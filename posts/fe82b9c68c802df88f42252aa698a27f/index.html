<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python爬虫处理滑块验证_python selenium爬虫滑块验证 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python爬虫处理滑块验证_python selenium爬虫滑块验证" />
<meta property="og:description" content="importrandomimporttimefrom PIL importImagefrom io importBytesIOimportrequests as rqfrom bs4 importBeautifulSoup as bsfrom selenium importwebdriverfrom selenium.webdriver importActionChainsfrom selenium.webdriver importChromeOptionsdefcrop_image(image_file_name):#保存图片
#截图验证码图片
#定位某个元素在浏览器中的位置
time.sleep(2)
img= browser.find_element_by_xpath(&#34;//*[@class=&#39;geetest_canvas_slice geetest_absolute&#39;]&#34;)
location=img.locationprint(&#34;图片的位置&#34;, location)
size=img.size
top, buttom, left, right= location[&#34;y&#34;], location[&#34;y&#34;]&#43;size[&#34;height&#34;], location[&#34;x&#34;], location[&#39;x&#39;] &#43; size[&#34;width&#34;]print(&#34;验证码位置&#34;, left,top, right, buttom)
screenshot=browser.get_screenshot_as_png()
screenshot=Image.open(BytesIO(screenshot))
captcha=screenshot.crop((int(left),int(top), int(right), int(buttom)))
captcha.save(image_file_name)returncaptchadefcompare_pixel(image1, image2, i, j):#判断两个图片像素是否相同
pixel1 =image1.load()[i, j]
pixel2=image2.load()[i, j]
threshold= 60
if abs(pixel1[0] - pixel2[0]) &lt; threshold and abs(pixel1[1] - pixel2[1]) &lt; threshold and abs(pixel1[2] - pixel2[2]) has_find =Falsefor i in range(left, img1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fe82b9c68c802df88f42252aa698a27f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-21T16:48:45+08:00" />
<meta property="article:modified_time" content="2020-12-21T16:48:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python爬虫处理滑块验证_python selenium爬虫滑块验证</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>importrandomimporttimefrom PIL importImagefrom io importBytesIOimportrequests as rqfrom bs4 importBeautifulSoup as bsfrom selenium importwebdriverfrom selenium.webdriver importActionChainsfrom selenium.webdriver importChromeOptionsdefcrop_image(image_file_name):#保存图片</p> 
 <p>#截图验证码图片</p> 
 <p>#定位某个元素在浏览器中的位置</p> 
 <p>time.sleep(2)</p> 
 <p>img= browser.find_element_by_xpath("//*[@class='geetest_canvas_slice geetest_absolute']")</p> 
 <p>location=img.locationprint("图片的位置", location)</p> 
 <p>size=img.size</p> 
 <p>top, buttom, left, right= location["y"], location["y"]+size["height"], location["x"], location['x'] + size["width"]print("验证码位置", left,top, right, buttom)</p> 
 <p>screenshot=browser.get_screenshot_as_png()</p> 
 <p>screenshot=Image.open(BytesIO(screenshot))</p> 
 <p>captcha=screenshot.crop((int(left),int(top), int(right), int(buttom)))</p> 
 <p>captcha.save(image_file_name)returncaptchadefcompare_pixel(image1, image2, i, j):#判断两个图片像素是否相同</p> 
 <p>pixel1 =image1.load()[i, j]</p> 
 <p>pixel2=image2.load()[i, j]</p> 
 <p>threshold= 60</p> 
 <p>if abs(pixel1[0] - pixel2[0]) &lt; threshold and abs(pixel1[1] - pixel2[1]) &lt; threshold and abs(pixel1[2] - pixel2[2]) </p> 
 <p>has_find =Falsefor i in range(left, img1.size[0]): #x坐标</p> 
 <p>if has_find: #找到不一样的位置，退出外层循环</p> 
 <p>break</p> 
 <p>for j in range(img1.size[1]): #y坐标(从0开始)</p> 
 <p>if not compare_pixel(img1, img2, i, j): #比较两张图片在同一位置的值</p> 
 <p>left =i</p> 
 <p>has_find= True #如果两张图片元素不一样，那么就退出内层循环</p> 
 <p>break</p> 
 <p>returnleft</p> 
 <p>options= ChromeOptions() #实例化一个ChromeOptions对象，设置参数避免被检测</p> 
 <p>options.add_experimental_option('excludeSwitches', ['enable-automation']) #以键值对的形式加入参数</p> 
 <p>options.add_argument("--no-sandbox")</p> 
 <p>options.add_argument("--start-maximized") #最大化窗口，一定要最大化，不然坐标会不准</p> 
 <p>options.add_argument('--disable-gpu')</p> 
 <p>browser=webdriver.Chrome(options=options)</p> 
 <p>time.sleep(0.6)</p> 
 <p>browser.get('https://www.bilibili.com/') #访问网站</p> 
 <p>time.sleep(0.5)</p> 
 <p>button= browser.find_element_by_xpath('//div[@class="mini-login van-popover__reference"]') #登陆</p> 
 <p>button.click()</p> 
 <p>browser.switch_to.window(browser.window_handles[1]) #对于新窗口，切换窗口句柄，不然句柄还保持在上一窗口，后面捕捉会出错</p> 
 <p>user= browser.find_element_by_xpath('//input[@id="login-username"]')</p> 
 <p>user.send_keys('19444338') #用户名</p> 
 <p>time.sleep(0.5)</p> 
 <p>passwd= browser.find_element_by_xpath('//input[@id="login-passwd"]')</p> 
 <p>passwd.send_keys('3346777') #密码</p> 
 <p>time.sleep(0.5)</p> 
 <p>login= browser.find_element_by_xpath('//a[@class="btn btn-login"]') #点击登录，出现验证码图片</p> 
 <p>login.click()</p> 
 <p>time.sleep(0.5)#滑块验证</p> 
 <p>defslid_verify():#缺口图片</p> 
 <p>img1 = crop_image('缺口图片.png')</p> 
 <p>time.sleep(0.5)#完整图片</p> 
 <p>#JS增删改查操作元素的属性</p> 
 <p>##新增属性</p> 
 <p>#driver.execute_script(“arguments[0].%s=arguments[1]” %attributeName,elementObj, value)</p> 
 <p>##修改属性</p> 
 <p>#driver.execute_script(“arguments[0].setAttribute(arguments[1],arguments[2])”, elementObj, attributeName, value)</p> 
 <p>##获取属性</p> 
 <p>#elementObj.get_attribute(attributeName)</p> 
 <p>##删除属性</p> 
 <p>#driver.execute_script(“arguments[0].removeAttribute(arguments[1])”,elementObj, attributeName)</p> 
 <p>#https://blog.csdn.net/DansonC/article/details/99398096</p> 
 <p>img_obj = browser.find_element_by_xpath('//*[@class="geetest_canvas_fullbg geetest_fade geetest_absolute"]') #找到图片，建立对象</p> 
 <p>#img_style = img_obj.get_attribute('style') # 记录style的值</p> 
 <p>browser.execute_script("arguments[0].removeAttribute(arguments[1])",img_obj, 'style') #删除图片属性，显示完整图片</p> 
 <p>img2 = crop_image('完整图片.png')#browser.execute_script("arguments[0].setAttribute(arguments[1],arguments[2])", img_obj, 'style', img_style) # 将style值添加回去，显示缺口图片</p> 
 <p>slider= browser.find_element_by_xpath("//div[@class='geetest_slider_button']") #找到拖动按钮</p> 
 <p>ActionChains(browser).move_to_element(slider).perform() #建立拖动对象</p> 
 <p>#获取滑块图片位置</p> 
 <p>slid_coor = find_coordinate(2, img1, img2)#获取缺口图片位置</p> 
 <p>target_coor = find_coordinate(57, img1, img2)print(slid_coor, target_coor)</p> 
 <p>target_coor-= 6 #调整偏移量</p> 
 <p>#拖动图片</p> 
 <p>track= [] #用于储存一次拖动滑块的距离(不能一次拖到位，不然会被判定为机器)</p> 
 <p>i =0#分为3断，分别设置不同速度，越接近缺口，越慢</p> 
 <p>stagev1 = round((target_coor-slid_coor)/4) #第1段(前3/5)：分为4次(平均距离移动)，stafev1为当前阶段的速度</p> 
 <p>while i</p> 
 <p>i+=stagev1</p> 
 <p>track.append(stagev1)</p> 
 <p>stagev2= round((target_coor-i)/7) #第2段(3/5到21/25)：分为7次(平均距离移动)</p> 
 <p>while i</p> 
 <p>i+=stagev2</p> 
 <p>track.append(stagev2)</p> 
 <p>stagev3= 1</p> 
 <p>while i</p> 
 <p>i +=stagev3</p> 
 <p>track.append(stagev3)</p> 
 <p>ActionChains(browser).click_and_hold(slider).perform()#点击，并按住鼠标不放</p> 
 <p>for x intrack:</p> 
 <p>ActionChains(browser).move_by_offset(xoffset=x, yoffset=0).perform() #拖动，x为一次移动的距离</p> 
 <p>time.sleep(0.5)</p> 
 <p>ActionChains(browser).release().perform()#放开鼠标</p> 
 <p>time.sleep(1)</p> 
 <p>success_flag= Selector(text=browser.page_source).xpath('/html/body/div[2]/div[2]/div[6]/div/div[1]/div[1]/div/div[3]/div/div[2]/text()').extract()[0]returnsuccess_flag</p> 
 <p>success_flag=slid_verify()while '超过' not in success_flag: #成功后，会有：'sec 秒的速度超过 score% 的用户'</p> 
 <p>if '怪物吃了拼图，请重试' == success_flag: #这是被判定为机器操作，需要"点击重试"</p> 
 <p>reclick = browser.find_element_by_xpath("//div[@class='geetest_panel_error_content']")</p> 
 <p>reclick.click()</p> 
 <p>re_verify= browser.find_element_by_xpath("//div[@class='geetest_slider_button']")</p> 
 <p>re_verify.click()</p> 
 <p>success_flag=slid_verify()</p> 
 <p>time.sleep(0.5)</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae2b256cb44971ebe81dd6a7d04ca6d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TypeError init() got an unexpected keyword argument ‘n_iter‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2e08fc4b9206b06c0aed0214714b44b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java实现定时任务的四种方式及其应用代码和基本概念-Timer/ScheduledExecutorService/SpringTask/Quartz</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>