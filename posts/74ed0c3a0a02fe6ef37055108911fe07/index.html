<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java通过FTPClient实现文件在指定文件夹的上传下载 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java通过FTPClient实现文件在指定文件夹的上传下载" />
<meta property="og:description" content="文章转载：
文件上传下载：https://www.cnblogs.com/yingyujyf/p/6933823.html
创建目录：FtpClient切换、创建目录不成功的问题（makeDirectory、changeWorkingDirectory）_ftp.changeworkingdirectory_weixin_40582761的博客-CSDN博客
目录绝对路径相对路径：java FTPClient中的相对路径和绝对路径_ftp相对路径,绝对路径_野猿新一的博客-CSDN博客
通过FTPClient对象操作上传下载需要引入jar包commons-net-1.4.1.jar，maven依赖如下
&lt;dependency&gt; &lt;groupId&gt;commons-net&lt;/groupId&gt; &lt;artifactId&gt;commons-net&lt;/artifactId&gt; &lt;version&gt;3.3&lt;/version&gt; &lt;/dependency&gt; ftpClient.retrieveFile方法用于下载文件
ftpClient.storeFile方法用于上传文件
ftpClient.makeDirectory创建目录（只能逐级创建，下面详细说明）
ftpClient.changeWorkingDirectory(&#34;/&#34;); // 切换到根目录，绝对目录
String dir = ftpClient.printWorkingDirectory(); // 获取当前工作目录
ftpClient.changeWorkingDirectory(dir); // 切换到当前目录
所以，上传下载的方法需要将这两个方法封装进去
ftp工具类：
package ftp.ftp2; import org.apache.commons.net.ftp.FTPClient; import org.apache.commons.net.ftp.FTPReply; import sun.net.TelnetOutputStream; import sun.net.ftp.FtpProtocolException; import java.io.*; import java.net.SocketException; import java.util.Properties; public class FtpUtil { /** * 获取FTPClient对象 * * @param ftpHost FTP主机服务器 * @param ftpPassword FTP 登录密码 * @param ftpUserName FTP登录用户名 * @param ftpPort FTP端口 默认为21 * @return */ public static FTPClient getFTPClient(String ftpHost, String ftpUserName, String ftpPassword, int ftpPort) { FTPClient ftpClient = new FTPClient(); try { ftpClient = new FTPClient(); ftpClient." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/74ed0c3a0a02fe6ef37055108911fe07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-19T08:42:39+08:00" />
<meta property="article:modified_time" content="2023-05-19T08:42:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java通过FTPClient实现文件在指定文件夹的上传下载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>文章转载</strong>：</p> 
<p>文件上传下载：<a href="https://www.cnblogs.com/yingyujyf/p/6933823.html" rel="nofollow" title="https://www.cnblogs.com/yingyujyf/p/6933823.html">https://www.cnblogs.com/yingyujyf/p/6933823.html</a></p> 
<p>创建目录：<a href="https://blog.csdn.net/weixin_40582761/article/details/87185007" title="FtpClient切换、创建目录不成功的问题（makeDirectory、changeWorkingDirectory）_ftp.changeworkingdirectory_weixin_40582761的博客-CSDN博客">FtpClient切换、创建目录不成功的问题（makeDirectory、changeWorkingDirectory）_ftp.changeworkingdirectory_weixin_40582761的博客-CSDN博客</a></p> 
<p>目录绝对路径相对路径：<a href="https://blog.csdn.net/mqdxiaoxiao/article/details/107463378" title="java FTPClient中的相对路径和绝对路径_ftp相对路径,绝对路径_野猿新一的博客-CSDN博客">java FTPClient中的相对路径和绝对路径_ftp相对路径,绝对路径_野猿新一的博客-CSDN博客</a></p> 
<p></p> 
<p>通过FTPClient对象操作上传下载需要引入jar包commons-net-1.4.1.jar，maven依赖如下</p> 
<pre><code class="language-XML">    &lt;dependency&gt;
        &lt;groupId&gt;commons-net&lt;/groupId&gt;
        &lt;artifactId&gt;commons-net&lt;/artifactId&gt;
        &lt;version&gt;3.3&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> 
<p>ftpClient.retrieveFile方法用于下载文件</p> 
<p>ftpClient.storeFile方法用于上传文件</p> 
<p>ftpClient.makeDirectory创建目录（只能逐级创建，下面详细说明）</p> 
<p>ftpClient.changeWorkingDirectory("/"); // 切换到根目录，绝对目录</p> 
<p>String dir = ftpClient.printWorkingDirectory(); // 获取当前工作目录</p> 
<p>ftpClient.changeWorkingDirectory(dir); // 切换到当前目录</p> 
<p>所以，上传下载的方法需要将这两个方法封装进去</p> 
<p>ftp工具类：</p> 
<pre><code class="language-java">package ftp.ftp2;


import org.apache.commons.net.ftp.FTPClient;
import org.apache.commons.net.ftp.FTPReply;
import sun.net.TelnetOutputStream;
import sun.net.ftp.FtpProtocolException;

import java.io.*;
import java.net.SocketException;
import java.util.Properties;



public class FtpUtil {

    /**
     * 获取FTPClient对象
     *
     * @param ftpHost     FTP主机服务器
     * @param ftpPassword FTP 登录密码
     * @param ftpUserName FTP登录用户名
     * @param ftpPort     FTP端口 默认为21
     * @return
     */
    public static FTPClient getFTPClient(String ftpHost, String ftpUserName,
                                         String ftpPassword, int ftpPort) {
        FTPClient ftpClient = new FTPClient();
        try {
            ftpClient = new FTPClient();
            ftpClient.connect(ftpHost, ftpPort);// 连接FTP服务器
            ftpClient.login(ftpUserName, ftpPassword);// 登陆FTP服务器
            if (!FTPReply.isPositiveCompletion(ftpClient.getReplyCode())) {
                System.out.println("未连接到FTP，用户名或密码错误。");
                ftpClient.disconnect();
            } else {
                System.out.println("FTP连接成功。");
            }
        } catch (SocketException e) {
            e.printStackTrace();
            System.out.println("FTP的IP地址可能错误，请正确配置。");
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("FTP的端口错误,请正确配置。");
        }
        return ftpClient;
    }

    /*
     * 从FTP服务器下载文件
     *
     * @param ftpHost FTP IP地址
     * @param ftpUserName FTP 用户名
     * @param ftpPassword FTP用户名密码
     * @param ftpPort FTP端口
     * @param ftpPath FTP服务器中文件所在路径 格式： ftptest/aa
     * @param localPath 下载到本地的位置 格式：H:/download
     * @param fileName 文件名称
     */
    public static void downloadFtpFile(String ftpHost, String ftpUserName,
                                       String ftpPassword, int ftpPort, String ftpPath, String localPath,
                                       String fileName) {

        FTPClient ftpClient = null;

        try {
            ftpClient = getFTPClient(ftpHost, ftpUserName, ftpPassword, ftpPort);
            ftpClient.setControlEncoding("UTF-8"); // 中文支持
            ftpClient.setFileType(FTPClient.BINARY_FILE_TYPE);
            ftpClient.enterLocalPassiveMode();
            ftpClient.changeWorkingDirectory(ftpPath);

            File localFile = new File(localPath + File.separatorChar + fileName);
            OutputStream os = new FileOutputStream(localFile);
            ftpClient.retrieveFile(fileName, os);
            os.close();
            ftpClient.logout();

        } catch (FileNotFoundException e) {
            System.out.println("没有找到" + ftpPath + "文件");
            e.printStackTrace();
        } catch (SocketException e) {
            System.out.println("连接FTP失败.");
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("文件读取错误。");
            e.printStackTrace();
        }

    }

    /**
     * Description: 向FTP服务器上传文件
     * @param ftpHost FTP服务器hostname
     * @param ftpUserName 账号
     * @param ftpPassword 密码
     * @param ftpPort 端口
     * @param ftpPath  FTP服务器中文件所在路径 格式： ftptest/aa
     * @param fileName ftp文件名称
     * @param input 文件流
     * @return 成功返回true，否则返回false
     */
    public static boolean uploadFile(String ftpHost, String ftpUserName,
                                     String ftpPassword, int ftpPort, String ftpPath,
                                     String fileName,InputStream input) {
        boolean success = false;
        FTPClient ftpClient = null;
        try {
            int reply;
            ftpClient = getFTPClient(ftpHost, ftpUserName, ftpPassword, ftpPort);
            reply = ftpClient.getReplyCode();
            if (!FTPReply.isPositiveCompletion(reply)) {
                ftpClient.disconnect();
                return success;
            }
            ftpClient.setControlEncoding("UTF-8"); // 中文支持
            ftpClient.setFileType(FTPClient.BINARY_FILE_TYPE);
            ftpClient.enterLocalPassiveMode();
            ftpClient.changeWorkingDirectory(ftpPath);

            ftpClient.storeFile(fileName, input);

            input.close();
            ftpClient.logout();
            success = true;
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            if (ftpClient.isConnected()) {
                try {
                    ftpClient.disconnect();
                } catch (IOException ioe) {
                }
            }
        }
        return success;
    }

}</code></pre> 
<p>测试类：</p> 
<pre><code class="language-java">package ftp.ftp2;

import java.io.*;

/**
 * Created by jyf on 2017/6/2.
 */
public class test {
    public static void main(String[] args) {
        String ftpHost = "172.16.114.10";
        String ftpUserName = "user";
        String ftpPassword = "a";
        int ftpPort = 21;
        String ftpPath = "test2/";
        String localPath = "F:\\11.txt";
        String fileName = "11.txt";

        //上传一个文件
        try{
            FileInputStream in=new FileInputStream(new File(localPath));
            boolean test = FtpUtil.uploadFile(ftpHost, ftpUserName, ftpPassword, ftpPort, ftpPath, fileName,in);
            System.out.println(test);
        } catch (FileNotFoundException e){
            e.printStackTrace();
            System.out.println(e);
        }

        //在FTP服务器上生成一个文件，并将一个字符串写入到该文件中
        try {
            InputStream input = new ByteArrayInputStream("test ftp jyf".getBytes("GBK"));
            boolean flag = FtpUtil.uploadFile(ftpHost, ftpUserName, ftpPassword, ftpPort, ftpPath, fileName,input);;
            System.out.println(flag);
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }

        //下载一个文件
        FtpUtil.downloadFtpFile(ftpHost, ftpUserName, ftpPassword, ftpPort, ftpPath, localPath, fileName);
    }
}</code></pre> 
<p>实际项目中的上传下载可能需要对操作的文件指定特定的目录，比如上传文件到指定目录，目录不存在需要动态的创建目录，对目录的操作如下</p> 
<p>Ftp创建目录只能逐级创建，你用创建目录的方法不能直接/aaa/bbb/这么创建要先创建aaa/，在/aaa/的目录下再创建bbb/。</p> 
<p>创建路径示例</p> 
<pre><code class="language-java">public static void main(String[] args) throws Exception {
    ConfigUtil instance = ConfigUtil.getInstance("/config.properties");
    FTPClient ftp = null;
    try {
      ftp = FtpUtil.getFTPClient(instance.getValue("ftp_ip"), instance.getValue("ftp_port"),
        instance.getValue("ftp_user"), instance.getValue("ftp_pwd"));
      ftp.setFileType(FTP.BINARY_FILE_TYPE);
      ftp.enterLocalPassiveMode();
      ftp.setDefaultTimeout(600000);
      ftp.setDataTimeout(600000);
      ftp.setSoTimeout(600000);
      ftp.setControlEncoding("GBK");
     
      String fileUrl = "/aaa/bbb/";
     
      if (!ftp.changeWorkingDirectory(fileUrl)) {
        System.err.println("不存在");
        boolean makeDirectory = ftp.makeDirectory(fileUrl);
        boolean changeWorkingDirectory = ftp.changeWorkingDirectory(fileUrl);
        System.err.println("创建：" + makeDirectory + ";切换：" + changeWorkingDirectory);
      } else {
        System.err.println("存在");
      }
     
    }catch (Exception e) {
      e.printStackTrace();
      throw e;
    }finally {
      if(ftp != null) {
        try {
          ftp.logout();
          ftp.disconnect();
        }
        catch (IOException e) {
          e.printStackTrace();
        }
      }
    }
  }
————————————————
版权声明：本文为CSDN博主「weixin_40582761」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_40582761/article/details/87185007</code></pre> 
<p>没有/aaa/目录会报错，有会创建bbb/目录</p> 
<p>实际应用时可能没有父目录/aaa/，那么就需要先创建父目录/aaa/再创建bbb/子目录，而这就是下面要演示的逐级创建</p> 
<pre><code class="language-java">public static void main(String[] args) throws Exception {
    ConfigUtil instance = ConfigUtil.getInstance("/config.properties");
    FTPClient ftp = null;
    try {
      ftp = FtpUtil.getFTPClient(instance.getValue("ftp_ip"), instance.getValue("ftp_port"),
        instance.getValue("ftp_user"), instance.getValue("ftp_pwd"));
      ftp.setFileType(FTP.BINARY_FILE_TYPE);
      ftp.enterLocalPassiveMode();
      ftp.setDefaultTimeout(600000);
      ftp.setDataTimeout(600000);
      ftp.setSoTimeout(600000);
      ftp.setControlEncoding("GBK");
     
      String fileUrl = "/aaa/bbb/ccc";
     
      /*该部分为逐级创建*/
      String[] split = fileUrl.split("/");
     
      for (String str : split) {
        if(StringUtils.isBlank(str)) {
          continue;
        }
        if (!ftp.changeWorkingDirectory(str)) {
          System.err.println("不存在");
          boolean makeDirectory = ftp.makeDirectory(str);
          boolean changeWorkingDirectory = ftp.changeWorkingDirectory(str);
          System.err.println(str + "创建：" + makeDirectory + ";切换：" + changeWorkingDirectory);
        } else {
          System.err.println("存在");
        }
      }
     
    }catch (Exception e) {
      e.printStackTrace();
      throw e;
    }finally {
      if(ftp != null) {
        try {
          ftp.logout();
          ftp.disconnect();
        }
        catch (IOException e) {
          e.printStackTrace();
        }
      }
    }
  }
————————————————
版权声明：本文为CSDN博主「weixin_40582761」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_40582761/article/details/87185007</code></pre> 
<p>操作目录需要知道目录的路径，这时就有绝对路径相对路径一说了</p> 
<p>这篇文章说的很好<a href="https://blog.csdn.net/mqdxiaoxiao/article/details/107463378" title="java FTPClient中的相对路径和绝对路径_ftp相对路径,绝对路径_野猿新一的博客-CSDN博客">java FTPClient中的相对路径和绝对路径_ftp相对路径,绝对路径_野猿新一的博客-CSDN博客</a></p> 
<p>下面是直接转载的上面链接的内容</p> 
<p>根目录<br> FTPClient的根目录为"/"</p> 
<p>切换到根目录</p> 
<pre><code class="language-java">ftpClient.changeWorkingDirectory("/"); // 切换到根目录
String dir = ftpClient.printWorkingDirectory(); // 获取当前工作目录
System.out.println(dir); // 打印输出当前工作目录，输出结果为"/"</code></pre> 
<p><br> 绝对路径<br> 绝对路径是以/开头的，比如"/AA"，"/AA/BB"，"/AA/BB/CC/"，"/AA/BB/CC/test.txt"等</p> 
<p>使用绝对路径的话不受当前工作路径的影响，</p> 
<p>比如如下实例代码使用changeWorkingDirectory("/A1/B1")方法切换当前工作路径到/A1/B1文件夹下</p> 
<p>但是我们使用ftpClient.listNames("/A1/B2")绝对路径获取/A1/B2文件夹下的文件，并不受当前工作目录的影响</p> 
<p>记得绝对路径一定是以/开头的不要写成"A1/B2"，这样的话就变成相对路径了，就会受当前路径的影响，相对路径"A1/B2"转化成绝对路径其实就是当前工作目录+相对路径，也就是"/A1/B1/A1/B2"</p> 
<p>对于相对路径我们下面部分会再详细说明</p> 
<pre><code class="language-java">public static void main(String[] args) {
    try {
        FTPClient ftpClient = new FTPClient();
        ftpClient.connect(ftpIp, ftpPort);
        ftpClient.login(ftpName, ftpPws);
        ftpClient.enterLocalPassiveMode();
 
        ftpClient.changeWorkingDirectory("/A1/B1");
        System.out.println("当前工作目录：" + ftpClient.printWorkingDirectory());
 
        String[] names = ftpClient.listNames("/A1/B2");
        System.out.println("/A1/B2目录下的文件：" + Arrays.toString(names));
    } catch (IOException e) {
        e.printStackTrace();
    }
}</code></pre> 
<p><br> 输出结果</p> 
<p>当前工作目录：/A1/B1<br> /A1/B2目录下的文件：[/A1/B2/b21.txt, /A1/B2/b22.txt]<br> 相对路径<br> 相对路径开头没有/</p> 
<p>相对路径的绝对路径为当前路径+相对路径</p> 
<p>如下实例先把当前工作目录切换到A1，然后再通过changeWorkingDirectory("B1")切换到B1，由于所以传入的是相对路径，所以实际切换后的路径是当前工作路径+B1，也就是/A1/B1</p> 
<p>最后再通过changeWorkingDirectory("/A1")，切换回A1目录，注意这时候传的是绝对路径所以不受当前工作目录影响，所以切换后的工作路径是"/A1"，而不是"/A1/B1/A1"</p> 
<pre><code class="language-java">public static void main(String[] args) {
    try {
        FTPClient ftpClient = new FTPClient();
        ftpClient.connect(ftpIp, ftpPort);
        ftpClient.login(ftpName, ftpPws);
        ftpClient.enterLocalPassiveMode();
        
        ftpClient.changeWorkingDirectory("/A1");
        System.out.println("当前工作目录：" + ftpClient.printWorkingDirectory());
 
        ftpClient.changeWorkingDirectory("B1");
        System.out.println("当前工作目录：" + ftpClient.printWorkingDirectory());
 
        ftpClient.changeWorkingDirectory("/A1");
        System.out.println("当前工作目录：" + ftpClient.printWorkingDirectory());
    } catch (IOException e) {
        e.printStackTrace();
    }
}</code></pre> 
<p><br> 输出结果为</p> 
<p>当前工作目录：/A1<br> 当前工作目录：/A1/B1<br> 当前工作目录：/A1<br> 适用的方法<br> 基本上FTPClient中所有关于文件或文件夹操作的方法都适用绝对路径和相对路径，有多个参数的方法还可以两种方式同时使用，比如rename("B1/test.txt", "/A1/test.txt")，下面列出比较常见的方法</p> 
<p>changeWorkingDirectory<br> listNames<br> retrieveFile<br> retrieveFileStream<br> storeFile<br> storeFileStream<br> makeDirectory<br> rename<br> 总结<br> 绝对路径以"/"开头</p> 
<p>相对路径不以"/"开头</p> 
<p>相对路径转成绝对路径=当前工作目录 + "/" + 绝对路径</p> 
<p>建议能使用绝对路径就尽量不要使用相对路径，因为绝对路径你能够一目了然地知道你当前在操作的文件路径，而如果使用相对路径的话很容易出现错误，因为FTP操作中经常会使用changeWorkingDirectory切换工作目录，切来切去的话到最后你都不知道当前工作目录是哪个</p> 
<p>本篇文章其实是一个思考问题循序渐进的过程，你要上传下载文件需要用ftpClient.retrieveFile方法用于下载文件，ftpClient.storeFile方法用于上传文件。上传的话可能需要在远程服务器创建目录将文件上传到此目录下就要用到ftpClient.makeDirectory创建目录（只能逐级创建）。而创建目录时需要将操作空间转到当前目录下才能操作</p> 
<p>String dir = ftpClient.printWorkingDirectory(); // 获取当前工作目录</p> 
<p>ftpClient.changeWorkingDirectory(dir); // 切换到当前目录</p> 
<p>所以顺序是先将操作空间改变到指定目录下，新增文件夹，上传文件</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a728bfad15887ee70cf0d50760130ab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何实现百万并发连接的 Nginx 集群</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d667ef45219b61c51d139a87bd47ceff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">链路追踪、配置中心</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>