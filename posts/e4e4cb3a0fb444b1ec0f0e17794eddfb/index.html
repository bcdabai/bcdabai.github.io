<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka事务机制：原理和实践 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kafka事务机制：原理和实践" />
<meta property="og:description" content="Kafka事务机制：原理和实践 Apache Kafka 是一个分布式流处理平台，广泛用于构建实时数据管道和流应用程序。它不仅以高吞吐量、可扩展性和容错能力著称，还提供了事务支持，以确保数据的完整性和一致性。在这篇博客中，我们将深入探讨 Kafka 的事务机制，了解其原理，并通过一个实际的例子来说明其应用。
Kafka事务简介 在 Kafka 0.11 版本之前，它主要支持“至少一次”（At-Least-Once）和“最多一次”（At-Most-Once）的消息传递保证。然而，这些保证在需要跨多个分区和主题原子地更新数据时显得不够。为了解决这个问题，Kafka 0.11 引入了事务支持，允许跨多个分区和主题进行原子写操作。
事务原理 Kafka 的事务功能基于以下几个核心概念：
事务协调器（Transaction Coordinator）:
Kafka 为每个事务分配一个事务协调器，它负责管理事务的状态。 事务日志（Transaction Log）:
Kafka 使用专门的事务日志来记录事务的状态更改。 生产者ID和事务ID:
每个事务都有唯一的事务ID，生产者使用这个ID来初始化事务。 幂等性:
Kafka 保证在一个事务内部，即使生产者重试发送消息，也不会导致消息重复。 写入隔离:
Kafka 确保只有已提交的事务的消息对消费者可见。 事务的处理流程 初始化事务:
生产者开始一个事务，向事务协调器发送初始化请求。 写操作:
生产者将消息发送到一个或多个主题的分区中。这些消息在事务提交或中止之前，对消费者是不可见的。 提交或中止事务:
生产者可以决定提交事务，使所有写操作对消费者可见，或中止事务以放弃所有更改。 实例应用 假设我们有一个简单的电商应用，需要在订单服务和库存服务之间同步数据。当一个新订单创建时，我们需要在订单主题中写入订单数据，并在库存主题中更新库存信息。
初始化事务:
订单服务开始一个新的事务。 写订单数据:
订单服务向订单主题写入新订单的数据。 更新库存:
同一个事务中，订单服务还需要在库存主题中更新库存信息。 提交事务:
如果两个操作都成功，订单服务提交事务。这时，订单数据和库存更新对消费者可见。 中止事务:
如果任一操作失败，订单服务将中止事务，从而撤销所有更改。 通过这种方式，Kafka 确保了订单创建和库存更新要么都成功，要么都不执行，从而保证了数据的一致性。
结语 Kafka 的事务机制为处理跨多个分区和主题的复杂数据流提供了强大的工具。它确保了数据的一致性和完整性，使 Kafka 成为构建可靠、一致的分布式应用和微服务的理想选择。通过合理地利用 Kafka 事务，开发者可以设计出更健壮、更容错的系统。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e4e4cb3a0fb444b1ec0f0e17794eddfb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-28T17:47:03+08:00" />
<meta property="article:modified_time" content="2023-11-28T17:47:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka事务机制：原理和实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Kafka_0"></a>Kafka事务机制：原理和实践</h2> 
<p>Apache Kafka 是一个分布式流处理平台，广泛用于构建实时数据管道和流应用程序。它不仅以高吞吐量、可扩展性和容错能力著称，还提供了事务支持，以确保数据的完整性和一致性。在这篇博客中，我们将深入探讨 Kafka 的事务机制，了解其原理，并通过一个实际的例子来说明其应用。</p> 
<h3><a id="Kafka_4"></a>Kafka事务简介</h3> 
<p>在 Kafka 0.11 版本之前，它主要支持“至少一次”（At-Least-Once）和“最多一次”（At-Most-Once）的消息传递保证。然而，这些保证在需要跨多个分区和主题原子地更新数据时显得不够。为了解决这个问题，Kafka 0.11 引入了事务支持，允许跨多个分区和主题进行原子写操作。</p> 
<h3><a id="_8"></a>事务原理</h3> 
<p>Kafka 的事务功能基于以下几个核心概念：</p> 
<ol><li> <p><strong>事务协调器（Transaction Coordinator）</strong>:</p> 
  <ul><li>Kafka 为每个事务分配一个事务协调器，它负责管理事务的状态。</li></ul> </li><li> <p><strong>事务日志（Transaction Log）</strong>:</p> 
  <ul><li>Kafka 使用专门的事务日志来记录事务的状态更改。</li></ul> </li><li> <p><strong>生产者ID和事务ID</strong>:</p> 
  <ul><li>每个事务都有唯一的事务ID，生产者使用这个ID来初始化事务。</li></ul> </li><li> <p><strong>幂等性</strong>:</p> 
  <ul><li>Kafka 保证在一个事务内部，即使生产者重试发送消息，也不会导致消息重复。</li></ul> </li><li> <p><strong>写入隔离</strong>:</p> 
  <ul><li>Kafka 确保只有已提交的事务的消息对消费者可见。</li></ul> </li></ol> 
<h4><a id="_27"></a>事务的处理流程</h4> 
<ol><li> <p><strong>初始化事务</strong>:</p> 
  <ul><li>生产者开始一个事务，向事务协调器发送初始化请求。</li></ul> </li><li> <p><strong>写操作</strong>:</p> 
  <ul><li>生产者将消息发送到一个或多个主题的分区中。这些消息在事务提交或中止之前，对消费者是不可见的。</li></ul> </li><li> <p><strong>提交或中止事务</strong>:</p> 
  <ul><li>生产者可以决定提交事务，使所有写操作对消费者可见，或中止事务以放弃所有更改。</li></ul> </li></ol> 
<p><img src="https://images2.imgbox.com/a5/7a/tfGb4GGV_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_41"></a>实例应用</h3> 
<p>假设我们有一个简单的电商应用，需要在订单服务和库存服务之间同步数据。当一个新订单创建时，我们需要在订单主题中写入订单数据，并在库存主题中更新库存信息。</p> 
<ol><li> <p><strong>初始化事务</strong>:</p> 
  <ul><li>订单服务开始一个新的事务。</li></ul> </li><li> <p><strong>写订单数据</strong>:</p> 
  <ul><li>订单服务向订单主题写入新订单的数据。</li></ul> </li><li> <p><strong>更新库存</strong>:</p> 
  <ul><li>同一个事务中，订单服务还需要在库存主题中更新库存信息。</li></ul> </li><li> <p><strong>提交事务</strong>:</p> 
  <ul><li>如果两个操作都成功，订单服务提交事务。这时，订单数据和库存更新对消费者可见。</li></ul> </li><li> <p><strong>中止事务</strong>:</p> 
  <ul><li>如果任一操作失败，订单服务将中止事务，从而撤销所有更改。</li></ul> </li></ol> 
<p>通过这种方式，Kafka 确保了订单创建和库存更新要么都成功，要么都不执行，从而保证了数据的一致性。</p> 
<h3><a id="_62"></a>结语</h3> 
<p>Kafka 的事务机制为处理跨多个分区和主题的复杂数据流提供了强大的工具。它确保了数据的一致性和完整性，使 Kafka 成为构建可靠、一致的分布式应用和微服务的理想选择。通过合理地利用 Kafka 事务，开发者可以设计出更健壮、更容错的系统。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85c3c435f0ff28e4c3b37f62097146f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kafka生产者发送消息的流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2e0c4179f9e80a6a940da93ec37ee834/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">杂记 | 使用Docker安装并配置MongoDB以支持事务（单副本，并解决了证书文件错误的问题）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>