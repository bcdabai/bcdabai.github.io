<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ddns文件服务器,DDNS基础配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ddns文件服务器,DDNS基础配置" />
<meta property="og:description" content="2、DHCP服务器配置
DHCP服务器安装配置比较简单，我就简要介绍下。配置文件在/etc/dhcpd/dhcpd.conf1: subnet 10.0.0.0 netmask 255.255.255.0 { #定义一个网段2: range 10.0.0.101 10.0.0.105; #地址池范围3: option domain-name-servers 10.0.0.1; #DNS服务地址4: option domain-name &#34;test.local&#34;; #域名5: option routers 10.0.0.1; #网关地址6: option broadcast-address 10.0.0.255; #广播地址7: default-lease-time 600; #默认租约时间8: max-lease-time 7200; #最大租约时间9: }10: 上面的部分都是DHCP配置内容，下面部分是针对的DDNS的配置11: key DHCP_UPDATER { #和DNS服务器同样定义key12: algorithm hmac-md5;13: secret ypvqSixjeGlarwFoRyX//w==;14: };15:16: zone test.local. { #定义DHCP可以发送的正向DNS17: primary 127.0.0.1;18: key DHCP_UPDATER;19: }20:21: zone 0.0.10.in-addr.arpa. { #同上，反向22: primary 127.0.0.1;23: key DHCP_UPDATER;24: }补充两个参数，刚刚忘加上了。1: ddns-update-style interim;
2: ignore client-updates;同理，重启DHCP服务。1: [root@Master ~]# service dhcpd restart" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a22c74ffde779523480e4665568e0b84/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-09T23:12:19+08:00" />
<meta property="article:modified_time" content="2021-08-09T23:12:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ddns文件服务器,DDNS基础配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>2、DHCP服务器配置</p> 
 <p>DHCP服务器安装配置比较简单，我就简要介绍下。配置文件在/etc/dhcpd/dhcpd.conf1:  subnet 10.0.0.0 netmask 255.255.255.0 {                #定义一个网段2:    range 10.0.0.101 10.0.0.105;                         #地址池范围3:    option domain-name-servers 10.0.0.1;                 #DNS服务地址4:    option domain-name "test.local";                     #域名5:    option routers 10.0.0.1;                             #网关地址6:    option broadcast-address 10.0.0.255;                 #广播地址7:    default-lease-time 600;                              #默认租约时间8:    max-lease-time 7200;                                 #最大租约时间9:  }10:   上面的部分都是DHCP配置内容，下面部分是针对的DDNS的配置11:   key DHCP_UPDATER {                                    #和DNS服务器同样定义key12:           algorithm hmac-md5;13:           secret ypvqSixjeGlarwFoRyX//w==;14:  };15:16:         zone test.local. {                              #定义DHCP可以发送的正向DNS17:            primary 127.0.0.1;18:            key DHCP_UPDATER;19:   }20:21:         zone 0.0.10.in-addr.arpa. {                     #同上，反向22:              primary 127.0.0.1;23:              key DHCP_UPDATER;24:  }补充两个参数，刚刚忘加上了。1:  ddns-update-style interim;</p> 
 <p>2:  ignore client-updates;同理，重启DHCP服务。1:  [root@Master ~]# service dhcpd restart</p> 
 <p>2:  Shutting down dhcpd:                                       [  OK  ]</p> 
 <p>3:  Starting dhcpd:                                            [  OK  ]</p> 
 <p>四、客户端配置</p> 
 <p>linux客户端比较特别，需要设置一下dhclient.conf这个文件来更新客户机的FQDN。1:  [root@client2 ~]# hostname -A ;hostname -I</p> 
 <p>2:  client2.test.local</p> 
 <p>3:  10.0.0.105</p> 
 <p>4:  [root@client2 ~]# cat /etc/dhcp/dhclient.conf #如果没有这个这个文件，手动创建一个</p> 
 <p>5:  send fqdn.fqdn "client2";</p> 
 <p>6:  send fqdn.encoded on;</p> 
 <p>7:  send fqdn.server-update on;</p> 
 <p>客户端测试命令</p> 
 <p>1:  [root@client2 ~]# dhclient -r &amp;&amp; dhclient</p> 
 <p>五、测试验证</p> 
 <p>1、通过日志来查看，正反向地址都更新到DNS服务器上了。1:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53029: signer "dhcp_updater" approved2:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53029: updating zone 'test.local/IN': adding an RR at 'client2.test.local' A3:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53029: updating zone 'test.local/IN': adding an RR at 'client2.test.local' TXT4:  Jul 14 21:29:19 Master dhcpd: Added new forward map from client2.test.local to 10.0.0.1055:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53722: signer "dhcp_updater" approved6:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53722: updating zone '0.0.10.in-addr.arpa/IN': deleting rrset at '105.0.0.10.in-addr.arpa' PTR7:  Jul 14 21:29:19 Master named[24550]: client 10.0.0.1#53722: updating zone '0.0.10.in-addr.arpa/IN': adding an RR at '105.0.0.10.in-addr.arpa' PTR</p> 
 <p>2、通过dig解析命令来查看是否能成功解析。</p> 
 <p>正向解析已成功1:  [root@client2 ~]# dig -t A client2.test.local</p> 
 <p>2:</p> 
 <p>3:  ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; -t A client2.test.local</p> 
 <p>4:  ;; global options: +cmd</p> 
 <p>5:  ;; Got answer:</p> 
 <p>6:  ;; -&gt;&gt;HEADER&lt;</p> 
 <p>7:  ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</p> 
 <p>8:</p> 
 <p>9:  ;; QUESTION SECTION:</p> 
 <p>10:  ;client2.test.local.        IN    A</p> 
 <p>11:</p> 
 <p>12:  ;; ANSWER SECTION:</p> 
 <p>13:  client2.test.local.    300    IN    A    10.0.0.105</p> 
 <p>14:</p> 
 <p>15:  ;; AUTHORITY SECTION:</p> 
 <p>16:  test.local.        86400    IN    NS    master.test.local.</p> 
 <p>17:</p> 
 <p>18:  ;; ADDITIONAL SECTION:</p> 
 <p>19:  master.test.local.    86400    IN    A    10.0.0.1</p> 
 <p>20:</p> 
 <p>21:  ;; Query time: 0 msec</p> 
 <p>22:  ;; SERVER: 10.0.0.1#53(10.0.0.1)</p> 
 <p>23:  ;; WHEN: Sat Mar 22 15:55:45 2014</p> 
 <p>24:  ;; MSG SIZE  rcvd: 89</p> 
 <p>反向解析已成功</p> 
 <p>1:  [root@client2 ~]# dig -x 10.0.0.1052:3:  ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; -x 10.0.0.1054:  ;; global options: +cmd5:  ;; Got answer:6:  ;; -&gt;&gt;HEADER&lt;</p> 
 <p>六、补充</p> 
 <p>启动DDNS服务器后，在DNS目录中会创建以jnl文件结尾的文件。此文件是用来临时存储动态DNS记录，一般过段时间会同步到zone文件中，不过默认多少时间和如何定义我没有查到相关信息。暂时先存疑吧。</p> 
 <p>最后说说会出现的一些故障吧，我遇到过2个故障：</p> 
 <p>1、连接拒绝，后来发现是我DNS监听在“listen-on port 53    { 10.0.0.1; };”上，而我的dhcp中的更新地址写的而是 “primary 127.0.0.1”。所以导致更新失败。1:  Master dhcpd: Unable to add forward map from client2.test.local to 10.0.0.105: connection refused</p> 
 <p>2、还有一个错误日志我找不到了，大致问题就是DNS目录权限问题。无法写入jnl结尾的文件，修改下即可。</p> 
 <p>后记，写着东西挺累，排版更累。很多不尽完善的地方，大家将就着看吧！</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/06aa2b2c55404cc0660495e70660bada/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微软更新服务器win7,Download Windows 7 的平台更新 from Official Microsoft Download Center</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e1eec77d8b6aa9f8776f60d7a36dea44/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">STM32学习笔记1——软硬件基础之keil5编程与GPIO开发</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>