<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt 多语言界面设计概述 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt 多语言界面设计概述" />
<meta property="og:description" content="1、多语言界面设计概述
有些软件需要开发多语言界面版本，如中文版和英文版，并且在软件里可以方便地切换界面语言。Qt 为多语言界面提供了很好的支持，使用 Qt 的一些规则和工具，可以很方便地为应用程序开发提供多语言界面支持。
用 Qt 开发多语言界面应用程序，主要包括以下几个步骤：
(1)在程序设计阶段，程序代码中每一个用户可见的字符串都用 tr()函数封装，以便 Qt 提取界面字符串用于生成翻译资源文件。用UI设计器可视化设计窗体时统一用一种语言，如汉语。
(2)在项目配置文件 (.pro 文件)中设置需要导出的翻译文件 (.ts 文件)名称，使用 lupdate工具扫描项目文件中需要翻译的字符串，并生成翻译文件。
(3)使用 Qt 的 Linguist程序打开生成的翻译文件，将程序中的字符串翻译为需要的语言，如将所有中文字符串翻译为英文。
(4)使用 lrelease工具编译翻译好的翻译文件，生成更为紧凑的“.qm”文件。
(5)在应用程序中用QTranslator 调用不同的“.qm”文件，实现不同的语言界面。
2、tr()函数的使用
为了让 Qt 能自动提取程序中用户可见的字符串，对于每个字符串都需要使用 tr()函数封装。tr()是 QObject 的一个静态函数，在使用了Q_OBJECT 宏定义的类或QObiect 的子类中，都可以直接使用 tr()函数，否则需要使用 QObiect::tr()进行调用。或者在类定义中用 Q_DECLARE_TR_FUNCTIONS 宏把tr()函数添加到类中之后，再直接调用 tr()函数。
tr()函数的定义是：
QString QObject::tr(const char *sourceText, const char *disambiguation = Q_NULLPTR, int n = -1) 其中，sourceText 是源字符串，disambiguation 是为翻译者提供额外信息的字符串，用于对些容易混淆的地方作说明，内容如下:
LabCellPos = new QLabel(tr(&#34;当前单元格:&#34;),this); QMessageBox::information(this，tr(&#34;信息&#34;)，tr(&#34;信息提示?“)，QMessageBox::Yes); QString strl=tr(&#34;左右&#34;，&#34;大约的意思”) ; QString str2=tr(&#34;左右”，&#34;掌握、控制的意思&#34;) ; 使用 tr()函数，需要注意以下一些事项。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/863948bd68585c86b5279e02dd784811/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-08T10:30:29+08:00" />
<meta property="article:modified_time" content="2023-05-08T10:30:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt 多语言界面设计概述</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、多语言界面设计概述</p> 
<p>有些软件需要开发多语言界面版本，如中文版和英文版，并且在软件里可以方便地切换界面语言。Qt 为多语言界面提供了很好的支持，使用 Qt 的一些规则和工具，可以很方便地为应用程序开发提供多语言界面支持。</p> 
<p>用 Qt 开发多语言界面应用程序，主要包括以下几个步骤：</p> 
<p>(1)在程序设计阶段，程序代码中每一个用户可见的字符串都用 tr()函数封装，以便 Qt 提取界面字符串用于生成翻译资源文件。用UI设计器可视化设计窗体时统一用一种语言，如汉语。</p> 
<p>(2)在项目配置文件 (.pro 文件)中设置需要导出的翻译文件 (.ts 文件)名称，使用 lupdate工具扫描项目文件中需要翻译的字符串，并生成翻译文件。</p> 
<p>(3)使用 Qt 的 Linguist程序打开生成的翻译文件，将程序中的字符串翻译为需要的语言，如将所有中文字符串翻译为英文。</p> 
<p>(4)使用 lrelease工具编译翻译好的翻译文件，生成更为紧凑的“.qm”文件。</p> 
<p>(5)在应用程序中用QTranslator 调用不同的“.qm”文件，实现不同的语言界面。</p> 
<p>2、tr()函数的使用</p> 
<p>为了让 Qt 能自动提取程序中用户可见的字符串，对于每个字符串都需要使用 tr()函数封装。tr()是 QObject 的一个静态函数，在使用了Q_OBJECT 宏定义的类或QObiect 的子类中，都可以直接使用 tr()函数，否则需要使用 QObiect::tr()进行调用。或者在类定义中用 Q_DECLARE_TR_FUNCTIONS 宏把tr()函数添加到类中之后，再直接调用 tr()函数。</p> 
<p>tr()函数的定义是：</p> 
<pre><code>QString QObject::tr(const char *sourceText, const char *disambiguation = Q_NULLPTR, int n = -1)</code></pre> 
<p>其中，sourceText 是源字符串，disambiguation 是为翻译者提供额外信息的字符串，用于对些容易混淆的地方作说明，内容如下:</p> 
<pre><code>LabCellPos = new QLabel(tr("当前单元格:"),this);
QMessageBox::information(this，tr("信息")，tr("信息提示?“)，QMessageBox::Yes);
QString strl=tr("左右"，"大约的意思”) ;
QString str2=tr("左右”，"掌握、控制的意思") ;</code></pre> 
<p><br> 使用 tr()函数，需要注意以下一些事项。</p> 
<p>(1)尽量使用常量字符串，不要使用字符串变量。在 tr()函数中应直接传递字符串常量，而不是用变量传递字符串，如下面的代码使用了字符串变量，使用 lupdate 工具提取项目中的字符串时，将不能提取“不能删除记录”这个字符串。</p> 
<p>char *errorStr="不能删除记录”;</p> 
<p>QString str2=tr(errorStr);</p> 
<p>(2)使用字符串变量时需要用 Qt_TR_NOOP()宏进行标记。若要在tr()函数中使用字符串变量，需要在定义字符串的地方用 Qt_TR_NOOP()宏进行标记，这在使用字符串数组时比较有用，例如:</p> 
<pre><code>const char *cities[4]={Qt_TR_NOOP("Beijing")，
Qt_TR_NOOP("Shanghai"),
Qt_TR_NOOP("Qingdao")，
Ot_TR_NOOP("Wuhan")};
for (int i=0; i&lt;4; i++)
    comboBox-&gt;addItem(tr(cities[il));</code></pre> 
<p><br> tr()不能使用拼接的动态字符串。tr()不能使用拼接的动态字符串，例如，下面的用法是错误的:LabCellPos-&gt;setText(tr("第"+ QString::number(current.row()) +"行");正确的方式如下。</p> 
<p>正确的方式如下：</p> 
<p>LabCellPos-&gt;setText(tr("第 %1 行”).arg(current.row()));</p> 
<p>翻译的字符串是"第 %1 行"，然后再用 QString 的arg()去替换占位符“%1”的内容。</p> 
<p>(3)Qt_NO_CAST_FROM_ASCII 的作用。在一个需要翻译为多语言的应用程序中，如果编写程序时忘了对某个字符串使用 tr()函数,lupdate 生成的翻译资源文件就会遗漏这个字符串为了避免这种疏忽错误，可以在项目配置文件 (.pro 文件) 中添加如下的定义:</p> 
<p>DEFINES += Qt_NO_CAST_FROM_ASCII</p> 
<p>这样在编译时，会禁止从const char* 到QString 的隐式转换，强制每个字符串都必须使用tr()或QLatin1String()封装，避免出现遗漏未翻译的字符串。</p> 
<p>3、生成语言翻译文件</p> 
<p>要生成多语言界面相关的翻译文件，除了之前所说的在对每个字符串都使用 tr()函数封装之外，还需要在项目配置文件 (.pro 文件)中使用TRANSLATIONS 定义语言翻译文件 (.ts 文件)，并使用 lupdate 工具生成语言翻译文件。</p> 
<p>在项目的配置文件中增加如下的设置语句:</p> 
<p>TRANSLATIONS =samp_cn.ts<br> samp_en.ts</p> 
<p>这里设置生成两个语言翻译文件“samp_cn.ts”和“samp_en.ts”，分别是中文和英文翻译文件。文件名称可以任意设计，只要有所区分即可。</p> 
<p>在项目设计期间，任何时候都可以使用 lupdate 工具生成或更新翻译文件，方法是单击 QtCreator 主菜单的“Tools”→“External”→“Qt 语言家”→“Update Translations(lupdate)”菜单项若项目的源程序目录下没有 samp_cn.ts 和 samp_en.ts 这两个文件，就会自动生成，如果文件已经存在，则会更新这两个文件的内容。</p> 
<p>4、使用 Qt Linguist 翻译 ts 文件</p> 
<p>生成的 samp_cn.ts 和 samp_en.ts 文件内包含了项目源程序和 UI界面里的所有字符串，使用 QtLinguist 可以将这些字符串翻译为需要的语言版本。在 Qt 安装后的程序组里可以找到Qt Linguist 软件。</p> 
<p>samp_cn.ts 是中文界面的翻译文件，由于源程序的界面就是用中文设计的，所以无需再翻译。samp_en.ts 是英文翻译文件，需要将提取的所有中文字符串翻译为英文。</p> 
<p>在 Linguist 软件中打开文件 samp_en.ts，当第一次打开一个 ts 文件时，Linguist 会出现如下图所示的语言设置对话框，用于设置目标语言和所在国家和地区。这个对话框也可以通过Linguist主菜单的“编辑”-“翻译文件设置”菜单项调出。samp_en.ts 是用英文界面的翻译文件，所以选择语言“English”，国家/地区可选择“UnitedStates”。</p> 
<p><img alt="" height="228" src="https://images2.imgbox.com/3b/e5/eiB6xbkQ_o.png" width="306"></p> 
<p>打开samp_en.ts 文件后的Linguist软件界面如下图所示。左侧“上下文”列表里列出了项目中的所有窗口或类,这个项目有 4个窗口。“字符串”列表里列出了从项目的 UI语言窗口和代码文件中提取的字符串，右侧“短语和表单”会显示窗口界面的预览或字符串在源程序中出现的代码段。 </p> 
<p><img alt="" height="405" src="https://images2.imgbox.com/d4/b2/o5mZgXbf_o.png" width="670"></p> 
<p>在“字符串”列表中选择一个源文后，在下方会出现译文编辑框，在此填写字符串对应的英文译文。Linguist 可以同时打开项目的多个 ts 文件，在选中一个源文后，在下方会出现对应的多个语言的译文编辑框，可以同时翻译为多个语言版本。</p> 
<p>5、调用翻译文件改变界面语言</p> 
<p>1)生成 qm文件</p> 
<p>使用 Linguist 软件编辑翻译文件，将所有字符串都翻译后，在 Qt Creator 中单击主菜单项“Tools”→“External”→“Qt 语言家”→“Release Translations(lrelease)”，会在项目源程序目录下生成与ts 文件对应的 qm 文件，这是更为紧凑的翻译文件。本实例生成的是 samp_cn.qm和samp_en.qm。</p> 
<p>2)项目启动时设置界面语言</p> 
<p>使用QTranslator 类设置界面的不同语言版本，需在应用程序启动时设置界面语言翻译文件,即在main()函数中进行处理。main.cpp的代码如下: </p> 
<pre><code>#include "mainwindow.h"
#include &lt;QApplication&gt;
#include &lt;QTranslator&gt;
#include &lt;OSettings&gt;
QTranslator*trans=NULL;
QString  readSetting();
int main(int argc, char *argv[])
{
    QApplication app(argc，  argv);
    trans = new QTranslator;
    QString curLang = readSetting(); //读取语言设置
    if (curLang=="EN")
    {
        trans-&gt;load("samp16_en.qm");
    }
    else
    {
        trans-&gt;load("samp_cn.qm");
    }
    app.installTranslator(trans);
    MainWindow w;
    w.show();
    return app.exec();
}
QString readsetting()
{//从注册表读取上次设置的语言
    QString organization="WWB-Qt";
    QString appName="samp";
    QSettings settings(organization,appName);
    QString   Lanquage=settings.value("Lanquaqe","EN").toString();
    return Lanquage;
}</code></pre> 
<p>这里定义了一个全局变量trans，在 main.cpp 里定义了一个函数readSetting()，用于从注册表里读取上次设置的界面语言版本。注册表里数据的读取和写入使用到 QSetings 类。在 main()函数中，创建QTranslator 类的对象trans 后，调用readSetting()函数从注册表里读取上次的语言版本，若为“EN”，就用 load()函数载入编译后的英文翻译文件 samp_en.qm，否则就载入中文翻译文件 samp_cn.qm。然后再执行 app.installTranslator(trans)，就可以给应用程序安装翻译器，实现需要的界面版本。</p> 
<p>samp_en.qm和samp_cn.qm 文件是被编译到项目的可执行文件中的，无需将这两个文件复制到可执行文件目录下。</p> 
<p>在 main()函数里加载翻译器是相比之下一劳永逸的方法，这样一来，随后应用程序的任何窗口都会自动应用开始设置的语言。所以，一些大型的软件在重新设置了语言版本后，通常都会要求重新启动软件才生效。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3107a3532f615e8f60b4ff0996a23c96/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QT自制软键盘 最完美、最简单、跟自带虚拟键盘一样</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65cb6ef0006cb101508152e18fa7d81a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">启动Rabbit时出现Plugin configuration unchanged无法启动问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>