<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PCIE reset - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PCIE reset" />
<meta property="og:description" content="PCIe总线规定了两个复位方式：conventional Reset和FLR（FunctionLevel Reset），而Conventional Reset由进一步分为两大类：Fundamental Reset和Non-Fundamental Reset。Fundamental Reset方式包括Cold和Warm Reset方式，可以将PCIe将设备中的绝大多数内部寄存器和内部状态都恢复成初始值；而Non-FundamentalReset方式为Hot Reset方式。
1.1 传统复位方式(conventional)
传统的复位方式分为Cold、Warm和Hot Reset。PCIe设备可以根据当前的设备的运行状态选择合适的复位方式，PCIe总线提供多种复位方式的主要原因是减小PCIe设备的复位延时。其中传统复位方式的延时大于FLR方式。使用传统复位方式时，Cold Reset使用的时间最长，而Hot Reset使用的时间最短。
1.2 Cold Reset
当一个PCIe设备的Vcc电源上电后，处理器系统将置该设备的PERST#信号为有效，此时将引发PCIe设备的复位方式，这种方式属于Fundamental Reset。PCIe设备进行Clod Reset时，所有使用Vcc进行供电的寄存器和PCIe端口逻辑将无条件进入初始状态。但是使用这种方式依然无法复用使用Vaux(备用电源)供电的寄存器和逻辑，这些寄存器和逻辑只能在处理器完全掉电时彻底复位。
1.3 Warm Reset
在PCIe的设备完成上电后，也可能重新进行Fundamental Reset，这种复位方式也被称为Warm Reset。PCIe并没有定义WarmReset的具体实现方式。
1.4 Hot Reset
当PCIe设备出现某种异常时，可以使用软件手段对该设备进行复位。如系统软件将Bridge Control Register 的Secondary Bus Reset位置为1，该桥片将secondary总线上的PCI/PCIe设备进行Hot Reset。CPIe总线将通过TS1和TS2序列对下游设备进行Hot Reset。
在TS1和TS2序列中包含一个Hot Reset位。当下游设备收到一个TS1和TS2序列，而且Hot Reset位为1时，下游设备将使用HotReset方式进行复位操作。
HotReset方式并不属于FundamentalReset。PCIe设备进行Hot Reset方式时，也可以将PCIe设备的多数寄存器和状态恢复为初始值。
同时，在PCIe总线中，如果需要对链路的Link Width进行改变时，也将会用到Hot Reset。具体的流程如下：
1. Ensurethe Link is in the L0 LTSSM state
2. Program the 6-bit “Link Mode Enable” field of the “Port LinkControl Register” on page 732." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6569caa808e891f4ffe74171b176cfd3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-15T16:29:46+08:00" />
<meta property="article:modified_time" content="2022-02-15T16:29:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PCIE reset</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>PCIe总线规定了两个复位方式：conventional Reset和FLR（FunctionLevel Reset），而Conventional Reset由进一步分为两大类：Fundamental Reset和Non-Fundamental Reset。Fundamental Reset方式包括Cold和Warm Reset方式，可以将PCIe将设备中的绝大多数内部寄存器和内部状态都恢复成初始值；而Non-FundamentalReset方式为Hot Reset方式。</p> 
<p>1.1   传统复位方式(conventional)<br> 传统的复位方式分为Cold、Warm和Hot Reset。PCIe设备可以根据当前的设备的运行状态选择合适的复位方式，PCIe总线提供多种复位方式的主要原因是减小PCIe设备的复位延时。其中传统复位方式的延时大于FLR方式。使用传统复位方式时，Cold  Reset使用的时间最长，而Hot  Reset使用的时间最短。</p> 
<p>1.2   Cold Reset<br> 当一个PCIe设备的Vcc电源上电后，处理器系统将置该设备的PERST#信号为有效，此时将引发PCIe设备的复位方式，这种方式属于Fundamental Reset。PCIe设备进行Clod Reset时，所有使用Vcc进行供电的寄存器和PCIe端口逻辑将无条件进入初始状态。但是使用这种方式依然无法复用使用Vaux(备用电源)供电的寄存器和逻辑，这些寄存器和逻辑只能在处理器完全掉电时彻底复位。</p> 
<p>1.3   Warm Reset<br> 在PCIe的设备完成上电后，也可能重新进行Fundamental Reset，这种复位方式也被称为Warm Reset。PCIe并没有定义WarmReset的具体实现方式。</p> 
<p>1.4   Hot Reset<br> 当PCIe设备出现某种异常时，可以使用软件手段对该设备进行复位。如系统软件将Bridge Control Register 的Secondary Bus Reset位置为1，该桥片将secondary总线上的PCI/PCIe设备进行Hot Reset。CPIe总线将通过TS1和TS2序列对下游设备进行Hot Reset。</p> 
<p>在TS1和TS2序列中包含一个Hot Reset位。当下游设备收到一个TS1和TS2序列，而且Hot Reset位为1时，下游设备将使用HotReset方式进行复位操作。</p> 
<p>    HotReset方式并不属于FundamentalReset。PCIe设备进行Hot Reset方式时，也可以将PCIe设备的多数寄存器和状态恢复为初始值。</p> 
<p>同时，在PCIe总线中，如果需要对链路的Link Width进行改变时，也将会用到Hot Reset。具体的流程如下：</p> 
<p>1. Ensurethe Link is in the L0 LTSSM state</p> 
<p>2. Program the 6-bit “Link Mode Enable” field of the “Port LinkControl Register” on page 732. This isusedby the LTSSM in DETECT</p> 
<p>3. Programthe 9-bit “Predetermined Number of Lanes” field of the “Gen2 Control Register” on</p> 
<p>page 771. Thisindicates to the LTSSM, the number of lanes to check for exiting from L2.IDLE or</p> 
<p>POLLING.ACTIVE</p> 
<p>4. Trigger aHot Reset, by setting the Secondary Bus Reset bit in the RC Bridge ControlRegister (of the Type 1 PCI Configuration Space Header) to 1</p> 
<p>5. Wait for2 mS. The core’s LTSSM will transition from L0 -&gt; RCVRY -&gt; HOTRESET</p> 
<p>6. Clear theSecondary Bus Reset bit. The core’s LTSSM will transition from HOTRESET -&gt; DETECT</p> 
<p>1.5   FLR（Function Level Reset）<br>       除了传统的复位方式之外，PCIe总线还提供了FLR方式。系统软件通过填写某些寄存器，如synosys 的PCIe的IP是可以PCIeExpress Capability 的Device Control Register的第16bit完成FLR。支持FLR方式的PCIe设备需要在其BAR空间中提供一个寄存器，当系统软件对该寄存器的Function LevelReset位写1时，PCIe设备将使用FLR方式复位PCIe设备的内部逻辑。FLR方式对PCIe设备是可选的。</p> 
<p>       在一个大规模的并行处理系统中，系统软件使用分区的概念管理所以硬件资源，包括处理器资源和所以IO资源，这些IO资源中通常会包含PCIe设备。在这种处理器系统中，任务在指定的分区中运行，当这个任务执行完毕后，系统软件需要调整硬件资源的分区。此时受到影响的PCIe设备需要使用FLR方式复位内部的逻辑，以免造成对新的分区的资源污染，并保护之前任务的结果。</p> 
<p>当PCIe设备使用FLR方式进行复位时，有些与PCIe链路相关的状态和寄存器并不会被复位：</p> 
<p>Ø  Sticky Registers。与传统的复位方式相同，FLR方式不能复位这些寄存器，但是系统软件对部分Sticky Registers进行修改。当Vaux(备用电源)被移除后，这些寄存器中的保存的数据才会丢失。</p> 
<p>Ø  HwIint类型的寄存器。在PCIe设备中，有效配置寄存器的属性为HwIint，这些寄存器的值由芯片的配置引脚决定，后者上电复位后从EEPROM中获取。Cold和Warm Reset可以复位这些寄存器，然后从EEPROM中从新获取数据，但是使用FLR方式不能复位这些寄存器。</p> 
<p>Ø  此外，还有一些特殊的配置寄存器不能被FLR方式复位，如Max_Payload_Size、RCB和一些与电源管理、流量控制和链路控制直接相关的寄存器。</p> 
<p>Ø  FLR方式不会影响LTSSM状态机。<br> ————————————————<br> 版权声明：本文为CSDN博主「yijingjing17」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/yijingjijng/article/details/48246593</p> 
<p></p> 
<p><a href="http://www.ssdfans.com/?p=4143" rel="nofollow" title="那些年呆哥错过的PCIe Reset">那些年呆哥错过的PCIe Reset</a>   </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/078770c3dccf8e8d1fc5d62326ace59b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VM虚拟机中Linux扩展磁盘空间的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/100c0993de1b48d15618b89855b0492e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spark读写Oracle性能深度调优</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>