<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>通过vue cli命令打包发布组件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="通过vue cli命令打包发布组件" />
<meta property="og:description" content="功能描述 把某个系统中的几个vue页面需要供给多个系统使用，所以需要对公共的vue页面进行打包发布到npm仓库，其他系统工程通过npm install导入进行使用
工程示例 |-- src | |-- App.vue # 根组件 | |-- main.js # 入口js文件 | |-- api # 接口请求api | |-- assets # 资源目录 | |-- components # 公共组件 | |-- route	# 路由 | |-- store	# store module | |-- views	# vue页面视图 | |-- utils |	|	|-- request.js # axios请求 |	|	|-- auth.js	# 获取cookie 关键代码 在package.json中的关键代码，关键是使用vue-cli-service的target lib命令进行打包
官方文档说明：vue cli的库打包说明
&#34;name&#34;: &#34;库的名称&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8243a8c832c410c18f00cc79885cab2f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-20T00:09:50+08:00" />
<meta property="article:modified_time" content="2022-05-20T00:09:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">通过vue cli命令打包发布组件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>功能描述</h3> 
<p>把某个系统中的几个vue页面需要供给多个系统使用，所以需要对公共的vue页面进行打包发布到npm仓库，其他系统工程通过npm install导入进行使用</p> 
<h3><a id="_2"></a>工程示例</h3> 
<pre><code>|-- src
|   |-- App.vue                      		# 根组件
|   |-- main.js                            # 入口js文件
|   |-- api 								   #  接口请求api
|   |-- assets                           # 资源目录
|   |-- components                 # 公共组件
|   |-- route							# 路由
|   |-- store							# store module
|   |-- views							# vue页面视图
|   |-- utils
|	|	|-- request.js               # axios请求
|	|	|-- auth.js					 # 获取cookie
</code></pre> 
<h3><a id="_18"></a>关键代码</h3> 
<p>在package.json中的关键代码，关键是使用vue-cli-service的target lib命令进行打包<br> 官方文档说明：<a href="https://cli.vuejs.org/zh/guide/build-targets.html#%E5%BA%93" rel="nofollow">vue cli的库打包说明</a></p> 
<pre><code>"name": "库的名称",
  "version": "1.0.0",
  "description": "描述",
  "main": "./库的名称.common.js",
  "scripts": {
    "dev": "vue-cli-service serve",
    "build:prod": "vue-cli-service build",
    "lib": "vue-cli-service build --target lib --name 库的名称 ./src/views/index.js",
  }
</code></pre> 
<p>在views/index.js中的关键代码，这个地方主要是写一个导出的出口文件</p> 
<pre><code>import pageA from './pageA ';

// https://webpack.js.org/guides/dependency-management/#requirecontext
const modulesFiles = require.context('../store/module', true, /\.js$/);

// you do not need `import app from './modules/app'`
// it will auto require all vuex module from modules file
const modules = modulesFiles.keys().reduce((modules, modulePath) =&gt; {
  // set './app.js' =&gt; 'app'
  const moduleName = modulePath.replace(/^\.\/(.*)\.\w+$/, '$1');
  const value = modulesFiles(modulePath);
  modules[moduleName] = value.default;
  return modules;
}, {});
// 使用sotore的手动注册模式
const installStore = function(options = {}) {
  if (!installStore.storeRegistered) {
    // register store
    if (!options.store) {
      console.error('Please provide a store!!');
    } else {
      Object.keys(modules).forEach((key) =&gt; {
        options.store.registerModule(key, modules[key]);
      });

      installStore.storeRegistered = true;
    }
  }
};
// 导出store的挂载和vue页面
export { installStore, pageA };
</code></pre> 
<h3><a id="_67"></a>打包</h3> 
<p>打包配置，在vue.config.js文件中加入下面的代码配置<br> 需要把package.json文件copy至打包后的dist文件夹，这样才能执行npm publish命令</p> 
<pre><code>css: { extract: false },  // 把css文件也打入common.js的文件中
.........
configureWebpack: {
    // provide the app's title in webpack's name field, so that
    // it can be accessed in index.html to inject the correct title.
    name: name,
    resolve: {
      alias: {
        '@': resolve('src')
      }
    },
    plugins: [new CopyWebpackPlugin([{ from: './package.json', to: `${__dirname}/dist` }])]
  },
</code></pre> 
<p>在进行本地调试完成之后，进行打包</p> 
<pre><code>执行 npm run lib
打包完之后的文件
|-- dist
|	|--demo.html
|	|--xxx.common.js
|	|--xxx.umd.js
|	|--xxx.umd.min.js
|	|--package.json
</code></pre> 
<h3><a id="_98"></a>本地调试</h3> 
<p>把打包出来的xxx.common.js文件copy至需要调试的工程包中</p> 
<pre><code>在main.js中挂载组件中的store
import store from './store'
import { installStore } from './xxx.common.js'
// 挂载store
installStore({storeRegistered: false,store: store})
</code></pre> 
<p>在路由中引入页面</p> 
<pre><code>组件同步加载方式
import { pageA } from './xxx.common.js';
const constantRoutes = [
{ path: '/xxx', meta: { title: 'xxx', noCache: true }, component: pageA , hidden: true },
]
</code></pre> 
<pre><code>组件异步加载方式
async function getPageA(){
  const  { pageA } = await import('./xxx.common.js');
  return pageA ;
}
const constantRoutes = [
{ path: '/xxx', meta: { title: 'xxx', noCache: true }, component: getPageA, hidden: true },
]
</code></pre> 
<h3><a id="_127"></a>发布</h3> 
<p>调试完成之后，打包，执行npm publish命令发布包至npm仓库中<br> 引入方式，把上一步的本地调试的from './xxx.common.js’换成 from '组件名称’即可</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dcb030fe4c8ed6b481b9e0a854a053ec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中介模式(python实现2)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3caa6418e52fb7a363688c0e949e12fc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot邮件发送</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>