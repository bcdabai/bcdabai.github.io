<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于 vue3 利用 vuex 状态控制路由和按钮的权限 - 路由权限（2） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于 vue3 利用 vuex 状态控制路由和按钮的权限 - 路由权限（2）" />
<meta property="og:description" content="vue3-router-permission 基于 vue3 利用 vuex 状态控制路由和按钮的权限 - 路由权限（2）
gitee: vue3-router-permission
新建本地存储 src -&gt; utils -&gt; localDb.js
const localdb = { get(key) { return JSON.parse(localStorage.getItem(key)) }, set(key, value) { localStorage.setItem(key, JSON.stringify(value)) }, remove(key) { localStorage.removeItem(key) }, clear() { localStorage.clear() }, } export default localdb 新建 vuex 状态管理 新建文件夹 和 文件
- src - store - modules - account.js - index.ts account.ts
import localDb from &#39;../../utils/localDb&#39; export default { namespaced: true, state: { userInfo: localDb." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/17a2f55b76899e527f3c163c53f4bba3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-29T11:34:02+08:00" />
<meta property="article:modified_time" content="2022-11-29T11:34:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于 vue3 利用 vuex 状态控制路由和按钮的权限 - 路由权限（2）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <h2><a id="vue3routerpermission_0"></a>vue3-router-permission</h2> 
 <p>基于 vue3 利用 vuex 状态控制路由和按钮的权限 - 路由权限（2）</p> 
 <p><a href="https://gitee.com/hesir00/vue3-router-permission.git" rel="nofollow">gitee: vue3-router-permission</a></p> 
</blockquote> 
<h5><a id="_6"></a>新建本地存储</h5> 
<blockquote> 
 <p>src -&gt; utils -&gt; localDb.js</p> 
</blockquote> 
<pre><code>const localdb = {
  get(key) {
    return JSON.parse(localStorage.getItem(key))
  },
  set(key, value) {
    localStorage.setItem(key, JSON.stringify(value))
  },
  remove(key) {
    localStorage.removeItem(key)
  },
  clear() {
    localStorage.clear()
  },
}

export default localdb

</code></pre> 
<h5><a id="_vuex__30"></a>新建 vuex 状态管理</h5> 
<blockquote> 
 <p>新建文件夹 和 文件</p> 
</blockquote> 
<pre><code> - src
    - store
        -  modules
            -  account.js
        -  index.ts
</code></pre> 
<blockquote> 
 <p>account.ts</p> 
</blockquote> 
<pre><code>
import localDb from '../../utils/localDb'

export default {
  namespaced: true,
  state: {
    userInfo: localDb.get('userInfo') || {},
    token: localDb.get('token'),
    menuList: localDb.get('menuList') || [],
    permission: localDb.get('permission') || [],
  },
  mutations: {
    setUserInfo(state, value) {
      localDb.set('userInfo', value)
      state.userInfo = value
    },
    setToken(state, value) {
      localDb.set('token', value)
      state.token = value
    },
    setMenuList(state, value) {
      localDb.set('menuList', value)
      state.menuList = value
    },
    setPermission(state, value) {
      localDb.set('permission', value)
      state.permission = value
    },
  },
}
</code></pre> 
<blockquote> 
 <p>index.ts</p> 
</blockquote> 
<pre><code>import { createStore } from 'vuex'
import account from './modules/account'

export default createStore({
  modules: {
    account,
  },
})
</code></pre> 
<h5><a id="maints__90"></a>main.ts 中导入</h5> 
<pre><code>...
import store from './store'
...
app.use(ElementPlus).use(router).use(store).mount('#app')
</code></pre> 
<h4><a id="_Mock__99"></a>构造 Mock 数据</h4> 
<blockquote> 
 <p>新建 mock 文件夹 再新建 index.js mock &gt; index.js</p> 
</blockquote> 
<pre><code>// 引入mockjs
import Mock from 'mockjs'

Mock.mock('/api/admin', 'get', () =&gt; {
  return {
    code: 200,
    data: {
      userInfo: {
        username: 'root',
      },
      token: '123456',
      permission: ['view', 'delete', 'add'],
      menuList: [
        {
          path: '/',
          redirect: '/home',
          component: 'layout/index',
          children: [
            {
              name: '首页',
              path: '/home',
              component: 'Home',
            },
            {
              name: '按钮权限',
              path: '/user',
              component: 'User',
            },
            {
              name: '关于',
              path: '/about',
              component: 'About',
            },
          ],
        },
      ],
    },
    msg: '登录成功',
  }
})
Mock.mock('/api/test', 'get', () =&gt; {
  return {
    code: 200,
    data: {
      userInfo: {
        username: 'test',
      },
      token: '789456',
      permission: ['view', 'add'],
      menuList: [
        {
          path: '/',
          redirect: '/home',
          component: 'layout/index',
          children: [
            {
              name: '首页',
              path: '/home',
              component: 'Home',
            },
            {
              name: '按钮权限',
              path: '/user',
              component: 'User',
            },
          ],
        },
      ],
    },
    msg: '登录成功',
  }
})

</code></pre> 
<h5><a id="_178"></a>新建请求</h5> 
<blockquote> 
 <p>src -&gt; utils -&gt; request.js</p> 
</blockquote> 
<pre><code>import axios from 'axios'
import { ElMessage ,ElLoading} from 'element-plus'

let request = axios.create({
  baseURL: '',
  timeout: 10000,
})

let loadingInstance;

// 拦截器的添加
request.interceptors.request.use(
  (config) =&gt; {
    loadingInstance = ElLoading.service('加载中')
    return config
  },
  (err) =&gt; {
    loadingInstance?.close()
    ElMessage.error('网络异常')
    request
    return Promise.reject(err)
  },
)

//响应拦截器
request.interceptors.response.use(
  (res) =&gt; {
    loadingInstance?.close()
    return res.data
  },
  (err) =&gt; {
    loadingInstance?.close()
    ElMessage.error('请求失败')
    return Promise.reject(err)
  },
)
export default request

</code></pre> 
<h5><a id="_API__223"></a>新建 API 接口</h5> 
<blockquote> 
 <p>src -&gt; api -&gt; mockApi.js</p> 
</blockquote> 
<pre><code>import request from './request.js'
export default {
  //用户列表
  adminLogin() {
    return request({
      url: `/api/admin`,
      method: 'get',
    })
  },
  //用户列表
  testLogin() {
    return request({
      url: `/api/test`,
      method: 'get',
    })
  },
}

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5c842cb798ebeaa11b452e87ac0c8dcf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">torch-geometric使用过程中的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57c4a70fdee89f17a179c9588385b586/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[附源码]Python计算机毕业设计Django仓库管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>