<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Bash cp 命令详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Bash cp 命令详解" />
<meta property="og:description" content="目录 Bash cp 命令详解 cp 命令语法和简单使用cp 命令的选项说明及示例按照是否复制文件的内容进行分类文件属性的控制创建文件的软硬链接目标文件或文件夹存在创建父目录其它几个选项比较简单 Bash cp 命令详解 cp 是 “copy” 的缩写。该命令的功能是复制文件和目录。可以把源文件（SOURCE）复制到目标文件（DEST），或者把多个源文件（SOURCEs）或目录复制到目录（DIRECTORY）中。
cp 命令语法和简单使用 语法：
cp [OPTION]... [-T] SOURCE DEST cp [OPTION]... SOURCE... DIRECTORY cp [OPTION]... -t DIRECTORY SOURCE... 在第一种格式中，如果提供了两个参数，第一个参数是源文件，第二参数是目标文件（可以不存在），cp 命令把源文件(SOURCE)复制到目标文件(DEST)中。
如果指定了 -T 选项，则第二参数只能是文件，不能是目录。
]# cp foo.txt bar.txt ]# ls -l total 8 -rw-r--r--. 1 root root 13 Oct 21 19:39 bar.txt -rw-r--r--. 1 root root 13 Oct 21 19:38 foo.txt 在第二种格式中，拷贝多个源文件到一个目录中。这种格式最后的参数必须是一个目录，不然，多个源文件复制到哪里去？
]# ls file1 file2 file3 file4 file5 file6 # 可以使用通配符匹配多个文件 ]# cp file* backup/ ]# ls backup/ file1 file2 file3 file4 file5 file6 第三种格式与第二格式相似，只不过通过一个选项 -t, --target-directory 来指定目标目录，并把所有源文件放在后面而已。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/47b81c75a3c5250ecc007239bd62af6e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-24T20:14:50+08:00" />
<meta property="article:modified_time" content="2022-10-24T20:14:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Bash cp 命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#centerBash_cp_center_3" rel="nofollow"></a> 
   <center>
     Bash cp 命令详解 
   </center></li><li><ul><li><a href="#cp__7" rel="nofollow">cp 命令语法和简单使用</a></li><li><a href="#cp__51" rel="nofollow">cp 命令的选项说明及示例</a></li><li><ul><li><a href="#_99" rel="nofollow">按照是否复制文件的内容进行分类</a></li><li><a href="#_326" rel="nofollow">文件属性的控制</a></li><li><a href="#_408" rel="nofollow">创建文件的软硬链接</a></li><li><a href="#_448" rel="nofollow">目标文件或文件夹存在</a></li><li><a href="#_561" rel="nofollow">创建父目录</a></li><li><a href="#_610" rel="nofollow">其它几个选项比较简单</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="centerBash_cp_center_3"></a> 
 <center>
   Bash cp 命令详解 
 </center></h2> 
<p><code>cp</code> 是 “copy” 的缩写。该命令的功能是复制文件和目录。可以把源文件（SOURCE）复制到目标文件（DEST），或者把多个源文件（SOURCEs）或目录复制到目录（DIRECTORY）中。</p> 
<h3><a id="cp__7"></a>cp 命令语法和简单使用</h3> 
<p>语法：</p> 
<pre><code class="prism language-bash"><span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>-T<span class="token punctuation">]</span> SOURCE DEST
<span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. SOURCE<span class="token punctuation">..</span>. DIRECTORY
<span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. -t DIRECTORY SOURCE<span class="token punctuation">..</span>.
</code></pre> 
<ul><li> <p>在第一种格式中，如果提供了两个参数，第一个参数是源文件，第二参数是目标文件（可以不存在），<code>cp</code> 命令把源文件(SOURCE)复制到目标文件(DEST)中。</p> <p>如果指定了 <code>-T</code> 选项，则第二参数只能是文件，不能是目录。</p> <pre><code class="prism language-bash"><span class="token punctuation">]</span><span class="token comment"># cp foo.txt bar.txt</span>

<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">8</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">13</span> Oct <span class="token number">21</span> <span class="token number">19</span>:39 bar.txt
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">13</span> Oct <span class="token number">21</span> <span class="token number">19</span>:38 foo.txt
</code></pre> </li><li> <p>在第二种格式中，拷贝多个源文件到一个目录中。这种格式最后的参数必须是一个目录，不然，多个源文件复制到哪里去？</p> <pre><code class="prism language-bash"><span class="token punctuation">]</span><span class="token comment"># ls</span>
file1  file2  file3  file4  file5  file6

<span class="token comment"># 可以使用通配符匹配多个文件</span>
<span class="token punctuation">]</span><span class="token comment"># cp file* backup/</span>

<span class="token punctuation">]</span><span class="token comment"># ls backup/</span>
file1  file2  file3  file4  file5  file6
</code></pre> </li><li> <p>第三种格式与第二格式相似，只不过通过一个选项 <code>-t, --target-directory</code> 来指定目标目录，并把所有源文件放在后面而已。</p> <pre><code>]# cp -t target/ foo.txt bar.txt

]# ls target/
bar.txt  foo.txt
</code></pre> </li></ul> 
<h3><a id="cp__51"></a>cp 命令的选项说明及示例</h3> 
<p>该命令的选项比较多，用户如果没有一定的文件系统基础知识，对文件相关的属性不太了解，那么要理解该命令的一些选项就比较难。毕竟我们平常在Windows中复制文件时基本不考虑这些方面。</p> 
<ul><li> <p>Linux 文件拥有许多属性，例如属主、属组、权限、时间戳、链接，安全上下文等。因此在复制时可以通过选项来控制这些属性。</p> 
  <table><thead><tr><th align="center">属性</th><th>说明</th></tr></thead><tbody><tr><td align="center">mode 模式</td><td>保留文件的模式位，等价于使用 <code>chmod</code> 进行过设置和任何 <code>ACLs</code>(文件访问列表)。</td></tr><tr><td align="center">ownership 属主属组</td><td>保留文件的属主、属组，等同于使用 <code>chown</code> 进行过设置。但是，保留住这些属性的能力受到与使用 <code>chown</code> 相同的限制。</td></tr><tr><td align="center">timestamps 时间戳</td><td>保留文件的最后访问和修改时间(atime和mtime)，等同于在使用 <code>touch</code> 时一样，尽可能保留。</td></tr><tr><td align="center">links 链接</td><td>在目标文件中保留与源文件之间的任何链接。使用 <code>-L</code> 或 <code>-H</code> ，此选项可能会将符号链接复制为硬链接。</td></tr><tr><td align="center">context 安全上下文</td><td>保留源文件的 SELinux 安全上下文，或者如果使用详细诊断时失败。</td></tr><tr><td align="center">xattr 扩展属性</td><td>保留源文件的扩展属性，或者在使用详细的诊断时失败。</td></tr><tr><td align="center">all 所有</td><td>保留以上所有的属性。与单独指定上述所有属性相同，但是在复制 <code>context</code> 或 <code>xattr</code> 失败时，将不会输出失败的退出状态。</td></tr></tbody></table></li><li> <p>一种特殊的文件——稀疏文件：这种文件可能显示体积很大，但是实际占用磁盘空间很小。其包含许多"空洞"，而空洞由一系列零字节组成，不占用任何物理磁盘空间。当读取这种文件时，这些空洞当成零被读取，因此可以节省磁盘空间。</p> <p>创建稀疏文件有多种方法，例如第一种方法：</p> <pre><code class="prism language-bash">$ truncate -s 100G big_file

$ ll -hs big_file
<span class="token number">0</span> -rw-rw-r--. <span class="token number">1</span> jian jian 100G Oct <span class="token number">23</span> <span class="token number">19</span>:10 big_file
</code></pre> <p><code>ll -hs</code> 命令能够打印出许多信息，其中的选项 <code>-s</code> 取得实际占用空间的大小，显示第一字段的值 0，代表文件实际占用磁盘空间为 0，而 100G 表示文件的大小，这是一个逻辑概念，其读自于 inode 区记录的文件元数据中的信息。记住：文件大小和实际占用空间是两个概念。</p> <p>创建稀疏文件第二种方法：使用 <code>dd</code> 命令创建稀疏文件：</p> <pre><code class="prism language-bash">$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>fs.img <span class="token assign-left variable">bs</span><span class="token operator">=</span>1G <span class="token assign-left variable">seek</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span>
$ ll -sh fs.img
<span class="token number">0</span> -rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">1</span>.0T Oct <span class="token number">23</span> <span class="token number">19</span>:33 fs.img
</code></pre> <p>稀疏文件采用的是预分配机制，即当您创建一个 1T 大小的文件时，只在 inode 区记录好文件的元数据，如果该文件没有内容，这个时候其实没有实际分配空间，后面根据需要逐步分配空间。这样做的好处有：</p> 
  <ul><li>预分配，就是把分配空间的工作放在了初始化时进行，避免了在需要时现场进行分配的开销。</li><li>如果不提前占坑，很有可能等到需要时已经没有空间够用，因此把物理空间先占好，就可以心安使用了。</li></ul> </li><li> <p>写时复制（CoW, Copy on Write）：这需要目标文件系统支持才行。执行复制的一瞬间只复制元数据（inode），所以拷贝速度极快，目标文件的内容与源文件共享，只在源文件进行写操作时才进行真正的复制。这与虚拟机的快照原理一样，这对于持续进行更新的数据进行备份很重要。</p> </li><li> <p>软连接文件如何处理和目标文件已经存在时如何操作都有许多选项。</p> </li></ul> 
<h4><a id="_99"></a>按照是否复制文件的内容进行分类</h4> 
<p>按照本人的理解，该命令主要涉及到两个对象：即文件和目录。目录相对简单，而文件则比较复杂。</p> 
<p>按照执行复制时是否默认复制源文件的内容进行分类：</p> 
<ul><li> <p>可直接复制文件内容的文件：大部分普通文件、可执行文件、硬链接文件都是这种类型。</p> </li><li> <p>软连接文件：默认是复制链接文件所指向的文件。可以通过选项来控制是否要拷贝软连接文件本身。细节比较多，请看示例：</p> <p>这是当前文件夹现状：</p> <pre><code class="prism language-bash">$ ll
total <span class="token number">4</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 <span class="token function">file</span>
lrwxrwxrwx. <span class="token number">1</span> jian jian  <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
</code></pre> 
  <ul><li> <p><code>--preserve=links</code> ：保留链接</p> <p>如果没有使用 <code>--no-dereferenc</code>，就算使用了 <code>--preserve=links</code> ，也不会复制链接本身。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> --preserve<span class="token operator">=</span>links file.ln file.ln.bak

$ ll
total <span class="token number">8</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 <span class="token function">file</span>
lrwxrwxrwx. <span class="token number">1</span> jian jian  <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:54 file.ln.bak
</code></pre> </li><li> <p><code>-d</code> ：不要拷贝指向所引用的文件，保留源文件链接本身</p> <p>只有使用 <code>-d</code> = <code>--no-dereference --preserve=links</code> ，才能真正复制链接文件本身。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> --no-dereference --preserve<span class="token operator">=</span>links file.ln file.ln.bak2
<span class="token punctuation">]</span>$ ll
total <span class="token number">8</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 <span class="token function">file</span>
lrwxrwxrwx. <span class="token number">1</span> jian jian  <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:54 file.ln.bak
lrwxrwxrwx. <span class="token number">1</span> jian jian  <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">11</span>:54 file.ln.bak2 -<span class="token operator">&gt;</span> <span class="token function">file</span>
</code></pre> <p>如果在复制时没有以绝对路径指定元软链接文件，并把该文件本身复制到其它目录中，该备份文件不能正常使用，</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -d file.ln subdir/file.ln.bak3

$ ll subdir/file.ln.bak3
total <span class="token number">0</span>
lrwxrwxrwx. <span class="token number">1</span> jian jian <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">16</span>:01 file.ln.bak3 -<span class="token operator">&gt;</span> <span class="token function">file</span>
<span class="token comment"># 此时看到软连接存在，但是显示找不到源文件</span>

$ <span class="token function">ln</span> -s <span class="token punctuation">..</span>/file file.ln    <span class="token comment"># 采用不是复制方式</span>
$ ll
total <span class="token number">0</span>
lrwxrwxrwx. <span class="token number">1</span> jian jian <span class="token number">7</span> Oct <span class="token number">23</span> <span class="token number">16</span>:14 file.ln -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/file
lrwxrwxrwx. <span class="token number">1</span> jian jian <span class="token number">4</span> Oct <span class="token number">23</span> <span class="token number">16</span>:01 file.ln.bak3 -<span class="token operator">&gt;</span> <span class="token function">file</span>
</code></pre> <p>从上面可以看到，两个链接文件的大小不同，里面保存的路径不同。因此，这种情况下，要么在当前目录创建，或者源文件使用绝对路径，就不会出现问题。</p> </li><li> <p>-H</p> <p>如果命令行上的一个参数是符号链接文件，则拷贝所引用的文件，而不是链接文件本身。但是如果在递归过程中发现符号链接，则复制链接文件本身，而不是所引用的文件。</p> <pre><code class="prism language-bash">$ tree
<span class="token builtin class-name">.</span>
├── <span class="token function">file</span>
├── file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
├── subdir1
│   ├── foo
│   └── foo.ln -<span class="token operator">&gt;</span> foo
└── subdir2
</code></pre> <p>这时复制中有两个源，一个是链接文件（出现在命令行上），另一个是包含链接文件的文件夹，<code>-R</code> 表示递归复制。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -HR file.ln subdir1 subdir2

$ tree
<span class="token builtin class-name">.</span>
├── <span class="token function">file</span>
├── file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
├── subdir1
│   ├── foo
│   └── foo.ln -<span class="token operator">&gt;</span> foo
└── subdir2
    ├── file.ln
    └── subdir1
        ├── foo
        └── foo.ln -<span class="token operator">&gt;</span> foo
</code></pre> <p>验证结果：</p> <pre><code class="prism language-bash">$ ll subdir2/
total <span class="token number">8</span>
-rw-rw-r--. <span class="token number">1</span> jian jian   <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">14</span>:59 file.ln
drwxrwxr-x. <span class="token number">2</span> jian jian <span class="token number">4096</span> Oct <span class="token number">23</span> <span class="token number">14</span>:59 subdir1
<span class="token comment"># 可以看到 "file.ln" 已经不是链接文件本身，而是所引用的文件的备份了。</span>

$ ll subdir2/subdir1/
total <span class="token number">4</span>
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">5</span> Oct <span class="token number">23</span> <span class="token number">14</span>:59 foo
lrwxrwxrwx. <span class="token number">1</span> jian jian <span class="token number">3</span> Oct <span class="token number">23</span> <span class="token number">14</span>:59 foo.ln -<span class="token operator">&gt;</span> foo
<span class="token comment"># 这里的 "foo.ln" 仍然是符号链接文件本身。</span>
</code></pre> </li><li> <p>-L</p> <p>始终复制符号链接所指向的文件，而不是链接文件本身。指定了该选项，<code>cp</code> 命令不会在目标中创建符号链接。</p> <pre><code class="prism language-bash">$ tree
<span class="token builtin class-name">.</span>
├── <span class="token function">file</span>
├── file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
├── subdir1
│   ├── foo
│   └── foo.ln -<span class="token operator">&gt;</span> foo
└── subdir3

$ <span class="token function">cp</span> -LR file.ln subdir1 subdir3/

$ tree
<span class="token builtin class-name">.</span>
├── <span class="token function">file</span>
├── file.ln -<span class="token operator">&gt;</span> <span class="token function">file</span>
├── subdir1
│   ├── foo
│   └── foo.ln -<span class="token operator">&gt;</span> foo
└── subdir3
    ├── file.ln
    └── subdir1
        ├── foo
        └── foo.ln
</code></pre> <p><code>subdir3/subdir1/foo.ln</code> 已经不是符号链接文件。</p> </li><li> <p><code>-P, --no-dereferenc</code></p> <p>如果源中遇到符号链接文件，则永远只复制符号链接本身。在其他位置已经有了示例。此处省略。</p> </li></ul> </li><li> <p>特殊文件：有一些文件比较特殊，一般不能直接复制，否则其结果与我们想要的相差太远。例如 /dev/zero，如果直接复制，就会产生一个大文件了。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> /dev/zero file.iso
^C                         <span class="token comment"># 过了很短时间通过 `ctrl+c` 予以取消</span>
$ ll file.iso
-rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">103452672</span> Oct <span class="token number">23</span> <span class="token number">18</span>:26 file.iso
</code></pre> <p>可以看到复制品并不是原设备文件的备份，而是一个比较大的文件。如果不及时取消操作，复制出来文件可能会很大。要想真正复制该设备文件，需要使用 <code>-a</code> 选项。</p> </li><li> <p><code>--copy-contents</code></p> <p>当递归操作时，拷贝特殊文件的内容，例如，/dev 下的FIFOs和设备。您通常不想使用该选项，因为它可能会导致不希望看到的结果，例如，永远挂起或者填满整个硬盘。但是，此选项可用于特殊的专家用例。</p> </li><li> <p><code>-a, --archive</code> 用于归档</p> <p>该选项等同于 <code>-dR --preserve=all</code>，其作用是递归、复制链接文件本身及尽可能保留文件的属性。在执行拷贝时，试图尽可能保留原始文件结构、属性和相关元数据。如果正在运行"SELinux"，该元数据包含安全上下文。</p> <p>使用 <code>-a</code> 选项可以复制该设备文件本身。通过测试，在CentOS 8 中如果以普通账号登录，不能执行以下命令，即使使用 "sudo " 也不行：</p> <pre><code class="prism language-bash"><span class="token comment"># cp -a /dev/zero zero.bak</span>

<span class="token comment"># ll /dev/zero zero.bak</span>
crw-rw-rw-. <span class="token number">1</span> root root <span class="token number">1</span>, <span class="token number">5</span> Oct <span class="token number">20</span> 09:59 /dev/zero
crw-rw-rw-. <span class="token number">1</span> root root <span class="token number">1</span>, <span class="token number">5</span> Oct <span class="token number">20</span> 09:59 zero.bak
</code></pre> <p>对于 <code>-a</code> 选项也不能完全保证拷贝过来的文件就与源文件一样。<br> 例如普通用户拷贝属主属组都是 root 的文件，拷贝过来后，这两个属性就变成了当前用户的。</p> <p>如果想要保留指定的所有文件属性不变，那么以 root 身份执行可以的，其它用户同样的操作，实际的文件属性会有变化。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -a /etc/issue issue

$ ll /etc/issue issue
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">23</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> /etc/issue
-rw-r--r--. <span class="token number">1</span> jian  jian  <span class="token number">23</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> issue
</code></pre> </li><li> <p><code>--sparse=WHEN</code> : 稀疏文件的操作</p> <p>该选项控制复制时稀疏文件的创建。当源文件被诊断为稀疏文件时，<code>WHEN</code> 定义了复制时应该如何操作。其取值为：</p> 
  <table><thead><tr><th align="center">WHEN</th><th>说明</th></tr></thead><tbody><tr><td align="center">auto 自动</td><td>如果源文件是稀疏文件，那么试图把目标文件创建为稀疏文件。如果目标文件存在，且不是普通文件，则不让其成为稀疏文件。这是默认值。</td></tr><tr><td align="center">always 总是</td><td>对于源文件中每个足够长的零字节序列，都尝试在目标文件中创建稀疏的空洞。如果源文件所在的文件系统不支持稀疏文件，而目标文件所在的文件系统支持，这将非常有用，这时可以根据实际情况可以创建稀疏文件。</td></tr><tr><td align="center">never 永不</td><td>从不创建输出的稀疏文件。一些特殊文件，例如，交换分区文件（swap）。在这种情况下，应当选择使用该值。</td></tr></tbody></table><pre><code class="prism language-bash">$ <span class="token function">cp</span> --sparse<span class="token operator">=</span>never big_file big_file.bak
^C           <span class="token comment"># 已经花费了很长时间，予以取消</span>

$ ll -hs big*
  <span class="token number">0</span> -rw-rw-r--. <span class="token number">1</span> jian jian 100G Oct <span class="token number">23</span> <span class="token number">19</span>:10 big_file
<span class="token number">3</span>.4G -rw-rw-r--. <span class="token number">1</span> jian jian <span class="token number">3</span>.4G Oct <span class="token number">23</span> <span class="token number">20</span>:06 big_file.bak
</code></pre> <p>使用 <code>never</code> 进行复制会实际占用硬盘空间的。</p> <p>有关稀疏文件的更详细介绍，可以参考这个博文：</p> <p><a rel="nofollow">深度剖析 Linux cp 的秘密</a></p> </li><li> <p><code>--REFLINK=[whEN]</code>：引用链接</p> <p>引用链接就是实现这种 “Copy on Write (CoW 写时复制)”，其选项中的 <code>when</code> 参数可以取值 <code>always</code> 和 <code>auto</code> ，默认是 <code>always</code> 。如果目标文件系统不支持，且取值是 <code>always</code> ，则复制失败；如果取值是 <code>auto</code> ，则会使用标准复制行为。</p> <p>以下可以参考有关引用链接的知识讲解：<br> <a rel="nofollow">软链接、硬链接和引用链接，以及如何实现文件快速拷贝(cp --reflink)</a></p> </li></ul> 
<h4><a id="_326"></a>文件属性的控制</h4> 
<p>Linux 文件的这些属性在复制时可以通过选项来加以控制。</p> 
<ul><li> <p><code>--preserve=[attr_list]</code></p> <p>保留指定的以逗号分隔属性，默认：mode, ownership, timestamps。可以取值：mode, ownership, timestamps, links, context, xattr, all。</p> </li><li> <p><code>--attributes-only</code></p> <p>不拷贝文件的数据，只创建一个具有相同属性的文件。如果目标文件已经存在，不会改变该文件的内容。通过 <code>--preserve</code> 选项您可以精确地控制想要拷贝那个属性。</p> <p>示例：使用该选项只拷贝属性</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> --attributes-only /etc/issue <span class="token builtin class-name">.</span>

$ ll /etc/issue issue
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">23</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> /etc/issue
-rw-r--r--. <span class="token number">1</span> jian  jian   <span class="token number">0</span> Oct <span class="token number">23</span> 09:33 issue
</code></pre> <p>从上可见，只创建了空文件。文件的状态信息查看如下：</p> <pre><code class="prism language-bash">$ <span class="token function">stat</span> /etc/issue issue
  File: /etc/issue
  Size: <span class="token number">23</span>        	Blocks: <span class="token number">8</span>          IO Block: <span class="token number">4096</span>   regular <span class="token function">file</span>
Device: 802h/2050d	Inode: <span class="token number">2097192</span>     Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>
Context: system_u:object_r:etc_t:s0
Access: <span class="token number">2022</span>-10-20 09:59:42.585181783 +0800
Modify: <span class="token number">2021</span>-11-10 08:17:30.000000000 +0800
Change: <span class="token number">2022</span>-10-12 09:44:35.455211960 +0800
Birth: <span class="token number">2022</span>-10-12 09:44:35.455211960 +0800
  File: issue
  Size: <span class="token number">0</span>         	Blocks: <span class="token number">0</span>          IO Block: <span class="token number">4096</span>   regular empty <span class="token function">file</span>
Device: 802h/2050d	Inode: <span class="token number">262151</span>      Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span> <span class="token number">1000</span>/     jian<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span> <span class="token number">1000</span>/     jian<span class="token punctuation">)</span>
Context: unconfined_u:object_r:user_home_t:s0
Access: <span class="token number">2022</span>-10-23 09:33:20.659995207 +0800
Modify: <span class="token number">2022</span>-10-23 09:33:20.659995207 +0800
Change: <span class="token number">2022</span>-10-23 09:33:20.659995207 +0800
Birth: <span class="token number">2022</span>-10-23 09:33:20.659995207 +0800
</code></pre> <p>如果没有指定 <code>--preserve</code> 具体值，拷贝的属性变化较大。下面指定时间戳：</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> --attributes-only --preserve<span class="token operator">=</span>timestamps /etc/issue <span class="token builtin class-name">.</span>
<span class="token punctuation">]</span>$ ll
total <span class="token number">0</span>
-rw-r--r--. <span class="token number">1</span> jian jian <span class="token number">0</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> issue
<span class="token punctuation">]</span>$ <span class="token function">stat</span> issue
  File: issue
  Size: <span class="token number">0</span>         	Blocks: <span class="token number">0</span>          IO Block: <span class="token number">4096</span>   regular empty <span class="token function">file</span>
Device: 802h/2050d	Inode: <span class="token number">262151</span>      Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span> <span class="token number">1000</span>/     jian<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span> <span class="token number">1000</span>/     jian<span class="token punctuation">)</span>
Context: unconfined_u:object_r:user_home_t:s0
Access: <span class="token number">2022</span>-10-20 09:59:42.585181783 +0800
Modify: <span class="token number">2021</span>-11-10 08:17:30.000000000 +0800
Change: <span class="token number">2022</span>-10-23 09:43:49.264987666 +0800
Birth: <span class="token number">2022</span>-10-23 09:41:51.348989081 +0800
</code></pre> <p>看来保留了文件的访问时间和修改时间。有些属性无法拷贝过来。</p> <pre><code class="prism language-bash"><span class="token punctuation">]</span>$ <span class="token function">cp</span> --attributes-only --preserve<span class="token operator">=</span>owner /etc/issue <span class="token builtin class-name">.</span>
<span class="token punctuation">]</span>$ ll
total <span class="token number">0</span>
-rw-r--r--. <span class="token number">1</span> jian jian <span class="token number">0</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> issue
</code></pre> <p>文件的属主属组无法保留。</p> 
  <ul><li><code>-p</code></li></ul> <p>等同于 <code>--preserve=mode,ownership,timestamps</code> 。</p> </li></ul> 
<h4><a id="_408"></a>创建文件的软硬链接</h4> 
<p>创建对源文件的软硬链接何尝不是一种“复制”。</p> 
<ul><li> <p><code>-s, --symbolic-link</code></p> <p>复制时创建符号链接而不是拷贝文件本身。如果目标文件不在当前目录，那么，所有的源文件必须以斜杆开头的绝对路径。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -s /etc/os-release subdir/

$ ll /etc/os-release os-release
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">21</span> Nov <span class="token number">10</span>  <span class="token number">2021</span> /etc/os-release -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/usr/lib/os-release
lrwxrwxrwx. <span class="token number">1</span> jian  jian  <span class="token number">15</span> Oct <span class="token number">23</span> <span class="token number">20</span>:32 os-release -<span class="token operator">&gt;</span> /etc/os-release
</code></pre> <p>如果在<code>~/myfiles/</code> 下有许多文件，想在 <code>~/myfiles2/</code> 创建这些文件的软连接可以使用以下两种方法之一：</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -s ~/myfiles/* ~/myfiles2

$ <span class="token function">cp</span> -Rs ~/myfiles ~/myfiles2
</code></pre> </li><li> <p>-l, --link</p> <p>创建硬链接而不是拷贝源文件内容。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> -l <span class="token function">file</span> file.hd

$ ll <span class="token function">file</span> file.hd
-rw-rw-r--. <span class="token number">2</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 <span class="token function">file</span>
-rw-rw-r--. <span class="token number">2</span> jian jian <span class="token number">13</span> Oct <span class="token number">23</span> <span class="token number">11</span>:53 file.hd
</code></pre> </li></ul> 
<h4><a id="_448"></a>目标文件或文件夹存在</h4> 
<p>如果目标文件已经存在，则要考虑覆盖时是否提示警告；是否要对目标文件进行备份，以及如果目标文件由于权限不够不能打开时，是否强制覆盖；或者不覆盖等。</p> 
<ul><li> <p><code>-i, --interactive</code></p> <p>默认情况下，复制命令会默默地覆盖现存文件，因此可能会丢失数据。如果您想在覆盖前予以提示确认，请使用该选项（超越前面的 <code>-n</code> 选项）。</p> <p>在 CentOS 8 中以 root 登录后，<code>cp</code> 默认已经被设置成别名，会予以提示：</p> <pre><code class="prism language-bash"><span class="token punctuation">]</span><span class="token comment"># alias cp</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">cp</span><span class="token operator">=</span><span class="token string">'cp -i'</span>
</code></pre> <p>而普通用户默认没有这个设置，建议自己在 <code>.bashrc</code> 加入 <code>alias cp='cp -i'</code>。</p> </li><li> <p>强制覆盖，有两种情况：</p> 
  <ul><li> <p>第一种是 <code>-f, --force</code>，表示如果目标文件存在但是不能打开(原因可能是权限不够)，则删除它，再执行一次复制（如果 <code>-n</code> 选项也在使用，则该选项忽略）。</p> </li><li> <p>第二种是 <code>--remove-destination</code> ，表示在试图打开每个现存目标文件之前，删除这些目标文件。</p> </li></ul> </li><li> <p>不覆盖。<code>-n, --no-clobber</code> ，表示不覆盖现存文件（超越前面的 <code>-i</code> 选项）。</p> </li><li> <p>由于目标文件存在，如果要对目标文件进行备份，有两种格式：</p> 
  <ul><li> <p>第一种是 <code>--backup[=CONTROL]</code> ，为每个现存的目标文件进行备份。通过 <code>--backup</code> 选项或着通过 <code>VERSION_CONTROL</code> 环境变量可以选择版本控制方法。"CONTROL"的取值有：</p> 
    <table><thead><tr><th align="center">CONTROL</th><th>说明</th></tr></thead><tbody><tr><td align="center">none, off</td><td>不做备份（即使提供了 <code>--backup</code> ）</td></tr><tr><td align="center">numbered, t</td><td>进行数字后缀备份，例如"<sub>1</sub>, <sub>2</sub>, …"</td></tr><tr><td align="center">existing, nil</td><td>如果数字备份存在，则继续数字后缀格式，否则，取值 <code>simple</code></td></tr><tr><td align="center">simple, never</td><td>只做简单备份</td></tr></tbody></table></li><li> <p>第二种是 <code>-b</code> 等价于不带参数的 <code>--backup</code> ，即不论复制几次，目标文件只有一个备份。</p> <pre><code class="prism language-bash">$ ll file.txt
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">6</span> Oct <span class="token number">24</span> <span class="token number">11</span>:41 file.txt
$ <span class="token function">cp</span> -b newdir/file.txt file.txt
$ ll file.txt*
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:42 file.txt
-rw-rw-r-- <span class="token number">1</span> sam sam  <span class="token number">6</span> Oct <span class="token number">24</span> <span class="token number">11</span>:41 file.txt~
</code></pre> </li><li> <p>设置备份文件的后缀 <code>-S, --suffix=SUFFIX</code> 。如果设置该选项，则会覆盖常规备份默认后缀（默认是 <code>~</code> ）。</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span>  -S .bak newdir/file.txt <span class="token builtin class-name">.</span>

$ ll file.txt*
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:51 file.txt
-rw-rw-r-- <span class="token number">1</span> sam sam  <span class="token number">6</span> Oct <span class="token number">24</span> <span class="token number">11</span>:41 file.txt~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:50 file.txt.bak
</code></pre> <p>使用数字方式，可以保留多个备份</p> <pre><code class="prism language-bash">$ <span class="token function">cp</span> --backup<span class="token operator">=</span>t newdir/file.txt <span class="token builtin class-name">.</span>
$ ll file.txt*
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:54 file.txt
-rw-rw-r-- <span class="token number">1</span> sam sam  <span class="token number">6</span> Oct <span class="token number">24</span> <span class="token number">11</span>:41 file.txt~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:51 file.txt.~1~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:50 file.txt.bak
$ <span class="token function">cp</span> --backup<span class="token operator">=</span>t newdir/file.txt <span class="token builtin class-name">.</span>
$ ll file.txt*
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:55 file.txt
-rw-rw-r-- <span class="token number">1</span> sam sam  <span class="token number">6</span> Oct <span class="token number">24</span> <span class="token number">11</span>:41 file.txt~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:51 file.txt.~1~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:54 file.txt.~2~
-rw-rw-r-- <span class="token number">1</span> sam sam <span class="token number">13</span> Oct <span class="token number">24</span> <span class="token number">11</span>:50 file.txt.bak
</code></pre> </li></ul> <p>作为一种特殊情况，如果提供了 <code>--force --backup</code> 选项，并且源文件和目标文件是同名的现存常规文件时，<code>cp</code> 命令会对源文件进行备份。</p> </li><li> <p><code>-u, --update</code></p> <p>只有当源文件比目标文件更新时，或者目标文件不存在时才拷贝。</p> <pre><code class="prism language-bash">$ <span class="token function">ls</span> -l --time-style<span class="token operator">=</span>+<span class="token string">"%F %T"</span> <span class="token builtin class-name">.</span> newdir/
.:
total <span class="token number">4</span>
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-23 <span class="token number">12</span>:40:52 file1
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-23 <span class="token number">12</span>:40:52 file2
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:40:40 file4
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:40:40 file5
drwxrwxr-x <span class="token number">2</span> jian jian <span class="token number">4096</span> <span class="token number">2022</span>-10-24 06:39:33 newdir

newdir/:
total <span class="token number">0</span>
-rw-rw-r-- <span class="token number">1</span> jian jian <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:39:33 file1
-rw-rw-r-- <span class="token number">1</span> jian jian <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:39:33 file2
-rw-rw-r-- <span class="token number">1</span> jian jian <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:39:33 file3

$ <span class="token function">cp</span> -u newdir/* <span class="token builtin class-name">.</span>

$ <span class="token function">ls</span> -l --time-style<span class="token operator">=</span>+<span class="token string">"%F %T"</span> <span class="token builtin class-name">.</span>
total <span class="token number">4</span>
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:43:09 file1
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:43:09 file2
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:43:09 file3
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:40:40 file4
-rw-rw-r-- <span class="token number">1</span> jian jian    <span class="token number">0</span> <span class="token number">2022</span>-10-24 06:40:40 file5
drwxrwxr-x <span class="token number">2</span> jian jian <span class="token number">4096</span> <span class="token number">2022</span>-10-24 06:39:33 newdir
</code></pre> <p>file3 文件原来没有，file1 和 file2 被更新。</p> </li></ul> 
<h4><a id="_561"></a>创建父目录</h4> 
<p>如果复制时源是多级目录，而目标中没有相应的多级目录，这时如果使用 <code>--parents</code> 选项，则在目标目录下创建所有需要的目录。相当于 <code>mkdir -p</code> 创建目录时，如果没有父目录，则予以创建。</p> 
<p>示例：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 当前目录树情况</span>
$ tree
<span class="token builtin class-name">.</span>
├── dir1
└── dir2
    └── dir3
        └── <span class="token function">file</span>

</code></pre> 
<p>如果不使用 --parents，这是把目录下的文件复制到对应目录下。</p> 
<pre><code class="prism language-bash">$ <span class="token function">cp</span> dir2/dir3/file dir1

$ tree
<span class="token builtin class-name">.</span>
├── dir1
│   └── <span class="token function">file</span>
└── dir2
    └── dir3
        └── <span class="token function">file</span>
</code></pre> 
<p>如果使用 --parents，则 dir1 下面创建必要的目录</p> 
<pre><code class="prism language-bash">$ <span class="token function">cp</span> --parents dir2/dir3/file dir1

$ tree
<span class="token builtin class-name">.</span>
├── dir1
│   ├── dir2
│   │   └── dir3
│   │       └── <span class="token function">file</span>
│   └── <span class="token function">file</span>
└── dir2
    └── dir3
        └── <span class="token function">file</span>
</code></pre> 
<h4><a id="_610"></a>其它几个选项比较简单</h4> 
<ul><li> <p><code>T, --no-target-directory</code></p> <p>就是把目标当成一个常规文件。就是第一种格式中的一个选项，其确保最后参数不能是目标。</p> </li><li> <p><code>--strip-trailing-slashes</code></p> <p>对每个源参数都删除尾随的斜杆。</p> </li><li> <p><code>-x, --one-file-system</code></p> <p>只对执行命令所在的文件系统进行操作。如果 <code>cp</code> 命令试图跨越边界到另一个文件系统，则跳过这些文件。这包括网络驱动器、另一个分区——任何驻留在具有不同挂载点的文件系统上的文件。</p> <p>表示挂载点本身的目录将被复制，但是不会进行遍历操作。</p> <p>如果指定了 <code>-v</code> 选项，则可以准确地看到跳过了那些文件。</p> </li><li> <p><code>--help</code></p> </li><li> <p><code>--version</code></p> </li></ul> 
<p>最后，提供一个有意思的主意事项：</p> 
<p>对于复制文件夹到目标文件夹，如果没有该目标目录，则创建该目录，并把文件都拷贝过去，但是同样的操作如果再次执行，这时已经有了目标目录，就会把源文件拷贝到目标文件夹下，当然，第三次拷贝会提示是否覆盖。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/faa21b0528a1b21c3320fd390f2eb695/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MD5加密后为0e开头的字符串</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/760abd5de8af8ca989060bbd3d27492f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java获取当前时间的前一天时间</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>