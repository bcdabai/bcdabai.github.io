<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在ubuntu上安装多个版本的CUDA，并且可以随时切换 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在ubuntu上安装多个版本的CUDA，并且可以随时切换" />
<meta property="og:description" content="CUDA是什么就不介绍了，直接讲怎么实现CUDA多版本的共存和实时切换。
1、安装多个版本的CUDA 这里，我们以cuda9-1版本和cuda9-0版本为例（先安装哪个无所谓） 首先，在cuda版本库中选择自己需要的cuda版本。 然后，选择对应的安装包，这里选择runfile类型的安装文件，以便后面设置每个cuda的安装路径。 下载完成以后，我们利用cd命令，进入到cuda_8.0.61_375.26_linux.run文件所在的目录中，然后运行下面的指令，进行安装（注意这个文件名，前面的cuda_8.0.61代表cuda的版本，后面的375.26代表的对应的NVIDIA驱动的版本，这里我用cuda8.0的安装过程为例，9.0和9.1同理）
安装过程中在建立软链接时需要注意一下，如果你是第一次安装cuda，那么毫无疑问输入y（yes），但是如果你是安装额外版本的cuda，是否选择y（yes）就要看你的具体需求而定，简言之，就是如果你希望启用当前安装的cuda版本，就选y，如果你只是想安装这个版本，而暂时还不想启用该版本时，就选n。
#先执行下面的命令安装相关依赖， #否则会出现`Missing recommended library`错误 sudo apt-get install freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev sudo sh cuda_8.0.61_375.26_linux.run #开始安装 #..一堆协议说明... #直接按q退出协议说明. zerozone@zerozone: accept/decline/quit: accept #接受协议 Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 375.26? y)es/(n)o/(q)uit: n #是否显卡驱动包，由于已经安装显卡驱动，选择n Install the CUDA 8.0 Toolkit? (y)es/(n)o/(q)uit: y #是否安装工具包，选择y Enter Toolkit Location [ default is /usr/local/cuda-8.0 ]: #工具包安装地址，默认回车即可 Do you want to install a symbolic link at /usr/local/cuda?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4b7c9494240565f76fe923b083a83516/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-28T13:23:29+08:00" />
<meta property="article:modified_time" content="2018-04-28T13:23:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在ubuntu上安装多个版本的CUDA，并且可以随时切换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>CUDA是什么就不介绍了，直接讲怎么实现CUDA多版本的共存和实时切换。</p> 
<h3 id="1安装多个版本的cuda">1、安装多个版本的CUDA</h3> 
<p>这里，我们以cuda9-1版本和cuda9-0版本为例（先安装哪个无所谓） <br> 首先，在cuda版本库中选择自己需要的cuda版本。 <br> <img src="https://images2.imgbox.com/ab/47/4GeVmBlg_o.jpg" alt="这里写图片描述" title=""></p> 
<p>然后，选择对应的安装包，<strong>这里选择runfile类型的安装文件</strong>，以便后面设置每个cuda的安装路径。 <br> <img src="https://images2.imgbox.com/35/72/GPCbH0sz_o.jpg" alt="这里写图片描述" title=""></p> 
<p>下载完成以后，我们利用cd命令，进入到cuda_8.0.61_375.26_linux.run文件所在的目录中，然后运行下面的指令，进行安装（注意这个文件名，前面的cuda_8.0.61代表cuda的版本，后面的375.26代表的对应的NVIDIA驱动的版本，这里我用cuda8.0的安装过程为例，9.0和9.1同理）</p> 
<p>安装过程中在建立软链接时需要注意一下，如果你是第一次安装cuda，那么毫无疑问输入y（yes），但是如果你是安装额外版本的cuda，是否选择y（yes）就要看你的具体需求而定，简言之，就是如果你希望启用当前安装的cuda版本，就选y，如果你只是想安装这个版本，而暂时还不想启用该版本时，就选n。</p> 
<pre class="prettyprint"><code class=" hljs applescript"><span class="hljs-comment">#先执行下面的命令安装相关依赖，</span>
<span class="hljs-comment">#否则会出现`Missing recommended library`错误</span>
sudo apt-<span class="hljs-keyword">get</span> install freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev 


sudo sh cuda_8<span class="hljs-number">.0</span><span class="hljs-number">.61</span>_375<span class="hljs-number">.26</span>_linux.<span class="hljs-command">run</span> <span class="hljs-comment">#开始安装</span>

<span class="hljs-comment">#..一堆协议说明...</span>
<span class="hljs-comment">#直接按q退出协议说明.</span>
zerozone@zerozone: accept/decline/quit: accept  <span class="hljs-comment">#接受协议</span>

Install NVIDIA Accelerated Graphics Driver <span class="hljs-keyword">for</span> Linux-x86_64 <span class="hljs-number">375.26</span>? 
y)es/(n)o/(q)uit: n  <span class="hljs-comment">#是否显卡驱动包，由于已经安装显卡驱动，选择n</span>

Install <span class="hljs-keyword">the</span> CUDA <span class="hljs-number">8.0</span> Toolkit?
(y)es/(n)o/(q)uit: y <span class="hljs-comment">#是否安装工具包，选择y</span>

Enter Toolkit Location
[ default <span class="hljs-keyword">is</span> /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span> ]: <span class="hljs-comment">#工具包安装地址，默认回车即可</span>

Do you want <span class="hljs-keyword">to</span> install a symbolic link <span class="hljs-keyword">at</span> /usr/<span class="hljs-keyword">local</span>/cuda?
(y)es/(n)o/(q)uit: y <span class="hljs-comment">#添加链接**注意这个连接，如果你之前安装过另一个版本的cuda，除非你确定想要用这个新版本的cuda，否则这里就建议选no，因为指定该链接后会将cuda指向这个新的版本**</span>

Install <span class="hljs-keyword">the</span> CUDA <span class="hljs-number">8.0</span> Samples?
(y)es/(n)o/(q)uit: y <span class="hljs-comment">#安装样例</span>

Enter CUDA Samples Location
 [ default <span class="hljs-keyword">is</span> /root ]:  <span class="hljs-comment">#样例安装地址默认即可</span>

<span class="hljs-comment"># ***安装信息***</span>
Installing <span class="hljs-keyword">the</span> CUDA Toolkit <span class="hljs-keyword">in</span> /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span> ...

Missing recommended library: libXi.so
Missing recommended library: libXmu.so
<span class="hljs-comment">#注意，这里出现了Missing recommended library错误，</span>
<span class="hljs-comment">#是因为博主在第一次安装时，没有添加最开始的那条安装相关依赖的指令，</span>
<span class="hljs-comment">#之后我添加了依赖后，再次安装，就没有Missing错误了</span>

Installing <span class="hljs-keyword">the</span> CUDA Samples <span class="hljs-keyword">in</span> /root ...
Copying samples <span class="hljs-keyword">to</span> /root/NVIDIA_CUDA-<span class="hljs-number">8.0</span>_Samples now...
Finished copying samples.

===========
= Summary =
===========
Driver:   Not Selected
Toolkit:  Installed <span class="hljs-keyword">in</span> /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>
Samples:  Installed <span class="hljs-keyword">in</span> /root, <span class="hljs-keyword">but</span> missing recommended libraries

Please make sure <span class="hljs-keyword">that</span>
 -   PATH includes /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>/bin
 -   LD_LIBRARY_PATH includes /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>/lib64, <span class="hljs-keyword">or</span>, add /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>/lib64 <span class="hljs-keyword">to</span> /etc/ld.so.conf <span class="hljs-keyword">and</span> <span class="hljs-command">run</span> ldconfig <span class="hljs-keyword">as</span> root

To uninstall <span class="hljs-keyword">the</span> CUDA Toolkit, <span class="hljs-command">run</span> <span class="hljs-keyword">the</span> uninstall <span class="hljs-keyword">script</span> <span class="hljs-keyword">in</span> /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>/bin

Please see CUDA_Installation_Guide_Linux.pdf <span class="hljs-keyword">in</span> /usr/<span class="hljs-keyword">local</span>/cuda-<span class="hljs-number">8.0</span>/doc/pdf <span class="hljs-keyword">for</span> detailed information <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> setting up CUDA.

***WARNING: Incomplete installation! This installation did <span class="hljs-keyword">not</span> install <span class="hljs-keyword">the</span> CUDA Driver. A driver <span class="hljs-keyword">of</span> <span class="hljs-property">version</span> <span class="hljs-keyword">at</span> least <span class="hljs-number">361.00</span> <span class="hljs-keyword">is</span> required <span class="hljs-keyword">for</span> CUDA <span class="hljs-number">8.0</span> functionality <span class="hljs-keyword">to</span> work.

To install <span class="hljs-keyword">the</span> driver using this installer, <span class="hljs-command">run</span> <span class="hljs-keyword">the</span> following command, replacing &lt;CudaInstaller&gt; <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-property">name</span> <span class="hljs-keyword">of</span> this <span class="hljs-command">run</span> <span class="hljs-type">file</span>:

    sudo &lt;CudaInstaller&gt;.<span class="hljs-command">run</span> -silent -driver

Logfile <span class="hljs-keyword">is</span> /tmp/cuda_install_6388.<span class="hljs-command">log</span>   
<span class="hljs-comment"># ***安装完成***</span></code></pre> 
<p>配置CUDA相关环境变量 <br> 修改~/.bashrc文件（或~/.zhsrc） 在文件末尾添加环境变量 </p> 
<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-constant">Tensorflow</span>官方安装历程要求注意的是<span class="hljs-symbol">:</span>配置<span class="hljs-constant">PATH</span>和<span class="hljs-constant">LD_LIBRARY_PATH</span>和<span class="hljs-constant">CUDA_HOME</span>环境变量.

vim ~<span class="hljs-regexp">/.bashrc #修改配置文件（如果你用的是zsh，则需要修改 ~/</span>.zshrc文件）

<span class="hljs-comment">#在文件结尾处添加</span>
export <span class="hljs-constant">LD_LIBRARY_PATH</span>=<span class="hljs-variable">$LD_LIBRARY_PATH</span><span class="hljs-symbol">:/usr/local/cuda/lib64</span>
export <span class="hljs-constant">PATH</span>=<span class="hljs-variable">$PATH</span><span class="hljs-symbol">:/usr/local/cuda/bin</span>
export <span class="hljs-constant">CUDA_HOME</span>=<span class="hljs-variable">$CUDA_HOME</span><span class="hljs-symbol">:/usr/local/cuda</span>
</code></pre> 
<p>利用同样的方法下载你想安装的另一个版本的cuda工具包（注意是runfile类型），在安装过程中，注意cuda symbol link的选择（首次安装，选y，安装额外的版本，选n）</p> 
<h3 id="2cuda多个版本的切换">2、cuda多个版本的切换</h3> 
<p>在安装了多个cuda版本后，可以在<code>/usr/local/</code>目录下查看自己安装的cuda版本，如下图所示： <br> <img src="https://images2.imgbox.com/46/1a/fyVnUhl7_o.jpg" alt="这里写图片描述" title=""></p> 
<p>这里，cuda-9.0和cuda-9.1就是我们安装的两个cuda版本了，而cuda是一个软链接，它指向我们指定的cuda版本（注意上面在设置环境变量时，使用的是cuda，而不是cuda-9.0和cuda-9.1，这主要是为了方便我们切换cuda版本，可以让我们不用每次都去该环境变量的值）</p> 
<p>可以使用stat命令查看当前cuda软链接指向的哪个cuda版本，如下所示： <br> <img src="https://images2.imgbox.com/bb/5c/r8GR4hWj_o.jpg" alt="这里写图片描述" title=""></p> 
<p>可以看到，文件类型是symbolic link，而指向的目录正是<code>/usr/local/cuda-9.0</code>，当我们想使用cuda-9.1版本时，只需要删除该软链接，然后重新建立指向cuda-9.1版本的软链接即可（注意名称还是cuda，因为要与<code>bashrc</code>文件里设置的保持一致）</p> 
<pre class="prettyprint"><code class=" hljs lasso">sudo rm <span class="hljs-attribute">-rf</span> cuda
sudo ln <span class="hljs-attribute">-s</span> /usr/<span class="hljs-built_in">local</span>/cuda<span class="hljs-subst">-</span><span class="hljs-number">9.1</span> /usr/<span class="hljs-built_in">local</span>/cuda</code></pre> 
<p>想切换其他版本的cuda，只需要改动建立软链接时cdua的正确路径即可</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a85c933a90c4890f6db3b4c8144b156c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决移动端position:fixed随软键盘移动的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3cc35b9260694eba65537c02eddc1b02/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">intellij idea for mac连上不https的SVN解决方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>