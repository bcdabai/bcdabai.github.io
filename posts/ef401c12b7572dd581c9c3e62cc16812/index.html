<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从0开发一个Django博客系统 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="从0开发一个Django博客系统" />
<meta property="og:description" content="目录
一、项目准备
1.1 项目分析
1.2 工程创建和配置
二、注册
2.2 定义用户模型类
2.3 图形验证码
2.4 短信验证码
2.5 用户注册实现
2.6 展示首页
2.7 状态保持
三、登录
3.1 手机登录
3.2 首页用户名展示
3.3 退出登录
四、忘记密码
五、用户中心
5.2 用户中心修改
六、写博客
6.1 写博客页面展示
6.2 文章分类模型
6.3 文章分类后台管理
6.4 写博客页面展示分类
查询数据并展示
6.5 文章模型
6.6 博客保存
七、博客首页
7.1 首页分类数据展示
7.2 首页文章数据展示
八、博客详情
8.1 详情页面展示
8.2 404页面展示
修改查询不到数据返回的响应
8.3 推荐文章数据展示
8.4 评论模型
8.5 发表评论
8.6 详情评论数据展示
一、项目准备 1.1 项目分析 需求分析原因 项目中，需求驱动开发。即开发人员需要以需求为目标来实现业务逻辑。 需求分析方式" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ef401c12b7572dd581c9c3e62cc16812/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-21T17:43:45+08:00" />
<meta property="article:modified_time" content="2022-12-21T17:43:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从0开发一个Django博客系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="h_593416735_0-toc" style="margin-left:40px;"><a href="#h_593416735_0" rel="nofollow">一、项目准备</a></p> 
<p id="h_593416735_1-toc" style="margin-left:80px;"><a href="#h_593416735_1" rel="nofollow">1.1 项目分析</a></p> 
<p id="h_593416735_2-toc" style="margin-left:80px;"><a href="#h_593416735_2" rel="nofollow">1.2 工程创建和配置</a></p> 
<p id="h_593416735_3-toc" style="margin-left:40px;"><a href="#h_593416735_3" rel="nofollow">二、注册</a></p> 
<p id="h_593416735_4-toc" style="margin-left:80px;"><a href="#h_593416735_4" rel="nofollow">2.2 定义用户模型类</a></p> 
<p id="h_593416735_5-toc" style="margin-left:80px;"><a href="#h_593416735_5" rel="nofollow">2.3 图形验证码</a></p> 
<p id="h_593416735_6-toc" style="margin-left:80px;"><a href="#h_593416735_6" rel="nofollow">2.4 短信验证码</a></p> 
<p id="h_593416735_7-toc" style="margin-left:80px;"><a href="#h_593416735_7" rel="nofollow">2.5 用户注册实现</a></p> 
<p id="h_593416735_8-toc" style="margin-left:80px;"><a href="#h_593416735_8" rel="nofollow">2.6 展示首页</a></p> 
<p id="h_593416735_9-toc" style="margin-left:80px;"><a href="#h_593416735_9" rel="nofollow">2.7 状态保持</a></p> 
<p id="h_593416735_10-toc" style="margin-left:40px;"><a href="#h_593416735_10" rel="nofollow">三、登录</a></p> 
<p id="h_593416735_11-toc" style="margin-left:80px;"><a href="#h_593416735_11" rel="nofollow">3.1 手机登录</a></p> 
<p id="h_593416735_12-toc" style="margin-left:80px;"><a href="#h_593416735_12" rel="nofollow">3.2 首页用户名展示</a></p> 
<p id="h_593416735_13-toc" style="margin-left:80px;"><a href="#h_593416735_13" rel="nofollow">3.3 退出登录</a></p> 
<p id="h_593416735_14-toc" style="margin-left:40px;"><a href="#h_593416735_14" rel="nofollow">四、忘记密码</a></p> 
<p id="h_593416735_15-toc" style="margin-left:40px;"><a href="#h_593416735_15" rel="nofollow">五、用户中心</a></p> 
<p id="h_593416735_16-toc" style="margin-left:80px;"><a href="#h_593416735_16" rel="nofollow">5.2 用户中心修改</a></p> 
<p id="h_593416735_17-toc" style="margin-left:40px;"><a href="#h_593416735_17" rel="nofollow">六、写博客</a></p> 
<p id="h_593416735_18-toc" style="margin-left:80px;"><a href="#h_593416735_18" rel="nofollow">6.1 写博客页面展示</a></p> 
<p id="h_593416735_19-toc" style="margin-left:80px;"><a href="#h_593416735_19" rel="nofollow">6.2 文章分类模型</a></p> 
<p id="h_593416735_20-toc" style="margin-left:80px;"><a href="#h_593416735_20" rel="nofollow">6.3 文章分类后台管理</a></p> 
<p id="h_593416735_21-toc" style="margin-left:80px;"><a href="#h_593416735_21" rel="nofollow">6.4 写博客页面展示分类</a></p> 
<p id="h_593416735_22-toc" style="margin-left:80px;"><a href="#h_593416735_22" rel="nofollow">查询数据并展示</a></p> 
<p id="h_593416735_23-toc" style="margin-left:80px;"><a href="#h_593416735_23" rel="nofollow">6.5 文章模型</a></p> 
<p id="h_593416735_24-toc" style="margin-left:80px;"><a href="#h_593416735_24" rel="nofollow">6.6 博客保存</a></p> 
<p id="h_593416735_25-toc" style="margin-left:40px;"><a href="#h_593416735_25" rel="nofollow">七、博客首页</a></p> 
<p id="h_593416735_26-toc" style="margin-left:80px;"><a href="#h_593416735_26" rel="nofollow">7.1 首页分类数据展示</a></p> 
<p id="h_593416735_27-toc" style="margin-left:80px;"><a href="#h_593416735_27" rel="nofollow">7.2 首页文章数据展示</a></p> 
<p id="h_593416735_28-toc" style="margin-left:40px;"><a href="#h_593416735_28" rel="nofollow">八、博客详情</a></p> 
<p id="h_593416735_29-toc" style="margin-left:80px;"><a href="#h_593416735_29" rel="nofollow">8.1 详情页面展示</a></p> 
<p id="h_593416735_30-toc" style="margin-left:80px;"><a href="#h_593416735_30" rel="nofollow">8.2 404页面展示</a></p> 
<p id="h_593416735_31-toc" style="margin-left:80px;"><a href="#h_593416735_31" rel="nofollow">修改查询不到数据返回的响应</a></p> 
<p id="h_593416735_32-toc" style="margin-left:80px;"><a href="#h_593416735_32" rel="nofollow">8.3 推荐文章数据展示</a></p> 
<p id="h_593416735_33-toc" style="margin-left:80px;"><a href="#h_593416735_33" rel="nofollow">8.4 评论模型</a></p> 
<p id="h_593416735_34-toc" style="margin-left:80px;"><a href="#h_593416735_34" rel="nofollow">8.5 发表评论</a></p> 
<p id="h_593416735_35-toc" style="margin-left:80px;"><a href="#h_593416735_35" rel="nofollow">8.6 详情评论数据展示</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="h_593416735_0">一、项目准备</h3> 
<h4 id="h_593416735_1">1.1 项目分析</h4> 
<blockquote>
  需求分析原因 
</blockquote> 
<ul><li>项目中，<strong>需求驱动开发</strong>。即开发人员需要以需求为目标来实现业务逻辑。</li></ul> 
<p>需求分析方式</p> 
<ul><li>企业中，借助<strong>产品原型图</strong>分析需求。</li><li>需求分析完后，前端按照产品原型图开发前端页面，后端开发对应的业务及响应处理。</li><li>提示：我们现在假借示例网站作为原型图来分析需求。</li></ul> 
<p>需求分析内容</p> 
<ul><li>页面及页面上的<strong>业务逻辑</strong>。</li><li>归纳业务逻辑并<strong>划分模块</strong>。</li></ul> 
<p><strong>1. 项目主要页面介绍</strong></p> 
<blockquote> 
 <strong>1.注册页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0a/47/ubwfBmzj_o.png"></p> 
<blockquote> 
 <strong>2.登录页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/38/5c/ISyTBD5i_o.png"></p> 
<blockquote> 
 <strong>3.忘记密码页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e0/0a/UxrZ1LYm_o.png"></p> 
<blockquote> 
 <strong>4.用户中心页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b1/6a/8E7qMWSR_o.png"></p> 
<blockquote> 
 <strong>5.写博客页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/14/47/XTdI5NQO_o.png"></p> 
<blockquote> 
 <strong>6.博客首页</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/98/70/ETrXPg2I_o.png"></p> 
<blockquote> 
 <strong>7.博客详情页面</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f1/3d/mzDYWA39_o.png"></p> 
<p>2. 归纳项目主要模块</p> 
<p></p> 
<table><tbody><tr><th>模块</th><th>功能</th></tr><tr><td>注册</td><td>图形验证、短信验证</td></tr><tr><td>登录</td><td>状态保持、Cookie、Session</td></tr><tr><td>个人中心</td><td>图片上传、更新数据</td></tr><tr><td>发布博客</td><td>数据入库</td></tr><tr><td>博客首页</td><td>数据分页</td></tr><tr><td>博客详情</td><td>博客详情数据展示、评论功能</td></tr></tbody></table> 
<p></p> 
<p><strong>3. 项目开发模式</strong></p> 
<p></p> 
<table><tbody><tr><th>选项</th><th>技术选型</th></tr><tr><td>开发模式</td><td>前后端不分离</td></tr><tr><td>后端框架</td><td>Django + Django模板引擎</td></tr></tbody></table> 
<p></p> 
<h4 id="h_593416735_2">1.2 工程创建和配置</h4> 
<p><strong>1.2.1 工程创建和配置</strong></p> 
<p><strong>1. 准备项目代码仓库</strong></p> 
<blockquote>
  1. 
 <strong>源码托管网站</strong> 
</blockquote> 
<ul><li><a href="https://link.zhihu.com/?target=https%3A//github.com/" rel="nofollow" title="GitHub">GitHub</a></li></ul> 
<blockquote>
  2. 
 <strong>创建源码远程仓库：itheima_blog</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0a/fc/z5RWciBj_o.png"></p> 
<p><strong>2. 克隆项目代码仓库</strong></p> 
<blockquote> 
 <strong>1.进入本地项目目录</strong> 
</blockquote> 
<pre><code>cd Desktop/</code></pre> 
<blockquote> 
 <strong>2.克隆仓库</strong> 
</blockquote> 
<pre><code>git clone https://github.com/qruihua/itheima_blog.git</code></pre> 
<p><strong>3. 创建美多商城工程</strong></p> 
<blockquote> 
 <strong>1.进入本地项目仓库</strong> 
</blockquote> 
<pre><code>cd itheima_blog/</code></pre> 
<blockquote> 
 <strong>2.创建美多商城虚拟环境，安装Django框架</strong> 
</blockquote> 
<pre><code>$ mkvirtualenv -p python3 blog
$ pip install django==2.2</code></pre> 
<blockquote> 
 <strong>3.创建美多商城Django工程</strong> 
</blockquote> 
<pre><code>$ django-admin startproject blog</code></pre> 
<blockquote>
  创建工程完成后：运行程序，测试结果。 
</blockquote> 
<p><strong>1.2.2 配置MySQL数据库</strong></p> 
<p><strong>1. 新建MySQL数据库</strong></p> 
<blockquote> 
 <strong>1.新建MySQL数据库：blog</strong> 
</blockquote> 
<pre><code>$ create database blog charset=utf8;</code></pre> 
<blockquote> 
 <strong>2.新建MySQL用户</strong> 
</blockquote> 
<pre><code>$ create user itheima identified by '123456';</code></pre> 
<blockquote> 
 <strong>3.授权itheima用户访问blog数据库</strong> 
</blockquote> 
<pre><code>$ grant all on blog.* to 'itheima'@'%';</code></pre> 
<blockquote> 
 <strong>4.授权结束后刷新特权</strong> 
</blockquote> 
<pre><code>$ flush privileges;</code></pre> 
<p>2. 配置MySQL数据库</p> 
<p><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/1.11/ref/databases/%23id10" rel="nofollow" title="文档">文档</a></p> 
<pre><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql', # 数据库引擎
        'HOST': '127.0.0.1', # 数据库主机
        'PORT': 3306, # 数据库端口
        'USER': 'itheima', # 数据库用户名
        'PASSWORD': '123456', # 数据库用户密码
        'NAME': 'blog' # 数据库名字
    },
}</code></pre> 
<blockquote> 
 <a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/1.11/ref/databases/%23mysql-db-api-drivers" rel="nofollow" title="文档">文档</a> 可能出现的错误 
</blockquote> 
<ul><li>Error loading MySQLdb module: No module named 'MySQLdb'.</li></ul> 
<p>出现错误的原因：</p> 
<ul><li>Django中操作MySQL数据库需要驱动程序MySQLdb</li><li>目前项目虚拟环境中没有驱动程序MySQLdb</li></ul> 
<p>解决办法：</p> 
<ul><li>安装PyMySQL扩展包</li><li>因为MySQLdb只适用于Python2.x的版本，Python3.x的版本中使用PyMySQL替代MySQLdb</li></ul> 
<p>3. 安装PyMySQL扩展包</p> 
<blockquote> 
 <strong>1.安装驱动程序</strong> 
</blockquote> 
<pre><code>$ pip install PyMySQL</code></pre> 
<blockquote> 
 <strong>2.在工程同名子目录的</strong>__init__.py 
 <strong>文件中，添加如下代码：</strong> 
</blockquote> 
<pre><code>import pymysql
pymysql.install_as_MySQLdb()</code></pre> 
<blockquote>
  配置完成后：运行程序，测试结果。 
</blockquote> 
<p><strong>1.2.3 配置Redis数据库</strong></p> 
<p>1. 安装django-redis扩展包</p> 
<blockquote> 
 <strong>1.安装django-redis扩展包</strong> 
</blockquote> 
<pre><code>$ pip install django-redis</code></pre> 
<blockquote> 
 <strong>2.django-redis使用说明文档</strong> 
</blockquote> 
<p><a href="https://link.zhihu.com/?target=https%3A//django-redis-chs.readthedocs.io/zh_CN/latest/" rel="nofollow" title="点击进入文档">点击进入文档</a></p> 
<p>2. 配置Redis数据库</p> 
<pre><code>CACHES = {
    "default": { # 默认
        "BACKEND": "django_redis.cache.RedisCache",
        "LOCATION": "redis://127.0.0.1:6379/0",
        "OPTIONS": {
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
        }
    },
    "session": { # session
        "BACKEND": "django_redis.cache.RedisCache",
        "LOCATION": "redis://127.0.0.1:6379/1",
        "OPTIONS": {
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
        }
    },
}
SESSION_ENGINE = "django.contrib.sessions.backends.cache"
SESSION_CACHE_ALIAS = "session"</code></pre> 
<blockquote>
  default： 
</blockquote> 
<ul><li>默认的Redis配置项，采用0号Redis库。</li></ul> 
<p>session：</p> 
<ul><li>状态保持的Redis配置项，采用1号Redis库。</li></ul> 
<p>SESSION_ENGINE</p> 
<ul><li>修改session存储机制使用Redis保存。</li></ul> 
<p>SESSION_CACHE_ALIAS：</p> 
<ul><li>使用名为"session"的Redis配置项存储session数据。</li></ul> 
<p>配置完成后：运行程序，测试结果。</p> 
<p><strong>1.2.4 配置工程日志</strong></p> 
<p><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/1.11/topics/logging/" rel="nofollow" title="文档">文档</a></p> 
<p>1. 配置工程日志</p> 
<pre><code>LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,  # 是否禁用已经存在的日志器
    'formatters': {  # 日志信息显示的格式
        'verbose': {
            'format': '%(levelname)s %(asctime)s %(module)s %(lineno)d %(message)s'
        },
        'simple': {
            'format': '%(levelname)s %(module)s %(lineno)d %(message)s'
        },
    },
    'filters': {  # 对日志进行过滤
        'require_debug_true': {  # django在debug模式下才输出日志
            '()': 'django.utils.log.RequireDebugTrue',
        },
    },
    'handlers': {  # 日志处理方法
        'console': {  # 向终端中输出日志
            'level': 'INFO',
            'filters': ['require_debug_true'],
            'class': 'logging.StreamHandler',
            'formatter': 'simple'
        },
        'file': {  # 向文件中输出日志
            'level': 'INFO',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': os.path.join(BASE_DIR, 'logs/blog.log'),  # 日志文件的位置
            'maxBytes': 300 * 1024 * 1024,
            'backupCount': 10,
            'formatter': 'verbose'
        },
    },
    'loggers': {  # 日志器
        'django': {  # 定义了一个名为django的日志器
            'handlers': ['console', 'file'],  # 可以同时向终端与文件中输出日志
            'propagate': True,  # 是否继续传递日志信息
            'level': 'INFO',  # 日志器接收的最低日志级别
        },
    }
}</code></pre> 
<p>2. 准备日志文件目录</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/88/13/XANqn8ip_o.png"></p> 
<p>3. 日志记录器的使用</p> 
<p>不同的应用程序所定义的日志等级可能会有所差别，分的详细点的会包含以下几个等级：</p> 
<ul><li>FATAL/CRITICAL = 重大的，危险的</li><li>ERROR = 错误</li><li>WARNING = 警告</li><li>INFO = 信息</li><li>DEBUG = 调试</li><li>NOTSET = 没有设置</li></ul> 
<pre><code>import logging

# 创建日志记录器
logger = logging.getLogger('django')
# 输出日志
logger.debug('测试logging模块debug')
logger.info('测试logging模块info')
logger.error('测试logging模块error')</code></pre> 
<p><strong>1.2.5 静态资源文件</strong></p> 
<p>1. 准备静态文件</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4f/c7/t3wbUxfo_o.png"></p> 
<p>2. 指定静态文件加载路径</p> 
<pre><code>STATIC_URL = '/static/'

# 配置静态文件加载路径
STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]</code></pre> 
<blockquote>
  配置完成后：运行程序，测试结果。 
</blockquote> 
<ul><li><a href="https://link.zhihu.com/?target=http%3A//127.0.0.1%3A8008/static/index.html" rel="nofollow" title="http://127.0.0.1:8000/static/index.html">http://127.0.0.1:8000/static/index.html</a></li></ul> 
<h3 id="h_593416735_3">二、注册</h3> 
<p><strong>2.1 界面展示</strong></p> 
<p>1. 创建用户模块应用</p> 
<blockquote> 
 <strong>创建应用</strong>users 
</blockquote> 
<pre><code>$ python manage.py startapp users</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/7f/8b/D9vFbm80_o.png"></p> 
<p>2. 注册用户模块应用</p> 
<pre><code>INSTALLED_APPS = [
    ...

    'users.apps.UsersConfig',
]</code></pre> 
<blockquote>
  注册完users应用后，运行测试程序。 
</blockquote> 
<p>3. 准备模板目录并设置模板路径</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/2f/d1/KwdKW5pu_o.png"></p> 
<p>4. 定义用户注册视图</p> 
<blockquote>
  1.将static文件夹下在register.html拖拽到templates文件中 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/88/42/2CESZJ90_o.png"></p> 
<blockquote>
  2.在users.views.py文件中定义视图 
</blockquote> 
<pre><code>from django.views import View

class RegisterView(View):
    """用户注册"""

    def get(self, request):
        """
        提供注册界面
        :param request: 请求对象
        :return: 注册界面
        """
        return render(request, 'register.html')</code></pre> 
<p>5. 定义用户注册路由</p> 
<blockquote> 
 <strong>1.在users子应用中创建urls.py文件，并定义子路由</strong> 
</blockquote> 
<pre><code>from django.urls import path
from users.views import RegisterView

urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('register/',RegisterView.as_view(),name='register'),
]</code></pre> 
<blockquote> 
 <strong>2.在工程的urls.py总路由中添加子应用路由引导</strong> 
</blockquote> 
<pre><code>from django.contrib import admin
from django.urls import path,include

urlpatterns = [
    path('admin/', admin.site.urls),
    # include 参数1要设置为元组（urlconf_module, app_name）
    # namespace 设置命名空间
    path('', include(('users.urls', 'users'), namespace='users')),
]</code></pre> 
<blockquote>
  运行测试程序。 
</blockquote> 
<p>6.修改静态文件加载方式</p> 
<blockquote>
  1.是 
 <strong>由于静态资源加载是相对路径，因此我们需要修改静态资源的加载方式</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/de/39/yS5c1jez_o.png"></p> 
<pre><code>以下代码是html的header处修改
    {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    。。。
    以下代码是html的footer处修改
    &lt;!-- 引入js --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/register.js' %}"&gt;&lt;/script&gt;</code></pre> 
<blockquote>
  运行测试程序，没有问题 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/70/e2/2nW68J6e_o.png"></p> 
<h4 id="h_593416735_4">2.2 定义用户模型类</h4> 
<p><strong>1. Django默认<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/2.2/topics/auth/default/" rel="nofollow" title="用户认证系统">用户认证系统</a></strong></p> 
<ul><li>Django自带用户认证系统</li><li>它处理用户账号、组、权限以及基于cookie的用户会话。</li><li>Django认证系统位置</li><li>django.contrib.auth包含认证框架的核心和默认的模型。</li><li>Django认证系统同时处理认证和授权</li><li>认证：验证一个用户是否它声称的那个人，可用于账号登录。</li><li>授权：授权决定一个通过了认证的用户被允许做什么。</li><li>Django认证系统包含的内容</li><li>用户：用户模型类、用户认证。</li><li>权限：标识一个用户是否可以做一个特定的任务，MIS系统常用到。</li><li>组：对多个具有相同权限的用户进行统一管理，MIS系统常用到。</li><li>密码：一个可配置的密码哈希系统，设置密码、密码校验。</li></ul> 
<p><strong>2. Django默认用户模型类</strong></p> 
<ul><li>Django认证系统中提供了用户模型类User保存用户的数据。</li><li><strong>User对象是认证系统的核心。</strong></li><li>Django认证系统用户模型类位置</li><li><strong>django.contrib.auth.models.User</strong></li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/5b/d5/sDwWEbMJ_o.png"></p> 
<p>父类<strong>AbstractUser</strong>介绍</p> 
<ul><li>User对象基本属性</li><li>创建用户必选：username、password</li><li>创建用户可选：email、first_name、last_name、last_login、date_joined、is_active 、is_staff、is_superuse</li><li>判断用户是否通过认证：is_authenticated</li><li>USERNAME_FIELD:可以修改用户名认证字段</li><li>创建用户的方法 user = User.objects.create_user(username, password, **extra_fields)</li><li>用户认证的方法 from django.contrib.auth import authenticate user = authenticate(username=username, password=password, **kwargs)</li><li>处理密码的方法</li><li>设置密码：set_password(raw_password)</li><li>校验密码：check_password(raw_password)</li></ul> 
<p><strong>3. 自定义用户模型类</strong></p> 
<blockquote>
  思考：为什么要自定义用户模型类？ 
</blockquote> 
<ul><li>观察注册界面会发现，个人博客注册页面中必须有手机号，而且在登录页面中也使用手机号进行认证。此外个人中心页面中有个人头像和个人简介字段。</li><li>但是Django默认用户模型类中没有这些字段，所以要自定义用户模型类。</li></ul> 
<p>如何自定义用户模型类？</p> 
<ul><li>继承自<strong>AbstractUser</strong>（可通过阅读Django默认用户模型类的源码得知） 。</li><li>新增手机号字段，头像字段和简介字段。</li></ul> 
<pre><code>from django.db import models
from django.contrib.auth.models import AbstractUser

# 用户信息
class User(AbstractUser):

    # 电话号码字段
    # unique 为唯一性字段
    mobile = models.CharField(max_length=20, unique=True,blank=True)

    # 头像
    # upload_to为保存到响应的子目录中
    avatar = models.ImageField(upload_to='avatar/%Y%m%d/', blank=True)

    # 个人简介
    user_desc = models.TextField(max_length=500, blank=True)

    # 修改认证的字段
    USERNAME_FIELD = 'mobile'

    #创建超级管理员的需要必须输入的字段
    REQUIRED_FIELDS = ['username','email']

    # 内部类 class Meta 用于给 model 定义元数据
    class Meta:
        db_table='tb_user'              #修改默认的表名
        verbose_name='用户信息'         # Admin后台显示
        verbose_name_plural=verbose_name # Admin后台显示

    def __str__(self):
        return self.mobile</code></pre> 
<p><strong>4. 指定用户模型类</strong></p> 
<p><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/2.2/topics/auth/customizing/%23auth-custom-user" rel="nofollow" title="文档">文档</a></p> 
<blockquote>
  思考：为什么Django默认用户模型类是User？ 
</blockquote> 
<ul><li>阅读源代码：'django.conf.global_settings’ AUTH_USER_MODEL = 'auth.User'</li></ul> 
<p>结论：</p> 
<ul><li>Django用户模型类是通过全局配置项<strong>AUTH_USER_MODEL</strong>决定的</li></ul> 
<p>配置规则： AUTH_USER_MODEL = '应用名.模型类名'</p> 
<pre><code># 指定本项目用户模型类

AUTH_USER_MODEL = 'users.User'</code></pre> 
<p>5. 迁移用户模型类</p> 
<blockquote> 
 <strong>1.创建迁移文件</strong> 
</blockquote> 
<ul><li>python manage.py makemigrations</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/89/a5/rDecdDSl_o.png"></p> 
<p>2.执行迁移文件</p> 
<ul><li>python manage.py migrate</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/aa/41/tXBYxCDZ_o.png"></p> 
<blockquote>
  运行测试程序 
</blockquote> 
<h4 id="h_593416735_5">2.3 图形验证码</h4> 
<p><strong>1. 准备captcha包（该包用于生成图形验证码）</strong></p> 
<blockquote> 
 <strong>1.将生成图片验证码的库复制到新建的libs包中。</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8a/7f/5lmsKrz8_o.png"></p> 
<blockquote> 
 <strong>2.安装Python处理图片的库</strong> 报错信息如下： 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/78/1e/g886mCw9_o.png"></p> 
<p>解决方案<strong>：在虚拟环境中安装Pillow。执行pip install Pillow即可</strong></p> 
<p><strong>2. 图形验证码后端接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>GET</td></tr><tr><td>请求地址</td><td>imagecode?uuid=xxxxx-xxxx-xxxxxx</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：路径参数</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>uuid</td><td>string</td><td>是</td><td>唯一编号</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：</strong>image/jpeg 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/23/c3/4wjxTLQI_o.png"></p> 
<p><strong>3. 图形验证码后端实现</strong></p> 
<blockquote> 
 <strong>1.图形验证码视图</strong> 
</blockquote> 
<pre><code>from django.http import HttpResponseBadRequest,HttpResponse
from libs.captcha.captcha import captcha
from django_redis import get_redis_connection

class ImageCodeView(View):

    def get(self,request):
        #获取前端传递过来的参数
        uuid=request.GET.get('uuid')
        #判断参数是否为None
        if uuid is None:
            return HttpResponseBadRequest('请求参数错误')
        # 获取验证码内容和验证码图片二进制数据
        text, image = captcha.generate_captcha()
        # 将图片验内容保存到redis中，并设置过期时间
        redis_conn = get_redis_connection('default')
        redis_conn.setex('img:%s' % uuid, 300, text)
        # 返回响应，将生成的图片以content_type为image/jpeg的形式返回给请求
        return HttpResponse(image, content_type='image/jpeg')</code></pre> 
<blockquote> 
 <strong>2.总路由</strong> 
</blockquote> 
<pre><code>from django.contrib import admin
from django.urls import path,include

urlpatterns = [
    path('admin/', admin.site.urls),
    # include 参数1要设置为元组（urlconf_module, app_name）
    # namespace 设置命名空间
    path('', include(('users.urls', 'users'), namespace='users')),
]</code></pre> 
<blockquote> 
 <strong>3.子路由</strong> 
</blockquote> 
<pre><code>from django.urls import path
from users.views import ImageCodeView

urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('imagecode/', ImageCodeView.as_view(),name='imagecode'),
]</code></pre> 
<p><strong>4. 修改模板中图片验证码HTML代码</strong></p> 
<blockquote>
  1.html中的原代码如下 
</blockquote> 
<pre><code>&lt;img src="{% static 'img/image_code.png' %}" @click="generate_image_code" alt="" style="width: 110px;height: 40px;"&gt;</code></pre> 
<blockquote>
  2.修改如下 
</blockquote> 
<pre><code>&lt;img :src="image_code_url" @click="generate_image_code" alt="" style="width: 110px;height: 40px;"&gt;</code></pre> 
<h4 id="h_593416735_6">2.4 短信验证码</h4> 
<p><strong>1. 容联云短信平台操作</strong></p> 
<blockquote> 
 <strong>1.容联云官网</strong> 
</blockquote> 
<ul><li>容联云通讯网址：<a href="https://link.zhihu.com/?target=https%3A//www.yuntongxun.com/" rel="nofollow" title="https://www.yuntongxun.com/">https://www.yuntongxun.com/</a></li><li>注册并登陆</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1a/6c/WpuZ8zfy_o.png"></p> 
<blockquote> 
 <strong>2.容联云管理控制台</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/73/ff/N1tepu60_o.png"></p> 
<blockquote>
  3 
 <strong>.添加容联云测试手机号</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d7/11/0qR7wKNy_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ec/80/YHD3mCQt_o.png"></p> 
<blockquote> 
 <strong>4.短信模板</strong> 免费开发测试使用的模板ID为1，形式为：【云通讯】您使用的是云通讯短信模板，您的验证码是{1}，请于{2}分钟内正确输入。 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/58/0e/vhBubVoV_o.png"></p> 
<p>2. 短信发送测试</p> 
<blockquote> 
 <strong>1.集成短信SDK到库中</strong> CCPRestSDK.py：由容联云通讯开发者编写的官方SDK文件，包括发送模板短信的方法 ccp_sms.py：调用发送模板短信的方法 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4d/2b/gcIDZmeG_o.png"></p> 
<blockquote> 
 <strong>2.修改相应参数进行测试</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8f/cf/6FGVbHte_o.png"></p> 
<blockquote> 
 <strong>3.进行测试</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/55/9f/3YDap8VY_o.png"></p> 
<p><strong>3. 短信验证码后端接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>GET</td></tr><tr><td>请求地址</td><td>/smscode/?mobile=xxxxℑ_code=xxxx&amp;uuid=xxxxx</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：路径参数</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>mobile</td><td>string</td><td>是</td><td>手机号</td></tr><tr><td>image_code</td><td>string</td><td>是</td><td>图形验证码</td></tr><tr><td>uuid</td><td>string</td><td>是</td><td>唯一编号</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：JSON</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>code</td><td>状态码</td></tr><tr><td>errmsg</td><td>错误信息</td></tr></tbody></table> 
<p></p> 
<p><strong>4. 短信验证码后端逻辑实现</strong></p> 
<pre><code>from django.http import JsonResponse
from utils.response_code import RETCODE
from random import randint
from libs.yuntongxun.sms import CCP
import logging
logger=logging.getLogger('django')

class SmsCodeView(View):

    def get(self,request):
        # 接收参数
        image_code_client = request.GET.get('image_code')
        uuid = request.GET.get('uuid')
        mobile=request.GET.get('mobile')

        # 校验参数
        if not all([image_code_client, uuid,mobile]):
            return JsonResponse({'code': RETCODE.NECESSARYPARAMERR, 'errmsg': '缺少必传参数'})

        # 创建连接到redis的对象
        redis_conn = get_redis_connection('default')
        # 提取图形验证码
        image_code_server = redis_conn.get('img:%s' % uuid)
        if image_code_server is None:
            # 图形验证码过期或者不存在
            return JsonResponse({'code': RETCODE.IMAGECODEERR, 'errmsg': '图形验证码失效'})
        # 删除图形验证码，避免恶意测试图形验证码
        try:
            redis_conn.delete('img:%s' % uuid)
        except Exception as e:
            logger.error(e)
        # 对比图形验证码
        image_code_server = image_code_server.decode()  # bytes转字符串
        if image_code_client.lower() != image_code_server.lower():  # 转小写后比较
            return JsonResponse({'code': RETCODE.IMAGECODEERR, 'errmsg': '输入图形验证码有误'})

        # 生成短信验证码：生成6位数验证码
        sms_code = '%06d' % randint(0, 999999)
        #将验证码输出在控制台，以方便调试
        logger.info(sms_code)
        # 保存短信验证码到redis中，并设置有效期
        redis_conn.setex('sms:%s' % mobile, 300, sms_code)
        # 发送短信验证码
        CCP().send_template_sms(mobile, [sms_code, 5],1)

        # 响应结果
        return JsonResponse({'code': RETCODE.OK, 'errmsg': '发送短信成功'})</code></pre> 
<p><strong>5. 添加response_code文件</strong></p> 
<blockquote> 
 <strong>在工程中新建utils包，将response_code文件复制到utils中</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/2b/41/kgSXYKmY_o.png"></p> 
<h4 id="h_593416735_7">2.5 用户注册实现</h4> 
<p>1. 用户注册接口设计</p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/register/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单参数</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>mobile</td><td>string</td><td>是</td><td>用户名</td></tr><tr><td>password</td><td>string</td><td>是</td><td>密码</td></tr><tr><td>password2</td><td>string</td><td>是</td><td>确认密码</td></tr><tr><td>sms_code</td><td>string</td><td>是</td><td>短信验证码</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>响应结果</th><th>响应内容</th></tr><tr><td>注册失败</td><td>响应错误提示</td></tr><tr><td>注册成功</td><td>重定向到首页</td></tr></tbody></table> 
<p></p> 
<p>2. 用户注册接口实现</p> 
<blockquote> 
 <strong>1.注册视图</strong> 
</blockquote> 
<pre><code>import re
from users.models import User
from django.db import DatabaseError

class RegisterView(View):

    def post(self,request):
        #接收参数
        mobile = request.POST.get('mobile')
        password = request.POST.get('password')
        password2 = request.POST.get('password2')
        smscode=request.POST.get('sms_code')

        # 判断参数是否齐全
        if not all([mobile, password, password2, smscode]):
            return HttpResponseBadRequest('缺少必传参数')
        # 判断手机号是否合法
        if not re.match(r'^1[3-9]\d{9}$', mobile):
            return HttpResponseBadRequest('请输入正确的手机号码')
        # 判断密码是否是8-20个数字
        if not re.match(r'^[0-9A-Za-z]{8,20}$', password):
            return HttpResponseBadRequest('请输入8-20位的密码')
        # 判断两次密码是否一致
        if password != password2:
            return HttpResponseBadRequest('两次输入的密码不一致')

        #验证短信验证码
        redis_conn = get_redis_connection('default')
        sms_code_server = redis_conn.get('sms:%s' % mobile)
        if sms_code_server is None:
            return HttpResponseBadRequest('短信验证码已过期')
        if smscode != sms_code_server.decode():
            return HttpResponseBadRequest('短信验证码错误')

        # 保存注册数据
        try:
            user=User.objects.create_user(username=mobile,mobile=mobile, password=password)
        except DatabaseError:
            return HttpResponseBadRequest('注册失败')

        # 响应注册结果
        return HttpResponse('注册成功，重定向到首页')</code></pre> 
<blockquote> 
 <strong>2.在进行页面提交时报403csrf问题</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e9/5c/XLvrugfu_o.png"></p> 
<blockquote> 
 <strong>3.在HTML表单中添加csrf_token</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/01/d8/WepGZj8p_o.png"></p> 
<h4 id="h_593416735_8">2.6 展示首页</h4> 
<p>1.创建首页子应用</p> 
<ul><li><strong>重要提示：注册成功，重定向到首页</strong></li></ul> 
<blockquote> 
 <strong>1.创建首页应用：home</strong> 
</blockquote> 
<pre><code>$ python manage.py startapp home</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e6/54/eHEQbwOj_o.png"></p> 
<blockquote> 
 <strong>2.定义首页视图：IndexView</strong> 
</blockquote> 
<pre><code>from django.views import View

class IndexView(View):
    """首页广告"""

    def get(self, request):
        """提供首页广告界面"""
        return render(request, 'index.html')</code></pre> 
<blockquote> 
 <strong>3.配置首页路由</strong> 
</blockquote> 
<p><strong>在home子应用中创建urls.py文件，并定义子路由</strong></p> 
<pre><code>from django.urls import path
from home.views import IndexView
urlpatterns = [
    path('', IndexView.as_view(),name='index'),
]</code></pre> 
<p><strong>在工程的urls.py总路由中添加子应用路由引导</strong></p> 
<pre><code>from django.urls import path, include

urlpatterns = [

    path('', include(('home.urls','home'),namespace='home')),
]</code></pre> 
<blockquote> 
 <strong>4.测试首页是否可以正常访问</strong> 
</blockquote> 
<pre><code>http://127.0.0.1:8000/</code></pre> 
<blockquote> 
 <strong>5.修改注册成功后，重定向到首页</strong> 
</blockquote> 
<pre><code>from django.shortcuts import redirect
from django.urls import reverse

# 响应注册结果
return redirect(reverse('home:index'))</code></pre> 
<h4 id="h_593416735_9">2.7 状态保持</h4> 
<blockquote>
  说明： 
</blockquote> 
<ul><li>如果需求是注册成功后即表示用户认证通过，那么此时可以在注册成功后实现状态保持</li><li>如果需求是注册成功后不表示用户认证通过，那么此时不用在注册成功后实现状态保持</li></ul> 
<p><strong>当前的需求是：注册成功后即表示用户认证通过</strong></p> 
<p><strong>1. login()方法介绍</strong></p> 
<ol><li>状态保持：</li></ol> 
<ul><li>将通过认证的用户的唯一标识信息（比如：用户ID）写入到当前session会话中</li></ul> 
<ol><li>login()方法：</li></ol> 
<ul><li>Django用户认证系统提供了login()方法</li><li>封装了写入session的操作，帮助我们快速实现状态保持</li></ul> 
<ol><li>login()位置：</li></ol> 
<ul><li>django.contrib.auth.__init__.py文件中 login(request, user)</li></ul> 
<p><strong>2. login()方法使用</strong></p> 
<pre><code># 保存注册数据
try:
    user=User.objects.create_user(username=mobile,mobile=mobile, password=password)
except DatabaseError:
    return HttpResponseBadRequest('注册失败')

# 实现状态保持
login(request, user)

# 响应注册结果
return redirect(reverse('home:index'))</code></pre> 
<p><strong>3. 查看状态保持结果</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/72/b1/s6nWsIqp_o.png"></p> 
<p><strong>4. 设置首页所需的用户名信息和登录状态</strong></p> 
<blockquote> 
 <strong>1.设置cookie代码</strong> 
</blockquote> 
<pre><code># 保存注册数据
        try:
            user=User.objects.create_user(username=mobile,mobile=mobile, password=password)
        except DatabaseError:
            return HttpResponseBadRequest('注册失败')

        # 实现状态保持
        from django.contrib.auth import login
        login(request, user)


        #跳转到首页
        response = redirect(reverse('home:index'))
        #设置cookie
        #登录状态，会话结束后自动过期
        response.set_cookie('is_login',True)
        #设置用户名有效期一个月
        response.set_cookie('username',user.username,max_age=30*24*3600)

        return response</code></pre> 
<blockquote> 
 <strong>2.查看cookie数据</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b8/f6/6vrMJCOW_o.png"></p> 
<h3 id="h_593416735_10">三、登录</h3> 
<h4 id="h_593416735_11">3.1 手机登录</h4> 
<p><strong>1. 登录页面展示</strong></p> 
<blockquote> 
 <strong>1.在users.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>from django.views import View

class LoginView(View):

    def get(self,request):
        return render(request,'login.html')</code></pre> 
<blockquote>
  2 
 <strong>.在users.urls.py文件中定义路由</strong> 
</blockquote> 
<pre><code>from users.views import LoginView
urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('login/', LoginView.as_view(),name='login'),
]</code></pre> 
<blockquote>
  3 
 <strong>.修改login.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
    {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- Footer部分 --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/login.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- 点击注册部分 --&gt;
    &lt;small class="form-text text-muted ml-1"&gt;还没有账号？&lt;a href="{% url 'users:register' %}" style="color: cornflowerblue; "&gt;注册新账号&lt;/a&gt;</code></pre> 
<p><strong>2. 登录接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/login/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>username</td><td>string</td><td>是</td><td>用户名</td></tr><tr><td>password</td><td>string</td><td>是</td><td>密码</td></tr><tr><td>remember</td><td>string</td><td>否</td><td>是否记住用户</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>登录失败</td><td>响应错误提示</td></tr><tr><td>登录成功</td><td>重定向到首页</td></tr></tbody></table> 
<p></p> 
<p><strong>3. 登录接口实现</strong></p> 
<pre><code>from django.contrib.auth import login
from django.contrib.auth import authenticate

class LoginView(View):

    def post(self,request):
        # 接受参数
        mobile = request.POST.get('mobile')
        password = request.POST.get('password')
        remember = request.POST.get('remember')

        # 校验参数
        # 判断参数是否齐全
        if not all([mobile, password]):
            return HttpResponseBadRequest('缺少必传参数')

        # 判断手机号是否正确
        if not re.match(r'^1[3-9]\d{9}$', mobile):
            return HttpResponseBadRequest('请输入正确的手机号')

        # 判断密码是否是8-20个数字
        if not re.match(r'^[0-9A-Za-z]{8,20}$', password):
            return HttpResponseBadRequest('密码最少8位，最长20位')

        # 认证登录用户
        # 认证字段已经在User模型中的USERNAME_FIELD = 'mobile'修改
        user=authenticate(mobile=mobile, password=password)

        if user is None:
            return HttpResponseBadRequest('用户名或密码错误')

        # 实现状态保持
        login(request, user)

        # 响应登录结果
        response =  redirect(reverse('home:index'))

        # 设置状态保持的周期
        if remember != 'on':
            # 没有记住用户：浏览器会话结束就过期
            request.session.set_expiry(0)
            # 设置cookie
            response.set_cookie('is_login', True)
            response.set_cookie('username', user.username, max_age=30 * 24 * 3600)
        else:
            # 记住用户：None表示两周后过期
            request.session.set_expiry(None)
            # 设置cookie
            response.set_cookie('is_login', True, max_age=14*24 * 3600)
            response.set_cookie('username', user.username, max_age=30 * 24 * 3600)
        #返回响应
        return response</code></pre> 
<blockquote>
  注意： 默认的认证方法中是对username进行认证。我们需要修改认证的字段为mobile。所以我们需要在User的模型中修改 USERNAME_FIELD='mobile'才能实现手机号的认证 
</blockquote> 
<h4 id="h_593416735_12">3.2 首页用户名展示</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/94/4a/Ez5jYzzN_o.png"></p> 
<p><strong>1. 用户名写入到cookie</strong></p> 
<pre><code># 响应登录结果
response =  redirect(reverse('home:index'))

# 设置状态保持的周期
if remember != 'on':
    # 没有记住用户：浏览器会话结束就过期
    request.session.set_expiry(0)
    # 设置cookie
    response.set_cookie('is_login', True)
    response.set_cookie('username', user.username, max_age=30 * 24 * 3600)
else:
    # 记住用户：None表示两周后过期
    request.session.set_expiry(None)
    # 设置cookie
    response.set_cookie('is_login', True, max_age=14*24 * 3600)
    response.set_cookie('username', user.username, max_age=30 * 24 * 3600)
#返回响应
return response</code></pre> 
<p><strong>2. Vue渲染首页用户名</strong></p> 
<blockquote> 
 <strong>1.index.html</strong> 
</blockquote> 
<pre><code>&lt;!-- 如果用户已经登录，则显示用户名下拉框 --&gt;
&lt;li class="nav-item dropdown" v-if="is_login"&gt;
    &lt;a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" @click="show_menu_click"&gt;[[username]]&lt;/a&gt;
    &lt;div class="dropdown-menu" aria-labelledby="navbarDropdown" style="display: block" v-show="show_menu"&gt;
        &lt;a class="dropdown-item" href="../static/write_blog.html"&gt;写文章&lt;/a&gt;
        &lt;a class="dropdown-item" href='../static/center.html'&gt;个人信息&lt;/a&gt;
        &lt;a class="dropdown-item" href='#'&gt;退出登录&lt;/a&gt;
    &lt;/div&gt;
&lt;/li&gt;
&lt;!-- 如果用户未登录，则显示登录按钮 --&gt;
&lt;li class="nav-item" v-else&gt;
    &lt;a class="nav-link" href="login.html"&gt;登录&lt;/a&gt;
&lt;/li&gt;</code></pre> 
<blockquote> 
 <strong>2.index.js</strong> 
</blockquote> 
<pre><code>mounted(){
    //获取用户名信息
    this.username=getCookie('username');
    //获取是否登录信息
    this.is_login=getCookie('is_login');
},</code></pre> 
<h4 id="h_593416735_13">3.3 退出登录</h4> 
<p><strong>1. logout()方法介绍</strong></p> 
<ol><li>退出登录：</li></ol> 
<ul><li>回顾登录：将通过认证的用户的唯一标识信息，写入到当前session会话中</li><li>退出登录：正好和登录相反（清理session会话信息）</li></ul> 
<ol><li>logout()方法：</li></ol> 
<ul><li>Django用户认证系统提供了logout()方法</li><li>封装了清理session的操作，帮助我们快速实现登出一个用户</li></ul> 
<p>logout()位置：</p> 
<ul><li>django.contrib.auth.__init__.py文件中</li></ul> 
<pre><code>logout(request)</code></pre> 
<p><strong>2. logout()方法使用</strong></p> 
<pre><code>from django.contrib.auth import logout

class LogoutView(View):

    def get(self,request):
        # 清理session
        logout(request)
        # 退出登录，重定向到登录页
        response = redirect(reverse('home:index'))
        # 退出登录时清除cookie中的登录状态
        response.delete_cookie('is_login')

        return response</code></pre> 
<blockquote>
  提示： 
</blockquote> 
<ul><li>由于首页中登录状态是从cookie中读取的。</li><li>所以退出登录时，需要将cookie中登录状态清除。</li></ul> 
<p><strong>3.实现退出登录</strong></p> 
<pre><code>&lt;div class="dropdown-menu" aria-labelledby="navbarDropdown" style="display: block" v-show="show_menu"&gt;
    &lt;a class="dropdown-item" href="../static/write_blog.html"&gt;写文章&lt;/a&gt;
    &lt;a class="dropdown-item" href='../static/center.html'&gt;个人信息&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:logout' %}'&gt;退出登录&lt;/a&gt;
&lt;/div&gt;</code></pre> 
<h3 id="h_593416735_14">四、忘记密码</h3> 
<p><strong>1. 忘记密码页面展示</strong></p> 
<blockquote> 
 <strong>1.在users.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>from django.views import View

class ForgetPasswordView(View):

    def get(self, request):

        return render(request, 'forget_password.html')</code></pre> 
<blockquote>
  2 
 <strong>.在users.urls.py文件中定义路由</strong> 
</blockquote> 
<pre><code>from users.views import ForgetPasswordView
urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('forgetpassword/', ForgetPasswordView.as_view(),name='forgetpassword'),
]</code></pre> 
<blockquote>
  3 
 <strong>.修改forget_password.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
    {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- Footer部分 --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/forget_password.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- 图片验证码部分 --&gt;
    &lt;img :src="image_code_url" @click="generate_image_code" alt="" style="width: 110px;height: 40px;"&gt;</code></pre> 
<blockquote>
  4 
 <strong>.修改login.html中的忘记密码的跳转连接</strong> 
</blockquote> 
<pre><code>&lt;small class="form-text text-muted ml-1"&gt;&lt;a class="secondaryAction layui-text" href="{% url 'users:forgetpassword' %}"&gt;忘记密码?&lt;/a&gt;</code></pre> 
<p><strong>2. 忘记密码接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/forgetpassword/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>mobile</td><td>string</td><td>是</td><td>用户名</td></tr><tr><td>password</td><td>string</td><td>是</td><td>密码</td></tr><tr><td>password2</td><td>string</td><td>是</td><td>确认密码</td></tr><tr><td>sms_code</td><td>string</td><td>是</td><td>短信验证码</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>修改失败</td><td>响应错误提示</td></tr><tr><td>修改成功</td><td>重定向到登录</td></tr></tbody></table> 
<p></p> 
<p><strong>3. 忘记密码接口实现</strong></p> 
<pre><code>class ForgetPasswordView(View):

    def post(self, request):
        # 接收参数
        mobile = request.POST.get('mobile')
        password = request.POST.get('password')
        password2 = request.POST.get('password2')
        smscode = request.POST.get('sms_code')

        # 判断参数是否齐全
        if not all([mobile, password, password2, smscode]):
            return HttpResponseBadRequest('缺少必传参数')

        # 判断手机号是否合法
        if not re.match(r'^1[3-9]\d{9}$', mobile):
            return HttpResponseBadRequest('请输入正确的手机号码')

        # 判断密码是否是8-20个数字
        if not re.match(r'^[0-9A-Za-z]{8,20}$', password):
            return HttpResponseBadRequest('请输入8-20位的密码')

        # 判断两次密码是否一致
        if password != password2:
            return HttpResponseBadRequest('两次输入的密码不一致')

        # 验证短信验证码
        redis_conn = get_redis_connection('default')
        sms_code_server = redis_conn.get('sms:%s' % mobile)
        if sms_code_server is None:
            return HttpResponseBadRequest('短信验证码已过期')
        if smscode != sms_code_server.decode():
            return HttpResponseBadRequest('短信验证码错误')

        # 根据手机号查询数据
        try:
            user = User.objects.get(mobile=mobile)
        except User.DoesNotExist:
            # 如果该手机号不存在，则注册个新用户
            try:
                User.objects.create_user(username=mobile, mobile=mobile, password=password)
            except Exception:
                return HttpResponseBadRequest('修改失败，请稍后再试')
        else:
            # 修改用户密码
            user.set_password(password)
            user.save()

        # 跳转到登录页面
        response = redirect(reverse('users:login'))

        return response</code></pre> 
<h3 id="h_593416735_15">五、用户中心</h3> 
<p><strong>5.1 用户中心展示</strong></p> 
<p>1. 页面展示</p> 
<blockquote> 
 <strong>1.在users.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>from django.views import View

class UserCenterView(View):

    def get(self,request):

        return render(request,'center.html')</code></pre> 
<blockquote>
  2 
 <strong>.在users.urls.py文件中定义路由</strong> 
</blockquote> 
<pre><code>from users.views import UserCenterView
urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('center/', UserCenterView.as_view(),name='center'),
]</code></pre> 
<blockquote>
  3 
 <strong>.修改center.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
    {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- Footer部分 --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/center.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- 页面跳转部分 --&gt;
    &lt;a class="dropdown-item" href='{% url 'users:center' %}'&gt;个人信息&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:logout' %}'&gt;退出登录&lt;/a&gt;</code></pre> 
<blockquote>
  4 
 <strong>.修改index.html中的的跳转连接</strong> 
</blockquote> 
<pre><code>&lt;a class="dropdown-item" href='{% url 'users:center' %}'&gt;个人信息&lt;/a&gt;</code></pre> 
<p><strong>2. 判断用户是否登录</strong></p> 
<blockquote>
  需求： 
</blockquote> 
<ul><li>当用户登录后，才能访问用户中心。</li><li>如果用户未登录，就不允许访问用户中心，将用户引导到登录界面。</li></ul> 
<p>实现方案：</p> 
<ul><li>需要判断用户是否登录。</li><li>根据是否登录的结果，决定用户是否可以访问用户中心。</li></ul> 
<p>Django用户认证系统提供了方法</p> 
<ul><li>request.user.is_authenticated()来判断用户是否登录。如果通过登录验证则返回<strong>True</strong>。反之，返回<strong>False</strong>。</li><li><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/1.11/topics/auth/default/" rel="nofollow" title="LoginRequiredMixin">LoginRequiredMixin</a>封装了判断用户是否登录的操作。</li></ul> 
<blockquote> 
 <strong>1.用户中心使用LoginRequiredMixin</strong> 
</blockquote> 
<pre><code>from django.views import View
from django.contrib.auth.mixins import LoginRequiredMixin

class UserCenterView(LoginRequiredMixin,View):

    def get(self,request):

        return render(request,'center.html')</code></pre> 
<blockquote> 
 <strong>2.设置未登录用户跳转的路由</strong> 
</blockquote> 
<pre><code>#在工程的settings.py文件中，添加以下配置。
LOGIN_URL = '/login/'</code></pre> 
<blockquote> 
 <strong>3.根据登录的next参数设置登录跳转路由</strong> 
</blockquote> 
<pre><code># 实现状态保持
login(request, user)

# 响应登录结果
next = request.GET.get('next')
if next:
    response= redirect(next)
else:
    response =  redirect(reverse('home:index'))</code></pre> 
<p><strong>3. 获取用户信息，模板渲染数据</strong></p> 
<blockquote> 
 <strong>1.获取用户信息修改center.html中的数据显示</strong> 
</blockquote> 
<pre><code>from django.contrib.auth.mixins import LoginRequiredMixin
class UserCenterView(LoginRequiredMixin,View):

    def get(self,request):
        # 获取用户信息
        user = request.user

        #组织模板渲染数据
        context = {
            'username': user.username,
            'mobile': user.mobile,
            'avatar': user.avatar.url if user.avatar else None,
            'user_desc': user.user_desc
        }
        return render(request,'center.html',context=context)</code></pre> 
<blockquote> 
 <strong>2.修改center.html中的数据显示</strong> 
</blockquote> 
<pre><code>&lt;form method="post" enctype="multipart/form-data"&gt;
    &lt;!-- username --&gt;
    &lt;div class="form-group col-md-4"&gt;
        &lt;label for="username"&gt;用户名&lt;/label&gt;
        &lt;input type="text" class="form-control" id="username" name="username" value="{<!-- -->{ username }}" &gt;
    &lt;/div&gt;
    {% if avatar %}
        &lt;br&gt; &lt;div class="col-md-4"&gt;头像&lt;/div&gt;
        &lt;img src="{<!-- -->{ avatar }}" style="max-width: 20%; border-radius: 15%;" class="col-md-4"&gt;&lt;br&gt;
        {% else %}
        &lt;br&gt;&lt;h5 class="col-md-4"&gt;暂无头像&lt;/h5&gt;&lt;br&gt;
    {% endif %}
    &lt;!-- avatar --&gt;
    &lt;div class="form-group col-md-4"&gt;
        &lt;label for="avatar"&gt;上传头像&lt;/label&gt;
        &lt;input type="file" class="form-control-file" name="avatar" id="avatar"&gt;
    &lt;/div&gt;

    &lt;!-- phone --&gt;
    &lt;div class="form-group col-md-4"&gt;
        &lt;label for="phone"&gt;电话&lt;/label&gt;
        &lt;input type="text" class="form-control" disabled="disabled" id="phone" name="phone" value="{<!-- -->{ mobile }}"&gt;
    &lt;/div&gt;
    &lt;!-- desc --&gt;
    &lt;div class="form-group col-md-4"&gt;
        &lt;label for="desc"&gt;简介&lt;/label&gt;
        &lt;!-- 文本区域 --&gt;
        &lt;textarea type="text" class="form-control" id="desc" name="desc" rows="12" &gt;{<!-- -->{ user_desc }}&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;!-- 提交按钮 --&gt;
    &lt;button type="submit" class="btn btn-primary" style="margin-left: 12px" &gt;修改&lt;/button&gt;
&lt;/form&gt;</code></pre> 
<h4 id="h_593416735_16">5.2 用户中心修改</h4> 
<p><strong>1. 用户中心接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/center/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>username</td><td>string</td><td>否</td><td>用户名</td></tr><tr><td>avatar</td><td>file</td><td>否</td><td>头像</td></tr><tr><td>desc</td><td>string</td><td>否</td><td>个人简介</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>修改失败</td><td>响应错误提示</td></tr><tr><td>修改成功</td><td>刷新展示</td></tr></tbody></table> 
<p></p> 
<p><strong>2. 用户中心修改接口实现</strong></p> 
<pre><code>from django.contrib.auth.mixins import LoginRequiredMixin
class UserCenterView(LoginRequiredMixin,View):

    def post(self,request):
        # 接收数据
        user = request.user
        avatar = request.FILES.get('avatar')
        username = request.POST.get('username',user.username)
        user_desc = request.POST.get('desc',user.user_desc)

        # 修改数据库数据
        try:
            user.username=username
            user.user_desc=user_desc
            if avatar:
                user.avatar=avatar
            user.save()
        except Exception as e:
            logger.error(e)
            return HttpResponseBadRequest('更新失败，请稍后再试')

        # 返回响应，刷新页面
        response = redirect(reverse('users:center'))
        #更新cookie信息
        response.set_cookie('username',user.username,max_age=30*24*3600)
        return response</code></pre> 
<p><strong>3. 用户中心头像的上传和展示</strong></p> 
<blockquote> 
 <strong>1.在settings.py文件中设置图片上传的路径并新建文件夹media</strong> 
</blockquote> 
<pre><code>MEDIA_ROOT = os.path.join(BASE_DIR, 'media/')</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d2/c5/gxHO17SG_o.png"></p> 
<blockquote> 
 <strong>2.重新上传之后发现无法访问</strong> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0e/af/IDTR909n_o.png"></p> 
<p>解决方案：</p> 
<p>第一步：设置图片的统一url都以media开头。在settings.py文件中设置</p> 
<pre><code># 图片的统一路由
MEDIA_URL = '/media/'</code></pre> 
<p>第二步：设置路由匹配规则。在工程的urls.py文件中设置</p> 
<pre><code>from django.contrib import admin
from django.urls import path,include

urlpatterns = [
    path('admin/', admin.site.urls),
    # include 参数1要设置为元组（urlconf_module, app_name）
    # namespace 设置命名空间
    path('', include(('users.urls', 'users'), namespace='users')),
    path('', include(('home.urls','home'),namespace='home')),
]
#以下代码为设置图片访问路由规则
from django.conf import settings
from django.conf.urls.static import static
urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</code></pre> 
<h3 id="h_593416735_17">六、写博客</h3> 
<h4 id="h_593416735_18">6.1 写博客页面展示</h4> 
<p><strong>1. 页面展示</strong></p> 
<blockquote> 
 <strong>1.在users.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>from django.views import View

class WriteBlogView(LoginRequiredMixin,View):

    def get(self,request):

        return render(request,'write_blog.html')</code></pre> 
<blockquote>
  2 
 <strong>.在users.urls.py文件中定义路由</strong> 
</blockquote> 
<pre><code>from users.views import WriteBlogView
urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('writeblog/', WriteBlogView.as_view(),name='writeblog'),
]</code></pre> 
<blockquote>
  3 
 <strong>.修改center.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
    {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- Footer部分 --&gt;
    &lt;!--ckeditor--&gt;
    &lt;script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}" data-ckeditor-basepath="{% static 'ckeditor/ckeditor/' %}" id="ckeditor-init-script"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"&gt;&lt;/script&gt;
    &lt;!-- 引入js --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/write_blog.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- 页面跳转部分 --&gt;
    &lt;a class="dropdown-item" href="{% url 'users:writeblog' %}"&gt;写文章&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:center'%}'&gt;个人信息&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:center' %}'&gt;退出登录&lt;/a&gt;</code></pre> 
<blockquote>
  4 
 <strong>.修改index.html中的的跳转连接</strong> 
</blockquote> 
<pre><code>&lt;a class="dropdown-item" href="{% url 'users:writeblog' %}"&gt;写文章&lt;/a&gt;</code></pre> 
<h4 id="h_593416735_19">6.2 文章分类模型</h4> 
<p>1. 定义模型类</p> 
<p>在home子应用的models.py模型中定义文章分类模型</p> 
<pre><code>from django.db import models
from django.utils import timezone

class ArticleCategory(models.Model):
    """
    文章分类
    """
    # 栏目标题
    title = models.CharField(max_length=100, blank=True)
    # 创建时间
    created = models.DateTimeField(default=timezone.now)

    def __str__(self):
        return self.title

    class Meta:
        db_table='tb_category'
        verbose_name = '类别管理'
        verbose_name_plural = verbose_name</code></pre> 
<p><strong>2. 迁移模型类</strong></p> 
<blockquote> 
 <strong>1.创建迁移文件</strong> 
</blockquote> 
<ul><li>python manage.py makemigrations</li></ul> 
<p><strong>2.执行迁移文件</strong></p> 
<ul><li>python manage.py migrate</li></ul> 
<h4 id="h_593416735_20">6.3 文章分类后台管理</h4> 
<p>网站的管理员负责查看、添加、修改、删除数据</p> 
<ul><li>Django能够根据定义的模型类自动地生成管理模块</li><li>登陆站点：<a href="https://link.zhihu.com/?target=http%3A//127.0.0.1%3A8000/admin" rel="nofollow" title="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></li><li>需要服务器是启动状态</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ba/77/VTzkJ7jC_o.png"></p> 
<ul><li>使用Django的管理模块, 需要按照如下步骤操作 :</li><li>1.管理界面本地化</li><li>2.创建管理员</li><li>3.注册模型类</li><li>4.发布内容到数据库</li></ul> 
<p><strong>1.管理界面本地化</strong></p> 
<ul><li>本地化是将显示的语言、时间等使用本地的习惯，这里的本地化就是进行中国化.</li><li>中国大陆地区使用简体中文, 时区使用亚洲/上海时区, 注意这里不使用北京时区.</li></ul> 
<pre><code>LANGUAGE_CODE = 'zh-Hans'   #原配置信息为'en-us'

TIME_ZONE = 'Asia/Shanghai'#原配置信息为'UTC'</code></pre> 
<p><strong>2.创建管理员</strong></p> 
<blockquote> 
 <strong>1.我们需要在User模型中设置 REQUIRED_FIELDS</strong> 
</blockquote> 
<pre><code>#创建超级管理员的需要必须输入的字段
REQUIRED_FIELDS = ['username','email']</code></pre> 
<blockquote> 
 <strong>2.在终端创建超级管理员</strong> 
</blockquote> 
<ul><li>创建管理员的命令 : python manage.py createsuperuser</li><li>按提示输入手机号、用户名、邮箱、密码信息</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ac/32/y0RxZ5Yc_o.png"></p> 
<ul><li>重置密码</li><li>python manager.py changepassword 用户名</li><li>登陆站点成功</li><li>站点界面中没有模型管理入口,因为没有注册模型类</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/52/82/OHvqsTyn_o.png"></p> 
<p><strong>3.注册模型类</strong></p> 
<ul><li>在应用的admin.py文件中注册模型类</li><li>需要导入模型模块 :from home.models import ArticleCategory</li></ul> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/47/f3/S0F2EExz_o.png"></p> 
<ul><li>注册模型后</li></ul> 
<blockquote> 
 <strong>1.站点管理能够显示类别管理是因为我们的模型的元类中设置做了设置</strong> class Meta: verbose_name = '类别管理' verbose_name_plural = verbose_name 2. 
 <strong>注册模型成功后, 就可以在站点管理界面方便快速的管理数据.</strong> 
</blockquote> 
<p><strong>4.发布内容到数据库</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/cd/80/BsvFk9G9_o.png"></p> 
<blockquote>
  模型类展示我们输入的内容是因为我们在模型中实现了__ 
 <em>str\</em>_方法_ class ArticleCategory(models.Model): """ 文章分类 """ # 栏目标题 title = models.CharField(max_length=100, blank=True) # 创建时间 created = models.DateTimeField(default=timezone.now) def __str__(self): return self.title 
</blockquote> 
<h4 id="h_593416735_21">6.4 写博客页面展示分类</h4> 
<h4 id="h_593416735_22">查询数据并展示</h4> 
<blockquote> 
 <strong>1.查询分类文章数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>from home.models import ArticleCategory
class WriteBlogView(LoginRequiredMixin,View):

    def get(self,request):
        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        context = {
            'categories': categories
        }
        return render(request,'write_blog.html',context=context)</code></pre> 
<blockquote>
  2 
 <strong>.在write_blog.html文件中使用模板语言展示数据</strong> 
</blockquote> 
<pre><code>&lt;!-- 文章栏目 --&gt;
&lt;div class="form-group"&gt;
    &lt;label for="column"&gt;栏目&lt;/label&gt;
    &lt;select class="form-control col-3" id="category" name="category"&gt;
            {% for category in categories %}
                &lt;option value="{<!-- -->{ category.id }}"&gt;{<!-- -->{ category.title }}&lt;/option&gt;
            {% endfor %}
    &lt;/select&gt;
&lt;/div&gt;</code></pre> 
<h4 id="h_593416735_23">6.5 文章模型</h4> 
<p><strong>1. 定义模型类</strong></p> 
<p>在home子应用的models.py模型中定义文章模型</p> 
<pre><code>from users.models import User 
class Article(models.Model):
    """
    文章
    """
    # 定义文章作者。 author 通过 models.ForeignKey 外键与内建的 User 模型关联在一起
    # 参数 on_delete 用于指定数据删除的方式，避免两个关联表的数据不一致。
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    # 文章标题图
    avatar = models.ImageField(upload_to='article/%Y%m%d/', blank=True)
    # 文章栏目的 “一对多” 外键
    category = models.ForeignKey(
        ArticleCategory,
        null=True,
        blank=True,
        on_delete=models.CASCADE,
        related_name='article'
    )
    # 文章标签
    tags = models.CharField(max_length=20,blank=True)
    # 文章标题。
    title = models.CharField(max_length=100,null=False,blank=False)
    # 概要
    sumary = models.CharField(max_length=200,null=False,blank=False)
    # 文章正文。
    content = models.TextField()
    # 浏览量
    total_views = models.PositiveIntegerField(default=0)
    # 文章评论数
    comments_count = models.PositiveIntegerField(default=0)
    # 文章创建时间。
    # 参数 default=timezone.now 指定其在创建数据时将默认写入当前的时间
    created = models.DateTimeField(default=timezone.now)
    # 文章更新时间。
    # 参数 auto_now=True 指定每次数据更新时自动写入当前时间
    updated = models.DateTimeField(auto_now=True)

    # 内部类 class Meta 用于给 model 定义元数据
    class Meta:
        # ordering 指定模型返回的数据的排列顺序
        # '-created' 表明数据应该以倒序排列
        ordering = ('-created',)
        db_table='tb_article'
        verbose_name='文章管理'
        verbose_name_plural=verbose_name
    # 函数 __str__ 定义当调用对象的 str() 方法时的返回值内容
    # 它最常见的就是在Django管理后台中做为对象的显示值。因此应该总是为 __str__ 返回一个友好易读的字符串
    def __str__(self):
        # 将文章标题返回
        return self.title</code></pre> 
<p><strong>2. 迁移模型类</strong></p> 
<blockquote> 
 <strong>1.创建迁移文件</strong> 
</blockquote> 
<ul><li>python manage.py makemigrations</li></ul> 
<p><strong>2.执行迁移文件</strong></p> 
<ul><li>python manage.py migrate</li></ul> 
<h4 id="h_593416735_24">6.6 博客保存</h4> 
<p><strong>1. 博客保存接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/writeblog/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>title</td><td>string</td><td>是</td><td>标题</td></tr><tr><td>avatar</td><td>file</td><td>是</td><td>标题图</td></tr><tr><td>category</td><td>string</td><td>是</td><td>栏目分类</td></tr><tr><td>tags</td><td>string</td><td>是</td><td>标签</td></tr><tr><td>sumary</td><td>string</td><td>是</td><td>文章摘要</td></tr><tr><td>content</td><td>string</td><td>是</td><td>文章内容</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>提交失败</td><td>响应错误提示</td></tr><tr><td>提交成功</td><td>跳转到详情页面</td></tr></tbody></table> 
<p></p> 
<p><strong>2. 用户中心修改接口实现</strong></p> 
<pre><code>from home.models import ArticleCategory,Article
class WriteBlogView(LoginRequiredMixin,View):

    def post(self,request):
        #接收数据
        avatar=request.FILES.get('avatar')
        title=request.POST.get('title')
        category_id=request.POST.get('category')
        tags=request.POST.get('tags')
        sumary=request.POST.get('sumary')
        content=request.POST.get('content')
        user=request.user

        #验证数据是否齐全
        if not all([avatar,title,category_id,sumary,content]):
            return HttpResponseBadRequest('参数不全')

        #判断文章分类id数据是否正确
        try:
            article_category=ArticleCategory.objects.get(id=category_id)
        except ArticleCategory.DoesNotExist:
            return HttpResponseBadRequest('没有此分类信息')

        #保存到数据库
        try:
            article=Article.objects.create(
                author=user,
                avatar=avatar,
                category=article_category,
                tags=tags,
                title=title,
                sumary=sumary,
                content=content
            )
        except Exception as e:
            logger.error(e)
            return HttpResponseBadRequest('发布失败，请稍后再试')

        #返回响应，跳转到文章详情页面
        #暂时先跳转到首页
        return redirect(reverse('home:index')) </code></pre> 
<h3 id="h_593416735_25">七、博客首页</h3> 
<h4 id="h_593416735_26">7.1 首页分类数据展示</h4> 
<p><strong>1. 首页接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>GET</td></tr><tr><td>请求地址</td><td>/?cat_id=xxx&amp;page_num=xxx&amp;page_size=xxx</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>cat_id</td><td>string</td><td>否</td><td>分类id</td></tr><tr><td>page_num</td><td>string</td><td>否</td><td>文章分页页码</td></tr><tr><td>page_size</td><td>string</td><td>否</td><td>文章每页条目数</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>失败</td><td>响应错误提示</td></tr><tr><td>成功</td><td>展示数据</td></tr></tbody></table> 
<p></p> 
<p><strong>2. 查询分类数据并展示</strong></p> 
<blockquote> 
 <strong>1.查询分类文章数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>from home.models import ArticleCategory
from django.http import HttpResponseNotFound

class IndexView(View):
    """首页广告"""

    def get(self, request):
        """提供首页广告界面"""
        #?cat_id=xxx&amp;page_num=xxx&amp;page_size=xxx
        cat_id=request.GET.get('cat_id',1)

        #判断分类id
        try:
            category = ArticleCategory.objects.get(id=cat_id)
        except ArticleCategory.DoesNotExist:
            return HttpResponseNotFound('没有此分类')

        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        context = {
            'categories':categories,
            'category':category
        }

        return render(request, 'index.html',context=context)</code></pre> 
<blockquote>
  2 
 <strong>.在index.html文件中使用模板语言展示分类数据</strong> 
</blockquote> 
<pre><code>&lt;ul class="nav navbar-nav"&gt;
    {% for cat in categories %}
        {% if cat.id == category.id %}
            &lt;li class="nav-item active"&gt;
                &lt;a class="nav-link mr-2" href="/?cat_id={<!-- -->{ cat.id }}"&gt;{<!-- -->{ cat.title }}&lt;/a&gt;
            &lt;/li&gt;
        {% else %}
            &lt;li class="nav-item"&gt;
                &lt;a class="nav-link mr-2" href="/?cat_id={<!-- -->{ cat.id }}"&gt;{<!-- -->{ cat.title }}&lt;/a&gt;
            &lt;/li&gt;
        {% endif %}
    {% endfor %}
&lt;/ul&gt;</code></pre> 
<h4 id="h_593416735_27">7.2 首页文章数据展示</h4> 
<p><strong>1. 查询分页数据并展示</strong></p> 
<blockquote> 
 <strong>1.查询分类文章数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>from home.models import ArticleCategory,Article
from django.http import HttpResponseNotFound
from django.core.paginator import Paginator,EmptyPage

class IndexView(View):
    """首页广告"""

    def get(self, request):
        """提供首页广告界面"""
        #?cat_id=xxx&amp;page_num=xxx&amp;page_size=xxx
        cat_id=request.GET.get('cat_id',1)
        page_num = request.GET.get('page_num', 1)
        page_size = request.GET.get('page_size', 10)
        #判断分类id
        try:
            category = ArticleCategory.objects.get(id=cat_id)
        except ArticleCategory.DoesNotExist:
            return HttpResponseNotFound('没有此分类')

        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        #分页数据
        articles = Article.objects.filter(
            category=category
        )

        # 创建分页器：每页N条记录
        paginator = Paginator(articles, page_size)
        # 获取每页商品数据
        try:
            page_articles = paginator.page(page_num)
        except EmptyPage:
            # 如果没有分页数据，默认给用户404
            return HttpResponseNotFound('empty page')
        # 获取列表页总页数
        total_page = paginator.num_pages

        context = {
            'categories':categories,
            'category':category,
            'articles': page_articles,
            'page_size': page_size,
            'total_page': total_page,
            'page_num': page_num,
        }

        return render(request, 'index.html',context=context)</code></pre> 
<blockquote> 
 <strong>2.在index.html文件中使用模板语言展示分类数据</strong> 
</blockquote> 
<pre><code>&lt;div class="container"&gt;
    &lt;!-- 列表循环 --&gt;
     {% for article in articles %}
        &lt;div class="row mt-2"&gt;
            &lt;!-- 文章内容 --&gt;
            &lt;!-- 标题图 --&gt;
            &lt;div class="col-3"&gt;
                &lt;img src="{<!-- -->{ article.avatar.url }}" alt="avatar" style="max-width:100%; border-radius: 20px"&gt;
            &lt;/div&gt;
            &lt;div class="col"&gt;
                &lt;!-- 栏目 --&gt;
                &lt;a  role="button" class="btn btn-sm mb-2 btn-warning"&gt;{<!-- -->{ article.category.title }}&lt;/a&gt;
            &lt;!-- 标签 --&gt;
                &lt;span&gt;
                        &lt;a class="badge badge-secondary"&gt;{<!-- -->{ article.tags }}&lt;/a&gt;
                &lt;/span&gt;
                &lt;!-- 标题 --&gt;
                &lt;h4&gt;
                    &lt;b&gt;&lt;a href="./detail.html" style="color: black;"&gt;{<!-- -->{ article.title }}&lt;/a&gt;&lt;/b&gt;
                &lt;/h4&gt;
                &lt;!-- 摘要 --&gt;
                &lt;div&gt;
                    &lt;p style="color: gray;"&gt;
                        {<!-- -->{ article.sumary }}
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;!-- 注脚 --&gt;
                &lt;p&gt;
                    &lt;!-- 查看、评论、时间 --&gt;
                    &lt;span&gt;&lt;i class="fas fa-eye" style="color: lightskyblue;"&gt;&lt;/i&gt;{<!-- -->{ article.total_views }}&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;
                    &lt;span&gt;&lt;i class="fas fa-comments" style="color: yellowgreen;"&gt;&lt;/i&gt;{<!-- -->{ article.comments_count }}&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;
                    &lt;span&gt;&lt;i class="fas fa-clock" style="color: pink;"&gt;&lt;/i&gt;{<!-- -->{ article.created | date }}&lt;/span&gt;
                &lt;/p&gt;
            &lt;/div&gt;
            &lt;hr style="width: 100%;"/&gt;
    &lt;/div&gt;
    {% endfor %}
    &lt;!-- 页码导航 --&gt;
    &lt;div class="pagenation" style="text-align: center"&gt;
        &lt;div id="pagination" class="page"&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre> 
<blockquote> 
 <strong>3.修改底部js分页代码</strong> 
</blockquote> 
<pre><code>&lt;script type="text/javascript"&gt;
    $(function () {
        $('#pagination').pagination({
            currentPage: {<!-- -->{ page_num }},
            totalPage: {<!-- -->{ total_page }},
            callback:function (current) {

                location.href = '/?cat_id={<!-- -->{ category.id }}&amp;page_size={<!-- -->{ page_size }}&amp;page_num='+current;
            }
        })
    });
&lt;/script&gt;</code></pre> 
<p><strong>2. 插入更多测试数据</strong></p> 
<p>我们可以通过蠕虫复制来插入更多测试数据</p> 
<pre><code>insert into tb_article(avatar,tags,title,sumary,content,total_views,comments_count,created,updated,author_id,category_id)
select avatar,tags,title,sumary,content,total_views,comments_count,created,updated,author_id,category_id fro</code></pre> 
<h3 id="h_593416735_28">八、博客详情</h3> 
<h4 id="h_593416735_29">8.1 详情页面展示</h4> 
<p><strong>1. 页面展示</strong></p> 
<blockquote> 
 <strong>1.在home.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>from django.views import View

class DetailView(View):

    def get(self,request):


        return render(request,'detail.html')</code></pre> 
<blockquote>
  2 
 <strong>.在home.urls.py文件中定义路由</strong> 
</blockquote> 
<pre><code>from users.views import DetailView
urlpatterns = [
    # 参数1：路由
    # 参数2：视图函数
    # 参数3：路由名，方便通过reverse来获取路由
    path('detail/', DetailView.as_view(),name='detail'),
]</code></pre> 
<blockquote>
  3 
 <strong>.修改detail.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
       {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    &lt;!--详情页面导入--&gt;
    &lt;script src="{% static 'ckeditor/ckeditor/plugins/prism/lib/prism/prism_patched.min.js' %}"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" href="{% static 'prism/prism.css' %}"&gt;
    &lt;!--导入css--&gt;
    &lt;link rel="stylesheet" href="{% static 'common/common.css' %}"&gt;
    &lt;link rel="stylesheet" href="{% static 'common/jquery.pagination.css' %}"&gt;
    &lt;!-- 引入vuejs --&gt;
    &lt;script type="text/javascript" src="{% static 'js/vue-2.5.16.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/axios-0.18.0.min.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/jquery-1.12.4.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- Footer部分 --&gt;
    &lt;!--ckeditor--&gt;
    &lt;script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}" data-ckeditor-basepath="{% static 'ckeditor/ckeditor/' %}" id="ckeditor-init-script"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"&gt;&lt;/script&gt;
    &lt;!-- 引入js --&gt;
    &lt;script type="text/javascript" src="{% static 'js/host.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/common.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/detail.js' %}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="{% static 'js/jquery.pagination.min.js' %}"&gt;&lt;/script&gt;
    ...
    &lt;!-- 页面跳转部分 --&gt;
    &lt;a class="dropdown-item" href="{% url 'users:writeblog' %}"&gt;写文章&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:center'%}'&gt;个人信息&lt;/a&gt;
    &lt;a class="dropdown-item" href='{% url 'users:center' %}'&gt;退出登录&lt;/a&gt;</code></pre> 
<p><strong>2. 首页接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/?id=xxx&amp;page_num=xxx&amp;page_size=xxx</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>id</td><td>string</td><td>否</td><td>文章id</td></tr><tr><td>page_num</td><td>string</td><td>否</td><td>评论页码</td></tr><tr><td>page_size</td><td>string</td><td>否</td><td>评论每页条目数</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>失败</td><td>响应错误提示</td></tr><tr><td>成功</td><td>展示数据</td></tr></tbody></table> 
<p></p> 
<p><strong>3. 查询分类数据并展示</strong></p> 
<blockquote> 
 <strong>1.查询文章数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>class DetailView(View):

    def get(self,request):
        # detail/?id=xxx&amp;page_num=xxx&amp;page_size=xxx
        #获取文档id
        id=request.GET.get('id')

        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        try:
            article=Article.objects.get(id=id)
        except Article.DoesNotExist:
            return render(request,'404.html')

        context = {
            'categories':categories,
            'category':article.category,
            'article':article,
        }

        return render(request,'detail.html',context=context)</code></pre> 
<blockquote> 
 <strong>2.在detail.html文件中使用模板语言展示文章数据</strong> 
</blockquote> 
<pre><code>#分类数据展示
 &lt;div&gt;
    &lt;ul class="nav navbar-nav"&gt;
        {% for cat in categories %}
            {% if cat.id == category.id %}
                &lt;li class="nav-item active"&gt;
                    &lt;a class="nav-link mr-2" href="/?cat_id={<!-- -->{ cat.id }}"&gt;{<!-- -->{ cat.title }}&lt;/a&gt;
                &lt;/li&gt;
            {% else %}
                &lt;li class="nav-item"&gt;
                    &lt;a class="nav-link mr-2" href="/?cat_id={<!-- -->{ cat.id }}"&gt;{<!-- -->{ cat.title }}&lt;/a&gt;
                &lt;/li&gt;
            {% endif %}
        {% endfor %}
    &lt;/ul&gt;
&lt;/div&gt;

#详情数据展示
 &lt;!-- 标题及作者 --&gt;
&lt;h1 class="mt-4 mb-4"&gt;{<!-- -->{ article.title }}&lt;/h1&gt;
&lt;div class="alert alert-success"&gt;&lt;div&gt;作者：&lt;span&gt;{<!-- -->{ article.author.username }}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;浏览：{<!-- -->{ article.total_views }}&lt;/div&gt;&lt;/div&gt;
&lt;!-- 文章正文 --&gt;
&lt;div class="col-12" style="word-break: break-all;word-wrap: break-word;"&gt;
    {<!-- -->{ article.content|safe }}
&lt;/div&gt;
&lt;br&gt;</code></pre> 
<p><strong>4. 修改首页跳转到详情页面的链接</strong></p> 
<pre><code>&lt;!-- 标题 --&gt;
&lt;h4&gt;
    &lt;b&gt;&lt;a href="{% url 'home:detail' %}?id={<!-- -->{ article.id }}" style="color: black;"&gt;{<!-- -->{ article.title }}&lt;/a&gt;&lt;/b&gt;
&lt;/h4&gt;</code></pre> 
<h4 id="h_593416735_30">8.2 404页面展示</h4> 
<h4 id="h_593416735_31">修改查询不到数据返回的响应</h4> 
<blockquote> 
 <strong>1.在home.views.py文件中定义视图</strong> 
</blockquote> 
<pre><code>try:
    article=Article.objects.get(id=id)
except Article.DoesNotExist:
    return render(request,'404.html')</code></pre> 
<blockquote>
  2 
 <strong>.修改404.html中的资源加载方式</strong> 
</blockquote> 
<pre><code>&lt;!-- Header部分 --&gt;
        {% load staticfiles %}
    &lt;!-- 引入bootstrap的css文件 --&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}"&gt;
    ...
    &lt;!--content--&gt;
    &lt;div class="container" style="height: 600px;margin-top: 20px"&gt;
        &lt;img src="{% static 'img/404.png' %}" alt=""&gt;
        &lt;br&gt;
        &lt;div style="text-align: center;"&gt;
            &lt;a href="{% url 'home:index' %}" class="primaryAction btn btn-primary"&gt;返回首页&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;</code></pre> 
<h4 id="h_593416735_32">8.3 推荐文章数据展示</h4> 
<p><strong>1. 添加文章浏览量数据</strong></p> 
<blockquote> 
 <strong>1.每次请求文章详情时给浏览量+1</strong> 
</blockquote> 
<pre><code>try:
    article=Article.objects.get(id=id)
except Article.DoesNotExist:
    return render(request,'404.html')
else:
    article.total_views+=1
    article.save()</code></pre> 
<p><strong>2. 查询推荐文章并展示</strong></p> 
<blockquote> 
 <strong>1.查询推荐文章数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>class DetailView(View):

    def get(self,request):
        # detail/?id=xxx&amp;page_num=xxx&amp;page_size=xxx
        #获取文档id
        id=request.GET.get('id')

        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        try:
            article=Article.objects.get(id=id)
        except Article.DoesNotExist:
            return render(request,'404.html')
        else:
            article.total_views+=1
            article.save()

        # 获取热点数据
        hot_articles = Article.objects.order_by('-total_views')[:9]

        context = {
            'categories':categories,
            'category':article.category,
            'article':article,
            'hot_articles':hot_articles
        }

        return render(request,'detail.html',context=context)</code></pre> 
<blockquote> 
 <strong>2.在detail.html文件中使用模板语言展示推荐数据</strong> 
</blockquote> 
<pre><code>&lt;div class="sidebar__inner"&gt;
    &lt;h4&gt;&lt;strong&gt;推荐&lt;/strong&gt;&lt;/h4&gt;
    &lt;hr&gt;
    {% for hot_article in hot_articles %}
        &lt;a href="{% url 'home:detail' %}?id={<!-- -->{ hot_article.id }}" style="color: black"&gt;{<!-- -->{ hot_article.title }}&lt;/a&gt;&lt;br&gt;
    {% endfor %}
    &lt;/div&gt;
&lt;/div&gt;</code></pre> 
<h4 id="h_593416735_33">8.4 评论模型</h4> 
<p><strong>1. 定义模型类</strong></p> 
<p>在home子应用的models.py模型中定义评论模型</p> 
<pre><code>class Comment(models.Model):
    #评论内容
    content=models.TextField()
    #评论的文章
    article=models.ForeignKey(Article,
                              on_delete=models.SET_NULL,
                              null=True)
    #发表评论的用户
    user=models.ForeignKey('users.User',
                           on_delete=models.SET_NULL,
                           null=True)
    #评论发布时间
    created=models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.article.title

    class Meta:
        db_table='tb_comment'
        verbose_name = '评论管理'
        verbose_name_plural = verbose_name</code></pre> 
<p><strong>2. 迁移模型类</strong></p> 
<blockquote> 
 <strong>1.创建迁移文件</strong> 
</blockquote> 
<ul><li>python manage.py makemigrations</li></ul> 
<p><strong>2.执行迁移文件</strong></p> 
<ul><li>python manage.py migrate</li></ul> 
<h4 id="h_593416735_34">8.5 发表评论</h4> 
<p><strong>1. 发表评论接口设计</strong></p> 
<blockquote> 
 <strong>1.请求方式</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>选项</th><th>方案</th></tr><tr><td>请求方法</td><td>POST</td></tr><tr><td>请求地址</td><td>/detail/</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>2.请求参数：表单</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>参数名</th><th>类型</th><th>是否必传</th><th>说明</th></tr><tr><td>user_id</td><td>string</td><td>是</td><td>发表评论的用户id</td></tr><tr><td>article_id</td><td>string</td><td>是</td><td>评论的文字id</td></tr><tr><td>content</td><td>string</td><td>是</td><td>评论内容</td></tr></tbody></table> 
<p></p> 
<blockquote> 
 <strong>3.响应结果：HTML</strong> 
</blockquote> 
<p></p> 
<table><tbody><tr><th>字段</th><th>说明</th></tr><tr><td>提交失败</td><td>响应错误提示</td></tr><tr><td>提交成功</td><td>刷新页面展示</td></tr></tbody></table> 
<p></p> 
<p><strong>2. 发表评论接口实现</strong></p> 
<blockquote> 
 <strong>1.发表评论实现</strong> 
</blockquote> 
<pre><code>from home.models import Comment,Article
class DetailView(View):

    def post(self,request):
        #获取用户信息
        user=request.user

        #判断用户是否登录
        if user and user.is_authenticated:
            #接收数据
            id=request.POST.get('id')
            content=request.POST.get('content')

            #判断文章是否存在
            try:
                article = Article.objects.get(id=id)
            except Article.DoesNotExist:
                return HttpResponseNotFound('没有此文章')

            #保存到数据
            Comment.objects.create(
                content=content,
                article=article,
                user=user
            )
            #修改文章评论数量
            article.comments_count+=1
            article.save()
            #拼接跳转路由
            path=reverse('home:detail')+'?id={}'.format(article.id)
            return redirect(path)
        else:
            #没有登录则跳转到登录页面
            return redirect(reverse('users:login'))</code></pre> 
<blockquote> 
 <strong>2.detail.html修改</strong> 
</blockquote> 
<pre><code>&lt;form method="POST"&gt;
    {% csrf_token %}
    &lt;input type="hidden" name="id" value="{<!-- -->{ article.id }}"&gt;
    &lt;div class="form-group"&gt;&lt;label for="body"&gt;&lt;strong&gt;我也要发言：&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;
            &lt;div class="django-ckeditor-widget" data-field-id="id_body" style="display: inline-block;"&gt;
                &lt;textarea cols="40" id="id_body" name="content" rows="10" required data-processed="0" :data-config="data_config" data-external-plugin-resources="[]" data-id="id_body" data-type="ckeditortype"&gt;

                &lt;/textarea&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- 提交按钮 --&gt;
    &lt;button type="submit" class="btn btn-primary "&gt;发送&lt;/button&gt;
&lt;/form&gt; </code></pre> 
<h4 id="h_593416735_35">8.6 详情评论数据展示</h4> 
<p><strong>1. 查询评论数据并展示</strong></p> 
<blockquote> 
 <strong>1.查询评论数据并通过context传递给HTML</strong> 
</blockquote> 
<pre><code>from home.models import Comment
from django.shortcuts import redirect,reverse
class DetailView(View):

    def get(self,request):
        # detail/?id=xxx&amp;page_num=xxx&amp;page_size=xxx
        #获取文档id
        id=request.GET.get('id')
        page_num=request.GET.get('page_num',1)
        page_size=request.GET.get('page_size',5)
        # 获取博客分类信息
        categories = ArticleCategory.objects.all()

        try:
            article=Article.objects.get(id=id)
        except Article.DoesNotExist:
            return render(request,'404.html')
        else:
            article.total_views+=1
            article.save()

        # 获取热点数据
        hot_articles = Article.objects.order_by('-total_views')[:9]

        # 获取当前文章的评论数据
        comments = Comment.objects.filter(
            article=article
        ).order_by('-created')
        #获取评论总数
        total_count = comments.count()

        # 创建分页器：每页N条记录
        paginator = Paginator(comments, page_size)
        # 获取每页商品数据
        try:
            page_comments = paginator.page(page_num)
        except EmptyPage:
            # 如果page_num不正确，默认给用户404
            return HttpResponseNotFound('empty page')
        # 获取列表页总页数
        total_page = paginator.num_pages

        context = {
            'categories':categories,
            'category':article.category,
            'article':article,
            'hot_articles':hot_articles,
            'total_count': total_count,
            'comments': page_comments,
            'page_size': page_size,
            'total_page': total_page,
            'page_num': page_num,
        }

        return render(request,'detail.html',context=context)</code></pre> 
<blockquote> 
 <strong>2.在index.html文件中使用模板语言展示分类数据</strong> 
</blockquote> 
<pre><code>&lt;!-- 显示评论 --&gt;
&lt;h4&gt;共有{<!-- -->{ total_count }}条评论&lt;/h4&gt;
&lt;div class="row"&gt;
     {% for comment in comments %}
        &lt;div class="col-12" &gt;
            &lt;hr&gt;&lt;p&gt;&lt;strong style="color: pink"&gt;&lt;/strong&gt;&lt;/p&gt;
            &lt;div&gt;
                &lt;div&gt;&lt;span&gt;&lt;strong&gt;{<!-- -->{ comment.user.username }}&lt;/strong&gt;&lt;/span&gt;&amp;nbsp;&lt;span style="color: gray"&gt;{<!-- -->{ comment.created | date:'Y:m:d H:i:s' }}&lt;/span&gt;&lt;/div&gt;
                &lt;br&gt;
                &lt;p&gt;{<!-- -->{ comment.content|safe }}&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    {% endfor %}
    &lt;div class="pagenation" style="text-align: center"&gt;
        &lt;div id="pagination" class="page"&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre> 
<blockquote> 
 <strong>3.修改底部js分页代码</strong> 
</blockquote> 
<pre><code>&lt;script type="text/javascript"&gt;
    $(function () {
        $('#pagination').pagination({
           currentPage: {<!-- -->{ page_num }},
            totalPage: {<!-- -->{ total_page }},
            callback:function (current) {
                location.href = '/detail/?id={<!-- -->{ article.id }}&amp;page_size={<!-- -->{ page_size }}&amp;page_num='+current;
            }
        })
    });
&lt;/script&gt;</code></pre> 
<p><strong>2. 插入更多测试数据</strong></p> 
<p>我们可以通过蠕虫复制来插入更多测试数据</p> 
<pre><code>insert into tb_comment(content,created,article_id,user_id)
select content,created,article_id,user_id from tb_comment;</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7ff19c62775d308378445a6f5d666b47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Wireshark导出rtp音频数据并使用Audacity分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c54ea4ebbfc88f840a5ede60c4f78d8a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SSM框架项目实战-CRM(客户关系管理1)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>