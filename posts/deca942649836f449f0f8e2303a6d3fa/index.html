<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>监控Oracle(oracledb_exporter) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="监控Oracle(oracledb_exporter)" />
<meta property="og:description" content="我们以监控Oracle为例，（目前仅有x86版本，可以下载源码针对不同环境使用golang环境自己编译）
监控什么指标下载对应系统的exporter插件，统一下载地址：https://prometheus.io/download/
监控指标对应的grafana展示模板，统一下载地址：https://grafana.com/grafana/dashboards
oracledb_exporter下载地址：https://github.com/iamseth/oracledb_exporter
oracle client下载地址：https://www.oracle.com/database/technologies/instant-client/downloads.html
环境准备 已完成Prometheus的配置安装已完成Grafana的配置安装下载oracledb_exporter插件 开始配置 第一步 # 下载Oracledb_exporter wget https://github.com/iamseth/oracledb_exporter/releases/download/0.2.9/oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz # 解压运行 tar -zxvf oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz # 下载oracle-instantclient18.5-basic-18.5.0.0.0-3.x86_64.rpm # 上传至服务器并安装 rpm -ivh oracle-instantclient18.5-basic-18.5.0.0.0-3.x86_64.rpm 开始运行 第一步配置Oracle client # 创建client目录 mkdir -p /usr/lib/oracle/12.1/client64/network/admin/ # 编辑监听文件 vim /usr/lib/oracle/12.1/client64/network/admin/tnsnames.ora ## 填写以下内容 ORCL = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = *IP*)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = *SID*) ) ) # 编辑环境变量配置文件 vim ~/.bashrc ## 输入以下内容 export ORACLE_HOME=/usr/lib/oracle/12." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/deca942649836f449f0f8e2303a6d3fa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-20T15:06:46+08:00" />
<meta property="article:modified_time" content="2022-09-20T15:06:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">监控Oracle(oracledb_exporter)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>我们以监控Oracle为例，（目前仅有x86版本，可以下载源码针对不同环境使用golang环境自己编译）</p> 
<blockquote> 
 <p>监控什么指标下载对应系统的exporter插件，统一下载地址：https://prometheus.io/download/</p> 
</blockquote> 
<blockquote> 
 <p>监控指标对应的grafana展示模板，统一下载地址：https://grafana.com/grafana/dashboards</p> 
</blockquote> 
<blockquote> 
 <p>oracledb_exporter下载地址：https://github.com/iamseth/oracledb_exporter</p> 
</blockquote> 
<blockquote> 
 <p>oracle client下载地址：https://www.oracle.com/database/technologies/instant-client/downloads.html</p> 
</blockquote> 
<h2><a id="_10"></a>环境准备</h2> 
<ul><li>已完成Prometheus的配置安装</li><li>已完成Grafana的配置安装</li><li>下载<a href="https://github.com/iamseth/oracledb_exporter/releases/download/0.2.9/oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz">oracledb_exporter</a>插件</li></ul> 
<h2><a id="_16"></a>开始配置</h2> 
<h3><a id="_18"></a>第一步</h3> 
<pre><code class="prism language-SHELL"># 下载Oracledb_exporter
wget https://github.com/iamseth/oracledb_exporter/releases/download/0.2.9/oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz

# 解压运行
tar -zxvf oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz

# 下载oracle-instantclient18.5-basic-18.5.0.0.0-3.x86_64.rpm

# 上传至服务器并安装
rpm -ivh oracle-instantclient18.5-basic-18.5.0.0.0-3.x86_64.rpm

</code></pre> 
<p><img src="https://images2.imgbox.com/86/e0/RKfu9y4V_o.png" alt=""></p> 
<h2><a id="_36"></a>开始运行</h2> 
<h3><a id="Oracle_client_38"></a>第一步配置Oracle client</h3> 
<pre><code class="prism language-SHELL"># 创建client目录
mkdir -p /usr/lib/oracle/12.1/client64/network/admin/
# 编辑监听文件
vim /usr/lib/oracle/12.1/client64/network/admin/tnsnames.ora
## 填写以下内容
ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = *IP*)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = *SID*)
    )
  )

# 编辑环境变量配置文件
vim  ~/.bashrc
## 输入以下内容
export  ORACLE_HOME=/usr/lib/oracle/12.1/client64
export  TNS_ADMIN=$ORACLE_HOME/network/admin
export  NLS_LANG='simplified chinese_china'.ZHS16GBK
export  LD_LIBRARY_PATH=$ORACLE_HOME/lib
export  PATH=$ORACLE_HOME/bin:$PATH
# 设置临时环境变量
export DATA_SOURCE_NAME=用户名/密码@//ip:port/实例名    
</code></pre> 
<h3><a id="_todo_67"></a>第二步 todo</h3> 
<pre><code class="prism language-SHELL">./oracledb_exporter

# 多个使用逗号分隔
</code></pre> 
<blockquote> 
 <p>脚本启动后，可以看到脚本为我们提供了一个基于9161的http服务，http://192.168.5.135:9161/metrics，看到监控数据即为成功</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5d/4f/X4WvGWnf_o.png" alt=""></p> 
<blockquote> 
 <p>可以看到有许多报错，这些报错暂时先不排查，可能是由于数据库的参数设置导致的或者其它原因。</p> 
</blockquote> 
<h3><a id="_80"></a>第二步</h3> 
<ul><li>我们需要将上述脚本提供的http地址配置到prometheus的配置文件中</li></ul> 
<pre><code class="prism language-SHELL">scrape_configs:
  - job_name: 'oracle'
    static_configs:
     - targets: ['192.168.5.135:9161']
</code></pre> 
<ul><li>保存退出并启动prometheus</li></ul> 
<pre><code class="prism language-SHELL">./prometheus --config.file=prometheus.yml --web.listen-address=:9099
</code></pre> 
<h3><a id="_97"></a>第三步</h3> 
<ul><li>配置grafana 
  <ul><li>登录grafana</li></ul> </li></ul> 
<h4><a id="prometheus_102"></a>新建数据源，并选择prometheus源(如果存在可跳过，这里不做赘述)</h4> 
<h4><a id="__grafana_104"></a>创建仪表板 - 使用导入监控服务器grafana模板的方式</h4> 
<ul><li>经过在官网查找监控服务器指标模板id为<strong>3333</strong>(由于我们服务器都联网了，所以直接输入id，load即可)</li></ul> 
<blockquote> 
 <p>[!TIP|style:callout]<br> 此处特殊说明一下，导入模板的目的本身是为了避免我们重复造轮子，自己去针对每个监控面板写查询prometheus的语句，当然模板本身也是由其他开发者提交的，所以3333并不是我们唯一选择</p> 
</blockquote> 
<ul><li>选择<code>prometheus</code>源, 点击<code>import</code>，右上角我们修改为5s刷新一次，等一会可以看到redis的监控指标如下：</li></ul> 
<p><img src="https://images2.imgbox.com/40/33/53XW9WK3_o.png" alt=""></p> 
<blockquote> 
 <p>以上至少证明了整个监控的流程走通了，至于no data还需要我们真对图标的表达式进行一项一项的验证。</p> 
</blockquote> 
<h3><a id="oracledb_exporter_117"></a>运行oracledb_exporter通用报错</h3> 
<pre><code class="prism language-SHELL">##错误： ./oracledb_exporter: error while loading shared libraries: libclntsh.so.18.1: cannot open shared object file: No such file or directory
find / -name libclntsh.so.18.1
# /usr/lib/oracle/18.5/client64/lib/libclntsh.so.18.1
ln -s /usr/lib/oracle/18.5/client64/lib/libclntsh.so.18.1 /usr/lib64/

## 同理，再次运行oracledb_exporter，缺什么就用上面那种方式解决，知道运行不报错
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2d2a48770582743fc293d31d0144c57e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">lamabda左连接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2450f94e0ed11928c5fac20aa31f5f87/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux 镜像文件ISO下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>