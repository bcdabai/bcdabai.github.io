<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NVIDIA JETSON XAVIER NX （四）安装Pytorch和torchvision - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NVIDIA JETSON XAVIER NX （四）安装Pytorch和torchvision" />
<meta property="og:description" content="可选择在NX上创建新python环境进行安装，避免和其他工程环境发生冲突，具体虚拟环境操作步骤可见Python创建虚拟环境。
下面就开始安装pytorch的愉快之旅吧！
1. 安装相关依赖环境
# 先把能更新的都更新了 sudo apt-get update sudo apt-get upgrade # 装上我们需要的环境包 # 最好使用pip3，不然出错了不好排查 sudo apt-get install python3-pip libopenblas-base libopenmpi-dev pip3 install Cython 2. 下载pytorch
由于NX使用的是aarch64架构的cpu，直接官网安装是不行的，那么就得求助NVIDIA论坛了：Pytorch for Jetson
论坛中给出了详细的安装步骤，按部就班进行就OK了。
这里下载可能会很慢，附上我下载好的pytorch v1.7~v1.9版本资源，可自取：Nvidia Jetson系列的arm编译的torch.whl
3. 安装
当下载好pytorch的whl文件之后，直接用在下载目录用命令安装
# 这里示例是v1.8.0版本 pip3 install numpy torch-1.8.0-cp36-cp36m-linux_aarch64.whl 这里需要注意的是，默认下载的numpy是最新版本（我的是1.19.5），最新版本的numpy会出现指令不兼容的问题，所以会导致非法指令的问题：
这样我们最好将numpy的版本降级，这样就能解决这个问题
# 本人尝试了v1.19.3版本可用 pip install numpy==1.19.3 安装好了pytorch之后，就是对应的视觉库torchvision了，我们在论坛上可以找到版本匹配表：
还是再安装对应的依赖库：
sudo apt-get install libjpeg-dev zlib1g-dev libpython3-dev libavcodec-dev libavformat-dev libswscale-dev 将github上大佬写好的torchvision库clone我们本地来
入口：torchvision
# torch1.8--torchvision0.9 git clone --branch v0.9.0 https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6b5e5504a18cb319c2b1946760e1cb17/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-26T17:16:17+08:00" />
<meta property="article:modified_time" content="2022-10-26T17:16:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NVIDIA JETSON XAVIER NX （四）安装Pytorch和torchvision</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>可选择在NX上创建新python环境进行安装，避免和其他工程环境发生冲突，具体虚拟环境操作步骤可见<a href="https://blog.csdn.net/qq_21843433/article/details/119204384">Python创建虚拟环境</a>。<br> 下面就开始安装pytorch的愉快之旅吧！<br> <strong>1. 安装相关依赖环境</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 先把能更新的都更新了</span>
sudo apt<span class="token operator">-</span>get update
sudo apt<span class="token operator">-</span>get upgrade
<span class="token comment"># 装上我们需要的环境包</span>
<span class="token comment"># 最好使用pip3，不然出错了不好排查</span>
sudo apt<span class="token operator">-</span>get install python3<span class="token operator">-</span>pip libopenblas<span class="token operator">-</span>base libopenmpi<span class="token operator">-</span>dev
pip3 install Cython
</code></pre> 
<p><strong>2. 下载pytorch</strong><br> 由于NX使用的是aarch64架构的cpu，直接官网安装是不行的，那么就得求助NVIDIA论坛了：<a href="https://forums.developer.nvidia.com/t/pytorch-for-jetson-version-1-9-0-now-available/72048" rel="nofollow">Pytorch for Jetson</a><br> 论坛中给出了详细的安装步骤，按部就班进行就OK了。<br> <img src="https://images2.imgbox.com/8a/3c/QqEfRzgU_o.png" alt="在这里插入图片描述"><br> 这里下载可能会很慢，附上我下载好的pytorch v1.7~v1.9版本资源，可自取：<a href="https://download.csdn.net/download/qq_21843433/20613313?spm=1001.2014.3001.5501">Nvidia Jetson系列的arm编译的torch.whl</a><br> <strong>3. 安装</strong><br> 当下载好pytorch的whl文件之后，直接用在下载目录用命令安装</p> 
<pre><code class="prism language-python"><span class="token comment"># 这里示例是v1.8.0版本</span>
pip3 install numpy torch<span class="token operator">-</span><span class="token number">1.8</span><span class="token number">.0</span><span class="token operator">-</span>cp36<span class="token operator">-</span>cp36m<span class="token operator">-</span>linux_aarch64<span class="token punctuation">.</span>whl
</code></pre> 
<p>这里需要注意的是，默认下载的numpy是最新版本（我的是1.19.5），最新版本的numpy会出现指令不兼容的问题，所以会导致非法指令的问题：<br> <img src="https://images2.imgbox.com/d9/4d/eXabD9tQ_o.jpg" alt="在这里插入图片描述"><br> 这样我们最好将numpy的版本降级，这样就能解决这个问题</p> 
<pre><code class="prism language-python"><span class="token comment"># 本人尝试了v1.19.3版本可用</span>
pip install numpy<span class="token operator">==</span><span class="token number">1.19</span><span class="token number">.3</span>
</code></pre> 
<p>安装好了pytorch之后，就是对应的视觉库torchvision了，我们在论坛上可以找到版本匹配表：<br> <img src="https://images2.imgbox.com/2f/f9/kkrzvpjc_o.png" alt="在这里插入图片描述"><br> 还是再安装对应的依赖库：</p> 
<pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install libjpeg<span class="token operator">-</span>dev zlib1g<span class="token operator">-</span>dev libpython3<span class="token operator">-</span>dev libavcodec<span class="token operator">-</span>dev libavformat<span class="token operator">-</span>dev libswscale<span class="token operator">-</span>dev
</code></pre> 
<p>将github上大佬写好的torchvision库clone我们本地来<br> 入口：<a href="https://github.com/pytorch/vision">torchvision</a></p> 
<pre><code class="prism language-python"><span class="token comment"># torch1.8--torchvision0.9</span>
git clone <span class="token operator">-</span><span class="token operator">-</span>branch v0<span class="token punctuation">.</span><span class="token number">9.0</span> https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>pytorch<span class="token operator">/</span>vision torchvision
<span class="token comment"># 这里由于网络不稳等问题，我使用gitee进行clone</span>
git clone <span class="token operator">-</span><span class="token operator">-</span>branch v0<span class="token punctuation">.</span><span class="token number">9.0</span> https<span class="token punctuation">:</span><span class="token operator">//</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>rchen1997<span class="token operator">/</span>torchvision torchvision
</code></pre> 
<p>下载结束后，进入torchvision文件内进行安装：</p> 
<pre><code class="prism language-python">cd torchvision
export BUILD_VERSION<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token number">0</span>  <span class="token comment"># where 0.x.0 is the torchvision version  </span>
python3 setup<span class="token punctuation">.</span>py install <span class="token operator">-</span><span class="token operator">-</span>user
cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>  <span class="token comment"># attempting to load torchvision from build dir will result in import error</span>
</code></pre> 
<p>这里可能会出现版本匹配或者不能加载 custom C++ ops的问题：<br> <img src="https://images2.imgbox.com/08/20/DAIAN7qz_o.png" alt="在这里插入图片描述"><br> 这是因为我们需要利用build中C++编译的文件，而现在这种安装方式可能会出现路径不一致的问题，所以我们需要将build下的torchvision文件拷贝到我们安装环境的库路径中，否则会出现import error。具体操作为：<br> （1）找到你python环境的所在位置，进入lib/python3.6/site-packages/中；<br> （2）进入上面安装好的torchvision/build/lib.linux-aarch64-3.6/torchvision，确认这里面是否有我们需要的ops文件夹和version.py版本信息，然后拷贝到步骤（1）中的路径即可。<br> <strong>4. 验证</strong><br> 拷贝代码进行验证：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'CUDA available: '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'cuDNN version: '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tensor a = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tensor b = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> a <span class="token operator">+</span> b
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tensor c = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>torchvision<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下就安装成功，丹炉造好了！！！<br> <img src="https://images2.imgbox.com/f9/ea/WQtMK0Vy_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/076686f828f8d4a6441b0c9374759232/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CMD 批处理文件 去后缀名_加日期</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c7130920e5942e91804ee934de200957/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">工具学习-Maven</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>