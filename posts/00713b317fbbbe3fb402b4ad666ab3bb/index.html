<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL----每天一个小函数之常用函数汇总四 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL----每天一个小函数之常用函数汇总四" />
<meta property="og:description" content="复合类型构建操作 1、Map类型构建: map 语法: map (key1, value1, key2, value2, …)
说明：根据输入的key和value对构建map类型
hive&gt; Create table iteblog as select map(‘100’,‘tom’,‘200’,‘mary’) as t from iteblog;
hive&gt; describe iteblog;
t map&lt;string ,string&gt;
hive&gt; select t from iteblog;
{“100”:“tom”,“200”:“mary”}
2、Struct类型构建: struct 语法: struct(val1, val2, val3, …)
说明：根据输入的参数构建结构体struct类型
hive&gt; create table iteblog as select struct(‘tom’,‘mary’,‘tim’) as t from iteblog;
hive&gt; describe iteblog;
t struct&lt;col1:string ,col2:string,col3:string&gt;
hive&gt; select t from iteblog;
{“col1”:“tom”,“col2”:“mary”,“col3”:“tim”}
3、array类型构建: array 语法: array(val1, val2, …)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/00713b317fbbbe3fb402b4ad666ab3bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-01T11:09:55+08:00" />
<meta property="article:modified_time" content="2021-06-01T11:09:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL----每天一个小函数之常用函数汇总四</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>复合类型构建操作</h2> 
<h3><a id="1Map_map_2"></a>1、Map类型构建: map</h3> 
<p>语法: map (key1, value1, key2, value2, …)<br> 说明：根据输入的key和value对构建map类型<br> hive&gt; Create table iteblog as select map(‘100’,‘tom’,‘200’,‘mary’) as t from iteblog;<br> hive&gt; describe iteblog;<br> t map&lt;string ,string&gt;<br> hive&gt; select t from iteblog;<br> {“100”:“tom”,“200”:“mary”}</p> 
<h3><a id="2Struct_struct_12"></a>2、Struct类型构建: struct</h3> 
<p>语法: struct(val1, val2, val3, …)<br> 说明：根据输入的参数构建结构体struct类型<br> hive&gt; create table iteblog as select struct(‘tom’,‘mary’,‘tim’) as t from iteblog;<br> hive&gt; describe iteblog;<br> t struct&lt;col1:string ,col2:string,col3:string&gt;<br> hive&gt; select t from iteblog;<br> {“col1”:“tom”,“col2”:“mary”,“col3”:“tim”}</p> 
<h3><a id="3array_array_22"></a>3、array类型构建: array</h3> 
<p>语法: array(val1, val2, …)<br> 说明：根据输入的参数构建数组array类型<br> hive&gt; create table iteblog as select array(“tom”,“mary”,“tim”) as t from iteblog;<br> hive&gt; describe iteblog;<br> t array<br> hive&gt; select t from iteblog;<br> [“tom”,“mary”,“tim”]</p> 
<h2><a id="_32"></a>复杂类型访问操作</h2> 
<h3><a id="1array_An_34"></a>1、array类型访问: A[n]</h3> 
<p>语法: A[n]<br> 操作类型: A为array类型，n为int类型<br> 说明：返回数组A中的第n个变量值。数组的起始下标为0。比如，A是个值为[‘foo’, ‘bar’]的数组类型，那么A[0]将返回’foo’,而A[1]将返回’bar’<br> hive&gt; create table iteblog as select array(“tom”,“mary”,“tim”) as t from iteblog;<br> hive&gt; select t[0],t[1],t[2] from iteblog;<br> tom mary tim</p> 
<h3><a id="2map_Mkey_43"></a>2、map类型访问: M[key]</h3> 
<p>语法: M[key]<br> 操作类型: M为map类型，key为map中的key值<br> 说明：返回map类型M中，key值为指定值的value值。比如，M是值为{‘f’ -&gt; ‘foo’, ‘b’ -&gt; ‘bar’, ‘all’ -&gt; ‘foobar’}的map类型，那么M[‘all’]将会返回’foobar’<br> hive&gt; Create table iteblog as select map(‘100’,‘tom’,‘200’,‘mary’) as t from iteblog;<br> hive&gt; select t[‘200’],t[‘100’] from iteblog;<br> mary tom</p> 
<h3><a id="3struct_Sx_52"></a>3、struct类型访问: S.x</h3> 
<p>语法: S.x<br> 操作类型: S为struct类型<br> 说明：返回结构体S中的x字段。比如，对于结构体struct foobar {int foo, int bar}，foobar.foo返回结构体中的foo字段<br> hive&gt; create table iteblog as select struct(‘tom’,‘mary’,‘tim’) as t from iteblog;<br> hive&gt; describe iteblog;<br> t struct&lt;col1:string ,col2:string,col3:string&gt;<br> hive&gt; select t.col1,t.col3 from iteblog;<br> tom tim</p> 
<h2><a id="_63"></a>复杂类型长度统计函数</h2> 
<h3><a id="1Map_sizeMapk_V_65"></a>1.Map类型长度函数: size(Map&lt;k .V&gt;)</h3> 
<p>语法: size(Map&lt;k .V&gt;)<br> 返回值: int<br> 说明: 返回map类型的长度<br> hive&gt; select size(map(‘100’,‘tom’,‘101’,‘mary’)) from iteblog;<br> 2</p> 
<h3><a id="2array_sizeArrayT_73"></a>2.array类型长度函数: size(Array)</h3> 
<p>语法: size(Array)<br> 返回值: int<br> 说明: 返回array类型的长度<br> hive&gt; select size(array(‘100’,‘101’,‘102’,‘103’)) from iteblog;<br> 4</p> 
<h3><a id="3_81"></a>3.类型转换函数</h3> 
<p>类型转换函数: cast<br> 语法: cast(expr as )<br> 返回值: Expected “=” to follow “type”<br> 说明: 返回转换后的数据类型<br> hive&gt; select cast(1 as bigint) from iteblog;<br> 1</p> 
<h2><a id="_91"></a>窗口函数</h2> 
<h3><a id="1_Row_NumberRankDense_Rank_93"></a>1. Row_Number,Rank，Dense_Rank</h3> 
<pre><code>这三个窗口函数的使用场景非常多 
</code></pre> 
<p>row_number():从1开始，按照顺序，生成分组内记录的序列,row_number()的值不会存在重复,当排序的值相同时,按照表中记录的顺序进行排列;通常用于获取分组内排序第一的记录;获取一个session中的第一条refer等。<br> rank()：生成数据项在分组中的排名，排名相等会在名次中留下空位。<br> dense_rank():生成数据项在分组中的排名，排名相等会在名次中不会留下空位。</p> 
<p>示例：数据准备<br> select * from dcx1234;<br> <img src="https://images2.imgbox.com/36/1f/9CO2fYRc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2SUMAVGMINMAX_105"></a>2.SUM、AVG、MIN、MAX</h3> 
<p>首先理解下什么是WINDOW子句</p> 
<p>PRECEDING：往前<br> FOLLOWING：往后<br> CURRENT ROW：当前行<br> UNBOUNDED：起点，UNBOUNDED PRECEDING 表示从前面的起点， UNBOUNDED FOLLOWING：表示到后面的终点<br> <img src="https://images2.imgbox.com/a5/ef/o7gtk2WQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3NTILE_118"></a>3.NTILE</h3> 
<p>NTILE(n) 用于将分组数据按照顺序切分成n片，返回当前切片值，如果切片不均匀，默认增加第一个切片的分布。NTILE不支持ROWS BETWEEN</p> 
<p>使用场景：<br> 1.如一年中，统计出工资前1/5之的人员的名单，使用NTILE分析函数,把所有工资分为5份，为1的哪一份就是我们想要的结果.<br> 2.sale前20%或者50%的用户ID<br> <img src="https://images2.imgbox.com/09/02/7fgiUVOa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4LEADLAGFIRST_VALUELAST_VALUE_128"></a>4.LEAD,LAG,FIRST_VALUE,LAST_VALUE</h3> 
<p>lag与lead函数可以返回上下行的数据</p> 
<p>LEAD(col,n,DEFAULT) 用于统计窗口内往下第n行值<br> 第一个参数为列名，第二个参数为往下第n行（可选，默认为1），第三个参数为默认值（当往下第n行为NULL时候，取默认值，如不指定，则为NULL）<br> <img src="https://images2.imgbox.com/84/10/1NnuBFrm_o.png" alt="在这里插入图片描述"></p> 
<p>使用场景：通常用于统计某用户在某个网页上的停留时间</p> 
<p>LAG(col,n,DEFAULT) 用于统计窗口内往上第n行值<br> 第一个参数为列名，第二个参数为往上第n行（可选，默认为1），第三个参数为默认值（当往上第n行为NULL时候，取默认值，如不指定，则为NULL）</p> 
<p><img src="https://images2.imgbox.com/e5/0b/zfEdsnDe_o.png" alt="在这里插入图片描述"></p> 
<p>FIRST_VALUE:取分组内排序后，截止到当前行，第一个值<br> LAST_VALUE:取分组内排序后，截止到当前行,最后一个值<br> <img src="https://images2.imgbox.com/64/9f/zsdLkicU_o.png" alt="在这里插入图片描述"></p> 
<p>如果不指定ORDER BY，则默认按照记录在文件中的偏移量进行排序，会出现错误的结果<br> <img src="https://images2.imgbox.com/a1/35/D4k3lsnK_o.png" alt="在这里插入图片描述"></p> 
<p>如果想要取分组内排序后最后一个值，则需要变通一下:<br> <img src="https://images2.imgbox.com/d0/3c/KL00QSWF_o.png" alt="在这里插入图片描述"></p> 
<p>提示：在使用分析函数的过程中，要特别注意ORDER BY子句，用的不恰当，统计出的结果就不是你所期望的</p> 
<h3><a id="5CUME_DISTPERCENT_RANK_158"></a>5.CUME_DIST，PERCENT_RANK</h3> 
<p>这两个序列分析函数不是很常用，这里也介绍下，他不支持window子句</p> 
<p>–CUME_DIST 小于等于当前值的行数/分组内总行数<br> –比如，统计小于等于当前薪水的人数，所占总人数的比例<br> <img src="https://images2.imgbox.com/59/b2/7FatqnTW_o.png" alt="在这里插入图片描述"></p> 
<p>PERCENT_RANK 分组内当前行的RANK值-1/分组内总行数-1</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5991715778465bb088832741796d6d5d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS开发之点击空白处退出键盘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91f427133f115679f6fcf8226ed7c800/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python pip运行错误 no such file or directory、ModuleNotFoundError</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>