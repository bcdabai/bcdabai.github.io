<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>clickhouse php,写了一个 clickhouse php tcp客户端 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="clickhouse php,写了一个 clickhouse php tcp客户端" />
<meta property="og:description" content="最近在one框架 增加对 clickhouse 数据库的支持，没有找到一个满意的客户端。去clickhouse 官方看了居然没有客户端的协议文档，但是还是挡不住我造轮子热情，根据官方c&#43;&#43;的代码连蒙带猜，写出来了。目前还有部分类型不支持，后续完善……
仓库地址
安装
composer require lizhichao/one-ck
支持类型[x] UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64
[x] Float32, Float64
[x] Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S)
[x] String
[x] FixedString(N)
[x] UUID
[x] Date
[x] Datetime
[x] Datetime64
[x] Nullable(T)
[x] IPv4
[x] IPv6
[x] Array(T)
[ ] Tuple(T)
[ ] Enum (can use LowCardinality instead)
Demouse OneCk\Client;
use OneCk\Types;
//default
//$ck = new Client(&#39;tcp://127.0.0.1:9000&#39;, &#39;default&#39;, &#39;&#39;, &#39;default&#39;);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5c351aa772b2c86bb37cfccdea19929b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-11T01:42:30+08:00" />
<meta property="article:modified_time" content="2021-03-11T01:42:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">clickhouse php,写了一个 clickhouse php tcp客户端</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>最近在one框架 增加对 clickhouse 数据库的支持，没有找到一个满意的客户端。去clickhouse 官方看了居然没有客户端的协议文档，但是还是挡不住我造轮子热情，根据官方c++的代码连蒙带猜，写出来了。目前还有部分类型不支持，后续完善……</p> 
 <p>仓库地址</p> 
 <p>安装</p> 
 <p>composer require lizhichao/one-ck</p> 
 <p>支持类型[x] UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</p> 
 <p>[x] Float32, Float64</p> 
 <p>[x] Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S)</p> 
 <p>[x] String</p> 
 <p>[x] FixedString(N)</p> 
 <p>[x] UUID</p> 
 <p>[x] Date</p> 
 <p>[x] Datetime</p> 
 <p>[x] Datetime64</p> 
 <p>[x] Nullable(T)</p> 
 <p>[x] IPv4</p> 
 <p>[x] IPv6</p> 
 <p>[x] Array(T)</p> 
 <p>[ ] Tuple(T)</p> 
 <p>[ ] Enum (can use LowCardinality instead)</p> 
 <p>Demouse OneCk\Client;</p> 
 <p>use OneCk\Types;</p> 
 <p>//default</p> 
 <p>//$ck = new Client('tcp://127.0.0.1:9000', 'default', '', 'default');</p> 
 <p>$t1 = microtime(true);</p> 
 <p>$ck = new Client('tcp://192.168.31.216:9091', 'default', '123456', 'test1');</p> 
 <p>$data['server info'] = $ck-&gt;getServerInfo();</p> 
 <p>$data['drop table'] = $ck-&gt;query('DROP TABLE IF EXISTS t6');</p> 
 <p>$table = [</p> 
 <p>'CREATE TABLE t6 (',</p> 
 <p>'`id` UInt32,',</p> 
 <p>'`f1` Int32,',</p> 
 <p>'`f2` Nullable(Int32),',</p> 
 <p>'`f3` UInt8,',</p> 
 <p>'`f4` Nullable(UInt8),',</p> 
 <p>'`f5` UInt16,',</p> 
 <p>'`f6` UInt64,',</p> 
 <p>'`f7` Int64,',</p> 
 <p>'`f8` Float32,',</p> 
 <p>'`f9` Float64,',</p> 
 <p>'`f10` Nullable(Float64),',</p> 
 <p>'`f11` Decimal32(3),',</p> 
 <p>'`f12` Decimal64(5),',</p> 
 <p>'`f13` Decimal128(7),',</p> 
 <p>'`f14` Nullable(Decimal128(7)),',</p> 
 <p>'`f15` String,',</p> 
 <p>'`f16` Nullable(String),',</p> 
 <p>'`f17` FixedString(32),',</p> 
 <p>'`f18` UUID,',</p> 
 <p>'`f19` Date,',</p> 
 <p>'`f20` Nullable(Date),',</p> 
 <p>'`f21` Datetime,',</p> 
 <p>'`f22` Datetime64(3),',</p> 
 <p>'`f23` IPv4,',</p> 
 <p>'`f24` Nullable(IPv4),',</p> 
 <p>'`f25` IPv6,',</p> 
 <p>'`f26` LowCardinality(String)',</p> 
 <p>') ENGINE = MergeTree() ORDER BY id SETTINGS index_granularity = 8192'</p> 
 <p>];</p> 
 <p>$data['create table'] = $ck-&gt;query(implode("\n", $table));</p> 
 <p>$data['insert data'] = $ck-&gt;insert('t6', [</p> 
 <p>[</p> 
 <p>'id' =&gt; 1,</p> 
 <p>'f1' =&gt; -3,</p> 
 <p>'f2' =&gt; null,</p> 
 <p>'f3' =&gt; 127,</p> 
 <p>'f4' =&gt; null,</p> 
 <p>'f5' =&gt; 3322,</p> 
 <p>'f6' =&gt; 1844674407370955161,</p> 
 <p>'f7' =&gt; 9223372036854775807,</p> 
 <p>'f8' =&gt; -2132121.5,</p> 
 <p>'f9' =&gt; 6546546544665.66658,</p> 
 <p>'f10' =&gt; null,</p> 
 <p>'f11' =&gt; 552.339,</p> 
 <p>'f12' =&gt; 3658.6954,</p> 
 <p>'f13' =&gt; '170141183460469231168730371588.4105721',</p> 
 <p>'f14' =&gt; null,</p> 
 <p>'f15' =&gt; 'emoji😀😁😂😃😄',</p> 
 <p>'f16' =&gt; null,</p> 
 <p>'f17' =&gt; md5('a'),</p> 
 <p>'f18' =&gt; '016e64be-605f-4108-8a67-495d74d7ef3c',</p> 
 <p>'f19' =&gt; '2020-09-05',</p> 
 <p>'f20' =&gt; null,</p> 
 <p>'f21' =&gt; '2020-09-05 14:25:12',</p> 
 <p>'f22' =&gt; '2020-09-05 14:25:12.258',</p> 
 <p>'f23' =&gt; '192.168.1.1',</p> 
 <p>'f24' =&gt; null,</p> 
 <p>'f25' =&gt; 'CDCD:910A:2222:5498:8475:1111:3900:2020',</p> 
 <p>'f26' =&gt; 'eee'</p> 
 <p>],</p> 
 <p>[</p> 
 <p>'id' =&gt; 2,</p> 
 <p>'f1' =&gt; 3,</p> 
 <p>'f2' =&gt; 3,</p> 
 <p>'f3' =&gt; 3,</p> 
 <p>'f4' =&gt; 3,</p> 
 <p>'f5' =&gt; 3,</p> 
 <p>'f6' =&gt; 3,</p> 
 <p>'f7' =&gt; 3,</p> 
 <p>'f8' =&gt; 3,</p> 
 <p>'f9' =&gt; 3,</p> 
 <p>'f10' =&gt; 3,</p> 
 <p>'f11' =&gt; -552.339,</p> 
 <p>'f12' =&gt; -3658.6954,</p> 
 <p>'f13' =&gt; '-170141183460469231168730371588.4105721',</p> 
 <p>'f14' =&gt; 3,</p> 
 <p>'f15' =&gt; 'aaa',</p> 
 <p>'f16' =&gt; 'aaa',</p> 
 <p>'f17' =&gt; md5('55'),</p> 
 <p>'f18' =&gt; md5('55'),</p> 
 <p>'f19' =&gt; '2020-09-06',</p> 
 <p>'f20' =&gt; '2020-09-06',</p> 
 <p>'f21' =&gt; '2020-09-06 14:25:12',</p> 
 <p>'f22' =&gt; '2020-09-06 14:25:12.258',</p> 
 <p>'f23' =&gt; '251.222.221.231',</p> 
 <p>'f24' =&gt; '192.168.1.2',</p> 
 <p>'f25' =&gt; '1030::C9B4:FF12:48AA:1A2B',</p> 
 <p>'f26' =&gt; 'eee22'</p> 
 <p>],</p> 
 <p>[</p> 
 <p>'id' =&gt; 3,</p> 
 <p>'f1' =&gt; -1,</p> 
 <p>'f2' =&gt; 3,</p> 
 <p>'f3' =&gt; 3,</p> 
 <p>'f4' =&gt; 3,</p> 
 <p>'f5' =&gt; 3,</p> 
 <p>'f6' =&gt; 3,</p> 
 <p>'f7' =&gt; 3,</p> 
 <p>'f8' =&gt; 3,</p> 
 <p>'f9' =&gt; 3,</p> 
 <p>'f10' =&gt; 3,</p> 
 <p>'f11' =&gt; 3,</p> 
 <p>'f12' =&gt; 3,</p> 
 <p>'f13' =&gt; 3,</p> 
 <p>'f14' =&gt; 3,</p> 
 <p>'f15' =&gt; 'aaa',</p> 
 <p>'f16' =&gt; 'aaa',</p> 
 <p>'f17' =&gt; md5('a'),</p> 
 <p>'f18' =&gt; '3026ee79-ac2a-46d2-882d-959a55d71025',</p> 
 <p>'f19' =&gt; '2020-09-07',</p> 
 <p>'f20' =&gt; '2020-09-07',</p> 
 <p>'f21' =&gt; '2020-09-07 14:25:12',</p> 
 <p>'f22' =&gt; '2020-09-07 14:25:12.258',</p> 
 <p>'f23' =&gt; '192.168.1.1',</p> 
 <p>'f24' =&gt; null,</p> 
 <p>'f25' =&gt; '2001:DB8:2de::e13',</p> 
 <p>'f26' =&gt; 'eee22'</p> 
 <p>]</p> 
 <p>]);</p> 
 <p>//$data['struct'] = $ck-&gt;query('desc t6');</p> 
 <p>$data['select t6'] = $ck-&gt;query('select * from t6');</p> 
 <p>$data['select t6 int64'] = $ck-&gt;query("select id,f6 from t6 where f6=1844674407370955161");</p> 
 <p>$data['select t6 Decimal32'] = $ck-&gt;query("select id,f11 from t6 where f11='552.339'");</p> 
 <p>$data['select t6 Decimal64'] = $ck-&gt;query("select id,f12 from t6 where f12='-3658.69540'");</p> 
 <p>$data['select t6 Decimal128'] = $ck-&gt;query("select id,f13 from t6 where f13='170141183460469231168730371588.4105721'");</p> 
 <p>$data['select t6 uuid'] = $ck-&gt;query("select id,f18 from t6 where f18='3026ee79-ac2a-46d2-882d-959a55d71025'");</p> 
 <p>$data['select t6 date'] = $ck-&gt;query("select id,f19 from t6 where f19='2020-09-05'");</p> 
 <p>$data['select t6 datetime'] = $ck-&gt;query("select id,f21 from t6 where f21='2020-09-07 20:25:12'");</p> 
 <p>$data['select t6 datetime64'] = $ck-&gt;query("select id,f22 from t6 where f22='2020-09-06 20:25:12.258'");</p> 
 <p>$data['select t6 ip'] = $ck-&gt;query("select id,f23,f25 from t6 where f23=" . Types::encodeIpv4('192.168.1.1'));</p> 
 <p>$data['select t6 ip64'] = $ck-&gt;query("select id,f23,f25 from t6 where f25='" . Types::encodeIpv6('1030::c9b4:ff12:48aa:1a2b') . "'");</p> 
 <p>echo json_encode($data);</p> 
 <p>// Batch write</p> 
 <p>//$data['drop table'] = $ck-&gt;query('DROP TABLE IF EXISTS t7');</p> 
 <p>//$table = [</p> 
 <p>// 'CREATE TABLE t7 (',</p> 
 <p>// '`id` UInt32,',</p> 
 <p>// '`f2` Nullable(Int32),',</p> 
 <p>// '`f5` UInt16,',</p> 
 <p>// '`f15` String',</p> 
 <p>// ') ENGINE = MergeTree() ORDER BY id SETTINGS index_granularity = 8192'</p> 
 <p>//];</p> 
 <p>//$data['create table'] = $ck-&gt;query(implode("\n", $table));</p> 
 <p>//$ck-&gt;writeStart('t7',['id','f2','f5','f15']);</p> 
 <p>//for ($i = 0; $i &lt; 100; $i++) {<!-- --></p> 
 <p>// $da = [];</p> 
 <p>// for ($j = 0; $j &lt; 1000; $j++) {<!-- --></p> 
 <p>// $da[] = [</p> 
 <p>// 'id' =&gt; mt_rand(1,1000000),</p> 
 <p>// 'f2' =&gt; mt_rand(-1000000,1000000),</p> 
 <p>// 'f5' =&gt; mt_rand(1,10000),</p> 
 <p>// 'f15' =&gt; md5(mt_rand(1,10000))</p> 
 <p>// ];</p> 
 <p>// }</p> 
 <p>// $ck-&gt;writeBlock($da);</p> 
 <p>//}</p> 
 <p>//</p> 
 <p>//$ck-&gt;writeEnd();</p> 
 <p>//</p> 
 <p>//echo microtime(true) - $t1;</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6de33a1de7e8258ba49af9ee670abf9a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">clickhouse php,php 链接 clickhouse</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f4b39dc0b7c791bc8280f00437e030b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">php源码 时间慢8小时 etc gmt,php程序时间相差8个小时的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>