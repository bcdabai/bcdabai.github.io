<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php soecket服务器搭建_php搭建swooleTCP服务器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php soecket服务器搭建_php搭建swooleTCP服务器" />
<meta property="og:description" content="这次的swoole学习，比较缓慢
也由于这些几天事比较多，晚上没去学习，swoole的笔记也一直在没编写，下面简单介绍和应用下swoole
swoole是什么？
异步、并行、高性能
纯C编写
php扩展
swoole能做什么？
异步多线程服务器及客户端
异步MySQL、Reids、数据库连接池、任务队列
http/websocket服务器/客户端
异步文件读写
Swoole2.0支持协程
Swolle 实践
swoole手册:https://wiki.swoole.com/wiki/page/1.html
服务器版本：centos7/ubuntu16
php版本：5.4&#43;
一、swoole安装(百度上有很多安装文章，也可以用宝塔直接安装)
二、简单TCP服务器创建
/**@创建TCP服务器
* 作者：生生
*/
$host = &#39;127.0.0.1&#39;;//监听对应外网的IP 0.0.0.0监听所有ip
$port = 9501;　//端口号(1024以下端口需要root权限)
$mode = SWOOLE_PROCESS;//SWOOLE_PROCESS 进程模式-多进程方式
$socke_type= SWOOLE_SOCK_TCP;//SWOOLE_SOCK_TCP 服务器类型-默认TCP
$serv = new swoole_server($host,$port); //后面2参数不写是默认
/**@
* 函数：bool $swoole_server-&gt;on(string $event,miexd $callback);
* $event
* connect:当建立链接的时候(2个默认参数：$serv-服务器信息,$fd-客户信息 /-名字随意)
* receive:当接收数据的时候(4个默认参数：$serv-同上,$fd-同上,$from_id-客户id,$data-传递数据)
* close:关闭链接
*/
//@作用：监听链接进入事件
$serv-&gt;on(&#39;connect&#39;,function($serv,$fd){
echo &#39;链接成功&#39;;
});
//@作用：监听数据接收事件
$serv-&gt;on(&#39;receive&#39;,function($serv,$fd,$from_id,$data){
var_dump($fd.&#39;--&#39;.$data);
/**@
* 函数：bool Server-&gt;send(mixed $fd, string $data, int $serverSocket = -1);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1f00592bc02a3d86f3d6a687f4f62942/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-21T04:22:29+08:00" />
<meta property="article:modified_time" content="2020-12-21T04:22:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php soecket服务器搭建_php搭建swooleTCP服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>这次的swoole学习，比较缓慢</p> 
 <p>也由于这些几天事比较多，晚上没去学习，swoole的笔记也一直在没编写，下面简单介绍和应用下swoole</p> 
 <p>swoole是什么？</p> 
 <p>异步、并行、高性能</p> 
 <p>纯C编写</p> 
 <p>php扩展</p> 
 <p>swoole能做什么？</p> 
 <p>异步多线程服务器及客户端</p> 
 <p>异步MySQL、Reids、数据库连接池、任务队列</p> 
 <p>http/websocket服务器/客户端</p> 
 <p>异步文件读写</p> 
 <p>Swoole2.0支持协程</p> 
 <p>Swolle 实践</p> 
 <p>swoole手册:https://wiki.swoole.com/wiki/page/1.html</p> 
 <p>服务器版本：centos7/ubuntu16</p> 
 <p>php版本：5.4+</p> 
 <p>一、swoole安装(百度上有很多安装文章，也可以用宝塔直接安装)</p> 
 <p>二、简单TCP服务器创建</p> 
 <p>/**@创建TCP服务器</p> 
 <p>* 作者：生生</p> 
 <p>*/</p> 
 <p>$host = '127.0.0.1';//监听对应外网的IP 0.0.0.0监听所有ip</p> 
 <p>$port = 9501;　　//端口号(1024以下端口需要root权限)</p> 
 <p>$mode = SWOOLE_PROCESS;//SWOOLE_PROCESS 进程模式-多进程方式</p> 
 <p>$socke_type= SWOOLE_SOCK_TCP;//SWOOLE_SOCK_TCP 服务器类型-默认TCP</p> 
 <p>$serv = new swoole_server($host,$port); //后面2参数不写是默认</p> 
 <p>/**@</p> 
 <p>* 函数：bool $swoole_server-&gt;on(string $event,miexd $callback);</p> 
 <p>* $event</p> 
 <p>* connect:当建立链接的时候(2个默认参数：$serv-服务器信息,$fd-客户信息 /-名字随意)</p> 
 <p>* receive:当接收数据的时候(4个默认参数：$serv-同上,$fd-同上,$from_id-客户id,$data-传递数据)</p> 
 <p>* close:关闭链接</p> 
 <p>*/</p> 
 <p>//@作用：监听链接进入事件</p> 
 <p>$serv-&gt;on('connect',function($serv,$fd){<!-- --></p> 
 <p>echo '链接成功';</p> 
 <p>});</p> 
 <p>//@作用：监听数据接收事件</p> 
 <p>$serv-&gt;on('receive',function($serv,$fd,$from_id,$data){<!-- --></p> 
 <p>var_dump($fd.'--'.$data);</p> 
 <p>/**@</p> 
 <p>* 函数：bool Server-&gt;send(mixed $fd, string $data, int $serverSocket = -1);</p> 
 <p>* 作用：向客户端发送数据</p> 
 <p>* 参数：</p> 
 <p>* $fd，客户端的文件描述符</p> 
 <p>*$data，发送的数据，TCP协议最大不得超过2M，可修改 buffer_output_size 改变允许发送的最大包长度</p> 
 <p>*$serverSocket，向Unix Socket DGRAM对端发送数据时需要此项参数，TCP客户端不需要填写</p> 
 <p>*/</p> 
 <p>$serv-&gt;send($fd,"数据：".$data);</p> 
 <p>});</p> 
 <p>//@作用：监听链接关闭事件</p> 
 <p>$serv-&gt;on('close',function($ser,$fd){<!-- --></p> 
 <p>echo '关闭链接';</p> 
 <p>});</p> 
 <p>//启动服务</p> 
 <p>$serv-&gt;start();</p> 
 <p>三、运行上面php文件</p> 
 <p>1、浏览器直接访问会提示：Fatal error: Swoole\Server::__construct(): swoole_server only can be used in PHP CLI mode. in /www/jzj/public/aa.php on line 7</p> 
 <p>这个文件需要用php CLI模式(php命令行模式运行： php -f 运行文件名.php)</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>2、如果命令行运行的时候出现这个错误说明，端口被占用，</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>查看被占用的端口PID：sudo lsof -i:9501</p> 
 <p>kill掉进程：sudo kill -9 PID(在运行php -f 运行文件名.php)</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>四、创建TCP同步客户端(TP5举例)</p> 
 <p>namespace app\admin\controller;</p> 
 <p>use think\Controller;</p> 
 <p>use think\Db;</p> 
 <p>use Redis;</p> 
 <p>use swoole_client;</p> 
 <p>class Index extends controller</p> 
 <p>{<!-- --></p> 
 <p>//客户端swoole</p> 
 <p>public function swoole()</p> 
 <p>{<!-- --></p> 
 <p>$client = new swoole_client(SWOOLE_SOCK_TCP);</p> 
 <p>//连接到服务器</p> 
 <p>if (!$client-&gt;connect('127.0.0.1', 9501, 0.5))</p> 
 <p>{<!-- --></p> 
 <p>die("connect failed.");</p> 
 <p>}</p> 
 <p>//向服务器发送数据</p> 
 <p>if (!$client-&gt;send("hello world"))</p> 
 <p>{<!-- --></p> 
 <p>echo '发送失败';</p> 
 <p>}</p> 
 <p>//从服务器接收数据</p> 
 <p>$data = $client-&gt;recv();</p> 
 <p>if (!$data)</p> 
 <p>{<!-- --></p> 
 <p>die("recv failed.");</p> 
 <p>}</p> 
 <p>echo $data;</p> 
 <p>//关闭连接</p> 
 <p>$client-&gt;close();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>注意客户端服务器在框架中要引入</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>把这个文件上传到服务器项目中，浏览器访问这个后如果报错如下：是因为服务端没有send发送数据出来问题</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>服务端会出现send为空，要注意很可能是$serv-&gt;on中的第一个参数不对，</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>如图：这个参数一定要是对应的new的对象</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>在重新运行文件：命令行会出现这个，</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这样就完成了简单的tcp服务器与同步tcp客户端的搭建，当tcp服务器文件运行完成后删除也不影响(建议保留)</p> 
 <p>简单流程是：编写TCP服务器文件-&gt;运行服务器文件-&gt;TCP服务器创建成功-&gt;创建TCP客户端文件-&gt;运行与服务端(向服务端发送数据并接受服务端返回信息)</p> 
 <p>当然这篇只是简单的搭建与了解swoole，后续还会更新简单的swoole的php异步操作与实时聊天功能</p> 
 <p>本人也是新手，swoole是很强大的扩展，里面包含很多知识我也在学习中</p> 
 <p>想要探讨swoole或者其他问题可以关注博客园：传说中的生生或+Q：876036823一起交流</p> 
 <p>-----生生的笔记</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dad82cf911d7129c2a28fcdd46b04532/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dsp31段最佳调音图_31段均衡器调音</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbe2a2858473b47ffde3ffd205235ab6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">自己建服务器 语音盒子_如何自己搭建一个服务器？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>