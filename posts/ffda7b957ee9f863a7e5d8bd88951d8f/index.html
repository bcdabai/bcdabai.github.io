<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue项目打包后---在nodejs环境中应用并代理跨域 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue项目打包后---在nodejs环境中应用并代理跨域" />
<meta property="og:description" content="Vue项目打包后—在nodejs环境中应用并代理跨域 使用koa框架部署项目 一、建立web服务文件夹 crmServer $ mkdir hrServer #建立crmServer文件夹 二、在该文件夹下，初始化npm $ npm init -y 三、安装服务端框架koa(也可以采用express或者egg) $ npm i koa koa-static 四、新建public文件夹，copy打包后的dist目录下的文件到hrServer/public下 五、在根目录下创建app.js app.js
const Koa = require(&#39;koa&#39;) const serve = require(&#39;koa-static&#39;); const app = new Koa(); app.use(serve(__dirname &#43; &#34;/public&#34;)); //将public下的代码静态化 app.listen(3333, () =&gt; { console.log(&#39;CRM项目启动&#39;) }) 此时，我们可以访问，http://localhost:3333
此时页面可以出来了
补充 更改路由模式为 history模式，设置基地址 // src/router/index.js 在路由实例中添加 mode: &#39;history&#39;, base: &#39;/admin/&#39;, // 配置项目的基础地址 解决history页面访问问题 安装 koa中间件 $ npm i koa2-connect-history-api-fallback 注册中间件 const Koa = require(&#39;koa&#39;) const serve = require(&#39;koa-static&#39;); const { historyApiFallback } = require(&#39;koa2-connect-history-api-fallback&#39;); const path = require(&#39;path&#39;) const app = new Koa(); // 这句话 的意思是除接口之外所有的请求都发送给了 index." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ffda7b957ee9f863a7e5d8bd88951d8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-07T17:36:51+08:00" />
<meta property="article:modified_time" content="2022-08-07T17:36:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue项目打包后---在nodejs环境中应用并代理跨域</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Vuenodejs_0"></a>Vue项目打包后—在nodejs环境中应用并代理跨域</h2> 
<h4><a id="koa_2"></a>使用koa框架部署项目</h4> 
<h5><a id="web_crmServer_4"></a>一、建立web服务文件夹 crmServer</h5> 
<pre><code class="prism language-js">$ mkdir hrServer #建立crmServer文件夹 
</code></pre> 
<h5><a id="npm_10"></a>二、在该文件夹下，初始化npm</h5> 
<pre><code class="prism language-js">$ npm init <span class="token operator">-</span>y
</code></pre> 
<h5><a id="koaexpressegg_16"></a>三、安装服务端框架koa(也可以采用express或者egg)</h5> 
<pre><code class="prism language-js">$ npm i koa koa<span class="token operator">-</span><span class="token keyword">static</span>
</code></pre> 
<h5><a id="publiccopydisthrServerpublic_22"></a>四、新建public文件夹，copy打包后的dist目录下的文件到<code>hrServer/public</code>下</h5> 
<h5><a id="appjs_24"></a>五、在根目录下创建app.js</h5> 
<p><code>app.js</code></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> Koa  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">"/public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将public下的代码静态化</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3333</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CRM项目启动'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>此时，我们可以访问，<a href="http://localhost:3333/" rel="nofollow">http://localhost:3333</a></p> 
</blockquote> 
<p>此时页面可以出来了</p> 
<h3><a id="_45"></a>补充</h3> 
<h4><a id="_history_47"></a>更改路由模式为 <code>history</code>模式，设置基地址</h4> 
<pre><code class="prism language-js"><span class="token comment">// src/router/index.js</span>
在路由实例中添加
<span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
<span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token string">'/admin/'</span><span class="token punctuation">,</span> <span class="token comment">// 配置项目的基础地址</span>
</code></pre> 
<h4><a id="history_58"></a>解决history页面访问问题</h4> 
<h5><a id="_koa_60"></a>安装 koa中间件</h5> 
<pre><code class="prism language-js">$ npm i koa2<span class="token operator">-</span>connect<span class="token operator">-</span>history<span class="token operator">-</span>api<span class="token operator">-</span>fallback
</code></pre> 
<h5><a id="_66"></a>注册中间件</h5> 
<pre><code class="prism language-js"><span class="token keyword">const</span> Koa  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span>  <span class="token punctuation">{<!-- --></span> historyApiFallback <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-connect-history-api-fallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这句话 的意思是除接口之外所有的请求都发送给了 index.html</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">historyApiFallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 这里的whiteList是 白名单的意思</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">"/public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将public下的代码静态化</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3333</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人资项目启动'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_83"></a>解决生产环境跨域问题</h4> 
<h5><a id="nodejs_85"></a>在nodejs中代理</h5> 
<h6><a id="_87"></a>安装跨域代理中间件</h6> 
<pre><code class="prism language-js">$ npm i koa2<span class="token operator">-</span>proxy<span class="token operator">-</span>middleware
</code></pre> 
<h6><a id="_93"></a>配置跨越代理</h6> 
<pre><code class="prism language-js"><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-proxy-middleware'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// (.*) means anything</span>
    <span class="token string-property property">'/prod-api/(.*)'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'项目服务器地址'</span><span class="token punctuation">,</span> <span class="token comment">//后端服务器地址</span>
        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>     
            <span class="token string-property property">'/prod-api'</span><span class="token operator">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>注意：这里之所以用了<strong>pathRewrite</strong>，是因为生产环境的请求基础地址是 <strong>/prod-api</strong>，需要将该地址去掉</p> 
<p><strong>That is All !</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a934085cc1ce53fcce8395be3eff9320/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested by server；</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1590ffa7891911a9e181590f441570c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx 用syslog传输error.log到远程服务器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>