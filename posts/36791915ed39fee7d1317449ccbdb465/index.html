<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小白入门：如何在docker中运行python程序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小白入门：如何在docker中运行python程序" />
<meta property="og:description" content="目录
摘要：
1，编写Dockerfile制作镜像
2，使用镜像创建容器
3，交互式运行容器/镜像修改
3.1 编辑
3.2保存
4，将镜像上传至DockerHub
5，从DockerHub拉取镜像
摘要： 本文仅涉及docker的基础使用。主要介绍如何在docker容器内运行python程序，以及一些相关问题及解决方法，例如：如何让容器启动后自动运行程序？如何二次修改镜像，如何进行文件挂载？如何将镜像上传至dockerhub？...... 本文涉及到与DockerHub/DockerDesktop相关的一些操作需要搭梯子。。。
1，编写Dockerfile制作镜像 为了在docker容器中运行python程序，首先要编写Dockerfile.txt文件，并以此来制作镜像。一般的我们将Dockerfile文件放置在python项目根目录下，如下图所示：
一个简单的Dockerfile文件内容是这样的：
FROM python:3.7-slim WORKDIR /work COPY . /work RUN pip install --no-cache-dir -r requirements.txt # 如果不能自动运行请尝试加上：RUN chmod &#43;x main.py CMD [&#34;python&#34;, &#34;main.py&#34;] 第一行表示使用python:3.7-slim为基础镜像（可以在dockerhub中找到，dockerhub是一个存放镜像的云仓库，类似于github）。
第二行表示在docker容器根目录下创建一个名为work的工作目录。
第三行表示将本机当前目录下的内容复制到容器工作目录。
第四行使得创建容器时自动安装项目依赖，本例中我们安装numpy。
第五行使得容器启动后自动运行main.py。另外如果加了这句指令仍不能自动运行，请尝试加上我注释的代码RUN chmod &#43;x main.py授予权限。
编写好Dockerfile后开始制作镜像。首先运行DockerDesktop程序（请事先安装），之后在终端打开项目文件。
可以看到python项目内容以及我们编写的Dockerfile正在此目录内。使用如下指令构建镜像：
docker build -t &lt;镜像名称&gt; . -f Dockerfile.txt 可以使用docker images指令查看存在镜像的信息，可以看到我们新创建的镜像
2，使用镜像创建容器 如果需要进行数据卷挂载，需在这里进行。通俗的讲，数据卷挂载就是将容器中的一个文件(夹)和本机中的一个文件(夹)关联起来。例如容器中有一个文件夹A，本机中有一个文件夹B。那么B中内容同步在A中，容器内可见；容器中对A文件夹的内容进行修改也会同步在B文件夹，在本机可见。我们以挂载两个文件夹(input,output)分别用作程序输入输出为例。
使用如下指令构建容器（方括号指令可选）
docker run [--rm] [--name &lt;容器名称&gt;] [-v &lt;本机文件夹路径&gt;:&lt;容器文件夹路径&gt;] &lt;镜像名称&gt; --rm 使得容器为一次性容器，程序运行结束后容器退出并销毁。如果需要容器后仍存在，请删除。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/36791915ed39fee7d1317449ccbdb465/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-28T20:49:23+08:00" />
<meta property="article:modified_time" content="2023-07-28T20:49:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小白入门：如何在docker中运行python程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E6%91%98%E8%A6%81%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E6%91%98%E8%A6%81%EF%BC%9A" rel="nofollow">摘要：</a></p> 
<p id="1%EF%BC%8C%E7%BC%96%E5%86%99Dockerfile%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F-toc" style="margin-left:0px;"><a href="#1%EF%BC%8C%E7%BC%96%E5%86%99Dockerfile%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F" rel="nofollow">1，编写Dockerfile制作镜像</a></p> 
<p id="%C2%A02%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8-toc" style="margin-left:0px;"><a href="#%C2%A02%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8" rel="nofollow"> 2，使用镜像创建容器</a></p> 
<p id="3%EF%BC%8C%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%2F%E9%95%9C%E5%83%8F%E4%BF%AE%E6%94%B9-toc" style="margin-left:0px;"><a href="#3%EF%BC%8C%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%2F%E9%95%9C%E5%83%8F%E4%BF%AE%E6%94%B9" rel="nofollow">3，交互式运行容器/镜像修改</a></p> 
<p id="3.1%20%E7%BC%96%E8%BE%91-toc" style="margin-left:40px;"><a href="#3.1%20%E7%BC%96%E8%BE%91" rel="nofollow">3.1 编辑</a></p> 
<p id="3.2%E4%BF%9D%E5%AD%98-toc" style="margin-left:40px;"><a href="#3.2%E4%BF%9D%E5%AD%98" rel="nofollow">3.2保存</a></p> 
<p id="4%EF%BC%8C%E5%B0%86%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E8%87%B3DockerHub-toc" style="margin-left:0px;"><a href="#4%EF%BC%8C%E5%B0%86%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E8%87%B3DockerHub" rel="nofollow">4，将镜像上传至DockerHub</a></p> 
<p id="%C2%A05%EF%BC%8C%E4%BB%8EDockerHub%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F-toc" style="margin-left:0px;"><a href="#%C2%A05%EF%BC%8C%E4%BB%8EDockerHub%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F" rel="nofollow"> 5，从DockerHub拉取镜像</a></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E6%91%98%E8%A6%81%EF%BC%9A">摘要：</h2> 
<p>       本文仅涉及docker的基础使用。主要介绍如何在docker容器内运行python程序，以及一些相关问题及解决方法，例如：如何让容器启动后自动运行程序？如何二次修改镜像，如何进行文件挂载？如何将镜像上传至dockerhub？......        </p> 
<p>      <strong>本文涉及到与DockerHub/DockerDesktop相关的一些操作需要搭梯子。。。</strong></p> 
<h2 id="1%EF%BC%8C%E7%BC%96%E5%86%99Dockerfile%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F">1，编写Dockerfile制作镜像</h2> 
<p>       为了在docker容器中运行python程序，首先要编写Dockerfile.txt文件，并以此来制作镜像。一般的我们将Dockerfile文件放置在python项目根目录下，如下图所示：</p> 
<p><img alt="" height="296" src="https://images2.imgbox.com/fe/8a/NJ9f3mZq_o.png" width="507"></p> 
<p>一个简单的Dockerfile文件内容是这样的：</p> 
<pre><code>FROM python:3.7-slim

WORKDIR /work

COPY . /work

RUN pip install --no-cache-dir -r requirements.txt

# 如果不能自动运行请尝试加上：RUN chmod +x main.py

CMD ["python", "main.py"]
</code></pre> 
<p><strong>第一行</strong>表示使用python:3.7-slim为基础镜像（可以在dockerhub中找到，dockerhub是一个存放镜像的云仓库，类似于github）。</p> 
<p><strong>第二行</strong>表示在docker容器根目录下创建一个名为work的工作目录。</p> 
<p><strong>第三行</strong>表示将本机当前目录下的内容复制到容器工作目录。</p> 
<p><strong>第四行</strong>使得创建容器时自动安装项目依赖，本例中我们安装numpy。</p> 
<p>                             <img alt="" height="169" src="https://images2.imgbox.com/55/d5/anMNzeOA_o.png" width="371"></p> 
<p><strong>第五行</strong>使得容器启动后自动运行main.py。另外如果加了这句指令仍不能自动运行，请尝试加上我注释的代码<strong>RUN chmod +x main.py</strong>授予权限。</p> 
<p>       编写好Dockerfile后开始制作镜像。<strong><span style="color:#0d0016;">首先运行DockerDesktop程序</span></strong>（请事先安装），之后在终端打开项目文件。</p> 
<p><img alt="" height="340" src="https://images2.imgbox.com/61/3a/rDsimalN_o.png" width="834"></p> 
<p> 可以看到python项目内容以及我们编写的Dockerfile正在此目录内。使用如下指令构建镜像：</p> 
<pre><code>docker build -t &lt;镜像名称&gt; . -f Dockerfile.txt</code></pre> 
<p><img alt="" height="511" src="https://images2.imgbox.com/c9/f5/Bea9L4g0_o.png" width="1200"></p> 
<p>可以使用docker images指令查看存在镜像的信息，可以看到我们新创建的镜像</p> 
<p><img alt="" height="79" src="https://images2.imgbox.com/17/7b/hRkQEnnm_o.png" width="774"></p> 
<h2 id="%C2%A02%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"> 2，使用镜像创建容器</h2> 
<p>        如果需要进行数据卷挂载，需在这里进行。通俗的讲，数据卷挂载就是将容器中的一个文件(夹)和本机中的一个文件(夹)关联起来。例如容器中有一个文件夹A，本机中有一个文件夹B。那么B中内容同步在A中，容器内可见；容器中对A文件夹的内容进行修改也会同步在B文件夹，在本机可见。我们以挂载两个文件夹(input,output)分别用作程序输入输出为例。</p> 
<p>使用如下指令构建容器（方括号指令可选）</p> 
<pre><code class="language-python">docker run [--rm] [--name &lt;容器名称&gt;] [-v &lt;本机文件夹路径&gt;:&lt;容器文件夹路径&gt;] &lt;镜像名称&gt;</code></pre> 
<p><strong>--rm</strong> 使得容器为一次性容器，程序运行结束后容器退出并销毁。如果需要容器后仍存在，请删除。</p> 
<p><strong>--name</strong> &lt;容器名称&gt; 是给容器命名，不添加系统会自动生成名称。</p> 
<p><strong>-v</strong> 进行数据卷挂载</p> 
<p>当然还有很多其他的参数可选，如有需要请查阅官方文档。</p> 
<p>容器启动后自动运行main.py，相应的本机挂载的文件夹中出现输出结果。</p> 
<pre><code class="language-python">#main.py内容
import os
import numpy as np
print('hello docker')
print(np.zeros((3,3)))
files=os.listdir('/input')
with open('/output/temp.txt','w',encoding='utf-8') as f:
    for i in files:
        f.writelines([i+'\n'])</code></pre> 
<p><img alt="" height="166" src="https://images2.imgbox.com/8d/a5/zUmof4m6_o.png" width="1200"></p> 
<p><img alt="" height="228" src="https://images2.imgbox.com/90/36/kzZr6co9_o.png" width="602"></p> 
<p>       可以看到容器启动后确实自动运行了main.py脚本。由于使用了--rm，所以程序运行结束后容器退出并销毁！</p> 
<h2 id="3%EF%BC%8C%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%2F%E9%95%9C%E5%83%8F%E4%BF%AE%E6%94%B9">3，交互式运行容器/镜像修改</h2> 
<p>       如果需要修改一个已有镜像，需要用该镜像创建一个容器并在该容器中进行修改，最后将该容器保存为一个新镜像。</p> 
<h3 id="3.1%20%E7%BC%96%E8%BE%91">3.1 编辑</h3> 
<p>用如下指令交互式启动容器(启动容器运行bash终端)：</p> 
<pre><code class="language-python">docker run -it &lt;镜像名称&gt; /bin/bash</code></pre> 
<p><img alt="" height="72" src="https://images2.imgbox.com/06/8e/w5PRXCx6_o.png" width="931"></p> 
<p><span style="color:#fe2c24;">注意，这里一定不能使用--rm，因为我们需要使用该容器创建新镜像。</span></p> 
<p>       启动容器并进入bash终端后的过程就像是操作Linux命令行（docker容器就像是丐版Linux）。初始位于我们创建的工作目录下。</p> 
<p>可以退到根目录看到整个文件系统全貌，其中就有我们创建的work工作目录。</p> 
<p><img alt="" height="130" src="https://images2.imgbox.com/6d/31/X1IsTIgj_o.png" width="780"></p> 
<p>如果需要查看/修改某一文件我们需要借助<strong>nano工具</strong>，用如下指令下载(也可使用apt-get)：</p> 
<pre><code class="language-python">apt update       #更新软件源
apt install nano #安装</code></pre> 
<p>例如我想要查看main.py，那么进入所在目录后使用<strong>nano main.py</strong>即可。</p> 
<p><img alt="" height="776" src="https://images2.imgbox.com/7f/72/GCl7t697_o.png" width="1200"></p> 
<p>在如上界面可进行文件内容的编辑。</p> 
<p>在容器中可以使用Linux指令进行各种操作，包括下载其他三方包，编辑文件(如上)等。</p> 
<p>       哦对了，有时可能需要上传新文件(夹)至容器，这需要在容器外操作。先使用<strong>exit</strong>退出容器，然后使用如下指令复制文件(夹)到容器内。</p> 
<pre><code class="language-python">docker cp &lt;需上传的文件本机路径&gt; &lt;容器ID/容器名&gt;:&lt;文件上传位置(容器中路径)&gt;</code></pre> 
<p><img alt="" height="243" src="https://images2.imgbox.com/ad/82/YKihR6rp_o.png" width="1200"></p> 
<p><span style="color:#4da8ee;">       哦，补充一下，这里的路径格式和前面的不太一样，前面是Linux格式的，无所谓啦，直接复制文件路径粘贴即可。我之前好像是用Windows格式遇到过错才改为Linux格式，不过这次试又好了。。。</span></p> 
<p>       其中容器ID或容器名可通过<strong>docker ps -a(查看所有容器)</strong>查看，或借助DockerDesktop提供的图形界面。上图中的<strong>docker start gracious_antonelli</strong>重新启动了容器，gracious_antonelli是容器名，<strong>docker exec -it gracious_antonelli</strong>交互式进入容器。</p> 
<h3 id="3.2%E4%BF%9D%E5%AD%98">3.2保存</h3> 
<p>在容器中修改好镜像后使用<strong>exit</strong>退出容器，使用如下指令将该容器保存为一个新镜像：</p> 
<pre><code class="language-python">docker commit &lt;容器名&gt; &lt;新镜像名&gt;</code></pre> 
<p>       使用新镜像启动容器发现程序不能自动运行了！这是因为前面交互式启动容器时设置成了容器启动后运行bash终端。我是这样解决的：<strong>以该镜像为基础镜像创建新镜像</strong>(编写新dockerfile并创建镜像)。</p> 
<pre><code class="language-XML">FROM docker_test
CMD ["python", "main.py"]</code></pre> 
<pre><code class="language-python"> docker build -t &lt;新镜像名&gt; . -f &lt;Dockerfile.txt本机地址&gt;</code></pre> 
<h2 id="4%EF%BC%8C%E5%B0%86%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E8%87%B3DockerHub">4，将镜像上传至DockerHub</h2> 
<p>首先要在DockerHub创建一个仓库：</p> 
<p><img alt="" height="925" src="https://images2.imgbox.com/4c/56/OJh1VZa7_o.png" width="1200"></p> 
<p> <img alt="" height="671" src="https://images2.imgbox.com/96/21/i2lpqlcK_o.png" width="1107"></p> 
<p> <img alt="" height="786" src="https://images2.imgbox.com/3e/97/5FdF87Lg_o.png" width="1200"></p> 
<p>之后使用如下指令上传镜像，<span style="color:#fe2c24;">请确保你的DockerDesktop处于登录状态：</span></p> 
<pre><code class="language-python">docker tag &lt;待上传镜像名&gt; &lt;DockerHub仓库名&gt;:&lt;tag版本名&gt;
docker push &lt;DockerHub仓库名&gt;:&lt;tag版本名&gt;</code></pre> 
<p><img alt="" height="366" src="https://images2.imgbox.com/84/89/NoiZ9nVg_o.png" width="1162"></p> 
<p><img alt="" height="614" src="https://images2.imgbox.com/a6/0d/8rGxdf53_o.png" width="1057"></p> 
<h2 id="%C2%A05%EF%BC%8C%E4%BB%8EDockerHub%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"> 5，从DockerHub拉取镜像</h2> 
<p> 使用如下指令拉取镜像：</p> 
<pre><code class="language-python">docker pull &lt;DockerHub仓库名&gt;:&lt;tag版本名&gt;</code></pre> 
<p><img alt="" height="437" src="https://images2.imgbox.com/30/35/oSdvOFZ7_o.png" width="1200"></p> 
<p><img alt="" height="95" src="https://images2.imgbox.com/17/2f/tgqsoWHK_o.png" width="790"></p> 
<p>可以按此方法拉取DockerHub上公开的其他镜像进行使用。</p> 
<h2></h2> 
<p>      <strong> Docker功能非常丰富，还有很多高级用法，本文只介绍了最最最基础的一部分，更深入的学习请参考官方文档。</strong></p> 
<p></p> 
<p><strong>最后啰嗦一嘴，小心你的C盘，哈哈哈。。。</strong></p> 
<p><strong> </strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1185c99bb9d65c9f3360022dae4fe53b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AUTOSAR Eth模块 以太网配置开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/054a59025fbefc446f347b6b2cfaef2d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">开发板 在虚拟机中 通过 wifi 联网</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>