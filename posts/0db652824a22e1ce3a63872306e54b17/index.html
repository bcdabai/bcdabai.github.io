<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ClickHouse之常见的时间周期函数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ClickHouse之常见的时间周期函数" />
<meta property="og:description" content="文章目录 前言时区相关timeZonetoTimeZonetimeZoneOf 年相关toYeartoStartOfYeartoStartOfISOYeartoRelativeYearNumtoISOYear 季度相关toQuartertoStartOfQuartertoRelativeQuarterNum 月相关toMonthtoStartOfMonthtoRelativeMonthNum 周相关toMondaytoStartOfWeek(t[,mode])toISOWeektoRelativeWeekNumtoWeek(date[,mode])toYearWeek(date[,mode]) 日相关toDayOfYeartoDayOfMonthtoDayOfWeektoRelativeDayNum 时分秒相关toHourtoMinutetoSecondtoUnixTimestamptoStartOfDaytoStartOfHourtoStartOfMinutetoStartOfSecondtoStartOfFiveMinutetoStartOfTenMinutestoStartOfFifteenMinutestoStartOfInterval(time_or_data,间隔x单位[,time_zone])toTimetoRelativeHourNumtoRelativeMinuteNumtoRelativeSecondNum 时间计算相关date_truncdate_adddate_diffdate_subtimestamp_addtimestamp_subadd**subtract**timeSlots(StartTime, Duration,[, Size]) 当前时间相关now 转日期格式相关todayyesterdaytimeSlottoYYYYMMtoYYYYMMDDtoYYYYMMDDhhmmssformatDateTimedateNameFROM_UNIXTIMEtoModifiedJulianDaytoModifiedJulianDayOrNullfromModifiedJulianDayfromModifiedJulianDayOrNull 前言 在工作中，如果使用了ClickHouse作为数据的存储的话，那么难免会遇到关于时间的转换问题
比如：字符串转时间，日期等特定格式。
时区相关 timeZone 返回服务器的时区。 如果它在分布式表的上下文中执行，那么它会生成一个普通列，其中包含与每个分片相关的值。否则它会产生一个常数值。
语法
timeZone() 返回时区，类型为： String。
toTimeZone 将Date或DateTime转换为指定的时区。 时区是Date/DateTime类型的属性。 表字段或结果集的列的内部值（秒数）不会更改，列的类型会更改，并且其字符串表示形式也会相应更改。
语法
toTimezone(value, timezone) 参数
value — 时间或日期和时间。类型为DateTime64。timezone — 返回值的时区。类型为 String。 这个参数是一个常量，因为 toTimezone 改变了列的时区（时区是 DateTime 类型的属性）。 返回类型为DateTime的日期和时间。
示例：
select now() as current_time, toTimezone(toDateTime(now()), &#39;Asia/Yekaterinburg&#39;) as timezone_datetime, toTypeName(toDateTime(now())) as type_name; current_time timezone_datetime type_name 2023-04-19 11:08:17 2023-04-19T08:08:17&#43;05:00 DateTime timeZoneOf 返回DateTime或者DateTime64数据类型的时区名称。
语法
timeZoneOf(value) 参数
value — 日期和时间。类型为DateTime或者DateTime64。 返回类型为String时区名称。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0db652824a22e1ce3a63872306e54b17/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-20T15:39:32+08:00" />
<meta property="article:modified_time" content="2023-04-20T15:39:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ClickHouse之常见的时间周期函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_7" rel="nofollow">时区相关</a></li><li><ul><li><a href="#timeZone_9" rel="nofollow">timeZone</a></li><li><a href="#toTimeZone_21" rel="nofollow">toTimeZone</a></li><li><a href="#timeZoneOf_50" rel="nofollow">timeZoneOf</a></li></ul> 
  </li><li><a href="#_75" rel="nofollow">年相关</a></li><li><ul><li><a href="#toYear_77" rel="nofollow">toYear</a></li><li><a href="#toStartOfYear_81" rel="nofollow">toStartOfYear</a></li><li><a href="#toStartOfISOYear_85" rel="nofollow">toStartOfISOYear</a></li><li><a href="#toRelativeYearNum_89" rel="nofollow">toRelativeYearNum</a></li><li><a href="#toISOYear_93" rel="nofollow">toISOYear</a></li></ul> 
  </li><li><a href="#_97" rel="nofollow">季度相关</a></li><li><ul><li><a href="#toQuarter_99" rel="nofollow">toQuarter</a></li><li><a href="#toStartOfQuarter_103" rel="nofollow">toStartOfQuarter</a></li><li><a href="#toRelativeQuarterNum_107" rel="nofollow">toRelativeQuarterNum</a></li></ul> 
  </li><li><a href="#_111" rel="nofollow">月相关</a></li><li><ul><li><a href="#toMonth_113" rel="nofollow">toMonth</a></li><li><a href="#toStartOfMonth_117" rel="nofollow">toStartOfMonth</a></li><li><a href="#toRelativeMonthNum_124" rel="nofollow">toRelativeMonthNum</a></li></ul> 
  </li><li><a href="#_128" rel="nofollow">周相关</a></li><li><ul><li><a href="#toMonday_130" rel="nofollow">toMonday</a></li><li><a href="#toStartOfWeektmode_134" rel="nofollow">toStartOfWeek(t[,mode])</a></li><li><a href="#toISOWeek_138" rel="nofollow">toISOWeek</a></li><li><a href="#toRelativeWeekNum_142" rel="nofollow">toRelativeWeekNum</a></li><li><a href="#toWeekdatemode_146" rel="nofollow">toWeek(date[,mode])</a></li><li><a href="#toYearWeekdatemode_183" rel="nofollow">toYearWeek(date[,mode])</a></li></ul> 
  </li><li><a href="#_201" rel="nofollow">日相关</a></li><li><ul><li><a href="#toDayOfYear_203" rel="nofollow">toDayOfYear</a></li><li><a href="#toDayOfMonth_207" rel="nofollow">toDayOfMonth</a></li><li><a href="#toDayOfWeek_211" rel="nofollow">toDayOfWeek</a></li><li><a href="#toRelativeDayNum_215" rel="nofollow">toRelativeDayNum</a></li></ul> 
  </li><li><a href="#_219" rel="nofollow">时分秒相关</a></li><li><ul><li><a href="#toHour_221" rel="nofollow">toHour</a></li><li><a href="#toMinute_225" rel="nofollow">toMinute</a></li><li><a href="#toSecond_229" rel="nofollow">toSecond</a></li><li><a href="#toUnixTimestamp_233" rel="nofollow">toUnixTimestamp</a></li><li><a href="#toStartOfDay_259" rel="nofollow">toStartOfDay</a></li><li><a href="#toStartOfHour_263" rel="nofollow">toStartOfHour</a></li><li><a href="#toStartOfMinute_267" rel="nofollow">toStartOfMinute</a></li><li><a href="#toStartOfSecond_271" rel="nofollow">toStartOfSecond</a></li><li><a href="#toStartOfFiveMinute_308" rel="nofollow">toStartOfFiveMinute</a></li><li><a href="#toStartOfTenMinutes_312" rel="nofollow">toStartOfTenMinutes</a></li><li><a href="#toStartOfFifteenMinutes_316" rel="nofollow">toStartOfFifteenMinutes</a></li><li><a href="#toStartOfIntervaltime_or_dataxtime_zone_320" rel="nofollow">toStartOfInterval(time_or_data,间隔x单位[,time_zone])</a></li><li><a href="#toTime_324" rel="nofollow">toTime</a></li><li><a href="#toRelativeHourNum_328" rel="nofollow">toRelativeHourNum</a></li><li><a href="#toRelativeMinuteNum_332" rel="nofollow">toRelativeMinuteNum</a></li><li><a href="#toRelativeSecondNum_336" rel="nofollow">toRelativeSecondNum</a></li></ul> 
  </li><li><a href="#_340" rel="nofollow">时间计算相关</a></li><li><ul><li><a href="#date_trunc_342" rel="nofollow">date_trunc</a></li><li><a href="#date_add_382" rel="nofollow">date_add</a></li><li><a href="#date_diff_417" rel="nofollow">date_diff</a></li><li><a href="#date_sub_448" rel="nofollow">date_sub</a></li><li><a href="#timestamp_add_482" rel="nofollow">timestamp_add</a></li><li><a href="#timestamp_sub_516" rel="nofollow">timestamp_sub</a></li><li><a href="#add_550" rel="nofollow">add**</a></li><li><a href="#subtract_576" rel="nofollow">subtract**</a></li><li><a href="#timeSlotsStartTime_Duration_Size_603" rel="nofollow">timeSlots(StartTime, Duration,[, Size])</a></li></ul> 
  </li><li><a href="#_607" rel="nofollow">当前时间相关</a></li><li><ul><li><a href="#now_609" rel="nofollow">now</a></li></ul> 
  </li><li><a href="#_641" rel="nofollow">转日期格式相关</a></li><li><ul><li><a href="#today_643" rel="nofollow">today</a></li><li><a href="#yesterday_647" rel="nofollow">yesterday</a></li><li><a href="#timeSlot_651" rel="nofollow">timeSlot</a></li><li><a href="#toYYYYMM_655" rel="nofollow">toYYYYMM</a></li><li><a href="#toYYYYMMDD_659" rel="nofollow">toYYYYMMDD</a></li><li><a href="#toYYYYMMDDhhmmss_663" rel="nofollow">toYYYYMMDDhhmmss</a></li><li><a href="#formatDateTime_667" rel="nofollow">formatDateTime</a></li><li><a href="#dateName_722" rel="nofollow">dateName</a></li><li><a href="#FROM_UNIXTIME_753" rel="nofollow">FROM_UNIXTIME</a></li><li><a href="#toModifiedJulianDay_781" rel="nofollow">toModifiedJulianDay</a></li><li><a href="#toModifiedJulianDayOrNull_809" rel="nofollow">toModifiedJulianDayOrNull</a></li><li><a href="#fromModifiedJulianDay_813" rel="nofollow">fromModifiedJulianDay</a></li><li><a href="#fromModifiedJulianDayOrNull_817" rel="nofollow">fromModifiedJulianDayOrNull</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>在工作中，如果使用了ClickHouse作为数据的存储的话，那么难免会遇到关于时间的转换问题</p> 
<p>比如：字符串转时间，日期等特定格式。</p> 
<h2><a id="_7"></a>时区相关</h2> 
<h3><a id="timeZone_9"></a>timeZone</h3> 
<p>返回服务器的时区。 如果它在分布式表的上下文中执行，那么它会生成一个普通列，其中包含与每个分片相关的值。否则它会产生一个常数值。</p> 
<p><strong>语法</strong></p> 
<pre><code>timeZone()
</code></pre> 
<p><strong>返回时区，类型为： String。</strong></p> 
<h3><a id="toTimeZone_21"></a>toTimeZone</h3> 
<p>将Date或DateTime转换为指定的时区。 时区是Date/DateTime类型的属性。 表字段或结果集的列的内部值（秒数）不会更改，列的类型会更改，并且其字符串表示形式也会相应更改。</p> 
<p><strong>语法</strong></p> 
<pre><code>toTimezone(value, timezone)
</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>value</code></strong> — 时间或日期和时间。类型为DateTime64。</li><li><strong><code>timezone</code></strong> — 返回值的时区。类型为 String。 这个参数是一个常量，因为 <strong><code>toTimezone</code></strong> 改变了列的时区（时区是 <strong><code>DateTime</code></strong> 类型的属性）。</li></ul> 
<p><strong>返回类型为DateTime的日期和时间。</strong></p> 
<p><strong>示例：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
    <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">current_time</span><span class="token punctuation">,</span>
    toTimezone<span class="token punctuation">(</span>toDateTime<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Asia/Yekaterinburg'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> timezone_datetime<span class="token punctuation">,</span>
    toTypeName<span class="token punctuation">(</span>toDateTime<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> type_name<span class="token punctuation">;</span>

<span class="token keyword">current_time</span>          timezone_datetime          type_name
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span>:<span class="token number">08</span>:<span class="token number">17</span>   <span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span>T08:<span class="token number">08</span>:<span class="token number">17</span><span class="token operator">+</span><span class="token number">05</span>:<span class="token number">00</span>  <span class="token keyword">DateTime</span>
</code></pre> 
<h3><a id="timeZoneOf_50"></a>timeZoneOf</h3> 
<p>返回DateTime或者DateTime64数据类型的时区名称。</p> 
<p><strong>语法</strong></p> 
<pre><code>timeZoneOf(value)
</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>value</code></strong> — 日期和时间。类型为DateTime或者DateTime64。</li></ul> 
<p><strong>返回类型为String时区名称。</strong></p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> timezoneOf<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

timezoneOf<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Etc<span class="token operator">/</span>UTC
</code></pre> 
<h2><a id="_75"></a>年相关</h2> 
<h3><a id="toYear_77"></a>toYear</h3> 
<p>将Date或DateTime转换为包含年份编号（AD）的UInt16类型的数字。</p> 
<h3><a id="toStartOfYear_81"></a>toStartOfYear</h3> 
<p>将Date或DateTime向前取整到本年的第一天。 返回Date类型。</p> 
<h3><a id="toStartOfISOYear_85"></a>toStartOfISOYear</h3> 
<p>将Date或DateTime向前取整到ISO本年的第一天。 返回Date类型。</p> 
<h3><a id="toRelativeYearNum_89"></a>toRelativeYearNum</h3> 
<p>将Date或DateTime转换为年份的编号，从过去的某个固定时间点开始。</p> 
<h3><a id="toISOYear_93"></a>toISOYear</h3> 
<p>将Date或DateTime转换为包含ISO年份的UInt16类型的编号。</p> 
<h2><a id="_97"></a>季度相关</h2> 
<h3><a id="toQuarter_99"></a>toQuarter</h3> 
<p>将Date或DateTime转换为包含季度编号的UInt8类型的数字。</p> 
<h3><a id="toStartOfQuarter_103"></a>toStartOfQuarter</h3> 
<p>将Date或DateTime向前取整到本季度的第一天。 返回Date类型。</p> 
<h3><a id="toRelativeQuarterNum_107"></a>toRelativeQuarterNum</h3> 
<p>将Date或DateTime转换为季度的数字，从过去的某个固定时间点开始。</p> 
<h2><a id="_111"></a>月相关</h2> 
<h3><a id="toMonth_113"></a>toMonth</h3> 
<p>将Date或DateTime转换为包含月份编号（1-12）的UInt8类型的数字。</p> 
<h3><a id="toStartOfMonth_117"></a>toStartOfMonth</h3> 
<p>将Date或DateTime向前取整到本月的第一天。 返回Date类型。</p> 
<blockquote> 
 <p>解析不正确日期的行为是特定于实现的。 ClickHouse可能会返回零日期，抛出异常或执行«natural»溢出。</p> 
</blockquote> 
<h3><a id="toRelativeMonthNum_124"></a>toRelativeMonthNum</h3> 
<p>将Date或DateTime转换为月份的编号，从过去的某个固定时间点开始。</p> 
<h2><a id="_128"></a>周相关</h2> 
<h3><a id="toMonday_130"></a>toMonday</h3> 
<p>将Date或DateTime向前取整到本周的星期一。 返回Date类型。</p> 
<h3><a id="toStartOfWeektmode_134"></a>toStartOfWeek(t[,mode])</h3> 
<p>按mode将Date或DateTime向前取整到最近的星期日或星期一。 返回Date类型。 mode参数的工作方式与toWeek()的mode参数完全相同。 对于单参数语法，mode使用默认值0。</p> 
<h3><a id="toISOWeek_138"></a>toISOWeek</h3> 
<p>将Date或DateTime转换为包含ISO周数的UInt8类型的编号。</p> 
<h3><a id="toRelativeWeekNum_142"></a>toRelativeWeekNum</h3> 
<p>将Date或DateTime转换为星期数，从过去的某个固定时间点开始。</p> 
<h3><a id="toWeekdatemode_146"></a>toWeek(date[,mode])</h3> 
<p>返回Date或DateTime的周数。两个参数形式可以指定星期是从星期日还是星期一开始，以及返回值应在0到53还是从1到53的范围内。如果省略了mode参数，则默认 模式为0。 <strong><code>toISOWeek()</code>是一个兼容函数，等效于<code>toWeek(date,3)</code></strong>。 下表描述了mode参数的工作方式。</p> 
<pre><code>toWeek(date, [, mode][, Timezone])
</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>date</code></strong> – Date 或 DateTime.</li><li><strong><code>mode</code></strong> – 可选参数, 取值范围 [0,9]， 默认0。</li><li><strong><code>Timezone</code></strong> – 可选参数， 可其他时间日期转换参数的行为一致。</li></ul> 
<table><thead><tr><th>Mode</th><th>周的第一天</th><th>范围</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>Sunday</td><td>0-53</td><td>看周日在哪一年</td></tr><tr><td>1</td><td>Monday</td><td>0-53</td><td>如果包含1月1日的一周在后一年度中有4天或更多天，则为第1周。否则，它是上一年的最后一周，下周是第1周。</td></tr><tr><td>2</td><td>Sunday</td><td>1-53</td><td>看周日在哪一年</td></tr><tr><td>3</td><td>Monday</td><td>1-53</td><td>如果包含1月1日的一周在后一年度中有4天或更多天，则为第1周。否则，它是上一年的最后一周，下周是第1周。</td></tr><tr><td>4</td><td>Sunday</td><td>0-53</td><td>如果包含1月1日的一周在后一年度中有4天或更多天，则为第1周。否则，它是上一年的最后一周，下周是第1周。</td></tr><tr><td>5</td><td>Monday</td><td>0-53</td><td>看周一在哪一年</td></tr><tr><td>6</td><td>Sunday</td><td>1-53</td><td>如果包含1月1日的一周在后一年度中有4天或更多天，则为第1周。否则，它是上一年的最后一周，下周是第1周。</td></tr><tr><td>7</td><td>Monday</td><td>1-53</td><td>看周一在哪一年</td></tr><tr><td>8</td><td>Sunday</td><td>1-53</td><td>包含1月1日的那周为本年度的第1周</td></tr><tr><td>9</td><td>Monday</td><td>1-53</td><td>包含1月1日的那周为本年度的第1周</td></tr></tbody></table> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> toDate<span class="token punctuation">(</span><span class="token string">'2016-12-27'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">date</span><span class="token punctuation">,</span> toWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> week0<span class="token punctuation">,</span> toWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> week1<span class="token punctuation">,</span> toWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> week9<span class="token punctuation">;</span>

┌───────<span class="token keyword">date</span>─┬─week0─┬─week1─┬─week9─┐
│ <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">27</span> │    <span class="token number">52</span> │    <span class="token number">52</span> │     <span class="token number">1</span> │
└────────────┴───────┴───────┴───────┘
</code></pre> 
<h3><a id="toYearWeekdatemode_183"></a>toYearWeek(date[,mode])</h3> 
<p>返回Date的年和周。 结果中的年份可能因为Date为该年份的第一周和最后一周而于Date的年份不同。</p> 
<p>mode参数的工作方式与toWeek()的mode参数完全相同。 对于单参数语法，mode使用默认值0。</p> 
<p><strong><code>toISOYear()</code>是一个兼容函数，等效于<code>intDiv(toYearWeek(date,3),100)</code></strong>.</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> toDate<span class="token punctuation">(</span><span class="token string">'2016-12-27'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">date</span><span class="token punctuation">,</span> toYearWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> yearWeek0<span class="token punctuation">,</span> toYearWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> yearWeek1<span class="token punctuation">,</span> toYearWeek<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> yearWeek9<span class="token punctuation">;</span>

┌───────<span class="token keyword">date</span>─┬─yearWeek0─┬─yearWeek1─┬─yearWeek9─┐
│ <span class="token number">2016</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">27</span> │    <span class="token number">201652</span> │    <span class="token number">201652</span> │    <span class="token number">201701</span> │
└────────────┴───────────┴───────────┴───────────┘
</code></pre> 
<h2><a id="_201"></a>日相关</h2> 
<h3><a id="toDayOfYear_203"></a>toDayOfYear</h3> 
<p>将Date或DateTime转换为包含一年中的某一天的编号的UInt16（1-366）类型的数字。</p> 
<h3><a id="toDayOfMonth_207"></a>toDayOfMonth</h3> 
<p>将Date或DateTime转换为包含一月中的某一天的编号的UInt8（1-31）类型的数字。</p> 
<h3><a id="toDayOfWeek_211"></a>toDayOfWeek</h3> 
<p>将Date或DateTime转换为包含一周中的某一天的编号的UInt8（周一是1, 周日是7）类型的数字。</p> 
<h3><a id="toRelativeDayNum_215"></a>toRelativeDayNum</h3> 
<p>将Date或DateTime转换为当天的编号，从过去的某个固定时间点开始。</p> 
<h2><a id="_219"></a>时分秒相关</h2> 
<h3><a id="toHour_221"></a>toHour</h3> 
<p>将DateTime转换为包含24小时制（0-23）小时数的UInt8数字。 这个函数假设如果时钟向前移动，它是一个小时，发生在凌晨2点，如果时钟被移回，它是一个小时，发生在凌晨3点（这并非总是如此 - 即使在莫斯科时钟在不同的时间两次改变）。</p> 
<h3><a id="toMinute_225"></a>toMinute</h3> 
<p>将DateTime转换为包含一小时中分钟数（0-59）的UInt8数字。</p> 
<h3><a id="toSecond_229"></a>toSecond</h3> 
<p>将DateTime转换为包含一分钟中秒数（0-59）的UInt8数字。 闰秒不计算在内。</p> 
<h3><a id="toUnixTimestamp_233"></a>toUnixTimestamp</h3> 
<p>对于DateTime参数：将值转换为UInt32类型的数字-Unix时间戳，对于String参数：根据时区将输入字符串转换为日期时间（可选的第二个参数，默认使用服务器时区），并返回相应的unix时间戳。</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql">toUnixTimestamp<span class="token punctuation">(</span><span class="token keyword">datetime</span><span class="token punctuation">)</span>
toUnixTimestamp<span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>返回</strong>类型**<code>UInt32</code>**unix timestamp.</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> toUnixTimestamp<span class="token punctuation">(</span><span class="token string">'2017-11-05 08:07:47'</span><span class="token punctuation">,</span> <span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> unix_timestamp

┌─unix_timestamp─┐
│     <span class="token number">1509836867</span> │
└────────────────┘
</code></pre> 
<blockquote> 
 <p>注意 下面描述的返回类型 toStartOf 函数是 Date 或 DateTime。尽管这些函数可以将 DateTime64 作为参数，但将超出正常范围（1900年-2299年）的 DateTime64 传递给它们会给出不正确的结果。</p> 
</blockquote> 
<h3><a id="toStartOfDay_259"></a>toStartOfDay</h3> 
<p>将DateTime向前取整到今天的开始。</p> 
<h3><a id="toStartOfHour_263"></a>toStartOfHour</h3> 
<p>将DateTime向前取整到当前小时的开始。</p> 
<h3><a id="toStartOfMinute_267"></a>toStartOfMinute</h3> 
<p>将DateTime向前取整到当前分钟的开始。</p> 
<h3><a id="toStartOfSecond_271"></a>toStartOfSecond</h3> 
<p>将DateTime向前取整到当前秒数的开始。</p> 
<p><strong>语法</strong></p> 
<pre><code>toStartOfSecond(value[, timezone])
</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>value</code></strong> — 时间和日期DateTime64.</li><li><strong><code>timezone</code></strong> — 返回值的Timezone (可选参数)。 如果未指定将使用 <strong><code>value</code></strong> 参数的时区。</li></ul> 
<p><strong>返回</strong>类型DateTime64，输入值毫秒部分为零。</p> 
<p><strong>示例</strong></p> 
<p>不指定时区查询:</p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> toDateTime64<span class="token punctuation">(</span><span class="token string">'2020-01-01 10:20:30.999'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> dt64
<span class="token keyword">SELECT</span> toStartOfSecond<span class="token punctuation">(</span>dt64<span class="token punctuation">)</span><span class="token punctuation">;</span>

┌───toStartOfSecond<span class="token punctuation">(</span>dt64<span class="token punctuation">)</span>─┐
│ <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">10</span>:<span class="token number">20</span>:<span class="token number">30.000</span> │
└─────────────────────────┘

<span class="token keyword">WITH</span> toDateTime64<span class="token punctuation">(</span><span class="token string">'2020-01-01 10:20:30.999'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> dt64
<span class="token keyword">SELECT</span> toStartOfSecond<span class="token punctuation">(</span>dt64<span class="token punctuation">,</span> <span class="token string">'Asia/Istanbul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

┌─toStartOfSecond<span class="token punctuation">(</span>dt64<span class="token punctuation">,</span> <span class="token string">'Asia/Istanbul'</span><span class="token punctuation">)</span>─┐
│                <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span>:<span class="token number">20</span>:<span class="token number">30.000</span> │
└────────────────────────────────────────┘
</code></pre> 
<h3><a id="toStartOfFiveMinute_308"></a>toStartOfFiveMinute</h3> 
<p>将DateTime以五分钟为单位向前取整到最接近的时间点。</p> 
<h3><a id="toStartOfTenMinutes_312"></a>toStartOfTenMinutes</h3> 
<p>将DateTime以十分钟为单位向前取整到最接近的时间点。</p> 
<h3><a id="toStartOfFifteenMinutes_316"></a>toStartOfFifteenMinutes</h3> 
<p>将DateTime以十五分钟为单位向前取整到最接近的时间点。</p> 
<h3><a id="toStartOfIntervaltime_or_dataxtime_zone_320"></a>toStartOfInterval(time_or_data,间隔x单位[,time_zone])</h3> 
<p>这是名为<code>toStartOf*</code>的所有函数的通用函数。例如， <code>toStartOfInterval（t，INTERVAL 1 year）</code><strong>返回与</strong><code>toStartOfYear（t）</code>相同的结果， <code>toStartOfInterval（t，INTERVAL 1 month）</code><strong>返回与</strong><code>toStartOfMonth（t）</code>相同的结果， <code>toStartOfInterval（t，INTERVAL 1 day）</code><strong>返回与</strong><code>toStartOfDay（t）</code>相同的结果， <code>toStartOfInterval（t，INTERVAL 15 minute）</code><strong>返回与</strong><code>toStartOfFifteenMinutes（t）</code>相同的结果。</p> 
<h3><a id="toTime_324"></a>toTime</h3> 
<p>将DateTime中的日期转换为一个固定的日期，同时保留时间部分。</p> 
<h3><a id="toRelativeHourNum_328"></a>toRelativeHourNum</h3> 
<p>将DateTime转换为小时数，从过去的某个固定时间点开始。</p> 
<h3><a id="toRelativeMinuteNum_332"></a>toRelativeMinuteNum</h3> 
<p>将DateTime转换为分钟数，从过去的某个固定时间点开始。</p> 
<h3><a id="toRelativeSecondNum_336"></a>toRelativeSecondNum</h3> 
<p>将DateTime转换为秒数，从过去的某个固定时间点开始。</p> 
<h2><a id="_340"></a>时间计算相关</h2> 
<h3><a id="date_trunc_342"></a>date_trunc</h3> 
<p>将Date或DateTime按指定的单位向前取整到最接近的时间点。</p> 
<p><strong>语法</strong></p> 
<pre><code>date_trunc(unit, value[, timezone])

</code></pre> 
<p>别名: <strong><code>dateTrunc</code></strong>.</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>unit</code></strong> — 单位. String. 可选值:<strong><code>second、minute、hour、day、week、month、quarter、year</code></strong></li><li><strong><code>value</code></strong> — DateTime 或者 DateTime64.</li><li><strong><code>timezone</code></strong> — Timezone name 返回值的时区(可选值)。如果未指定将使用<code>value</code>的时区</li></ul> 
<p><strong>返回按指定的单位向前取整后的DateTime。</strong></p> 
<p><strong>示例</strong></p> 
<p>不指定时区查询:</p> 
<pre><code>SELECT now(), date_trunc('hour', now());

┌───────────────now()─┬─date_trunc('hour', now())─┐
│ 2020-09-28 10:40:45 │       2020-09-28 10:00:00 │
└─────────────────────┴───────────────────────────┘

SELECT now(), date_trunc('hour', now(), 'Asia/Istanbul');

┌───────────────now()─┬─date_trunc('hour', now(), 'Asia/Istanbul')─┐
│ 2020-09-28 10:46:26 │                        2020-09-28 13:00:00 │
└─────────────────────┴────────────────────────────────────────────┘

</code></pre> 
<h3><a id="date_add_382"></a>date_add</h3> 
<p>将时间间隔或日期间隔添加到提供的日期或带时间的日期。</p> 
<p><strong>语法</strong></p> 
<pre><code>date_add(unit, value, date)

</code></pre> 
<p>别名为：<strong><code>dateAdd</code></strong>, <strong><code>DATE_ADD</code></strong>。</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>unit</code></strong> — <strong><code>value</code>对应的时间单位。类型为String。 可能的值：<code>second、minute、hour、day、week、month、quarter、year</code></strong></li><li><strong><code>value</code></strong> — 要添加的间隔值。类型为Int。</li><li><strong><code>date</code></strong> — 添加<code>value</code>的日期或日期。类型为Date或者DateTime。</li></ul> 
<p><strong>返回值</strong></p> 
<p>通过将 <strong><code>value</code></strong> 以<code>unit</code> 表示，添加到<code>date</code> 获得的日期或带时间的日期。</p> 
<p>类型为： Date或DateTime。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> date_add<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

┌─plus<span class="token punctuation">(</span>toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toIntervalYear<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>─┐
│                                    <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> │
└───────────────────────────────────────────────┘
</code></pre> 
<h3><a id="date_diff_417"></a>date_diff</h3> 
<p>返回两个日期或具有时间值的日期之间的差值。</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql">date_diff<span class="token punctuation">(</span><span class="token string">'unit'</span><span class="token punctuation">,</span> startdate<span class="token punctuation">,</span> enddate<span class="token punctuation">,</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>别名为： <strong><code>dateDiff</code></strong>, <strong><code>DATE_DIFF</code></strong>。</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>unit</code></strong> — <strong><code>value</code>对应的时间单位。类型为String。 可能的值：<code>second、minute、hour、day、week、month、quarter、year</code></strong></li><li><strong><code>startdate</code></strong> — 要减去的第一个时间值（减数）。类型为Date或者DateTime。</li><li><strong><code>enddate</code></strong> — 要减去的第二个时间值（被减数）。类型为Date或者DateTime。</li><li><strong><code>timezone</code></strong> — Timezone name (可选项)。如果指定，它适用于 <strong><code>startdate</code></strong> 和 <strong><code>enddate</code></strong>。如果未指定，则使用 <strong><code>startdate</code></strong> 和 <strong><code>enddate</code></strong> 的时区。如果它们不相同，则结果未指定。类型为String。</li></ul> 
<p><strong>返回</strong>以 <strong><code>unit</code></strong> 表示的 <strong><code>enddate</code></strong> 和 <strong><code>startdate</code></strong> 之间的区别。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> dateDiff<span class="token punctuation">(</span><span class="token string">'hour'</span><span class="token punctuation">,</span> toDateTime<span class="token punctuation">(</span><span class="token string">'2018-01-01 22:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toDateTime<span class="token punctuation">(</span><span class="token string">'2018-01-02 23:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dateDiff<span class="token punctuation">;</span>

┌─dateDiff─┐
│                                                                                           <span class="token number">25</span> │
└──────────┘
</code></pre> 
<h3><a id="date_sub_448"></a>date_sub</h3> 
<p>从提供的日期或带时间的日期中减去时间间隔或日期间隔。</p> 
<p><strong>语法</strong></p> 
<pre><code>date_sub(unit, value, date)
</code></pre> 
<p>别名为： <strong><code>dateSub</code></strong>, <strong><code>DATE_SUB</code></strong>.</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>unit</code></strong> — <strong><code>value</code>对应的时间单位。类型为String。 可能的值：<code>second、minute、hour、day、week、month、quarter、year</code></strong></li><li><strong><code>value</code></strong> — 要减去的时间。类型为Int。</li><li><strong><code>date</code></strong> — 被减去<code>value</code>*的日期或日期。类型为Date或者DateTime。</li></ul> 
<p><strong>返回值</strong></p> 
<p>从 <strong><code>date</code></strong> 中减去以<code>unit</code> 表示的<code>value</code> 得到的日期或带时间的日期。</p> 
<p>类型为：Date 或者 DateTime。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> date_sub<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

┌─minus<span class="token punctuation">(</span>toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toIntervalYear<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>─┐
│                                     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> │
└────────────────────────────────────────────────┘
</code></pre> 
<h3><a id="timestamp_add_482"></a>timestamp_add</h3> 
<p>将指定的时间值与提供的日期或日期时间值相加。</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql">timestamp_add<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token keyword">value</span> unit<span class="token punctuation">)</span>
</code></pre> 
<p>别名为： <strong><code>timeStampAdd</code></strong>, <strong><code>TIMESTAMP_ADD</code></strong>.</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>date</code></strong> — 日期或日期与时间。类型为Date或者DateTime。</li><li><strong><code>value</code></strong> — 要添加的间隔值。类型为Int。</li><li><strong><code>unit</code></strong> — <strong><code>value</code>对应的时间单位。类型为String。 可能的值：<code>second、minute、hour、day、week、month、quarter、year</code></strong></li></ul> 
<p><strong>返回值</strong></p> 
<p>以**<code>unit</code><strong>表示的指定</strong><code>value</code><strong>的日期或带时间的日期添加到</strong><code>date</code>**。</p> 
<p>类型为：Date或者DateTime。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> timestamp_add<span class="token punctuation">(</span>toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">3</span> <span class="token keyword">MONTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

┌─plus<span class="token punctuation">(</span>toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toIntervalMonth<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>─┐
│                                     <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span> │
└────────────────────────────────────────────────┘
</code></pre> 
<h3><a id="timestamp_sub_516"></a>timestamp_sub</h3> 
<p>从提供的日期或带时间的日期中减去时间间隔。</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql">timestamp_sub<span class="token punctuation">(</span>unit<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token keyword">date</span><span class="token punctuation">)</span>
</code></pre> 
<p>别名为： <strong><code>timeStampSub</code></strong>, <strong><code>TIMESTAMP_SUB</code></strong>。</p> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>unit</code></strong> — <strong><code>value</code>对应的时间单位。类型为String。 可能的值:<code>second、minute、hour、day、week、month、quarter、year</code></strong></li><li><strong><code>value</code></strong> — 要减去的间隔值。类型为Int。</li><li><strong><code>date</code></strong> — 日期或日期与时间。类型为Date或者DateTime。</li></ul> 
<p><strong>返回值</strong></p> 
<p>从 <strong><code>date</code></strong> 中减去以**<code>unit</code>** 表示的**<code>value</code>** 得到的日期或带时间的日期。</p> 
<p>类型为： Date或者DateTime。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> timestamp_sub<span class="token punctuation">(</span><span class="token keyword">MONTH</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> toDateTime<span class="token punctuation">(</span><span class="token string">'2018-12-18 01:02:03'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

┌─minus<span class="token punctuation">(</span>toDateTime<span class="token punctuation">(</span><span class="token string">'2018-12-18 01:02:03'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toIntervalMonth<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>─┐
│                                          <span class="token number">2018</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">01</span>:<span class="token number">02</span>:<span class="token number">03</span> │
└──────────────────────────────────────────────────────────────┘
</code></pre> 
<h3><a id="add_550"></a>add**</h3> 
<ul><li><strong>addYears</strong></li><li><strong>addMonths</strong></li><li><strong>addWeeks</strong></li><li><strong>addDays</strong></li><li><strong>addHours</strong></li><li><strong>addMinutes</strong></li><li><strong>addSeconds</strong></li><li><strong>addQuarters</strong></li></ul> 
<p>函数将一段时间间隔添加到Date/DateTime，然后返回Date/DateTime。例如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span>
    toDate<span class="token punctuation">(</span><span class="token string">'2018-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">date</span><span class="token punctuation">,</span>
    toDateTime<span class="token punctuation">(</span><span class="token string">'2018-01-01 00:00:00'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> date_time
<span class="token keyword">SELECT</span>
    addYears<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> add_years_with_date<span class="token punctuation">,</span>
    addYears<span class="token punctuation">(</span>date_time<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> add_years_with_date_time

┌─add_years_with_date─┬─add_years_with_date_time─┐
│          <span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> │      <span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> │
└─────────────────────┴──────────────────────────┘
</code></pre> 
<h3><a id="subtract_576"></a>subtract**</h3> 
<ul><li><strong>subtractYears</strong></li><li><strong>subtractMonths</strong></li><li><strong>subtractWeeks</strong></li><li><strong>subtractDays</strong></li><li><strong>subtractours</strong></li><li><strong>subtractMinutes</strong></li><li><strong>subtractSeconds</strong></li><li><strong>subtractQuarters</strong></li></ul> 
<p>函数将Date/DateTime减去一段时间间隔，然后返回Date/DateTime。例如：</p> 
<pre><code>WITH
    toDate('2019-01-01') AS date,
    toDateTime('2019-01-01 00:00:00') AS date_time
SELECT
    subtractYears(date, 1) AS subtract_years_with_date,
    subtractYears(date_time, 1) AS subtract_years_with_date_time

┌─subtract_years_with_date─┬─subtract_years_with_date_time─┐
│               2018-01-01 │           2018-01-01 00:00:00 │
└──────────────────────────┴───────────────────────────────┘

</code></pre> 
<h3><a id="timeSlotsStartTime_Duration_Size_603"></a>timeSlots(StartTime, Duration,[, Size])</h3> 
<p>它返回一个时间数组，其中包括从从«StartTime»开始到«StartTime + Duration 秒»内的所有符合«size»（以秒为单位）步长的时间点。其中«size»是一个可选参数，默认为1800。 例如，<code>timeSlots(toDateTime('2012-01-01 12:20:00')，600) = [toDateTime（'2012-01-01 12:00:00'），toDateTime（'2012-01-01 12:30:00' ）]</code>。 这对于搜索在相应会话中综合浏览量是非常有用的。</p> 
<h2><a id="_607"></a>当前时间相关</h2> 
<h3><a id="now_609"></a>now</h3> 
<p>返回当前日期和时间。</p> 
<p><strong>语法</strong></p> 
<pre><code>now([timezone])

</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>timezone</code></strong> — Timezone name 返回结果的时区(可先参数). String.</li></ul> 
<p><strong>返回</strong>类型DateTime的当前日期和时间。</p> 
<p><strong>示例</strong></p> 
<pre><code>SELECT now();
┌───────────────now()─┐
│ 2020-10-17 07:42:09 │
└─────────────────────┘

SELECT now('Asia/Istanbul');
┌─now('Asia/Istanbul')─┐
│  2020-10-17 10:42:23 │
└──────────────────────┘

</code></pre> 
<h2><a id="_641"></a>转日期格式相关</h2> 
<h3><a id="today_643"></a>today</h3> 
<p>不接受任何参数并在请求执行时的某一刻返回当前日期(Date)。 其功能与’toDate（now()）’相同。</p> 
<h3><a id="yesterday_647"></a>yesterday</h3> 
<p>不接受任何参数并在请求执行时的某一刻返回昨天的日期(Date)。 其功能与’today() - 1’相同。</p> 
<h3><a id="timeSlot_651"></a>timeSlot</h3> 
<p>将时间向前取整半小时。 此功能用于Yandex.Metrica，因为如果跟踪标记显示单个用户的连续综合浏览量在时间上严格超过此数量，则半小时是将会话分成两个会话的最短时间。这意味着（tag id，user id，time slot）可用于搜索相应会话中包含的综合浏览量。</p> 
<h3><a id="toYYYYMM_655"></a>toYYYYMM</h3> 
<p>将Date或DateTime转换为包含年份和月份编号的UInt32类型的数字（YYYY * 100 + MM）。</p> 
<h3><a id="toYYYYMMDD_659"></a>toYYYYMMDD</h3> 
<p>将Date或DateTime转换为包含年份和月份编号的UInt32类型的数字（YYYY * 10000 + MM * 100 + DD）。</p> 
<h3><a id="toYYYYMMDDhhmmss_663"></a>toYYYYMMDDhhmmss</h3> 
<p>将Date或DateTime转换为包含年份和月份编号的UInt64类型的数字（YYYY * 10000000000 + MM * 100000000 + DD * 1000000 + hh * 10000 + mm * 100 + ss）。</p> 
<h3><a id="formatDateTime_667"></a>formatDateTime</h3> 
<p>函数根据给定的格式字符串来格式化时间。请注意：格式字符串必须是常量表达式，例如：单个结果列不能有多种格式字符串。</p> 
<p><strong>语法</strong></p> 
<pre><code>formatDateTime(Time, Format[, Timezone])

</code></pre> 
<p><strong>返回值</strong>根据指定格式返回的日期和时间。</p> 
<p><strong>支持的格式修饰符</strong></p> 
<p>使用格式修饰符来指定结果字符串的样式。«示例» 列是对**<code>2018-01-02 22:33:44</code>**的格式化结果。</p> 
<table><thead><tr><th>修饰符</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>%C</td><td>年除以100并截断为整数(00-99)</td><td>20</td></tr><tr><td>%d</td><td>月中的一天，零填充（01-31)</td><td>02</td></tr><tr><td>%D</td><td>短MM/DD/YY日期，相当于%m/%d/%y</td><td>01/02/2018</td></tr><tr><td>%e</td><td>月中的一天，空格填充（ 1-31)</td><td>2</td></tr><tr><td>%F</td><td>短YYYY-MM-DD日期，相当于%Y-%m-%d</td><td>2018-01-02</td></tr><tr><td>%G</td><td>ISO周号的四位数年份格式， 从基于周的年份由ISO 8601定义 标准计算得出，通常仅对％V有用</td><td>2018</td></tr><tr><td>%g</td><td>两位数的年份格式，与ISO 8601一致，四位数表示法的缩写</td><td>18</td></tr><tr><td>%H</td><td>24小时格式（00-23)</td><td>22</td></tr><tr><td>%I</td><td>12小时格式（01-12)</td><td>10</td></tr><tr><td>%j</td><td>一年中的一天 (001-366)</td><td>002</td></tr><tr><td>%m</td><td>月份为十进制数（01-12)</td><td>01</td></tr><tr><td>%M</td><td>分钟(00-59)</td><td>33</td></tr><tr><td>%n</td><td>换行符(")</td><td></td></tr><tr><td>%p</td><td>AM或PM指定</td><td>PM</td></tr><tr><td>%Q</td><td>季度（1-4)</td><td>1</td></tr><tr><td>%R</td><td>24小时HH:MM时间，相当于%H:%M</td><td>22:33</td></tr><tr><td>%S</td><td>秒 (00-59)</td><td>44</td></tr><tr><td>%t</td><td>水平制表符(’)</td><td></td></tr><tr><td>%T</td><td>ISO8601时间格式(HH:MM:SS)，相当于%H:%M:%S</td><td>22:33:44</td></tr><tr><td>%u</td><td>ISO8601工作日为数字，星期一为1(1-7)</td><td>2</td></tr><tr><td>%V</td><td>ISO8601周编号(01-53)</td><td>01</td></tr><tr><td>%w</td><td>工作日为十进制数，周日为0(0-6)</td><td>2</td></tr><tr><td>%y</td><td>年份，最后两位数字（00-99)</td><td>18</td></tr><tr><td>%Y</td><td>年</td><td>2018</td></tr><tr><td>%%</td><td>%符号</td><td>%</td></tr></tbody></table> 
<p><strong>示例</strong></p> 
<pre><code>SELECT formatDateTime(toDate('2010-01-04'), '%g')
┌─formatDateTime(toDate('2010-01-04'), '%g')─┐
│ 10                                         │
└────────────────────────────────────────────┘

</code></pre> 
<h3><a id="dateName_722"></a>dateName</h3> 
<p>返回日期的指定部分。</p> 
<p><strong>语法</strong></p> 
<pre><code>dateName(date_part, date)

</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>date_part</code></strong> — 日期部分。可能的值为：year, quarter,month, week, dayofyear, day, weekday, hour, minute, second。类型为String。</li><li><strong><code>date</code></strong> — 日期。类型为Date, DateTime或者DateTime64。</li><li><strong><code>timezone</code></strong> — 时区（可选项）。类型为String。</li></ul> 
<p><strong>返回</strong>日期的指定部分。</p> 
<p><strong>示例</strong></p> 
<pre><code>WITH toDateTime('2021-04-14 11:22:33') AS date_value
SELECT dateName('year', date_value) year, dateName('month', date_value) month, dateName('day', date_value) day;

┌─year─┬─month─┬─day─┐
│ 2021 │ April │ 14  │
└──────┴───────┴─────┴

</code></pre> 
<h3><a id="FROM_UNIXTIME_753"></a>FROM_UNIXTIME</h3> 
<p>当只有单个整数类型的参数时，它的作用与**<code>toDateTime</code>**相同，并返回DateTime类型。</p> 
<p>例如:</p> 
<pre><code>SELECT FROM_UNIXTIME(423543535)

┌─FROM_UNIXTIME(423543535)─┐
│      1983-06-04 10:58:55 │
└──────────────────────────┘

</code></pre> 
<p>当有两个参数时，第一个是整型或DateTime，第二个是常量格式字符串，它的作用与**<code>formatDateTime</code><strong>相同，并返回</strong><code>String</code>**类型。</p> 
<p>例如:</p> 
<pre><code>SELECT FROM_UNIXTIME(1234334543, '%Y-%m-%d %R:%S') AS DateTime

┌─DateTime────────────┐
│ 2009-02-11 14:42:23 │
└─────────────────────┘

</code></pre> 
<h3><a id="toModifiedJulianDay_781"></a>toModifiedJulianDay</h3> 
<p>将文本形式 的**<code>YYYY-MM-DD</code>** 日期转换为 Int32 数字。此功能支持从**<code>0000-01-01</code><strong>到</strong><code>9999-12-31</code>**的日期。如果无法将参数解析为日期或日期无效，则会引发异常。</p> 
<p><strong>语法</strong></p> 
<pre><code>toModifiedJulianDay(date)

</code></pre> 
<p><strong>参数</strong></p> 
<ul><li><strong><code>date</code></strong> — 文本形式的日期。类型为String或者FixedString。</li></ul> 
<p><strong>返回</strong>转换的日数。</p> 
<p><strong>示例</strong></p> 
<pre><code>SELECT toModifiedJulianDay('2020-01-01');

┌─toModifiedJulianDay('2020-01-01')─┐
│                             58849 │
└───────────────────────────────────┘

</code></pre> 
<h3><a id="toModifiedJulianDayOrNull_809"></a>toModifiedJulianDayOrNull</h3> 
<p>类似于toModifiedJulianDay()，但它不会引发异常，而是返回 <strong><code>NULL</code></strong>。</p> 
<h3><a id="fromModifiedJulianDay_813"></a>fromModifiedJulianDay</h3> 
<p>将日数字转换为 <strong><code>YYYY-MM-DD</code></strong> 文本格式的日期。该函数支持从 <strong><code>-678941</code></strong> 到 <strong><code>2973119</code></strong> 的天数（分别代表 0000-01-01 和 9999-12-31）。如果天数超出支持范围，则会引发异常。</p> 
<h3><a id="fromModifiedJulianDayOrNull_817"></a>fromModifiedJulianDayOrNull</h3> 
<p>类似于fromModifiedJulianDayOrNull()，但它不会引发异常，而是返回 <strong><code>NULL</code></strong>。</p> 
<p>更多详情请看ClickHouse官网：<a href="https://clickhouse.com/docs/en/sql-reference/functions/date-time-functions" rel="nofollow">直通车</a></p> 
<hr> 
<hr> 
<p><strong>--------------------------------------------------------------欢迎叨扰此地址---------------------------------------------------------------</strong></p> 
<p>本文作者：Java技术债务<br> 原文链接：<a href="https://cuizb.top/myblog/article/1681899030" rel="nofollow">https://cuizb.top/myblog/article/1681899030</a><br> 版权声明： 本博客所有文章除特别声明外，均采用 CC BY 3.0 CN协议进行许可。转载请署名作者且注明文章出处。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/91be2d7c8438682402cef4041e32bbfc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">模拟企业业务构建基于nginx的高可用web集群</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0961ce0a8ccfb421b8e9cfdfc91f884a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue设置整个页面回到顶部和局部div回到顶部</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>