<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>4 课程分类查询 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="4 课程分类查询" />
<meta property="og:description" content="4 课程分类查询 4.1 需求分析 下边根据内容管理模块的业务流程，下一步要实现新增课程，在新增课程界面，有三处信息需要选择，如下图：
课程等级、课程类型来源于数据字典表，此部分的信息前端已从系统管理服务读取。
课程分类信息没有在数据字典表中存储，而是由单独一张课程分类表，存储在内容管理数据库中。
下边看下course_category课程分类表的结构
这张表是一个树型结构，通过父结点id将各元素组成一个树。
我们可以看下该表的数据，下图是一部分数据：
现在的需求是需要在内容管理服务中编写一个接口读取该课程分类表的数据，组成一个树型结构返回给前端。
课程分类的PO类如下：
如果没有此po类则需要生成的此表的po类拷贝到内容管理模块的model工程中，将mapper拷贝到内容管理模块的service工程中。
4.2 接口定义 我们可以点击新增课程，观察前端的请求记录：
http://localhost:8601/api/content/course-category/tree-nodes 该地址正是前端获取课程分类的接口地址。
通过上图界面的内容可以看出该接口的协议为：HTTP GET
请求参数为空。
通过查阅接口文档，此接口要返回全部课程分类，以树型结构返回，如下所示。
JSON
[
{
&#34;childrenTreeNodes&#34; : [
{
&#34;childrenTreeNodes&#34; : null,
&#34;id&#34; : &#34;1-1-1&#34;,
&#34;isLeaf&#34; : null,
&#34;isShow&#34; : null,
&#34;label&#34; : &#34;HTML/CSS&#34;,
&#34;name&#34; : &#34;HTML/CSS&#34;,
&#34;orderby&#34; : 1,
&#34;parentid&#34; : &#34;1-1&#34;
},
{
&#34;childrenTreeNodes&#34; : null,
&#34;id&#34; : &#34;1-1-2&#34;,
&#34;isLeaf&#34; : null,
&#34;isShow&#34; : null,
&#34;label&#34; : &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3ab4ae36f012531e5ff82835808e388a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-24T21:46:07+08:00" />
<meta property="article:modified_time" content="2024-01-24T21:46:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">4 课程分类查询</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:.0001pt;text-align:left;"><strong>4 课程分类查询</strong></h2> 
<h3 style="margin-left:.0001pt;text-align:left;"><strong>4.1 需求分析</strong></h3> 
<p style="margin-left:.0001pt;text-align:left;">下边根据内容管理模块的业务流程，下一步要实现新增课程，在新增课程界面，有三处信息需要选择，如下图：<img alt="" height="643" src="https://images2.imgbox.com/6d/f1/RRdfaW9u_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;">课程等级、课程类型来源于数据字典表，此部分的信息前端已从系统管理服务读取。</p> 
<p style="margin-left:.0001pt;text-align:left;">课程分类信息没有在数据字典表中存储，而是由单独一张课程分类表，存储在内容管理数据库中。<img alt="" height="273" src="https://images2.imgbox.com/2b/83/9Rhxibte_o.png" width="588"></p> 
<p style="margin-left:.0001pt;text-align:left;">下边看下course_category课程分类表的结构</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="139" src="https://images2.imgbox.com/61/73/sOmZymfR_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">这张表是一个树型结构，通过父结点id将各元素组成一个树。</p> 
<p style="margin-left:.0001pt;text-align:left;">我们可以看下该表的数据，下图是一部分数据：<img alt="" height="599" src="https://images2.imgbox.com/25/00/qEZ305h4_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;">现在的需求是需要在内容管理服务中编写一个接口读取该课程分类表的数据，组成一个树型结构返回给前端。</p> 
<p style="margin-left:.0001pt;text-align:left;">课程分类的PO类如下：<img alt="" height="492" src="https://images2.imgbox.com/92/f3/aYSDacu5_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;">如果没有此po类则需要生成的此表的po类拷贝到内容管理模块的model工程中，将mapper拷贝到内容管理模块的service工程中。</p> 
<h3 style="margin-left:.0001pt;text-align:left;"><strong>4.2 接口定义</strong></h3> 
<p style="margin-left:.0001pt;text-align:left;">我们可以点击新增课程，观察前端的请求记录：<img alt="" height="232" src="https://images2.imgbox.com/fa/1b/gLCgr3CX_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;"><a href="http://localhost:8601/api/content/course-category/tree-nodes" rel="nofollow" title="http://localhost:8601/api/content/course-category/tree-nodes">http://localhost:8601/api/content/course-category/tree-nodes</a> 该地址正是前端获取课程分类的接口地址。</p> 
<p style="margin-left:.0001pt;text-align:left;">通过上图界面的内容可以看出该接口的协议为：HTTP GET</p> 
<p style="margin-left:.0001pt;text-align:left;">请求参数为空。</p> 
<p style="margin-left:.0001pt;text-align:left;">通过查阅接口文档，此接口要返回全部课程分类，以树型结构返回，如下所示。</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">JSON</span><br>  [<br>          {<!-- --><br>             "childrenTreeNodes" : [<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-1",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "HTML/CSS",<br>                   "name" : "HTML/CSS",<br>                   "orderby" : 1,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-2",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "JavaScript",<br>                   "name" : "JavaScript",<br>                   "orderby" : 2,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-3",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "jQuery",<br>                   "name" : "jQuery",<br>                   "orderby" : 3,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-4",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "ExtJS",<br>                   "name" : "ExtJS",<br>                   "orderby" : 4,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-5",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "AngularJS",<br>                   "name" : "AngularJS",<br>                   "orderby" : 5,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-6",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "ReactJS",<br>                   "name" : "ReactJS",<br>                   "orderby" : 6,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-7",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Bootstrap",<br>                   "name" : "Bootstrap",<br>                   "orderby" : 7,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-8",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Node.js",<br>                   "name" : "Node.js",<br>                   "orderby" : 8,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-9",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Vue",<br>                   "name" : "Vue",<br>                   "orderby" : 9,<br>                   "parentid" : "1-1"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-1-10",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "其它",<br>                   "name" : "其它",<br>                   "orderby" : 10,<br>                   "parentid" : "1-1"<br>                }<br>             ],<br>             "id" : "1-1",<br>             "isLeaf" : null,<br>             "isShow" : null,<br>             "label" : "前端开发",<br>             "name" : "前端开发",<br>             "orderby" : 1,<br>             "parentid" : "1"<br>          },<br>          {<!-- --><br>             "childrenTreeNodes" : [<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-1",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "微信开发",<br>                   "name" : "微信开发",<br>                   "orderby" : 1,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-2",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "iOS",<br>                   "name" : "iOS",<br>                   "orderby" : 2,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-3",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "手游开发",<br>                   "name" : "手游开发",<br>                   "orderby" : 3,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-4",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Swift",<br>                   "name" : "Swift",<br>                   "orderby" : 4,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-5",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Android",<br>                   "name" : "Android",<br>                   "orderby" : 5,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-6",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "ReactNative",<br>                   "name" : "ReactNative",<br>                   "orderby" : 6,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-7",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "Cordova",<br>                   "name" : "Cordova",<br>                   "orderby" : 7,<br>                   "parentid" : "1-2"<br>                },<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-8",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "其它",<br>                   "name" : "其它",<br>                   "orderby" : 8,<br>                   "parentid" : "1-2"<br>                }<br>             ],<br>             "id" : "1-2",<br>             "isLeaf" : null,<br>             "isShow" : null,<br>             "label" : "移动开发",<br>             "name" : "移动开发",<br>             "orderby" : 2,<br>             "parentid" : "1"<br>          }<br>    ]</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">上边的数据格式是一个数组结构，数组的元素即为分类信息，分类信息设计两级分类，第一级的分类信息示例如下：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">JSON</span><br> "id" : "1-2",<br> "isLeaf" : null,<br> "isShow" : null,<br> "label" : "移动开发",<br> "name" : "移动开发",<br> "orderby" : 2,<br> "parentid" : "1"</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">第二级的分类是第一级分类中childrenTreeNodes属性，它是一个数组结构：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">JSON</span><br> {<!-- --><br> "id" : "1-2",<br> "isLeaf" : null,<br> "isShow" : null,<br> "label" : "移动开发",<br> "name" : "移动开发",<br> "orderby" : 2,<br> "parentid" : "1",<br> "childrenTreeNodes" : [<br>                {<!-- --><br>                   "childrenTreeNodes" : null,<br>                   "id" : "1-2-1",<br>                   "isLeaf" : null,<br>                   "isShow" : null,<br>                   "label" : "微信开发",<br>                   "name" : "微信开发",<br>                   "orderby" : 1,<br>                   "parentid" : "1-2"<br>                }<br>  }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">所以，定义一个DTO类表示分类信息的模型类，如下：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> package com.xuecheng.content.model.dto;<br><br> import com.xuecheng.content.model.po.CourseCategory;<br> import lombok.Data;<br><br> import java.io.Serializable;<br> import java.util.List;<br><br> /**<br>  * @description 课程分类树型结点dto<br>  * @author Mr.M<br>  * @date 2022/9/7 15:16<br>  * @version 1.0<br>  */<br> @Data<br> public class CourseCategoryTreeDto extends CourseCategory implements Serializable {<!-- --><br><br>   List&lt;CourseCategoryTreeDto&gt; childrenTreeNodes;<br> }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">接口定义如下：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> package com.xuecheng.content.api;<br><br> import com.xuecheng.content.model.dto.CourseCategoryTreeDto;<br> import com.xuecheng.content.service.CourseCategoryService;<br> import lombok.extern.slf4j.Slf4j;<br> import org.springframework.beans.factory.annotation.Autowired;<br> import org.springframework.web.bind.annotation.GetMapping;<br> import org.springframework.web.bind.annotation.RestController;<br><br> import java.util.List;<br><br> /**<br>  * &lt;p&gt;<br>  * 数据字典 前端控制器<br>  * &lt;/p&gt;<br>  *<br>  * @author itcast<br>  */<br> @Slf4j<br> @RestController<br> public class CourseCategoryController {<!-- --><br><br>     <br>     @GetMapping("/course-category/tree-nodes")<br>     public List&lt;CourseCategoryTreeDto&gt; queryTreeNodes() {<!-- --><br>        return null;<br>     }<br> }</p> </td></tr></tbody></table> 
<h3 style="margin-left:.0001pt;text-align:left;"><strong>4.3 接口开发</strong></h3> 
<h4 style="margin-left:.0001pt;text-align:left;"><strong>4.3.1 树型表查询</strong></h4> 
<p style="margin-left:.0001pt;text-align:left;">课程分类表是一个树型结构，其中parentid字段为父结点ID，它是树型结构的标志字段。</p> 
<p style="margin-left:.0001pt;text-align:left;">如果树的层级固定可以使用表的自链接去查询，比如：我们只查询两级课程分类，可以用下边的SQL</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> select<br>        one.id            one_id,<br>        one.name          one_name,<br>        one.parentid      one_parentid,<br>        one.orderby       one_orderby,<br>        one.label         one_label,<br>        two.id            two_id,<br>        two.name          two_name,<br>        two.parentid      two_parentid,<br>        two.orderby       two_orderby,<br>        two.label         two_label<br>    from course_category one<br>             inner join course_category two on one.id = two.parentid<br>    where one.parentid = 1<br>      and one.is_show = 1<br>      and two.is_show = 1<br>    order by one.orderby,<br>             two.orderby</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">如果树的层级不确定，此时可以使用MySQL递归实现，使用with语法，如下：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br>     <span style="color:#245bdb;">WITH</span> [RECURSIVE]<br>         cte_name [(col_name [, col_name] ...)] <span style="color:#245bdb;">AS</span> (subquery)<br>         [, cte_name [(col_name [, col_name] ...)] <span style="color:#245bdb;">AS</span> (subquery)] ...</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">cte_name :公共表达式的名称,可以理解为表名,用来表示as后面跟着的子查询</p> 
<p style="margin-left:.0001pt;text-align:left;">col_name :公共表达式包含的列名,可以写也可以不写</p> 
<p style="margin-left:.0001pt;text-align:left;">下边是一个递归的简单例子：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> with RECURSIVE t1  AS<br> (<br>   SELECT 1 as n<br>   UNION ALL<br>   SELECT n + 1 FROM t1 WHERE n &lt; 5<br> )<br> SELECT <em>* </em>FROM t1;</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">输出：<img alt="" height="234" src="https://images2.imgbox.com/44/42/L6OZnZXZ_o.png" width="209"></p> 
<p style="margin-left:.0001pt;text-align:left;">说明：</p> 
<p style="margin-left:.0001pt;text-align:left;">t1 相当于一个表名</p> 
<p style="margin-left:.0001pt;text-align:left;">select 1 相当于这个表的初始值，这里使用UNION ALL 将初始值加入到表中。</p> 
<p style="margin-left:.0001pt;text-align:left;">n&lt;5为递归执行的条件，当n&gt;=5时结束递归调用。</p> 
<p style="margin-left:.0001pt;text-align:left;">下边我们使用递归实现课程分类的查询</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> with recursive t1 as (<br> select <em>* </em>from  course_category p where  id= '1'<br> union all<br>  select t.* from course_category t inner join t1 on t1.<strong>id </strong>= t.parentid<br> )<br> select <em>*  </em>from t1 order by t1.id, t1.orderby</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">查询结果如下：<img alt="" height="303" src="https://images2.imgbox.com/c3/61/h5eHCCXG_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;">t1表中初始的数据是id等于1的记录，即根结点。</p> 
<p style="margin-left:.0001pt;text-align:left;">通过inner join t1 t2 on t2.id = t.parentid 找到id='1'的下级节点 。</p> 
<p style="margin-left:.0001pt;text-align:left;">通过这种方法就找到了id='1'的所有下级节点，下级节点包括了所有层级的节点。</p> 
<p style="margin-left:.0001pt;text-align:left;">上边这种方法是向下递归，即找到初始节点的所有下级节点。</p> 
<p style="margin-left:.0001pt;text-align:left;">如何向上递归？</p> 
<p style="margin-left:.0001pt;text-align:left;">下边的sql实现了向上递归：</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> with recursive t1 as (<br> select * from  course_category p where  id= '1-1-1'<br> union all<br>  select t.* from course_category t inner join t1 on t1.parentid = t.id<br> )<br> select <em>*  </em>from t1 order by t1.id, t1.orderby</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">初始节点为1-1-1，通过递归找到它的父级节点，父级节点包括所有级别的节点。</p> 
<p style="margin-left:.0001pt;text-align:left;">以上是我们研究了树型表的查询方法，通过递归的方式查询课程分类比较灵活，因为它可以不限制层级。</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">mysql为了避免无限递归默认递归次数为1000，可以通过设置cte_max_recursion_depth参数增加递归深度，还可以通过max_execution_time限制执行时间，超过此时间也会终止递归操作。</p> 
<p style="margin-left:.0001pt;text-align:left;">mysql递归相当于在存储过程中执行若干次sql语句，java程序仅与数据库建立一次链接执行递归操作，所以只要控制好递归深度，控制好数据量性能就没有问题。</p> 
<p style="margin-left:.0001pt;text-align:left;">思考：如果java程序在递归操作中连接数据库去查询数据组装数据，这个性能高吗？</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<h4 style="margin-left:.0001pt;text-align:left;"><strong>4.3.2 开发Mapper</strong></h4> 
<p style="margin-left:.0001pt;text-align:left;">下边我们可自定义mapper方法查询课程分类，最终将查询结果映射到List&lt;CourseCategoryTreeDto&gt;中。</p> 
<p style="margin-left:.0001pt;text-align:left;">生成课程分类表的mapper文件并拷贝至内容管理模块 的service工程中。<img alt="" height="547" src="https://images2.imgbox.com/58/a3/iaHXFgO7_o.png" width="663"></p> 
<p style="margin-left:.0001pt;text-align:left;">1、下边 定义一个mapper方法，并定义sql语句。</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> public interface CourseCategoryMapper extends BaseMapper&lt;CourseCategory&gt; {<!-- --><br>     public List&lt;CourseCategoryTreeDto&gt; selectTreeNodes(String id);<br> }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">2、找到对应 的mapper.xml文件，编写sql语句。</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> &lt;select id="selectTreeNodes" resultType="com.xuecheng.content.model.dto.CourseCategoryTreeDto" parameterType="string"&gt;<br>     with recursive t1 as (<br>         select * from  course_category p where  id= #{id}<br>         union all<br>         select t.* from course_category t inner join t1 on t1.id = t.parentid<br>     )<br>     select *  from t1 order by t1.id, t1.orderby<br><br> &lt;/select&gt;</p> </td></tr></tbody></table> 
<h4 style="margin-left:.0001pt;text-align:left;"><strong>4.3.3 开发service</strong></h4> 
<p style="margin-left:.0001pt;text-align:left;">定义service接口，调用mapper查询课程分类，遍历数据按照接口要求对数据进行封装</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> public interface CourseCategoryService {<!-- --><br>     <em>/**</em><br><em>     * 课程分类树形结构查询</em><br><em>     *</em><br><em>     * @return</em><br><em>     */</em><br><em>    </em>public List&lt;CourseCategoryTreeDto&gt; queryTreeNodes(String id);<br> }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;">编写service接口实现</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> @Slf4j<br> @Service<br> public class CourseCategoryServiceImpl implements CourseCategoryService {<!-- --><br><br>     @Autowired<br>     CourseCategoryMapper courseCategoryMapper;<br><br>     public List&lt;CourseCategoryTreeDto&gt; queryTreeNodes(String id) {<!-- --><br>        List&lt;CourseCategoryTreeDto&gt; courseCategoryTreeDtos = courseCategoryMapper.selectTreeNodes(id);<br>     //将list转map,以备使用,排除根节点<br>     Map&lt;String, CourseCategoryTreeDto&gt; mapTemp = courseCategoryTreeDtos.stream().filter(item-&gt;!id.equals(item.getId())).collect(Collectors.toMap(key -&gt; key.getId(), value -&gt; value, (key1, key2) -&gt; key2));<br>     //最终返回的list<br>     List&lt;CourseCategoryTreeDto&gt; categoryTreeDtos = new ArrayList&lt;&gt;();<br>     //依次遍历每个元素,排除根节点<br>     courseCategoryTreeDtos.stream().filter(item-&gt;!id.equals(item.getId())).forEach(item-&gt;{<!-- --><br>         if(item.getParentid().equals(id)){<!-- --><br>             categoryTreeDtos.add(item);<br>         }<br>         //找到当前节点的父节点<br>         CourseCategoryTreeDto courseCategoryTreeDto = mapTemp.get(item.getParentid());<br>         if(courseCategoryTreeDto!=null){<!-- --><br>             if(courseCategoryTreeDto.getChildrenTreeNodes() ==null){<!-- --><br>                 courseCategoryTreeDto.setChildrenTreeNodes(new ArrayList&lt;CourseCategoryTreeDto&gt;());<br>             }<br>             //下边开始往ChildrenTreeNodes属性中放子节点<br>             courseCategoryTreeDto.getChildrenTreeNodes().add(item);<br>         }<br>     });<br>     return categoryTreeDtos;<br>     }<br><br> }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;"><strong>4.3.4 单元测试</strong></p> 
<p style="margin-left:.0001pt;text-align:left;">定义单元测试类对service接口进行测试</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> @SpringBootTest<br> class CourseCategoryServiceTests {<!-- --><br><br>     @Autowired<br>     CourseCategoryService courseCategoryService;<br><br><br>     @Test<br>     void testqueryTreeNodes() {<!-- --><br>         List&lt;CourseCategoryTreeDto&gt; categoryTreeDtos = courseCategoryService.queryTreeNodes("1");<br>         System.<em>out</em>.println(categoryTreeDtos);<br>     }<br><br> }</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<h3 style="margin-left:.0001pt;text-align:left;"><strong>4.4 接口测试</strong></h3> 
<h4 style="margin-left:.0001pt;text-align:left;"><strong>4.4.1 接口层代码完善</strong></h4> 
<p style="margin-left:.0001pt;text-align:left;">完善controller方法，注入service调用业务层方法查询课程分类。</p> 
<table border="1" cellspacing="0" style="margin-left:-.6pt;"><tbody><tr><td style="background-color:#f5f6f7;width:425.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#646a73;">Java</span><br> package com.xuecheng.content.controller;<br><br> import com.xuecheng.content.model.dto.CourseCategoryTreeDto;<br> import com.xuecheng.content.model.po.Dictionary;<br> import com.xuecheng.content.service.CourseCategoryService;<br> import com.xuecheng.content.service.DictionaryService;<br> import lombok.extern.slf4j.Slf4j;<br> import org.springframework.beans.factory.annotation.Autowired;<br> import org.springframework.web.bind.annotation.GetMapping;<br> import org.springframework.web.bind.annotation.PathVariable;<br> import org.springframework.web.bind.annotation.RestController;<br><br> import java.util.List;<br><br> /**<br>  * &lt;p&gt;<br>  * 数据字典 前端控制器<br>  * &lt;/p&gt;<br>  *<br>  * @author itcast<br>  */<br> @Slf4j<br> @RestController<br> public class CourseCategoryController {<!-- --><br><br>     @Autowired<br>     CourseCategoryService courseCategoryService;<br><br>     @GetMapping("/course-category/tree-nodes")<br>     public List&lt;CourseCategoryTreeDto&gt; queryTreeNodes() {<!-- --><br>        return courseCategoryService.queryTreeNodes("1");<br>     }<br> }</p> </td></tr></tbody></table> 
<h4 style="margin-left:.0001pt;text-align:left;"><strong>4.4.2 测试接口</strong></h4> 
<p style="margin-left:.0001pt;text-align:left;">使用httpclient测试：</p> 
<p style="margin-left:.0001pt;text-align:left;">定义.http文件 <img alt="" height="118" src="https://images2.imgbox.com/66/c9/5zFnsuyr_o.png" width="709"></p> 
<p style="margin-left:.0001pt;text-align:left;">运行测试。</p> 
<p style="margin-left:.0001pt;text-align:left;">完成前后端连调：</p> 
<p style="margin-left:.0001pt;text-align:left;">打开前端工程，进入新增课程页面。</p> 
<p style="margin-left:.0001pt;text-align:left;">课程分类下拉框可以正常显示<img alt="" height="367" src="https://images2.imgbox.com/eb/16/0N6R5iS2_o.png" width="709"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a598f29244595e5226d2370ba2d35df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">探索设计模式的魅力：深入理解面向对象设计的深层原则与思维</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b9e4371b1f6bd0e2214c2ee211e2509/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaWeb篇——认识Servlet中重要的ServletContext对象，一篇文章帮你拿下 ！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>