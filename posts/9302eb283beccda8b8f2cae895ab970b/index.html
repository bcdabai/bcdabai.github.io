<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DehazeNet: An End-to-End System for Single Image Haze Removal（端到端的去雾模型） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DehazeNet: An End-to-End System for Single Image Haze Removal（端到端的去雾模型）" />
<meta property="og:description" content="1、论文去雾总体思路 DehazeNet是2016年华南理工大学的研究者提出的一个端到端的深度学习模型，该模型主要通过输入的原始有雾图像拟合出该图所对应的medium transmission map（透射率t值图），并使用引导滤波对t值进行refine，接着通过medium transmission map中前0.1%的值所对应的原始图像的RGB值的均值求取全局大气光值，利用现有的大气散射模型完成图像去雾操作。
文章的主要贡献:
1、通过特殊的网络设计构建了一个端到端的网络，利用原始雾天图像直接拟合对应的透射率图像t，进而达到去雾的目的
2、提出了一个非线性的双边整流线性激活函数模块（BReLu）,并验证了它的有效性（减少搜索空间，加速模型收敛）
3、建立了DehazeNet与现有的假设先验之间的联系，并解释了通过自动学习来优化和改善之前的先验假设
2、既有模型简介 2.1 大气散射模型 由上图可知，阳光在物体表面形成反射光 J(x)，反射光在穿过雾霾的过程中发生散射，只有部分能量 J(x)t(x) 能到达摄像头。与此同时，阳光也在悬浮颗粒表面散射形成大气光 α 被摄像头接收。因此，摄像头中的成像 I(x) 可由两部分组成，透射的物体亮度 J(x)t(x) 和散射的大气光照 α(1－t(x))。
大气散射模型是图像去雾的核心公式，由上述描述可知，最终到达镜头呈现出来的图像包含两部分：透射的物体亮度 J(x)t(x)以及散射的大气光照 α(1－t(x))，具体公式如下所示：
2.2 既有先验模型 （1）暗通道先验
参考之前的文章：Single Image Haze Removal Using Dark Channel Prior(暗通道先验)
（2）最大对比度方法
雾霾会降低物体成像的对比度：Σx‖ΔI(x)‖=tΣx‖ΔJ(x)‖≤Σx‖ΔJ(x)‖。因此，基于这个推论可利用局部对比度来近似估计雾霾的浓度。同时，也可以通过最大化局部对比度来还原图像的颜色和能见度
（3）颜色衰减先验
颜色衰减先验（CAP）是一种与暗通道先验（DCP）相似的先验特征。观察发现雾霾会同时导致图像饱和度的降低和亮度的增加，整体上表现为颜色的衰减。根据颜色衰减先验，亮度和饱和度的差值被应用于估计雾霾的浓度
（4）色调视差
3、DehazeNet总体概况 模型的整体架构包含四个大块，分别是特征提取，主要是通过卷积&#43;maxout激活函数；多尺度特征映射，主要借鉴xception网络，使用3、5、7三种不同大小的卷积获取不同感受野的特征并进行通道拼接；局部极值，利用maxpooling完成极值的求解；非线性回归，使用一个6*6的卷积&#43;BReLU完成非线性映射。
3.1 特征提取 传统图像提取特征都会需要一定的假设和先验，但是这些手工设计的或者假设的特征并不是在所有情况下都适用。在观察了暗通道先验、最大对比度先验、颜色衰减先验的实现原理后，作者提出可以使用相对应的卷积核去卷积原始图像并加上非线性激活后的特征等效代替上述先验特征。此处使用maxout激活函数主要是将通道分段，提取不同的通道的最大值，结合不同的卷积核，可以得到类似暗通道先验、最大对比度先验、颜色衰减先验等的效果，并且可以带来更强的拟合性能。
此处的卷积使用的是5*5的卷积核，输入是3通道输出是原始输入图片的宽（输入数据大小16*16），激活函数是maxout，该激活函数和普通的激活函数不太一样，如下为对比
对于普通的激活函数，z=w*x&#43;b而言，out=f(z)，其中f就是我们常用的激活函数，比如ReLU,Sigmod等
针对maxout不一样的点在于，如果我们设置maxout的组数K为5，则会在每个神经元的前面多出一层，这一层有5个神经元，如下图所示。
那么maxout的计算公式就变成了：
z1=w1x&#43;b1
z2=w2x&#43;b2
z3=w3x&#43;b3
z4=w4x&#43;b4
z5=w5*x&#43;b5
最终的输出为out = max(z1,z2,z3,z4,z5)
差别就在于：常规的激活函数主要针对单个神经元，比如ReLU，输出的max(0,x)；而针对maxout这样的激活函数，是将多个神经元分为一组，整体求最大值。maxout相对其它激活拥有更好的拟合效果
3.2 多尺度映射 多尺度特征在图像去雾中应用广泛，原因是它可以获取尺度不变性，使得获取的特征更加鲁棒，受inception模块的启发，作者使用3*3,5*5以及7*7的卷积核去获取不同的特征，并进行聚合，增强特征对多尺度物体的泛化能力。
3.3 局部极值 使用局部极值的原因类似于其它先验算法里面的假定局部透射率不变作用一样，文中使用maxpool去代替之前的局部透射率不变先验操作，这里使用的是7*7的局部区域。
3.4 非线性回归 图像恢复领域，最后一层的输出值一般是上限和下限处于一个小范围的，sigmoid以及relu都不太适合作为激活函数，前者由于梯度爆炸问题，后者由于无上限都不适合，本文提出使用BReLU激活函数，限制激活后的值处于tmin以及tmax之间，实际有点类似Hardtanh函数，作者在实现的时候也是继承这个函数去实现的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9302eb283beccda8b8f2cae895ab970b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-09T23:18:50+08:00" />
<meta property="article:modified_time" content="2023-11-09T23:18:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DehazeNet: An End-to-End System for Single Image Haze Removal（端到端的去雾模型）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1、论文去雾总体思路</h3> 
<p>DehazeNet是2016年华南理工大学的研究者提出的一个端到端的深度学习模型，该模型主要通过输入的原始有雾图像拟合出该图所对应的medium transmission map（透射率t值图），并使用引导滤波对t值进行refine，接着通过medium transmission map中前0.1%的值所对应的原始图像的RGB值的均值求取全局大气光值，利用现有的大气散射模型完成图像去雾操作。</p> 
<p>文章的主要贡献:<br> 1、通过特殊的网络设计构建了一个端到端的网络，利用原始雾天图像直接拟合对应的透射率图像t，进而达到去雾的目的<br> 2、提出了一个非线性的双边整流线性激活函数模块（BReLu）,并验证了它的有效性（减少搜索空间，加速模型收敛）<br> 3、建立了DehazeNet与现有的假设先验之间的联系，并解释了通过自动学习来优化和改善之前的先验假设</p> 
<h3><a id="2_7"></a>2、既有模型简介</h3> 
<h4><a id="21__8"></a>2.1 大气散射模型</h4> 
<p><img src="https://images2.imgbox.com/3f/b2/wMWKgwnI_o.png" alt="在这里插入图片描述"><br> 由上图可知，阳光在物体表面形成反射光 J(x)，反射光在穿过雾霾的过程中发生散射，只有部分能量 J(x)t(x) 能到达摄像头。与此同时，阳光也在悬浮颗粒表面散射形成大气光 α 被摄像头接收。因此，摄像头中的成像 I(x) 可由两部分组成，<strong>透射的物体亮度 J(x)t(x)</strong> 和<strong>散射的大气光照 α(1－t(x))</strong>。</p> 
<p>大气散射模型是图像去雾的核心公式，由上述描述可知，最终到达镜头呈现出来的图像包含两部分：<strong>透射的物体亮度 J(x)t(x)<strong>以及</strong>散射的大气光照 α(1－t(x))</strong>，具体公式如下所示：<br> <img src="https://images2.imgbox.com/4d/d5/TOCUhMqN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__14"></a>2.2 既有先验模型</h3> 
<p>（1）暗通道先验<br> <img src="https://images2.imgbox.com/c5/46/PGIHvsAH_o.png" alt="在这里插入图片描述"><br> 参考之前的文章：<a href="https://blog.csdn.net/caobin_cumt/article/details/134256376">Single Image Haze Removal Using Dark Channel Prior(暗通道先验)</a><br> （2）最大对比度方法<br> 雾霾会降低物体成像的对比度：Σx‖ΔI(x)‖=tΣx‖ΔJ(x)‖≤Σx‖ΔJ(x)‖。因此，基于这个推论可利用局部对比度来近似估计雾霾的浓度。同时，也可以通过最大化局部对比度来还原图像的颜色和能见度<br> <img src="https://images2.imgbox.com/4d/55/656fVPzF_o.png" alt="在这里插入图片描述"><br> （3）颜色衰减先验<br> 颜色衰减先验（CAP）是一种与暗通道先验（DCP）相似的先验特征。观察发现雾霾会同时导致图像饱和度的降低和亮度的增加，整体上表现为颜色的衰减。根据颜色衰减先验，亮度和饱和度的差值被应用于估计雾霾的浓度<br> <img src="https://images2.imgbox.com/6f/44/CbJDhN5X_o.png" alt="在这里插入图片描述"><br> （4）色调视差<br> <img src="https://images2.imgbox.com/15/3e/wyKZEaNc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3DehazeNet_26"></a>3、DehazeNet总体概况</h3> 
<p><img src="https://images2.imgbox.com/46/b6/v1MSU0YQ_o.png" alt="在这里插入图片描述"><br> 模型的整体架构包含四个大块，分别是<strong>特征提取</strong>，主要是通过卷积+maxout激活函数；<strong>多尺度特征映射</strong>，主要借鉴xception网络，使用3、5、7三种不同大小的卷积获取不同感受野的特征并进行通道拼接；<strong>局部极值</strong>，利用maxpooling完成极值的求解；<strong>非线性回归</strong>，使用一个6*6的卷积+BReLU完成非线性映射。</p> 
<h4><a id="31__30"></a>3.1 特征提取</h4> 
<p>传统图像提取特征都会需要一定的假设和先验，但是这些手工设计的或者假设的特征并不是在所有情况下都适用。在观察了暗通道先验、最大对比度先验、颜色衰减先验的实现原理后，作者提出可以使用相对应的卷积核去卷积原始图像并加上非线性激活后的特征等效代替上述先验特征。此处使用maxout激活函数主要是将通道分段，提取不同的通道的最大值，结合不同的卷积核，可以得到类似暗通道先验、最大对比度先验、颜色衰减先验等的效果，并且可以带来更强的拟合性能。<br> <img src="https://images2.imgbox.com/72/fe/nymdzhc2_o.png" alt="在这里插入图片描述"><br> 此处的卷积使用的是5*5的卷积核，输入是3通道输出是原始输入图片的宽（输入数据大小16*16），激活函数是maxout，该激活函数和普通的激活函数不太一样，如下为对比<br> <img src="https://images2.imgbox.com/d8/89/WpPgyyZR_o.png" alt="在这里插入图片描述"><br> 对于普通的激活函数，z=w*x+b而言，out=f(z)，其中f就是我们常用的激活函数，比如ReLU,Sigmod等</p> 
<p>针对maxout不一样的点在于，如果我们设置maxout的组数K为5，则会在每个神经元的前面多出一层，这一层有5个神经元，如下图所示。<br> <img src="https://images2.imgbox.com/84/5e/imThrquD_o.png" alt="在这里插入图片描述"><br> 那么maxout的计算公式就变成了：<br> z1=w1<em>x+b1<br> z2=w2</em>x+b2<br> z3=w3<em>x+b3<br> z4=w4</em>x+b4<br> z5=w5*x+b5<br> 最终的输出为out = max(z1,z2,z3,z4,z5)</p> 
<p><em><strong>差别就在于</strong></em>：常规的激活函数主要针对单个神经元，比如ReLU，输出的max(0,x)；而针对maxout这样的激活函数，是将多个神经元分为一组，整体求最大值。maxout相对其它激活拥有更好的拟合效果</p> 
<h4><a id="32__48"></a>3.2 多尺度映射</h4> 
<p>多尺度特征在图像去雾中应用广泛，原因是它可以获取尺度不变性，使得获取的特征更加鲁棒，受inception模块的启发，作者使用3*3,5*5以及7*7的卷积核去获取不同的特征，并进行聚合，增强特征对多尺度物体的泛化能力。</p> 
<h4><a id="33__51"></a>3.3 局部极值</h4> 
<p>使用局部极值的原因类似于其它先验算法里面的假定局部透射率不变作用一样，文中使用maxpool去代替之前的局部透射率不变先验操作，这里使用的是7*7的局部区域。</p> 
<h4><a id="34__54"></a>3.4 非线性回归</h4> 
<p>图像恢复领域，最后一层的输出值一般是上限和下限处于一个小范围的，sigmoid以及relu都不太适合作为激活函数，前者由于梯度爆炸问题，后者由于无上限都不适合，本文提出使用BReLU激活函数，限制激活后的值处于tmin以及tmax之间，实际有点类似Hardtanh函数，作者在实现的时候也是继承这个函数去实现的。<br> <img src="https://images2.imgbox.com/7f/98/69uVICuQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="35__57"></a>3.5 网络设计结构</h4> 
<p><img src="https://images2.imgbox.com/39/44/F3jvxA9q_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="36__59"></a>3.6 存在的问题以及后续改进</h4> 
<p>1、全局大气光值A不能当作一个常量对待，后续可以像学习透射率转换参数t一样包含在统一的网络中进行学习<br> 2、大气散射模型也可以通过模型直接学习，完全摒弃人工设计</p> 
<h3><a id="4_62"></a>4、参考源码</h3> 
<p><a href="https://github.com/zlinker/DehazeNet/blob/master/DehazeNet.py">https://github.com/zlinker/DehazeNet/blob/master/DehazeNet.py</a><br> <a href="https://github.com/thuBingo/DehazeNet_Pytorch">https://github.com/thuBingo/DehazeNet_Pytorch</a><br> <a href="https://blog.csdn.net/hjimce/article/details/50414467">深度学习（二十三）Maxout网络学习</a></p> 
<p>下述代码是实现DehazeNet的网络结构，总体比较简单，需要引起注意的是maxout以及BReLU的实现。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">BRelu</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Hardtanh<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>BRelu<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> inplace<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">extra_repr</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        inplace_str <span class="token operator">=</span> <span class="token string">'inplace=True'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>inplace <span class="token keyword">else</span> <span class="token string">''</span>
        <span class="token keyword">return</span> inplace_str

<span class="token keyword">class</span> <span class="token class-name">DehazeNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> groups<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>DehazeNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">input</span>
        self<span class="token punctuation">.</span>groups <span class="token operator">=</span> groups
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>maxpool <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>brelu <span class="token operator">=</span> BRelu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>named_modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">Maxout</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> groups<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> groups<span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> groups<span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        out <span class="token operator">=</span> x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> out

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>Maxout<span class="token punctuation">(</span>out<span class="token punctuation">,</span> self<span class="token punctuation">.</span>groups<span class="token punctuation">)</span>
        out1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        y <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>out1<span class="token punctuation">,</span> out2<span class="token punctuation">,</span> out3<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>maxpool<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>brelu<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y <span class="token operator">=</span> y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> y

</code></pre> 
<p><strong>文中生成数据集的小tips：</strong></p> 
<p><img src="https://images2.imgbox.com/2b/05/YZ6y1Df3_o.png" alt="在这里插入图片描述"><br> 由上述文献可知：使用一张无雾的图片J(x)，随机设置透射率参数t，并将全局大气光A设置为1，可以直接获取带雾图片，顺带还可以获取相应透射率参数作为训练获取的gt值。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/933812a3cf87f8e722b978e8541bc87a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Leetcode】383. 赎金信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c64c66dc2c1f0a7a77b16a63df5f154b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java面试题-Redis-第四天（线程模型一)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>