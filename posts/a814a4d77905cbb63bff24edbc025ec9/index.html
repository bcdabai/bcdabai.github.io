<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FlinkSql on yarn 提交踩坑记录 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FlinkSql on yarn 提交踩坑记录" />
<meta property="og:description" content="FlinkSql on yarn 提交踩坑记录 最近需要实现一个flinksql执行引擎，实现前台只需关注sql编写，后台自动提交flinksql到yarn集群中，由于初次接触flinksql，对flinksql研究不深，在实现过程中遇到很多问题。其中一个问题研究了挺长时间，相信很多初次玩flinksql的朋友们也会遇到这个问题，所以在这里分享一下问题的解决方法。
我是在本地跑通了flinksql的kafka to mysql案例，准备通过flink run 命令提交到yarn集群执行，结果遇到如下问题：
------------------------------------------------------------
The program finished with the following exception:
org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: findAndCreateTableSource failed.
at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:335)
at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:205)
at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:138)
at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:662)
at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:210)
at org.apache.flink.client.cli.CliFrontend.parseParameters(CliFrontend.java:893)
at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:966)
at java.security.AccessController.doPrivileged(Native Method)
at javax.security.auth.Subject.doAs(Subject.java:422)
at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1754)
at org.apache.flink.runtime.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:966)
Caused by: org.apache.flink.table.api.TableException: findAndCreateTableSource failed.
at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSource(TableFactoryUtil.java:55)
at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSource(TableFactoryUtil.java:92)
at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.findAndCreateTableSource(CatalogSourceTable.scala:162)
at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.tableSource$lzycompute(CatalogSourceTable.scala:65)
at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.tableSource(CatalogSourceTable.scala:65)
at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.toRel(CatalogSourceTable.scala:82)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a814a4d77905cbb63bff24edbc025ec9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-01T22:17:33+08:00" />
<meta property="article:modified_time" content="2020-08-01T22:17:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FlinkSql on yarn 提交踩坑记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><strong><strong><strong>                                         FlinkSql on yarn 提交踩坑记录</strong></strong></strong></h4> 
<p style="margin-left:0pt;">    最近需要实现一个flinksql执行引擎，实现前台只需关注sql编写，后台自动提交flinksql到yarn集群中，由于初次接触flinksql，对flinksql研究不深，在实现过程中遇到很多问题。其中一个问题研究了挺长时间，相信很多初次玩flinksql的朋友们也会遇到这个问题，所以在这里分享一下问题的解决方法。</p> 
<p style="margin-left:0pt;">    我是在本地跑通了flinksql的kafka to mysql案例，准备通过flink run 命令提交到yarn集群执行，结果遇到如下问题：</p> 
<p style="margin-left:0pt;">------------------------------------------------------------</p> 
<p style="margin-left:0pt;"> The program finished with the following exception:</p> 
<p style="margin-left:0pt;"> </p> 
<p style="margin-left:0pt;">org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: findAndCreateTableSource failed.</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:335)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:205)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:138)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:662)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:210)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.cli.CliFrontend.parseParameters(CliFrontend.java:893)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:966)</p> 
<p style="margin-left:0pt;">        at java.security.AccessController.doPrivileged(Native Method)</p> 
<p style="margin-left:0pt;">        at javax.security.auth.Subject.doAs(Subject.java:422)</p> 
<p style="margin-left:0pt;">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1754)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.runtime.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:966)</p> 
<p style="margin-left:0pt;">Caused by: org.apache.flink.table.api.TableException: findAndCreateTableSource failed.</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSource(TableFactoryUtil.java:55)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSource(TableFactoryUtil.java:92)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.findAndCreateTableSource(CatalogSourceTable.scala:162)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.tableSource$lzycompute(CatalogSourceTable.scala:65)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.tableSource(CatalogSourceTable.scala:65)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.toRel(CatalogSourceTable.scala:82)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.toRel(SqlToRelConverter.java:3328)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertIdentifier(SqlToRelConverter.java:2357)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertFrom(SqlToRelConverter.java:2051)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertFrom(SqlToRelConverter.java:2005)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertSelectImpl(SqlToRelConverter.java:646)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertSelect(SqlToRelConverter.java:627)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertQueryRecursive(SqlToRelConverter.java:3181)</p> 
<p style="margin-left:0pt;">        at org.apache.calcite.sql2rel.SqlToRelConverter.convertQuery(SqlToRelConverter.java:563)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.calcite.FlinkPlannerImpl.org$apache$flink$table$planner$calcite$FlinkPlannerImpl$$rel(FlinkPlannerImpl.scala:148)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.calcite.FlinkPlannerImpl.rel(FlinkPlannerImpl.scala:135)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.operations.SqlToOperationConverter.toQueryOperation(SqlToOperationConverter.java:535)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.operations.SqlToOperationConverter.convertSqlQuery(SqlToOperationConverter.java:439)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.operations.SqlToOperationConverter.convert(SqlToOperationConverter.java:157)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.planner.delegation.ParserImpl.parse(ParserImpl.java:66)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.table.api.internal.TableEnvironmentImpl.sqlQuery(TableEnvironmentImpl.java:464)</p> 
<p style="margin-left:0pt;">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</p> 
<p style="margin-left:0pt;">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</p> 
<p style="margin-left:0pt;">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</p> 
<p style="margin-left:0pt;">        at java.lang.reflect.Method.invoke(Method.java:498)</p> 
<p style="margin-left:0pt;">        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:321)</p> 
<p style="margin-left:0pt;">        ... 11 more</p> 
<p style="margin-left:0pt;">Caused by: org.apache.flink.table.api.NoMatchingTableFactoryException: Could not find a suitable table factory for 'org.apache.flink.table.factories.TableSourceFactory' in</p> 
<p style="margin-left:0pt;">the classpath.</p> 
<p style="margin-left:0pt;"> </p> 
<p style="margin-left:0pt;">Reason: Required context properties mismatch.</p> 
<p style="margin-left:0pt;"> </p> 
<p style="margin-left:0pt;">The matching candidates:</p> 
<p style="margin-left:0pt;">org.apache.flink.table.sources.CsvAppendTableSourceFactory</p> 
<p style="margin-left:0pt;">Mismatched properties:</p> 
<p style="margin-left:0pt;">'connector.type' expects 'filesystem', but is 'kafka'</p> 
<p style="margin-left:0pt;">'format.type' expects 'csv', but is 'json'</p> 
<p style="margin-left:0pt;"> </p> 
<p style="margin-left:0pt;">The following properties are requested:</p> 
<p style="margin-left:0pt;">connector.properties.bootstrap.servers=172.31.100.21:9092</p> 
<p style="margin-left:0pt;">connector.properties.zookeeper.connect=172.31.96.26:2181</p> 
<p style="margin-left:0pt;">connector.startup-mode=earliest-offset</p> 
<p style="margin-left:0pt;">connector.topic=test1</p> 
<p style="margin-left:0pt;">connector.type=kafka</p> 
<p style="margin-left:0pt;">connector.version=universal</p> 
<p style="margin-left:0pt;">format.derive-schema=true</p> 
<p style="margin-left:0pt;">format.type=json</p> 
<p style="margin-left:0pt;">schema.0.data-type=VARCHAR(2147483647)</p> 
<p style="margin-left:0pt;">schema.0.name=address</p> 
<p style="margin-left:0pt;">schema.1.data-type=VARCHAR(2147483647)</p> 
<p style="margin-left:0pt;">schema.1.name=age</p> 
<p style="margin-left:0pt;">schema.2.data-type=VARCHAR(2147483647)</p> 
<p style="margin-left:0pt;">schema.2.name=city</p> 
<p style="margin-left:0pt;">schema.3.data-type=VARCHAR(2147483647)</p> 
<p style="margin-left:0pt;">schema.3.name=name</p> 
<p style="margin-left:0pt;">update-mode=append</p> 
<p style="margin-left:0pt;">刚开始以为是jar包冲突问题，但是发现无论怎么排除冲突都无法解决这个问题。不过最终找到了解决方法。</p> 
<p style="margin-left:0pt;">1、首先排除与flink安装目录 lib下相同的jar包</p> 
<p style="margin-left:0pt;">2、更改maven 打包配置，maven打包配置如下，重点是红色下划线部分，原因是由于JDK的服务发现机制是基于META-INF/services/目录的，如果同一接口存在多个实现需要合并 ，则可以使用此Transformer。</p> 
<p style="margin-left:0pt;"><span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>plugin</strong></span></strong><span style="color:#000000;">&gt;</span><br>     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>groupId</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">org.apache.maven.plugins</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>groupId</strong></span></strong><span style="color:#000000;">&gt;</span><br>     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>artifactId</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">maven-shade-plugin</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>artifactId</strong></span></strong><span style="color:#000000;">&gt;</span><br>     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>version</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">2.4.1</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>version</strong></span></strong><span style="color:#000000;">&gt;</span><br>     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>executions</strong></span></strong><span style="color:#000000;">&gt;</span><br>         <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>execution</strong></span></strong><span style="color:#000000;">&gt;</span><br>             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>phase</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">package</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>phase</strong></span></strong><span style="color:#000000;">&gt;</span><br>             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>goals</strong></span></strong><span style="color:#000000;">&gt;</span><br>                 <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>goal</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">shade</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>goal</strong></span></strong><span style="color:#000000;">&gt;</span><br>             <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>goals</strong></span></strong><span style="color:#000000;">&gt;</span><br>             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>configuration</strong></span></strong><span style="color:#000000;">&gt;</span><br>                 <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>filters</strong></span></strong><span style="color:#000000;">&gt;</span><br>                     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>filter</strong></span></strong><span style="color:#000000;">&gt;</span><br>                         <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>artifact</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">*:*</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>artifact</strong></span></strong><span style="color:#000000;">&gt;</span><br>                         <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>excludes</strong></span></strong><span style="color:#000000;">&gt;</span><br>                             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">META-INF/*.SF</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><br>                             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">META-INF/*.DSA</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><br>                             <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><span style="color:#000000;">META-INF/*.RSA</span><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>exclude</strong></span></strong><span style="color:#000000;">&gt;</span><br>                         <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>excludes</strong></span></strong><span style="color:#000000;">&gt;</span><br>                     <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>filter</strong></span></strong><span style="color:#000000;">&gt;</span><br>                 <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>filters</strong></span></strong><span style="color:#000000;">&gt;</span><br>                 <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>transformers</strong></span></strong><span style="color:#000000;">&gt;</span><br>                     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>transformer </strong></span></strong><strong><span style="color:#0000ff;"><strong>implementation</strong></span></strong><strong><span style="color:#008000;"><strong>="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</strong></span></strong><span style="color:#000000;">&gt;</span><br>                     <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>transformer</strong></span></strong><span style="color:#000000;">&gt;</span><br>                     <span style="color:#000000;">&lt;</span><strong><span style="color:#000080;"><strong>transformer </strong></span></strong><strong><span style="color:#0000ff;"><strong>implementation</strong></span></strong><strong><span style="color:#008000;"><strong>="</strong></span></strong><strong><u><span style="color:#c00000;"><strong><u>org.apache.maven.plugins.shade.resource.ServicesResourceTransformer</u></strong></span></u></strong><strong><span style="color:#008000;"><strong>"</strong></span></strong><span style="color:#000000;">/&gt;</span><br>                 <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>transformers</strong></span></strong><span style="color:#000000;">&gt;</span><br>             <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>configuration</strong></span></strong><span style="color:#000000;">&gt;</span><br>         <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>execution</strong></span></strong><span style="color:#000000;">&gt;</span><br>     <span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>executions</strong></span></strong><span style="color:#000000;">&gt;</span><br><span style="color:#000000;">&lt;/</span><strong><span style="color:#000080;"><strong>plugin</strong></span></strong><span style="color:#000000;">&gt;</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa779b15655e193a1520eaa07421808a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iptables详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7525696060363c56e7c639a939ee9563/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">surf和sift算法被申请专利后部分opencv版本无法使用后的安装pycharm&#43;opencv使用surf和sift算法教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>