<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【狂神说】Docker 学习笔记【基础篇】 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【狂神说】Docker 学习笔记【基础篇】" />
<meta property="og:description" content="学习思想而非学技术，技术日新月异，唯有思想长盛不衰，润泽后生
学习资料：
【狂神说Java】Docker最新超详细版教程通俗易懂_哔哩哔哩_bilibili
Docker快速入门总结笔记_huangjhai的博客-CSDN博客
(74条消息) docker 进阶 之容器数据卷 DockerFile Docker网络 — 狂神说_cheng的博客-CSDN博客
官网：https://www.docker.com/
文档地址： https://docs.docker.com/ （Docker 官网文档超级详细）
仓库地址：https://hub.docker.com/
Docker中文文档 Docker概述-DockerInfo
Docker 中文文档（译）_nickDaDa的博客-CSDN博客_docker中文文档
1、Docker概述 1.1 Docker 为什么会出现 一款产品上线：面临问题：
问题1：开发 和 上线 俩套环境
问题2：开发人员 和 运维人员 ，开发测试可运行，上线就运行不了
问题3：环境配置十分麻烦，每个机器都要部署环境（集群 Redis、ES、Hadoop 等等）
问题4： 发布 jar包 时 又要 部署（Mysql、ES、Redis、jdk 等等）费时的环境，希望jar &#43; 环境一起发布
问题5：部署的环境不能跨平台 windows 与 Linux
Docker 给以上问题提出了解决方案
传统：开发打jar包 给运维来部署
现在：开发即负责打包又负责部署，全栈开发
开发人员 打jar包带上环境（这里的环境称为镜像） – Docker 仓库（商店） – 运维人员下载 镜像 可直接运行
docker 的 思想 来源于 集装箱 ，打包装箱，相互隔离" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1a8dd3882a7494a2cb726bcf7db70722/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-11T15:36:31+08:00" />
<meta property="article:modified_time" content="2022-02-11T15:36:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【狂神说】Docker 学习笔记【基础篇】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>学习思想而非学技术，技术日新月异，唯有思想长盛不衰，润泽后生</p> 
</blockquote> 
<p>学习资料：</p> 
<p><a href="https://www.bilibili.com/video/BV1og4y1q7M4" rel="nofollow">【狂神说Java】Docker最新超详细版教程通俗易懂_哔哩哔哩_bilibili</a></p> 
<p><a href="https://blog.csdn.net/huangjhai/article/details/118854733">Docker快速入门总结笔记_huangjhai的博客-CSDN博客</a></p> 
<p><a href="https://blog.csdn.net/xiaozecheng/article/details/106165491">(74条消息) docker 进阶 之容器数据卷 DockerFile Docker网络 — 狂神说_cheng的博客-CSDN博客</a></p> 
<p>官网：https://www.docker.com/</p> 
<p>文档地址： https://docs.docker.com/ （Docker 官网文档超级详细）</p> 
<p>仓库地址：https://hub.docker.com/</p> 
<p><a href="http://www.dockerinfo.net/document" rel="nofollow">Docker中文文档 Docker概述-DockerInfo</a></p> 
<p><a href="https://blog.csdn.net/nickDaDa/article/details/88716395"> Docker 中文文档（译）_nickDaDa的博客-CSDN博客_docker中文文档</a></p> 
<h2><a id="1Docker_26"></a>1、Docker概述</h2> 
<h3><a id="11_Docker__28"></a>1.1 Docker 为什么会出现</h3> 
<blockquote> 
 <p>一款产品上线：面临问题：</p> 
</blockquote> 
<p>问题1：开发 和 上线 俩套环境</p> 
<p>问题2：开发人员 和 运维人员 ，开发测试可运行，上线就运行不了</p> 
<p>问题3：环境配置十分麻烦，每个机器都要部署环境（集群 Redis、ES、Hadoop 等等）</p> 
<p>问题4： 发布 jar包 时 又要 部署（Mysql、ES、Redis、jdk 等等）费时的环境，希望jar + 环境一起发布</p> 
<p>问题5：部署的环境不能跨平台 windows 与 Linux</p> 
<p><strong>Docker 给以上问题提出了解决方案</strong></p> 
<p>传统：开发打jar包 给运维来部署</p> 
<p>现在：开发即负责打包又负责部署，全栈开发</p> 
<p>开发人员 打jar包带上环境（这里的环境称为<strong>镜像</strong>） – Docker 仓库（商店） – 运维人员下载 <strong>镜像</strong> 可直接运行</p> 
<p><img src="https://images2.imgbox.com/48/c9/MKvV11tm_o.png" alt="在这里插入图片描述"></p> 
<p>docker 的 思想 来源于 集装箱 ，打包装箱，相互隔离</p> 
<p><strong>虚拟机非常笨重，而docker十分小巧。</strong></p> 
<p>开源：开放源代码</p> 
<h3><a id="12_Docker_65"></a>1.2 Docker的概述</h3> 
<blockquote> 
 <p>1、基本介绍</p> 
</blockquote> 
<p>​ Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。</p> 
<p>​ Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p> 
<p>​ 容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p> 
<p>​ Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版），我们用社区版就可以了。</p> 
<p>官网：https://www.docker.com/</p> 
<p>文档地址： https://docs.docker.com/ （<strong>Docker 官网文档超级详细</strong>）</p> 
<p>仓库地址：https://hub.docker.com/</p> 
<blockquote> 
 <p>2、应用场景</p> 
</blockquote> 
<p>​ Web 应用的自动化打包和发布。</p> 
<p>​ 自动化测试和持续集成、发布。</p> 
<p>​ 在服务型环境中部署和调整数据库或其他的后台应用。</p> 
<p>​ 从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</p> 
<blockquote> 
 <p>3、Docker 的优势</p> 
</blockquote> 
<p>​ Docker 是一个用于开发，交付和运行应用程序的开放平台。Docker 使您能够将应用程序与基础架构分开，从而可以快速交付软件。借助 Docker，您可以与管理应用程序相同的方式来管理基础架构。通过利用 Docker 的方法来快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p> 
<p>(1) 快速，一致地交付您的应用程序。</p> 
<p>​ Docker 允许开发人员使用您提供的应用程序或服务的本地容器在标准化环境中工作，从而简化了开发的生命周期。</p> 
<p>​ 容器非常适合持续集成和持续交付（CI / CD）工作流程，请考虑以下示例方案：</p> 
<p>​ 您的开发人员在本地编写代码，并使用 Docker 容器与同事共享他们的工作。他们使用 Docker 将其应用程序推送到测试环境中，并执行自动或手动测试。当开发人员发现错误时，他们可以在开发环境中对其进行修复，然后将其重新部署到测试环境中，以进行测试和验证。测试完成后，将修补程序推送给生产环境，就像将更新的镜像推送到生产环境一样简单。</p> 
<p>(2) 响应式部署和扩展<br> Docker 是基于容器的平台，允许高度可移植的工作负载。Docker 容器可以在开发人员的本机上，数据中心的物理或虚拟机上，云服务上或混合环境中运行。</p> 
<p>​ Docker 的可移植性和轻量级的特性，还可以使您轻松地完成动态管理的工作负担，并根据业务需求指示，实时扩展或拆除应用程序和服务。</p> 
<p>(3) 在同一硬件上运行更多工作负载<br> Docker 轻巧快速。它为基于虚拟机管理程序的虚拟机提供了可行、经济、高效的替代方案，因此您可以利用更多的计算能力来实现业务目标。Docker 非常适合于高密度环境以及中小型部署，而您可以用更少的资源做更多的事情。</p> 
<h2><a id="2__115"></a>2、 虚拟化技术和容器化技术</h2> 
<p>​ 虚拟化技术特点：1.资源占用多 2.冗余步骤多 3.启动很慢</p> 
<p>​ 容器化技术：容器化技术不是模拟的一个完整的操作系统</p> 
<p>​ 虚拟机非常笨重，而docker十分小巧。</p> 
<blockquote> 
 <p>比较Docker和虚拟机的不同：</p> 
</blockquote> 
<ul><li>传统虚拟机：</li></ul> 
<p>​ 虚拟出硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</p> 
<ul><li>Docker容器 ：</li></ul> 
<p>​ Docker容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟硬件。</p> 
<p>​ 每个容器都是相互隔离的，每个容器都有属于自己的文件系统，互不影响。</p> 
<blockquote> 
 <p>DevOps (Dev:开发，Ops:运维)</p> 
</blockquote> 
<p>容器化带来的好处：</p> 
<ul><li>应用更快速的交付和部署<br> 传统：一堆帮助文档，安装程序<br> Docker :打包镜像发布测试，一键运行</li><li>更便捷的升级和扩缩容<br> 使用了Docker之后，我们部署应用就和搭积木一样！<br> 项目打包为一个镜像，扩展服务器A !服务器B</li><li>更简单的系统运维<br> 在容器化之后，我们的开发，测试环境都是高度一致的.</li><li>更高效的计算资源利用：<br> Docker是内核级别的虚拟化，可以再一个物理机上可以运行很多的容器实例！服务器的性能可以被压榨到极致。</li></ul> 
<h2><a id="3_Docker_152"></a>3、 Docker的基本组成</h2> 
<blockquote> 
 <p>Docker的基本组成图如下：</p> 
</blockquote> 
<p>Client:客户端</p> 
<p>DOCKER_HOST:docker的主机（服务器）</p> 
<p>Registry: 远程仓库</p> 
<p><img src="https://images2.imgbox.com/de/e0/aUmHgRZv_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>基本组成</p> 
</blockquote> 
<ul><li> <p>镜像(image ):<br> docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，tomcat镜像==&gt; run ==&gt; tomcatOI容器(提供服务器)，通过这个镜像可以创建多个容器(最终服务运行或者项目运行就是在容器中的).</p> <p>​ 开发人员 打jar包带上环境（这里的环境称为<strong>镜像</strong>）</p> </li><li> <p>容器(container ):<br> Docker用容器技术，独立运行Y或者一个组应用，通过镜像来创建的。启动，停止，删除，基本命令！目前就可以把这个容器理解为就是一个简易的linux系统</p> <p><strong>镜像启动后出现容器</strong></p> <p>（镜像相当于类，容器相当于实例。一个镜像可以创建多个容器）</p> </li><li> <p>仓库(repository ):<br> 仓库就是存放镜像的地方！仓库分为公有仓库和私有仓库！Docker Hub (默认是国外的)</p> </li></ul> 
<h2><a id="4_Docker_183"></a>4、 Docker的安装</h2> 
<p><a href="https://docs.docker.com/engine/install/centos/" rel="nofollow">在 CentOS | 上安装 Docker 引擎Docker 文档</a></p> 
<blockquote> 
 <p>环境准备</p> 
</blockquote> 
<p>Linux CentOS7</p> 
<p>1、查看系统的内核：<code>uname -r</code></p> 
<p>系统内核版本为3.10.0</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment">#  uname -r</span>
<span class="token number">3.10</span>.0-1160.el7.x86_64
</code></pre> 
<p>2、查看系统配置<code>cat /etc/os-release</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"7 (Core)"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"rhel fedora"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux 7 (Core)"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;31"</span>
<span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:/o:centos:centos:7"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.centos.org/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.centos.org/"</span>

<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT</span><span class="token operator">=</span><span class="token string">"CentOS-7"</span>
<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>
</code></pre> 
<blockquote> 
 <p>卸载旧版本</p> 
</blockquote> 
<p>旧版本的 Docker 被称为 或 .如果已安装这些项，请将其以及关联的依赖项一起卸载。</p> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># sudo yum remove docker \
                  docker<span class="token operator">-</span>client \
                  docker<span class="token operator">-</span>client<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>common \
                  docker<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>latest<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>engine
</code></pre> 
<h3><a id="41__236"></a>4.1 开始安装</h3> 
<blockquote> 
 <p>Docker的安装步骤</p> 
</blockquote> 
<p>1、下载需要的安装包</p> 
<pre><code class="prism language-swift">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils
</code></pre> 
<p>2、设置阿里云的Docker镜像仓库</p> 
<pre><code class="prism language-swift">yum<span class="token operator">-</span>config<span class="token operator">-</span>manager \
    <span class="token operator">--</span>add<span class="token operator">-</span>repo \
    https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo 
</code></pre> 
<p>3、更新yum软件包索引</p> 
<pre><code class="prism language-swift">yum makecache fast
</code></pre> 
<p>4、安装docker相关的配置</p> 
<p>docker-ce 是社区版，docker-ee 企业版</p> 
<pre><code class="prism language-swift"> yum install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io
</code></pre> 
<p>出现了completed（或 完毕！）即安装成功。</p> 
<p>5、启动Docker</p> 
<pre><code class="prism language-swift"># 启动<span class="token builtin">Docker</span>
systemctl start docker

# 查看当前版本号，是否启动成功
docker version

# 设置开机自启动
systemctl enable docker
</code></pre> 
<h3><a id="42_helloworld_285"></a>4.2 hello-world镜像测试</h3> 
<p>1、下载hello-world镜像进行测试</p> 
<pre><code class="prism language-swift">docker run hello<span class="token operator">-</span>world
</code></pre> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># clear
<span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker run hello<span class="token operator">-</span>world
<span class="token builtin">Unable</span> to <span class="token builtin">find</span> image <span class="token string">'hello-world:latest'</span> locally <span class="token comment">//本地没在到 hello-world 镜像</span>
latest<span class="token punctuation">:</span> <span class="token builtin">Pulling</span> from library<span class="token operator">/</span>hello<span class="token operator">-</span>world <span class="token comment">// pull 远程拉取 hello-world 镜像</span>
2db29710123e<span class="token punctuation">:</span> <span class="token builtin">Pull</span> complete  <span class="token comment">// pull完成</span>
<span class="token builtin">Digest</span><span class="token punctuation">:</span> sha256<span class="token punctuation">:</span>507ecde44b8eb741278274653120c2bf793b174c06ff4eaa672b713b3263477b
<span class="token builtin">Status</span><span class="token punctuation">:</span> <span class="token builtin">Downloaded</span> newer image <span class="token keyword">for</span> hello<span class="token operator">-</span>world<span class="token punctuation">:</span>latest

<span class="token builtin">Hello</span> from <span class="token builtin">Docker</span><span class="token operator">!</span> <span class="token comment">//运行成功</span>
<span class="token builtin">This</span> message shows that your installation appears to be working correctly<span class="token punctuation">.</span>

<span class="token builtin">To</span> generate this message<span class="token punctuation">,</span> <span class="token builtin">Docker</span> took the following steps<span class="token punctuation">:</span>
 <span class="token number">1</span><span class="token punctuation">.</span> <span class="token builtin">The</span> <span class="token builtin">Docker</span> client contacted the <span class="token builtin">Docker</span> daemon<span class="token punctuation">.</span>
 <span class="token number">2</span><span class="token punctuation">.</span> <span class="token builtin">The</span> <span class="token builtin">Docker</span> daemon pulled the <span class="token string">"hello-world"</span> image from the <span class="token builtin">Docker</span> <span class="token builtin">Hub</span><span class="token punctuation">.</span>
    <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>
 <span class="token number">3</span><span class="token punctuation">.</span> <span class="token builtin">The</span> <span class="token builtin">Docker</span> daemon created a <span class="token keyword">new</span> <span class="token class-name">container</span> from that image which runs the
    executable that produces the output you are currently reading<span class="token punctuation">.</span>
 <span class="token number">4</span><span class="token punctuation">.</span> <span class="token builtin">The</span> <span class="token builtin">Docker</span> daemon streamed that output to the <span class="token builtin">Docker</span> client<span class="token punctuation">,</span> which sent it
    to your terminal<span class="token punctuation">.</span>

<span class="token builtin">To</span> <span class="token keyword">try</span> something more ambitious<span class="token punctuation">,</span> you can run an <span class="token builtin">Ubuntu</span> container with<span class="token punctuation">:</span>
 $ docker run <span class="token operator">-</span>it ubuntu bash

<span class="token builtin">Share</span> images<span class="token punctuation">,</span> automate workflows<span class="token punctuation">,</span> and more with a free <span class="token builtin">Docker</span> <span class="token constant">ID</span><span class="token punctuation">:</span>
 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>hub<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>

<span class="token builtin">For</span> more examples and ideas<span class="token punctuation">,</span> visit<span class="token punctuation">:</span>
 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>docs<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token keyword">get</span><span class="token operator">-</span>started<span class="token operator">/</span>
</code></pre> 
<p>2、查看下载的hello-world镜像</p> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token constant">REPOSITORY</span>    <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>        <span class="token constant">SIZE</span>
hello<span class="token operator">-</span>world   latest    feb5d9fea6a5   <span class="token number">4</span> months ago   <span class="token number">13</span><span class="token punctuation">.</span>3kB <span class="token comment">//hello-world镜像</span>
</code></pre> 
<blockquote> 
 <p>Docker的卸载</p> 
</blockquote> 
<p>1、卸载依赖</p> 
<pre><code class="prism language-swift">yum remove docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io
</code></pre> 
<p>2、删除资源 <code>./var/lib/docker</code>是docker的默认工作路径</p> 
<pre><code class="prism language-swift">rm <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>docker
</code></pre> 
<h2><a id="5_346"></a>5、配置阿里云镜像加速</h2> 
<p><strong>本地机器无法使用</strong></p> 
<p>1、进入阿里云官网，搜索容器镜像服务</p> 
<p><img src="https://images2.imgbox.com/30/52/GkpLa65P_o.png" alt="在这里插入图片描述"></p> 
<p>2、同时执行官方的命令</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  "registry-mirrors": ["https://2y5oty1p.mirror.aliyuncs.com"]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart docke
</code></pre> 
<p>3、查看配置命令<code>docker info</code>，配置成功<br> <img src="https://images2.imgbox.com/49/6e/jTsYD89E_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="6Docker_371"></a>6、Docker原理</h2> 
<h3><a id="61_Docker_373"></a>6.1 Docker容器运行流程</h3> 
<p>启动一个容器，<code>docker run</code>的运行流程如下图：</p> 
<p><img src="https://images2.imgbox.com/6c/92/3eHbrR04_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="62__382"></a>6.2 底层原理</h3> 
<p>Docker是一个Client-Server（客户端-服务器）结构的系统，Docker的守护进程运行在主机上，通过Socker从客户端访问！Docker Server(服务器)接收到Docker-Client(客户端)的指令，就会执行这个指令！</p> 
<p><img src="https://images2.imgbox.com/51/97/UbhaUmh3_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>Docker为什么比VMWare(虚拟机)快？</p> 
</blockquote> 
<p>1、Docker比虚拟机更少的抽象层</p> 
<p>2、docker利用宿主机的内核，而VM需要的是Guest OS（虚拟机操作系统）</p> 
<p><img src="https://images2.imgbox.com/bd/af/Q7VblSwW_o.png" alt="img"></p> 
<p>​ Docker新建一个容器的时候，不需要像虚拟机一样重新加载一个操作系统内核，直接利用宿主机的操作系统，而虚拟机是需要加载Guest OS（虚拟机操作系统）。Docker和VM的对比如下：</p> 
<p><img src="https://images2.imgbox.com/2c/23/oEnOcSgX_o.png" alt="img"></p> 
<h2><a id="7Docker_405"></a>7、Docker常用命令</h2> 
<p>命令的帮助文档地址:https://docs.docker.com/engine/reference/commandline/docker/</p> 
<h3><a id="71__409"></a>7.1 全部命令</h3> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker <span class="token operator">--</span>help 

<span class="token builtin">Usage</span><span class="token punctuation">:</span>  docker <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">COMMAND</span>
<span class="token comment">// docker [选项] 命令</span>

A <span class="token keyword">self</span><span class="token operator">-</span>sufficient runtime <span class="token keyword">for</span> containers <span class="token comment">//翻译：容器的自给自足运行时</span>


<span class="token builtin">Options</span><span class="token punctuation">:</span>【选项】
      <span class="token operator">--</span>config string      <span class="token comment">//客户端配置文件的位置 (default "/root/.docker")</span>
  <span class="token operator">-</span>c<span class="token punctuation">,</span> <span class="token operator">--</span>context string    <span class="token comment">//用于连接到守护进程的上下文的名称(覆盖DOCKER_HOST env变量和默认上下文设置 "docker context use")</span>
  <span class="token operator">-</span>D<span class="token punctuation">,</span> <span class="token operator">--</span>debug              <span class="token comment">//启用调试模式</span>
  <span class="token operator">-</span>H<span class="token punctuation">,</span> <span class="token operator">--</span>host list          <span class="token comment">//守护进程 socket(s) 连接</span>
  <span class="token operator">-</span>l<span class="token punctuation">,</span> <span class="token operator">--</span>log<span class="token operator">-</span>level string   <span class="token comment">//设置日志级别 ("debug"|"info"|"warn"|"error"|"fatal") (default "info")</span>
      <span class="token operator">--</span>tls                <span class="token comment">//使用 TLS; 隐含 --tlsverify</span>
      <span class="token operator">--</span>tlscacert string   <span class="token comment">//仅由此CA签名的信任证书(default "/root/.docker/ca.pem")</span>
      <span class="token operator">--</span>tlscert string     <span class="token comment">//TLS证书文件路径 (default "/root/.docker/cert.pem")</span>
      <span class="token operator">--</span>tlskey string      <span class="token comment">//TLS密钥文件的路径  (default "/root/.docker/key.pem")</span>
      <span class="token operator">--</span>tlsverify          <span class="token comment">//使用TLS并验证远端</span>
  <span class="token operator">-</span>v<span class="token punctuation">,</span> <span class="token operator">--</span>version            <span class="token comment">//打印版本信息并退出</span>

<span class="token builtin">Management</span> <span class="token builtin">Commands</span><span class="token punctuation">:</span>【管理命令】
  app<span class="token operator">*</span>        <span class="token builtin">Docker</span> <span class="token builtin">App</span> <span class="token punctuation">(</span><span class="token builtin">Docker</span> <span class="token builtin">Inc</span><span class="token punctuation">.</span><span class="token punctuation">,</span> v0<span class="token punctuation">.</span><span class="token number">9.1</span><span class="token operator">-</span>beta3<span class="token punctuation">)</span>
  builder     <span class="token function">Manage</span><span class="token punctuation">(</span>管理<span class="token punctuation">)</span> builds
  buildx<span class="token operator">*</span>     <span class="token builtin">Docker</span> <span class="token builtin">Buildx</span> <span class="token punctuation">(</span><span class="token builtin">Docker</span> <span class="token builtin">Inc</span><span class="token punctuation">.</span><span class="token punctuation">,</span> v0<span class="token punctuation">.</span><span class="token number">7.1</span><span class="token operator">-</span>docker<span class="token punctuation">)</span>
  config      <span class="token builtin">Manage</span> <span class="token builtin">Docker</span> configs
  container   <span class="token builtin">Manage</span> containers <span class="token comment">//containers:容器</span>
  context     <span class="token builtin">Manage</span> contexts
  image       <span class="token builtin">Manage</span> images
  manifest    <span class="token builtin">Manage</span> <span class="token builtin">Docker</span> image manifests and manifest lists <span class="token comment">//管理Docker镜像清单和清单列表</span>
  network     <span class="token builtin">Manage</span> networks
  node        <span class="token builtin">Manage</span> <span class="token builtin">Swarm</span> nodes <span class="token comment">//群节点</span>
  plugin      <span class="token builtin">Manage</span> plugins <span class="token comment">//插件</span>
  scan<span class="token operator">*</span>       <span class="token builtin">Docker</span> <span class="token builtin">Scan</span> <span class="token punctuation">(</span><span class="token builtin">Docker</span> <span class="token builtin">Inc</span><span class="token punctuation">.</span><span class="token punctuation">,</span> v0<span class="token punctuation">.</span><span class="token number">12.0</span><span class="token punctuation">)</span> <span class="token comment">//Scan:扫描</span>
  secret      <span class="token builtin">Manage</span> <span class="token builtin">Docker</span> secrets <span class="token comment">//密码</span>
  service     <span class="token builtin">Manage</span> services
  stack       <span class="token builtin">Manage</span> <span class="token builtin">Docker</span> stacks
  swarm       <span class="token builtin">Manage</span> <span class="token builtin">Swarm</span> <span class="token comment">//群</span>
  system      <span class="token builtin">Manage</span> <span class="token builtin">Docker</span>
  trust       <span class="token builtin">Manage</span> trust on <span class="token builtin">Docker</span> images <span class="token comment">// trust:信任</span>
  volume      <span class="token builtin">Manage</span> volumes <span class="token comment">//卷</span>

<span class="token builtin">Commands</span><span class="token punctuation">:</span>【命令】
  attach      <span class="token comment">//将本地标准输入、输出和错误流附加到运行的容器 attach:附加</span>
  build       <span class="token comment">//从Dockerfile构建一个映像</span>
  commit      <span class="token comment">//根据容器的更改创建一个新镜像</span>
  cp          <span class="token comment">//在容器和本地文件系统之间复制文件/文件夹</span>
  create      <span class="token comment">//创建一个新容器</span>
  diff        <span class="token comment">//检查容器文件系统中文件或目录的更改</span>
  events      <span class="token comment">//从服务器获取实时事件 events:事件</span>
  exec        <span class="token comment">//在运行的容器中运行命令 exec:执行</span>
  export      <span class="token comment">//将容器的文件系统导出为tar存档文件 export:导出</span>
  history     <span class="token comment">//显示一个镜像的历史</span>
  images      <span class="token comment">//镜像的列表</span>
  <span class="token keyword">import</span>      <span class="token comment">//从tarball文件中导入内容以创建文件系统映像</span>
  info        <span class="token comment">//显示整个系统的信息</span>
  inspect     <span class="token comment">//返回Docker对象的底层信息 inspect:检查</span>
  kill        <span class="token comment">//杀死一个或多个正在运行的容器</span>
  load        <span class="token comment">//从tar存档文件或STDIN加载镜像</span>
  login       <span class="token comment">//登录到Docker注册表</span>
  logout      <span class="token comment">//从Docker注册表注销</span>
  logs        <span class="token comment">//获取容器的日志</span>
  pause       <span class="token comment">//暂停一个或多个容器中的所有进程 pause:暂停</span>
  port        <span class="token comment">//列出容器的端口映射或特定映射</span>
  ps          <span class="token comment">//容器的列表</span>
  pull        <span class="token comment">//从仓库（registry）中拉取镜像或存储库</span>
  push        <span class="token comment">//将镜像或存储库推送到仓库（registry）</span>
  rename      <span class="token comment">//重命名一个容器</span>
  restart     <span class="token comment">//重新启动一个或多个容器</span>
  rm          <span class="token comment">//移除一个或多个容器</span>
  rmi          <span class="token comment">//移除一个或多个镜像</span>
  run         <span class="token comment">//在新容器中运行命令</span>
  save        <span class="token comment">//将一个或多个镜像保存到tar存档文件(默认情况下流到STDOUT)</span>
  search      <span class="token comment">//在Docker Hub搜索镜像</span>
  start       <span class="token comment">//启动一个或多个停止的容器</span>
  stats       <span class="token comment">//显示容器资源使用统计的实时流</span>
  stop        <span class="token comment">//停止一个或多个正在运行的容器</span>
  tag         <span class="token comment">//创建引用SOURCE_IMAGE的标记TARGET_IMAGE</span>
  top         <span class="token comment">//显示容器的运行进程</span>
  unpause     <span class="token comment">//取消暂停一个或多个容器中的所有进程 unpause:不暂停</span>
  update     <span class="token comment">//更新一个或多个容器的配置</span>
  version    <span class="token comment">//查看Docker版本信息</span>
  wait        <span class="token comment">//阻塞直到一个或多个容器停止，然后打印它们的退出代码</span>

<span class="token builtin">Run</span> <span class="token string">'docker COMMAND --help'</span> <span class="token keyword">for</span> more information on a command<span class="token punctuation">.</span>
</code></pre> 
<h3><a id="72__498"></a>7.2 基础命令</h3> 
<pre><code class="prism language-swift">docker version          #查看docker的版本信息
docker info             #查看docker的系统信息<span class="token punctuation">,</span>包括镜像和容器的数量
docker 命令 <span class="token operator">--</span>help       #帮助命令<span class="token punctuation">(</span>可查看可选的参数<span class="token punctuation">)</span>
docker <span class="token constant">COMMAND</span> <span class="token operator">--</span>help
docker <span class="token operator">--</span>help           #列出所有命令
</code></pre> 
<h3><a id="73__510"></a>7.3 镜像命令</h3> 
<blockquote> 
 <p>拉取(下载)一个镜像</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token comment">//docker pull 镜像[:tag]  tag:版本（版本默认最新）</span>
docker pull mysql
docker pull mysql<span class="token punctuation">:</span><span class="token number">5.7</span> <span class="token comment">//指定版本</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker pull mysql</span>
Using default tag: latest
latest: Pulling from library/mysql
<span class="token comment"># == 分层下载，docker iamge的核心联合文件系统 ==</span>
6552179c3509: Pull complete 
d69aa66e4482: Pull complete  
3b19465b002b: Pull complete 
<span class="token comment">#...</span>
Digest: sha256:92d27b8222bbcf53bc42c70ca7cd1010d6c0527efc61f14980ce77c50932bef4 <span class="token comment"># 签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
docker.io/library/mysql:latest <span class="token comment">#真实地址</span>

<span class="token comment"># 下载成功</span>
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
mysql         latest    d1dc36cf8d9e   <span class="token number">3</span> days ago     519MB
hello-world   latest    feb5d9fea6a5   <span class="token number">4</span> months ago   <span class="token number">13</span>.3kB

<span class="token comment">#等价于</span>
docker pull mysql 等价于 docker pull docker.io/library/mysqlzlatest
</code></pre> 
<p><strong>分层下载</strong>,比如mysql5.7 与 mysql 8.0 有层一致就不用重新下载</p> 
<blockquote> 
 <p><code>docker images</code> 查看本地主机的所有镜像</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@iZwz99sm8v95sckz8bd2c4Z <span class="token operator">~</span><span class="token punctuation">]</span># docker images
<span class="token punctuation">[</span>镜像的仓库源  镜像的标签  镜像的id     镜像的创建时间    镜像的大小<span class="token punctuation">]</span>
<span class="token constant">REPOSITORY</span>    <span class="token constant">TAG</span>       <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>         <span class="token constant">SIZE</span>
hello<span class="token operator">-</span>world   latest    bf756fb1ae65   <span class="token number">11</span> months ago   <span class="token number">13</span><span class="token punctuation">.</span>3kB


# 可选参数

<span class="token operator">-</span>a<span class="token operator">/</span><span class="token operator">--</span>all 列出所有镜像
<span class="token operator">-</span>q<span class="token operator">/</span><span class="token operator">--</span>quiet 只显示镜像的id
</code></pre> 
<blockquote> 
 <p><code>docker search</code> 搜索镜像</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker search mysql  										
<span class="token constant">NAME</span>                              <span class="token constant">DESCRIPTION</span>                                     <span class="token constant">STARS</span>     <span class="token constant">OFFICIAL</span>   <span class="token constant">AUTOMATED</span>
mysql                             <span class="token builtin">MySQL</span> <span class="token keyword">is</span> a widely used<span class="token punctuation">,</span> open<span class="token operator">-</span>source relation…   <span class="token number">12043</span>     <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>       
mariadb                           <span class="token builtin">MariaDB</span> <span class="token builtin">Server</span> <span class="token keyword">is</span> a high performing open sou…   <span class="token number">4613</span>      <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>       
mysql<span class="token operator">/</span>mysql<span class="token operator">-</span>server                <span class="token builtin">Optimized</span> <span class="token builtin">MySQL</span> <span class="token builtin">Server</span> <span class="token builtin">Docker</span> images<span class="token punctuation">.</span> <span class="token builtin">Create</span>…   <span class="token number">901</span>       <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>
phpmyadmin                        phpMyAdmin <span class="token operator">-</span> A web interface <span class="token class-name">for</span> <span class="token builtin">MySQL</span> and M…   <span class="token number">439</span>       <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>       
<span class="token comment">//...</span>
<span class="token comment">// STARS:收藏数</span>
</code></pre> 
<p>查看其可选参数</p> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker search <span class="token operator">--</span>help

<span class="token builtin">Usage</span><span class="token punctuation">:</span>  docker search <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">TERM</span>

<span class="token builtin">Search</span> the <span class="token builtin">Docker</span> <span class="token builtin">Hub</span> <span class="token keyword">for</span> images

<span class="token builtin">Options</span><span class="token punctuation">:</span>
  <span class="token operator">-</span>f<span class="token punctuation">,</span> <span class="token operator">--</span><span class="token builtin">filter</span> <span class="token builtin">filter</span>   <span class="token comment">//根据所提供的条件过滤输出</span>
      <span class="token operator">--</span>format string   <span class="token comment">//使用Go模板的漂亮打印搜索</span>
      <span class="token operator">--</span>limit int       <span class="token comment">//搜索结果的最大数目(默认25个)</span>
      <span class="token operator">--</span>no<span class="token operator">-</span>trunc        <span class="token comment">//不截断输出</span>
</code></pre> 
<blockquote> 
 <p>搜索收藏数大于3000的镜像</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token comment">// STARS:收藏数</span>
<span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker search mysql <span class="token operator">--</span><span class="token builtin">filter</span><span class="token operator">=</span><span class="token constant">STARS</span><span class="token operator">=</span><span class="token number">3000</span>
<span class="token constant">NAME</span>      <span class="token constant">DESCRIPTION</span>                                     <span class="token constant">STARS</span>     <span class="token constant">OFFICIAL</span>   <span class="token constant">AUTOMATED</span>
mysql     <span class="token builtin">MySQL</span> <span class="token keyword">is</span> a widely used<span class="token punctuation">,</span> open<span class="token operator">-</span>source relation…   <span class="token number">12043</span>     <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>       
mariadb   <span class="token builtin">MariaDB</span> <span class="token builtin">Server</span> <span class="token keyword">is</span> a high performing open sou…   <span class="token number">4613</span>      <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>  
</code></pre> 
<blockquote> 
 <p>在仓库搜索</p> 
</blockquote> 
<p>https://hub.docker.com/search?q=mysql&amp;type=image</p> 
<p><img src="https://images2.imgbox.com/c6/14/7W0skXka_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>删除镜像</p> 
</blockquote> 
<pre><code class="prism language-swift">docker rmi <span class="token operator">-</span>f 【镜像id】
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># clear</span>
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f feb5d9fea6a5</span>
Untagged: hello-world:latest
Untagged: hello-world@sha256:507ecde44b8eb741278274653120c2bf793b174c06ff4eaa672b713b3263477b
Deleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412
</code></pre> 
<ul><li>删除多个镜像</li></ul> 
<pre><code class="prism language-swift">docker rmi <span class="token operator">-</span>f 【镜像id】 【镜像id】 【镜像id】 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<ul><li>删除所有镜像</li></ul> 
<pre><code class="prism language-swift">docker rmi <span class="token operator">-</span>f $<span class="token punctuation">(</span>docker images<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="74___631"></a>7.4 容器命令</h3> 
<p><strong>镜像启动后出现容器</strong></p> 
<p>（镜像相当于类，容器相当于实例。一个镜像可以创建多个容器）</p> 
<p>（镜像相当于你安装系统时下载的镜像文件，而容器呢就相当于你安装好的系统）</p> 
<blockquote> 
 <p>1、先拉取一个centos镜像</p> 
</blockquote> 
<pre><code class="prism language-swift">docker pull centos
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker pull centos</span>
Using default tag: latest
latest: Pulling from library/centos
a1d0c7532777: Pull complete 
Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177
Status: Downloaded newer image <span class="token keyword">for</span> centos:latest
docker.io/library/centos:latest
</code></pre> 
<blockquote> 
 <p>运行容器</p> 
</blockquote> 
<p>run是新建一个容器(直接使用容器会自动退出)，start是启动一个已经存在的容器</p> 
<pre><code class="prism language-swift"><span class="token comment">//image：镜像名字或id </span>
docker run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> image

<span class="token comment">//参数说明</span>
<span class="token operator">--</span>name<span class="token operator">=</span><span class="token string">"名字"</span>           <span class="token comment">//指定容器名字</span>
<span class="token operator">-</span>d                     <span class="token comment">//后台方式运行 若没有提供服务则自动退出（停止）</span>
<span class="token operator">-</span>it                    <span class="token comment">//使用交互方式运行,进入容器查看内容</span>
<span class="token operator">-</span>p                     <span class="token comment">//指定容器的端口(小写的P)</span>
	 <span class="token operator">-</span>p ip<span class="token punctuation">:</span>主机端口<span class="token punctuation">:</span>容器端口  <span class="token comment">//配置主机端口映射到容器端口(小写的P)</span>
     <span class="token operator">-</span>p 主机端口<span class="token punctuation">:</span>容器端口 
     <span class="token operator">-</span>p 容器端口  

<span class="token operator">-</span>P                     <span class="token comment">//随机指定端口(大写的P)</span>
</code></pre> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker start <span class="token operator">--</span>help

<span class="token comment">// CONTAINER:容器id</span>
<span class="token builtin">Usage</span><span class="token punctuation">:</span>  docker start <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">CONTAINER</span><span class="token punctuation">:</span>容器id <span class="token punctuation">[</span><span class="token constant">CONTAINER</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>

<span class="token comment">//启动一个或多个停止的容器</span>

<span class="token builtin">Options</span><span class="token punctuation">:</span>
  <span class="token operator">-</span>a<span class="token punctuation">,</span> <span class="token operator">--</span>attach               <span class="token comment">//附加STDOUT/STDERR和前向信号</span>
      <span class="token operator">--</span>detach<span class="token operator">-</span>keys string   <span class="token comment">//覆盖用于分离容器的键序列</span>
  <span class="token operator">-</span>i<span class="token punctuation">,</span> <span class="token operator">--</span>interactive         <span class="token comment">//将容器的STDIN</span>
</code></pre> 
<blockquote> 
 <p>进入容器</p> 
</blockquote> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>it centos <span class="token operator">/</span>bin<span class="token operator">/</span>bash
</code></pre> 
<ul><li>容器内就是一个独立和隔离的centos环境</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@b8f211692996 /<span class="token punctuation">]</span><span class="token comment"># ls </span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</code></pre> 
<blockquote> 
 <p>退出容器<code>exit</code></p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># exit 停止并退出容器（后台方式运行则仅退出）</span>
<span class="token comment"># Ctrl+P+Q  不停止容器退出</span>
<span class="token punctuation">[</span>root@b8f211692996 /<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre> 
<blockquote> 
 <p>列出容器</p> 
</blockquote> 
<pre><code class="prism language-swift">docker ps 	   <span class="token comment">// 列出当前正在运行的容器</span>
docker ps <span class="token operator">-</span>a   <span class="token comment">// 列出所有容器的运行记录</span>
docker ps <span class="token operator">-</span>n<span class="token operator">=</span><span class="token operator">?</span> <span class="token comment">// 显示最近创建的n个容器</span>
docker ps <span class="token operator">-</span>q   <span class="token comment">// 只显示容器的编号</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps      #列出当前正在运行的容器</span>
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
b8f211692996   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">14</span> minutes ago   Up <span class="token number">14</span> minutes             zealous_lichterman
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a   # 列出所有容器的运行记录</span>
CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                          PORTS     NAMES
0f009b5ce7d7   centos         <span class="token string">"/bin/bash"</span>   <span class="token number">3</span> minutes ago    Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> About a minute ago             cool_lovelace
b8f211692996   centos         <span class="token string">"/bin/bash"</span>   <span class="token number">14</span> minutes ago   Up <span class="token number">14</span> minutes                             zealous_lichterman
9d6d432cfc32   feb5d9fea6a5   <span class="token string">"/hello"</span>      <span class="token number">19</span> hours ago     Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">19</span> hours ago                   wizardly_booth
53ef5a5247a6   feb5d9fea6a5   <span class="token string">"/hello"</span>      <span class="token number">19</span> hours ago     Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">19</span> hours ago                   eloquent_chatterjee
</code></pre> 
<blockquote> 
 <p>停止容器</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker stop <span class="token operator">--</span>help

<span class="token comment">// CONTAINER：容器(但要用容器id才行)</span>
<span class="token builtin">Usage</span><span class="token punctuation">:</span>  docker stop <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">CONTAINER</span> <span class="token punctuation">[</span><span class="token constant">CONTAINER</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>

<span class="token comment">//翻译：停止一个或多个正在运行的容器</span>
<span class="token builtin">Stop</span> one or more running containers

<span class="token builtin">Options</span><span class="token punctuation">:</span>
  <span class="token operator">-</span>t<span class="token punctuation">,</span> <span class="token operator">--</span>time int   <span class="token comment">//在杀死它之前等待几秒钟 (default 10)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
eb679ca2e254   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">4</span> minutes ago    Up <span class="token number">4</span> minutes              blissful_robinson
b8f211692996   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">26</span> minutes ago   Up <span class="token number">26</span> minutes             zealous_lichterman
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker stop centos</span>
Error response from daemon: No such container: centos
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker stop eb679ca2e254</span>
eb679ca2e254
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker stop b8f211692996</span>
b8f211692996
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</code></pre> 
<blockquote> 
 <p>删除容器</p> 
</blockquote> 
<pre><code class="prism language-bash">docker <span class="token function">rm</span> 容器id                 <span class="token comment"># 删除指定的容器,不能删除正在运行的容器</span>
docker <span class="token function">rm</span> -f 容器id   		  <span class="token comment"># 强制删除，包括正在运行的容器</span>
docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span>   <span class="token comment"># 删除所有的容器</span>
docker <span class="token function">ps</span> -a -q<span class="token operator">|</span><span class="token function">xargs</span> docker <span class="token function">rm</span> <span class="token comment"># 删除所有的容器</span>
</code></pre> 
<blockquote> 
 <p>启动和停止容器</p> 
</blockquote> 
<pre><code class="prism language-bash">docker start 容器id          <span class="token comment">#启动容器</span>
docker restart 容器id        <span class="token comment">#重启容器</span>
docker stop 容器id           <span class="token comment">#停止当前运行的容器</span>
docker <span class="token function">kill</span> 容器id           <span class="token comment">#强制停止当前容器</span>
</code></pre> 
<h3><a id="75__781"></a>7.5 其他常用命令</h3> 
<blockquote> 
 <p>日志的查看</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker logs <span class="token operator">--</span>help

<span class="token builtin">Usage</span><span class="token punctuation">:</span>  docker logs <span class="token punctuation">[</span><span class="token constant">OPTIONS</span><span class="token punctuation">]</span> <span class="token constant">CONTAINER</span>

<span class="token comment">//获取容器的日志</span>

<span class="token builtin">Options</span><span class="token punctuation">:</span>
      <span class="token operator">--</span>details        <span class="token comment">//显示提供给日志的额外细节</span>
  <span class="token operator">-</span>f<span class="token punctuation">,</span> <span class="token operator">--</span>follow         <span class="token comment">//跟踪日志输出</span>
      <span class="token operator">--</span>since string   <span class="token comment">//显示自定义时间戳以来的日志 (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)</span>
  <span class="token operator">-</span>n<span class="token punctuation">,</span> <span class="token operator">--</span>tail string    、、从日志的末尾显示的行数<span class="token punctuation">(</span><span class="token keyword">default</span> <span class="token string">"all"</span><span class="token punctuation">)</span>
  <span class="token operator">-</span>t<span class="token punctuation">,</span> <span class="token operator">--</span>timestamps     <span class="token comment">//显示时间戳</span>
      <span class="token operator">--</span>until string  <span class="token comment">//在时间戳之前显示日志 (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)</span>

<span class="token comment">//常用：</span>
docker logs <span class="token operator">-</span>tf 【容器id】
docker logs <span class="token operator">--</span>tail number 【容器id】 <span class="token comment">//num为要显示的日志条数</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment">#docker容器后台运行，必须要有一个前台的进程，否则会自动停止</span>
<span class="token comment">#编写shell脚本循环执行，使得centos容器保持运行状态</span>
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d centos /bin/sh -c "while true;do echo hi;sleep 5;done"</span>
2b8ed9e4dcb655547b3c2aa28cd849179190ec03ecca2aabf9c7a44155b13097

<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES
2b8ed9e4dcb6   centos    <span class="token string">"/bin/sh -c 'while t…"</span>   <span class="token number">3</span> seconds ago   Up <span class="token number">2</span> seconds             beautiful_elion

<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker logs -tf --tail 10 2b8ed9e4dcb6</span>
<span class="token number">2022</span>-01-31T02:32:36.215664841Z hi
<span class="token number">2022</span>-01-31T02:32:41.224798220Z hi
<span class="token number">2022</span>-01-31T02:32:46.227706348Z hi
<span class="token number">2022</span>-01-31T02:32:51.243402617Z hi
<span class="token number">2022</span>-01-31T02:32:56.257314943Z hi
<span class="token number">2022</span>-01-31T02:33:01.284139739Z hi
<span class="token number">2022</span>-01-31T02:33:06.294600809Z hi
<span class="token comment"># Ctrl + Shift + c 退出</span>
</code></pre> 
<blockquote> 
 <p>查看容器中进程信息</p> 
</blockquote> 
<pre><code class="prism language-swift">docker top 容器id
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker top 2b8ed9e4dcb6</span>
<span class="token environment constant">UID</span>     PID       <span class="token environment constant">PPID</span>     C    STIME      TTY      TIME                CMD
root    <span class="token number">11156</span>    <span class="token number">11135</span>     <span class="token number">0</span>    <span class="token number">11</span>:31      ?     00:00:00     /bin/sh -c <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> hi<span class="token punctuation">;</span><span class="token function">sleep</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">done</span>
root     <span class="token number">11886</span>   <span class="token number">11156</span>     <span class="token number">0</span>     <span class="token number">11</span>:43     ?     00:00:00   /usr/bin/coreutils --coreutils-prog-shebang<span class="token operator">=</span>sleep /usr/bin/sleep <span class="token number">5</span>
</code></pre> 
<blockquote> 
 <p>查看容器的元数据</p> 
</blockquote> 
<pre><code class="prism language-swift">docker inspect 容器id
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect 2b8ed9e4dcb6 # 显示的id是 真实id 的 缩写</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"2b8ed9e4dcb655547b3c2aa28cd849179190ec03ecca2aabf9c7a44155b13097"</span>,<span class="token comment"># 真实id</span>
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-01-31T02:32:35.769096414Z"</span>,
        <span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"/bin/sh"</span>,
        <span class="token string">"Args"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"-c"</span>,
            <span class="token string">"while true;do echo hi;sleep 5;done"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"State"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"running"</span>,
            <span class="token string">"Running"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"Paused"</span><span class="token builtin class-name">:</span> false,

</code></pre> 
<blockquote> 
 <p>进入当前正在运行的容器</p> 
</blockquote> 
<p>因为通常我们的容器都是使用后台方式来运行的，有时需要进入容器修改配置</p> 
<pre><code class="prism language-swift"><span class="token comment">// 方式一</span>
 docker exec <span class="token operator">-</span>it 【容器id】 <span class="token operator">/</span>bin<span class="token operator">/</span>bash

<span class="token comment">// 方式二</span>
docker attach 【容器id】
</code></pre> 
<p>方式一：进入容器后开启一个新的终端，可以在里面操作 （常用）</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 2b8ed9e4dcb6 /bin/bash</span>
<span class="token punctuation">[</span>root@2b8ed9e4dcb6 /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token comment"># 查看进程</span>
<span class="token punctuation">[</span>root@48c706c3a876 /<span class="token punctuation">]</span><span class="token comment">#  ps -ef </span>
<span class="token environment constant">UID</span>         PID   <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMD
root          <span class="token number">1</span>      <span class="token number">0</span>  <span class="token number">0</span> 03:38 ?        00:00:00 /bin/sh -c <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> hi<span class="token punctuation">;</span><span class="token function">sleep</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">done</span>
root         <span class="token number">12</span>      <span class="token number">0</span>  <span class="token number">0</span> 03:38 pts/0    00:00:00 /bin/bash
root         <span class="token number">28</span>      <span class="token number">1</span>  <span class="token number">0</span> 03:38 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang<span class="token operator">=</span>sleep /usr/bin/sleep <span class="token number">5</span>
root         <span class="token number">29</span>     <span class="token number">12</span>  <span class="token number">0</span> 03:38 pts/0    00:00:00 <span class="token function">ps</span> -ef
</code></pre> 
<p>方式二：进入容器正在执行的终端，不会启动新的进程</p> 
<pre><code class="prism language-swift"><span class="token punctuation">[</span>root@<span class="token number">192</span> <span class="token operator">~</span><span class="token punctuation">]</span># docker attach 2b8ed9e4dcb6 
hi
hi
hi
<span class="token comment">//...</span>
</code></pre> 
<blockquote> 
 <p>拷贝操作</p> 
</blockquote> 
<p>（还可以使用 -v 卷技术）</p> 
<p>拷贝操作的命令如下：</p> 
<pre><code class="prism language-swift"><span class="token comment">//将容器的文件拷贝到主机中</span>
docker cp 容器id<span class="token punctuation">:</span>容器内路径  目的主机路径
<span class="token comment">//docker cp 7b605b457f23:/home/Hello.txt hello.txt</span>

<span class="token comment">//将宿主机的文件拷贝到容器中</span>
docker cp 目的主机路径 容器id<span class="token punctuation">:</span>容器内路径
</code></pre> 
<ul><li>将容器的文件拷贝到主机中</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@7b605b457f23 /<span class="token punctuation">]</span><span class="token comment"># cd home/  </span>
<span class="token punctuation">[</span>root@7b605b457f23 home<span class="token punctuation">]</span><span class="token comment"># touch Hello.txt</span>
<span class="token punctuation">[</span>root@7b605b457f23 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
Hello.txt

</code></pre> 
<p>1、在容器中新建文件</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@iZwz99sm8v95sckz8bd2c4Z ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it c703b5b1911f /bin/bash</span>
<span class="token punctuation">[</span>root@c703b5b1911f /<span class="token punctuation">]</span><span class="token comment"># cd home</span>
<span class="token punctuation">[</span>root@c703b5b1911f home<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token comment">#touch 新建文件</span>
<span class="token punctuation">[</span>root@c703b5b1911f home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
<span class="token punctuation">[</span>root@c703b5b1911f home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
<span class="token punctuation">[</span>root@c703b5b1911f home<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@iZwz99sm8v95sckz8bd2c4Z ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
c703b5b1911f   centos    <span class="token string">"/bin/sh -c 'while t…"</span>   <span class="token number">35</span> minutes ago   Up <span class="token number">35</span> minutes             pedantic_banach
<span class="token punctuation">[</span>root@iZwz99sm8v95sckz8bd2c4Z ~<span class="token punctuation">]</span><span class="token comment"># docker cp c703b5b1911f:/home/test.java /home</span>
<span class="token punctuation">[</span>root@iZwz99sm8v95sckz8bd2c4Z ~<span class="token punctuation">]</span><span class="token comment"># ls /home</span>
hai  pan  test.java
<span class="token punctuation">[</span>root@7b605b457f23 home<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre> 
<p>2.copy文件</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># cd 桌面</span>
<span class="token punctuation">[</span>root@192 桌面<span class="token punctuation">]</span><span class="token comment"># ls</span>
Kuang
<span class="token punctuation">[</span>root@192 桌面<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token punctuation">[</span>root@192 桌面<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE    COMMAND        CREATED         STATUS                     PORTS     NAMES
7b605b457f23   centos   <span class="token string">"/bin/bash"</span>    <span class="token number">3</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> minutes ago     tender_burnell
<span class="token comment"># ...</span>

<span class="token punctuation">[</span>root@192 桌面<span class="token punctuation">]</span><span class="token comment"># docker cp 7b605b457f23:/home/Hello.txt hello.txt</span>
<span class="token punctuation">[</span>root@192 桌面<span class="token punctuation">]</span><span class="token comment"># ls</span>
hello.txt  Kuang <span class="token comment"># 成功</span>
</code></pre> 
<blockquote> 
 <p>常用命令小节</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/50/b1/qMqUgKVo_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="8docker__973"></a>8、docker 练习</h2> 
<h3><a id="81_Nginx_975"></a>8.1 部署Nginx</h3> 
<p>（Nginx：是一个高性能的HTTP和反向代理web服务器）</p> 
<p>1、搜索nginx</p> 
<p>https://hub.docker.com/_/nginx</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker search nginx</span>
NAME                DESCRIPTION                            STARS     OFFICIAL   AUTOMATED
nginx            Official build of Nginx.                  <span class="token number">16232</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span> 
//<span class="token punctuation">..</span>.
</code></pre> 
<p>2、拉取nginx</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker pull nginx</span>
Using default tag: latest
latest: Pulling from library/nginx
5eb5b503b376: Pull complete 
1ae07ab881bd: Pull complete 
78091884b7be: Pull complete 
091c283c6a66: Pull complete 
55de5851019b: Pull complete 
b559bad762be: Pull complete 
Digest: sha256:2834dc507516af02784808c5f48b7cbe38b8ed5d0f4837f16e78d00deb7e7767
Status: Downloaded newer image <span class="token keyword">for</span> nginx:latest
docker.io/library/nginx:latest

<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker images # 下载成功</span>
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    c316d5a335a5   <span class="token number">4</span> days ago     142MB
</code></pre> 
<p>3、启动nginx镜像</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d --name nginx01 -p 8801:80 nginx</span>
b93af0c28d2baca7b03dc34eaf6d0b8778abdb989e091d9461351a48b12fb706

<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps #运行成功</span>
CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS                PORTS                           NAMES
b93af0c28d2b   nginx     <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">13</span> seconds ago   Up <span class="token number">11</span> seconds   <span class="token number">0.0</span>.0.0:8801-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::8801-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx01

</code></pre> 
<p>​ <code>-p 8801:80</code>通过端口映射将 主机的8801端口 与 容器的80端口 连通，从而暴露 容器的80端口</p> 
<p>4、测试连接nginx</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># curl localhost:8801</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{<!-- --></span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{<!-- --></span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token comment"># 连接成功</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>windows（外网）上访问成功</li></ul> 
<p><img src="https://images2.imgbox.com/99/29/k4Da4hCh_o.png" alt="在这里插入图片描述"></p> 
<p>5、进入nginx容器</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it nginx01 /bin/bash</span>
root@b93af0c28d2b:/<span class="token comment"># whereis nginx</span>
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
</code></pre> 
<h3><a id="82_Tomcat_1069"></a>8.2 部署Tomcat</h3> 
<p>1、搜索tomcat</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker search tomcat</span>
NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
tomcat                        Apache Tomcat is an <span class="token function">open</span> <span class="token builtin class-name">source</span> implementati…   <span class="token number">3248</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
</code></pre> 
<p>2、拉取tomcat</p> 
<pre><code class="prism language-swift">docker pull tomcat<span class="token punctuation">:</span><span class="token number">9.0</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker pull tomcat:9.0</span>
<span class="token number">9.0</span>: Pulling from library/tomcat
0c6b8ff8c37e: Pull complete 
<span class="token comment"># ...</span>
Digest: sha256:c1cbd0fcc6d937c79d9f84ad6747b8ace4846a7ddf44f9344695c61f7443fa02
Status: Downloaded newer image <span class="token keyword">for</span> tomcat:9.0
docker.io/library/tomcat:9.0
</code></pre> 
<p>3、启动Tomcat</p> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8002</span><span class="token punctuation">:</span><span class="token number">8080</span> <span class="token operator">--</span>name tomcat01 tomcat
</code></pre> 
<ul><li>docker 自动给我下载最新版（启动成功）</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8002:8080 --name tomcat01 tomcat</span>
Unable to <span class="token function">find</span> image <span class="token string">'tomcat:latest'</span> locally <span class="token comment"># 没有发现最新版</span>
latest: Pulling from library/tomcat
0c6b8ff8c37e: Already exists <span class="token comment"># 下载Tomcat9.0时已下载</span>
<span class="token comment"># ...</span>
bc5c573a9ab7: Pull complete <span class="token comment"># 补充下载</span>
f9f34f3a3d27: Pull complete 
Digest: sha256:28ef9f9a08f812de2f7f1de9076f39c911e5f92615ea168693964fbc2247701c
Status: Downloaded newer image <span class="token keyword">for</span> tomcat:latest
b55631abdbffbe3bf156050846e71f03834f8984bf4fe96952ddda46e209967b <span class="token comment">#启动成功，容器id</span>
</code></pre> 
<ul><li>启动成功</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                                       NAMES
b55631abdbff   tomcat    <span class="token string">"catalina.sh run"</span>   <span class="token number">33</span> seconds ago   Up <span class="token number">30</span> seconds   <span class="token number">0.0</span>.0.0:8002-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8002-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat01 
</code></pre> 
<p>4、测试，windows(外网)访问成功<br> <img src="https://images2.imgbox.com/48/8e/1zvoiWQl_o.png" alt="在这里插入图片描述"></p> 
<p>5、进入tomcat容器</p> 
<pre><code class="prism language-swift">docker exec <span class="token operator">-</span>it nginx01 <span class="token operator">/</span>bin<span class="token operator">/</span>bash
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 /bin/bash</span>
root@b55631abdbff:/usr/local/tomcat<span class="token comment"># ls</span>
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
</code></pre> 
<p>(容器中的命令是少了,阿里云镜像默认下载的是最小的镜像，保证最小的运行环境。)</p> 
<p>6、部署网站</p> 
<p>​ 在webapps.dist文件在个tomcat网站代码</p> 
<pre><code class="prism language-shell">root@b55631abdbff:/usr/local/tomcat<span class="token comment"># cd webapps.dist/</span>
root@b55631abdbff:/usr/local/tomcat/webapps.dist<span class="token comment"># ls</span>
ROOT  docs  examples  host-manager  manager
root@b55631abdbff:/usr/local/tomcat/webapps.dist<span class="token comment"># cd examples/</span>
root@b55631abdbff:/usr/local/tomcat/webapps.dist/examples<span class="token comment"># ls</span>
META-INF  WEB-INF  index.html  jsp  servlets  websocket
root@b55631abdbff:/usr/local/tomcat/webapps.dist/examples<span class="token comment"># cat index.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--
  <span class="token comment"># ...</span>
--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE HTML<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Apache Tomcat Examples<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>Apache Tomcat Examples<span class="token operator">&lt;</span>/H<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"servlets"</span><span class="token operator">&gt;</span>Servlets examples<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"jsp"</span><span class="token operator">&gt;</span>JSP Examples<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"websocket/index.xhtml"</span><span class="token operator">&gt;</span>WebSocket Examples<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/ul<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<p>​ 将webapps.dist的网站代码copy到webapps中让服务器运行</p> 
<pre><code class="prism language-swift">root@b55631abdbff<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>tomcat# cp <span class="token operator">-</span>r webapps<span class="token punctuation">.</span>dist<span class="token comment">/* webapps
</span></code></pre> 
<ul><li>测试，windows(外网)访问成功</li></ul> 
<p><img src="https://images2.imgbox.com/6d/bd/Uiw7nCD0_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>思考问题</p> 
</blockquote> 
<p>​ 每次部署项目都要进入容器是不是太麻烦，可以通过修改外部影响容器内部就好了。</p> 
<h3><a id="83__ElasticSearchKibana_1192"></a>8.3 部署 ElasticSearch+Kibana</h3> 
<blockquote> 
 <p>部署难点</p> 
</blockquote> 
<p>ElasticSearch是什么：<a href="https://blog.csdn.net/JENREY/article/details/81290535?ops_request_misc=%7B%22request%5Fid%22%3A%22164368073116780274110758%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=164368073116780274110758&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-81290535.pc_search_insert_ulrmf&amp;utm_term=Elasticsearch+&amp;spm=1018.2226.3001.4187"> ElasticSearch从入门到精通，史上最全（持续更新，未完待续，每天一点点）_Null的博客-CSDN博客</a></p> 
<p>ElasticSearch是 智能搜索，分布式的搜索引擎</p> 
<p>ElasticSearch暴露的端口多、十分耗内存、数据一定要放安全目录</p> 
<p>ElasticSearch是一个日志切割管理的工具</p> 
<blockquote> 
 <p>部署 ElasticSearch</p> 
</blockquote> 
<p>​ 正常安装ElasticSearch后太消耗内存,导致Linux太卡了，需要添加 <code>-e ES_JAVA_OPTS="-Xms128m -Xmx512m"</code> 配置ElasticSearch的虚拟机占用的内存大小。</p> 
<p>1、安装并启动</p> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name elasticsearch01 <span class="token operator">-</span>p <span class="token number">9200</span><span class="token punctuation">:</span><span class="token number">9200</span> <span class="token operator">-</span>p <span class="token number">9300</span><span class="token punctuation">:</span><span class="token number">9300</span> <span class="token operator">-</span>e <span class="token string">"discovery.type=single-node"</span> <span class="token operator">-</span>e <span class="token constant">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms128m -Xmx512m"</span> elasticsearch<span class="token punctuation">:</span><span class="token number">7.6</span><span class="token punctuation">.</span><span class="token number">2</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d --name elasticsearch01 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms128m -Xmx512m" elasticsearch:7.6.2</span>
Unable to <span class="token function">find</span> image <span class="token string">'elasticsearch:7.6.2'</span> locally
<span class="token number">7.6</span>.2: Pulling from library/elasticsearch
ab5ef0e58194: Pull complete 
c4d1ca5c8a25: Pull complete 
941a3cc8e7b8: Pull complete 
43ec483d9618: Pull complete 
c486fd200684: Pull complete 
1b960df074b2: Pull complete 
1719d48d6823: Pull complete 
Digest: sha256:1b09dbd93085a1e7bca34830e77d2981521a7210e11f11eda997add1c12711fa
Status: Downloaded newer image <span class="token keyword">for</span> elasticsearch:7.6.2
c097654fbab08d26f803e150b54c471336a9ba24283595ba64f33d87aba33c62

<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                                                                  NAMES
c097654fbab0   elasticsearch:7.6.2   <span class="token string">"/usr/local/bin/dock…"</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes   <span class="token number">0.0</span>.0.0:9200-<span class="token operator">&gt;</span><span class="token number">9200</span>/tcp, :::9200-<span class="token operator">&gt;</span><span class="token number">9200</span>/tcp, <span class="token number">0.0</span>.0.0:9300-<span class="token operator">&gt;</span><span class="token number">9300</span>/tcp, :::9300-<span class="token operator">&gt;</span><span class="token number">9300</span>/tcp   elasticsearch01
</code></pre> 
<p>2、测试连接ElasticSearch</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># curl localhost:9200</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"c097654fbab0"</span>,
  <span class="token string">"cluster_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker-cluster"</span>,
  <span class="token string">"cluster_uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"HtBpQlrcR_mI-Suj8qzW8w"</span>,
  <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"number"</span> <span class="token builtin class-name">:</span> <span class="token string">"7.6.2"</span>,
    <span class="token string">"build_flavor"</span> <span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
    <span class="token string">"build_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"docker"</span>,
    <span class="token string">"build_hash"</span> <span class="token builtin class-name">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,
    <span class="token string">"build_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span>,
    <span class="token string">"build_snapshot"</span> <span class="token builtin class-name">:</span> false,
    <span class="token string">"lucene_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"8.4.0"</span>,
    <span class="token string">"minimum_wire_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.8.0"</span>,
    <span class="token string">"minimum_index_compatibility_version"</span> <span class="token builtin class-name">:</span> <span class="token string">"6.0.0-beta1"</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"tagline"</span> <span class="token builtin class-name">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3、查看资源占用情况</p> 
<pre><code class="prism language-swift">docker stats
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker stats</span>
CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT   MEM %     NET I/O           BLOCK I/O     PIDS
c097654fbab0   elasticsearch01   <span class="token number">0.25</span>%     420MiB / <span class="token number">2</span>.406GiB   <span class="token number">17.05</span>%    <span class="token number">3</span>.71kB / <span class="token number">2</span>.75kB   0B / <span class="token number">1</span>.74MB   <span class="token number">44</span>
</code></pre> 
<blockquote> 
 <p>Kibana</p> 
</blockquote> 
<p>​ Kibana 是一款开源的数据分析和可视化平台，它是 Elastic Stack 成员之一，设计用于和 Elasticsearch 协作。您可以使用 Kibana 对 Elasticsearch 索引中的数据进行搜索、查看、交互操作。您可以很方便的利用图表、表格及地图对数据进行多元化的分析和呈现。</p> 
<h2><a id="9Portaniner_1278"></a>9、图形化管理工具Portaniner安装</h2> 
<p>Portaniner是Docker的图形化管理工具，类似的工具还有Rancher(CI/CD再用)</p> 
<p>（Portaniner平时比较少用）</p> 
<p>1、下载运行Portaniner镜像并运行，设置本机映射端口为8088</p> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8088</span><span class="token punctuation">:</span><span class="token number">9000</span> <span class="token operator">--</span>restart<span class="token operator">=</span>always <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock<span class="token punctuation">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock <span class="token operator">--</span>privileged<span class="token operator">=</span><span class="token boolean">true</span> portainer<span class="token operator">/</span>portainer
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span>
Unable to <span class="token function">find</span> image <span class="token string">'portainer/portainer:latest'</span> locally
latest: Pulling from portainer/portainer
94cfa856b2b1: Pull complete 
49d59ee0881a: Pull complete 
a2300fd28637: Pull complete 
Digest: sha256:fb45b43738646048a0a0cc74fcee2865b69efde857e710126084ee5de9be0f3f
Status: Downloaded newer image <span class="token keyword">for</span> portainer/portainer:latest
b3b421cc14a11d7a4119eb8b3144c8f4796d7ad078ff9e1ecbdf8044b3e1a4cd
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                 COMMAND        CREATED          STATUS          PORTS                                       NAMES
b3b421cc14a1   portainer/portainer   <span class="token string">"/portainer"</span>   <span class="token number">29</span> seconds ago   Up <span class="token number">27</span> seconds   <span class="token number">0.0</span>.0.0:8088-<span class="token operator">&gt;</span><span class="token number">9000</span>/tcp, :::8088-<span class="token operator">&gt;</span><span class="token number">9000</span>/tcp   flamboyant_cray
</code></pre> 
<p>2、windows(外网)访问成功</p> 
<p>(1) 第一次登录设置admin用户的密码 (测试中为了好记可以设置成12345678)</p> 
<p><img src="https://images2.imgbox.com/ae/34/q6D29faD_o.png" alt="在这里插入图片描述"></p> 
<p>(2) 选择Local(本地)</p> 
<p><img src="https://images2.imgbox.com/62/2c/2orOdejb_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell"><span class="token comment"># 安装时要加上</span>
-v <span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span> 
</code></pre> 
<p>(3) 主页</p> 
<p><img src="https://images2.imgbox.com/e1/c8/CONxlKIW_o.png" alt="在这里插入图片描述"></p> 
<p>（4） 查看镜像列表</p> 
<p><img src="https://images2.imgbox.com/38/b5/vOpHRSu1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="10Docker_1331"></a>10、Docker镜像详解</h2> 
<h3><a id="101__1333"></a>10.1 什么是镜像</h3> 
<p>​ 镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需要的所有内容，包括代码，运行时（一个程序在运行或者在被执行的依赖）、库，环境变量和配置文件。</p> 
<p>​ 所以应用直接打包镜像，就可以用于运行</p> 
<p>​ 获得镜像的途径：</p> 
<pre><code>- 自己制作镜像DockerFile
- 远程仓库下载
- 别人copy给你
</code></pre> 
<h3><a id="102__1345"></a>10.2 联合文件系统</h3> 
<blockquote> 
 <p>UnionFS （联合文件系统）</p> 
</blockquote> 
<p>​ Docker的镜像实际上由一层一层的文件系统组成(下载镜像时分层下载可印证)，这种层级的文件系统是UnionFS联合文件系统。</p> 
<p><img src="https://images2.imgbox.com/d6/a1/CKzrDP3p_o.png" alt="在这里插入图片描述"></p> 
<p>​ UnionFS （联合文件系统）是一种分层、轻量级并且高性能的文件系统，它支持对文研系统的修改<br> ​ 作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。<br> ​ 特性：一次同时加载多个文件系统，但从外面看起来，只能看到外文件系统，联合加载会把各层文件系统叠加起来,这样最终的文件系统会包含所有底层的文件和目录</p> 
<p>作用：比如tomcat下载了centos,则mysql就不用下载了。相同层可复用</p> 
<p>思考：为什么Docke也像要采用这种分层的结构呢？<br> 最大的好处，莫过于是资源共享了 ！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只高要加载一份base镜像,这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享.<br> 查看镜像分层的方式可以通过<code>docker image inspect</code>命令!</p> 
<pre><code class="prism language-swift">docker image inspect redis
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker image inspect redis</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"sha256:f1b6973564e91aecb808142499829a15798fdc783a30de902bb0c4133fee19ad"</span>,
        <span class="token string">"RepoTags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"redis:latest"</span>
        <span class="token punctuation">]</span>,
        <span class="token comment"># ...</span>
        
        <span class="token string">"RootFS"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> 
            <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"layers"</span>,
            <span class="token string">"Layers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token comment"># 这里指示了分层信息</span>
                <span class="token string">"sha256:7d0ebbe3f5d26c1b5ec4d5dbb6fe3205d7061f9735080b0162d550530328abd6"</span>,
                <span class="token string">"sha256:92b6c42121d80f330a80c20afa928e19c31ab3a5fe7cf9c91517fa8cc468b33f"</span>,
                <span class="token string">"sha256:65845b69eb5c3291dd610ddf2f61f524ab206f9754900d9f3512fcbc2d38604f"</span>,
                <span class="token string">"sha256:7048818d16571a765e2b0cf82c20d627abebccec73ac3d7b7973501000e6e05d"</span>,
                <span class="token string">"sha256:c61d5cbf862134aad34822e96d9efc009cca19ad604419cb3f8cf8857eb18372"</span>,
                <span class="token string">"sha256:ff503dae4eb68eb7a71095e5b1b1b123f42d37e923222038b64fba5a80b13307"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"LastTagTime"</span><span class="token builtin class-name">:</span> <span class="token string">"0001-01-01T00:00:00Z"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>​ 所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上,创建新的镜像层.<br> 举一个简单的例子，假如基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加Python包，<br> 就会在基础镜像层之上创建第二个镜像层;如果继续添加一个安全补丁，就会创建第三个镜像层。<br> 该镜像当前已经包含3个镜像层，如下图所示（这只是一个用于演示的很简单的例子）.</p> 
<p><img src="https://images2.imgbox.com/7b/17/6hyM8oSm_o.png" alt="在这里插入图片描述"></p> 
<p>​ 在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常里要.下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像包含了来自两个镜像层的6个文件.</p> 
<p><img src="https://images2.imgbox.com/4c/62/UoKKs0bF_o.png" alt="在这里插入图片描述"></p> 
<p>​ 这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。<br> ​ Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。<br> Linux上可用的存储引擎有AUFS、Overlay2. Device hopper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的<br> 文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p> 
<p><img src="https://images2.imgbox.com/d4/f7/fih9Lo54_o.png" alt="img"></p> 
<p>​ Docker在Windows上仅支持windowsfilter 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW［ 1］ 0<br> 下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。<br> <img src="https://images2.imgbox.com/40/a0/j2PkvQ7M_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>特点</p> 
</blockquote> 
<p>​ Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p> 
<p><img src="https://images2.imgbox.com/76/17/W4P7ZRPe_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11_1438"></a>11、提交自己镜像</h2> 
<p>使用<code>docker commit</code>命令提交容器成为一个新的版本</p> 
<pre><code class="prism language-swift">docker commit <span class="token operator">-</span>m<span class="token operator">=</span><span class="token string">"提交的描述信息"</span>  <span class="token operator">-</span>a<span class="token operator">=</span><span class="token string">"作者"</span> 容器id 目标镜像名<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token constant">TAG</span><span class="token punctuation">]</span> 
</code></pre> 
<p>​ 由于默认的Tomcat镜像的webapps文件夹中没有任何内容，需要从webapps.dist中拷贝文件到webapps文件夹。下面自行制作镜像：就是从webapps.dist中拷贝文件到webapps文件夹下，并提交该镜像作为一个新的镜像。<strong>使得该镜像默认的webapps文件夹下就有文件</strong>。具体步骤如下：</p> 
<p>1、启动Tomcat</p> 
<pre><code class="prism language-swift"><span class="token comment">// 启动Tomcat 一定要配置端口映射 `-p 8080:8080`</span>
docker run <span class="token operator">-</span>it <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">8080</span> tomcat

<span class="token comment">//开多一个终端</span>
<span class="token comment">// 进入容器</span>
docker exec <span class="token operator">-</span>it d55df6cdafe8 <span class="token operator">/</span>bin<span class="token operator">/</span>bash
</code></pre> 
<p>2、制作（修改）镜像，拷贝<code>cp -r webapps.dist/* webapps</code></p> 
<pre><code class="prism language-shell">root@d55df6cdafe8:/usr/local/tomcat<span class="token comment"># cd webapps</span>
root@d55df6cdafe8:/usr/local/tomcat/webapps<span class="token comment"># ls</span>
root@d55df6cdafe8:/usr/local/tomcat/webapps<span class="token comment"># cd ..</span>
root@d55df6cdafe8:/usr/local/tomcat<span class="token comment"># ls</span>
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
root@d55df6cdafe8:/usr/local/tomcat<span class="token comment"># cp -r webapps.dist/* webapps</span>
root@d55df6cdafe8:/usr/local/tomcat<span class="token comment"># cd webapps</span>
root@d55df6cdafe8:/usr/local/tomcat/webapps<span class="token comment"># ls</span>
ROOT  docs  examples  host-manager  manager
</code></pre> 
<p>3、windows访问</p> 
<p><img src="https://images2.imgbox.com/81/79/WEsfn6w5_o.png" alt="在这里插入图片描述"></p> 
<p>4、提交自己镜像,提交到本地（之后再发布到远程仓库）</p> 
<pre><code class="prism language-swift"><span class="token comment">//docker commit -m="提交的描述信息"  -a="作者" 容器id 目标镜像名:[TAG] </span>
docker commit <span class="token operator">-</span>m<span class="token operator">=</span><span class="token string">"add webapps app"</span>  <span class="token operator">-</span>a<span class="token operator">=</span><span class="token string">"一个平凡de人"</span> 6df1e2c4a350 tomcat02<span class="token punctuation">:</span><span class="token number">1.0</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker commit -m="add webapps app"  -a="一个平凡de人" 6df1e2c4a350 tomcat02:1.0</span>
sha256:e699f08da20e848d7a9bd7c8953b63500abe1ea6a6605838dc9f97876857c229
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY            TAG       IMAGE ID       CREATED          SIZE
tomcat02              <span class="token number">1.0</span>       e699f08da20e   <span class="token number">35</span> seconds ago   684MB <span class="token comment"># 自己镜像</span>
tomcat                latest    413407dddb5e   <span class="token number">4</span> days ago       680MB
redis                 latest    f1b6973564e9   <span class="token number">5</span> days ago       113MB
portainer/portainer   latest    580c0e4e98b0   <span class="token number">10</span> months ago    <span class="token number">79</span>.1MB
elasticsearch         <span class="token number">7.6</span>.2     f29a1ee41030   <span class="token number">22</span> months ago    791MB
</code></pre> 
<p>5、测试</p> 
<p>​ （1）启动</p> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>it <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">8080</span> tomcat02<span class="token punctuation">:</span><span class="token number">1.0</span>
</code></pre> 
<p>​ （2）windows访问，测试成功</p> 
<p><img src="https://images2.imgbox.com/f5/bc/bjAFeOxW_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>小节</p> 
</blockquote> 
<p>如果你想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像,就好比我们以前学习VM时候，快照保存虚拟机状态，之后可状态回滚！</p> 
<h2><a id="12_1514"></a>12、容器数据卷</h2> 
<blockquote> 
 <p>docker的理念回顾</p> 
</blockquote> 
<p>将应用和环境打包成一个镜像</p> 
<p>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！需求：数据可以持久化</p> 
<p>MySQL，容器删除了，删库跑路！需求：MySQL数据可以存储在本地！</p> 
<p>容器之间可以有一个数据共享的技术！Docker容器中产生的数据，同步到本地！</p> 
<p>这就是卷技术！<strong>目录的挂载</strong>，将我们容器内的目录，挂载到Linux上面！</p> 
<p><img src="https://images2.imgbox.com/54/ca/xARbfRgz_o.png" alt="在这里插入图片描述"></p> 
<p>使用卷技术的原因：容器的持久化和同步操作！容器间也是可以数据共享的！</p> 
<h3><a id="121__1533"></a>12.1 使用数据卷</h3> 
<p>挂载后 主机目录和容器目录<strong>共享</strong>一个目录资源，容器目录也可以理解为是主机目录的快捷方式</p> 
<blockquote> 
 <p>方式一 ：直接使用命令挂载 -v</p> 
</blockquote> 
<pre><code class="prism language-swift"><span class="token comment">//-v, --volume list      绑定挂载卷</span>
docker run <span class="token operator">-</span>it <span class="token operator">-</span>v 主机目录<span class="token punctuation">:</span>容器目录  <span class="token operator">-</span>p 主机端口<span class="token punctuation">:</span>容器内端口

<span class="token comment">//通过 查看挂载</span>
docker inspect 容器id
</code></pre> 
<p>1、挂载并进入命令行<code>/bin/bash</code></p> 
<pre><code class="prism language-swift">docker run <span class="token operator">-</span>it <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>ceshi<span class="token punctuation">:</span><span class="token operator">/</span>home centos <span class="token operator">/</span>bin<span class="token operator">/</span>bash
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span>
<span class="token punctuation">[</span>root@a40aea147d6d /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@a40aea147d6d home<span class="token punctuation">]</span><span class="token comment"># ls # 空</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
ceshi <span class="token comment"># 找到ceshi目录</span>
</code></pre> 
<p>2、查看挂载</p> 
<pre><code class="prism language-swift">docker inspect 【容器id】
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># docker inspect a40aea147d6d</span>
<span class="token comment"># ...</span>
<span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"bind"</span>,
                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/home/ceshi"</span>, <span class="token comment"># 挂载成功 主机目录</span>
                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"/home"</span>, <span class="token comment"># 挂载成功 容器目录</span>
                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">"rprivate"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
<span class="token comment"># ...</span>
</code></pre> 
<p>3、测试挂载</p> 
<p>挂载后 主机目录和容器目录<strong>共享</strong>一个目录资源，容器目录也可以理解为是主机目录的快捷方式</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@a40aea147d6d home<span class="token punctuation">]</span><span class="token comment"># touch test.txt # 创建文件</span>
<span class="token punctuation">[</span>root@a40aea147d6d home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.txt
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
ceshi
<span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># cd ceshi/</span>
<span class="token punctuation">[</span>root@192 ceshi<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.txt <span class="token comment"># 挂载成功，也test.txt文件</span>

<span class="token comment"># 向文件写入数据</span>
<span class="token punctuation">[</span>root@192 ceshi<span class="token punctuation">]</span><span class="token comment"># echo "This is test data" &gt; test.txt</span>
<span class="token punctuation">[</span>root@192 ceshi<span class="token punctuation">]</span><span class="token comment"># cat test.txt </span>
This is <span class="token builtin class-name">test</span> data
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment"># 容器内目录也有数据</span>
<span class="token punctuation">[</span>root@a40aea147d6d home<span class="token punctuation">]</span><span class="token comment"># cat test.txt </span>
This is <span class="token builtin class-name">test</span> data
</code></pre> 
<p>就算容器关闭，数据依旧一致。</p> 
<h3><a id="122_MySQL_1618"></a>12.2 MySQL同步数据实战</h3> 
<p>1、获取mysql镜像</p> 
<pre><code class="prism language-swift">docker pull mysql
</code></pre> 
<p>2、运行容器,挂载倆个数据目录，配置密码<code>-e MYSQL_ROOT_PASSWORD=password</code></p> 
<pre><code class="prism language-shell"><span class="token comment"># -e 环境配置，配置mysql密码</span>
docker run -d -p <span class="token number">3306</span>:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql  -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> --name mysql01 mysql
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql  -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql</span>
05574ce7407c7745ee28951f5ccc032062b83b9d9486ef6062a1d321df2ad0c8
</code></pre> 
<pre><code class="prism language-shell">
<span class="token comment"># 启动成功之后，我们在本地使用sqlyog来测试一下</span>
<span class="token comment"># sqlyog-连接到服务器的3306--和容器内的3306映射 </span>

<span class="token comment"># 在本地测试创建一个数据库，查看一下我们映射的路径是否ok！</span>
</code></pre> 
<p>3、测试连接，在windows上用数据库连接工具测试连接mysql容器·</p> 
<p><img src="https://images2.imgbox.com/36/51/I4BX78TX_o.png" alt="在这里插入图片描述"></p> 
<ul><li>连接成功</li></ul> 
<p><img src="https://images2.imgbox.com/13/90/yoaLznqs_o.png" alt="在这里插入图片描述"></p> 
<p>4、文件目录映射成功</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 mysql<span class="token punctuation">]</span><span class="token comment"># cd /home/mysql/</span>
<span class="token punctuation">[</span>root@192 mysql<span class="token punctuation">]</span><span class="token comment"># ls</span>
conf  data
<span class="token punctuation">[</span>root@192 mysql<span class="token punctuation">]</span><span class="token comment"># cd data</span>
<span class="token punctuation">[</span>root@192 data<span class="token punctuation">]</span><span class="token comment"># ls</span>
auto.cnf       ca-key.pem       <span class="token comment">#ib_16384_0.dblwr  ib_logfile0   mysql               public_key.pem   undo_001</span>
binlog.000001  ca.pem           <span class="token comment">#ib_16384_1.dblwr  ib_logfile1   mysql.ibd           server-cert.pem  undo_002</span>
binlog.000002  client-cert.pem  ib_buffer_pool     ibtmp1        performance_schema  server-key.pem
binlog.index   client-key.pem   ibdata1            <span class="token comment">#innodb_temp  private_key.pem     sys</span>
</code></pre> 
<p>5、linux中，一个数据库对应一个目录，一个数据表对应一个文件</p> 
<p>（1）创建数据库</p> 
<p><img src="https://images2.imgbox.com/49/94/BscWxfrT_o.png" alt="在这里插入图片描述"></p> 
<p>（2）成功看到test目录</p> 
<p><img src="https://images2.imgbox.com/1a/8e/OAg0sa9Q_o.png" alt="在这里插入图片描述"></p> 
<p>（3）创建数据表</p> 
<p><img src="https://images2.imgbox.com/ba/77/Yj9XMWvo_o.png" alt="在这里插入图片描述"></p> 
<p>（4）成功看到文件</p> 
<blockquote> 
 <p>容器数据持久化</p> 
</blockquote> 
<p>假设我们将容器删除，发现我们挂载到本地的数据卷依旧没有丢失，这就实现了容器数据持久化功能。</p> 
<h3><a id="123__1693"></a>12.3 具名挂载和匿名挂载</h3> 
<p><strong>卷指容器被挂载的主机目录</strong></p> 
<blockquote> 
 <p>匿名挂载</p> 
</blockquote> 
<p>1、匿名挂载就是不指定主机目录进行挂载（没有给卷（主机目录）起名就是匿名）</p> 
<pre><code class="prism language-shell"><span class="token comment"># -v 容器内路径!</span>
docker run -d -P --name nginx01 -v /etc/nginx nginx
</code></pre> 
<p>2、查看所有的volume（卷）的情况</p> 
<pre><code class="prism language-swift">docker volume ls   
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls   </span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c <span class="token comment">#这些字符串就代表匿名卷(目录),是匿名挂载</span>
<span class="token builtin class-name">local</span>     8ecbc00746d9bea6a8095e65ead44e30b5cbf49f7409bc58aff9fab4b10cf0f4
<span class="token builtin class-name">local</span>     d745315f9e2d743c1a83edc5312809efba67693b8a01a27eb0a49a4ff572a450
</code></pre> 
<p>3、指定卷来查看挂载</p> 
<pre><code class="prism language-swift"> docker volume inspect 7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment">#  docker volume inspect 7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-01T21:04:59+08:00"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c/_data"</span>,<span class="token comment"># 挂载的目录</span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c"</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

</code></pre> 
<blockquote> 
 <p>具名挂载</p> 
</blockquote> 
<p>1、具名挂载就是指定了主机目录进行挂载（有给卷（主机目录）起名就是具名（有具体的名））</p> 
<pre><code class="prism language-shell">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx
</code></pre> 
<p>2、查看所有的volume（卷）的情况</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># docker volume ls   </span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     7ef9dee8a0efcf74601d3ce615fc1a74a96008d861648d5f415c581ce426b44c
<span class="token builtin class-name">local</span>     8ecbc00746d9bea6a8095e65ead44e30b5cbf49f7409bc58aff9fab4b10cf0f4
<span class="token builtin class-name">local</span>     d745315f9e2d743c1a83edc5312809efba67693b8a01a27eb0a49a4ff572a450
<span class="token builtin class-name">local</span>     juming-nginx <span class="token comment">#有具体的名,具名挂载</span>
</code></pre> 
<p>3、指定卷来查看挂载</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># docker volume inspect juming-nginx</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-01T21:16:26+08:00"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/juming-nginx/_data"</span>, <span class="token comment"># 挂载的目录</span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"juming-nginx"</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>​ 所有的docker容器内的卷，没有指定<strong>绝对路径的目录</strong>的情况下都是在<code>/var/lib/docker/volumes/xxxx/_data</code>下的，<br> 如果指定了目录，<code>docker volume ls</code> 是查看不到的。</p> 
<blockquote> 
 <p>小节</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 三种挂载： 匿名挂载、具名挂载、指定路径挂载</span>
-v 容器内路径				<span class="token comment">#匿名挂载</span>
-v 卷名：容器内路径			  <span class="token comment">#具名挂载</span>
-v /宿主机路径：容器内路径 	<span class="token comment">#指定路径挂载 docker volume ls 是查看不到的</span>
</code></pre> 
<blockquote> 
 <p>拓展</p> 
</blockquote> 
<p>通过 -v 容器内路径： ro rw 改变读写权限</p> 
<pre><code class="prism language-shell">ro <span class="token comment">#readonly 只读</span>
rw <span class="token comment">#readwrite 可读可写</span>
docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx
docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx
</code></pre> 
<p>ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</p> 
<h2><a id="_1807"></a></h2> 
<h2><a id="13_Dockerfile_1809"></a>13、 初始Dockerfile</h2> 
<blockquote> 
 <p>什么是Dockerfile</p> 
</blockquote> 
<p>Dockerfile 是用来构建docker镜像的构建文件，是一段命令脚本。</p> 
<blockquote> 
 <p>创建Dockerfile</p> 
</blockquote> 
<p>1、创建docker的测试目录</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 _data<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@192 home<span class="token punctuation">]</span><span class="token comment"># mkdir docker-test-volume</span>
</code></pre> 
<p>2、创建Dockerfile脚本文件，通过这个脚本可以生成镜像,</p> 
<p>Dockerfile脚本文件内容分析:</p> 
<pre><code class="prism language-shell"><span class="token comment"># 文件中的内容 指令(大写) 参数</span>
<span class="token comment">#镜像是一层一层的，这里的每个命令，就是镜像的一层！</span>
FROM centos <span class="token comment"># 指定镜像</span>

VOLUME <span class="token punctuation">[</span><span class="token string">"volume01"</span>,<span class="token string">"volume02"</span><span class="token punctuation">]</span> <span class="token comment"># 挂载目录</span>

CMD <span class="token builtin class-name">echo</span> <span class="token string">"----end----"</span> <span class="token comment"># CMD 执行命令行命令 </span>
CMD /bin/bash
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 docker-test-volume<span class="token punctuation">]</span><span class="token comment"># vim dockerfile01</span>
<span class="token punctuation">[</span>root@192 docker-test-volume<span class="token punctuation">]</span><span class="token comment"># cat dockerfile01 </span>
FROM centos 

VOLUME <span class="token punctuation">[</span><span class="token string">"volume01"</span>,<span class="token string">"volume02"</span><span class="token punctuation">]</span> 

CMD <span class="token builtin class-name">echo</span> <span class="token string">"----end----"</span> 
CMD /bin/bash
</code></pre> 
<p>3、执行Dockerfile脚本文件，构建镜像</p> 
<pre><code class="prism language-swift">docker build <span class="token operator">-</span>f <span class="token operator">/</span>home<span class="token operator">/</span>docker<span class="token operator">-</span>test<span class="token operator">-</span>volume dockerfile01 <span class="token operator">-</span>t <span class="token operator">/</span>kuangshen<span class="token operator">/</span>centos <span class="token punctuation">.</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY            TAG       IMAGE ID       CREATED         SIZE
kuangshen/centos      latest    6b3e9b445d81   <span class="token number">3</span> hours ago     231MB <span class="token comment">#构建成功</span>
<span class="token comment"># ...</span>
</code></pre> 
<p>4、启动镜像，查看容器</p> 
<pre><code class="prism language-shell">docker run -it /kuangshen/centos /bin/bash
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@b68f2c5c965b /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var	   volume02
dev  home  lib64  media       opt  root  sbin  sys  usr  volume01
<span class="token comment"># 找到挂载的目录volume01、volume02</span>
</code></pre> 
<h2><a id="14__1876"></a>14、 数据卷容器</h2> 
<h3><a id="141___1878"></a>14.1 数据卷容器</h3> 
<p>容器挂载数据卷,实现容器间的数据同步和资源共享！</p> 
<p><img src="https://images2.imgbox.com/61/a5/2vFm4Vn0_o.png" alt="在这里插入图片描述"></p> 
<p>1、启动父容器docker01</p> 
<pre><code class="prism language-shell">docker run -it --name docker01 kuangshen/centos
</code></pre> 
<p>2、启动容器docker02并挂载到父容器docker01的共享卷,命令<code>--volumes-from 容器列表</code></p> 
<pre><code class="prism language-shell">docker run -it --name docker02 --volumes-from docker01 kuangshen/centos
</code></pre> 
<p>3、查看容器运行</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS          PORTS     NAMES
fa68f1afa235   kuangshen/centos   <span class="token string">"/bin/sh -c /bin/bash"</span>   <span class="token number">11</span> seconds ago   Up <span class="token number">10</span> seconds             docker02
eb991bf17656   kuangshen/centos   <span class="token string">"/bin/sh -c /bin/bash"</span>   <span class="token number">2</span> minutes ago    Up <span class="token number">2</span> minutes              docker01
</code></pre> 
<p>4、在父容器docker01的共享卷中创建文件，看docker02共享卷的变化</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@eb991bf17656 /<span class="token punctuation">]</span><span class="token comment"># cd volume01</span>
<span class="token punctuation">[</span>root@eb991bf17656 volume01<span class="token punctuation">]</span><span class="token comment"># touch docker.txt</span>
</code></pre> 
<ul><li>docker02容器内成功看到docker01创建的文件</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@fa68f1afa235 /<span class="token punctuation">]</span><span class="token comment"># cd volume01</span>
<span class="token punctuation">[</span>root@fa68f1afa235 volume01<span class="token punctuation">]</span><span class="token comment"># ls</span>
docker.txt
</code></pre> 
<p>5、再加个docker03试试，也有docker01创建的文件</p> 
<pre><code class="prism language-shell">docker run -it --name docker03 --volumes-from docker01 kuangshen/centos
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@e4ad9cb37d01 /<span class="token punctuation">]</span><span class="token comment"># cd volume01</span>
<span class="token punctuation">[</span>root@e4ad9cb37d01 volume01<span class="token punctuation">]</span><span class="token comment"># ls</span>
docker.txt
</code></pre> 
<p>6、小结</p> 
<ul><li> <p>docker03创建的文件docker01、docker02也同步共享。</p> </li><li> <p>删除docker01，docker02和docker03依旧保持数据同步和资源共享。</p> </li><li> <p>容器挂载后双向资源绑定，双向拷贝。</p> </li></ul> 
<h3><a id="142_Mysql_1943"></a>14.2 Mysql容器实现数据同步</h3> 
<p>1、启动mysql01,绑定端口3306,配置密码<code>-e MYSQL_ROOT_PASSWORD=password</code>,挂载卷<code>-v</code></p> 
<pre><code class="prism language-shell">docker run -it --name mysql01 -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> -v /etc/mysql/conf.d -v /var/lib/mysql mysql
</code></pre> 
<p>2、启动mysql02（绑定端口3307）、mysql03（绑定端口3308）</p> 
<pre><code class="prism language-shell"><span class="token comment"># mysql02</span>
docker run -it --name mysql02 --volumes-from mysql01 -p <span class="token number">3100</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> -v /etc/mysql/conf.d -v /var/lib/mysql mysql

<span class="token comment"># mysql03</span>
docker run -it --name mysql03 --volumes-from mysql01 -p <span class="token number">330</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> -v /etc/mysql/conf.d -v /var/lib/mysql mysql
</code></pre> 
<p>3、连接数据库测试</p> 
<blockquote> 
 <p>结论</p> 
</blockquote> 
<p>容器之间的配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。</p> 
<p>但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的！</p> 
<h2><a id="15Dockerfile_1971"></a>15、Dockerfile（重点）</h2> 
<p>dockerfile是用来构建docker镜像的文件！命令参数脚本！</p> 
<blockquote> 
 <p>构建步骤：</p> 
</blockquote> 
<p>1、 编写一个dockerfile文件</p> 
<p>2、 docker build 构建称为一个镜像</p> 
<p>3、 docker run运行镜像</p> 
<p>4、 docker push发布镜像（DockerHub 、阿里云仓库)</p> 
<blockquote> 
 <p>官方的镜像</p> 
</blockquote> 
<p>官方仓库搜索：https://hub.docker.com/_/centos</p> 
<p><img src="https://images2.imgbox.com/2e/23/arSIACr1_o.png" alt="在这里插入图片描述"></p> 
<p>点击版本跳转到Github,看到dockerfile文件：</p> 
<p>​ docker 99%的镜像都是从FROM scratch（基础镜像）开始<br> <img src="https://images2.imgbox.com/e3/6d/pnnSsfH4_o.png" alt="在这里插入图片描述"></p> 
<p>很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！</p> 
<p>官方既然可以制作镜像，那我们也可以！</p> 
<h3><a id="151_DockerFile_2002"></a>15.1 DockerFile构建过程</h3> 
<blockquote> 
 <p>DockerFile脚本文件语法</p> 
</blockquote> 
<p>1、每个保留关键字(指令）都是必须是大写字母</p> 
<p>2、执行从上到下顺序</p> 
<p>3、#表示注释</p> 
<p>4、每一个指令都会创建提交一个新的镜像曾，并提交！</p> 
<blockquote> 
 <p>Dockerfile</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/50/ed/TzRkPmsz_o.png" alt="img"></p> 
<p>Dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p> 
<p>Docker镜像逐渐成企业交付的标准，必须要掌握！</p> 
<p>DockerFile：构建文件，定义了一切的步骤，源代码</p> 
<p>DockerImages：通过DockerFile构建生成的镜像，最终发布和运行产品。</p> 
<p>Docker容器：容器就是镜像运行起来提供服务。</p> 
<blockquote> 
 <p>DockerFile的指令</p> 
</blockquote> 
<table><thead><tr><th>指令</th><th>解释</th><th>小写</th></tr></thead><tbody><tr><td>FROM</td><td>基础镜像，一切从这里开始构建</td><td>from</td></tr><tr><td>MAINTAINER</td><td>镜像是谁写的， 姓名+邮箱(翻译：维护人员)</td><td>maintainer</td></tr><tr><td>RUN</td><td>镜像构建的时候需要运行的命令</td><td>run</td></tr><tr><td>ADD</td><td>步骤，tomcat镜像，这个tomcat压缩包！添加内容 添加同目录</td><td>add</td></tr><tr><td>WORKDIR</td><td>镜像的工作目录</td><td>workdir</td></tr><tr><td>VOLUME</td><td>挂载的目录</td><td>volume</td></tr><tr><td>EXPOSE</td><td>保留端口配置（开放的端口）</td><td>expose</td></tr><tr><td>CMD</td><td>指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</td><td>cmd</td></tr><tr><td>ENTRYPOINT</td><td>指定这个容器启动的时候要运行的命令，可以追加命令（入口点）</td><td>entrypoint</td></tr><tr><td>ONBUILD</td><td>当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令，触发指令。</td><td>onbuild</td></tr><tr><td>COPY</td><td>类似ADD，将我们文件拷贝到镜像中</td><td>copy</td></tr><tr><td>ENV</td><td>构建的时候设置环境变量！</td><td>env</td></tr></tbody></table> 
<h3><a id="152_Dockerfile_2047"></a>15.2 Dockerfile实战</h3> 
<blockquote> 
 <p>创建一个自己的centos镜像</p> 
</blockquote> 
<p>官方的centos许多命令都没有，所以我们创建一个自己的centos镜像</p> 
<p>1、创建工作目录</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/home/dockerfile
<span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># vim centos-dockerfile</span>
</code></pre> 
<p>2、编写Dockerfile文件 (文件名：centos-dockerfile)</p> 
<pre><code class="prism language-shell">FROM centos
MAINTAINER root<span class="token operator">&lt;</span>id_07221888@qq.com<span class="token operator">&gt;</span>

ENV MYPATH /usr/local <span class="token comment"># 设置环境变量</span>
WORKDIR <span class="token variable">$MYPATH</span> <span class="token comment"># 镜像的工作目录，进入镜像的初始目录</span>
 
<span class="token comment"># RUN: 镜像构建的时候需要运行的命令 </span>
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>      <span class="token comment"># 新增 vim 工具</span>
RUN yum -y <span class="token function">install</span> net-tools <span class="token comment"># 新增 网络 工具 有ifconfig命令</span>

EXPOSE <span class="token number">80</span> <span class="token comment"># 开放的端口</span>

CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span> <span class="token comment"># CMD：容器启动的时候要运行的命令</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">"-----end----"</span>
CMD /bin/bash 
</code></pre> 
<pre><code class="prism language-shell">FROM centos
MAINTAINER root<span class="token operator">&lt;</span>id_07221888@qq.com<span class="token operator">&gt;</span>

ENV MYPATH /usr/local 
WORKDIR <span class="token variable">$MYPATH</span> 
 
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>      
RUN yum -y <span class="token function">install</span> net-tools 

EXPOSE <span class="token number">80</span> 

CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span> 
CMD <span class="token builtin class-name">echo</span> <span class="token string">"-----end----"</span>
CMD /bin/bash 
</code></pre> 
<p>3、通过这个文件构建镜像</p> 
<pre><code class="prism language-shell"><span class="token comment"># 命令 docker build -f 文件路径 -t 镜像名:[tag] .</span>
docker build -f /home/dockerfile/centos-dockerfile  -t mycentos:0.1 <span class="token builtin class-name">.</span>
</code></pre> 
<pre><code class="prism language-shell">Step <span class="token number">5</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 64495d343335
CentOS Linux <span class="token number">8</span> - AppStream                       <span class="token number">68</span>  B/s <span class="token operator">|</span>  <span class="token number">38</span>  B     00:00    
Error: Failed to download metadata <span class="token keyword">for</span> repo <span class="token string">'appstream'</span><span class="token builtin class-name">:</span> Cannot prepare internal mirrorlist: No URLs <span class="token keyword">in</span> mirrorlist
The <span class="token builtin class-name">command</span> <span class="token string">'/bin/sh -c yum -y install vim'</span> returned a non-zero code: <span class="token number">1</span>
</code></pre> 
<pre><code class="prism language-shell">因为没有vim这个rpm包。vim命令在vim-ehanced这个包内。
yum失败的可以在yum之前加一个更新软件源
</code></pre> 
<pre><code>systemctl stop firewalld.service                          # 停止防火墙 
</code></pre> 
<p>4、启动镜像</p> 
<blockquote> 
 <p>列出镜像的变更历史</p> 
</blockquote> 
<pre><code class="prism language-swift">docker history 镜像
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker history mysql</span>
IMAGE          CREATED      CREATED BY                                      SIZE      COMMENT
d1dc36cf8d9e   <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop)  CMD ["mysqld"]               0B        </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop)  EXPOSE 3306 33060            0B        </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop)  ENTRYPOINT ["docker-entry…   0B        </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token function">ln</span> -s usr/local/bin/docker-entryp…   34B       
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop) COPY file:c112ec3a02a7b818…   13.2kB    </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop) COPY dir:2e040acc386ebd23b…   1.12kB    </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token comment">#(nop)  VOLUME [/var/lib/mysql]      0B        </span>
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token punctuation">{<!-- --></span>   <span class="token builtin class-name">echo</span> mysql-community-server m…   384MB     
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token builtin class-name">echo</span> <span class="token string">'deb http://repo.mysql.com/a…   55B       
&lt;missing&gt;      6 days ago   /bin/sh -c #(nop)  ENV MYSQL_VERSION=8.0.28-…   0B        
&lt;missing&gt;      6 days ago   /bin/sh -c #(nop)  ENV MYSQL_MAJOR=8.0          0B        
&lt;missing&gt;      6 days ago   /bin/sh -c set -ex;  key='</span>859BE8D7C586F53843…   <span class="token number">2</span>.29kB    
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> install…   <span class="token number">52</span>.2MB    
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token function">mkdir</span> /docker-entrypoint-initdb.d    0B        
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">6</span> days ago   /bin/sh -c <span class="token builtin class-name">set</span> -eux<span class="token punctuation">;</span>  <span class="token assign-left variable">savedAptMark</span><span class="token operator">=</span><span class="token string">"$(apt-ma…   4.06MB    
&lt;missing&gt;      6 days ago   /bin/sh -c #(nop)  ENV GOSU_VERSION=1.14        0B        
&lt;missing&gt;      6 days ago   /bin/sh -c apt-get update &amp;&amp; apt-get install…   9.34MB    
&lt;missing&gt;      6 days ago   /bin/sh -c groupadd -r mysql &amp;&amp; useradd -r -…   329kB     
&lt;missing&gt;      7 days ago   /bin/sh -c #(nop)  CMD ["</span>bash"<span class="token punctuation">]</span>                 0B        
<span class="token operator">&lt;</span>missing<span class="token operator">&gt;</span>      <span class="token number">7</span> days ago   /bin/sh -c <span class="token comment">#(nop) ADD file:c51141702f568a28a…   69.3MB    </span>
</code></pre> 
<p>使用我们平时拿到一个镜像，可以研究一下是什么做的</p> 
<h3><a id="153_CMD__ENTRYPOINT_2161"></a>15.3 CMD 和 ENTRYPOINT区别</h3> 
<ul><li>CMD : 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。(替代的方式)</li><li>ENTRYPOINT : 指定这个容器启动的时候要运行的命令，可以追加命令。(追加的方式)</li></ul> 
<blockquote> 
 <p>测试cmd</p> 
</blockquote> 
<p>1、编写dockerfile文件</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># cat dockerfile-test-cmd</span>
FROM centos
CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
</code></pre> 
<p>2、 构建镜像</p> 
<pre><code class="prism language-shell">docker build  -f dockerfile-test-cmd -t cmd-test:0.1 <span class="token builtin class-name">.</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build  -f dockerfile-test-cmd -t cmd-test:0.1 .</span>
Sending build context to Docker daemon  <span class="token number">3</span>.072kB
Step <span class="token number">1</span>/2 <span class="token builtin class-name">:</span> FROM centos
 ---<span class="token operator">&gt;</span> 5d0da3dc9764
Step <span class="token number">2</span>/2 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 462edab225f4
Removing intermediate container 462edab225f4
 ---<span class="token operator">&gt;</span> 3a12f3d5b2a5
Successfully built 3a12f3d5b2a5
Successfully tagged cmd-test:0.1

</code></pre> 
<p>3、运行镜像</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run cmd-test:0.1</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
<span class="token comment"># .. </span>
<span class="token comment"># 列出了 容器内 根目录所有文件夹</span>
</code></pre> 
<p>4、想追加一个命令 -l 成为ls -al</p> 
<pre><code class="prism language-shell">docker run cmd-test:0.1 <span class="token function">ls</span> -al
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker run cmd-test:0.1 ls -al</span>
total <span class="token number">0</span>
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:53 <span class="token builtin class-name">.</span>
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:53 <span class="token punctuation">..</span>
-rwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">0</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:53 .dockerenv
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.   <span class="token number">5</span> root root <span class="token number">340</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:53 dev
<span class="token comment"># ...</span>
</code></pre> 
<blockquote> 
 <p>测试ENTRYPOINT</p> 
</blockquote> 
<p>1、编写dockerfile文件</p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> dockerfile-test-entrypoint
FROM centos
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
</code></pre> 
<p>2、构建镜像</p> 
<pre><code class="prism language-shell">docker build  -f dockerfile-test-entrypoint -t entrypoint-test:0.1 <span class="token builtin class-name">.</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED         SIZE
entrypoint-test   <span class="token number">0.1</span>       390f47c46bdd   <span class="token number">9</span> seconds ago   231MB
</code></pre> 
<p>3、想追加一个命令 -l</p> 
<pre><code class="prism language-shell">docker run entrypoint-test:0.1 -l
</code></pre> 
<ul><li>成功</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run entrypoint-test:0.1 -l</span>
total <span class="token number">0</span>
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:59 <span class="token builtin class-name">.</span>
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:59 <span class="token punctuation">..</span>
-rwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">0</span> Feb  <span class="token number">2</span> <span class="token number">13</span>:59 .dockerenv
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
<span class="token comment"># ...</span>
</code></pre> 
<h3><a id="154_Dockerfiletomcat_2271"></a>15.4 Dockerfile制作tomcat镜像</h3> 
<p>1、准备镜像文件</p> 
<p>准备tomcat 和 jdk到当前目录，编写好README</p> 
<p><a href="https://tomcat.apache.org/download-90.cgi" rel="nofollow">Apache Tomcat® - Apache Tomcat 9 Software Downloads</a></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 tomcat<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-9.0.58.tar.gz  jdk-8u60-linux-x64.tar.gz
<span class="token punctuation">[</span>root@192 tomcat<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/root/桌面/Kuang/tomcat
</code></pre> 
<ul><li>创建readme.txt文件</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 tomcat<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-9.0.58.tar.gz  Dockerfile  jdk-8u60-linux-x64.tar.gz  readme.txt
</code></pre> 
<p>2、编写dokerfile，官方命名<code>Dockerfile</code>,build 会自动寻找,就不用-f 指定了</p> 
<p><img src="https://images2.imgbox.com/2a/30/MH3zRX2u_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell">FROM centos 
MAINTAINER root<span class="token operator">&lt;</span>id_07221888@qq.com<span class="token operator">&gt;</span>
COPY readme.txt /usr/local/readme.txt <span class="token comment">#复制文件</span>

ADD jdk-8u60-linux-x64.tar.gz /usr/local/ <span class="token comment">#复制解压</span>
ADD apache-tomcat-9.0.58.tar.gz /usr/local/ 

ENV MYPATH /usr/local <span class="token comment">#设置环境变量</span>
WORKDIR <span class="token variable">$MYPATH</span> <span class="token comment">#设置工作目录</span>

ENV JAVA_HOME /usr/local/jdk1.8.0_60 <span class="token comment">#设置环境变量</span>
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools/jar

ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.58 <span class="token comment">#设置环境变量</span>
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.58

ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin <span class="token comment">#设置环境变量 分隔符是：</span>

EXPOSE <span class="token number">8080</span> <span class="token comment">#设置暴露的端口</span>

CMD /usr/local/apache-tomcat-9.0.58/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> -F /usr/local/apache-tomcat-9.0.58/bin/logs/catalina.out <span class="token comment"># 设置默认命令</span>
</code></pre> 
<pre><code>FROM centos #
MAINTAINER cheng&lt;1204598429@qq.com&gt;
COPY README /usr/local/README #复制文件
ADD jdk-8u231-linux-x64.tar.gz /usr/local/ #复制解压
ADD apache-tomcat-9.0.35.tar.gz /usr/local/ #复制解压
RUN yum -y install vim
ENV MYPATH /usr/local #设置环境变量
WORKDIR $MYPATH #设置工作目录
ENV JAVA_HOME /usr/local/jdk1.8.0_231 #设置环境变量
ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.35 #设置环境变量
ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib #设置环境变量 分隔符是：
EXPOSE 8080 #设置暴露的端口
CMD /usr/local/apache-tomcat-9.0.35/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.35/logs/catalina.out # 设置默认命令

</code></pre> 
<p>3、构造镜像</p> 
<pre><code class="prism language-shell">docker build  -t diytomcat <span class="token builtin class-name">.</span>
</code></pre> 
<p><strong>构建失败</strong></p> 
<p>4、运行镜像</p> 
<pre><code>docker run -d -p 8080:8080 --name tomcat01 -v /home/kuangshen/build/tomcat/test:/usr/local/apache-tomcat-9.0.35/webapps/test -v /home/kuangshen/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.35/logs mytomcat:0.1
</code></pre> 
<p>5、访问测试</p> 
<p>6、发布项目(由于做了卷挂载，我们直接在本地编写项目就可以发布了！)</p> 
<p>发现：项目部署成功，可以直接访问！</p> 
<p>我们以后开发的步骤：需要掌握Dockerfile的编写！我们之后的一切都是使用docker镜像来发布运行！</p> 
<h3><a id="155_DockerHub_2361"></a>15.5 发布镜像到DockerHub(常用)</h3> 
<p>1、登录远程仓库（ https://hub.docker.com/）</p> 
<p><img src="https://images2.imgbox.com/03/77/6ZnhdGzd_o.png" alt="在这里插入图片描述"></p> 
<p>2、终端登录</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker login --help</span>

Usage:  docker login <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span>

登录到Docker注册表。
如果没有指定服务器，则由守护进程定义默认值。

Options:
  -p, --password string   Password
      --password-stdin    从stdin获取密码
  -u, --username string   Username
</code></pre> 
<p>3、登录成功</p> 
<pre><code class="prism language-shell">docker login -u 【你的用户名】 -p 【你的密码】
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment">#  docker login -u 【你的用户名】 -p 【你的密码】</span>
WARNING<span class="token operator">!</span> Using --password via the CLI is insecure. Use --password-stdin.
WARNING<span class="token operator">!</span> Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment">#credentials-store</span>

Login Succeeded
</code></pre> 
<p>4、提交 push镜像</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED        SIZE
cmd-test          <span class="token number">0.1</span>       3a12f3d5b2a5   <span class="token number">18</span> hours ago   231MB
<span class="token comment"># ...</span>
</code></pre> 
<p>(1) 先打标签</p> 
<pre><code class="prism language-shell"><span class="token comment"># docker tag 镜像id 你的账户名/镜像仓库名:tag名</span>
docker tag 3a12f3d5b2a5 dockerywl/cmd-test:0.1
</code></pre> 
<p>(2) 再提交 push镜像</p> 
<pre><code class="prism language-shell"><span class="token comment"># docker push 作者/镜像:TAG(版本)</span>
docker push dockerywl/cmd-test:0.1
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker push dockerywl/cmd-test:0.1</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/dockerywl/cmd-test<span class="token punctuation">]</span>
74ddd0ec08fa: Pushing <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span>                                  <span class="token punctuation">]</span>  <span class="token number">77</span>.74MB/231.3MB
</code></pre> 
<p>(3) push成功</p> 
<p><img src="https://images2.imgbox.com/2a/d7/M5ms9qOR_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>发布到阿里云镜像服务上</p> 
</blockquote> 
<p>看官网 很详细https://cr.console.aliyun.com/repository/</p> 
<h3><a id="156__2444"></a>15.6 保存传输</h3> 
<p>保存后拷贝的U盘交给别人使用</p> 
<p>1、保存(压缩)成backup.tar</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker save --help</span>

Usage:  docker save <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>IMAGE<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

将一个或多个镜像保存到tar存档文件<span class="token punctuation">(</span>默认情况下流到STDOUT<span class="token punctuation">)</span>

Options:
  -o, --output string   写入一个文件，而不是STDOUT
</code></pre> 
<pre><code class="prism language-shell">docker save 镜像 -o 文件名
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker save redis -o backup.tar </span>
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># ls </span>
backup.tar  <span class="token comment"># 成功</span>
</code></pre> 
<p>2、加载（解压）镜像压缩文件backup.tar</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker load --help</span>

Usage:  docker load <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span>

从tar存档文件或STDIN加载镜像

Options:
  -i, --input string   从tar存档文件读取，而不是STDIN
  -q, --quiet          抑制负载输出
</code></pre> 
<pre><code class="prism language-shell">docker load -i backup.tar
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker load -i backup.tar</span>
92b6c42121d8: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">338</span>.4kB/338.4kB
65845b69eb5c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">4</span>.274MB/4.274MB
7048818d1657: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>   <span class="token number">27</span>.8MB/27.8MB
c61d5cbf8621: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">2</span>.048kB/2.048kB
ff503dae4eb6: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">3</span>.584kB/3.584kB
Loaded image: redis:latest <span class="token comment"># 成功</span>
</code></pre> 
<h3><a id="157_Docker_2501"></a>15.7 Docker所有流程小结（重点）</h3> 
<p><img src="https://images2.imgbox.com/e9/14/3psX6NLP_o.png" alt="image-20200516171155667"></p> 
<h2><a id="___2505"></a>= 容器内安装工具 =</h2> 
<p>tomcat 容器</p> 
<p><a href="https://www.runoob.com/linux/linux-comm-apt.html" rel="nofollow">Linux apt 命令 | 菜鸟教程 (runoob.com)</a></p> 
<pre><code class="prism language-shell"><span class="token comment"># 先执行</span>
<span class="token function">apt</span> update 

<span class="token comment"># 安装 ip 查看工具</span>
<span class="token function">apt</span> <span class="token function">install</span> -y iproute2

<span class="token comment"># 安装 ping 命令工具</span>
<span class="token function">apt-get</span> <span class="token function">install</span> inetutils-ping

<span class="token comment"># 安装 vim 命令工具</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span>

<span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span>  <span class="token function">apt</span> <span class="token function">install</span> -y iproute2 <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> inetutils-ping
</code></pre> 
<h2><a id="16Docker_2529"></a>16、Docker网络详解</h2> 
<p>容器编排、集群部署</p> 
<h3><a id="161_Docker_0_2533"></a>16.1 理解Docker 0(不推荐使用)</h3> 
<p>不推荐使用：Docker 0 不支持 ping 容器名</p> 
<blockquote> 
 <p>清空所有环境</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 删除所有镜像</span>
docker rmi -f <span class="token variable"><span class="token variable">$(</span>docker images<span class="token variable">)</span></span>

<span class="token comment"># 删除所有的容器</span>
docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span>   
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># ifconfig</span>
<span class="token comment"># docker0地址 有路由器的功能。</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        <span class="token comment"># ...</span>

<span class="token comment"># 本机地址</span>
ens33: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">192.168</span>.64.130  netmask <span class="token number">255.255</span>.255.0  broadcast <span class="token number">192.168</span>.64.255
        <span class="token comment"># ...</span>

<span class="token comment"># 本机回环地址</span>
lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        <span class="token comment"># ...</span>
</code></pre> 
<blockquote> 
 <p>Linux主机 与 容器 互相ping通</p> 
</blockquote> 
<p>1、新建容器</p> 
<pre><code class="prism language-shell">docker pull tomcat
docker run -it -d -P --name tomcat01 tomcat /bin/bash
</code></pre> 
<p>2、进入为容器安装 ip 查看工具</p> 
<pre><code class="prism language-shell">docker attath 容器id
<span class="token comment"># 常用</span>
<span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> -y iproute2
</code></pre> 
<p>3、查看容器内网ip</p> 
<p>​ docker分配的容器内网ip ： 172.17.0.2</p> 
<pre><code class="prism language-shell">root@138f304dfa38:/usr/local/tomcat<span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
       
<span class="token comment"># veth-pair技术 6 与  7 成对</span>
<span class="token number">6</span>: eth0@if7: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre> 
<p>4、可以ping通 (毕竟tomcat提供的服务外网都可以访问，肯定ping的通)</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># ping 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.048</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.052</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.085</span> ms
^C
--- <span class="token number">172.17</span>.0.2 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 2001ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.048</span>/0.061/0.085/0.018 ms
</code></pre> 
<p>5、进入为容器安装 ping 命令工具</p> 
<pre><code class="prism language-shell"><span class="token function">apt-get</span> <span class="token function">install</span> inetutils-ping
</code></pre> 
<p>6、 容器 ping通 Linux主机</p> 
<pre><code class="prism language-shell">root@138f304dfa38:/usr/local/tomcat<span class="token comment"># ping 192.168.64.130</span>
PING <span class="token number">192.168</span>.64.130 <span class="token punctuation">(</span><span class="token number">192.168</span>.64.130<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.64.130: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.294</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.64.130: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.125</span> ms
^C--- <span class="token number">192.168</span>.64.130 <span class="token function">ping</span> statistics ---
<span class="token number">7</span> packets transmitted, <span class="token number">7</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max/stddev <span class="token operator">=</span> <span class="token number">0.125</span>/0.181/0.294/0.056 ms
</code></pre> 
<blockquote> 
 <p>原理</p> 
</blockquote> 
<p>1、我们每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要按照了docker，就会有一个docker0桥接模式，使用的技术是veth-pair技术！</p> 
<p>https://www.cnblogs.com/bakari/p/10613710.html</p> 
<p>veth-pair 就是一对的虚拟设备接口，和 tap/tun 设备不同的是，它都是<strong>成对</strong>出现的。一端连着协议栈，一端彼此相连着。</p> 
<p>（成对：Linux 主机网卡 6,7成对，则容器网卡7，6成对）</p> 
<p>Linux 主机 再次执行 <code>ip addr</code>，多了个网卡</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token comment"># ...</span>
<span class="token number">2</span>: ens33: <span class="token comment"># ...</span>
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:a4:0b:89:6b brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
     <span class="token comment"># ...</span>
<span class="token comment"># 多了个网卡</span>
<span class="token number">7</span>: veth568cc5e@if6: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether de:55:c0:b4:58:42 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::dc55:c0ff:feb4:5842/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre> 
<p>2、再启动一个tocmat02容器，执行 <code>ip addr</code>，又多了个网卡</p> 
<pre><code class="prism language-shell">docker run -it -d -P --name tomcat02 tomcat
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># ip addr</span>
<span class="token comment"># ...</span>

<span class="token comment"># veth-pair技术 7 与  6 成对，Linux主机则为6 与 7成对</span>
<span class="token number">7</span>: veth568cc5e@if6: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether de:55:c0:b4:58:42 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::dc55:c0ff:feb4:5842/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token comment"># veth-pair技术 9 与  8 成对</span>
<span class="token number">9</span>: veth7668013@if8: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether 7a:c2:eb:86:ae:9f brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span>
    inet6 fe80::78c2:ebff:fe86:ae9f/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre> 
<p>3、进入tocmat02容器，为容器安装 ip 查看工具,ip:172.17.0.2</p> 
<pre><code class="prism language-shell"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> -y iproute2 
</code></pre> 
<pre><code class="prism language-shell">root@443a02110963:/usr/local/tomcat<span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">10</span>: eth0@if11: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
root@443a02110963:/usr/local/tomcat<span class="token comment"># </span>
</code></pre> 
<p>4、tomcat01与tocmat02 可以相互ping 通</p> 
<pre><code class="prism language-shell">root@443a02110963:/usr/local/tomcat<span class="token comment"># ping 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.129</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.279</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.142</span> ms
^C--- <span class="token number">172.17</span>.0.2 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max/stddev <span class="token operator">=</span> <span class="token number">0.129</span>/0.183/0.279/0.068 ms
</code></pre> 
<blockquote> 
 <p>结论</p> 
</blockquote> 
<p>tomcat01和tomcat02公用一个路由器，docker0。</p> 
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip。</p> 
<p><img src="https://images2.imgbox.com/87/ee/EZzg0gpM_o.png" alt="image-20200516174248626"></p> 
<p>Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥 docker0</p> 
<p><img src="https://images2.imgbox.com/57/67/LW80HfXI_o.png" alt="image-20200516174701063"></p> 
<p>Docker中所有网络接口都是虚拟的，虚拟的转发效率高（内网传递文件）</p> 
<p><strong>只要容器删除，对应的网桥一对就没了！</strong></p> 
<h3><a id="162_link_2733"></a>16.2 –link（不推荐使用）</h3> 
<blockquote> 
 <p>思考一个场景</p> 
</blockquote> 
<p>​ 我们编写了一个微服务，database url=ip: 项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器？（高可用）</p> 
<p>​ <strong>实现ping 通 容器名</strong></p> 
<blockquote> 
 <p>–link 作用</p> 
</blockquote> 
<p>​ docker run --link可以用来链接2个容器，使得源容器（被链接的容器）和接收容器（主动去链接的容器）之间可以互相通信，并且接收容器可以获取源容器的一些数据，如源容器的环境变量。</p> 
<blockquote> 
 <p>测试</p> 
</blockquote> 
<p>1、准备centos01、centos02</p> 
<pre><code class="prism language-shell">$ docker run -it -d --name centos01 centos 
$ docker run -it -d --name centos02 centos 
</code></pre> 
<p>2、实现ping不通容器名</p> 
<pre><code class="prism language-shell">$ docker <span class="token builtin class-name">exec</span> -it centos02 <span class="token function">ping</span> centos01 
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos02 ping centos01 </span>
ping: centos01: Name or <span class="token function">service</span> not known
</code></pre> 
<p>3、运行一个tomcat03 ,加上参数<code>--link centos02</code>，连接centos02</p> 
<pre><code class="prism language-shell">$ docker run -it --name centos03 --link centos02 centos /bin/bash
</code></pre> 
<pre><code>[root@a04540580e1b /]# ping centos02
PING centos02 (172.17.0.3) 56(84) bytes of data.
64 bytes from centos02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.118 ms
64 bytes from centos02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.110 ms
^C
--- centos02 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 0.110/0.114/0.118/0.004 ms
[root@a04540580e1b /]# 
</code></pre> 
<p>4、用centos03 ping centos02 可以ping通</p> 
<pre><code class="prism language-shell">docker <span class="token builtin class-name">exec</span> -it centos03 <span class="token function">ping</span> centos02
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos03 ping centos02</span>
PING centos02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from centos02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.071</span> ms
<span class="token number">64</span> bytes from centos02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.154</span> ms
^C
--- centos02 <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">2</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 1003ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.071</span>/0.112/0.154/0.042 ms
</code></pre> 
<p>但是用tomcat02 ping tomcat03 ping不通</p> 
<h3><a id="163_Docker_2804"></a>16.3 Docker网络探究</h3> 
<p><code>docker network</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
297f07c51979   bridge    bridge    <span class="token builtin class-name">local</span> <span class="token comment"># bridge:桥接 docker0</span>
87a8f8309bfa   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
51b67872ea20   none      null      <span class="token builtin class-name">local</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network --help</span>

Usage:  docker network COMMAND

Manage networks  <span class="token comment"># 管理网络</span>

Commands:
  connect     <span class="token comment"># 将容器连接到网络</span>
  create      <span class="token comment"># 创建网络</span>
  disconnect  <span class="token comment"># 断开一个容器与网络的连接</span>
  inspect     <span class="token comment"># 显示一个或多个网络的详细信息</span>
  <span class="token function">ls</span>          <span class="token comment"># 网络列表</span>
  prune       <span class="token comment"># 删除所有未使用的网络</span>
  <span class="token function">rm</span>          <span class="token comment"># 删除一个或多个网络</span>
</code></pre> 
<p>1、查看docker0的网络信息</p> 
<pre><code>docker network inspect 297f07c51979 
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect 297f07c51979 </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"297f07c5197942c2a4bc867abd31c61f6f804f1b7fc08b6e7b3da2839c77bc34"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-03T17:50:16.517397962+08:00"</span>,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,
        <span class="token string">"EnableIPv6"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"IPAM"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>, <span class="token comment"># default</span>
            <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"Subnet"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.0/16"</span>, <span class="token comment"># 网段</span>
                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Internal"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Attachable"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Ingress"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"ConfigFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Network"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"ConfigOnly"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"78904cf546599b37473b34ff4a5bf5f1af3a632e5bd80ff8e72904d7ed339c45"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat02"</span>, <span class="token comment"># tomcat02</span>
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"ea7126991ab6eab6d65f0bc8c0135d014446c919c9ceee1e94d1ddd8c07e5c80"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:03"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.3/16"</span>, <span class="token comment"># tomcat02 的 ip 地址</span>
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"95cac41f93906a08c79b49e84ed490b220032ee954c27b243835de6cb035bb56"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat01"</span>, <span class="token comment"># tomcat01</span>
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"4c10c4fe891272787fc69121be3f929a830fef79eca92c507f5fdccad9d83145"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.2/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment"># ...</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

</code></pre> 
<p>2、查看容器tomcat02详细信息</p> 
<pre><code class="prism language-shell">docker inspect 容器id
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect 78904cf54659</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"78904cf546599b37473b34ff4a5bf5f1af3a632e5bd80ff8e72904d7ed339c45"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-03T12:13:25.377988982Z"</span>,
        <span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"/bin/bash"</span>,
        <span class="token string">"Args"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"State"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment"># 主题</span>
            <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"running"</span>,
            <span class="token string">"Running"</span><span class="token builtin class-name">:</span> true, <span class="token comment"># 运行</span>
            <span class="token string">"Paused"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Restarting"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"OOMKilled"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Dead"</span><span class="token builtin class-name">:</span> false, 
            <span class="token string">"Pid"</span><span class="token builtin class-name">:</span> <span class="token number">9965</span>,
            <span class="token string">"ExitCode"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Error"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"StartedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-03T12:44:20.630270698Z"</span>,
            <span class="token string">"FinishedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-03T12:34:37.648949082Z"</span>
        <span class="token punctuation">}</span>,
      
        <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Hostname"</span><span class="token builtin class-name">:</span> <span class="token string">"78904cf54659"</span>,
            <span class="token string">"Domainname"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"User"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token comment"># ...</span>
            <span class="token string">"Env"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token comment"># 环境配置</span>
                <span class="token string">"PATH=/usr/local/tomcat/bin:/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>,
                <span class="token string">"JAVA_HOME=/usr/local/openjdk-11"</span>,
                <span class="token string">"LANG=C.UTF-8"</span>,
                <span class="token string">"JAVA_VERSION=11.0.13"</span>,
                <span class="token comment"># ...</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Cmd"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/bin/bash"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Image"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat"</span>, <span class="token comment"># 镜像</span>
            <span class="token string">"Volumes"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"WorkingDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/local/tomcat"</span>, <span class="token comment"># 工作目录</span>
            <span class="token string">"Entrypoint"</span><span class="token builtin class-name">:</span> null, 
            <span class="token string">"OnBuild"</span><span class="token builtin class-name">:</span> null,
            <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"NetworkSettings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Bridge"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"SandboxID"</span><span class="token builtin class-name">:</span> <span class="token string">"5ed43e901e7b9b49937e06d39a5f1fe73709437d70beaf8b07d3e56c48affcdf"</span>,
            <span class="token string">"HairpinMode"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"LinkLocalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"LinkLocalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Ports"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"8080/tcp"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"HostIp"</span><span class="token builtin class-name">:</span> <span class="token string">"0.0.0.0"</span>,
                        <span class="token string">"HostPort"</span><span class="token builtin class-name">:</span> <span class="token string">"49169"</span>
                    <span class="token punctuation">}</span>,
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"HostIp"</span><span class="token builtin class-name">:</span> <span class="token string">"::"</span>,
                        <span class="token string">"HostPort"</span><span class="token builtin class-name">:</span> <span class="token string">"49169"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>,
            <span class="token comment"># ...</span>
            <span class="token string">"Networks"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"bridge"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment"># 桥接</span>
                    <span class="token comment"># ...</span>
                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>, <span class="token comment"># 网关</span>
                    <span class="token string">"IPAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.3"</span>, <span class="token comment"># ip</span>
                    <span class="token comment"># ...</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>3、查看容器tomcat03详细信息，得到连接信息</p> 
<pre><code class="prism language-shell">docker inspect 4e6aae2d99dd
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment"># ...</span>
<span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment"># ...</span>
	<span class="token string">"Links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/tomcat02:/tomcat03/tomcat02"</span>
            <span class="token punctuation">]</span>,
	<span class="token comment"># ...</span>
<span class="token punctuation">}</span>
<span class="token comment"># ...</span>
</code></pre> 
<p>4、容器tomcat03配置了网络映射 将主机名(tomcat02)与ip地址host映射(不推荐使用)。</p> 
<pre><code>cat /etc/hosts
</code></pre> 
<p><img src="https://images2.imgbox.com/e5/3c/8sCmRqQU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="164__3000"></a>16.4 自定义网络</h3> 
<p>查看所有的docker网络</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
297f07c51979   bridge    bridge    <span class="token builtin class-name">local</span> <span class="token comment"># bridge:桥接 docker0</span>
87a8f8309bfa   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
51b67872ea20   none      null      <span class="token builtin class-name">local</span>
</code></pre> 
<blockquote> 
 <p>网络模式</p> 
</blockquote> 
<p>bridge ：桥接 docker（默认，自己创建也是用bridge模式）</p> 
<p>none ：不配置网络，一般不用</p> 
<p>host ：和所主机共享网络</p> 
<p>container ：容器网络连通（用得少！局限很大）</p> 
<blockquote> 
 <p>自定义一个网络</p> 
</blockquote> 
<p>1、默认参数 <code>-net bridge</code></p> 
<pre><code class="prism language-shell"><span class="token comment"># 启动时 --net bridge 是默认带上的,bridge就是docker0</span>
$ docker run -d -P --name tomcat01 tomcat 等价于 <span class="token operator">=</span><span class="token operator">&gt;</span> docker run -d -P --name tomcat01 --net bridge tomcat
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment"># docker0，特点：默认，域名不能访问。 --link可以打通连接，但是很麻烦！</span>
</code></pre> 
<p>2、创建网络的命令</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network create --help</span>

Usage:  docker network create <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> NETWORK

Create a network

Options:
      --attachable           <span class="token comment"># 启用手动容器附件</span>
      --aux-address map      <span class="token comment"># map网络驱动使用的辅助IPv4或IPv6地址(默认map[])</span>
      --config-from string   <span class="token comment"># 要复制配置的网络</span>
      --config-only          <span class="token comment"># 创建仅配置网络</span>
  -d, --driver string        <span class="token comment"># 管理网络的驱动程序(默认为“bridge”)</span>
      --gateway strings      <span class="token comment"># IPv4或IPv6主子网网关</span>
      --ingress              <span class="token comment"># 创建群路由-mesh网络</span>
      --internal             <span class="token comment"># 限制外部用户访问网络</span>
      --ip-range strings     <span class="token comment"># 从子范围分配容器ip</span>
      --ipam-driver string   <span class="token comment"># IP地址管理驱动程序(默认为“default”)</span>
      --ipam-opt map         <span class="token comment"># map设置IPAM驱动的特定选项(default map[])</span>
      --ipv6                 <span class="token comment"># 启用ipv6组网功能</span>
      --label list           <span class="token comment"># list设置网络元数据</span>
  -o, --opt map              <span class="token comment"># 设置驱动程序的特定选项(默认map[])</span>
      --scope string         <span class="token comment"># 控制网络范围</span>
      --subnet strings       <span class="token comment"># CIDR格式的子网，表示一个网段</span>
</code></pre> 
<p>3、自定义一个网络（创建网络）,名字为mynet</p> 
<pre><code class="prism language-shell">$ docker network create --driver bridge --subnet <span class="token number">192.168</span>.0.0/16 --gateway <span class="token number">192.168</span>.0.1 mynet
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment">#  docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span>
6293fb8f0a642641dc0f6043b7a666690406db6423070b08f6af38a67e96e64f
</code></pre> 
<p>4、查看自定义的网络mynet</p> 
<pre><code class="prism language-shell">$ docker network inspect mynet
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"mynet"</span>,
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"6293fb8f0a642641dc0f6043b7a666690406db6423070b08f6af38a67e96e64f"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-04T10:06:47.753633784+08:00"</span>,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>, <span class="token comment">#网络模式 bridge(桥接)</span>
        <span class="token string">"EnableIPv6"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"IPAM"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
            <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,
            <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"Subnet"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.0/16"</span>, <span class="token comment"># 子网 192.168.0.2 ~ 192.168.255.254</span>
                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.1"</span> <span class="token comment"># 网关</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token comment"># ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>创建容器，配置网络</p> 
</blockquote> 
<p>1、创建容器01、02</p> 
<pre><code class="prism language-shell"><span class="token comment">#  接 /bin/bash 直接进命令行</span>
docker run -it --name centos-net01 --net mynet centos 
docker run -it --name centos-net02 --net mynet centos 
</code></pre> 
<p>2、再次查看自定义的网络mynet，可见多了新增容器01、02的网络配置</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"mynet"</span>,
        <span class="token comment"># ...</span>
         <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"0c9e72313626017f9143fef9bfe9acb70f0ed46c352c8f6ed0612675c666379d"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"centos-net01"</span>, <span class="token comment"># centos-net01</span>
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"a228cec33c9019f31999f9b8c9ced3e60d3e611ae395d147b0db2ea920fce4ed"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:02"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.2/16"</span>, <span class="token comment"># ip地址： 192.168.0.2</span>
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"c31a887225dfa9572bc47703d838932590d9a5188b1fe13e82cd5851e286b497"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"centos-net02"</span>, <span class="token comment"># centos-net02</span>
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"7f4864f0e52fb36149cfffa78bde3ee88e38ea20202eca4c0b4ec5136e62ec94"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:03"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.3/16"</span>, <span class="token comment"># ip地址： 192.168.0.3</span>
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>3、在自定义的网络下，服务可以互相ping通，不用使用<code>–link</code></p> 
<ul><li>01 ping 通 02</li></ul> 
<pre><code class="prism language-shell">docker <span class="token builtin class-name">exec</span> -it centos-net01 <span class="token function">ping</span> centos-net02 
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos-net01 ping centos-net02 </span>
PING centos-net02 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from centos-net02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.072</span> ms
<span class="token number">64</span> bytes from centos-net02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.077</span> ms
<span class="token number">64</span> bytes from centos-net02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.081</span> ms
<span class="token number">64</span> bytes from centos-net02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.110</span> ms
^C
--- centos-net02 <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3004ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.072</span>/0.085/0.110/0.014 ms
</code></pre> 
<ul><li>反之亦然，02 ping 通 01</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos-net02 ping centos-net01</span>
PING centos-net01 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from centos-net01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.049</span> ms
<span class="token number">64</span> bytes from centos-net01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.095</span> ms
^C
--- centos-net01 <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">2</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 1003ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.049</span>/0.072/0.095/0.023 ms
</code></pre> 
<p>4、查看host映射,映射 <code>ip 对应 容器id</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos-net02 cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
<span class="token comment"># ...</span>
<span class="token number">192.168</span>.0.3	c31a887225df <span class="token comment"># ip 对应 容器id（centos-net01 的ip）</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos-net01 cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
<span class="token comment"># ...</span>
<span class="token number">192.168</span>.0.2	0c9e72313626 <span class="token comment"># ip 对应 容器id（centos-net02 的ip）</span>
</code></pre> 
<p>我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！</p> 
<p>好处：</p> 
<p>redis -不同的集群使用不同的网络，保证集群是安全和健康的</p> 
<p>mysql-不同的集群使用不同的网络，保证集群是安全和健康的</p> 
<p><img src="https://images2.imgbox.com/17/10/xixdFZRG_o.png" alt="image-20200516192504367"></p> 
<h3><a id="165__3207"></a>16.5 网络连通</h3> 
<p>解决问题，网段不同如何ping通</p> 
<p><img src="https://images2.imgbox.com/1e/e5/Kke9inkh_o.png" alt="在这里插入图片描述"></p> 
<p>1、创建容器 centos01，测试ping 容器名失败</p> 
<pre><code class="prism language-shell">$ docker run -dit --name centos01 centos
$ docker <span class="token builtin class-name">exec</span> -it centos01 <span class="token function">ping</span> centos-net01
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment">#  docker exec -it centos01 ping centos-net01</span>
ping: centos-net01: Name or <span class="token function">service</span> not known
</code></pre> 
<p>2、解决方法：<code>docker network connect</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># clear</span>
<span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker network connect --help</span>

<span class="token comment"># NETWORK：工作网络（mynet）</span>
Usage:  docker network connect <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> NETWORK CONTAINER

Connect a container to a network <span class="token comment"># 将容器连接到网络中</span>

Options:
      --alias strings           <span class="token comment"># 为容器添加网络范围的别名</span>
      --driver-opt strings      <span class="token comment"># 网络驱动选项</span>
      --ip string               <span class="token comment"># IPv4地址(例如172.30.100.104)</span>
      --ip6 string              <span class="token comment"># IPv6地址(例如,2001:db8:: 33)</span>
      --link list               <span class="token comment"># 添加链接到另一个容器</span>
      --link-local-ip strings   <span class="token comment"># 为容器添加链路本地地址</span>
</code></pre> 
<p>3、将网络mynet与 centos01容器连通</p> 
<pre><code class="prism language-shell">$ docker network connect mynet centos01
</code></pre> 
<p>4、查看mynet</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect mynet </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"mynet"</span>,
        <span class="token comment"># ...</span>
        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"0c9e72313626017f9143fef9bfe9acb70f0ed46c352c8f6ed0612675c666379d"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"centos-net01"</span>,
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"b09c89b344437d0a166567d03358cdb6f2c05a6833813501285ed516abe641df"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:02"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.2/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"c31a887225dfa9572bc47703d838932590d9a5188b1fe13e82cd5851e286b497"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"centos-net02"</span>,
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"eda6dd675c194a84e6d398ee8c16cc6b42d67fb91069264d00d05ada7dd5633b"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:04"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.4/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"dac6694051750f990fa6fac796795d60b8e4578d9b72f90fbc9519b54e6498ac"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"centos01"</span>, <span class="token comment"># 新增centos01</span>
                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"e79c29a2d531dd69b766ee6253f1562d7a8bcbc6accfab23cb6df5cdbaa6a7a0"</span>,
                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:03"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.3/16"</span>, <span class="token comment"># 公网ip </span>
                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token comment"># ...</span>
</code></pre> 
<ul><li>centos01容器的hosts文件(<strong>一个容器两个ip</strong>)</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos01 cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
<span class="token comment"># ... </span>
<span class="token comment">#  dac669405175 是 centos01容器自己的 容器id</span>
<span class="token number">172.17</span>.0.2	dac669405175 <span class="token comment"># 私网ip =&gt; 容器id</span>
<span class="token number">192.168</span>.0.3	dac669405175 <span class="token comment"># 公网ip =&gt; 容器id</span>
</code></pre> 
<ul><li>centos-net01容器的hosts文件</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it centos-net01 cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
<span class="token comment"># ...</span>
<span class="token number">192.168</span>.0.2	0c9e72313626  <span class="token comment"># 私网(公网)ip =&gt; 容器id</span>
</code></pre> 
<p>5、再次测试，centos01与 centos-net01、centos-net02 均可ping通</p> 
<pre><code class="prism language-shell">$ docker <span class="token builtin class-name">exec</span> -it centos01 <span class="token function">ping</span> centos-net01
$ docker <span class="token builtin class-name">exec</span> -it centos01 <span class="token function">ping</span> centos-net02
$ docker <span class="token builtin class-name">exec</span> -it centos-net01 <span class="token function">ping</span> centos01 
$ docker <span class="token builtin class-name">exec</span> -it centos-net02 <span class="token function">ping</span> centos01 
</code></pre> 
<blockquote> 
 <p>结论</p> 
</blockquote> 
<p>假设要跨网络操作别人，就需要使用<code>docker network connect</code>连通！</p> 
<h2><a id="17Redis_3319"></a>17、Redis集群部署实战</h2> 
<h3><a id="171__3321"></a>17.1 部署</h3> 
<blockquote> 
 <p>环境</p> 
</blockquote> 
<p>三主三从</p> 
<p><img src="https://images2.imgbox.com/7d/dc/8qMJyzr3_o.png" alt="在这里插入图片描述"></p> 
<p>1、创建网卡</p> 
<pre><code class="prism language-shell">$ docker network create redisnet --subnet <span class="token number">172.38</span>.0.0/16
</code></pre> 
<p>2、通过脚本创建六个redis配置文件</p> 
<pre><code class="prism language-shell"><span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">mkdir</span> -p /mydata/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf</span>
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF</span>
<span class="token keyword">done</span>
</code></pre> 
<ul><li>查看redis配置文件</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># cd /mydata/redis/</span>
<span class="token punctuation">[</span>root@192 redis<span class="token punctuation">]</span><span class="token comment"># ls</span>
node-1  node-2  node-3  node-4  node-5  node-6
<span class="token punctuation">[</span>root@192 conf<span class="token punctuation">]</span><span class="token comment"># cd /mydata/redis/node-1/conf</span>
<span class="token punctuation">[</span>root@192 conf<span class="token punctuation">]</span><span class="token comment"># ls</span>
redis.conf
<span class="token punctuation">[</span>root@192 conf<span class="token punctuation">]</span><span class="token comment"># cat redis.conf </span>
port <span class="token number">6379</span>
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0
cluster-enabled <span class="token function">yes</span>
cluster-config-file nodes.conf
cluster-node-timeout <span class="token number">5000</span>
cluster-announce-ip <span class="token number">172.38</span>.0.11
cluster-announce-port <span class="token number">6379</span>
cluster-announce-bus-port <span class="token number">16379</span>
appendonly <span class="token function">yes</span>
</code></pre> 
<p>3、通过脚本创建和运行六个redis容器，<code>--ip</code> 指定ip，<code>-v</code>挂载redis配置文件和数据</p> 
<pre><code class="prism language-shell"><span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
docker run -p <span class="token number">637</span><span class="token variable">${port}</span>:6379 -p <span class="token number">1667</span><span class="token variable">${port}</span>:16379 --name redis-<span class="token variable">${port}</span> <span class="token punctuation">\</span>
-v /mydata/redis/node-<span class="token variable">${port}</span>/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.1<span class="token variable">${port}</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token keyword">done</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/d7/dU4TOjZi_o.png" alt="在这里插入图片描述"></p> 
<ul><li>或者一个一个容器添加</li></ul> 
<pre><code class="prism language-shell">docker run -p <span class="token number">6371</span>:6379 -p <span class="token number">16671</span>:16379 --name redis-1 <span class="token punctuation">\</span>
-v /mydata/redis/node-1/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

docker run -p <span class="token number">6372</span>:6379 -p <span class="token number">16672</span>:16379 --name redis-2 <span class="token punctuation">\</span>
-v /mydata/redis/node-2/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

docker run -p <span class="token number">6373</span>:6379 -p <span class="token number">16673</span>:16379 --name redis-3 <span class="token punctuation">\</span>
-v /mydata/redis/node-3/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

docker run -p <span class="token number">6374</span>:6379 -p <span class="token number">16674</span>:16379 --name redis-4 <span class="token punctuation">\</span>
-v /mydata/redis/node-4/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

docker run -p <span class="token number">6375</span>:6379 -p <span class="token number">16675</span>:16379 --name redis-5 <span class="token punctuation">\</span>
-v /mydata/redis/node-5/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

docker run -p <span class="token number">6376</span>:6379 -p <span class="token number">16676</span>:16379 --name redis-6 <span class="token punctuation">\</span>
-v /mydata/redis/node-6/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redisnet --ip <span class="token number">172.38</span>.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
</code></pre> 
<p>4、查看创建的redis容器</p> 
<p>（秒退的，可以用docker logs redis-1 查看日志）</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 conf<span class="token punctuation">]</span><span class="token comment">#  docker ps </span>
CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                                                                      NAMES
49e9e62c7fff   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">20</span> seconds ago   Up <span class="token number">19</span> seconds   <span class="token number">0.0</span>.0.0:6376-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6376-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16676-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16676-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-6
691b11db10c8   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">21</span> seconds ago   Up <span class="token number">20</span> seconds   <span class="token number">0.0</span>.0.0:6375-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6375-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16675-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16675-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-5
fc37037e7ae9   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">22</span> seconds ago   Up <span class="token number">20</span> seconds   <span class="token number">0.0</span>.0.0:6374-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6374-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16674-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16674-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-4
85ef9071ac9b   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">22</span> seconds ago   Up <span class="token number">21</span> seconds   <span class="token number">0.0</span>.0.0:6373-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6373-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16673-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16673-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-3
44b92119b2b3   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">23</span> seconds ago   Up <span class="token number">21</span> seconds   <span class="token number">0.0</span>.0.0:6372-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6372-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16672-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16672-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-2
269b8eb57942   redis:5.0.9-alpine3.11   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">23</span> seconds ago   Up <span class="token number">22</span> seconds   <span class="token number">0.0</span>.0.0:6371-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6371-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, <span class="token number">0.0</span>.0.0:16671-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp, :::16671-<span class="token operator">&gt;</span><span class="token number">16379</span>/tcp   redis-1

</code></pre> 
<p>5、查看网络redisnet的信息（Containers字段内省略了数据）</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 conf<span class="token punctuation">]</span><span class="token comment"># docker inspect redisnet </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redisnet"</span>,
        <span class="token comment"># ...</span>
        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"269b8eb57942dd3c816247251c1d4a0299c86d8dbfa45c1e60fd68b1e0b5e470"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redis-1"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.11/16"</span>,
            <span class="token punctuation">}</span>,
            <span class="token string">"44b92119b2b3573e1a8e15a1e435cd3c1cde30a6fc3f960189a88f715e962fec"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redis-2"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.12/16"</span>,
            <span class="token punctuation">}</span>,
            <span class="token string">"49e9e62c7ffff2955194095818f4b806e609329350456e65c2bec9f5932bd8f6"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redis-6"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.16/16"</span>,
            <span class="token punctuation">}</span>,
            <span class="token string">"691b11db10c8403b999386caec7ad20dad535aa0d0e3f9d98214423b328f23de"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.15/16"</span>,
            <span class="token punctuation">}</span>,
            <span class="token string">"85ef9071ac9bbacc25cda715a695819e32fa17945956ae2c744e43b841e27af6"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redis-3"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.13/16"</span>,
            <span class="token punctuation">}</span>,
            <span class="token string">"fc37037e7ae9ed007bef0290f3610f3a3cbbde744189a7b3e3a112b9497e7e5a"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"redis-4"</span>,
                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.38.0.14/16"</span>,
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token comment"># ...</span>
</code></pre> 
<p>5、<strong>创建集群</strong>,(redis默认没有bash,所以用 /bin/sh)</p> 
<p>（1）进入redis-1容器</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it redis-1 /bin/sh </span>
/data <span class="token comment"># ls</span>
appendonly.aof  nodes.conf
/data <span class="token comment"># </span>
</code></pre> 
<p>（2） 创建集群</p> 
<pre><code class="prism language-shell">redis-cli --cluster create <span class="token number">172.38</span>.0.11:6379 <span class="token number">172.38</span>.0.12:6379 <span class="token number">172.38</span>.0.13:6379 <span class="token number">172.38</span>.0.14:6379 <span class="token number">172.38</span>.0.15:6379 <span class="token number">172.38</span>.0.16:6379  --cluster-replicas <span class="token number">1</span>
</code></pre> 
<pre><code class="prism language-shell">/data <span class="token comment"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:637</span>
<span class="token number">9</span> <span class="token number">172.38</span>.0.16:6379  --cluster-replicas <span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span> <span class="token comment"># 三主三从</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">172.38</span>.0.15:6379 to <span class="token number">172.38</span>.0.11:6379
Adding replica <span class="token number">172.38</span>.0.16:6379 to <span class="token number">172.38</span>.0.12:6379
Adding replica <span class="token number">172.38</span>.0.14:6379 to <span class="token number">172.38</span>.0.13:6379
M: 7866a044a62217acc264e0780724baebfcbdf9ec <span class="token number">172.38</span>.0.11:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: e2210b65a712c43fce9cb11a40605d4ae6afc61c <span class="token number">172.38</span>.0.12:6379
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: a2d9d996b447f724860502d4230434d8fbef45bb <span class="token number">172.38</span>.0.13:6379
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: eaa1f8ba8de966a6fffaed6b43e0226d95caffb9 <span class="token number">172.38</span>.0.14:6379
   replicates a2d9d996b447f724860502d4230434d8fbef45bb
S: 35fcc7906fda3c977cf6fe09ebfd4632c8288449 <span class="token number">172.38</span>.0.15:6379
   replicates 7866a044a62217acc264e0780724baebfcbdf9ec
S: 59c81a95ed20b8964246dee3bfc333e25960275a <span class="token number">172.38</span>.0.16:6379
   replicates e2210b65a712c43fce9cb11a40605d4ae6afc61c
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each node
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using node <span class="token number">172.38</span>.0.11:6379<span class="token punctuation">)</span>
M: 7866a044a62217acc264e0780724baebfcbdf9ec <span class="token number">172.38</span>.0.11:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 35fcc7906fda3c977cf6fe09ebfd4632c8288449 <span class="token number">172.38</span>.0.15:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 7866a044a62217acc264e0780724baebfcbdf9ec
M: a2d9d996b447f724860502d4230434d8fbef45bb <span class="token number">172.38</span>.0.13:6379
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 59c81a95ed20b8964246dee3bfc333e25960275a <span class="token number">172.38</span>.0.16:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates e2210b65a712c43fce9cb11a40605d4ae6afc61c
M: e2210b65a712c43fce9cb11a40605d4ae6afc61c <span class="token number">172.38</span>.0.12:6379
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: eaa1f8ba8de966a6fffaed6b43e0226d95caffb9 <span class="token number">172.38</span>.0.14:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates a2d9d996b447f724860502d4230434d8fbef45bb
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre> 
<h3><a id="172_Redis_3551"></a>17.2 测试Redis集群</h3> 
<p>Redis三种模式:主从模式, 哨兵模式, <strong>集群模式（推荐）</strong></p> 
<p>1、redis-cli -c 代表进入集群</p> 
<pre><code class="prism language-shell">/data <span class="token comment"># redis-cli -c</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster info
cluster_state:ok
<span class="token comment"># ..</span>
cluster_known_nodes:6 <span class="token comment"># 节点：6</span>
cluster_size:3 <span class="token comment"># 集群数量：3</span>
<span class="token comment"># ...</span>
</code></pre> 
<p>2、查看节点信息</p> 
<pre><code class="prism language-shell"><span class="token comment"># master(主)  slave(从)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
35fcc7906fda3c977cf6fe09ebfd4632c8288449 <span class="token number">172.38</span>.0.15:6379@16379 slave 7866a044a62217acc264e0780724baebfcbdf9ec <span class="token number">0</span> <span class="token number">1643970509988</span> <span class="token number">5</span> connected
a2d9d996b447f724860502d4230434d8fbef45bb <span class="token number">172.38</span>.0.13:6379@16379 master - <span class="token number">0</span> <span class="token number">1643970508952</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
59c81a95ed20b8964246dee3bfc333e25960275a <span class="token number">172.38</span>.0.16:6379@16379 slave e2210b65a712c43fce9cb11a40605d4ae6afc61c <span class="token number">0</span> <span class="token number">1643970509257</span> <span class="token number">6</span> connected
e2210b65a712c43fce9cb11a40605d4ae6afc61c <span class="token number">172.38</span>.0.12:6379@16379 master - <span class="token number">0</span> <span class="token number">1643970508000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
eaa1f8ba8de966a6fffaed6b43e0226d95caffb9 <span class="token number">172.38</span>.0.14:6379@16379 slave a2d9d996b447f724860502d4230434d8fbef45bb <span class="token number">0</span> <span class="token number">1643970509000</span> <span class="token number">4</span> connected
7866a044a62217acc264e0780724baebfcbdf9ec <span class="token number">172.38</span>.0.11:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1643970507000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
</code></pre> 
<p>3、高可用测试</p> 
<p>（1）存值（由redis-2处理）</p> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name zs
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">5798</span><span class="token punctuation">]</span> located at <span class="token number">172.38</span>.0.12:6379 <span class="token comment"># 12 =&gt; redis-2</span>
OK
<span class="token number">172.38</span>.0.12:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"zs"</span>
</code></pre> 
<p>（2）停止redis-2</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 ~<span class="token punctuation">]</span><span class="token comment"># docker stop redis-2</span>
redis-2
</code></pre> 
<p>（3）依旧可取（此时由redis-6处理，redis-6顶上了）。高可用</p> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">5798</span><span class="token punctuation">]</span> located at <span class="token number">172.38</span>.0.16:6379 <span class="token comment"># 16 =&gt; redis-6</span>
<span class="token string">"zs"</span>
</code></pre> 
<p>（4）查看节点信息<code>cluster nodes</code></p> 
<p><img src="https://images2.imgbox.com/23/8c/LFpEFnQX_o.png" alt="在这里插入图片描述"></p> 
<p>我们使用docker之后，所有的技术都会慢慢变得简单起来！</p> 
<h2><a id="18SpringBootDocker_3618"></a>18、SpringBoot微服务打包Docker镜像</h2> 
<h3><a id="181_SpringBoot_3620"></a>18.1 构建SpringBoot项目</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>colltroller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloColltroer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"hello,一个平凡de人"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>运行</li></ul> 
<p><img src="https://images2.imgbox.com/0f/36/WCUg4h0w_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="182_jar_3643"></a>18.2 打jar包</h3> 
<p>1、 双击Maven package打包</p> 
<p><img src="https://images2.imgbox.com/01/95/CC1NoeEm_o.png" alt="在这里插入图片描述"></p> 
<p>2、打包成功</p> 
<p><img src="https://images2.imgbox.com/d9/f1/yVv6Lfos_o.png" alt="在这里插入图片描述"></p> 
<p>3、测试jar是否可以运行,访问<a href="http://127.0.0.1:8080/hello" rel="nofollow">127.0.0.1:8080/hello</a>运行成功</p> 
<pre><code class="prism language-shell">$ java -jar demo1-0.0.1-SNAPSHOT.jar
</code></pre> 
<p>4、idea安装docker插件</p> 
<p><img src="https://images2.imgbox.com/4e/5c/wbCirs8b_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="183_jar_3668"></a>18.3 上传jar包</h3> 
<p>在idea项目根目录创建并编写Dockerfile文件</p> 
<pre><code class="prism language-shell">FROM java:11
COPY *.jar /app.jar
CMD <span class="token punctuation">[</span><span class="token string">"--server.port=8080"</span><span class="token punctuation">]</span>
EXPOSE <span class="token number">8080</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span>,<span class="token string">"-jar"</span>,<span class="token string">"app.jar"</span><span class="token punctuation">]</span>
</code></pre> 
<p>将jar包和Dockerfile上传到服务器</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/home/idea
<span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># ls</span>
demo1-0.0.1-SNAPSHOT.jar  Dockerfile
</code></pre> 
<h3><a id="184__3689"></a>18.4 构建镜像</h3> 
<p>1、构建镜像</p> 
<pre><code class="prism language-shell">$ docker build -t springboot <span class="token builtin class-name">.</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># docker build -t springboot .</span>
Sending build context to Docker daemon  <span class="token number">16</span>.57MB
Step <span class="token number">1</span>/5 <span class="token builtin class-name">:</span> FROM java:8
<span class="token comment"># ...</span>
Successfully built f107ab2a9246
Successfully tagged springboot:latest
</code></pre> 
<p>2、查看镜像</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY   TAG                IMAGE ID       CREATED         SIZE
springboot   latest             f107ab2a9246   <span class="token number">2</span> minutes ago   660MB
<span class="token comment"># ...</span>
</code></pre> 
<p>3、运行springboot容器,访问<code>127.0.0.1:8080/hello</code></p> 
<pre><code class="prism language-shell">docker run -dit -p <span class="token number">8080</span>:8080 --name hello springboot 
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># docker run -dit -p 8080:8080 --name hello springboot </span>
b8d1f65da8a8b71975b336952af497ba946d801294b1ac42d266da41ba1b6a0c
<span class="token punctuation">[</span>root@192 idea<span class="token punctuation">]</span><span class="token comment"># curl 127.0.0.1:8080/hello</span>
hello,一个平凡de人
</code></pre> 
<p>4、外网访问<a href="http://192.168.64.131:8080/hello" rel="nofollow">192.168.64.131:8080/hello</a></p> 
<p><img src="https://images2.imgbox.com/52/0b/vywrniiv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="185__3733"></a>18.5 发布</h3> 
<p>1、 登录</p> 
<pre><code class="prism language-shell">$ docker login -u 【你的用户名】 -p 【你的密码】
</code></pre> 
<p>2、打标签</p> 
<pre><code class="prism language-shell"><span class="token comment"># docker tag 镜像id 你的账户名/镜像仓库名:tag名</span>
$ docker tag f107ab2a9246 dockerywl/springboot
</code></pre> 
<p>3、再提交 push镜像</p> 
<pre><code class="prism language-shell"><span class="token comment"># docker push 作者/镜像:TAG(版本)</span>
$ docker push dockerywl/springboot
</code></pre> 
<blockquote> 
 <p>总结</p> 
</blockquote> 
<p>以后我们使用了Docker之后，给别人交付就是一个镜像即可！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e8931e5ced5987aba7bcd49a8d32a0a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java日期格式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cdbabb4730ceafa5e9dc3d6d7fc5a99b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MacOS：brew安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>