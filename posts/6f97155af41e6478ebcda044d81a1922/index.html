<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>httpd服务管理与配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="httpd服务管理与配置" />
<meta property="og:description" content="httpd服务管理与配置 前言：
我这里讲解httpd服务的安装以及配置和管理
提示：yum/apt安装和源码编译安装的目录结构大不相同，建议使用源码安装，方便管理
什么是httpd服务？ httpd服务，又称apache服务，是我们最常用的Web服务之一，它是一款功能强大、稳定性好的Web服务，该服务提供网站访问、发送网页、图片等文件内容的功能。 文章目录 httpd服务管理与配置 一、httpd安装源码安装yum/apt安装 二、httpd服务配置编译安装目录结构配置文件多站点配置基于域名的虚拟站点基于ip的虚拟站点基于端口的虚拟站点 三、httpd服务管理httpd日志管理1.自带的日志分割工具:rotatelogs2.三方工具：cronolog3.日志分析系统 访问控制与安全1.地址限制访问2.用户密码验证访问 httpd优化访问1.网页压缩模块2.网页缓存模块3.防盗链模块 一、httpd安装 apr和apr-util包下载地址：http://archive.apache.org/dist/apr/
httpd下载地址：https://httpd.apache.org/
源码安装 1.安装依赖工具和包
#更新epel源和安装编译工具 yum install -y epel-release yum clean all &amp;&amp; yum makecache yum -y install gcc gcc-g&#43;&#43; make #安装依赖包 yum -y install expat-devel pcre pcre-devel 2.编译安装apr和apr-util依赖包
#安装apr-1.7.0 tar zxf apr-1.7.0.tar.gz &amp;&amp; cd apr-1.7.0 ./configure --prefix=/usr/local/apr make &amp;&amp; make install #安装apr-util-1.6.1 tar zxf apr-util-1.6.1.tar.gz &amp;&amp; cd apr-util-1.6.1 ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr make &amp;&amp; make install 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f97155af41e6478ebcda044d81a1922/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-19T15:14:05+08:00" />
<meta property="article:modified_time" content="2022-04-19T15:14:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">httpd服务管理与配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="centerhttpd_0"></a> 
 <center>
   httpd服务管理与配置 
 </center></h2> 
<p>前言：<br> 我这里讲解httpd服务的安装以及配置和管理</p> 
<p><code>提示：yum/apt安装和源码编译安装的目录结构大不相同，建议使用源码安装，方便管理</code></p> 
<h3>什么是httpd服务？</h3> httpd服务，又称apache服务，是我们最常用的Web服务之一，它是一款功能强大、稳定性好的Web服务，该服务提供网站访问、发送网页、图片等文件内容的功能。 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#centerhttpd_0" rel="nofollow"></a> 
   <center>
     httpd服务管理与配置 
   </center></li><li><a href="#httpd_11" rel="nofollow">一、httpd安装</a></li><li><ul><li><a href="#_14" rel="nofollow">源码安装</a></li><li><a href="#yumapt_46" rel="nofollow">yum/apt安装</a></li></ul> 
  </li><li><a href="#httpd_57" rel="nofollow">二、httpd服务配置</a></li><li><ul><li><a href="#_58" rel="nofollow">编译安装目录结构</a></li><li><a href="#_70" rel="nofollow">配置文件</a></li><li><a href="#_130" rel="nofollow">多站点配置</a></li><li><ul><li><a href="#_137" rel="nofollow">基于域名的虚拟站点</a></li><li><a href="#ip_159" rel="nofollow">基于ip的虚拟站点</a></li><li><a href="#_182" rel="nofollow">基于端口的虚拟站点</a></li></ul> 
  </li></ul> 
  </li><li><a href="#httpd_210" rel="nofollow">三、httpd服务管理</a></li><li><ul><li><a href="#httpd_212" rel="nofollow">httpd日志管理</a></li><li><ul><li><a href="#1font_colorff0033rotatelogsfont_227" rel="nofollow">1.自带的日志分割工具:<font color="#ff0033">rotatelogs</font></a></li><li><a href="#2font_colorff0033cronologfont_234" rel="nofollow">2.三方工具：<font color="#ff0033">cronolog</font></a></li><li><a href="#3_242" rel="nofollow">3.日志分析系统</a></li></ul> 
   </li><li><a href="#_265" rel="nofollow">访问控制与安全</a></li><li><ul><li><a href="#1_266" rel="nofollow">1.地址限制访问</a></li><li><a href="#2_277" rel="nofollow">2.用户密码验证访问</a></li></ul> 
   </li><li><a href="#httpd_301" rel="nofollow">httpd优化访问</a></li><li><ul><li><a href="#1_307" rel="nofollow">1.网页压缩模块</a></li><li><a href="#2_332" rel="nofollow">2.网页缓存模块</a></li><li><a href="#3_355" rel="nofollow">3.防盗链模块</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="httpd_11"></a>一、httpd安装</h2> 
<p>apr和apr-util包下载地址：http://archive.apache.org/dist/apr/<br> httpd下载地址：https://httpd.apache.org/</p> 
<h3><a id="_14"></a>源码安装</h3> 
<p>1.安装依赖工具和包</p> 
<pre><code class="prism language-powershell"><span class="token comment">#更新epel源和安装编译工具</span>
 yum install <span class="token operator">-</span>y epel<span class="token operator">-</span>release
yum clean all &amp;&amp; yum makecache
yum <span class="token operator">-</span>y install gcc gcc<span class="token operator">-</span>g+<span class="token operator">+</span> make
<span class="token comment">#安装依赖包</span>
yum <span class="token operator">-</span>y install expat<span class="token operator">-</span>devel pcre pcre<span class="token operator">-</span>devel
</code></pre> 
<p>2.编译安装apr和apr-util依赖包</p> 
<pre><code class="prism language-powershell"><span class="token comment">#安装apr-1.7.0</span>
tar zxf apr<span class="token operator">-</span>1<span class="token punctuation">.</span>7<span class="token punctuation">.</span>0<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz &amp;&amp; cd apr<span class="token operator">-</span>1<span class="token punctuation">.</span>7<span class="token punctuation">.</span>0
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>apr
make &amp;&amp; make install
<span class="token comment">#安装apr-util-1.6.1</span>
tar zxf apr<span class="token operator">-</span>util<span class="token operator">-</span>1<span class="token punctuation">.</span>6<span class="token punctuation">.</span>1<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz &amp;&amp; cd apr<span class="token operator">-</span>util<span class="token operator">-</span>1<span class="token punctuation">.</span>6<span class="token punctuation">.</span>1
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>apr<span class="token operator">-</span>util <span class="token operator">--</span>with<span class="token operator">-</span>apr=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>apr
make &amp;&amp; make install
</code></pre> 
<p>3.编译安装httpd</p> 
<pre><code class="prism language-powershell"><span class="token comment">#添加apache用户和用户组</span>
groupadd apache &amp;&amp; useradd <span class="token operator">-</span>M <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin apache <span class="token operator">-</span>g apache
<span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd <span class="token operator">--</span>with<span class="token operator">-</span>apr=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>apr <span class="token operator">--</span>with<span class="token operator">-</span>apr<span class="token operator">-</span>util=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>apr<span class="token operator">-</span>util <span class="token operator">--</span><span class="token function">enable-modules</span>=all <span class="token operator">--</span><span class="token function">enable-mods</span><span class="token operator">-</span>shared=all
make &amp;&amp; make install
</code></pre> 
<p>启动服务：</p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span>bin<span class="token operator">/</span>apachectl <span class="token function">start</span>
</code></pre> 
<h3><a id="yumapt_46"></a>yum/apt安装</h3> 
<p>centos系统使用的是yum，ubuntu和debian使用的是apt<br> <code>提示：包名是httpd不是apache，你下载apache的话会找不到包</code><br> 1.yum安装</p> 
<pre><code class="prism language-powershell">yum <span class="token operator">-</span>y install httpd
</code></pre> 
<p>2.apt安装</p> 
<pre><code class="prism language-powershell">apt <span class="token operator">-</span>y install httpd
</code></pre> 
<h2><a id="httpd_57"></a>二、httpd服务配置</h2> 
<h3><a id="_58"></a>编译安装目录结构</h3> 
<p>编译安装好了之后我们会看到在安装目录下会生成很多文件<br> <code>注意：个人喜好我安装在/usr/local/httpd这个目录下，根据个人安装而定</code><br> <img src="https://images2.imgbox.com/a4/6f/tQ2pICjQ_o.png" alt="httpd.001"><br> 从上图我们可以看到会生成bin、conf、htdocs、logs、modules等目录<br> bin：存放服务命令的地方<br> conf：存放配置文件的地方<br> htdcos：默认存放网页文件的地方<br> logs：存放日志的地方<br> modules：存放模块文件的地方</p> 
<h3><a id="_70"></a>配置文件</h3> 
<p><strong>大家可以通过配置来配置httpd服务的运行设置</strong><br> 配置文件路径：/usr/local/httpd/conf/httpd.conf<br> 子配置文件路径：/usr/local/httpd/conf/httpd.conf<br> 子配置文件需要启用哟！</p> 
<p><strong>配置文件的配置项解析</strong></p> 
<pre><code class="prism language-bash">ServerRoot <span class="token string">"/usr/local/httpd"</span>   <span class="token comment">#安装目录</span>
Listen <span class="token number">80</span>    <span class="token comment">#监听端口</span>
<span class="token comment">#多站点监听端口</span>
<span class="token comment">#Listen 192.168.31.101:88</span>
<span class="token comment">#Listen 192.168.31.101:81</span>
<span class="token comment">#加载模块</span>
LoadModule authn_file_module modules/mod_authn_file.so
Include conf/extra/httpd-vhosts.conf     <span class="token comment">#加载子配置文件</span>
<span class="token comment">####################################################</span>
<span class="token comment">#apache程序运行使用的用户和用户组</span>
User apache
Group apache
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
ServerAdmin apache.com     <span class="token comment">#网站域名</span>
ServerName localhost:80      <span class="token comment">#网站名字</span>
<span class="token operator">&lt;</span>Directory /<span class="token operator">&gt;</span>
    AllowOverride none
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
DocumentRoot <span class="token string">"/usr/local/httpd/htdocs"</span>    <span class="token comment">#网站访问网页文件位置</span>
<span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs"</span><span class="token operator">&gt;</span>     <span class="token comment">#配置该网站站点路径的权限</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>IfModule dir_module<span class="token operator">&gt;</span>   <span class="token comment">#首加载的文件名</span>
    DirectoryIndex index.html
    DirectoryIndex index.php index.html
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
ErrorLog <span class="token string">"logs/error_log"</span>    <span class="token comment">#错误日志路径</span>
LogLevel warn     <span class="token comment">#日志等级</span>
<span class="token operator">&lt;</span>IfModule log_config_module<span class="token operator">&gt;</span>
    LogFormat <span class="token string">"%h %l %u %t <span class="token entity" title='\"'>\"</span>%r<span class="token entity" title='\"'>\"</span> %&gt;s %b <span class="token entity" title='\"'>\"</span>%{Referer}i<span class="token entity" title='\"'>\"</span> <span class="token entity" title='\"'>\"</span>%{User-Agent}i<span class="token entity" title='\"'>\"</span>"</span> combined
    LogFormat <span class="token string">"%h %l %u %t <span class="token entity" title='\"'>\"</span>%r<span class="token entity" title='\"'>\"</span> %&gt;s %b"</span> common
    <span class="token operator">&lt;</span>IfModule logio_module<span class="token operator">&gt;</span>
      LogFormat <span class="token string">"%h %l %u %t <span class="token entity" title='\"'>\"</span>%r<span class="token entity" title='\"'>\"</span> %&gt;s %b <span class="token entity" title='\"'>\"</span>%{Referer}i<span class="token entity" title='\"'>\"</span> <span class="token entity" title='\"'>\"</span>%{User-Agent}i<span class="token entity" title='\"'>\"</span> %I %O"</span> combinedio
    <span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/cgi-bin"</span><span class="token operator">&gt;</span>   <span class="token comment">#cgi-bin工具站点权限设置</span>
    AllowOverride None
    Options None
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>IfModule headers_module<span class="token operator">&gt;</span>
    RequestHeader <span class="token builtin class-name">unset</span> Proxy early
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>IfModule proxy_html_module<span class="token operator">&gt;</span>
Include conf/extra/proxy-html.conf
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>IfModule ssl_module<span class="token operator">&gt;</span>
SSLRandomSeed startup <span class="token builtin class-name">builtin</span>
SSLRandomSeed connect <span class="token builtin class-name">builtin</span>
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_130"></a>多站点配置</h3> 
<p><code>注意：这里我通过子配置文件演示，ip地址和网页路径根据自己的设置来</code></p> 
<p>首先配置httpd.conf文件开启子配置项</p> 
<pre><code class="prism language-bash">Include conf/extra/httpd-vhosts.conf
</code></pre> 
<h4><a id="_137"></a>基于域名的虚拟站点</h4> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /usr/local/httpd/conf/extra/httpd-vhosts.conf
----------------------------------------------------------------
<span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs"</span><span class="token operator">&gt;</span>
   Order allow,deny
   Allow from all
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
NameVirtualHost  *:80
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.0.10<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/baidu"</span>
    ServerName www.baidu.com
    ErrorLog <span class="token string">"logs/baidu.com-error.log"</span>
    CustomLog <span class="token string">"logs/baidu.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.0.10<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/google"</span>
    ServerName www.google.com
    ErrorLog <span class="token string">"logs/goole.com-error.log"</span>
    CustomLog <span class="token string">"logs/google.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="ip_159"></a>基于ip的虚拟站点</h4> 
<p>服务存在多个网卡</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /usr/local/httpd/conf/extra/httpd-vhosts.conf
----------------------------------------------------------------
<span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs"</span><span class="token operator">&gt;</span>
   Order allow,deny
   Allow from all
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
NameVirtualHost  *:80
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.0.10<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/baidu"</span>
    ServerName www.baidu.com
    ErrorLog <span class="token string">"logs/baidu.com-error.log"</span>
    CustomLog <span class="token string">"logs/baidu.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.0.10<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/google"</span>
    ServerName www.google.com
    ErrorLog <span class="token string">"logs/goole.com-error.log"</span>
    CustomLog <span class="token string">"logs/google.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_182"></a>基于端口的虚拟站点</h4> 
<p>首先先修改httpd.conf主配置文件监听端口</p> 
<pre><code class="prism language-bash">Listen <span class="token number">192.168</span>.31.101:88
Listen <span class="token number">192.168</span>.31.101:81
</code></pre> 
<p>再配置子配置文件</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /usr/local/httpd/conf/extra/httpd-vhosts.conf
----------------------------------------------------------------
<span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs"</span><span class="token operator">&gt;</span>
   Order allow,deny
   Allow from all
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
NameVirtualHost  <span class="token number">192.168</span>.0.100
<span class="token operator">&lt;</span>VirtualHost *:8<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/baidu"</span>
    ServerName www.baidu.com
    ErrorLog <span class="token string">"logs/baidu.com-error.log"</span>
    CustomLog <span class="token string">"logs/baidu.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>VirtualHost *:8<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
    DocumentRoot <span class="token string">"/usr/local/httpd/htdocs/google"</span>
    ServerName www.google.com
    ErrorLog <span class="token string">"logs/goole.com-error.log"</span>
    CustomLog <span class="token string">"logs/google.com-access.log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="httpd_210"></a>三、httpd服务管理</h2> 
<h3><a id="httpd_212"></a>httpd日志管理</h3> 
<p>在/var/log（默认情况下存放） 由rsyslogd程序产生（系统日志）<br> httpd服务的日志可以在httpd.conf主配置文件里配置日志存放位置：</p> 
<pre><code class="prism language-bash">ErrorLog <span class="token string">"logs/hattpd-error.log"</span>    <span class="token comment">#错误日志文件</span>
CustomLog <span class="token string">"logs/hattpd-access.log"</span> common  <span class="token comment">#访问记录日志文件</span>
</code></pre> 
<p><code>注意：这里的common为日志的展示格式</code><br> apache中日志记录格式：普通型common和复合型combined（安装默认为common）</p> 
<p>我的建议是一般有子配置文件我们会在子配置文件中去设置日志<br> 子配置文件的好处之一：可以分开创建和查看以及分析各个网页的日志文件</p> 
<p><font color="#ff0033"><strong>存在的问题：</strong></font>随着网站访问量增大，默认情况日志文件越来越大<br> <font color="#ff0033"><strong>我们可以采取的措施：</strong></font>对日志进行分割</p> 
<h4><a id="1font_colorff0033rotatelogsfont_227"></a>1.自带的日志分割工具:<font color="#ff0033">rotatelogs</font></h4> 
<p>分割工具位置：/usr/local/httpd/bin/rotatelogs<br> 使用方法：</p> 
<pre><code class="prism language-bash">ErrorLog <span class="token string">"|/usr/local/httpd/bin/rotatelogs -l /usr/local/httpd/logs/error_%Y%m%d.log 86400"</span>
CustomLog <span class="token string">"|/usr/local/httpd/bin/rotatelogs -l /usr/local/httpd/logs/access_%Y%m%d.log 86400"</span> common
</code></pre> 
<h4><a id="2font_colorff0033cronologfont_234"></a>2.三方工具：<font color="#ff0033">cronolog</font></h4> 
<p>安装包名：cronolog-1.6.2.tar.gz<br> 使用方法（跟rotatelogs相似）</p> 
<pre><code class="prism language-bash">ErrorLog <span class="token string">"|/usr/local/sbin/cronolog /usr/local/httpd/logs/test/error_%Y%m%d.log"</span>
CustomLog <span class="token string">"|/usr/local/sbin/cronolog
/usr/local/httpd/logs/test/access_%Y%m%d.log"</span> common
</code></pre> 
<h4><a id="3_242"></a>3.日志分析系统</h4> 
<p>1.下载安装源码包<br> 2.在/usr/local下建立文件夹/usr/local/awstats<br> 3.解压之后目录移动到/usr/local/awstats<br> 4.给awstats_configure.pl可执行权限，如下图所示<br> <img src="https://images2.imgbox.com/a7/69/GMxK1oy2_o.png" alt="httpd.002"><br> 5.运行脚本awstats_configure.pl（运行后进行手动一步一步选择如下图）<br> <img src="https://images2.imgbox.com/bb/5f/8buNvOX8_o.png" alt="httpd.003"><br> 6.修改站点统计配置文件：指定统计的具体日志文件路径<br> 我的刚刚是默认路径为/etc/awstats下</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> awstats.www.baidu.com.conf
------------------------------------------------
<span class="token assign-left variable">LogFile</span><span class="token operator">=</span><span class="token string">"/usr/local/httpd/logs/hattpd-access.log"</span>
</code></pre> 
<p>7.手动创建/var/lib/awstats这个目录：mkidr /var/lib/awstats<br> 8.然后给awstats_updateall.pl文件执行权限，运行该文件<br> 9.结果如下图：<br> <img src="https://images2.imgbox.com/86/4c/qn7Jh0Zv_o.png" alt="httpd.004"><br> 然后是用办公电脑访问，如下图就是成功了<br> 我这里的网址为：http://www.baidu.com/awstats/awstats.pl?config=www.baidu.com<br> <img src="https://images2.imgbox.com/2c/76/CpEIwSMX_o.png" alt="httpd.005"></p> 
<h3><a id="_265"></a>访问控制与安全</h3> 
<h4><a id="1_266"></a>1.地址限制访问</h4> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs/baidu"</span><span class="token operator">&gt;</span>
   Options None
   AllowOverride None
   Order allow,deny  <span class="token comment">#先允许后拒绝，可以交换顺序</span>
   Allow from <span class="token number">192.168</span>.0.100
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
</code></pre> 
<p>配置之后除了192.168.0.100这个ip其他ip都无法访问</p> 
<h4><a id="2_277"></a>2.用户密码验证访问</h4> 
<p>使用httpd自带的工具：<font color="#ff0033">htpasswd</font><br> 1.创建用户认证数据库命令：</p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span>bin<span class="token operator">/</span>htpasswd <span class="token operator">-</span>c <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span>conf<span class="token operator">/</span><span class="token punctuation">.</span>httpdpasswd webadmin
</code></pre> 
<p>weadmin为用户，然后系统会让你输入密码，用户密码保存在<font color="#ff0033">/usr/local/httpd/conf/.httpdpasswd</font>这个文件里<br> 2.配置文件修改加入项</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>Directory <span class="token string">"/usr/local/httpd/htdocs/baidu"</span><span class="token operator">&gt;</span>
   Options None
   AllowOverride None
   Order allow,deny  <span class="token comment">#先允许后拒绝，可以交换顺序</span>
   Allow from all
   AuthName <span class="token string">"AWStats Directory"</span>
   AuthType Basic
   AuthUserFile /usr/local/httpd/conf/.awspwd
   require valid-user
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
</code></pre> 
<p>添加用户：</p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span>bin<span class="token operator">/</span>htpasswd <span class="token operator">-</span>b <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token punctuation">.</span>passwd  test1 test123456
</code></pre> 
<h3><a id="httpd_301"></a>httpd优化访问</h3> 
<p><code>注意：源码安装是默认开启保持，rpm安装是默认关闭</code></p> 
<pre><code class="prism language-bash">KeepAlive Off
KeepAliveTimeout <span class="token number">300</span>
</code></pre> 
<h4><a id="1_307"></a>1.网页压缩模块</h4> 
<p>作用：httpd中gzip模块可以使用gzip压缩算法来实现对httpd服务器发布<br> 的网页内容进行压缩后再传输到客户端浏览器<br> 不同版本之间的区别：<br> apache 1.x：没有内建网页压缩技术，使用的是额外的第三方mod_gzip模块来执行压缩。压缩比率高，高出4%~6%压缩量<br> apache 2.x：内建使用mod_deflate,压缩速度快<br> apache 2.0.45开始：mod_deflate使用DeflateCompressionLevel指令来设置压缩级别，1最快压缩比最低，9最慢压缩比最高，默认6<br> 1.查看检查模块：</p> 
<pre><code class="prism language-powershell">apachectl <span class="token operator">-</span>t <span class="token operator">-</span>D DUMP_MODULES <span class="token punctuation">|</span> grep <span class="token string">"deflate"</span>
</code></pre> 
<p>2.停止服务，重新到解压的目录编译安装（编译时加上模块选项）</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span> <span class="token operator">--</span><span class="token function">enable-deflate</span> <span class="token operator">--</span><span class="token function">enable-so</span> <span class="token operator">--</span><span class="token function">enable-rewrite</span> <span class="token operator">--</span><span class="token function">enable-charset</span><span class="token operator">-</span>lite <span class="token operator">--</span><span class="token function">enable-cgi</span>
</code></pre> 
<p>3.修改主配置文件添加开启mod_deflate模块</p> 
<pre><code class="prism language-bash">AddOutputFilterByType DEFLATE text/html text/plain text/css text/xml text/javascript
DeflateCompressionLevel <span class="token number">9</span>
setOutputFilter DEFLATE
</code></pre> 
<p>4.重新启动服务检查模块</p> 
<pre><code class="prism language-powershell">apachectl <span class="token operator">-</span>t <span class="token operator">-</span>D DUMP_MODULES <span class="token punctuation">|</span> grep <span class="token string">"deflate"</span>
</code></pre> 
<h4><a id="2_332"></a>2.网页缓存模块</h4> 
<p>作用：httpd的mod_expires模块会自动生成页面头部信息中的Express标签和Cache-Control标签，客户端浏览器根据标签决定下次访问是在本地机器的缓存中获取页面，不需要再次向服务器发出请求<br> 配置mod_expires模块与mod_deflate模块相似<br> 1.检查模块：</p> 
<pre><code class="prism language-powershell">apachectl <span class="token operator">-</span>t <span class="token operator">-</span>D DUMP_MODULES <span class="token punctuation">|</span> grep <span class="token string">"expires"</span>
</code></pre> 
<p>2.重新编译安装</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span> <span class="token operator">--</span><span class="token function">enable-deflate</span> <span class="token operator">-</span><span class="token function">enable-expires</span> <span class="token operator">--</span><span class="token function">enable-so</span> <span class="token operator">--</span><span class="token function">enable-rewrite</span> <span class="token operator">--</span><span class="token function">enable-charset</span><span class="token operator">-</span>lite <span class="token operator">--</span><span class="token function">enable-cgi</span>
make &amp;&amp; make install
</code></pre> 
<p>修改主配置文件，启用mod_expires模块</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>IfModule mod_expires.c<span class="token operator">&gt;</span>
    ExpiresActive On
    ExpiresDefault <span class="token string">"access plus 60 seconds"</span>
<span class="token operator">&lt;</span>/IfModule<span class="token operator">&gt;</span>
</code></pre> 
<p>4.重启检测</p> 
<pre><code class="prism language-powershell">apachectl <span class="token operator">-</span>t <span class="token operator">-</span>D DUMP_MODULES <span class="token punctuation">|</span> grep <span class="token string">"expires"</span>
</code></pre> 
<h4><a id="3_355"></a>3.防盗链模块</h4> 
<p>防盗链的使用（防止别人是用自己的资源流量，比如使用你网页的图片链接放到别人网站上，别人实际访问的是你自己的网络资源）<br> 使用httpd中的一个模块：mod_rewrite模块<br> 1.检查模块：</p> 
<pre><code class="prism language-powershell">apachectl <span class="token operator">-</span>t <span class="token operator">-</span>D DUMP<span class="token operator">-</span>MODULES <span class="token punctuation">|</span> grep <span class="token string">"rewrite"</span>
</code></pre> 
<p>2.如果没有，关闭服务，重新编译</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>httpd<span class="token operator">/</span> <span class="token operator">--</span><span class="token function">enable-deflate</span> <span class="token operator">--</span><span class="token function">enable-so</span> <span class="token operator">--</span><span class="token function">enable-rewrite</span> <span class="token operator">--</span><span class="token function">enable-charset</span><span class="token operator">-</span>lite <span class="token operator">--</span><span class="token function">enable-cgi</span> <span class="token operator">--</span><span class="token function">enable-expires</span>
make &amp;&amp; make install
</code></pre> 
<p>3.在配置文件中的那个网页配置段添加启动模块（可以在子配置文件中启用模块）</p> 
<pre><code class="prism language-bash">RewriteEngine On
RewriteCond %<span class="token punctuation">{<!-- --></span>HTTP_REFERER<span class="token punctuation">}</span> <span class="token operator">!</span>^http://abc.com/.*$ <span class="token punctuation">[</span>NC<span class="token punctuation">]</span>
RewriteCond %<span class="token punctuation">{<!-- --></span>HTTP_REFERER<span class="token punctuation">}</span> <span class="token operator">!</span>^http://abc.com$ <span class="token punctuation">[</span>NC<span class="token punctuation">]</span>
RewriteCond %<span class="token punctuation">{<!-- --></span>HTTP_REFERER<span class="token punctuation">}</span> <span class="token operator">!</span>^http://www.abc.com/.*$ <span class="token punctuation">[</span>NC<span class="token punctuation">]</span>
RewriteCond %<span class="token punctuation">{<!-- --></span>HTTP_REFERER<span class="token punctuation">}</span> <span class="token operator">!</span>^http://www.abc.com/$ <span class="token punctuation">[</span>NC<span class="token punctuation">]</span>
RewriteRule .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ http://www.abc.com/error.png
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fbf2c421d6c51b1762b1036583b5f0e5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Tensorflow-gpu安装&#43;Keras安装&#43;Pytorch-gpu安装 经验分享/Win10 (conda安装Cuda和Cudnn) 含测试代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8c78f4e67e43a46045cebb50fb23a293/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言-学生学号成绩读入程序（输出了学生总分、平均分、名次以及学生信息的查询）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>