<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>日常服务器巡检时，free -m命令的说明 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="日常服务器巡检时，free -m命令的说明" />
<meta property="og:description" content="日常服务器巡检中，我们通常会进行服务器的硬件健康状态，比如对服务器的硬盘、CPU和内存等状态进行查询。现在这里我们进行的是对常用的查看内存使用情况的free -m 命令进行讲解： 一、巡检第一台服务器： #free -m
total used free shared buffers cached
Mem: 16031 744 15287 0 182 213
-/&#43; buffers/cache: 348 15683
Swap: 8015 0 8015
以上是对某台服务器进行内存的使用情况进行检查，好多新手统计当前内存的使用率=user/total=744 / 16031 * 100%=5%，感觉没毛病，加上用top命令查看cpu使用率时，发现使用率为0.3%
二、接着往下看第二台服务器的硬件设备使用率情况： 先查看第二台服务器CPU使用情况
（类似上面的第一台服务器，cpu使用率不高，那么就查看它（第二台）的内存使用率了）
#free -m
total used free shared buffers cached
Mem: 16031 15861 170 0 287 15079
-/&#43; buffers/cache: 494 15537
Swap: 8015 0 8015
在第二台服务器，你会发现没有什么程序在运行，但是使用top或free命令看到可用内存free项会很少，那么这是什么情况呢？
其实一开始，算内存的使用率=user/total=744 / 16031 * 100%=5%用这公式是错误的了，这是Linux新手，容易犯的错误！
那好，现在开始进行对free -m命令进行讲解： （以上例子进行讲解）
#free -m" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3bf3399dc3beeffe48880ad9b12ddade/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-12T00:33:35+08:00" />
<meta property="article:modified_time" content="2019-03-12T00:33:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">日常服务器巡检时，free -m命令的说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>日常服务器巡检中，我们通常会进行服务器的硬件健康状态，比如对服务器的硬盘、CPU和内存等状态进行查询。现在这里我们进行的是对常用的查看内存使用情况的free -m 命令进行讲解：</h3> 
<h4>一、巡检第一台服务器：</h4> 
<p><img alt="" class="has" height="187" src="https://images2.imgbox.com/3a/18/fIoxiKiM_o.png" width="981"></p> 
<p>#<strong>free -m</strong></p> 
<p>                                    total            used         free      shared       buffers       cached<br> Mem:                        16031            <span style="color:#f33b45;"><strong> 744</strong>   </span>    15287          0             182             213<br> -/+ buffers/cache:                             348       15683<br> Swap:                        8015                 0          8015</p> 
<p>以上是对某台服务器进行内存的使用情况进行检查，好多新手统计当前内存的<span style="color:#e579b6;"><em>使用率=user/total=744 / 16031 * 100%=5%</em></span>，感觉没毛病，加上<strong>用top命令查看cpu使用率时，发现使用率为0.3%</strong></p> 
<p><img alt="" class="has" height="623" src="https://images2.imgbox.com/34/ff/IzcPWKDr_o.png" width="864"></p> 
<h4>二、接着往下看第二台服务器的硬件设备使用率情况：</h4> 
<p>先查看第二台服务器CPU使用情况</p> 
<p><img alt="" class="has" height="765" src="https://images2.imgbox.com/bc/59/MZNb3arA_o.png" width="1097"></p> 
<p>（类似上面的第一台服务器，cpu使用率不高，那么就<strong>查看它（第二台）的内存使用率</strong>了）</p> 
<p><img alt="" class="has" height="153" src="https://images2.imgbox.com/96/f5/NofHWPsh_o.png" width="1028"></p> 
<p>#<strong>free -m</strong></p> 
<p>                                    total            used         free      shared       buffers       cached<br> Mem:                        16031          <span style="color:#f33b45;"><strong>  15861</strong></span>       170        0              287             15079<br> -/+ buffers/cache:                             494       15537<br> Swap:                        8015                 0          8015</p> 
<p>在第二台服务器，你会发现没有什么程序在运行，但是使用top或free命令看到<strong>可用内存free项</strong>会很少，那么这是什么情况呢？</p> 
<p>其实一开始，算内存的<span style="color:#e579b6;"><em>使用率=user/total=744 / 16031 * 100%=5%</em></span>用这公式是错误的了，这是Linux新手，容易犯的错误！</p> 
<h3><strong>那好，现在开始进行对free -m命令进行讲解：</strong></h3> 
<p>（以上例子进行讲解）</p> 
<p>#<strong>free -m</strong></p> 
<p>                                    total            used         free      shared       buffers       cached<br> Mem:                        16031          <span style="color:#f33b45;"><strong>  15861</strong></span>       170        0              287             15079<br> -/+ buffers/cache:                             494       15537<br> Swap:                        8015                 0          8015</p> 
<p><em>+++++++++++++++++++++我是华丽的分隔线+++++++++++++++++++++</em></p> 
<p><strong>-m</strong>：   内存大小以M为单位，只输free命令时是以kb为单位。</p> 
<p> <strong>totel</strong>： 机器总的物理内存。</p> 
<p><strong> used</strong>：用掉的内存。</p> 
<p> <strong>free</strong>：空闲的物理内存。</p> 
<p><strong>shared</strong>：多个进程共享的内存总和，一般数值为0，当前废弃不用。</p> 
<p><strong>buffers</strong>： 写缓存，数据存储时，先保存到磁盘缓冲区，然后再写入到永久空间。</p> 
<p><strong>cached</strong>： 读缓存，数据从磁盘读出后，暂留在缓冲区，预备程序接下来的使用。</p> 
<p><span style="color:#f33b45;"><strong>- buffers/cache</strong></span>：序角度上看已经使用的内存数，这才是程序实实在在用掉的内存数。</p> 
<p><span style="color:#f33b45;"><strong>+ buffers/cache</strong></span>：程序角度上看未使用、可用的内存数。</p> 
<p>Swap：total是交换分区的总内存大小，free是交换分区空闲可用的内存大小。</p> 
<h3>其实算已有的内存和可用的内存，计算方式如下：</h3> 
<p>#<strong>free -m</strong></p> 
<p>                                    total            used         free      shared       buffers       cached<br> Mem:                        16031          <span style="color:#f33b45;"><strong>  </strong></span>15861       170        0              287             15079<br> -/+ buffers/cache:                            <strong><span style="color:#f33b45;"> 494 </span></strong>      <span style="color:#f33b45;"><strong>15537</strong></span><br> Swap:                        8015                 0          8015</p> 
<p><strong><span style="color:#f33b45;">-buffers/cache</span></strong>：(已用)的内存数，即used-buffers-cached=15861-287-15079=495</p> 
<p><strong><span style="color:#f33b45;">+buffers/cache</span></strong>：(可用)的内存数，即free+buffers+cached=170+287+15079=15537</p> 
<p>++华丽的分割线++++++++++++++++++++</p> 
<p>（注意：云主机或VMware的虚拟机的free -m命令是看不到<span style="color:#f33b45;">-/+ buffers/cache</span>这一项的，是直接计算使用率=used/total）</p> 
<p><img alt="" class="has" height="89" src="https://images2.imgbox.com/c0/e2/2C7Rf4EA_o.png" width="973"></p> 
<p>++华丽的分割线++++++++++++++++++++</p> 
<p>在Linux中，内存是拿来用的，不是拿来看的。而在Windows中，无论你的真实物理内存有多少，它都会用硬盘交换文件来读，即使是内存还有一大部分。这也就是Windows常常提示虚拟空间不足的原因。可以想见，硬盘怎么会快过内存，所以我们在观察Linux的内存使用情况时，只要没发现用swap的交换空间，就不用担心自己的内存太少。如果常常看到swap用了很多，那么你就要考虑加物理内存了。这也是在Linux服务器上看内存是否够用的标准。从用户和操作系统的角度来看，其大小空间是有区别的。像buffer/cached的内存，由于这块内存从操作系统的角度确实被使用，但如果用户要使用，这块内存是可以很快被回收而被用户空间程序使用，因此从用户角度而言这块内存应被划为空闲状态。</p> 
<p>但是如何回收cache及什么时候cache是回话不了，想更深层了解buffers/cache的区别，个人发现一位大神的精彩讲解，请看下面的链接！</p> 
<p><a href="https://blog.csdn.net/lqglqglqg/article/details/82313966">https://blog.csdn.net/lqglqglqg/article/details/82313966</a></p> 
<p>（摘取部分总结）</p> 
<h3><strong>Linux 系统内存中的 cache 并不是在所有情况下都能被释放当做空闲空间用的。并且也也明确了，即使可以释放 cache，也并不是对系统来说没有成本的</strong>。总结一下要点，我们应该记得这样几点：</h3> 
<ol><li>当 cache 作为文件缓存被释放的时候会引发 IO 变高，这是 cache 加快文件访问速度所要付出的成本。</li><li>tmpfs 中存储的文件会占用 cache 空间，除非文件删除否则这个 cache 不会被自动释放。</li><li>使用 shmget 方式申请的共享内存会占用 cache 空间，除非共享内存被 ipcrm 或者使用 shmctl 去 IPC_RMID，否则相关的 cache 空间都不会被自动释放。</li><li>使用 mmap 方法申请的 MAP_SHARED 标志的内存会占用 cache 空间，除非进程将这段内存 munmap，否则相关的 cache 空间都不会被自动释放。</li><li>实际上 shmget、mmap 的共享内存，在内核层都是通过 tmpfs 实现的，tmpfs 实现的存储用的都是 cache。</li></ol> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/759dde8d3008579ebc7744f409dbe0fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用python创建数组的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95a48e0a1b5d0971b5ceb0fcbfdf0f49/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安全多方计算新突破！阿里首次实现“公开可验证” 的安全方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>