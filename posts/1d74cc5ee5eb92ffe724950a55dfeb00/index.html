<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jenkins使用脚本进行前后端分离项目自动git拉取并部署 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="jenkins使用脚本进行前后端分离项目自动git拉取并部署" />
<meta property="og:description" content="前言 需要先安装好jenkins，配置好工作空间，然后本人是将jenkins部署到一个tomcat服务器上。
启动时执行sh脚本，脚本通过java运行war包
nohup /usr/lib/jvm/java-11/bin/java -Xms1024m -Xmx2048m -jar 你的jenkins的war目录/jenkins.war &gt; ./logs/jenkins.log 2&gt;&amp;1 &amp; echo start jenkins 直接执行./自定义sh.sh即可
需要安装插件，这里可能包含了一些不必要的插件，但是一定全，插件列表放在最后
我们的思路是在git中拉取项目到jenkins的工作空间，然后根据脚本将项目部署。
一、后端java项目 java项目使用的是springboot技术，思路是使用springboot自带的tomcat打包成一个可执行的jar包，然后将这个jar包覆盖原来的旧jar包，最后运行脚本重启服务。
前置准备是需要修改pom文件，实现输入maven命令将java项目部署成一个完整的jar包，可以参考这篇文章 请查看第二点和第三点即可
首先登录jenkins，点击左上角的新建item
先输入任务名，选中pipeline，然后点击确定
点击确定后接着输入描述
输入完描述后，先不要保存，此时是重头戏，需要复制部署用的脚本，滚动条拉到最下面，将流水线里复制以下脚本
pipeline { agent any environment { def model = &#34;ipas-server&#34; def DATE = sh(script: &#39;date &#43;%Y%m%d_%H%M%S&#39;, returnStdout:true) def JAR_NAME= &#34;ipas.jar&#34;	// 打出来的jar包名字 def BASEPATH = &#34;/opt/AppData&#34;	def JOB_NAME = &#34;ipas&#34; // jenkins的工作空间，项目从git拉取后会放在此处 def workspace=&#39;/opt/jenkins-server/workspace/ipas-new&#39; def project=&#39;ipas&#39; } stages { stage(&#39;拉取代码&#39;) { steps { // 从git仓库中拉取代码 // get branch是git分支， // credentialsId可查看下面的Jenkins 添加配置Git账号密码凭据 // url是git的项目地址 git branch: &#39;dev-cll2&#39;, credentialsId: &#39;你的credentialsId&#39;, url: &#39;http://你的git地址/ipas-new." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1d74cc5ee5eb92ffe724950a55dfeb00/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-04T09:40:51+08:00" />
<meta property="article:modified_time" content="2023-05-04T09:40:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">jenkins使用脚本进行前后端分离项目自动git拉取并部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>需要先安装好jenkins，配置好工作空间，然后本人是将jenkins部署到一个tomcat服务器上。<br> 启动时执行sh脚本，脚本通过java运行war包</p> 
<pre><code class="prism language-powershell">nohup <span class="token operator">/</span>usr/lib/jvm/java-11/bin/java <span class="token operator">-</span>Xms1024m <span class="token operator">-</span>Xmx2048m <span class="token operator">-</span>jar 你的jenkins的war目录<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>war &gt; <span class="token punctuation">.</span><span class="token operator">/</span>logs/jenkins<span class="token punctuation">.</span>log 2&gt;&amp;1 &amp;
<span class="token function">echo</span> <span class="token function">start</span> jenkins
</code></pre> 
<p>直接执行./自定义sh.sh即可</p> 
<p>需要安装插件，这里可能包含了一些不必要的插件，但是一定全，插件列表放在最后</p> 
<p>我们的思路是在git中拉取项目到jenkins的工作空间，然后根据脚本将项目部署。</p> 
<h3><a id="java_19"></a>一、后端java项目</h3> 
<p>java项目使用的是springboot技术，思路是使用springboot自带的tomcat打包成一个可执行的jar包，然后将这个jar包覆盖原来的旧jar包，最后运行脚本重启服务。</p> 
<p><strong>前置准备</strong>是需要修改pom文件，实现输入maven命令将java项目部署成一个完整的jar包，可以参考这篇文章 <a href="https://blog.csdn.net/cjy1575944940/article/details/126526000?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22126526000%22,%22source%22:%22cjy1575944940%22%7D">请查看第二点和第三点即可</a></p> 
<p>首先登录jenkins，点击左上角的<em>新建item</em><br> <img src="https://images2.imgbox.com/ec/b0/oXHs3aib_o.png" alt="请添加图片描述"><br> 先输入任务名，选中pipeline，然后点击确定<br> <img src="https://images2.imgbox.com/93/37/c1ovjWvL_o.png" alt="请添加图片描述"><br> 点击确定后接着输入描述<br> <img src="https://images2.imgbox.com/03/3a/HyYQ10Co_o.png" alt="请添加图片描述"><br> 输入完描述后，先不要保存，此时是重头戏，需要复制部署用的脚本，滚动条拉到最下面，将流水线里复制以下脚本<br> <img src="https://images2.imgbox.com/3e/e6/4jWHp4fu_o.png" alt="请添加图片描述"></p> 
<pre><code class="prism language-groovy">pipeline <span class="token punctuation">{<!-- --></span>
    agent any
    environment <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">def</span> model <span class="token operator">=</span> <span class="token string">"ipas-server"</span>
        <span class="token keyword">def</span> DATE <span class="token operator">=</span> <span class="token function">sh</span><span class="token punctuation">(</span>script<span class="token punctuation">:</span> <span class="token string">'date +%Y%m%d_%H%M%S'</span><span class="token punctuation">,</span> returnStdout<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token keyword">def</span> JAR_NAME<span class="token operator">=</span> <span class="token string">"ipas.jar"</span>	<span class="token comment">// 打出来的jar包名字</span>
        <span class="token keyword">def</span> BASEPATH <span class="token operator">=</span> <span class="token string">"/opt/AppData"</span>	
        <span class="token keyword">def</span> JOB_NAME <span class="token operator">=</span> <span class="token string">"ipas"</span>
        <span class="token comment">// jenkins的工作空间，项目从git拉取后会放在此处</span>
        <span class="token keyword">def</span> workspace<span class="token operator">=</span><span class="token string">'/opt/jenkins-server/workspace/ipas-new'</span>
        <span class="token keyword">def</span> project<span class="token operator">=</span><span class="token string">'ipas'</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{<!-- --></span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'拉取代码'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 从git仓库中拉取代码</span>
                <span class="token comment">// get branch是git分支，</span>
                <span class="token comment">// credentialsId可查看下面的Jenkins 添加配置Git账号密码凭据</span>
                <span class="token comment">// url是git的项目地址</span>
                git branch<span class="token punctuation">:</span> <span class="token string">'dev-cll2'</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> <span class="token string">'你的credentialsId'</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string">'http://你的git地址/ipas-new.git'</span>
                    
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'打包'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
               <span class="token comment">// 此处使用运行项目根目录下的pom-test.xml的方式</span>
               sh <span class="token string">"cd $workspace &amp;&amp; mvn clean package -f pom-test.xml"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'移动项目'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 将jenkins工作空间中打包的jar包移动到要部署的文件夹中</span>
                sh <span class="token string">'''mv /opt/jenkins-server/workspace/ipas-new/servers/servers-admin/target/servers-admin.jar /opt/AppData/ipas-new-server/admin/servers-ipas-admin.jar'''</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
        
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'运行'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">// 运行关闭脚本，然后运行启动脚本重启</span>
                sh <span class="token string">'''cd /opt/AppData/ipas-new-server/admin
                    ./shutdown.sh servers-ipas-admin
                    ./start.sh servers-ipas-admin'''</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后一步的shutdown.sh和start.sh是根据以上<strong>前置准备</strong>进行配置的<br> 然后点击保存，回到首页，找到右边的开始按钮，点击<br> <img src="https://images2.imgbox.com/d8/b9/GJy3KB71_o.png" alt="请添加图片描述"><br> 如果运行成功，左边会显示绿色勾勾，否则，会显示红色的叉叉。<br> 这里假设我们的项目部署失败了，我们需要查看日志<br> 点击项目名<br> <img src="https://images2.imgbox.com/18/a7/4GGi9aNM_o.png" alt="请添加图片描述"><br> 鼠标移动到报错的地方，然后点击logs<br> <img src="https://images2.imgbox.com/3f/b6/2waJkKDY_o.png" alt="请添加图片描述"><br> 可以看到此处git代码拉取没有成功，是由于验证没有通过<br> <img src="https://images2.imgbox.com/c7/65/aoPwuvRp_o.png" alt="请添加图片描述"><br> 此处看到是因为这个credentialsId没有验证通过，这玩意是用来对应你的git账号和密码的。设置可以查看这篇文章 <a href="https://blog.csdn.net/qq_40943363/article/details/104220944">Jenkins 添加配置Git账号密码凭据</a><br> 配置成功后复制此处的即可<br> <img src="https://images2.imgbox.com/8c/81/009tGnC6_o.png" alt="请添加图片描述"></p> 
<p>设置完后重新修改脚本中<strong>拉取</strong>部分的credentialsId，重新按启动按钮即可</p> 
<h3><a id="_102"></a>前端项目部署</h3> 
<p>同样重复上述步骤，只不过脚本变了而已。<br> 部署思路是从git中拉取vue的项目，然后运行npm的打包命令，将项目打包到jenkins工作空间下之后再复制替换到要部署的文件夹里<br> 此处由于项目中需要安装npm，有两种思路，一种就是每次都安装，此时新建item的时候需要以下这段设置<br> <img src="https://images2.imgbox.com/f1/58/QyRz0gvy_o.png" alt="在这里插入图片描述"></p> 
<p>脚本如下</p> 
<pre><code class="prism language-groovy">pipeline <span class="token punctuation">{<!-- --></span>
    agent any
    environment <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">def</span> DATE <span class="token operator">=</span> <span class="token function">sh</span><span class="token punctuation">(</span>script<span class="token punctuation">:</span> <span class="token string">'date +%Y%m%d_%H%M%S'</span><span class="token punctuation">,</span> returnStdout<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">// jenkins的工作空间，项目从git拉取后会放在此处</span>
        <span class="token keyword">def</span> workspace<span class="token operator">=</span><span class="token string">'/opt/jenkins-server/workspace/ipas-bms'</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{<!-- --></span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'拉取代码'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 从git仓库中拉取代码</span>
                <span class="token comment">// get branch是git分支，</span>
                <span class="token comment">// credentialsId可查看下面的Jenkins 添加配置Git账号密码凭据</span>
                <span class="token comment">// url是git的项目地址</span>
                git branch<span class="token punctuation">:</span> <span class="token string">'release-test'</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> <span class="token string">'你的git账号密码生成的credentialsId'</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string">'http://项目的git地址/IPAS.git'</span>
                    
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
		
		<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'打包后台'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    steps <span class="token punctuation">{<!-- --></span>
		        script <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>npminstall<span class="token operator">==</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    	<span class="token comment">// 运行npm打包前端项目命令</span>
                        sh <span class="token string">"cd $workspace/ipas-clients &amp;&amp; npm run build"</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                        sh <span class="token string">"cd $workspace/ipas-clients &amp;&amp; npm install &amp;&amp; npm run build"</span>
                    <span class="token punctuation">}</span>
		        <span class="token punctuation">}</span>
		    <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
		
		<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'移动项目'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">// 将工作空间中打包的vue项目移动到要部署的文件夹里</span>
               sh <span class="token string">'''\\cp -rf /opt/jenkins-server/workspace/ipas-bms/ipas-clients/dist/* /opt/AppData/ipas-client'''</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
           
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>第二种就是仅仅执行一次npm install，不会每次部署都执行。<br> 此时只需要进入jenkins工作空间里执行npm install即可<br> 然后把打包脚本修改下，修改成不需要npm install。只需打包</p> 
<pre><code class="prism language-groovy"><span class="token comment">// 修改后，只需要执行npm run build打包即可不再执行安装</span>
<span class="token comment">// if(npminstall=="false"){<!-- --></span>
 	<span class="token comment">// 运行npm打包前端项目命令</span>
     sh <span class="token string">"cd $workspace/ipas-clients &amp;&amp; npm run build"</span>
 <span class="token comment">// }</span>
 <span class="token comment">// else{<!-- --></span>
    <span class="token comment">// sh "cd $workspace/ipas-clients &amp;&amp; npm install &amp;&amp; npm run build"</span>
 <span class="token comment">//}</span>

</code></pre> 
<p>完成后点击启动按钮即可</p> 
<h3><a id="_174"></a>查看日志</h3> 
<p>有时候会有一些莫名奇妙的原因没有报错，但实际上是有错的，此时需要看日志<br> <img src="https://images2.imgbox.com/38/bb/uTfyKQDT_o.png" alt="请添加图片描述"><br> 点击红框处，两个都可以，然后点击最左边的console output，即可看到日志<br> <img src="https://images2.imgbox.com/a0/96/lLvftrMw_o.png" alt="请添加图片描述"></p> 
<h3><a id="_183"></a>插件列表</h3> 
<p><img src="https://images2.imgbox.com/81/7e/BoALqLD0_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/8a/9b/NUsQhryh_o.png" alt="请添加图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ccac2fbd4bb8f6833188935074ae1058/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">@RequestParam、@RequestBody、@RequestAttribute、@RequestPart和@PathVariable详解和具体示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1ee805a74883623391892505fd2b64ab/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">无法打开内核设备“\.\VMCIDev\VMX”: 操作成功完成。是否在安装 VMware Workstation 后重新引导? 模块“DevicePowerOn”启动失败。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>