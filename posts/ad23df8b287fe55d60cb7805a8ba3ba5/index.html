<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hprof - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hprof" />
<meta property="og:description" content="转载地址：http://geek.csdn.net/news/detail/90509 一、开发者的自测利器-Hprof命令 1. 示例演示
例子程序：
/** * PROJECT_NAME: test * DATE: 16/7/22 * CREATE BY: chao.cheng **/ public class HProfTest { public void slowMethod() { try { Thread.sleep(1000); } catch (Exception e) { e.printStackTrace(); } } public void slowerMethod() { try { Thread.sleep(10000); } catch (Exception e) { e.printStackTrace(); } } public static void main(String[] args) { HProfTest test = new HProfTest(); test.slowerMethod(); test.slowMethod(); } } 注：这是一段测试代码通过sleep方法进行延时，在程序运行过程中很慢，我想知道到底是哪段程序影响的整体性能呢？
我在这个java程序中，加了如下运行参数：
-agentlib:hprof=cpu=times,interval=10 /* times：java函数的执行时间 hprof=cpu是针对cpu统计时间 interval=10 采样10次 */ 再次运行这段程序显示如下图：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ad23df8b287fe55d60cb7805a8ba3ba5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-22T15:27:54+08:00" />
<meta property="article:modified_time" content="2016-07-22T15:27:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hprof</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 style="font-family:'microsoft yahei',arial; font-weight:500; line-height:1.1; color:rgb(51,51,51); margin-top:20px; margin-bottom:10px; font-size:24px; text-align:justify"> 转载地址：http://geek.csdn.net/news/detail/90509</h4> 
<h4 style="font-family:'microsoft yahei',arial; font-weight:500; line-height:1.1; color:rgb(51,51,51); margin-top:20px; margin-bottom:10px; font-size:24px; text-align:justify"> <br> </h4> 
<h4 style="font-family:'microsoft yahei',arial; font-weight:500; line-height:1.1; color:rgb(51,51,51); margin-top:20px; margin-bottom:10px; font-size:24px; text-align:justify"> 一、开发者的自测利器-Hprof命令</h4> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <span style="font-weight:700">1. 示例演示</span></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 例子程序：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs java" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent"><span class="hljs-javadoc" style="color:rgb(136,0,0)">/**
 * PROJECT_NAME: test
 * DATE:         16/7/22
 * CREATE BY:    chao.cheng
 **/</span>
<span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-class" style=""><span class="hljs-keyword" style="color:rgb(0,0,136)">class</span> <span class="hljs-title" style="color:rgb(102,0,102)">HProfTest</span> {<!-- --></span>
    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">slowMethod</span>() {
        <span class="hljs-keyword" style="color:rgb(0,0,136)">try</span> {
            Thread.sleep(<span class="hljs-number" style="color:rgb(0,102,102)">1000</span>);
        } <span class="hljs-keyword" style="color:rgb(0,0,136)">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">slowerMethod</span>() {
        <span class="hljs-keyword" style="color:rgb(0,0,136)">try</span> {
            Thread.sleep(<span class="hljs-number" style="color:rgb(0,102,102)">10000</span>);
        } <span class="hljs-keyword" style="color:rgb(0,0,136)">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">static</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">main</span>(String[] args) {
        HProfTest test = <span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> HProfTest();
        test.slowerMethod();
        test.slowMethod();
    }
}</code></pre> 
<blockquote style="padding:10px 20px; margin:10px 0px; font-size:14px; border-left-width:5px; border-left-style:solid; color:rgb(51,51,51); font-family:'microsoft yahei',arial; line-height:27.2000007629395px; text-align:justify; background:rgb(247,247,247)"> 
 <p style="margin-top:0px; margin-bottom:0px"><span style="font-weight:700">注</span>：这是一段测试代码通过sleep方法进行延时，在程序运行过程中很慢，我想知道到底是哪段程序影响的整体性能呢？</p> 
</blockquote> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 我在这个java程序中，加了如下运行参数：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs haml" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent">-<span class="ruby" style=""><span class="hljs-symbol" style="color:rgb(0,102,102)">agentlib:</span>hprof=cpu=times,interval=<span class="hljs-number" style="color:rgb(0,102,102)">10</span>
</span><span class="hljs-comment" style="color:rgb(136,0,0)">/* </span>
    times：java函数的执行时间
    hprof=cpu是针对cpu统计时间
    interval=10 采样10次 
*/</code></pre> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 再次运行这段程序显示如下图：</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <img src="https://images2.imgbox.com/52/3b/cDGqfN41_o.png" alt="图片描述" title="" style="border:0px; vertical-align:middle; display:table; margin:auto; max-width:100%"></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 这时候还发现在工程目录里面，多了一个文本文件java.hprof.txt，如下图所示：</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <img src="https://images2.imgbox.com/ef/45/A7RJs7gC_o.png" alt="图片描述" title="" style="border:0px; vertical-align:middle; display:table; margin:auto; max-width:100%"></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 内容如下：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs avrasm" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent">CPU TIME (ms) BEGIN (total = <span class="hljs-number" style="color:rgb(0,102,102)">11542</span>) Fri Jul <span class="hljs-number" style="color:rgb(0,102,102)">22</span> <span class="hljs-number" style="color:rgb(0,102,102)">11</span>:<span class="hljs-number" style="color:rgb(0,102,102)">00</span>:<span class="hljs-number" style="color:rgb(0,102,102)">34</span> <span class="hljs-number" style="color:rgb(0,102,102)">2016</span>
rank   self  accum   count trace method
   <span class="hljs-number" style="color:rgb(0,102,102)">1</span> <span class="hljs-number" style="color:rgb(0,102,102)">86.65</span>% <span class="hljs-number" style="color:rgb(0,102,102)">86.65</span>%       <span class="hljs-number" style="color:rgb(0,102,102)">1</span> <span class="hljs-number" style="color:rgb(0,102,102)">303422</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">com</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.test</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.HProfTest</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.slowerMethod</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">2</span>  <span class="hljs-number" style="color:rgb(0,102,102)">8.66</span>% <span class="hljs-number" style="color:rgb(0,102,102)">95.31</span>%       <span class="hljs-number" style="color:rgb(0,102,102)">1</span> <span class="hljs-number" style="color:rgb(0,102,102)">303423</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">com</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.test</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.HProfTest</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.slowMethod</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">3</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.25</span>% <span class="hljs-number" style="color:rgb(0,102,102)">95.56</span>%      <span class="hljs-number" style="color:rgb(0,102,102)">36</span> <span class="hljs-number" style="color:rgb(0,102,102)">300745</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.util</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.zip</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.ZipFile</span>.&lt;init&gt;
   <span class="hljs-number" style="color:rgb(0,102,102)">4</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.20</span>% <span class="hljs-number" style="color:rgb(0,102,102)">95.76</span>%      <span class="hljs-number" style="color:rgb(0,102,102)">36</span> <span class="hljs-number" style="color:rgb(0,102,102)">300434</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.lang</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.String</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.equals</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">5</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.13</span>% <span class="hljs-number" style="color:rgb(0,102,102)">95.89</span>%      <span class="hljs-number" style="color:rgb(0,102,102)">14</span> <span class="hljs-number" style="color:rgb(0,102,102)">301138</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.net</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.URLStreamHandler</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.parseURL</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">6</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.11</span>% <span class="hljs-number" style="color:rgb(0,102,102)">96.01</span>%       <span class="hljs-number" style="color:rgb(0,102,102)">6</span> <span class="hljs-number" style="color:rgb(0,102,102)">301339</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.net</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.URLClassLoader</span>$1<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.run</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">7</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.10</span>% <span class="hljs-number" style="color:rgb(0,102,102)">96.10</span>%      <span class="hljs-number" style="color:rgb(0,102,102)">14</span> <span class="hljs-number" style="color:rgb(0,102,102)">301124</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.lang</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.String</span>.&lt;init&gt;
   <span class="hljs-number" style="color:rgb(0,102,102)">8</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.09</span>% <span class="hljs-number" style="color:rgb(0,102,102)">96.19</span>%    <span class="hljs-number" style="color:rgb(0,102,102)">3407</span> <span class="hljs-number" style="color:rgb(0,102,102)">300355</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.lang</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.String</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.charAt</span>
   <span class="hljs-number" style="color:rgb(0,102,102)">9</span>  <span class="hljs-number" style="color:rgb(0,102,102)">0.08</span>% <span class="hljs-number" style="color:rgb(0,102,102)">96.27</span>%      <span class="hljs-number" style="color:rgb(0,102,102)">36</span> <span class="hljs-number" style="color:rgb(0,102,102)">300443</span> java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.io</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.UnixFileSystem</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.normalize</span></code></pre> 
<blockquote style="padding:10px 20px; margin:10px 0px; font-size:14px; border-left-width:5px; border-left-style:solid; color:rgb(51,51,51); font-family:'microsoft yahei',arial; line-height:27.2000007629395px; text-align:justify; background:rgb(247,247,247)"> 
 <p style="margin-top:0px; margin-bottom:0px"><span style="font-weight:700">注</span>：通过上面内容可以看到，哪个类的方法执行时间长，耗费了CPU时间，一目了然，方便我们快速定位问题。</p> 
</blockquote> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <span style="font-weight:700">2. 命令的具体讲解</span></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> hprof不是独立的监控工具，它只是一个java agent工具，它可以用在监控Java应用程序在运行时的CPU信息和堆内容，使用java -agentlib:hprof=help命令可以查看hprof的使用文档。</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <img src="https://images2.imgbox.com/c5/cf/MwdVC0Lm_o.png" alt="图片描述" title="" style="border:0px; vertical-align:middle; display:table; margin:auto; max-width:100%"></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 通过上图可以看到这个工具非常强大，可以统计的东西很多，上面的例子统计的是CPU时间，同样我们还可以统计内存占用的dump信息。 <br style=""> 如：<code style="font-family:'Source Code Pro',monospace; font-size:14.3999996185303px; padding:2px 4px; color:rgb(63,63,63); white-space:nowrap">-agentlib:hprof=heap,format=b,file=/test.hprof</code></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 这个hprof小工具，非常方便我们在用JUnit自测代码的时候结合使用，既可以解决业务上的BUG，又能够在一定程序上解决可发现的性能问题，非常实用。</p> 
<h4 style="font-family:'microsoft yahei',arial; font-weight:500; line-height:1.1; color:rgb(51,51,51); margin-top:20px; margin-bottom:10px; font-size:24px; text-align:justify"> 二、性能排查工具-pidstat</h4> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <span style="font-weight:700">1. 示例演示</span></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 例子程序：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs java" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent"><span class="hljs-javadoc" style="color:rgb(136,0,0)">/**
 * PROJECT_NAME: test
 * DATE:         16/7/22
 * CREATE BY:    chao.cheng
 **/</span>
<span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-class" style=""><span class="hljs-keyword" style="color:rgb(0,0,136)">class</span> <span class="hljs-title" style="color:rgb(102,0,102)">PidstatTest</span> {<!-- --></span>
    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">static</span> <span class="hljs-class" style=""><span class="hljs-keyword" style="color:rgb(0,0,136)">class</span> <span class="hljs-title" style="color:rgb(102,0,102)">PidstatTask</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">implements</span>  <span class="hljs-title" style="color:rgb(102,0,102)">Runnable</span> {<!-- --></span>
        <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">run</span>() {
            <span class="hljs-keyword" style="color:rgb(0,0,136)">while</span>(<span class="hljs-keyword" style="color:rgb(0,0,136)">true</span>) {
                <span class="hljs-keyword" style="color:rgb(0,0,136)">double</span> value = Math.random() * Math.random();
            }
        }
    }

    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">static</span> <span class="hljs-class" style=""><span class="hljs-keyword" style="color:rgb(0,0,136)">class</span> <span class="hljs-title" style="color:rgb(102,0,102)">LazyTask</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">implements</span> <span class="hljs-title" style="color:rgb(102,0,102)">Runnable</span> {<!-- --></span>
        <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">run</span>() {
            <span class="hljs-keyword" style="color:rgb(0,0,136)">try</span> {
                <span class="hljs-keyword" style="color:rgb(0,0,136)">while</span> (<span class="hljs-keyword" style="color:rgb(0,0,136)">true</span>) {
                    Thread.sleep(<span class="hljs-number" style="color:rgb(0,102,102)">1000</span>);
                }
            } <span class="hljs-keyword" style="color:rgb(0,0,136)">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    }

    <span class="hljs-keyword" style="color:rgb(0,0,136)">public</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">static</span> <span class="hljs-keyword" style="color:rgb(0,0,136)">void</span> <span class="hljs-title" style="">main</span>(String[] args) {
        <span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> Thread(<span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> PidstatTask()).start();
        <span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> Thread(<span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> LazyTask()).start();
        <span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> Thread(<span class="hljs-keyword" style="color:rgb(0,0,136)">new</span> LazyTask()).start();
    }
}</code></pre> 
<blockquote style="padding:10px 20px; margin:10px 0px; font-size:14px; border-left-width:5px; border-left-style:solid; color:rgb(51,51,51); font-family:'microsoft yahei',arial; line-height:27.2000007629395px; text-align:justify; background:rgb(247,247,247)"> 
 <p style="margin-top:0px; margin-bottom:0px"><span style="font-weight:700">注</span>：这是一段测试用的java程序，将其运行起来。</p> 
</blockquote> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 在命令行输入：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs haml" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent">pidstat -p 843 1 3 -u -t
<span class="hljs-comment" style="color:rgb(136,0,0)">/* </span>
-<span class="ruby" style="">u：代表对cpu使用率的监控
</span>参数1 3：表示每秒采样一次，一共三次
-<span class="ruby" style="">t：将监控级别细化到线程 
</span>*/</code></pre> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 运行命令显示如下图所示：</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <img src="https://images2.imgbox.com/28/d9/dO0lVOXZ_o.png" alt="图片描述" title="" style="border:0px; vertical-align:middle; display:table; margin:auto; max-width:100%"></p> 
<blockquote style="padding:10px 20px; margin:10px 0px; font-size:14px; border-left-width:5px; border-left-style:solid; color:rgb(51,51,51); font-family:'microsoft yahei',arial; line-height:27.2000007629395px; text-align:justify; background:rgb(247,247,247)"> 
 <p style="margin-top:0px; margin-bottom:0px"><span style="font-weight:700">注</span>：其实中TID就是线程ID，%usr表示用户线程使用率，从图中可以看到855这个线程CPU占用非常高。</p> 
</blockquote> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 再输入如下命令：</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <code style="font-family:'Source Code Pro',monospace; font-size:14.3999996185303px; padding:2px 4px; color:rgb(63,63,63); white-space:nowrap">jstack -l 843 &gt; /tmp/testlog.txt</code></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 查看testlog.txt显示如下部分内容：</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <img src="https://images2.imgbox.com/6e/cb/BCH5oc2i_o.png" alt="图片描述" title="" style="border:0px; vertical-align:middle; display:table; margin:auto; max-width:100%"></p> 
<blockquote style="padding:10px 20px; margin:10px 0px; font-size:14px; border-left-width:5px; border-left-style:solid; color:rgb(51,51,51); font-family:'microsoft yahei',arial; line-height:27.2000007629395px; text-align:justify; background:rgb(247,247,247)"> 
 <p style="margin-top:0px; margin-bottom:0px"><span style="font-weight:700">注</span>：我们关注的是日志文件的NID字段，它对应的就是我们上面说的TID，NID是TID的16进制表示，将上面的十进制855转换成十六进制为357，在日志中进行搜索看到如下内容：</p> 
</blockquote> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs avrasm" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent"><span class="hljs-string" style="color:rgb(0,136,0)">"Thread-0"</span> prio=<span class="hljs-number" style="color:rgb(0,102,102)">10</span> tid=<span class="hljs-number" style="color:rgb(0,102,102)">0x00007f7d90103800</span> nid=<span class="hljs-number" style="color:rgb(0,102,102)">0x357</span> runnable [<span class="hljs-number" style="color:rgb(0,102,102)">0x00007f7d943d5000</span>]
   java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.lang</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.Thread</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.State</span>: RUNNABLE
    at PidstatTest$PidstatTask<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.run</span>(PidstatTest<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102)">13</span>)
    at java<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.lang</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.Thread</span><span class="hljs-preprocessor" style="color:rgb(68,68,68)">.run</span>(Thread<span class="hljs-preprocessor" style="color:rgb(68,68,68)">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102)">722</span>)

   Locked ownable synchronizers:
    - None</code></pre> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> 以此可以推断出有性能瓶颈的程序点。</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> <span style="font-weight:700">2. pidstat具体命令详解</span></p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> pidstat是一个功能非常强大的性能监测工具，他是Sysstat的组件之一，可以从<a target="_blank" href="http://sebastien.godard.pagesperso-orange.fr/download.html" rel="nofollow noopener noreferrer" style="color:rgb(51,122,183); text-decoration:none; background-color:transparent">http://sebastien.godard.pagesperso-orange.fr/download.html</a> 进行下载，下载后可以通过<code style="font-family:'Source Code Pro',monospace; font-size:14.3999996185303px; padding:2px 4px; color:rgb(63,63,63); white-space:nowrap">./configure</code>等命令进行安装，这个命令的强大之处在于不仅可以监控进程的性能情况，也可以监控线程的性能情况。</p> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> pidstat监控CPU常用显示字段内容如下：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs perl" style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent"><span class="hljs-number" style="color:rgb(0,102,102)">1</span>、PID - 被监控的任务的进程号
<span class="hljs-number" style="color:rgb(0,102,102)">2</span>、<span class="hljs-variable" style="color:rgb(102,0,102)">%usr</span> - 当在用户层执行（应用程序）时这个任务的cpu使用率，和 nice 优先级无关。注意这个字段计算的cpu时间不包括在虚拟处理器中花去的时间。
<span class="hljs-number" style="color:rgb(0,102,102)">3</span>、<span class="hljs-variable" style="color:rgb(102,0,102)">%system</span> - 这个任务在系统层使用时的cpu使用率。
<span class="hljs-number" style="color:rgb(0,102,102)">4</span>、<span class="hljs-variable" style="color:rgb(102,0,102)">%guest</span> - 任务花费在虚拟机上的cpu使用率（运行在虚拟处理器）。
<span class="hljs-number" style="color:rgb(0,102,102)">5</span>、<span class="hljs-variable" style="color:rgb(102,0,102)">%CPU</span> - 任务总的cpu使用率。在SMP环境（多处理器）中，如果在命令行中输入-I参数的话，cpu使用率会除以你的cpu数量。
<span class="hljs-number" style="color:rgb(0,102,102)">6</span>、CPU - 正在运行这个任务的处理器编号。
<span class="hljs-number" style="color:rgb(0,102,102)">7</span>、Command - 这个任务的命令名称。</code></pre> 
<p style="margin-top:0px; margin-bottom:20px; color:rgb(51,51,51); font-family:'microsoft yahei',arial; font-size:16px; line-height:27.2000007629395px; text-align:justify"> pidstat监控IO常用的字段显示内容如下：</p> 
<pre class="prettyprint" style="overflow:auto; font-family:'Source Code Pro',monospace; font-size:13px; padding:9.5px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; text-align:justify; background-color:rgb(248,249,250)"><code class=" hljs " style="font-family:'Source Code Pro',monospace; font-size:undefined; padding:0px; color:inherit; white-space:pre-wrap; display:block; background:transparent">1、kB_rd/s - 任务从硬盘上的读取速度（kb）
2、kB_wr/s - 任务向硬盘中的写入速度（kb）
3、kB_ccwr/s - 任务写入磁盘被取消的速率（kb）</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6cc76ea89df783c7a207b1012653c579/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS笔记监听键盘状态 获取键盘高度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e1f19ca4f2a5fba80466101858a13427/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第一章 银联8583报文解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>