<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VBA快速智能拆分日期 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VBA快速智能拆分日期" />
<meta property="og:description" content="实例需求：
A列为待处理数据，日期有多种格式 单个日期：6.16同月简写时间段：7.7-8，其含为7.7-7.8跨月时间段：5.29-6.2 现在需要将A列日期，按照如下规则筛选，并提取开始日期和结束日期，填写在B列和C列 时间段（包含起止日期）大于等于5天如果没有符合条件的时间段，B列和C列留空如果有多个符合条件的时间段，提取最后一个，例如A2单元格中，5.15-19和5.29-6.2都符合条件，那么从5.29-6.2中提取起止日期 示例代码如下。
Sub SplitDate() Dim arrDT, arrDate, i As Long, j As Long Dim dDate1 As Date, dDate2 As Date, iMth As Long Const DT_FORMAT = &#34;yyyy-mm-dd&#34; For i = 2 To Cells(Rows.Count, 1).End(xlUp).Row arrDT = Split(Cells(i, 1), &#34;,&#34;) For j = UBound(arrDT) To 0 Step -1 arrDate = Split(Replace(Replace(arrDT(j), &#34;-&#34;, &#34;|&#34;), &#34;.&#34;, &#34;-&#34;), &#34;|&#34;) If UBound(arrDate) &gt; 0 And IsDate(arrDate(0)) Then dDate1 = CDate(arrDate(0)) iMth = Month(dDate1) If InStr(arrDate(1), &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/674e79f4f995fc6578ca180e67d19df3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-27T12:36:44+08:00" />
<meta property="article:modified_time" content="2024-01-27T12:36:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VBA快速智能拆分日期</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>实例需求：</p> 
<ol><li>A列为待处理数据，日期有多种格式</li></ol> 
<ul><li>单个日期：6.16</li><li>同月简写时间段：7.7-8，其含为7.7-7.8</li><li>跨月时间段：5.29-6.2</li></ul> 
<ol start="2"><li>现在需要将A列日期，按照如下规则筛选，并提取开始日期和结束日期，填写在B列和C列</li></ol> 
<ul><li>时间段（包含起止日期）大于等于5天</li><li>如果没有符合条件的时间段，B列和C列留空</li><li>如果有多个符合条件的时间段，提取最后一个，例如A2单元格中，5.15-19和5.29-6.2都符合条件，那么从5.29-6.2中提取起止日期</li></ul> 
<p><img src="https://images2.imgbox.com/c3/9b/3LnhRjpC_o.png" alt="在这里插入图片描述"></p> 
<p>示例代码如下。</p> 
<pre><code>Sub SplitDate()
    Dim arrDT, arrDate, i As Long, j As Long
    Dim dDate1 As Date, dDate2 As Date, iMth As Long
    Const DT_FORMAT = "yyyy-mm-dd"
    For i = 2 To Cells(Rows.Count, 1).End(xlUp).Row
        arrDT = Split(Cells(i, 1), ",")
        For j = UBound(arrDT) To 0 Step -1
            arrDate = Split(Replace(Replace(arrDT(j), "-", "|"), ".", "-"), "|")
            If UBound(arrDate) &gt; 0 And IsDate(arrDate(0)) Then
                dDate1 = CDate(arrDate(0))
                iMth = Month(dDate1)
                If InStr(arrDate(1), "-") = 0 Then
                    arrDate(1) = iMth &amp; "-" &amp; arrDate(1)
                End If
                dDate2 = CDate(arrDate(1))
                If dDate2 - dDate1 &gt;= 4 Then
                    Cells(i, 2) = Format(dDate1, DT_FORMAT)
                    Cells(i, 3) = Format(dDate2, DT_FORMAT)
                    Exit For
                End If
            End If
        Next
    Next
End Sub
</code></pre> 
<p>【代码解析】<br> 第5~23行代码循环遍历A列单元格处理数据。<br> 第6行代码将原日期使用逗号拆分为单个时间段。<br> 第7~22行代码倒序处理拆分后的时间段。<br> 第8行代码将数据段再次拆分。首先将减号替换为竖线，然后将小数点替换为减号，最后使用数据作为分割符拆分为起止日期。多次替换的目的是为了将起止日期转换为<code>y-m</code>的格式，以便于后续处理。<br> 第9行代码中<code>UBound(arrDate) &gt; 0</code>说明时间段包含两个日期，否则为单日期。<br> 第10行代码中将拆分后的开始日期字符串转换为日期数据，年份将使用当前日历年，例如：<code>Cdate("5-2")</code>的结果为<code>2024/5/2</code>。<br> 注意：本示例代码并不适用于计算跨年的日期间隔，例如12.30-1.2<br> 第11行代码获取开始日期的月份。<br> 第12行代码判断结束日期字符串中是否包含减号，如果不包含说明是简写格式，第13行在日期之前添加将添加月份和减号。<br> 第15行代码将结束日期字符串转换为日期数据。<br> 第16行代码判断日期间隔是否满足要求。<br> 如果满足要求，第17~18行代码将开始日期和结束日期分别写入B列和C列。<br> 第19行代码退出For循环。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d88b12530e69103ed8cf49e15a8adbb6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring第二讲</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/af101473be50befa7db5476ae4e682fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Bug: git stash恢复误drop的提交</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>