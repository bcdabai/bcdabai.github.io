<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pyinstaller 打包程序的相对路径问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pyinstaller 打包程序的相对路径问题" />
<meta property="og:description" content="pyinstaller 打包py文件成exe文件，在没有python的机器上运行，执行打包后的程序，经常会出现程序使用的图标无法显示，程序使用的关联文件无法关联。或者，在打包的本机上运行正常，但是将打包后的程序放到其它机器上就有问题。这些现象都很有可能是由程序使用的文件路径发生改变产生的，因此在打包时候我们需要根据执行路径进行路径“冻结”。
1.使用绝对路径
在python代码中使用绝对路径调用外部文件可以保证打包时候路径可追溯，因此在本机上运行打包后程序基本没问题。但是当本机上对应路径的资源文件被改变，或者将打包程序应用到别的机器，都会出现搜索不到资源文件的问题。这种方式不是合适的打包发布python软件的方式。
2.使用冻结路径
增加一个py文件，例如叫
frozen_dir.py
--------------------------------------------------------------------------------------------------------------
# -*- coding: utf-8 -*-
import sys
import os
def app_path():
&#34;&#34;&#34;Returns the base application path.&#34;&#34;&#34;
if hasattr(sys, &#39;frozen&#39;):
# Handles PyInstaller
return os.path.dirname(sys.executable) #使用pyinstaller打包后的exe目录
return os.path.dirname(__file__) #没打包前的py目录
-----------------------------------------------------------------------------------------------------------------
其中的app_path()函数返回一个程序的执行路径，为了方便我们将此文件放在项目文件的根目录，通过这种方式建立了相对路径的关系。
源代码中使用路径时，以app_path()的返回值作为基准路径，其它路径都是其相对路径。以本文中使用的python项目打包为例，如下所示
test.py
---------------------------------------------------------------------------------------------------
# -*- codling: utf-8 -*- import os import frozen_dir def savelog(file,log): dirname = os.path.dirname(file) if not os.path.exists(dirname): os.mkdir(dirname) with open(file,&#39;a&#39;,encoding=&#39;utf-8&#39;) as f: f.write(log&#43;&#39;\n&#39;) if __name__==&#39;__main__&#39;: file = frozen_dir.app_path()&#43;r&#39;\log\2.txt&#39; print(file) savelog(file,&#39;hello you&#39;) savelog(file,&#39;文件路径%s&#39; %(file)) -------------------------------------------------------------------------------------------------------" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5bffc6c7c2a03fb0ca3de7256ae7697e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-01-14T14:37:26+08:00" />
<meta property="article:modified_time" content="2019-01-14T14:37:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pyinstaller 打包程序的相对路径问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>pyinstaller 打包py文件成exe文件，在没有python的机器上运行，执行打包后的程序，经常会出现程序使用的图标无法显示，程序使用的关联文件无法关联。或者，在打包的本机上运行正常，但是将打包后的程序放到其它机器上就有问题。这些现象都很有可能是由程序使用的文件路径发生改变产生的，因此在打包时候我们需要根据执行路径进行路径“冻结”。</p> 
<p>1.使用绝对路径</p> 
<p>在python代码中使用绝对路径调用外部文件可以保证打包时候路径可追溯，因此在本机上运行打包后程序基本没问题。但是当本机上对应路径的资源文件被改变，或者将打包程序应用到别的机器，都会出现搜索不到资源文件的问题。这种方式不是合适的打包发布python软件的方式。</p> 
<p>2.使用冻结路径</p> 
<p>增加一个py文件，例如叫</p> 
<p>frozen_dir.py</p> 
<p>--------------------------------------------------------------------------------------------------------------<br> # -*- coding: utf-8 -*-<br> import sys<br> import os<br>  <br> def app_path():<br>     """Returns the base application path."""<br>     if hasattr(sys, 'frozen'):<br>         # Handles PyInstaller<br>         return os.path.dirname(sys.executable)  #使用pyinstaller打包后的exe目录<br>     return os.path.dirname(__file__)                 #没打包前的py目录</p> 
<p>-----------------------------------------------------------------------------------------------------------------<br> 其中的app_path()函数返回一个程序的执行路径，为了方便我们将此文件放在项目文件的根目录，通过这种方式建立了相对路径的关系。</p> 
<p>源代码中使用路径时，以app_path()的返回值作为基准路径，其它路径都是其相对路径。以本文中使用的python项目打包为例，如下所示</p> 
<p>test.py</p> 
<p>---------------------------------------------------------------------------------------------------</p> 
<pre># -*- codling: utf-8 -*-
import os
import frozen_dir

def savelog(file,log):
    dirname = os.path.dirname(file)
    if not os.path.exists(dirname):
        os.mkdir(dirname)
    with open(file,'a',encoding='utf-8') as f:
        f.write(log+'\n')

if __name__=='__main__':
    file = frozen_dir.app_path()+r'\log\2.txt'
    print(file)
    savelog(file,'hello you')
    savelog(file,'文件路径%s' %(file))
</pre> 
<p>-------------------------------------------------------------------------------------------------------</p> 
<p>注意：1、pyinstaller -D test.py 生成exe文件有效</p> 
<p>            2、pyinstaller -F test.py 只生成单独exe文件无效</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/adfd20a315c214598a39b6601ddc3f75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">038-2018-1030 gevent IO多路复用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7302062b025041665141eb40583555bf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">cookie设置域名问题，cookie跨域</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>