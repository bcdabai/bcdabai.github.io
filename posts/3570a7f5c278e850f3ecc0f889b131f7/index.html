<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql aa复制_MySQL主从复制与主主复制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql aa复制_MySQL主从复制与主主复制" />
<meta property="og:description" content="1、简介
MySQL作为世界上使用最为广泛的数据库之一，免费是其原因之一。但不可忽略的是它本身的功能的确很强大。随着技术的发展，在实际的生产环境中，由单台MySQL数据库服务器不能满足实际的需求。此时数据库集群就很好的解决了这个问题了。采用MySQL分布式集群，能够搭建一个高并发、负载均衡的集群服务器(这篇博客暂时不涉及)。在此之前我们必须要保证每台MySQL服务器里的数据同步。数据同步我们可以通过MySQL内部配置就可以轻松完成，主要有主从复制和主主复制。
2、环境说明
两台linux虚拟主机
Linux版本CentOS6.6、MySQL 5.5
ip：192.168.95.11、192.168.95.12
3、主从复制
3.1、MySQL
已经安装好，并且没有任何数据
3.2、配置文件
一般Linux中的MySQL配置文件都在/etc/my.cnf(windows中的配置文件为mysql.ini)
log-bin=mysql-bin 开启二进制日志
注意：二进制日志必须开启，因为数据的同步实质上就是其他的MySQL数据库服务器将这个数据变更的二进制日志在本机上再执行一遍。
192.168.95.11 为主数据库服务器
192.168.95.12 为从数据库服务器
3.3、开始构建主从复制
第一步：
在192.168.95.11中创建一个192.168.95.12主机中可以登录的MySQL用户
用户：mysql12
密码：mysql12
mysql&gt;GRANT REPLICATION SLAVE ON *.* TO ‘mysql12’@’192.168.95.12’ IDENTIFIED BY ‘mysql12’;
mysql&gt;FLUSH PRIVILEGES;
第二步：
查看192.168.95.11MySQL服务器二进制文件名与位置
mysql&gt;SHOW MASTER STATUS;
第三步：
告知二进制文件名与位置
在192.168.95.12中执行：
mysql&gt;CHANGE MASTER TO
&gt;MASTER_HOST=’192.168.95.11’,
&gt;MASTER_USER=’mysql12’,
&gt;MASTER_PASSWORD=’mysql12’,
&gt;MASTER_LOG_FILE=’mysql-bin.000048’,
&gt;MASTER_LOG_POS=432;
完成主从复制配置
3.4、测试主从复制
在192.168.95.12中
mysql&gt;SLAVE START; #开启复制
mysql&gt;SHOW SLAVE STATUS\G #查看主从复制是否配置成功
当看到Slave_IO_Running: YES、Slave_SQL_Running: YES才表明状态正常
实际测试：
--登陆192.168.95.11主MySQL
mysql&gt;SHOW DATABASES;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3570a7f5c278e850f3ecc0f889b131f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-19T20:38:44+08:00" />
<meta property="article:modified_time" content="2021-01-19T20:38:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql aa复制_MySQL主从复制与主主复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>1、简介</p> 
 <p>MySQL作为世界上使用最为广泛的数据库之一，免费是其原因之一。但不可忽略的是它本身的功能的确很强大。随着技术的发展，在实际的生产环境中，由单台MySQL数据库服务器不能满足实际的需求。此时数据库集群就很好的解决了这个问题了。采用MySQL分布式集群，能够搭建一个高并发、负载均衡的集群服务器(这篇博客暂时不涉及)。在此之前我们必须要保证每台MySQL服务器里的数据同步。数据同步我们可以通过MySQL内部配置就可以轻松完成，主要有主从复制和主主复制。</p> 
 <p>2、环境说明</p> 
 <p>两台linux虚拟主机</p> 
 <p>Linux版本CentOS6.6、MySQL 5.5</p> 
 <p>ip：192.168.95.11、192.168.95.12</p> 
 <p>3、主从复制</p> 
 <p>3.1、MySQL</p> 
 <p>已经安装好，并且没有任何数据</p> 
 <p>3.2、配置文件</p> 
 <p>一般Linux中的MySQL配置文件都在/etc/my.cnf(windows中的配置文件为mysql.ini)</p> 
 <p>log-bin=mysql-bin 开启二进制日志</p> 
 <p>注意：二进制日志必须开启，因为数据的同步实质上就是其他的MySQL数据库服务器将这个数据变更的二进制日志在本机上再执行一遍。</p> 
 <p>192.168.95.11  为主数据库服务器</p> 
 <p>192.168.95.12  为从数据库服务器</p> 
 <p>3.3、开始构建主从复制</p> 
 <p>第一步：</p> 
 <p>在192.168.95.11中创建一个192.168.95.12主机中可以登录的MySQL用户</p> 
 <p>用户：mysql12</p> 
 <p>密码：mysql12</p> 
 <p>mysql&gt;GRANT REPLICATION SLAVE ON *.* TO ‘mysql12’@’192.168.95.12’ IDENTIFIED BY ‘mysql12’;</p> 
 <p>mysql&gt;FLUSH PRIVILEGES;</p> 
 <p>第二步：</p> 
 <p>查看192.168.95.11MySQL服务器二进制文件名与位置</p> 
 <p>mysql&gt;SHOW MASTER STATUS;</p> 
 <p align="center"><img src="https://images2.imgbox.com/b9/78/jTnVHoDI_o.png" alt="f237683ce7633c992c41dbcd2c1e6342.png"></p> 
 <p>第三步：</p> 
 <p>告知二进制文件名与位置</p> 
 <p>在192.168.95.12中执行：</p> 
 <p>mysql&gt;CHANGE MASTER TO</p> 
 <p>&gt;MASTER_HOST=’192.168.95.11’,</p> 
 <p>&gt;MASTER_USER=’mysql12’,</p> 
 <p>&gt;MASTER_PASSWORD=’mysql12’,</p> 
 <p>&gt;MASTER_LOG_FILE=’mysql-bin.000048’,</p> 
 <p>&gt;MASTER_LOG_POS=432;</p> 
 <p align="center"><img src="https://images2.imgbox.com/ad/31/OhJC9nh6_o.png" alt="593ee1f4278cf9c7106616f8ee605e41.png"></p> 
 <p>完成主从复制配置</p> 
 <p>3.4、测试主从复制</p> 
 <p>在192.168.95.12中</p> 
 <p>mysql&gt;SLAVE START;   #开启复制</p> 
 <p>mysql&gt;SHOW SLAVE STATUS\G   #查看主从复制是否配置成功</p> 
 <p align="center"><img src="https://images2.imgbox.com/14/f6/JbsO3QKp_o.png" alt="5dffc0684a13c2b1d686be61542985f3.png"></p> 
 <p>当看到Slave_IO_Running: YES、Slave_SQL_Running: YES才表明状态正常</p> 
 <p>实际测试：</p> 
 <p>--登陆192.168.95.11主MySQL</p> 
 <p>mysql&gt;SHOW DATABASES;</p> 
 <p align="center"><img src="https://images2.imgbox.com/19/d6/PSkF7mfl_o.png" alt="1354faabfa1e3587286a5d1942c78304.png"></p> 
 <p>--登陆192.168.95.12从MySQL</p> 
 <p>mysql&gt;SHOW DATABASES;</p> 
 <p align="center"><img src="https://images2.imgbox.com/29/cb/I39uLxgB_o.png" alt="394f3bfaaa8355896f38d464c41f19e6.png"></p> 
 <p>-----------------------------------------------------</p> 
 <p>192.168.95.11主MySQL操作：</p> 
 <p>mysql&gt;create database aa;</p> 
 <p>mysql&gt;use aa;</p> 
 <p>mysql&gt;create table tab1(id int auto_increment,name varchar(10),primary key(id));</p> 
 <p>mysql&gt;show databases;</p> 
 <p>mysql&gt;show tables;</p> 
 <p align="center"><img src="https://images2.imgbox.com/a8/c4/a91iG11x_o.png" alt="56cf8fac38d10fd3665101ae5e7ae542.png"></p> 
 <p>192.168.95.12从MySQL操作：</p> 
 <p>mysql&gt;show databases;</p> 
 <p>mysql&gt;show tables;</p> 
 <p align="center"><img src="https://images2.imgbox.com/e6/41/0gTXsGGJ_o.png" alt="3de3729843babd1e20b4c9cc7823f4b7.png"></p> 
 <p>由上面两个结果图可得知，两主机达到了数据同步。主从复制的配置就是如此的简单。</p> 
 <p>4、MySql主主复制</p> 
 <p>4.1、实现原理</p> 
 <p>主主复制即在两台MySQL主机内都可以变更数据，而且另外一台主机也会做出相应的变更。聪明的你也许已经想到该怎么实现了。对，就是将两个主从复制有机合并起来就好了。只不过在配置的时候我们需要注意一些问题，例如，主键重复，server-id不能重复等等。</p> 
 <p>4.2、配置文件</p> 
 <p>--192.168.95.11</p> 
 <p>server-id=11   #任意自然数n，只要保证两台MySQL主机不重复就可以了。</p> 
 <p>log-bin=mysql-bin   #开启二进制日志</p> 
 <p>auto_increment_increment=2   #步进值auto_imcrement。一般有n台主MySQL就填n</p> 
 <p>auto_increment_offset=1   #起始值。一般填第n台主MySQL。此时为第一台主MySQL</p> 
 <p>binlog-ignore=mysql   #忽略mysql库【我一般都不写】</p> 
 <p>binlog-ignore=information_schema   #忽略information_schema库【我一般都不写】</p> 
 <p>replicate-do-db=aa   #要同步的数据库，默认所有库</p> 
 <p>--192.168.95.12</p> 
 <p>server-id=12</p> 
 <p>log-bin=mysql-bin</p> 
 <p>auto_increment_increment=2</p> 
 <p>auto_increment_offset=2</p> 
 <p>replicate-do-db=aa</p> 
 <p>配置好后重启MySQL</p> 
 <p>4.3、开始构建主主复制</p> 
 <p>因为主主复制是两个主从复制组合一起，所以我就接着上面主从复制接着配置。</p> 
 <p>第一步：</p> 
 <p>在192.168.95.12中创建一个192.168.95.11主机中可以登录的MySQL用户</p> 
 <p>用户：mysql11</p> 
 <p>密码：mysql11</p> 
 <p>mysql&gt;GRANT REPLICATION SLAVE ON *.* TO ‘mysql11’@’192.168.95.11’ IDENTIFIED BY ‘mysql11’;</p> 
 <p>mysql&gt;FLUSH PRIVILEGES;</p> 
 <p>第二步：</p> 
 <p>在192.168.95.12查看二进制日志名和位置</p> 
 <p>mysql&gt;show master status;</p> 
 <p align="center"><img src="https://images2.imgbox.com/87/39/9F5DkJqM_o.png" alt="3a85939044b201c78bc0f556955321cb.png"></p> 
 <p>第三步：</p> 
 <p>告知二进制文件名与位置</p> 
 <p>在192.168.95.11中执行：</p> 
 <p>mysql&gt;CHANGE MASTER TO</p> 
 <p>MASTER_HOST=’192.168.95.12’,</p> 
 <p>MASTER_USER=’mysql11’,</p> 
 <p>MASTER_PASSWORD=’mysql11’,</p> 
 <p>MASTER_LOG_FILE=’mysql-bin.000084’,</p> 
 <p>MASTER_LOG_POS=107;</p> 
 <p align="center"><img src="https://images2.imgbox.com/13/ad/pNLTFWcO_o.png" alt="833958389cbb9e0d360d3d02b98a048b.png"></p> 
 <p>完成主主复制配置</p> 
 <p>4.4、测试主主复制</p> 
 <p>分别开启slave start；</p> 
 <p>mysql&gt;SHOW SLAVE STATUS\G   #查看主从复制是否配置成功</p> 
 <p>192.168.95.11</p> 
 <p align="center"><img src="https://images2.imgbox.com/15/66/FTKRKQun_o.png" alt="22680b7138d56b159dc1d07584f77d05.png"></p> 
 <p>192.168.95.12</p> 
 <p align="center"><img src="https://images2.imgbox.com/8e/3a/hiOc8nES_o.png" alt="ad0fed7734b79bb141ebf88f5ffe9ec5.png"></p> 
 <p>当看到Slave_IO_Running: YES、Slave_SQL_Running: YES才表明状态正常</p> 
 <p>测试：</p> 
 <p>--192.168.95.11</p> 
 <p>mysql&gt;use aa;</p> 
 <p>mysql&gt;select*from tab1;</p> 
 <p>tab1无数据</p> 
 <p>--192.168.95.12</p> 
 <p>mysql&gt;use aa;</p> 
 <p>mysql&gt;select*from tab1;</p> 
 <p>tab1无数据</p> 
 <p>--192.168.95.11插入数据</p> 
 <p>mysql&gt;insert into tab1 (name) value(‘11’),(‘11’),(‘11’);</p> 
 <p>--192.168.95.12插入数据</p> 
 <p>mysql&gt;insert into tab1 (name) value(‘22’),(‘22’),(‘22’);</p> 
 <p>查看数据：</p> 
 <p>两个主机数据结果一样！</p> 
 <p align="center"><img src="https://images2.imgbox.com/fb/3f/UZPEeMUc_o.png" alt="abeb413941206385afc8f4be967f6dcc.png"></p> 
 <p>主主复制配置成功！</p> 
 <p>5、注意事项</p> 
 <p>1、主主复制配置文件中auto_increment_increment和auto_increment_offset只能保证主键不重复，却不能保证主键有序。</p> 
 <p>2、当配置完成Slave_IO_Running、Slave_SQL_Running不全为YES时，show slave status\G信息中有错误提示，可根据错误提示进行更正。</p> 
 <p>3、Slave_IO_Running、Slave_SQL_Running不全为YES时，大多数问题都是数据不统一导致。</p> 
 <p>常见出错点：</p> 
 <p>1、两台数据库都存在db数据库，而第一台MySQL db中有tab1，第二台MySQL db中没有tab1，那肯定不能成功。</p> 
 <p>2、已经获取了数据的二进制日志名和位置，又进行了数据操作，导致POS发生变更。在配置CHANGE MASTER时还是用到之前的POS。</p> 
 <p>3、stop slave后，数据变更，再start slave。出错。</p> 
 <p>终极更正法：重新执行一遍CHANGE MASTER就好了。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa919e803f5355e10e52c3a89467a059/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql的两个时间比较大小_mysql中日期比较大小的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9844b2be4c524ebeff9de80938cc0809/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript实现小米购物车功能案例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>