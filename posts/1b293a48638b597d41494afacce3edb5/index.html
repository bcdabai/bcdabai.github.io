<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>oracle数据库之DBNAME和DBID - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="oracle数据库之DBNAME和DBID" />
<meta property="og:description" content="一、查看DBID (1)使用rman查看
$ rman target / Recovery Manager: Release 11.2.0.4.0 - Production on Fri Jun 12 03:20:19 2015 Copyright (c) 1982, 2011, Oracle and/or its affiliates. All rights reserved. connected to target database: DBTEST (DBID=1275017193) RMAN&gt; (2)使用sqlplus查看
SQL&gt; select dbid,name,open_mode from v$database; #查看数据库的dbid DBID NAME OPEN_MODE ----------- ------- --------------- 1553428630 SHP READ WRITE (3)dump文件查看
#dump日志文件 SQL&gt; alter system dump logfile ‘/u01/app/oracle/oradata/dbtest/redo01.log‘; #dump数据文件 SQL&gt; alter system dump datafile ‘/u01/app/oracle/oradata/dbtest/users01.dbf‘ block min 1 block max 4; #dump归档日志 SQL&gt; alter system dump logfile ‘/home/oracle/arch/1_11_882154347." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1b293a48638b597d41494afacce3edb5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-21T16:03:10+08:00" />
<meta property="article:modified_time" content="2023-03-21T16:03:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">oracle数据库之DBNAME和DBID</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DBID_0"></a>一、查看DBID</h2> 
<p><strong>(1)使用rman查看</strong></p> 
<pre><code class="prism language-bash">$ rman target /

Recovery Manager: Release <span class="token number">11.2</span>.0.4.0 - Production on Fri Jun <span class="token number">12</span> 03:20:19 <span class="token number">2015</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2011</span>, Oracle and/or its affiliates.  All rights reserved.

connected to target database: DBTEST <span class="token punctuation">(</span>DBID<span class="token operator">=</span><span class="token number">1275017193</span><span class="token punctuation">)</span>

RMAN<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>(2)使用sqlplus查看</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid<span class="token punctuation">,</span>name<span class="token punctuation">,</span>open_mode <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>   <span class="token comment">#查看数据库的dbid</span>

   DBID           NAME           OPEN_MODE
<span class="token comment">-----------     -------        ---------------</span>
<span class="token number">1553428630</span>        SHP            <span class="token keyword">READ</span> <span class="token keyword">WRITE</span>
</code></pre> 
<p><strong>(3)dump文件查看</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">#dump日志文件</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> system <span class="token keyword">dump</span> logfile ‘<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>dbtest<span class="token operator">/</span>redo01<span class="token punctuation">.</span>log‘<span class="token punctuation">;</span>

<span class="token comment">#dump数据文件</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> system <span class="token keyword">dump</span> datafile ‘<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>dbtest<span class="token operator">/</span>users01<span class="token punctuation">.</span>dbf‘ block min <span class="token number">1</span> block max <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">#dump归档日志</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> system <span class="token keyword">dump</span>  logfile ‘<span class="token operator">/</span>home<span class="token operator">/</span>oracle<span class="token operator">/</span>arch<span class="token operator">/</span><span class="token number">1</span>_11_882154347<span class="token punctuation">.</span>dbf‘<span class="token punctuation">;</span>

然后查看<span class="token keyword">dump</span>文件的内容
查看oracle 数据库的DBID
</code></pre> 
<h2><a id="NIDDBNAMEDBID_44"></a>二、使用NID修改DBNAME和DBID</h2> 
<h3><a id="nid_46"></a>nid详解</h3> 
<p>我们知道，在数据库内部，数据库的DBNAME和DBID是数据库标识符，其中，DBID更是数据库的唯一标识符，如果要重新调整数据库的名字，一般是要重建控制文件,为数据库赋予新的名称 (DBNAME)；<br> 但是，更改实例的内部数据库标识符 (DBID) 是不可能的，这样对于恢复管理器 (RMAN)来说，由于是通过 DBID来区分数据库的，因此无法在同一个RMAN存储库中同时注册种子数据库和重建之后的数据库。<br> 对此，Oracle专门提供的数据库名字修改工具NID(DBNEWID)，解决了这个问题。<br> NID(DBNEWID)实用程序是在Oracle 10g中引入的，是一个数据库实用程序，位于 $ORACLE_HOME/bin 目录中，可以更改操作数据库的内部数据库标识符 (DBID) 和数据库名称 (DBNAME)。</p> 
<p>NID用途：<br> 只修改数据库的DBID（无法指定值修改）；<br> 只修改数据库的DBNAME；<br> 同时修改数据库的DBNAME和DBID（无法指定值修改）；</p> 
<p>注意：</p> 
<ol><li>如果仅调整DBNAME，调整之后，数据库是不需要使用RESETLOGS选项就可以正常打开，数据库备份和存档日志都不会失效。调整DBNAME的影响是： 需要调整初始化参数文件中的db_name参数；需要重新创建 Oracle密码文件.</li><li>如果仅调整数据库的DBID，由于更改数据库的DBID是一个全局的操作，一旦数据库的DBID发生改变，对应该数据库的所有备份和存档日志将不再可用，所以在更改数据库DBID之后，必须使用RESETLOGS选项打开数据库，那么数据库会将联机重做日志的序列重置为1，因此，建议在调整数据库的DBID之后应立即对整个数据库进行备份。</li></ol> 
<p>NID 实用程序的参数：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@dkf ~<span class="token punctuation">]</span>$ nid -help

DBNEWID: Release <span class="token number">19.0</span>.0.0.0 - Production on Thu Dec <span class="token number">22</span> <span class="token number">17</span>:45:01 <span class="token number">2022</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2019</span>, Oracle and/or its affiliates.  All rights reserved.

Keyword     Description                    <span class="token punctuation">(</span>Default<span class="token punctuation">)</span>
----------------------------------------------------
TARGET      Username/Password              <span class="token punctuation">(</span>NONE<span class="token punctuation">)</span>
DBNAME      New database name              <span class="token punctuation">(</span>NONE<span class="token punctuation">)</span>
LOGFILE     Output Log                     <span class="token punctuation">(</span>NONE<span class="token punctuation">)</span>
REVERT      Revert failed change           NO
SETNAME     Set a new database name only   NO
APPEND      Append to output log           NO
HELP        Displays these messages        NO

<span class="token punctuation">[</span>oracle@dkfdg ~<span class="token punctuation">]</span>$ 

翻译如下：
DBNEWID：发布11.2.0.4.0-2023年3月20日星期一16:46:15制作

版权所有（c）19822011，Oracle和/或其附属公司。保留所有权利。

关键字       描述                 （默认）
----------------------------------------------------
TARGET    用户名/密码	              <span class="token punctuation">(</span>无<span class="token punctuation">)</span>
DBNAME    新数据库名称              <span class="token punctuation">(</span>无<span class="token punctuation">)</span>
LOGFILE   输出日志                 <span class="token punctuation">(</span>无<span class="token punctuation">)</span>
REVERT    还原失败更改               否
SETNAME   仅设置新数据库名称          否
APPEND    附加到输出日志             否
HELP      显示这些消息			   否

</code></pre> 
<ul><li> <p>TARGET输入用户名和密码，注意，该用户必须具有sysdba的权限。譬如target=sys/oracle,当然，如果我们是在操作系统本地操作的话，可用反斜杠连接，即target=/</p> </li><li> <p>REVERT指明一个失败的DBID操作是否需要回退。默认是NO。注意，如果数据库的DBID修改成功，该操作无法回退。该回退操作只针对失败的DBID修改操作。</p> </li><li> <p>DBNAME指定新的数据库名。</p> </li><li> <p>SETNAME默认是NO，则该数据库将同时修改DBID和DBNAME。如果指定为YES，则该数据库将只修改DBNAME</p> </li><li> <p>LOGFILE日志文件，记录操作信息，默认是覆盖上个日志文件。如果APPEND设为YES的话，则这次操作信息将被追加到上个日志文件中。APPEND默认是NO。</p> </li><li> <p>HELP用来提示DBNEWID的语法规则。默认为NO</p> </li></ul> 
<h3><a id="19cnidDBIDDBNAME_109"></a>在19c数据库上使用nid修改数据库DBID和DBNAME参数：</h3> 
<p>建议调整之前对数据库进行全量备份<br> 建议在调整DBNAE和DBID前对数据库进行全备，全备备份脚本示例：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@dkf ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /oracle/ods_backup/bak0.sh 
<span class="token comment">#!/bin/bash </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/oracle/product/19.3.0/dbhome_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>dkf006 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span> 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">BACK_DIR</span><span class="token operator">=</span><span class="token string">'/u01/app/rmanbak'</span> 
<span class="token function">mkdir</span> -p <span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span> 
//u01/app/oracle/product/19.3.0/dbhome_1/bin/rman <span class="token assign-left variable">log</span><span class="token operator">=</span><span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span>/rman_backup_<span class="token variable">$DATE</span>.log target / <span class="token operator">&lt;&lt;</span><span class="token string">EOF 
run{ 
    CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 3 DAYS; 
    CONFIGURE CONTROLFILE AUTOBACKUP ON; 
    CONFIGURE CONTROLFILE autobackup format for device type disk to '<span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span>/CONTROLFILE.%F'; 
    ALLOCATE CHANNEL disk1 DEVICE TYPE DISK FORMAT '<span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span>/full_%d_%T_%s.bak'; 
    ALLOCATE CHANNEL disk2 DEVICE TYPE DISK FORMAT '<span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span>/full_%d_%T_%s.bak'; 
    ALLOCATE CHANNEL disk3 DEVICE TYPE DISK FORMAT '<span class="token variable">$BACK_DIR</span>/<span class="token variable">$DATE</span>/full_%d_%T_%s.bak'; 
    SQL 'ALTER SYSTEM ARCHIVE LOG CURRENT'; 
    BACKUP  DATABASE SKIP INACCESSIBLE FILESPERSET 10 PLUS ARCHIVELOG FILESPERSET 20 DELETE ALL INPUT; 
    SQL 'ALTER SYSTEM ARCHIVE LOG CURRENT'; 
    RELEASE channel disk1; 
    RELEASE channel disk2; 
    RELEASE channel disk3; 
} 
EOF</span> 
<span class="token builtin class-name">exit</span> 
</code></pre> 
<h4><a id="1DBID_138"></a>1、只调整数据库的DBID</h4> 
<p>1、查询数据库的信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid<span class="token punctuation">,</span> name <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span> 
DBID        NAME 
<span class="token comment">---------- --------- </span>
<span class="token number">2651711443</span> dkf006 
</code></pre> 
<p>2、正常关闭数据库，并将数据库启动到mount状态</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">SHUTDOWN</span> IMMEDIATE 
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> STARTUP MOUNT 
</code></pre> 
<p>3、直接调用NID工具，连接数据库，不需要指定DBNAME</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@dkf ~<span class="token punctuation">]</span>$ nid <span class="token assign-left variable">target</span><span class="token operator">=</span>sys/oracle

DBNEWID: Release <span class="token number">19.0</span>.0.0.0 - Production on Thu Dec <span class="token number">22</span> <span class="token number">17</span>:29:24 <span class="token number">2022</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2019</span>, Oracle and/or its affiliates.  All rights reserved.

Connected to database DKF006 <span class="token punctuation">(</span>DBID<span class="token operator">=</span><span class="token number">2651711443</span><span class="token punctuation">)</span>

Connected to server version <span class="token number">19.3</span>.0

Control Files <span class="token keyword">in</span> database:
    +DATA/DKF006/CONTROLFILE/current.261.1101088595

Change database ID of database DKF006? <span class="token punctuation">(</span>Y/<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Y

Proceeding with operation
Changing database ID from <span class="token number">2651711443</span> to <span class="token number">2674719348</span>
    Control File +DATA/DKF006/CONTROLFILE/current.261.1101088595 - modified
    Datafile +DATA/DKF006/DATAFILE/system.257.110108848 - dbid changed
    Datafile +DATA/DKF006/DATAFILE/sysaux.258.110108852 - dbid changed
    Datafile +DATA/DKF006/DATAFILE/undotbs1.259.110108853 - dbid changed
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.266.110108879 - dbid changed
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.267.110108879 - dbid changed
    Datafile +DATA/DKF006/DATAFILE/users.260.110108853 - dbid changed
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.268.110108879 - dbid changed
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/system.272.110108943 - dbid changed
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/sysaux.273.110108943 - dbid changed
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/undotbs1.271.110108943 - dbid changed
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/users.275.110108945 - dbid changed
    Datafile +DATA/DKF006/DATAFILE/test.280.110739837 - dbid changed
    Datafile +DATA/DKF006/TEMPFILE/temp.265.110108860 - dbid changed
    Datafile +DATA/DKF006/DBCED86261CB7148E0550A002762E1A4/TEMPFILE/temp.269.110108882 - dbid changed
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/TEMPFILE/temp.274.110108943 - dbid changed
    Control File +DATA/DKF006/CONTROLFILE/current.261.1101088595 - dbid changed
    Instance shut down

Database ID <span class="token keyword">for</span> database DKF006 changed to <span class="token number">2674719348</span>.
All previous backups and archived redo logs <span class="token keyword">for</span> this database are unusable.
Database has been shutdown, <span class="token function">open</span> database with RESETLOGS option.
Succesfully changed database ID.
DBNEWID - Completed succesfully.
</code></pre> 
<p>4、 操作成功，打开数据库，会提示数据库需要用resetlogs打开：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> startup
ORACLE instance started<span class="token punctuation">.</span>

Total System <span class="token keyword">Global</span> Area <span class="token number">1241510080</span> bytes
<span class="token keyword">Fixed</span> Size                  <span class="token number">9134272</span> bytes
Variable Size             <span class="token number">402653184</span> bytes
<span class="token keyword">Database</span> Buffers          <span class="token number">822083584</span> bytes
Redo Buffers                <span class="token number">7639040</span> bytes
<span class="token keyword">Database</span> mounted<span class="token punctuation">.</span>
ORA<span class="token operator">-</span><span class="token number">01589</span>: must <span class="token keyword">use</span> RESETLOGS <span class="token operator">or</span> NORESETLOGS <span class="token keyword">option</span> <span class="token keyword">for</span> <span class="token keyword">database</span> <span class="token keyword">open</span>

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> 
</code></pre> 
<p>5、使用resetlogs打开数据库：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span> RESETLOGS<span class="token punctuation">;</span>

<span class="token keyword">Database</span> altered<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> 
</code></pre> 
<h4><a id="2DBNAME_228"></a>2、只调整数据库的DBNAME</h4> 
<p>1、查询数据库的信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid<span class="token punctuation">,</span> name <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span> 
DBID      NAME 
<span class="token comment">---------- --------- </span>
<span class="token number">2651711443</span> dkf006 
</code></pre> 
<p>2、正常关闭数据库，并将数据库启动到mount状态</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">SHUTDOWN</span> IMMEDIATE 
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> STARTUP MOUNT 
</code></pre> 
<p>3、使用 DBNEWID (NID) 工具更改数据库的DBNAME</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@dkf ~<span class="token punctuation">]</span>$ nid <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>sys/oracle <span class="token assign-left variable">DBNAME</span><span class="token operator">=</span>dkf007 <span class="token assign-left variable">SETNAME</span><span class="token operator">=</span>YES 

DBNEWID: Release <span class="token number">19.0</span>.0.0.0 - Production on Thu Dec <span class="token number">22</span> <span class="token number">18</span>:16:10 <span class="token number">2022</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2019</span>, Oracle and/or its affiliates.  All rights reserved.

Connected to database DKF006 <span class="token punctuation">(</span>DBID<span class="token operator">=</span><span class="token number">2674719348</span><span class="token punctuation">)</span>

Connected to server version <span class="token number">19.3</span>.0

Control Files <span class="token keyword">in</span> database:
    +DATA/DKF006/CONTROLFILE/current.261.1101088595

Change database name of database DKF006 to DKF007? <span class="token punctuation">(</span>Y/<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Y

Proceeding with operation
Changing database name from DKF006 to DKF007
    Control File +DATA/DKF006/CONTROLFILE/current.261.1101088595 - modified
    Datafile +DATA/DKF006/DATAFILE/system.257.110108848 - wrote new name
    Datafile +DATA/DKF006/DATAFILE/sysaux.258.110108852 - wrote new name
    Datafile +DATA/DKF006/DATAFILE/undotbs1.259.110108853 - wrote new name
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.266.110108879 - wrote new name
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.267.110108879 - wrote new name
    Datafile +DATA/DKF006/DATAFILE/users.260.110108853 - wrote new name
    Datafile +DATA/DKF006/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.268.110108879 - wrote new name
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/system.272.110108943 - wrote new name
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/sysaux.273.110108943 - wrote new name
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/undotbs1.271.110108943 - wrote new name
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/DATAFILE/users.275.110108945 - wrote new name
    Datafile +DATA/DKF006/DATAFILE/test.280.110739837 - wrote new name
    Datafile +DATA/DKF006/TEMPFILE/temp.265.110108860 - wrote new name
    Datafile +DATA/DKF006/DBCED86261CB7148E0550A002762E1A4/TEMPFILE/temp.269.110108882 - wrote new name
    Datafile +DATA/DKF006/DBCEFC8A3ACE81CBE0550A002762E1A4/TEMPFILE/temp.274.110108943 - wrote new name
    Control File +DATA/DKF006/CONTROLFILE/current.261.1101088595 - wrote new name
    Instance shut down

Database name changed to DKF007.
Modify parameter <span class="token function">file</span> and generate a new password <span class="token function">file</span> before restarting.
Succesfully changed database name.
DBNEWID - Completed succesfully.
</code></pre> 
<p>DBNEWID 在尝试对文件进行 I/O 之前在控制文件(不是数据文件)的头中执行验证。如果验证成功，则 DBNEWID 会提示确认，更改控制文件中的数据库名称，然后退出,DBNEWID 成功完成后，数据库会自动进行关闭。</p> 
<p>4、更新pfile文件并创建密码文件(如有必要)<br> 此实用程序不会更改 pfile 中的数据库名称，因此请手动更改 pfile 中的数据库名称 (DB_NAME) 并创建密码文件(如有必要)。</p> 
<p>如果操作失败，要恢复更改，请再次运行 DBNEWID 实用程序，指定 REVERT 关键字。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@dkfdg ~<span class="token punctuation">]</span>$ nid <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>sys/oracle  <span class="token assign-left variable">REVERT</span><span class="token operator">=</span>YES <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>rollback.log 
</code></pre> 
<h4><a id="3DBNAMEDBID_301"></a>3、同时更改数据库的DBNAME和DBID</h4> 
<p>1、查询数据库的信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid<span class="token punctuation">,</span> name <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span> 
DBID      NAME 
<span class="token comment">---------- --------- </span>
<span class="token number">2651711443</span> dkf006 
</code></pre> 
<p>2、正常关闭数据库，并将数据库启动到mount状态</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">SHUTDOWN</span> IMMEDIATE 
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> STARTUP MOUNT 
</code></pre> 
<p>3、使用 DBNEWID (NID) 工具更改数据库的DBNAME和DBID<br> 注意：DBNEWID 实用程序在尝试对文件进行 I/O 之前在数据文件和控制文件的标头中执行验证。如果验证成功，则 DBNEWID 会提示确认操作(除非您指定日志文件，在这种情况下它不会提示)，更改所有数据文件中的 DBID，数据库会进行关闭，然后退出。</p> 
<pre><code class="prism language-bash">$ nid <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>sys/password <span class="token assign-left variable">DBNAME</span><span class="token operator">=</span>dkf007 LOGFILE <span class="token operator">=</span>change_dbname.log 
</code></pre> 
<p>4、更新spfile文件并创建密码文件(如有必要)<br> 此实用程序不会更改 spfile 中的数据库名称，因此请手动更改 spfile 中的数据库名称 (DB_NAME) 并创建密码文件(如有必要)。</p> 
<h2><a id="Oracle_DBID_329"></a>三、Oracle 设置指定DBID</h2> 
<p>在一些特殊的情况下，我们可能需要修改数据库的DBID，有时候可能仅仅是修改控制文件的。<br> 从Oracle10g开始，Oracle在DBMS_BACKUP_RESTORE包中增加了几个PROCEDURE用来完成这个工作。</p> 
<h3><a id="DBID_333"></a>查询源数据库的DBID</h3> 
<p>用rman登陆数据库或者select dbid from v$database;。</p> 
<p>源DBID=392820279。</p> 
<p>登陆到目标数据库，查看DBID</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@MICHAEL ~<span class="token punctuation">]</span>$ rman target /

Recovery Manager: Release <span class="token number">10.2</span>.0.1.0 - Production on Tue Apr <span class="token number">14</span> 00:27:31 <span class="token number">2009</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2005</span>, Oracle. All rights reserved.

connected to target database: MICHAEL <span class="token punctuation">(</span>DBID<span class="token operator">=</span><span class="token number">393099115</span><span class="token punctuation">)</span>

RMAN<span class="token operator">&gt;</span>

或：

<span class="token punctuation">[</span>oracle@MICHAEL ~<span class="token punctuation">]</span>$ sqlplus  /  as sysdba

SQL*Plus: Release <span class="token number">10.2</span>.0.1.0 - Production on Tue Apr <span class="token number">14</span> 00:33:28 <span class="token number">2009</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2005</span>, Oracle. All rights reserved.

Connected to:

Oracle Database 10g Enterprise Edition Release <span class="token number">10.2</span>.0.1.0 - Production

With the Partitioning, OLAP and Data Mining options

SQL<span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid from <span class="token function">v</span><span class="token variable">$database</span><span class="token punctuation">;</span>

DBID

----------

<span class="token number">393099115</span>

</code></pre> 
<h3><a id="DBMS_BACKUP_RESTOREDBID_375"></a>使用DBMS_BACKUP_RESTORE设置DBID</h3> 
<p>如果你遇到数据库DBMS_BACKUP_RESTORE不存在的情况：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">DESC</span> DBMS_BACKUP_RESTORE
ERROR:
ORA<span class="token operator">-</span><span class="token number">04043</span>: 对象 DBMS_BACKUP_RESTORE 不存在 
</code></pre> 
<p>可以通过运行 $ORACLE_HOME/rdbms/admin/dbmsbkrs.sql 来创建！</p> 
<p>相关参数设置：</p> 
<blockquote> 
 <p>SQL&gt; exec dbms_backup_restore.nidbegin(‘michael’,‘MICHAEL’,‘392820279’,393099115,0,0,10)</p> 
 <p>Param 1：目标数据库的实例名，即dbname对应的VALUE。</p> 
 <p>Param 2：为更改后的实例名，必须大写。</p> 
 <p>Param 3：为更改后的DBID。</p> 
 <p>Param 4：为原来的DBID。</p> 
</blockquote> 
<h4><a id="1_400"></a>1、连接数据库</h4> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>oracle@MICHAEL ~<span class="token punctuation">]</span>$ sqlplus <span class="token string">"/ as sysdba"</span>
</code></pre> 
<h4><a id="2DBID_406"></a>2、修改DBID</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> parameter db_name

NAME        <span class="token keyword">TYPE</span>        <span class="token keyword">VALUE</span>
<span class="token comment">-------- ----------- ------------</span>
db_name    string      michael

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span> dbms_backup_restore<span class="token punctuation">.</span>nidbegin<span class="token punctuation">(</span><span class="token string">'michael'</span><span class="token punctuation">,</span><span class="token string">'MICHAEL'</span><span class="token punctuation">,</span><span class="token string">'392820279'</span><span class="token punctuation">,</span> <span class="token string">'393099115'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
PL<span class="token operator">/</span><span class="token keyword">SQL</span> <span class="token keyword">procedure</span> successfully completed<span class="token punctuation">.</span>
</code></pre> 
<p>此时查看发现DBID还是原来的，并未修改。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>

DBID
<span class="token comment">----------</span>
<span class="token number">393099115</span>
</code></pre> 
<p>接下来执行下面步骤来使修改生效：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> variable a number<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> variable b number<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> variable c number<span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span> dbms_backup_restore<span class="token punctuation">.</span>nidprocessdf<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>:a<span class="token punctuation">,</span>:b<span class="token punctuation">,</span>:c<span class="token punctuation">)</span><span class="token punctuation">;</span>
PL<span class="token operator">/</span><span class="token keyword">SQL</span> <span class="token keyword">procedure</span> successfully completed<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> :a

A
<span class="token comment">----------</span>
<span class="token number">0</span>


<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> :b

B
<span class="token comment">----------</span>
<span class="token number">1</span>


<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> :c

C
<span class="token comment">----------</span>
<span class="token number">1</span>


<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span> dbms_backup_restore<span class="token punctuation">.</span>nidprocesscf<span class="token punctuation">(</span>:a<span class="token punctuation">,</span>:b<span class="token punctuation">)</span><span class="token punctuation">;</span>
PL<span class="token operator">/</span><span class="token keyword">SQL</span> <span class="token keyword">procedure</span> successfully completed<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> :a

A
<span class="token comment">----------</span>
<span class="token number">1</span>


<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> :b

B
<span class="token comment">----------</span>
<span class="token number">1</span>


<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span> dbms_backup_restore<span class="token punctuation">.</span>nidend<span class="token punctuation">;</span>
PL<span class="token operator">/</span><span class="token keyword">SQL</span> <span class="token keyword">procedure</span> successfully completed<span class="token punctuation">.</span>


</code></pre> 
<h4><a id="3_481"></a>3、验证修改结果</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> dbid <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>

DBID
<span class="token comment">----------</span>
<span class="token number">392820279</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c7621d57aa822f129fb89eeec52dcda/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单例模式线程安全问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b65b93a32807890a11f0187482ced230/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PostgreSQL 修改数据存储路径</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>