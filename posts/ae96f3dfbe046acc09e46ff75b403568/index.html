<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序语音播放功能的实现 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序语音播放功能的实现" />
<meta property="og:description" content="1.想要实现微信的语音播放需要在微信公众号后台下载微信同声传译插件，可以去微信服务平台搜索此插件并下载，指定对应的小程序号就行了。
2.下载完在 微信小程序后台--设置--第三方设置-- 插件管理-- 进入 微信同声传译详情 复制插件AppID 到 app.json 进行配置：
app.json：
&#34;plugins&#34;: { &#34;WechatSI&#34;: { &#34;version&#34;: &#34;0.3.5&#34;, &#34;provider&#34;: &#34;wx069ba97219f66d99&#34; } } wxml:
&lt;view class=&#34;wrap&#34;&gt; &lt;textarea class=&#39;content&#39; placeholder=&#39;请输入内容&#39; value=&#39;{{content}}&#39; bindinput=&#39;content&#39;&gt;&lt;/textarea&gt; &lt;view class=&#39;box&#39;&gt; &lt;button class=&#34;btn start&#34; size=&#34;mini&#34; bindtap=&#39;start&#39;&gt;开始&lt;/button&gt; &lt;button class=&#34;btn&#34; size=&#34;mini&#34; bindtap=&#39;end&#39;&gt;结束&lt;/button&gt; &lt;/view&gt; &lt;/view&gt; js
//引入插件：微信同声传译 const plugin = requirePlugin(&#39;WechatSI&#39;); //创建内部 audio 上下文 InnerAudioContext 对象。 const innerAudioContext = wx.createInnerAudioContext(); Page({ data: { content: &#39;&#39;,//内容 src:&#39;&#39;, // }, onReady(e) { innerAudioContext.onError(function (res) { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ae96f3dfbe046acc09e46ff75b403568/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-21T17:25:34+08:00" />
<meta property="article:modified_time" content="2022-05-21T17:25:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序语音播放功能的实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3a/ec/kNTveroe_o.png"></p> 
<p></p> 
<p>1.想要实现微信的语音播放需要在微信公众号后台下载微信同声传译插件，可以去微信服务平台搜索此插件并下载，指定对应的小程序号就行了。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8b/f7/c83wnruP_o.png"></p> 
<p></p> 
<p>2.下载完在 微信小程序后台--设置--第三方设置-- 插件管理-- 进入 微信同声传译详情 复制插件AppID 到 app.json 进行配置：</p> 
<p>app.json：</p> 
<pre><code class="language-javascript">"plugins": {
        "WechatSI": {
          "version": "0.3.5",
          "provider": "wx069ba97219f66d99"
         }
 }</code></pre> 
<p>wxml:</p> 
<pre><code class="language-javascript">&lt;view class="wrap"&gt;
    &lt;textarea class='content' placeholder='请输入内容' value='{<!-- -->{content}}' bindinput='content'&gt;&lt;/textarea&gt;
    &lt;view class='box'&gt;
        &lt;button class="btn start" size="mini" bindtap='start'&gt;开始&lt;/button&gt;
        &lt;button class="btn" size="mini" bindtap='end'&gt;结束&lt;/button&gt;
    &lt;/view&gt;
&lt;/view&gt;</code></pre> 
<p>js</p> 
<pre><code class="language-javascript">//引入插件：微信同声传译
const plugin = requirePlugin('WechatSI');
//创建内部 audio 上下文 InnerAudioContext 对象。
const innerAudioContext = wx.createInnerAudioContext();
Page({

  data: {
    content: '',//内容
    src:'', //
  },
  onReady(e) {
    innerAudioContext.onError(function (res) {
      console.log(res);
      wx.showToast({
        title: '语音播放失败',
        icon: 'none',
      })
    }) 
  },
  // 手动输入内容
  content(e) {
    //   console.log(e);
    this.setData({
      content: e.detail.value,
    })
  },
  // 文字转语音
  start (e) {
    var that = this;
    var content = this.data.content;
    plugin.textToSpeech({
      lang: "zh_CN",
      tts: true,
      content: content,
      success: function (res) {
        console.log(res);
        console.log("succ tts", res.filename);
        that.setData({
          src: res.filename
        })
        that.yuyinPlay();
 
      },
      fail: function (res) {
        console.log("fail tts", res)
      }
    })
  },
  
  //播放语音
  yuyinPlay(e) {
    if (this.data.src == '') {
      console.log(暂无语音);
      return;
    }
    // console.log("正在播放");
    innerAudioContext.autoplay = true
    innerAudioContext.src = this.data.src //设置音频地址
    innerAudioContext.play(); //播放音频
  },
 
  // 结束语音
  end (e) {
    innerAudioContext.pause();//暂停音频
  },
  
})</code></pre> 
<p>wxss:</p> 
<pre><code class="language-css">.wrap {
    margin-top:300rpx;
    height: 200px;
  }
   
  .content {
    border: 1px solid #ccc;
    margin: 0 auto;
    padding: 10rpx 10rpx 70rpx;
  }
  .btn {
    width: 100px;
    height: 70rpx;
    border: 1px solid #eee;
    background: #fff;
    color: #606267;
    margin-left: 100px;
  }
  .box{
      width: 300px;
      /* border: 1px solid red; */
  }
  .start{
    margin-left: 40px;
  }</code></pre> 
<p><strong>PS:长文本处理，由于语音播放文本限制为：1000字节。需要进行分段处理</strong></p> 
<pre><code class="language-javascript">// 点击朗读
  readlongText() {
    //同声传译一次最多1000字节,长文本按300字进行截断,然后按照朗读速度估算300字的时间,延迟下一次读取,正常300字/1分17秒
    let arrText = this.data.content.replace(/\r/g, ",").replace(/\n/g, ",").replace(/\s+/g, ",").replace(/#/g, ",");
    console.log(arrText, arrText.length) //获取全文+总数字
    //     arrText= arrText.replace(/[`:_.~!@#$%^&amp;*() \+ =&lt;&gt;?"{}|, \/ ;' \\ [ \] ·~！@#￥%……&amp;*（）—— \+ ={}|《》？：“”【】、；‘’，。、]/g,
    // ''); //去除标点符号
    if (arrText.length &lt; 300) {
      // 总数字小于300，直接转为语音
      this.read(arrText)
    } else {
      // 总数字大于300，拆分成多个段落
      const num = Math.ceil(arrText.length / 300)
      const time = 75
      for (let i = 0; i &lt; num; i++) {
        const text = arrText.substr(0 + i * 300, 300) //全文分成多个300字的段落
        console.log(text)
        setTimeout(() =&gt; {
          this.read(text)
        }, time * 1000 * i); //每隔1分17秒读一段
      }

    }
  },
  // 文字转语音
  read(content) {
    var that = this;
    plugin.textToSpeech({
      lang: "zh_CN",
      tts: true,
      content: content,
      success: function (res) {
        // console.log(res);
        // console.log("succ tts", res.filename);
        that.setData({
          src: res.filename
        })
        that.yuyinPlay();

      },
      fail: function (res) {
        console.log("fail tts", res)
      }
    })
  },

  //播放语音
  yuyinPlay(e) {
    if (this.data.src == '') {
      console.log(暂无语音);
      return;
    }
    // console.log("正在播放");
    innerAudioContext.autoplay = true
    innerAudioContext.src = this.data.src //设置音频地址
    innerAudioContext.play(); //播放音频
  },

  // 结束语音
  end(e) {
    innerAudioContext.pause(); //暂停音频
  },</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc67a01ce5707ea459d03f38ea4ccfdd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中国地图和世界地图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/199b5d4d44b8f785836265ff4d67610f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">联想一面面经</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>