<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>动态分区式内存管理（完整代码） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="动态分区式内存管理（完整代码）" />
<meta property="og:description" content="操作系统实验导航 实验一：银行家算法 https://blog.csdn.net/weixin_46291251/article/details/115384510
实验二：多级队列调度和多级反馈队列调度算法 https://blog.csdn.net/weixin_46291251/article/details/115530582
实验三：动态分区式内存管理 https://blog.csdn.net/weixin_46291251/article/details/115772341
实验四：Linux下多进程通信 https://blog.csdn.net/weixin_46291251/article/details/116274665
实验五：进程通信的三种方式 https://blog.csdn.net/weixin_46291251/article/details/116301250
实验六：Linux文件系统实验 https://blog.csdn.net/weixin_46291251/article/details/116423798
实验七：自制简单U盘引导程序 https://blog.csdn.net/weixin_46291251/article/details/116427629
实验八：磁盘调度算法 https://blog.csdn.net/weixin_46291251/article/details/116431907
实验九：请求分页系统中的置换算法 https://blog.csdn.net/weixin_46291251/article/details/116443021
学习笔记：操作系统复习笔记 https://blog.csdn.net/weixin_46291251/article/details/117086851
背景知识： 关于内存管理的几种方式： 固定分区： 原理：又称定长分区或静态分区模式，是满足多道程序设计需要的最简单的存储管理技术。基本思想：给进入主存的用户作业划分一块连续存储区域，把作业装入该连续存储区域，若有多个作业装入主存，则它们可并发执行。
使用大小相等的固定分区有两个难点：程序可能太大而不能放到一个分区中，内存的，利用率很低。由于被装入的数据块小于分区大小，从而导致分区内部有浪费现象，成为“内部碎片”。对与大小不等的分区策略，最简单的方法就是把每个进程分配到能够容纳它的最小分区中。
目前已经基本上没有什么场合使用固定分区。
优势：实现简单，只需要极少的操作系统开销
缺点：有内部碎片，对内存的使用不充分，活动进程的最大数目是固定的。
可变分区： 可变分区存储管理不是预先把内存中的用户区域划分成若干固定分区，而是在作业要求装入内存时，根据用户作业的大小和当时内存空间使用情况决定是否为该作业分配一个分区。因此分区大小不是预先固定的，而是按作业需求量来划分的；分区的个数和位置也不是预先确定的。它有效地克服了固定分区方式中，由于分区内部剩余内存空置造成浪费的问题。
可变分区方式常用的内存分配算法有以下几种：
1、 最先适应分配算法
每次分配总是顺序查找空闲区表，找到能满足长度要求的空闲区就分配。优点是实现简单，缺点是可能将大的空闲区分割成许多小的空闲区，形成许多不连续的“碎片”。碎片长度可能不能满足作业要求，降低了内存利用率。
改进方法，可把空闲区按地址顺序从小到大登记在空闲区表中，有利于大作业。问题是归还空区时须按地址插入表中适当位置。
2、最优适应分配算法
按作业要求从所有空闲区中挑选一个能满足要求的最小空闲区，这样保证不去分割一个更大的区域，使装入大作业时比较容易得到满足。实现办法：将空闲区按长度以递增次序登记在表中，分配时按空闲区表顺序查找即可。缺点是可能碎片更小而无法使用。回收时也要按长度扦入。
3、最坏适应分配算法
这种算法总是挑选一个最大的空闲区分割一部分给作业使用，使剩下部分不致太小，仍可供分配使用。实现办法：空闲区表中的登记项按空闲区长度递减顺序排列，按序查找分配。
题目描述：动态分区式存贮区管理 设计一个动态分区式存贮区管理程序，要求支持不同的放置策略。如首次、最佳、最坏。 说明： （1）分区描述器rd如下: flagsizenext 要求空闲区队列按链表组织。 主存大小假设为maxsize（单位为节=rd的大小）。 （2）主程序结构如下： 输入放置策略 申请一块内存作为主存 循环处理用户的请求（包括申请、释放） 需设计两个函数处理用户请求：
申请函数 Addr=Request(size)释放函数 Release(addr） （3）数据实例：maxsize=512 J1申请162，J2申请64，J3申请120，J4申请86，J1完成， J3完成，J5申请72，J6申请100，J2完成，J7申请36， J8申请60，J4完成， J9申请110，J10申请42。 备注：
（a）所有大小其单位为节（1节=rd的大小）（b）作业申请n节,实际分配的分区大小应为n&#43;1节。 其中一节作为分区描述器，其他n节提供给作业。（c）已分配区放在高地址处。（d）合并时应考虑四种情况： 假设回收区为r,上邻为f1（f1需搜索自由主存队列）,下邻为f2（f2可直接计算）
A)f1空闲，f2已分配；
B)f1已分配，f2空闲；
C)f1空闲，f2空闲；
D)f1已分配，f2已分配； 设计思路： 向系统申请内存：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/76eae8ac386bba96b7d5e1af379f5abb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-15T00:17:31+08:00" />
<meta property="article:modified_time" content="2022-03-15T00:17:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">动态分区式内存管理（完整代码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><kbd> <mark>操作系统实验导航</mark> </kbd><br> <mark>实验一：银行家算法</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/115384510"> https://blog.csdn.net/weixin_46291251/article/details/115384510</a><br> <mark>实验二：多级队列调度和多级反馈队列调度算法</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/115530582"> https://blog.csdn.net/weixin_46291251/article/details/115530582</a><br> <mark>实验三：动态分区式内存管理</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/115772341"> https://blog.csdn.net/weixin_46291251/article/details/115772341</a><br> <mark>实验四：Linux下多进程通信</mark> <a href="https://blog.csdn.net/weixin_46291251/article/details/116274665">https://blog.csdn.net/weixin_46291251/article/details/116274665</a><br> <mark>实验五：进程通信的三种方式</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/116301250"> https://blog.csdn.net/weixin_46291251/article/details/116301250</a><br> <mark>实验六：Linux文件系统实验</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/116423798"> https://blog.csdn.net/weixin_46291251/article/details/116423798</a><br> <mark>实验七：自制简单U盘引导程序</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/116427629"> https://blog.csdn.net/weixin_46291251/article/details/116427629</a><br> <mark>实验八：磁盘调度算法</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/116431907"> https://blog.csdn.net/weixin_46291251/article/details/116431907</a><br> <mark>实验九：请求分页系统中的置换算法</mark> <a href="https://blog.csdn.net/weixin_46291251/article/details/116443021">https://blog.csdn.net/weixin_46291251/article/details/116443021</a><br> <mark>学习笔记：操作系统复习笔记</mark><a href="https://blog.csdn.net/weixin_46291251/article/details/117086851"> https://blog.csdn.net/weixin_46291251/article/details/117086851</a></p> 
<h3><a id="_14"></a>背景知识：</h3> 
<h6><a id="_15"></a>关于内存管理的几种方式：</h6> 
<h5><a id="_16"></a>固定分区：</h5> 
<p>原理：又称定长分区或静态分区模式，是满足多道程序设计需要的最简单的存储管理技术。基本思想：给进入主存的用户作业划分一块连续存储区域，把作业装入该连续存储区域，若有多个作业装入主存，则它们可并发执行。</p> 
<p>使用大小相等的固定分区有两个难点：程序可能太大而不能放到一个分区中，内存的，利用率很低。由于被装入的数据块小于分区大小，从而导致分区内部有浪费现象，成为“内部碎片”。对与大小不等的分区策略，最简单的方法就是把每个进程分配到能够容纳它的最小分区中。</p> 
<p>目前已经基本上没有什么场合使用固定分区。</p> 
<p>优势：实现简单，只需要极少的操作系统开销</p> 
<p>缺点：有内部碎片，对内存的使用不充分，活动进程的最大数目是固定的。</p> 
<h5><a id="_29"></a>可变分区：</h5> 
<p>可变分区存储管理不是预先把内存中的用户区域划分成若干固定分区，而是在作业要求装入内存时，根据用户作业的大小和当时内存空间使用情况决定是否为该作业分配一个分区。因此分区大小不是预先固定的，而是按作业需求量来划分的；分区的个数和位置也不是预先确定的。它有效地克服了固定分区方式中，由于分区内部剩余内存空置造成浪费的问题。<br> 可变分区方式常用的内存分配算法有以下几种：</p> 
<ul><li> <p>1、 最先适应分配算法<br> 　　每次分配总是顺序查找空闲区表，找到能满足长度要求的空闲区就分配。优点是实现简单，缺点是可能将大的空闲区分割成许多小的空闲区，形成许多不连续的“碎片”。碎片长度可能不能满足作业要求，降低了内存利用率。<br> 　　改进方法，可把空闲区按地址顺序从小到大登记在空闲区表中，有利于大作业。问题是归还空区时须按地址插入表中适当位置。</p> </li><li> <p>2、最优适应分配算法<br> 　　按作业要求从所有空闲区中挑选一个能满足要求的最小空闲区，这样保证不去分割一个更大的区域，使装入大作业时比较容易得到满足。实现办法：将空闲区按长度以递增次序登记在表中，分配时按空闲区表顺序查找即可。缺点是可能碎片更小而无法使用。回收时也要按长度扦入。</p> </li><li> <p>3、最坏适应分配算法<br> 　　这种算法总是挑选一个最大的空闲区分割一部分给作业使用，使剩下部分不致太小，仍可供分配使用。实现办法：空闲区表中的登记项按空闲区长度递减顺序排列，按序查找分配。</p> </li></ul> 
<h3><a id="_42"></a>题目描述：动态分区式存贮区管理</h3> 
<h5><a id="_43"></a>设计一个动态分区式存贮区管理程序，要求支持不同的放置策略。如首次、最佳、最坏。</h5> 
<h5><a id="_44"></a>说明：</h5> 
<h6><a id="1rd_45"></a>（1）分区描述器rd如下:</h6> 
<table><thead><tr><th>flag</th><th>size</th><th>next</th></tr></thead><tbody></tbody></table> 
<pre><code>  要求空闲区队列按链表组织。
  主存大小假设为maxsize（单位为节=rd的大小）。 
</code></pre> 
<h6><a id="2_52"></a>（2）主程序结构如下：</h6> 
<pre><code>  输入放置策略     
  申请一块内存作为主存
  循环处理用户的请求（包括申请、释放）
</code></pre> 
<p>需设计两个函数处理用户请求：</p> 
<ul><li>申请函数 Addr=Request(size)</li><li>释放函数 Release(addr）</li></ul> 
<h6><a id="3maxsize512_59"></a>（3）数据实例：maxsize=512</h6> 
<pre><code>    J1申请162，J2申请64，J3申请120，J4申请86，J1完成，
    J3完成，J5申请72，J6申请100，J2完成，J7申请36，
    J8申请60，J4完成， J9申请110，J10申请42。
</code></pre> 
<p>备注：</p> 
<ul><li>（a）所有大小其单位为节（1节=rd的大小）</li><li>（b）作业申请n节,实际分配的分区大小应为n+1节。 其中一节作为分区描述器，其他n节提供给作业。</li><li>（c）已分配区放在高地址处。</li><li>（d）合并时应考虑四种情况： 假设回收区为r,上邻为f1（f1需搜索自由主存队列）,下邻为f2（f2可直接计算）<br> A)f1空闲，f2已分配；<br> B)f1已分配，f2空闲；<br> C)f1空闲，f2空闲；<br> D)f1已分配，f2已分配；</li></ul> 
<h3><a id="_73"></a>设计思路：</h3> 
<ul><li> <p>向系统申请内存：<br> 需要申请的内存单元的个数：totalNum<br> 每个内存单元的大小：sizeof(rd)<br> 程序实际向系统申请到达大小：maxsize<br> 即：<br> const int totalNum = 512;//需要申请的块数<br> const int maxsize = totalNum * sizeof(rd);//实际需要申请的大小<br> rd* MainHead = (rd*)malloc(maxsize);//申请到的资源</p> </li><li> <p>进程向程序申请内存Request：<br> 原型：rd* Request(int need,int choice);<br> 参数：need表示需要申请的大小，choice表示分配时采取的方法。<br> 返回值：返回一个指针，指向申请到的空间的首地址，若为空则表示申请失败。</p> </li><li> <p>进程释放内存Release：<br> 原型：bool Release(rd* r);<br> 参数：r表示待释放内存的首地址<br> 返回值：返回1表示释放成功，0表示失败</p> </li><li> <p>可视化展示内存使用情况：<br> 每一次读取用户的请求后，程序均输出当前的内存使用情况，方便用户查看，包括空闲队列的情况、已用队列的情况、内存总体分配情况。</p> </li></ul> 
<h3><a id="_94"></a>数据结构：</h3> 
<ul><li>分区描述器：<br> 设计一个结构体rd用来表示分区描述器，其包含：<br> Flag：分配标志，空闲为0，不为0则表示进程编号<br> Size：分区大小，分区可用字数+分区描述器大小<br> *next：指向下一个同类型的区域</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> rd <span class="token punctuation">{<!-- --></span><span class="token comment">//分区描述器</span>
    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//分配标志，空闲为0，不为0则表示进程编号</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//分区大小，分区可用字数+分区描述器大小</span>
    rd<span class="token operator">*</span> next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>   <span class="token comment">//指向下一个同类型的区域</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>空闲内存队列和已用内存队列：<br> 两个队列都通过链表的形式组织<br> 分别为其设置头节点Free和Used：</li></ul> 
<pre><code class="prism language-cpp">rd<span class="token operator">*</span> Free <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">,</span> <span class="token operator">*</span> Used <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">;</span><span class="token comment">//分别用来存空闲队列和已占用队列</span>
</code></pre> 
<h3><a id="_117"></a>算法设计</h3> 
<h6><a id="_119"></a>三种算法：</h6> 
<pre><code>  首次：按物理地址的顺序排列，优先地址最小的
  最佳：按照空闲容量递增排列，优先最小的
  最坏：按照空闲容量递减排列，优先最大的
</code></pre> 
<p>三种算法在分配和释放的操作上没有区别。<br> 区别在于：空闲队列变化以后需要排序，该排序对应的排序算法不同（依据是以上原理）。但在本程序中不使用排序算法，而是每次都遍历搜索满足条件的最值。</p> 
<h6><a id="Request_126"></a>进程向程序申请内存Request：</h6> 
<p>无论是利用上述的哪种方法，都需要从已经给定的头节点开始遍历，找到&gt;=需求的一块空间。<br> 找到满足上述三种算法中最优的内存块：找到内存大小比need大的内存块中地址最小的、内存最小的、内存最大的。<br> 上述最优的内存块分两种情况：</p> 
<ul><li>内存=need:这种情况只需要在free队列删除该节点，并将其加入used队列即可。</li><li>内存&gt;need:这种情况需要将原节点信息中的size减小need大小然后在used队列中插入一个新节点。</li></ul> 
<h6><a id="Release_133"></a>进程释放内存Release：</h6> 
<p>释放进程时需要分以下四种情况：假设三块连续内存分别为f1、r、f2<br> 上邻为f1（f1需搜索自由主存队列）,下邻为f2（f2可直接计算）</p> 
<ul><li>A)f1空闲，f2已分配； //f和f1合并，修改表项f1，数量不变</li><li>B)f1已分配，f2空闲； //f和f2合并，修改表项f2，数量不变</li><li>C)f1空闲，f2空闲； //f1 f f2合并，修改表项f1，删除f2</li><li>D)f1已分配，f2已分配； //增加空闲表项f</li></ul> 
<p>这里设计两个信号量bool f1_is_free = 1, f2_is_free = 1;分别用来判断f1、f2是否已分配，然后程序遍历两个队列正确修改信号量的值后，程序根据这两个值分四种情况对两个队列做出相应的修改即可。</p> 
<h6><a id="_142"></a>可视化展示内存使用情况：</h6> 
<p>首先遍历输出两个队列的以下信息：</p> 
<ul><li>1.头节点相对于总内存起点的偏移量</li><li>2.该段内存实际大小</li></ul> 
<p>由于本程序中插入队列元素时没有对其排序，上述输出不直观，所以继续采用以下方法输出：<br> 由内存的起点开始向后同时遍历两个队列，每次找到与之最相邻的那个内存块。<br> 找到内存块后由flag判断其是否已占用，由size判断这块内存的大小。<br> 输出头节点相对于总内存起点的偏移量然后输出不同数量的符号表示这块空间<br> 原则：未占用用‘-’表示，已占用用‘+’表示<br> 输出的数量（长度）与内存大小成正比。<br> 输出示例：</p> 
<p><img src="https://images2.imgbox.com/13/a0/UDEXhBM3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_159"></a>整体实现的代码：</h3> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">struct</span> rd <span class="token punctuation">{<!-- --></span><span class="token comment">//分区描述器</span>
    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//分配标志，空闲为0，//不为0则表示进程编号</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//分区大小，分区可用字数+分区描述器大小</span>
    rd<span class="token operator">*</span> next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>   <span class="token comment">//对空闲区：指向下一个空闲分区，对已分配区：此项为零。</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
rd<span class="token operator">*</span> Free <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">,</span> <span class="token operator">*</span> Used <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">;</span><span class="token comment">//分别用来存空闲队列和已占用队列</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> totalNum <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span><span class="token comment">//需要申请的块数</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> maxsize <span class="token operator">=</span> <span class="token number">512</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>rd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实际需要申请的大小</span>
rd<span class="token operator">*</span> MainHead <span class="token operator">=</span> <span class="token punctuation">(</span>rd<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>maxsize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请到的资源</span>


rd<span class="token operator">*</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token keyword">int</span> need<span class="token punctuation">,</span><span class="token keyword">int</span> choice<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//申请地址的函数，返回申请到的地址，为NULL则无法申请。</span>
    <span class="token comment">//size为要申请的danwei大小的个数，实际大小为size* sizeof(rd);   </span>
    <span class="token keyword">int</span> tem<span class="token punctuation">;</span>
    rd<span class="token operator">*</span> Ans <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    rd<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">*</span> prep <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">,</span> <span class="token operator">*</span> preAns <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//首次算法:按物理地址的顺序排列，优先地址最小的</span>
        tem <span class="token operator">=</span> INT_MAX<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep <span class="token operator">=</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p <span class="token operator">&lt;</span> tem <span class="token operator">&amp;&amp;</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">&gt;</span> need<span class="token punctuation">)</span>
                tem <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p<span class="token punctuation">,</span> Ans <span class="token operator">=</span> p<span class="token punctuation">,</span> preAns <span class="token operator">=</span> prep<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Ans <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//最佳算法按:照空闲容量递增排列，优先最小的</span>
        tem <span class="token operator">=</span> totalNum<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p<span class="token operator">=</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep<span class="token operator">=</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">&lt;</span> tem <span class="token operator">&amp;&amp;</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">&gt;</span> need<span class="token punctuation">)</span>
                tem <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">,</span> Ans <span class="token operator">=</span> p<span class="token punctuation">,</span> preAns <span class="token operator">=</span> prep<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Ans <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//最坏算法：按照空闲容量递减排列，优先最大的</span>
        tem <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">,</span> prep <span class="token operator">=</span> prep<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">&gt;</span> tem<span class="token punctuation">)</span> 
                tem <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">,</span> Ans <span class="token operator">=</span> p<span class="token punctuation">,</span> preAns <span class="token operator">=</span> prep<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tem <span class="token operator">&lt;</span> need<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//修改free队列</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Ans<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">==</span> need<span class="token punctuation">)</span>
        preAns<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> Ans<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span><span class="token comment">//删除表项</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        Ans<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">-</span><span class="token operator">=</span> need<span class="token punctuation">;</span>
        <span class="token comment">//Ans =(Ans+Ans-&gt;size * sizeof(rd));//后一半划分出去</span>

 <span class="token comment">//       cout&lt;&lt;"当前分配地址距离开始" &lt;&lt; Ans - MainHead &lt;&lt; endl;</span>
        Ans <span class="token operator">+</span><span class="token operator">=</span> Ans<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Ans<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    Ans<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">=</span> need<span class="token punctuation">;</span>

    <span class="token comment">//修改used队列</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Used<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Used<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> Ans<span class="token punctuation">;</span>
        Ans<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        Ans<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
        Used<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> Ans<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> Ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token function">Release</span><span class="token punctuation">(</span>rd<span class="token operator">*</span> r<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//释放所给出的分区的地址，返回1表示正常释放</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"该空间未使用，无法释放"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    rd<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    rd<span class="token operator">*</span> f1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">*</span> f2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
   
    <span class="token comment">//先判断used</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> r<span class="token punctuation">)</span>
            f1 <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> p<span class="token punctuation">)</span>
            f2 <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//再判断free</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">+</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">==</span> r<span class="token punctuation">)</span>
            f1 <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token operator">+</span>r<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">==</span> p<span class="token punctuation">)</span>
            f2 <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//修改used队列</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> r<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>




    <span class="token keyword">bool</span> f1_is_free <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> f2_is_free <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>f1<span class="token operator">-</span><span class="token operator">&gt;</span>flag<span class="token punctuation">)</span>
        f1_is_free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>f2 <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>flag<span class="token punctuation">)</span>
        f2_is_free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//修改free队列</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>f1_is_free <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>f2_is_free<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>     <span class="token comment">// A)f1空闲，f2已分配；     //f和f1合并，修改表项f1，数量不变</span>
        f1<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> r<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
        f1<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">+</span><span class="token operator">=</span> r<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>f1_is_free <span class="token operator">&amp;&amp;</span> f2_is_free<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// B)f1已分配，f2空闲；     //f和f2合并，修改表项f2，数量不变</span>
        r<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
        r<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        r<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">+</span><span class="token operator">=</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span><span class="token comment">//找到f2的前驱</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> f2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> r<span class="token punctuation">;</span><span class="token comment">//后继修改为r</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f1_is_free <span class="token operator">&amp;&amp;</span> f2_is_free<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// C)f1空闲，f2空闲；       //f1 f f2合并，修改表项f1，删除f2</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span><span class="token comment">//找到f1的前驱</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> f1<span class="token punctuation">)</span> 
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span><span class="token comment">//防止构成环路</span>
            f1<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
        f1<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span>f2<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token operator">+</span>r<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span><span class="token comment">//找到f2的前驱</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> f2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                p<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> f2<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span><span class="token comment">//后继修改为r</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>f1_is_free <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>f2_is_free<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// D)f1已分配，f2已分配；   //增加空闲表项f</span>
        r<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Free<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Free<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> r<span class="token punctuation">;</span>
            r<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            r<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
            Free<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> r<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">show_detail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//展示内存的使用情况</span>
    rd<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    rd<span class="token operator">*</span> Cur <span class="token operator">=</span> MainHead<span class="token punctuation">;</span>

    <span class="token comment">//先判断used</span>
    cout <span class="token operator">&lt;&lt;</span><span class="token string">"Used:--"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> p <span class="token operator">-</span> MainHead <span class="token operator">&lt;&lt;</span><span class="token string">"_"</span><span class="token operator">&lt;&lt;</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token operator">&lt;&lt;</span> <span class="token string">"---&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token comment">//再判断free</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Free:--"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> p <span class="token operator">-</span> MainHead <span class="token operator">&lt;&lt;</span> <span class="token string">"_"</span> <span class="token operator">&lt;&lt;</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">&lt;&lt;</span> <span class="token string">"---&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword">do</span><span class="token punctuation">{<!-- --></span><span class="token comment">//直到当前是最后一块为止</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Free<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Cur <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Cur <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token comment">//到此就找到了上一次的Cur后跟的块（free或者used）</span>
        <span class="token comment">//输出可视化</span>
        <span class="token comment">//512个字节，共分为26段，已用用+++++表示，未用用======表示，每段用三个符号表示</span>
        string u <span class="token operator">=</span> <span class="token string">"+++"</span><span class="token punctuation">;</span>
        string f <span class="token operator">=</span> <span class="token string">"---"</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Cur<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//为free</span>
          <span class="token comment">//  cout &lt;&lt; Cur-&gt;size;</span>
            cout <span class="token operator">&lt;&lt;</span> Cur <span class="token operator">-</span> MainHead<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>Cur<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    cout <span class="token operator">&lt;&lt;</span> f<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Cur<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//为free</span>
            cout <span class="token operator">&lt;&lt;</span> Cur <span class="token operator">-</span> MainHead<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>Cur<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                cout <span class="token operator">&lt;&lt;</span> u<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Cur <span class="token operator">+</span><span class="token operator">=</span> Cur<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Cur <span class="token operator">-</span> MainHead <span class="token punctuation">)</span>  <span class="token operator">&lt;</span> totalNum<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"|||"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>



 <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"——————————请输入放置策略————————"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"—— 首次：1     最佳：2    最坏：3    退出：0——"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"—————————————————————————"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">int</span> method <span class="token punctuation">;</span>
        cin <span class="token operator">&gt;&gt;</span> method<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>method<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"——————————Thanks!————————"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> method <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> method <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"您的输入有误，请重新输入:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
            

        MainHead <span class="token operator">=</span> <span class="token punctuation">(</span>rd<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>maxsize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请到的资源</span>
        Free <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">,</span> Used <span class="token operator">=</span> <span class="token keyword">new</span> rd<span class="token punctuation">;</span><span class="token comment">//分别用来存空闲队列和已占用队列</span>
       
        MainHead<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        rd<span class="token operator">*</span> fir <span class="token operator">=</span> MainHead<span class="token punctuation">;</span>fir<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> fir<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  fir<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">=</span> totalNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        Free<span class="token operator">-</span><span class="token operator">&gt;</span>next <span class="token operator">=</span> fir<span class="token punctuation">;</span>

        <span class="token keyword">char</span> operat<span class="token punctuation">;</span>
        <span class="token keyword">int</span> id<span class="token punctuation">,</span> need<span class="token punctuation">;</span>
        fstream In<span class="token punctuation">;</span>
        In<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"请求.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>In<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"文件打开失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"初始状态："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token function">show_detail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//展示初始状态</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>In<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            In <span class="token operator">&gt;&gt;</span> operat<span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>operat <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                In <span class="token operator">&gt;&gt;</span> id <span class="token operator">&gt;&gt;</span> need<span class="token punctuation">;</span>
                rd<span class="token operator">*</span> req <span class="token operator">=</span> <span class="token function">Request</span><span class="token punctuation">(</span>need<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//req为申请到的地址</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>req <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"     失败___"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">" +++ "</span> <span class="token operator">&lt;&lt;</span> need <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"     成功___"</span> <span class="token operator">&lt;&lt;</span>id<span class="token operator">&lt;&lt;</span> <span class="token string">" +++ "</span> <span class="token operator">&lt;&lt;</span> need <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                req<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">=</span> id<span class="token punctuation">;</span>
                req<span class="token operator">-</span><span class="token operator">&gt;</span>size <span class="token operator">=</span> need<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>operat <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                In <span class="token operator">&gt;&gt;</span> id <span class="token punctuation">;</span>
                rd<span class="token operator">*</span> rel <span class="token operator">=</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> rel <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> rel<span class="token operator">=</span>rel<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>rel<span class="token operator">-</span><span class="token operator">&gt;</span>flag <span class="token operator">==</span> id<span class="token punctuation">)</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> rel_ans <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> rel_size <span class="token operator">=</span> rel<span class="token operator">-</span><span class="token operator">&gt;</span>size<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rel <span class="token operator">==</span> Used<span class="token operator">-</span><span class="token operator">&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"进程"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">"没有正在使用的空间"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> 
                    rel_ans <span class="token operator">=</span> <span class="token function">Release</span><span class="token punctuation">(</span>rel<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>rel_ans <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"进程___"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">"无法释放"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> 
                    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"     成功___"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">" --- "</span> <span class="token operator">&lt;&lt;</span> rel_size <span class="token operator">&lt;&lt;</span> <span class="token string">"  "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                

            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                cout <span class="token operator">&lt;&lt;</span> operat <span class="token operator">&lt;&lt;</span> <span class="token string">"读取失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">show_detail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//展示每次修改后的结果</span>
        <span class="token punctuation">}</span>
        <span class="token function">free</span><span class="token punctuation">(</span>MainHead<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="_455"></a>程序运行情况：</h3> 
<h6><a id="_456"></a>测试数据：</h6> 
<ul><li><img src="https://images2.imgbox.com/73/00/NDk33Hrh_o.png" alt="在这里插入图片描述"></li></ul> 
<h6><a id="_459"></a>运行截图：</h6> 
<ul><li>方法二：最佳优先算法<br> <img src="https://images2.imgbox.com/f7/18/0r6wV550_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/54/9e/SFqtuIPM_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f9c5b716a9511f586991f52693d688f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hadoop单机配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b50173652412259b54c82baf814b365a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">磁盘调度算法（先来先服务、最短寻道优先以及电梯调度算法）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>