<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫实战练习（疫情数据获取） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python爬虫实战练习（疫情数据获取）" />
<meta property="og:description" content="一、国内疫情数据的爬取1.1 获取响应1.2 使用xpath解析数据1.2.1 分析xpath解析的数据1.2.2 再一次分析数据 1.3 json转化xpath数据类型1.4 逐个获取我们需要的数据，并保存至Excel中1.4.1 创建工作簿1.4.2 创建工作表1.4.3 写入数据至表中1.4.4 数据保存 1.5 代码汇总 二、国外疫情数据的爬取2.1 代码汇总 三、结果 一、国内疫情数据的爬取 1.1 获取响应 # 导入requests库 import requests url = &#34;https://voice.baidu.com/act/newpneumonia/newpneumonia&#34; response = requests.get(url) # 查看响应的编码 print(&#34;编码：&#34;,response.encoding) # 查看响应头 print(response.headers) # 查看响应地址 print(&#34;地址：&#34;,response.url) # 查看响应状态码，200表示请求成功 print(&#34;状态码：&#34;,response.status_code) # 查看正确响应的结果，并与网页源代码比较一下，是否相同 result = response.text print(result) 1.2 使用xpath解析数据 # 导入xpath库，如未安装在cmd里面输入pip install xpath即可 from lxml import etree # 将数据转化为树形态 # 生成HTML对象 html = etree.HTML(result) result = html.xpath(&#39;//script[@type=&#34;application/json&#34;]/text()&#39;) 1.2.1 分析xpath解析的数据 # 查看解析结果 print(result) # 查看数据类型 print(type(result)) # 查看列表长度 print(len(result)) # 进一步提取列表中的数据 result = result[0] 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bc7cd213e7415fe0c8920510a7832d2c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-13T23:40:38+08:00" />
<meta property="article:modified_time" content="2020-06-13T23:40:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫实战练习（疫情数据获取）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4> </h4> 
 <ul><li><a href="#_2" rel="nofollow">一、国内疫情数据的爬取</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 获取响应</a></li><li><a href="#12_xpath_33" rel="nofollow">1.2 使用xpath解析数据</a></li><li><ul><li><a href="#121_xpath_44" rel="nofollow">1.2.1 分析xpath解析的数据</a></li><li><a href="#122__66" rel="nofollow">1.2.2 再一次分析数据</a></li></ul> 
   </li><li><a href="#13_jsonxpath_80" rel="nofollow">1.3 json转化xpath数据类型</a></li><li><a href="#14_Excel_246" rel="nofollow">1.4 逐个获取我们需要的数据，并保存至Excel中</a></li><li><ul><li><a href="#141__254" rel="nofollow">1.4.1 创建工作簿</a></li><li><a href="#142__261" rel="nofollow">1.4.2 创建工作表</a></li><li><a href="#143__274" rel="nofollow">1.4.3 写入数据至表中</a></li><li><a href="#144__289" rel="nofollow">1.4.4 数据保存</a></li></ul> 
   </li><li><a href="#15__296" rel="nofollow">1.5 代码汇总</a></li></ul> 
  </li><li><a href="#_344" rel="nofollow">二、国外疫情数据的爬取</a></li><li><ul><li><a href="#21__413" rel="nofollow">2.1 代码汇总</a></li></ul> 
  </li><li><a href="#_458" rel="nofollow">三、结果</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、国内疫情数据的爬取</h2> 
<h3><a id="11__4"></a>1.1 获取响应</h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入requests库</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://voice.baidu.com/act/newpneumonia/newpneumonia"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看响应的编码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"编码："</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>
<span class="token comment"># 查看响应头</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
<span class="token comment"># 查看响应地址</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"地址："</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment"># 查看响应状态码，200表示请求成功</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"状态码："</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看正确响应的结果，并与网页源代码比较一下，是否相同</span>
result <span class="token operator">=</span> response<span class="token punctuation">.</span>text
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="12_xpath_33"></a>1.2 使用xpath解析数据</h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入xpath库，如未安装在cmd里面输入pip install xpath即可</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree <span class="token comment"># 将数据转化为树形态</span>
<span class="token comment"># 生成HTML对象</span>
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//script[@type="application/json"]/text()'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="121_xpath_44"></a>1.2.1 分析xpath解析的数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 查看解析结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 查看列表长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 进一步提取列表中的数据</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="122__66"></a>1.2.2 再一次分析数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 查看上一步提取结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="13_jsonxpath_80"></a>1.3 json转化xpath数据类型</h3> 
<blockquote> 
 <p>使用json.loads()方法可以将字符串转换为Python的基本数据类型</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 导入Json库，此库无需安装</span>
<span class="token keyword">import</span> json
result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 获取字典中所有的键</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看每一个键对应的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"page"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看每一个键对应的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"component"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看每一个键对应的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"bundle"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看每一个键对应的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"version"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>通过查看这些键，可以得出result[“component”]才是我们需要的结果，但是探索还未结束，还要继续</p> 
</blockquote> 
<pre><code class="prism language-python">result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"component"</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 查看列表长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 提取列表中的数据</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 查看数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 获取所有的键值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>从上面的结果中可以看到数据量特别的大，因此这里只查看我们需要的目标数据</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 查看所有键值</span>
<span class="token comment"># for i in result.keys():</span>
<span class="token comment">#     print(i)</span>
<span class="token comment">#     print(result[i])</span>
<span class="token comment">#     print("*"*20)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看当前数据更新时间</span>
result<span class="token punctuation">[</span><span class="token string">'mapLastUpdatedTime'</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 中国当前时间的数据省市数据</span>
<span class="token comment"># result['caseList']</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 国外数据更新时间</span>
result<span class="token punctuation">[</span><span class="token string">"foreignLastUpdatedTime"</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 国外数据</span>
<span class="token comment"># result['caseOutsideList']</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 全球数据</span>
<span class="token comment"># result["globalList"]</span>
</code></pre> 
<blockquote> 
 <p>查看国内当前数据</p> 
</blockquote> 
<pre><code class="prism language-python">result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'caseList'</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">for</span> each <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>each<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>各项数据总结：</p> 
</blockquote> 
<table><thead><tr><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">confirmed</td><td align="left">累计确诊人数</td></tr><tr><td align="left">died</td><td align="left">死亡人数</td></tr><tr><td align="left">crued</td><td align="left">治愈人数</td></tr><tr><td align="left">relativeTime</td><td align="left">时间</td></tr><tr><td align="left">confirmedRelative</td><td align="left">确诊增量</td></tr><tr><td align="left">diedRelative</td><td align="left">死亡增量</td></tr><tr><td align="left">curedRelative</td><td align="left">治愈增量</td></tr><tr><td align="left">curConfirm</td><td align="left">现有确诊</td></tr><tr><td align="left">curConfirmRelative</td><td align="left">现有确诊增量</td></tr><tr><td align="left">icuDisable</td><td align="left">ID编号</td></tr><tr><td align="left">area</td><td align="left">省/直辖市/特别行政区</td></tr><tr><td align="left">subList</td><td align="left">area的地级市</td></tr></tbody></table> 
<h3><a id="14_Excel_246"></a>1.4 逐个获取我们需要的数据，并保存至Excel中</h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> openpyxl
</code></pre> 
<h4><a id="141__254"></a>1.4.1 创建工作簿</h4> 
<pre><code class="prism language-python">wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="142__261"></a>1.4.2 创建工作表</h4> 
<pre><code class="prism language-python">ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 设置表的标题</span>
ws<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"国内疫情"</span> 
</code></pre> 
<h4><a id="143__274"></a>1.4.3 写入数据至表中</h4> 
<pre><code class="prism language-python"><span class="token comment"># 写入表头</span>
ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"省份"</span><span class="token punctuation">,</span><span class="token string">"累计确诊"</span><span class="token punctuation">,</span><span class="token string">"死亡"</span><span class="token punctuation">,</span><span class="token string">"治愈"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> each <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    list_name <span class="token operator">=</span> <span class="token punctuation">[</span>each<span class="token punctuation">[</span><span class="token string">"area"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"confirmed"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"died"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"crued"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token comment"># 如果为空则填充0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> list_name<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
            i <span class="token operator">=</span> <span class="token string">"0"</span>
    ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list_name<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="144__289"></a>1.4.4 数据保存</h4> 
<pre><code class="prism language-python">wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./data1.xlsx'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="15__296"></a>1.5 代码汇总</h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入requests库</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://voice.baidu.com/act/newpneumonia/newpneumonia"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># 查看正确响应的结果，并与网页源代码比较一下，是否相同</span>
result <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment"># 导入xpath库，如未安装在cmd里面输入pip install xpath即可</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree <span class="token comment"># 将数据转化为树形态</span>
<span class="token comment"># 生成HTML对象</span>
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//script[@type="application/json"]/text()'</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 导入Json库，此库无需安装</span>
<span class="token keyword">import</span> json
result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"component"</span><span class="token punctuation">]</span>

<span class="token comment"># 获取国内当前数据</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'caseList'</span><span class="token punctuation">]</span>

<span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> openpyxl
<span class="token comment"># 创建工作簿</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 创建工作表</span>
ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
<span class="token comment"># 设置表的标题</span>
ws<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"国内疫情"</span> 
<span class="token comment"># 写入表头</span>
ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"省份"</span><span class="token punctuation">,</span><span class="token string">"累计确诊"</span><span class="token punctuation">,</span><span class="token string">"死亡"</span><span class="token punctuation">,</span><span class="token string">"治愈"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 写入各行</span>
<span class="token keyword">for</span> each <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    list_name <span class="token operator">=</span> <span class="token punctuation">[</span>each<span class="token punctuation">[</span><span class="token string">"area"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"confirmed"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"died"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>each<span class="token punctuation">[</span><span class="token string">"crued"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token comment"># 如果为空则填充0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> list_name<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
            i <span class="token operator">=</span> <span class="token string">"0"</span>
    ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list_name<span class="token punctuation">)</span>
<span class="token comment"># 保存至excel中</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./data_china.xlsx'</span><span class="token punctuation">)</span>  
</code></pre> 
<h2><a id="_344"></a>二、国外疫情数据的爬取</h2> 
<blockquote> 
 <p>根据国内的方法，只需要将result[‘caseList’] 改为 result[“globalList”]即可</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 导入requests库</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://voice.baidu.com/act/newpneumonia/newpneumonia"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># 查看正确响应的结果，并与网页源代码比较一下，是否相同</span>
result <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment"># 导入xpath库，如未安装在cmd里面输入pip install xpath即可</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree <span class="token comment"># 将数据转化为树形态</span>
<span class="token comment"># 生成HTML对象</span>
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//script[@type="application/json"]/text()'</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 导入Json库，此库无需安装</span>
<span class="token keyword">import</span> json
result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"component"</span><span class="token punctuation">]</span>

<span class="token comment"># 获取国外当前数据</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"globalList"</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 查看国外数据</span>
<span class="token comment"># print(result)</span>
<span class="token comment"># 可以发现结果为一个列表且长度为8</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 通过遍历并分析这个列表，发现这里是以七大洲和钻石公主号邮轮构成的这个列表</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>以每个洲以及邮轮分别创建一个表，来存储各个州的各个国家的数据</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> openpyxl
<span class="token comment"># 创建工作簿</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> each <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    title <span class="token operator">=</span> each<span class="token punctuation">[</span><span class="token string">"area"</span><span class="token punctuation">]</span> <span class="token comment"># 获取各州名</span>
    ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token comment"># 根据名称创建多个工作表</span>
    ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"国家"</span><span class="token punctuation">,</span><span class="token string">"累计确诊"</span><span class="token punctuation">,</span><span class="token string">"死亡"</span><span class="token punctuation">,</span><span class="token string">"治愈"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 写入表头至新建的表</span>
    <span class="token keyword">for</span> country <span class="token keyword">in</span> each<span class="token punctuation">[</span><span class="token string">"subList"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment"># 可以从原始数据中看到各个国家的数据在"subList"键中</span>
        list_name <span class="token operator">=</span> <span class="token punctuation">[</span>country<span class="token punctuation">[</span><span class="token string">"country"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"confirmed"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"died"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"crued"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> list_name<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
                i <span class="token operator">=</span> <span class="token string">"0"</span>
        ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list_name<span class="token punctuation">)</span>
<span class="token comment"># 保存至excel中</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./data_global.xlsx'</span><span class="token punctuation">)</span>      
</code></pre> 
<h3><a id="21__413"></a>2.1 代码汇总</h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入requests库</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://voice.baidu.com/act/newpneumonia/newpneumonia"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># 查看正确响应的结果，并与网页源代码比较一下，是否相同</span>
result <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment"># 导入xpath库，如未安装在cmd里面输入pip install xpath即可</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree <span class="token comment"># 将数据转化为树形态</span>
<span class="token comment"># 生成HTML对象</span>
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//script[@type="application/json"]/text()'</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 导入Json库，此库无需安装</span>
<span class="token keyword">import</span> json
result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"component"</span><span class="token punctuation">]</span>

<span class="token comment"># 获取国外当前数据</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"globalList"</span><span class="token punctuation">]</span>

<span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> openpyxl
<span class="token comment"># 创建工作簿</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> each <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    title <span class="token operator">=</span> each<span class="token punctuation">[</span><span class="token string">"area"</span><span class="token punctuation">]</span> <span class="token comment"># 获取各州名</span>
    ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token comment"># 根据名称创建多个工作表</span>
    ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"国家"</span><span class="token punctuation">,</span><span class="token string">"累计确诊"</span><span class="token punctuation">,</span><span class="token string">"死亡"</span><span class="token punctuation">,</span><span class="token string">"治愈"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 写入表头至新建的表</span>
    <span class="token keyword">for</span> country <span class="token keyword">in</span> each<span class="token punctuation">[</span><span class="token string">"subList"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment"># 可以从原始数据中看到各个国家的数据在"subList"键中</span>
        list_name <span class="token operator">=</span> <span class="token punctuation">[</span>country<span class="token punctuation">[</span><span class="token string">"country"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"confirmed"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"died"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>country<span class="token punctuation">[</span><span class="token string">"crued"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> list_name<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
                i <span class="token operator">=</span> <span class="token string">"0"</span>
        ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list_name<span class="token punctuation">)</span>
<span class="token comment"># 保存至excel中</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./data_global.xlsx'</span><span class="token punctuation">)</span>      
</code></pre> 
<h2><a id="_458"></a>三、结果</h2> 
<p><img src="https://images2.imgbox.com/41/18/n7r1utkp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8b/93/hnKSo5ZS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/67/4c/zbuoKFFk_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aea3bc15853c07765966c0635a784b32/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">流形：Java的扩展方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91a92e008947b267b985b0a5c32e43a7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GDB图形数据库/Tinkerpop gremlin使用总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>