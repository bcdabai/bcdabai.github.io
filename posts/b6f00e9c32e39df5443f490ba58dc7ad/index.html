<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>借助一个例子简要了解机器学习 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="借助一个例子简要了解机器学习" />
<meta property="og:description" content="练习:训练一个模型, 基于适合狗的护具的大小来预测适合狗的靴子尺寸 环境: azureml_py
import pandas !wget https://raw.githubusercontent.com/MicrosoftDocs/mslearn-introduction-to-machine-learning/main/graphing.py !wget https://raw.githubusercontent.com/MicrosoftDocs/mslearn-introduction-to-machine-learning/main/Data/doggy-boot-harness.csv !pip install statsmodels # Make a dictionary of data for boot sizes and harness sizes in cm data = { &#39;boot_size&#39; : [ 39, 38, 37, 39, 38, 35, 37, 36, 35, 40, 40, 36, 38, 39, 42, 42, 36, 36, 35, 41, 42, 38, 37, 35, 40, 36, 35, 39, 41, 37, 35, 41, 39, 41, 42, 42, 36, 37, 37, 39, 42, 35, 36, 41, 41, 41, 39, 39, 35, 39 ], &#39;harness_size&#39;: [ 58, 58, 52, 58, 57, 52, 55, 53, 49, 54, 59, 56, 53, 58, 57, 58, 56, 51, 50, 59, 59, 59, 55, 50, 55, 52, 53, 54, 61, 56, 55, 60, 57, 56, 61, 58, 53, 57, 57, 55, 60, 51, 52, 56, 55, 57, 58, 57, 51, 59 ] } # Convert it into a table using pandas dataset = pandas." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b6f00e9c32e39df5443f490ba58dc7ad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-24T01:21:06+08:00" />
<meta property="article:modified_time" content="2024-01-24T01:21:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">借助一个例子简要了解机器学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="__1"></a>练习:训练一个模型, <code>基于适合狗的护具的大小</code>来预测适合狗的靴子尺寸</h3> 
<p><code>环境: azureml_py</code></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas
!wget https<span class="token punctuation">:</span><span class="token operator">//</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>MicrosoftDocs<span class="token operator">/</span>mslearn<span class="token operator">-</span>introduction<span class="token operator">-</span>to<span class="token operator">-</span>machine<span class="token operator">-</span>learning<span class="token operator">/</span>main<span class="token operator">/</span>graphing<span class="token punctuation">.</span>py
!wget https<span class="token punctuation">:</span><span class="token operator">//</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>MicrosoftDocs<span class="token operator">/</span>mslearn<span class="token operator">-</span>introduction<span class="token operator">-</span>to<span class="token operator">-</span>machine<span class="token operator">-</span>learning<span class="token operator">/</span>main<span class="token operator">/</span>Data<span class="token operator">/</span>doggy<span class="token operator">-</span>boot<span class="token operator">-</span>harness<span class="token punctuation">.</span>csv
!pip install statsmodels


<span class="token comment"># Make a dictionary of data for boot sizes and harness sizes in cm</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'boot_size'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> 
                    <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> 
                    <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> 
                    <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span>
                    <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">39</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'harness_size'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span>
                <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span>
                <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span>
                <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span>
                <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">59</span>
                <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># Convert it into a table using pandas</span>
dataset <span class="token operator">=</span> pandas<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
dataset
</code></pre> 
<table><thead><tr><th align="right"></th><th align="right">boot_size</th><th align="right">harness_size</th></tr></thead><tbody><tr><td align="right">0</td><td align="right">39</td><td align="right">58</td></tr><tr><td align="right">1</td><td align="right">38</td><td align="right">58</td></tr><tr><td align="right">2</td><td align="right">37</td><td align="right">52</td></tr><tr><td align="right">3</td><td align="right">39</td><td align="right">58</td></tr><tr><td align="right">4</td><td align="right">38</td><td align="right">57</td></tr><tr><td align="right">5</td><td align="right">35</td><td align="right">52</td></tr><tr><td align="right">6</td><td align="right">37</td><td align="right">55</td></tr><tr><td align="right">7</td><td align="right">36</td><td align="right">53</td></tr><tr><td align="right">8</td><td align="right">35</td><td align="right">49</td></tr><tr><td align="right">9</td><td align="right">40</td><td align="right">54</td></tr><tr><td align="right">10</td><td align="right">40</td><td align="right">59</td></tr><tr><td align="right">11</td><td align="right">36</td><td align="right">56</td></tr><tr><td align="right">12</td><td align="right">38</td><td align="right">53</td></tr><tr><td align="right">13</td><td align="right">39</td><td align="right">58</td></tr><tr><td align="right">14</td><td align="right">42</td><td align="right">57</td></tr><tr><td align="right">15</td><td align="right">42</td><td align="right">58</td></tr><tr><td align="right">16</td><td align="right">36</td><td align="right">56</td></tr><tr><td align="right">17</td><td align="right">36</td><td align="right">51</td></tr><tr><td align="right">18</td><td align="right">35</td><td align="right">50</td></tr><tr><td align="right">19</td><td align="right">41</td><td align="right">59</td></tr><tr><td align="right">20</td><td align="right">42</td><td align="right">59</td></tr><tr><td align="right">21</td><td align="right">38</td><td align="right">59</td></tr><tr><td align="right">22</td><td align="right">37</td><td align="right">55</td></tr><tr><td align="right">23</td><td align="right">35</td><td align="right">50</td></tr><tr><td align="right">24</td><td align="right">40</td><td align="right">55</td></tr><tr><td align="right">25</td><td align="right">36</td><td align="right">52</td></tr><tr><td align="right">26</td><td align="right">35</td><td align="right">53</td></tr><tr><td align="right">27</td><td align="right">39</td><td align="right">54</td></tr><tr><td align="right">28</td><td align="right">41</td><td align="right">61</td></tr><tr><td align="right">29</td><td align="right">37</td><td align="right">56</td></tr><tr><td align="right">30</td><td align="right">35</td><td align="right">55</td></tr><tr><td align="right">31</td><td align="right">41</td><td align="right">60</td></tr><tr><td align="right">32</td><td align="right">39</td><td align="right">57</td></tr><tr><td align="right">33</td><td align="right">41</td><td align="right">56</td></tr><tr><td align="right">34</td><td align="right">42</td><td align="right">61</td></tr><tr><td align="right">35</td><td align="right">42</td><td align="right">58</td></tr><tr><td align="right">36</td><td align="right">36</td><td align="right">53</td></tr><tr><td align="right">37</td><td align="right">37</td><td align="right">57</td></tr><tr><td align="right">38</td><td align="right">37</td><td align="right">57</td></tr><tr><td align="right">39</td><td align="right">39</td><td align="right">55</td></tr><tr><td align="right">40</td><td align="right">42</td><td align="right">60</td></tr><tr><td align="right">41</td><td align="right">35</td><td align="right">51</td></tr><tr><td align="right">42</td><td align="right">36</td><td align="right">52</td></tr><tr><td align="right">43</td><td align="right">41</td><td align="right">56</td></tr><tr><td align="right">44</td><td align="right">41</td><td align="right">55</td></tr><tr><td align="right">45</td><td align="right">41</td><td align="right">57</td></tr><tr><td align="right">46</td><td align="right">39</td><td align="right">58</td></tr><tr><td align="right">47</td><td align="right">39</td><td align="right">57</td></tr><tr><td align="right">48</td><td align="right">35</td><td align="right">51</td></tr><tr><td align="right">49</td><td align="right">39</td><td align="right">59</td></tr></tbody></table> 
<p>我们希望使用"harness size"来估计"boot size"。这意味着’ harness_size '是我们的<code>input</code>。我们需要一个模型来处理输入并对boot size输出)做出自己的估计。</p> 
<p>普通最小二乘法<a href="https://scikit-learn.org/stable/modules/linear_model.html#ordinary-least-squares" rel="nofollow">Ordinary Least Squares (OLS)</a></p> 
<blockquote> 
 <p>示例: <a href="https://scikit-learn.org/stable/auto_examples/linear_model/plot_ols.html#sphx-glr-auto-examples-linear-model-plot-ols-py" rel="nofollow"> Linear Regression Example — scikit-learn 1.4.0 documentation</a></p> 
</blockquote> 
<p>这里使用一个现有的库来创建我们的模型, 但是我们还不训练它</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>formula<span class="token punctuation">.</span>api <span class="token keyword">as</span> smf

<span class="token comment"># 首先, 我们使用一种特殊语法定义公式, 说明boot_size由harness_size解释</span>
formula <span class="token operator">=</span> <span class="token string">"boot_size ~ harness_size"</span>
model <span class="token operator">=</span> smf<span class="token punctuation">.</span>ols<span class="token punctuation">(</span>formula <span class="token operator">=</span> formula<span class="token punctuation">,</span> data <span class="token operator">=</span> dataset<span class="token punctuation">)</span>

<span class="token comment"># 已经创建了模型, 但它没有内部参数的设置</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model selected but it does not have parameters set. We need to train it!"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>OLS模型有两个参数(斜率和偏移量), 但这些参数还没有在我们的模型中设置。我们需要训练我们的模型来找到这些值, 这样模型就可以根据狗的护具尺寸可靠地估计狗的靴子尺寸。</p> 
</blockquote> 
<pre><code class="prism language-python">fitted_model <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 现在已拟合, 输出我们模型的信息</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The following model parameters have been found:\n"</span> <span class="token operator">+</span>
        <span class="token string-interpolation"><span class="token string">f"Line slope: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>fitted_model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token operator">+</span>
        <span class="token string-interpolation"><span class="token string">f"Line Intercept: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>fitted_model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>The following model parameters have been found:</p> 
<p>Line slope: 0.5859254167382711</p> 
<p>Line Intercept: 5.719109812682577</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 显示数据点的散点图, 并添加拟合线</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"harness_size"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dataset<span class="token punctuation">[</span><span class="token string">"boot_size"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"harness_size"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fitted_model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> dataset<span class="token punctuation">[</span><span class="token string">"harness_size"</span><span class="token punctuation">]</span> <span class="token operator">+</span> fitted_model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Fitted line'</span><span class="token punctuation">)</span>

<span class="token comment"># 添加标签和图例</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"harness_size"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"boot_size"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/91/c6/vXn4tvgp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 预测护具大小为61.4时对应的靴子大小</span>
harness_size <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">'harness_size'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">61.4</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
approximate_boot_size <span class="token operator">=</span> fitted_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>harness_size<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Estimated approximate_boot_size:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>approximate_boot_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>Estimated approximate_boot_size:</p> 
<p>41.694930400412424</p> 
<h3><a id="_164"></a>输入和输出</h3> 
<p><img src="https://images2.imgbox.com/3c/18/SfA5WY91_o.png" alt="在这里插入图片描述"></p> 
<p>训练的目标是改进模型, 使它可以进行高质量的估计或预测</p> 
<p>模型不会自行训练, 它们使用数据和两段代码（<code>目标函数</code>和<code>优化器</code>）进行训练</p> 
<p>目标函数判断模型表现得不错（正确地估计了靴子尺寸）还是糟糕</p> 
<p>在训练期间, 模型进行预测, 目标函数计算其性能。优化器是随后更改模型参数的代码, 以便模型下次会做得更好, 通常可以使用开源框架</p> 
<p>目标、数据和优化器只是训练模型的一种手段, 训练完成后, 就不再需要它们</p> 
<p>训练只会改变模型内部的参数值;它不会改变使用的模型类型</p> 
<h3><a id="_185"></a>练习:可视化输入和输出</h3> 
<p>这次，我们从文件加载数据，对其进行过滤，并将其绘制成图形。为了更好地了解模型构建或局限性</p> 
<p>这里使用 Pandas 加载数据</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas
!wget https<span class="token punctuation">:</span><span class="token operator">//</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>MicrosoftDocs<span class="token operator">/</span>mslearn<span class="token operator">-</span>introduction<span class="token operator">-</span>to<span class="token operator">-</span>machine<span class="token operator">-</span>learning<span class="token operator">/</span>main<span class="token operator">/</span>graphing<span class="token punctuation">.</span>py
!wget https<span class="token punctuation">:</span><span class="token operator">//</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>MicrosoftDocs<span class="token operator">/</span>mslearn<span class="token operator">-</span>introduction<span class="token operator">-</span>to<span class="token operator">-</span>machine<span class="token operator">-</span>learning<span class="token operator">/</span>main<span class="token operator">/</span>Data<span class="token operator">/</span>doggy<span class="token operator">-</span>boot<span class="token operator">-</span>harness<span class="token punctuation">.</span>csv


dataset <span class="token operator">=</span> pandas<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'doggy-boot-harness.csv'</span><span class="token punctuation">)</span>

<span class="token comment"># 数据很多，使用head()只打印前几行</span>
dataset<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table><thead><tr><th align="right"></th><th align="right">boot_size</th><th align="right">harness_size</th><th align="right">sex</th><th align="right">age_years</th></tr></thead><tbody><tr><td align="right">0</td><td align="right">39</td><td align="right">58</td><td align="right">male</td><td align="right">12.0</td></tr><tr><td align="right">1</td><td align="right">38</td><td align="right">58</td><td align="right">male</td><td align="right">9.6</td></tr><tr><td align="right">2</td><td align="right">37</td><td align="right">52</td><td align="right">female</td><td align="right">8.6</td></tr><tr><td align="right">3</td><td align="right">39</td><td align="right">58</td><td align="right">male</td><td align="right">10.2</td></tr><tr><td align="right">4</td><td align="right">38</td><td align="right">57</td><td align="right">male</td><td align="right">7.8</td></tr></tbody></table> 
<p>按列筛选数据</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Harness sizes"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>harness_size<span class="token punctuation">)</span>

<span class="token keyword">del</span> dataset<span class="token punctuation">[</span><span class="token string">"sex"</span><span class="token punctuation">]</span>
<span class="token keyword">del</span> dataset<span class="token punctuation">[</span><span class="token string">"age_years"</span><span class="token punctuation">]</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nAvailable columns after deleting sex and age information:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ef/ce/Ugsuek4H_o.png" alt="在这里插入图片描述"></p> 
<p>Available columns after deleting sex and age information:</p> 
<p>[‘boot_size’ ‘harness_size’]</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"TOP OF TABLE"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nBOTTOM OF TABLE"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/81/wUnBE8qk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"We have </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> rows of data"</span></span><span class="token punctuation">)</span>

is_small <span class="token operator">=</span> dataset<span class="token punctuation">.</span>harness_size <span class="token operator">&lt;</span> <span class="token number">55</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nWhether the dog's harness was smaller than size 55:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>is_small<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/91/bf/XL5U7jjS_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">data_from_small_dogs <span class="token operator">=</span> dataset<span class="token punctuation">[</span>is_small<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nData for dogs with harness smaller than size 55:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data_from_small_dogs<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\nNumber of dogs with harness size less than 55: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>data_from_small_dogs<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/a5/7BU98RWH_o.png" alt="在这里插入图片描述"></p> 
<p>上面也可写作</p> 
<pre><code class="prism language-python">data_from_small_dogs <span class="token operator">=</span> dataset<span class="token punctuation">[</span>dataset<span class="token punctuation">.</span>boot_size <span class="token operator">&lt;</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>对copy()的调用是可选的，但有助于避免在更复杂的场景中出现意外行为</p> 
<h4><a id="Python__270"></a>Python 直接赋值、浅拷贝和深度拷贝</h4> 
<blockquote> 
 <p><a href="https://www.runoob.com/python/att-dictionary-copy.html" rel="nofollow">Python 字典(Dictionary) copy()方法 | 菜鸟教程 (runoob.com)</a></p> 
 <p><a href="https://www.runoob.com/w3cnote/python-understanding-dict-copy-shallow-or-deep.html" rel="nofollow">Python 直接赋值、浅拷贝和深度拷贝解析 | 菜鸟教程 (runoob.com)</a><br> 1、<strong>b = a:</strong> 赋值引用，a 和 b 都指向同一个对象。<br> <img src="https://images2.imgbox.com/65/d5/4erxS55h_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p><strong>2、b = a.copy():</strong> 浅拷贝, a 和 b 是一个独立的对象，但他们的子对象还是指向统一对象（是引用）。<br> <img src="https://images2.imgbox.com/f5/b0/NUnnQOsA_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p><code>浅拷贝：深拷贝父对象（一级目录），子对象（二级目录）不拷贝，还是引用</code></p> 
 <p><strong>b = copy.deepcopy(a):</strong> 深度拷贝, a 和 b 完全拷贝了父对象及其子对象，两者是完全独立的。<br> <img src="https://images2.imgbox.com/35/52/eFAfCOBy_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>data_smaller_paws<span class="token punctuation">[</span><span class="token string">"harness_size"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data_smaller_paws<span class="token punctuation">[</span><span class="token string">"boot_size"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"harness_size"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"boot_size"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/86/SxFdiw6T_o.png" alt="在这里插入图片描述"></p> 
<p>某些客户可能希望以英寸为单位，而不是以厘米为单位</p> 
<p>那么我们需要创建新的横坐标</p> 
<pre><code class="prism language-python">data_smaller_paws<span class="token punctuation">[</span><span class="token string">'harness_size_imperial'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_smaller_paws<span class="token punctuation">.</span>harness_size <span class="token operator">/</span> <span class="token number">2.54</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>data_smaller_paws<span class="token punctuation">[</span><span class="token string">"harness_size_imperial"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data_smaller_paws<span class="token punctuation">[</span><span class="token string">"boot_size"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"harness_size_imperial"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"boot_size"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/87/a1/bZ0X7ST9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_317"></a>如何使用模型</h3> 
<p><img src="https://images2.imgbox.com/c4/62/29yXpaqB_o.png" alt="在这里插入图片描述"></p> 
<p>在训练过程中，目标函数通常需要知道模型的输出和正确答案是什么。这些值称为标签。在我们的场景中，如果我们的模型预测了靴子大小，则靴子大小就是我们的标签。</p> 
<p>模型完成训练后，可以将其单独保存到文件中。我们不再需要原始数据、目标函数或模型优化器。当我们想使用模型时，我们可以从磁盘加载它，为其提供新数据，并返回预测。</p> 
<h3><a id="_328"></a>对新数据使用经过训练的模型</h3> 
<p>在我们刚刚学习机器学习时，构建、训练然后使用模型是很常见的;但在现实世界中，我们不希望每次都要进行预测时就训练模型。</p> 
<ol><li>创建基本模型</li><li>将其保存到磁盘</li><li>从磁盘加载</li><li>使用它来预测不在训练数据集中的狗</li></ol> 
<p>正如我们之前所做的那样，创建一个简单的线性回归模型，并在我们的数据集上对其进行训练</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>formula<span class="token punctuation">.</span>api <span class="token keyword">as</span> smf

model <span class="token operator">=</span> smf<span class="token punctuation">.</span>ols<span class="token punctuation">(</span>formula <span class="token operator">=</span> <span class="token string">"boot_size ~ harness_size"</span><span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>保存并加载模型</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> joblib

model_filename <span class="token operator">=</span> <span class="token string">'./avalanche_dog_boot_model.pkl'</span>
joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>model<span class="token punctuation">,</span> model_filename<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model saved!"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><a href="https://joblib.readthedocs.io/en/stable/" rel="nofollow"> Joblib: running Python functions as pipeline jobs — joblib 1.3.2 documentation</a></p> 
</blockquote> 
<pre><code class="prism language-python">model_loaded <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_filename<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"We have loaded a model with the following parameters:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model_loaded<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
</code></pre> 
<p>We have loaded a model with the following parameters:</p> 
<p>Intercept 5.719110</p> 
<p>harness_size 0.585925</p> 
<p>dtype: float64</p> 
<h3><a id="_379"></a>实际应用场景</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">load_model_and_predict</span><span class="token punctuation">(</span>harness_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    This function loads a pretrained model. 
    It uses the model with the customer's dog's harness size 
    to predict the size of boots that will fit that dog.

    harness_size: The dog harness size, in cm 
    '''</span>

    <span class="token comment"># Load the model from file and print basic information about it</span>
    loaded_model <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_filename<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"We've loaded a model with the following parameters:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>loaded_model<span class="token punctuation">.</span>params<span class="token punctuation">)</span>

    inputs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"harness_size"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>harness_size<span class="token punctuation">]</span><span class="token punctuation">}</span> 

    <span class="token comment"># Use the model to make a prediction</span>
    predicted_boot_size <span class="token operator">=</span> loaded_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> predicted_boot_size


<span class="token keyword">def</span> <span class="token function">check_size_of_boots</span><span class="token punctuation">(</span>selected_harness_size<span class="token punctuation">,</span> selected_boot_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    Calculates whether the customer has chosen a pair of doggy boots that 
    are a sensible size. This works by estimating the dog's actual boot 
    size from their harness size.

    This returns a message for the customer that should be shown before
    they complete their payment 

    selected_harness_size: The size of the harness the customer wants to buy
    selected_boot_size: The size of the doggy boots the customer wants to buy
    '''</span>

    <span class="token comment"># Estimate the customer's dog's boot size</span>
    estimated_boot_size <span class="token operator">=</span> load_model_and_predict<span class="token punctuation">(</span>selected_harness_size<span class="token punctuation">)</span>

    <span class="token comment"># Round to the nearest whole number because we don't sell partial sizes</span>
    estimated_boot_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>estimated_boot_size<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Check if the boot size selected is appropriate</span>
    <span class="token keyword">if</span> selected_boot_size <span class="token operator">==</span> estimated_boot_size<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Great choice! We think these boots will fit your avalanche dog well."</span></span>

    <span class="token keyword">if</span> selected_boot_size <span class="token operator">&lt;</span> estimated_boot_size<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"The boots you have selected might be TOO SMALL for a dog as "</span>\
               <span class="token string-interpolation"><span class="token string">f"big as yours. We recommend a doggy boots size of </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>estimated_boot_size<span class="token punctuation">}</span></span><span class="token string">."</span></span>

    <span class="token keyword">if</span> selected_boot_size <span class="token operator">&gt;</span> estimated_boot_size<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"The boots you have selected might be TOO BIG for a dog as "</span>\
               <span class="token string-interpolation"><span class="token string">f"small as yours. We recommend a doggy boots size of </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>estimated_boot_size<span class="token punctuation">}</span></span><span class="token string">."</span></span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># Practice using our new warning system</span>
check_size_of_boots<span class="token punctuation">(</span>selected_harness_size<span class="token operator">=</span><span class="token number">55</span><span class="token punctuation">,</span> selected_boot_size<span class="token operator">=</span><span class="token number">39</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/21/65/GctEP3WK_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1077f06970cf6066b666921193804441/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows下安装达梦8开发版数据库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9411fdbba31ffbec64926d38a8ffb8bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">༺༽༾ཊ—Unity之-03-建造者模式—ཏ༿༼༻</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>