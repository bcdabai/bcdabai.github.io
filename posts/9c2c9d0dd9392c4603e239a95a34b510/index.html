<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WebSocket 入门实战 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WebSocket 入门实战" />
<meta property="og:description" content="1. 引言 WebSocket 是一种在单个 TCP 连接上提供全双工通信的协议，允许客户端和服务器之间实时、双向地进行数据交换。WebSocket 的引入使得 Web 应用程序能够更轻松地实现实时通信，如在线聊天、实时数据更新等。本文将介绍 WebSocket 的使用场景以及通过 Java 进行 WebSocket 编程的实例。
2. WebSocket 使用场景 WebSocket 在以下场景中非常有用：
实时聊天应用程序： WebSocket 提供了一种实时通信的方式，使得在线聊天应用程序能够实时地传递消息。
实时数据更新： 对于需要在客户端和服务器之间共享实时数据的应用程序，例如股票市场行情、在线游戏状态等。
协作应用程序： 在协作工具中，用户可以实时共享文档、图像等内容。
实时提醒和通知： 通过 WebSocket，服务器可以即时地向客户端推送通知，而不需要客户端不断地轮询。
3. Java代码示例 下面通过一个简单的 Java 示例来演示如何使用 Spring Boot 和 Spring WebSocket 来创建一个基本的 WebSocket 服务。
1. 创建 Spring Boot 项目 引入websocket-starter
&lt;!-- Spring Boot Starter WebSocket --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt; &lt;/dependency&gt; 2. 编写 WebSocket 配置 创建一个 WebSocket 配置类，用于配置和启用 WebSocket：
// WebSocketConfig.java @Configuration @EnableWebSocketMessageBroker public class WebSocketConfig extends AbstractWebSocketMessageBrokerConfigurer { @Override public void configureMessageBroker(MessageBrokerRegistry config) { config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9c2c9d0dd9392c4603e239a95a34b510/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T13:16:41+08:00" />
<meta property="article:modified_time" content="2024-01-11T13:16:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WebSocket 入门实战</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1. 引言</h3> 
<p>WebSocket 是一种在单个 TCP 连接上提供全双工通信的协议，允许客户端和服务器之间实时、双向地进行数据交换。WebSocket 的引入使得 Web 应用程序能够更轻松地实现实时通信，如在线聊天、实时数据更新等。本文将介绍 WebSocket 的使用场景以及通过 Java 进行 WebSocket 编程的实例。</p> 
<h3>2. WebSocket 使用场景</h3> 
<p>WebSocket 在以下场景中非常有用：</p> 
<ol><li> <p><strong>实时聊天应用程序：</strong> WebSocket 提供了一种实时通信的方式，使得在线聊天应用程序能够实时地传递消息。</p> </li><li> <p><strong>实时数据更新：</strong> 对于需要在客户端和服务器之间共享实时数据的应用程序，例如股票市场行情、在线游戏状态等。</p> </li><li> <p><strong>协作应用程序：</strong> 在协作工具中，用户可以实时共享文档、图像等内容。</p> </li><li> <p><strong>实时提醒和通知：</strong> 通过 WebSocket，服务器可以即时地向客户端推送通知，而不需要客户端不断地轮询。</p> </li></ol> 
<h3>3. Java代码示例</h3> 
<p>下面通过一个简单的 Java 示例来演示如何使用 Spring Boot 和 Spring WebSocket 来创建一个基本的 WebSocket 服务。</p> 
<h4 style="background-color:transparent;">1. 创建 Spring Boot 项目</h4> 
<p>引入websocket-starter</p> 
<pre><code class="language-XML"> &lt;!-- Spring Boot Starter WebSocket --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre> 
<h4 style="background-color:transparent;">2. 编写 WebSocket 配置</h4> 
<p>创建一个 WebSocket 配置类，用于配置和启用 WebSocket：</p> 
<pre><code class="language-java">// WebSocketConfig.java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig extends AbstractWebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.enableSimpleBroker("/topic");
        config.setApplicationDestinationPrefixes("/app");
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/websocket-example").withSockJS();
    }
}
</code></pre> 
<p></p> 
<p>这个配置类配置了基本的消息代理，使得消息可以在客户端和服务器之间进行传递。</p> 
<h4>3. 创建 WebSocket 控制器</h4> 
<p>创建一个简单的 WebSocket 控制器，用于处理 WebSocket 消息：</p> 
<pre><code class="language-java">// WebSocketController.java
@Controller
public class WebSocketController {

    @MessageMapping("/hello")
    @SendTo("/topic/greetings")
    public Greeting greeting(HelloMessage message) throws Exception {
        Thread.sleep(1000); // 模拟处理时间
        return new Greeting("Hello, " + message.getName() + "!");
    }
}
</code></pre> 
<p></p> 
<h4>4. 创建消息模型</h4> 
<p>创建用于传递消息的模型类：</p> 
<pre><code class="language-java">// HelloMessage.java
public class HelloMessage {

    private String name;

    // Getter and Setter
}


// Greeting.java
public class Greeting {

    private String content;

    public Greeting(String content) {
        this.content = content;
    }

    // Getter
}
</code></pre> 
<p></p> 
<h4>5. 编写前端页面</h4> 
<p>在前端页面使用 JavaScript 来处理 WebSocket 连接，创建一个test.html，写入以下代码</p> 
<pre><code class="language-html">&lt;!-- index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;WebSocket Example&lt;/title&gt;
    &lt;script src="https://code.jquery.com/jquery-3.6.0.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;label for="name"&gt;Enter your name: &lt;/label&gt;
        &lt;input type="text" id="name" /&gt;
        &lt;button onclick="connect()" id='connect'&gt;Connect&lt;/button&gt;
        &lt;hr /&gt;
        &lt;textarea id="messages" cols="40" rows="10" readonly&gt;&lt;/textarea&gt;
        &lt;hr /&gt;
        &lt;label for="message"&gt;Message: &lt;/label&gt;
        &lt;input type="text" id="message" /&gt;
        &lt;button onclick="sendMessage()"&gt;Send&lt;/button&gt;
    &lt;/div&gt;

    &lt;script&gt;
        var stompClient = null;

        function setConnected(connected) {
            document.getElementById('connect').disabled = connected;
        }

        function connect() {
            // 注意端口号
            var socket = new SockJS('http://localhost:8090/websocket-example');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                setConnected(true);
			
                stompClient.subscribe('/topic/greetings', function (greeting) {
					console.log("receive websocket server msg:",greeting)
                    showGreeting(JSON.parse(greeting.body).content);
                });
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log('Disconnected');
        }

        function sendMessage() {
            var message = document.getElementById('message').value;
            stompClient.send("/app/hello", {}, JSON.stringify({ 'name': message }));
        }

        function showGreeting(message) {
            var textarea = document.getElementById('messages');
            textarea.value += message + '\n';
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<p style="background-color:transparent;"><span style="color:#fe2c24;">注意，如果是直接打开上面的html页面，调用后端服务会存在跨域问题，需要用配置了跨域的谷歌浏览器打开才能使用。</span></p> 
<h4 style="background-color:transparent;">6. 运行应用程序</h4> 
<p>运行 Spring Boot 应用程序，并访问 </p> 
<p><img alt="" height="932" src="https://images2.imgbox.com/b0/bf/1IcIq5Op_o.png" width="1151"> </p> 
<h3>4. 总结</h3> 
<p>这个简单示例演示了如何使用 Spring Boot 和 Spring WebSocket 创建一个基本的 WebSocket 服务。通过这个例子，可以了解 WebSocket 在实时通信中的应用，如果大家在平时工作当中有遇到需要实时推送的场景，比如大屏实时展示数据变化，就可以用这种发放时。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3385f52a7cf62e83b341d152912a5f69/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">响应式编程Reactor API大全（下）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3d2676d1c494f7db9a1eb10cab74269b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ChatGPT新出Team号 年付费</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>