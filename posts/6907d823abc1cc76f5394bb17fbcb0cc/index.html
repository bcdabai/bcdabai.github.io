<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《Web接口开发与自动化测试基于Python语言》--第8章 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《Web接口开发与自动化测试基于Python语言》--第8章" />
<meta property="og:description" content="第8章 开发web接口 因为要对web接口进行测试，虫师在前面大致讲解了web开发的过程，接下来就是web接口开发。所以，了解了什么是web接口开发，也就很容易进行web接口测试了。
8.1 为何要开发Web接口 总的来说，就是当开发大型B/S架构的程序时，前后端分离，当前端想要调用后台程序，只需要调用接口即可。这样带来的好处就是：
后端不必精通前端技术（HTML5/JavaScript/CSS），只专注于数据的处理并提供Web接口即可；
前端的专业性越来越高，通过调用Web接口获取数据，从而专注于数据展示和页面交互设计；
Web接口的应用范围更加广泛，由后端开发的接口既可以提供给Web页面调用，也可以提供移动APP调用等；
8.2 什么是Web接口 通过数据传输协议（eg：HTTP/SOAP……）传输一定格式（eg：XML/JSON/CSV……）数据的接口。
在当前Web接口中，HTTP协议&#43;JSON数据格式，是目前最流行的两个接口技术。
8.2.1 HTTP HTTP（Hyper Text Transfer Protocol，超文本传输协议）
主要特点：
无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接，采用这种方式可以节省传输时间；
媒体独立：只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送，客户端和服务器指定使用适合的MIME-type内容类型；
无状态：无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大，如果服务器不需要先前的信息，那么它的应答就比较快。
HTTP请求方法：
请求方法说明（V1.1）GET请求指定的页面信息，并返回实体主体POST向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中，POST请求可能会导致新的资源的建立或已有资源的修改HEAD类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头PUT从客户端向服务器传送的数据取代指定文档的内容DELETE请求服务器删除指定的页面TRACE请求服务器返回收到的请求信息，主要用于测试或诊断CONNECTHTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器OPTIONS请求查询服务器的性能，或者查询与资源相关的选项和需求 状态响应码： 当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含HTTP状态码的信息头（Server Header）用以响应浏览器的请求。
HTTP状态码分为五类： 1**：信息，服务器收到请求，需要请求者继续执行操作；
2**：成功，操作被成功接收并处理；
3**：重定向，需要进一步的操作以完成请求；
4**：客户端错误，请求包含语法错误或无法完成请求；
5**：服务器错误，服务器在处理请求的过程中发生了错误。
常见状态代码和状态说明： 200 OK： 请求成功，一般用于GET或POST请求。
302 Fund： 临时移动，资源只是临时被移动，客户端应继续使用原有URI。
400 Bad Request： 客户端请求有语法错误，不能被服务器所理解。
401 Unauthorized： 请求要求用户的身份认证。
403 Forbidden： 服务器理解请求客户端的请求，但是拒绝执行此请求。
404 Not Found： 服务器无法根据客户端的请求找到资源。
500 Internal Server Error： 服务器内部错误，无法完成请求。
503 Server Unavailable： 由于超载或系统维护，服务器暂时无法处理客户端请求。
请求头信息与响应头信息：
请求头信息：请求报头允许客户端向服务器端传递请求的附加信息以及客户端自身的信息，常用的请求报头如下：
Accept：浏览器可接受的MIME类型。
Accept-Encoding：浏览器能够进行解码的数据编码方式，比如gzip。
Accept-Language：浏览器所希望的语言种类，当服务器能够提供一种以上的语言版本时会用到。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6907d823abc1cc76f5394bb17fbcb0cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-04T13:19:48+08:00" />
<meta property="article:modified_time" content="2018-08-04T13:19:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《Web接口开发与自动化测试基于Python语言》--第8章</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="第8章-开发web接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>第8章 开发web接口</strong></span></h2> 
<blockquote> 
 <p style="margin-left:0px;"><span style="color:#999999;">因为要对web接口进行测试，虫师在前面大致讲解了web开发的过程，接下来就是web接口开发。所以，了解了什么是web接口开发，也就很容易进行web接口测试了。</span></p> 
</blockquote> 
<p style="margin-left:0px;"> </p> 
<h3 id="81-为何要开发web接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t1"></a>8.1 为何要开发Web接口</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">总的来说，就是当开发大型B/S架构的程序时，前后端分离，当前端想要调用后台程序，只需要调用接口即可。这样带来的好处就是：</span></p> 
<ol style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">后端不必精通前端技术（HTML5/JavaScript/CSS），只专注于数据的处理并提供Web接口即可；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">前端的专业性越来越高，通过调用Web接口获取数据，从而专注于数据展示和页面交互设计；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Web接口的应用范围更加广泛，由后端开发的接口既可以提供给Web页面调用，也可以提供移动APP调用等；</span></p> </li></ol> 
<p style="margin-left:0px;"> </p> 
<h3 id="82-什么是web接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t2"></a>8.2 什么是Web接口</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">通过数据传输协议（eg：HTTP/SOAP……）传输一定格式（eg：XML/JSON/CSV……）数据的接口。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">在当前Web接口中，HTTP协议+JSON数据格式，是目前最流行的两个接口技术。</span></p> 
<h4 id="821-http" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t3"></a>8.2.1 HTTP</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">HTTP（Hyper Text Transfer Protocol，超文本传输协议）</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">主要特点：</span></p> 
  <ol style="margin-left:32px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>无连接：</strong>无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接，采用这种方式可以节省传输时间；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>媒体独立：</strong>只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送，客户端和服务器指定使用适合的MIME-type内容类型；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>无状态：</strong>无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大，如果服务器不需要先前的信息，那么它的应答就比较快。</span></p> </li></ol></li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">HTTP请求方法：</span></p> </li></ul> 
<table border="1" cellspacing="0"><thead><tr><th style="background-color:#eff3f5;text-align:left;vertical-align:middle;">请求方法</th><th style="background-color:#eff3f5;text-align:left;vertical-align:middle;">说明（V1.1）</th></tr></thead><tbody><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">GET</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">请求指定的页面信息，并返回实体主体</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">POST</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中，POST请求可能会导致新的资源的建立或已有资源的修改</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">HEAD</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">PUT</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">从客户端向服务器传送的数据取代指定文档的内容</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">DELETE</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">请求服务器删除指定的页面</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">TRACE</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">请求服务器返回收到的请求信息，主要用于测试或诊断</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">CONNECT</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器</span></td></tr><tr><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">OPTIONS</span></td><td style="background-color:#ffffff;border-color:#dddddd;text-align:left;vertical-align:middle;"><span style="color:#4f4f4f;">请求查询服务器的性能，或者查询与资源相关的选项和需求</span></td></tr></tbody></table> 
<p style="margin-left:0px;"> </p> 
<ul style="margin-left:0px;"><li>状态响应码：</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含HTTP状态码的信息头（Server Header）用以响应浏览器的请求。</span></p> 
<ul style="margin-left:0px;"><li>HTTP状态码分为五类：</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>1**：</strong>信息，服务器收到请求，需要请求者继续执行操作；</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>2**：</strong>成功，操作被成功接收并处理；</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>3**：</strong>重定向，需要进一步的操作以完成请求；</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>4**：</strong>客户端错误，请求包含语法错误或无法完成请求；</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>5**：</strong>服务器错误，服务器在处理请求的过程中发生了错误。</span></p> 
<ul style="margin-left:0px;"><li>常见状态代码和状态说明：</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>200 OK：</strong> 请求成功，一般用于GET或POST请求。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>302 Fund：</strong> 临时移动，资源只是临时被移动，客户端应继续使用原有URI。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>400 Bad Request：</strong> 客户端请求有语法错误，不能被服务器所理解。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>401 Unauthorized：</strong> 请求要求用户的身份认证。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>403 Forbidden：</strong> 服务器理解请求客户端的请求，但是拒绝执行此请求。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>404 Not Found：</strong> 服务器无法根据客户端的请求找到资源。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>500 Internal Server Error：</strong> 服务器内部错误，无法完成请求。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><strong>503 Server Unavailable：</strong> 由于超载或系统维护，服务器暂时无法处理客户端请求。</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">请求头信息与响应头信息：</span></p> 
  <ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">请求头信息：请求报头允许客户端向服务器端传递请求的附加信息以及客户端自身的信息，常用的请求报头如下：</span></p> 
    <ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Accept：浏览器可接受的MIME类型。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Accept-Encoding：浏览器能够进行解码的数据编码方式，比如gzip。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Accept-Language：浏览器所希望的语言种类，当服务器能够提供一种以上的语言版本时会用到。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Connection：表示是否需要持久连接，从HTTP/1.1起，默认都开启了Keep-Alive，保持连接特性。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Host：初始URL中的主机和端口，它通常是从HTTP URL中提取出来的。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">User-Agent：请求报头域允许客户端将它的操作系统、浏览器和其他属性告诉服务器。</span></p> </li></ul></li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">响应头信息：响应报头允许服务器传递不能放在状态行中的附加响应信息，以及关于服务器的信息和对Request-URI所标识的资源进行下一步访问的信息，常用的响应报头如下：</span></p> 
    <ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Content-Type：表示后面的文档属于哪种MIME类型。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Date：当前的GMT（国际时间）。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">Server：包含了服务器用来处理请求的软件信息。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">X-Frame-Options：用来给浏览器指示允许一个页面可否在<code>&lt;frame&gt;</code>、<code>&lt;iframe&gt;</code>或<code>&lt;object&gt;</code>中展现的标记。网站可以使用此功能，来确保自己网站的内容没有被嵌到别人的网站中去，从而避免了点击劫持（click jacking）的攻击。</span></p> </li></ul></li></ul></li></ul> 
<h4 id="822-json格式" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t4"></a>8.2.2 JSON格式</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">JSON：JavaScript Object Notation，即JavaScript对象表示法。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">JSON解析器和JSON库支持不同的编程语言，JSON具有自我描述性，很容易理解。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">JSON语法是JavaScript对象表示法语法的子集：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">数据在名称/值对中。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">数据由逗号分隔。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">花括号保存对象。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">方括号保存数组。</span></p> </li></ul> 
<p style="margin-left:0px;"> </p> 
<h3 id="83-开发系统web接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t5"></a>8.3 开发系统Web接口</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">继续开发之前的发布会签到系统的Web接口。</span></p> 
<h4 id="831-配置接口路径" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t6"></a>8.3.1 配置接口路径</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">开发Web接口的访问方式与开发系统的访问方式相同，为了进行区分，这里设置Web接口的根目录为“/api/”，通过二级目录表示实现具体功能的接口。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">eg：</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><a href="http://127.0.0.1:8000/api/add_event/" rel="nofollow">http://127.0.0.1:8000/api/add_event/</a> 表示添加发布会接口 <br><a href="http://127.0.0.1:8000/api/get_event_list/" rel="nofollow">http://127.0.0.1:8000/api/get_event_list/</a> 表示查询发布会接口</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改/home/test/guest/guest/urls.py文件，添加接口根路径“/api/”：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#000088"&gt;from&lt;/span&gt; django.conf.urls &lt;span style="color:#000088"&gt;import&lt;/span&gt; url, include

urlpatterns = [
    ……
    url(&lt;span style="color:#009900"&gt;r'^api/'&lt;/span&gt;, include(&lt;span style="color:#009900"&gt;'sign.urls'&lt;/span&gt;, namespace=&lt;span style="color:#009900"&gt;"sign"&lt;/span&gt;)),
]&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">在sign应用下创建urls.py文件，即/home/test/guest/sign/urls.py，用来配置具体接口的二级目录：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#000088"&gt;from&lt;/span&gt; django.conf.urls &lt;span style="color:#000088"&gt;import&lt;/span&gt; url
&lt;span style="color:#000088"&gt;from&lt;/span&gt; sign &lt;span style="color:#000088"&gt;import&lt;/span&gt; views_if

urlpatterns = [
    &lt;span style="color:#880000"&gt;# sign system interface:&lt;/span&gt;
    &lt;span style="color:#880000"&gt;# ex: /api/add_event/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^add_event/'&lt;/span&gt;, views_if.add_event, name=&lt;span style="color:#009900"&gt;'add_event'&lt;/span&gt;),
    &lt;span style="color:#880000"&gt;# ex: /api/add_guest/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^add_guest/'&lt;/span&gt;, views_if.add_guest, name=&lt;span style="color:#009900"&gt;'add_guest'&lt;/span&gt;),
    &lt;span style="color:#880000"&gt;# ex: /api/get_event_list/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^get_event_list'&lt;/span&gt;, views_if.get_event_list, name=&lt;span style="color:#009900"&gt;'get_event_list'&lt;/span&gt;),
    &lt;span style="color:#880000"&gt;# ex: /api/get_event_list/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^get_event_list'&lt;/span&gt;, views_if.get_event_list, name=&lt;span style="color:#009900"&gt;'get_event_list'&lt;/span&gt;),
    &lt;span style="color:#880000"&gt;# ex: /api/get_guest_list/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^get_guest_list'&lt;/span&gt;, views_if.get_guest_list, name=&lt;span style="color:#009900"&gt;'get_guest_list'&lt;/span&gt;),
    &lt;span style="color:#880000"&gt;# ex: /api/user_sign/&lt;/span&gt;
    url(&lt;span style="color:#009900"&gt;r'^user_sign'&lt;/span&gt;, views_if.user_sign, name=&lt;span style="color:#009900"&gt;'user_sign'&lt;/span&gt;),
]&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">这里看到我们从sign导入了一个views_if，这是为了避免Web接口代码与views.py文件中的系统功能代码混在一起，因此需要重新在sign应用下创建views_if.py文件，即/home/test/guest/sign/views_if.py文件，用于Web接口的开发。</span></p> 
<h4 id="832-添加发布会接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t7"></a>8.3.2 添加发布会接口</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改文件/home/test/guest/sign/views_if.py，增加发布会接口：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#880000"&gt;#! /usr/bin python&lt;/span&gt;
&lt;span style="color:#880000"&gt;# -*- coding:utf-8 -*-&lt;/span&gt;


&lt;span style="color:#000088"&gt;from&lt;/span&gt; django.http &lt;span style="color:#000088"&gt;import&lt;/span&gt; JsonResponse
&lt;span style="color:#000088"&gt;from&lt;/span&gt; sign.models &lt;span style="color:#000088"&gt;import&lt;/span&gt; Event
&lt;span style="color:#000088"&gt;from&lt;/span&gt; django.core.exceptions &lt;span style="color:#000088"&gt;import&lt;/span&gt; ValidationError


&lt;span style="color:#880000"&gt;# 添加发布会接口&lt;/span&gt;
&lt;span style="color:#000088"&gt;def&lt;/span&gt; &lt;span style="color:#009900"&gt;add_event&lt;/span&gt;&lt;span style="color:#4f4f4f"&gt;(request)&lt;/span&gt;:
    eid = request.POST.get(&lt;span style="color:#009900"&gt;'eid'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    name = request.POST.get(&lt;span style="color:#009900"&gt;'name'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    limit = request.POST.get(&lt;span style="color:#009900"&gt;'limit'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    status = request.POST.get(&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    address = request.POST.get(&lt;span style="color:#009900"&gt;'address'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    start_time = request.POST.get(&lt;span style="color:#009900"&gt;'start_time'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; name == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; limit == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; address == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; start_time == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10021&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'parameter error'&lt;/span&gt;})

    result = Event.objects.filter(id=eid)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event id already exists'&lt;/span&gt;})

    result = Event.objects.filter(name=name)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10023&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event name already exists'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; status == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        status = &lt;span style="color:#006666"&gt;1&lt;/span&gt;
    &lt;span style="color:#000088"&gt;try&lt;/span&gt;:
        Event.objects.create(id=eid, name=name, limit=limit, address=address, status=int(status), start_time=start_time)
    &lt;span style="color:#000088"&gt;except&lt;/span&gt; ValidationError &lt;span style="color:#000088"&gt;as&lt;/span&gt; e:
        error = &lt;span style="color:#009900"&gt;'start_time format error. It must be in YYYY-MM-DD HH:MM:SS format.'&lt;/span&gt;
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10024&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:error})

    &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'add event success'&lt;/span&gt;})&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li><li>37</li><li>38</li><li>39</li><li>40</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">对上面代码进行分析：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">首先，通过POST请求接收发布会参数，包括发布会id、名称、人数、状态、地址和时间；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">然后，判断eid、name、limit、address、start_time是否为空，如果为空则返回参数错误；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">然后，判断eid、name是否存在，如果存在说明添加数据重复，返回对应状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">然后，判断status，状态不是必传字段，如果判断为空，则置为1=True=开启状态；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">最后，将数据插入Event表，如果插入数据日期格式错误，则抛出ValidationError异常，异常处理接收该异常并返回响应的状态码和提示，否则插入成功，返回200状态码。</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><span style="color:#ff0000;"><strong>注意：</strong></span></span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">JsonResponse()是一个非常有用的类，它可以将字典转化成JSON格式返回给客户端。</span></p> 
<h4 id="833-查询发布会接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t8"></a>8.3.3 查询发布会接口</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改文件/home/test/guest/sign/views_if.py，增加发布会查询接口：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#880000"&gt;# 查询发布会接口&lt;/span&gt;
&lt;span style="color:#000088"&gt;def&lt;/span&gt; &lt;span style="color:#009900"&gt;get_event_list&lt;/span&gt;&lt;span style="color:#4f4f4f"&gt;(request)&lt;/span&gt;:
    eid = request.GET.get(&lt;span style="color:#009900"&gt;'eid'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    name = request.GET.get(&lt;span style="color:#009900"&gt;'name'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;and&lt;/span&gt; name == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10021&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'parameter error'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid != &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        event = {}
        &lt;span style="color:#000088"&gt;try&lt;/span&gt;:
            result = = Event.objects.get(id=eid)
        &lt;span style="color:#000088"&gt;except&lt;/span&gt; ObjectDoesNotExist:
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'query result is empty'&lt;/span&gt;})
        &lt;span style="color:#000088"&gt;else&lt;/span&gt;:
            event[&lt;span style="color:#009900"&gt;'name'&lt;/span&gt;] = result.name
            event[&lt;span style="color:#009900"&gt;'limit'&lt;/span&gt;] = result.limit
            event[&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;] = result.status
            event[&lt;span style="color:#009900"&gt;'address'&lt;/span&gt;] = result.address
            event[&lt;span style="color:#009900"&gt;'start_time'&lt;/span&gt;] = result.start_time
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'success'&lt;/span&gt;, &lt;span style="color:#009900"&gt;'data'&lt;/span&gt;:event})
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; name != &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        datas = []
        results = Event.objects.filter(name__contains=name)
        &lt;span style="color:#000088"&gt;if&lt;/span&gt; results:
            &lt;span style="color:#000088"&gt;for&lt;/span&gt; r &lt;span style="color:#000088"&gt;in&lt;/span&gt; results:
                event = {}
                event[&lt;span style="color:#009900"&gt;'name'&lt;/span&gt;] = r.name
                event[&lt;span style="color:#009900"&gt;'limit'&lt;/span&gt;] = r.limit
                event[&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;] = r.status
                event[&lt;span style="color:#009900"&gt;'address'&lt;/span&gt;] = r.address
                event[&lt;span style="color:#009900"&gt;'start_time'&lt;/span&gt;] = r.start_time
                datas.append(event)
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'success'&lt;/span&gt;, &lt;span style="color:#009900"&gt;'data'&lt;/span&gt;:datas})
        &lt;span style="color:#000088"&gt;else&lt;/span&gt;:
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'query result is empty'&lt;/span&gt;})&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">对上述代码进行分析：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">通过GET请求接收发布会id（eid）和发布会名称（name），两个参数都为可选项，但不能同时为空，否则接口代码返回状态码10021和parameter error错误提示；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">如果发布会id不为空，则优先使用发布会id查询，因为id具有唯一性，所以，查询结果只会有一条。将查询结果以字典的形式存放到定义的event中，并将event作为借口返回字典中data对应的值；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">发布会名称name为模糊查询，查询数据可能会有多条，返回的数据格式会稍显复杂，首先将查询的每一条数据放到一个event字典中，再把每个event字典放到datas数组中，最后将整个datas数组作为借口返回字典中的data对应的值。</span></p> </li></ul> 
<h4 id="834-添加嘉宾接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t9"></a>8.3.4 添加嘉宾接口</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改文件/home/test/guest/sign/views_if.py，增加添加嘉宾接口：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#000088"&gt;from&lt;/span&gt; sign.models &lt;span style="color:#000088"&gt;import&lt;/span&gt; Event, Guest
&lt;span style="color:#000088"&gt;from&lt;/span&gt; django.db.utils &lt;span style="color:#000088"&gt;import&lt;/span&gt; IntegrityError
&lt;span style="color:#000088"&gt;import&lt;/span&gt; time

&lt;span style="color:#880000"&gt;# 添加嘉宾接口&lt;/span&gt;
&lt;span style="color:#000088"&gt;def&lt;/span&gt; &lt;span style="color:#009900"&gt;add_guest&lt;/span&gt;&lt;span style="color:#4f4f4f"&gt;(request)&lt;/span&gt;:
    eid = request.POST.get(&lt;span style="color:#009900"&gt;'eid'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    realname = request.POST.get(&lt;span style="color:#009900"&gt;'realname'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    phone = request.POST.get(&lt;span style="color:#009900"&gt;'phone'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    email = request.POST.get(&lt;span style="color:#009900"&gt;'email'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; realname == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; phone == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10021&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'parameter error'&lt;/span&gt;})

    result = Event.objects.filter(id=eid)
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event id null'&lt;/span&gt;})

    result = Event.objects.get(id=eid).status
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10023&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event status is not available'&lt;/span&gt;})

    event_limit = Event.objects.get(id=eid).limit
    guest_limit = Guest.objects.filter(event_id=eid)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; len(guest_limit) &gt;= event_limit:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10024&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event number is full'&lt;/span&gt;})

    event_time = Event.objects.get(id=eid).start_time
    etime = str(event_time).split(&lt;span style="color:#009900"&gt;"."&lt;/span&gt;)[&lt;span style="color:#006666"&gt;0&lt;/span&gt;]
    timeArray = time.strptime(etime, &lt;span style="color:#009900"&gt;"%Y-%m-%d %H:%M:%S"&lt;/span&gt;)
    e_time = int(time.mktime(timeArray))
    now_time = str(time.time())
    ntime = now_time.split(&lt;span style="color:#009900"&gt;"."&lt;/span&gt;)[&lt;span style="color:#006666"&gt;0&lt;/span&gt;]
    n_time = int(ntime)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; n_time &gt;= e_time:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10025&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event has started'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;try&lt;/span&gt;:
        Guest.objects.create(realname=realname, phone=int(phone), email=email, sign=&lt;span style="color:#006666"&gt;0&lt;/span&gt;, event_id=int(eid))
    &lt;span style="color:#000088"&gt;except&lt;/span&gt; IntegrityError:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10026&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'the event guest phone number repeat'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'stauts'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'add guest success'&lt;/span&gt;})&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li><li>37</li><li>38</li><li>39</li><li>40</li><li>41</li><li>42</li><li>43</li><li>44</li><li>45</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">对上述代码进行分析：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">通过POST请求接受嘉宾参数：关联发布会id（eid）、姓名（realname）、手机号（phone）和邮箱（mail）等参数；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断eid、realname、phone等参数均不为空；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断嘉宾管理的发布会id（eid）是否存在，以及关联的发布会状态是否为True（即1），如果不为True，则说明当前为关闭状态，返回相应的状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断当前时间是否大于发布会时间，如果大于则说明发布会已经开始，或者早已经结束。那么该发布会就不能再添加嘉宾了；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">插入嘉宾数据，如果手机号（phone）已存在，则抛出IntegrityError异常，接收该异常并返回相应的状态码和提示信息，如果插入成功，则返回状态码200和提示信息。</span></p> </li></ul> 
<h4 id="835-查询嘉宾接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t10"></a>8.3.5 查询嘉宾接口</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改文件/home/test/guest/sign/views_if.py，增加查询嘉宾接口：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#880000"&gt;# 查询嘉宾接口&lt;/span&gt;
&lt;span style="color:#000088"&gt;def&lt;/span&gt; &lt;span style="color:#009900"&gt;get_guest_list&lt;/span&gt;&lt;span style="color:#4f4f4f"&gt;(request)&lt;/span&gt;:
    eid = request.POST.get(&lt;span style="color:#009900"&gt;'eid'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    phone = request.POST.get(&lt;span style="color:#009900"&gt;'phone'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10021&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'eid cannot be empty'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid != &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;and&lt;/span&gt; phone == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        datas = []
        results = Guest.objects.filter(event_id=eid)
        &lt;span style="color:#000088"&gt;if&lt;/span&gt; results:
            &lt;span style="color:#000088"&gt;for&lt;/span&gt; r &lt;span style="color:#000088"&gt;in&lt;/span&gt; results:
                guest = {}
                guest[&lt;span style="color:#009900"&gt;'realname'&lt;/span&gt;] = r.realname
                guest[&lt;span style="color:#009900"&gt;'phone'&lt;/span&gt;] = r.phone
                guest[&lt;span style="color:#009900"&gt;'email'&lt;/span&gt;] = r.email
                guest[&lt;span style="color:#009900"&gt;'sign'&lt;/span&gt;] = r.sign
                datas.append(guest)
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'success'&lt;/span&gt;, &lt;span style="color:#009900"&gt;'data'&lt;/span&gt;:datas})
        &lt;span style="color:#000088"&gt;else&lt;/span&gt;:
            &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'query  result is empty'&lt;/span&gt;})

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid != &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;and&lt;/span&gt; phone != &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
            guest = {}
            &lt;span style="color:#000088"&gt;try&lt;/span&gt;:
                result = Guest.objects.get(phone=phone, event_id=eid)
            &lt;span style="color:#000088"&gt;except&lt;/span&gt; ObjectDoesNotExist:
                &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'query result is empty'&lt;/span&gt;})
            &lt;span style="color:#000088"&gt;else&lt;/span&gt;:
                guest[&lt;span style="color:#009900"&gt;'realname'&lt;/span&gt;] = result.realname
                guest[&lt;span style="color:#009900"&gt;'phone'&lt;/span&gt;] = result.phone
                guest[&lt;span style="color:#009900"&gt;'email'&lt;/span&gt;] = result.email
                guest[&lt;span style="color:#009900"&gt;'sign'&lt;/span&gt;] = result.sign
                &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'success'&lt;/span&gt;, &lt;span style="color:#009900"&gt;'data'&lt;/span&gt;:guest})&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">对上述代码进行分析：</span></p> 
<ul style="margin-left:0px;"><li>查询嘉宾接口与查询发布会接口相似，只是参数和查询条件的判断有所不同，这里不再赘述。</li></ul> 
<h4 id="836-发布会签到接口" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t11"></a>8.3.6 发布会签到接口</strong></span></h4> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">修改文件/home/test/guest/sign/views_if.py，增加发布会签到接口：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-python"&gt;&lt;span style="color:#880000"&gt;# 嘉宾签到接口&lt;/span&gt;
&lt;span style="color:#000088"&gt;def&lt;/span&gt; &lt;span style="color:#009900"&gt;user_sign&lt;/span&gt;&lt;span style="color:#4f4f4f"&gt;(request)&lt;/span&gt;:
    eid = request.POST.get(&lt;span style="color:#009900"&gt;'eid'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)
    phone = request.POST.get(&lt;span style="color:#009900"&gt;'phone'&lt;/span&gt;, &lt;span style="color:#009900"&gt;''&lt;/span&gt;)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; eid == &lt;span style="color:#009900"&gt;''&lt;/span&gt; &lt;span style="color:#000088"&gt;or&lt;/span&gt; phone == &lt;span style="color:#009900"&gt;''&lt;/span&gt;:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'stauts'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10021&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'parameter error'&lt;/span&gt;})

    result = Event.objects.filter(id=eid)
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'stauts'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10022&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event id null'&lt;/span&gt;})

    result = Event.objects.get(id=eid).stauts
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'stauts'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10023&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event status is not available'&lt;/span&gt;})

    event_time = Event.objects.get(id=eid).start_time
    etime = str(event_time).split(&lt;span style="color:#009900"&gt;"."&lt;/span&gt;)[&lt;span style="color:#006666"&gt;0&lt;/span&gt;]
    timeArray = time.strptime(etime, &lt;span style="color:#009900"&gt;"%Y-%m-%d %H:%M:%S"&lt;/span&gt;)
    e_time = int(time.mktime(timeArray))

    now_time = str(time.time())
    ntime = now_time.split(&lt;span style="color:#009900"&gt;"."&lt;/span&gt;)[&lt;span style="color:#006666"&gt;0&lt;/span&gt;]
    n_time = int(ntime)

    &lt;span style="color:#000088"&gt;if&lt;/span&gt; n_time &gt;= e_time:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10024&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'event has started'&lt;/span&gt;})

    result = Guest.objects.filter(phone=phone)
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10025&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'user phone null'&lt;/span&gt;})

    result = Guest.objects.filter(event_id=eid, phone=phone)
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10026&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'user did not participate in the conference'&lt;/span&gt;})

    result = Guest.objects.get(event_id=eid, phone=phone).sign
    &lt;span style="color:#000088"&gt;if&lt;/span&gt; &lt;span style="color:#000088"&gt;not&lt;/span&gt; result:
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;10027&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'user has sign in'&lt;/span&gt;})
    &lt;span style="color:#000088"&gt;else&lt;/span&gt;:
        Guest.objects.filter(event_id=eid, phone=phone).update(sign=&lt;span style="color:#009900"&gt;'1'&lt;/span&gt;)
        &lt;span style="color:#000088"&gt;return&lt;/span&gt; JsonResponse({&lt;span style="color:#009900"&gt;'status'&lt;/span&gt;:&lt;span style="color:#006666"&gt;200&lt;/span&gt;, &lt;span style="color:#009900"&gt;'message'&lt;/span&gt;:&lt;span style="color:#009900"&gt;'sign success'&lt;/span&gt;})&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li><li>37</li><li>38</li><li>39</li><li>40</li><li>41</li><li>42</li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">对上述代码进行分析：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">签到接口通过POST请求接收参数：发布会id（eid）、嘉宾手机号（phone）；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断发布会id（eid）和嘉宾手机号（phone）两个参数均不能为空；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">通过查询发布会表判断发布会id（eid）是否存在，如果不存在，则返回相应的状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">再判断发布会状态是否为True，如果不为True，则说明发布会状态当前未开启，返回相应的状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断当前时间是否大于发布会时间，如果大于则说明发布会已经开始，不允许签到；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">再判断嘉宾的手机号是否存在，如果不存在，则返回相应的状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断嘉宾的手机号与发布会id是否为对应关系，如果不是对应关系，则返回相应的状态码和提示信息；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">判断该嘉宾的状态是否为已签到，如果已签到，则返回相应的状态码和提示信息，如果未签到，则修改状态为已签到，并返回状态码200和提示信息。</span></p> </li></ul> 
<h3 id="84-编写web接口文档" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t12"></a>8.4 编写Web接口文档</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">通过接口文档，可以方便其他人调用你的接口，接口文档必须满足以下：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">信息完整</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">及时更新</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">内容准确</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">以下就是上述接口对应的接口文档：</span></p> 
<ol style="margin-left:0px;"><li>发布会接口</li></ol> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;"><img alt="这里写图片描述" class="has" src="https://images2.imgbox.com/60/f9/Vg9PGqMY_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">其余接口也基本都类似，这里也就不再赘述了。</span></p> 
<h3 id="85-总结" style="margin-left:0px;"><span style="color:#4f4f4f;"><strong><a name="t13"></a>8.5 总结</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">本章主要是讲解了接口的概念，以及如何实现接口，以及接口文档的范例。对于如何调用接口，本章还未提及，应该是下面章节的内容了。</span></p> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">我们可以总结出接口代码的特点：</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">通过GET/POST接收参数</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">对传入的参数进行判断</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">对合法参数进行数据库的插入或查询</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4f4f4f;">对每一步无论正确与否都返回状态码和提示信息</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4f4f4f;">记住以上这些内容，基本就掌握接口的概念了。期待下一章的内容。</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4819793660c6119c2d8c2420fbff4c79/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;环境配置（MinGW的下载及安装）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62941c397bb77c0a8f4aeb15359f61d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">应届生Java面试经验总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>