<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android 拍照使用fileprovider遇到的坑 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android 拍照使用fileprovider遇到的坑" />
<meta property="og:description" content="废话少说，直接进入正题。 最大的坑是：
Process: com.android.camera2, PID: 20419 java.lang.SecurityException: Permission Denial: opening provider android.support.v4.content.FileProvider from ProcessRecord{4238a238 20419:com.android.camera2/u0a30} (pid=20419, uid=10030) that is not exported from uid 10143 其实字面意思上已经很好理解了，缺少权限，注意：5.0以上的手机是不会报这个错的 然后我就在网上搜，应该会有这方面的资料吧，搜了好长时间，国外的网站都翻了，除了exported和grantUriPermissions在manifest上设置外，竟然没有别的资料。 第二天，我觉得可能是我搜得不对，终于我搜到了一个靠谱的
intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION); 我想，这回肯定没问题了，但是结果总是出乎你的意料之外，竟然还是报错~~~~ 这可咋整，接着搜，点开一篇文章，没报什么希望，是介绍7.0的拍照调用fileprovider的，嗯？有不一样的设置
List&lt;ResolveInfo&gt; resInfoList= getPackageManager().queryIntentActivities(takePictureIntent, PackageManager.MATCH_DEFAULT_ONLY); for (ResolveInfo resolveInfo : resInfoList) { String packageName = resolveInfo.activityInfo.packageName; grantUriPermission(packageName, photoURI, Intent.FLAG_GRANT_WRITE_URI_PERMISSION); } 试试吧，一试，成了，太激动了，这是一款4.4.4的手机，没毛病~~~ 还有一款4.2.2的手机，一试，这个还报错，想了想，这个list循环只加了write权限，估计是缺少read权限，一加，果然好使！ 就此，这个深坑解决啦，希望别的网友也能看到这篇帖子 最后链接上给我思路的博客： http://www.jianshu.com/p/a1eb3ad79ef6 感谢！ 最后附上拍照源码：
private void take() { // 激活系统的照相机进行拍照 String filePath = AppConfig.CIVIL_WORKER_PATH &#43; AppConfig.CHECK_PHOTO; File outputFile = new File(filePath); if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/67272799aa839d2fa2e33c9b7c3c7e55/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-11T14:34:15+08:00" />
<meta property="article:modified_time" content="2017-07-11T14:34:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android 拍照使用fileprovider遇到的坑</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>废话少说，直接进入正题。 <br> 最大的坑是：</p> 
<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-label">Process:</span> <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.android</span><span class="hljs-preprocessor">.camera</span>2, PID: <span class="hljs-number">20419</span>                                     java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.SecurityException</span>: Permission Denial: opening provider android<span class="hljs-preprocessor">.support</span><span class="hljs-preprocessor">.v</span>4<span class="hljs-preprocessor">.content</span><span class="hljs-preprocessor">.FileProvider</span> from ProcessRecord{<!-- --><span class="hljs-number">4238</span>a238 <span class="hljs-number">20419</span>:<span class="hljs-keyword">com</span><span class="hljs-preprocessor">.android</span><span class="hljs-preprocessor">.camera</span>2/u0a30} (pid=<span class="hljs-number">20419</span>, uid=<span class="hljs-number">10030</span>) that is not exported from uid <span class="hljs-number">10143</span></code></pre> 
<p>其实字面意思上已经很好理解了，缺少权限，注意：5.0以上的手机是不会报这个错的 <br> 然后我就在网上搜，应该会有这方面的资料吧，搜了好长时间，国外的网站都翻了，除了exported和grantUriPermissions在manifest上设置外，竟然没有别的资料。 <br> 第二天，我觉得可能是我搜得不对，终于我搜到了一个靠谱的</p> 
<pre class="prettyprint"><code class=" hljs avrasm">intent<span class="hljs-preprocessor">.addFlags</span>(Intent<span class="hljs-preprocessor">.FLAG</span>_GRANT_READ_URI_PERMISSION | Intent<span class="hljs-preprocessor">.FLAG</span>_GRANT_WRITE_URI_PERMISSION)<span class="hljs-comment">;</span></code></pre> 
<p>我想，这回肯定没问题了，但是结果总是出乎你的意料之外，竟然还是报错~~~~ <br> 这可咋整，接着搜，点开一篇文章，没报什么希望，是介绍7.0的拍照调用fileprovider的，嗯？有不一样的设置</p> 
<pre class="prettyprint"><code class=" hljs avrasm"> List&lt;ResolveInfo&gt; resInfoList= getPackageManager()<span class="hljs-preprocessor">.queryIntentActivities</span>(takePictureIntent, PackageManager<span class="hljs-preprocessor">.MATCH</span>_DEFAULT_ONLY)<span class="hljs-comment">;</span>
                for (ResolveInfo resolveInfo : resInfoList) {
                    String packageName = resolveInfo<span class="hljs-preprocessor">.activityInfo</span><span class="hljs-preprocessor">.packageName</span><span class="hljs-comment">;</span>
                    grantUriPermission(packageName, photoURI,
                            Intent<span class="hljs-preprocessor">.FLAG</span>_GRANT_WRITE_URI_PERMISSION)<span class="hljs-comment">;</span>
                }</code></pre> 
<p>试试吧，一试，成了，太激动了，这是一款4.4.4的手机，没毛病~~~ <br> 还有一款4.2.2的手机，一试，这个还报错，想了想，这个list循环只加了write权限，估计是缺少read权限，一加，果然好使！ <br> 就此，这个深坑解决啦，希望别的网友也能看到这篇帖子 <br> 最后链接上给我思路的博客： <br> <a href="http://www.jianshu.com/p/a1eb3ad79ef6" rel="nofollow noopener noreferrer" target="_blank">http://www.jianshu.com/p/a1eb3ad79ef6</a> <br> 感谢！ <br> 最后附上拍照源码：</p> 
<pre class="prettyprint"><code class=" hljs avrasm">private void take() {
        // 激活系统的照相机进行拍照
        String filePath = AppConfig<span class="hljs-preprocessor">.CIVIL</span>_WORKER_PATH + AppConfig<span class="hljs-preprocessor">.CHECK</span>_PHOTO<span class="hljs-comment">;</span>
        File outputFile = new File(filePath)<span class="hljs-comment">;</span>
        if (!outputFile<span class="hljs-preprocessor">.getParentFile</span>()<span class="hljs-preprocessor">.exists</span>()) {
            outputFile<span class="hljs-preprocessor">.getParentFile</span>()<span class="hljs-preprocessor">.mkdir</span>()<span class="hljs-comment">;</span>
        }
        Uri photoURI = FileProvider<span class="hljs-preprocessor">.getUriForFile</span>(activity,
                getPackageName() + <span class="hljs-string">".fileprovider"</span>, outputFile)<span class="hljs-comment">;</span>
        //为拍摄的图片指定一个存储的路径
        Intent intent = new Intent(MediaStore<span class="hljs-preprocessor">.ACTION</span>_IMAGE_CAPTURE)<span class="hljs-comment">;</span>
        //设置权限
        List&lt;ResolveInfo&gt; resInfoList = getPackageManager()<span class="hljs-preprocessor">.queryIntentActivities</span>(intent, PackageManager<span class="hljs-preprocessor">.MATCH</span>_DEFAULT_ONLY)<span class="hljs-comment">;</span>
        for (ResolveInfo resolveInfo : resInfoList) {
            String packageName = resolveInfo<span class="hljs-preprocessor">.activityInfo</span><span class="hljs-preprocessor">.packageName</span><span class="hljs-comment">;</span>
            grantUriPermission(packageName, photoURI,                   Intent<span class="hljs-preprocessor">.FLAG</span>_GRANT_READ_URI_PERMISSION|Intent<span class="hljs-preprocessor">.FLAG</span>_GRANT_WRITE_URI_PERMISSION)<span class="hljs-comment">;</span>
        }
        intent<span class="hljs-preprocessor">.putExtra</span>(<span class="hljs-string">"camerasensortype"</span>, <span class="hljs-number">1</span>)<span class="hljs-comment">; // 调用后置摄像头</span>
        intent<span class="hljs-preprocessor">.putExtra</span>(MediaStore<span class="hljs-preprocessor">.EXTRA</span>_OUTPUT, photoURI)<span class="hljs-comment">;</span>
        startActivityForResult(intent, REQUEST_TAKE_PICTURE)<span class="hljs-comment">;</span>
    }</code></pre> 
<pre class="prettyprint"><code class=" hljs java"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> REQUEST_TAKE_PICTURE = <span class="hljs-number">100</span>;<span class="hljs-comment">//照相</span>
  <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onActivityResult</span>(<span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">int</span> resultCode, Intent data) {
        <span class="hljs-keyword">super</span>.onActivityResult(requestCode, resultCode, data);
        <span class="hljs-keyword">if</span> (resultCode == RESULT_OK &amp;&amp; requestCode == REQUEST_TAKE_PICTURE) {
            String filePath = AppConfig.CIVIL_WORKER_PATH + AppConfig.CHECK_PHOTO;
            Bitmap bitmap = BitmapUtils.getimage(filePath);
        }
    }</code></pre> 
<p>OVER</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fcc9240ea7bcb3ae70aad21f0b2aa508/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS8.0 UILabel切圆角之后有时边缘会有一条黑线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/53714c566ae4ce3057b49ef973bd0f34/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Spring】 - lookup-method和replaced-method使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>