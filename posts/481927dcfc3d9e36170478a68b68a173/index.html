<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JVM 类的加载过程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JVM 类的加载过程" />
<meta property="og:description" content="文章目录 1 类的生命周期2 类加载过程2.1 加载2.2 验证2.3 准备2.4 解析2.5 初始化 3 类卸载 1 类的生命周期 类从被加载到虚拟机内存中开始到卸载出内存为止，它的整个生命周期可以简单概括为 7 个阶段：：加载（Loading）、验证（Verification）、准备（Preparation）、解析（Resolution）、初始化（Initialization）、使用（Using）和卸载（Unloading）。其中，前三个阶段可以统称为连接（Linking）。
2 类加载过程 系统加载Class文件的三步：加载-&gt;链接-&gt;初始化。链接过程又可分为三步：验证-&gt;准备-&gt;解析
2.1 加载 类加载过程的第一步，主要完成下面 3 件事情：
通过全类名获取定义此类的二进制字节流。将字节流所代表的静态存储结构转换为方法区的运行时数据结构。在内存中生成一个代表该类的 Class 对象，作为方法区这些数据的访问入口。 加载这一步主要是通过我们后面要讲到的 类加载器 完成的。类加载器有很多种，当我们想要加载一个类的时候，具体是哪个类加载器加载由 双亲委派模型 决定（不过，我们也能打破由双亲委派模型）。
每个 Java 类都有一个引用指向加载它的 ClassLoader。不过，数组类不是通过 ClassLoader 创建的，而是 JVM 在需要的时候自动创建的，数组类通过getClassLoader()方法获取 ClassLoader 的时候和该数组的元素类型的 ClassLoader 是一致的。
加载阶段与连接阶段的部分动作(如一部分字节码文件格式验证动作)是交叉进行的，加载阶段尚未结束，连接阶段可能就已经开始了。
2.2 验证 验证是连接阶段的第一步，这一阶段的目的是确保 Class 文件的字节流中包含的信息符合《Java 虚拟机规范》的全部约束要求，保证这些信息被当作代码运行后不会危害虚拟机自身的安全。
验证阶段主要由四个检验阶段组成：
文件格式验证（Class 文件格式检查）元数据验证（字节码语义检查）字节码验证（程序语义检查）符号引用验证（类的正确性检查） 符号引用验证发生在类加载过程中的解析阶段，具体点说是 JVM 将符号引用转化为直接引用的时候。符号引用验证的主要目的是确保解析阶段能正常执行，如果无法通过符号引用验证，JVM 会抛出异常
2.3 准备 准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些内存都将在方法区中分配。对于该阶段有以下几点需要注意：
这时候进行内存分配的仅包括类变量（ Class Variables ，即静态变量，被 static 关键字修饰的变量，只与类相关，因此被称为类变量），而不包括实例变量。实例变量会在对象实例化时随着对象一块分配在 Java 堆中。从概念上讲，类变量所使用的内存都应当在 方法区 中进行分配。除了字符串常量池分配在堆中这里所设置的初始值&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/481927dcfc3d9e36170478a68b68a173/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-03T14:52:08+08:00" />
<meta property="article:modified_time" content="2023-04-03T14:52:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JVM 类的加载过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 类的生命周期</a></li><li><a href="#2__6" rel="nofollow">2 类加载过程</a></li><li><ul><li><a href="#21__10" rel="nofollow">2.1 加载</a></li><li><a href="#22__22" rel="nofollow">2.2 验证</a></li><li><a href="#23__35" rel="nofollow">2.3 准备</a></li><li><a href="#24__41" rel="nofollow">2.4 解析</a></li><li><a href="#25__44" rel="nofollow">2.5 初始化</a></li></ul> 
  </li><li><a href="#3__51" rel="nofollow">3 类卸载</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 类的生命周期</h2> 
<p>类从被加载到虚拟机内存中开始到卸载出内存为止，它的整个生命周期可以简单概括为 7 个阶段：：<strong>加载</strong>（Loading）、<strong>验证</strong>（Verification）、<strong>准备</strong>（Preparation）、<strong>解析</strong>（Resolution）、<strong>初始化</strong>（Initialization）、<strong>使用</strong>（Using）和<strong>卸载</strong>（Unloading）。其中，前三个阶段可以统称为<strong>连接</strong>（Linking）。<br> <img src="https://images2.imgbox.com/97/df/GnnEXoCJ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__6"></a>2 类加载过程</h2> 
<p>系统加载Class文件的三步：<strong>加载-&gt;链接-&gt;初始化</strong>。链接过程又可分为三步：<strong>验证-&gt;准备-&gt;解析</strong><br> <img src="https://images2.imgbox.com/69/49/xkQiIJqz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="21__10"></a>2.1 加载</h3> 
<p>类加载过程的第一步，主要完成下面 3 件事情：</p> 
<ol><li>通过<strong>全类名</strong>获取定义此类的<strong>二进制字节流。</strong></li><li>将字节流所代表的静态存储结构<strong>转换</strong>为方法区的运行时数据结构。</li><li>在内存中生成一个代表该类的 <strong>Class 对象</strong>，作为方法区这些数据的访问入口。</li></ol> 
<p>加载这一步主要是通过我们后面要讲到的 <strong>类加载器</strong> 完成的。类加载器有很多种，当我们想要加载一个类的时候，具体是哪个类加载器加载由 <strong>双亲委派模型</strong> 决定（不过，我们也能打破由双亲委派模型）。</p> 
<p>每个 Java 类都有一个引用指向加载它的 <strong>ClassLoader</strong>。不过，数组类不是通过 ClassLoader 创建的，而是 JVM 在需要的时候自动创建的，数组类通过<code>getClassLoader()</code>方法获取 ClassLoader 的时候和该数组的元素类型的 ClassLoader 是一致的。</p> 
<p><strong>加载阶段与连接阶段的部分动作(如一部分字节码文件格式验证动作)是交叉进行的</strong>，加载阶段尚未结束，连接阶段可能就已经开始了。</p> 
<h3><a id="22__22"></a>2.2 验证</h3> 
<p>验证是连接阶段的第一步，这一阶段的<strong>目的是确保 Class 文件的字节流中包含的信息符合《Java 虚拟机规范》的全部约束要求，保证这些信息被当作代码运行后不会危害虚拟机自身的安全。</strong></p> 
<p>验证阶段主要由<strong>四</strong>个检验阶段组成：</p> 
<ol><li>文件格式验证（Class 文件格式检查）</li><li>元数据验证（字节码语义检查）</li><li>字节码验证（程序语义检查）</li><li>符号引用验证（类的正确性检查）</li></ol> 
<p><img src="https://images2.imgbox.com/87/02/B1IK0bFF_o.png" alt="在这里插入图片描述"><br> <strong>符号引用验证发生在类加载过程中的解析阶段，具体点说是 JVM 将符号引用转化为直接引用的时候</strong>。符号引用验证的主要目的是确保解析阶段能正常执行，如果无法通过符号引用验证，JVM 会抛出异常</p> 
<h3><a id="23__35"></a>2.3 准备</h3> 
<p><strong>准备阶段是正式为类变量分配内存并设置类变量初始值的阶段</strong>，这些内存都将在方法区中分配。对于该阶段有以下几点需要注意：</p> 
<ol><li>这时候进行<strong>内存分配的仅包括类变量</strong>（ Class Variables ，即<strong>静态变量</strong>，被 static 关键字修饰的变量，只与类相关，因此被称为类变量），而不包括实例变量。<strong>实例变量会在对象实例化时随着对象一块分配在 Java 堆中</strong>。</li><li>从概念上讲，类变量所使用的内存都应当在 <strong>方法区</strong> 中进行分配。除了字符串常量池分配在堆中</li><li>这里所设置的初始值"通常情况"下是数据类型默认的零值（如 0、0L、null、false 等），比如我们定义了public static int value=111 ，那么 value 变量在准备阶段的初始值就是 0 而不是 111（初始化阶段才会赋值）。<strong>特殊情况</strong>：比如给 value 变量加上了 <strong>final</strong> 关键字public static final int value=111 ，那么准备阶段 value 的值就被赋值为 111。</li></ol> 
<h3><a id="24__41"></a>2.4 解析</h3> 
<p><strong>解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程。</strong> 解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用限定符 7 类符号引用进行。</p> 
<h3><a id="25__44"></a>2.5 初始化</h3> 
<p><strong>初始化阶段是执行初始化方法 <code>&lt;clinit&gt; ()</code>方法的过程，是类加载的最后一步，这一步 JVM 才开始真正执行类中定义的 Java 程序代码(字节码)。</strong></p> 
<blockquote> 
 <p><code>&lt;clinit&gt; ()</code>方法是编译之后自动生成的。</p> 
</blockquote> 
<p>对于初始化阶段，<strong>只有主动去使用类才会初始化类</strong></p> 
<h2><a id="3__51"></a>3 类卸载</h2> 
<p><strong>卸载类即该类的 Class 对象被 GC</strong></p> 
<p>卸载类需要满足 3 个要求:</p> 
<ol><li>该类的所有的<strong>实例对象都已被 GC</strong>，也就是说堆不存在该类的实例对象。</li><li>该类<strong>没有</strong>在其他任何地方<strong>被引用</strong></li><li>该类的<strong>类加载器的实例已被 GC</strong></li></ol> 
<p>所以，在 JVM 生命周期内，由 jvm 自带的类加载器加载的类是不会被卸载的。但是由我们自定义的类加载器加载的类是可能被卸载的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3ce4e0cc6782e851d0bfdfb59fc0cc39/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS 7 管理员密码遗忘如何处理（保姆级教程）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0135a4875cb564e29b645353b296d437/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL Server | 设置默认值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>