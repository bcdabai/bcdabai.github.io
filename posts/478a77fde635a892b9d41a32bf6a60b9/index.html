<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql8 主从复制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql8 主从复制" />
<meta property="og:description" content="文章目录 环境介绍原理官方解释白话版： 实现一、创建数据库一、主库操作 从库配置常见错误处理从库启动主从查询状态出现异常情况1：（从库查看运行状态出现Slave_IO_Running: No）情况2：（从库查看运行状态出现Slave_SQL_Running: No）开始解决问题（从库操作）关于其他错误MySql常见错误码 mysql主从复制常用命令创建用户相关权限相关 End; 环境介绍 提示：为方便新手与演示，本人使用宝塔面板进行环境快速搭建（与使用命令行搭建无异，仅文件位置可能稍有不用，不影响开发）
主库开发环境：Linux&#43;ContOS7&#43;MySql8&#43;php7（主）
从库A开发环境：Linux&#43;Ubuntu 20.04.1 &#43;MySql8&#43;php7（从A）
从库B开发环境：Linux&#43;Ubuntu 20.04.1 &#43;MySql8&#43;php7（从B）
服务器数量3台（服务器数量至少&gt;=2台）
原理 官方解释 1）主库master将数据的改变记录到binlog二进制日志中，
2）从库slave会在一定时间间隔内对主库master中的二进制文件进行检测是否发生改变，
如果发现主库master二进制文件有改变则从库slave会开始I/OThread线程请求主库master二进制事件
3）同时主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存在从节点本地的中继日志中，从节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，使得其数据和主节点的保持一致，最后I/OThread和SQLThread将进入睡眠状态，等待下一次被唤醒。
白话版： 主库master有个binlog二进制日志用来记录主库master上的数据改变。从库slave有2线程，一个是I/O线程，一个是SQL线程。从库的I/O线程会在一定时间间隔内主动请求主库的binlog主库被请求后生成一个log dump线程用来给从库的I/O线程传binlog从库将得到的binlog存在自己本地的relay-log（中继日志）文件中从库SQL线程会读取relay-log（中继日志）文件，并将内容解析成sql语句在从库上重新执行一遍这就完成了主从复制的过程End 实现 情景：搭建一主多从
主库公网ip:39.103.299.01
从库公网ip:115.28.137.02
一、创建数据库 在主服务器上创建数据库，将创建好的数据库文件备份。
2.在从库上创建数据库，并将主库的数据被备份在从库上导入。（目的：保证主从2个数据库是完全一致）
不导入也可以，不过有时会因为在主库新建表格，从库并没有自动创建，此时插入数据从库数据库日志会报错，导致主从复制关系失效！
一、主库操作 使用root权限登录主库mysql
mysql -u root -p 主库创建mysql用户，可以将用户设置为所有人都能访问，也可以设置成指定从库ip访问。
2.1 创建所有人都能访问mysql用户并设置密码create user &#39;用户名&#39;@&#39;%&#39;;
#创建用户rootslave并设置为设备都可登录 create user &#39;rootslave&#39;@&#39;%&#39;; 2.2为新用户设置密码set password for &#39;同户名&#39;@&#39;host&#39;=&#39;新的密码&#39;;
这里的host只有3种分别为 %(所有ip)、localhost(本服务器)、指定的服务器ip(如158.652.30.145)
#将用户rootslave的密码设为qwe123 set password for &#39;rootslave&#39;@&#39;%&#39;=&#39;qwe123&#39;; 2.3位新创建的用户设置权限grant replication slave on *.* to &#39;用户名&#39;@&#39;从服务ip（host）&#39;;
注意：我们不在这里设置同步的具体数据库名和数据库表，而是在mysql配置文件中进行设置，所以照这个命令敲即可！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/478a77fde635a892b9d41a32bf6a60b9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-30T17:14:46+08:00" />
<meta property="article:modified_time" content="2022-03-30T17:14:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql8 主从复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_3" rel="nofollow">环境介绍</a></li><li><a href="#_11" rel="nofollow">原理</a></li><li><ul><li><a href="#_14" rel="nofollow">官方解释</a></li><li><a href="#_19" rel="nofollow">白话版：</a></li></ul> 
  </li><li><a href="#_29" rel="nofollow">实现</a></li><li><ul><li><a href="#_34" rel="nofollow">一、创建数据库</a></li><li><a href="#_40" rel="nofollow">一、主库操作</a></li></ul> 
  </li><li><a href="#_118" rel="nofollow">从库配置</a></li><li><a href="#_152" rel="nofollow">常见错误处理</a></li><li><ul><li><a href="#_153" rel="nofollow">从库启动主从查询状态出现异常</a></li><li><ul><li><a href="#1Slave_IO_Running_No_154" rel="nofollow">情况1：（从库查看运行状态出现Slave_IO_Running: No）</a></li><li><a href="#2Slave_SQL_Running_No_158" rel="nofollow">情况2：（从库查看运行状态出现Slave_SQL_Running: No）</a></li><li><a href="#_165" rel="nofollow">开始解决问题（从库操作）</a></li><li><a href="#_179" rel="nofollow">关于其他错误</a></li><li><a href="#MySql_185" rel="nofollow">MySql常见错误码</a></li></ul> 
  </li></ul> 
  </li><li><a href="#mysql_252" rel="nofollow">mysql主从复制常用命令</a></li><li><ul><li><a href="#_253" rel="nofollow">创建用户相关</a></li><li><a href="#_292" rel="nofollow">权限相关</a></li></ul> 
  </li><li><a href="#End_326" rel="nofollow">End;</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_3"></a>环境介绍</h2> 
<p><font color="#999AAA">提示：为方便新手与演示，本人使用宝塔面板进行环境快速搭建（与使用命令行搭建无异，仅文件位置可能稍有不用，不影响开发）</font></p> 
<p>主库开发环境：Linux+ContOS7+MySql8+php7（主）<br> 从库A开发环境：Linux+Ubuntu 20.04.1 +MySql8+php7（从A）<br> 从库B开发环境：Linux+Ubuntu 20.04.1 +MySql8+php7（从B）<br> 服务器数量3台（服务器数量至少&gt;=2台）</p> 
<h2><a id="_11"></a>原理</h2> 
<p><img src="https://images2.imgbox.com/41/e0/X4JsUpX7_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_14"></a>官方解释</h3> 
<p>1）主库master将数据的改变记录到binlog二进制日志中，<br> 2）从库slave会在一定时间间隔内对主库master中的二进制文件进行检测是否发生改变，<br> 如果发现主库master二进制文件有改变则从库slave会开始I/OThread线程请求主库master二进制事件<br> 3）同时主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存在从节点本地的中继日志中，从节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，使得其数据和主节点的保持一致，最后I/OThread和SQLThread将进入睡眠状态，等待下一次被唤醒。</p> 
<h3><a id="_19"></a>白话版：</h3> 
<ul><li>主库master有个binlog二进制日志用来记录主库master上的数据改变。</li><li>从库slave有2线程，一个是I/O线程，一个是SQL线程。</li><li>从库的I/O线程会在一定时间间隔内主动请求主库的binlog</li><li>主库被请求后生成一个log dump线程用来给从库的I/O线程传binlog</li><li>从库将得到的binlog存在自己本地的relay-log（中继日志）文件中</li><li>从库SQL线程会读取relay-log（中继日志）文件，并将内容解析成sql语句在从库上重新执行一遍</li><li>这就完成了主从复制的过程</li><li>End</li></ul> 
<h2><a id="_29"></a>实现</h2> 
<p>情景：搭建一主多从<br> <strong>主库公网ip:39.103.299.01</strong><br> <strong>从库公网ip:115.28.137.02</strong></p> 
<h3><a id="_34"></a>一、创建数据库</h3> 
<ol><li>在主服务器上创建数据库，将创建好的数据库文件备份。<br> <img src="https://images2.imgbox.com/cf/69/Nnwq35Cm_o.png" alt="在这里插入图片描述"><br> 2.在从库上创建数据库，并将主库的数据被备份在从库上导入。（目的：保证主从2个数据库是完全一致）<br> <mark>不导入也可以，不过有时会因为在主库新建表格，从库并没有自动创建，此时插入数据从库数据库日志会报错，导致主从复制关系失效！</mark><br> <img src="https://images2.imgbox.com/9c/91/RfP8p3c8_o.png" alt="在这里插入图片描述"></li></ol> 
<h3><a id="_40"></a>一、主库操作</h3> 
<ol><li> <p>使用<strong>root权限</strong>登录<strong>主库mysql</strong></p> <pre><code class="prism language-bash">mysql -u root -p
</code></pre> </li><li> <p>主库创建mysql用户，可以将用户设置为所有人都能访问，也可以设置成指定从库ip访问。<br> 2.1 创建所有人都能访问mysql用户并设置密码<code>create user '用户名'@'%';</code></p> <pre><code class="prism language-sql"><span class="token comment">#创建用户rootslave并设置为设备都可登录</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> <p>2.2为新用户设置密码<code>set password for '同户名'@'host'='新的密码';</code></p> <p><font color="#ff8533">这里的host只有3种分别为 %(所有ip)、localhost(本服务器)、指定的服务器ip(如158.652.30.145)</font></p> <pre><code class="prism language-sql"><span class="token comment">#将用户rootslave的密码设为qwe123</span>
<span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token operator">=</span><span class="token string">'qwe123'</span><span class="token punctuation">;</span> 
</code></pre> <p>2.3位新创建的用户设置权限<code>grant replication slave on *.* to '用户名'@'从服务ip（host）';</code><br> <mark>注意：我们不在这里设置同步的具体数据库名和数据库表，而是在mysql配置文件中进行设置，所以照这个命令敲即可！</mark></p> <pre><code class="prism language-sql"><span class="token comment">#给rootslave用户分配‘replication slave’权限并让他可以操作所有数据库中的所有表</span>
<span class="token comment">#如果是2台从服务器，只需要将这条命令运行2次（注意后面的从服务器ip地址）</span>
<span class="token comment">#我这里为了延时，直接从服务器的地址设为了%</span>
<span class="token keyword">grant</span> <span class="token keyword">replication</span> slave <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> <p><font color="red">这里建议给rootslave账户的权限高一些，不然后面主库新建表时可能会因为账号权限不足导致主从SQL线程因权限问题报错。</font></p> <p>2.4刷新权限<br> <mark>注意：只要执行了权限操作指令就要用这个命令来刷新</mark></p> <pre><code class="prism language-sql">flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre> <p>2.5查看命令是否分配成功</p> <pre><code class="prism language-sql"><span class="token keyword">show</span> grants <span class="token keyword">for</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> <p><img src="https://images2.imgbox.com/6d/61/P0MrMbar_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<p>3.配置主服务器my.cnf文件（文件路径 /etc/my.cnf）<br> <font color="#999AAA">这个可以在服务器中使用<code>vim /etc/my.cnf</code>进行修改。也可以在宝塔中进行配置</font></p> 
<p>3.1</p> 
<pre><code class="prism language-bash">server-id<span class="token operator">=</span><span class="token number">66</span>  <span class="token comment">#服务器id 此id在主从复制服务器集群中要保持唯一（每台服务器的这值都是唯一的）</span>

log-bin<span class="token operator">=</span>mysql-bin   <span class="token comment">#二进制文件存放路径，非必须，mysql8后默认存放/var/lib/mysql这里</span>

binlog-do-db<span class="token operator">=</span>sync_database  <span class="token comment">#想要同步的数据库，如果有多个以空格隔开db1 db2 db3 ....</span>

binlog-ignore-db<span class="token operator">=</span>mysql  <span class="token comment">#不同步的数据（可以不配置）  如果有多个以空格隔开db1 db2 db3 ....</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/51/00/RZV3dOJm_o.png" alt="在这里插入图片描述"><br> 3.2修改了mysql配置项需要重载配置重启mysql<br> 3.2.1重启命令：</p> 
<pre><code class="prism language-bash"><span class="token function">service</span> mysqld restart<span class="token punctuation">;</span>
</code></pre> 
<p>3.2.2 或者在宝塔中重启mysql,两种方式二选一<br> <img src="https://images2.imgbox.com/d0/21/GcMtjDMc_o.png" alt="在这里插入图片描述"><br> 4.检查binlog日志是否开启</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'log_bin'</span><span class="token punctuation">;</span>
</code></pre> 
<p>状态为ON表示已经开启<br> <img src="https://images2.imgbox.com/52/ed/PisSGU9T_o.png" alt="在这里插入图片描述"><br> 5.查看主库状态，获取从库必要的配置参数</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>
</code></pre> 
<p>记住这几个参数，配置从库的时候要用到；<br> <img src="https://images2.imgbox.com/11/85/ESbZpvCj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_118"></a>从库配置</h2> 
<ol><li>配置从服务器my.cnf文件（文件路径 /etc/my.cnf），将server-id=2 #这里的id在mysql集群中必须是唯一的不可重复的（数字自定义就可以）<br> <font color="#999AAA">这个可以在服务器中使用<code>vim /etc/my.cnf</code>进行修改。也可以在宝塔中进行配置<mark>与主服务器的配置方法一样</mark></font></li></ol> 
<p><img src="https://images2.imgbox.com/9c/1c/aXO7Zkkx_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li> <p>修改了mysql配置项，需要重启mysql <code>service mysqld restart</code></p> </li><li> <p>启动主从同步功能<br> 3.1 登录从服务器mysql <code>mysql -u root -p 密码</code></p> <p>3.2 设置同步信息 <code>change master to master_host='主服务器的IP',master_user='主服务的slave账号',master_password='主服务器的密码',master_log_file='日志的名称',master_log_pos=同步位置;</code></p> <pre><code class="prism language-sql">change master <span class="token keyword">to</span> master_host<span class="token operator">=</span><span class="token string">'39.103.233.01'</span><span class="token punctuation">,</span>master_user<span class="token operator">=</span><span class="token string">'rootslave'</span><span class="token punctuation">,</span>master_password<span class="token operator">=</span><span class="token string">'qwe123'</span><span class="token punctuation">,</span>master_log_file<span class="token operator">=</span><span class="token string">'mysql-bin.000013'</span><span class="token punctuation">,</span>master_log_pos<span class="token operator">=</span><span class="token number">156</span><span class="token punctuation">;</span>
</code></pre> <p>3.2.1查看配置信息（这个表在主服务器的第5步）<br> <img src="https://images2.imgbox.com/36/8d/wFxLfpPy_o.png" alt="在这里插入图片描述"></p> <p>3.2.2 在<strong>从服务器</strong>mysql中设置主从配置<br> <img src="https://images2.imgbox.com/3f/b9/kHvnyXYL_o.png" alt="在这里插入图片描述"><br> 4.启动同步 <code>start slave;</code><br> 5.查看服务启动状态<code>show slave status\G</code></p> </li></ol> 
<p><img src="https://images2.imgbox.com/7f/7a/KoNOuXEf_o.png" alt="在这里插入图片描述"><br> 6. 测试效果（左主库，右从库）<br> <img src="https://images2.imgbox.com/b4/4f/svD9juXe_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_152"></a>常见错误处理</h2> 
<h3><a id="_153"></a>从库启动主从查询状态出现异常</h3> 
<h4><a id="1Slave_IO_Running_No_154"></a>情况1：（从库查看运行状态出现Slave_IO_Running: No）</h4> 
<p><img src="https://images2.imgbox.com/fc/85/gqmcU6dI_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2Slave_SQL_Running_No_158"></a>情况2：（从库查看运行状态出现Slave_SQL_Running: No）</h4> 
<p><img src="https://images2.imgbox.com/e2/b2/efk1R4I2_o.png" alt="在这里插入图片描述"></p> 
<p>1.主库使用命令：<code>show master status;</code> 来查看主库配置信息<br> 2.从库使用命令：<code>show slave status\G</code> 命令查看从库主从配置信息。</p> 
<h4><a id="_165"></a>开始解决问题（从库操作）</h4> 
<pre><code class="prism language-sql">stop slave<span class="token punctuation">;</span><span class="token comment">//停止主从同步</span>

CHANGE MASTER <span class="token keyword">TO</span> MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">'mysql-bin.000013'</span><span class="token punctuation">,</span> MASTER_LOG_POS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//当Slave_IO_Running：No使用本行命令</span>

<span class="token keyword">set</span> <span class="token keyword">GLOBAL</span> SQL_SLAVE_SKIP_COUNTER<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//当 Slave_SQL_Running: No使用本行命令</span>

<span class="token keyword">start</span> slave<span class="token punctuation">;</span><span class="token comment">//启动主从服务器</span>

<span class="token keyword">show</span> slave <span class="token keyword">status</span>\G <span class="token comment">//查看主从同步信息</span>
</code></pre> 
<h4><a id="_179"></a>关于其他错误</h4> 
<p>是什么原因导致主从复制失效的？<mark>最简单的途径就是看sql的错误日志！</mark><br> <img src="https://images2.imgbox.com/fc/8d/U9vhDXpi_o.png" alt="在这里插入图片描述"><br> 更具具体的错误日志去解决问题<br> 例如：主库建表，从库并没跟着新建表，而且主从也失效了，通过查看主库的mysql日志发现，是因为我的主库rootslave主从同步账号权限给的不够导致的同步建表失败！</p> 
<h4><a id="MySql_185"></a>MySql常见错误码</h4> 
<p>MySQL常见错误类型</p> 
<p>1005：创建表失败<br> 1006：创建数据库失败<br> 1007：数据库已存在，创建数据库失败<br> 1008：数据库不存在，删除数据库失败<br> 1009：不能删除数据库文件导致删除数据库失败<br> 1010：不能删除数据目录导致删除数据库失败<br> 1011：删除数据库文件失败<br> 1012：不能读取系统表中的记录<br> 1020：记录已被其他用户修改<br> 1021：硬盘剩余空间不足，请加大硬盘可用空间<br> 1022：关键字重复，更改记录失败<br> 1023：关闭时发生错误<br> 1024：读文件错误<br> 1025：更改名字时发生错误<br> 1026：写文件错误<br> 1032：记录不存在<br> 1036：数据表是只读的，不能对它进行修改<br> 1037：系统内存不足，请重启数据库或重启服务器<br> 1038：用于排序的内存不足，请增大排序缓冲区<br> 1040：已到达数据库的最大连接数，请加大数据库可用连接数<br> 1041：系统内存不足<br> 1042：无效的主机名<br> 1043：无效连接<br> 1044：当前用户没有访问数据库的权限<br> 1045：不能连接数据库，用户名或密码错误<br> 1048：字段不能为空<br> 1049：数据库不存在<br> 1050：数据表已存在<br> 1051：数据表不存在<br> 1054：字段不存在<br> 1065：无效的SQL语句，SQL语句为空<br> 1081：不能建立Socket连接<br> 1114：数据表已满，不能容纳任何记录<br> 1116：打开的数据表太多<br> 1129：数据库出现异常，请重启数据库<br> 1130：连接数据库失败，没有连接数据库的权限<br> 1133：数据库用户不存在<br> 1141：当前用户无权访问数据库<br> 1142：当前用户无权访问数据表<br> 1143：当前用户无权访问数据表中的字段<br> 1146：数据表不存在<br> 1147：未定义用户对数据表的访问权限<br> 1149：SQL语句语法错误<br> 1158：网络错误，出现读错误，请检查网络连接状况<br> 1159：网络错误，读超时，请检查网络连接状况<br> 1160：网络错误，出现写错误，请检查网络连接状况<br> 1161：网络错误，写超时，请检查网络连接状况<br> 1062：字段值重复，入库失败<br> 1169：字段值重复，更新记录失败<br> 1177：打开数据表失败<br> 1180：提交事务失败<br> 1181：回滚事务失败<br> 1203：当前用户和数据库建立的连接已到达数据库的最大连接数，请增大可用的数据库连接数或重启数据库<br> 1205：加锁超时<br> 1211：当前用户没有创建用户的权限<br> 1216：外键约束检查失败，更新子表记录失败<br> 1217：外键约束检查失败，删除或修改主表记录失败<br> 1226：当前用户使用的资源已超过所允许的资源，请重启数据库或重启服务器<br> 1227：权限不足，您无权进行此操作<br> 1235：MySQL版本过低，不具有本功能</p> 
<hr color="#000000" size='1"'> 
<h2><a id="mysql_252"></a>mysql主从复制常用命令</h2> 
<h3><a id="_253"></a>创建用户相关</h3> 
<ol><li> <p>创建新用户</p> <pre><code> host：
 	'%'=所有人
 	'localhost'=本服务器才能访问
 	'指定ip'=指定ip才能访问
</code></pre> <p>格式：<code>create user '新用户的名字'@'host地址' identified by '新用户的登录密码';</code></p> <pre><code class="prism language-sql"><span class="token comment">#创建用户并设置用户密码</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'qweabc123'</span><span class="token punctuation">;</span>
<span class="token comment">#指定多个ip能访问 并设置密码（多个ip使用英文逗号分割）</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'rootslave'</span><span class="token variable">@'115.28.137.30'</span><span class="token punctuation">,</span><span class="token string">'rootslave'</span><span class="token variable">@'8.140.159.122'</span>  identified <span class="token keyword">by</span> <span class="token string">'qweabc123'</span><span class="token punctuation">;</span>
<span class="token comment">#或者 仅创建用户</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>修改mysql用户密码<br> 格式：<code>set password '用户名'@'登录地址' = '新密码'；</code></p> <pre><code class="prism language-sql"><span class="token comment">#设置用户名为rooter且host地址为%的用户密码为123qwe</span>
<span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">'rooter'</span><span class="token variable">@'%'</span> <span class="token operator">=</span> <span class="token string">'123qwe'</span><span class="token punctuation">;</span> 
</code></pre> </li><li> <p>查看用户名和host<br> 格式：<code>select 字段A,字段B from 数据库名.用户表;</code></p> <pre><code class="prism language-sql"><span class="token comment">#查询数据库名为mysql中的user数据表，获取所有user与host列</span>
<span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>删除用户<br> 格式：<code>DROP USER '用户名'@'host地址';</code></p> <pre><code class="prism language-sql"><span class="token comment">#删除用户 rootslave</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">'rootslave'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
<h3><a id="_292"></a>权限相关</h3> 
<ol><li> <p>给新用户设置权限<br> 格式：<code>grant 权限 on 数据库.数据表 to '要被授权的用户名'@'用户host'；</code></p> <pre><code class="prism language-sql"><span class="token comment">#设置最高权限</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>刷新权限<br> <mark>设置完权限后要执行此命令</mark></p> <pre><code class="prism language-sql">flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>查看用户权限<br> 格式：<code>show grants for '用户名'@'用户的host';</code></p> <pre><code class="prism language-sql"><span class="token comment">#查看rootslave用户拥有的权限</span>
<span class="token keyword">show</span> grants <span class="token keyword">for</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token comment">#或</span>
<span class="token keyword">show</span> grants <span class="token keyword">for</span> <span class="token string">'rootslave'</span><span class="token punctuation">;</span><span class="token comment">#如果这个用户的host有%、localhost、指定ip可能会出现多个结果</span>
</code></pre> </li><li> <p>删除用户权限<br> 格式：<code>revoke 权限 on 数据对象 from 用户;</code></p> <pre><code class="prism language-sql"><span class="token comment">#删除用户rootslave在所有数据库中所有数据表的全部权限</span>
<span class="token keyword">revoke</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'rootslave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>显示mysql进程</p> <pre><code class="prism language-sql"><span class="token keyword">show</span> processlist<span class="token punctuation">;</span>
</code></pre> </li></ol> 
<hr color="#000000" size='1"'> 
<h2><a id="End_326"></a>End;</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4431d774a86d0b436b91f3c97c762b3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">锁-spring shedlock</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d83cbab84df86e9f4e39253af8229f92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue中 事件总线（eventBus）详解及使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>