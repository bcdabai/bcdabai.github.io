<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mbedtls学习4.mbedtls_RAM/ROM优化指南 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mbedtls学习4.mbedtls_RAM/ROM优化指南" />
<meta property="og:description" content="MbedTLS RAM 和 ROM 资源占用优化指南 mbedtls 软件包采用了模块化的设计，可以使用 config.h 文件来进行功能模块的配置选择。
mbedtls 默认提供的 config.h 文件是一个通用的、全功能的配置，占用了非常大的 RAM 和 ROM 空间，但是保证了 SSL 握手和通讯的建立速度、稳定性、协议兼容性以及数据传输效率。但嵌入式设备受限于其有限的 RAM 和 ROM 空间，我们不得不牺牲速度来节省 RAM 空间，裁剪不需要的功能模块来降低 ROM 占用。
本优化指南，在保证 SSL/TLS 客户端能与服务器建立安全稳定连接的前提下，对 RAM 和 ROM 占用进行优化统计。
注意：
mbedtls 客户端的优化属于针对性优化，针对特定的 SSL/TLS 服务器进行的优化，不同的 SSL/TLS 服务器配置不同，优化所用到的配置参数也是不同的。
因此，开发者在进行 SSL/TLS 优化前，在 MCU 资源条件允许的情况下，请先使用默认的配置调通 SSL/TLS 握手连接和加密通讯，然后再根据 SSL/TLS 服务器具体的配置进行逐项优化。
当然，多数情况下您并不知道服务器的具体参数配置，因此也只能试探性优化，本文给出了各个配置的说明，来方便开发者进行针对性的优化。
优化说明 RAM 资源占用统计说明
首先保证 SSL 握手连接正常，加密数据通讯正常。
运行 tls_test 测试例程，进行 RAM 优化测试。测试例程在单独的线程中运行，通过对比 SSL 握手成功前后所占用的内存来确定在握手通讯过程所使用的 RAM 情况。该测试方法只能粗略估计 SSL 客户端成功进行握手连接所需要的 RAM 大小，该数据包含了保证握手通讯所需要的额外的 RAM 空间。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/464b6c90dfd2cb4c3d4b71899dc17a20/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-26T14:11:29+08:00" />
<meta property="article:modified_time" content="2020-05-26T14:11:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mbedtls学习4.mbedtls_RAM/ROM优化指南</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MbedTLS_RAM__ROM__0"></a>MbedTLS RAM 和 ROM 资源占用优化指南</h2> 
<p><strong>mbedtls</strong> 软件包采用了模块化的设计，可以使用 <code>config.h</code> 文件来进行功能模块的配置选择。</p> 
<p><code>mbedtls</code> 默认提供的 <code>config.h</code> 文件是一个通用的、全功能的配置，占用了非常大的 RAM 和 ROM 空间，但是保证了 SSL 握手和通讯的建立速度、稳定性、协议兼容性以及数据传输效率。但嵌入式设备受限于其有限的 RAM 和 ROM 空间，我们不得不牺牲速度来节省 RAM 空间，裁剪不需要的功能模块来降低 ROM 占用。</p> 
<p>本优化指南，在保证 SSL/TLS 客户端能与服务器建立安全稳定连接的前提下，对 RAM 和 ROM 占用进行优化统计。</p> 
<p><strong>注意：</strong></p> 
<p><strong>mbedtls</strong> 客户端的优化属于针对性优化，针对特定的 SSL/TLS 服务器进行的优化，不同的 SSL/TLS 服务器配置不同，优化所用到的配置参数也是不同的。</p> 
<p>因此，开发者在进行 SSL/TLS 优化前，在 MCU 资源条件允许的情况下，请先使用默认的配置调通 SSL/TLS 握手连接和加密通讯，然后再根据 SSL/TLS 服务器具体的配置进行逐项优化。</p> 
<p>当然，多数情况下您并不知道服务器的具体参数配置，因此也只能试探性优化，本文给出了各个配置的说明，来方便开发者进行针对性的优化。</p> 
<h3><a id="_16"></a>优化说明</h3> 
<ul><li> <p>RAM 资源占用统计说明</p> <p>首先保证 SSL 握手连接正常，加密数据通讯正常。<br> 运行 <code>tls_test</code> 测试例程，进行 RAM 优化测试。测试例程在单独的线程中运行，通过对比 SSL 握手成功前后所占用的内存来确定在握手通讯过程所使用的 RAM 情况。该测试方法只能粗略估计 SSL 客户端成功进行握手连接所需要的 RAM 大小，该数据包含了保证握手通讯所需要的额外的 RAM 空间。</p> </li><li> <p>ROM 资源占用统计说明</p> <p>通过对比启动 <strong>mbedtls</strong> 功能组件前后参与链接的文件来统计 <strong>mbedtls</strong> 所占用 ROM 大小。</p> </li><li> <p>测试平台： iMXRT1052</p> </li><li> <p>测试 IDE： MDK5</p> </li><li> <p>优化级别： o2</p> </li><li> <p>测试例程： <code>samples/tls_app_test.c</code></p> </li><li> <p>测试使用的 SSL 服务器： <code>www.rt-thread.org</code></p> </li><li> <p>测试服务器根证书签名算法： <code>sha1RSA</code></p> </li><li> <p>测试服务器根证书签名哈希算法： <code>sha1</code></p> </li><li> <p>测试服务器根证书公钥： <code>RSA 2048 bits</code></p> </li><li> <p>测试服务器根证书指纹算法： <code>sha1</code></p> </li><li> <p>SSL 客户端指定密码套件</p> </li></ul> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SSL_CIPHERSUITES                        \
    MBEDTLS_TLS_RSA_WITH_AES_256_CBC_SHA256</span>
</code></pre> 
<ul><li>SSL 客户端指定帧大小为 <code>#define MBEDTLS_SSL_MAX_CONTENT_LEN 3584</code></li><li>测试使用的配置（<strong>详见文末</strong>）</li></ul> 
<h3><a id="_55"></a>优化后的资源占用汇总</h3> 
<ul><li> <p>默认的 <code>tls_config.h</code> 配置资源占用情况</p> <p><strong>mbedtls</strong> 默认的配置文件为 <code>mbedtls/include/mbedtls/config.h</code>，而 <strong>RT-Thread</strong> 使用的配置文件为 <code>ports/inc/tls_config.h</code>。用户进行配置优化的时候也是使用的 <code>ports/inc/tls_config.h</code> 文件。</p> </li></ul> 
<pre><code class="prism language-c"><span class="token function">RO</span><span class="token punctuation">(</span>CODE <span class="token operator">+</span> RO<span class="token punctuation">)</span>       <span class="token punctuation">:</span> <span class="token number">159828</span> bytes（<span class="token number">156.08</span>K）
<span class="token function">RW</span><span class="token punctuation">(</span>RW <span class="token operator">+</span> ZI<span class="token punctuation">)</span>         <span class="token punctuation">:</span>    <span class="token number">720</span> bytes
<span class="token function">ROM</span><span class="token punctuation">(</span>CODE <span class="token operator">+</span> RO <span class="token operator">+</span> RW<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">159972</span> bytes（<span class="token number">156.22</span>K）
动态内存使用         <span class="token punctuation">:</span>  <span class="token number">26849</span> bytes（<span class="token number">26.22</span>K）（包含 <span class="token number">1</span>K 的测试 buffer）
</code></pre> 
<ul><li>优化后的配置资源占用情况</li></ul> 
<pre><code class="prism language-c"><span class="token function">RO</span><span class="token punctuation">(</span>CODE <span class="token operator">+</span> RO<span class="token punctuation">)</span>       <span class="token punctuation">:</span> <span class="token number">71893</span> bytes（<span class="token number">70.21</span>K）
<span class="token function">RW</span><span class="token punctuation">(</span>RW <span class="token operator">+</span> ZI<span class="token punctuation">)</span>         <span class="token punctuation">:</span>    <span class="token number">82</span> bytes
<span class="token function">ROM</span><span class="token punctuation">(</span>CODE <span class="token operator">+</span> RO <span class="token operator">+</span> RW<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">71975</span> bytes（<span class="token number">70.29</span>K）
动态内存使用         <span class="token punctuation">:</span> <span class="token number">23344</span> bytes（<span class="token number">22.79</span>K）（包含 <span class="token number">1</span>K 的测试 buffer）
</code></pre> 
<h3><a id="_77"></a>优化前的准备</h3> 
<ol><li>首先你要有准备接入的 SSL 服务器（保证能正常工作）</li><li>准备好接入 SSL 服务器的 PEM 格式根证书文件（存放到 mbedtls 软件包 <code>certs</code> 目录下，删除其他不需要的证书）</li><li>使用默认的 mbedtls 配置文件成功接通 SSL 服务器（优化后更难定位失败原因）</li><li>逐项优化 mbedtls 配置，反复测试</li></ol> 
<p><strong>注意：</strong></p> 
<p>如果您的 MCU 资源比较小，无法使用默认的 <code>tls_config.h</code> 配置文件，开发者可以选择使用 <code>QEMU</code> 虚拟机进行开发调试以及 mbedtls 优化。将 mbedtls 资源占用优化到合适的时候，再使用您需要的 MCU 进行验证测试。</p> 
<h3><a id="_88"></a>优化配置概述</h3> 
<h4><a id="_90"></a>常用优化配置</h4> 
<p>通过对下面列表中的配置进行修改，可以很大程度上降低 mbedtls RAM 和 ROM 的占用。</p> 
<p>开发者在进行优化时，建议优先对下面列表中的配置进行优化，如果不能满足要求，再针对其他的配置进行逐项的优化。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">const char mbedtls_root_certificate[ ]</td><td align="left">存储根证书的常量数组。编译的时候，会将 PEM 证书添加到该数组。建议只在 <code>certs</code> 证书目录存放需要的根证书文件，否则会占用非常大的 RAM 和 ROM 空间</td><td align="left">只存放需要的证书文件</td></tr><tr><td align="left">MBEDTLS_SSL_CIPHERSUITES</td><td align="left">通过指定密码套件来节省几百字节的 ROM 和 几百字节的 RAM。这里注意需要指定服务器支持的加密套件，并为该加密套件启用相关的功能组件，关闭其他功能组件。如果只接入一个 SSL 服务器，通常这里只需要定义支持一个加密套件即可</td><td align="left">仅指定根证书需要的加密套件</td></tr><tr><td align="left">MBEDTLS_AES_ROM_TABLES</td><td align="left">将 AES 表存储在 ROM 中以节省 RAM 占用（很大程度上降低 RAM 占用）</td><td align="left">建议启用</td></tr><tr><td align="left">MBEDTLS_SSL_MAX_CONTENT_LEN</td><td align="left">默认为 16384。RFC定义了 SSL/TLS 消息的默认大小，如果您在此处更改值，则其他客户端/服务器可能无法再与您通信。除非你能确定服务端的帧大小。根据服务器发送的最大帧大小做适当的修改</td><td align="left">适当调小（出现 0x7200 错误时请增大该配置）</td></tr><tr><td align="left">MBEDTLS_MPI_MAX_SIZE</td><td align="left">可用的 MPI 最大字节数，默认为 1024，可以根据适当调小</td><td align="left">适当调小</td></tr><tr><td align="left">MBEDTLS_MPI_WINDOW_SIZE</td><td align="left">MPI 用于模幂运算的最大窗口数量，默认为6，选值范围：1-6，可适当调小</td><td align="left">适当调小</td></tr><tr><td align="left">MBEDTLS_ECP_MAX_BITS</td><td align="left">GF§ 椭圆曲线最大位，默认为 521</td><td align="left">适当调小</td></tr><tr><td align="left">MBEDTLS_ECP_WINDOW_SIZE</td><td align="left">用于点乘的最大窗口大小，默认为 6，选值范围： 2-7，可以适当减小，减小会影响速度</td><td align="left">适当调小</td></tr><tr><td align="left">MBEDTLS_ECP_FIXED_POINT_OPTIM</td><td align="left">默认1，启用定点加速。启用后，将加速点乘运算大约 3 到 4 倍，成本是峰值内存占用增加约 2 倍。可以配置为 0，牺牲速度来节省 RAM 占用</td><td align="left">可优化配置为 0</td></tr><tr><td align="left">MBEDTLS_ECP_NIST_OPTIM</td><td align="left">为每个 NIST 启用特定的实例，使相应曲线上的操作快 4 到 8 倍，缺点是 ROM 占用大。可以选择性优化</td><td align="left">可禁用</td></tr><tr><td align="left">MBEDTLS_ENTROPY_MAX_SOURCES</td><td align="left">最大的熵源数量，最小为2，默认使用 <code>mbedtls_platform_entropy_poll</code> 源。RT-Thread 上使用最小配置 2</td><td align="left">可优化配置为 2</td></tr></tbody></table> 
<h4><a id="_110"></a>系统相关配置</h4> 
<p>这部分配置跟具体的系统和编译器相关，下表列出了在 <strong>RT-Thread</strong> 上需要做的配置。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_HAVE_ASM</td><td align="left">需要编译器可以处理汇编代码</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_HAVE_TIME</td><td align="left">如果您的系统没有 time.h 和 time() 函数，请注释该配置</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_HAVE_TIME_DATE</td><td align="left">如果您的系统没有 time.h、time()、gmtime() 或者没有正确的时钟，请注释该配置</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_DEBUG_C</td><td align="left">定义该配置以启动调试 log 输出</td><td align="left">如需调试log，则启用，否则请禁用</td></tr><tr><td align="left">MBEDTLS_NET_C</td><td align="left">该配置仅支持 POSIX/Unix 和 windows 系统，在 RT-Thread 系统上需要关闭</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_NO_PLATFORM_ENTROPY</td><td align="left">如果您的平台不支持 /dev/urandom 或 Windows CryptoAPI 等标准，则需要启用该配置。RT-Thread 上必须启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_TIMING_C</td><td align="left">如果注释，则需要用户自己实现相关的函数。默认启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_TIMING_ALT</td><td align="left">如果注释，则需要用户自己实现相关的函数。默认启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_ENTROPY_HARDWARE_ALT</td><td align="left">如果注释，则需要用户自己实现相关的函数。默认启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_ENTROPY_C （依赖：MBEDTLS_SHA256_C 或 MBEDTLS_SHA512_C）</td><td align="left">启用特定于平台的熵代码。需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_PADLOCK_C （依赖：MBEDTLS_HAVE_ASM）</td><td align="left">在x86上启用VIA Padlock支持</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_AESNI_C （依赖：MBEDTLS_HAVE_ASM）</td><td align="left">在x86-64上启用AES-NI支持</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_PLATFORM_C</td><td align="left">使能平台抽象层，用于重定义实现 free、printf 等函数</td><td align="left">启用</td></tr></tbody></table> 
<h4><a id="_130"></a>功能组件相关配置</h4> 
<p>用户可以根据要接入的 SSL/TLS 服务器特性以及根证书使用的签名算法来选择启用哪部分的功能。启用或禁用功能组件时请注意将相关的依赖打开或禁用。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_ASN1_PARSE_C</td><td align="left">使能通用的 ASN1 解析器。ASN1: 一种描述数字对象的方法和标准，需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_ASN1_WRITE_C</td><td align="left">启用通用 ASN1 编写器</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_BIGNUM_C</td><td align="left">启用大整数库 （multi-precision integer library）</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_CIPHER_C</td><td align="left">启用通用密码层</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_AES_C</td><td align="left">启用 AES 加密。PEM_PARSE 使用 AES 来解密被加密的密钥。通过启用 AES 来支持 <code>*_WITH_AES_*</code> 类型的加密套件</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_CTR_DRBG_C （依赖：MBEDTLS_AES_C）</td><td align="left">启用基于 CTR_DRBG AES-256 的随机生成器</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_MD_C</td><td align="left">启用通用消息摘要层，需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_OID_C</td><td align="left">启用OID数据库，此模块在OID和内部值之间进行转换，需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_PK_C （依赖：MBEDTLS_RSA_C、MBEDTLS_ECP_C）</td><td align="left">启用通用公共（非对称）密钥层，需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_PK_PARSE_C （依赖：MBEDTLS_PK_C）</td><td align="left">启用通用公共（非对称）密钥解析器，需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_SHA256_C</td><td align="left">启用 SHA-224 和 SHA-256 加密哈希算法，根据根证书详细信息中的<code>签名哈希算法</code>进行选择</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_SHA512_C</td><td align="left">启用 SHA-384 和 SHA-512 加密哈希算法，根据根证书详细信息中的<code>签名哈希算法</code>进行选择</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_SSL_CLI_C （依赖：MBEDTLS_SSL_TLS_C）</td><td align="left">启用 SSL 客户端代码，作为 SSL 服务端的时候不需要启用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_SSL_SRV_C （依赖：MBEDTLS_SSL_TLS_C）</td><td align="left">启用 SSL 服务端代码，作为 SSL 客户端的时候不需要启用</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_SSL_TLS_C （依赖：MBEDTLS_CIPHER_C、MBEDTLS_MD_C 和至少定义一个 MBEDTLS_SSL_PROTO_XXX）</td><td align="left">使能 SSL/TLS 代码</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_X509_CRT_PARSE_C （依赖：MBEDTLS_X509_USE_C）</td><td align="left">使能 X509 证书解析</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_X509_USE_C （依赖：MBEDTLS_ASN1_PARSE_C、MBEDTLS_BIGNUM_C、MBEDTLS_OID_C、MBEDTLS_PK_PARSE_C）</td><td align="left">启用X.509核心以使用证书</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_BASE64_C</td><td align="left">启用 base64 组件，PEM 证书解析需要使用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_CERTS_C</td><td align="left">该模块用于测试 SSL 客户端和服务器，可以选择禁用</td><td align="left">可禁用</td></tr><tr><td align="left">MBEDTLS_PEM_PARSE_C（依赖：MBEDTLS_BASE64_C）</td><td align="left">启用对 PEM 文件解码解析的支持</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_RSA_C （依赖：MBEDTLS_BIGNUM_C、MBEDTLS_OID_C）</td><td align="left">启用RSA公钥密码系统。RSA、DHE-RSA、ECDHE-RSA、RSA-PSK 方式的密钥交换需要使用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_SHA1_C</td><td align="left">启用 SHA1 加密哈希算法。TLS 1.1/1.2 需要使用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_MD5_C</td><td align="left">启用MD5哈希算法。PEM 解析需要使用</td><td align="left">启用</td></tr><tr><td align="left">MBEDTLS_PK_PARSE_EC_EXTENDED （依赖：）</td><td align="left">该宏用以支持 RFC 5915 和RFC 5480 不允许的 SEC1 变体增强对读取 EC 密钥的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_ERROR_STRERROR_DUMMY</td><td align="left">启用虚拟错误功能，以便在禁用 MBEDTLS_ERROR_C 时更容易在第三方库中使用 mbedtls_strerror（）（启用 MBEDTLS_ERROR_C 时无效）</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_GENPRIME （依赖：MBEDTLS_BIGNUM_C）</td><td align="left">启用素数生成代码</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_FS_IO</td><td align="left">启用文件系统交互相关的功能函数</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_PKCS5_C （依赖：MBEDTLS_MD_C）</td><td align="left">该模块增加了对 PKCS＃5 功能的支持。AES 算法数据填充方案的需要。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_PKCS12_C （依赖：MBEDTLS_ASN1_PARSE_C、MBEDTLS_CIPHER_C、MBEDTLS_MD_C）</td><td align="left">添加用于解析 PKCS＃8 加密私钥的算法</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_PKCS1_V15 （依赖：MBEDTLS_RSA_C）</td><td align="left">用于支持 PKCS＃1 v1.5 操作，RSA 密钥套件需要使用。如果使用了 RSA 密钥套件，则需要启用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_PKCS1_V21 （依赖：MBEDTLS_MD_C、MBEDTLS_RSA_C）</td><td align="left">启用对 PKCS＃1 v2.1 编码的支持，这样可以支持 RSAES-OAEP 和 RSASSA-PSS 操作</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_PK_RSA_ALT_SUPPORT</td><td align="left">支持 PK 层中的外部私有 RSA 密钥（例如，来自 HSM）。不需要启用，禁用</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_SELF_TEST</td><td align="left">启用检查功能。建议在启用 debug 的时候启用，其他时候禁用</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_ALL_ALERT_MESSAGES</td><td align="left">启用警报消息发送功能</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_ENCRYPT_THEN_MAC</td><td align="left">启用对Encrypt-then-MAC，RFC 7366的支持。用于加强对 CBC 密码套件的保护，可以禁用</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_EXTENDED_MASTER_SECRET</td><td align="left">启用对扩展主密钥的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_FALLBACK_SCSV</td><td align="left">注释此宏以禁用客户端使用回退策略</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_CBC_RECORD_SPLITTING</td><td align="left">在 SSLv3 和 TLS 1.0 中为 CBC 模式启用 1/n-1 记录拆分。启用该宏以降低 BEAST 攻击的风险，可以选择性禁用</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_RENEGOTIATION</td><td align="left">屏蔽该宏禁用对TLS重新协商的支持。启用可能会带来安全风险，建议禁用</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_SSL_MAX_FRAGMENT_LENGTH</td><td align="left">在 SSL 中启用对 RFC 6066 最大帧长度扩展的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_ALPN</td><td align="left">启用对 RFC 7301 应用层协议协商的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_SESSION_TICKETS</td><td align="left">在SSL中启用对RFC 5077会话 tickets 的支持，需要服务端支持。通常用来优化握手流程</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_EXPORT_KEYS</td><td align="left">启用对导出密钥块和主密钥的支持。 这对于 TLS 的某些用户是必需的，例如 EAP-TLS</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_SERVER_NAME_INDICATION （依赖：MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">在 SSL 中启用对 RFC 6066 服务器名称指示（SNI）的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_TRUNCATED_HMAC</td><td align="left">在 SSL 中启用对 RFC 6066 截断 HMAC 的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_VERSION_FEATURES （依赖：MBEDTLS_VERSION_C）</td><td align="left">版本功能信息相关</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_VERSION_C</td><td align="left">该模块提供运行时版本信息</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_X509_CHECK_KEY_USAGE</td><td align="left">启用 keyUsage 扩展（CA和叶证书）的验证。禁用此功能可避免错误发布和/或误用（中间）CA 和叶证书的问题。注释后跳过 keyUsage 检查 CA 和叶证书</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_X509_CHECK_EXTENDED_KEY_USAGE</td><td align="left">启用 extendedKeyUsage 扩展（叶证书）的验证。禁用此功能可避免错误发布和/或误用证书的问题</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_X509_RSASSA_PSS_SUPPORT</td><td align="left">启用使用 RSASSA-PSS（也称为 PKCS＃1 v2.1）签名的 X.509 证书，CRL 和 CSRS 的解析和验证。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_BLOWFISH_C</td><td align="left">启用 Blowfish 分组密码</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_ERROR_C</td><td align="left">启用错误代码到错误字符串的转换</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_HMAC_DRBG_C （依赖：MBEDTLS_MD_C）</td><td align="left">启用随机字节发生器</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_PEM_WRITE_C （依赖：MBEDTLS_BASE64_C）</td><td align="left">此模块添加了对编码/写入PEM文件的支持。TLS Client 不需要</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_PK_WRITE_C（依赖：MBEDTLS_PK_C）</td><td align="left">启用通用公钥写入功能。嵌入式系统一般不需要，禁用</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_RIPEMD160_C</td><td align="left">RIPEMD (RACE原始完整性校验讯息摘要)是一种加密哈希函数，通用性差于 SHA-1/2</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_CACHE_C</td><td align="left">启用 SSL 缓存</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_TICKET_C（依赖：MBEDTLS_CIPHER_C）</td><td align="left">服务端的配置</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_X509_CRL_PARSE_C（依赖：MBEDTLS_X509_USE_C）</td><td align="left">CRL: Certidicate Revocation List (CRL) 证书吊销列表模块</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_X509_CSR_PARSE_C （依赖：MBEDTLS_X509_USE_C）</td><td align="left">Certificate Signing Request (CSR).证书签名请求解析，用于 DER 证书</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_X509_CREATE_C （依赖：MBEDTLS_BIGNUM_C、MBEDTLS_OID_C、MBEDTLS_PK_WRITE_C）</td><td align="left">启用X.509核心以创建证书，服务器需要</td><td align="left">禁用</td></tr><tr><td align="left">MBEDTLS_X509_CRT_WRITE_C （依赖：MBEDTLS_X509_CREATE_C）</td><td align="left">启用创建证书，服务器需要。禁用</td><td align="left"></td></tr><tr><td align="left">MBEDTLS_X509_CSR_WRITE_C （依赖：MBEDTLS_X509_CREATE_C）</td><td align="left">启用创建X.509证书签名请求（CSR）</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_XTEA_C</td><td align="left">启用 XTEA 分组密码</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_ECDSA_DETERMINISTIC （依赖：MBEDTLS_HMAC_DRBG_C）</td><td align="left">启用确定性 ECDSA（RFC 6979），防止签名时缺少熵而导致签名密钥泄露。建议启用</td><td align="left">建议启用</td></tr></tbody></table> 
<h4><a id="_202"></a>密码套件相关配置</h4> 
<p><strong>mbedtls</strong> 中密码套件命名形式为 <code>MBEDTLS_TLS_PSK_WITH_AES_256_GCM_SHA384</code>。</p> 
<p><strong>mbedtls</strong> 在数组 <code>static const int ciphersuite_preference[]</code> 中定义了所有支持的密码套件，如果开启支持所有的密码套件将会占用非常大的 ROM 空间。这里建议用户通过 <code>MBEDTLS_SSL_CIPHERSUITES</code> 宏来指定客户端与服务器使用具体哪种加密套件。指定加密套件后，将不需要的加密套件和依赖的功能组件全部禁用，同时禁用不需要的椭圆曲线，来最大程度上节省 ROM 空间。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_SSL_CIPHERSUITES</td><td align="left">通过指定密码套件来节省 ROM 和 几百字节的 RAM。这里注意需要指定服务器支持的加密套件，并为该加密套件启用相关的功能组件，关闭其他功能组件。如果只接入一个 SSL 服务器，通常这里只需要定义支持一个加密套件即可</td><td align="left">仅指定根证书需要的加密套件</td></tr><tr><td align="left">MBEDTLS_AES_C</td><td align="left">通过启用 AES 来支持 <code>*_WITH_AES_*</code> 类型的密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_GCM_C （依赖：MBEDTLS_AES_C、MBEDTLS_CAMELLIA_C）</td><td align="left">启用该配置来支持 <code>*_AES_GCM_*</code>、<code>*_CAMELLIA_GCM_*</code> 类型的密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_REMOVE_ARC4_CIPHERSUITES</td><td align="left">默认启用，在 SSL/TLS 中禁用 RC4 密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ARC4_C</td><td align="left">启用 RC4 加密套件，<code>*_WITH_RC4*</code> 类型密码套件。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_CAMELLIA_C</td><td align="left">启用 Camellia 分组密码，用于支持 <code>*_WITH_CAMELLIA_*</code> 类型的密码套件。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_CIPHER_MODE_CBC</td><td align="left">为对称密码启用密码块链接模式（CBC）。如果使用了 CBC 密码套件则需要启用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_CIPHER_MODE_CFB</td><td align="left">为对称密码启用密码反馈模式（CFB）。如果使用了 CFB 密码套件则需要启用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_CIPHER_MODE_CTR</td><td align="left">启用对称密码的计数器分组密码模式（CTR）。如果使用了 CTR 密码套件则需要启用</td><td align="left">根据需要选择</td></tr><tr><td align="left"><strong>MBEDTLS_CIPHER_PADDING_XXX</strong></td><td align="left">在密码层中启用填充模式。如果禁用所有填充模式，则只有完整块可以与 CBC 一起使用</td><td align="left">根据需要选择，可以全禁用</td></tr><tr><td align="left">MBEDTLS_CIPHER_PADDING_PKCS7</td><td align="left"></td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_CIPHER_PADDING_ONE_AND_ZEROS</td><td align="left"></td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_CIPHER_PADDING_ZEROS_AND_LEN</td><td align="left"></td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_CIPHER_PADDING_ZEROS</td><td align="left"></td><td align="left">可以禁用</td></tr><tr><td align="left"><strong>MBEDTLS_CIPHER_PADDING_XXX</strong></td><td align="left"></td><td align="left"></td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_ECDH_RSA_ENABLED （依赖：MBEDTLS_ECDH_C、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_ECDH_RSA_* 类型的密码套件</code></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_ECDHE_RSA_ENABLED （依赖：MBEDTLS_ECDH_C、MBEDTLS_RSA_C、MBEDTLS_PKCS1_V15、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_ECDHE_RSA_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA_ENABLED （依赖：MBEDTLS_ECDH_C、MBEDTLS_ECDSA_C、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_ECDHE_ECDSA_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_ECDH_ECDSA_ENABLED （依赖：MBEDTLS_ECDH_C、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_ECDHE_ECDSA_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_DHE_RSA_ENABLED （依赖：MBEDTLS_DHM_C、MBEDTLS_RSA_C、MBEDTLS_PKCS1_V15、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_DHE_RSA_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_PSK_ENABLED</td><td align="left">启用 <code>*_PSK_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_DHE_PSK_ENABLED（依赖：MBEDTLS_DHM_C）</td><td align="left">启用 <code>*_DHE_PSK_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_ECDHE_PSK_ENABLED （依赖：MBEDTLS_ECDH_C）</td><td align="left">启用 <code>*_ECDHE_PSK_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_RSA_PSK_ENABLED （依赖：MBEDTLS_RSA_C、MBEDTLS_PKCS1_V15、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_RSA_PSK_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_KEY_EXCHANGE_RSA_ENABLED （依赖：MBEDTLS_RSA_C、MBEDTLS_PKCS1_V15、MBEDTLS_X509_CRT_PARSE_C）</td><td align="left">启用 <code>*_RSA_*</code> 类型密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_CCM_C （依赖：MBEDTLS_AES_C 或 MBEDTLS_CAMELLIA_C）</td><td align="left">启用具有 CBC-MAC（CCM）模式的计数器用于128位分组密码，用于支持 AES-CCM 密码套件。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_DES_C</td><td align="left">启用 DES 块密码</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_DHM_C</td><td align="left">启用 Diffie-Hellman-Merkle 模块，用于支持 DHE-RSA, DHE-PSK 密码套件。根据需要选择是否禁用</td><td align="left">根据需要选择</td></tr></tbody></table> 
<h4><a id="_239"></a>椭圆曲线相关配置</h4> 
<p>用户成功选择了匹配的加密套件，并验证可以正常建立握手连接和加密通讯后，可以尝试将加密套件不需要的椭圆曲线禁用。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_ECDH_C （依赖：MBEDTLS_ECP_C）</td><td align="left">启用椭圆曲线 Diffie-Hellman 库。用于支持 <code>*_ECDHE_ECDSA_*</code>、<code>*_ECDHE_RSA_*</code>、<code>*_DHE_PSK_*</code> 类型的密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECDSA_C（依赖：MBEDTLS_ECP_C、MBEDTLS_ASN1_WRITE_C、MBEDTLS_ASN1_PARSE_C）</td><td align="left">用于支持 <code>*_ECDHE_ECDSA_*</code> 类型的密码套件</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_C（依赖：MBEDTLS_BIGNUM_C 和至少一个 MBEDTLS_ECP_DP_XXX_ENABLED）</td><td align="left">启用 GF§ 椭圆曲线</td><td align="left">根据需要选择</td></tr><tr><td align="left"><strong>MBEDTLS_ECP_XXXX_ENABLED</strong></td><td align="left">在椭圆曲线模块中启用特定的曲线。默认情况下启用所有支持的曲线。可以根据实际情况选择一个曲线即可</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP192R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP224R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP256R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP384R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP521R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP192K1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP224K1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_SECP256K1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_BP256R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_BP384R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_BP512R1_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_ECP_DP_CURVE25519_ENABLED</td><td align="left"></td><td align="left">根据需要选择</td></tr><tr><td align="left"><strong>MBEDTLS_ECP_XXXX_ENABLED</strong></td><td align="left"></td><td align="left"></td></tr></tbody></table> 
<h4><a id="TLS__263"></a>TLS 版本选择相关配置</h4> 
<p>通常 SSL/TLS 服务器支持多种 TLS 协议版本，客户端则不需要支持所有的协议版本。因此在确定服务器支持的 TLS 协议版本后，可以禁用其他版本的协议。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_SSL_PROTO_TLS1 （依赖：MBEDTLS_MD5_C、MBEDTLS_SHA1_C）</td><td align="left">启用对 TLS 1.0 版本的支持</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_SSL_PROTO_TLS1_1（依赖：MBEDTLS_MD5_C、MBEDTLS_SHA1_C）</td><td align="left">启用对 TLS 1.1 版本的支持</td><td align="left">根据需要选择</td></tr><tr><td align="left">MBEDTLS_SSL_PROTO_TLS1_2（依赖：MBEDTLS_SHA1_C 或者 MBEDTLS_SHA256_C 或者 MBEDTLS_SHA512_C）</td><td align="left">启用对 TLS 1.2 版本的支持</td><td align="left">根据需要选择</td></tr></tbody></table> 
<h4><a id="DTLS__273"></a>DTLS 相关配置</h4> 
<p>DTLS 是基于 UDP 的安全加密连接，目的是保障 UDP 通讯的数据安全。由于 UDP 本身不支持自动重传，且存在丢包问题，所以在进行握手连接的时候与 TLS 有些许不同，但两者重复了大部分的代码。因此可以通过下表中的配置来优化 DTLS 加密连接。</p> 
<p>如果用户的系统中，不需要使用 DTLS，则可以将下表中的所有配置禁用。</p> 
<table><thead><tr><th align="left">配置</th><th align="left">说明</th><th align="left">优化建议</th></tr></thead><tbody><tr><td align="left">MBEDTLS_SSL_PROTO_DTLS（依赖：MBEDTLS_SSL_PROTO_TLS1_1 或 MBEDTLS_SSL_PROTO_TLS1_2）</td><td align="left">启用 DTLS 功能，用于对 UDP 进行加密</td><td align="left">如果不需要 DTLS 加密连接，则禁用</td></tr><tr><td align="left">MBEDTLS_SSL_DTLS_ANTI_REPLAY（依赖：MBEDTLS_SSL_TLS_C、MBEDTLS_SSL_PROTO_DTLS）</td><td align="left">启用对DTLS中的反重放机制的支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_DTLS_HELLO_VERIFY（依赖：MBEDTLS_SSL_PROTO_DTLS）</td><td align="left">启用对 DTLS HelloVerifyRequest 的支持</td><td align="left">需要开启</td></tr><tr><td align="left">MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE （依赖：MBEDTLS_SSL_DTLS_HELLO_VERIFY）</td><td align="left">为从同一端口重新连接的客户端启用服务器端支持，需要服务器特殊支持</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_DTLS_BADMAC_LIMIT（依赖：MBEDTLS_SSL_PROTO_DTLS）</td><td align="left">启用支持 MAC 错误的记录限制</td><td align="left">可以禁用</td></tr><tr><td align="left">MBEDTLS_SSL_COOKIE_C</td><td align="left">DTLS hello cookie 支持。非 DTLS 下可以禁用</td><td align="left">可以禁用</td></tr></tbody></table> 
<h3><a id="_288"></a>参考</h3> 
<ul><li>mbedTLS 官方网站：https://tls.mbed.org/</li><li>测试时用的配置文件</li></ul> 
<pre><code class="prism language-c"><span class="token comment">/* tls_config.h*/</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> MBEDTLS_CONFIG_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_CONFIG_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;rtthread.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">if</span> defined(_MSC_VER) &amp;&amp; !defined(_CRT_SECURE_NO_DEPRECATE)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_DEPRECATE 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_HAVE_ASM</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_HAVE_TIME</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ASN1_PARSE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ASN1_WRITE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_BIGNUM_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_CIPHER_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_AES_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_CTR_DRBG_C</span>
<span class="token comment">// #define MBEDTLS_ECDH_C</span>
<span class="token comment">// #define MBEDTLS_ECDSA_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_C</span>
<span class="token comment">// #define MBEDTLS_GCM_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_MD_C</span>
<span class="token comment">// #define MBEDTLS_NET_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_OID_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_PK_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_PK_PARSE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SHA256_C</span>
<span class="token comment">// #define MBEDTLS_SHA512_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SSL_CLI_C</span>
<span class="token comment">// #define MBEDTLS_SSL_SRV_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SSL_TLS_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_X509_CRT_PARSE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_X509_USE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_BASE64_C</span>
<span class="token comment">// #define MBEDTLS_CERTS_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_PEM_PARSE_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_AES_ROM_TABLES</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_MPI_MAX_SIZE         384</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_MPI_WINDOW_SIZE        2</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_MAX_BITS         384</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_WINDOW_SIZE        2</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_FIXED_POINT_OPTIM  0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_NIST_OPTIM</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ENTROPY_MAX_SOURCES 2</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SSL_CIPHERSUITES                        \
    MBEDTLS_TLS_RSA_WITH_AES_256_CBC_SHA256</span>

<span class="token comment">// #define MBEDTLS_SSL_MAX_CONTENT_LEN             3584</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_NO_PLATFORM_ENTROPY</span>
<span class="token comment">// #define MBEDTLS_TLS_DEFAULT_ALLOW_SHA1_IN_KEY_EXCHANGE</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_RSA_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SHA1_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_TIMING_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ENTROPY_HARDWARE_ALT</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_TIMING_ALT</span>
<span class="token comment">// #define MBEDTLS_DEBUG_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_MD5_C</span>
<span class="token comment">// #define MBEDTLS_HAVE_TIME_DATE</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_CIPHER_MODE_CBC</span>
<span class="token comment">// #define MBEDTLS_CIPHER_MODE_CFB</span>
<span class="token comment">// #define MBEDTLS_CIPHER_MODE_CTR</span>
<span class="token comment">// #define MBEDTLS_CIPHER_PADDING_PKCS7</span>
<span class="token comment">// #define MBEDTLS_CIPHER_PADDING_ONE_AND_ZEROS</span>
<span class="token comment">// #define MBEDTLS_CIPHER_PADDING_ZEROS_AND_LEN</span>
<span class="token comment">// #define MBEDTLS_CIPHER_PADDING_ZEROS</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_REMOVE_ARC4_CIPHERSUITES</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP192R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP224R1_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_DP_SECP256R1_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ECP_DP_SECP384R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP521R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP192K1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP224K1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_SECP256K1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_BP256R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_BP384R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_BP512R1_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECP_DP_CURVE25519_ENABLED</span>
<span class="token comment">// #define MBEDTLS_ECDSA_DETERMINISTIC</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_ECDH_RSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_ECDHE_RSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_ECDH_ECDSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_DHE_RSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_PSK_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_DHE_PSK_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_ECDHE_PSK_ENABLED</span>
<span class="token comment">// #define MBEDTLS_KEY_EXCHANGE_RSA_PSK_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_KEY_EXCHANGE_RSA_ENABLED</span>
<span class="token comment">// #define MBEDTLS_PK_PARSE_EC_EXTENDED</span>
<span class="token comment">// #define MBEDTLS_ERROR_STRERROR_DUMMY</span>
<span class="token comment">// #define MBEDTLS_GENPRIME</span>
<span class="token comment">// #define MBEDTLS_FS_IO</span>
<span class="token comment">// #define MBEDTLS_PK_RSA_ALT_SUPPORT</span>
<span class="token comment">// #define MBEDTLS_PKCS12_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_PKCS1_V15</span>
<span class="token comment">// #define MBEDTLS_PKCS1_V21</span>
<span class="token comment">// #define MBEDTLS_SELF_TEST</span>
<span class="token comment">// #define MBEDTLS_SSL_ALL_ALERT_MESSAGES</span>
<span class="token comment">// #define MBEDTLS_SSL_ENCRYPT_THEN_MAC</span>
<span class="token comment">// #define MBEDTLS_SSL_EXTENDED_MASTER_SECRET</span>
<span class="token comment">// #define MBEDTLS_SSL_FALLBACK_SCSV</span>
<span class="token comment">// #define MBEDTLS_SSL_CBC_RECORD_SPLITTING</span>
<span class="token comment">// #define MBEDTLS_SSL_RENEGOTIATION</span>
<span class="token comment">// #define MBEDTLS_SSL_MAX_FRAGMENT_LENGTH</span>
<span class="token comment">// #define MBEDTLS_SSL_PROTO_TLS1</span>
<span class="token comment">// #define MBEDTLS_SSL_PROTO_TLS1_1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_SSL_PROTO_TLS1_2</span>
<span class="token comment">// #define MBEDTLS_SSL_ALPN</span>
<span class="token comment">// #define MBEDTLS_SSL_PROTO_DTLS</span>
<span class="token comment">// #define MBEDTLS_SSL_DTLS_ANTI_REPLAY</span>
<span class="token comment">// #define MBEDTLS_SSL_DTLS_HELLO_VERIFY</span>
<span class="token comment">// #define MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE</span>
<span class="token comment">// #define MBEDTLS_SSL_DTLS_BADMAC_LIMIT</span>
<span class="token comment">// #define MBEDTLS_SSL_SESSION_TICKETS</span>
<span class="token comment">// #define MBEDTLS_SSL_EXPORT_KEYS</span>
<span class="token comment">// #define MBEDTLS_SSL_SERVER_NAME_INDICATION</span>
<span class="token comment">// #define MBEDTLS_SSL_TRUNCATED_HMAC</span>
<span class="token comment">// #define MBEDTLS_VERSION_FEATURES</span>
<span class="token comment">// #define MBEDTLS_X509_CHECK_KEY_USAGE</span>
<span class="token comment">// #define MBEDTLS_X509_CHECK_EXTENDED_KEY_USAGE</span>
<span class="token comment">// #define MBEDTLS_X509_RSASSA_PSS_SUPPORT</span>
<span class="token comment">// #define MBEDTLS_AESNI_C</span>
<span class="token comment">// #define MBEDTLS_ARC4_C</span>
<span class="token comment">// #define MBEDTLS_BLOWFISH_C</span>
<span class="token comment">// #define MBEDTLS_CAMELLIA_C</span>
<span class="token comment">// #define MBEDTLS_CCM_C</span>
<span class="token comment">// #define MBEDTLS_DES_C</span>
<span class="token comment">// #define MBEDTLS_DHM_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_ENTROPY_C</span>
<span class="token comment">// #define MBEDTLS_ERROR_C</span>
<span class="token comment">// #define MBEDTLS_HMAC_DRBG_C</span>
<span class="token comment">// #define MBEDTLS_PADLOCK_C</span>
<span class="token comment">// #define MBEDTLS_PEM_WRITE_C</span>
<span class="token comment">// #define MBEDTLS_PK_WRITE_C</span>
<span class="token comment">// #define MBEDTLS_PKCS5_C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MBEDTLS_PLATFORM_C</span>
<span class="token comment">// #define MBEDTLS_RIPEMD160_C</span>
<span class="token comment">// #define MBEDTLS_SSL_CACHE_C</span>
<span class="token comment">// #define MBEDTLS_SSL_COOKIE_C</span>
<span class="token comment">// #define MBEDTLS_SSL_TICKET_C</span>
<span class="token comment">// #define MBEDTLS_VERSION_C   </span>
<span class="token comment">// #define MBEDTLS_X509_CRL_PARSE_C</span>
<span class="token comment">// #define MBEDTLS_X509_CSR_PARSE_C</span>
<span class="token comment">// #define MBEDTLS_X509_CREATE_C</span>
<span class="token comment">// #define MBEDTLS_X509_CRT_WRITE_C   </span>
<span class="token comment">// #define MBEDTLS_X509_CSR_WRITE_C   </span>
<span class="token comment">// #define MBEDTLS_XTEA_C</span>

<span class="token macro property">#<span class="token directive keyword">if</span> defined(YOTTA_CFG_MBEDTLS_USER_CONFIG_FILE)</span>
<span class="token macro property">#<span class="token directive keyword">include</span> YOTTA_CFG_MBEDTLS_USER_CONFIG_FILE</span>
<span class="token macro property">#<span class="token directive keyword">elif</span> defined(MBEDTLS_USER_CONFIG_FILE)</span>
<span class="token macro property">#<span class="token directive keyword">include</span> MBEDTLS_USER_CONFIG_FILE</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"mbedtls/check_config.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> tls_malloc  rt_malloc</span>
<span class="token macro property">#<span class="token directive keyword">define</span> tls_free    rt_free</span>
<span class="token macro property">#<span class="token directive keyword">define</span> tls_realloc rt_realloc</span>
<span class="token macro property">#<span class="token directive keyword">define</span> tls_calloc  rt_calloc</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* MBEDTLS_CONFIG_H */</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4927bdbf87f7c2a525779b6ff5b54fdb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mbedtls学习2.mbedtls从0使用指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0da0ff195ef4097b185ec842584bbd9a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">常用统计量及其常见分布</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>