<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS7 使用docker部署Nginx&#43;PHP环境 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS7 使用docker部署Nginx&#43;PHP环境" />
<meta property="og:description" content="下载nginx和php镜像
$ docker pull php $ docker pull nginx 创建 Dockerfile文件， Dockerfile是由一系列命令和参数构成的脚本，这些命令应用于基础镜像并最终创建一个新的镜像 （个人创建在/var/lib/docker的phpdockerfile目录下）
$ mkdir phpdockerfile $ cd phpdockerfile $ touch Dockerfile Dockerfile文件中写入以下代码
FROM php:5.6-fpm RUN apt-get update &amp;&amp; apt-get install -y \ libfreetype6-dev \ libjpeg62-turbo-dev \ libmcrypt-dev \ libpng-dev \ &amp;&amp; docker-php-ext-install -j$(nproc) iconv mcrypt \ &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \ &amp;&amp; docker-php-ext-install -j$(nproc) gd RUN docker-php-ext-install mbstring RUN docker-php-ext-install mysqli RUN docker-php-ext-install pdo &amp;&amp; docker-php-ext-install pdo_mysql 创建镜像，**pdophp 代表新镜像名可自定义，." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/33b4cc2c7b77f2782e0dd1fe8901d3f3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-24T15:41:01+08:00" />
<meta property="article:modified_time" content="2021-06-24T15:41:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS7 使用docker部署Nginx&#43;PHP环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ol><li> <p>下载nginx和php镜像</p> <pre><code>$ docker pull php
$ docker pull nginx
</code></pre> </li><li> <p>创建 <strong>Dockerfile</strong>文件， Dockerfile是由一系列命令和参数构成的脚本，这些命令应用于基础镜像并最终创建一个新的镜像 （个人创建在/var/lib/docker的phpdockerfile目录下）</p> <pre><code>$ mkdir phpdockerfile
$ cd phpdockerfile
$ touch Dockerfile
</code></pre> <p>Dockerfile文件中写入以下代码</p> <pre><code>FROM php:5.6-fpm

RUN apt-get update &amp;&amp; apt-get install -y \
        libfreetype6-dev \
        libjpeg62-turbo-dev \
        libmcrypt-dev \
        libpng-dev \
    &amp;&amp; docker-php-ext-install -j$(nproc) iconv mcrypt \
    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
    &amp;&amp; docker-php-ext-install -j$(nproc) gd

RUN docker-php-ext-install mbstring

RUN docker-php-ext-install mysqli

RUN docker-php-ext-install pdo &amp;&amp; docker-php-ext-install pdo_mysql 
</code></pre> <p>创建镜像，**pdophp <strong>代表新镜像名可自定义，</strong>. **代表当前目录 docker自动去找Dockerfile文件</p> <p><code>$ docker build -t pdophp .</code></p> </li><li> <p>根据创建的pdophp镜像，建立容器互连php与nginx，并建立文件映射</p> <pre><code>// myphp1 容器名(可自定义)
// bridge 网络组名称(可通过docker network ls命令查找已有网络组名称)
// /Users/xxx/Works/web/工作目录(可自定义)
// --name 容器命名
// -v 设置挂载目录
docker run --name myphp1 --net bridge -v /Users/xxx/Works/web/:/var/www/html/ --privileged=true -d pdophp
</code></pre> <pre><code>// mynginx1 容器名(可自定义)
// bridge 网络组名称（可通过docker network ls命令查找已有网络组名称）
// /Users/xxx/Works/web 工作目录(可自定义)
// /Users/xxx/Works/docker/nginx/conf.d/ nginx配置文件(可自定义)
// --name 容器命名
// -p 设置映射端口
// -v 设置挂载目录
docker run --name mynginx1  -p 80:80 --net workend  -v /Users/xxx/Works/web:/usr/share/nginx/html -v /Users/xxx/Works/docker/nginx/conf.d/:/etc/nginx/conf.d --privileged=true -d nginx 
</code></pre> <p>查找网络组名称</p> <p><code>docker network ls</code><br> <img src="https://images2.imgbox.com/d4/2c/ofBByHpY_o.png" alt="在这里插入图片描述"></p> </li><li> <p>查看容器运行情况</p> <p><code>$ docker ps -a</code> 查看所有容器</p> <p><code>$ docker ps</code> 查看正在运行的容器</p> <p><img src="https://images2.imgbox.com/86/a9/TCPytUcg_o.png" alt="在这里插入图片描述"></p> </li><li> <p>建立nginx配置文件</p> <p>首先注意上一步中myphp1的端口为9000</p> <p>在**/Users/xxx/Works/docker/nginx/conf.d/<strong>下创建</strong>default.conf**</p> <p>当前使用thinkphp的配置举例</p> <pre><code>server {
        listen       80;
        server_name  域名或ip;
	root        /var/www/html/think-5.1/public;


        location / {
            index  index.html index.htm index.php;
	       try_files $uri $uri/ /index.php?$query_string;
            autoindex  off;
        }
        location ~ \.php(.*)$ {
            fastcgi_pass   myphp1:9000;
            fastcgi_index  index.php;
            fastcgi_split_path_info  ^((?U).+\.php)(/?.+)$;          
	       fastcgi_param  SCRIPT_FILENAME $document_root/$fastcgi_script_name;
            fastcgi_param  PATH_INFO  $fastcgi_path_info;
            fastcgi_param  PATH_TRANSLATED  $document_root$fastcgi_path_info;
            include        fastcgi_params;
        }
}
</code></pre> <p>重启mynginx1</p> <p><code>docker restart mynginx1</code></p> <p>注意：如果发现无法正常启动mynginx1，可能是<strong>fastcgi_pass myphp1:9000;</strong> 中的<strong>myphp1</strong>的问题</p> <p>可使用命令获取ip进行替换</p> <pre><code>docker inspect --format='{<!-- -->{.NetworkSettings.IPAddress}}' myphp1
</code></pre> </li><li> <p>在**/Users/xxx/Works/web/** 目录下上传thinkphp代码即可</p> </li></ol> 
<p>参考：https://my.oschina.net/u/210357/blog/1186820</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf5abab73073c49bfe060b0049504c93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mac bash切换zsh 之后报 zsh: command not found:XXX 的解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8304c6ed066ed1184bffa03bb6580bb7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">flask&#43;pyecharts显示中国省份地图出现的问题1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>