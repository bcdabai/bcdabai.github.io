<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>响应式编程WebFlux基础实战练习 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="响应式编程WebFlux基础实战练习" />
<meta property="og:description" content="什么是WebFlux？
响应式编程WebFlux是Spring Framework 5中引入的一个全新的响应式编程框架，它基于Reactor库构建，提供了异步和非阻塞的事件处理。WebFlux框架设计用于处理长时间运行的异步任务，例如网络调用或数据库操作，而不会阻塞线程。这样可以提高系统的吞吐量和伸缩性。并在Netty，Undertow和Servlet 3.1 &#43;容器等服务器上运行。
WebFlux基础实战练习 0. WebFlun环境准备 基于Spring Boot，项目依赖
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt; &lt;/parent&gt; &lt;artifactId&gt;chapter04-webflux&lt;/artifactId&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-bom&lt;/artifactId&gt; &lt;version&gt;2023.0.0&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-core&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- Spring Boot Starter Test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt; &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt; &lt;version&gt;5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6142c9068fa0fd05046f9cc9808c5849/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T16:41:41+08:00" />
<meta property="article:modified_time" content="2024-01-12T16:41:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">响应式编程WebFlux基础实战练习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>什么是WebFlux？<br> 响应式编程WebFlux是Spring Framework 5中引入的一个全新的响应式编程框架，它基于Reactor库构建，提供了异步和非阻塞的事件处理。WebFlux框架设计用于处理长时间运行的异步任务，例如网络调用或数据库操作，而不会阻塞线程。这样可以提高系统的吞吐量和伸缩性。并在Netty，Undertow和Servlet 3.1 +容器等服务器上运行。</p> 
</blockquote> 
<h3><a id="WebFlux_3"></a>WebFlux基础实战练习</h3> 
<h4><a id="0_WebFlun_5"></a>0. WebFlun环境准备</h4> 
<blockquote> 
 <p>基于Spring Boot，项目依赖</p> 
</blockquote> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>chapter04-webflux<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-bom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2023.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-webflux<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Spring Boot Starter Test --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>启动类<br> Spring Boot 有一个 WebFlux 启动器，默认情况下，启动器使用 Netty</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebFluxMainApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">WebFluxMainApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1__87"></a>1. <strong>基于注解的编程模式</strong></h4> 
<blockquote> 
 <p>WebFlux提供了两种主要的编程模式，分别是基于注解的编程模式（Annotation-based Programming）和函数式编程模式（Functional Programming）。</p> 
</blockquote> 
<p><strong>基于注解的编程模式（Annotation-based Programming）：</strong> 这是类似于传统的Spring MVC风格的编程模式。开发者可以使用注解来定义Controller、请求映射、参数绑定等，类似于Spring MVC的@Controller和@RequestMapping注解。使用这种模式，开发者可以通过注解轻松地定义和配置应用程序的各个组件。</p> 
<h5><a id="WebFlux_93"></a>WebFlux基于注解的编程模式的工作流程图：</h5> 
<div class="mermaid"> 
 <svg id="mermaid-svg-NtEl2JJAJjjjlGKO" width="151.515625" xmlns="http://www.w3.org/2000/svg" height="550" viewbox="0 0 151.515625 550" class="mermaid-svg"> 
  <style>#mermaid-svg-NtEl2JJAJjjjlGKO {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .error-icon{fill:#552222;}#mermaid-svg-NtEl2JJAJjjjlGKO .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-NtEl2JJAJjjjlGKO .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-NtEl2JJAJjjjlGKO .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-NtEl2JJAJjjjlGKO .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-NtEl2JJAJjjjlGKO .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-NtEl2JJAJjjjlGKO .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-NtEl2JJAJjjjlGKO .marker{fill:#333333;stroke:#333333;}#mermaid-svg-NtEl2JJAJjjjlGKO .marker.cross{stroke:#333333;}#mermaid-svg-NtEl2JJAJjjjlGKO svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-NtEl2JJAJjjjlGKO .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .cluster-label text{fill:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .cluster-label span{color:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .label text,#mermaid-svg-NtEl2JJAJjjjlGKO span{fill:#333;color:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .node rect,#mermaid-svg-NtEl2JJAJjjjlGKO .node circle,#mermaid-svg-NtEl2JJAJjjjlGKO .node ellipse,#mermaid-svg-NtEl2JJAJjjjlGKO .node polygon,#mermaid-svg-NtEl2JJAJjjjlGKO .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-NtEl2JJAJjjjlGKO .node .label{text-align:center;}#mermaid-svg-NtEl2JJAJjjjlGKO .node.clickable{cursor:pointer;}#mermaid-svg-NtEl2JJAJjjjlGKO .arrowheadPath{fill:#333333;}#mermaid-svg-NtEl2JJAJjjjlGKO .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-NtEl2JJAJjjjlGKO .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-NtEl2JJAJjjjlGKO .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-NtEl2JJAJjjjlGKO .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-NtEl2JJAJjjjlGKO .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-NtEl2JJAJjjjlGKO .cluster text{fill:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO .cluster span{color:#333;}#mermaid-svg-NtEl2JJAJjjjlGKO div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-NtEl2JJAJjjjlGKO :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;"> 
      <path class="path" d="M75.7578125,54L75.7578125,60.333333333333336C75.7578125,66.66666666666667,75.7578125,79.33333333333333,75.7578125,92C75.7578125,104.66666666666667,75.7578125,117.33333333333333,75.7578125,123.66666666666667L75.7578125,130" marker-end="url(#arrowhead142)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead142" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-C" style="opacity: 1;" id="L-B-C"> 
      <path class="path" d="M75.7578125,176L75.7578125,182.33333333333334C75.7578125,188.66666666666666,75.7578125,201.33333333333334,75.7578125,214C75.7578125,226.66666666666666,75.7578125,239.33333333333334,75.7578125,245.66666666666666L75.7578125,252" marker-end="url(#arrowhead143)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead143" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-D" style="opacity: 1;" id="L-C-D"> 
      <path class="path" d="M75.7578125,298L75.7578125,304.3333333333333C75.7578125,310.6666666666667,75.7578125,323.3333333333333,75.7578125,336C75.7578125,348.6666666666667,75.7578125,361.3333333333333,75.7578125,367.6666666666667L75.7578125,374" marker-end="url(#arrowhead144)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead144" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-D LE-E" style="opacity: 1;" id="L-D-E"> 
      <path class="path" d="M75.7578125,420L75.7578125,426.3333333333333C75.7578125,432.6666666666667,75.7578125,445.3333333333333,75.7578125,458C75.7578125,470.6666666666667,75.7578125,483.3333333333333,75.7578125,489.6666666666667L75.7578125,496" marker-end="url(#arrowhead145)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead145" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(75.7578125,92)" style="opacity: 1;"> 
      <g transform="translate(-32,-13)" class="label"> 
       <rect rx="0" ry="0" width="64" height="26"></rect> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B">请求到达</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(75.7578125,214)"> 
      <g transform="translate(-32,-13)" class="label"> 
       <rect rx="0" ry="0" width="64" height="26"></rect> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-C" class="edgeLabel L-LS-B' L-LE-C">注解映射</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(75.7578125,336)"> 
      <g transform="translate(-48,-13)" class="label"> 
       <rect rx="0" ry="0" width="96" height="26"></rect> 
       <foreignobject width="96" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-D" class="edgeLabel L-LS-C' L-LE-D">业务逻辑处理</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(75.7578125,458)"> 
      <g transform="translate(-32,-13)" class="label"> 
       <rect rx="0" ry="0" width="64" height="26"></rect> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-D-E" class="edgeLabel L-LS-D' L-LE-E">响应构建</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="flowchart-A-117" transform="translate(75.7578125,31)" style="opacity: 1;"> 
      <rect rx="0" ry="0" x="-50" y="-23" width="100" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-40,-13)"> 
        <foreignobject width="80" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           客户端请求 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-118" transform="translate(75.7578125,153)"> 
      <rect rx="5" ry="5" x="-46.21875" y="-23" width="92.4375" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-36.21875,-13)"> 
        <foreignobject width="72.4375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Controller 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-120" transform="translate(75.7578125,275)"> 
      <rect rx="5" ry="5" x="-67.7578125" y="-23" width="135.515625" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-57.7578125,-13)"> 
        <foreignobject width="115.515625" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           RequestMapping 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-D-122" transform="translate(75.7578125,397)"> 
      <rect rx="5" ry="5" x="-28.6328125" y="-23" width="57.265625" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-18.6328125,-13)"> 
        <foreignobject width="37.265625" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Mono 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-E-124" transform="translate(75.7578125,519)"> 
      <rect rx="0" ry="0" x="-34" y="-23" width="68" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-24,-13)"> 
        <foreignobject width="48" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           客户端 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h5><a id="_109"></a>代码示例</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebFluxController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/mono"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">"Hello, Mono!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/flux"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">fluxExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试</p> 
<blockquote> 
 <p>GET http://localhost:8080/mono 返回响应：Hello, Mono!</p> 
 <p>GET http://localhost:8080/flux 返回响应：[1,2,3,4,5]</p> 
</blockquote> 
<h5><a id="API_138"></a>相关API</h5> 
<ol><li> <p><strong><code>Mono</code>：</strong></p> 
  <ul><li><code>Mono</code> 是 Reactor 中表示包含零个或一个元素的响应式类型。</li><li>适用于表示异步操作的结果，例如从数据库查询、网络调用或其他异步任务中返回的单个结果。</li><li>可以通过 <code>Mono.just(value)</code> 创建包含单个值的 <code>Mono</code>，也可以通过各种操作符对 <code>Mono</code> 进行组合、转换和操作。</li><li><code>Mono</code> 可以表示一个成功的结果，也可以表示错误或空值。</li></ul> </li><li> <p><strong><code>Flux</code>：</strong></p> 
  <ul><li><code>Flux</code> 是 Reactor 中表示包含零个、一个或多个元素的响应式类型。</li><li>适用于表示异步流的结果，例如从事件流、消息队列或其他异步源中返回的多个元素。</li><li>可以通过 <code>Flux.just(value1, value2, ...)</code> 创建包含多个值的 <code>Flux</code>，也可以通过各种操作符对 <code>Flux</code> 进行处理和转换。</li><li><code>Flux</code> 支持背压（backpressure），可以有效地处理大量的异步数据。</li></ul> </li></ol> 
<p>在使用 WebFlux 框架时，<code>Mono</code> 和 <code>Flux</code> 通常用于表示响应的内容。<code>Mono</code> 表示单一值的响应，而 <code>Flux</code> 表示包含多个值的响应，适用于处理异步请求和构建响应式应用程序。</p> 
<h4><a id="2__155"></a>2. <strong>函数式编程模式</strong></h4> 
<p><strong>函数式编程模式（Functional Programming）：</strong> 这是WebFlux的另一种编程模式，它使用Router和Handler函数。开发者通过编写函数式的路由和处理器来定义请求的处理逻辑，而不是使用注解。这种模式更加灵活，并且适用于需要更直观、函数式风格的代码。</p> 
<h5><a id="WebFlux_159"></a>WebFlux基于函数式编程模式的工作流程图：</h5> 
<div class="mermaid"> 
 <svg id="mermaid-svg-1M0EAmb9ABqRpg3w" width="154.234375" xmlns="http://www.w3.org/2000/svg" height="550" viewbox="0 0 154.234375 550" class="mermaid-svg"> 
  <style>#mermaid-svg-1M0EAmb9ABqRpg3w {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .error-icon{fill:#552222;}#mermaid-svg-1M0EAmb9ABqRpg3w .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-1M0EAmb9ABqRpg3w .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1M0EAmb9ABqRpg3w .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1M0EAmb9ABqRpg3w .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1M0EAmb9ABqRpg3w .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1M0EAmb9ABqRpg3w .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1M0EAmb9ABqRpg3w .marker{fill:#333333;stroke:#333333;}#mermaid-svg-1M0EAmb9ABqRpg3w .marker.cross{stroke:#333333;}#mermaid-svg-1M0EAmb9ABqRpg3w svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1M0EAmb9ABqRpg3w .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .cluster-label text{fill:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .cluster-label span{color:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .label text,#mermaid-svg-1M0EAmb9ABqRpg3w span{fill:#333;color:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .node rect,#mermaid-svg-1M0EAmb9ABqRpg3w .node circle,#mermaid-svg-1M0EAmb9ABqRpg3w .node ellipse,#mermaid-svg-1M0EAmb9ABqRpg3w .node polygon,#mermaid-svg-1M0EAmb9ABqRpg3w .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-1M0EAmb9ABqRpg3w .node .label{text-align:center;}#mermaid-svg-1M0EAmb9ABqRpg3w .node.clickable{cursor:pointer;}#mermaid-svg-1M0EAmb9ABqRpg3w .arrowheadPath{fill:#333333;}#mermaid-svg-1M0EAmb9ABqRpg3w .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-1M0EAmb9ABqRpg3w .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-1M0EAmb9ABqRpg3w .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-1M0EAmb9ABqRpg3w .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-1M0EAmb9ABqRpg3w .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-1M0EAmb9ABqRpg3w .cluster text{fill:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w .cluster span{color:#333;}#mermaid-svg-1M0EAmb9ABqRpg3w div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1M0EAmb9ABqRpg3w :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;"> 
      <path class="path" d="M77.1171875,54L77.1171875,60.333333333333336C77.1171875,66.66666666666667,77.1171875,79.33333333333333,77.1171875,92C77.1171875,104.66666666666667,77.1171875,117.33333333333333,77.1171875,123.66666666666667L77.1171875,130" marker-end="url(#arrowhead171)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead171" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-C" style="opacity: 1;" id="L-B-C"> 
      <path class="path" d="M77.1171875,176L77.1171875,182.33333333333334C77.1171875,188.66666666666666,77.1171875,201.33333333333334,77.1171875,214C77.1171875,226.66666666666666,77.1171875,239.33333333333334,77.1171875,245.66666666666666L77.1171875,252" marker-end="url(#arrowhead172)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead172" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-D" style="opacity: 1;" id="L-C-D"> 
      <path class="path" d="M77.1171875,298L77.1171875,304.3333333333333C77.1171875,310.6666666666667,77.1171875,323.3333333333333,77.1171875,336C77.1171875,348.6666666666667,77.1171875,361.3333333333333,77.1171875,367.6666666666667L77.1171875,374" marker-end="url(#arrowhead173)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead173" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-D LE-E" style="opacity: 1;" id="L-D-E"> 
      <path class="path" d="M77.1171875,420L77.1171875,426.3333333333333C77.1171875,432.6666666666667,77.1171875,445.3333333333333,77.1171875,458C77.1171875,470.6666666666667,77.1171875,483.3333333333333,77.1171875,489.6666666666667L77.1171875,496" marker-end="url(#arrowhead174)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead174" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(77.1171875,92)" style="opacity: 1;"> 
      <g transform="translate(-32,-13)" class="label"> 
       <rect rx="0" ry="0" width="64" height="26"></rect> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B">请求到达</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(77.1171875,214)"> 
      <g transform="translate(-16,-13)" class="label"> 
       <rect rx="0" ry="0" width="32" height="26"></rect> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-C" class="edgeLabel L-LS-B' L-LE-C">路由</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(77.1171875,336)"> 
      <g transform="translate(-48,-13)" class="label"> 
       <rect rx="0" ry="0" width="96" height="26"></rect> 
       <foreignobject width="96" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-D" class="edgeLabel L-LS-C' L-LE-D">业务逻辑处理</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(77.1171875,458)"> 
      <g transform="translate(-32,-13)" class="label"> 
       <rect rx="0" ry="0" width="64" height="26"></rect> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-D-E" class="edgeLabel L-LS-D' L-LE-E">响应构建</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="flowchart-A-143" transform="translate(77.1171875,31)" style="opacity: 1;"> 
      <rect rx="0" ry="0" x="-50" y="-23" width="100" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-40,-13)"> 
        <foreignobject width="80" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           客户端请求 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-144" transform="translate(77.1171875,153)"> 
      <rect rx="5" ry="5" x="-64.6640625" y="-23" width="129.328125" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-54.6640625,-13)"> 
        <foreignobject width="109.328125" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           RouterFunction 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-146" transform="translate(77.1171875,275)"> 
      <rect rx="5" ry="5" x="-69.1171875" y="-23" width="138.234375" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-59.1171875,-13)"> 
        <foreignobject width="118.234375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           HandlerFunction 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-D-148" transform="translate(77.1171875,397)"> 
      <rect rx="5" ry="5" x="-65.3671875" y="-23" width="130.734375" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-55.3671875,-13)"> 
        <foreignobject width="110.734375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           ServerResponse 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-E-150" transform="translate(77.1171875,519)"> 
      <rect rx="0" ry="0" x="-34" y="-23" width="68" height="46" class="label-container" style="fill:#86B342;stroke:#333;stroke-width:2px;"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-24,-13)"> 
        <foreignobject width="48" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           客户端 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h5><a id="_175"></a>代码示例</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebFluxRouter</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">routeExample</span><span class="token punctuation">(</span><span class="token class-name">WebFluxHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/router/mono"</span><span class="token punctuation">,</span> handler<span class="token operator">::</span><span class="token function">monoExample</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/router/flux"</span><span class="token punctuation">,</span> handler<span class="token operator">::</span><span class="token function">fluxExample</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">class</span> <span class="token class-name">WebFluxHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoExample</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_PLAIN</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"Hello, Mono from Router!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">fluxExample</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>测试</p> 
<blockquote> 
 <p>GET http://localhost:8080/router/mono 返回响应：Hello, Mono from Router!</p> 
 <p>GET http://localhost:8080/flux 返回响应：[1,2,3,4,5]</p> 
</blockquote> 
<h5><a id="API_212"></a>相关API</h5> 
<ol><li><strong><code>RouterFunction&lt;ServerResponse&gt;</code>：</strong> 
  <ul><li><code>RouterFunction</code> 是 Spring WebFlux 中用于定义路由的函数接口。</li><li><code>RouterFunction&lt;ServerResponse&gt;</code> 表示这个函数定义了一组路由规则，每个路由规则都映射到一个处理器函数，用于处理特定的HTTP请求。</li><li>在这个例子中，<code>routeExample</code> 方法创建了一个路由函数，定义了两个GET请求的路由规则，分别映射到 <code>"/router/mono"</code> 和 <code>"/router/flux"</code> 路径，并指定了相应的处理器函数。</li></ul> </li><li><strong><code>ServerRequest</code>：</strong> 
  <ul><li><code>ServerRequest</code> 是 Spring WebFlux 中表示HTTP请求的对象。</li><li>在处理器函数中，<code>ServerRequest</code> 包含了与请求相关的信息，例如HTTP方法、路径、请求头等。</li><li>在这个例子中，<code>monoExample</code> 和 <code>fluxExample</code> 方法的参数中都包含了一个 <code>ServerRequest</code> 对象，用于处理相关的请求信息。</li></ul> </li><li><strong><code>ServerResponse</code>：</strong> 
  <ul><li><code>ServerResponse</code> 是 Spring WebFlux 中表示HTTP响应的对象。</li><li>通过 <code>ServerResponse</code>，可以设置响应的状态码、头部信息、内容类型等，并定义响应体。</li><li>在这个例子中，<code>monoExample</code> 和 <code>fluxExample</code> 方法的返回类型是 <code>Mono&lt;ServerResponse&gt;</code>，表示响应是一个响应式单值。</li></ul> </li><li><strong><code>MediaType</code>：</strong> 
  <ul><li><code>MediaType</code> 是 Spring 框架中表示媒体类型的枚举，用于指定HTTP请求和响应的媒体类型。</li><li>在这个例子中，<code>MediaType.TEXT_PLAIN</code> 表示文本媒体类型，而 <code>MediaType.APPLICATION_JSON</code> 表示JSON媒体类型。</li></ul> </li><li><strong><code>Mono</code> 和 <code>Flux</code>：</strong> 
  <ul><li><code>Mono</code> 和 <code>Flux</code> 是 Reactor 框架中的类型，用于处理响应式编程和异步数据流。</li><li>在这个例子中，<code>monoExample</code> 方法返回的是一个 <code>Mono&lt;ServerResponse&gt;</code>，而 <code>fluxExample</code> 方法返回的是一个 <code>Mono&lt;ServerResponse&gt;</code>，表示响应是异步单值或异步数据流。</li></ul> </li><li><strong><code>.bodyValue("Hello, Mono from Router!")</code>：</strong> 
  <ul><li><code>.bodyValue</code> 是 <code>ServerResponse</code> 中的方法，用于设置响应体的值。</li><li>在这个例子中，通过 <code>.bodyValue("Hello, Mono from Router!")</code> 设置了响应体的值为字符串 “Hello, Mono from Router!”。</li><li>这是一个简单的方式，适用于需要返回一个确定的值作为响应体的情况。</li></ul> </li><li><strong><code>.body(Flux.just(1, 2, 3, 4, 5).collectList(), List.class)</code>：</strong> 
  <ul><li><code>.body</code> 方法用于设置响应体，与 <code>.bodyValue</code> 不同，<code>.body</code> 可以处理更复杂的情况，例如异步数据流。</li><li>在这个例子中，使用了 <code>.body(Flux.just(1, 2, 3, 4, 5).collectList(), List.class)</code>，表示响应体是一个包含整数 1, 2, 3, 4, 5 的 <code>Flux</code>，通过 <code>collectList()</code> 转换为 <code>Mono&lt;List&lt;Integer&gt;&gt;</code>。</li><li><code>List.class</code> 参数提供了响应体的元素类型信息。</li></ul> </li></ol> 
<p>这些API和注解共同构建了一个基于WebFlux的响应式路由和处理器。路由定义通过 <code>RouterFunction</code> 创建，处理逻辑通过 <code>WebFluxHandler</code> 中的方法实现，而 <code>Mono</code> 和 <code>Flux</code> 用于表示异步的响应。</p> 
<h4><a id="3__243"></a>3. <strong>异常处理和全局错误处理</strong></h4> 
<h5><a id="_245"></a>代码示例</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebFluxExceptionHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"有错不改 ex = "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromValue</span><span class="token punctuation">(</span><span class="token string">"Error: 系统繁忙！"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>TODO：存在bug，目前拦截错误后不能正常响应"Error: 系统繁忙！"</li></ul> 
<h4><a id="4_WebFlux_262"></a>4. WebFlux集成测试</h4> 
<h5><a id="_264"></a>代码示例</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebTestClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">RANDOM_PORT</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebFluxIntegrationTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webTestClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testMonoEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        webTestClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/router/mono"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"Hello, Mono from Router!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFluxEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        webTestClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/router/flux"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectBodyList</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="API_300"></a>相关API</h5> 
<ol><li> <p><strong><code>@SpringBootTest</code> 注解</strong>:</p> 
  <ul><li>该注解表示这是一个Spring Boot的集成测试。</li><li><code>webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT</code> 表示在测试过程中随机选择一个可用端口。</li></ul> </li><li> <p><strong><code>WebTestClient</code> 对象</strong>:</p> 
  <ul><li>通过<code>@Autowired</code>注入<code>WebTestClient</code>，这是Spring框架提供的用于进行Web请求的测试客户端。</li></ul> </li><li> <p><strong><code>testMonoEndpoint</code> 方法</strong>:</p> 
  <ul><li>这是一个测试方法，用于测试一个返回单一值的WebFlux端点。</li><li><code>webTestClient.get()</code> 发起一个GET请求。</li><li><code>.uri("/router/mono")</code> 设置请求的URI为"/router/mono"。</li><li><code>.exchange()</code> 发送请求并获取响应。</li><li><code>.expectStatus().isOk()</code> 验证响应的HTTP状态码是否为OK（200）。</li><li><code>.expectBody(String.class).isEqualTo("Hello, Mono from Router!")</code> 验证响应体的内容是否为指定的字符串。</li></ul> </li><li> <p><strong><code>testFluxEndpoint</code> 方法</strong>:</p> 
  <ul><li>这是另一个测试方法，用于测试一个返回Flux（反应式流）的WebFlux端点。</li><li>与<code>testMonoEndpoint</code>类似，不同之处在于使用了<code>.expectBodyList(Integer.class)</code>来验证响应体是否为一个<code>List</code>，并且该<code>List</code>的元素类型为整数。</li><li>使用<code>.isEqualTo(List.of(1, 2, 3, 4, 5))</code>验证返回的整数列表是否与期望的一致。</li></ul> </li></ol> 
<p>总体来说，这个测试类通过<code>WebTestClient</code>发送HTTP请求到"/router/mono"和"/router/flux"端点，然后验证返回的响应是否符合预期。这样可以确保WebFlux端点的行为是正确的，同时也是一种测试反应式流的方式。</p> 
<blockquote> 
 <p>学习打卡day09：响应式编程WebFlux基础实战练习</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78358b24167f7582422e9bba4fdb2ee5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Think and Retrieval: A Hypothesis Knowledge Graph Enhanced Medical Large Language Models</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c7d4f5c1a85fb895237a4c8eebdb602b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">成绩转换 switch全部列出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>