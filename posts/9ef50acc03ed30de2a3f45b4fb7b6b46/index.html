<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python实现员工管理系统（Django页面版 ) 七 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python实现员工管理系统（Django页面版 ) 七" />
<meta property="og:description" content="各位小伙伴们好久不见，2024年即将到来，小编在这里提前祝大家新的一年快快乐乐，能够事业有成，学习顺心，家庭和睦，事事顺利。
今天我们本篇要实现的是一个登录界面的实现，其实登录界面的实现看着挺好实现的，其实里面需要注意到的点还是很多的，因此我可能会需要多篇博客进行一个讲解，接下来我们开始本次的登录界面的实现。
大家可以从上面的登录界面可以发现，我们本次需要完成的是用户在输入账号和密码后，然后再输入一个验证码后点击登录就能进入到我们的界面中，在这里我们用户输入的账号和密码是与我们上一篇博客是挂钩的，如果有不明白的朋友可以去看一下。
Python实现员工管理系统（Django页面版 ) 六-CSDN博客
其次我们对于不同的等级的用户进去是需要展示不同的页面的，就比如员工他就只能看看他的同事是哪些，还有他的任务是什么，他也不能进行添加，删除，修改操作，其实这个板块是属于用户权限的划分，我们在本章博客先不做这个，我们把这个伏笔埋一下。 好好好，也不多说这么多啦，咱先把基础的模板搞定，到哪步咱再说哪步。
在之前我们都是使用model.ModelFrom来对数据库中的数据进行一个修饰，一般来讲我们在对数据进行操作的时候我们用这个是比较方便的，那对于我们并不需要对数据库的数据进行操作的时候我们有没有更简单的方式来解决呢，下面我们来介绍一下model.Form。
model.form是Django中的一个模块，用于创建和处理表单。它是一个基于Model的表单，可以很方便地与数据库模型进行交互。
下面我们在我们的views文件夹下，新建一个login.py
我们可以从最上面的展示效果来看，我们需要三个字段，分别是用户名，密码和验证码，因此我们需要新建一个Form类来创建这三个字段。
login.py
from django import forms from project_manage.utils.encryption import md5 class LoginForm(forms.Form): username = forms.CharField(label=&#39;用户&#39;,widget=forms.TextInput(attrs={&#39;class&#39;:&#39;from-control&#39;,&#39;autocomplete&#39;:&#39;off&#39;})) password = forms.CharField(label=&#39;用户&#39;,widget=forms.PasswordInput(attrs={&#39;class&#39;:&#39;from-control&#39;,&#39;autocomplete&#39;:&#39;off&#39;})) code = forms.CharField(label=&#39;验证码&#39;,widget=forms.TextInput(attrs={&#39;class&#39;:&#39;from-control&#39;,&#39;autocomplete&#39;:&#39;off&#39;})) def clean_password(self): pwd = self.cleaned_data.get(&#39;password&#39;) return md5(pwd) 其中的md5是我们在上一篇博客中对密码的一个加密函数，不了解的朋友可以去看一下。我们会发现其实Form和ModelForm的使用方式是差不多的，只是Form我们用的更加简单。那个钩子方法会将我们输入的密码进行一个md5加密并返回给数据库。
下面我们来编写我们的模块函数，由于这次的登录界面对比之前的那些模板方法可能比较难理解，我就分开写方便大家理解。
首先我们在访问登录界面是一个get请求访问，那他就会给我们返回一个登录界面的展示
login.py
def login(request): if request.method == &#39;GET&#39;: form = LoginForm() return render(request,&#39;login.html&#39;,{&#39;form&#39;:form}) 在模板文件中创建一个login.html文件
login,html
{% load static %} &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;title&gt;登录页&lt;/title&gt; &lt;link rel=&#34;stylesheet&#34; href=&#34;{% static &#39;bootstrap-3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9ef50acc03ed30de2a3f45b4fb7b6b46/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-30T11:45:35+08:00" />
<meta property="article:modified_time" content="2023-12-30T11:45:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python实现员工管理系统（Django页面版 ) 七</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>        各位小伙伴们好久不见，2024年即将到来，小编在这里提前祝大家新的一年快快乐乐，能够事业有成，学习顺心，家庭和睦，事事顺利。</p> 
<p>        今天我们本篇要实现的是一个登录界面的实现，其实登录界面的实现看着挺好实现的，其实里面需要注意到的点还是很多的，因此我可能会需要多篇博客进行一个讲解，接下来我们开始本次的登录界面的实现。</p> 
<p><img alt="" height="351" src="https://images2.imgbox.com/b0/82/vxIDXk3E_o.png" width="1200"></p> 
<p>         大家可以从上面的登录界面可以发现，我们本次需要完成的是用户在输入账号和密码后，然后再输入一个验证码后点击登录就能进入到我们的界面中，在这里我们用户输入的账号和密码是与我们上一篇博客是挂钩的，如果有不明白的朋友可以去看一下。</p> 
<p><a href="https://blog.csdn.net/m0_71494659/article/details/135041871" title="Python实现员工管理系统（Django页面版 ) 六-CSDN博客">Python实现员工管理系统（Django页面版 ) 六-CSDN博客</a></p> 
<p>        其次我们对于不同的等级的用户进去是需要展示不同的页面的，就比如员工他就只能看看他的同事是哪些，还有他的任务是什么，他也不能进行添加，删除，修改操作，其实这个板块是属于用户权限的划分，我们在本章博客先不做这个，我们把这个伏笔埋一下。        </p> 
<p>        好好好，也不多说这么多啦，咱先把基础的模板搞定，到哪步咱再说哪步。</p> 
<p>        在之前我们都是使用<strong>model.ModelFrom</strong>来对数据库中的数据进行一个修饰，一般来讲我们在对数据进行操作的时候我们用这个是比较方便的，那对于我们并不需要对数据库的数据进行操作的时候我们有没有更简单的方式来解决呢，下面我们来介绍一下<strong>model.Form。</strong></p> 
<blockquote> 
 <p><strong>model.form</strong>是Django中的一个模块，用于创建和处理表单。它是一个基于Model的表单，可以很方便地与数据库模型进行交互。</p> 
</blockquote> 
<p>        下面我们在我们的views文件夹下，新建一个login.py</p> 
<p><img alt="" height="202" src="https://images2.imgbox.com/cc/5d/8LPuvC19_o.png" width="270"></p> 
<p>        我们可以从最上面的展示效果来看，我们需要三个字段，分别是用户名，密码和验证码，因此我们需要新建一个Form类来创建这三个字段。</p> 
<p>login.py</p> 
<pre><code class="language-python">from django import forms
from project_manage.utils.encryption import md5

class LoginForm(forms.Form):
    username = forms.CharField(label='用户',widget=forms.TextInput(attrs={'class':'from-control','autocomplete':'off'}))
    password = forms.CharField(label='用户',widget=forms.PasswordInput(attrs={'class':'from-control','autocomplete':'off'}))
    code = forms.CharField(label='验证码',widget=forms.TextInput(attrs={'class':'from-control','autocomplete':'off'}))

    def clean_password(self):
        pwd = self.cleaned_data.get('password')
        return md5(pwd)</code></pre> 
<p>          其中的md5是我们在上一篇博客中对密码的一个加密函数，不了解的朋友可以去看一下。我们会发现其实Form和ModelForm的使用方式是差不多的，只是Form我们用的更加简单。那个钩子方法会将我们输入的密码进行一个md5加密并返回给数据库。</p> 
<p>        下面我们来编写我们的模块函数，由于这次的登录界面对比之前的那些模板方法可能比较难理解，我就分开写方便大家理解。</p> 
<p>首先我们在访问登录界面是一个get请求访问，那他就会给我们返回一个登录界面的展示</p> 
<p>login.py</p> 
<pre><code class="language-python">def login(request):
    if request.method == 'GET':
        form = LoginForm()
        return render(request,'login.html',{'form':form})</code></pre> 
<p>在模板文件中创建一个login.html文件</p> 
<p>login,html</p> 
<pre><code class="language-html">{% load static %}
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;登录页&lt;/title&gt;
    &lt;link rel="stylesheet" href="{% static 'bootstrap-3.4.1-dist/css/bootstrap.min.css' %}"&gt;
    &lt;style&gt;
        .account {
            width: 450px;
            border: 2px solid #2196f300;
            background-color: #fff8d240;
            margin-left: auto;
            margin-right: auto;
            border-radius: 5%;
            padding: 20px;
            margin-top: 50px;
            box-shadow: 7px 11px 5px #9e9e9e;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body"&gt;
&lt;div class="account"&gt;
    &lt;form method="post" novalidate&gt;
        {% csrf_token %}
        &lt;div class="form-group"&gt;
            &lt;label&gt;账号&lt;/label&gt;
            {<!-- -->{ form.username }}
            &lt;span style="color: red"&gt;{<!-- -->{ form.username.errors.0 }}&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class="form-group"&gt;
            &lt;label&gt;密码&lt;/label&gt;
            {<!-- -->{ form.password }}
            &lt;span style="color: red"&gt;{<!-- -->{ form.password.errors.0 }}&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class="form-group"&gt;
            &lt;div class="row"&gt;
                &lt;div class="col-xs-7"&gt;
                    &lt;label&gt;验证码&lt;/label&gt;
                    {<!-- -->{ form.code }}
                    &lt;span style="color: red"&gt;{<!-- -->{ form.code.errors.0 }}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="col-xs-5"&gt;
                    &lt;button style="border: none"&gt;
                        &lt;img src="/image/code/"&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;

        &lt;/div&gt;

        &lt;button type="submit" class="btn btn-success"&gt;登录&lt;/button&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p>          下面我们先对验证码进行一个处理，验证码其实就是往我们的页面插入一张图片，然后让用户进行输入图片中的信息即可，如果输入错误提示验证码错误。</p> 
<p>在utils文件夹下创建一个code.py用于存放验证码</p> 
<p><img alt="" height="249" src="https://images2.imgbox.com/27/b0/X7USw7wK_o.png" width="275"></p> 
<p>code.py</p> 
<pre><code class="language-python"># -*- coding:utf-8 -*-
from PIL import Image,ImageDraw,ImageFont
from random import randint,choice

def create_captcha_content():
    # 创建一张图片，模式为RGB模式  全白
    img = Image.new(mode='RGB',size=(110,40),color=(255,255,255))
    # 创建一个画笔
    draw = ImageDraw.Draw(img,mode='RGB')
    # 设置字体
    font = ImageFont.truetype(r'C:\Windows\Fonts\simhei.ttf',size=30)
    # 选择图片内容
    text = 'ABCDEFG123456789'
    captcha_text = ''
    for i in range(4):
        captcha_text += choice(text)
    x = 15
    for i in captcha_text:
        R = randint(0,255)
        G = randint(0,255)
        B = randint(0,255)

        draw.text((x, 3),
                  text=i,
                  font=font,
                  fill=f"rgb({R},{G},{B})"
                  )
        # 调整下一个字的间隔
        x += 20

    # 在图像中展示线段作为干扰用户输入数据的方式
    for i in range(1, randint(3,6)):
        x1, y1 = randint(0,100),randint(0,30)
        x2, y2 = randint(0,100),randint(0,30)
        R = str(randint(0,255))
        G = str(randint(0,255))
        B = str(randint(0,255))
        draw.line((x1,y1,x2,y2),fill=f'rgb({R},{G},{B})',width=2)

    # 在图像中展示散点作为干扰用户输入数据的方式
    for i in range(1,randint(100,150)):
        x1,y1 = randint(0,100),randint(0,30)
        R = str(randint(0,255))
        G = str(randint(0,255))
        B = str(randint(0,255))
        draw.point((x1,y1),fill=f'rgb({R},{G},{B})')

    # 返回图像和验证码
    return [img,captcha_text]

</code></pre> 
<p>        在这里就不对里面的代码进行解释了，不过需要注意的是对于字体的选择我是使用电脑自带的字体，下面我开介绍一下如何使用电脑自带的字体。</p> 
<p>进入C盘 ----》 打开Windows文件   找到Fonts文件夹</p> 
<p><img alt="" height="439" src="https://images2.imgbox.com/a2/27/zxS0htbT_o.png" width="598"></p> 
<p>然后进去后随便找一个觉得合适的字体，然后右击选择属性，找到文件的路径即可</p> 
<p><img alt="" height="460" src="https://images2.imgbox.com/7c/5e/gv4fJTNT_o.png" width="857"> </p> 
<p>好的，现在回到我们的模块函数</p> 
<p>        我们需要将把验证码通过图像的形式插入到我们的界面中去，因此我们需要封装我们的验证码模块函数，我们在进行页面刷新的时候验证码也能跟着刷新</p> 
<p>login.py</p> 
<pre><code class="language-python">from io import BytesIO
def image_code(request):
    image,text = create_captcha_content()
    # 将验证码的值放入到session中
    request.session['image_code'] = text
    # 60s的时效性
    request.session.set_expiry(60)
    stream = BytesIO()
    image.save(stream,'png')
    return HttpResponse(stream.getvalue())</code></pre> 
<p>        其中的session是我们用户和服务器之间的一个会话，我们可以将用户的一些信息放入到这个session中，方便我们服务器进行后续的判断查找。然后我们会在里面设置一个时效性，类似与cookie，在这段时间后服务器就会将该用户信息删除，如果服务器检查到存在该用户的信息的话，那么用户下次进入时就不用进行登录。</p> 
<p>配置验证码路由  </p> 
<p>urls.py</p> 
<pre><code class="language-python">    # 验证码
    path('image/code/',login.image_code),</code></pre> 
<p></p> 
<p>        我们在进行用户登录的时候，首先是需要验证我们输入的验证码是否与图像展示的验证码一样，然后再到数据库中校验是否存在这个用户，存在即返回界面，不存在就给出错误信息。</p> 
<p>login.py</p> 
<pre><code class="language-python">def login(request):
    if request.method == 'GET':
        form = LoginForm()
        return render(request,'login.html',{'form':form})

    form = LoginForm(data=request.POST)
    if form.is_valid():
        # 验证码验证
        user_input_code = form.cleaned_data.pop('code')
        # 没有值设置为空
        code = request.session.get('image_code','')
        # 对于验证码不区分大小写
        if user_input_code.upper() != code.upper():
            form.add_error('code','验证码错误')
            return render(request,'login.html',{'form':form})

        # 账号密码验证，数据库校验
        admin_object = models.Admin.objects.filter(**form.cleaned_data).first()
        if not admin_object:
            # print(form.cleaned_data)
            form.add_error('password','用户名或者密码错误')
            return render(request,'login.html',{'form':form})
        # 生成字符串存储到cookie和session当中去
        info = {
            'id':admin_object.id,
            'name':admin_object.username,
            'role':admin_object.role
        }
        request.session['info'] = info

        # 时效性           ------ 一个点
        request.session.set_expiry(60 * 60 * 24)

        # request.session.set_expiry(10)

        return redirect('/')
    return render(request,'login.html',{'form':form})</code></pre> 
<p>  用户退出模块函数</p> 
<pre><code class="language-python">def logout(request):
    request.session.clear()
    return redirect('/login/')</code></pre> 
<p>        其实用户退出很简单，只需要把用户当前的session清空即可，然后返回到登录界面</p> 
<p>配置路由</p> 
<p>urls</p> 
<pre><code class="language-python">    # 登录页面
    path('login/',login.login),

    # 退出登录
    path('logout/',login.logout),</code></pre> 
<p>        其实做到这里差不多登录界面就完成了，但是里面还没有做到用户权限的划分，我们在后面的博客进行讲解吧。最后，还是祝大家新的一年快乐！！！</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2de8ed24ef685ab6b46c8a7a940d5d92/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">html如何设置标签图标2023/12/30</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/06365657b9e9746ee82a042e1d6129ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分享Python采集40个NET整站程序源码，总有一款适合您</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>