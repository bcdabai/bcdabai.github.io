<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>è‡ªåŠ¨ç”Ÿæˆå›ºå®šè§„åˆ™çš„è®¢å•å·ï¼ˆå‰ç¼€&#43;é‡‡è´­æ—¥æœŸ&#43;6ä½æµæ°´å·ï¼‰ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="è‡ªåŠ¨ç”Ÿæˆå›ºå®šè§„åˆ™çš„è®¢å•å·ï¼ˆå‰ç¼€&#43;é‡‡è´­æ—¥æœŸ&#43;6ä½æµæ°´å·ï¼‰" />
<meta property="og:description" content="ä»»åŠ¡ï¼šè¿›è´§ä¿¡æ¯å¢åŠ ä¸€ä¸ªå±æ€§ï¼Œé‡‡è´­å•æ®å·ï¼Œè¦æ±‚æŒ‰é‡‡è´­æ—¥æœŸ&#43;6ä½æµæ°´å·ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å•æ®å·ï¼Œæ ¼å¼ï¼šCGD-yyyyMMdd-XXXXXXã€‚
ä»¥ä¸‹å†…å®¹ï¼Œä»…ä¸ºä¸Šè¿°éœ€æ±‚è¿›è¡Œçš„æ“ä½œï¼Œä½ ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œç”Ÿæˆè®¢å•è§„åˆ™çš„ä¿®æ”¹ã€‚
æ•°æ®åº“æ“ä½œ
é¦–å…ˆå½“ç„¶æ˜¯åœ¨è‡ªå·±çš„æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºè¦æ±‚æˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆå›ºå®šè§„åˆ™è®¢å•å·ï¼Œä¸”æ·»åŠ åœ¨åŸæœ‰æ•°æ®ä¸­ã€‚æ‰€ä»¥éœ€è¦è‡ªå·±çš„åŸæœ‰è¡¨ä¸­æ·»åŠ ä¸€ä¸ªã€è®¢å•å·ã€‘çš„å­—æ®µã€‚
è€ƒè™‘åˆ°è¯¥å­—æ®µå†…å®¹å½¢æˆï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªè¡¨purchase_serialnumï¼Œä¸“é—¨ç”¨æ¥ç”Ÿæˆå’Œå­˜å‚¨å›ºå®šè§„åˆ™çš„è®¢å•å·ã€‚ï¼ˆè®°å¾—å†™ä¸€ä¸ªæµ‹è¯•å­—æ®µï¼Œå¦‚ä¸‹å›¾çš„ç¬¬ä¸€ä¸ªå†…å®¹ï¼‰
å­—æ®µå†…å®¹æ ¹æ®è‡ªå·±çš„éœ€è¦åˆ›å»ºï¼ˆè¶Šç®€å•è¶Šå¥½ï¼‰ï¼Œä½†æ˜¯å¦‚ä¸Šå›¾çš„å‰ä¸‰ä¸ªå­—æ®µå¿…é¡»è¦æœ‰ï¼Œæ–¹ä¾¿æ¥ä¸‹æ¥ä½¿ç”¨ã€‚
ä¸¤ä¸ªè¡¨ä¸­æˆ‘å®šä¹‰çš„æ˜¯ä¸»é”®idè‡ªå¢ï¼Œæ–¹ä¾¿æ–°å¢è®¢å•æ—¶ç”Ÿæˆè®¢å•å·çš„ä½ç½®æ˜¯ç›¸åŒçš„ã€‚
å¦‚æœä½ åœ¨æµ‹è¯•çš„æ—¶å€™ä¸¤ä¸ªä¸åŒè¡¨ä¸­äº§ç”Ÿäº†ä¸»é”®idè‡ªå¢çš„åºå·ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡SQLè¯­å¥æ¥æ”¹å˜ã€‚ï¼ˆå¦‚NAvicatä¸­è¿è¡Œä¸€ä¸‹ï¼‰
ALTER TABLE tableName AUTO_INCREMENT 3; â€œtableNameâ€æŒ‡çš„æ˜¯è¡¨åï¼Œâ€œ3â€æŒ‡çš„æ˜¯ä½ éœ€è¦æ”¹å˜è‡ªå¢idæˆå“ªä¸ªæ•°å­—å¼€å§‹ ç„¶åæ–°çš„è¡¨å½“ç„¶å°±è¦åˆ›å»ºå¯¹åº”çš„å®ä½“ç±»ã€xmlæ–‡ä»¶ï¼Œdaoå±‚ï¼Œserviceå±‚ç­‰ç­‰ï¼Œä»¥ä¸‹å†…å®¹ä»…å±•ç¤ºéƒ¨åˆ†ã€‚
PurchaseSerialnum
@Data // getter/setterç”¨@Dataæ›¿ä»£ï¼Œä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„æœç´¢lombokæŸ¥æ‰¾ä¾èµ–å’Œç”¨æ³• public class PurchaseSerialnum implements Serializable { private Integer serialnumberid; private String serialnumber; private Integer serialcount; private Date cereattime; private String prefix; private static final long serialVersionUID = 1L; } PurchaseSerialnumMapper.xml
&lt;select id=&#34;selectMax&#34; resultMap=&#34;BaseResultMap&#34;&gt; SELECT * FROM purchase_serialnum WHERE serialNumberId = ( SELECT Max( serialNumberId ) FROM purchase_serialnum) &lt;/select&gt; PurchaseSerialnumMapper
PurchaseSerialnum selectMax(); PurchaseSerialnumService" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/933e05d2720a66d1da292251382ae35c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-25T16:59:57+08:00" />
<meta property="article:modified_time" content="2022-04-25T16:59:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">è‡ªåŠ¨ç”Ÿæˆå›ºå®šè§„åˆ™çš„è®¢å•å·ï¼ˆå‰ç¼€&#43;é‡‡è´­æ—¥æœŸ&#43;6ä½æµæ°´å·ï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>ä»»åŠ¡ï¼šè¿›è´§ä¿¡æ¯å¢åŠ ä¸€ä¸ªå±æ€§ï¼Œé‡‡è´­å•æ®å·ï¼Œè¦æ±‚æŒ‰é‡‡è´­æ—¥æœŸ+6ä½æµæ°´å·ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å•æ®å·ï¼Œæ ¼å¼ï¼šCGD-yyyyMMdd-XXXXXXã€‚</p> 
</blockquote> 
<p>ä»¥ä¸‹å†…å®¹ï¼Œä»…ä¸ºä¸Šè¿°éœ€æ±‚è¿›è¡Œçš„æ“ä½œï¼Œä½ ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œç”Ÿæˆè®¢å•è§„åˆ™çš„ä¿®æ”¹ã€‚</p> 
<blockquote> 
 <p>æ•°æ®åº“æ“ä½œ</p> 
</blockquote> 
<p>é¦–å…ˆå½“ç„¶æ˜¯åœ¨è‡ªå·±çš„æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºè¦æ±‚æˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆå›ºå®šè§„åˆ™è®¢å•å·ï¼Œä¸”æ·»åŠ åœ¨åŸæœ‰æ•°æ®ä¸­ã€‚æ‰€ä»¥éœ€è¦è‡ªå·±çš„åŸæœ‰è¡¨ä¸­æ·»åŠ ä¸€ä¸ªã€è®¢å•å·ã€‘çš„å­—æ®µã€‚</p> 
<p><img alt="" height="250" src="https://images2.imgbox.com/cc/01/K9yscPKH_o.png" width="870"></p> 
<p>è€ƒè™‘åˆ°è¯¥å­—æ®µå†…å®¹å½¢æˆï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªè¡¨purchase_serialnumï¼Œä¸“é—¨ç”¨æ¥ç”Ÿæˆå’Œå­˜å‚¨å›ºå®šè§„åˆ™çš„è®¢å•å·ã€‚ï¼ˆè®°å¾—å†™ä¸€ä¸ªæµ‹è¯•å­—æ®µï¼Œå¦‚ä¸‹å›¾çš„ç¬¬ä¸€ä¸ªå†…å®¹ï¼‰</p> 
<p><img alt="" height="252" src="https://images2.imgbox.com/44/10/9Sk53xTM_o.png" width="448"></p> 
<p>å­—æ®µå†…å®¹æ ¹æ®è‡ªå·±çš„éœ€è¦åˆ›å»ºï¼ˆè¶Šç®€å•è¶Šå¥½ï¼‰ï¼Œä½†æ˜¯<span style="color:#fe2c24;"><strong>å¦‚ä¸Šå›¾çš„å‰ä¸‰ä¸ªå­—æ®µå¿…é¡»è¦æœ‰</strong></span>ï¼Œæ–¹ä¾¿æ¥ä¸‹æ¥ä½¿ç”¨ã€‚</p> 
<p>ä¸¤ä¸ªè¡¨ä¸­æˆ‘å®šä¹‰çš„æ˜¯<strong><span style="color:#a2e043;">ä¸»é”®idè‡ªå¢</span></strong>ï¼Œæ–¹ä¾¿æ–°å¢è®¢å•æ—¶ç”Ÿæˆè®¢å•å·çš„ä½ç½®æ˜¯ç›¸åŒçš„ã€‚</p> 
<p>å¦‚æœä½ åœ¨æµ‹è¯•çš„æ—¶å€™ä¸¤ä¸ªä¸åŒè¡¨ä¸­äº§ç”Ÿäº†ä¸»é”®idè‡ªå¢çš„åºå·ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡SQLè¯­å¥æ¥æ”¹å˜ã€‚ï¼ˆå¦‚NAvicatä¸­è¿è¡Œä¸€ä¸‹ï¼‰</p> 
<pre><code class="language-sql">ALTER TABLE tableName AUTO_INCREMENT 3;

â€œtableNameâ€æŒ‡çš„æ˜¯è¡¨åï¼Œâ€œ3â€æŒ‡çš„æ˜¯ä½ éœ€è¦æ”¹å˜è‡ªå¢idæˆå“ªä¸ªæ•°å­—å¼€å§‹</code></pre> 
<p>ç„¶åæ–°çš„è¡¨å½“ç„¶å°±è¦åˆ›å»ºå¯¹åº”çš„å®ä½“ç±»ã€xmlæ–‡ä»¶ï¼Œdaoå±‚ï¼Œserviceå±‚ç­‰ç­‰ï¼Œä»¥ä¸‹å†…å®¹ä»…å±•ç¤ºéƒ¨åˆ†ã€‚</p> 
<blockquote> 
 <p>PurchaseSerialnum</p> 
</blockquote> 
<pre><code class="language-java">@Data
//    getter/setterç”¨@Dataæ›¿ä»£ï¼Œä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„æœç´¢lombokæŸ¥æ‰¾ä¾èµ–å’Œç”¨æ³•
public class PurchaseSerialnum implements Serializable {
    private Integer serialnumberid;

    private String serialnumber;

    private Integer serialcount;

    private Date cereattime;

    private String prefix;

    private static final long serialVersionUID = 1L;
}</code></pre> 
<blockquote> 
 <p>PurchaseSerialnumMapper.xml</p> 
</blockquote> 
<pre><code class="language-XML">  &lt;select id="selectMax" resultMap="BaseResultMap"&gt;
    SELECT
      *
    FROM
      purchase_serialnum
    WHERE
        serialNumberId = (
        SELECT
          Max( serialNumberId )
        FROM
          purchase_serialnum)
  &lt;/select&gt;</code></pre> 
<blockquote> 
 <p>PurchaseSerialnumMapper</p> 
</blockquote> 
<pre><code class="language-java">PurchaseSerialnum selectMax();</code></pre> 
<blockquote> 
 <p>PurchaseSerialnumService</p> 
</blockquote> 
<pre><code class="language-java">    PurchaseSerialnum selectMax();</code></pre> 
<blockquote> 
 <p>PurchaseSerialnumService</p> 
</blockquote> 
<pre><code class="language-java">    @Autowired
    private PurchaseSerialnumMapper purchaseSerialnumMapper;


    @Override
    public PurchaseSerialnum selectMax(){
        return purchaseSerialnumMapper.selectMax();
    }</code></pre> 
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿”å›åˆ°ä¹‹å‰Purchaseè¡¨çš„Controllerä¸­ï¼Œè¿›è¡Œå†…å®¹ä¿®æ”¹ã€‚</p> 
<pre><code class="language-java">@RequestMapping("/purchase")
public class PurchaseController {
    @Autowired
    private PurchaseService purchaseService;
    @Autowired
    private PurchaseSerialnumService purchaseSerialnumService;

    public PurchaseSerialnum getSerialnum(){
        //å®šä¹‰éœ€è¦è¿”å›çš„æµæ°´å·
        String serialnumber = null;
        int serialcount;
        //æŸ¥è¯¢å½“å‰æœ€å¤§idå€¼ï¼Œä»¥ä¾¿çŸ¥é“å½“å‰æ—¥æœŸæ˜¯å¦æœ‰åˆ›å»ºè®¢å•å·
        //1.é€šè¿‡tableNameè¡¨åæŸ¥è¯¢å”¯ä¸€å¯¹è±¡
        PurchaseSerialnum serialnum =  purchaseSerialnumService.selectMax();
        //2. è·å–å¯¹è±¡çš„å‰ç¼€
        String prefix = serialnum.getPrefix();
        //3. è·å–å¯¹è±¡çš„é»˜è®¤å•å·
        String serial = serialnum.getSerialnumber();
        //4. é€šè¿‡å½“å‰ç³»ç»Ÿæ—¶é—´å’Œé»˜è®¤å•å·æ—¶é—´å¯¹æ¯”
        //4.1 è·å–å½“å‰æ—¶é—´ æ ¼å¼ï¼šyyyyMMdd
        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
        String nowDate = sdf.format(new Date());
        //4.2 è·å–å•å·æ—¶é—´ï¼ˆ4ï¼Œ12ï¼‰è¡¨ç¤ºä»ç¬¬4ä¸ªå¼€å§‹åˆ°ç¬¬11ä½ï¼Œä¹Ÿå°±æ˜¯è·å–æ—¥æœŸï¼Œæ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹ä½ç½®
        String oldDate = serial.substring(4, 12);
        //4.3 æ—¥æœŸç›¸ç­‰ï¼Œè¯´æ˜ä»Šå¤©å·²ç»ç”Ÿæˆè®¢å•å·
        if(nowDate.equals(oldDate)){
            //æ‹¿åˆ°è‡ªå¢idï¼Œæ‹¼æ¥ç”Ÿæˆå•å·
            serialcount = serialnum.getSerialcount();
            serialcount=serialcount+1;
            //è¿”å›ç»“æœï¼Œå‰ç¼€+æ—¶é—´æ—¥æœŸ+6ä½æµæ°´
        }else{
            //4.4æ—¥æœŸä¸ç›¸ç­‰
            serialcount=1;
        }
        serialnumber=prefix+ "-" + new SimpleDateFormat("yyyyMMdd").format(new Date())+ "-" + String.format("%06d",serialcount);
        PurchaseSerialnum purchaseSerialnum = new PurchaseSerialnum();
        purchaseSerialnum.setPrefix(prefix);
        purchaseSerialnum.setSerialnumber(serialnumber);
        purchaseSerialnum.setSerialcount(serialcount);
        return purchaseSerialnum;
    }
    //æ–°å¢-get
    @GetMapping("/add")
    public String add(Model model) {
        Purchase entity = new Purchase();
        model.addAttribute("item",entity);
        return "/purchase/add";
    }

    //æ–°å¢-post
    @PostMapping("/add")
    @ResponseBody
    public String add(Purchase entity){
        try {
            //è¿™é‡Œæ˜¯ä¸ºäº†è·å–ä¸Šé¢getSerialnum()æ–¹æ³•çš„å†…å®¹
            PurchaseSerialnum purchaseSerialnum = getSerialnum();
            //å°†è‡ªåŠ¨ç”Ÿæˆçš„è®¢å•å·ä¼ åˆ°Purchaseè¡¨çš„serialNumåˆ—ä¸­
            entity.setSerial_id(purchaseSerialnum.getSerialnumber());
            //æ–°å¢è®¢å•è¡¨çš„ä¿¡æ¯
            purchaseSerialnumService.insert(purchaseSerialnum);
            //æ–°å¢è¿›è´§ä¿¡æ¯
            purchaseService.insert(entity);
            return "ok";
        }catch (Exception e) {
            return e.getMessage();
        }
    }</code></pre> 
<blockquote> 
 <p>è¿è¡Œç»“æœ</p> 
</blockquote> 
<p><img alt="" height="502" src="https://images2.imgbox.com/42/12/hm3nXr8d_o.png" width="1200"></p> 
<p>æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºæé—®ï¼Œä¼šä»¥æœ€å¿«çš„é€Ÿåº¦å›å¤å¤§å®¶ğŸ˜€ğŸ˜€ğŸ˜€</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbec9217b7f9496b71c8c99d4716e190/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å€ŸåŠ©vueè„šæ‰‹æ¶è§£å†³ajaxè¯·æ±‚è·¨åŸŸçš„é—®é¢˜ï¼ˆ2022-04-25å­¦ä¹ ç¬”è®°ï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4b8f2fafa77c74b11901663a632aeea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">TX-C&#43;&#43;-ç®—æ³•é¢˜</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>