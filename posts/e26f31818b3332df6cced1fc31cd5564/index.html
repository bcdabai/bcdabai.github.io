<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue使用原生canvas绘制海报 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue使用原生canvas绘制海报" />
<meta property="og:description" content="前段时间，公司项目要求绘制商品的分享海报，当时尝试使用了html2canvas，但是后来发现，它只有在Safari浏览器上面效果比较理想，但是在Android手机上面，各种移位，总之就是不能生成完整的图。虽然后面有尝试过在绘制过程中加一个延时，但是效果还是不太好，最后还是决定使用原生canvas来制作了。过程虽然麻烦些，但是最终的效果还是不错的。
先上一张效果图
下面是我整理的绘制过程
前期准备 &lt;div class=&#34;hidden&#34; style=&#34;display: none;&#34;&gt; &lt;canvas id=&#34;mycanvas&#34; :width=&#34;w&#34; :height=&#34;h&#34; /&gt; &lt;img class=&#34;goodsImg&#34; src=&#34;&#34; alt=&#34;&#34; crossOrigin=&#34;*&#34;&gt; &lt;/div&gt; &lt;img class=&#34;postImg&#34; src alt&gt; 这里，canvas模块，我是用display: none 将其隐藏，因为只需要获取到canvas生成的base64格式的图片就可以了，而原始的canvas内容不展示也不影响。
之所以这样处理，canvas的宽度高度，要比生成的图片的宽高大一些，这样生成的图片会清晰很多。
data() { return { w: 650, h: 1200 } } .postImg { width: 570px; } 注意：canvas的宽高最好用 width 和 height 属性，以免变形。
写好布局，接下来还有比较重要的一步：
对于绘制图片的处理
这里分为两种情况： 一种是本地图片绘制，一种是网络图片绘制；
其实两种绘制差别上不是很大，只是网络图片需要解决图片跨域的问题。
解决方法也是有的，需要在 oss 上面去配置一下允许跨域。这个需要找公司负责这方面人员去帮你配置，当然如果你自己也可以配置的话，那也再好不过了，具体的配置方法网上有很多，可以自己去搜。
这里我用的是网络图片，所以 src 的属性是空的，后面会在获取到数据后填充上的。
如果是绘制本地图片，需要把上面的 html 代码稍作修改
&lt;div class=&#34;hidden&#34; style=&#34;display: none;&#34;&gt; &lt;canvas id=&#34;mycanvas&#34; :width=&#34;w&#34; :height=&#34;h&#34; /&gt; &lt;img src=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e26f31818b3332df6cced1fc31cd5564/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-26T18:06:59+08:00" />
<meta property="article:modified_time" content="2020-05-26T18:06:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue使用原生canvas绘制海报</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前段时间，公司项目要求绘制商品的分享海报，当时尝试使用了html2canvas，但是后来发现，它只有在Safari浏览器上面效果比较理想，但是在Android手机上面，各种移位，总之就是不能生成完整的图。虽然后面有尝试过在绘制过程中加一个延时，但是效果还是不太好，最后还是决定使用原生canvas来制作了。过程虽然麻烦些，但是最终的效果还是不错的。</p> 
<p>先上一张效果图<br> <img src="https://images2.imgbox.com/c5/89/ONDuwror_o.png" alt="在这里插入图片描述"></p> 
<p>下面是我整理的绘制过程</p> 
<h3><a id="_8"></a>前期准备</h3> 
<pre><code class="prism language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mycanvas<span class="token punctuation">"</span></span> <span class="token attr-name">:width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>w<span class="token punctuation">"</span></span> <span class="token attr-name">:height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goodsImg<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">crossOrigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postImg<span class="token punctuation">"</span></span> <span class="token attr-name">src</span> <span class="token attr-name">alt</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这里，canvas模块，我是用display: none 将其隐藏，因为只需要获取到canvas生成的base64格式的图片就可以了，而原始的canvas内容不展示也不影响。<br> 之所以这样处理，canvas的宽度高度，要比生成的图片的宽高大一些，这样生成的图片会清晰很多。</p> 
<pre><code class="prism language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
		w<span class="token punctuation">:</span> <span class="token number">650</span><span class="token punctuation">,</span>
		h<span class="token punctuation">:</span> <span class="token number">1200</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-css"><span class="token selector">.postImg</span> <span class="token punctuation">{<!-- --></span>
	<span class="token property">width</span><span class="token punctuation">:</span> 570px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>注意：canvas的宽高最好用 width 和 height 属性，以免变形。<br> 写好布局，接下来还有比较重要的一步：</p> 
<p><strong>对于绘制图片的处理</strong><br> 这里分为两种情况： 一种是<strong>本地图片</strong>绘制，一种是<strong>网络图片</strong>绘制；</p> 
<p>其实两种绘制差别上不是很大，只是网络图片需要解决图片跨域的问题。<br> 解决方法也是有的，需要在 oss 上面去配置一下允许跨域。这个需要找公司负责这方面人员去帮你配置，当然如果你自己也可以配置的话，那也再好不过了，具体的配置方法网上有很多，可以自己去搜。</p> 
<p>这里我用的是网络图片，所以 src 的属性是空的，后面会在获取到数据后填充上的。</p> 
<p>如果是绘制本地图片，需要把上面的 html 代码稍作修改</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mycanvas<span class="token punctuation">"</span></span> <span class="token attr-name">:width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>w<span class="token punctuation">"</span></span> <span class="token attr-name">:height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>本地图片地址<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postImg<span class="token punctuation">"</span></span> <span class="token attr-name">src</span> <span class="token attr-name">alt</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>vue中如果要把本地图片绘制出来，一定要直接把 img标签 写在 html里。 通过 let img = new Image()，img.src = 本地图片路径，这种方式，没有办法将图片绘制出来；这样做的结果就是，不管你用了什么办法，图片就是出不来。。。。<br> 现在准备工作基本上就完了，接下来就是比较重要的绘制过程了。</p> 
<h3><a id="_57"></a>绘制</h3> 
<pre><code class="prism language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
		w<span class="token punctuation">:</span> <span class="token number">650</span><span class="token punctuation">,</span>
		h<span class="token punctuation">:</span> <span class="token number">1200</span><span class="token punctuation">,</span>
		info<span class="token punctuation">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 这里可以添加一个loading</span>
		
		<span class="token keyword">let</span> qrImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 创建二维码图片对象</span>
		qrImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>url  <span class="token comment">// 二维码 base64 链接码</span>

		<span class="token keyword">let</span> goodsImg <span class="token operator">=</span> <span class="token string">''</span>
		goodsImg <span class="token operator">=</span>  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.goodsImg'</span><span class="token punctuation">)</span>
		goodsImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>goodsImg  <span class="token comment">// 网络图片地址</span>

		<span class="token comment">// 开始绘制</span>
		goodsImg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mycanvas'</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                 antialias<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token comment">// 是画质更清晰  其他配置可以参考文档</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
			
			<span class="token comment">// 填充背景色</span>
			ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ffffff'</span>
			ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span>
			
			<span class="token comment">// 绘制价格</span>
			ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#E85700'</span>  <span class="token comment">// 设置字体颜色</span>
            ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'24px PingFang SC'</span>  <span class="token comment">// 字体、字体大小</span>
            ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'￥'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">)</span>  <span class="token comment">// 文字内容和位置  相当于绝对定位left 和top值  定位参照位置是canvas区域左上角</span>
            ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'36px PingFang SC'</span>
            ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>sharePrice1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>sharePrice2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">)</span>  <span class="token comment">// 价格涉及到小数点，所以对价格做了处理，拼在一起是一个完整的价格</span>
            ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(153,153,153,1)'</span>   <span class="token comment">// 切换颜色 绘制原价</span>
            ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'24px PingFangSC-Regular,PingFang SC'</span>
            ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`原价：￥</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>afterPrice1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>afterPrice2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">)</span>
			
			<span class="token comment">// 绘制标题</span>
			ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 0, 1)'</span>
			ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'36px PingFangSC-Regular,PingFang SC'</span>
			<span class="token comment">/*  标题分了两行绘制，因为标题长度是随机的，只绘制一行，
				效果不好；
				所以这里写了一个方法，可以截取固定字节的字符串
				标题长度超过28字节，截取前28字节的字符串，在第
				一行绘制；
				然后拿到剩余的字符串second，截取固定26字节字符串
				strSecond，对比两者的的长度是否一致，或者两者的
				内容是否完全一样。如果一样，second== strSecond,
				可以直接绘制 second； 如果 second &gt; strSecond,
				可以在 strSecond 后面 + '...' ，再绘制，达到溢出
				省略的效果。
			*/</span>
			<span class="token keyword">let</span> first <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">autoAddEllipsis</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span>
			ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">780</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> second <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
			<span class="token keyword">let</span> strSecond <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">autoAddEllipsis</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>second <span class="token operator">==</span> strSecond<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">830</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>strSecond <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">830</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 绘制提示语</span>
			ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(153,153,153,1)'</span>
			ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'24px PingFangSC-Regular,PingFang SC'</span>
			ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'长按或扫描查看'</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">,</span> <span class="token number">1110</span><span class="token punctuation">)</span>

			ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>qrImg<span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">872</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">)</span>  <span class="token comment">// 绘制二维码</span>
			ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>proImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">)</span> <span class="token comment">// 绘制商品图片</span>
			<span class="token keyword">let</span> Url <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mycanvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>  <span class="token comment">// 转base64</span>
			document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.postImg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> Url  <span class="token comment">// 展示图片</span>
			
			<span class="token comment">// 哈哈，这里又写了一遍，因为出现二维码没有绘制出来的情况</span>
			qrImg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
				ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>qrImg<span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">872</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">)</span>
				ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>proImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">,</span> <span class="token number">650</span><span class="token punctuation">)</span>
				<span class="token keyword">let</span> Url <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mycanvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
				document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.postImg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> Url
				
				<span class="token comment">// 绘制完成 清除loading   什么loading，我也不知道</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样这个海报就绘制完成了，剩余的就是怎么处理这个海报了。<br> 然后那个每次都截取固定字符串的方法，简单说一下，因为我也是从别人那里搜刮来的，不是自己的成果，不好意思放上来。就说一下大概思路：</p> 
<p><strong>autoAddEllipsis</strong> 方法 接收两个参数:<br> <strong>str</strong> 需要截取的字符串，<br> <strong>length</strong> 需要截取的字节长度</p> 
<p>然后它的核心是一句话： <strong>Unicode编码大于255说明占两个字节</strong>(至于如何将字符转为Unicode编码，可以自行查文档)<br> str的每个字符都需要转码计算它的字节数，所以需要对 str 进行遍历，判断每个字符的字节数 是一个还是两个，然后进行计数count，直到count 超过 length未知。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e403326aa7a4f3b39a1b5a3f8db982b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git/Shell：批量 git pull，一键更新同一目录下的多个仓库（快速拉取全部项目）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c4ec0f9f5a72368e9f16d953249a2344/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;知识点4——vector与string简述</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>