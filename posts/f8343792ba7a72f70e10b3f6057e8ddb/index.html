<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>response.addHeader(&#34;Content-Disposition&#34;, - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="response.addHeader(&#34;Content-Disposition&#34;," />
<meta property="og:description" content="1 使用Servlet实现文件下载的时候，避免浏览器自动打开文件 response.addHeader(“Content-Disposition”, “attachment; filename=” &#43; response.encodeURL(downloadfile)); 2解决Response.AddHeader(“Content-Disposition”, “attachment; filename=” &#43; file.Name) 中文显示乱码 如果file.Name为中文则乱码。解决办法是 方法1： response.setHeader(“Content-Disposition”, “attachment; filename=” &#43; java.net.URLEncoder.encode(fileName, “UTF-8”)); 下载的程序里有了上面一句，一般在IE6的下载提示框上将正确显示文件的名字，无论是简体中文，还是日文。但是文字只要超过17个字，就不能下载了。 一. 通过原来的方式，也就是先用URLEncoder编码，当中文文字超过17个时，IE6 无法下载文件。这是IE的bug，参见微软的知识库文章 KB816868 。原因可能是IE在处理 Response Header 的时候，对header的长度限制在150字节左右。而一个汉字编码成UTF-8是9个字节，那么17个字便是153个字节，所以会报错。而且不跟后缀也不对. 方法2： response.setHeader( “Content-Disposition”, “attachment;filename=” &#43; new String( fileName.getBytes(“gb2312”), “ISO8859-1” ) ); 在确保附件文件名都是简 体中文字的情况下，那么这个办法确实是最有效的，不用让客户逐个的升级IE。如果台湾同胞用，把gb2312改成big5就行。但现在的系统通常都加入了 国际化的支持，普遍使用UTF-8。如果文件名中又有简体中文字，又有繁体中文，还有日文。那么乱码便产生了。另外，在上Firefox (v1.0-en)下载也是乱码。
3Content-disposition中Attachment和inline的区别 ava web中下载文件时,我们一般设置Content-Disposition告诉浏览器下载文件的名称,是否在浏览器中内嵌显示. Content-disposition: inline; filename=foobar.pdf 表示浏览器内嵌显示一个文件
Content-disposition: attachment; filename=foobar.pdf 表示会下载文件,如火狐浏览器中 spring mvc中 Java代码 收藏代码 @ResponseBody @RequestMapping(value = “/download”,produces=”application/octet-stream”) public byte[] downloadFile(HttpServletRequest request, HttpServletResponse response,String contentType2) throws IOException { byte[]bytes=FileUtils." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f8343792ba7a72f70e10b3f6057e8ddb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-05T15:47:05+08:00" />
<meta property="article:modified_time" content="2017-06-05T15:47:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">response.addHeader(&#34;Content-Disposition&#34;,</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>1 使用Servlet实现文件下载的时候，避免浏览器自动打开文件</strong> <br> response.addHeader(“Content-Disposition”, “attachment; filename=” + response.encodeURL(downloadfile)); </p> 
<p><strong>2解决Response.AddHeader(“Content-Disposition”, “attachment; filename=” + file.Name) 中文显示乱码</strong> <br> 如果file.Name为中文则乱码。解决办法是 <br> 方法1： <br> response.setHeader(“Content-Disposition”, “attachment; filename=” + java.net.URLEncoder.encode(fileName, “UTF-8”)); <br> 下载的程序里有了上面一句，一般在IE6的下载提示框上将正确显示文件的名字，无论是简体中文，还是日文。但是文字只要超过17个字，就不能下载了。 <br> 一. 通过原来的方式，也就是先用URLEncoder编码，当中文文字超过17个时，IE6 无法下载文件。这是IE的bug，参见微软的知识库文章 KB816868 。原因可能是IE在处理 Response Header 的时候，对header的长度限制在150字节左右。而一个汉字编码成UTF-8是9个字节，那么17个字便是153个字节，所以会报错。而且不跟后缀也不对. <br> 方法2： <br> response.setHeader( “Content-Disposition”, “attachment;filename=” + new String( fileName.getBytes(“gb2312”), “ISO8859-1” ) ); <br> 在确保附件文件名都是简 体中文字的情况下，那么这个办法确实是最有效的，不用让客户逐个的升级IE。如果台湾同胞用，把gb2312改成big5就行。但现在的系统通常都加入了 国际化的支持，普遍使用UTF-8。如果文件名中又有简体中文字，又有繁体中文，还有日文。那么乱码便产生了。另外，在上Firefox (v1.0-en)下载也是乱码。</p> 
<p><strong>3Content-disposition中Attachment和inline的区别</strong> <br> ava web中下载文件时,我们一般设置Content-Disposition告诉浏览器下载文件的名称,是否在浏览器中内嵌显示. <br> Content-disposition: inline; filename=foobar.pdf <br> 表示浏览器内嵌显示一个文件</p> 
<p>Content-disposition: attachment; filename=foobar.pdf <br> 表示会下载文件,如火狐浏览器中 <br> <img src="https://images2.imgbox.com/93/76/Ge52bp5n_o.jpg" alt="这里写图片描述" title=""></p> 
<p>spring mvc中 <br> Java代码 收藏代码 <br> @ResponseBody <br> @RequestMapping(value = “/download”,produces=”application/octet-stream”) <br> public byte[] downloadFile(HttpServletRequest request, HttpServletResponse response,String contentType2) <br> throws IOException { <br> byte[]bytes=FileUtils.getBytes4File(“D:\Temp\cc.jpg”); <br> response.addHeader(“Content-Disposition”, “inline;filename=\”a.jpg\”“); <br> return bytes; <br> } <br> 如上代码中是内嵌显示图片呢?还是会弹框下载呢? <br> 答案是:弹框下载 <br> 为什么呢?设置为inline应该是内嵌显示啊! <br> 因为response content type设置成了”application/octet-stream” <br> 注意:我们说是内嵌显示还是下载,那一定是针对可内嵌显示的类型,例如”image/jpeg”,”image/png”等.</p> 
<p>看下面的例子:设置response content type为”image/jpeg” <br> Java代码 收藏代码 <br> @ResponseBody <br> @RequestMapping(value = “/download”,produces=”image/jpeg”) <br> public byte[] downloadFile(HttpServletRequest request, HttpServletResponse response,String contentType2,String downloadType) <br> throws IOException { <br> byte[]bytes=FileUtils.getBytes4File(“D:\Temp\cc.jpg”); <br> response.addHeader(“Content-Disposition”, downloadType+”;filename=\”a.jpg\”“); <br> return bytes; </p> 
<pre><code>}  
</code></pre> 
<p>在浏览器中访问:<a href="http://localhost:8080/tv_mobile/video/download?downloadType=inline" rel="nofollow">http://localhost:8080/tv_mobile/video/download?downloadType=inline</a> 时就内嵌显示: <br> <img src="https://images2.imgbox.com/e3/5a/EmbsJsF6_o.jpg" alt="这里写图片描述" title=""></p> 
<p>当在浏览器中访问:<a href="http://localhost:8080/tv_mobile/video/download?downloadType=attachment" rel="nofollow">http://localhost:8080/tv_mobile/video/download?downloadType=attachment</a> 时就弹框下载. <br> 参考:<a href="http://hw1287789687.iteye.com/blog/2188480" rel="nofollow">http://hw1287789687.iteye.com/blog/2188480</a></p> 
<p><strong>4 header中Content-Disposition的作用</strong> <br> 今天查看Struts2的文件上传部分 发现有个例子开头打印的信息中有Content-Disposition，一时好奇，所以了解了一下。顺便学习一下文件上传所需要的注意事项。</p> 
<pre><code>  Content-disposition 是 MIME 协议的扩展，MIME 协议指示 MIME 用户代理如何显示附加的文件。当 Internet Explorer 接收到头时，它会激活文件下载对话框，它的文件名框自动填充了头中指定的文件名。（请注意，这是设计导致的；无法使用此功能将文档保存到用户的计算机上，而不向用户询问保存位置。）   

    服务端向客户端游览器发送文件时，如果是浏览器支持的文件类型，一般会默认使用浏览器打开，比如txt、jpg等，会直接在浏览器中显示，如果需要提示用户保存，就要利用Content-Disposition进行一下处理，关键在于一定要加上attachment：
</code></pre> 
<p>Response.AppendHeader(“Content-Disposition”,”attachment;filename=FileName.txt”);</p> 
<p>备注：这样浏览器会提示保存还是打开，即使选择打开，也会使用相关联的程序比如记事本打开，而不是IE直接打开了。</p> 
<p>Content-Disposition就是当用户想把请求所得的内容存为一个文件的时候提供一个默认的文件名。具体的定义如下：</p> 
<p>content-disposition = “Content-Disposition” “:”</p> 
<p>disposition-type *( “;” disposition-parm )</p> 
<p>disposition-type = “attachment” | disp-extension-token</p> 
<p>disposition-parm = filename-parm | disp-extension-parm</p> 
<p>filename-parm = “filename” “=” quoted-string</p> 
<p>disp-extension-token = token</p> 
<p>disp-extension-parm = token “=” ( token | quoted-string )</p> 
<p>那么由上可知具体的例子：</p> 
<p>Content-Disposition: attachment; filename=“filename.xls”</p> 
<pre><code>   当然filename参数可以包含路径信息，但User-Agnet会忽略掉这些信息，只会把路径信息的最后一部分做为文件名。当你在响应类型为application/octet- stream情况下使用了这个头信息的话，那就意味着你不想直接显示内容，而是弹出一个”文件下载”的对话框，接下来就是由你来决定“打开”还是“保存” 了。
</code></pre> 
<p>注意事项：</p> 
<p>1.当代码里面使用Content-Disposition来确保浏览器弹出下载对话框的时候。 response.addHeader(“Content-Disposition”,”attachment”);一定要确保没有做过关于禁止浏览器缓存的操作。如下：</p> 
<p>response.setHeader(“Pragma”, “No-cache”); <br> response.setHeader(“Cache-Control”, “No-cache”); <br> response.setDateHeader(“Expires”, 0);</p> 
<p>不然会发现下载功能在opera和firefox里面好好的没问题，在IE下面就是不行，就是找不到文件。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b020bfccbe7d619a6bd1d43ede282abd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一阶段-sevenWork-定义一个名为Vehicles（交通工具）的基类</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/163c4ff577474216d29665c9534b6e16/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SDUT 3915 从零开始的异世界生活</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>