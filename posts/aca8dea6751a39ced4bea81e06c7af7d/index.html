<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于EasyExcel锁定指定列导出数据到excel - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于EasyExcel锁定指定列导出数据到excel" />
<meta property="og:description" content="基于EasyExcel锁定指定列导出数据到excel 大家好，我是llp。最近在做系统报表时,遇到一个需求，需要查询系统数据导出excel，并要求导出的excel列中有一些是锁定的有一些是不锁定的，其实就是实现动态列锁定的效果。
1.需求描述 要求导出的excel列中有一些时锁定的有一些时不锁定的，即使实现动态列锁定的效果。
需求图示 easyexcel基本使用： https://blog.csdn.net/qq_44981526/article/details/122052455 2.实现步骤 1.获取要导出的数据 示例代码
@GetMapping(&#34;/exportRiskDetailReport&#34;) @ApiOperation(&#34;风险排查明细统计导出&#34;) public void exportRiskDetailReport(DetailReportDto detailReportDto){ //1.结合实际业务查询数据 List&lt;DetailReportViewDto&gt; list = statisticsReportDomainService.riskDetailReport(premisesIdList, detailReportDto); //2.基于EasyExcel导出excel文件 EasyExcelUtil.excelLockExport(DetailReportViewDto.class, &#34;风险排查明细统计数据&#34;&#43;DateUtil.format(new Date(), &#34;yyyyMMddHHmmssS&#34;), list, null); } 2.编写EasyExcel工具类 @Slf4j public class EasyExcelUtil { //导出excel指定锁定列 public static void excelLockExport(Class head, String excelname, List data, String sheetName) { ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletResponse response = requestAttributes.getResponse(); response.setContentType(&#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#34;); response.setCharacterEncoding(&#34;utf-8&#34;); try { // 这里URLEncoder.encode可以防止浏览器端导出excel文件名中文乱码 当然和easyexcel没有关系 String fileName = URLEncoder.encode(excelname, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/aca8dea6751a39ced4bea81e06c7af7d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-29T17:27:41+08:00" />
<meta property="article:modified_time" content="2023-01-29T17:27:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于EasyExcel锁定指定列导出数据到excel</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="EasyExcelexcel_0"></a>基于EasyExcel锁定指定列导出数据到excel</h2> 
<p>大家好，我是llp。最近在做系统报表时,遇到一个需求，需要查询系统数据导出excel，并要求导出的excel列中有一些是锁定的有一些是不锁定的，其实就是实现动态列锁定的效果。</p> 
<h3><a id="1_7"></a>1.需求描述</h3> 
<p>要求导出的excel列中有一些时锁定的有一些时不锁定的，即使实现动态列锁定的效果。</p> 
<ul><li>需求图示</li></ul> 
<p><img src="https://images2.imgbox.com/a5/19/bRb3op4G_o.png" alt="image-20221129185658805"></p> 
<ul><li>easyexcel基本使用： <a href="https://blog.csdn.net/qq_44981526/article/details/122052455">https://blog.csdn.net/qq_44981526/article/details/122052455</a></li></ul> 
<h3><a id="2_21"></a>2.实现步骤</h3> 
<h4><a id="1_23"></a>1.获取要导出的数据</h4> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/exportRiskDetailReport"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"风险排查明细统计导出"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exportRiskDetailReport</span><span class="token punctuation">(</span><span class="token class-name">DetailReportDto</span> detailReportDto<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//1.结合实际业务查询数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DetailReportViewDto</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> statisticsReportDomainService<span class="token punctuation">.</span><span class="token function">riskDetailReport</span><span class="token punctuation">(</span>premisesIdList<span class="token punctuation">,</span> detailReportDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.基于EasyExcel导出excel文件</span>
        <span class="token class-name">EasyExcelUtil</span><span class="token punctuation">.</span><span class="token function">excelLockExport</span><span class="token punctuation">(</span><span class="token class-name">DetailReportViewDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">"风险排查明细统计数据"</span><span class="token operator">+</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yyyyMMddHHmmssS"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2EasyExcel_42"></a>2.编写EasyExcel工具类</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EasyExcelUtil</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//导出excel指定锁定列</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">excelLockExport</span><span class="token punctuation">(</span><span class="token class-name">Class</span> head<span class="token punctuation">,</span> <span class="token class-name">String</span> excelname<span class="token punctuation">,</span> <span class="token class-name">List</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> sheetName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ServletRequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> requestAttributes<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 这里URLEncoder.encode可以防止浏览器端导出excel文件名中文乱码 当然和easyexcel没有关系</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>excelname<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\+"</span><span class="token punctuation">,</span> <span class="token string">"%20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename*=utf-8''"</span> <span class="token operator">+</span> fileName <span class="token operator">+</span> <span class="token string">".xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span>
                	<span class="token comment">//锁定工作簿</span>
                    <span class="token punctuation">.</span><span class="token function">registerWriteHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LockSheetWriteHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                	<span class="token comment">//指定单元格解锁</span>
                    <span class="token punctuation">.</span><span class="token function">registerWriteHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CellHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>sheetName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">"Sheet1"</span> <span class="token operator">:</span> sheetName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"导出数据失败: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="3UnLockCell_74"></a>3.编写UnLockCell自定义注解</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 用于标记锁定哪些列不需要锁定
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">UnLockCell</span> <span class="token punctuation">{<!-- --></span>


<span class="token punctuation">}</span>
</code></pre> 
<p><strong>使用@UnLockCell注解修饰不需要锁定的字段，这里每个字段都对应easy的表头</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@HeadRowHeight</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>description <span class="token operator">=</span> <span class="token string">"风险排查明细报表DTO"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DetailReportViewDto</span> <span class="token keyword">extends</span> <span class="token class-name">DtoBase</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"风险明细补充数据id"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"账单明细id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"账单明细id"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> noticeDetailId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费单位"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费单位"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dataCustomerName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"是否关联企业"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">BooleanConvert</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"是否关联企业"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> relationEnterprise<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"客户属性"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"客户属性：租户|业主"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> contractRoleType<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelIgnore</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"所属事业部资源id"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> orgResourceId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"所属事业部"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"所属事业部"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orgName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"项目部"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"项目部"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> organization<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelIgnore</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"项目部资源id"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> organizationResourceId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelIgnore</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"楼盘资源id"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> premisesId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"楼盘"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"楼盘"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"楼盘1"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> premisesName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费类型"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费类型"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> arrearsType<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelIgnore</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"费项id"</span><span class="token punctuation">,</span> hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> costItemId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费期间起期"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费期间起期"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> costDateBegin<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费期间止期"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费期间止期"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> costDateEnd<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费总金额"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">MoneyConvert</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费总金额"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"800000000"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Money</span> arrearsAmount<span class="token punctuation">;</span>

    <span class="token comment">//----------------导入后显示字段----------------</span>
    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费原因"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费原因"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"没钱"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> reasonSummary<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费可回收比例"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"欠费可回收比例"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> recoverableRatio<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"可收取金额预估"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">MoneyConvert</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"可收取金额预估"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Money</span> estimateAmount<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"不可收取金额预估"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">MoneyConvert</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"不可收取金额预估"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Money</span> notChargeableAmount<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"清收举措"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"清收举措"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"UrgeMeasuresEnum STOPMETERS"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> urgeMeasures<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"后果预判"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"后果预判"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> consequencePrediction<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"解决建议"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"解决建议"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> solutionSuggestion<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@UnLockCell</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"备注"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"备注"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4WriteHandler_215"></a>4.编写WriteHandler</h4> 
<p><strong>用于锁定工作簿</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSheetWriteHandler</span> <span class="token keyword">implements</span> <span class="token class-name">SheetWriteHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeSheetCreate</span><span class="token punctuation">(</span><span class="token class-name">WriteWorkbookHolder</span> writeWorkbookHolder<span class="token punctuation">,</span> <span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterSheetCreate</span><span class="token punctuation">(</span><span class="token class-name">WriteWorkbookHolder</span> writeWorkbookHolder<span class="token punctuation">,</span> <span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Sheet</span> sheet <span class="token operator">=</span> writeSheetHolder<span class="token punctuation">.</span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//锁定工作簿，设置保护密码</span>
        sheet<span class="token punctuation">.</span><span class="token function">protectSheet</span><span class="token punctuation">(</span><span class="token string">"1qaz!QAZ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 锁定单元格不可选中(防止别人直接复制内容到其他excel修改)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SXSSFSheet</span><span class="token punctuation">)</span> writeSheetHolder<span class="token punctuation">.</span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lockSelectLockedCells</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>用于指定单元格样式</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CellHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CellWriteHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">"1qaz!QAZ"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 在创建单元格之前调用
     * The maximum number of Cell Styles was exceeded. You can define up to 64000 style in a .xlsx Workbook
     *
     * @param writeSheetHolder
     * @param writeTableHolder
     * @param row
     * @param head
     * @param columnIndex
     * @param relativeRowIndex
     * @param isHead
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeCellCreate</span><span class="token punctuation">(</span><span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">,</span> <span class="token class-name">WriteTableHolder</span> writeTableHolder<span class="token punctuation">,</span> <span class="token class-name">Row</span> row<span class="token punctuation">,</span> <span class="token class-name">Head</span> head<span class="token punctuation">,</span> <span class="token class-name">Integer</span> columnIndex<span class="token punctuation">,</span> <span class="token class-name">Integer</span> relativeRowIndex<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isHead<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 在创建单元格后调用
     *
     * @param writeSheetHolder
     * @param writeTableHolder
     * @param cell             * @param head
     * @param relativeRowIndex
     * @param isHead
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCellCreate</span><span class="token punctuation">(</span><span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">,</span> <span class="token class-name">WriteTableHolder</span> writeTableHolder<span class="token punctuation">,</span> <span class="token class-name">Cell</span> cell<span class="token punctuation">,</span> <span class="token class-name">Head</span> head<span class="token punctuation">,</span> <span class="token class-name">Integer</span> relativeRowIndex<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isHead<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 在转换单元格数据后调用
     *
     * @param writeSheetHolder
     * @param writeTableHolder
     * @param cellData
     * @param cell
     * @param head
     * @param relativeRowIndex
     * @param isHead
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCellDataConverted</span><span class="token punctuation">(</span><span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">,</span> <span class="token class-name">WriteTableHolder</span> writeTableHolder<span class="token punctuation">,</span> <span class="token class-name">CellData</span> cellData<span class="token punctuation">,</span> <span class="token class-name">Cell</span> cell<span class="token punctuation">,</span> <span class="token class-name">Head</span> head<span class="token punctuation">,</span> <span class="token class-name">Integer</span> relativeRowIndex<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isHead<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 在完成对单元格的所有操作后调用
     *
     * @param writeSheetHolder
     * @param writeTableHolder
     * @param cellDataList
     * @param cell
     * @param head
     * @param relativeRowIndex
     * @param isHead
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCellDispose</span><span class="token punctuation">(</span><span class="token class-name">WriteSheetHolder</span> writeSheetHolder<span class="token punctuation">,</span> <span class="token class-name">WriteTableHolder</span> writeTableHolder<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CellData</span><span class="token punctuation">&gt;</span></span> cellDataList<span class="token punctuation">,</span> <span class="token class-name">Cell</span> cell<span class="token punctuation">,</span> <span class="token class-name">Head</span> head<span class="token punctuation">,</span> <span class="token class-name">Integer</span> relativeRowIndex<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isHead<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> fieldName <span class="token operator">=</span> head<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> writeSheetHolder<span class="token punctuation">.</span><span class="token function">getClazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">UnLockCell</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> field<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">ExcelProperty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token constant">LOCKED</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">setCellStyleProperties</span><span class="token punctuation">(</span>cell<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>说明：这里分成两个writeHandler，一个用于锁定工作簿，一个用于指定单元格样式</strong></p> 
<p>我所猜的坑页正是在这里，最开始我是用的是CellHandler，在这个handler中去锁定工作簿，并指定锁定列遇到了如下问题：</p> 
<p><code>The maximum number of Cell Styles was exceeded. You can define up to 64000 style in a .xlsx Workbook</code></p> 
<p>错误的原因：创建了太多的单元格样式，而这个限制其实xlsx excel所限制的，而poi或者说easyexcel只是遵守规则。</p> 
<p>起初查询了关于这个错误的很多文章，大多都是建议将创建样式的方法写在循环外面或者说是复用样式。</p> 
<p>显然复用样式是比较靠谱的方案，我尝试了在CellHandler中进行复用，但在导出时会限于死循环，一直得不到响应。</p> 
<p>解决办法：</p> 
<ul><li>将锁定工作簿操作放在实现SheetWriteHandler接口的实现类中实现</li><li>单元格样式复用操作，则在实现CellWriteHandler接口的实现类中实现</li></ul> 
<p><img src="https://images2.imgbox.com/1b/09/ex0UyUE5_o.png" alt="image-20221129190948467"></p> 
<h3><a id="3_347"></a>3.最终效果</h3> 
<p><img src="https://images2.imgbox.com/f1/65/qLWeEOjQ_o.png" alt="image-20221129193526121"></p> 
<p><img src="https://images2.imgbox.com/55/11/KqEJ8aCj_o.png" alt="image-20221129185658805"></p> 
<h3><a id="4_359"></a>4.小总结</h3> 
<p>问题本身并不难，还是要多养成看API的习惯。有时候问题在网上找不到或者说应用场景不一样，看API文档确实会给到很大的帮助。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7357d0f4168553aa1e585e4ded345298/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">阿里云磁盘挂载，挂载点提示异常：mount: /data: wrong fs type, bad option, bad superblock on /dev/vdb, missing codepag</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6dd65ce7ba38e19c66fb950a68752feb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">记OPNsense防火墙的安装过程 - 安全</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>