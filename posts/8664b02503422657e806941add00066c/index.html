<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>各种字符串类型之间的转换 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="各种字符串类型之间的转换" />
<meta property="og:description" content="五、各种字符串类型之间的转换
1、函数 WideCharToMultiByte()，转换 UNICODE 到 MBCS。使用范例：
LPCOLESTR lpw = L&#34;Hello,你好&#34;; size_t wLen = wcslen( lpw ) &#43; 1; // 宽字符字符长度，&#43;1表示包含字符串结束符 int aLen=WideCharToMultiByte( // 第一次调用，计算所需 MBCS 字符串字节长度 CP_ACP, 0, lpw, // 宽字符串指针 wLen, // 字符长度 NULL, 0, // 参数0表示计算转换后的字符空间 NULL, NULL); LPSTR lpa = new char [aLen]; WideCharToMultiByte( CP_ACP, 0, lpw, wLen, lpa, // 转换后的字符串指针 aLen, // 给出空间大小 NULL, NULL); // 此时，lpa 中保存着转换后的 MBCS 字符串 ... ... ... ... delete [] lpa; 2、函数 MultiByteToWideChar()，转换 MBCS 到 UNICODE。使用范例： LPCSTR lpa = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8664b02503422657e806941add00066c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-04-17T14:32:15+08:00" />
<meta property="article:modified_time" content="2012-04-17T14:32:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">各种字符串类型之间的转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> <strong>五、各种字符串类型之间的转换</strong><br> 　　1、函数 WideCharToMultiByte()，转换 UNICODE 到 MBCS。使用范例：</p> 
<pre style="font-size:18px; letter-spacing:1px; line-height:22px; background-color:rgb(199,237,204)">      LPCOLESTR lpw = L"Hello,你好";
      size_t wLen = wcslen( lpw ) + 1;  // 宽字符字符长度，+1表示包含字符串结束符
      
      int aLen=WideCharToMultiByte(  // 第一次调用，计算所需 MBCS 字符串字节长度
		CP_ACP,
		0,
		lpw,  // 宽字符串指针
		wLen, // 字符长度
		NULL,
		0,  // 参数0表示计算转换后的字符空间
		NULL,
		NULL);
	
      LPSTR lpa = new char [aLen];
	
      WideCharToMultiByte(
		CP_ACP,
		0,
		lpw,
		wLen,
		lpa,  // 转换后的字符串指针
		aLen, // 给出空间大小
		NULL,
		NULL);

      // 此时，lpa 中保存着转换后的 MBCS 字符串
      ... ... ... ...
      delete [] lpa;</pre> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    2、函数 MultiByteToWideChar()，转换 MBCS 到 UNICODE。使用范例：</span> 
<pre style="font-size:18px; letter-spacing:1px; line-height:22px; background-color:rgb(199,237,204)">      LPCSTR lpa = "Hello,你好";
      size_t aLen = strlen( lpa ) + 1;
      
      int wLen = MultiByteToWideChar(
		CP_ACP,
		0,
		lpa,
		aLen,
		NULL,
		0);
      
      LPOLESTR lpw = new WCHAR [wLen];
      MultiByteToWideChar(
		CP_ACP,
		0,
		lpa,
		aLen,
		lpw,
		wLen);
      ... ... ... ...
      delete [] lpw;</pre> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    3、使用 ATL 提供的转换宏。</span> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">　</span> 
<p style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> </p> 
<div class="tablediv" style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
 <table class="dtTABLE" width="100%" cellspacing="1" border="1" style="font-size:14px; line-height:18pt"><tbody><tr><td width="226">A2BSTR</td><td width="226">OLE2A</td><td width="226">T2A</td><td width="227">W2A</td></tr><tr><td width="226">A2COLE</td><td width="226">OLE2BSTR</td><td width="226">T2BSTR</td><td width="227">W2BSTR</td></tr><tr><td width="226">A2CT</td><td width="226">OLE2CA</td><td width="226">T2CA</td><td width="227">W2CA</td></tr><tr><td width="226">A2CW</td><td width="226">OLE2CT</td><td width="226">T2COLE</td><td width="227">W2COLE</td></tr><tr><td width="226">A2OLE</td><td width="226">OLE2CW</td><td width="226">T2CW</td><td width="227">W2CT</td></tr><tr><td width="226">A2T</td><td width="226">OLE2T</td><td width="226">T2OLE</td><td width="227">W2OLE</td></tr><tr><td width="226">A2W</td><td width="226">OLE2W</td><td width="226">T2W</td><td width="227">W2T</td></tr></tbody></table> 
</div> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">上表中的宏函数，其实非常容易记忆：</span> 
<table border="1" cellspacing="1" width="100%" style="font-family:Tahoma; font-size:14px; line-height:18pt; letter-spacing:1px"><tbody><tr><td width="10%">2</td><td width="90%">好搞笑的缩写，to 的发音和 2 一样，所以借用来表示“转换为、转换到”的含义。</td></tr><tr><td width="10%">A</td><td width="90%">ANSI 字符串，也就是 MBCS。</td></tr><tr><td width="10%">W、OLE</td><td width="90%">宽字符串，也就是 UNICODE。</td></tr><tr><td width="10%">T</td><td width="90%">中间类型T。如果定义了 _UNICODE，则T表示W；如果定义了 _MBCS，则T表示A</td></tr><tr><td width="10%">C</td><td width="90%">const 的缩写</td></tr></tbody></table> 
<p style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 使用范例：</p> 
<pre style="font-size:18px; letter-spacing:1px; line-height:22px; background-color:rgb(199,237,204)">      #include &lt;atlconv.h&gt;
      
      void fun()
      {
          USES_CONVERSION;  // 只需要调用一次，就可以在函数中进行多次转换
          
          LPCTSTR lp = OLE2CT( L"Hello,你好") );
          ... ... ... ...
          // 不用显式释放 lp 的内存，因为
          // 由于 ATL 转换宏使用栈作为临时空间，函数结束后会自动释放栈空间。
      }</pre> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">　　使用 ATL 转换宏，由于不用释放临时空间，所以使用起来非常方便。但是考虑到栈空间的尺寸（VC 默认2M），使用时要注意几点：</span> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    1、只适合于进行短字符串的转换；</span> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    2、不要试图在一个次数比较多的循环体内进行转换；</span> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    3、不要试图对字符型文件内容进行转换，因为文件尺寸一般情况下是比较大的；</span> 
<br style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px"> 
<span style="font-family:Tahoma; font-size:18px; letter-spacing:1px; line-height:22px">    4、对情况 2 和 3，要使用 MultiByteToWideChar() 和 WideCharToMultiByte()；</span>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/68d2793e83124cc2dd6c19d7798edc5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最全的OLE操作Excel的完整代码（2）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8146d3200e1fb0d7cf79da4ff1cdf39/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">matlab实现牛顿迭代法求解非线性方程组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>