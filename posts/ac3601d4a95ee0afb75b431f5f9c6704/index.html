<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu 14.04 配置 Nginx &#43; uWSGI 托管 virtualenv 下 Flask 应用的一点注意事项 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu 14.04 配置 Nginx &#43; uWSGI 托管 virtualenv 下 Flask 应用的一点注意事项" />
<meta property="og:description" content="标题很长，本文内容却很简单。在现在的 Python 开发中，虚拟环境是必不可少的，但是有时候，虚拟环境又会给我们带来一些不必要的麻烦或者说坑，比如今天要谈到的 Flask 应用托管的问题。
Nginx &#43; uWSGI 可以说是 Python Web 项目托管的不二之选，当然，如果只是自己开发测试，或者应用在访问量很小的应用上，Gunicorn 甚至 Web 框架自带的 web server 也许就够了，但是我们逃不开会碰到这对王者组合的情况，今天我就遇到了这样的坑。按照官方文档分别配置 Nginx 和 uWSGI 后，使用 uwsgi 的命令语句启动，没有任何问题，但是尝试使用 ini 配置启动 uWSGI 后，则会遇到一直报 502 bad gateway 的错误。
一番排查后——排查过程不表——发现问题所在，我的 uWSGI 安装在了项目的 virtualenv 目录中，然而 ini 配置文件却没有配置虚拟环境目录，而网上现有的博客教程里的 ini 配置都是没有提到这个问题的，所以，我们加上虚拟环境的配置，并且注意，最好加上 plugin = python 这一条配置，当然了，这个需要提前安装，具体如何安装，不是本文重点，暂不赘述了。
所以，我最终的 ini 配置文件内容如下：
[uwsgi] plugins = python vhost = true chdir = /home/k/Documents/demo venv = /home/k/Documents/demo/venv #python module to import app = main module = %(app) #socket file&#39;s location socket = /home/k/Documents/demo/%n." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ac3601d4a95ee0afb75b431f5f9c6704/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-04-24T10:23:00+08:00" />
<meta property="article:modified_time" content="2016-04-24T10:23:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu 14.04 配置 Nginx &#43; uWSGI 托管 virtualenv 下 Flask 应用的一点注意事项</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>标题很长，本文内容却很简单。在现在的 Python 开发中，虚拟环境是必不可少的，但是有时候，虚拟环境又会给我们带来一些不必要的麻烦或者说坑，比如今天要谈到的 Flask 应用托管的问题。</p> 
<p>Nginx + uWSGI 可以说是 Python Web 项目托管的不二之选，当然，如果只是自己开发测试，或者应用在访问量很小的应用上，Gunicorn 甚至 Web 框架自带的 web server 也许就够了，但是我们逃不开会碰到这对王者组合的情况，今天我就遇到了这样的坑。按照官方文档分别配置 Nginx 和 uWSGI 后，使用 uwsgi 的命令语句启动，没有任何问题，但是尝试使用 ini 配置启动 uWSGI 后，则会遇到一直报 <code>502 bad gateway</code> 的错误。</p> 
<p>一番排查后——排查过程不表——发现问题所在，我的 uWSGI 安装在了项目的 virtualenv 目录中，然而 ini 配置文件却没有配置虚拟环境目录，而网上现有的博客教程里的 ini 配置都是没有提到这个问题的，所以，我们加上虚拟环境的配置，并且注意，<strong>最好加上 <code>plugin = python</code></strong> 这一条配置，当然了，这个需要提前安装，具体如何安装，不是本文重点，暂不赘述了。</p> 
<p>所以，我最终的 ini 配置文件内容如下：</p> 
<pre class="prettyprint"><code class="language-ini hljs "><span class="hljs-title">[uwsgi]</span>
<span class="hljs-setting">plugins = <span class="hljs-value">python</span></span>

<span class="hljs-setting">vhost = <span class="hljs-value"><span class="hljs-keyword">true</span></span></span>
<span class="hljs-setting">chdir = <span class="hljs-value">/home/k/Documents/demo</span></span>
<span class="hljs-setting">venv = <span class="hljs-value">/home/k/Documents/demo/venv</span></span>

#python module to import
<span class="hljs-setting">app = <span class="hljs-value">main</span></span>
<span class="hljs-setting">module = <span class="hljs-value">%(app)</span></span>

#socket file's location
<span class="hljs-setting">socket = <span class="hljs-value">/home/k/Documents/demo/%n.sock</span></span>

#permissions for the socket file
<span class="hljs-setting">chmod-socket    = <span class="hljs-value"><span class="hljs-number">666</span></span></span>

#the variable that holds a flask application inside the module imported at line #6
<span class="hljs-setting">callable = <span class="hljs-value">app</span></span>

#location of log files
<span class="hljs-setting">logto = <span class="hljs-value">/home/k/Documents/demo/%n.log</span></span>

<span class="hljs-setting">processes = <span class="hljs-value"><span class="hljs-number">4</span></span></span>
<span class="hljs-setting">threads = <span class="hljs-value"><span class="hljs-number">2</span></span></span></code></pre> 
<p>而我的项目目录结构则是：</p> 
<pre class="prettyprint"><code class=" hljs avrasm">demo/
|____venv/
|____main<span class="hljs-preprocessor">.py</span> <span class="hljs-preprocessor"># 这个是应用的启动文件（对应 ini 配置中的 app）</span>
|____uwsgi<span class="hljs-preprocessor">.ini</span>
|____uwsgi<span class="hljs-preprocessor">.sock</span>
|____uwsgi<span class="hljs-preprocessor">.log</span>
|____access<span class="hljs-preprocessor">.log</span> <span class="hljs-preprocessor"># 这个是 Nginx 中的 access 日志配置</span>
|____error<span class="hljs-preprocessor">.log</span> <span class="hljs-preprocessor"># 这个是 Nginx 中的 error 日志配置</span></code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/672c9bd8722a214c96d5871df73195d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS之键盘的使用／通知对键盘的监听</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4468c6c442e02833bb75823257956555/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[swift实战入门]手把手教你编写2048(三)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>