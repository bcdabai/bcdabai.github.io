<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫批量下载科研论文（SciHub） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="爬虫批量下载科研论文（SciHub）" />
<meta property="og:description" content="系列文章目录 利用 eutils 实现自动下载序列文件
提示：写完文章后，目录可以自动生成，如何生成可参考右边的帮助文档
文章目录 系列文章目录前言一、获取文献信息二、下载文献PDF文件参考 前言 大家好✨，这里是bio🦖。这次为大家带来自动收集文献信息、批量下载科研论文的脚本（只能批量下载公布在sci-hub上的科研论文）。平常阅读文献时只需要一篇一篇下载即可，并不需要用到批量下载的操作。但有时需要对某领域进行总结或者归纳，就可以考虑使用批量下载咯~
导师下令找文献，学生偷偷抹眼泪。
文献三千挤满屏，只下一篇可不行。
作息紊乱失双休，日夜不分忘寝食。
满腔热血搞科研，一盆冷水当头洛。
（打油诗人作）
一、获取文献信息 每个人的研究领域不一样，获取文献信息的方式不一样。这里以Pubmed1为例，PubMed是主要用于检索MEDLINE数据库中，生命科学和生物医学引用文献及索引的免费搜索引擎。之前爬取冠状病毒核酸数据使用过eutils，本篇博客也使用eutils去获取文献信息，关于eutils的介绍可以看利用 eutils 实现自动下载序列文件 。这里就不做介绍~
首先构造搜索url，其中term是你检索的关键词，year对应文献发表日期，API_KEY能够让你在一秒内的访问次数从3次提升到10次。这里将term替换为Machine learning，year替换为2022。然后使用requests库获取该url的对应的信息，在使用BeautifulSoup库将其转化为html格式。
https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key={API_KEY}&amp;term={term}&#43;{year}[pdat]
代码如下：
import pandas as pd import requests from bs4 import BeautifulSoup import math import re import time API_KEY = &#34;Your AIP KEY&#34; term = &#34;Machine Learning&#34; year = &#34;2022&#34; url_start = f&#39;https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key={API_KEY}&amp;term={term}&#43;{year}[pdat]&#39; info_page = BeautifulSoup(requests.get(url_start, timeout=(5, 5)).text, &#39;html.parser&#39;) 爬取的结果如下，可以看到结果主要包括许多PMID。然后包括的信息总数&lt;count&gt;31236&lt;/count&gt;、最大返回数&lt;retmax&gt;20&lt;/retmax&gt;以及结果开始的序号&lt;retstart&gt;0&lt;/retstart&gt;。下一步就是根据id获取文章对应的信息。
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt; &lt;!DOCTYPE eSearchResult PUBLIC &#34;-//NLM//DTD esearch 20060628//EN&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d35d3daedcd4c6c4d81d55dd2b4d3264/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T23:16:32+08:00" />
<meta property="article:modified_time" content="2023-10-26T23:16:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫批量下载科研论文（SciHub）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<p><a href="https://blog.csdn.net/ouyangk1026/article/details/126903167">利用 eutils 实现自动下载序列文件</a></p> 
<hr> 
<p><code>提示：写完文章后，目录可以自动生成，如何生成可参考右边的帮助文档</code></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#_11" rel="nofollow">前言</a></li><li><a href="#_21" rel="nofollow">一、获取文献信息</a></li><li><a href="#PDF_182" rel="nofollow">二、下载文献PDF文件</a></li><li><a href="#_206" rel="nofollow">参考</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_11"></a>前言</h2> 
<p>大家好✨，这里是bio🦖。这次为大家带来自动收集文献信息、批量下载科研论文的脚本（只能批量下载公布在sci-hub上的科研论文）。平常阅读文献时只需要一篇一篇下载即可，并不需要用到批量下载的操作。但有时需要对某领域进行总结或者归纳，就可以考虑使用批量下载咯~</p> 
<p>导师下令找文献，学生偷偷抹眼泪。<br> 文献三千挤满屏，只下一篇可不行。<br> 作息紊乱失双休，日夜不分忘寝食。<br> 满腔热血搞科研，一盆冷水当头洛。<br> （打油诗人作）</p> 
<hr> 
<h2><a id="_21"></a>一、获取文献信息</h2> 
<p>每个人的研究领域不一样，获取文献信息的方式不一样。这里以Pubmed<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup>为例，PubMed是主要用于检索MEDLINE数据库中，生命科学和生物医学引用文献及索引的免费搜索引擎。之前爬取冠状病毒核酸数据使用过eutils，本篇博客也使用eutils去获取文献信息，关于eutils的介绍可以看<a href="https://blog.csdn.net/ouyangk1026/article/details/126903167">利用 eutils 实现自动下载序列文件</a> 。这里就不做介绍~</p> 
<p>首先构造搜索url，其中<code>term</code>是你检索的关键词，<code>year</code>对应文献发表日期，<code>API_KEY</code>能够让你在一秒内的访问次数从3次提升到10次。这里将<code>term</code>替换为<code>Machine learning</code>，<code>year</code>替换为<code>2022</code>。然后使用<code>requests</code>库获取该url的对应的信息，在使用<code>BeautifulSoup</code>库将其转化为html格式。</p> 
<blockquote> 
 <p>https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key={API_KEY}&amp;term={term}+{year}[pdat]</p> 
</blockquote> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> math
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time

API_KEY <span class="token operator">=</span> <span class="token string">"Your AIP KEY"</span>
term <span class="token operator">=</span> <span class="token string">"Machine Learning"</span>
year <span class="token operator">=</span> <span class="token string">"2022"</span>
url_start <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>API_KEY<span class="token punctuation">}</span></span><span class="token string">&amp;term=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>term<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>year<span class="token punctuation">}</span></span><span class="token string">[pdat]'</span></span>
info_page <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_start<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
</code></pre> 
<p>爬取的结果如下，可以看到结果主要包括许多PMID。然后包括的信息总数<code>&lt;count&gt;31236&lt;/count&gt;</code>、最大返回数<code>&lt;retmax&gt;20&lt;/retmax&gt;</code>以及结果开始的序号<code>&lt;retstart&gt;0&lt;/retstart&gt;</code>。下一步就是根据id获取文章对应的信息。</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>?xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> ?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>!DOCTYPE eSearchResult PUBLIC <span class="token string">"-//NLM//DTD esearch 20060628//EN"</span> <span class="token string">"https://eutils.ncbi.nlm.nih.gov/eutils/dtd/20060628/esearch.dtd"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>esearchresult<span class="token operator">&gt;</span><span class="token operator">&lt;</span>count<span class="token operator">&gt;</span><span class="token number">31236</span><span class="token operator">&lt;</span><span class="token operator">/</span>count<span class="token operator">&gt;</span><span class="token operator">&lt;</span>retmax<span class="token operator">&gt;</span><span class="token number">20</span><span class="token operator">&lt;</span><span class="token operator">/</span>retmax<span class="token operator">&gt;</span><span class="token operator">&lt;</span>retstart<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>retstart<span class="token operator">&gt;</span><span class="token operator">&lt;</span>idlist<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37878682</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37873546</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37873494</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># omitting many results</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37786662</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37780106</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token number">37776368</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>idlist<span class="token operator">&gt;</span><span class="token operator">&lt;</span>translationset<span class="token operator">&gt;</span><span class="token operator">&lt;</span>translation<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">from</span><span class="token operator">&gt;</span>Machine Learning<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">from</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>to<span class="token operator">&gt;</span><span class="token string">"machine learning"</span><span class="token punctuation">[</span>MeSH Terms<span class="token punctuation">]</span> OR <span class="token punctuation">(</span><span class="token string">"machine"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span> AND <span class="token string">"learning"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span><span class="token punctuation">)</span> OR <span class="token string">"machine learning"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>to<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>translation<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>translationset<span class="token operator">&gt;</span><span class="token operator">&lt;</span>querytranslation<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"machine learning"</span><span class="token punctuation">[</span>MeSH Terms<span class="token punctuation">]</span> OR <span class="token punctuation">(</span><span class="token string">"machine"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span> AND <span class="token string">"learning"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span><span class="token punctuation">)</span> OR <span class="token string">"machine learning"</span><span class="token punctuation">[</span>All Fields<span class="token punctuation">]</span><span class="token punctuation">)</span> AND <span class="token number">2022</span><span class="token operator">/</span><span class="token number">01</span><span class="token operator">/</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">2022</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">31</span><span class="token punctuation">[</span>Date <span class="token operator">-</span> Publication<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>querytranslation<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>esearchresult<span class="token operator">&gt;</span>
</code></pre> 
<p>可以看到结果也是31236条记录，爬取的信息忠实于实际的信息，可以放心食用~<br> <img src="https://images2.imgbox.com/90/a9/Q6VjUoQv_o.png" alt="在这里插入图片描述"></p> 
<p>获取文章的信息也是相同的步骤，首先构造url，然后爬取对应的信息，直接上代码：</p> 
<pre><code class="prism language-python">API_KEY <span class="token operator">=</span> <span class="token string">"Your AIP KEY"</span>
id_str <span class="token operator">=</span> <span class="token string">'37878682'</span>
url_paper <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&amp;api_key=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>API_KEY<span class="token punctuation">}</span></span><span class="token string">&amp;id=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_str<span class="token punctuation">}</span></span><span class="token string">&amp;rettype=medline&amp;retmode=text'</span></span>
paper_info <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_paper<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如下，包括PMID、DOI、摘要、作者、单位、发表年份等等信息，你可以从这一步获得的信息中获取你需要的信息如DOI。接下来的就是要爬取文献对应的PDF文件。这是最关键的一步。</p> 
<pre><code class="prism language-python">PMID<span class="token operator">-</span> <span class="token number">37878682</span>
OWN <span class="token operator">-</span> NLM
STAT<span class="token operator">-</span> Publisher
LR  <span class="token operator">-</span> <span class="token number">20231025</span>
IS  <span class="token operator">-</span> <span class="token number">2047</span><span class="token operator">-</span>217X <span class="token punctuation">(</span>Electronic<span class="token punctuation">)</span>
IS  <span class="token operator">-</span> <span class="token number">2047</span><span class="token operator">-</span>217X <span class="token punctuation">(</span>Linking<span class="token punctuation">)</span>
VI  <span class="token operator">-</span> <span class="token number">12</span>
DP  <span class="token operator">-</span> <span class="token number">2022</span> Dec <span class="token number">28</span>
TI  <span class="token operator">-</span> Computational prediction of human deep intronic variation<span class="token punctuation">.</span>
LID <span class="token operator">-</span> giad085 <span class="token punctuation">[</span>pii<span class="token punctuation">]</span>
LID <span class="token operator">-</span> <span class="token number">10.1093</span><span class="token operator">/</span>gigascience<span class="token operator">/</span>giad085 <span class="token punctuation">[</span>doi<span class="token punctuation">]</span>
AB  <span class="token operator">-</span> BACKGROUND<span class="token punctuation">:</span> The adoption of whole<span class="token operator">-</span>genome sequencing <span class="token keyword">in</span> genetic screens has 
      facilitated the detection of genetic variation <span class="token keyword">in</span> the intronic regions of genes<span class="token punctuation">,</span> 
      far <span class="token keyword">from</span> annotated splice sites<span class="token punctuation">.</span> However<span class="token punctuation">,</span> selecting an appropriate computational 
      tool to discriminate functionally relevant genetic variants <span class="token keyword">from</span> those <span class="token keyword">with</span> no 
      effect <span class="token keyword">is</span> challenging<span class="token punctuation">,</span> particularly <span class="token keyword">for</span> deep intronic regions where independent 
      benchmarks are scarce<span class="token punctuation">.</span> RESULTS<span class="token punctuation">:</span> In this study<span class="token punctuation">,</span> we have provided an overview of 
      the computational methods available <span class="token keyword">and</span> the extent to which they can be used to 
      analyze deep intronic variation<span class="token punctuation">.</span> We leveraged diverse datasets to extensively 
      evaluate tool performance across different intronic regions<span class="token punctuation">,</span> distinguishing 
      between variants that are expected to disrupt splicing through different 
      molecular mechanisms<span class="token punctuation">.</span> Notably<span class="token punctuation">,</span> we compared the performance of SpliceAI<span class="token punctuation">,</span> a widely 
      used sequence<span class="token operator">-</span>based deep learning model<span class="token punctuation">,</span> <span class="token keyword">with</span> that of more recent methods that 
      extend its original implementation<span class="token punctuation">.</span> We observed considerable differences <span class="token keyword">in</span> tool 
      performance depending on the region considered<span class="token punctuation">,</span> <span class="token keyword">with</span> variants generating cryptic 
      splice sites being better predicted than those that potentially affect splicing 
      regulatory elements<span class="token punctuation">.</span> Finally<span class="token punctuation">,</span> we devised a novel quantitative assessment of tool 
      interpretability <span class="token keyword">and</span> found that tools providing mechanistic explanations of their 
      predictions are often correct <span class="token keyword">with</span> respect to the ground <span class="token operator">-</span> information<span class="token punctuation">,</span> but the 
      use of these tools results <span class="token keyword">in</span> decreased predictive power when compared to black 
      box methods<span class="token punctuation">.</span> CONCLUSIONS<span class="token punctuation">:</span> Our findings translate into practical recommendations 
      <span class="token keyword">for</span> tool usage <span class="token keyword">and</span> provide a reference framework <span class="token keyword">for</span> applying prediction tools <span class="token keyword">in</span> 
      deep intronic regions<span class="token punctuation">,</span> enabling more informed decision<span class="token operator">-</span>making by practitioners<span class="token punctuation">.</span>
CI  <span class="token operator">-</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> The Author<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token number">2023.</span> Published by Oxford University Press GigaScience<span class="token punctuation">.</span>
FAU <span class="token operator">-</span> Barbosa<span class="token punctuation">,</span> Pedro
AU  <span class="token operator">-</span> Barbosa P
AUID<span class="token operator">-</span> ORCID<span class="token punctuation">:</span> <span class="token number">0000</span><span class="token operator">-</span><span class="token number">0002</span><span class="token operator">-</span><span class="token number">3892</span><span class="token operator">-</span><span class="token number">7640</span>
</code></pre> 
<p>在进行尝试下载文献之前，构建两个函数便于批量爬取信息。<code>get_literature_id</code>和<code>get_detailed_info</code>分别获取文献的PMID以及详细信息。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_literature_id</span><span class="token punctuation">(</span>term<span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">:</span>
    API_KEY <span class="token operator">=</span> <span class="token string">"Your AIP KEY"</span>
    <span class="token comment"># pdat means published date, 2020[pdat] means publised literatures from 2020/01/01 to 2020/12/31</span>
    url_start <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>API_KEY<span class="token punctuation">}</span></span><span class="token string">&amp;term=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>term<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>year<span class="token punctuation">}</span></span><span class="token string">[pdat]'</span></span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_start<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment"># translate str to int</span>
    year_published_count <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    
    id_list <span class="token operator">=</span> <span class="token punctuation">[</span>_<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> info<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>year_published_count<span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url_page <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&amp;api_key=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>API_KEY<span class="token punctuation">}</span></span><span class="token string">&amp;term=pbmc+AND+single+cell+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>year<span class="token punctuation">}</span></span><span class="token string">[pdat]&amp;retmax=20&amp;retstart=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>page<span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        info_page <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_page<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
        id_list <span class="token operator">+=</span> <span class="token punctuation">[</span>_<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> info_page<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> id_list<span class="token punctuation">,</span> year_published_count

<span class="token keyword">def</span> <span class="token function">get_detailed_info</span><span class="token punctuation">(</span>id_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    API_KEY <span class="token operator">=</span> <span class="token string">"Your AIP KEY"</span>
    <span class="token comment"># PMID DOI PMCID Title Abstract Author_1st Affiliation_1st Journel Pulication_time</span>
    extracted_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> batch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>id_list<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        id_str <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>id_list<span class="token punctuation">[</span>batch<span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>batch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        detailed_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&amp;api_key=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>API_KEY<span class="token punctuation">}</span></span><span class="token string">&amp;id=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_str<span class="token punctuation">}</span></span><span class="token string">&amp;rettype=medline&amp;retmode=text'</span></span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        detailed_info <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>detailed_url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
        literature_as_line_list <span class="token operator">=</span> detailed_info<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\nPMID'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

        <span class="token keyword">for</span> literature <span class="token keyword">in</span> literature_as_line_list<span class="token punctuation">:</span>
            <span class="token comment"># PMID</span>
            pmid <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'- '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># DOI</span>
            <span class="token keyword">if</span> <span class="token string">'[doi]'</span> <span class="token keyword">in</span> literature<span class="token punctuation">:</span>
                doi <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'[doi]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                doi <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token comment"># PMCID</span>
            <span class="token keyword">if</span> <span class="token string">"PMC"</span> <span class="token keyword">in</span> literature<span class="token punctuation">:</span>
                pmcid <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'PMC -'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                pmcid <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token comment"># Title</span>
            title <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'\n[A-Z]{2,3}\s'</span><span class="token punctuation">,</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'TI  - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n      "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'\n'</span> <span class="token keyword">in</span> title<span class="token punctuation">:</span>
                title <span class="token operator">=</span> title<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n      "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token comment"># Abstract</span>
            abstract <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'AB  - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n      "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Author_1st</span>
            author <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'FAU - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Affiliation_1st</span>
            tmp_affiliation <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'FAU - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token string">"AD  - "</span> <span class="token keyword">in</span> tmp_affiliation<span class="token punctuation">:</span>
                affiliation <span class="token operator">=</span> tmp_affiliation<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'AD  - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n      "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                affiliation <span class="token operator">=</span> <span class="token string">""</span>

            <span class="token comment"># Journel</span>
            journel <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'TA  - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># Publication time</span>
            publication_time <span class="token operator">=</span> literature<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'SO  - '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token string">':'</span> <span class="token keyword">in</span> publication_time<span class="token punctuation">:</span>
                publication_time <span class="token operator">=</span> publication_time<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

            extracted_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>pmid<span class="token punctuation">,</span> doi<span class="token punctuation">,</span> pmcid<span class="token punctuation">,</span> title<span class="token punctuation">,</span> abstract<span class="token punctuation">,</span> author<span class="token punctuation">,</span> affiliation<span class="token punctuation">,</span> journel<span class="token punctuation">,</span> publication_time<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> extracted_info
</code></pre> 
<p>爬取的部分结果如下图所示。有些文章没有DOI号，不信的话可以尝试在PubMed中搜索该文章对应的PMID<code>33604555</code>看看~。<br> <img src="https://images2.imgbox.com/39/a1/13618Uvx_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="PDF_182"></a>二、下载文献PDF文件</h2> 
<p>关于下载文献的PDF文件，这里是从SciHub中爬取的，不是从期刊官方，部分文章可以没有被SciHub收录或者收录的预印版，因此，不能 保证上文中获取的信息就能从SciHub中全部下载成功。如果不能访问SciHub，自然就不能爬取对应的内容了，可以考虑买个VPN，科学上网~。</p> 
<p>爬取SciHub上的文章需要构建一个访问头的信息，不然回返回403禁止访问。然后将获取的内容保存为PDF格式即可。其中从SciHub中爬取文献PDF文件参考了 <a href="https://zyicu.cn/?p=7535" rel="nofollow">用Python批量下载文献</a><sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup></p> 
<pre><code class="prism language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'/mnt/c/Users/search_result.csv'</span><span class="token punctuation">)</span>
doi_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token operator">~</span>data<span class="token punctuation">[</span><span class="token string">'DOI'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
doi_list <span class="token operator">=</span> doi_data<span class="token punctuation">[</span><span class="token string">"DOI"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
pmid_list <span class="token operator">=</span> doi_data<span class="token punctuation">[</span><span class="token string">"PMID"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> doi<span class="token punctuation">,</span> pmid <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>doi_list<span class="token punctuation">,</span> pmid_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    download_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://sci.bban.top/pdf/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doi<span class="token punctuation">}</span></span><span class="token string">.pdf?#view=FitH'</span></span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"</span><span class="token punctuation">}</span>
    literature <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>download_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">if</span> literature<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"this paper may have not downloading permission, it's doi: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doi<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/mnt/c/Users/ouyangkang/Desktop/scraper_literature/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>pmid<span class="token punctuation">}</span></span><span class="token string">.pdf'</span></span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>literature<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre> 
<p>爬取结果如下图所示，成功下载了199篇~（这里的关键词不是机器学习，提供的doi数量是522，下载成功率为38%）。<br> <img src="https://images2.imgbox.com/ee/9f/BoInvdZC_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_206"></a>参考</h2> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://pubmed.ncbi.nlm.nih.gov/" rel="nofollow">.Pubmed official websity</a> <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn2" class="footnote-item"><p><a href="https://zyicu.cn/?p=7535" rel="nofollow">用Python批量下载文献</a> <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a></p> </li></ol> 
</section>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1f41af01b4ed8583b3917d8b748b9b5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为eNSP配置专题-路由策略的配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97d477b79053eca9055ba9da25d728d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Hyper-v 管理器虚拟机配置内网外网固定ip】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>