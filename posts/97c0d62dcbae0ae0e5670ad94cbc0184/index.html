<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shell mapfile命令（readarray命令）介绍（读取行到数组变量）（进程替换&#43;重定向＜ ＜()、()＞ ＞） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shell mapfile命令（readarray命令）介绍（读取行到数组变量）（进程替换&#43;重定向＜ ＜()、()＞ ＞）" />
<meta property="og:description" content="文章目录 shell mapfile命令（readarray命令）介绍`mapfile --help`英文中文 简单使用教程创建一个测试文件使用mapfile命令读取文件打印数组内容 各选项详解1. -d delim：使用DELIM来终止行，而不是换行原理示例 2. -n count：最多复制COUNT行。如果COUNT为0，所有行都被复制3. -O origin：从索引ORIGIN开始分配给ARRAY。默认索引是0解释示例 4. -s count：丢弃首先读取的COUNT行5. -t：从每一行读取中删除尾随的DELIM（默认为换行）6. -u fd：从文件描述符FD读取行，而不是标准输入7. -C callback：每读取QUANTUM行就评估一次CALLBACK解释示例 8. -c quantum：指定每次调用CALLBACK之间读取的行数 其他问题在管道操作中使用mapfile命令时，由于shell的子进程问题，mapfile无法改变父shell环境中的数组 shell mapfile命令（readarray命令）介绍 mapfile 或 readarray 是 Bash shell 中的一个内置命令，主要用于从标准输入或文件中读取行到数组变量中。
mapfile 和 readarray 是完全相同的命令。在 Bash shell 中，这两个命令是等效的，可以互换使用。
mapfile --help 英文 root@ky:/userdata/tmp# mapfile --help mapfile: mapfile [-d delim] [-n count] [-O origin] [-s count] [-t] [-u fd] [-C callback] [-c quantum] [array] Read lines from the standard input into an indexed array variable." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/97c0d62dcbae0ae0e5670ad94cbc0184/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T00:35:33+08:00" />
<meta property="article:modified_time" content="2024-01-12T00:35:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shell mapfile命令（readarray命令）介绍（读取行到数组变量）（进程替换&#43;重定向＜ ＜()、()＞ ＞）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#shell_mapfilereadarray_1" rel="nofollow">shell mapfile命令（readarray命令）介绍</a></li><li><a href="#mapfile_help_6" rel="nofollow">`mapfile --help`</a></li><li><ul><li><a href="#_7" rel="nofollow">英文</a></li><li><a href="#_46" rel="nofollow">中文</a></li></ul> 
  </li><li><a href="#_79" rel="nofollow">简单使用教程</a></li><li><ul><li><a href="#_80" rel="nofollow">创建一个测试文件</a></li><li><a href="#mapfile_93" rel="nofollow">使用mapfile命令读取文件</a></li><li><a href="#_103" rel="nofollow">打印数组内容</a></li></ul> 
  </li><li><a href="#_125" rel="nofollow">各选项详解</a></li><li><ul><li><a href="#1_d_delimDELIM_128" rel="nofollow">1. -d delim：使用DELIM来终止行，而不是换行</a></li><li><ul><li><a href="#_130" rel="nofollow">原理</a></li><li><a href="#_145" rel="nofollow">示例</a></li></ul> 
   </li><li><a href="#2_n_countCOUNTCOUNT0_161" rel="nofollow">2. -n count：最多复制COUNT行。如果COUNT为0，所有行都被复制</a></li><li><a href="#3_O_originORIGINARRAY0_173" rel="nofollow">3. -O origin：从索引ORIGIN开始分配给ARRAY。默认索引是0</a></li><li><ul><li><a href="#_174" rel="nofollow">解释</a></li><li><a href="#_182" rel="nofollow">示例</a></li></ul> 
   </li><li><a href="#4_s_countCOUNT_195" rel="nofollow">4. -s count：丢弃首先读取的COUNT行</a></li><li><a href="#5_tDELIM_207" rel="nofollow">5. -t：从每一行读取中删除尾随的DELIM（默认为换行）</a></li><li><a href="#6_u_fdFD_230" rel="nofollow">6. -u fd：从文件描述符FD读取行，而不是标准输入</a></li><li><a href="#7_C_callbackQUANTUMCALLBACK_258" rel="nofollow">7. -C callback：每读取QUANTUM行就评估一次CALLBACK</a></li><li><ul><li><a href="#_260" rel="nofollow">解释</a></li><li><a href="#_268" rel="nofollow">示例</a></li></ul> 
   </li><li><a href="#8_c_quantumCALLBACK_305" rel="nofollow">8. -c quantum：指定每次调用CALLBACK之间读取的行数</a></li></ul> 
  </li><li><a href="#_312" rel="nofollow">其他问题</a></li><li><ul><li><a href="#mapfileshellmapfileshell_313" rel="nofollow">在管道操作中使用mapfile命令时，由于shell的子进程问题，mapfile无法改变父shell环境中的数组</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="shell_mapfilereadarray_1"></a>shell mapfile命令（readarray命令）介绍</h2> 
<p><code>mapfile</code> 或 <code>readarray</code> 是 Bash shell 中的一个内置命令，主要用于从标准输入或文件中读取行到数组变量中。</p> 
<p><code>mapfile</code> 和 <code>readarray</code> 是完全相同的命令。在 Bash shell 中，这两个命令是等效的，可以互换使用。</p> 
<h2><a id="mapfile_help_6"></a><code>mapfile --help</code></h2> 
<h3><a id="_7"></a>英文</h3> 
<pre><code class="prism language-python">root@ky<span class="token punctuation">:</span><span class="token operator">/</span>userdata<span class="token operator">/</span>tmp<span class="token comment"># mapfile --help</span>
mapfile<span class="token punctuation">:</span> mapfile <span class="token punctuation">[</span><span class="token operator">-</span>d delim<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>n count<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>O origin<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>s count<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>t<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>u fd<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>C callback<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>c quantum<span class="token punctuation">]</span> <span class="token punctuation">[</span>array<span class="token punctuation">]</span>
    Read lines <span class="token keyword">from</span> the standard <span class="token builtin">input</span> into an indexed array variable<span class="token punctuation">.</span>

    Read lines <span class="token keyword">from</span> the standard <span class="token builtin">input</span> into the indexed array variable ARRAY<span class="token punctuation">,</span> <span class="token keyword">or</span>
    <span class="token keyword">from</span> <span class="token builtin">file</span> descriptor FD <span class="token keyword">if</span> the <span class="token operator">-</span>u option <span class="token keyword">is</span> supplied<span class="token punctuation">.</span>  The variable MAPFILE
    <span class="token keyword">is</span> the default ARRAY<span class="token punctuation">.</span>

    Options<span class="token punctuation">:</span>
      <span class="token operator">-</span>d delim  Use DELIM to terminate lines<span class="token punctuation">,</span> instead of newline
      <span class="token operator">-</span>n count  Copy at most COUNT lines<span class="token punctuation">.</span>  If COUNT <span class="token keyword">is</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">all</span> lines are copied
      <span class="token operator">-</span>O origin Begin assigning to ARRAY at index ORIGIN<span class="token punctuation">.</span>  The default index <span class="token keyword">is</span> <span class="token number">0</span>
      <span class="token operator">-</span>s count  Discard the first COUNT lines read
      <span class="token operator">-</span>t        Remove a trailing DELIM <span class="token keyword">from</span> each line read <span class="token punctuation">(</span>default newline<span class="token punctuation">)</span>
      <span class="token operator">-</span>u fd     Read lines <span class="token keyword">from</span> <span class="token builtin">file</span> descriptor FD instead of the standard <span class="token builtin">input</span>
      <span class="token operator">-</span>C callback       Evaluate CALLBACK each time QUANTUM lines are read
      <span class="token operator">-</span>c quantum        Specify the number of lines read between each call to
                        CALLBACK

    Arguments<span class="token punctuation">:</span>
      ARRAY     Array variable name to use <span class="token keyword">for</span> <span class="token builtin">file</span> data

    If <span class="token operator">-</span>C <span class="token keyword">is</span> supplied without <span class="token operator">-</span>c<span class="token punctuation">,</span> the default quantum <span class="token keyword">is</span> <span class="token number">5000.</span>  When
    CALLBACK <span class="token keyword">is</span> evaluated<span class="token punctuation">,</span> it <span class="token keyword">is</span> supplied the index of the <span class="token builtin">next</span> array
    element to be assigned <span class="token keyword">and</span> the line to be assigned to that element
    <span class="token keyword">as</span> additional arguments<span class="token punctuation">.</span>

    If <span class="token keyword">not</span> supplied <span class="token keyword">with</span> an explicit origin<span class="token punctuation">,</span> mapfile will clear ARRAY before
    assigning to it<span class="token punctuation">.</span>

    Exit Status<span class="token punctuation">:</span>
    Returns success unless an invalid option <span class="token keyword">is</span> given <span class="token keyword">or</span> ARRAY <span class="token keyword">is</span> readonly <span class="token keyword">or</span>
    <span class="token keyword">not</span> an indexed array<span class="token punctuation">.</span>

</code></pre> 
<h3><a id="_46"></a>中文</h3> 
<pre><code class="prism language-python">root@ubuntu<span class="token punctuation">:</span><span class="token operator">~</span><span class="token comment"># mapfile --help</span>
mapfile<span class="token punctuation">:</span> mapfile <span class="token punctuation">[</span><span class="token operator">-</span>d delim<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>n count<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>O origin<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>s count<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>t<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>u fd<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>C callback<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>c quantum<span class="token punctuation">]</span> <span class="token punctuation">[</span>array<span class="token punctuation">]</span>
    从标准输入读取行到索引数组变量。

    从标准输入读取行到索引数组变量ARRAY，或者
    如果提供了<span class="token operator">-</span>u选项，则从文件描述符FD读取。变量MAPFILE
    是默认的ARRAY。

    选项：
      <span class="token operator">-</span>d delim  使用DELIM终止行，而不是换行
      <span class="token operator">-</span>n count  最多复制COUNT行。如果COUNT为<span class="token number">0</span>，所有行都被复制
      <span class="token operator">-</span>O origin 从索引ORIGIN开始分配给ARRAY。默认索引是<span class="token number">0</span>
      <span class="token operator">-</span>s count  丢弃首先读取的COUNT行
      <span class="token operator">-</span>t        从每一行读取中删除尾随的DELIM（默认为换行）
      <span class="token operator">-</span>u fd     从文件描述符FD读取行，而不是标准输入
      <span class="token operator">-</span>C callback       每读取QUANTUM行就评估一次CALLBACK
      <span class="token operator">-</span>c quantum        指定每次调用CALLBACK之间读取的行数

    参数：
      ARRAY     用于存储文件数据的数组变量名

    如果没有提供<span class="token operator">-</span>c，<span class="token operator">-</span>C的默认量子为<span class="token number">5000</span>。当
    评估CALLBACK时，将提供下一个要分配的数组元素的索引
    和要分配给该元素的行作为额外的参数。

    如果没有提供显式的起始，mapfile会在分配给ARRAY之前清除它。

    退出状态：
    除非给出无效选项或ARRAY是只读的或者不是索引数组，否则返回成功。
</code></pre> 
<h2><a id="_79"></a>简单使用教程</h2> 
<h3><a id="_80"></a>创建一个测试文件</h3> 
<p>首先，我们创建一个文本文件，其中包含一些我们想要处理的数据。打开终端并输入以下内容：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>line3<span class="token entity" title="\n">\n</span>line4<span class="token entity" title="\n">\n</span>line5"</span> <span class="token operator">&gt;</span> test.txt
</code></pre> 
<p>这将在你的当前目录下创建一个名为test.txt的文件，并填充了5行数据。</p> 
<p><img src="https://images2.imgbox.com/05/7e/W3H5ElIE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="mapfile_93"></a>使用mapfile命令读取文件</h3> 
<p>然后，我们可以使用mapfile命令读取这个文件的内容并存储到一个数组中。在终端中输入：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> my_array <span class="token operator">&lt;</span> test.txt
</code></pre> 
<p>这里，<code>-t</code>选项用于删除每行的尾随换行符，<code>my_array</code>是我们的数组名称，<code>&lt; test.txt</code>表示从test.txt文件中读取数据。</p> 
<h3><a id="_103"></a>打印数组内容</h3> 
<p>现在，我们可以打印数组的内容来验证mapfile命令是否正常工作。在终端中输入：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<blockquote> 
 <ol><li> <p><code>printf</code>：这是一个在shell脚本中常用的命令，用于格式化并打印数据。它的功能和C语言中的printf函数类似。</p> </li><li> <p><code>"%s\n"</code>：这是printf命令的格式字符串。%s表示一个字符串，\n表示换行符。所以，这个格式字符串的意思是，对于每个参数，打印出该参数（视为字符串）并在其后添加一个换行符。</p> </li><li> <p><code>"${my_array[@]}"</code>：这是bash中获取数组所有元素的语法。my_array是数组名，[@]表示获取数组中的所有元素。${}是变量替换符，它告诉bash将my_array[@]替换为my_array数组中的所有元素。</p> </li></ol> 
 <p>综合起来，<code>printf "%s\n" "${my_array[@]}"</code>这条命令的作用是，按照每行一个的方式打印出my_array数组中的所有元素。</p> 
</blockquote> 
<p>你应该会看到test.txt文件中的每一行都被打印出来。</p> 
<p><img src="https://images2.imgbox.com/29/c9/hXpFiXSZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_125"></a>各选项详解</h2> 
<p>以下是mapfile命令中每个选项的使用示例：</p> 
<h3><a id="1_d_delimDELIM_128"></a>1. -d delim：使用DELIM来终止行，而不是换行</h3> 
<h4><a id="_130"></a>原理</h4> 
<p><code>-d delim</code>是mapfile命令的一个选项，其中delim是你自定义的终止符。默认情况下，mapfile会将每一行（由换行符’\n’分隔）读入数组。但是，如果你使用了<code>-d</code>选项，mapfile就会用你指定的delim作为行的结束符，而不是使用默认的换行符。</p> 
<p>举个例子，假设你有以下的字符串：</p> 
<pre><code class="prism language-py">a<span class="token punctuation">:</span>b<span class="token punctuation">:</span>c
</code></pre> 
<p>默认情况下，mapfile会将这整个字符串视为一个行，因为没有遇到换行符’\n’。但是，如果你执行<code>mapfile -d : my_array</code>，然后输入上述字符串，mapfile就会将’a’, ‘b’, ‘c’视为三行，因为此时它把’:'作为行的结束符。</p> 
<p>所以说，<code>-d delim</code>选项允许你改变mapfile识别行结束的方式。</p> 
<h4><a id="_145"></a>示例</h4> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-d</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-t</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"a:b:c<span class="token entity" title="\n">\n</span>d:e:f"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这将打印出：</p> 
<pre><code class="prism language-py">a
b
c
d
e
f
</code></pre> 
<p><img src="https://images2.imgbox.com/58/17/a1YuQDWA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_n_countCOUNTCOUNT0_161"></a>2. -n count：最多复制COUNT行。如果COUNT为0，所有行都被复制</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">2</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>line3"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这将打印出：</p> 
<pre><code class="prism language-py">line1
line2
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/50/kVWbo2SE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_O_originORIGINARRAY0_173"></a>3. -O origin：从索引ORIGIN开始分配给ARRAY。默认索引是0</h3> 
<h4><a id="_174"></a>解释</h4> 
<p><code>-O origin</code> 是mapfile命令的一个选项，用于指定数组索引的起始值。</p> 
<p>默认情况下，当你使用mapfile读取文件时，它会将文件的每一行存入到一个数组中，其中第一行对应数组的索引0，第二行对应索引1，依此类推。这就是默认索引是0的意思。</p> 
<p>然而，如果你使用 <code>-O origin</code> 选项，你可以改变这个默认行为。origin是一个数字，代表你想要数组的起始索引值。例如，如果你执行 <code>mapfile -O 3 -t my_array &lt; test.txt</code>，那么文件的第一行将会被存储在my_array[3]，第二行存储在my_array[4]，以此类推。</p> 
<p>换句话说，<code>-O origin</code> 允许你控制数据被存储到数组的哪个位置开始。</p> 
<h4><a id="_182"></a>示例</h4> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-O</span> <span class="token number">2</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>line3"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>3<span class="token punctuation">]</span>}</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>4<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这将打印出：</p> 
<pre><code class="prism language-py">line1
line2
line3
</code></pre> 
<p><img src="https://images2.imgbox.com/be/b9/XA7j5Q5o_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_s_countCOUNT_195"></a>4. -s count：丢弃首先读取的COUNT行</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-s</span> <span class="token number">1</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>line3"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这将打印出：</p> 
<pre><code>line2
line3
</code></pre> 
<p><img src="https://images2.imgbox.com/98/df/MRxxrrsW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_tDELIM_207"></a>5. -t：从每一行读取中删除尾随的DELIM（默认为换行）</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这将打印出：</p> 
<pre><code class="prism language-py">line1
line2

</code></pre> 
<p>如果不加<code>-t</code>参数，打印出的是：</p> 
<pre><code class="prism language-python">line1

line2



</code></pre> 
<p><img src="https://images2.imgbox.com/26/de/AgaEQuP7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_u_fdFD_230"></a>6. -u fd：从文件描述符FD读取行，而不是标准输入</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span> test.txt
<span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-u</span> <span class="token number">3</span> my_array
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<blockquote> 
 <p><code>exec 3&lt; test.txt</code> 是在Bash shell中创建并打开一个新的文件描述符（在这里是描述符3）并将其与特定文件（在这里是test.txt）关联起来的方法。</p> 
 <p>具体来说：</p> 
 <ul><li> <p><code>exec</code> 是一个bash内建命令，通常用于启动新的进程。然而，在这个上下文中，它被用来打开、关闭或复制文件描述符。</p> </li><li> <p><code>3</code> 是你选择的文件描述符号码。在Linux和Unix系统中，文件描述符0、1和2分别代表标准输入、标准输出和标准错误。数字3及以上可以被程序用来创建额外的文件描述符。</p> </li><li> <p><code>&lt;</code> 是输入重定向符号。它将文件内容导向某个位置（在这个例子中，是文件描述符3）。</p> </li><li> <p><code>test.txt</code> 是你想要读取的文件名。</p> </li></ul> 
 <p>因此，<code>exec 3&lt; test.txt</code>的效果是：打开文件test.txt，并将它与文件描述符3关联。之后，你可以使用这个文件描述符来读取文件内容。例如，你可以使用命令 <code>read -u 3 line</code> 来从文件描述符3（也就是test.txt文件）读取一行。</p> 
</blockquote> 
<p>这会从myfile.txt文件中读取行到my_array。</p> 
<p><img src="https://images2.imgbox.com/7a/78/giTNF0Gp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_C_callbackQUANTUMCALLBACK_258"></a>7. -C callback：每读取QUANTUM行就评估一次CALLBACK</h3> 
<h4><a id="_260"></a>解释</h4> 
<p><code>-C callback</code> 是mapfile命令的一个选项，它允许你在读取指定数量的行之后执行一个特定的回调函数。</p> 
<p>这里的callback是你定义的一个bash函数，而QUANTUM是一个数字，表示每读取多少行就执行一次这个函数。例如，如果你设置 <code>-C myfunc -c 5</code>，那么每当mapfile读取了5行数据后，就会执行myfunc这个函数。</p> 
<p>这个功能在处理大文件时非常有用，因为你可以定期处理数据，而不必等到所有数据都被读取完毕。例如，你可以使用回调函数来显示进度信息，或者将数据分批写入到另一个文件中。</p> 
<p>请注意，回调函数应该在使用mapfile之前定义，并且这个函数可以访问到两个变量：MAPFILE和MAPFILE_COUNT。MAPFILE是一个数组，包含已经被读取的行，而MAPFILE_COUNT表示已经读取的行数。</p> 
<h4><a id="_268"></a>示例</h4> 
<p>当然，下面是一个使用<code>-C callback</code>选项的完整示例：</p> 
<p>首先，我们创建一个名为<code>process_lines</code>的bash函数。这个函数将会在每读取到5行数据时被调用，并打印出已读取的行数和最后一行的内容。</p> 
<pre><code class="prism language-bash"><span class="token function-name function">process_lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">index</span><span class="token operator">=</span><span class="token variable">$1</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token variable">$2</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"已读取到第<span class="token variable">$index</span>行"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"该行内容: <span class="token variable">$line</span>"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后，我们创建一个测试文件并使用mapfile命令读取它：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"line1<span class="token entity" title="\n">\n</span>line2<span class="token entity" title="\n">\n</span>line3<span class="token entity" title="\n">\n</span>line4<span class="token entity" title="\n">\n</span>line5<span class="token entity" title="\n">\n</span>line6<span class="token entity" title="\n">\n</span>line7<span class="token entity" title="\n">\n</span>line8<span class="token entity" title="\n">\n</span>line9<span class="token entity" title="\n">\n</span>line10"</span> <span class="token operator">&gt;</span> test.txt
<span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-C</span> process_lines <span class="token parameter variable">-c</span> <span class="token number">5</span> my_array <span class="token operator">&lt;</span> test.txt
</code></pre> 
<p>在这个命令中，<code>-C process_lines</code>指定了回调函数，而<code>-c 5</code>指定了每读取5行就执行一次回调函数。</p> 
<p>如果你运行上述代码，你应该会看到以下的输出：</p> 
<pre><code class="prism language-py">已读取到第<span class="token number">4</span>行
该行内容<span class="token punctuation">:</span> line5
已读取到第<span class="token number">9</span>行
该行内容<span class="token punctuation">:</span> line10
</code></pre> 
<p>这就说明，在读取到第4行和第9行时，<code>process_lines</code>函数被成功地调用了。</p> 
<p><img src="https://images2.imgbox.com/73/63/XLqfWQLn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8_c_quantumCALLBACK_305"></a>8. -c quantum：指定每次调用CALLBACK之间读取的行数</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-C</span> callback <span class="token parameter variable">-c</span> <span class="token number">100</span> my_array <span class="token operator">&lt;</span> test.txt
</code></pre> 
<p>这将在读取myfile.txt的每100行后执行callback函数。</p> 
<h2><a id="_312"></a>其他问题</h2> 
<h3><a id="mapfileshellmapfileshell_313"></a>在管道操作中使用mapfile命令时，由于shell的子进程问题，mapfile无法改变父shell环境中的数组</h3> 
<p>如下两行命令：</p> 
<pre><code class="prism language-python">echo <span class="token operator">-</span>e <span class="token string">"a:b:c\nd:e:f"</span> <span class="token operator">|</span> mapfile <span class="token operator">-</span>d <span class="token punctuation">:</span> <span class="token operator">-</span>t my_array2
printf <span class="token string">"%s\n"</span> <span class="token string">"${my_array2[@]}"</span>
</code></pre> 
<p>执行后显示为空：</p> 
<p><img src="https://images2.imgbox.com/a1/2d/zA7H7nAw_o.png" alt="在这里插入图片描述"></p> 
<p>原因是在管道操作中使用mapfile命令时，由于shell的子进程问题，mapfile无法改变父shell环境中的数组。</p> 
<p>要解决这个问题，可以尝试避免使用管道，而是使用输入重定向(&lt;)将echo的结果传给mapfile，如下所示：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">mapfile</span> <span class="token parameter variable">-d</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-t</span> my_array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"a:b:c<span class="token entity" title="\n">\n</span>d:e:f"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre> 
<p>这里我们使用了一个叫做进程替代(process substitution)的特性，<code>&lt; &lt;(commands)</code>的形式会创建一个临时文件（或者在某些系统中是一个文件描述符），这个文件包含commands命令的输出，然后这个文件会被作为输入重定向到前面的命令中。</p> 
<p>这样应该能够得到预期的结果，即数组my_array包含"a", “b”, “c”, “d”, “e”, "f"这六个元素。</p> 
<p><img src="https://images2.imgbox.com/60/ae/SKPN550L_o.png" alt="在这里插入图片描述"></p> 
<p><a href="https://dontla.blog.csdn.net/article/details/124989038" rel="nofollow">参考文章：linux shell编程、bash编程、shell教程、bash教程、shell文档、bash文档、shell脚本、bash脚本【教程】第三章：特殊字符</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1cff15aa7a4a9a6454d9971849561ab8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java的helloworld、IDEA一些快捷键、导入模块</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6e19663e43b628b39432f2d6961e96b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【MongoDB 从入门到入神】全网最全通透篇之 MongoDB 概述及详细使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>