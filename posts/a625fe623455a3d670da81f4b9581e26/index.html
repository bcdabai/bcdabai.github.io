<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CC2530之定时器T3 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CC2530之定时器T3" />
<meta property="og:description" content="CC2530之定时器T3 在本次学习中，主要通过定时器T3周期性的控制LED的亮灭。
首先，先查看相关电路图。由图可知，当CC2530端口1的0号引脚输出低电平时，LED1将被点亮。 接下来，先查看与LED（P1_0）配置相关的寄存器。
端口1功能选择寄存器（P1SEL）。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为普通的I/O口，若设置为1，则将相关引脚设为外设I/O，默认值都为0。 端口1方向选择寄存器(P1DIR)。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为输入引脚，若设置为1，则将相关引脚设为输出引脚，默认值都为0。 端口1输入模式寄存器(P1INP)。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为上拉/下拉模式，若设置为1，则将相关引脚设为三态模式，其中P1_0和P1_1没有上拉/下拉功能，可以不用配置，默认值都为0。 再来看看与定时器T3相关的寄存器
定时器3的控制寄存器（T3CTL） bit7~bit5：设置分频值 bit7:5描述000分频值为1001分频值为2010分频值为4011分频值为8100分频值为16101分频值为32110分频值为64111分频值为128 bit4：定时器T3的启动/停止位。写1表示启动，写0表示停止 bit3：溢出中断掩码。写1表示打开溢出中断，写0表示关闭溢出中断。 bit2：清计数器。写1表示将计数器设置为0并初始化所有相关引脚。 bit1~bit0：设置计数器的计数模式。
bit1:0描述00自由计数，从0x0000计数到0xFFFF，不断重复计数01向下计数一次，由T3CC0计数到0，10模计数，从0x0000计数到T1CC0，不断重复计数11向上/向下计数，从0x0000计数到T1CC0再从T1CC0计数到0x0000,不断重复 定时器3通道0捕获/比较控制寄存器。 bit6：通道0中断掩码。写1表示使能中断，写0表示禁用中断。 bit5~bit3：通道0比较输出模式选择。 bit5:3描述000在比较中设置输出001在比较中清除输出010在比较中切换输出011在比较正计数时设置输出，在0时清除100在比较正计数时清除输出，在0时设置101在比较时设置输出，在0xFF时清除110在比较时清除输出，在0时设置111初始化输出引脚。 CMP[2:0]不变 bit2：定时器3通道0的模式。0表示捕获模式，1表示比较模式。 bit1~bit0：捕获模式选择
bit1:0描述00无捕获01在上升沿捕获10在下降沿捕获11在所有边沿都捕获 定时器3通道0捕获/比较值寄存器 当T3CCTL0.MODE=1（比较模式）时写该寄存器会导致T3CC0.VAL[7:0]更新到写入值延迟到T3CNT.CNT[7:0]=0x00 定时器1/3/4中断掩码/标志寄存器 bit1：定时器3通道0中断标志。0：无中断未决；1：中断未决 bit0：定时器3溢出中断标志。0：无中断未决；1：中断未决 中断标志4寄存器 bit3：定时器3中断标志，当中断发生时置为1，当CPU向量指向中断服务例程时置为0 中断使能寄存器1 bit3：定时器3中断使能。1：中断使能；0：中断失能。 中断使能寄存器0 bit7：总中断使能。 /*利用定时器3，间隔约0.5s将LED电平翻转一次*/ #include &lt;ioCC2530.h&gt; typedef unsigned char uchar; typedef unsigned int uint; #define LED1 P1_0 void LEDInit(void) { P1SEL &amp;= ~0x01; //普通IO P1DIR |= 0x01; //输出模式 } void TIM3Init(void) { T3CTL |= 0xE0; //128分频 T3CTL &amp;= ~0x03; //自由计数 T3CTL |= 0x08; //使能定时器3溢出中断 T3IE = 1; //定时器3中断使能,相当于IEN1 |= 0x08 T3CTL |= 0x10; //启动定时器3 EA = 1; //开启总中断,相当于IEN0 |= 0x80 } uint count; #pragma vector = T3_VECTOR __interrupt void T3_ISR(void) { IRCON = 0x00;//清中断标志，也可由硬件自动完成 /*产生245次中断后，LED发生翻转，时间间隔大概为 128*255*245/16000000 = 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a625fe623455a3d670da81f4b9581e26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-02-03T11:08:33+08:00" />
<meta property="article:modified_time" content="2018-02-03T11:08:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CC2530之定时器T3</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="cc2530之定时器t3"> 
 <center>
   CC2530之定时器T3 
 </center></h2> 
<p>在本次学习中，主要通过定时器T3周期性的控制LED的亮灭。</p> 
<p>首先，先查看相关电路图。由图可知，当CC2530端口1的0号引脚输出低电平时，LED1将被点亮。 <br> <img src="https://images2.imgbox.com/23/65/Gg8puuAi_o.jpg" alt="LED_Circuit.jpg" title=""></p> 
<p>接下来，先查看与LED（P1_0）配置相关的寄存器。</p> 
<ol><li><p>端口1功能选择寄存器（P1SEL）。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为普通的I/O口，若设置为1，则将相关引脚设为外设I/O，默认值都为0。 <br> <img src="https://images2.imgbox.com/bf/d7/JVBjtdAN_o.jpg" alt="P1SEL.jpg" title=""></p></li><li><p>端口1方向选择寄存器(P1DIR)。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为输入引脚，若设置为1，则将相关引脚设为输出引脚，默认值都为0。 <br> <img src="https://images2.imgbox.com/2b/de/bYFa9PA1_o.jpg" alt="P1DIR.jpg" title=""></p></li><li><p>端口1输入模式寄存器(P1INP)。这是一个8位的寄存器，对应端口1的8个引脚，将相应位设为0，表示将相应引脚设置为上拉/下拉模式，若设置为1，则将相关引脚设为三态模式，其中P1_0和P1_1没有上拉/下拉功能，可以不用配置，默认值都为0。 <br> <img src="https://images2.imgbox.com/f8/cd/oQHnjJP7_o.jpg" alt="P1INP.jpg" title=""> </p></li></ol> 
<p>再来看看与定时器T3相关的寄存器</p> 
<ol><li>定时器3的控制寄存器（T3CTL） <br> bit7~bit5：设置分频值</li></ol> 
<table><thead><tr><th>bit7:5</th><th>描述</th></tr></thead><tbody><tr><td>000</td><td>分频值为1</td></tr><tr><td>001</td><td>分频值为2</td></tr><tr><td>010</td><td>分频值为4</td></tr><tr><td>011</td><td>分频值为8</td></tr><tr><td>100</td><td>分频值为16</td></tr><tr><td>101</td><td>分频值为32</td></tr><tr><td>110</td><td>分频值为64</td></tr><tr><td>111</td><td>分频值为128</td></tr></tbody></table> 
<p>bit4：定时器T3的启动/停止位。写1表示启动，写0表示停止 <br> bit3：溢出中断掩码。写1表示打开溢出中断，写0表示关闭溢出中断。 <br> bit2：清计数器。写1表示将计数器设置为0并初始化所有相关引脚。 <br> bit1~bit0：设置计数器的计数模式。</p> 
<table><thead><tr><th>bit1:0</th><th>描述</th></tr></thead><tbody><tr><td>00</td><td>自由计数，从0x0000计数到0xFFFF，不断重复计数</td></tr><tr><td>01</td><td>向下计数一次，由T3CC0计数到0，</td></tr><tr><td>10</td><td>模计数，从0x0000计数到T1CC0，不断重复计数</td></tr><tr><td>11</td><td>向上/向下计数，从0x0000计数到T1CC0再从T1CC0计数到0x0000,不断重复</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/19/3f/GwauW5g8_o.jpg" alt="T3CTL.jpg" title=""></p> 
<ol><li>定时器3通道0捕获/比较控制寄存器。 <br> bit6：通道0中断掩码。写1表示使能中断，写0表示禁用中断。 <br> bit5~bit3：通道0比较输出模式选择。</li></ol> 
<table><thead><tr><th>bit5:3</th><th>描述</th></tr></thead><tbody><tr><td>000</td><td>在比较中设置输出</td></tr><tr><td>001</td><td>在比较中清除输出</td></tr><tr><td>010</td><td>在比较中切换输出</td></tr><tr><td>011</td><td>在比较正计数时设置输出，在0时清除</td></tr><tr><td>100</td><td>在比较正计数时清除输出，在0时设置</td></tr><tr><td>101</td><td>在比较时设置输出，在0xFF时清除</td></tr><tr><td>110</td><td>在比较时清除输出，在0时设置</td></tr><tr><td>111</td><td>初始化输出引脚。 CMP[2:0]不变</td></tr></tbody></table> 
<p>bit2：定时器3通道0的模式。0表示捕获模式，1表示比较模式。 <br> bit1~bit0：捕获模式选择</p> 
<table><thead><tr><th>bit1:0</th><th>描述</th></tr></thead><tbody><tr><td>00</td><td>无捕获</td></tr><tr><td>01</td><td>在上升沿捕获</td></tr><tr><td>10</td><td>在下降沿捕获</td></tr><tr><td>11</td><td>在所有边沿都捕获</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/b5/c0/meRiZ1WZ_o.jpg" alt="T3CCTL0.jpg" title=""></p> 
<ol><li><p>定时器3通道0捕获/比较值寄存器 <br> 当T3CCTL0.MODE=1（比较模式）时写该寄存器会导致T3CC0.VAL[7:0]更新到写入值延迟到T3CNT.CNT[7:0]=0x00 <br> <img src="https://images2.imgbox.com/12/4d/jvdIimLU_o.jpg" alt="T3CC0.jpg" title=""></p></li><li><p>定时器1/3/4中断掩码/标志寄存器 <br> bit1：定时器3通道0中断标志。0：无中断未决；1：中断未决 <br> bit0：定时器3溢出中断标志。0：无中断未决；1：中断未决 <br> <img src="https://images2.imgbox.com/fe/6a/qPEb44CA_o.jpg" alt="TIMIF.jpg" title=""></p></li><li><p>中断标志4寄存器 <br> bit3：定时器3中断标志，当中断发生时置为1，当CPU向量指向中断服务例程时置为0 <br> <img src="https://images2.imgbox.com/7e/0c/vNz680Sp_o.jpg" alt="(IRCON.jpg" title=""></p></li><li><p>中断使能寄存器1 <br> bit3：定时器3中断使能。1：中断使能；0：中断失能。 <br> <img src="https://images2.imgbox.com/a0/b8/GeQPCwOJ_o.jpg" alt="IEN1.jpg" title=""></p></li><li><p>中断使能寄存器0 <br> bit7：总中断使能。 <br> <img src="https://images2.imgbox.com/47/46/ASTjarxO_o.jpg" alt="IEN0.jpg" title=""></p></li></ol> 
<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-comment">/*利用定时器3，间隔约0.5s将LED电平翻转一次*/</span>
<span class="hljs-preprocessor">#include &lt;ioCC2530.h&gt;</span>

typedef unsigned <span class="hljs-keyword">char</span> <span class="hljs-keyword">uchar</span>;
typedef unsigned <span class="hljs-keyword">int</span> <span class="hljs-keyword">uint</span>;

<span class="hljs-preprocessor">#define LED1 P1_0</span>

<span class="hljs-keyword">void</span> LEDInit(<span class="hljs-keyword">void</span>)
{
  P1SEL &amp;= ~<span class="hljs-number">0x01</span>; <span class="hljs-comment">//普通IO</span>
  P1DIR |= <span class="hljs-number">0x01</span>;  <span class="hljs-comment">//输出模式</span>
}

<span class="hljs-keyword">void</span> TIM3Init(<span class="hljs-keyword">void</span>)
{
  T3CTL |= <span class="hljs-number">0xE0</span>; <span class="hljs-comment">//128分频</span>
  T3CTL &amp;= ~<span class="hljs-number">0x03</span>;  <span class="hljs-comment">//自由计数</span>
  T3CTL |= <span class="hljs-number">0x08</span>;  <span class="hljs-comment">//使能定时器3溢出中断</span>
  T3IE = <span class="hljs-number">1</span>;  <span class="hljs-comment">//定时器3中断使能,相当于IEN1 |= 0x08</span>
  T3CTL |= <span class="hljs-number">0x10</span>; <span class="hljs-comment">//启动定时器3</span>
 <span class="hljs-constant"> EA </span>= <span class="hljs-number">1</span>;  <span class="hljs-comment">//开启总中断,相当于IEN0 |= 0x80</span>
}

<span class="hljs-keyword">uint</span> count;
<span class="hljs-preprocessor">#pragma vector = T3_VECTOR</span>
__interrupt <span class="hljs-keyword">void</span> T3_ISR(<span class="hljs-keyword">void</span>)
{
 <span class="hljs-constant"> IRCON </span>= <span class="hljs-number">0x00</span>;<span class="hljs-comment">//清中断标志，也可由硬件自动完成</span>
   <span class="hljs-comment">/*产生245次中断后，LED发生翻转，时间间隔大概为
   128*255*245/16000000 = 0.5s
  */</span>
  if(count++ &gt; <span class="hljs-number">244</span>) 
  {                 
    count = <span class="hljs-number">0</span>;
    LED1 = !LED1;
  }
}

<span class="hljs-keyword">void</span> main(<span class="hljs-keyword">void</span>)
{
  LEDInit();
  TIM3Init();
  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);
}</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b824c38d64d05c12c82ead5a2cb2fe13/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IIS配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3907bcba131abc8651e32fcba939bef3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用ifconfig命令，只有lo，没有eth0</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>