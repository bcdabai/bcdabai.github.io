<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微服务-kubernetes安装 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微服务-kubernetes安装" />
<meta property="og:description" content="文章目录 一、前言二、kubernetes2.1、Kubernetes (K8S) 是什么2.1.1、主要特性：2.2.2、传统部署方式：2.2.3、虚拟机部署2.2.4容器部署2.2.5什么时候需要 Kubernetes2.2.6、Kubernetes 集群架构 三、kubernetes安装3.1、主节点需要组件3.1.1、设置对应主机名3.1.2、修改 hosts3.1.3、所有节点关闭 SELinux3.1.4、所有节点确保防火墙关闭 3.2、添加k8s安装源3.3、安装k8s需要的组件3.4、启动 kubelet、docker，并设置开机启动（所有节点）3.5、修改 docker 配置（所有节点）3.6、用 kubeadm 初始化集群（仅在主节点跑）3.7、安装网络插件，否则 node 是 NotReady 状态（主节点跑）3.8、把工作节点加入集群（只在工作节点跑） 一、前言 本文将详细介绍kubernetes安装流程。
二、kubernetes 2.1、Kubernetes (K8S) 是什么 它是一个为 容器化 应用提供集群部署和管理的开源工具，由 Google 开发。
Kubernetes 这个名字源于希腊语，意为“舵手”或“飞行员”。k8s 这个缩写是因为 k 和 s 之间有八个字符的关系。 Google 在 2014 年开源了 Kubernetes 项目
2.1.1、主要特性： 高可用，不宕机，自动灾难恢复
灰度更新，不影响业务正常运转
一键回滚到历史版本
方便的伸缩扩展（应用伸缩，机器加减）、提供负载均衡
有一个完善的生态
2.2.2、传统部署方式： 应用直接在物理机上部署，机器资源分配不好控制，出现Bug时，可能机器的大部分资源被某个应用占用，导致其他应用无法正常运行，无法做到应用隔离。
2.2.3、虚拟机部署 在单个物理机上运行多个虚拟机，每个虚拟机都是完整独立的系统，性能损耗大。
2.2.4容器部署 所有容器共享主机的系统，轻量级的虚拟机，性能损耗小，资源隔离，CPU和内存可按需分配
2.2.5什么时候需要 Kubernetes 当你的应用只是跑在一台机器，直接一个 docker &#43; docker-compose 就够了，方便轻松；
当你的应用需要跑在 3，4 台机器上，你依旧可以每台机器单独配置运行环境 &#43; 负载均衡器；
当你应用访问数不断增加，机器逐渐增加到十几台、上百台、上千台时，每次加机器、软件更新、版本回滚，都会变得非常麻烦、痛不欲生，再也不能好好的摸鱼了，人生浪费在那些没技术含量的重复性工作上。
这时候，Kubernetes 就可以一展身手了，让你轻松管理百万千万台机器的集群。“谈笑间，樯橹灰飞烟灭”，享受着一手掌控所有，年薪百万指日可待。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bc9740569149f7ce637e7101314cceb9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-04T20:12:48+08:00" />
<meta property="article:modified_time" content="2023-09-04T20:12:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微服务-kubernetes安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、前言</a></li><li><a href="#kubernetes_3" rel="nofollow">二、kubernetes</a></li><li><ul><li><a href="#21Kubernetes_K8S__4" rel="nofollow">2.1、Kubernetes (K8S) 是什么</a></li><li><ul><li><a href="#211_8" rel="nofollow">2.1.1、主要特性：</a></li><li><a href="#222_16" rel="nofollow">2.2.2、传统部署方式：</a></li><li><a href="#223_19" rel="nofollow">2.2.3、虚拟机部署</a></li><li><a href="#224_22" rel="nofollow">2.2.4容器部署</a></li><li><a href="#225_Kubernetes_25" rel="nofollow">2.2.5什么时候需要 Kubernetes</a></li><li><a href="#226Kubernetes__33" rel="nofollow">2.2.6、Kubernetes 集群架构</a></li></ul> 
  </li></ul> 
  </li><li><a href="#kubernetes_41" rel="nofollow">三、kubernetes安装</a></li><li><ul><li><a href="#31_42" rel="nofollow">3.1、主节点需要组件</a></li><li><ul><li><a href="#311_46" rel="nofollow">3.1.1、设置对应主机名</a></li><li><a href="#312_hosts_51" rel="nofollow">3.1.2、修改 hosts</a></li><li><a href="#313_SELinux_57" rel="nofollow">3.1.3、所有节点关闭 SELinux</a></li><li><a href="#314_62" rel="nofollow">3.1.4、所有节点确保防火墙关闭</a></li></ul> 
   </li><li><a href="#32k8s_67" rel="nofollow">3.2、添加k8s安装源</a></li><li><a href="#33k8s_80" rel="nofollow">3.3、安装k8s需要的组件</a></li><li><a href="#34_kubeletdocker_84" rel="nofollow">3.4、启动 kubelet、docker，并设置开机启动（所有节点）</a></li><li><a href="#35_docker__91" rel="nofollow">3.5、修改 docker 配置（所有节点）</a></li><li><a href="#36_kubeadm__107" rel="nofollow">3.6、用 kubeadm 初始化集群（仅在主节点跑）</a></li><li><a href="#37_node__NotReady__120" rel="nofollow">3.7、安装网络插件，否则 node 是 NotReady 状态（主节点跑）</a></li><li><a href="#38_129" rel="nofollow">3.8、把工作节点加入集群（只在工作节点跑）</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、前言</h2> 
<p>本文将详细介绍kubernetes安装流程。</p> 
<h2><a id="kubernetes_3"></a>二、kubernetes</h2> 
<h3><a id="21Kubernetes_K8S__4"></a>2.1、Kubernetes (K8S) 是什么</h3> 
<p>它是一个为 容器化 应用提供集群部署和管理的开源工具，由 Google 开发。<br> Kubernetes 这个名字源于希腊语，意为“舵手”或“飞行员”。k8s 这个缩写是因为 k 和 s 之间有八个字符的关系。 Google 在 2014 年开源了 Kubernetes 项目</p> 
<h4><a id="211_8"></a>2.1.1、主要特性：</h4> 
<p>高可用，不宕机，自动灾难恢复<br> 灰度更新，不影响业务正常运转<br> 一键回滚到历史版本<br> 方便的伸缩扩展（应用伸缩，机器加减）、提供负载均衡<br> 有一个完善的生态</p> 
<h4><a id="222_16"></a>2.2.2、传统部署方式：</h4> 
<p>应用直接在物理机上部署，机器资源分配不好控制，出现Bug时，可能机器的大部分资源被某个应用占用，导致其他应用无法正常运行，无法做到应用隔离。</p> 
<h4><a id="223_19"></a>2.2.3、虚拟机部署</h4> 
<p>在单个物理机上运行多个虚拟机，每个虚拟机都是完整独立的系统，性能损耗大。</p> 
<h4><a id="224_22"></a>2.2.4容器部署</h4> 
<p>所有容器共享主机的系统，轻量级的虚拟机，性能损耗小，资源隔离，CPU和内存可按需分配</p> 
<h4><a id="225_Kubernetes_25"></a>2.2.5什么时候需要 Kubernetes</h4> 
<p>当你的应用只是跑在一台机器，直接一个 docker + docker-compose 就够了，方便轻松；<br> 当你的应用需要跑在 3，4 台机器上，你依旧可以每台机器单独配置运行环境 + 负载均衡器；<br> 当你应用访问数不断增加，机器逐渐增加到十几台、上百台、上千台时，每次加机器、软件更新、版本回滚，都会变得非常麻烦、痛不欲生，再也不能好好的摸鱼了，人生浪费在那些没技术含量的重复性工作上。</p> 
<p>这时候，Kubernetes 就可以一展身手了，让你轻松管理百万千万台机器的集群。“谈笑间，樯橹灰飞烟灭”，享受着一手掌控所有，年薪百万指日可待。</p> 
<p>Kubernetes 可以为你提供集中式的管理集群机器和应用，加机器、版本升级、版本回滚，那都是一个命令就搞定的事，不停机的灰度更新，确保高可用、高性能、高扩展。</p> 
<h4><a id="226Kubernetes__33"></a>2.2.6、Kubernetes 集群架构</h4> 
<p><img src="https://images2.imgbox.com/49/53/nbnrd8DE_o.png" alt="在这里插入图片描述"><br> master<br> 主节点，控制平台，不需要很高性能，不跑任务，通常一个就行了，也可以开多个主节点来提高集群可用度。</p> 
<p>worker<br> 工作节点，可以是虚拟机或物理计算机，任务都在这里跑，机器性能需要好点；通常都有很多个，可以不断加机器扩大集群；每个工作节点由主节点管理</p> 
<h2><a id="kubernetes_41"></a>三、kubernetes安装</h2> 
<h3><a id="31_42"></a>3.1、主节点需要组件</h3> 
<p>● docker（也可以是其他容器运行时）Docker安装教程见：<a href="https://blog.csdn.net/wmj20001225/article/details/132634304?spm=1001.2014.3001.5501">docker安装</a><br> ● kubectl 集群命令行交互工具<br> ● kubeadm 集群初始化工具</p> 
<h4><a id="311_46"></a>3.1.1、设置对应主机名</h4> 
<pre><code class="prism language-sh"><span class="token comment">#设置对应主机名</span>
hostnamectl set-hostname master
</code></pre> 
<h4><a id="312_hosts_51"></a>3.1.2、修改 hosts</h4> 
<pre><code class="prism language-sh"><span class="token function">vi</span> /etc/hosts
<span class="token comment">#这里需要填入主机的ip地址，你的虚拟机ip是多少就写多少例如我这里是172.16.0.4</span>
<span class="token number">172.16</span>.0.4 master
</code></pre> 
<h4><a id="313_SELinux_57"></a>3.1.3、所有节点关闭 SELinux</h4> 
<pre><code class="prism language-sh">setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> --follow-symlinks <span class="token string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/sysconfig/selinux
</code></pre> 
<h4><a id="314_62"></a>3.1.4、所有节点确保防火墙关闭</h4> 
<pre><code class="prism language-sh">systemctl stop firewalld
systemctl disable firewalld
</code></pre> 
<h3><a id="32k8s_67"></a>3.2、添加k8s安装源</h3> 
<pre><code class="prism language-shell"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
<span class="token function">mv</span> kubernetes.repo /etc/yum.repos.d/
</code></pre> 
<h3><a id="33k8s_80"></a>3.3、安装k8s需要的组件</h3> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kubelet-1.22.4 kubectl-1.22.4 kubeadm-1.22.4
</code></pre> 
<h3><a id="34_kubeletdocker_84"></a>3.4、启动 kubelet、docker，并设置开机启动（所有节点）</h3> 
<pre><code class="prism language-shell">systemctl <span class="token builtin class-name">enable</span> kubelet
systemctl start kubelet
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
systemctl start <span class="token function">docker</span>
</code></pre> 
<h3><a id="35_docker__91"></a>3.5、修改 docker 配置（所有节点）</h3> 
<pre><code class="prism language-shell">
<span class="token comment"># kubernetes 官方推荐 docker 等使用 systemd 作为 cgroupdriver，否则 kubelet 启动不了</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> daemon.json</span>
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "registry-mirrors": ["https://ud6340vz.mirror.aliyuncs.com"]
}
EOF</span>
<span class="token function">mv</span> daemon.json /etc/docker/

<span class="token comment"># 重启生效</span>
systemctl daemon-reload
systemctl restart <span class="token function">docker</span>
</code></pre> 
<h3><a id="36_kubeadm__107"></a>3.6、用 kubeadm 初始化集群（仅在主节点跑）</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 初始化集群控制台 Control plane</span>
<span class="token comment"># 失败了可以用 kubeadm reset 重置</span>
kubeadm init --image-repository<span class="token operator">=</span>registry.aliyuncs.com/google_containers


<span class="token comment"># 复制授权文件，以便 kubectl 可以有权限访问集群</span>
<span class="token comment"># 如果你其他节点需要访问集群，需要从主节点复制这个文件过去其他节点(不创建授权文件会报错)</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
<span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre> 
<h3><a id="37_node__NotReady__120"></a>3.7、安装网络插件，否则 node 是 NotReady 状态（主节点跑）</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 很有可能国内网络访问不到这个资源，你可以网上找找国内的源安装 flannel</span>
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre> 
<p>查看是否安装成功</p> 
<p><img src="https://images2.imgbox.com/d8/de/8VqFvQXU_o.png" alt="在这里插入图片描述"><br> master节点为ready状态即为安装成功；</p> 
<h3><a id="38_129"></a>3.8、把工作节点加入集群（只在工作节点跑）</h3> 
<pre><code class="prism language-shell">kubeadm <span class="token function">join</span> <span class="token number">172.16</span>.32.10:6443 <span class="token parameter variable">--token</span> xxx --discovery-token-ca-cert-hash xxx
</code></pre> 
<p>安装网络插件，否则 node 是 NotReady 状态（主节点跑）</p> 
<pre><code class="prism language-shell"><span class="token comment"># 很有可能国内网络访问不到这个资源，你可以网上找找国内的源安装 flannel</span>
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

<span class="token comment"># 如果上面的插件安装失败，可以选用 Weave，下面的命令二选一就可以了。</span>
kubectl apply <span class="token parameter variable">-f</span> https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml
kubectl apply <span class="token parameter variable">-f</span> http://static.corecore.cn/weave.v2.8.1.yaml

<span class="token comment"># 更多其他网路插件查看下面介绍，自行网上找 yaml 安装</span>
https://blog.csdn.net/ChaITSimpleLove/article/details/117809007
</code></pre> 
<p>查看节点，要在主节点查看（其他节点有安装 kubectl 也可以查看）<br> <img src="https://images2.imgbox.com/7e/4e/X1nxsAHc_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34e2243e09d05eff5f11571d2e5a7e4f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android蓝牙bt/ble开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa998983b1cfa1ce89c59c46f4a3eeca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nginx使用详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>