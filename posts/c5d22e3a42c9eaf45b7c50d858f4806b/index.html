<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一文让你彻底搞懂Mybatis之缓存机制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一文让你彻底搞懂Mybatis之缓存机制" />
<meta property="og:description" content="编译软件：IntelliJ IDEA 2019.2.4 x64
操作系统：win10 x64 位 家庭版
Maven版本：apache-maven-3.6.3
Mybatis版本：3.5.6
文章目录 一. 缓存是什么？二. 为什么要使用缓存？三. Mybatis中的缓存分哪几种？3.1 Mybatis缓存机制之一级缓存3.2 Mybatis缓存机制之二级缓存3.3 Mybatis中缓存机制之第三方缓存【以EhCache为例】 一. 缓存是什么？ 一说到缓存，我们可能都会想到Cashe，这里摘自百度百科对它的解释：它原本是指访问速度比一般随机存取存储器（RAM）快的一种高速存储器，通常它不像系统主存那样使用DRAM技术，而使用昂贵但较快速的SRAM技术。缓存的设置是所有现代计算机系统发挥高性能的重要因素之一。它的工作原理是当CPU要读取一个数据时，首先从CPU缓存中查找，找到就立即读取并送给CPU处理；没有找到，就从速率相对较慢的内存中读取并送给CPU处理，同时把这个数据所在的数据块调入缓存中，可以使得以后对整块数据的读取都从缓存中进行，不必再调用内存。
以上部分内容可能看不懂，没关系，你只需要知道正是由于这样的读取机制，使得CPU读取缓存的命中率非常高（大多数CPU可达90%左右），也就是说CPU下一次要读取的数据90%都在CPU缓存中，只有大约10%需要从内存读取。这样大大节省了CPU直接读取内存的时间，非常快捷！！！
简而言之，以cpu中的缓存举例，缓存其实就是数据交换的缓冲区【又称Cashe】，是存贮数据（使用频繁的数据）的临时地方。当用户查询数据，首先在缓存中寻找，如果找到了则直接执行。如果找不到，则去数据库中查找。
二. 为什么要使用缓存？ 举个生活中的例子，当我们在线观看视频时，以哔哩哔哩网站为例，你会发现，底下的进度条会实时显示蓝色，白色等两种颜色。不难发现，蓝色代表的是视频实际播放的进度，而白色代表的是视频实时预先缓存的进度。如下所示。
这种让用户一边下载一边观看、收听，而不要等整个文件下载到自己的计算机上才可以观看的网络传输技术，就是鼎鼎大名的流媒体技术。该技术的原理是先在使用者端的计算机上创建一个缓冲区，在播放前预先下一段数据作为缓冲，在网路实际连线速度小于播放所耗的速度时，播放程序就会取用一小段缓冲区内的数据，这样可以避免播放的中断，也使得播放品质得以保证。该技术在很多音频影视网站上被大量使用，旨在丰富用户的使用体验并提高音频的播放性能。
而程序中的缓存【Mybatis缓存】，亦是如此，Mybatis使用缓存优势可以提高查询效率，并降低服务器的压力。它的本质就是用利用空间换时间，牺牲数据的实时性，以服务器内存中的数据暂时代替从数据库读取最新的数据，减少数据库IO，减轻服务器压力，减少网络延迟，加快页面打开速度。
三. Mybatis中的缓存分哪几种？ 👉分类
一级缓存二级缓存第三方缓存 3.1 Mybatis缓存机制之一级缓存 👉概述
一级缓存【本地缓存(Local Cache)或SqlSessiona级别缓存】
🤔什么是SqlSessiona？
SqlSession是一个会话，相当于JDBC中的一个Connection对象，是整个Mybatis运行的核心，它是MyBatis的关键对象，是执行持久化操作的独享，类似于JDBC中的Connection。它是应用程序与持久层之间执行交互操作的一个单线程对象，也是MyBatis的核心接口之一
👉特点
一级缓存默认开启不能关闭可以清空 💡 ：有点类似于使用腾讯视频网站去看电影，电影观看进度条前的那一小段灰色的进度条
👉缓存原理
第一次获取数据时，先从数据库中加载数据，将数据缓存至Mybatis一级缓存中【缓存底层实现原理Map,key:hashCode&#43;查询的Sqlld&#43;编写的sal查询语句&#43;参数】以后再次获取数据时，先从一级缓存中获取，如未获取到数据，再从数据库中获取数据 不信？请看如下测试代码的体现
代码示例如下：
@Test public void test04(){ try { String resource = &#34;mybatis-config.xml&#34;; InputStream inputStream = Resources.getResourceAsStream(resource); SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //通过SqlSessionFactory对象调用openSession(); SqlSession sqlSession = sqlSessionFactory." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c5d22e3a42c9eaf45b7c50d858f4806b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-28T18:44:03+08:00" />
<meta property="article:modified_time" content="2023-07-28T18:44:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一文让你彻底搞懂Mybatis之缓存机制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>编译软件：IntelliJ IDEA 2019.2.4 x64<br> 操作系统：win10 x64 位 家庭版<br> Maven版本：apache-maven-3.6.3<br> Mybatis版本：3.5.6</p> 
</blockquote> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#__12" rel="nofollow">一. 缓存是什么？</a></li><li><a href="#___26" rel="nofollow">二. 为什么要使用缓存？</a></li><li><a href="#__Mybatis_38" rel="nofollow">三. Mybatis中的缓存分哪几种？</a></li><li><ul><li><a href="#31_Mybatis_52" rel="nofollow">3.1 Mybatis缓存机制之一级缓存</a></li><li><a href="#32_Mybatis_134" rel="nofollow">3.2 Mybatis缓存机制之二级缓存</a></li><li><a href="#33_MybatisEhCache_330" rel="nofollow">3.3 Mybatis中缓存机制之第三方缓存【以EhCache为例】</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="__12"></a>一. 缓存是什么？</h2> 
<p>一说到缓存，我们可能都会想到<strong>Cashe</strong>，这里摘自百度百科对它的解释：它原本是指访问速度比一般随机存取存储器（RAM）快的一种高速存储器，通常它不像系统主存那样使用DRAM技术，而使用昂贵但较快速的SRAM技术。缓存的设置是所有现代计算机系统发挥高性能的重要因素之一。它的工作原理是<strong>当CPU要读取一个数据时，首先从CPU缓存中查找，找到就立即读取并送给CPU处理；没有找到，就从速率相对较慢的内存中读取并送给CPU处理，同时把这个数据所在的数据块调入缓存中，可以使得以后对整块数据的读取都从缓存中进行，不必再调用内存。</strong></p> 
<p><img src="https://images2.imgbox.com/f6/f4/rccOlWks_o.jpg" alt="在这里插入图片描述"><br> 以上部分内容可能看不懂，没关系，你只需要知道正是由于这样的读取机制，使得CPU读取缓存的命中率非常高（大多数CPU可达90%左右），也就是说CPU下一次要读取的数据90%都在CPU缓存中，只有大约10%需要从内存读取。<strong>这样大大节省了CPU直接读取内存的时间</strong>，非常快捷！！！</p> 
<p><img src="https://images2.imgbox.com/e4/fd/G9F8BI2N_o.png" alt="在这里插入图片描述"></p> 
<p>简而言之，以cpu中的缓存举例，<strong>缓存其实就是数据交换的缓冲区【又称Cashe】，是存贮数据（使用频繁的数据）的临时地方。当用户查询数据，首先在缓存中寻找，如果找到了则直接执行。如果找不到，则去数据库中查找</strong>。</p> 
<hr> 
<h2><a id="___26"></a>二. 为什么要使用缓存？</h2> 
<p>举个生活中的例子，当我们在线观看视频时，以哔哩哔哩网站为例，你会发现，底下的进度条会实时显示蓝色，白色等两种颜色。不难发现，蓝色代表的是视频实际播放的进度，而白色代表的是视频实时预先缓存的进度。如下所示。</p> 
<p><img src="https://images2.imgbox.com/3c/8a/W1ryrJk9_o.png" alt="在这里插入图片描述"><br> 这种<strong>让用户一边下载一边观看、收听，而不要等整个文件下载到自己的计算机上才可以观看的网络传输技术</strong>，就是鼎鼎大名的<strong>流媒体技术</strong>。该技术的原理是先在使用者端的计算机上创建一个<strong>缓冲区</strong>，在播放前预先下一段数据作为<strong>缓冲</strong>，在网路实际连线速度小于播放所耗的速度时，播放程序就会取用一小段缓冲区内的数据，这样可以<strong>避免播放的中断，也使得播放品质得以保证</strong>。该技术在很多音频影视网站上被大量使用，旨在丰富用户的使用体验并提高音频的播放性能。<br> <img src="https://images2.imgbox.com/54/b1/A4dyasQe_o.png" alt="在这里插入图片描述"><br> 而程序中的缓存【Mybatis缓存】，亦是如此，Mybatis使用缓存优势可以<strong>提高查询效率，并降低服务器的压力。<strong>它的本质就是用</strong>利用空间换时间，牺牲数据的实时性，以服务器内存中的数据暂时代替从数据库读取最新的数据，减少数据库IO，减轻服务器压力，减少网络延迟，加快页面打开速度。</strong></p> 
<hr> 
<h2><a id="__Mybatis_38"></a>三. Mybatis中的缓存分哪几种？</h2> 
<p>👉分类</p> 
<ol><li><strong>一级缓存</strong></li><li><strong>二级缓存</strong></li><li><strong>第三方缓存</strong></li></ol> 
<p><img src="https://images2.imgbox.com/51/1b/wsBIIK9A_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31_Mybatis_52"></a>3.1 Mybatis缓存机制之一级缓存</h3> 
<p>👉概述</p> 
<blockquote> 
 <p>一级缓存【本地缓存(Local Cache)或SqlSessiona级别缓存】</p> 
</blockquote> 
<p>🤔什么是SqlSessiona？</p> 
<blockquote> 
 <p>SqlSession是一个<strong>会话</strong>，相当于JDBC中的一个Connection对象，是整个Mybatis运行的核心，它是MyBatis的关键对象，是执行持久化操作的独享，类似于JDBC中的Connection。它是应用程序与持久层之间执行交互操作的一个单线程对象，也是MyBatis的核心接口之一</p> 
</blockquote> 
<p>👉特点</p> 
<ul><li><strong>一级缓存默认开启</strong></li><li><strong>不能关闭</strong></li><li><strong>可以清空</strong></li></ul> 
<blockquote> 
 <p>💡 ：有点类似于使用腾讯视频网站去看电影，电影观看进度条前的那一小段灰色的进度条</p> 
</blockquote> 
<p>👉缓存原理</p> 
<ol><li><strong><code>第一次获取数据时，先从数据库中加载数据，将数据缓存至Mybatis一级缓存中【缓存底层实现原理Map,key:hashCode+查询的Sqlld+编写的sal查询语句+参数】</code></strong></li><li><strong><code>以后再次获取数据时，先从一级缓存中获取，如未获取到数据，再从数据库中获取数据</code></strong></li></ol> 
<p>不信？请看如下测试代码的体现</p> 
<p>代码示例如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过SqlSessionFactory对象调用openSession();</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取EmployeeMapper的代理对象</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第二次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees1 <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees1<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/00/0f/rfgf3OOQ_o.png" alt="在这里插入图片描述"></p> 
<p>👉<strong>一级缓存的五种失效情况</strong></p> 
<ol><li> <p><code>不同的SqlSession对应不同的一级缓存</code></p> </li><li> <p><code>同一个SqlSession但是查间条件不同</code></p> </li><li> <p><code>同一个SqlSession两次查询期间执行了任何一次增删改操作</code></p> <p><strong>执行任何一次的增删改操作会默认清空一级缓存</strong></p> </li><li> <p><code>同一个SqlSession两次查询期间手动清空了缓存</code></p> <p>如何手动清空一级缓存？</p> <pre><code class="prism language-java">sqlSession<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><code>同一个SqlSessioni两次查询期间提交了事务</code></p> <pre><code class="prism language-java">sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h3><a id="32_Mybatis_134"></a>3.2 Mybatis缓存机制之二级缓存</h3> 
<p>👉概述</p> 
<blockquote> 
 <p>二级缓存【全局作用域缓存】是SqlSessionFactory级别的缓存</p> 
</blockquote> 
<p>👉特点</p> 
<ul><li> <p><strong>二级缓存默认关闭，需要开启才能使用</strong></p> </li><li> <p><strong>二级缓存需要提交sqlSession或关闭sqlSessionl时，才会缓存。</strong></p> </li></ul> 
<p>👉二级缓存使用的步骤</p> 
<p>①全局配置文件中开启二级缓存“&lt;setting name="cacheEnab1ed"value=“true”/&gt;”</p> 
<p>②需要使用二级缓存的<strong>映射文件处</strong>使用cache配置缓存</p> 
<p>③注意：POJO（Java Bean【java的实体类】）需要实现Serializable接口</p> 
<p>④关闭sqlSession或提交sqlSessionl时，将数据缓存到二级缓存</p> 
<p>👉用法案例</p> 
<blockquote> 
 <p>演示二级缓存的效果</p> 
</blockquote> 
<p>代码示例如下：</p> 
<p>①全局配置文件中开启二级缓存</p> 
<p><img src="https://images2.imgbox.com/fd/d6/kkvy432c_o.png" alt="在这里插入图片描述"></p> 
<p>②这里假设映射文件EmployeeMapper.xml使用cache配置缓存</p> 
<p><img src="https://images2.imgbox.com/ec/70/rsgU6AM4_o.png" alt="在这里插入图片描述"></p> 
<p>③在映射文件EmployeeMapper.xml对应的pojo类实现Serializable接口</p> 
<p><img src="https://images2.imgbox.com/80/1b/EHR7ZZtN_o.png" alt="在这里插入图片描述"></p> 
<p>④测试</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过SqlSessionFactory对象调用openSession()获取sqlSession对象;</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过sqlSession对象调用getMapper(EmployeeMapper.class)以获取EmployeeMapper的代理对象</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭sqlsession，目的是为了将数据加载到二级缓存中</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//重新获取sqlsession对象</span>
        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span>sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用sqlsession对象调用etMapper(EmployeeMapper.class)获取EmployeeMapper接口的代理对象mapper</span>
        <span class="token class-name">EmployeeMapper</span> mapper <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees1 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees1<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/65/pDMq99xQ_o.png" alt="在这里插入图片描述"></p> 
<p>👉底层原理</p> 
<ol><li><strong><code>第一次获取数据时，先从数据库中获取数据，将数据缓存至一级缓存；当提交或关闭SqlSessionl时，将数据缓存至二级缓存</code></strong></li><li><strong><code>以后再次获取数据时，先从一级缓存中获取数据，如果一级缓存没有指定数据，再去二级缓存中获取数据。如果二级缓存也没有指定数据时，需要去数据库中获取数据</code></strong></li></ol> 
<p>👉二级缓存相关属性（在设置了cash的映射文件中设置以下属性）</p> 
<ul><li> <p><code>eviction=“FIFO"</code>：<strong>缓存清除【回收】策略</strong></p> 
  <ul><li><code>LU-最近最少使用的</code>：<strong>移除最长时间不被使用的对象</strong></li><li><code>FFO-先进先出</code>：<strong>按对象进入缓存的顺序来移除它们</strong></li></ul> </li><li> <p><code>flushlnterval</code>：<strong>刷新间隔，单位毫秒，默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句时刷新</strong></p> </li><li> <p><code>size</code>：<strong>引用数目，正整数，代表缓存最多可以存储多少个对象，太大容易导致内存益出</strong></p> </li><li> <p><code>readOnly</code>：<strong>只读，true/false</strong></p> 
  <ul><li><code>true</code>：<strong>只读缓存；会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势</strong></li><li><code>false</code>：<strong>读写缓存；会返回缓存对象的拷贝(通过序列化)。这会慢一些，但是安全，因此默认是false</strong></li></ul> </li></ul> 
<p>👉二级缓存的失效情况</p> 
<p><strong>①<code>在两次查询之间，执行增删改操作，会同时清空一级缓存和二级缓存</code></strong></p> 
<p><strong>②<code>sqlSession.clearCache()只是用来清除一级缓存</code></strong></p> 
<p>🤔思考</p> 
<blockquote> 
 <p>执行两次查询操作（查询条件相同且查询语句相同），中间使用sqlsession.clearCache()，然后关闭第一个sqlsession对象，又新建一个sqlsession对象，执行第二次查询，是否会导致二级缓存失效？</p> 
</blockquote> 
<p>我的推测： <strong>会失效</strong></p> 
<p>测试代码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test05</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过SqlSessionFactory对象调用openSession()获取sqlSession对象;</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过sqlSession对象调用getMapper(EmployeeMapper.class)以获取EmployeeMapper的代理对象</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//清空一级缓存</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//需要先关闭sqlsession对象，以缓存数据到二级缓存</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//重新获取sqlsession对象</span>
        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用sqlsession对象调用etMapper(EmployeeMapper.class)获取EmployeeMapper接口的代理对象mapper</span>
        <span class="token class-name">EmployeeMapper</span> mapper <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">/* //在两个查询之间执行一次更新操作，目的是为了清空二级缓存
        Employee e = new Employee();
        e.setId(1);
        e.setSalary(25000.0);
        mapper.updateEmp(e);*/</span>

        <span class="token comment">//调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees1 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees1<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/b0/afzEQ0Ff_o.png" alt="在这里插入图片描述"></p> 
<p><strong>推测错了，二级缓存仍然可以命中该查询结果</strong></p> 
<p>⭐原因分析</p> 
<p>当第一次执行某个 SQL 语句时，该 SQL 语句的缓存条目会被添加到二级缓存中；而在清空当前 SqlSession 对象的一级缓存时，并没有清空对应的 SQL 语句在二级缓存中的缓存条目，因此该 SQL 语句的缓存条目仍然存在于二级缓存中，即使这个二级缓存还没有和数据库同步。</p> 
<p>当新建另一个 SqlSession 对象，执行相同的查询操作且查询条件和前一次查询操作相同时，MyBatis 将会先从一级缓存中尝试获取数据。由于已经执行了 <code>sqlsession.clearCache()</code> 清空了当前 SqlSession 的一级缓存，因此一级缓存会命中失败，但是 MyBatis 可以从二级缓存中获取到之前查询过的结果集，返回给我当前的查询操作结果。</p> 
<h3><a id="33_MybatisEhCache_330"></a>3.3 Mybatis中缓存机制之第三方缓存【以EhCache为例】</h3> 
<p>👉概述</p> 
<blockquote> 
 <p>EhCache【第三方缓存】是一个纯ava的进程内缓存框架</p> 
</blockquote> 
<p>👉使用步骤</p> 
<blockquote> 
 <p>①导入jar包</p> 
</blockquote> 
<p>代码示例如下：</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 导入ehcache的jar包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.caches<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span>
<span class="token comment">&lt;!-- 导入一个日志的jar包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>②编写ehcache的配置文件（resources目录下）【ehcache.xml】</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/15/fa/V1gEZ88M_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../config/ehcache.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 磁盘保存路径 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>E:\mybatis\ehcache<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>
            <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>512<span class="token punctuation">"</span></span>
            <span class="token attr-name">maxElementsOnDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000000<span class="token punctuation">"</span></span>
            <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
            <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">diskExpiryThreadIntervalSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>③加载第三方缓存【映射文件】</p> 
</blockquote> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--  此处加载第三方缓存ehcache  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.caches.ehcache.EhcacheCache<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>④开始使用</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过SqlSessionFactory对象调用openSession()获取sqlSession对象;</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过sqlSession对象调用getMapper(EmployeeMapper.class)以获取EmployeeMapper的代理对象</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭sqlsession，目的是为了将数据加载到二级缓存中</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//重新获取sqlsession对象</span>
        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span>sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用sqlsession对象调用etMapper(EmployeeMapper.class)获取EmployeeMapper接口的代理对象mapper</span>
        <span class="token class-name">EmployeeMapper</span> mapper <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees1 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees1<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1c/ba/vGKvonfX_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/24/9f/TMMVFLC3_o.png" alt="在这里插入图片描述"></p> 
<p>❗注意</p> 
<p>①第三方缓存，<strong>需要建立在二级缓存基础上</strong>【需要开启二级缓存，第三方缓存才能生效】</p> 
<p>②如何让第三方缓存失效？</p> 
<p><strong>将二级缓存设置失效即可</strong>【在两次查询之间，进行一次增删改操作以清除二级缓存】</p> 
<p>代码示例如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过SqlSessionFactory对象调用openSession()获取sqlSession对象;</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//通过sqlSession对象调用getMapper(EmployeeMapper.class)以获取EmployeeMapper的代理对象</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一次调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭sqlsession，目的是为了将数据加载到二级缓存中</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//重新获取sqlsession对象</span>
        <span class="token class-name">SqlSession</span> sqlSession1 <span class="token operator">=</span>sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用sqlsession对象调用etMapper(EmployeeMapper.class)获取EmployeeMapper接口的代理对象mapper</span>
        <span class="token class-name">EmployeeMapper</span> mapper <span class="token operator">=</span> sqlSession1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//在两个查询操作之间执行一次更新操作，目的是为了清空二级缓存</span>
        <span class="token class-name">Employee</span> e<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">setSalary</span><span class="token punctuation">(</span><span class="token number">25000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">updateEmp</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用selectEmpByOneOpr(1);</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees1 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectEmpByOneOpr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employees1<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/7a/CrRfMCCs_o.png" alt="在这里插入图片描述"></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a951fd63cf40c54db444583f83a6b443/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【JVM】详细解析java创建对象的具体流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd639538e4b41d9beaa5f18d3e7fbe13/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决wandb: Network error (ReadTimeout), entering retry loop.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>