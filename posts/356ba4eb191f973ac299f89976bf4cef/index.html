<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>è‹ç©¹å¤–å–-day10 - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="è‹ç©¹å¤–å–-day10" />
<meta property="og:description" content="è‹ç©¹å¤–å–-day10 æœ¬é¡¹ç›®å­¦è‡ªé»‘é©¬ç¨‹åºå‘˜çš„ã€Šè‹ç©¹å¤–å–ã€‹é¡¹ç›®ï¼Œæ˜¯ç‘å‰å¤–å–çš„Plusç‰ˆæœ¬
åŠŸèƒ½æ›´å¤šï¼Œæ›´åŠ ä¸°å¯Œã€‚
ç»“åˆèµ„æ–™ï¼Œå’Œè‡ªå·±å¯¹å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›çœ‹æ³•å’Œé—®é¢˜è§£å†³æƒ…å†µä¸Šä¼ è¯¾ä»¶ç¬”è®°
è§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1TP411v7v6/?spm_id_from=333.337.search-card.all.click
èµ„æ–™ï¼šå…³æ³¨é»‘é©¬ç¨‹åºå‘˜å…¬ä¼—å·----&gt;å›å¤ï¼šè‹ç©¹å¤–å–
ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·åŠ æ²¹
ã€å¯ä»¥ä½¿ç”¨ApiFoxä»£æ›¿YApiæ¥å¯¼å…¥çš„æ¥å£æ–‡æ¡£ã€‘
ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜Œ ğŸ˜ ğŸ¥° ğŸ˜˜ ğŸ˜— ğŸ˜™ ğŸ˜š ğŸ˜‹ ğŸ˜› ğŸ˜ ğŸ˜œ ğŸ¤ª ğŸ¤¨ ğŸ§ ğŸ¤“ ğŸ˜ ğŸ¤© ğŸ¥³
1ã€å¯ä»¥å­¦ä¹ Spring Taskå’ŒWebSocket
2ã€å®ç°æ¥å•æé†’å’Œç”¨æˆ·å‚¬å•
æ–‡ç« ç›®å½• è‹ç©¹å¤–å–-day101. Spring Task1.1 ä»‹ç»1.2 cronè¡¨è¾¾å¼1.3 å…¥é—¨æ¡ˆä¾‹1.3.1 Spring Taskä½¿ç”¨æ­¥éª¤1.3.2 ä»£ç å¼€å‘1.3.3 åŠŸèƒ½æµ‹è¯• 2.è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†2.1 éœ€æ±‚åˆ†æ2.2 ä»£ç å¼€å‘2.3 åŠŸèƒ½æµ‹è¯• 3. WebSocket3.1 ä»‹ç»3.2 å…¥é—¨æ¡ˆä¾‹3.2.1 æ¡ˆä¾‹åˆ†æ3.2.2 ä»£ç å¼€å‘3.2.3 åŠŸèƒ½æµ‹è¯• 4. æ¥å•æé†’4.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡4.2 ä»£ç å¼€å‘4.3 åŠŸèƒ½æµ‹è¯•4.4 ä»£ç æäº¤ 5. å®¢æˆ·å‚¬å•5.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡5.2 ä»£ç å¼€å‘5.2.1 Controllerå±‚5.2.2 Serviceå±‚æ¥å£5.2.3 Serviceå±‚å®ç°ç±» 5.3 åŠŸèƒ½æµ‹è¯•5.4 ä»£ç æäº¤ 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/356ba4eb191f973ac299f89976bf4cef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-02T10:54:33+08:00" />
<meta property="article:modified_time" content="2023-08-02T10:54:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">è‹ç©¹å¤–å–-day10</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="day10_0"></a>è‹ç©¹å¤–å–-day10</h2> 
<blockquote> 
 <p>æœ¬é¡¹ç›®å­¦è‡ªé»‘é©¬ç¨‹åºå‘˜çš„ã€Šè‹ç©¹å¤–å–ã€‹é¡¹ç›®ï¼Œæ˜¯ç‘å‰å¤–å–çš„Plusç‰ˆæœ¬<br> åŠŸèƒ½æ›´å¤šï¼Œæ›´åŠ ä¸°å¯Œã€‚<br> ç»“åˆèµ„æ–™ï¼Œå’Œè‡ªå·±å¯¹å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›çœ‹æ³•å’Œé—®é¢˜è§£å†³æƒ…å†µä¸Šä¼ è¯¾ä»¶ç¬”è®°<br> è§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1TP411v7v6/?spm_id_from=333.337.search-card.all.click<br> èµ„æ–™ï¼šå…³æ³¨é»‘é©¬ç¨‹åºå‘˜å…¬ä¼—å·----&gt;å›å¤ï¼šè‹ç©¹å¤–å–</p> 
</blockquote> 
<blockquote> 
 <p>ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·åŠ æ²¹<br> ã€å¯ä»¥ä½¿ç”¨ApiFoxä»£æ›¿YApiæ¥å¯¼å…¥çš„æ¥å£æ–‡æ¡£ã€‘<br> ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜Œ ğŸ˜ ğŸ¥° ğŸ˜˜ ğŸ˜— ğŸ˜™ ğŸ˜š ğŸ˜‹ ğŸ˜› ğŸ˜ ğŸ˜œ ğŸ¤ª ğŸ¤¨ ğŸ§ ğŸ¤“ ğŸ˜ ğŸ¤© ğŸ¥³<br> 1ã€å¯ä»¥å­¦ä¹ Spring Taskå’ŒWebSocket<br> 2ã€å®ç°æ¥å•æé†’å’Œç”¨æˆ·å‚¬å•</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#day10_0" rel="nofollow">è‹ç©¹å¤–å–-day10</a></li><li><ul><li><a href="#1_Spring_Task_18" rel="nofollow">1. Spring Task</a></li><li><ul><li><a href="#11__20" rel="nofollow">1.1 ä»‹ç»</a></li><li><a href="#12_cron_40" rel="nofollow">1.2 cronè¡¨è¾¾å¼</a></li><li><a href="#13__104" rel="nofollow">1.3 å…¥é—¨æ¡ˆä¾‹</a></li><li><ul><li><a href="#131_Spring_Task_106" rel="nofollow">1.3.1 Spring Taskä½¿ç”¨æ­¥éª¤</a></li><li><a href="#132__116" rel="nofollow">1.3.2 ä»£ç å¼€å‘</a></li><li><a href="#133__177" rel="nofollow">1.3.3 åŠŸèƒ½æµ‹è¯•</a></li></ul> 
   </li></ul> 
   </li><li><a href="#2_187" rel="nofollow">2.è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</a></li><li><ul><li><a href="#21__189" rel="nofollow">2.1 éœ€æ±‚åˆ†æ</a></li><li><a href="#22__210" rel="nofollow">2.2 ä»£ç å¼€å‘</a></li><li><a href="#23__313" rel="nofollow">2.3 åŠŸèƒ½æµ‹è¯•</a></li></ul> 
   </li><li><a href="#3_WebSocket_350" rel="nofollow">3. WebSocket</a></li><li><ul><li><a href="#31__352" rel="nofollow">3.1 ä»‹ç»</a></li><li><a href="#32__385" rel="nofollow">3.2 å…¥é—¨æ¡ˆä¾‹</a></li><li><ul><li><a href="#321__387" rel="nofollow">3.2.1 æ¡ˆä¾‹åˆ†æ</a></li><li><a href="#322__409" rel="nofollow">3.2.2 ä»£ç å¼€å‘</a></li><li><a href="#323__633" rel="nofollow">3.2.3 åŠŸèƒ½æµ‹è¯•</a></li></ul> 
   </li></ul> 
   </li><li><a href="#4__646" rel="nofollow">4. æ¥å•æé†’</a></li><li><ul><li><a href="#41__648" rel="nofollow">4.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡</a></li><li><a href="#42__670" rel="nofollow">4.2 ä»£ç å¼€å‘</a></li><li><a href="#43__720" rel="nofollow">4.3 åŠŸèƒ½æµ‹è¯•</a></li><li><a href="#44__756" rel="nofollow">4.4 ä»£ç æäº¤</a></li></ul> 
   </li><li><a href="#5__757" rel="nofollow">5. å®¢æˆ·å‚¬å•</a></li><li><ul><li><a href="#51__759" rel="nofollow">5.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡</a></li><li><a href="#52__788" rel="nofollow">5.2 ä»£ç å¼€å‘</a></li><li><ul><li><a href="#521_Controller_790" rel="nofollow">5.2.1 Controllerå±‚</a></li><li><a href="#522_Service_811" rel="nofollow">5.2.2 Serviceå±‚æ¥å£</a></li><li><a href="#523_Service_825" rel="nofollow">5.2.3 Serviceå±‚å®ç°ç±»</a></li></ul> 
    </li><li><a href="#53__868" rel="nofollow">5.3 åŠŸèƒ½æµ‹è¯•</a></li><li><a href="#54__898" rel="nofollow">5.4 ä»£ç æäº¤</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_Spring_Task_18"></a>1. Spring Task</h3> 
<h4><a id="11__20"></a>1.1 ä»‹ç»</h4> 
<p><strong>Spring Task</strong> æ˜¯Springæ¡†æ¶æä¾›çš„ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œå¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªä»£ç é€»è¾‘ã€‚</p> 
<p><strong>å®šä½ï¼šå®šæ—¶ä»»åŠ¡æ¡†æ¶</strong></p> 
<p><strong>ä½œç”¨ï¼šå®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µJavaä»£ç </strong><br> ä¸ºä»€ä¹ˆè¦åœ¨Javaç¨‹åºä¸­ä½¿ç”¨Spring Taskï¼Ÿ</p> 
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p> 
<p>1). ä¿¡ç”¨å¡æ¯æœˆè¿˜æ¬¾æé†’<br> 2). é“¶è¡Œè´·æ¬¾æ¯æœˆè¿˜æ¬¾æé†’<br> 3). ç«è½¦ç¥¨å”®ç¥¨ç³»ç»Ÿå¤„ç†æœªæ”¯ä»˜è®¢å•<br> 4). å…¥èŒçºªå¿µæ—¥ä¸ºç”¨æˆ·å‘é€é€šçŸ¥</p> 
<p>**å¼ºè°ƒï¼š**åªè¦æ˜¯éœ€è¦å®šæ—¶å¤„ç†çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨Spring Task</p> 
<h4><a id="12_cron_40"></a>1.2 cronè¡¨è¾¾å¼</h4> 
<p><strong>cronè¡¨è¾¾å¼</strong>å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥<strong>å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´</strong></p> 
<p><strong>æ„æˆè§„åˆ™ï¼šåˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œç”±ç©ºæ ¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰</strong></p> 
<p>æ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´(å¯é€‰)</p> 
<p><strong>ä¸¾ä¾‹ï¼š</strong></p> 
<p>2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´ å¯¹åº”çš„cronè¡¨è¾¾å¼ä¸ºï¼š<strong>0 0 9 12 10 ? 2022</strong></p> 
<p><img src="https://images2.imgbox.com/52/6b/NQX5E1Ro_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>è¯´æ˜ï¼š<strong>ä¸€èˆ¬</strong>æ—¥</strong>å’Œ<strong>å‘¨</strong>çš„å€¼ä¸åŒæ—¶è®¾ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾ç½®ï¼Œå¦ä¸€ä¸ªç”¨ï¼Ÿè¡¨ç¤ºã€‚</p> 
<p>**æ¯”å¦‚ï¼š**æè¿°2æœˆä»½çš„æœ€åä¸€å¤©ï¼Œæœ€åä¸€å¤©å…·ä½“æ˜¯å‡ å·å‘¢ï¼Ÿå¯èƒ½æ˜¯28å·ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯29å·ï¼Œæ‰€ä»¥å°±ä¸èƒ½å†™å…·ä½“æ•°å­—ã€‚</p> 
<p>ä¸ºäº†æè¿°è¿™äº›ä¿¡æ¯ï¼Œæä¾›ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ã€‚è¿™äº›å…·ä½“çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªå·±å»æ‰‹å†™ï¼Œå› ä¸ºè¿™ä¸ªcronè¡¨è¾¾å¼ï¼Œå®ƒå…¶å®æœ‰åœ¨çº¿ç”Ÿæˆå™¨ã€‚</p> 
<p>cronè¡¨è¾¾å¼åœ¨çº¿ç”Ÿæˆå™¨ï¼šhttps://cron.qqe2.com/</p> 
<p><img src="https://images2.imgbox.com/94/96/Cr6JmnzF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç½‘ç«™ä¸Šé¢ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„è¦æ±‚å»ç”Ÿæˆcornè¡¨è¾¾å¼å³å¯ã€‚æ‰€ä»¥ä¸€èˆ¬å°±ä¸ç”¨è‡ªå·±å»ç¼–å†™è¿™ä¸ªè¡¨è¾¾å¼ã€‚</p> 
<p><strong>é€šé…ç¬¦ï¼š</strong></p> 
<p>* è¡¨ç¤ºæ‰€æœ‰å€¼ï¼›</p> 
<p>? è¡¨ç¤ºæœªè¯´æ˜çš„å€¼ï¼Œå³ä¸å…³å¿ƒå®ƒä¸ºä½•å€¼ï¼›</p> 
<p>- è¡¨ç¤ºä¸€ä¸ªæŒ‡å®šçš„èŒƒå›´ï¼›</p> 
<p>, è¡¨ç¤ºé™„åŠ ä¸€ä¸ªå¯èƒ½å€¼ï¼›</p> 
<p>/ ç¬¦å·å‰è¡¨ç¤ºå¼€å§‹æ—¶é—´ï¼Œç¬¦å·åè¡¨ç¤ºæ¯æ¬¡é€’å¢çš„å€¼ï¼›</p> 
<p><strong>cronè¡¨è¾¾å¼æ¡ˆä¾‹ï¼š</strong></p> 
<p>*/5 * * * * ? æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡</p> 
<p>0 */1 * * * ? æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</p> 
<p>0 0 5-15 * * ? æ¯å¤©5-15ç‚¹æ•´ç‚¹è§¦å‘</p> 
<p>0 0/3 * * * ? æ¯ä¸‰åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</p> 
<p>0 0-5 14 * * ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:05æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘</p> 
<p>0 0/5 14 * * ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘</p> 
<p>0 0/5 14,18 * * ? åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´å’Œä¸‹åˆ6ç‚¹åˆ°6:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘</p> 
<p>0 0/30 9-17 * * ? æœä¹æ™šäº”å·¥ä½œæ—¶é—´å†…æ¯åŠå°æ—¶</p> 
<p>0 0 10,14,16 * * ? æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä¸‹åˆ2ç‚¹ï¼Œ4ç‚¹</p> 
<h4><a id="13__104"></a>1.3 å…¥é—¨æ¡ˆä¾‹</h4> 
<h5><a id="131_Spring_Task_106"></a>1.3.1 Spring Taskä½¿ç”¨æ­¥éª¤</h5> 
<p>1). å¯¼å…¥mavenåæ ‡ spring-contextï¼ˆå·²å­˜åœ¨ï¼‰</p> 
<p>2). å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ @EnableScheduling å¼€å¯ä»»åŠ¡è°ƒåº¦</p> 
<p>3). è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</p> 
<h5><a id="132__116"></a>1.3.2 ä»£ç å¼€å‘</h5> 
<p><strong>ç¼–å†™å®šæ—¶ä»»åŠ¡ç±»ï¼š</strong></p> 
<p>è¿›å…¥sky-serveræ¨¡å—ä¸­</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>task</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scheduled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * å®šæ—¶ä»»åŠ¡ æ¯éš”5ç§’è§¦å‘ä¸€æ¬¡
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0/5 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼š{}"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>å¼€å¯ä»»åŠ¡è°ƒåº¦ï¼š</strong></p> 
<p>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ @EnableScheduling</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableScheduling</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableTransactionManagement</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span> <span class="token comment">//å¼€å¯æ³¨è§£æ–¹å¼çš„äº‹åŠ¡ç®¡ç†</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@EnableScheduling</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SkyApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SkyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"server started"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="133__177"></a>1.3.3 åŠŸèƒ½æµ‹è¯•</h5> 
<p>å¯åŠ¨æœåŠ¡ï¼ŒæŸ¥çœ‹æ—¥å¿—</p> 
<p><img src="https://images2.imgbox.com/b8/d7/L8S4yNnr_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</p> 
<h3><a id="2_187"></a>2.è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</h3> 
<h4><a id="21__189"></a>2.1 éœ€æ±‚åˆ†æ</h4> 
<p>ç”¨æˆ·ä¸‹å•åå¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼š</p> 
<ul><li>ä¸‹å•åæœªæ”¯ä»˜ï¼Œè®¢å•ä¸€ç›´å¤„äº**â€œå¾…æ”¯ä»˜â€**çŠ¶æ€</li><li>ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼Œè®¢å•ä¸€ç›´å¤„äº**â€œæ´¾é€ä¸­â€**çŠ¶æ€</li></ul> 
<p><img src="https://images2.imgbox.com/97/ba/Jb3OWjUB_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ”¯ä»˜è¶…æ—¶çš„è®¢å•å¦‚ä½•å¤„ç†ï¼Ÿ æ´¾é€ä¸­çš„è®¢å•ä¸€ç›´ä¸ç‚¹å‡»å®Œæˆå¦‚ä½•å¤„ç†ï¼Ÿ</p> 
<p>å¯¹äºä¸Šé¢ä¸¤ç§æƒ…å†µéœ€è¦é€šè¿‡<strong>å®šæ—¶ä»»åŠ¡</strong>æ¥ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œå…·ä½“é€»è¾‘ä¸ºï¼š</p> 
<ul><li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•ï¼ˆä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å–æ¶ˆâ€</li><li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨â€œæ´¾é€ä¸­â€çš„è®¢å•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€</li></ul> 
<h4><a id="22__210"></a>2.2 ä»£ç å¼€å‘</h4> 
<p><strong>1). è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTaskï¼ˆå¾…å®Œå–„ï¼‰ï¼š</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>task</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œå®ç°è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderTask</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processTimeoutOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š{}"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 1 * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processDeliveryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š{}"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2). åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•:</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * æ ¹æ®çŠ¶æ€å’Œä¸‹å•æ—¶é—´æŸ¥è¯¢è®¢å•
     * @param status
     * @param orderTime
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from orders where status = #{status} and order_time &lt; #{orderTime}"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> <span class="token function">getByStatusAndOrdertimeLT</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> status<span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span> orderTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>3). å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„processTimeoutOrderæ–¹æ³•ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processTimeoutOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š{}"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LocalDateTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// select * from orders where status = 1 and order_time &lt; å½“å‰æ—¶é—´-15åˆ†é’Ÿ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> ordersList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getByStatusAndOrdertimeLT</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">PENDING_PAYMENT</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ordersList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ordersList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ordersList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>order <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">CANCELLED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                order<span class="token punctuation">.</span><span class="token function">setCancelReason</span><span class="token punctuation">(</span><span class="token string">"æ”¯ä»˜è¶…æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                order<span class="token punctuation">.</span><span class="token function">setCancelTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                orderMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>4). å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„processDeliveryOrderæ–¹æ³•ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 1 * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processDeliveryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š{}"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// select * from orders where status = 4 and order_time &lt; å½“å‰æ—¶é—´-1å°æ—¶</span>
        <span class="token class-name">LocalDateTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> ordersList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getByStatusAndOrdertimeLT</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_IN_PROGRESS</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>ordersList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ordersList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ordersList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>order <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                orderMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="23__313"></a>2.3 åŠŸèƒ½æµ‹è¯•</h4> 
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p> 
<ul><li>æŸ¥çœ‹æ§åˆ¶å°sql</li><li>æŸ¥çœ‹æ•°æ®åº“ä¸­æ•°æ®å˜åŒ–</li></ul> 
<p><strong>æ”¯ä»˜è¶…æ—¶çš„è®¢å•æµ‹è¯•ï¼š</strong></p> 
<p><strong>1). æŸ¥çœ‹è®¢å•è¡¨</strong></p> 
<p>æœ‰ä¸€æ¡è®¢å•ï¼ŒçŠ¶æ€ä¸º1ã€‚è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</p> 
<p><img src="https://images2.imgbox.com/52/7c/UaHm0ZEk_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>2). å¼€å¯å®šæ—¶ä»»åŠ¡</strong></p> 
<p>å¯åŠ¨æœåŠ¡ï¼Œè§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ã€‚å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ä»»åŠ¡æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</p> 
<p><img src="https://images2.imgbox.com/b9/9b/I8bh3ep5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>3). å†æ¬¡æŸ¥çœ‹è®¢å•è¡¨</strong></p> 
<p>çŠ¶æ€å·²æ›´æ”¹ä¸º6ï¼Œå·²å–æ¶ˆã€‚</p> 
<p><img src="https://images2.imgbox.com/fb/9a/kWaSbim5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¯æ˜å®šæ—¶ä»»åŠ¡å·²ç”Ÿæ•ˆã€‚</p> 
<p><strong>å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•ä»»åŠ¡</strong>æµ‹è¯•è‡ªå·²å®Œæˆï¼Œæµ‹è¯•æ­¥éª¤å’Œä¸Šè¿°ä¸€è‡´ã€‚å¯é€‚å½“ä¿®æ”¹cronè¡¨è¾¾å¼ï¼Œæ”¹å˜ä»»åŠ¡æ‰§è¡Œé¢‘ç‡ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚</p> 
<h3><a id="3_WebSocket_350"></a>3. WebSocket</h3> 
<h4><a id="31__352"></a>3.1 ä»‹ç»</h4> 
<p>WebSocket æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„<strong>ç½‘ç»œåè®®</strong>ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»º<strong>æŒä¹…æ€§</strong>çš„è¿æ¥ï¼Œ å¹¶è¿›è¡Œ<strong>åŒå‘</strong>æ•°æ®ä¼ è¾“ã€‚</p> 
<p><strong>HTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š</strong></p> 
<ul><li>HTTPæ˜¯<strong>çŸ­è¿æ¥</strong></li><li>WebSocketæ˜¯<strong>é•¿è¿æ¥</strong></li><li>HTTPé€šä¿¡æ˜¯<strong>å•å‘</strong>çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼</li><li>WebSocketæ”¯æŒ<strong>åŒå‘</strong>é€šä¿¡</li><li>HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥</li></ul> 
<p><img src="https://images2.imgbox.com/0a/6b/ziOVfLDP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æ€è€ƒï¼šæ—¢ç„¶WebSocketæ”¯æŒåŒå‘é€šä¿¡ï¼ŒåŠŸèƒ½çœ‹ä¼¼æ¯”HTTPå¼ºå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºWebSocketå¼€å‘æ‰€æœ‰çš„ä¸šåŠ¡åŠŸèƒ½ï¼Ÿ</strong></p> 
<p><strong>WebSocketç¼ºç‚¹ï¼š</strong></p> 
<p>æœåŠ¡å™¨é•¿æœŸç»´æŠ¤é•¿è¿æ¥éœ€è¦ä¸€å®šçš„æˆæœ¬<br> å„ä¸ªæµè§ˆå™¨æ”¯æŒç¨‹åº¦ä¸ä¸€<br> WebSocket æ˜¯é•¿è¿æ¥ï¼Œå—ç½‘ç»œé™åˆ¶æ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤„ç†å¥½é‡è¿</p> 
<p><strong>ç»“è®ºï¼šWebSocketå¹¶ä¸èƒ½å®Œå…¨å–ä»£HTTPï¼Œå®ƒåªé€‚åˆåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä½¿ç”¨</strong></p> 
<p><strong>WebSocketåº”ç”¨åœºæ™¯ï¼š</strong></p> 
<p>1). è§†é¢‘å¼¹å¹•<br> 2). ç½‘é¡µèŠå¤©<br> 3). ä½“è‚²å®å†µæ›´æ–°<br> 4). è‚¡ç¥¨åŸºé‡‘æŠ¥ä»·å®æ—¶æ›´æ–°</p> 
<h4><a id="32__385"></a>3.2 å…¥é—¨æ¡ˆä¾‹</h4> 
<h5><a id="321__387"></a>3.2.1 æ¡ˆä¾‹åˆ†æ</h5> 
<p><strong>éœ€æ±‚ï¼šå®ç°æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ã€‚æµè§ˆå™¨æ—¢å¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯ã€‚</strong></p> 
<p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/db/e0/zCcVNb7j_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p> 
<p>1). ç›´æ¥ä½¿ç”¨websocket.htmlé¡µé¢ä½œä¸ºWebSocketå®¢æˆ·ç«¯</p> 
<p>2). å¯¼å…¥WebSocketçš„mavenåæ ‡</p> 
<p>3). å¯¼å…¥WebSocketæœåŠ¡ç«¯ç»„ä»¶WebSocketServerï¼Œç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡</p> 
<p>4). å¯¼å…¥é…ç½®ç±»WebSocketConfigurationï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶</p> 
<p>5). å¯¼å…¥å®šæ—¶ä»»åŠ¡ç±»WebSocketTaskï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®</p> 
<h5><a id="322__409"></a>3.2.2 ä»£ç å¼€å‘</h5> 
<p>1). å®šä¹‰websocket.htmlé¡µé¢(èµ„æ–™ä¸­å·²æä¾›)</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">HTML</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>WebSocket Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>å‘é€æ¶ˆæ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">closeWebSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>å…³é—­è¿æ¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> websocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> clientId <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'WebSocket'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//è¿æ¥WebSocketèŠ‚ç‚¹</span>
        websocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://localhost:8080/ws/"</span><span class="token operator">+</span>clientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Not support websocket'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">setMessageInnerHTML</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">setMessageInnerHTML</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">setMessageInnerHTML</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">setMessageInnerHTML</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onbeforeunload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        websocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</span>
    <span class="token keyword">function</span> <span class="token function">setMessageInnerHTML</span><span class="token punctuation">(</span><span class="token parameter">innerHTML</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> innerHTML <span class="token operator">+</span> <span class="token string">'&lt;br/&gt;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å‘é€æ¶ˆæ¯</span>
    <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> message <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        websocket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	<span class="token comment">//å…³é—­è¿æ¥</span>
    <span class="token keyword">function</span> <span class="token function">closeWebSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        websocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2). å¯¼å…¥mavenåæ ‡</p> 
<p>åœ¨sky-serveræ¨¡å—pom.xmlä¸­å·²å®šä¹‰</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>3). å®šä¹‰WebSocketæœåŠ¡ç«¯ç»„ä»¶(èµ„æ–™ä¸­å·²æä¾›)</p> 
<p>ç›´æ¥å¯¼å…¥åˆ°sky-serveræ¨¡å—å³å¯</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>websocket</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token class-name">OnClose</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token class-name">OnMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token class-name">OnOpen</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token class-name">Session</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">PathParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerEndpoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * WebSocketæœåŠ¡
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ServerEndpoint</span><span class="token punctuation">(</span><span class="token string">"/ws/{sid}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSocketServer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//å­˜æ”¾ä¼šè¯å¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Session</span><span class="token punctuation">&gt;</span></span> sessionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•
     */</span>
    <span class="token annotation punctuation">@OnOpen</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> sid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·ç«¯ï¼š"</span> <span class="token operator">+</span> sid <span class="token operator">+</span> <span class="token string">"å»ºç«‹è¿æ¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•
     *
     * @param message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯
     */</span>
    <span class="token annotation punctuation">@OnMessage</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> sid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ï¼š"</span> <span class="token operator">+</span> sid <span class="token operator">+</span> <span class="token string">"çš„ä¿¡æ¯:"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•
     *
     * @param sid
     */</span>
    <span class="token annotation punctuation">@OnClose</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> sid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥æ–­å¼€:"</span> <span class="token operator">+</span> sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * ç¾¤å‘
     *
     * @param message
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendToAllClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Session</span><span class="token punctuation">&gt;</span></span> sessions <span class="token operator">=</span> sessionMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Session</span> session <span class="token operator">:</span> sessions<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
                session<span class="token punctuation">.</span><span class="token function">getBasicRemote</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>4). å®šä¹‰é…ç½®ç±»ï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶(ä»èµ„æ–™ä¸­ç›´æ¥å¯¼å…¥å³å¯)</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>server<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">ServerEndpointExporter</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * WebSocketé…ç½®ç±»ï¼Œç”¨äºæ³¨å†ŒWebSocketçš„Bean
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSocketConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServerEndpointExporter</span> <span class="token function">serverEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServerEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>5). å®šä¹‰å®šæ—¶ä»»åŠ¡ç±»ï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®(ä»èµ„æ–™ä¸­ç›´æ¥å¯¼å…¥å³å¯)</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>task</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token class-name">WebSocketServer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scheduled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormatter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSocketTask</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebSocketServer</span> webSocketServer<span class="token punctuation">;</span>

    <span class="token comment">/**
     * é€šè¿‡WebSocketæ¯éš”5ç§’å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0/5 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageToClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        webSocketServer<span class="token punctuation">.</span><span class="token function">sendToAllClient</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="323__633"></a>3.2.3 åŠŸèƒ½æµ‹è¯•</h5> 
<p>å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€websocket.htmlé¡µé¢</p> 
<p><strong>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/e6/3d/FBEZMp9G_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æœåŠ¡å™¨å‘æµè§ˆå™¨é—´éš”5ç§’æ¨é€æ•°æ®ï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/97/9b/ZeE9XfOD_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4__646"></a>4. æ¥å•æé†’</h3> 
<h4><a id="41__648"></a>4.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4> 
<p>ç”¨æˆ·ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸåï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p> 
<ul><li> <p>è¯­éŸ³æ’­æŠ¥ <img src="https://images2.imgbox.com/86/2f/iLYMm4KH_o.png" alt=""></p> </li><li> <p>å¼¹å‡ºæç¤ºæ¡†</p> </li></ul> 
<p><img src="https://images2.imgbox.com/37/c4/ZTs1jxlE_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p> 
<ul><li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li><li>å½“å®¢æˆ·æ”¯ä»˜åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</li><li>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent 
  <ul><li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li><li>orderId ä¸ºè®¢å•id</li><li>content ä¸ºæ¶ˆæ¯å†…å®¹</li></ul> </li></ul> 
<h4><a id="42__670"></a>4.2 ä»£ç å¼€å‘</h4> 
<p><strong>åœ¨OrderServiceImplä¸­æ³¨å…¥WebSocketServerå¯¹è±¡ï¼Œä¿®æ”¹paySuccessæ–¹æ³•ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebSocketServer</span> webSocketServer<span class="token punctuation">;</span>
	<span class="token comment">/**
     * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€
     *
     * @param outTradeNo
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paySuccess</span><span class="token punctuation">(</span><span class="token class-name">String</span> outTradeNo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span>
        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">BaseContext</span><span class="token punctuation">.</span><span class="token function">getCurrentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•</span>
        <span class="token class-name">Orders</span> ordersDB <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getByNumberAndUserId</span><span class="token punctuation">(</span>outTradeNo<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span>
        <span class="token class-name">Orders</span> orders <span class="token operator">=</span> <span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>ordersDB<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">TO_BE_CONFIRMED</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">payStatus</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">PAID</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">checkoutTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//</span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæ¯ç±»å‹ï¼Œ1è¡¨ç¤ºæ¥å•æé†’</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">,</span> orders<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> <span class="token string">"è®¢å•å·ï¼š"</span> <span class="token operator">+</span> outTradeNo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//é€šè¿‡WebSocketå®ç°æ¥å•æé†’ï¼Œå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯</span>
        webSocketServer<span class="token punctuation">.</span><span class="token function">sendToAllClient</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///</span>
    <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
     * æ ¹æ®è®¢å•å·å’Œç”¨æˆ·idæŸ¥è¯¢è®¢å•
     * @param orderNumber
     * @param userId
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from orders where number = #{orderNumber} and user_id= #{userId}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Orders</span> <span class="token function">getByNumberAndUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderNumber<span class="token punctuation">,</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="43__720"></a>4.3 åŠŸèƒ½æµ‹è¯•</h4> 
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p> 
<ul><li>æŸ¥çœ‹æµè§ˆå™¨è°ƒè¯•å·¥å…·æ•°æ®äº¤äº’è¿‡ç¨‹</li><li>å‰åç«¯è”è°ƒ</li></ul> 
<p><strong>1). ç™»å½•ç®¡ç†ç«¯åå°</strong></p> 
<p>ç™»å½•æˆåŠŸåï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹é•¿è¿æ¥</p> 
<p><img src="https://images2.imgbox.com/35/0d/k85eCgrv_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</p> 
<p><img src="https://images2.imgbox.com/11/9e/RaQstQ5s_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>2). å°ç¨‹åºç«¯ä¸‹å•æ”¯ä»˜</strong></p> 
<p>ä¿®æ”¹å›è°ƒåœ°å€ï¼Œåˆ©ç”¨å†…ç½‘ç©¿é€è·å–åŸŸå</p> 
<p><img src="https://images2.imgbox.com/e6/3e/JfDyYRVF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä¸‹å•æ”¯ä»˜</p> 
<p><strong>3). æŸ¥çœ‹æ¥å•æé†’</strong></p> 
<p>æ”¯ä»˜æˆåŠŸåï¼Œåå°æ”¶åˆ°æ¥å•æé†’ï¼Œå¹¶æœ‰è¯­éŸ³æ’­æŠ¥</p> 
<p><img src="https://images2.imgbox.com/98/ff/D30z5HqE_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="44__756"></a>4.4 ä»£ç æäº¤</h4> 
<h3><a id="5__757"></a>5. å®¢æˆ·å‚¬å•</h3> 
<h4><a id="51__759"></a>5.1 éœ€æ±‚åˆ†æå’Œè®¾è®¡</h4> 
<p>ç”¨æˆ·åœ¨å°ç¨‹åºä¸­ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p> 
<ul><li> <p>è¯­éŸ³æ’­æŠ¥ <img src="https://images2.imgbox.com/18/33/P4iV3d79_o.png" alt=""></p> </li><li> <p>å¼¹å‡ºæç¤ºæ¡†</p> </li></ul> 
<p><img src="https://images2.imgbox.com/b7/81/cPKGiLZ0_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p> 
<ul><li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li><li>å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥<br> çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent 
  <ul><li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li><li>orderId ä¸ºè®¢å•id</li><li>content ä¸ºæ¶ˆæ¯å†…å®¹</li></ul> </li></ul> 
<p>å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®æ—¶ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€‚</p> 
<p><strong>æ¥å£è®¾è®¡(å‚¬å•)ï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/cd/eb/ZKujOuDS_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="52__788"></a>5.2 ä»£ç å¼€å‘</h4> 
<h5><a id="521_Controller_790"></a>5.2.1 Controllerå±‚</h5> 
<p><strong>æ ¹æ®ç”¨æˆ·å‚¬å•çš„æ¥å£å®šä¹‰ï¼Œåœ¨user/OrderControllerä¸­åˆ›å»ºå‚¬å•æ–¹æ³•ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * ç”¨æˆ·å‚¬å•
     *
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/reminder/{id}"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å‚¬å•"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">reminder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        orderService<span class="token punctuation">.</span><span class="token function">reminder</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="522_Service_811"></a>5.2.2 Serviceå±‚æ¥å£</h5> 
<p><strong>åœ¨OrderServiceæ¥å£ä¸­å£°æ˜reminderæ–¹æ³•ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * ç”¨æˆ·å‚¬å•
     * @param id
     */</span>
    <span class="token keyword">void</span> <span class="token function">reminder</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="523_Service_825"></a>5.2.3 Serviceå±‚å®ç°ç±»</h5> 
<p><strong>åœ¨OrderServiceImplä¸­å®ç°reminderæ–¹æ³•ï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * ç”¨æˆ·å‚¬å•
     *
     * @param id
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reminder</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// æŸ¥è¯¢è®¢å•æ˜¯å¦å­˜åœ¨</span>
        <span class="token class-name">Orders</span> orders <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>orders <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OrderBusinessException</span><span class="token punctuation">(</span><span class="token class-name">MessageConstant</span><span class="token punctuation">.</span><span class="token constant">ORDER_NOT_FOUND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//åŸºäºWebSocketå®ç°å‚¬å•</span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2ä»£è¡¨ç”¨æˆ·å‚¬å•</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> <span class="token string">"è®¢å•å·ï¼š"</span> <span class="token operator">+</span> orders<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        webSocketServer<span class="token punctuation">.</span><span class="token function">sendToAllClient</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>5.2.4 Mapperå±‚</p> 
<p><strong>åœ¨OrderMapperä¸­æ·»åŠ getByIdï¼š</strong></p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * æ ¹æ®idæŸ¥è¯¢è®¢å•
     * @param id
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from orders where id=#{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Orders</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="53__868"></a>5.3 åŠŸèƒ½æµ‹è¯•</h4> 
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p> 
<ul><li>æŸ¥çœ‹æµè§ˆå™¨è°ƒè¯•å·¥å…·æ•°æ®äº¤äº’è¿‡ç¨‹</li><li>å‰åç«¯è”è°ƒ</li></ul> 
<p><strong>1). ç™»å½•ç®¡ç†ç«¯åå°</strong></p> 
<p>ç™»å½•æˆåŠŸåï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹é•¿è¿æ¥</p> 
<p><img src="https://images2.imgbox.com/f9/13/knhsmpnk_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</p> 
<p><img src="https://images2.imgbox.com/c9/7a/qFxAbn2f_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>2). ç”¨æˆ·è¿›è¡Œå‚¬å•</strong></p> 
<p>ç”¨æˆ·å¯åœ¨è®¢å•åˆ—è¡¨æˆ–è€…è®¢å•è¯¦æƒ…ï¼Œè¿›è¡Œå‚¬å•</p> 
<p><img src="https://images2.imgbox.com/47/71/fup0iKrp_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>3). æŸ¥çœ‹å‚¬å•æé†’</strong></p> 
<p>æ—¢æœ‰å‚¬å•å¼¹çª—ï¼ŒåŒæ—¶è¯­éŸ³æ’­æŠ¥ <img src="https://images2.imgbox.com/e9/72/QqnsaExp_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="54__898"></a>5.4 ä»£ç æäº¤</h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf66e0072ec1ebe70a6460c80ed99d3e/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Javaçµæ´»æ“ä½œHttpè¯·æ±‚ï¼ˆhutoolï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/87d1e2ec3a686783cd3efe039732fb69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Linux(äºŒ)---------ç½‘ç»œå‘½ä»¤å­¦ä¹ ï¼ˆifconfigå‘½ä»¤ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>