<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CookieJar下载并使用cookies - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CookieJar下载并使用cookies" />
<meta property="og:description" content="在前面写过一篇《requests下载并使用cookies》，除了用requests，用http.cookiejar同样能实现，不过步骤繁琐很多，用http.cookiejar首先需要创建一个cookiejar对象，然后再用cookiejar创建一个handler，再在handler中创建一个opener，最后在opener中传递帐号密码，获取cookies信息。
下面主要介绍两种使用方法，一种是直接获取cookies信息然后获取目标网页信息；一种是先将cookies信息下载，再加载cookies信息并获取目标网页信息。下面直接用人人网举例说明。
一、直接获取cookies信息然后获取目标网页信息 简单来说分来两步完成，先登录并获取cookies信息，再用带cookies信息的opener获取目标页面信息
from urllib import request,parse from http.cookiejar import CookieJar #1、登录 #1.1、创建一个cookiejar对象 cookiejar = CookieJar() #1.2、使用cookiejar创建一个HTTPCookieProcessor对象 handler = request.HTTPCookieProcessor(cookiejar) #1.3、使用上一步创建的Handler创建一个opener opener = request.build_opener(handler) #1.4、使用opener发送登录请求（邮箱密码） headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#39; } data = { &#39;email&#39;:&#34;你的帐号&#34;, &#39;password&#39;:&#39;你的密码&#39; } login_url = &#39;http://www.renren.com/PLogin.do&#39;#登录的网址 req = request.Request(login_url,headers = headers,data=parse.urlencode(data).encode(&#39;utf-8&#39;)) opener.open(req) #2、访问个人主页 dapeng_url = &#39;http://www.renren.com/880151247/profile&#39;#爬取的网址 #获取个人主页页面的时候，不要新建一个opener #应该要用上一步的那个opener，因为之前那个opener包含了登录所需要的cookie信息 req = request.Request(dapeng_url,headers=headers) resp = opener.open(req) with open(&#39;renren." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c6da69f17f7b1b1eda48601bae55694d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-27T10:24:08+08:00" />
<meta property="article:modified_time" content="2019-08-27T10:24:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CookieJar下载并使用cookies</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在前面写过一篇<a href="https://blog.csdn.net/qq_22592457/article/details/100083590">《requests下载并使用cookies》</a>，除了用requests，用http.cookiejar同样能实现，不过步骤繁琐很多，用http.cookiejar首先需要创建一个cookiejar对象，然后再用cookiejar创建一个handler，再在handler中创建一个opener，最后在opener中传递帐号密码，获取cookies信息。</p> 
<p>下面主要介绍两种使用方法，一种是直接获取cookies信息然后获取目标网页信息；一种是先将cookies信息下载，再加载cookies信息并获取目标网页信息。下面直接用人人网举例说明。</p> 
<h4>一、直接获取cookies信息然后获取目标网页信息</h4> 
<p>简单来说分来两步完成，先登录并获取cookies信息，再用带cookies信息的opener获取目标页面信息</p> 
<pre class="has"><code class="hljs language-python">from urllib import request,parse
from http.cookiejar import CookieJar

#1、登录
#1.1、创建一个cookiejar对象
cookiejar = CookieJar()
#1.2、使用cookiejar创建一个HTTPCookieProcessor对象
handler = request.HTTPCookieProcessor(cookiejar)
#1.3、使用上一步创建的Handler创建一个opener
opener = request.build_opener(handler)
#1.4、使用opener发送登录请求（邮箱密码）
headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36' 
}
data = {
    'email':"你的帐号",
    'password':'你的密码'
}
login_url = 'http://www.renren.com/PLogin.do'#登录的网址
req = request.Request(login_url,headers = headers,data=parse.urlencode(data).encode('utf-8'))
opener.open(req)

#2、访问个人主页
dapeng_url = 'http://www.renren.com/880151247/profile'#爬取的网址
#获取个人主页页面的时候，不要新建一个opener
#应该要用上一步的那个opener，因为之前那个opener包含了登录所需要的cookie信息
req = request.Request(dapeng_url,headers=headers)
resp = opener.open(req)
with open('renren.html','w',encoding='utf-8') as fp:
    fp.write(resp.read().decode('utf-8'))</code></pre> 
<h4>二、下载cookies并保存，再加载并使用cookies</h4> 
<p>这里用的是MozillaCookieJar来存放下载的cookies信息，需要注意一点的是，在save时最好设定ignore_discard=True，因为浏览器在关闭网页时会自动将对应的cookies更新状态为已过期，而默认的cookies下载时，只会下载当前有效的cookies，ignore_discard=True的作用是把已过期的cookie也保存下载。</p> 
<p>下面是下载保存cookies信息的代码</p> 
<pre class="has"><code class="hljs language-python">#保存cookie到本地
from urllib import request,parse
from http.cookiejar import MozillaCookieJar

cookiejar = MozillaCookieJar('cookie.txt')
handler = request.HTTPCookieProcessor(cookiejar)
opener = request.build_opener(handler)

headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36' 
}
data = {
    'email':"你的帐号",
    'password':'你的密码'
}
login_url = 'http://www.renren.com/PLogin.do'
req = request.Request(login_url,headers = headers,data=parse.urlencode(data).encode('utf-8'))
resp = opener.open(req)
cookiejar.save(ignore_discard=True,ignore_expires=True)
#ignore_discard=True的作用是把已过期的cookie也保存下载</code></pre> 
<p>下面是加载cookies信息的代码</p> 
<pre class="has"><code class="hljs language-python">#加载本地的cookie
from urllib import request,parse
from http.cookiejar import MozillaCookieJar

cookiejar = MozillaCookieJar('cookie.txt')#本地cookie文件的地址
cookiejar.load(ignore_discard=True)#这个是加载
handler = request.HTTPCookieProcessor(cookiejar)
opener = request.build_opener(handler)

headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36' 
}

dapeng_url = 'http://www.renren.com/880151247/profile'
req = request.Request(dapeng_url,headers=headers)
resp = opener.open(req)
with open('renren.html','w',encoding='utf-8') as fp:
    fp.write(resp.read().decode('utf-8'))</code></pre> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d882c0584448fed4e1b64d4ae2d46334/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">spring boot XSS 攻击 富文本框</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aedc4efc6f371fb0c263c734f1a7dfdb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微分算子法总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>