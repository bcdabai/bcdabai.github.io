<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>构建CommonAPI c&#43;&#43; 和some/IP环境 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="构建CommonAPI c&#43;&#43; 和some/IP环境" />
<meta property="og:description" content="获取common API C&#43;&#43; git clone https://github.com/COVESA/capicxx-core-runtime.git
第一次编译capicxx-core-runtime cd capicxx-core-runtime/ mkdir build cd build/ ls cmake .. 报错 缺少 No package ‘automotive-dlt’ found
获取dlt git clone https://github.com/GENIVI/dlt-daemon.git
cd dlt-daemon/ mkdir build cd build/ cmake .. make 编译dlt-daemon错误 /usr/include/x86_64-linux-gnu/bits/string_fortified.h:106:10: error: ‘__builtin_strncpy’ specified bound 10 equals destination size [-Werror=stringop-truncation] vi /home/hippo/CommonAPI/dlt-daemon/src/console/dlt-control-common.c 把size改成 size - 1 make sudo make install sudo ldconfig 第二次编译capicxx-core-runtime 安装依赖模块
sudo apt-get install doxygen sudo apt-get install graphviz sudo apt-get install doxygen-doc doxygen-gui sudo apt-get install asciidoc fop 第三次编译capicxx-core-runtime cmake ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f6019c63054c86d5aebaa2f11b1fa15/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-21T13:58:08+08:00" />
<meta property="article:modified_time" content="2023-02-21T13:58:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">构建CommonAPI c&#43;&#43; 和some/IP环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="common_API_C_0"></a>获取common API C++</h3> 
<p>git clone https://github.com/COVESA/capicxx-core-runtime.git</p> 
<h4><a id="capicxxcoreruntime_4"></a>第一次编译capicxx-core-runtime</h4> 
<pre><code>cd capicxx-core-runtime/
mkdir build
cd build/
ls
cmake ..

</code></pre> 
<p>报错 缺少 No package ‘automotive-dlt’ found</p> 
<h4><a id="dlt_17"></a>获取dlt</h4> 
<p>git clone https://github.com/GENIVI/dlt-daemon.git</p> 
<pre><code>cd dlt-daemon/
mkdir build
cd build/
cmake ..
make
</code></pre> 
<h4><a id="dltdaemon_29"></a>编译dlt-daemon错误</h4> 
<pre><code>/usr/include/x86_64-linux-gnu/bits/string_fortified.h:106:10: error: ‘__builtin_strncpy’ specified bound 10 equals destination size [-Werror=stringop-truncation]
</code></pre> 
<pre><code>vi /home/hippo/CommonAPI/dlt-daemon/src/console/dlt-control-common.c
把size改成 size - 1
</code></pre> 
<pre><code>make
sudo make install
sudo ldconfig

</code></pre> 
<h4><a id="capicxxcoreruntime_51"></a>第二次编译capicxx-core-runtime</h4> 
<p>安装依赖模块</p> 
<pre><code>  sudo apt-get install doxygen
  sudo apt-get install graphviz
  sudo apt-get install doxygen-doc doxygen-gui
  sudo apt-get install asciidoc fop
</code></pre> 
<h4><a id="capicxxcoreruntime_62"></a>第三次编译capicxx-core-runtime</h4> 
<pre><code>cmake ..
sudo make install
sudo ldconfig
</code></pre> 
<h3><a id="CommonAPI_someip_70"></a>安装CommonAPI someip</h3> 
<pre><code>git clone https://github.com/GENIVI/capicxx-someip-runtime.git
cd capicxx-someip-runtime
mkdir build &amp;&amp; cd build
cmake -D USE_INSTALLED_COMMONAPI=ON -D CMAKE_INSTALL_PREFIX=/usr/local ..
make
sudo make install
</code></pre> 
<h3><a id="vsomeip_83"></a>安装vsomeip</h3> 
<h4><a id="vsomeip_85"></a>获取vsomeip</h4> 
<pre><code>git clone https://github.com/COVESA/vsomeip.git
</code></pre> 
<h4><a id="_93"></a>安装依赖包</h4> 
<pre><code>sudo apt-get install source-highlight
sudo apt-get install libboost-system1.71-dev libboost-thread1.71-dev libboost-log1.71-dev
sudo apt-get install libsystemd-dev

cd vsomeip/
mkdir build
cd build/
cmake ..
</code></pre> 
<h4><a id="_106"></a>编译错误</h4> 
<pre><code>CMake Warning at examples/hello_world/CMakeLists.txt:35 (find_package):
  By not providing "Findvsomeip3.cmake" in CMAKE_MODULE_PATH this project has
  asked CMake to find a package configuration file provided by "vsomeip3",
  but CMake did not find one.

  Could not find a package configuration file provided by "vsomeip3" with any
  of the following names:

    vsomeip3Config.cmake
    vsomeip3-config.cmake

  Add the installation prefix of "vsomeip3" to CMAKE_PREFIX_PATH or set
  "vsomeip3_DIR" to a directory containing one of the above files.  If
  "vsomeip3" provides a separate development package or SDK, be sure it has
  been installed.

</code></pre> 
<h4><a id="_127"></a>修改编译命令</h4> 
<p>增加 -DCMAKE_INSTALL_PREFIX=/usr/local为编译安装目录</p> 
<pre><code>cmake -DENABLE_SIGNAL_HANDLING=1 -DCMAKE_INSTALL_PREFIX=/usr/local  -DDIAGNOSIS_ADDRESS=0x10 ..
make
sudo make install
sudo ldconfig
</code></pre> 
<h4><a id="commonapi_coretools_generator_138"></a>获取commonapi_core-tools_generator</h4> 
<pre><code>下载https://github.com/COVESA/capicxx-core-tools/releases/

解压

设置link

sudo ln -s ~/CommonAPI/code_generator/commonapi_core_generator/commonapi-core-generator-linux-x86_64 /usr/bin/commonapi-core-generator-linux-x86_64


生成代码
 commonapi-core-generator-linux-x86_64 -sk fidl/E02Attributes.fidl
</code></pre> 
<h4><a id="commonapi_someip_generator_156"></a>获取commonapi_someip_generator</h4> 
<pre><code>下载 https://github.com/COVESA/capicxx-someip-tools/releases/

解压

设置link

sudo ln -s ~/CommonAPI/code_generator/commonapi_someip_generator/commonapi-someip-generator-linux-x86_64 /usr/bin/commonapi-someip-generator-linux-x86_64

生成代码
commonapi-someip-generator-linux-x86_64 -ll verbose fidl/E02Attributes-SomeIP.fdepl
</code></pre> 
<h4><a id="Helloworld_171"></a>编译Helloworld</h4> 
<p>修改CmakeList文件</p> 
<pre><code># Copyright (C) 2015 Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

cmake_minimum_required(VERSION 2.8)
project(E01HelloWorld)

#set(PROJECT_NAME E01HelloWorld)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -pthread -std=c++11")

#set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pthread -Wall -O0 -std=c++11 -D_GLIBCXX_USE_NANOSLEEP -DLINUX")


# CommonAPI
include(FindPkgConfig)

# SOME/IP
find_package (CommonAPI 3.2.0 REQUIRED)
find_package (CommonAPI-SomeIP 3.2.0 REQUIRED)
find_package (vsomeip3 3.1.0 REQUIRED)

message(STATUS "COMMONAPI_INCLUDE_DIRS: ${COMMONAPI_INCLUDE_DIRS}")
message(STATUS "vsomeip3_INCLUDE_DIRS: ${VSOMEIP_INCLUDE_DIRS}")
message(STATUS, "COMMONAPI_SOMEIP_INCLUDE_DIRS: ${COMMONAPI_SOMEIP_INCLUDE_DIRS}")

# Source Files
set(PRJ_SRC_PATH src)
set(PRJ_SRC_GEN_PATH src-gen)

include_directories(
    ${PRJ_SRC_PATH}
    ${PRJ_SRC_GEN_PATH}
    ${COMMONAPI_INCLUDE_DIRS}
    ${COMMONAPI_SOMEIP_INCLUDE_DIRS}
    ${VSOMEIP_INCLUDE_DIRS}
)

set(PRJ_NAME_CLIENT ${PROJECT_NAME}Client)
set(PRJ_NAME_SERVICE ${PROJECT_NAME}Service)

message(STATUS, "PRJ_NAME_CLIENT: ${PRJ_NAME_CLIENT}")
message(STATUS, "PRJ_NAME_SERVICE: ${PRJ_NAME_SERVICE}")

# Source Files

set(PRJ_SRC_GEN_COMMONAPI_PATH ${PRJ_SRC_GEN_PATH}/v0/commonapi/examples)

# Application
FILE(GLOB PRJ_PROXY_GEN_SRCS ${PRJ_SRC_GEN_COMMONAPI_PATH}/*Proxy.cpp)
FILE(GLOB PRJ_DEPOLYMENT_GEN_SRCS ${PRJ_SRC_GEN_COMMONAPI_PATH}/*Deployment.cpp)
FILE(GLOB PRJ_STUB_GEN_SRCS ${PRJ_SRC_GEN_COMMONAPI_PATH}/*Stub*.cpp)
FILE(GLOB PRJ_STUB_IMPL_SRCS ${PRJ_SRC_PATH}/*Stub*.cpp)

set(PRJ_CLIENT_SRCS ${PRJ_SRC_PATH}/${PRJ_NAME_CLIENT}.cpp ${PRJ_PROXY_GEN_SRCS})
set(PRJ_SERVICE_SRCS ${PRJ_SRC_PATH}/${PRJ_NAME_SERVICE}.cpp ${PRJ_SRC_PATH}/${PRJ_NAME}StubImpl.cpp ${PRJ_STUB_GEN_SRCS} ${PRJ_STUB_IMPL_SRCS})

# Boost
find_package( Boost 1.54 COMPONENTS system thread log REQUIRED )
include_directories( ${Boost_INCLUDE_DIR} )

add_executable(${PRJ_NAME_CLIENT}
    ${PRJ_SRC_PATH}/${PRJ_NAME_CLIENT}.cpp
    ${PRJ_PROXY_GEN_SRCS}
    ${PRJ_DEPOLYMENT_GEN_SRCS}
)

target_link_libraries(${PRJ_NAME_CLIENT} CommonAPI CommonAPI-SomeIP vsomeip3)

add_executable(${PRJ_NAME_SERVICE}
    ${PRJ_SRC_PATH}/${PRJ_NAME_SERVICE}.cpp
    ${PRJ_STUB_IMPL_SRCS}
    ${PRJ_STUB_GEN_SRCS}
    ${PRJ_DEPOLYMENT_GEN_SRCS}
)

target_link_libraries(${PRJ_NAME_SERVICE} CommonAPI CommonAPI-SomeIP vsomeip3)


</code></pre> 
<h4><a id="HelloWorld_257"></a>运行HelloWorld</h4> 
<pre><code>启动service
./E01HelloWorldService  VSOMEIP_CONFIGURATION=…/vsomeip-local.json VSOMEIP_APPLICATION_NAME=service-sample

启动client
./E01HelloWorldClient VSOMEIP_CONFIGURATION=…/vsomeip-local.json VSOMEIP_APPLICATION_NAME=client-sample

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f859063ceab1182e84f96317bc33ae35/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">无法ping 通华为云ECS服务器公网IP的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/271c30d8a86cb0c1743df056844fa399/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">修复远程桌面显示“你的凭据不工作”的四种方法！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>