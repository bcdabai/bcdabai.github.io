<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch及ELK使用（二）：日志数据采集 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch及ELK使用（二）：日志数据采集" />
<meta property="og:description" content="1 继续安装ELK 上文已经安装了ELK三大件中的两个软件elasticsearch和kibana。 在此基础上，在同一个机器上再安装logstash， 完成三大件的安装。
（非root用户）登录linux，下载最新的logstash安装包 下载地址https://www.elastic.co/cn/downloads/elasticsearch 。然后解压即可
cd /home/zyplanke/elk curl -L -O https://artifacts.elastic.co/downloads/logstash/logstash-6.8.3.tar.gz tar -xvf logstash-6.8.3.tar.gz 2 安装filebeat filebeat通常与日志源服务器放同一台机器上。因此我们在另一台跑业务（有业务日志）的Linux机器上安装filebeat。
如果是收集业务系统的日志，确保filebeat对日志文件具有读权限。
登录业务系统（通常可使用业务系统的用户）载最新的filebeat安装包 下载地址https://www.elastic.co/cn/downloads/elasticsearch
cd /home/zyplanke/elk curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.8.3-linux-x86_64.tar.gz tar -xvf filebeat-6.8.3-linux-x86_64.tar.gz 3 配置日志文件采集 filebeat从日志源采集日志数据，通过网络发给logstash，logstash将数据进行处理后发给elasticsearch。
前面已经将elasticsearch和kibana，下面分别配置filebeat和logstash。
3.1 配置filebeat 编辑filebeat.yml, 内容如下
filebeat.inputs: - type: log enabled: true paths: - /var/log/*.log fields: logcategory: oslog #output.elasticsearch: 由于我们filebeat不直接发给elasticsearch，所有注释本配置。 # hosts: [&#34;localhost:9200&#34;] output.logstash: hosts: [&#34;192.168.43.201:5044&#34;] 上面的filebeat配置：
input表示，filebeat从指定的目录和文件作为采集的日志源(路径和文件名支持星号模糊匹配。 注意必须有被采集文件的读权限)。必须enabled为true，否则不生效。 可以配置多个input。而fields是自己定义的字段（并赋值），方便后续处理。output表示，filebeat将采集的日志（加上fileds、tag及其他属性）后，将起传输到logstash 3.2 配置logstash 在config目录中，以复制logstash-sample.conf样例文件，得到文件logstash_file.conf。
编辑config/logstash_file.conf，内容如下
input { beats { port =&gt; 5044 } } output { elasticsearch { hosts =&gt; [&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f8d2a76a3da302ff103596e5302a2d10/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-27T14:42:04+08:00" />
<meta property="article:modified_time" content="2023-09-27T14:42:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch及ELK使用（二）：日志数据采集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_ELK_0"></a>1 继续安装ELK</h2> 
<p>上文已经安装了ELK三大件中的两个软件elasticsearch和kibana。 在此基础上，在同一个机器上再安装logstash， 完成三大件的安装。</p> 
<ol><li> <p>（非root用户）登录linux，下载最新的logstash安装包 下载地址<a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="nofollow">https://www.elastic.co/cn/downloads/elasticsearch</a> 。然后解压即可</p> <pre><code>cd /home/zyplanke/elk
curl -L -O https://artifacts.elastic.co/downloads/logstash/logstash-6.8.3.tar.gz
tar -xvf logstash-6.8.3.tar.gz
</code></pre> </li></ol> 
<h2><a id="2_filebeat_12"></a>2 安装filebeat</h2> 
<p>filebeat通常与日志源服务器放同一台机器上。因此我们在另一台跑业务（有业务日志）的Linux机器上安装filebeat。</p> 
<p>如果是收集业务系统的日志，确保filebeat对日志文件具有读权限。</p> 
<ol><li> <p>登录业务系统（通常可使用业务系统的用户）载最新的filebeat安装包 下载地址<a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="nofollow">https://www.elastic.co/cn/downloads/elasticsearch</a></p> <pre><code>cd /home/zyplanke/elk
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.8.3-linux-x86_64.tar.gz
tar -xvf filebeat-6.8.3-linux-x86_64.tar.gz
</code></pre> </li></ol> 
<h2><a id="3__26"></a>3 配置日志文件采集</h2> 
<p>filebeat从日志源采集日志数据，通过网络发给logstash，logstash将数据进行处理后发给elasticsearch。</p> 
<p>前面已经将elasticsearch和kibana，下面分别配置filebeat和logstash。</p> 
<h3><a id="31_filebeat_32"></a>3.1 配置filebeat</h3> 
<p>编辑filebeat.yml, 内容如下</p> 
<pre><code>filebeat.inputs:
- type: log
  enabled: true
  paths: 
   - /var/log/*.log
  fields:
  	logcategory: oslog

#output.elasticsearch:        由于我们filebeat不直接发给elasticsearch，所有注释本配置。
#  hosts: ["localhost:9200"]


output.logstash:
  hosts: ["192.168.43.201:5044"]
</code></pre> 
<p>上面的filebeat配置：</p> 
<ul><li>input表示，filebeat从指定的目录和文件作为采集的日志源(路径和文件名支持星号模糊匹配。 注意必须有被采集文件的读权限)。必须enabled为true，否则不生效。 可以配置多个input。</li><li>而fields是自己定义的字段（并赋值），方便后续处理。</li><li>output表示，filebeat将采集的日志（加上fileds、tag及其他属性）后，将起传输到logstash</li></ul> 
<h3><a id="32_logstash_61"></a>3.2 配置logstash</h3> 
<p>在config目录中，以复制logstash-sample.conf样例文件，得到文件logstash_file.conf。</p> 
<p>编辑config/logstash_file.conf，内容如下</p> 
<pre><code>input {
  beats {
    port =&gt; 5044
  }
}

output {
  elasticsearch {
    hosts =&gt; ["http://192.168.43.201:9200"]
    index =&gt; "%{[fields][logcategory]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"
    #user =&gt; "elastic"
    #password =&gt; "changeme"
  }
}
</code></pre> 
<p>上面logstash_file.conf配置的：</p> 
<ul><li>input：logstash从filebeat接收数据的本地端口。</li><li>filter（可选）：进行转换改变</li><li>output：logstash结果传输到哪里（这里定义为传输到elasticsearch，若elasticsearch集群有多个节点则hosts内容应多个）。同时配置了索引名。注意这里使用了filebeat自定义字段。</li></ul> 
<h3><a id="33__90"></a>3.3 启动</h3> 
<ol><li>启动logstash。</li></ol> 
<pre><code>./logstash -f ../config/logstash_file.conf
</code></pre> 
<p>启动需要多等一小会。</p> 
<ol start="2"><li>启动filebeat。 ./filebeat -e -c 配置文件名 -e输出到标准输出，默认输出到syslog和logs下 -c 指定配置文件</li></ol> 
<pre><code>./filebeat -e -c filebeat.yml
</code></pre> 
<p>默认filebeat会在当前目录创建data目录，里面存放了每个采集文件的名字和坐标（偏移量），这样可以在filebeat重启后支持断点续传。</p> 
<p>如果希望filebeat全部重新传输，则可以把filebeat下整个data目录删除（可能在elasticsearch中也要删除。），让filebeat觉得从来都没有传输过。<br> <strong>附：为了便于filebeat的启停管理，写了一个名为：run_filebeat.sh的Shell脚本供使用</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">##################################################################################</span>
<span class="token comment"># desc:    FileBeat运行管理脚本</span>
<span class="token comment">###################################################################################</span>
<span class="token assign-left variable">CURR_PWD</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span> <span class="token parameter variable">-P</span><span class="token variable">`</span></span>

<span class="token function-name function">Usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token builtin class-name">echo</span> <span class="token string">"*******************************************************"</span>
	<span class="token builtin class-name">echo</span> <span class="token string">" Usage: "</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $0<span class="token variable">`</span></span>            : print this usage info "</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $0<span class="token variable">`</span></span> show       : show current running process "</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $0<span class="token variable">`</span></span> start      : start process"</span>    		
	<span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $0<span class="token variable">`</span></span> stop       : stop process"</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $0<span class="token variable">`</span></span> kill       : froce kill process"</span>
	<span class="token builtin class-name">echo</span> <span class="token string">""</span>
	<span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">#判断参数的参数个数，如果不符合要求，则输出用法提示</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-ne</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>   
    Usage
<span class="token keyword">fi</span> 

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
	<span class="token string">"show"</span><span class="token punctuation">)</span>  <span class="token comment"># 显示当前正运行的进程</span>
	  <span class="token builtin class-name">echo</span> <span class="token string">""</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" Currently, running processes as follows....."</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"*******************************************************"</span>
		<span class="token comment">#ps -f | head -1</span>
		<span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-u</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"filebeat"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"grep"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span>  <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-r</span> pwdx <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">${CURR_PWD}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-r</span> <span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-p</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"grep"</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"*******************************************************"</span>
		<span class="token builtin class-name">echo</span> <span class="token string">""</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>	
		
	<span class="token string">"start"</span><span class="token punctuation">)</span>
		<span class="token function">nohup</span> <span class="token variable">${CURR_PWD}</span>/filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat.yml <span class="token operator">&amp;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" starting...  "</span>
		<span class="token function">sleep</span> <span class="token number">1</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" Please check the result via logs files or nohup.out!"</span>
		<span class="token builtin class-name">echo</span> <span class="token string">""</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
		
	<span class="token string">"stop"</span><span class="token punctuation">)</span>
		<span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-u</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"filebeat"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"grep"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span>  <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-r</span> pwdx <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">${CURR_PWD}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-r</span> <span class="token function">kill</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" stoping...  "</span>
		<span class="token function">sleep</span> <span class="token number">1</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" Please check the result by yourself!"</span>
		<span class="token builtin class-name">echo</span> <span class="token string">""</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token string">"kill"</span><span class="token punctuation">)</span>
		<span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-u</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"filebeat"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"grep"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span>  <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-r</span> pwdx <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">${CURR_PWD}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-r</span> <span class="token function">kill</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
		<span class="token function">sleep</span> <span class="token number">5</span>
		<span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-u</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"filebeat"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"grep"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span>  <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-r</span> pwdx <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">${CURR_PWD}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-r</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	*<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">" input error!!! "</span>
		Usage
		<span class="token punctuation">;</span><span class="token punctuation">;</span>	
<span class="token keyword">esac</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre> 
<h3><a id="34__174"></a>3.4 检查结果</h3> 
<p>当filebeat、logstash、elasticsearch、kibana都启动后。日志会自动采集，并存放到elasticsearch中。通过kibana可以查看结果：<br> <img src="https://images2.imgbox.com/48/54/zNBePcvT_o.png" alt="在这里插入图片描述"></p> 
<p>注意：该index的health为yellow是因为，logstash向elasticsearch创建index时指定了number_of_replicas=1，既处理主数据外至少还需要一个副本。</p> 
<p>而elasticsearch要求副本应分散在不同的节点node上，这样安全避免单节点故障而丢失数据。因本环境elasticsearch只有一个node，所有health为yellow。如果把该index的设置Setting中，“number_of_replicas” 改为 “0”。则health就会变为green。</p> 
<h3><a id="35__185"></a>3.5 搜索结果（文档）</h3> 
<p>在源日志中，有/var/log/vmware-vmsvc.log日志文件，该文件里面的数据为：<br> <img src="https://images2.imgbox.com/b3/ea/YOKHeeHu_o.png" alt="在这里插入图片描述"></p> 
<p>在kibana里“Dev Tools”中通过RESTfull API 模糊搜索</p> 
<pre><code>GET /oslog-6.8.3-2020.06.25/_search
{
  "query": { "match": { "log.file.path": "vmsvc.log" } },
  "sort": [
    {
      "@timestamp": {
        "order": "asc"
      }
    }
  ]
}
</code></pre> 
<p>搜索结果如下图，在message集中就是vmware-vmsvc.log的日志内容。<br> <img src="https://images2.imgbox.com/50/80/yXcl8HcT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="36__210"></a>3.6 字段拆分过滤</h3> 
<ol><li>上面的message是日志的每一行，实际上日志每行的内容是有规律的，可以进行切割，以便精确的进行分析。</li></ol> 
<p>其他不变。编辑config/logstash_file.conf，增加filter内容如下</p> 
<pre><code>input {
  beats {
    port =&gt; 5044
  }
}

filter {
    mutate {
      split =&gt; {"message"=&gt;"Z]"}
    }
    mutate {
        add_field =&gt; {
         "datetime" =&gt; "%{[message][0]}"
         "msg" =&gt; "%{[message][1]}"
        }
    }
    mutate {
       convert =&gt; {
          "datetime" =&gt; "string"
          "msg" =&gt; "string"
        }
    }
    mutate {
       lowercase =&gt; ["[fields][logcategory]"]
    }
}

output {
  elasticsearch {
    hosts =&gt; ["http://localhost:9200"]
    index =&gt; "%{[fields][logcategory]}-aftersplit-%{+YYYY.MM.dd}"
    #user =&gt; "elastic"
    #password =&gt; "changeme"
  }
}
</code></pre> 
<p>mutate（该单词意思为变化）：</p> 
<ul><li>split：指定对什么内容进行切割，并指定分隔符。</li><li>add_field：增加哪些自定义字段，而且设置了其值从获得（从切割后的数组中获得）</li><li>convert：将字段转换为什么类型。</li><li>lowercase: 将指定的字段中的值转为小写。因为elasticsearch中的index名只允许为小写。</li></ul> 
<ol start="2"><li>启动logstash。</li></ol> 
<pre><code>./logstash -f ../config/logstash_file.conf
</code></pre> 
<p>启动需要多等一小会。</p> 
<ol start="3"><li> <p>启动filebeat。</p> <p>默认filebeat会在当前目录创建data目录，里面存放了每个采集文件的名字和坐标（偏移量），这样可以在filebeat重启后支持断点续传。</p> <p>如果希望filebeat全部重新传输，则可以把filebeat下整个data目录删除（可能在elasticsearch中也要删除。），让filebeat觉得从来都没有传输过。</p> </li></ol> 
<pre><code>rm data
./filebeat -e -c filebeat.yml
</code></pre> 
<p><strong>搜索结果（文档）</strong></p> 
<p>在kibana里“Dev Tools”中通过RESTfull API 模糊搜索（根据logstash的配置，index的名字为：oslog-aftersplit-2020.06.25）</p> 
<pre><code>GET /oslog-aftersplit-2020.06.25/_search
{
  "query": { "match": { "log.file.path": "vmsvc.log" } },
  "sort": [
    {
      "@timestamp": {
        "order": "asc"
      }
    }
  ]
}
</code></pre> 
<p>搜索结果如下图，可以看到拆分后的字段：datatime和msg已经正确的赋值。。<br> <img src="https://images2.imgbox.com/a9/4d/Q26O8dfp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="37_index_setting_305"></a>3.7 修改index默认设置_setting</h3> 
<p>以上通过logstash在elasticsearch中创建的索引，都是默认设置的属性。 如果希望改变logstash在elasticsearch创建的索引设置，例如number_of_shards、number_of_replicas等等。 我们不能直接在logstash.conf文件中配置（因为没有直接的选项）。而是：<br> 1、先创建一个<code>template.json</code>文件，在文件中编辑一下内容：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"template"</span> <span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"settings"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string-property property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2、然后在logstash.conf文件中增加<code>template</code>、<code>template_overwrite</code>两项配置。类似如下：</p> 
<pre><code class="prism language-bash">  <span class="token punctuation">(</span>省略其他<span class="token punctuation">)</span>
output <span class="token punctuation">{<!-- --></span>
 elasticsearch <span class="token punctuation">{<!-- --></span>
   hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">]</span>
   index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"%{[fields][logcategory]}-aftersplit-%{+YYYY.MM.dd}"</span>
   template <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"/home/zyplanke/elk/logstash-6.8.3/config/template.json"</span>
   template_overwrite <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"true"</span>
   <span class="token comment">#user =&gt; "elastic"</span>
   <span class="token comment">#password =&gt; "changeme"</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">(</span>省略其他<span class="token punctuation">)</span>
</code></pre> 
<p>3、重启logstash即可，新创建的索引自动会使用<code>template.json</code>文件定义的设置。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1809e1f7582f6392534de00ba8f31946/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring核心 - 执行顺序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20ba35d496e6a7af0cb20749dac7be0a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python 实现动态规划</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>