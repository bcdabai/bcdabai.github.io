<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>can的总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="can的总结" />
<meta property="og:description" content="一.什么是can can就是车用主线，贯穿整个车的存在
can的分类2 默认是高速can
低速容错can
单线can
用两种can会减少can网络语言的负载率，就是原本一个小屋做核酸，现在是两个速度翻倍。可参考均衡负载原理
can的特征 1.节点间采用多主通信方式
即任意节点都可以发送，可以实现点对点发送和全局网络发送
2.采用短帧结构，报文帧的有效字节数为8个，可达汽车实时响应要求
即字节数越少响应速度越快
3.报文ID值越小，优先级越高。报文ID可分成不同的优先级，进一步满足汽车网络报文的实时性要求
4.非破坏性总线仲裁处理机制
即两个报文进行传输，不会只接收一个会根据id大小依次接收
5.可靠的CRC校验方式，传输数据出错率极低，满足汽车数据传输的可靠性要求
6.报文帧仲裁失败或传输期间被破坏有自动重发（机制）
即会将未发送成功的报文进行重新发送
7.节点在错误严重的情况下，具有自动脱离总线的功能，切断它与总线的联系，不影响总线的正常工作
如果一直发送不成功，会自动停止发送
8.通信距离最远达10km（速度5Kbps以下）
距离越远通信质量越差
9.通信速率最高1MB/s
距离越近速率越快
10.节点数实际可达110个
11.CAN节点设计成本较低，通信介质采用双绞线
can的收发器 can收发器定义：can收发器逻辑信号和物理信号之间的转换采用差分电平方式
1.将逻辑数字信号转化成物理信号
2.将物理信号转换成逻辑数字信号
can的模式 can高can低
即高速can和低速can，高速can系统采用硬线是动力型，速度快，适用于ABS、控制ECU等
低速can是舒适型，速度相对较慢，主要是控制仪表、防盗等
can信号电平 显性即差压过高然后为零 差压大于0.9v显零
隐形即无差压或者差压过低 差压小于0.5v隐1
显性0，隐性1
can编码方式 采用非归零编码
CAN编码采用NRZ非归零编码，相同带宽情况下，NRZ编码信息量比曼彻斯特编码更大
can信号电平之线与原理 多个can节点并接到同一个总线时，只要其中一个节点输出低电平，总线就为低电平；当所有节点输出高电平时，总线才为高电平
can的异步串行通信 can报文同步采用时钟线采样数据
can报文异步采用采样点按照约定的频率区采样数据
异步串行通信省去了时钟信号线，但遇到一个问题是：根据波特率做采样，波特率的误差会产生通信错误
波特率采样点每次出现一点偏差，后面偏差越来越大
can的采样点 一个标称的位时间=1/波特率
为时间分为：同步端、传播段、相位缓冲段1、相位缓冲段2
采样点在相位缓冲段1和2中提取采样
(C:\Users\10345\AppData\Roaming\Typora\typora-user-images\image-20221008212112517.png)]
1000=1024k 1位相当于一微妙
can的终端电阻与连接器 根据电磁场
和微波理论，高频电路中负载阻抗需与传输线的特性阻抗一致，否则电信号在线束端遭遇阻抗突变，产生反射现象，造成波形震荡
信号反射造成的信号不完整性，是属于直接将数据反射，不管数据反射到哪里
解决：反射都在首端或者末端进行数据传输，因此在首尾加上120欧姆，加在中间不推荐，有可能反射不到
协议推荐：
默认协议，但是根据制造商的设定，会有偏差[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ek2aAoEn-1665659904917)(C:%5CUsers%5C10345%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221009194714109.png#pic_center)]
can终端电阻和线缆 不符合要求会造成总线波形不好之类的，影响通信
can节点物理结构 1.can控制器/收发器 分别对应ISO/OSI模型的数据链路层和物理层，完成CAN报文的收发" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d095dfa8fc6c89a1a07bbb9d8748e1c9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T13:15:05+08:00" />
<meta property="article:modified_time" content="2023-12-29T13:15:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">can的总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="can_0"></a>一.什么是can</h3> 
<p>can就是车用主线，贯穿整个车的存在</p> 
<h4><a id="can2_4"></a>can的分类2</h4> 
<p>默认是高速can</p> 
<p>低速容错can</p> 
<p>单线can</p> 
<p>用两种can会减少can网络语言的负载率，就是原本一个小屋做核酸，现在是两个速度翻倍。可参考均衡负载原理</p> 
<h4><a id="can_14"></a>can的特征</h4> 
<p>1.节点间采用多主通信方式</p> 
<p>即任意节点都可以发送，可以实现点对点发送和全局网络发送</p> 
<p>2.采用短帧结构，报文帧的有效字节数为8个，可达汽车实时响应要求</p> 
<p>即字节数越少响应速度越快</p> 
<p>3.报文ID值越小，优先级越高。报文ID可分成不同的优先级，进一步满足汽车网络报文的实时性要求</p> 
<p>4.非破坏性总线仲裁处理机制</p> 
<p>即两个报文进行传输，不会只接收一个会根据id大小依次接收</p> 
<p>5.可靠的CRC校验方式，传输数据出错率极低，满足汽车数据传输的可靠性要求</p> 
<p>6.报文帧仲裁失败或传输期间被破坏有自动重发（机制）</p> 
<p>即会将未发送成功的报文进行重新发送</p> 
<p>7.节点在错误严重的情况下，具有自动脱离总线的功能，切断它与总线的联系，不影响总线的正常工作</p> 
<p>如果一直发送不成功，会自动停止发送</p> 
<p>8.通信距离最远达10km（速度5Kbps以下）</p> 
<p>距离越远通信质量越差</p> 
<p>9.通信速率最高1MB/s</p> 
<p>距离越近速率越快</p> 
<p>10.节点数实际可达110个</p> 
<p>11.CAN节点设计成本较低，通信介质采用双绞线</p> 
<h4><a id="can_52"></a>can的收发器</h4> 
<p>can收发器定义：can收发器逻辑信号和物理信号之间的转换采用差分电平方式</p> 
<p>1.将逻辑数字信号转化成物理信号</p> 
<p>2.将物理信号转换成逻辑数字信号</p> 
<h4><a id="can_60"></a>can的模式</h4> 
<p>can高can低</p> 
<p>即高速can和低速can，高速can系统采用硬线是动力型，速度快，适用于ABS、控制ECU等</p> 
<p>低速can是舒适型，速度相对较慢，主要是控制仪表、防盗等</p> 
<h4><a id="can_68"></a>can信号电平</h4> 
<p>显性即差压过高然后为零 差压大于0.9v显零</p> 
<p>隐形即无差压或者差压过低 差压小于0.5v隐1</p> 
<p>显性0，隐性1</p> 
<h4><a id="can_76"></a>can编码方式</h4> 
<p>采用非归零编码</p> 
<p>CAN编码采用NRZ非归零编码，相同带宽情况下，NRZ编码信息量比曼彻斯特编码更大</p> 
<h4><a id="can_82"></a>can信号电平之线与原理</h4> 
<p>多个can节点并接到同一个总线时，只要其中一个节点输出低电平，总线就为低电平；当所有节点输出高电平时，总线才为高电平</p> 
<h4><a id="can_86"></a>can的异步串行通信</h4> 
<p>can报文同步采用时钟线采样数据</p> 
<p>can报文异步采用采样点按照约定的频率区采样数据</p> 
<p>异步串行通信省去了时钟信号线，但遇到一个问题是：根据波特率做采样，波特率的误差会产生通信错误</p> 
<p>波特率采样点每次出现一点偏差，后面偏差越来越大</p> 
<h4><a id="can_96"></a>can的采样点</h4> 
<p>一个标称的位时间=1/波特率</p> 
<p>为时间分为：同步端、传播段、相位缓冲段1、相位缓冲段2</p> 
<p>采样点在相位缓冲段1和2中提取采样<br> (C:\Users\10345\AppData\Roaming\Typora\typora-user-images\image-20221008212112517.png)]<br> <img src="https://images2.imgbox.com/4f/1b/ySrEg6IB_o.png" alt="在这里插入图片描述"><br> 1000=1024k 1位相当于一微妙</p> 
<h4><a id="can_107"></a>can的终端电阻与连接器</h4> 
<p>根据电磁场</p> 
<p>和微波理论，高频电路中负载阻抗需与传输线的特性阻抗一致，否则电信号在线束端遭遇阻抗突变，产生反射现象，造成波形震荡</p> 
<p>信号反射造成的信号不完整性，是属于直接将数据反射，不管数据反射到哪里<br> <img src="https://images2.imgbox.com/5c/e5/WHj9uBWs_o.png" alt="在这里插入图片描述"></p> 
<p>解决：反射都在首端或者末端进行数据传输，因此在首尾加上120欧姆，加在中间不推荐，有可能反射不到</p> 
<p><img src="https://images2.imgbox.com/9d/3f/3mIetXp7_o.png" alt="在这里插入图片描述"><br> 协议推荐：</p> 
<p>默认协议，但是根据制造商的设定，会有偏差[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ek2aAoEn-1665659904917)(C:%5CUsers%5C10345%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221009194714109.png#pic_center)]</p> 
<p><img src="https://images2.imgbox.com/c6/a0/nNLzsToq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="can_126"></a>can终端电阻和线缆</h4> 
<p>不符合要求会造成总线波形不好之类的，影响通信<br> <img src="https://images2.imgbox.com/4e/9d/Tgf4Cw52_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="can_133"></a>can节点物理结构</h4> 
<h5><a id="1can_135"></a>1.can控制器/收发器</h5> 
<p>分别对应ISO/OSI模型的数据链路层和物理层，完成CAN报文的收发</p> 
<h5><a id="2_139"></a>2.功能电路</h5> 
<p>完成特定的功能，如信号采集或控制外设等</p> 
<h5><a id="3_143"></a>3.主控制器与应用软件</h5> 
<ul><li>控制各个硬件部件工作</li><li>按照CAN报文使用规则解析CAN报文；</li><li>采集并发送数据等<br> <img src="https://images2.imgbox.com/03/1f/lB01yZsT_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="CAN_150"></a>二.CAN报文</h3> 
<h4><a id="1CAN_152"></a>1.CAN报文帧种类</h4> 
<ul><li>数据帧 用于发送节点向接收节点传送数据，是使用最多的帧类型</li><li>远程帧 用于接收节点向某个发送节点请求数据</li><li>错误帧 用于当某节点检测出错误时向其他节点通知错误的帧</li><li>过载帧 用于接收节点向发送节点通知自身接收能力的帧</li><li>帧间隔 将数据帧或远程帧与前面的帧分离的帧</li></ul> 
<h4><a id="2_160"></a>2.数据帧：标准帧和扩展帧</h4> 
<p><img src="https://images2.imgbox.com/f9/fd/4uTBcEPk_o.png" alt="在这里插入图片描述"></p> 
<p>标准帧和扩展帧的帧起始，SOF，由一个显性位组成</p> 
<p>在总线空闲的时候，发送节点发出帧起始，其他接收节点从这个帧起始位进行同步</p> 
<p><img src="https://images2.imgbox.com/c9/9b/YQO7Y8Dl_o.png" alt="在这里插入图片描述"><br> 控制段主要是数据长度<br> <img src="https://images2.imgbox.com/ec/c3/qmDrNmer_o.png" alt="在这里插入图片描述"><br> 数据段最多八个字节<br> Data：Byt0-Byte7 传输时首先发送MSB（最高位）<br> <img src="https://images2.imgbox.com/b2/16/PVb9AX6r_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/24/28/hPDsdHpB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7b/4e/yZssZ6vy_o.png" alt="在这里插入图片描述"><br> 帧结束如果连续11个隐性位组成，就代表帧空闲<br> <img src="https://images2.imgbox.com/4d/2a/rJhhrly2_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/f8/f3/lrxn388P_o.png" alt="在这里插入图片描述"><br> 全部加起来是108位<br> 特殊情况:如果有位填充，那就要在加<br> <img src="https://images2.imgbox.com/af/12/YaUnoGd4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3CAN_180"></a>3.CAN总线竞争与仲裁机制</h4> 
<p>CAN总线有多个节点同时要发送数据，谁先发送那？</p> 
<p>CAN总线非破坏性仲裁机制</p> 
<ul><li>仲裁发生在仲裁段</li><li>采用“线与”机制</li><li>ID值越小，优先级越高</li><li>仲裁失败进入“只听”模式</li></ul> 
<p>用相同的轨道，有序就是非破坏性仲裁机制</p> 
<h5><a id="httpsimgblogcsdnimgcne37f52da16ed47bba01fab24a5bac736pngpic_center_193"></a>非破坏仲裁机制的前提<img src="https://images2.imgbox.com/f4/58/tEjnaJe1_o.png" alt="在这里插入图片描述"></h5> 
<p>检测到的数据与另一条数据相遇后，被另一条数据覆盖</p> 
<p>如果发生在其他六个段，则会报错</p> 
<h5><a id="_198"></a>仲裁的线与机制</h5> 
<p><img src="https://images2.imgbox.com/17/67/MZzfabqJ_o.png" alt="在这里插入图片描述"><br> 显性0，隐性1</p> 
<p>仲裁段的节点Bid第五位是隐性</p> 
<p>节点A、C的为显性，总线电平为显性，节点B退出总线竞争</p> 
<p>节点C的ID第三位是隐形</p> 
<p>节点A的为显性，总线电平为显性，节点C退出总线竞争</p> 
<p>如果有报文正在发送，是无法插入破坏这个帧的</p> 
<h3><a id="CAN_215"></a>三、CAN节点状态与错误处理机制</h3> 
<h4><a id="CAN_217"></a>CAN错误类型</h4> 
<p>**1.CRC错误：**接收节点计算的CRC值与发送CRC值不同</p> 
<p>**2.位填充错误：**传输信号违反“位填充”规则</p> 
<p>**3.应答错误：**发送节点在ACK阶段没有接收到应答信号</p> 
<p>**4.位发送错误：**发送节点在发送时总线电平与发送电平不同</p> 
<p>5.**格式错误：**传输的数据帧格式与任何一种合法的帧格式不符</p> 
<h4><a id="_229"></a>错误检测区域</h4> 
<p><img src="https://images2.imgbox.com/f8/35/nL7MyMLO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_231"></a>错误帧</h4> 
<p><img src="https://images2.imgbox.com/74/85/cnz3w485_o.png" alt="在这里插入图片描述"><br> **主动错误：**六个连续的显性电平位（错误标志）加上八个连续的隐形电平位（错误界定符）就是处于主动错误状态的节点发送</p> 
<p>**被动错误：**六个连续的隐性电平位（错误标志）加上八个连续隐性电平位（错误界定符）就是处于被动错误状态的节点发送</p> 
<h4><a id="CANhttpsimgblogcsdnimgcne847be4ed8fd4fb7ad0e26ce1e3a1c3bpngpic_center_237"></a>CAN节点状态<img src="https://images2.imgbox.com/c4/e5/r0nwgxHI_o.png" alt="在这里插入图片描述"></h4> 
<h4><a id="CANhttpsimgblogcsdnimgcnb0dc6f8e6638415f913431299225ed73pngpic_center_238"></a>CAN的错误处理流程<img src="https://images2.imgbox.com/81/d3/lt9Zme36_o.png" alt="在这里插入图片描述"></h4> 
<h3><a id="CAN_239"></a>四、CAN分析仪常用功能有那些</h3> 
<h4><a id="_241"></a>数据链路层测试需求</h4> 
<p>CAN报文检测，报文记录，错误帧记录</p> 
<p>DBC解析信号，线图绘制，仪表板功能</p> 
<p>报文自动化脚本发送等</p> 
<h4><a id="CAN_249"></a>CAN物理层测试需求</h4> 
<p>物理波形测量，CAN波形串行解码，CAN错误位指示等</p> 
<h3><a id="_254"></a>五、问题</h3> 
<h4><a id="1_256"></a>1.为什么要采用两根线（双绞线）的差分电平信号？</h4> 
<p>原因：双绞线传输差分信号时受到共模信号干扰后，电平差值不变，信号解码正常</p> 
<h4><a id="2_260"></a>2.如何减少波特率的误差带来的通信错误?</h4> 
<p>can总线规定信号的跳变沿时刻进行同步，将误差累积限制在两个跳变沿。</p> 
<h4><a id="301_264"></a>3.如果发送的数据都是0或者1，同样不跳变造成误差累积应该怎么办那？</h4> 
<p>发送多个相同位时没有跳变沿用于同步，导致误差不断累计</p> 
<p>解决：采用填充位在连续五个相同位后插入一个相反位，产生跳变沿，用于同步。连续五个0，插入一个1，或者连续五个1，插入一个0</p> 
<p>经过大量实验为五个</p> 
<h4><a id="4CANCANCAN_272"></a>4.CAN节点供电正常,CAN工具就是接收不到CAN报文数据或报错，可能是什么原因？</h4> 
<p>网络上有多个节点的时候就要注意多加终端电阻的问题，会引发短路</p> 
<p>错误类型：为错误、填充错误、格式错误、CRC错误、ACK错误</p> 
<p>主动错误和被动错误、关闭总线三个变换条件</p> 
<h4><a id="5CAN_282"></a>5.测试CAN物理变形，发现报文出现严重的振铃和反射现象？</h4> 
<p>信号传输过程中出现到阻抗的变化，就会发生信号的反射。信号在驱动端和远端负载之间多次反射，其结果就是信号振铃</p> 
<h5><a id="_286"></a>原则：</h5> 
<ul><li>尽量缩短引线长度</li><li>加粗到线、印制铜箔的宽度 通信品质，质量</li><li>减小信号的传输距离 通信品质</li><li>采用引线电感小的元器件等</li><li>阻抗匹配</li></ul> 
<h4><a id="6CAN_294"></a>6.通信错误会不会是CAN收发器故障引起，如何判断收发器的好坏？</h4> 
<p>can收发器的常规检测方法：可以在给ECU上电的CAN总线空闲情况下，测量CANH和CANL对地的电压是否在2.5v左右。如果出现0v或者5v质类的，靠考虑收发器故障问题</p> 
<h4><a id="7CANCAN_298"></a>7.来自相同厂家的两个CAN节点可以通信，为什么两个不同厂家的CAN节点连接通信是好是坏，甚至不能通信？</h4> 
<p>波特率采样点：不同厂家可能使用不能的采样点，也可能是通信不良</p> 
<h4><a id="8ECUCANCANCAN_302"></a>8.所有在测的ECU节点CAN功能单独测试正常，但是装车后发现CAN功能失常，可能仪表紊乱，CAN错误频发，特别是新能源车上？</h4> 
<p>重点考虑<strong>电磁干扰</strong></p> 
<p>选择一个性能好的隔离收发器，或者外部隔离器</p> 
<p>增加CAN线缆双绞程度，保证差模信号被干扰的程度</p> 
<p>步线将动力线缆和CAN线缆远离，抑制周期脉冲干扰</p> 
<p>CAN端适当共模滤波器等浪涌效果好的感性防护器件</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Ki79jrtl-1665659265406)(C:\Users\10345\AppData\Roaming\Typora\typora-user-images\image-20221009203757163.png)]<br> 闲情况下，测量CANH和CANL对地的电压是否在2.5v左右。如果出现0v或者5v质类的，靠考虑收发器故障问题</p> 
<h4><a id="7CANCAN_319"></a>7.来自相同厂家的两个CAN节点可以通信，为什么两个不同厂家的CAN节点连接通信是好是坏，甚至不能通信？</h4> 
<p>波特率采样点：不同厂家可能使用不能的采样点，也可能是通信不良</p> 
<h4><a id="8ECUCANCANCAN_323"></a>8.所有在测的ECU节点CAN功能单独测试正常，但是装车后发现CAN功能失常，可能仪表紊乱，CAN错误频发，特别是新能源车上？</h4> 
<p>重点考虑<strong>电磁干扰</strong></p> 
<p>选择一个性能好的隔离收发器，或者外部隔离器</p> 
<p>增加CAN线缆双绞程度，保证差模信号被干扰的程度</p> 
<p>步线将动力线缆和CAN线缆远离，抑制周期脉冲干扰</p> 
<p>CAN端适当共模滤波器等浪涌效果好的感性防护器件</p> 
<p>[外链图片转存中…(img-Ki79jrtl-1665659265406)]</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f251deec118dbfb4e0f61e38ad4505b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Vue2】倒计时功能（俩小时）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/552de878579663b06dfcf4128482f308/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">鸿蒙应用开发培训笔记02：应用开发入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>