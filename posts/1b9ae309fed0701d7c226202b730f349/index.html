<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>lpa 半监督学习 之--标签传播算法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="lpa 半监督学习 之--标签传播算法" />
<meta property="og:description" content="众所周知，机器学习可以大体分为三大类：监督学习、非监督学习和半监督学习。监督学习可以认为是我们有非常多的labeled标注数据来train一个模型，期待这个模型能学习到数据的分布，以期对未来没有见到的样本做预测。那这个性能的源头--训练数据，就显得非常感觉。你必须有足够的训练数据，以覆盖真正现实数据中的样本分布才可以，这样学习到的模型才有意义。那非监督学习就是没有任何的labeled数据，就是平时所说的聚类了，利用他们本身的数据分布，给他们划分类别。而半监督学习，顾名思义就是处于两者之间的，只有少量的labeled数据，我们试图从这少量的labeled数据和大量的unlabeled数据中学习到有用的信息。
1、社区及社区发现： 网络图内部连接比较紧密的节点子集合对应的子图叫做社区（community），各社区节点集合彼此没有交集的称为非重叠型（disjoint）社区，有交集的称为重叠型（overlapping）社区。对给定的网络图寻找其社区结构的过程称为“社区发现”。大体上看，社区发现的过程就是一种聚类的过程。
2、基本思想 标签传播算法是不重叠社区发现的经典算法，其基本思想是：将一个节点的邻居节点的标签中数量最多的标签作为该节点自身的标签。给每个节点添加标签（label）以代表它所属的社区，并通过标签的“传播”形成同一标签的“社区”结构。
给每个节点添加标签（label）以代表它所属的社区，并通过标签的“传播”形成同一标签的“社区”结构。一个节点的标签取决于它邻居节点的标签：假设节点z的邻居节点有z1至zk，那么哪个社区包含z的邻居节点最多z就属于那个社区（或者说z的邻居中包含哪个社区的标签最多，z就属于哪个社区）。优点是收敛周期短，无需任何先验参数(不需事先指定社区个数和大小)，算法执行过程中不需要计算任何社区指标。
时间复杂度接近线性：对顶点分配标签的复杂度为O(n)，每次迭代时间为O( m)，找出所有社区的复杂度为O (n &#43;m)，但迭代次数难以估计
3、传播过程： 1)初始时，给每个节点一个唯一的标签； 2)每个节点使用其邻居节点的标签中最多的标签来更新自身的标签。 3)反复执行步骤2)，直到每个节点的标签都不再发生变化为止。 一次迭代过程中一个节点标签的更新可以分为同步和异步两种。所谓同步更新，即节点z在第t次迭代的label依据于它的邻居节点在第t-1次迭代时所得的label；异步更新，即节点z在第t次迭代的label依据于第t次迭代已经更新过label的节点和第t次迭代未更新过label的节点在第t-1次迭代时的label。
注： 1、迭代次数设定一个阈值，可以防止过度运算； 2、对于二分图等网络结构，同步更新会引起震荡； //3、类似（“强”社区&gt;）定义的结构（该社区&gt;=）； 4、每个顶点在初始的时候赋予唯一的标签，即“重要性”相同，而迭代过程又采用随机序列，会导致同一初始状态不同结果甚至巨型社区的出现； 5、如果能预测“社区中心”点，能有效提高社区发现的准确度，大幅提高效率； 6、同一节点的邻居节点的标签可能存在多种社区最大数目相同的情况，取“随机”一个作为其标签
4、算法改进思路：初始化或传播改进 1)给节点或边添加权重（势函数、模块密度优化、LeaderRank值、局部拓扑信息的相似度、标签从属系数等），信息熵等描述节点的传播优先度，进而初步确定社区中心点以提高社区划分的精度； 2）标签初始化改进，如提取一些较为紧密的子结构来作为标签传播的初始标签（非重叠最小极大团提取算法 orz。。。）或通过初始社区划分算法先确定社区的雏形再进行传播。 3）标签随机选择改进，将1）中的权值和节点邻接点的度数等作为参考因素，对标签更新过程进行修正。
1)在社区中寻找不重叠三角形作为起始簇的雏形，以提高算法结果的稳定性和运行效率； 2)添加标签熵属性，在迭代过程中不采用随机序列，而是根据每个节点的标签熵来排序序列； 3)在2）的基础上，为了不完全消除标签传播算法的随机性，将排序好的队列平均分成三个部分，在每个部分内，节点进行随机排列。 4)对于同一节点的邻居节点的标签可能存在多种社区最大数目相同的情况，不使用随机方法，而是分析该节点的邻节点的邻节点集标签分布情况来决定该节点的标签 5)在社区中寻找以度最大的若干节点为中心的“雪花型”结构作为起始簇的雏形 在实现的过程中，将上述方案进行组合衍生出更多的可行方案，初步试验结果表明算法的随机性与稳定性很难同时保证，设定起始簇的结构收敛速度快但有可能生成巨型社区；在节点较少的情况下，标签熵的方法准确率和稳定性最好；至于组合方案初步的试验验证发现效果反而下降了。
5、评价标准：社区发现的主要评价指标有Jaccard指数，fsame指数、NMI（规范化交互信息）以及Modularity（模块度）等，常用的训练集是一些真实基准网络，如：karate（空手道俱乐部，34个节点，78条边的无向图）、Football（美国大学橄榄球联盟、115个节点无向图）等 Modularity（模块度）：网络中连接社区内部边所占的比例与另一网络中的内部边的期望值之间的差值 Jaccard指数：衡量社区分割正确性的指标，在已知正确划分的情况下通过正确分类的节点对的数量来计量 NMI：依然是已知划分情况下与真实结果差异度的比较指标，其标准差可以衡量算法的稳定性
6、伪代码
&lt;code class=&#34;hljs delphi has-numbering&#34; style=&#34;display: block; padding: 0px; color: inherit; box-sizing: border-box; font-family: &#39;Source Code Pro&#39;, monospace;font-size:undefined; white-space: pre; border-radius: 0px; word-wrap: normal; background: transparent;&#34;&gt;输入：无向图邻接矩阵AdjacentMatrix，节点个数VerticeNum 输出：存储节点标签的分类数组Community &lt;span class=&#34;hljs-comment&#34; style=&#34;color: rgb(136, 0, 0); box-sizing: border-box;&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1b9ae309fed0701d7c226202b730f349/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-15T20:34:00+08:00" />
<meta property="article:modified_time" content="2016-09-15T20:34:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">lpa 半监督学习 之--标签传播算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content-detail markdown-body"> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> <span style="color:rgb(51,51,51);font-family:Arial;line-height:26px;font-size:18px;">  </span><span style="color:rgb(51,51,51);font-family:Arial;line-height:26px;font-size:18px;">众所周知，机器学习可以大体分为三大类：监督学习、非监督学习和半监督学习。监督学习可以认为是我们有非常多的labeled标注数据来train一个模型，期待这个模型能学习到数据的分布，以期对未来没有见到的样本做预测。那这个性能的源头--训练数据，就显得非常感觉。你必须有足够的训练数据，以覆盖真正现实数据中的样本分布才可以，这样学习到的模型才有意义。那非监督学习就是没有任何的labeled数据，就是平时所说的聚类了，利用他们本身的数据分布，给他们划分类别。而半监督学习，顾名思义就是处于两者之间的，只有少量的labeled数据，我们试图从这少量的labeled数据和大量的unlabeled数据中学习到有用的信息。</span><br></p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 1、社区及社区发现： <br> 网络图内部连接比较紧密的节点子集合对应的子图叫做社区（community），各社区节点集合彼此没有交集的称为非重叠型（disjoint）社区，有交集的称为重叠型（overlapping）社区。对给定的网络图寻找其社区结构的过程称为“社区发现”。大体上看，社区发现的过程就是一种聚类的过程。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 2、基本思想 <br>标签传播算法是不重叠社区发现的经典算法，其基本思想是：将一个节点的邻居节点的标签中数量最多的标签作为该节点自身的标签。给每个节点添加标签（label）以代表它所属的社区，并通过标签的“传播”形成同一标签的“社区”结构。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 给每个节点添加标签（label）以代表它所属的社区，并通过标签的“传播”形成同一标签的“社区”结构。一个节点的标签取决于它邻居节点的标签：假设节点z的邻居节点有z1至zk，那么哪个社区包含z的邻居节点最多z就属于那个社区（或者说z的邻居中包含哪个社区的标签最多，z就属于哪个社区）。优点是收敛周期短，无需任何先验参数(不需事先指定社区个数和大小)，算法执行过程中不需要计算任何社区指标。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 时间复杂度接近线性：对顶点分配标签的复杂度为O(n)，每次迭代时间为O( m)，找出所有社区的复杂度为O (n +m)，但迭代次数难以估计</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 3、传播过程： <br> 1)初始时，给每个节点一个唯一的标签； <br> 2)每个节点使用其邻居节点的标签中最多的标签来更新自身的标签。 <br> 3)反复执行步骤2)，直到每个节点的标签都不再发生变化为止。 <br> 一次迭代过程中一个节点标签的更新可以分为同步和异步两种。所谓同步更新，即节点z在第t次迭代的label依据于它的邻居节点在第t-1次迭代时所得的label；异步更新，即节点z在第t次迭代的label依据于第t次迭代已经更新过label的节点和第t次迭代未更新过label的节点在第t-1次迭代时的label。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 注： <br> 1、迭代次数设定一个阈值，可以防止过度运算； <br> 2、对于二分图等网络结构，同步更新会引起震荡； <br> //3、类似（“强”社区&gt;）定义的结构（该社区&gt;=）； <br> 4、每个顶点在初始的时候赋予唯一的标签，即“重要性”相同，而迭代过程又采用随机序列，会导致同一初始状态不同结果甚至巨型社区的出现； <br> 5、如果能预测“社区中心”点，能有效提高社区发现的准确度，大幅提高效率； <br> 6、同一节点的邻居节点的标签可能存在多种社区最大数目相同的情况，取“随机”一个作为其标签</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 4、算法改进思路：初始化或传播改进 <br> 1)给节点或边添加权重（势函数、模块密度优化、LeaderRank值、局部拓扑信息的相似度、标签从属系数等），信息熵等描述节点的传播优先度，进而初步确定社区中心点以提高社区划分的精度； <br> 2）标签初始化改进，如提取一些较为紧密的子结构来作为标签传播的初始标签（非重叠最小极大团提取算法 orz。。。）或通过初始社区划分算法先确定社区的雏形再进行传播。 <br> 3）标签随机选择改进，将1）中的权值和节点邻接点的度数等作为参考因素，对标签更新过程进行修正。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 1)在社区中寻找不重叠三角形作为起始簇的雏形，以提高算法结果的稳定性和运行效率； <br> 2)添加标签熵属性，在迭代过程中不采用随机序列，而是根据每个节点的标签熵来排序序列； <br> 3)在2）的基础上，为了不完全消除标签传播算法的随机性，将排序好的队列平均分成三个部分，在每个部分内，节点进行随机排列。 <br> 4)对于同一节点的邻居节点的标签可能存在多种社区最大数目相同的情况，不使用随机方法，而是分析该节点的邻节点的邻节点集标签分布情况来决定该节点的标签 <br> 5)在社区中寻找以度最大的若干节点为中心的“雪花型”结构作为起始簇的雏形 <br> 在实现的过程中，将上述方案进行组合衍生出更多的可行方案，初步试验结果表明算法的随机性与稳定性很难同时保证，设定起始簇的结构收敛速度快但有可能生成巨型社区；在节点较少的情况下，标签熵的方法准确率和稳定性最好；至于组合方案初步的试验验证发现效果反而下降了。</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 5、评价标准：社区发现的主要评价指标有Jaccard指数，fsame指数、NMI（规范化交互信息）以及Modularity（模块度）等，常用的训练集是一些真实基准网络，如：karate（空手道俱乐部，34个节点，78条边的无向图）、Football（美国大学橄榄球联盟、115个节点无向图）等 <br> Modularity（模块度）：网络中连接社区内部边所占的比例与另一网络中的内部边的期望值之间的差值 <br><img src="https://images2.imgbox.com/67/3b/QJ99KVy5_o.jpg" alt="这里写图片描述" title="" style="border:none;"><br> Jaccard指数：衡量社区分割正确性的指标，在已知正确划分的情况下通过正确分类的节点对的数量来计量 <br> NMI：依然是已知划分情况下与真实结果差异度的比较指标，其标准差可以衡量算法的稳定性</p> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> 6、伪代码</p> 
 <pre class="prettyprint">&lt;code class="hljs delphi has-numbering" style="display: block; padding: 0px; color: inherit; box-sizing: border-box; font-family: 'Source Code Pro', monospace;font-size:undefined; white-space: pre; border-radius: 0px; word-wrap: normal; background: transparent;"&gt;输入：无向图邻接矩阵AdjacentMatrix，节点个数VerticeNum 
输出：存储节点标签的分类数组Community
&lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//初始化每个节点的标签&lt;/span&gt;
&lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;For&lt;/span&gt; i &lt;- &lt;span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;"&gt;0&lt;/span&gt; &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;to&lt;/span&gt; VerticeNum &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;Do&lt;/span&gt;
    Community[i] &lt;- i
    &lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//寻找i节点的所有邻居存入Neighbor[i]&lt;/span&gt;
    FindMaetexNonZero(i,AdjacentMatrix,NeighBor[i])
&lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;while&lt;/span&gt; 未达到分类标准 &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;or&lt;/span&gt; 未超出迭代阈值 &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;then&lt;/span&gt;
    RandomSort(SS)&lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//生成随机序数队列SS&lt;/span&gt;
    &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;For&lt;/span&gt; i &lt;- &lt;span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;"&gt;0&lt;/span&gt; &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;to&lt;/span&gt; VerticeNum &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;Do&lt;/span&gt;
        &lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//统计节点i邻居中数量最多的标签&lt;/span&gt;
        VectorFrequency(Neighbor[i], lable)
        &lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//若只有一个数量最多则直接赋值&lt;/span&gt;
        &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;if&lt;/span&gt; lable.size() = &lt;span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;"&gt;1&lt;/span&gt; &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;then&lt;/span&gt;
            Community[i] &lt;- lable[&lt;span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;"&gt;0&lt;/span&gt;]
        &lt;span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;"&gt;//若有多个相同数量的标签则随机选择一个&lt;/span&gt;
        &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;else&lt;/span&gt; &lt;span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;"&gt;then&lt;/span&gt;
            Community[i] &lt;- lable[random]
return Community&lt;/code&gt;&lt;ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;1&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;2&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;3&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;4&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;5&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;6&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;7&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;8&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;9&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;10&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;11&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;12&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;13&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;14&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;15&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;16&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;17&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;18&lt;/li&gt;&lt;li style="box-sizing: border-box; padding: 0px 5px;"&gt;19&lt;/li&gt;&lt;/ul&gt;</pre> 
 <p style="color:rgb(54,46,43);font-family:'microsoft yahei';font-size:14px;line-height:26px;"> </p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">一、半监督学习</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       半监督学习（Semi-supervised learning）发挥作用的场合是：你的数据有一些有label，一些没有。而且一般是绝大部分都没有，只有少许几个有label。半监督学习算法会充分的利用unlabeled数据来捕捉我们整个数据的潜在分布。</span><span style="font-size:18px;">它基于三大假设：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       1）Smoothness平滑假设：相似的数据具有相同的label。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       2）Cluster聚类假设：处于同一个聚类下的数据具有相同label。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       3）Manifold流形假设：处于同一流形结构下的数据具有相同label。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       例如下图，只有两个labeled数据，如果直接用他们来训练一个分类器，例如LR或者SVM，那么学出来的分类面就是左图那样的。如果现实中，这个数据是右图那边分布的话，猪都看得出来，左图训练的这个分类器烂的一塌糊涂、惨不忍睹。因为我们的labeled训练数据太少了，都没办法覆盖我们未来可能遇到的情况。但是，如果右图那样，把大量的unlabeled数据（黑色的）都考虑进来，有个全局观念，牛逼的算法会发现，哎哟，原来是两个圈圈（分别处于两个圆形的流形之上）！那算法就很聪明，把大圈的数据都归类为红色类别，把内圈的数据都归类为蓝色类别。因为，实践中，labeled数据是昂贵，很难获得的，但unlabeled数据就不是了，写个脚本在网上爬就可以了，因此如果能充分利用大量的unlabeled数据来辅助提升我们的模型学习，这个价值就非常大。</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/aa/c3/c7RT0OSH_o.png" width="600" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       半监督学习算法有很多，下面我们介绍最简单的标签传播算法（label propagation），最喜欢简单了，哈哈。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">二、标签传播算法</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       标签传播算法（label propagation）的核心思想非常简单：相似的数据应该具有相同的label。LP算法包括两大步骤：1）构造相似矩阵；2）勇敢的传播吧。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">2.1、相似矩阵构建</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       LP算法是基于Graph的，因此我们需要先构建一个图。我们为所有的数据构建一个图，图的节点就是一个数据点，包含labeled和unlabeled的数据。节点i和节点j的边表示他们的相似度。这个图的构建方法有很多，这里我们假设这个图是全连接的，节点i和节点j的边权重为：</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/07/75/BEwOt4bc_o.png" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       这里，α是超参。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       还有个非常常用的图构建方法是knn图，也就是只保留每个节点的k近邻权重，其他的为0，也就是不存在边，因此是稀疏的相似矩阵。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">2.2、LP算法</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       标签传播算法非常简单：通过节点之间的边传播label。边的权重越大，表示两个节点越相似，那么label越容易传播过去。我们定义一个NxN的概率转移矩阵P：</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/c3/8c/eFKwyzVg_o.png" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       P<sub>ij</sub>表示从节点i转移到节点j的概率。假设有C个类和L个labeled样本，我们定义一个LxC的label矩阵Y<sub>L</sub>，第i行表示第i个样本的标签指示向量，即如果第i个样本的类别是j，那么该行的第j个元素为1，其他为0。同样，我们也给U个unlabeled样本一个UxC的label矩阵Y<sub>U</sub>。把他们合并，我们得到一个NxC的soft label矩阵F=[Y<sub>L</sub>;Y<sub>U</sub>]。soft label的意思是，我们保留样本i属于每个类别的概率，而不是互斥性的，这个样本以概率1只属于一个类。当然了，最后确定这个样本i的类别的时候，是取max也就是概率最大的那个类作为它的类别的。那F里面有个Y<sub>U</sub>，它一开始是不知道的，那最开始的值是多少？无所谓，随便设置一个值就可以了。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       千呼万唤始出来，简单的LP算法如下：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       1）执行传播：F=PF</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       2）重置F中labeled样本的标签：F<sub>L</sub>=Y<sub>L</sub></span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       3）重复步骤1）和2）直到F收敛。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       步骤1）就是将矩阵P和矩阵F相乘，这一步，每个节点都将自己的label以P确定的概率传播给其他节点。如果两个节点越相似（在欧式空间中距离越近），那么对方的label就越容易被自己的label赋予，就是更容易拉帮结派。步骤2）非常关键，因为labeled数据的label是事先确定的，它不能被带跑，所以每次传播完，它都得回归它本来的label。随着labeled数据不断的将自己的label传播出去，最后的类边界会穿越高密度区域，而停留在低密度的间隔中。相当于每个不同类别的labeled样本划分了势力范围。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">2.3、变身的LP算法</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       我们知道，我们每次迭代都是计算一个soft label矩阵F=[Y<sub>L</sub>;Y<sub>U</sub>]，但是Y<sub>L</sub>是已知的，计算它没有什么用，在步骤2）的时候，还得把它弄回来。我们关心的只是Y<sub>U</sub>，那我们能不能只计算Y<sub>U</sub>呢？Yes。我们将矩阵P做以下划分：</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/96/c1/IdlsYVja_o.png" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       这时候，我们的算法就一个运算：</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/3a/c7/ghclp7mB_o.png" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       迭代上面这个步骤直到收敛就ok了，是不是很cool。可以看到F<sub>U</sub>不但取决于labeled数据的标签及其转移概率，还取决了unlabeled数据的当前label和转移概率。因此LP算法能额外运用unlabeled数据的分布特点。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       这个算法的收敛性也非常容易证明，具体见参考文献[1]。实际上，它是可以收敛到一个凸解的：</span></p> 
 <p align="center" style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <img src="https://images2.imgbox.com/39/da/Kl7uJDT1_o.png" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       所以我们也可以直接这样求解，以获得最终的Y<sub>U</sub>。但是在实际的应用过程中，由于矩阵求逆需要O(n<sup>3</sup>)的复杂度，所以如果unlabeled数据非常多，那么I – P<sub>UU</sub>矩阵的求逆将会非常耗时，因此这时候一般选择迭代算法来实现。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <strong><span style="font-size:18px;">三、LP算法的Python实现</span></strong></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       Python环境的搭建就不啰嗦了，可以参考前面的博客。需要额外依赖的库是经典的numpy和matplotlib。代码中包含了两种图的构建方法：RBF和KNN指定。同时，自己生成了两个toy数据库：两条长形形状和两个圈圈的数据。第四部分我们用大点的数据库来做实验，先简单的可视化验证代码的正确性，再前线。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       算法代码：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;"></span></p> 
 <div class="dp-highlighter bg_python" style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:rgb(51,51,51);line-height:26px;"> 
  <div class="bar"> 
   <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);"> 
    <strong>[python]</strong>  
    <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">view plain</a> 
     <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">copy</a> 
    <div style="width:18px;"> 
    </div> 
     
   </div> 
  </div> 
  <ol style="border:none;color:rgb(92,92,92);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#***************************************************************************</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Description: label propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Author: Zou Xiaoyi (zouxy09@qq.com)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Date:   2015-10-15</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* HomePage: http://blog.csdn.net/zouxy09</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#**************************************************************************</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> time  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> numpy as np  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># return k neighbors index</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> navie_knn(dataSet, query, k):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    numSamples = dataSet.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## step 1: calculate Euclidean distance</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    diff = np.tile(query, (numSamples, <span class="number" style="border:none;">1</span><span style="border:none;">)) - dataSet  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    squaredDiff = diff ** <span class="number" style="border:none;">2</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    squaredDist = np.sum(squaredDiff, axis = <span class="number" style="border:none;">1</span><span style="border:none;">) </span><span class="comment" style="border:none;color:rgb(0,130,0);"># sum is performed by row</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## step 2: sort the distance</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    sortedDistIndices = np.argsort(squaredDist)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> k &gt; len(sortedDistIndices):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        k = len(sortedDistIndices)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> sortedDistIndices[</span><span class="number" style="border:none;">0</span><span style="border:none;">:k]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># build a big graph (normalized weight matrix)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> buildGraph(MatX, kernel_type, rbf_sigma = </span><span class="special" style="border:none;">None</span><span style="border:none;">, knn_num_neighbors = </span><span class="special" style="border:none;">None</span><span style="border:none;">):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_samples = MatX.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    affinity_matrix = np.zeros((num_samples, num_samples), np.float32)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> kernel_type == </span><span class="string" style="border:none;color:#0000FF;">'rbf'</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> rbf_sigma == </span><span class="special" style="border:none;">None</span><span style="border:none;">:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">raise</span><span style="border:none;"> ValueError(</span><span class="string" style="border:none;color:#0000FF;">'You should input a sigma of rbf kernel!'</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            row_sum = <span class="number" style="border:none;">0.0</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> j </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">                diff = MatX[i, :] - MatX[j, :]  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                affinity_matrix[i][j] = np.exp(sum(diff**<span class="number" style="border:none;">2</span><span style="border:none;">) / (-</span><span class="number" style="border:none;">2.0</span><span style="border:none;"> * rbf_sigma**</span><span class="number" style="border:none;">2</span><span style="border:none;">))  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">                row_sum += affinity_matrix[i][j]  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            affinity_matrix[i][:] /= row_sum  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">elif</span><span style="border:none;"> kernel_type == </span><span class="string" style="border:none;color:#0000FF;">'knn'</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> knn_num_neighbors == </span><span class="special" style="border:none;">None</span><span style="border:none;">:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">raise</span><span style="border:none;"> ValueError(</span><span class="string" style="border:none;color:#0000FF;">'You should input a k of knn kernel!'</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            k_neighbors = navie_knn(MatX, MatX[i, :], knn_num_neighbors)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            affinity_matrix[i][k_neighbors] = <span class="number" style="border:none;">1.0</span><span style="border:none;"> / knn_num_neighbors  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">raise</span><span style="border:none;"> NameError(</span><span class="string" style="border:none;color:#0000FF;">'Not support kernel type! You can use knn or rbf!'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> affinity_matrix  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># label propagation</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = </span><span class="string" style="border:none;color:#0000FF;">'rbf'</span><span style="border:none;">, rbf_sigma = </span><span class="number" style="border:none;">1.5</span><span style="border:none;">, \  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">                    knn_num_neighbors = <span class="number" style="border:none;">10</span><span style="border:none;">, max_iter = </span><span class="number" style="border:none;">500</span><span style="border:none;">, tol = </span><span class="number" style="border:none;">1e</span><span style="border:none;">-</span><span class="number" style="border:none;">3</span><span style="border:none;">):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># initialize</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_label_samples = Mat_Label.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_unlabel_samples = Mat_Unlabel.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_samples = num_label_samples + num_unlabel_samples  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    labels_list = np.unique(labels)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_classes = len(labels_list)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    MatX = np.vstack((Mat_Label, Mat_Unlabel))  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    clamp_data_label = np.zeros((num_label_samples, num_classes), np.float32)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_label_samples):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        clamp_data_label[i][labels[i]] = <span class="number" style="border:none;">1.0</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    label_function = np.zeros((num_samples, num_classes), np.float32)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    label_function[<span class="number" style="border:none;">0</span><span style="border:none;"> : num_label_samples] = clamp_data_label  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    label_function[num_label_samples : num_samples] = -<span class="number" style="border:none;">1</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># graph construction</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    affinity_matrix = buildGraph(MatX, kernel_type, rbf_sigma, knn_num_neighbors)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># start to propagation</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    iter = <span class="number" style="border:none;">0</span><span style="border:none;">; pre_label_function = np.zeros((num_samples, num_classes), np.float32)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    changed = np.abs(pre_label_function - label_function).sum()  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">while</span><span style="border:none;"> iter &lt; max_iter </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">and</span><span style="border:none;"> changed &gt; tol:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> iter % </span><span class="number" style="border:none;">1</span><span style="border:none;"> == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"---&gt; Iteration %d/%d, changed: %f"</span><span style="border:none;"> % (iter, max_iter, changed)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        pre_label_function = label_function  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        iter += <span class="number" style="border:none;">1</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="comment" style="border:none;color:rgb(0,130,0);"># propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        label_function = np.dot(affinity_matrix, label_function)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="comment" style="border:none;color:rgb(0,130,0);"># clamp</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        label_function[<span class="number" style="border:none;">0</span><span style="border:none;"> : num_label_samples] = clamp_data_label  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="comment" style="border:none;color:rgb(0,130,0);"># check converge</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        changed = np.abs(pre_label_function - label_function).sum()  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># get terminate label of unlabeled data</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    unlabel_data_labels = np.zeros(num_unlabel_samples)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_unlabel_samples):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        unlabel_data_labels[i] = np.argmax(label_function[i+num_label_samples])  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> unlabel_data_labels  </span></span> </li></ol> 
 </div> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> </p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       </span><span style="font-size:18px;">测试代码：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;"></span></p> 
 <div class="dp-highlighter bg_python" style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:rgb(51,51,51);line-height:26px;"> 
  <div class="bar"> 
   <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);"> 
    <strong>[python]</strong>  
    <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">view plain</a> 
     <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">copy</a> 
    <div style="width:18px;"> 
    </div> 
     
   </div> 
  </div> 
  <ol style="border:none;color:rgb(92,92,92);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#***************************************************************************</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Description: label propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Author: Zou Xiaoyi (zouxy09@qq.com)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Date:   2015-10-15</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* HomePage: http://blog.csdn.net/zouxy09</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#**************************************************************************</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> time  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> math  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> numpy as np  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">from</span><span style="border:none;"> label_propagation </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> labelPropagation  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># show</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> show(Mat_Label, labels, Mat_Unlabel, unlabel_data_labels):   </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> matplotlib.pyplot as plt   </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(Mat_Label.shape[</span><span class="number" style="border:none;">0</span><span style="border:none;">]):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> int(labels[i]) == </span><span class="number" style="border:none;">0</span><span style="border:none;">:    </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Label[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Label[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'Dr'</span><span style="border:none;">)    </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">elif</span><span style="border:none;"> int(labels[i]) == </span><span class="number" style="border:none;">1</span><span style="border:none;">:    </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Label[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Label[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'Db'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Label[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Label[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'Dy'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(Mat_Unlabel.shape[</span><span class="number" style="border:none;">0</span><span style="border:none;">]):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> int(unlabel_data_labels[i]) == </span><span class="number" style="border:none;">0</span><span style="border:none;">:    </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Unlabel[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Unlabel[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'or'</span><span style="border:none;">)    </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">elif</span><span style="border:none;"> int(unlabel_data_labels[i]) == </span><span class="number" style="border:none;">1</span><span style="border:none;">:    </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Unlabel[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Unlabel[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'ob'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            plt.plot(Mat_Unlabel[i, <span class="number" style="border:none;">0</span><span style="border:none;">], Mat_Unlabel[i, </span><span class="number" style="border:none;">1</span><span style="border:none;">], </span><span class="string" style="border:none;color:#0000FF;">'oy'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    plt.xlabel(<span class="string" style="border:none;color:#0000FF;">'X1'</span><span style="border:none;">); plt.ylabel(</span><span class="string" style="border:none;color:#0000FF;">'X2'</span><span style="border:none;">)   </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    plt.xlim(<span class="number" style="border:none;">0.0</span><span style="border:none;">, </span><span class="number" style="border:none;">12.</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    plt.ylim(<span class="number" style="border:none;">0.0</span><span style="border:none;">, </span><span class="number" style="border:none;">12.</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    plt.show()    </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> loadCircleData(num_data):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    center = np.array([<span class="number" style="border:none;">5.0</span><span style="border:none;">, </span><span class="number" style="border:none;">5.0</span><span style="border:none;">])  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    radiu_inner = <span class="number" style="border:none;">2</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    radiu_outer = <span class="number" style="border:none;">4</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_inner = num_data / <span class="number" style="border:none;">3</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_outer = num_data - num_inner  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    data = []  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    theta = <span class="number" style="border:none;">0.0</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(num_inner):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        pho = (theta % <span class="number" style="border:none;">360</span><span style="border:none;">) * math.pi / </span><span class="number" style="border:none;">180</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        tmp = np.zeros(<span class="number" style="border:none;">2</span><span style="border:none;">, np.float32)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        tmp[<span class="number" style="border:none;">0</span><span style="border:none;">] = radiu_inner * math.cos(pho) + np.random.rand(</span><span class="number" style="border:none;">1</span><span style="border:none;">) + center[</span><span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        tmp[<span class="number" style="border:none;">1</span><span style="border:none;">] = radiu_inner * math.sin(pho) + np.random.rand(</span><span class="number" style="border:none;">1</span><span style="border:none;">) + center[</span><span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        data.append(tmp)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        theta += <span class="number" style="border:none;">2</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    theta = <span class="number" style="border:none;">0.0</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(num_outer):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        pho = (theta % <span class="number" style="border:none;">360</span><span style="border:none;">) * math.pi / </span><span class="number" style="border:none;">180</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        tmp = np.zeros(<span class="number" style="border:none;">2</span><span style="border:none;">, np.float32)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        tmp[<span class="number" style="border:none;">0</span><span style="border:none;">] = radiu_outer * math.cos(pho) + np.random.rand(</span><span class="number" style="border:none;">1</span><span style="border:none;">) + center[</span><span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        tmp[<span class="number" style="border:none;">1</span><span style="border:none;">] = radiu_outer * math.sin(pho) + np.random.rand(</span><span class="number" style="border:none;">1</span><span style="border:none;">) + center[</span><span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        data.append(tmp)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        theta += <span class="number" style="border:none;">1</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label = np.zeros((<span class="number" style="border:none;">2</span><span style="border:none;">, </span><span class="number" style="border:none;">2</span><span style="border:none;">), np.float32)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label[<span class="number" style="border:none;">0</span><span style="border:none;">] = center + np.array([-radiu_inner + </span><span class="number" style="border:none;">0.5</span><span style="border:none;">, </span><span class="number" style="border:none;">0</span><span style="border:none;">])  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label[<span class="number" style="border:none;">1</span><span style="border:none;">] = center + np.array([-radiu_outer + </span><span class="number" style="border:none;">0.5</span><span style="border:none;">, </span><span class="number" style="border:none;">0</span><span style="border:none;">])  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    labels = [<span class="number" style="border:none;">0</span><span style="border:none;">, </span><span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Unlabel = np.vstack(data)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> Mat_Label, labels, Mat_Unlabel  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> loadBandData(num_unlabel_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#Mat_Label = np.array([[5.0, 2.], [5.0, 8.0]])</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#labels = [0, 1]</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#Mat_Unlabel = np.array([[5.1, 2.], [5.0, 8.1]])</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label = np.array([[<span class="number" style="border:none;">5.0</span><span style="border:none;">, </span><span class="number" style="border:none;">2.</span><span style="border:none;">], [</span><span class="number" style="border:none;">5.0</span><span style="border:none;">, </span><span class="number" style="border:none;">8.0</span><span style="border:none;">]])  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    labels = [<span class="number" style="border:none;">0</span><span style="border:none;">, </span><span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_dim = Mat_Label.shape[<span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Unlabel = np.zeros((num_unlabel_samples, num_dim), np.float32)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Unlabel[:num_unlabel_samples/<span class="number" style="border:none;">2</span><span style="border:none;">, :] = (np.random.rand(num_unlabel_samples/</span><span class="number" style="border:none;">2</span><span style="border:none;">, num_dim) - </span><span class="number" style="border:none;">0.5</span><span style="border:none;">) * np.array([</span><span class="number" style="border:none;">3</span><span style="border:none;">, </span><span class="number" style="border:none;">1</span><span style="border:none;">]) + Mat_Label[</span><span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Unlabel[num_unlabel_samples/<span class="number" style="border:none;">2</span><span style="border:none;"> : num_unlabel_samples, :] = (np.random.rand(num_unlabel_samples/</span><span class="number" style="border:none;">2</span><span style="border:none;">, num_dim) - </span><span class="number" style="border:none;">0.5</span><span style="border:none;">) * np.array([</span><span class="number" style="border:none;">3</span><span style="border:none;">, </span><span class="number" style="border:none;">1</span><span style="border:none;">]) + Mat_Label[</span><span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> Mat_Label, labels, Mat_Unlabel  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># main function</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> __name__ == </span><span class="string" style="border:none;color:#0000FF;">"__main__"</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_unlabel_samples = <span class="number" style="border:none;">800</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#Mat_Label, labels, Mat_Unlabel = loadBandData(num_unlabel_samples)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label, labels, Mat_Unlabel = loadCircleData(num_unlabel_samples)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## Notice: when use 'rbf' as our kernel, the choice of hyper parameter 'sigma' is very import! It should be</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## chose according to your dataset, specific the distance of two data points. I think it should ensure that</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## each point has about 10 knn or w_i,j is large enough. It also influence the speed of converge. So, may be</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## 'knn' kernel is better!</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#unlabel_data_labels = labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = 'rbf', rbf_sigma = 0.2)</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    unlabel_data_labels = labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = <span class="string" style="border:none;color:#0000FF;">'knn'</span><span style="border:none;">, knn_num_neighbors = </span><span class="number" style="border:none;">10</span><span style="border:none;">, max_iter = </span><span class="number" style="border:none;">400</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    show(Mat_Label, labels, Mat_Unlabel, unlabel_data_labels)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li></ol> 
 </div> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> </p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       </span><span style="font-size:18px;">该注释的，代码都注释的，有看不明白的，欢迎交流。不同迭代次数时候的结果如下：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;text-align:center;"> <img src="https://images2.imgbox.com/e7/ca/nJArqlmR_o.png" width="600" alt="" style="border:none;"></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       是不是很漂亮的传播过程？！在数值上也是可以看到随着迭代的进行逐渐收敛的，迭代的数值变化过程如下：</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> </p> 
 <div class="dp-highlighter bg_python" style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:rgb(51,51,51);line-height:26px;"> 
  <div class="bar"> 
   <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);"> 
    <strong>[python]</strong>  
    <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">view plain</a> 
     <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">copy</a> 
    <div style="width:18px;"> 
    </div> 
     
   </div> 
  </div> 
  <ol style="border:none;color:rgb(92,92,92);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span style="border:none;">---&gt; Iteration </span><span class="number" style="border:none;">0</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1602.000000</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">1</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">6.300182</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">2</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">5.129996</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">3</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">4.301994</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">4</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">3.819295</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">5</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">3.501743</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">6</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">3.277122</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">7</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">3.105952</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">8</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.967030</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">9</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.848606</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">10</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.743997</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">11</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.649270</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">12</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.562057</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">13</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.480885</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">14</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.404774</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">15</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.333075</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">16</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.265301</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">17</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.201107</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">18</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.140209</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">19</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.082354</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">20</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">2.027376</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">21</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.975071</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">22</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.925286</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">23</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.877894</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">24</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.832743</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">25</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.789721</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">26</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.748706</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">27</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.709593</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">28</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.672284</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">29</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.636668</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">30</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.602668</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">31</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.570200</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">32</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.539179</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">33</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.509530</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">34</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.481182</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">35</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.454066</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">36</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.428120</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">37</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.403283</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">38</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.379502</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">39</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.356734</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">40</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.334906</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">41</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.313983</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">42</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.293921</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">43</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.274681</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">44</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.256214</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">45</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.238491</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">46</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.221474</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">47</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.205126</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">48</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.189417</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">49</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.174316</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">50</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.159804</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">51</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.145844</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">52</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.132414</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">53</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.119490</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">54</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.107032</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">55</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.095054</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">56</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.083513</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">57</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.072397</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">58</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.061671</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">59</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.051324</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">60</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.041363</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">61</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.031742</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">62</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.022459</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">63</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.013494</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">64</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">1.004836</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">65</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.996484</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">66</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.988407</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">67</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.980592</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">68</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.973045</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">69</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.965744</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">70</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.958682</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">71</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.951848</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">72</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.945227</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">73</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.938820</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">74</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.932608</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">75</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.926590</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">76</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.920765</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">77</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.915107</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">78</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.909628</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">79</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.904309</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">80</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.899143</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">81</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.894122</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">82</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.889259</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">83</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.884530</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">84</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.879933</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">85</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.875464</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">86</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.871121</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">87</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.866888</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">88</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.862773</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">89</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.858783</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">90</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.854879</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">91</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.851084</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">92</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.847382</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">93</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.843779</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">94</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.840274</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">95</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.836842</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">96</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.833501</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">97</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.830240</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">98</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.827051</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">99</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.823950</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">100</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.820906</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">101</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.817946</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">102</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.815053</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">103</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.812217</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">104</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.809437</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">105</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.806724</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">106</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.804076</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">107</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.801480</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">108</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.798937</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">109</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.796448</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">110</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.794008</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">111</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.791612</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">112</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.789282</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">113</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.786984</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">114</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.784728</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">115</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.782516</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">116</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.780355</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">117</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.778216</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">118</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.776139</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">119</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.774087</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">120</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.772072</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">121</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.770085</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">122</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.768146</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">123</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.766232</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">124</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.764356</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">125</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.762504</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">126</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.760685</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">127</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.758889</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">128</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.757135</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">---&gt; Iteration <span class="number" style="border:none;">129</span><span style="border:none;">/</span><span class="number" style="border:none;">400</span><span style="border:none;">, changed: </span><span class="number" style="border:none;">0.755406</span><span style="border:none;">  </span></span> </li></ol> 
 </div> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> </p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;"><strong>四、LP算法MPI并行实现</strong></span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       这里，我们测试的是LP的变身版本。从公式，我们可以看到，第二项P<sub>UL</sub>Y<sub>L</sub>迭代过程并没有发生变化，所以这部分实际上从迭代开始就可以计算好，从而避免重复计算。不过，不管怎样，LP算法都要计算一个UxU的矩阵P<sub>UU</sub>和一个UxC矩阵F<sub>U</sub>的乘积。当我们的unlabeled数据非常多，而且类别也很多的时候，计算是很慢的，同时占用的内存量也非常大。另外，构造Graph需要计算两两的相似度，也是O(n<sup>2</sup>)的复杂度，当我们数据的特征维度很大的时候，这个计算量也是非常客观的。所以我们就得考虑并行处理了。而且最好是能放到集群上并行。那如何并行呢？</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       对算法的并行化，一般分为两种：数据并行和模型并行。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       数据并行很好理解，就是将数据划分，每个节点只处理一部分数据，例如我们构造图的时候，计算每个数据的k近邻。例如我们有1000个样本和20个CPU节点，那么就平均分发，让每个CPU节点计算50个样本的k近邻，然后最后再合并大家的结果。可见这个加速比也是非常可观的。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       模型并行一般发生在模型很大，无法放到单机的内存里面的时候。例如庞大的深度神经网络训练的时候，就需要把这个网络切开，然后分别求解梯度，最后有个leader的节点来收集大家的梯度，再反馈给大家去更新。当然了，其中存在更细致和高效的工程处理方法。在我们的LP算法中，也是可以做模型并行的。假如我们的类别数C很大，把类别数切开，让不同的CPU节点处理，实际上就相当于模型并行了。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       那为啥不切大矩阵P<sub>UU</sub>，而是切小点的矩阵F<sub>U</sub>，因为大矩阵P<sub>UU</sub>没法独立分块，并行的一个原则是处理必须是独立的。 矩阵F<sub>U</sub>依赖的是所有的U，而把P<sub>UU</sub>切开分发到其他节点的时候，每次F<sub>U</sub>的更新都需要和其他的节点通信，这个通信的代价是很大的（实际上，很多并行系统没法达到线性的加速度的瓶颈是通信！线性加速比是，我增加了n台机器，速度就提升了n倍）。但是对类别C也就是矩阵F<sub>U</sub>切分，就不会有这个问题，因为他们的计算是独立的。只是决定样本的最终类别的时候，将所有的F<sub>U</sub>收集回来求max就可以了。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       所以，在下面的代码中，是同时包含了数据并行和模型并行的雏形的。另外，还值得一提的是，我们是迭代算法，那决定什么时候迭代算法停止？除了判断收敛外，我们还可以让每迭代几步，就用测试label测试一次结果，看模型的整体训练性能如何。特别是判断训练是否过拟合的时候非常有效。因此，代码中包含了这部分内容。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;">       好了，代码终于来了。大家可以搞点大数据库来测试，如果有MPI集群条件的话就更好了。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> <span style="font-size:18px;"></span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">        <span style="font-size:18px;">下面的代码依赖numpy、scipy（用其稀疏矩阵加速计算）和mpi4py。其中mpi4py需要依赖openmpi和Cpython，可以参考我<a href="http://blog.csdn.net/zouxy09/article/details/49031845" style="color:rgb(51,102,153);text-decoration:none;">之前的博客</a>进行安装。</span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> </p> 
 <div class="dp-highlighter bg_python" style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:rgb(51,51,51);line-height:26px;"> 
  <div class="bar"> 
   <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);"> 
    <strong>[python]</strong>  
    <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">view plain</a> 
     <a href="http://blog.csdn.net/zouxy09/article/details/49105265#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;width:16px;text-indent:-2000px;">copy</a> 
    <div style="width:18px;"> 
    </div> 
     
   </div> 
  </div> 
  <ol style="border:none;color:rgb(92,92,92);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#***************************************************************************</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Description: label propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Author: Zou Xiaoyi (zouxy09@qq.com)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* Date:   2015-10-15</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* HomePage: http://blog.csdn.net/zouxy09</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#* </span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#**************************************************************************</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> os, sys, time  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> numpy as np  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">from</span><span style="border:none;"> scipy.sparse </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> csr_matrix, lil_matrix, eye  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> operator  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> cPickle as pickle  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> mpi4py.MPI as MPI  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#   Global variables for MPI</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);">#</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># instance for invoking MPI related functions</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">comm = MPI.COMM_WORLD  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># the node rank in the whole community</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">comm_rank = comm.Get_rank()  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># the size of the whole community, i.e., the total number of working nodes in the MPI cluster</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">comm_size = comm.Get_size()  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># load mnist dataset</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> load_MNIST():  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">import</span><span style="border:none;"> gzip  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    f = gzip.open(<span class="string" style="border:none;color:#0000FF;">"mnist.pkl.gz"</span><span style="border:none;">, </span><span class="string" style="border:none;color:#0000FF;">"rb"</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    train, val, test = pickle.load(f)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    f.close()  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label = train[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    labels = train[<span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Unlabel = test[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    groundtruth = test[<span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    labels_id = [<span class="number" style="border:none;">0</span><span style="border:none;">, </span><span class="number" style="border:none;">1</span><span style="border:none;">, </span><span class="number" style="border:none;">2</span><span style="border:none;">, </span><span class="number" style="border:none;">3</span><span style="border:none;">, </span><span class="number" style="border:none;">4</span><span style="border:none;">, </span><span class="number" style="border:none;">5</span><span style="border:none;">, </span><span class="number" style="border:none;">6</span><span style="border:none;">, </span><span class="number" style="border:none;">7</span><span style="border:none;">, </span><span class="number" style="border:none;">8</span><span style="border:none;">, </span><span class="number" style="border:none;">9</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> Mat_Label, labels, labels_id, Mat_Unlabel, groundtruth  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># return k neighbors index</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> navie_knn(dataSet, query, k):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    numSamples = dataSet.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## step 1: calculate Euclidean distance</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    diff = np.tile(query, (numSamples, <span class="number" style="border:none;">1</span><span style="border:none;">)) - dataSet  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    squaredDiff = diff ** <span class="number" style="border:none;">2</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    squaredDist = np.sum(squaredDiff, axis = <span class="number" style="border:none;">1</span><span style="border:none;">) </span><span class="comment" style="border:none;color:rgb(0,130,0);"># sum is performed by row</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">## step 2: sort the distance</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    sortedDistIndices = np.argsort(squaredDist)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> k &gt; len(sortedDistIndices):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        k = len(sortedDistIndices)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> sortedDistIndices[</span><span class="number" style="border:none;">0</span><span style="border:none;">:k]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># build a big graph (normalized weight matrix)</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># sparse U x (U + L) matrix</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> buildSubGraph(Mat_Label, Mat_Unlabel, knn_num_neighbors):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_unlabel_samples = Mat_Unlabel.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    data = []; indices = []; indptr = [<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_all = np.vstack((Mat_Label, Mat_Unlabel))  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    values = np.ones(knn_num_neighbors, np.float32) / knn_num_neighbors  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_unlabel_samples):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        k_neighbors = navie_knn(Mat_all, Mat_Unlabel[i, :], knn_num_neighbors)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        indptr.append(np.int32(indptr[-<span class="number" style="border:none;">1</span><span style="border:none;">]) + knn_num_neighbors)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        indices.extend(k_neighbors)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        data.append(values)   </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> csr_matrix((np.hstack(data), indices, indptr))  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># build a big graph (normalized weight matrix)</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># sparse U x (U + L) matrix</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> buildSubGraph_MPI(Mat_Label, Mat_Unlabel, knn_num_neighbors):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_unlabel_samples = Mat_Unlabel.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    local_data = []; local_indices = []; local_indptr = [<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_all = np.vstack((Mat_Label, Mat_Unlabel))  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    values = np.ones(knn_num_neighbors, np.float32) / knn_num_neighbors  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    sample_offset = np.linspace(<span class="number" style="border:none;">0</span><span style="border:none;">, num_unlabel_samples, comm_size + </span><span class="number" style="border:none;">1</span><span style="border:none;">).astype(</span><span class="string" style="border:none;color:#0000FF;">'int'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(sample_offset[comm_rank], sample_offset[comm_rank+</span><span class="number" style="border:none;">1</span><span style="border:none;">]):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        k_neighbors = navie_knn(Mat_all, Mat_Unlabel[i, :], knn_num_neighbors)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        local_indptr.append(np.int32(local_indptr[-<span class="number" style="border:none;">1</span><span style="border:none;">]) + knn_num_neighbors)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        local_indices.extend(k_neighbors)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        local_data.append(values)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    data = np.hstack(comm.allgather(local_data))  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    indices = np.hstack(comm.allgather(local_indices))  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    indptr_tmp = comm.allgather(local_indptr)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    indptr = []  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> range(len(indptr_tmp)):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> i == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            indptr.extend(indptr_tmp[i])  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            last_indptr = indptr[-<span class="number" style="border:none;">1</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">del</span><span style="border:none;">(indptr[-</span><span class="number" style="border:none;">1</span><span style="border:none;">])  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            indptr.extend(indptr_tmp[i] + last_indptr)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="border:none;"> csr_matrix((np.hstack(data), indices, indptr), dtype = np.float32)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;"><span class="comment" style="border:none;color:rgb(0,130,0);"># label propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> run_label_propagation_sparse(knn_num_neighbors = </span><span class="number" style="border:none;">20</span><span style="border:none;">, max_iter = </span><span class="number" style="border:none;">100</span><span style="border:none;">, tol = </span><span class="number" style="border:none;">1e</span><span style="border:none;">-</span><span class="number" style="border:none;">4</span><span style="border:none;">, test_per_iter = </span><span class="number" style="border:none;">1</span><span style="border:none;">):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># load data and graph</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Processor %d/%d loading graph file..."</span><span style="border:none;"> % (comm_rank, comm_size)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#Mat_Label, labels, Mat_Unlabel, groundtruth = loadFourBandData()</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    Mat_Label, labels, labels_id, Mat_Unlabel, unlabel_data_id = load_MNIST()  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_size &gt; len(labels_id):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">raise</span><span style="border:none;"> ValueError(</span><span class="string" style="border:none;color:#0000FF;">"Sorry, the processors must be less than the number of classes"</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);">#affinity_matrix = buildSubGraph(Mat_Label, Mat_Unlabel, knn_num_neighbors)</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    affinity_matrix = buildSubGraph_MPI(Mat_Label, Mat_Unlabel, knn_num_neighbors)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># get some parameters</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_classes = len(labels_id)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    num_label_samples = len(labels)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    num_unlabel_samples = Mat_Unlabel.shape[<span class="number" style="border:none;">0</span><span style="border:none;">]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    affinity_matrix_UL = affinity_matrix[:, <span class="number" style="border:none;">0</span><span style="border:none;">:num_label_samples]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    affinity_matrix_UU = affinity_matrix[:, num_label_samples:num_label_samples+num_unlabel_samples]  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Have %d labeled images, %d unlabeled images and %d classes"</span><span style="border:none;"> % (num_label_samples, num_unlabel_samples, num_classes)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># divide label_function_U and label_function_L to all processors</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    class_offset = np.linspace(<span class="number" style="border:none;">0</span><span style="border:none;">, num_classes, comm_size + </span><span class="number" style="border:none;">1</span><span style="border:none;">).astype(</span><span class="string" style="border:none;color:#0000FF;">'int'</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># initialize local label_function_U</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    local_start_class = class_offset[comm_rank]  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    local_num_classes = class_offset[comm_rank+<span class="number" style="border:none;">1</span><span style="border:none;">] - local_start_class  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    local_label_function_U = eye(num_unlabel_samples, local_num_classes, <span class="number" style="border:none;">0</span><span style="border:none;">, np.float32, format=</span><span class="string" style="border:none;color:#0000FF;">'csr'</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># initialize local label_function_L</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    local_label_function_L = lil_matrix((num_label_samples, local_num_classes), dtype = np.float32)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_label_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        class_off = int(labels[i]) - local_start_class  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> class_off &gt;= </span><span class="number" style="border:none;">0</span><span style="border:none;"> </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">and</span><span style="border:none;"> class_off &lt; local_num_classes:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            local_label_function_L[i, class_off] = <span class="number" style="border:none;">1.0</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    local_label_function_L = local_label_function_L.tocsr()  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    local_label_info = affinity_matrix_UL.dot(local_label_function_L)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Processor %d/%d has to process %d classes..."</span><span style="border:none;"> % (comm_rank, comm_size, local_label_function_L.shape[</span><span class="number" style="border:none;">1</span><span style="border:none;">])  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># start to propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    iter = <span class="number" style="border:none;">1</span><span style="border:none;">; changed = </span><span class="number" style="border:none;">100.0</span><span style="border:none;">;  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">while</span><span style="border:none;"> </span><span class="special" style="border:none;">True</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        pre_label_function = local_label_function_U.copy()  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="comment" style="border:none;color:rgb(0,130,0);"># propagation</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        local_label_function_U = affinity_matrix_UU.dot(local_label_function_U) + local_label_info  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="comment" style="border:none;color:rgb(0,130,0);"># check converge</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        local_changed = abs(pre_label_function - local_label_function_U).sum()  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        changed = comm.reduce(local_changed, root = <span class="number" style="border:none;">0</span><span style="border:none;">, op = MPI.SUM)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        status = <span class="string" style="border:none;color:#0000FF;">'RUN'</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        test = <span class="special" style="border:none;">False</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> iter % </span><span class="number" style="border:none;">1</span><span style="border:none;"> == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                norm_changed = changed / (num_unlabel_samples * num_classes)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">                <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"---&gt; Iteration %d/%d, changed: %f"</span><span style="border:none;"> % (iter, max_iter, norm_changed)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> iter &gt;= max_iter </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">or</span><span style="border:none;"> changed &lt; tol:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">                status = <span class="string" style="border:none;color:#0000FF;">'STOP'</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"************** Iteration over! ****************"</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> iter % test_per_iter == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                test = <span class="special" style="border:none;">True</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            iter += <span class="number" style="border:none;">1</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        test = comm.bcast(test <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;"> </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;"> </span><span class="special" style="border:none;">None</span><span style="border:none;">, root = </span><span class="number" style="border:none;">0</span><span style="border:none;">)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        status = comm.bcast(status <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;"> </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="border:none;"> </span><span class="special" style="border:none;">None</span><span style="border:none;">, root = </span><span class="number" style="border:none;">0</span><span style="border:none;">)  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> status == </span><span class="string" style="border:none;color:#0000FF;">'STOP'</span><span style="border:none;">:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">break</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> test == </span><span class="special" style="border:none;">True</span><span style="border:none;">:  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">def</span><span style="border:none;"> evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># get local label with max score</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Start to combine local result..."</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    local_max_score = np.zeros((num_unlabel_samples, <span class="number" style="border:none;">1</span><span style="border:none;">), np.float32)   </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    local_max_label = np.zeros((num_unlabel_samples, <span class="number" style="border:none;">1</span><span style="border:none;">), np.int32)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_unlabel_samples):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        local_max_label[i, <span class="number" style="border:none;">0</span><span style="border:none;">] = np.argmax(local_label_function_U.getrow(i).todense())  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        local_max_score[i, <span class="number" style="border:none;">0</span><span style="border:none;">] = local_label_function_U[i, local_max_label[i, </span><span class="number" style="border:none;">0</span><span style="border:none;">]]  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        local_max_label[i, <span class="number" style="border:none;">0</span><span style="border:none;">] += local_start_class  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">          </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># gather the results from all the processors</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Start to gather results from all processors"</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    all_max_label = np.hstack(comm.allgather(local_max_label))  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    all_max_score = np.hstack(comm.allgather(local_max_score))  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">      </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="comment" style="border:none;color:rgb(0,130,0);"># get terminate label of unlabeled data</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> comm_rank == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Start to analysis the results..."</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        right_predict_count = <span class="number" style="border:none;">0</span><span style="border:none;">  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">for</span><span style="border:none;"> i </span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">in</span><span style="border:none;"> xrange(num_unlabel_samples):  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> i % </span><span class="number" style="border:none;">1000</span><span style="border:none;"> == </span><span class="number" style="border:none;">0</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"***"</span><span style="border:none;">, all_max_score[i]  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            max_idx = np.argmax(all_max_score[i])  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">            max_label = all_max_label[i, max_idx]  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> int(unlabel_data_id[i]) == int(labels_id[max_label]):  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">                right_predict_count += <span class="number" style="border:none;">1</span><span style="border:none;">  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">        accuracy = float(right_predict_count) * <span class="number" style="border:none;">100.0</span><span style="border:none;"> / num_unlabel_samples  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">print</span><span style="border:none;"> </span><span class="string" style="border:none;color:#0000FF;">"Have %d samples, accuracy: %.3f%%!"</span><span style="border:none;"> % (num_unlabel_samples, accuracy)  </span></span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">  </span> </li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;"> <span style="border:none;color:#000000;"><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="border:none;"> __name__ == </span><span class="string" style="border:none;color:#0000FF;">'__main__'</span><span style="border:none;">:  </span></span> </li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;"> <span style="border:none;color:#000000;">    run_label_propagation_sparse(knn_num_neighbors = <span class="number" style="border:none;">20</span><span style="border:none;">, max_iter = </span><span class="number" style="border:none;">30</span><span style="border:none;">)  </span></span> </li></ol> 
 </div> 
 <br> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0b1c570e969c73cf51d37bd2a0ee8951/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">redis maxmemory设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72d9a55b8ef5a8f2ffb3373e338ccca0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">poj1631(O(nlogn的lis解法))</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>