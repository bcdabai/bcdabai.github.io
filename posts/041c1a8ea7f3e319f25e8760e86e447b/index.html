<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sequence point顺序点，side effect副作用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sequence point顺序点，side effect副作用" />
<meta property="og:description" content="In C99 --- 6.5 Expressions
Between the previous and next sequence point an object shall have its stored value modified at most once by the evaluation of an expression. Furthermore, the prior value shall be read only to determine the value to be stored 2. Between the previous and next sequence point an object shall have its stored valuemodified at most once by the evaluation of an expression. Furthermore, the prior value shall be read only to determine the value to be stored." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/041c1a8ea7f3e319f25e8760e86e447b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-10-07T22:46:39+08:00" />
<meta property="article:modified_time" content="2013-10-07T22:46:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sequence point顺序点，side effect副作用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>In C99  --- 6.5 Expressions</p> 
<div id="_mcePaste" style="left:-10000px; top:0px; width:1px; height:1px; position:absolute; overflow-x:hidden; overflow-y:hidden">
  Between the previous and next sequence point an object shall have its stored value 
</div> 
<div id="_mcePaste" style="left:-10000px; top:0px; width:1px; height:1px; position:absolute; overflow-x:hidden; overflow-y:hidden">
  modified at most once by the evaluation of an expression. Furthermore, the prior value 
</div> 
<div id="_mcePaste" style="left:-10000px; top:0px; width:1px; height:1px; position:absolute; overflow-x:hidden; overflow-y:hidden">
  shall be read only to determine the value to be stored 
</div> 
<p>2. Between the previous and next sequence point an object shall have its stored valuemodified at most once by the evaluation of an expression. Furthermore, the prior value shall be read only to determine the value to be stored.</p> 
<p>3. The grouping of operators and operands is indicated by the syntax. Except as specified later (for the function-call (), &amp;&amp;, ||, ?:, and comma operators),<strong>the order of evaluation of subexpressions and the order in which side effects take place are both unspecified</strong></p> 
<p></p> 
<p>In C++ ISO/IEC 14882:2003 --- 5 Expressions</p> 
<p>4. Except where noted, the order of evaluation of operands of individual operators and subexpressions of individual expressions,<strong>and the order in which side effects take place, is unspecified</strong>.53) Between the previous and next sequence point a scalar object shall have its stored value modified at most once by the evaluation of an expression. Furthermore, the prior value shall be accessed only to determine the value to be stored.The requirements of this paragraph shall be met for each allowable ordering of the subexpressions of a full expression; otherwise the behavior is undefined.</p> 
<p>So undefined:</p> 
<p>i = v[i++];</p> 
<p>i = ++i + 1;</p> 
<p>a[i] = i++;</p> 
<p>while allowing</p> 
<p><span id="0KSFindDIV" class="KSFIND_CLASS_SELECT"><span style="background-color:rgb(239,210,0)">i = i + 1</span></span>;</p> 
<p>a[i] = i;</p> 
<p>注意这句话</p> 
<p>2) <strong>Furthermore, the prior value shall be accessed only to determine the value to be stored.</strong></p> 
<p>就是说只有用来仅是直接决定 要存的值得时候，才可以取，像上面的例子a[i] = i,    i = i+1这两个→ →的i都只是仅仅用来决定左值的，所以没问题</p> 
<p>而上面两个i++了，是不行的，对i做了改变，看似也是决定了左值的，但是有问题就是对i进行了修改，不能修改两次及以上，参考第一条</p> 
<p>1) <strong>Between the previous and next sequence point a scalar object shall have its stored value modified at most once by the evaluation of an expression.</strong></p> 
<p> </p> 
<p>参考</p> 
<p><a target="_blank" href="http://c-faq.com/expr/seqpoints.html" rel="nofollow noopener noreferrer">http://c-faq.com/expr/seqpoints.html</a></p> 
<p> if an object is written to within a full expression, any and all accesses to it within the same expression must be directly involved in the computation of the value to be written. This rule effectively constrains legal expressions to those in which the accesses demonstrably precede the modification. For example, the old standby <tt><span id="1KSFindDIV" class="KSFIND_CLASS">i = i + 1</span></tt> is allowed, because the access of <tt>i</tt> is used to determine <tt>i</tt>'s final value. The example</p> 
<pre>	a[i] = i++
</pre> 
<p>is disallowed because one of the accesses of <tt>i</tt> (the one in <tt>a[i]</tt>) has nothing to do with the value which ends up being stored in <tt>i</tt> (which happens over in <tt>i++</tt>), and so there's no good way to define--either for our understanding or the compiler's--whether the access should take place before or after the incremented value is stored. Since there's no good way to define it, the Standard declares that it is undefined, and that portable programs simply must not use such constructs.</p> 
<p><a target="_blank" href="http://stackoverflow.com/questions/4176328/undefined-behavior-and-sequence-points" rel="nofollow noopener noreferrer">http://stackoverflow.com/questions/4176328/undefined-behavior-and-sequence-points</a></p> 
<p><a target="_blank" href="http://en.wikipedia.org/wiki/Sequence_point" rel="nofollow noopener noreferrer">http://en.wikipedia.org/wiki/Sequence_point</a></p> 
<p> </p> 
<p>此外</p> 
<p>i=i++;显然就属于这种情况，如果i这里是基本类型的话。而在c.erase(i++)就是另外一种</p> 
<p>情况，因为在i++之后调用c.erase之前是有一个时序点的。因此就没有二义性问题。</p> 
<p> </p> 这里面举了个函数调用sequence point的例子 
<p> </p> 
<p> </p> 
<p>再次</p> 
<p>gcc 中-Wsequence-point会给warning的</p> 
<p>比如</p> 
<p>#include &lt;stdlib.h&gt;</p> 
<p>int main()<br> {<!-- --><br>         int x = 0;<br>         x += x&gt;0?x++:x--;<br>         x = x+1;<br>         x = x++;<br>         int a[10];<br>         a[x] = x;<br>         return 0;<br> }<br> a.c:6: warning: operation on ‘x’ may be undefined<br> a.c:8: warning: operation on ‘x’ may be undefined</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4eb008f49e770ed31a5d139b78c428e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从细节看，为何360能独占鳌头</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/401bee6dbb0fbe0c0c8c8fe2e6550437/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iOS 点击return或者点击屏幕键盘消失</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>