<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>fastJson配置的(FastJsonConfiguration)的作用 null装换成““ 或者是不返回null值 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="fastJson配置的(FastJsonConfiguration)的作用 null装换成““ 或者是不返回null值" />
<meta property="og:description" content="第一种解决办法 实际开发过程中，当我们返回json数据时,如果数据为空,那么默认返回null（因为ResponseBody这个注解底层就是使用的jackson）。毕竟程序员不喜欢null这个字眼。
那么我们如何不让他返回null呢？我们可以使用fastJson解决。fastJson是阿里巴巴的开源库，被誉为史上最快的Json解析库 首先请看查询结果
因为数据库中enName的值为空,所以查询出的结果就表示为Null。
那么我们如何不返回null，而返回一个&#34; &#34;空的字符串呢？其实很
简单，只需要增加fastjson配置替换默认的jackson配置即可。 下面贴出代码。
/** * @Description FastJson配置类 */ @Configuration public class FastJsonConfiguration implements WebMvcConfigurer { @Override public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) { /* 31 先把JackSon的消息转换器删除. 32 备注: (1)源码分析可知，返回json的过程为: 33 Controller调用结束后返回一个数据对象，for循环遍历conventers，找到支持application/json的HttpMessageConverter，然后将返回的数据序列化成json。 34 具体参考org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor的writeWithMessageConverters方法 35 (2)由于是list结构，我们添加的fastjson在最后。因此必须要将jackson的转换器删除，不然会先匹配上jackson，导致没使用fastjson 36 */ for (int i = converters.size() - 1; i &gt;= 0; i--) { if (converters.get(i) instanceof MappingJackson2HttpMessageConverter) { converters.remove(i); } } FastJsonHttpMessageConverter fastJsonHttpMessageConverter = new FastJsonHttpMessageConverter(); FastJsonConfig fastJsonConfig = new FastJsonConfig(); fastJsonConfig." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1bd61db070e03ae79e18005973bca656/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-02T14:04:48+08:00" />
<meta property="article:modified_time" content="2023-10-02T14:04:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">fastJson配置的(FastJsonConfiguration)的作用 null装换成““ 或者是不返回null值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>第一种解决办法</h3> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> <strong>实际开发过程中，当我们返回json数据时,如果数据为空,那么默认返回null（因为ResponseBody这个注解底层就是使用的jackson）。毕竟程序员不喜欢null这个字眼。<br> 那么我们如何不让他返回null呢？我们可以使用fastJson解决。fastJson是阿里巴巴的开源库，被誉为史上最快的Json解析库</strong></li></ul> 
<p><strong>首先请看查询结果</strong><br> <img src="https://images2.imgbox.com/84/8e/S4QSeHPd_o.png" alt="在这里插入图片描述"><br> <strong>因为数据库中enName的值为空,所以查询出的结果就表示为Null。<br> 那么我们如何不返回null，而返回一个" "空的字符串呢？其实很<br> 简单，只需要增加fastjson配置替换默认的jackson配置即可。 下面贴出代码。</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @Description FastJson配置类
 */</span>
@Configuration
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FastJsonConfiguration</span> implements WebMvcConfigurer <span class="token punctuation">{<!-- --></span>

    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureMessageConverters</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>HttpMessageConverter<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> converters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/*
31
         先把JackSon的消息转换器删除.
32
         备注: (1)源码分析可知，返回json的过程为:
33
                    Controller调用结束后返回一个数据对象，for循环遍历conventers，找到支持application/json的HttpMessageConverter，然后将返回的数据序列化成json。
34
                    具体参考org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor的writeWithMessageConverters方法
35
               (2)由于是list结构，我们添加的fastjson在最后。因此必须要将jackson的转换器删除，不然会先匹配上jackson，导致没使用fastjson
36
        */</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> converters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>converters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> instanceof MappingJackson2HttpMessageConverter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                converters<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        FastJsonHttpMessageConverter fastJsonHttpMessageConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">FastJsonHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FastJsonConfig fastJsonConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">FastJsonConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastJsonConfig<span class="token punctuation">.</span><span class="token function">setSerializerFeatures</span><span class="token punctuation">(</span>
                <span class="token comment">// 防止循环引用</span>
                SerializerFeature<span class="token punctuation">.</span>DisableCircularReferenceDetect<span class="token punctuation">,</span>
                <span class="token comment">// 空集合返回[],不返回null</span>
                SerializerFeature<span class="token punctuation">.</span>WriteNullListAsEmpty<span class="token punctuation">,</span>
                <span class="token comment">// 空字符串返回"",不返回null</span>
                SerializerFeature<span class="token punctuation">.</span>WriteNullStringAsEmpty<span class="token punctuation">,</span>
                SerializerFeature<span class="token punctuation">.</span>WriteDateUseDateFormat<span class="token punctuation">,</span>
                SerializerFeature<span class="token punctuation">.</span>WriteMapNullValue
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastJsonHttpMessageConverter<span class="token punctuation">.</span><span class="token function">setFastJsonConfig</span><span class="token punctuation">(</span>fastJsonConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//处理中文乱码问题</span>
        List<span class="token operator">&lt;</span>MediaType<span class="token operator">&gt;</span> fastMediaTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-function"><span class="token function">ArrayList</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastMediaTypes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON_UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastJsonHttpMessageConverter<span class="token punctuation">.</span><span class="token function">setSupportedMediaTypes</span><span class="token punctuation">(</span>fastMediaTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fastJsonHttpMessageConverter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>接下类我们再次运行。会发现</strong><br> <img src="https://images2.imgbox.com/bf/e2/29REse0A_o.png" alt="在这里插入图片描述"><br> <strong>这样的话,enName的值就变成了了空的字符串。而生效的代码就是这一行</strong></p> 
<pre><code class="prism language-cpp"> <span class="token comment">// 空字符串返回"",不返回null</span>
   SerializerFeature<span class="token punctuation">.</span>WriteNullStringAsEmpty<span class="token punctuation">,</span>
</code></pre> 
<p><strong>那么接下来同学还有疑问就是，我如果不想返回enName这个属性该怎么做呢?其实也很简单，我们只需要在该属性的实体类上增加一个注解即可。</strong><br> <strong>图中标注黄色的部分</strong><br> <img src="https://images2.imgbox.com/97/b0/MGviJG3q_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp">  @<span class="token function">JSONField</span><span class="token punctuation">(</span>serialize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>再次运行</strong><br> <img src="https://images2.imgbox.com/da/7c/5sZF2VGa_o.png" alt="在这里插入图片描述"><br> <strong>这时候就会返现返回的数据没有了enName这个属性。</strong><br> <strong>这是我的数据库中的数据。</strong><br> <img src="https://images2.imgbox.com/f4/62/X7hWpWfL_o.png" alt="在这里插入图片描述"></p> 
<p><a href="https://www.jianshu.com/p/b67de9052743" rel="nofollow"><strong>参考博客1</strong></a><br> <a href="https://www.jianshu.com/p/88a5932d522e" rel="nofollow"><strong>参考博客2</strong></a><br> <a href="https://www.cnblogs.com/zeng1994/p/10853263.html" rel="nofollow"><strong>参考博客3</strong></a><br> <strong><a href="https://www.jianshu.com/p/fc0fdb9ed63f" rel="nofollow">参考博客4</a></strong></p> 
<p><strong>配置fastjson不生效问题<br> <a href="https://blog.csdn.net/john1337/article/details/76275797">参考博客1</a><br> <a href="https://blog.csdn.net/weixin_34216107/article/details/88769517">参考博客2</a></strong></p> 
<p><strong>第二种解决办法 不使用fastJson</strong></p> 
<pre><code>@Configuration
public class MyFastJsonConfig{

    @Bean
    @Primary
    @ConditionalOnMissingBean(ObjectMapper.class)
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        objectMapper.getSerializerProvider().setNullValueSerializer(new JsonSerializer&lt;Object&gt;() {
            @Override
            public void serialize(Object o, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException {
                jsonGenerator.writeString("");
            }
        });
        return objectMapper;
    }

}
</code></pre> 
<p><strong>第三种解决办法</strong></p> 
<pre><code>import com.alibaba.fastjson.serializer.SerializerFeature;
import com.alibaba.fastjson.support.config.FastJsonConfig;
import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.MediaType;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;

import java.nio.charset.Charset;
import java.util.ArrayList;
import java.util.List;

@Configuration
public class FastJsonConfiguration extends WebMvcConfigurationSupport {
	@Override
	public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
		FastJsonHttpMessageConverter converter = new FastJsonHttpMessageConverter();
		FastJsonConfig config = new FastJsonConfig();
		config.setSerializerFeatures(
				// 保留 Map 空的字段
				SerializerFeature.WriteMapNullValue,
				// 将 String 类型的 null 转成""
				SerializerFeature.WriteNullStringAsEmpty,
				// 将 Number 类型的 null 转成 0
				SerializerFeature.WriteNullNumberAsZero,
				// 将 List 类型的 null 转成 []
				SerializerFeature.WriteNullListAsEmpty,
				// 将 Boolean 类型的 null 转成 false
				SerializerFeature.WriteNullBooleanAsFalse,
				// 避免循环引用
				SerializerFeature.DisableCircularReferenceDetect);

		converter.setFastJsonConfig(config);
		converter.setDefaultCharset(Charset.forName("UTF-8"));
		List&lt;MediaType&gt; mediaTypeList = new ArrayList&lt;&gt;();
		// 解决中文乱码问题，相当于在 Controller 上的 @RequestMapping 中加了个属性 produces = "application/json"
		mediaTypeList.add(MediaType.APPLICATION_JSON);
		converter.setSupportedMediaTypes(mediaTypeList);
		converters.add(converter);
	}
</code></pre> 
<p><em><strong>欢迎加入技术群聊</strong></em><br> <img src="https://images2.imgbox.com/5c/ed/9bgUjyjS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_171"></a><em><strong><code>这辈子坚持与不坚持都不可怕，怕的是独自走在坚持的道路上！！！</code></strong></em></h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6499cc2e7cb3daaf2861d054ecf54b87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最小生成树</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b6945da1a1a729044e27cb0dd82e0981/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">管理经济学基本概念(一): 成本、效益、盈亏等</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>