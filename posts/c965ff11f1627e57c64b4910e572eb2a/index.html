<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据学习之Hive函数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据学习之Hive函数" />
<meta property="og:description" content="一. Hive函数基础 1. 聚合函数 hive 支持 count(),max(),min(),sum(),avg() 等常用的聚合函数
注意：
聚合操作时要注意 null 值 count(*) 包含 null 值，统计所有行数 count(id) 不包含 null 值 min 求最小值是不包含 null，除非所有值都是 null avg 求平均值也是不包含 null 2. 关系运算 支持：等值(=)、不等值(!= 或 &lt;&gt;)、小于(&lt;)、小于等于(&lt;=)、大于(&gt;)、大于等于(&gt;=)
空值判断(is null)、非空判断(is not null)
LIKE 比较: LIKE
语法: A LIKE B
操作类型: strings
描述: 如果字符串 A 或者字符串 B 为 NULL，则返回 NULL；如果字符串 A 符合表达式 B 的正则语法，则为TRUE；
3. 数学运算 支持所有数值类型：加(&#43;)、减(-)、乘(*)、除(/)、取余(%)、位与(&amp;)、位或(|)、位异或(^)、位取反(~)
4. 逻辑运算 支持：逻辑与(and)、逻辑或(or)、逻辑非(not)
5. 数值运算 取整函数: round 语法: round(double a)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c965ff11f1627e57c64b4910e572eb2a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-09T18:30:00+08:00" />
<meta property="article:modified_time" content="2023-03-09T18:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据学习之Hive函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style="">一. Hive函数基础</h2> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">1. 聚合函数</span></h3> 
 <p style="">hive 支持 count(),max(),min(),sum(),avg() 等常用的聚合函数</p> 
 <p style="">注意：</p> 
 <blockquote class="kdocs-blockquote" style="">
   聚合操作时要注意 null 值 
  <br>count(*) 包含 null 值，统计所有行数 
  <br>count(id) 不包含 null 值 
  <br>min 求最小值是不包含 null，除非所有值都是 null 
  <br>avg 求平均值也是不包含 null 
 </blockquote> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">2. 关系运算</span></h3> 
 <p style="">支持：等值(=)、不等值(!= 或 &lt;&gt;)、小于(&lt;)、小于等于(&lt;=)、大于(&gt;)、大于等于(&gt;=)</p> 
 <p style="">空值判断(is null)、非空判断(is not null)</p> 
 <p style="">LIKE 比较: LIKE</p> 
 <p style="">语法: A LIKE B</p> 
 <p style="">操作类型: strings</p> 
 <p style="">描述: 如果字符串 A 或者字符串 B 为 NULL，则返回 NULL；如果字符串 A 符合表达式 B 的正则语法，则为TRUE；</p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">3. 数学运算</span></h3> 
 <p style="">支持所有数值类型：加(+)、减(-)、乘(*)、除(/)、取余(%)、位与(&amp;)、位或(|)、位异或(^)、位取反<span class="kdocs-fontSize" style="font-size:9pt;">(~)</span></p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">4. 逻辑运算</span></h3> 
 <p style="">支持：逻辑与(and)、逻辑或(or)、逻辑非(not)</p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">5. 数值运算</span></h3> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>取整函数: round</h4></li></ul> 
 <p style="">语法: round(double a)</p> 
 <p style="">返回值: BIGINT</p> 
 <p style="">说明: 返回 double 类型的整数值部分 （遵循四舍五入）</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>指定精度取整函数: round</h4></li></ul> 
 <p style="">语法: round(double a, int d)</p> 
 <p style="">返回值: DOUBLE</p> 
 <p style="">说明: 返回指定精度 d 的 double 类型</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>向下取整函数: floor</h4></li></ul> 
 <p style="">语法: floor(double a)</p> 
 <p style="">返回值: BIGINT</p> 
 <p style="">说明: 返回等于或者小于该 double 变量的最大的整数</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>向上取整函数: ceil</h4></li></ul> 
 <p style="">语法: ceil(double a)</p> 
 <p style="">返回值: BIGINT</p> 
 <p style="">说明: 返回等于或者大于该 double 变量的最小的整数</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>取随机数函数: rand</h4></li></ul> 
 <p style="">语法: rand(),rand(int seed)</p> 
 <p style="">返回值: double</p> 
 <p style="">说明: 返回一个 0 到 1 范围内的随机数。如果指定种子 seed，则会等到一个稳定的随机数序列</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>自然指数函数: exp</h4></li></ul> 
 <p style="">语法: exp(double a)</p> 
 <p style="">返回值: double</p> 
 <p style="">说明: 返回自然对数 e 的 a 次方</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>以 10 为底对数函数: log10</h4></li></ul> 
 <p style="">语法: log10(double a)</p> 
 <p style="">返回值: double</p> 
 <p style="">说明: 返回以 10 为底的 a 的对数</p> 
 <p style="">此外还有：以 2 为底对数函数: log2()、对数函数: log()</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>幂运算函数: pow</h4></li></ul> 
 <p style="">语法: pow(double a, double p)</p> 
 <p style="">返回值: double</p> 
 <p style="">说明: 返回 a 的 p 次幂</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>开平方函数: sqrt</h4></li></ul> 
 <p style="">语法: sqrt(double a)</p> 
 <p style="">返回值: double</p> 
 <p style="">说明: 返回 a 的平方根</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>二进制函数: bin</h4></li></ul> 
 <p style="">语法: bin(BIGINT a)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明: 返回 a 的二进制代码表示</p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">6. 条件函数</span></h3> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>If 函数: if</h4></li></ul> 
 <p style="">语法: if(boolean testCondition, T valueTrue, T valueFalseOrNull)</p> 
 <p style="">返回值: T</p> 
 <p style="">说明: 当条件 testCondition 为 TRUE 时，返回 valueTrue；否则返回 valueFalseOrNull</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>非空查找函数: coalesce</h4></li></ul> 
 <p style="">语法: coalesce(T v1, T v2, …)</p> 
 <p style="">返回值: T</p> 
 <p style="">说明: 返回参数中的第一个非空值；如果所有值都为 NULL，那么返回 NULL</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>条件判断函数：case when (两种写法，其一)</h4></li></ul> 
 <p style="">语法: case when a then b [when c then d]* [else e] end</p> 
 <p style="">返回值: T</p> 
 <p style="">说明：如果 a 为 TRUE,则返回 b；如果 c 为 TRUE，则返回 d；否则返回 e</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>条件判断函数：case when (两种写法，其二)</h4></li></ul> 
 <p style="">语法: case a when b then c [when d then e]* [else f] end</p> 
 <p style="">返回值: T</p> 
 <p style="">说明：如果 a 等于 b，那么返回 c；如果 a 等于 d，那么返回 e；否则返回 f</p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">7. 日期函数</span></h3> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>获取当前 UNIX 时间戳函数: unix_timestamp</h4></li></ul> 
 <p style="">语法: unix_timestamp()</p> 
 <p style="">返回值: bigint</p> 
 <p style="">说明: 获得当前时区的 UNIX 时间戳</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4> UNIX 时间戳转日期函数: from_unixtime</h4></li></ul> 
 <p style="">语法: from_unixtime(bigint unixtime[, string format])</p> 
 <p style="">返回值: string</p> 
 <p style="">说明: 转化 UNIX 时间戳（从 1970-01-01 00:00:00 UTC 到指定时间的秒数）到当前时区的时间格式</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转 UNIX 时间戳函数: unix_timestamp</h4></li></ul> 
 <p style="">语法: unix_timestamp(string date)</p> 
 <p style="">返回值: bigint</p> 
 <p style="">说明: 转换格式为"yyyy-MM-dd HH:mm:ss"的日期到 UNIX 时间戳。如果转化失败，则返回 0。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>指定格式日期转 UNIX 时间戳函数: unix_timestamp</h4></li></ul> 
 <p style="">语法: unix_timestamp(string date, string pattern)</p> 
 <p style="">返回值: bigint</p> 
 <p style="">说明: 转换 pattern 格式的日期到 UNIX 时间戳。如果转化失败，则返回 0。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期时间转日期函数: to_date</h4></li></ul> 
 <p style="">语法: to_date(string timestamp)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明: 返回日期时间字段中的日期部分。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转年函数: year</h4></li></ul> 
 <p style="">语法: year(string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的年。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转月函数: month</h4></li></ul> 
 <p style="">语法: month (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的月份。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转天函数: day</h4></li></ul> 
 <p style="">语法: day (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的天。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转小时函数: hour</h4></li></ul> 
 <p style="">语法: hour (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的小时。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转分钟函数: minute</h4></li></ul> 
 <p style="">语法: minute (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的分钟。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转秒函数: second</h4></li></ul> 
 <p style="">语法: second (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期中的秒。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期转周函数: weekofyear</h4></li></ul> 
 <p style="">语法: weekofyear (string date)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回日期在当前的周数。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期比较函数: datediff</h4></li></ul> 
 <p style="">语法: datediff(string enddate, string startdate)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明: 返回结束日期减去开始日期的天数。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期增加函数: date_add</h4></li></ul> 
 <p style="">语法: date_add(string startdate, int days)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明: 返回开始日期 startdate 增加 days 天后的日期。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>日期减少函数: date_sub</h4></li></ul> 
 <p style="">语法: date_sub (string startdate, int days)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明: 返回开始日期 startdate 减少 days 天后的日期。</p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">8. 字符串函数</span></h3> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串长度函数：length</h4></li></ul> 
 <p style="">语法: length(string A)</p> 
 <p style="">返回值: int</p> 
 <p style="">说明：返回字符串 A 的长度</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串反转函数：reverse</h4></li></ul> 
 <p style="">语法: reverse(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回字符串 A 的反转结果</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串连接函数：concat</h4></li></ul> 
 <p style="">语法: concat(string A, string B…)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回输入字符串连接后的结果，支持任意个输入字符串</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>带分隔符字符串连接函数：concat_ws</h4></li></ul> 
 <p style="">语法: concat_ws(string SEP, string A, string B…)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回输入字符串连接后的结果，SEP 表示各个字符串间的分隔符</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串截取函数：substr,substring</h4></li></ul> 
 <p style="">语法: substr(string A, int start),substring(string A, int start)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回字符串 A 从 start 位置到结尾的字符串</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串截取函数：substr,substring</h4></li></ul> 
 <p style="">语法: substr(string A, int start, int len),substring(string A, int start, int len)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回字符串 A 从 start 位置开始，长度为 len 的字符串</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串转大写函数：upper,ucase</h4></li></ul> 
 <p style="">语法: upper(string A) ucase(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回字符串 A 的大写格式</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>字符串转小写函数：lower,lcase</h4></li></ul> 
 <p style="">语法: lower(string A) lcase(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回字符串 A 的小写格式</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>去空格函数：trim</h4></li></ul> 
 <p style="">语法: trim(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：去除字符串两边的空格</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>左边去空格函数：ltrim</h4></li></ul> 
 <p style="">语法: ltrim(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：去除字符串左边的空格</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>右边去空格函数：rtrim</h4></li></ul> 
 <p style="">语法: rtrim(string A)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：去除字符串右边的空格</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>正则表达式替换函数：regexp_replace</h4></li></ul> 
 <p style="">语法: regexp_replace(string A, string B, string C)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：将字符串 A 中的符合 java 正则表达式 B 的部分替换为 C。注意，在有些情况下要使用转义字符，类似 oracle 中的 regexp_replace 函数。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>正则表达式解析函数：regexp_extract</h4></li></ul> 
 <p style="">语法: regexp_extract(string subject, string pattern, int index)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：将字符串 subject 按照 pattern 正则表达式的规则拆分，返回 index 指定的字符。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>URL 解析函数：parse_url</h4></li></ul> 
 <p style="">语法: parse_url(string urlString, string partToExtract [, string keyToExtract])</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回 URL 中指定的部分。partToExtract 的有效值为：</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>json 解析函数：get_json_object</h4></li></ul> 
 <p style="">语法: get_json_object(string json_string, string path)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：解析 json 的字符串 json_string,返回 path 指定的内容。如果输入的 json 字符串无效，那么返回 NULL。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>空格字符串函数：space</h4></li></ul> 
 <p style="">语法: space(int n)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回长度为 n 的字符串</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>重复字符串函数：repeat</h4></li></ul> 
 <p style="">语法: repeat(string str, int n)</p> 
 <p style="">返回值: string</p> 
 <p style="">说明：返回重复 n 次后的 str 字符串</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>分割字符串函数: split</h4></li></ul> 
 <p style="">语法: split(string str, string pat)</p> 
 <p style="">返回值: array</p> 
 <p style="">说明: 按照 pat 字符串分割 str，会返回分割后的字符串数组</p> 
 <p style=""></p> 
 <h2 style="">二. Hive函数进阶</h2> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h3>UDTF之explode函数</h3></li></ol> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><h4><span class="kdocs-bold" style="font-weight:bold;">explode语法功能</span></h4></li></ul> 
 <p style="text-indent:1.4em;text-align:left;">explode函数接收map或者array类型的数据作为参数，然后把参数中的每个元素炸开变成一行数据。一个元素一行。这样的效果正好满足于输入一行输出多行。</p> 
 <p style="text-indent:1.4em;text-align:left;">explode函数在关系型数据库中本身是不该出现的。</p> 
 <p style="text-indent:1.4em;text-align:null;">因为他的出现本身就是在操作不满足第一范式的数据（每个属性都不可再分）。本身已经违背了数据库的设计原理，但是在面向分析的数据库或者数据仓库中，这些规范可以发生改变</p> 
 <p style="padding-left:1.4em;text-align:left;">explode(array)将array列表里的每个元素生成一行；</p> 
 <p style="padding-left:1.4em;text-align:left;">explode(map)将map里的每一对元素作为一行，其中key为一列，value为一列；</p> 
 <p style="padding-left:1.4em;text-align:left;">一般情况下，explode函数可以直接使用即可，也可以根据需要结合lateral view侧视图使用。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><h4>explode函数的使用</h4></li></ul> 
 <pre class="kdocs-sql"><code class="language-sql">select explode(`array`(11,22,33)) as item;
select explode(`map`("id",10086,"name","zhangsan","age",18));</code></pre> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:494px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:54.8583%;height:0;"> 
    <img src="https://images2.imgbox.com/41/cc/KlygOqdD_o.png" style="margin-left:;display:block;width:494px;margin-top:-54.8583%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><h3><span class="kdocs-bold" style="font-weight:bold;">Lateral View侧视图</span></h3></li></ol> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><h4><span class="kdocs-bold" style="font-weight:bold;">概念</span></h4></li></ul> 
 <p style="text-indent:1.4em;text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Lateral View</span>是一种特殊的语法，主要用于<span class="kdocs-bold" style="font-weight:bold;">搭配UDTF类型功能的函数一起使用</span>，用于解决UDTF函数的一些查询限制的问题。</p> 
 <p style="text-indent:1.4em;text-align:left;">侧视图的原理是将UDTF的结果构建成一个类似于视图的表，然后将原表中的每一行和UDTF函数输出的每一行进行连接，生成一张新的虚拟表。这样就避免了UDTF的使用限制问题。使用lateral view时也可以对UDTF产生的记录设置字段名称，产生的字段可以用于group by、order by 、limit等语句中，不需要再单独嵌套一层子查询。</p> 
 <p style="text-indent:1.4em;text-align:left;">一般只要使用UDTF，就会固定搭配lateral view使用。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><h4><span class="kdocs-bold" style="font-weight:bold;">UDTF配合侧视图使用</span></h4></li></ul> 
 <p style="text-align:null;">lateral view侧视图基本语法如下</p> 
 <pre class="kdocs-sql"><code class="language-sql">select …… from tabelA lateral view UDTF(xxx) 别名as col1,col2,col3……;</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>行转列</h4></li></ul> 
 <p style="">相关参数说明:</p> 
 <p style="text-indent:1.4em;">CONCAT(string A/col, string B/col…)：返回输入字符串连接后的结果，支持任意个输入字符串;</p> 
 <p style="text-indent:1.4em;">CONCAT_WS(separator, str1, str2,...)：它是一个特殊形式的 CONCAT()。</p> 
 <p style="text-indent:1.4em;">第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL和空字符串。分隔符将被加到被连接的字符串之间;</p> 
 <p style="text-indent:1.4em;">COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生 array 类型字段。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><h4>列转行</h4></li></ul> 
 <p style="">所需函数:</p> 
 <p style="text-indent:1.4em;">EXPLODE(col)：将 hive 一列中复杂的 array 或者 map 结构拆分成多行。</p> 
 <p style="text-indent:1.4em;">LATERAL VIEW</p> 
 <p style="text-indent:1.4em;">用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</p> 
 <p style="text-indent:1.4em;">解释：用于和 split, explode 等 UDTF 一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</p> 
 <p style=""></p> 
 <h2 style="">三. Hive窗口函数</h2> 
 <h3 style="text-align:null;">1. 窗口函数概述</h3> 
 <p style="text-indent:1.4em;text-align:left;">窗口函数（Window functions）是一种SQL函数，非常适合于数据分析，因此也叫做OLAP函数，其最大特点是：输入值是从SELECT语句的结果集中的一行或多行的“窗口”中获取的。你也可以理解为窗口有大有小（行有多有少）。</p> 
 <p style="text-indent:1.4em;text-align:left;">通过OVER子句，窗口函数与其他SQL函数有所区别。如果函数具有OVER子句，则它是窗口函数。如果它缺少OVER子句，则它是一个普通的聚合函数。</p> 
 <p style="text-indent:1.4em;text-align:left;">窗口函数可以简单地解释为类似于聚合函数的计算函数，但是通过GROUP BY子句组合的常规聚合会隐藏正在聚合的各个行，最终输出一行，<span class="kdocs-bold" style="font-weight:bold;">窗口函数聚合后还可以访问当中的各个行，并且可以将这些行中的某些属性添加到结果集中</span>。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:748px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.95722%;height:0;"> 
    <img src="https://images2.imgbox.com/9b/19/yu6pjWZq_o.png" style="margin-left:;display:block;width:748px;margin-top:-33.95722%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2. 窗口函数语法</span></h3> 
 <pre class="kdocs-sql"><code class="language-sql">Function(arg1,..., argn) OVER ([PARTITION BY &lt;...&gt;] [ORDER BY &lt;....&gt;] [&lt;window_expression&gt;])
--其中Function(arg1,..., argn) 可以是下面分类中的任意一个
    --聚合函数：比如sum max avg等
    --排序函数：比如rank row_number等
    --分析函数：比如lead lag first_value等
--OVER [PARTITION BY &lt;...&gt;] 类似于group by 用于指定分组  每个分组你可以把它叫做窗口
--如果没有PARTITION BY 那么整张表的所有行就是一组
--[ORDER BY &lt;....&gt;]  用于指定每个分组内的数据排序规则 支持ASC、DESC
--[&lt;window_expression&gt;] 用于指定每个窗口中 操作的数据范围 默认是窗口中所有行</code></pre> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d642ee917c3322f0a482f90aa7928ec8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年笔试算法-四达时代</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3fa4e10351e6bcd93666665747d7b7f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java线程池优化思路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>