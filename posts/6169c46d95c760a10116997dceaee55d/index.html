<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python中使用BeautifulSoup模块&#43;CSS选择器获取中彩网福彩3D的开奖数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python中使用BeautifulSoup模块&#43;CSS选择器获取中彩网福彩3D的开奖数据" />
<meta property="og:description" content="在上篇博客中，我们使用了BeautifulSoup模块获取中彩网福彩3D的开奖数据，在编写爬虫程序的过程中发现，如果只使用BeautifulSoup模块中的find_all函数来匹配标签解析网页时，工作量较大而且容易出错，这和find_all函数本身的工作原理以及输入输出有关。通过查找，我们发现将BeautifulSoup模块和CSS选择器结合起来使用会提高网络爬虫的编写和运行效率，所以，同样以爬取中彩网中福彩3D的开奖数据为例，讲解BeautifulSoup模块如何与CSS选择器结合使用。首先，将介绍CSS选择器的工作原理和使用方法。
CSS选择器的工作原理和使用方法 CSS选择器的工作原理是：我们在编写CSS时要遵守一些固定的规范，如标签名不加任何修饰符，类名前面加“.”，id名前面加“#”。我们同样可以利用类似的方法筛选元素，用到的方法是soup.select()，返回值的数据类型为列表。 CSS选择器的使用方法如下：
from bs4 import BeautifulSoup # html内容 html = &#34;&#34;&#34; &lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;p class=&#34;title&#34; name=&#34;dromouse&#34;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt; &lt;p class=&#34;story&#34;&gt;Once upon a time there were three little sisters; and their names were &lt;a href=&#34;http://example.com/elsie&#34; class=&#34;sister&#34; id=&#34;link1&#34;&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;, &lt;a href=&#34;http://example.com/lacie&#34; class=&#34;sister&#34; id=&#34;link2&#34;&gt;Lacie&lt;/a&gt; and &lt;a href=&#34;http://example.com/tillie&#34; class=&#34;sister&#34; id=&#34;link3&#34;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.&lt;/p&gt; &lt;p class=&#34;story&#34;&gt;...&lt;/p&gt; &#34;&#34;&#34; # 创建BeautifulSoup对象用于解析网页 soup = BeautifulSoup(html, &#39;lxml&#39;) 1）通过标签名查找" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6169c46d95c760a10116997dceaee55d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-17T22:31:29+08:00" />
<meta property="article:modified_time" content="2018-07-17T22:31:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python中使用BeautifulSoup模块&#43;CSS选择器获取中彩网福彩3D的开奖数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>        在上篇博客中，我们使用了BeautifulSoup模块获取中彩网福彩3D的开奖数据，在编写爬虫程序的过程中发现，如果只使用BeautifulSoup模块中的find_all函数来匹配标签解析网页时，工作量较大而且容易出错，这和find_all函数本身的工作原理以及输入输出有关。通过查找，我们发现将BeautifulSoup模块和CSS选择器结合起来使用会提高网络爬虫的编写和运行效率，所以，同样以爬取中彩网中福彩3D的开奖数据为例，讲解BeautifulSoup模块如何与CSS选择器结合使用。首先，将介绍CSS选择器的工作原理和使用方法。</p> 
<p><strong>CSS选择器的工作原理和使用方法</strong> <br>         CSS选择器的工作原理是：我们在编写CSS时要遵守一些固定的规范，如标签名不加任何修饰符，类名前面加“.”，id名前面加“#”。我们同样可以利用类似的方法筛选元素，用到的方法是soup.select()，返回值的数据类型为列表。 <br>         CSS选择器的使用方法如下：</p> 
<pre class="prettyprint"><code class=" hljs xml">from bs4 import BeautifulSoup

# html内容
html = """
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>The Dormouse's story<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"dromouse"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">b</span>&gt;</span>The Dormouse's story<span class="hljs-tag">&lt;/<span class="hljs-title">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"story"</span>&gt;</span>Once upon a time there were three little sisters; and their names were
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>,
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/lacie"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link2"</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span> and
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/tillie"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link3"</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>;
and they lived at the bottom of a well.<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"story"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
"""
# 创建BeautifulSoup对象用于解析网页
soup = BeautifulSoup(html, 'lxml')
</code></pre> 
<p><strong>1）通过标签名查找</strong></p> 
<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-keyword">print</span>(soup.<span class="hljs-keyword">select</span>(<span class="hljs-string">'title'</span>))
<span class="hljs-comment"># [&lt;title&gt;The Dormouse's story&lt;/title&gt;]</span></code></pre> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('a'))
"""
[<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>,
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/lacie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link2"</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>,
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/tillie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link3"</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]
"""</code></pre> 
<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-keyword">print</span>(soup.<span class="hljs-keyword">select</span>(<span class="hljs-string">'b'</span>))
<span class="hljs-comment"># [&lt;b&gt;The Dormouse's story&lt;/b&gt;]</span></code></pre> 
<p><strong>2）通过类名查找重点内容</strong></p> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('.sister'))
"""
[<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>,
 <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/lacie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link2"</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>, 
 <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/tillie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link3"</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]
"""</code></pre> 
<p><strong>3）通过id名查找</strong></p> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('#link1'))
# [<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]</code></pre> 
<p><strong>4）组合查找</strong> <br>         组合查找即为将标签与标签、标签与类名、标签与id名等组合起来进行查找，例如查找p标签中id为link1的元素或查找head标签的子标签title。</p> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('p #link1'))      # 二者之间用空格隔开
# [<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]</code></pre> 
<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-keyword">print</span>(soup.<span class="hljs-keyword">select</span>(<span class="hljs-string">'head &gt; title'</span>))      <span class="hljs-comment"># 二者之间用&gt;隔开，&gt;表示从父标签到子标签</span>
<span class="hljs-comment"># [&lt;title&gt;The Dormouse's story&lt;/title&gt;]</span></code></pre> 
<p><strong>5）属性查找</strong> <br>         进行属性查找时，属性需要用中括号括起来，当属性和标签属于同一个节点时，中间不能加空格，否则无法匹配到；不在同一节点的标签与属性之间用空格隔开。</p> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('a[class="sister"]'))     # 二者之间不用空格隔开
"""
[<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>,
 <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/lacie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link2"</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>, 
 <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/tillie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link3"</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]
"""</code></pre> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('a[href="http://example.com/elsie"]'))        # 二者之间不用空格隔开
# [<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]</code></pre> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('p a[href="http://example.com/elsie"]'))      # 二者之间用空格隔开
# [<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]</code></pre> 
<p>        soup.select()方法的返回值为列表类型，可以通过遍历的形式输出，并以get_text()方法或.text属性获取内容，代码如下：</p> 
<pre class="prettyprint"><code class=" hljs xml">print(soup.select('a'))
"""
[<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/elsie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link1"</span>&gt;</span><span class="hljs-comment">&lt;!-- Elsie --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>, 
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/lacie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link2"</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>, 
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sister"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://example.com/tillie"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"link3"</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>]
"""</code></pre> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># 遍历列表元素</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> soup.select(<span class="hljs-string">'a'</span>):
    <span class="hljs-comment"># 打印标签元素内容的两种方法</span>
    print(i.get_text())
    print(i.text)
<span class="hljs-string">"""


Lacie
Lacie
Tillie
Tillie
"""</span></code></pre> 
<p>        网页源代码截图如下： <br> </p> 
<center> 
 <br> 
 <img src="https://images2.imgbox.com/46/78/lN1vbZfs_o.png" alt="这里写图片描述" title=""> 
 <br> 
</center> 
<br>         使用BeautifulSoup模块+CSS选择器对页面进行解析的函数如下： 
<p></p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># 定义使用BeautifulSoup和CSS选择器解析页面的函数</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_per_page</span><span class="hljs-params">(url)</span>:</span>
    <span class="hljs-string">"""
    :param url:页面对应的url
    :return: 页面中包含的数据列表
    """</span>
    <span class="hljs-comment"># 创建Request对象</span>
    req = request.Request(url=url)
    <span class="hljs-comment"># 传入用户代理</span>
    req.add_header(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span>)
    <span class="hljs-comment"># 发送请求，读取打开网页</span>
    response = request.urlopen(req)
    <span class="hljs-comment"># 读取网页内容，重新编码</span>
    html = response.read().decode(<span class="hljs-string">'utf-8'</span>)
    <span class="hljs-comment"># 创建BeautifulSoup对象用于解析网页内容</span>
    html_soup = BeautifulSoup(html, <span class="hljs-string">'lxml'</span>)
    <span class="hljs-comment"># 创建存放每个页面数据的列表</span>
    per_page_data = []
    <span class="hljs-comment"># 遍历tr标签列表</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> html_soup.select(<span class="hljs-string">'tr'</span>)[<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>]:
        <span class="hljs-comment"># 创建存放每天数据的列表</span>
        per_day_data = []
        <span class="hljs-comment"># 开奖时间</span>
        time = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(time)
        <span class="hljs-comment"># 期号</span>
        issue = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>].text
        per_day_data.append(issue)
        <span class="hljs-comment"># 中奖号码</span>
        digits = int(str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">0</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">1</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">2</span>].text))
        per_day_data.append(digits)
        <span class="hljs-comment"># 单选</span>
        single_selection = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">3</span>].text
        per_day_data.append(single_selection)
        <span class="hljs-comment"># 组选3</span>
        group_selection_3 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">4</span>].text
        per_day_data.append(group_selection_3)
        <span class="hljs-comment"># 组选6</span>
        group_selection_6 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">5</span>].text
        per_day_data.append(group_selection_6)
        <span class="hljs-comment"># 销售额</span>
        sales = item.select(<span class="hljs-string">'td &gt; strong'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(sales)
        <span class="hljs-comment"># 返奖比例</span>
        return_rates = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">7</span>].text
        per_day_data.append(return_rates)
        <span class="hljs-comment"># 将每天的数据加入每页的数据中</span>
        per_page_data.append(per_day_data)
    <span class="hljs-comment"># 打印消息</span>
    print(<span class="hljs-string">'解析页面成功！'</span>)
    <span class="hljs-comment"># 返回二维列表</span>
    <span class="hljs-keyword">return</span> per_page_data</code></pre> 
<p>        测试代码和效果如下：</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment">#-*-coding:utf-8-*-</span>
<span class="hljs-string">"""
@author:taoshouzheng
@time:2018/7/17 9:07
@email:tsz1216@sina.com
"""</span>

<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np


<span class="hljs-comment"># 定义使用BeautifulSoup和CSS选择器解析页面的函数</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_per_page</span><span class="hljs-params">(url)</span>:</span>
    <span class="hljs-string">"""
    :param url:页面对应的url
    :return: 页面中包含的数据列表
    """</span>
    <span class="hljs-comment"># 创建Request对象</span>
    req = request.Request(url=url)
    <span class="hljs-comment"># 传入用户代理</span>
    req.add_header(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span>)
    <span class="hljs-comment"># 发送请求，读取打开网页</span>
    response = request.urlopen(req)
    <span class="hljs-comment"># 读取网页内容，重新编码</span>
    html = response.read().decode(<span class="hljs-string">'utf-8'</span>)
    <span class="hljs-comment"># 创建BeautifulSoup对象用于解析网页内容</span>
    html_soup = BeautifulSoup(html, <span class="hljs-string">'lxml'</span>)
    <span class="hljs-comment"># 创建存放每个页面数据的列表</span>
    per_page_data = []
    <span class="hljs-comment"># 遍历tr标签列表</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> html_soup.select(<span class="hljs-string">'tr'</span>)[<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>]:
        <span class="hljs-comment"># 创建存放每天数据的列表</span>
        per_day_data = []
        <span class="hljs-comment"># 开奖时间</span>
        time = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(time)
        <span class="hljs-comment"># 期号</span>
        issue = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>].text
        per_day_data.append(issue)
        <span class="hljs-comment"># 中奖号码</span>
        digits = int(str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">0</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">1</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">2</span>].text))
        per_day_data.append(digits)
        <span class="hljs-comment"># 单选</span>
        single_selection = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">3</span>].text
        per_day_data.append(single_selection)
        <span class="hljs-comment"># 组选3</span>
        group_selection_3 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">4</span>].text
        per_day_data.append(group_selection_3)
        <span class="hljs-comment"># 组选6</span>
        group_selection_6 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">5</span>].text
        per_day_data.append(group_selection_6)
        <span class="hljs-comment"># 销售额</span>
        sales = item.select(<span class="hljs-string">'td &gt; strong'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(sales)
        <span class="hljs-comment"># 返奖比例</span>
        return_rates = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">7</span>].text
        per_day_data.append(return_rates)
        <span class="hljs-comment"># 将每天的数据加入每页的数据中</span>
        per_page_data.append(per_day_data)
    <span class="hljs-comment"># 打印消息</span>
    print(<span class="hljs-string">'解析页面成功！'</span>)
    <span class="hljs-comment"># 返回二维列表</span>
    <span class="hljs-keyword">return</span> per_page_data


<span class="hljs-comment"># 主模块</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 调用函数</span>
    page_data = parse_per_page(<span class="hljs-string">'http://kaijiang.zhcw.com/zhcw/html/3d/list.html'</span>)
    <span class="hljs-comment"># 将列表转化为数组</span>
    page_data_array = np.array(page_data)
    <span class="hljs-comment"># 打印</span>
    print(page_data_array)
</code></pre> 
<p></p> 
<center> 
 <br> 
 <img src="https://images2.imgbox.com/ab/0d/YfDkZfAA_o.png" alt="这里写图片描述" title=""> 
 <br> 
</center> 
<br>         总的代码和效果如下： 
<p></p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment">#-*-coding:utf-8-*-</span>
<span class="hljs-string">"""
@author:taoshouzheng
@time:2018/7/17 9:07
@email:tsz1216@sina.com
"""</span>
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-string">"""
使用BeautifulSoup模块和CSS选择器获取中彩网福彩3D的开奖数据
"""</span>


<span class="hljs-comment"># 定义获取所有页面对应的url的函数</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_urls</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""
    :return: url列表
    """</span>
    <span class="hljs-comment"># 创建url列表</span>
    url_list = []
    <span class="hljs-comment"># 第一页的真实请求地址</span>
    ori_url = <span class="hljs-string">'http://kaijiang.zhcw.com/zhcw/html/3d/list.html'</span>
    <span class="hljs-comment"># 加入列表</span>
    url_list.append(ori_url)
    <span class="hljs-comment"># 生成并遍历列表</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> list(range(<span class="hljs-number">2</span>, <span class="hljs-number">247</span>)):
        url = <span class="hljs-string">'http://kaijiang.zhcw.com/zhcw/html/3d/list_'</span> + str(i) + <span class="hljs-string">'.html'</span>
        <span class="hljs-comment"># 加入列表</span>
        url_list.append(url)
    <span class="hljs-comment"># 打印消息</span>
    print(<span class="hljs-string">'成功获取url！'</span>)
    <span class="hljs-comment"># 返回列表</span>
    <span class="hljs-keyword">return</span> url_list


<span class="hljs-comment"># 定义使用BeautifulSoup和CSS选择器解析页面的函数</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_per_page</span><span class="hljs-params">(url)</span>:</span>
    <span class="hljs-string">"""
    :param url:页面对应的url
    :return: 页面中包含的数据列表
    """</span>
    <span class="hljs-comment"># 创建Request对象</span>
    req = request.Request(url=url)
    <span class="hljs-comment"># 传入用户代理</span>
    req.add_header(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span>)
    <span class="hljs-comment"># 发送请求，读取打开网页</span>
    response = request.urlopen(req)
    <span class="hljs-comment"># 读取网页内容，重新编码</span>
    html = response.read().decode(<span class="hljs-string">'utf-8'</span>)
    <span class="hljs-comment"># 创建BeautifulSoup对象用于解析网页内容</span>
    html_soup = BeautifulSoup(html, <span class="hljs-string">'lxml'</span>)
    <span class="hljs-comment"># 创建存放每个页面数据的列表</span>
    per_page_data = []
    <span class="hljs-comment"># 遍历tr标签列表</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> html_soup.select(<span class="hljs-string">'tr'</span>)[<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>]:
        <span class="hljs-comment"># 创建存放每天数据的列表</span>
        per_day_data = []
        <span class="hljs-comment"># 开奖时间</span>
        time = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(time)
        <span class="hljs-comment"># 期号</span>
        issue = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>].text
        per_day_data.append(issue)
        <span class="hljs-comment"># 中奖号码</span>
        digits = int(str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">0</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">1</span>].text) + str(item.select(<span class="hljs-string">'td &gt; em'</span>)[<span class="hljs-number">2</span>].text))
        per_day_data.append(digits)
        <span class="hljs-comment"># 单选</span>
        single_selection = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">3</span>].text
        per_day_data.append(single_selection)
        <span class="hljs-comment"># 组选3</span>
        group_selection_3 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">4</span>].text
        per_day_data.append(group_selection_3)
        <span class="hljs-comment"># 组选6</span>
        group_selection_6 = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">5</span>].text
        per_day_data.append(group_selection_6)
        <span class="hljs-comment"># 销售额</span>
        sales = item.select(<span class="hljs-string">'td &gt; strong'</span>)[<span class="hljs-number">0</span>].text
        per_day_data.append(sales)
        <span class="hljs-comment"># 返奖比例</span>
        return_rates = item.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">7</span>].text
        per_day_data.append(return_rates)
        <span class="hljs-comment"># 将每天的数据加入每页的数据中</span>
        per_page_data.append(per_day_data)
    <span class="hljs-comment"># 打印消息</span>
    print(<span class="hljs-string">'解析页面成功！'</span>)
    <span class="hljs-comment"># 返回二维列表</span>
    <span class="hljs-keyword">return</span> per_page_data


<span class="hljs-comment"># 主模块</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 创建用于存放所有数据的列表</span>
    all_data = []
    <span class="hljs-comment"># 调用函数获取所有的url</span>
    url_list = get_all_urls()
    <span class="hljs-comment"># 遍历列表中的每一个url</span>
    <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> url_list:
        <span class="hljs-comment"># 调用函数解析每一个网页</span>
        page_data = parse_per_page(url=url)
        <span class="hljs-comment"># 将每页的数据加入总的二维列表中</span>
        all_data.extend(page_data)
    <span class="hljs-comment"># 将存放所有数据的二维列表转化为数组</span>
    all_data_array = np.array(all_data)
    <span class="hljs-comment"># 表头信息</span>
    header = <span class="hljs-string">'开奖日期'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'期号'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'中奖号码'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'单选'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'组选3'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'组选6'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'销售额（元）'</span> + <span class="hljs-string">'\t'</span> + <span class="hljs-string">'返奖比例'</span>
    <span class="hljs-comment"># 将数组中元素写入txt文件中</span>
    np.savetxt(<span class="hljs-string">'中彩3D开奖数据.txt'</span>, all_data_array, fmt=<span class="hljs-string">'%s'</span>, delimiter=<span class="hljs-string">'\t'</span>, header=header, comments=<span class="hljs-string">''</span>, encoding=<span class="hljs-string">'utf-8'</span>)
    <span class="hljs-comment"># 打印消息</span>
    print(<span class="hljs-string">'文件写入成功！'</span>)
</code></pre> 
<p>        效果截图： <br> </p> 
<center> 
 <br> 
 <img src="https://images2.imgbox.com/9d/c2/VPnfweJd_o.png" alt="这里写图片描述" title=""> 
 <br> 
 <img src="https://images2.imgbox.com/04/d7/YdOX5eQP_o.png" alt="这里写图片描述" title=""> 
 <br> 
</center> 
<br>         欢迎交流！ QQ：3408649893 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e31072ba53228f6dd6b20a460e6b399b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS Linux 7.4中polkit服务启动失败</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/513cb06338d36912a0262069c447b96a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot简单项目搭建，从数据读取数据展示到页面</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>