<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pyecharts快速入门和疫情数据可视化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pyecharts快速入门和疫情数据可视化" />
<meta property="og:description" content="pyecharts快速入门和疫情数据可视化 前言 pyecharts 是基于百度echarts的一个python库，能够很好的集成python相关的前端框架，显示出来的图表也十分漂亮。是否还在烦恼matplotlib 不够漂亮？这个库让你不再烦恼。
文章目录 pyecharts快速入门和疫情数据可视化前言pyecharts入门疫情数据可视化一、导入相关工具包 二、数据获取三、数据可视化四、全部代码五、总结 pyecharts入门 这里我用官网的一个例子带着大家快速入门
这是一个画柱状图的例子：首先这是一个链式调用
from pyecharts.charts import Bar from pyecharts import options as opts from pyecharts.globals import ThemeType bar = ( Bar(init_opts=opts.InitOpts(theme=ThemeType.LIGHT))#初始化配置项 .add_xaxis([&#34;衬衫&#34;, &#34;羊毛衫&#34;, &#34;雪纺衫&#34;, &#34;裤子&#34;, &#34;高跟鞋&#34;, &#34;袜子&#34;]) .add_yaxis(&#34;商家A&#34;, [5, 20, 36, 10, 75, 90]) .add_yaxis(&#34;商家B&#34;, [15, 6, 45, 20, 35, 66]) .set_global_opts(title_opts=opts.TitleOpts(title=&#34;主标题&#34;, subtitle=&#34;副标题&#34;)) .set_series_opts(label_opts=opts.LabelOpts(font_size=18))) bar.render()#生成html图标 正常调用
bar = Bar(init_opts=opts.InitOpts(theme=ThemeType.LIGHT)) bar.add_xaxis([&#34;衬衫&#34;, &#34;羊毛衫&#34;, &#34;雪纺衫&#34;, &#34;裤子&#34;, &#34;高跟鞋&#34;, &#34;袜子&#34;]) bar.add_yaxis(&#34;商家A&#34;, [5, 20, 36, 10, 75, 90]) bar." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/585e882aa67d2f5969d8e4e49c944d7e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-02T14:40:42+08:00" />
<meta property="article:modified_time" content="2020-04-02T14:40:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pyecharts快速入门和疫情数据可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="pyecharts_0"></a>pyecharts快速入门和疫情数据可视化</h3> 
<h3><a id="_2"></a>前言</h3> 
<p>pyecharts 是基于百度echarts的一个python库，能够很好的集成python相关的前端框架，显示出来的图表也十分漂亮。是否还在烦恼matplotlib 不够漂亮？这个库让你不再烦恼。<br> </p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#pyecharts_0" rel="nofollow">pyecharts快速入门和疫情数据可视化</a></li><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#pyecharts_6" rel="nofollow">pyecharts入门</a></li><li><a href="#_104" rel="nofollow">疫情数据可视化</a></li><li><ul><li><a href="#_106" rel="nofollow">一、导入相关工具包</a></li></ul> 
   </li><li><a href="#_119" rel="nofollow">二、数据获取</a></li><li><a href="#_184" rel="nofollow">三、数据可视化</a></li><li><a href="#_269" rel="nofollow">四、全部代码</a></li><li><a href="#_336" rel="nofollow">五、总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="pyecharts_6"></a>pyecharts入门</h3> 
<p>这里我用官网的一个例子带着大家快速入门</p> 
<p>这是一个画柱状图的例子：首先这是一个链式调用</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> ThemeType

bar <span class="token operator">=</span> <span class="token punctuation">(</span>
    Bar<span class="token punctuation">(</span>init_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>InitOpts<span class="token punctuation">(</span>theme<span class="token operator">=</span>ThemeType<span class="token punctuation">.</span>LIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#初始化配置项</span>
    <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"衬衫"</span><span class="token punctuation">,</span> <span class="token string">"羊毛衫"</span><span class="token punctuation">,</span> <span class="token string">"雪纺衫"</span><span class="token punctuation">,</span> <span class="token string">"裤子"</span><span class="token punctuation">,</span> <span class="token string">"高跟鞋"</span><span class="token punctuation">,</span> <span class="token string">"袜子"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"商家A"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"商家B"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"主标题"</span><span class="token punctuation">,</span> subtitle<span class="token operator">=</span><span class="token string">"副标题"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>font_size<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#生成html图标</span>
</code></pre> 
<p>正常调用</p> 
<pre><code>bar = Bar(init_opts=opts.InitOpts(theme=ThemeType.LIGHT))
bar.add_xaxis(["衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"])
bar.add_yaxis("商家A", [5, 20, 36, 10, 75, 90])
bar.add_yaxis("商家B", [15, 6, 45, 20, 35, 66])
bar.set_global_opts(title_opts=opts.TitleOpts(title="主标题", subtitle="副标题"))
bar.set_series_opts(label_opts=opts.LabelOpts(font_size=18))
bar.render()
</code></pre> 
<p>咱们先看一下输出图片</p> 
<p><img src="https://images2.imgbox.com/32/a9/KyEZdomx_o.png" alt="在这里插入图片描述"></p> 
<p>是不是还挺好看，下面我给大家说如何通过官方api文档来进行学习！</p> 
<ul><li><a href="https://pyecharts.org/#/zh-cn/quickstart" rel="nofollow">官网API</a></li></ul> 
<p><img src="https://images2.imgbox.com/8c/36/MdvvCJUo_o.png" alt="在这里插入图片描述"></p> 
<p>这是网页打开后最左侧的栏目。我们首先看到红箭头指向的配置项部分。</p> 
<p>我们先打开<strong>全局配置项</strong>：</p> 
<p><img src="https://images2.imgbox.com/e2/7d/ERHEMOBI_o.png" alt="在这里插入图片描述"></p> 
<p>这些都是一些大体上的配置，比如图标的大小，工具栏显示等等</p> 
<p>这些配置项的类，除了第二个初始化配置项需要写在图表初始化里的：</p> 
<pre><code>
    Bar(init_opts=opts.InitOpts(theme=ThemeType.LIGHT)
</code></pre> 
<p>就是这里。</p> 
<p>剩下的全局配置项全部写在这里set_global_opts类里面，参数一般是x_opts = opts.XOpts()：</p> 
<pre><code>set_global_opts(title_opts=opts.TitleOpts(title="主标题", subtitle="副标题"))
</code></pre> 
<p>咱们再展开详细说一些，进入这个TitleOpts这个类中：</p> 
<p><img src="https://images2.imgbox.com/ad/72/QiiWZlXm_o.png" alt="在这里插入图片描述"></p> 
<p>右侧的这些是这个类的一些值，如果你不去添加，很多都是默认值。就像咱们上面写的 title=‘主标题’</p> 
<p>如果我们给这个title赋值，他就会使用这个类的默认值，从上图我们能够看到，默认值是None</p> 
<p>接着我们看一下<strong>系列配置项</strong>：</p> 
<p><img src="https://images2.imgbox.com/bd/b6/hvJhCv1Z_o.png" alt="在这里插入图片描述"></p> 
<p>这个配置项主要是针对文字样式、图标样式这些小一点的细节的改变</p> 
<p>这些类方法需要写在这里set_series_opts()方法里：</p> 
<pre><code>set_series_opts(label_opts=opts.LabelOpts(font_size=18))
</code></pre> 
<p>具体的学习方法和上面将的全局配置项一致，这里就不做多解释。</p> 
<p>至于图表的具体方法学习，咱们可以通过查看这个图表类自带的一些方法，比如下图五角星处：</p> 
<p><img src="https://images2.imgbox.com/6d/8e/g5FjZF9r_o.png" alt="在这里插入图片描述"></p> 
<p>最后，推荐官方提供的一个pyecharts各种图表的显示，上面是代码，下面是结果，有助于我们快速使用</p> 
<ul><li><a href="http://gallery.pyecharts.org/#/README" rel="nofollow">Pyecharts 的项目演示</a></li></ul> 
<p><img src="https://images2.imgbox.com/c6/1b/qQqFavgS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_104"></a>疫情数据可视化</h3> 
<h4><a id="_106"></a>一、导入相关工具包</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar <span class="token comment">#pyecharts工具包</span>
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts<span class="token comment">#pyecharts操作包</span>
<span class="token keyword">import</span> requests<span class="token comment">#获取数据</span>
<span class="token keyword">import</span> json<span class="token comment">#编/解码json数据</span>
<span class="token keyword">import</span> re<span class="token comment">#正则表达式匹配</span>
<span class="token keyword">import</span> datetime<span class="token comment">#获取时间</span>
</code></pre> 
<h3><a id="_119"></a>二、数据获取</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url<span class="token operator">=</span><span class="token string">'https://ncov.dxy.cn/ncovh5/view/pneumonia'</span>
    result <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token comment">#访问链接</span>
    today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span><span class="token comment">#20200402</span>
    <span class="token comment">##result.content.decode() 更推荐使用这种方式 平常也可以使用result.text获取，但是可能会导致乱码</span>
    data <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'window.getAreaStat = (.*?)}]}catch'</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token comment">#非贪婪、多行匹配、对匹配大小写不敏感</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#获取所有匹配的字符</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'window.getAreaStat ='</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'}catch'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token comment">#删除多余的字符</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#删除前后的空格</span>
    jsondata <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'../data/'</span><span class="token operator">+</span>today<span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
         json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>jsondata<span class="token punctuation">,</span>f<span class="token punctuation">)</span> <span class="token comment">#注意 如果不加ensure_ascii=False 的话，汉字会转化为ascii码进行存储比如湖北省</span>

</code></pre> 
<p>大部分解释我都写在注释里了，这里挑一些比较重要事的进行强调</p> 
<ul><li> <p>访问链接后，可以通过result.text 获取网页数据，但是容易出现汉字乱码的情况，这里我们一般使用result.content.decode()它会根据获取的网页内容进行自动解码。</p> </li><li> <p>re.search()是从字符串中查找，一般常用于正则表达式匹配。r‘正则表达式’ 这个r的作用就是 后面的字符串是原生字符。什么意思呢，因为在正则表达式匹配中，’\ ‘作为转义字符，如果你想要使用‘\’的话，需要写成l两个\连用。这时候，你加上r就不需要处理这种转义字符了。</p> </li><li> <p>re.S 表示 匹配所有。因为html网页中，每一行的末尾都有一个回车‘\n’符号。而进行正则表达式匹配时，默认遇到’\n’就停止匹配，所以需要我们加上re.S 把这个回车符号包含进去。当然还有其他修饰符,这里我只列出常用的：</p> </li></ul> 
<table><thead><tr><th>修饰符</th><th>描述</th></tr></thead><tbody><tr><td>re.I</td><td>使匹配对大小写不敏感</td></tr><tr><td>re.M</td><td>多行匹配,影响^和$</td></tr><tr><td>re.S</td><td>使.匹配包含换行符在内的所有字符</td></tr><tr><td>re.U</td><td>根据Unicode字符解析字符</td></tr></tbody></table> 
<p>这里解释一下re.M，举个例子：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> re
line <span class="token operator">=</span> <span class="token string">"Counter12345\nICounter556"</span>
result <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span> r<span class="token string">'\d+$'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>
result1 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span> r<span class="token string">'\d+$'</span><span class="token punctuation">,</span> line<span class="token punctuation">,</span>re<span class="token punctuation">.</span>M<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"不加修饰符"</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"加修饰符"</span><span class="token punctuation">,</span>result1<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code>不加修饰符 ['556']
加修饰符 ['12345', '556']
</code></pre> 
<p>不加re.M这个修饰符，表示以这个字符串为整体，来定位开始和结束</p> 
<p>加上re.M这个修饰符，表示以每一行作为字符串的开始和结束。</p> 
<ul><li> <p>json.dump()将json写入到文件中，这里面有个参数 ensure_ascii。若这个参数为False，表示json中的汉字不会被编码成ascii码。默认值为True</p> </li><li> <p>部分数据</p> <pre><code>[{"provinceName": "湖北省", "provinceShortName": "湖北", "currentConfirmedCount": 1283, "confirmedCount": 67802, "suspectedCount": 0, "curedCount": 63326, "deadCount": 3193, "comment": "", "locationId": 420000, "statisticsData": "https://file1.dxycdn.com/2020/0223/618/3398299751673487511-135.json" 
</code></pre> </li></ul> 
<h3><a id="_184"></a>三、数据可视化</h3> 
<p>这里我们使用pyecharts的地图图表作为显示。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">datashow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#数据处理</span>
    today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'../data/'</span><span class="token operator">+</span>today<span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
        jsondata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    listprovince <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    listcount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> jsondata<span class="token punctuation">:</span>
        listprovince<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'provinceShortName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        listcount<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'confirmedCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    pieces <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#540d0d'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">9999</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#9c1414'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#d92727'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">499</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#ed3232'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f27777'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f7adad'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f7e4e4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token builtin">map</span> <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'疫情数据可视化'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>listprovince<span class="token punctuation">,</span>listcount<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'china'</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>visualmap_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>VisualMapOpts<span class="token punctuation">(</span>pieces<span class="token operator">=</span>pieces<span class="token punctuation">,</span>is_piecewise<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/a4/61/6NtAiQOx_o.png" alt="在这里插入图片描述"></p> 
<p>下面就针对代码的一些重点进行一下讲解：</p> 
<ul><li> <p>获取前面保存的json文件，要记得声明编码格式</p> </li><li> <p>通过遍历，将每个省份的名字和确诊数字分别存入数组中。注意，这里要使用简称，比如河北省，我们不能使用全程，要使用河北，要不然pyecharts不识别，无法映射</p> </li><li> <p>实例化map对象，通过add方法添加label和数据。注意数据的格式 应该是</p> <pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'湖北'</span>，<span class="token number">22334</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'河北'</span><span class="token punctuation">,</span><span class="token string">'234'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <p>zip这个函数是将列表存储成上述这样的格式，举个例子</p> <pre><code class="prism language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> data <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> <p>输出结果：</p> <pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>add()方法的第三个参数是显示什么地图，若填入’china‘显示中国地图，填入’广东’则显示广东省地图。</p> </li><li> <p>接着就是设置一些全局配置项</p> </li><li> <p>render()是将map 渲染成html保存下来，默认路径是path=render.html</p> </li><li> <p>可以渲染成图片，不过需要安装snapshot_selenium和下载chrome驱动</p> <pre><code class="prism language-python"><span class="token keyword">from</span> snapshot_selenium <span class="token keyword">import</span> snapshot
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>render <span class="token keyword">import</span> make_snapshot
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
option <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#设置无头模式</span>
option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'headless'</span><span class="token punctuation">)</span>
webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
make_snapshot<span class="token punctuation">(</span>snapshot<span class="token punctuation">,</span> <span class="token builtin">map</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"map.png"</span><span class="token punctuation">)</span>
</code></pre> 
  <ol><li>可以通过 pip install snapshot_selenium 安装snapshot_selenium</li><li>下载chrome驱动，配置环境变量 参考：<a href="https://blog.csdn.net/mango_ZZY/article/details/105138176">pyecharts渲染图片</a></li></ol> </li></ul> 
<h3><a id="_269"></a>四、全部代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>render <span class="token keyword">import</span> make_snapshot
<span class="token keyword">from</span> snapshot_selenium <span class="token keyword">import</span> snapshot
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Map
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">import</span> re
<span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">getdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url<span class="token operator">=</span><span class="token string">'https://ncov.dxy.cn/ncovh5/view/pneumonia'</span>
    result <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span>
    <span class="token comment">##result.content.decode() 更推荐使用这种方式 平常也可以使用result.text获取，但是可能会导致乱码</span>
    data <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'window.getAreaStat = (.*?)}]}catch'</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token comment">#非贪婪、多行匹配、对匹配大小写不敏感</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#获取所有匹配的字符</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'window.getAreaStat ='</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'}catch'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token comment">#删除多余的字符</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#删除前后的空格</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    jsondata <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'../data/'</span><span class="token operator">+</span>today<span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
         json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>jsondata<span class="token punctuation">,</span>f<span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment">#注意 如果不加ensure_ascii=False 的话，汉字会转化为ascii码进行存储比如湖北省</span>

<span class="token keyword">def</span> <span class="token function">datashow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    option <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'headless'</span><span class="token punctuation">)</span>
    webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
    <span class="token comment">#数据处理</span>
    today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'../data/'</span><span class="token operator">+</span>today<span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
        jsondata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    listprovince <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    listcount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>jsondata<span class="token punctuation">)</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> jsondata<span class="token punctuation">:</span>
        listprovince<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'provinceShortName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        listcount<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'confirmedCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>listprovince<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>listcount<span class="token punctuation">)</span>
    pieces <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#540d0d'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">9999</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#9c1414'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#d92727'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">499</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#ed3232'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f27777'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f7adad'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'#f7e4e4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token builtin">map</span> <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'疫情数据可视化'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>listprovince<span class="token punctuation">,</span>listcount<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'china'</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>visualmap_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>VisualMapOpts<span class="token punctuation">(</span>pieces<span class="token operator">=</span>pieces<span class="token punctuation">,</span>is_piecewise<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    make_snapshot<span class="token punctuation">(</span>snapshot<span class="token punctuation">,</span><span class="token builtin">map</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"D:\\python\\Future_data\\data\\map.png"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    getdata<span class="token punctuation">(</span><span class="token punctuation">)</span>
    datashow<span class="token punctuation">(</span><span class="token punctuation">)</span>



</code></pre> 
<h3><a id="_336"></a>五、总结</h3> 
<p>通过这个项目的实战，我们学到了pyecharts的基本用法以及json处理相关操作。希望大家能够在次基础上多去练习。走的时候留个👍 🤭</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80044aff6f6890e28488f17b4d6f86a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">itop4412开发板-QtE4.7-UVC摄像头使用例程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a286d9991c6a547ae25a5f5216164b8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Join</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>