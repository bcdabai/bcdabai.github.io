<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sql Server中 master.dbo.spt_values 的用法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Sql Server中 master.dbo.spt_values 的用法" />
<meta property="og:description" content="master.dbo.spt_values是一个数据库常量表，表里都是一些枚举数据。
我们可以先查询一下看表里都有什么☞
select * from master.dbo.spt_values 查询得知表里有五个字段：☞
name（名称）,number（值）,type（类型）,low（下限）,high（上限）,status（状态）
抽取一个type看下☞
select number from master..spt_values where type = &#39;p&#39; --Type = &#39;P&#39;的number数字范围是0-2047 取1-1000之间的数字 select number from master..spt_values where type=&#39;P&#39; and number between 1 and 1000 取当前日期往后的365个日期 select convert(varchar(10), dateadd(day,number,getdate()), 120) as [日期] from master..spt_values where type = &#39;P&#39; and number between 0 and 365 取2019年4月至2020年3月的月份 select convert(varchar(6),dateadd(month,number,&#39;20190401&#39;),112) as month from master..spt_values where type = &#39;P&#39; and dateadd(month,number,&#39;20190401&#39;) &lt;= &#39;20200301&#39; 取两句话中重复的汉字 declare @text1 varchar(100),@text2 varchar(100) set @text1 = &#39;没有理想的人不伤心&#39; set @text2 = &#39;他也会伤心&#39; SELECT SUBSTRING(@text2,number,1) as value from master." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2a9c5475837f7342ae1dbbdb48285ca1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-25T16:01:05+08:00" />
<meta property="article:modified_time" content="2022-02-25T16:01:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Sql Server中 master.dbo.spt_values 的用法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font color="blue"> master.dbo.spt_values是一个数据库常量表，表里都是一些枚举数据。</font></p> 
<p>我们可以先查询一下看表里都有什么☞</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>spt_values</code></pre> 
<p>查询得知表里有五个字段：☞<br> name（名称）,number（值）,type（类型）,low（下限）,high（上限）,status（状态）</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/e1/27/YicvjoOr_o.png"><br> 抽取一个type看下☞</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> number <span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values <span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'p'</span> 
<span class="token comment">--Type = 'P'的number数字范围是0-2047</span></code></pre> 
<hr> 
<ol><li>取1-1000之间的数字</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> number <span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values 
<span class="token keyword">where</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">'P'</span> <span class="token operator">and</span> number <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1000</span></code></pre> 
<ol start="2"><li>取当前日期往后的365个日期</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dateadd<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span>getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">[</span>日期<span class="token punctuation">]</span>  
<span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values
<span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'P'</span> <span class="token operator">and</span> number <span class="token operator">between</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token number">365</span>  </code></pre> 
<ol start="3"><li>取2019年4月至2020年3月的月份</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dateadd<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token string">'20190401'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span>
<span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values
<span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'P'</span> <span class="token operator">and</span> dateadd<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token string">'20190401'</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token string">'20200301'</span></code></pre> 
<ol start="4"><li>取两句话中重复的汉字</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">declare</span> <span class="token variable">@text1</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">@text2</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token variable">@text1</span> <span class="token operator">=</span> <span class="token string">'没有理想的人不伤心'</span> 
<span class="token keyword">set</span> <span class="token variable">@text2</span> <span class="token operator">=</span> <span class="token string">'他也会伤心'</span>
<span class="token keyword">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token variable">@text2</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">value</span>
<span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values
<span class="token keyword">where</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">'p'</span> <span class="token operator">and</span> number <span class="token operator">&lt;=</span> <span class="token function">LEN</span><span class="token punctuation">(</span><span class="token variable">@text2</span><span class="token punctuation">)</span> <span class="token operator">and</span> CHARINDEX<span class="token punctuation">(</span>SUBSTRING<span class="token punctuation">(</span><span class="token variable">@text2</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">@text1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span></code></pre> 
<ol start="5"><li>求一个日期所在月份的所有日期</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">declare</span> <span class="token variable">@date</span> <span class="token keyword">datetime</span>
<span class="token keyword">set</span> <span class="token variable">@date</span> <span class="token operator">=</span> <span class="token string">'20220225'</span>
<span class="token keyword">select</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">@date</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token keyword">right</span><span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>number<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">[</span>日期格式<span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">,</span>ltrim<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">(</span><span class="token variable">@date</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">right</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">+</span><span class="token keyword">month</span><span class="token punctuation">(</span><span class="token variable">@date</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">right</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token operator">+</span>ltrim<span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">[</span>日期格式<span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">from</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values
<span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'p'</span>
<span class="token operator">and</span> number <span class="token operator">&gt;=</span> <span class="token number">1</span>
<span class="token operator">and</span> number <span class="token operator">&lt;=</span> datediff<span class="token punctuation">(</span>dd<span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">@date</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-01'</span>
    <span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dateadd<span class="token punctuation">(</span>mm<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">@date</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'-01'</span><span class="token punctuation">)</span>



</code></pre> 
<hr> 
<p><strong>练习题：</strong><br> 有如下一张表T<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/19/7d/Sf6mDMsJ_o.png"><br> ITEM表示物料种类，QTY表示发货数量，MIN_QTY表示最小发货量，希望通过SQL查询得出下面的结果：<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/9a/4b/lcv3PRK3_o.png"></p> 
<p>解释：通过MIN_QTY将QTY进行等分，不能够完全等分的，剩余部分用QTY减去等分后的数量。例如230的最小数量是80，可以先等分成2份，剩下部分用230-2*80=70</p> 
<p>提示：可以使用MASTER.DBO.SPT_VALUES进行关联后进行等分（SQL Server的解法）</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> Item<span class="token punctuation">,</span>QTY<span class="token punctuation">,</span>MIN_QTY<span class="token punctuation">,</span>SEQ
<span class="token punctuation">,</span><span class="token keyword">case</span> <span class="token keyword">when</span> MIN_QTY <span class="token operator">*</span> rnk <span class="token operator">&lt;</span> QTY <span class="token keyword">THEN</span> MIN_QTY <span class="token keyword">ELSE</span> QTY<span class="token operator">-</span>MIN_QTY<span class="token operator">*</span><span class="token punctuation">(</span>rnk<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">AS</span> NEW_QTY
<span class="token keyword">from</span> <span class="token punctuation">(</span>
<span class="token keyword">select</span> Item<span class="token punctuation">,</span>QTY<span class="token punctuation">,</span>MIN_QTY<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>MIN_QTY<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span> <span class="token keyword">partition</span> <span class="token keyword">by</span> Item <span class="token punctuation">)</span> <span class="token keyword">as</span> SEQ<span class="token punctuation">,</span>b<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">as</span> rnk
<span class="token keyword">from</span> T a
<span class="token keyword">CROSS</span> <span class="token keyword">join</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>spt_values b
<span class="token keyword">where</span> b<span class="token punctuation">.</span>number <span class="token operator">*</span> a<span class="token punctuation">.</span>MIN_QTY <span class="token operator">&lt;=</span> a<span class="token punctuation">.</span>qty <span class="token operator">and</span> b<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> <span class="token string">'P'</span>
<span class="token punctuation">)</span> a
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/373dac566e3b5921e0309cab832b7084/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TypeScript杂谈(一)——type关键字</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/29b7a1e7fda94dec8d9372550f1c24ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">请求表头headers设置Accept-Encoding为gzip,deflate,br时，python ——requets的get/post返回的结果有可能是乱码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>