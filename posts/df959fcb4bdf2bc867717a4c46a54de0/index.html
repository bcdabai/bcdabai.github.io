<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Androidäº‹ä»¶ä¼ é€’(äºŒ)ï¼šDOWN åœ¨Activityã€Viewã€ViewGroupä¼ é€’ï¼Œé™¤äº†è‡ªå·±æœ¬èº«çš„ä¼ é€’ï¼Œè¿˜åšäº†ä»€ä¹ˆï¼Ÿ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Androidäº‹ä»¶ä¼ é€’(äºŒ)ï¼šDOWN åœ¨Activityã€Viewã€ViewGroupä¼ é€’ï¼Œé™¤äº†è‡ªå·±æœ¬èº«çš„ä¼ é€’ï¼Œè¿˜åšäº†ä»€ä¹ˆï¼Ÿ" />
<meta property="og:description" content="Androidäº‹ä»¶ä¼ é€’(ä¸€)ï¼šActivityã€Viewã€ViewGroupåŠdispatchtouchEventã€onTouchEventæ¢³ç†
Androidäº‹ä»¶ä¼ é€’(ä¸‰)ï¼šäº‹ä»¶åŠ¨ä½œ UP åœ¨Activityã€Viewã€ViewGroupä¼ é€’
Androidäº‹ä»¶ä¼ é€’(å››)ï¼šæ€»ç»“ç¯‡
ä¸‹é¢æºç åŸºäºAndroid11 API30
æ¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä»Activityå¼€å§‹åˆ†æACTION_DOWNåŠ¨ä½œçš„ä¼ é€’ï¼š
1 Activity#dispatchTouchEvent public class Activity extends ContextThemeWrapper implements Window.Callback,...... { ......çœç•¥å…¶å®ƒä»£ç ...... private Window mWindow; public Window getWindow() { return mWindow; } @UnsupportedAppUsage final void attach(Context context,......) { attachBaseContext(context); mFragments.attachHost(null /*parent*/); ğŸ‘‰ mWindow = new PhoneWindow(this, window, activityConfigCallback); mWindow.setCallback(this); ......çœç•¥...... } public boolean dispatchTouchEvent(MotionEvent ev) { if (ev.getAction() == MotionEvent.ACTION_DOWN) { âœç©ºå®ç°ï¼Œä½ å¯ä»¥é‡å†™æ­¤æ–¹æ³•å®ç°è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ï¼Œä½†æ˜¯åªæ˜¯DOWNåŠ¨ä½œä¼šè°ƒç”¨ï¼Œ å…¶å®ƒåç»­åŠ¨ä½œéƒ½ä¸ä¼šæ‰§è¡Œè¯¥æ–¹æ³• onUserInteraction(); } if (getWindow().superDispatchTouchEvent(ev)) { âœgetWindow()å¾—åˆ°çš„å°±æ˜¯PhoneWindow,æ‰€ä»¥å»çœ‹å®ƒçš„superDispatchTouchEvent(ev)æ–¹æ³• return true; } return onTouchEvent(ev); } public void onUserInteraction() { } } ğŸ‘‡Â PhoneWindow." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/df959fcb4bdf2bc867717a4c46a54de0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-17T15:37:19+08:00" />
<meta property="article:modified_time" content="2022-05-17T15:37:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Androidäº‹ä»¶ä¼ é€’(äºŒ)ï¼šDOWN åœ¨Activityã€Viewã€ViewGroupä¼ é€’ï¼Œé™¤äº†è‡ªå·±æœ¬èº«çš„ä¼ é€’ï¼Œè¿˜åšäº†ä»€ä¹ˆï¼Ÿ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://blog.csdn.net/u011288271/article/details/114881303" title="Androidäº‹ä»¶ä¼ é€’(ä¸€)ï¼šActivityã€Viewã€ViewGroupåŠdispatchtouchEventã€onTouchEventæ¢³ç†">Androidäº‹ä»¶ä¼ é€’(ä¸€)ï¼šActivityã€Viewã€ViewGroupåŠdispatchtouchEventã€onTouchEventæ¢³ç†</a></p> 
<p><a href="https://blog.csdn.net/u011288271/article/details/115121917" title="Androidäº‹ä»¶ä¼ é€’(ä¸‰)ï¼šäº‹ä»¶åŠ¨ä½œ UP åœ¨Activityã€Viewã€ViewGroupä¼ é€’">Androidäº‹ä»¶ä¼ é€’(ä¸‰)ï¼šäº‹ä»¶åŠ¨ä½œ UP åœ¨Activityã€Viewã€ViewGroupä¼ é€’</a></p> 
<p><a href="https://blog.csdn.net/u011288271/article/details/115125615" title="Androidäº‹ä»¶ä¼ é€’(å››)ï¼šæ€»ç»“ç¯‡">Androidäº‹ä»¶ä¼ é€’(å››)ï¼šæ€»ç»“ç¯‡</a></p> 
<p>ä¸‹é¢æºç åŸºäº<span style="color:#f33b45;"><strong>Android11 API30</strong></span></p> 
<p>æ¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä»Activityå¼€å§‹åˆ†æACTION_DOWNåŠ¨ä½œçš„ä¼ é€’ï¼š</p> 
<h2>1 Activity#dispatchTouchEvent</h2> 
<pre><code class="language-java">  
public class Activity extends ContextThemeWrapper
        implements Window.Callback,...... {     

        ......çœç•¥å…¶å®ƒä»£ç ......

    private Window mWindow;

    public Window getWindow() {
        return mWindow;
    }
    
    @UnsupportedAppUsage
    final void attach(Context context,......) {
        attachBaseContext(context);

        mFragments.attachHost(null /*parent*/);

     ğŸ‘‰ mWindow = new PhoneWindow(this, window, activityConfigCallback);

        mWindow.setCallback(this);

        ......çœç•¥......
    }
        
   
    public boolean dispatchTouchEvent(MotionEvent ev) {
        if (ev.getAction() == MotionEvent.ACTION_DOWN) {
            âœç©ºå®ç°ï¼Œä½ å¯ä»¥é‡å†™æ­¤æ–¹æ³•å®ç°è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ï¼Œä½†æ˜¯åªæ˜¯DOWNåŠ¨ä½œä¼šè°ƒç”¨ï¼Œ
            å…¶å®ƒåç»­åŠ¨ä½œéƒ½ä¸ä¼šæ‰§è¡Œè¯¥æ–¹æ³•
            onUserInteraction(); 
        }
        if (getWindow().superDispatchTouchEvent(ev)) {
            âœgetWindow()å¾—åˆ°çš„å°±æ˜¯PhoneWindow,æ‰€ä»¥å»çœ‹å®ƒçš„superDispatchTouchEvent(ev)æ–¹æ³•
            return true;
        }
        return onTouchEvent(ev);
    }
  

    public void onUserInteraction() {
        
    }

}</code></pre> 
<p>Â ğŸ‘‡Â PhoneWindow.java</p> 
<pre><code class="language-java">public class PhoneWindow extends Window implements MenuBuilder.Callback {

    ......

    @Override
    public boolean superDispatchTouchEvent(MotionEvent event) {
        âœmDecorå³DecorView
        return mDecor.superDispatchTouchEvent(event);
    }

}</code></pre> 
<p>ğŸ‘‡Â DecorView.java</p> 
<pre><code class="language-java">public class DecorView extends FrameLayoutimplements RootViewSurfaceTaker, ......{

    ......

       
    public boolean superDispatchTouchEvent(MotionEvent event) {
          âœ DecorView extends FrameLayoutï¼Œé—´æ¥ç»§æ‰¿ViewGroup
             æ‰€ä»¥æ¥ç€å»çœ‹ViewGroupçš„dispatchTouchEvent
        return super.dispatchTouchEvent(event);
    }

}
</code></pre> 
<p>ğŸ‘‡Â ViewGroup.java</p> 
<pre><code class="language-java">@UiThread
public abstract class ViewGroup extends View implements ViewParent, ViewManager {


        ......çœç•¥å…¶å®ƒä»£ç ......


     @Override
     public boolean dispatchTouchEvent(MotionEvent ev) {
       
        ......çœç•¥å…¶å®ƒä»£ç ......

        //âœé»˜è®¤å€¼false
        boolean handled = false;

        if (onFilterTouchEventForSecurity(ev)) {
            final int action = ev.getAction();
            final int actionMasked = action &amp; MotionEvent.ACTION_MASK;

            // Handle an initial down.
            if (actionMasked == MotionEvent.ACTION_DOWN) {
              //âœå½“å‰äº‹ä»¶ä¸ºACTION_DOWNï¼Œæ¸…é™¤ä¹‹å‰æ‰€æœ‰çŠ¶æ€ä¸ºæ–°ä¸€è½®äº‹ä»¶åšå‡†å¤‡
                cancelAndClearTouchTargets(ev);
                resetTouchState();
            }

             //âœåˆ¤æ–­äº‹ä»¶æ˜¯å¦è¢«æ‹¦æˆªï¼Œå³onInterceptTouchEventæ–¹æ³•çš„è¿”å›å€¼
            final boolean intercepted;
            
            if (actionMasked == MotionEvent.ACTION_DOWN
                    || mFirstTouchTarget != null) {
                //âœdisallowIntercept æ˜¯å¦å…è®¸æ‹¦æˆªäº‹ä»¶,é€šè¿‡requestDisallowInterceptTouchEventæ–¹æ³•è®¾ç½®ï¼Œè¯¥æ–¹æ³•æ˜¯ViewParentæ¥å£ä¸­çš„æ–¹æ³•ï¼ŒViewGroupå®ç°äº†è¯¥æ–¹æ³•ï¼Œ
                   //å¦‚æœæ˜¯Buttonç­‰ä¸æ˜¯ç»§æ‰¿è‡ªViewGroupçš„æ§ä»¶è¦ä½¿ç”¨getParent().requestDisallowInterceptTouchEvent(boolean)
                final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;
                if (!disallowIntercept) {
                        //âœonInterceptTouchEvent(ev)å°±æ˜¯ViewGroupç‰¹æœ‰çš„æ–¹æ³•ï¼Œå¦‚æœä½ æƒ³åœ¨æŸå¸ƒå±€ä¸­æ‹¦æˆªäº‹ä»¶ï¼Œé‡å†™è¯¥æ–¹æ³•ç”¨æ¥æ‹¦æˆªäº‹ä»¶
                    intercepted = onInterceptTouchEvent(ev);
                    ev.setAction(action); // restore action in case it was changed
                } else {
                    //âœå¦‚æœç¦æ­¢çˆ¶å¸ƒå±€æ‹¦æˆªäº‹ä»¶ï¼Œç›´æ¥ç½®ä¸ºfalse
                    intercepted = false;
                }
            } else {
                //âœå¦‚æœå½“å‰äº‹ä»¶ä¸æ˜¯ACTION_DOWNï¼Œè€Œæ˜¯åç»­çš„MOVEæˆ–è€…UPã€‚æ¯”å¦‚UPäº‹ä»¶çš„ä¼ é€’å°±æ˜¯åœ¨è¿™é‡Œç»ˆæ­¢ï¼Œä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯¦ç»†è¯´
                intercepted = true;
            }

            

            //âœåˆ¤æ–­å½“å‰äº‹ä»¶æ˜¯å¦å·²è¢«å–æ¶ˆ
            final boolean canceled = resetCancelNextUpFlag(this)
                    || actionMasked == MotionEvent.ACTION_CANCEL;

            
            boolean alreadyDispatchedToNewTouchTarget = false;
            //âœæ²¡æœ‰è¢«æ‹¦æˆªä¸”æ²¡æœ‰è¢«å–æ¶ˆ
            if (!canceled &amp;&amp; !intercepted) {
                 //âœACTION_DOWNåŠ¨ä½œæ‰ä¼šéå†å½“å‰å¸ƒå±€æ‰€æœ‰å­æ§ä»¶å»å¯»æ‰¾æœ‰æ— æ¥æ”¶äº‹ä»¶çš„
                if (actionMasked == MotionEvent.ACTION_DOWN
                        || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)
                        || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
                    
                    removePointersFromTouchTargets(idBitsToAssign);

                    final int childrenCount = mChildrenCount;
                    if (newTouchTarget == null &amp;&amp; childrenCount != 0) {
                        final float x =
                                isMouseEvent ? ev.getXCursorPosition() : ev.getX(actionIndex);
                        final float y =
                                isMouseEvent ? ev.getYCursorPosition() : ev.getY(actionIndex);
                         
                       // âœéå†å½“å‰å¸ƒå±€ä¸­æ‰€æœ‰å­æ§ä»¶ï¼Œè¿™ä¸æ˜¯åµŒå¥—å¸ƒå±€å¾ªç¯æ˜¯å½“å‰å¸ƒå±€çš„å­æ§ä»¶ï¼Œå®ƒä»¬æ˜¯å¹¶åˆ—çš„ã€‚
                       //ä»childrenCount - 1å€’ç€éå†ï¼Œæ˜¯å› ä¸ºå­æ§ä»¶å¦‚æœæœ‰é‡å ä¸€å®šæ˜¯åé¢çš„ç›–åœ¨å‰é¢æ§ä»¶çš„ä¸Šé¢ï¼Œæˆ‘ä»¬çš„äº‹ä»¶è¦å…ˆåˆ¤æ–­ä¸Šé¢çš„æ§ä»¶è¦ä¸è¦å¤„ç†äº‹ä»¶ï¼Œå¦‚æœä¸å¤„ç†åœ¨åˆ¤æ–­ä¸‹é¢çš„ã€‚
                        for (int i = childrenCount - 1; i &gt;= 0; i--) {
                            //âœè‡ªå®šä¹‰æ§ä»¶é€šè¿‡é‡å†™getChildDrawingOrderæ–¹æ³•ï¼Œå¯ä»¥æ”¹å˜å­æ§ä»¶çš„åŠ è½½é¡ºåºï¼Œæ‰€ä»¥è¿™é‡Œè·å–å…¶åœ¨çˆ¶å¸ƒå±€ä¸­çœŸæ­£çš„ä½ç½®ã€‚
                               //ä¾‹å¦‚è‡ªå®šä¹‰RecyclerViewå°±å¯ä»¥é‡å†™è¯¥æ–¹æ³•ä¿®æ”¹itemçš„åŠ è½½é¡ºåº
                            final int childIndex = getAndVerifyPreorderedIndex(
                                    childrenCount, i, customOrder);

                            final View child = getAndVerifyPreorderedView(
                                    preorderedList, children, childIndex);
                            if (!child.canReceivePointerEvents()
                                    || !isTransformedTouchPointInView(x, y, child, null)) {
                               //âœè¿™é‡Œæ˜¯åˆ¤æ–­å½“å‰childæ˜¯å¦èƒ½æ¥æ”¶åˆ°äº‹ä»¶ï¼Œæˆ–è€…äº‹ä»¶çš„åæ ‡æ˜¯å¦åœ¨å…¶èŒƒå›´å†…ï¼Œå°±æ˜¯ä½ ç‚¹æ²¡ç‚¹åˆ°å½“å‰childä¸Šï¼Œä½ éƒ½æ²¡æœ‰ç‚¹åˆ°å®ƒä¸Šé¢å°±æŠŠäº‹ä»¶ç»™å®ƒè‚¯å®šæ˜¯ä¸åˆç†çš„ã€‚
                                 //å½“å‰childæ— æ³•æ¥æ”¶äº‹ä»¶æˆ–è€…ä½ ç‚¹çš„åæ ‡ä¸åœ¨å®ƒçš„èŒƒå›´å†…ï¼Œå°±è·³è¿‡å®ƒï¼Œç»§ç»­åˆ¤æ–­ä¸‹ä¸€ä¸ªchildã€‚ 
                                continue;
                            }
                             //âœåˆ¤æ–­childæ˜¯å¦å·²åœ¨mFirstTouchTargeté“¾è¡¨ä¸­
                             newTouchTarget = getTouchTarget(child);
                            if (newTouchTarget != null) {
                                //âœå¦‚æœåœ¨mFirstTouchTargeté“¾è¡¨ä¸­æ‰¾åˆ°childå°±åœæ­¢å¯»æ‰¾å½“å‰äº‹ä»¶æ¥æ”¶æ§ä»¶å¹¶æŠŠå½“å‰äº‹ä»¶çš„idBitsToAssignæ·»åŠ åˆ°å…¶pointerIdBitsä¸­
                                newTouchTarget.pointerIdBits |= idBitsToAssign;
                                break;
                            }



                            âœ ğŸ”ºé‡å¤´æˆæ¥å–½ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°æˆ‘ä»¬ç‚¹å‡»ä¸Šçš„ä¸€ä¸ªchildï¼Œä¸‹é¢å°±åˆ¤æ–­è¿™ä¸ªchildæ˜¯ä¸æ˜¯æ¥æ”¶å¤„ç†äº‹ä»¶ã€‚è¿™é‡Œæˆ‘ç»™å®ƒèµ·äº†ä¸ªåå­—ï¼šåµŒå¥—å¾ªç¯èµ·æºã€‚åé¢ä¼šç”¨åˆ°è¿™ä¸ªåå­—ï¼ï¼ï¼
                            if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
                               ......
                        }
                        if (preorderedList != null) preorderedList.clear();
                    }

                   .......
                }
            }
            

        ......åé¢éƒ¨åˆ†æ”¾åœ¨åé¢åˆ†æ..........

        return handled;
    }

    
   

}</code></pre> 
<p>ğŸ‘‡çœ‹ä¸€ä¸‹ <strong>dispatchTransformedTouchEvent(MotionEvent , boolean ,View , int )</strong>æ–¹æ³•</p> 
<pre><code class="language-java"> âš ï¸ğŸ”ºğŸ”ºè¿™é‡Œåˆ†ä¸ºä¸‰ç§æƒ…å†µ
    private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,
            View child, int desiredPointerIdBits) {
        final boolean handled;

**************************** æƒ…å†µ1 äº‹ä»¶è¢«å–æ¶ˆ ******************************************
        //âœå…ˆä¿å­˜å½“å‰eventçš„actionåˆ°oldActionä¸­ 
        final int oldAction = event.getAction();

        //âœå¦‚æœå·²å–æ¶ˆ
        if (cancel || oldAction == MotionEvent.ACTION_CANCEL) {
            //âœæŠŠå½“å‰eventçš„actionè®¾ç½®ä¸ºACTION_CANCEL
            //é‡è¦çš„æ˜¯å°†ACTION_CANCELè¿™ä¸€åŠ¨ä½œä¼ é€’ä¸‹å»ï¼Œè€Œä¸éœ€è¦å…¶ä»–å¦å¤–çš„å˜æ¢æ“ä½œã€‚
            event.setAction(MotionEvent.ACTION_CANCEL);
        
            if (child == null) { 
 //è¿™é‡Œchildä¸ºå•¥æœ‰å¯èƒ½ä¸ºnullå‘¢ï¼Ÿè¿™é‡Œæ­£å¸¸çˆ¶å¸ƒå±€æœ‰å­å¸ƒå±€ï¼Œå­å¸ƒå±€ä¸å¯èƒ½ä¸ºnullã€‚è€Œæ˜¯å› ä¸º
 //è°ƒç”¨dispatchTransformedTouchEventæœ‰å¤šå¤„éä¸€å¤„ï¼Œæœ‰å¯èƒ½ä¼ çš„å°±æ˜¯null.
 //æ‰€ä»¥æ­¤å¤„æ˜¯å¦ä¸ºnullæ˜¯åŒºåˆ†æ˜¯å¦è‡ªå·±å¤„ç†è¿˜æ˜¯ç»§ç»­çºµå‘ä¼ é€’ 
                
                handled = super.dispatchTouchEvent(event);
            } else {
               
                handled = child.dispatchTouchEvent(event);
            }
            event.setAction(oldAction);
            return handled;
        }


********************************** æƒ…å†µ2 æœ€å¸¸ç”¨çš„ è¯¦ç»†åˆ†æ *******************************
        //âœè·å–æ‰€æœ‰è§¦æ‘¸ç‚¹ï¼Œæ”¾åœ¨ä¸€ä¸ªintä¸­é«˜8ä½ç´¢å¼•ä½8ä½åŠ¨ä½œç±»å‹ï¼›å› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¤šæŒ‡æ“ä½œè€Œä¸æ˜¯ä¸€ä¸ªæ‰‹æŒ‡
        final int oldPointerIdBits = event.getPointerIdBits();
        //âœ &amp;ï¼ˆä¸æ“ä½œï¼‰æ˜¯éƒ½æ˜¯1æ‰ä¸º1ã€‚æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å•æŒ‡æ“ä½œæ‰€ä»¥oldPointerIdBitså’ŒdesiredPointerIdBitsç›¸åŒä¸æ“ä½œä»¥åè¿˜æ˜¯ä¸å˜å³newPointerIdBits = oldPointerIdBitsï¼›
            //å¦‚æœoldPointerIdBits å­˜æœ‰å¤šä¸ªè§¦æ‘¸ç‚¹å†å’Œå½“å‰ä¸€ä¸ªåŠ¨ä½œçš„desiredPointerIdBitsè¿›è¡Œ&amp;æ“ä½œå¾—åˆ°çš„newPointerIdBitsè‚¯å®šå’ŒoldPointerIdBitsä¸ç›¸ç­‰ã€‚
        final int newPointerIdBits = oldPointerIdBits &amp; desiredPointerIdBits;
        
        //âœç”±äºæŸäº›å¼‚å¸¸å¯¼è‡´æ¥æ”¶è§¦æ‘¸ç‚¹æ‰¾ä¸åˆ°ï¼Œå°±ç›´æ¥æŠ›å¼ƒå½“å‰äº‹ä»¶
        if (newPointerIdBits == 0) {
            return false;
        }

        final MotionEvent transformedEvent;
        //âœä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯ä¸€æ ¹æ‰‹æŒ‡æ“ä½œå±å¹•ï¼Œæ–°æ—§è§¦æ‘¸ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ‰€ä»¥ç›¸ç­‰
        if (newPointerIdBits == oldPointerIdBits) {
            if (child == null || child.hasIdentityMatrix()) {
                if (child == null) {
                     //âœæ²¡æœ‰child,äº‹ä»¶äº¤ç»™è‡ªå·±å¤„ç†ï¼Œè°ƒç”¨çˆ¶ç±»Viewçš„dispatchTouchEventï¼Œåˆ¤æ–­æ˜¯å¦æ¶ˆè´¹æ­¤äº‹ä»¶åŠ¨ä½œ
                    handled = super.dispatchTouchEvent(event);
                } else {
                    //âœè¿™é‡Œè¿›è¡Œåæ ‡è½¬æ¢ï¼Œä¸Šé¢CANCELçš„æƒ…å†µä¸‹å°±åªæ˜¯ä¼ é€’actionï¼Œå¹¶ä¸éœ€è¦è¿›è¡Œè½¬æ¢æ“ä½œ
                    final float offsetX = mScrollX - child.mLeft;
                    final float offsetY = mScrollY - child.mTop;
                    event.offsetLocation(offsetX, offsetY);

                  âœchildä¸ä¸ºnullï¼Œåˆ†ä¸¤ç§(æœ€åé¢æœ‰å¦å¤–åˆ†æ):
                     ğŸ”º1.å¦‚æœchildæ˜¯LinearLayoutç­‰ç›´æ¥ç»§æ‰¿ViewGrouå°±ä¼šåµŒå¥—è°ƒç”¨dispatchTouchEventç»§ç»­æ£€æŸ¥å…¶å†…æ˜¯å¦æœ‰child,è¿™æ ·å°±æŠŠå¸ƒå±€å±‚å±‚éå†ç›´åˆ°æœ€é‡Œå±‚,è¿™é‡Œæ˜¯çºµå‘å¾€å¸ƒå±€å†…å±‚å¾ªç¯çš„å…³é”®!ğŸ”º
                       2.å¦‚æœchildæ˜¯Buttonç­‰ç»§æ‰¿è‡ªViewé‚£å°±æ˜¯è°ƒç”¨Viewçš„dispatchTouchEventåˆ¤æ–­å½“å‰childæ˜¯å¦æ¥æ”¶å¤„ç†å½“å‰äº‹ä»¶ã€‚ä¼šæ ¹æ®æ˜¯å¦æ¥æ”¶äº‹ä»¶å¼€å§‹é€å±‚å‘å¤–è¿”å›äº†ã€‚
                    //PSï¼šè¿™é‡Œè¦æ³¨æ„æ¯”å¦‚childæ˜¯ä½ è‡ªå·±å®šä¹‰äº†ä¸€ä¸ªLinearLayouté‡å†™äº†dispatchTouchEvent
                        //è¿™é‡Œå°±ä¼šæ‰§è¡Œä½ è‡ªå·±é‡å†™çš„dispatchTouchEventé™¤éä½ ä½¿ç”¨é»˜è®¤è¿”å›å€¼super.dispatchTouchEvent(ev)ï¼Œ
                        //å¦åˆ™æ— è®ºä½ è¿”å›trueè¿˜æ˜¯falseï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¸ä¼šç»§ç»­å¾€å†…éƒ¨ä¼ é€’äº†ã€‚
                        //å› ä¸ºæ‰§è¡Œçš„æ˜¯ä½ è‡ªå·±é‡å†™çš„dispatchTouchEventè€Œä¸æ˜¯ViewGroupçš„dispatchTouchEventä½ è‡ªå·±çš„dispatchTouchEventæ–¹æ³•é‡Œå¯æ²¡æœ‰forå¾ªç¯éå†childæ¥ä¼ é€’äº‹ä»¶
                    handled = child.dispatchTouchEvent(event);

                    event.offsetLocation(-offsetX, -offsetY);
                }
                return handled;
            }
            transformedEvent = MotionEvent.obtain(event);
        } else {
            //âœæ–°æ—§è§¦æ‘¸ç‚¹ä¸ç›¸åŒçš„æƒ…å†µä¸‹è¿›è¡Œæ‹†åˆ†æ–°æ„æˆä¸€ä¸ªMotionEvent transformedEvent
            transformedEvent = event.split(newPointerIdBits);
        }


********************************** æƒ…å†µ3 ********************************************
        //âœ è¿™ä¸ªæ€ä¹ˆåˆæ¥äº†ä¸€ä¸ªè¿™æ ·çš„åˆ¤æ–­ï¼Œå‰é¢éƒ½æœ‰ä¸¤ä¸ªäº†ï¼Œè¿™é‡Œè¿™ä¸ªæœ‰ä»€ä¹ˆç”¨ï¼Ÿ
            //è¿˜è®°å¾—ä¸Šé¢newPointerIdBits != oldPointerIdBitsæƒ…å†µä¸‹æ‹†åˆ†å‡ºæ¥ä¸€ä¸ªMotionEvent transformedEvent ä¸Šé¢åªæ˜¯æ‹†åˆ†äº‹ä»¶è¿˜æ²¡åˆ†å‘ï¼Œåœ¨è¿™é‡Œè¿›è¡Œåˆ†å‘ã€‚
        if (child == null) {
            handled = super.dispatchTouchEvent(transformedEvent);
        } else {
            final float offsetX = mScrollX - child.mLeft;
            final float offsetY = mScrollY - child.mTop;
            transformedEvent.offsetLocation(offsetX, offsetY);
            if (! child.hasIdentityMatrix()) {
                transformedEvent.transform(child.getInverseMatrix());
            }

            handled = child.dispatchTouchEvent(transformedEvent);
        }

        // Done.
        transformedEvent.recycle();
        return handled;
    }


ğŸ”ºï¼šæˆ‘ä»¬æœ€ç»ˆç›®çš„æ˜¯æ‰¾åˆ°æ¥æ”¶äº‹ä»¶çš„æ§ä»¶ï¼Œé‚£é¦–å…ˆæ˜¯æ‰¾åˆ°å¸ƒå±€çš„æœ€é‡Œå±‚æ§ä»¶
 
          if (child == null) {
                    âœ 1 é‡Œå±‚å¸ƒå±€å®¹å™¨æ²¡æœ‰child,äº‹ä»¶äº¤ç»™è‡ªå·±å¤„ç†ï¼Œè°ƒç”¨çˆ¶ç±»Viewçš„dispatchTouchEventï¼Œåˆ¤æ–­æ˜¯å¦æ¶ˆè´¹æ­¤äº‹ä»¶åŠ¨ä½œ
                    handled = super.dispatchTouchEvent(event);
                } else {
                    
                  âœ 2 åˆ°è¿™é‡Œå¦‚æœchildæ˜¯å®¹å™¨æ¯”å¦‚Linearlayoutä¼šå»æ‰¾å®ƒè¿˜æœ‰æ²¡æœ‰å­å¸ƒå±€ï¼Œå¦‚æœæ²¡æœ‰            
                        å°±æ˜¯ä¸Šé¢child==null; å¦‚æœæœ‰å°±ç»§ç»­æ‰¾ç›´åˆ°æœ€é‡Œå±‚æ˜¯åƒButtonç­‰Viewçš„å­ç±»ï¼Œ
                        æ­¤æ—¶child.dispatchTouchEventå°±æ˜¯View.dispatchTouchEvent
               handled = child.dispatchTouchEvent(event);

                    event.offsetLocation(-offsetX, -offsetY);
                }
                return handled;
 åœ¨æ‰¾åˆ°æœ€é‡Œå±‚æ§ä»¶çš„æ—¶å€™ï¼Œéƒ½æ˜¯è°ƒç”¨Viewçš„dispatchTouchEventæ–¹æ³•åˆ¤æ–­æ§ä»¶æ˜¯å¦æ¥æ”¶å¤„ç†äº‹ä»¶åŠ¨ä½œ
 æ¥ä¸‹æ¥å°±çœ‹View.dispatchTouchEventæ˜¯å¦‚ä½•åˆ¤æ–­æ§ä»¶æ˜¯å¦èƒ½æ¥æ”¶äº‹ä»¶åŠ¨ä½œçš„ã€‚
 PSï¼šè‡ªå®šä¹‰dispatchTouchEventä¸Šé¢æ³¨é‡Šä¹Ÿè¯´äº†ï¼Œè¿™é‡Œå°±å…ˆä¸è€ƒè™‘ï¼Œå…ˆèµ°é»˜è®¤æµç¨‹ã€‚  </code></pre> 
<p>ğŸ‘‡é‚£å°±çœ‹ä¸€ä¸‹ <strong>Viewçš„dispatchTouchEvent(MotionEvent)</strong>æ–¹æ³•</p> 
<pre><code class="language-java">@UiThread
public class View implements Drawable.Callback, KeyEvent.Callback,
        AccessibilityEventSource {

    public boolean dispatchTouchEvent(MotionEvent event) {
        
        //âœåˆå§‹åŒ–resulté»˜è®¤å€¼
        boolean result = false;

        

        final int actionMasked = event.getActionMasked();

        if (actionMasked == MotionEvent.ACTION_DOWN) {
            // Defensive cleanup for new gesture
            stopNestedScroll();
        }
            //âœé˜²æ­¢ç¨‹åºæ¶æ„é®ç›–ï¼Œè¯¯å¯¼ç”¨æˆ·
        if (onFilterTouchEventForSecurity(event)) {
            if ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) {
                result = true;
            }
            
            ListenerInfo li = mListenerInfo;
            if (li != null &amp;&amp; li.mOnTouchListener != null
                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED
                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {
                //âœè¦åˆ°è¿™é‡Œæ»¡è¶³å››ä¸ªæ¡ä»¶ï¼š
                        1 liå³mListenerInfoä¸ä¸ºnull;
                        2 li.mOnTouchListenerä¸ä¸ºnullå³æˆ‘ä»¬è‡ªå·±setOnTouchListener()
                        3 (mViewFlags &amp; ENABLED_MASK) == ENABLED æ§ä»¶å¯æ“ä½œ
                        4 æˆ‘ä»¬åœ¨setOnTouchListeneræ—¶OnTouchListenerä¸­é‡å†™çš„onTouchæ–¹æ³•è¿”å›true
                          PS:ç‚¹è¿› setOnTouchListener(onTouchListener)æ–¹æ³•å°±æ˜¯li.mOnTouchListener = onTouchListener
                result = true;
            }

            if (!result &amp;&amp; onTouchEvent(event)) {
                //âœå¦‚æœæ²¡æœ‰æ»¡è¶³ä¸Šä¸€æ¡ä»¶resultè¿˜æ˜¯falseï¼Œä¼šè°ƒç”¨onTouchEvent(event)åˆ†ä¸¤ç§æƒ…å†µ
                //    1 æˆ‘ä»¬é‡å†™äº†onTouchEventï¼Œä¼šæ ¹æ®æˆ‘ä»¬é‡å†™çš„returnå€¼æ¥åˆ¤æ–­
                //    2 æˆ‘ä»¬æ²¡æœ‰é‡å†™onTouchEventï¼Œå°±ä¼šè°ƒç”¨Viewé»˜è®¤çš„onTouchEventæ–¹æ³•(çœ‹ä¸‹é¢)
                
                result = true;
            }
        }

        

        return result;
    }

     //âœViewmé»˜è®¤onTouchEventæ–¹æ³• 
     public boolean onTouchEvent(MotionEvent event) {
        //âœäº‹ä»¶åæ ‡æ ‡å¿—ï¼ŒåŠ¨ä½œç­‰èµ‹å€¼
        final float x = event.getX();
        final float y = event.getY();
        final int viewFlags = mViewFlags;
        final int action = event.getAction();
        //âœåˆ¤æ–­æ˜¯å¦å¯ç‚¹å‡»
        final boolean clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE
                || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)
                || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;

        if ((viewFlags &amp; ENABLED_MASK) == DISABLED) {
            if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) {
                setPressed(false);
            }
            mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;
            // A disabled view that is clickable still consumes the touch
            // events, it just doesn't respond to them.
            return clickable;
        }
        //âœæ˜¯å¦è®¾ç½®å§”æ‰˜ï¼Œä¸€èˆ¬æ˜¯ä¸æ”¹å˜å¸ƒå±€é€šè¿‡å§”æ‰˜æ‰©å¤§ç‚¹å‡»èŒƒå›´,å¯å»æœç´¢çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚
        if (mTouchDelegate != null) {
            if (mTouchDelegate.onTouchEvent(event)) {
                return true;
            }
        }

        if (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) {
            switch (action) {
                //âœæŠ¬èµ·åŠ¨ä½œï¼Œæ ‡å¿—ä¸€ä¸ªäº‹ä»¶çš„ç»“æŸã€‚åƒæœ€å¸¸ç”¨çš„ç‚¹å‡»ï¼Œå°±æ˜¯åœ¨UPè¿™ä¸ªäº‹ä»¶ç»“æŸæ—¶ä¸­å›è°ƒè€Œä¸æ˜¯DOWNæŒ‰ä¸‹æ—¶å°±ä¼šåˆ¤æ–­
                case MotionEvent.ACTION_UP:
                    //âœå†åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦å¯ç‚¹å‡»ï¼Œè‹¥å¦ç›´æ¥break
                    if (!clickable) {
                        removeTapCallback();
                        removeLongPressCallback();
                        mInContextButtonPress = false;
                        mHasPerformedLongPress = false;
                        mIgnoreNextUpEvent = false;
                        break;
                    }
                    boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;
                    if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) {
                       
                        
                        //âœæ²¡æœ‰è¿›è¡Œæ˜¯å¦é•¿æŒ‰åˆ¤æ–­ä¸”upåŠ¨ä½œä¸å¯è¢«å¿½ç•¥   
                        if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) {
                             

                            
                            if (!focusTaken) {
                                
                                
                                if (mPerformClick == null) {
                                    mPerformClick = new PerformClick();
                                }
                                //âœå¯¹äºonClickListenerçš„å›è°ƒæ˜¯é€šè¿‡post(mPerformClick)è€Œä¸æ˜¯ç›´æ¥æ‰§è¡ŒperformClickInternal()
                                  //è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ç‚¹å‡»æ“ä½œæ‰§è¡Œå‰è§†å›¾æ•ˆæœæ‰§è¡Œå®Œæ¯•ï¼Œæˆ‘ä»¬å°±å»çœ‹çœ‹post(mPerformClick)æ˜¯å•¥
                                if (!post(mPerformClick)) {
                                    performClickInternal();
                                }
                            }
                        }

                        
                    }
                    
                    break;
                //âœæŒ‰ä¸‹æ“ä½œé‡Œé¢ä¼šå¼€å¯æ˜¯ç‚¹å‡»è¿˜æ˜¯é•¿æŒ‰çš„æ£€æµ‹
                case MotionEvent.ACTION_DOWN:
                     
                    //âœæ˜¯å¦åˆ¤æ–­é•¿æŒ‰é»˜è®¤æ˜¯falseæ²¡æœ‰åˆ¤æ–­ï¼Œåªæœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰ä¼šåˆ¤æ–­æ˜¯å¦é•¿æŒ‰
                    mHasPerformedLongPress = false;

                    if (isInScrollingContainer) {
                           ......
                    } else {
                        // Not inside a scrolling container, so show the feedback right away
                        setPressed(true, x, y);
                        //âœæ™®é€šç‚¹å‡»äº‹ä»¶èµ°è¿™é‡Œåˆ¤æ–­æ˜¯æ˜¯å¦æ˜¯é•¿æŒ‰,ä¼šæ‰§è¡Œä¸€ä¸ªCheckForLongPresså…¶å®ç°äº†Runnable 
                        checkForLongClick(
                                ViewConfiguration.getLongPressTimeout(),
                                x,
                                y,
                                TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS);
                    }

                    break;

                case MotionEvent.ACTION_CANCEL:
                    if (clickable) {
                        setPressed(false);
                    }
                    removeTapCallback();
                    removeLongPressCallback();
                    mInContextButtonPress = false;
                    mHasPerformedLongPress = false;
                    mIgnoreNextUpEvent = false;
                    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;
                    break;

                case MotionEvent.ACTION_MOVE:
                  
                         ......

                    break;
            }

            return true;
        }

        return false;
    }

}</code></pre> 
<p>å›è°ƒç‚¹å‡»ç›‘å¬çš„ <strong>post(mPerformClick)</strong> ä¸­å…ˆçœ‹Â <strong>mPerformClick = new PerformClick();</strong>Â </p> 
<pre><code class="language-java">private final class PerformClick implements Runnable {
        @Override
        public void run() {
            recordGestureClassification(TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__SINGLE_TAP);
            performClickInternal();
        }
    }


 private boolean performClickInternal() {
        
        notifyAutofillManagerOnClick();

        return performClick();
    }

 public boolean performClick() {
       

        final boolean result;
        final ListenerInfo li = mListenerInfo;
        if (li != null &amp;&amp; li.mOnClickListener != null) {
            playSoundEffect(SoundEffectConstants.CLICK);
            li.mOnClickListener.onClick(this);
            âœli = mListenerInfoæœ‰æ²¡æœ‰æ„Ÿåˆ°å¾ˆç†Ÿæ‚‰ï¼Œè®¾ç½®TouchListenerå°±æ˜¯ç”¨åˆ°è¿™ä¸ª    
                åŒæ ·ï¼Œæˆ‘ä»¬setOnClickListenerä¹Ÿæ˜¯ç›´æ¥èµ‹å€¼ç»™li.mOnClickListenerï¼Œå¦‚æœæˆ‘ä»¬
                è®¾ç½®äº†OnClickListenerå°±ä¼šåœ¨è¿™é‡Œè¢«å›è°ƒ
        
            
            result = true;
        } else {
            âœå¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®å°±èµ°è¿™é‡Œ ç½®ä¸ºfalse ï¼Œæœ€åreturnå‡ºå»
            result = false;
        }

        return result;
    }</code></pre> 
<p>å†çœ‹Viewçš„post(Â  )æ–¹æ³•æ˜¯ä»€ä¹ˆæ ·çš„</p> 
<pre><code class="language-java"> public boolean post(Runnable action) {
        final AttachInfo attachInfo = mAttachInfo;
        if (attachInfo != null) {
            âœä¸€èˆ¬æƒ…å†µä¸‹attachInfo ä¸ä¸ºnull,é€šè¿‡å…¶handleræŠŠmPerformClickå‘é€æ‰§è¡Œ
                æˆ‘ä»¬çš„onClickListenerå›è°ƒä¹Ÿå°±è¢«è°ƒç”¨äº†ã€‚
            return attachInfo.mHandler.post(action);
        }

        // Postpone the runnable until we know on which thread it needs to run.
        // Assume that the runnable will be successfully placed after attach.
        getRunQueue().post(action);
        return true;
    }</code></pre> 
<p>åˆ°è¿™é‡Œä¸€ä¸ªäº‹ä»¶ï¼Œå±‚å±‚ä¼ é€’æ‰¾åˆ°æ¥æ”¶å¤„ç†äº‹ä»¶çš„æ§ä»¶å¹¶æ¶ˆè´¹æ‰äº‹ä»¶å°±ç»“æŸäº†ã€‚é€šè¿‡æºç æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜¯å…ˆåˆ¤æ–­OnTouch å†åˆ¤æ–­OnTouchEvent æœ€ååˆ¤æ–­ OnClickListenerï¼Œè¿™å°±æ˜¯è¿™ä¸‰è€…çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚</p> 
<p>ä½†æ˜¯ï¼Œè¿™ä¸€æ¬¡çš„äº‹ä»¶è¿˜æ²¡æœ‰å®Œï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†æ¶ˆè´¹äº‹ä»¶çš„æ§ä»¶æ¥ä¸‹æ¥è¿˜è¦å¹²å•¥ï¼Ÿæˆ‘ä»¬è¦å¼€å§‹å¾€å›è¿”äº†ã€‚</p> 
<p>å…ˆå›åˆ°<strong>dispatchTransformedTouchEvent è¿™é‡Œ</strong></p> 
<pre><code class="language-java"> private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,
            View child, int desiredPointerIdBits) {


                   ......


   if (newPointerIdBits == oldPointerIdBits) {
            if (child == null || child.hasIdentityMatrix()) {
                if (child == null) {
                    âœ è¦ä¹ˆæ˜¯è¿™é‡ŒæŠŠè¿”å›å€¼ç»™handled,æˆ‘ä»¬è®©handled=true,æœ‰æ§ä»¶æ¥æ”¶äº‹ä»¶ 
                    handled = super.dispatchTouchEvent(event);

                } else {
                    
                    âœ è¦ä¹ˆæ˜¯è¿™é‡ŒæŠŠè¿”å›å€¼ç»™handled,æˆ‘ä»¬è®©handled=true,æœ‰æ§ä»¶æ¥æ”¶äº‹ä»¶  
                    handled = child.dispatchTouchEvent(event);

                    
                }
                âœ è¿”å›handledçš„å€¼
                return handled;
            }
            transformedEvent = MotionEvent.obtain(event);
        } else {
            transformedEvent = event.split(newPointerIdBits);
        }


                    ......


        return handled;

}</code></pre> 
<p>æ¥ç€å°±å›åˆ° ğŸ”ºåµŒå¥—å¾ªç¯èµ·æº ğŸ”ºå³ ViewGroupçš„dispatchTransformedTouchEventæ–¹æ³•é‚£é‡Œã€‚</p> 
<pre><code class="language-java">@UiThread
public abstract class ViewGroup extends View implements ViewParent, ViewManager {


        ......çœç•¥å…¶å®ƒä»£ç ......


     @Override
     public boolean dispatchTouchEvent(MotionEvent ev) {
       
        ......çœç•¥å…¶å®ƒä»£ç ......
        if (!canceled &amp;&amp; !intercepted) {
                for (int i = childrenCount - 1; i &gt;= 0; i--) {

                            âœ ğŸ”ºæˆ‘ä»¬æ˜¯ä»è¿™é‡Œå‡ºå»çš„ï¼Œç°åœ¨å›åˆ°è¿™é‡Œï¼š ğŸ”ºåµŒå¥—å¾ªç¯èµ·æº ğŸ”º
                            if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
                                âœ è¿›å…¥è¿™ä¸ªåˆ¤æ–­æ¡ä»¶è¯´æ˜æœ‰æ§ä»¶æ¥æ”¶å¤„ç†äº‹ä»¶
                                mLastTouchDownTime = ev.getDownTime();
                                if (preorderedList != null) {
                                    // childIndex points into presorted list, find original index
                                    for (int j = 0; j &lt; childrenCount; j++) {
                                        if (children[childIndex] == mChildren[j]) {
                                            mLastTouchDownIndex = j;
                                            break;
                                        }
                                    }
                                } else {
                                    mLastTouchDownIndex = childIndex;
                                }
                                mLastTouchDownX = ev.getX();
                                mLastTouchDownY = ev.getY();
                                âœè¿™é‡Œä¼šæŠŠä¸€ä¸ªé“¾è¡¨TouchTargetå¯¹è±¡èµ‹å€¼ç»™mFirstTouchTarget
                                   ğŸ”º addTouchTarget è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œåé¢æœ‰åˆ†æğŸ”º
                                newTouchTarget = addTouchTarget(child, idBitsToAssign);
                                âœå¼€å…³ç½®ä¸ºtrue
                                alreadyDispatchedToNewTouchTarget = true;
                                break;
                            }
                            
                            ev.setTargetAccessibilityFocus(false);
                        }//for (int i = childrenCount - 1; i &gt;= 0; i--) end
                      


                    if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) {
                        âœå½“å³æ‰‹æŒ‡æŒ‰åœ¨å±å¹•ä¸ŠæŸä¸ªæ§ä»¶ä½æŠ¬èµ·ï¼Œå¦ä¸€æ‰‹æŒ‡æŒ‰åœ¨å¦ä¸€æ§ä»¶ä½†æ˜¯è¯¥æ§ä»¶æœªæ¥æ”¶äº‹ä»¶ï¼Œå°±ä¼šæŠŠç¬¬äºŒæ ¹æ‰‹æŒ‡çš„äº‹ä»¶ç»‘å®šåˆ°å‰ä¸€ä¸ªæœ€æ–°çš„æ§ä»¶ä¸Š
                        newTouchTarget = mFirstTouchTarget;
                        while (newTouchTarget.next != null) {
                            newTouchTarget = newTouchTarget.next;
                        }
                        newTouchTarget.pointerIdBits |= idBitsToAssign;
                    }
                 
            }//if (!canceled &amp;&amp; !intercepted) end
            

         if (mFirstTouchTarget == null) {
                âœ1 å½“æ²¡æœ‰æ‰¾åˆ°æ¥æ”¶å¤„ç†äº‹ä»¶çš„æ§ä»¶è°ƒç”¨dispatchTransformedTouchEventä¼ è¿‡å»çš„childå‚æ•°å€¼ä¸ºnull,å‰é¢è¿™ä¸ªæ–¹æ³•é‡Œæˆ‘ä»¬ä¹Ÿåˆ†æäº†ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æ˜¯åˆ¤æ–­è‡ªèº«æ˜¯å¦å¤„ç†äº‹ä»¶ï¼Œ
                    å¦‚æœè‡ªå·±ä¹Ÿä¸å¤„ç†å°±handled = false,åˆå›åˆ°å‰ä¸€å±‚çˆ¶å¸ƒå±€çš„ å¾ªç¯èµ·æº é‚£é‡Œï¼Œç„¶åå†åˆ°çˆ¶å¸ƒå±€çš„ViewGroupåˆèµ°åˆ°è¿™é‡Œï¼Œç»§ç»­åˆ¤æ–­ï¼Œè¿™æ ·å°±ä»å†…åˆ°å¤–åˆ¤æ–­æ˜¯å¦æœ‰æ§ä»¶æ¶ˆè´¹äº‹ä»¶ã€‚   
                handled = dispatchTransformedTouchEvent(ev, canceled, null,
                        TouchTarget.ALL_POINTER_IDS);
            } else {
                âœè¿›å…¥åˆ°è¿™é‡Œå°±è¯´æ˜å·²æ‰¾åˆ°æ¥æ”¶äº‹ä»¶çš„æ§ä»¶

                TouchTarget predecessor = null;
                TouchTarget target = mFirstTouchTarget;
                while (target != null) {
                    final TouchTarget next = target.next;
                    if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {
                        âœåœ¨DOWNäº‹ä»¶ä¸”æ‰¾åˆ°æ¥æ”¶æ§ä»¶alreadyDispatchedToNewTouchTargetè¢«ç½®ä¸ºtrueè€Œä¸”target == newTouchTargetï¼Œä¸€èˆ¬åˆ°åˆ°è¿™é‡Œ handled = true å°±åˆ°æœ€åé¢returnäº†ã€‚
                        handled = true;
                    } else {
                        

                        .... è¿™é‡Œå…ˆçœç•¥ä¸‹ç¯‡æ–‡ç« UPåŠ¨ä½œä»”ç»†åˆ†æ .....                     

                    }
                    predecessor = target;
                    target = next;
                }
            }

            // Update list of touch targets for pointer up or cancel, if needed.
            if (canceled
                    || actionMasked == MotionEvent.ACTION_UP
                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
                resetTouchState();
            } else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) {
                final int actionIndex = ev.getActionIndex();
                final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex);
                removePointersFromTouchTargets(idBitsToRemove);
            }
        }

        if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) {
            mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1);
        }

        return handled;
    }


}


OKï¼Œåˆ°è¿™é‡ŒdispatchTouchEventç»ˆäºç»ˆäºèµ°å®Œäº†ï¼Œåˆ«é«˜å…´å¤ªæ—©ï¼è¿™åªæ˜¯ä¸€å±‚å¸ƒå±€ï¼Œè¿˜æœ‰å½“å‰å¸ƒå±€çš„çˆ¶å¸ƒå±€åœ¨Â ğŸ”ºåµŒå¥—å¾ªç¯èµ·æº ğŸ”ºé‚£é‡Œç­‰ç€ä½ ç»™ä»–å›è¯è¦ä¸è¦æ¥å—å¤„ç†äº‹ä»¶ï¼ï¼ï¼

è¿™æ ·æˆ‘ä»¬åˆå›åˆ°çˆ¶å¸ƒå±€çš„Â ğŸ”ºåµŒå¥—å¾ªç¯èµ·æº ğŸ”º å†å›åˆ°å‰é¢å†æ‰¾çˆ¶å¸ƒå±€ï¼Œå†å›åˆ°...å†æ‰¾....ç›´åˆ°æ ¹å¸ƒå±€ã€‚

å¦‚æœå­å¸ƒå±€æœ‰æ§ä»¶æ¥æ”¶äº‹ä»¶ï¼ŒdispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)å°±ä¸ºtrueï¼Œè¿›å…¥ifåˆ¤æ–­ï¼›è¿™æ ·ä»è¿™ä¸ªæ¥æ”¶äº‹ä»¶çš„æ§ä»¶åˆ°å®ƒçš„çˆ¶å¸ƒå±€ï¼Œå†çˆ¶å¸ƒå±€éƒ½æ˜¯trueï¼›
               if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {
                        âœéƒ½æ˜¯trueå°±èµ°è¿™é‡Œ
                        handled = true;
                 } else{
                    
                        .......
                 }
                âœç„¶åç›´æ¥returnæ²¡æœ‰å…¶å®ƒæ“ä½œ
                retrn handled;
ä¸ºä»€ä¹ˆéƒ½æ˜¯trueä¼šæ»¡è¶³if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget)æ¡ä»¶ï¼Œ
è¿™å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´äº†çš„ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼š newTouchTarget = addTouchTarget(child, idBitsToAssign);
</code></pre> 
<p>Â ğŸ‘‡Â  Â addTouchTarget(child, idBitsToAssign)æ–¹æ³•åˆ†æ</p> 
<pre><code class="language-java"> 

    private TouchTarget addTouchTarget(@NonNull View child, int pointerIdBits) {
        final TouchTarget target = TouchTarget.obtain(child, pointerIdBits);
        target.next = mFirstTouchTarget;
        mFirstTouchTarget = target;
        return target;
    }

æ¥ä¸‹æ¥çœ‹TouchTarget.obtain(child, pointerIdBits)æ˜¯å•¥ï¼š
 private static final class TouchTarget { //âœTouchTarget æ˜¯ViewGroupå†…éƒ¨ç±»
      public static TouchTarget obtain(@NonNull View child, int pointerIdBits) {
            if (child == null) {
                throw new IllegalArgumentException("child must be non-null");
            }

            final TouchTarget target;
            synchronized (sRecycleLock) {
                âœsRecycleBin åªæœ‰ä¸‹é¢recycle()æ–¹æ³•ä¸­åˆå§‹åŒ–ï¼Œæ¯ä¸€å±‚å¸ƒå±€DOWNåŠ¨ä½œè¿›æ¥éƒ½æ˜¯null
                if (sRecycleBin == null) {
                    target = new TouchTarget(); âœæ¯å±‚æ–°å»ºä¸€ä¸ªTouchTargetå¯¹è±¡
                } else {
                    target = sRecycleBin;
                    sRecycleBin = target.next;
                     sRecycledCount--;
                    target.next = null;
                }
            }
            ğŸ”ºå¾ˆé‡è¦ï¼æŠŠchildä¿å­˜åˆ°target.childä¸­
            target.child = child;
            target.pointerIdBits = pointerIdBits;
            return target;
         }
       public void recycle() {
             ......
            synchronized (sRecycleLock) {
                if (sRecycledCount &lt; MAX_RECYCLED) {
                     
                    sRecycleBin = this;
                    
                } else {
                  ......  
                }
               ...... 
            }
        }

}
TouchTargetå¯¹è±¡åˆ›å»ºå¥½äº†æ¥ä¸‹å›åˆ°addTouchTarget æ–¹æ³•
private TouchTarget addTouchTarget(@NonNull View child, int pointerIdBits) {
        final TouchTarget target = TouchTarget.obtain(child, pointerIdBits);
        //âœ mFirstTouchTargetæ­¤æ—¶ä¸ºnull,å³target.next = null
        target.next = mFirstTouchTarget;
        //âœ æŠŠTouchTargetèµ‹å€¼ç»™mFirstTouchTarget
        mFirstTouchTarget = target;

        return target;
    }
 è¿˜è®°å¾— newTouchTarget = addTouchTarget(child, idBitsToAssign);å³newTouchTarget = target;
 æ‰€ä»¥ åé¢æœ‰ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget),target == newTouchTargetä¸ºtrueã€‚

</code></pre> 
<p>ä»æ¥æ”¶äº‹ä»¶åŠ¨ä½œçš„æ§ä»¶å¼€å§‹å¾€å¤–çš„æ¯ä¸€å±‚å¸ƒå±€éƒ½æ‰§è¡Œä¸€æ¬¡Â addTouchTarget(child, idBitsToAssign)æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä¸¾ä¸ªä¾‹å­çœ‹è¿™æ ·æ‰§è¡Œä»¥åæ˜¯å•¥æ ·å­ï¼š</p> 
<p>è‡ªå®šä¹‰äº†ä¸¤ä¸ªLinearLayoutåˆ†åˆ«ä¸º MyLinearLayoutOut å’Œ MyLinearLayoutï¼›è‡ªå®šä¹‰ä¸€ä¸ªButton:MyButton;å¸ƒå±€å¦‚ä¸‹ï¼š</p> 
<p><img alt="" height="489" src="https://images2.imgbox.com/c2/eb/lYVf89C6_o.png" width="385"></p> 
<p>å› ä¸ºButtoné»˜è®¤æ¥æ”¶æ¶ˆè´¹äº‹ä»¶ï¼Œæ‰€ä»¥åœ¨xmlå¸ƒå±€æ–‡ä»¶ä¸­æŠŠandroid:clickable="false" ï¼›</p> 
<pre><code class="language-html">        &lt;com.sz.MyButton
            android:id="@+id/my_btn"
            android:clickable="false"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="MyButton" /&gt;</code></pre> 
<p>ç„¶ååœ¨MyLinearLayout é‡Œé¢é‡å†™onTouchEventæ–¹æ³•è®©ä»–æ¥æ”¶å¤„ç†äº‹ä»¶ï¼š</p> 
<pre><code class="language-java">    @Override
    public boolean onTouchEvent(MotionEvent event) {
 

        return true;
 
    }</code></pre> 
<p>å…¶ä»–çš„éƒ½æ˜¯é»˜è®¤çš„ã€‚</p> 
<p>æˆ‘ä»¬ç‚¹å‡»MyButtonæŒ‰é’®ä»¥åï¼š</p> 
<p>dispatchTouchEvent ä»Â  DecorViewÂ âÂ MyLinearLayoutOutÂ âÂ MyLinearLayoutÂ â MyButton</p> 
<p>ç„¶åå¼€å§‹åˆ¤æ–­ MyButton æ˜¯å¦æ¥æ”¶äº‹ä»¶ï¼Œé€å±‚å¾€å¤–è¿”å›å¦‚ä¸‹å›¾ï¼š</p> 
<p><img alt="" height="589" src="https://images2.imgbox.com/a5/b2/oMy7ugyh_o.png" width="1139"></p> 
<p>(PS1:å›¾ä¸­TouchTarget@1862ï¼ŒTouchTarget@1850è¿™ä¸ªæ˜¯éšä¾¿å†™çš„è¡¨ç¤ºåˆ†åˆ«æ˜¯ä¸åŒçš„TouchTargetå¯¹è±¡è€Œä¸æ˜¯åŒä¸€ä¸ª)</p> 
<p>(PS2:å›¾ä¸­DecorViewå’ŒMyLinearLayoutä¹‹é—´è¿˜æœ‰å¸ƒå±€ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å°±ç›´æ¥çœç•¥äº†)</p> 
<p>(PS3:æœ€å¤–å±‚è¿˜æœ‰ä¸€ä¸ªActivity,æ²¡æœ‰åŠ æ˜¯å› ä¸ºå®ƒæ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„æˆ‘ä»¬åé¢è®¨è®º)</p> 
<p>è¿™æ ·é€šè¿‡DOWNäº‹ä»¶å°±ç»™æ¥æ”¶äº‹ä»¶çš„MyLinearLayoutçš„æ‰€æœ‰çˆ¶å¸ƒå±€é‡Œçš„ mFirstTouchTargetéƒ½èµ‹å€¼äº†ï¼Œä¸”TouchTarget.childå°±æŒ‡å‘å­å¸ƒå±€ã€‚</p> 
<p>ä½†æ¥æ”¶äº‹ä»¶çš„MyLinearLayoutå®ƒçš„mFirstTouchTarget = nullã€‚</p> 
<p>è¿™æ ·DOWNäº‹ä»¶å°±å¤„ç†å®Œäº†ï¼Œæ¥ç€å°±å¤„ç†UPäº‹ä»¶ã€‚</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f824b0f0d5b20aa4c733040ee0344272/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">SQL SERVER FOR XML PATH</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0398e47d65102e57f0846f528339ec4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">No plugin found for prefix â€˜tomcat7â€˜ in the current project and in the plugin groups</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>