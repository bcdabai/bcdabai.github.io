<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Spring Cloud Alibaba】Nacos的简单介绍以及服务注册与发现功能的基本使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Spring Cloud Alibaba】Nacos的简单介绍以及服务注册与发现功能的基本使用" />
<meta property="og:description" content="Nacos的简单介绍 Nacos（官网）致力于帮助您发现、配置和管理您的微服务。它提供了一组简单实用的功能，使您能够实现动态服务发现、服务配置管理以及服务和流量管理。
Nacos 让您构建更轻松、更快捷，您可以使用Nacos on Cloud或编译运行源代码来发布和管理微服务平台。它是支持采用微服务或云原生方法的以服务为中心的现代应用程序架构的基础设施。
Nacos 提供了四大功能 服务发现和服务健康检查: Nacos 使服务可以轻松注册自己并通过 DNS 或 HTTP 接口发现其他服务。Nacos 还提供服务的实时健康检查，以防止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。Nacos 还提供了统一的健康检查仪表盘，帮助您根据健康状态管理服务的可用性及流量。动态服务发现对以服务为中心的（例如微服务和云原生）应用架构方式非常关键。动态配置管理: 动态配置服务允许您在所有环境中以集中和动态的方式管理所有服务的配置。Nacos消除了在配置更新时重新部署应用程序和服务的需要，这使得配置更改更加高效和敏捷。动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。Nacos 提供了一个简洁易用的UI (控制台样例 Demo) 帮助您管理所有的服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助您更安全地在生产环境中管理配置变更和降低配置变更带来的风险。动态 DNS 服务: Nacos 支持加权路由，让您在数据中心内的生产环境中更轻松地实现中间层负载均衡、灵活的路由策略、流量控制和简单的 DNS 解析服务。它可以帮助您轻松实现基于 DNS 的服务发现，以消除耦合到厂商私有服务发现API上的风险。服务和元数据管理: Nacos 提供易于使用的可视化界面，帮助您管理服务元数据、配置、kubernetes DNS、服务健康和指标统计。Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。 Nacos 地图 （图片来自https://nacos.io/zh-cn/docs/what-is-nacos.html）
与Spring Cloud Alibaba的版本关系 Spring Cloud Alibaba版本关系：
本博客使用
Spring Boot 2.3.12
Spring Cloud Alibaba 2.2.7
nacos 2.0.3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4dc47e40400e1b4daf5bcb56645655ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-25T21:19:20+08:00" />
<meta property="article:modified_time" content="2022-01-25T21:19:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Spring Cloud Alibaba】Nacos的简单介绍以及服务注册与发现功能的基本使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Nacos_0"></a>Nacos的简单介绍</h3> 
<p>Nacos（<a href="https://nacos.io" rel="nofollow">官网</a>）致力于帮助您发现、配置和管理您的微服务。它提供了一组简单实用的功能，使您能够实现动态服务发现、服务配置管理以及服务和流量管理。</p> 
<p>Nacos 让您构建更轻松、更快捷，您可以使用<a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" rel="nofollow">Nacos on Cloud</a>或编译运行源代码来发布和管理微服务平台。它是支持采用微服务或云原生方法的以服务为中心的现代应用程序架构的基础设施。</p> 
<h4><a id="Nacos__5"></a>Nacos 提供了四大功能</h4> 
<ol><li><strong>服务发现和服务健康检查:</strong> Nacos 使服务可以轻松注册自己并通过 DNS 或 HTTP 接口发现其他服务。Nacos 还提供服务的实时健康检查，以防止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。Nacos 还提供了统一的健康检查仪表盘，帮助您根据健康状态管理服务的可用性及流量。动态服务发现对以服务为中心的（例如微服务和云原生）应用架构方式非常关键。</li><li><strong>动态配置管理:</strong> 动态配置服务允许您在所有环境中以集中和动态的方式管理所有服务的配置。Nacos消除了在配置更新时重新部署应用程序和服务的需要，这使得配置更改更加高效和敏捷。动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。Nacos 提供了一个简洁易用的UI (控制台样例 Demo) 帮助您管理所有的服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助您更安全地在生产环境中管理配置变更和降低配置变更带来的风险。</li><li><strong>动态 DNS 服务:</strong> Nacos 支持加权路由，让您在数据中心内的生产环境中更轻松地实现中间层负载均衡、灵活的路由策略、流量控制和简单的 DNS 解析服务。它可以帮助您轻松实现基于 DNS 的服务发现，以消除耦合到厂商私有服务发现API上的风险。</li><li><strong>服务和元数据管理:</strong> Nacos 提供易于使用的可视化界面，帮助您管理服务元数据、配置、kubernetes DNS、服务健康和指标统计。Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。</li></ol> 
<h4><a id="Nacos__13"></a>Nacos 地图</h4> 
<p>（图片来自https://nacos.io/zh-cn/docs/what-is-nacos.html）<br> <img src="https://images2.imgbox.com/8f/0d/ImtzMZnr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Spring_Cloud_Alibaba_16"></a>与Spring Cloud Alibaba的版本关系</h4> 
<p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E">Spring Cloud Alibaba版本关系</a>：<br> <img src="https://images2.imgbox.com/e7/dc/eB9MqJWL_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/64/88/FRD8Zxcl_o.png" alt="在这里插入图片描述"></p> 
<p>本博客使用<br> Spring Boot 2.3.12<br> Spring Cloud Alibaba 2.2.7<br> nacos 2.0.3</p> 
<h3><a id="Nacos_26"></a>Nacos的下载与运行部署</h3> 
<p>有两种方式，一种是下载二进制文件编译运行，另一种是使用docker部署。（我这里采用docker 部署，二进制文件下载编译运行做个简单的介绍）</p> 
<h4><a id="_28"></a>二进制文件下载编译运行</h4> 
<p>你可以下载二进制文件，然后使用脚本运行Nacos server<br> <a href="https://github.com/alibaba/nacos/releases">Nacos各种版本的下载地址</a><br> 最新版是2.0.4，但是客户端好像还没有及时更新，所以先用2.0.3也没啥关系<br> <img src="https://images2.imgbox.com/48/09/h9t95TBv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Windows下载</strong>：直接下载zip后缀的nacos-server压缩包。<br> Windows运行</p> 
<pre><code class="prism language-csharp">startup<span class="token punctuation">.</span>cmd <span class="token operator">-</span>m standalone
</code></pre> 
<p><strong>Linux下载</strong><br> 在tar.gz文件上面鼠标右键复制链接地址，然后使用wget命令进行下载。</p> 
<pre><code class="prism language-csharp"><span class="token class-name">wget</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>alibaba<span class="token operator">/</span>nacos<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span><span class="token number">2.0</span><span class="token number">.4</span><span class="token operator">/</span>nacos<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> 
<p>解压</p> 
<pre><code class="prism language-csharp">tar <span class="token operator">-</span>zxvf nacos<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> 
<p>cd到脚本所在文件夹，然后使用脚本文件运行Nacos服务</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">.</span><span class="token operator">/</span>startup<span class="token punctuation">.</span>sh <span class="token operator">-</span>m standalone
</code></pre> 
<h4><a id="docker__55"></a>docker 拉取镜像运行</h4> 
<p>docker hub中的nacos<br> <img src="https://images2.imgbox.com/26/55/r1g5TkhM_o.png" alt="在这里插入图片描述"><br> 我下载2.0.3版本，和spring cloud版本和spirng boot版本对应使用</p> 
<pre><code class="prism language-csharp">docker pull nacos<span class="token operator">/</span>nacos<span class="token operator">-</span>server<span class="token punctuation">:</span>v2<span class="token punctuation">.</span><span class="token number">0.3</span>
</code></pre> 
<p>运行一个基本的nacos-server尝尝鲜,nacos 2.0要放开这两个端口</p> 
<p>9848 是nacos 2.0 新增的客户端gRPC请求服务端端口，用于客户端向服务端发起连接和请求</p> 
<pre><code class="prism language-csharp">docker run <span class="token operator">-</span>itd <span class="token operator">--</span>name nacos<span class="token operator">-</span>quick <span class="token operator">-</span><span class="token class-name">e</span> MODE<span class="token operator">=</span>standalone <span class="token operator">-</span>p <span class="token number">8848</span><span class="token punctuation">:</span><span class="token number">8848</span> <span class="token operator">-</span>p <span class="token number">9848</span><span class="token punctuation">:</span><span class="token number">9848</span> nacos<span class="token operator">/</span>nacos<span class="token operator">-</span>server<span class="token punctuation">:</span>v2<span class="token punctuation">.</span><span class="token number">0.3</span>
</code></pre> 
<p>查询宿主机端口8848和9848是否开放</p> 
<pre><code class="prism language-csharp">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>query<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">8848</span><span class="token operator">/</span>tcp
firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>query<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">9848</span><span class="token operator">/</span>tcp
</code></pre> 
<p>如果是no,输入如下命令对外开放这两个端口</p> 
<pre><code class="prism language-csharp">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>permanent <span class="token operator">--</span><span class="token keyword">add</span><span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">8848</span><span class="token operator">/</span>tcp
firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>permanent <span class="token operator">--</span><span class="token keyword">add</span><span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">9848</span><span class="token operator">/</span>tcp
</code></pre> 
<p>重启防火墙(修改配置后要重启防火墙)，让修改生效</p> 
<pre><code class="prism language-csharp">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>reload
</code></pre> 
<p>去服务器的控制台去开启防火墙，<br> 如果是阿里云，还需要在安全组里面手动添加端口 ，配置可由那些IP访问。不然你防火墙开放了端口也是没用的。</p> 
<p>访问管理界面（要加/nacos路径，因为有默认配置server.servlet.contextPath=/nacos）</p> 
<pre><code class="prism language-csharp">服务器ip<span class="token punctuation">:</span><span class="token number">8848</span><span class="token operator">/</span>nacos
</code></pre> 
<p>默认账号和密码都是nacos<br> <img src="https://images2.imgbox.com/6f/23/bHuOxNYp_o.png" alt="在这里插入图片描述"><br> 登录默认账户密码进入<br> <img src="https://images2.imgbox.com/e4/5d/jnSmZh6e_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Nacos_99"></a>Nacos服务注册与发现的基本介绍与使用</h3> 
<p>动态服务发现对以服务为中心的（例如微服务和云原生）应用架构方式非常关键。Nacos支持DNS-Based和RPC-Based（Dubbo、gRPC）模式的服务发现。Nacos也提供实时健康检查，以防止将请求发往不健康的服务实例。</p> 
<p>服务（Service）是Nacos世界的一等公民。Nacos支持几乎所有主流类型的服务的发现、配置和管理：</p> 
<ul><li>Kubernetes Service</li><li>gRPC &amp; Dubbo RPC Service</li><li>Spring Cloud RESTful Service</li></ul> 
<p>Eureka也有服务注册与发现的功能，但由于Eureka2.0闭源，以及Nacos本身的优势（服务在线管理、配置动态刷新等）。</p> 
<table><thead><tr><th>功能</th><th>Nacos</th><th>Eureka</th><th>说明</th></tr></thead><tbody><tr><td>注册中心</td><td>是</td><td>是</td><td>服务治理基本功能，负责服务中心化注册</td></tr><tr><td>配置中心</td><td>是</td><td>否</td><td><code>Eureka</code>需要<code>Config</code>的配合来实现配置中心，且不提供管理界面</td></tr><tr><td>配置动态刷新</td><td>是</td><td>否</td><td><code>Eureka</code>需要<code>Config</code>、<code>MQ</code>以及<code>Webhook</code>的配合来实现配置动态刷新，而<code>Nacos</code>采用<code>Netty</code>保持<code>TCP</code>长连接实时推送</td></tr><tr><td>可用区AZ</td><td>是</td><td>是</td><td>对服务集群划分不同区域，实现区域隔离，并提供容灾自动切换</td></tr><tr><td>分组</td><td>是</td><td>否</td><td><code>Nacos</code>可以根据业务和环境进行分组管理</td></tr><tr><td>元数据</td><td>是</td><td>是</td><td>提供服务标签数据，例如环境或服务标识</td></tr><tr><td>权重</td><td>是</td><td>否</td><td><code>Nacos</code>默认提供权重设置功能，调整承载流量压力</td></tr><tr><td>健康检查</td><td>是</td><td>是</td><td><code>Nacos</code>支持由客户端或服务端发起的健康检查，<code>Eureka</code>是由客户端发起心跳</td></tr><tr><td>负载均衡</td><td>是</td><td>是</td><td>均提供负责均衡策略，<code>Eureka</code>采用<code>Ribbon</code></td></tr><tr><td>管理界面</td><td>是</td><td>否</td><td><code>Nacos</code>支持对服务在线管理，<code>Eureka</code>只是预览服务状态</td></tr></tbody></table> 
<h4><a id="_113"></a>代码基本结构</h4> 
<p>创建主工程 springcloud,选择maven,直接–&gt;next<br> <img src="https://images2.imgbox.com/46/5b/1XwBZZk7_o.png" alt="在这里插入图片描述"><br> 填写项目相关信息<br> <img src="https://images2.imgbox.com/fe/d0/FwwpvyV2_o.png" alt="在这里插入图片描述"><br> 创建子项目:<br> 在项目上:右键–&gt;new–&gt;module–&gt;maven–&gt;next<br> 创建一个nacos-provider 子module<br> <img src="https://images2.imgbox.com/a6/f5/WKKT18Ht_o.png" alt="在这里插入图片描述">再同样创建一个nacos-consumer子module</p> 
<p>nacos-consumer结构如下<br> <img src="https://images2.imgbox.com/1e/f0/IdNQWvbj_o.png" alt="在这里插入图片描述"><br> nacos-provider结构如下<br> <img src="https://images2.imgbox.com/54/97/dwe49rz4_o.png" alt="在这里插入图片描述"><br> 总体结构如下<br> <img src="https://images2.imgbox.com/2a/f4/TiGeXRrw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_131"></a>代码相关文件</h4> 
<h4><a id="_132"></a>根项目</h4> 
<p><strong>pom.xml</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">project</span> xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>xt<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>springcloud<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>packaging<span class="token operator">&gt;</span>pom<span class="token operator">&lt;</span><span class="token operator">/</span>packaging<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modules<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>nacos<span class="token operator">-</span>provider<span class="token operator">&lt;</span><span class="token operator">/</span>module<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>nacos<span class="token operator">-</span>consumer<span class="token operator">&lt;</span><span class="token operator">/</span>module<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>modules<span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">2.3</span><span class="token number">.12</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token operator">&gt;</span><span class="token number">2.2</span><span class="token number">.7</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencyManagement<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>dependencies<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>$<span class="token punctuation">{<!-- --></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span>pom<span class="token operator">&lt;</span><span class="token operator">/</span>type<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>import<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.18</span><span class="token number">.22</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>provided<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencyManagement<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="nacosconsumer__194"></a>nacos-consumer 子项目</h4> 
<p>向nacos server 注册这个项目，消费nacos-provider 服务<br> <strong>pom.xml</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">project</span> xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>springcloud<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>xt<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>nacos<span class="token operator">-</span>consumer<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>
    
    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>actuator<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
    
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<p>application.yml 配置文件</p> 
<pre><code class="prism language-csharp">server<span class="token punctuation">:</span>
  port<span class="token punctuation">:</span> <span class="token number">8085</span>

spring<span class="token punctuation">:</span>
  application<span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> nacos<span class="token operator">-</span><span class="token class-name">consumer</span>
  cloud<span class="token punctuation">:</span>
    nacos<span class="token punctuation">:</span>
      discovery<span class="token punctuation">:</span>
        server<span class="token operator">-</span>addr<span class="token punctuation">:</span> 部署nacos server的服务器IP<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> 
<p>controller</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller<span class="token punctuation">;</span>

import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PathVariable<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMethod<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span>RestTemplate<span class="token punctuation">;</span>


@RestController
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> final <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    @Autowired
    <span class="token keyword">public</span> <span class="token function">TestController</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplate<span class="token punctuation">;</span><span class="token punctuation">}</span>

    @<span class="token function">RequestMapping</span><span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">=</span> <span class="token string">"/echo/{str}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span>@PathVariable <span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">"http://nacos-provider/echo/"</span> <span class="token operator">+</span> str<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>启动类<br> 可以使用2种方式来消费服务，一种是RestTemplate，一种是Feign，我这里采用第一种</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">;</span>

import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span>EnableDiscoveryClient<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>LoadBalanced<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span>RestTemplate<span class="token punctuation">;</span>


@SpringBootApplication
@EnableDiscoveryClient
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConsumerApplication</span> <span class="token punctuation">{<!-- --></span>

    @Bean
    @LoadBalanced
    <span class="token keyword">public</span> <span class="token return-type class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>NacosConsumerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="nacosprovider__314"></a>nacos-provider 子项目</h4> 
<p>向nacos server注册服务，给nacos-provider 消费提供服务<br> <strong>pom.xml</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">project</span> xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>springcloud<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>xt<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>nacos<span class="token operator">-</span>provider<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
    
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<p>application.yml 配置文件</p> 
<pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">project</span> xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>springcloud<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>xt<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>nacos<span class="token operator">-</span>provider<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<p>实体类，我用来统计每个nacos-provider服务提供了多少次服务</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entity<span class="token punctuation">;</span>

import lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span>

import java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span>AtomicInteger<span class="token punctuation">;</span>


@Component
@Data
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountNumber</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">AtomicInteger</span> atomicInteger<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CountNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>service 层</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">;</span>

import com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>CountNumber<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>

@Service
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoService</span> <span class="token punctuation">{<!-- --></span>

    @Autowired
    <span class="token class-name">CountNumber</span> countNumber<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">queryCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> countNumber<span class="token punctuation">.</span><span class="token function">getAtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">addOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        countNumber<span class="token punctuation">.</span><span class="token function">getAtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>controller</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller<span class="token punctuation">;</span>

import com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>EchoService<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpStatus<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>ResponseEntity<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PathVariable<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestParam<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span>

import java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span>AtomicInteger<span class="token punctuation">;</span>

@RestController
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoController</span> <span class="token punctuation">{<!-- --></span>

    @Autowired
    <span class="token class-name">EchoService</span> echoService<span class="token punctuation">;</span>

    @<span class="token function">GetMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseEntity</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResponseEntity</span><span class="token punctuation">(</span><span class="token string">"index error"</span><span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @<span class="token function">GetMapping</span><span class="token punctuation">(</span><span class="token string">"/error"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseEntity</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResponseEntity</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @<span class="token function">GetMapping</span><span class="token punctuation">(</span><span class="token string">"/echo/{string}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span>@PathVariable String <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        echoService<span class="token punctuation">.</span><span class="token function">addOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> ans <span class="token operator">=</span> <span class="token string">"hello Nacos Discovery :"</span> <span class="token operator">+</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> cnt <span class="token operator">=</span> echoService<span class="token punctuation">.</span><span class="token function">queryCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ans <span class="token operator">+=</span> <span class="token string">"我是"</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">+</span><span class="token string">"号生产者实例"</span><span class="token punctuation">;</span>
        <span class="token comment">//演示的时候我这里手动更改这个打印，和这个字符串，以使得每个输出更加清晰,每运行一个服务，改动一下</span>
        ans<span class="token operator">+=</span><span class="token string">"我被调用了"</span><span class="token operator">+</span>cnt<span class="token operator">+</span><span class="token string">"次"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  ans<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>启动类</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">;</span>

import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span>EnableDiscoveryClient<span class="token punctuation">;</span>

@SpringBootApplication
@EnableDiscoveryClient
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosProviderApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>NacosProviderApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_500"></a>测试运行(同时测试负载均衡情况)</h4> 
<p>我打算启动三个nacos-provider提供服务（如下是已经配置好了），点击IDEA右上角如图所示的地方<br> <img src="https://images2.imgbox.com/f9/29/2HgZX0ga_o.png" alt="在这里插入图片描述"><br> 添加spring boot应用<br> <img src="https://images2.imgbox.com/69/d7/EEl7OUK0_o.png" alt="在这里插入图片描述"><br> 如图所示的添加，添加两个<br> <img src="https://images2.imgbox.com/14/29/yKJkyzvS_o.png" alt="在这里插入图片描述"><br> 然后依次启动每一个nacos-provider 服务，记得每run一次，要更改一次application.yml的配置文件的端口号，不然会端口冲突</p> 
<p>将三个nacos-provider服务和一个nacos-consumer服务启动以后，我们可以到nacos 提供的管理页面去查看</p> 
<pre><code class="prism language-csharp">http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>服务器ip<span class="token punctuation">:</span><span class="token number">8848</span><span class="token operator">/</span>nacos
</code></pre> 
<p>在nacos 提供的管理页面可以看到我们运行的服务实例已经被注册到了nacos server上面<br> <img src="https://images2.imgbox.com/26/5d/hMjdSdzC_o.png" alt="在这里插入图片描述"><br> 还可以对服务进行管理，编辑，下线，调整负载均衡时候的权重等等<br> 同时这里可以看到服务，集群以及实例级别的元数据信息，可以在控制台修改填充元数据，也可以使用application.yml文件进行设置<br> 元数据信息可以帮助描述详细信息，还可以用来做版本控制<br> <img src="https://images2.imgbox.com/06/75/ZvgFH65X_o.png" alt="在这里插入图片描述"><br> 我们采用nacos-consumer来对nacos-provider发起10次请求，来看看nacos-provider的消费情况</p> 
<p>我发现在我向consumer发出10次请求，而consumner向provider发起10次请求的过程中，1,2，3号provider实例轮番上阵，这可能说明nacos的默认负载均衡策略是轮询（但是也不一定，因为只是从表面现象看是这样，要去看源码才能有所了解）<br> <img src="https://images2.imgbox.com/7c/a4/G6iAM6yO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fe/b8/YVYq13Tb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/68/2SwSd2wR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c0/cf/ZwwR439Q_o.png" alt="在这里插入图片描述"><br> 在nacos 提供的控制台页面修改1号provider实例的权重为100之后，再发动10次请求，结果表面还是轮询，看来控制台的修改权重并没有起到作用。那么看起来很可能是nacos的负载均衡并没有起到作用。</p> 
<p>因为我们这里也是使用的@LoadBalanced注解来实现客户端负载均衡的</p> 
<p>而@LoadBalanced注解实现客户端负载均衡的底层使用了Ribbon组件<br> 同时，我们在nacos-discovery的包里面可以发现，他依赖了ribbon组件<br> <img src="https://images2.imgbox.com/51/16/TOLJQYuS_o.png" alt="在这里插入图片描述"></p> 
<p>而Nacos已经实现了自定义的IRule实现类NacosRule。因此需要将NacosRule实例变成bean，便于Spring容器管理，修改NacosConsumerApplication类如下：重启NacosConsumerApplication</p> 
<pre><code class="prism language-csharp">package com<span class="token punctuation">.</span>xt<span class="token punctuation">.</span>springcloud<span class="token punctuation">;</span>

import com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>NacosRule<span class="token punctuation">;</span>
import com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>IRule<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span>EnableDiscoveryClient<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>LoadBalanced<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Scope<span class="token punctuation">;</span>
import org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span>RestTemplate<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author: codingXT
 * @Date: 2022-01-22-14:29
 * @Description:
 */</span>

@SpringBootApplication
@EnableDiscoveryClient
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConsumerApplication</span> <span class="token punctuation">{<!-- --></span>

    @Bean
    @LoadBalanced
    <span class="token keyword">public</span> <span class="token return-type class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name">@Bean</span>
    @<span class="token function">Scope</span><span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">=</span> <span class="token string">"prototype"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IRule</span> <span class="token function">loadBalanceRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NacosRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>NacosConsumerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

</code></pre> 
<p>然后重启nacos-consumer服务让他生效，其他provider可以不用重启。<br> 我这里都重启了，然后修改8081号端口的1号provider服务实例的权重为100<br> <img src="https://images2.imgbox.com/50/8b/kbuojaVX_o.png" alt="在这里插入图片描述"><br> 192.168.56.1是我的以太网适配器 VirtutalBox Host-Only Network 的IP地址<br> 这块网卡是virtualbox的虚拟网卡，应该是IDEA自动装上去的，用作验证服务器使用。(我也不是很清楚，有知道的大佬评论区踢我一下)<br> <img src="https://images2.imgbox.com/88/cd/6mg3PMCM_o.png" alt="在这里插入图片描述"></p> 
<p>使用postman来发起批量请求300次，来看看nacos 控制台的权重修改是否生效<br> <a href="https://www.cnblogs.com/yuer02/p/14785802.html" rel="nofollow">postman批量发送多个请求</a> 可以看这个<br> <img src="https://images2.imgbox.com/73/68/3m2UJ5Te_o.png" alt="在这里插入图片描述"><br> 请求300次，run开始批量请求<br> <img src="https://images2.imgbox.com/91/54/O0fCfdMZ_o.png" alt="在这里插入图片描述"></p> 
<p>然后1号provider实例被调用了296次<br> <img src="https://images2.imgbox.com/5f/19/fsphKLve_o.png" alt="在这里插入图片描述"><br> 2号provider实例被调用了3次<br> <img src="https://images2.imgbox.com/16/76/8Ihnm6yN_o.png" alt="在这里插入图片描述"><br> 3号provider实例被调用了1次</p> 
<p><img src="https://images2.imgbox.com/e2/17/Iaf8VzDf_o.png" alt="在这里插入图片描述"></p> 
<p>看样子nacos的负载均衡起到了作用，大部分请求都被转发到1号provider实例去了</p> 
<h4><a id="_601"></a>服务的注册与发现的基本原理</h4> 
<h5><a id="_602"></a>服务注册</h5> 
<p>Spring Cloud Nacos Discovery 遵循了 spring cloud common 标准，实现了 AutoServiceRegistration、ServiceRegistry、Registration 这三个接口。</p> 
<p>在 spring cloud 应用的启动阶段，监听了 WebServerInitializedEvent 事件，当Web容器初始化完成后，即收到 WebServerInitializedEvent 事件后，会触发注册的动作，调用 ServiceRegistry 的 register 方法，将服务注册到 Nacos Server。</p> 
<h5><a id="_607"></a>服务发现</h5> 
<p>NacosServerList 实现了 com.netflix.loadbalancer.ServerList 接口，并在 @ConditionOnMissingBean 的条件下进行自动注入，默认集成了Ribbon。</p> 
<p>如果需要有更加自定义的可以使用 @Autowired 注入一个 NacosRegistration 实例，通过其持有的 NamingService 字段内容直接调用 Nacos API。</p> 
<h4><a id="nacos_612"></a>nacos的其他配置项：</h4> 
<table><thead><tr><th>配置项</th><th>key</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>服务端地址</td><td>spring.cloud.nacos.discovery.server-addr</td><td></td><td></td></tr><tr><td>服务名</td><td>spring.cloud.nacos.discovery.service</td><td>spring.application.name</td><td></td></tr><tr><td>权重</td><td>spring.cloud.nacos.discovery.weight</td><td>1</td><td>取值范围 1 到 100，数值越大，权重越大</td></tr><tr><td>网卡名</td><td>spring.cloud.nacos.discovery.network-interface</td><td></td><td>当IP未配置时，注册的IP为此网卡所对应的IP地址，如果此项也未配置，则默认取第一块网卡的地址</td></tr><tr><td>注册的IP地址</td><td>spring.cloud.nacos.discovery.ip</td><td></td><td>优先级最高</td></tr><tr><td>注册的端口</td><td>spring.cloud.nacos.discovery.port</td><td>-1</td><td>默认情况下不用配置，会自动探测</td></tr><tr><td>命名空间</td><td>spring.cloud.nacos.discovery.namespace</td><td></td><td>常用场景之一是不同环境的注册的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。</td></tr><tr><td>AccessKey</td><td>spring.cloud.nacos.discovery.access-key</td><td></td><td></td></tr><tr><td>SecretKey</td><td>spring.cloud.nacos.discovery.secret-key</td><td></td><td></td></tr><tr><td>Metadata</td><td>spring.cloud.nacos.discovery.metadata</td><td></td><td>使用Map格式配置</td></tr><tr><td>日志文件名</td><td>spring.cloud.nacos.discovery.log-name</td><td></td><td></td></tr><tr><td>接入点</td><td>spring.cloud.nacos.discovery.endpoint</td><td>UTF-8</td><td>地域的某个服务的入口域名，通过此域名可以动态地拿到服务端地址</td></tr><tr><td>是否集成Ribbon</td><td>ribbon.nacos.enabled</td><td>true</td><td></td></tr></tbody></table> 
<h3><a id="References_705"></a>References:</h3> 
<ul><li>https://github.com/alibaba/nacos/wiki/</li><li>https://kaven.blog.csdn.net/article/details/121207295</li><li>https://nacos.io/zh-cn/</li><li>https://nacos.io/en-us/docs/quick-start-spring-cloud.html</li><li>https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example/readme-zh.md</li><li>https://www.cnblogs.com/yuer02/p/14785802.html</li></ul> 
<p>（写博客主要是对自己学习的归纳整理，资料大部分来源于书籍、网络资料和自己的实践，整理不易，但是难免有不足之处，如有错误，请大家评论区批评指正。同时感谢广大博主和广大作者辛苦整理出来的资源和分享的知识。）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1810c0ab52454883b5c4d975e24fc531/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微服务之间调用方式@FeignClient</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/795d2de09d62fe2d49e96f1a087dd705/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">idea开发springboot项目时的自动编译和热部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>