<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 Canvas 手画不规则多边形，并限制相交线和凹多边形 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 Canvas 手画不规则多边形，并限制相交线和凹多边形" />
<meta property="og:description" content="简介 使用 Canvas 实现的手画不规则多边形功能。通过鼠标在画面上点击的点作为多边形的顶点，连线形成多边形。除了手画之外，还加入了随机生成和回显，检测多边形横穿，凹凸性的检测。注意：两个点如果靠太近会被认为是同一个点而忽略。闭合区域需要点击图形中的第一个点，或者点击“闭合图形”按钮。
两个 Canvas 图层 由于要实现线条跟随鼠标运动功能，而且 Canvas 的图形无法清除单个绘制命令，因此我用 CSS 的绝对定位，在同一个区域叠加了两个 Canvas 对象。一个在下面，表示已经绘制结束的图形，叫做固定 Canvas；一个在上面，每次鼠标移动就重新绘制跟随鼠标移动的线条，叫做临时 Canvas。canvasTemp 即为临时 Canvas。
&lt;template&gt; &lt;div class=&#34;canvas-box&#34; :style=&#34;{ width: canvasWidth &#43; &#39;px&#39;, height: canvasHeight &#43; &#39;px&#39; }&#34; &gt; &lt;canvas ref=&#34;canvas&#34; :width=&#34;canvasWidth&#34; :height=&#34;canvasHeight&#34; class=&#34;canvas&#34; &gt;&lt;/canvas&gt; &lt;canvas ref=&#34;canvasTemp&#34; class=&#34;canvas&#34; :width=&#34;canvasWidth&#34; :height=&#34;canvasHeight&#34; @mousedown=&#34;draw&#34; &gt;&lt;/canvas&gt; &lt;/div&gt; &lt;/template&gt; &lt;style lang=&#34;less&#34; scoped&gt; .canvas-box { margin: 5px auto; background: #aaa; position: relative; .canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: crosshair; } } &lt;/style&gt; 绘制过程 绘画过程简要描述为：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/983f96cc676679cf2330ae8094603609/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-07T19:22:12+08:00" />
<meta property="article:modified_time" content="2022-03-07T19:22:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 Canvas 手画不规则多边形，并限制相交线和凹多边形</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>简介</h3> 
<p>使用 Canvas 实现的手画不规则多边形功能。通过鼠标在画面上点击的点作为多边形的顶点，连线形成多边形。除了手画之外，还加入了随机生成和回显，检测多边形横穿，凹凸性的检测。注意：两个点如果靠太近会被认为是同一个点而忽略。闭合区域需要点击图形中的第一个点，或者点击“闭合图形”按钮。<br> <img src="https://images2.imgbox.com/0c/df/KItDvvAX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Canvas__5"></a>两个 Canvas 图层</h3> 
<p>由于要实现线条跟随鼠标运动功能，而且 Canvas 的图形无法清除单个绘制命令，因此我用 CSS 的绝对定位，在同一个区域叠加了两个 Canvas 对象。一个在下面，表示已经绘制结束的图形，叫做固定 Canvas；一个在上面，每次鼠标移动就重新绘制跟随鼠标移动的线条，叫做临时 Canvas。canvasTemp 即为临时 Canvas。</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"canvas-box"</span>
    <span class="token punctuation">:</span>style<span class="token operator">=</span><span class="token string">"{ width: canvasWidth + 'px', height: canvasHeight + 'px' }"</span>
  <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>canvas
      ref<span class="token operator">=</span><span class="token string">"canvas"</span>
      <span class="token punctuation">:</span>width<span class="token operator">=</span><span class="token string">"canvasWidth"</span>
      <span class="token punctuation">:</span>height<span class="token operator">=</span><span class="token string">"canvasHeight"</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"canvas"</span>
    <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>canvas<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>canvas
      ref<span class="token operator">=</span><span class="token string">"canvasTemp"</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"canvas"</span>
      <span class="token punctuation">:</span>width<span class="token operator">=</span><span class="token string">"canvasWidth"</span>
      <span class="token punctuation">:</span>height<span class="token operator">=</span><span class="token string">"canvasHeight"</span>
      @mousedown<span class="token operator">=</span><span class="token string">"draw"</span>
    <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>canvas<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"less"</span> scoped<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>canvas<span class="token operator">-</span>box <span class="token punctuation">{<!-- --></span>
  margin<span class="token punctuation">:</span> <span class="token number">5</span>px auto<span class="token punctuation">;</span>
  background<span class="token punctuation">:</span> #aaa<span class="token punctuation">;</span>
  position<span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token punctuation">.</span>canvas <span class="token punctuation">{<!-- --></span>
    position<span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
    height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
    cursor<span class="token punctuation">:</span> crosshair<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_48"></a>绘制过程</h3> 
<p>绘画过程简要描述为：</p> 
<ol><li>在绘画区域点击第 1 个点，随后线条跟随鼠标移动。</li><li>随后点击第 2 — 到第 n 个点，每个点即为多边形的顶点。</li><li>点击第一个点闭合图形，或者点击自动闭合图形按钮。</li></ol> 
<h4><a id="_Canvas__56"></a>固定 Canvas 绘制</h4> 
<p>临时 Canvas接收点击事件，得到当前点击的坐标点。</p> 
<ul><li>如果是第一个点，则清空之前的绘画区域，并且在固定 Canvas 中移动位置到当前点。</li><li>否则检查符合要求后，在固定 Canvas 中绘制一条上一个点到当前点的线。如果符合条件，则闭合图形。</li><li>让线跟随鼠标移动。</li></ul> 
<pre><code class="prism language-js"><span class="token function">draw</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 点一个当前点</span>
  <span class="token keyword">let</span> pointDown <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token punctuation">:</span> e<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> e<span class="token punctuation">.</span>offsetY<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 第一个点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>closeStatus<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>pointDown<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pointDown<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 首先检查生成的点是否符合要求</span>
    <span class="token keyword">const</span> check <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPoint</span><span class="token punctuation">(</span>pointDown<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>check<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">case</span> <span class="token string">"closeFirst"</span><span class="token punctuation">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">closeFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token boolean">false</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token boolean">true</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 已经有点了，连成线</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pointDown<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pointDown<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>pointDown<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果已经到达最大数量，则直接闭合图形</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxPointNum<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">closeFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 让线跟随鼠标移动 后面一节描述</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_Canvas__104"></a>临时 Canvas 跟随鼠标移动</h4> 
<p>在鼠标松开后，监听鼠标移动。在每次鼠标移动的时候，清空临时 Canvas。重新绘制一条点击的坐标点到当前鼠标位置的线。<br> 由于鼠标位置移动很频繁，因此加入了简单的防抖：在下一次dom更新数据后，仅绘制鼠标最后移动到的位置。</p> 
<pre><code class="prism language-js"><span class="token comment">// 让线跟随鼠标移动</span>
document<span class="token punctuation">.</span><span class="token function-variable function">onmouseup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  document<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 防抖</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvasWidth<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvasHeight
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> event<span class="token punctuation">.</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_132"></a>初始化和绘制结束</h4> 
<p>初始化放在mounted中，主要是设置canvas对象。绘制结束则在检查图形符合要求后，直接闭合图形。检查是否符合要求的方法在后面描述。</p> 
<pre><code class="prism language-js"><span class="token comment">// 初始化</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"rgba(128, 100, 162, 0.5)"</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvasTemp<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// 闭合图形</span>
<span class="token function">closeFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 检查部分</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPointCross</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"闭合图形时发生横穿线，请重新绘制！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPointConcave</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"闭合图形时出现凹多边形，请重新绘制！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minPointNum <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>closeStatus<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 符合要求</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> document<span class="token punctuation">.</span>onmouseup <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasWidth<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>closeStatus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 绘制结束，返回数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"drawFinished"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 清除图形</span>
<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pointList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> document<span class="token punctuation">.</span>onmouseup <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasTempObj<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasWidth<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasWidth<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>closeStatus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h3><a id="_184"></a>随机生成和回显图形</h3> 
<p>随机生成两个整数点作为xy坐标形成多边形顶点，判断是否符合要求，符合要求的顶点列表作为多边形。如果符合要求，则调用回显函数。</p> 
<h4><a id="_186"></a>随机生成图形</h4> 
<p>可以看到随机生成的图形中有while (1)循环，还有if (j &gt; num * 100) 这种限制。这是因为目前是随机生成点，再判断是否符合要求，在遇到较复杂的图形限制时，随机生成函数很容易陷入死循环，因此加入了循环失败次数限制。</p> 
<pre><code class="prism language-js"><span class="token comment">// 辅助函数，获取随机点</span>
<span class="token function">getRandomPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasWidth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvasHeight <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token punctuation">,</span>
    y<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 随机生成点并绘制图形</span>
<span class="token function">randomRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>regionNum<span class="token punctuation">.</span>min<span class="token punctuation">;</span>
    <span class="token keyword">const</span> pointList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRandomPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> point <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRandomPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 判断生成的点是否符合要求</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvasRegion<span class="token punctuation">.</span><span class="token function">checkPoint</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> pointList<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> num <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token operator">++</span>i<span class="token punctuation">;</span>
      pointList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 判断生成的图形是否符合要求</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      pointList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> num <span class="token operator">||</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvasRegion<span class="token punctuation">.</span><span class="token function">checkPointCross</span><span class="token punctuation">(</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pointList<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvasRegion<span class="token punctuation">.</span><span class="token function">checkPointConcave</span><span class="token punctuation">(</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pointList<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvasRegion<span class="token punctuation">.</span><span class="token function">handleForeignData</span><span class="token punctuation">(</span>pointList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h4><a id="_232"></a>回显图形</h4> 
<p>直接在固定 Canvas中绘制即可。</p> 
<pre><code class="prism language-js"><span class="token comment">// 处理外来的数据</span>
<span class="token function">handleForeignData</span><span class="token punctuation">(</span>canvasData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span>canvasData <span class="token operator">||</span>
    canvasData<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minPointNum <span class="token operator">||</span>
    canvasData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxPointNum
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"回显数据不符合要求！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pointList <span class="token operator">=</span> canvasData<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">echoFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 回显图形</span>
<span class="token function">echoFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvasObj<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">closeFigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h3><a id="_262"></a>点位置的限制</h3> 
<p>为了防止用户手抖，在同一个位置多次点击鼠标而产生很多顶点，我们增加了点的位置限制。方法很简单：</p> 
<ol><li>点击鼠标时，对图形中已有的每个顶点进行循环，每个点判断与鼠标当前位置的距离。如果距离小于要求，则不能生成顶点。</li><li>如果与图形中的第一个顶点（就是起点）位置小于要求，则认为用户在尝试闭合图形。</li></ol> 
<pre><code class="prism language-js"><span class="token comment">// 检查点有没有与当前点位置太近，如果太近就不认为是一个点</span>
<span class="token function">checkPointClose</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> pointList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pointList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
      Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> point<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span>
        Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> point<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果是在第一个点附近点的，那就认为是在尝试闭合图形</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pointList<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minPointNum <span class="token operator">&amp;&amp;</span> i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token string">"closeFirst"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h3><a id="_288"></a>相交线的限制</h3> 
<p>相交线表示多边形的两条边相交。如果允许相交，就会产生下面这种奇怪的图形：<br> <img src="https://images2.imgbox.com/6e/8b/JtJJkNSt_o.png" alt="在这里插入图片描述"></p> 
<p>这种图形很明显不像正常的多边形，因此要对相交线进行限制。那么如何判断两条边相交？</p> 
<h4><a id="_293"></a>小学数学做法</h4> 
<p>小学数学课的时候，我们都学过如何求两个直线的交点。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
             
             
               ( 
              
             
               x 
              
             
               1 
              
             
               , 
              
             
               y 
              
             
               1 
              
             
               ) 
              
             
            
           
           
            
             
             
               ( 
              
             
               x 
              
             
               2 
              
             
               , 
              
             
               y 
              
             
               2 
              
             
               ) 
              
              
              
               
               
                 构 
                
               
                 造 
                
               
                 直 
                
               
                 线 
                
               
                 方 
                
               
                 程 
                
               
              
                → 
               
              
              
             
               y 
              
             
               = 
              
             
               a 
              
             
               x 
              
             
               + 
              
             
               b 
              
             
            
           
          
          
           
            
             
             
               ( 
              
             
               x 
              
             
               3 
              
             
               , 
              
             
               y 
              
             
               3 
              
             
               ) 
              
             
            
           
           
            
             
             
               ( 
              
             
               x 
              
             
               4 
              
             
               , 
              
             
               y 
              
             
               4 
              
             
               ) 
              
              
              
               
               
                 构 
                
               
                 造 
                
               
                 直 
                
               
                 线 
                
               
                 方 
                
               
                 程 
                
               
              
                → 
               
              
              
             
               y 
              
             
               = 
              
             
               c 
              
             
               x 
              
             
               + 
              
             
               d 
              
             
            
           
          
         
         
         
          
          
            联 
           
          
            立 
           
          
            求 
           
          
            解 
           
          
         
           → 
          
         
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         \begin{matrix} (x1,y1)&amp;(x2,y2)\quad\overrightarrow{\scriptsize 构造直线方程}\quad y=ax+b\\(x3,y3)&amp;(x4,y4)\quad\overrightarrow{\scriptsize 构造直线方程}\quad y=cx+d\end{matrix}\quad \overrightarrow{\scriptsize 联立求解}\quad(x,y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.4em; vertical-align: -0.95em;"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">1</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">3</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 1em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.522em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord"><span class="mord cjk_fallback sizing reset-size6 size3">构</span><span class="mord cjk_fallback sizing reset-size6 size3">造</span><span class="mord cjk_fallback sizing reset-size6 size3">直</span><span class="mord cjk_fallback sizing reset-size6 size3">线</span><span class="mord cjk_fallback sizing reset-size6 size3">方</span><span class="mord cjk_fallback sizing reset-size6 size3">程</span></span></span><span class="svg-align" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="hide-tail" style="height: 0.522em; min-width: 0.888em;"> 
                    <svg width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"> 
                     <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"></path> 
                    </svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">b</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right: 1em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.522em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord"><span class="mord cjk_fallback sizing reset-size6 size3">构</span><span class="mord cjk_fallback sizing reset-size6 size3">造</span><span class="mord cjk_fallback sizing reset-size6 size3">直</span><span class="mord cjk_fallback sizing reset-size6 size3">线</span><span class="mord cjk_fallback sizing reset-size6 size3">方</span><span class="mord cjk_fallback sizing reset-size6 size3">程</span></span></span><span class="svg-align" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="hide-tail" style="height: 0.522em; min-width: 0.888em;"> 
                    <svg width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"> 
                     <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"></path> 
                    </svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.522em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord"><span class="mord cjk_fallback sizing reset-size6 size3">联</span><span class="mord cjk_fallback sizing reset-size6 size3">立</span><span class="mord cjk_fallback sizing reset-size6 size3">求</span><span class="mord cjk_fallback sizing reset-size6 size3">解</span></span></span><span class="svg-align" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="hide-tail" style="height: 0.522em; min-width: 0.888em;"> 
            <svg width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"> 
             <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z"></path> 
            </svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></span></p> 
<p>最后判断交点（x,y）是否属于两个顶点构成的线段内。<br> 其中，如果a等于c，表示两个直线斜率一致，两个直线平行，无交点。如果同时b等于d，代表两个为同一条直线。最后判断交点是否在线段内非常简单，只需要判断交点的坐标是否在线段两个端点之间即可。<br> 但是，这个方法有个很大的问题：会使用到除法。使用点构造直线方程时会用到除法，联立方程求解交点也会用到除法。计算机中的浮点数是离散存储的，如果是整数可以精确存储。如果使用除法，会产生浮点数，造成精度损失，对于部分边界情况会造成误判。因此不采用这种方法。</p> 
<h4><a id="_302"></a>向量叉乘判断方向法</h4> 
<h5><a id="_303"></a>向量叉乘</h5> 
<p>有两个起点在(0,0)，终点在(x1, y1)和(x2, y2)的向量， 命名为向量a和b。<br> <img src="https://images2.imgbox.com/bc/f0/3QS6lwao_o.png" alt="在这里插入图片描述"><br> 两个向量的叉乘定义为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           ∣ 
          
          
           
            
             
              
              
                x 
               
              
                1 
               
              
             
            
            
             
              
              
                x 
               
              
                2 
               
              
             
            
           
           
            
             
              
              
                y 
               
              
                1 
               
              
             
            
            
             
              
              
                y 
               
              
                2 
               
              
             
            
           
          
         
           ∣ 
          
         
        
          = 
         
        
          x 
         
        
          1 
         
        
          ∗ 
         
        
          y 
         
        
          2 
         
        
          − 
         
        
          x 
         
        
          2 
         
        
          ∗ 
         
        
          y 
         
        
          1 
         
        
       
         \begin{vmatrix}x1&amp;x2\\y1&amp;y2\end{vmatrix}=x1*y2-x2*y1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.424em; vertical-align: -0.95002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.47398em;"><span class="" style="top: -1.65598em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.26198em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.86798em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -3.47398em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="mord">1</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="mord">2</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.47398em;"><span class="" style="top: -1.65598em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.26198em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.86798em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -3.47398em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95002em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord mathdefault">x</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mord">1</span></span></span></span></span></span><br> 如果叉乘结果为正，则说明向量b在向量a的逆时针方向。如果为正则是顺时针方向。如果为0代表a和b共线。</p> 
<h5><a id="_312"></a>使用向量叉乘判断交叉</h5> 
<p>接下来，如果有两条线段分别叫做AB和CD，如何判断两条线是否交叉？<br> <img src="https://images2.imgbox.com/4a/da/Rv2QwHeA_o.png" alt="在这里插入图片描述"></p> 
<p>我们令点A作为零点，做AC，AD两条辅助向量。此时我们发现，如果两线交叉，那么C和D必须在直线的两侧。也就是说，向量AB和AC的叉乘与向量AB和AD的叉乘必须是异号的。那么下面这种情况呢？<br> <img src="https://images2.imgbox.com/d2/4b/wqF42ehd_o.png" alt="在这里插入图片描述"><br> 向量AC和AD的确在向量AB的两侧，两条直线交叉，但是线段并不交叉。这时候我们以另一条线段的端点D作为零点，再判断一次发现并不异号。因此，判断两次就能保证交叉。<br> 判断时，我们每点击一个点，就与原来图中的最后一个点连成一条线，再与原来图中所有点判断是否交叉。</p> 
<pre><code class="prism language-js"><span class="token comment">// 辅助函数 获取以point1作为原点的线</span>
<span class="token function">getPointLine</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token punctuation">:</span> point2<span class="token punctuation">.</span>x <span class="token operator">-</span> point1<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> point2<span class="token punctuation">.</span>y <span class="token operator">-</span> point1<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p1<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 辅助函数 两线叉乘 两线的起点必须一致</span>
<span class="token function">crossLine</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> point1<span class="token punctuation">.</span>x <span class="token operator">*</span> point2<span class="token punctuation">.</span>y <span class="token operator">-</span> point2<span class="token punctuation">.</span>x <span class="token operator">*</span> point1<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 辅助函数 检查第二条线的方向在第一条线的左还是右</span>
<span class="token function">isDirection</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">,</span> point3<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 假设point1是原点</span>
  <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPointLine</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPointLine</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">crossLine</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 辅助函数 判断两个点是否是同一个</span>
<span class="token function">isEuqalPoint</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>point1<span class="token punctuation">.</span>x <span class="token operator">==</span> point2<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> point1<span class="token punctuation">.</span>y <span class="token operator">==</span> point2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 辅助函数 检查两个线是否交叉</span>
<span class="token function">isPointCross</span><span class="token punctuation">(</span>line1P1<span class="token punctuation">,</span> line1P2<span class="token punctuation">,</span> line2P1<span class="token punctuation">,</span> line2P2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> euqal <span class="token operator">=</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEuqalPoint</span><span class="token punctuation">(</span>line1P1<span class="token punctuation">,</span> line2P1<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEuqalPoint</span><span class="token punctuation">(</span>line1P1<span class="token punctuation">,</span> line2P2<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEuqalPoint</span><span class="token punctuation">(</span>line1P2<span class="token punctuation">,</span> line2P1<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEuqalPoint</span><span class="token punctuation">(</span>line1P2<span class="token punctuation">,</span> line2P2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>line1P1<span class="token punctuation">,</span> line1P2<span class="token punctuation">,</span> line2P1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>line1P1<span class="token punctuation">,</span> line1P2<span class="token punctuation">,</span> line2P2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>line2P1<span class="token punctuation">,</span> line2P2<span class="token punctuation">,</span> line1P1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re4 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>line2P1<span class="token punctuation">,</span> line2P2<span class="token punctuation">,</span> line1P2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re11 <span class="token operator">=</span> re1 <span class="token operator">*</span> re2<span class="token punctuation">;</span>
  <span class="token keyword">const</span> re22 <span class="token operator">=</span> re3 <span class="token operator">*</span> re4<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>re11 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> re22 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>euqal<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>re1 <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> re2 <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> re3 <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> re4 <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>re11 <span class="token operator">*</span> re22 <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 检查图形有没有横穿</span>
<span class="token function">checkPointCross</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> pointList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>crossAllow<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pointList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isPointCross</span><span class="token punctuation">(</span>
      pointList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
      pointList<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      point
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>re<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>如果出现叉乘为0的情况，那么比较复杂，需要首先排除多边形临近边的情况，剩下要分几种情况分别判断。<br> <img src="https://images2.imgbox.com/d0/ec/1erPh5Px_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_396"></a>凹多边形限制</h3> 
<p>凹多边形同样用到上面的叉乘方法来判断。从上面我们知道，向量叉乘可以表示第二个向量在第一个的顺时针还是逆时针方向。我们假设A，B，C是先后画在图中的三个点。我们设A点为零点。连接AC。这时候AB和AC的叉乘&gt;0，表示逆时针。<br> <img src="https://images2.imgbox.com/79/df/vI0Y05Ff_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们在图中再画点D。再令点B为零点，连接BD。如果叉乘&lt;0，表示顺时针。这时候我们在图中就会很明显的发现，图形出现凹处。如果叉乘&gt;0，表示逆时针，这时候是可以保证凸多边形的。因此凸多边形的条件是，如果顺序连接图形，每条线的顺逆时针必须一致。<br> <img src="https://images2.imgbox.com/89/1d/cGtW1Um0_o.png" alt="在这里插入图片描述"></p> 
<p>当然也有一些特殊情况，比如图1，虽然每条边都是逆时针符合规则，但是实际上在内卷，如果不交叉线，根本无法闭合。图2很显然是凹多边形，但是凹凸性不一致的边中间的直线上点了好多点，这样就无法通过临近边的叉乘来判断之前线的顺逆时针了。我的解决方法：禁止画这种线，既临近边的叉乘不能为0。还可以有好几个方法能更好的解决：1.顺序记录下每个边的旋转方向，每条边的旋转方向必须一致。 2.可以让图形中任意一个端点连接当前图中的最后一个点，再与当前画的三个点比较凹凸性，如果发现不一致则不是凸多边形。</p> 
<pre><code class="prism language-js"><span class="token comment">// 辅助函数 检查三个线是否凹凸</span>
<span class="token function">isPointConcave</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">,</span> point3<span class="token punctuation">,</span> point4<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> re1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>point1<span class="token punctuation">,</span> point2<span class="token punctuation">,</span> point3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> re2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirection</span><span class="token punctuation">(</span>point2<span class="token punctuation">,</span> point3<span class="token punctuation">,</span> point4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>re1 <span class="token operator">*</span> re2 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 检查是否是凹图形</span>
<span class="token function">checkPointConcave</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> pointList<span class="token punctuation">,</span> isEnd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>concaveAllow<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pointList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isPointConcave</span><span class="token punctuation">(</span>
      pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      point
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// 如果是闭合时，point为起始点，需要再判断最后两条线与第一条线是否形成凹图形</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isEnd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isPointConcave</span><span class="token punctuation">(</span>
        pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isPointConcave</span><span class="token punctuation">(</span>
        pointList<span class="token punctuation">[</span>pointList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pointList<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>如果是最后闭合图形，则需要判断闭合点附近多条线的顺逆时针。</p> 
<h3><a id="_456"></a>参考</h3> 
<ul><li>判断两条线段是否相交—（向量叉乘）<br> <a href="https://www.cnblogs.com/tuyang1129/p/9390376.html" rel="nofollow">https://www.cnblogs.com/tuyang1129/p/9390376.html</a></li><li>线段的叉乘<br> <a href="https://blog.csdn.net/m0_50089378/article/details/122288557">https://blog.csdn.net/m0_50089378/article/details/122288557</a></li><li>凸多边形判断[LeetCode] 469. 凸多边形<br> <a href="https://blog.csdn.net/weixin_39913117/article/details/111372353">https://blog.csdn.net/weixin_39913117/article/details/111372353</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12ea835e8e94301e2c9c03ea450ea59e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">史上最全linux语法汇总，教你一文掌握linux</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a16487f7c578c679a865fb9bb6fe7bbd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">老杜MySQL入门34道题答案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>