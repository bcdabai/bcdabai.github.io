<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL高级查询语句小结（二） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL高级查询语句小结（二）" />
<meta property="og:description" content="2018.8.8—–学习笔记；
基本常用查询 select select * from student; all 查询所有 select all sex from student; distinct 过滤重复 select distinct sex from student; count 统计 select count(*) from student; select count(sex) from student; select count(distinct sex) from student; top 取前N条记录 select top 3 * from student; alias column name 列重命名 select id as 编号, name ‘名称’, sex 性别 from student; alias table name 表重命名 select id, name, s.id, s.name from student s; column 列运算 select (age &#43; id) col from student; select s." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fec84cec3b55574405a24fc175f9767e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-07T09:55:59+08:00" />
<meta property="article:modified_time" content="2018-08-07T09:55:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL高级查询语句小结（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>2018.8.8—–学习笔记；</p> 
<h6 id="基本常用查询">基本常用查询</h6> 
<p><strong>select </strong></p> 
<blockquote> 
 <p>select * from student; </p> 
</blockquote> 
<p><strong>all 查询所有 </strong></p> 
<blockquote> 
 <p>select all sex from student; </p> 
</blockquote> 
<p><strong>distinct 过滤重复 </strong></p> 
<blockquote> 
 <p>select distinct sex from student; </p> 
</blockquote> 
<p><strong>count 统计 </strong></p> 
<blockquote> 
 <p>select count(*) from student; <br> select count(sex) from student; <br> select count(distinct sex) from student; </p> 
</blockquote> 
<p><strong>top 取前N条记录 </strong></p> 
<blockquote> 
 <p>select top 3 * from student; </p> 
</blockquote> 
<p><strong>alias column name 列重命名 </strong></p> 
<blockquote> 
 <p>select id as 编号, name ‘名称’, sex 性别 from student; </p> 
</blockquote> 
<p><strong>alias table name 表重命名 </strong></p> 
<blockquote> 
 <p>select id, name, s.id, s.name from student s; </p> 
</blockquote> 
<p><strong>column 列运算 </strong></p> 
<blockquote> 
 <p>select (age + id) col from student; <br> select s.name + ‘-’ + c.name from classes c, student s where s.cid = c.id; </p> 
</blockquote> 
<p><strong>where 条件 </strong></p> 
<blockquote> 
 <p>select * from student where id = 2; <br> select * from student where id &gt; 7; <br> select * from student where id &lt; 3; <br> select * from student where id &lt;&gt; 3; <br> select * from student where id &gt;= 3; <br> select * from student where id &lt;= 5; <br> select * from student where id !&gt; 3; <br> select * from student where id !&lt; 5; </p> 
</blockquote> 
<p><strong>and 并且 </strong></p> 
<blockquote> 
 <p>select * from student where id &gt; 2 and sex = 1; </p> 
</blockquote> 
<p><strong>or 或者 </strong></p> 
<blockquote> 
 <p>select * from student where id = 2 or sex = 1; </p> 
</blockquote> 
<p><strong>between … and … 相当于并且 </strong></p> 
<blockquote> 
 <p>select * from student where id between 2 and 5; <br> select * from student where id not between 2 and 5; </p> 
</blockquote> 
<p><strong>like 模糊查询 </strong></p> 
<blockquote> 
 <p>select * from student where name like ‘%a%’; <br> select * from student where name like ‘%[a][o]%’; <br> select * from student where name not like ‘%a%’; <br> select * from student where name like ‘ja%’; <br> select * from student where name not like ‘%[j,n]%’; <br> select * from student where name like ‘%[j,n,a]%’; <br> select * from student where name like ‘%[^ja,as,on]%’; <br> select * from student where name like ‘%[ja_on]%’; </p> 
</blockquote> 
<p><strong>in 子查询 </strong></p> 
<blockquote> 
 <p>select * from student where id in (1, 2); </p> 
</blockquote> 
<p><strong>not in 不在其中 </strong></p> 
<blockquote> 
 <p>select * from student where id not in (1, 2); </p> 
</blockquote> 
<p><strong>is null 是空 </strong></p> 
<blockquote> 
 <p>select * from student where age is null; </p> 
</blockquote> 
<p><strong>is not null 不为空 </strong></p> 
<blockquote> 
 <p>select * from student where age is not null; </p> 
</blockquote> 
<p><strong>order by 排序 </strong></p> 
<blockquote> 
 <p>select * from student order by name; <br> select * from student order by name desc; <br> select * from student order by name asc; </p> 
</blockquote> 
<p><strong>group by 分组 </strong> <br> 按照年龄进行分组统计 </p> 
<blockquote> 
 <p>select count(age), age from student group by age; </p> 
</blockquote> 
<p>按照性别进行分组统计 </p> 
<blockquote> 
 <p>select count(*), sex from student group by sex; </p> 
</blockquote> 
<p>按照年龄和性别组合分组统计，并排序 </p> 
<blockquote> 
 <p>select count(*), sex from student group by sex, age order by age; </p> 
</blockquote> 
<p>按照性别分组，并且是id大于2的记录最后按照性别排序 </p> 
<blockquote> 
 <p>select count(*), sex from student where id &gt; 2 group by sex order by sex; </p> 
</blockquote> 
<p>查询id大于2的数据，并完成运算后的结果进行分组和排序 </p> 
<blockquote> 
 <p>select count(<em>), (sex </em> id) new from student where id &gt; 2 group by sex * id order by sex * id;</p> 
</blockquote> 
<p><strong>group by all 所有分组 </strong> <br> 按照年龄分组，是所有的年龄 </p> 
<blockquote> 
 <p>select count(*), age from student group by all age; </p> 
</blockquote> 
<p><strong>having 分组过滤条件 </strong> <br> 按照年龄分组，过滤年龄为空的数据，并且统计分组的条数和现实年龄信息 </p> 
<blockquote> 
 <p>select count(*), age from student group by age having age is not null; </p> 
</blockquote> 
<p>按照年龄和cid组合分组，过滤条件是cid大于1的记录 </p> 
<blockquote> 
 <p>select count(*), cid, sex from student group by cid, sex having cid &gt; 1; </p> 
</blockquote> 
<p>按照年龄分组，过滤条件是分组后的记录条数大于等于2 </p> 
<blockquote> 
 <p>select count(*), age from student group by age having count(age) &gt;= 2; </p> 
</blockquote> 
<p>按照cid和性别组合分组，过滤条件是cid大于1，cid的最大值大于2 </p> 
<blockquote> 
 <p>select count(*), cid, sex from student group by cid, sex having cid &gt; 1 and max(cid) &gt; 2;</p> 
</blockquote> 
<h6 id="二-嵌套子查询">二、 嵌套子查询</h6> 
<p>子查询是一个嵌套在select、insert、update或delete语句或其他子查询中的查询。任何允许使用表达式的地方都可以使用子查询。子查询也称为内部查询或内部选择，而包含子查询的语句也成为外部查询或外部选择。</p> 
<h4 id="from-select-table示例">from (select … table)示例</h4> 
<p>将一个table的查询结果当做一个新表进行查询 </p> 
<blockquote> 
 <p>select * from ( <br> select id, name from student where sex = 1 <br> ) t where t.id &gt; 2; </p> 
</blockquote> 
<p>上面括号中的语句，就是子查询语句（内部查询）。在外面的是外部查询，其中外部查询可以包含以下语句： <br> 1、 包含常规选择列表组件的常规select查询 <br> 2、 包含一个或多个表或视图名称的常规from语句 <br> 3、 可选的where子句 <br> 4、 可选的group by子句 <br> 5、 可选的having子句 </p> 
<h2 id="示例">示例</h2> 
<p>查询班级信息，统计班级学生人生 </p> 
<blockquote> 
 <p>select <em>, (select count(</em>) from student where cid = classes.id) as num <br> from classes order by num; </p> 
</blockquote> 
<h2 id="in-not-in子句查询示例">in, not in子句查询示例</h2> 
<p>查询班级id大于小于的这些班级的学生信息 </p> 
<blockquote> 
 <p>select * from student where cid in ( <br> select id from classes where id &gt; 2 and id &lt; 4 <br> ); </p> 
</blockquote> 
<p>查询不是班的学生信息 </p> 
<blockquote> 
 <p>select * from student where cid not in ( <br> select id from classes where name = ‘2班’ <br> ) </p> 
</blockquote> 
<p>in、not in 后面的子句返回的结果必须是一列，这一列的结果将会作为查询条件对应前面的条件。如cid对应子句的id； </p> 
<h2 id="exists和not-exists子句查询示例">exists和not exists子句查询示例</h2> 
<p>查询存在班级id为的学生信息 </p> 
<blockquote> 
 <p>select * from student where exists ( <br> select * from classes where id = student.cid and id = 3 <br> ); </p> 
</blockquote> 
<p>查询没有分配班级的学生信息 </p> 
<blockquote> 
 <p>select * from student where not exists ( <br> select * from classes where id = student.cid <br> ); </p> 
</blockquote> 
<p>exists和not exists查询需要内部查询和外部查询进行一个关联的条件，如果没有这个条件将是查询到的所有信息。如：id等于student.id； </p> 
<h2 id="someanyall子句查询示例">some、any、all子句查询示例</h2> 
<p>查询班级的学生年龄大于班级的学生的年龄的信息 </p> 
<blockquote> 
 <p>select * from student where cid = 5 and age &gt; all ( <br> select age from student where cid = 3 <br> ); <br> select * from student where cid = 5 and age &gt; any ( <br> select age from student where cid = 3 <br> ); <br> select * from student where cid = 5 and age &gt; some ( <br> select age from student where cid = 3 <br> ); </p> 
</blockquote> 
<h6 id="聚合查询">聚合查询</h6> 
<p><strong>1、 distinct去掉重复数据 </strong></p> 
<blockquote> 
 <p>select distinct sex from student; <br> select count(sex), count(distinct sex) from student; </p> 
</blockquote> 
<p><strong>2、 compute和compute by汇总查询 </strong> <br> 对年龄大于的进行汇总 </p> 
<blockquote> 
 <p>select age from student <br> where age &gt; 20 order by age compute sum(age) by age; </p> 
</blockquote> 
<p>对年龄大于的按照性别进行分组汇总年龄信息 </p> 
<blockquote> 
 <p>select id, sex, age from student <br> where age &gt; 20 order by sex, age compute sum(age) by sex; </p> 
</blockquote> 
<p>按照年龄分组汇总 </p> 
<blockquote> 
 <p>select age from student <br> where age &gt; 20 order by age, id compute sum(age); </p> 
</blockquote> 
<p>按照年龄分组，年龄汇总，id找最大值 </p> 
<blockquote> 
 <p>select id, age from student <br> where age &gt; 20 order by age compute sum(age), max(id); </p> 
</blockquote> 
<p>compute进行汇总前面是查询的结果，后面一条结果集就是汇总的信息。compute子句中可以添加多个汇总表达式，可以添加的信息如下： <br> a、 可选by关键字。它是每一列计算指定的行聚合 <br> b、 行聚合函数名称。包括sum、avg、min、max、count等 <br> c、 要对其执行聚合函数的列 <br> compute by适合做先分组后汇总的业务。compute by后面的列一定要是order by中出现的列。 <br> <strong>3、 cube汇总 </strong> <br> cube汇总和compute效果类似，但语法较简洁，而且返回的是一个结果集。 </p> 
<blockquote> 
 <p>select count(*), sex from student group by sex with cube; <br> select count(*), age, sum(age) from student where age is not null group by age with cube;</p> 
</blockquote> 
<p>cube要结合group by语句完成分组汇总 </p> 
<h6 id="排序函数">排序函数</h6> 
<p>排序在很多地方需要用到，需要对查询结果进行排序并且给出序号。比如： <br> 1、 对某张表进行排序，序号需要递增不重复的 <br> 2、 对学生的成绩进行排序，得出名次，名次可以并列，但名次的序号是连续递增的 <br> 3、 在某些排序的情况下，需要跳空序号，虽然是并列 <br> 基本语法 <br> 排序函数 over([分组语句] 排序子句[desc][asc]) <br> 排序子句 order by 列名, 列名 <br> 分组子句 partition by 分组列, 分组列 </p> 
<h2 id="rownumber函数">row_number函数</h2> 
<p>根据排序子句给出递增连续序号 <br> 按照名称排序的顺序递增 <br> select s.id, s.name, cid, c.name, row_number() over(order by c.name) as number <br> from student s, classes c where cid = c.id; </p> 
<h2 id="rank函数函数">rank函数函数</h2> 
<p>根据排序子句给出递增的序号，但是存在并列并且跳空 <br> <strong>顺序递增 </strong></p> 
<blockquote> 
 <p>select id, name, rank() over(order by cid) as rank from student; </p> 
</blockquote> 
<p><strong>跳过相同递增 </strong></p> 
<blockquote> 
 <p>select s.id, s.name, cid, c.name, rank() over(order by c.name) as rank <br> from student s, classes c where cid = c.id; </p> 
</blockquote> 
<h2 id="denserank函数">dense_rank函数</h2> 
<p>根据排序子句给出递增的序号，但是存在并列不跳空 <br> 不跳过，直接递增 </p> 
<blockquote> 
 <p>select s.id, s.name, cid, c.name, dense_rank() over(order by c.name) as dense <br> from student s, classes c where cid = c.id; </p> 
</blockquote> 
<h2 id="partition-by分组子句">partition by分组子句</h2> 
<p>可以完成对分组的数据进行增加排序，partition by可以与以上三个函数联合使用。 <br> 利用partition by按照班级名称分组，学生id排序 </p> 
<blockquote> 
 <p>select s.id, s.name, cid, c.name, row_number() over(partition by c.name order by s.id) as rank <br> from student s, classes c where cid = c.id; <br> select s.id, s.name, cid, c.name, rank() over(partition by c.name order by s.id) as rank <br> from student s, classes c where cid = c.id; <br> select s.id, s.name, cid, c.name, dense_rank() over(partition by c.name order by s.id) as rank <br> from student s, classes c where cid = c.id; </p> 
</blockquote> 
<h2 id="ntile平均排序函数">ntile平均排序函数</h2> 
<p>将要排序的数据进行平分，然后按照等分排序。ntile中的参数代表分成多少等分。 </p> 
<blockquote> 
 <p>select s.id, s.name, cid, c.name, <br> ntile(5) over(order by c.name) as ntile <br> from student s, classes c where cid = c.id; </p> 
</blockquote> 
<h6 id="集合运算">集合运算</h6> 
<p>操作两组查询结果，进行交集、并集、减集运算 </p> 
<h6 id="1-union和union-all进行并集运算">1、 union和union all进行并集运算</h6> 
<p><strong>union 并集、不重复 </strong></p> 
<blockquote> 
 <p>select id, name from student where name like ‘ja%’ <br> union <br> select id, name from student where id = 4; </p> 
</blockquote> 
<p><strong>并集、重复</strong> </p> 
<blockquote> 
 <p>select * from student where name like ‘ja%’ <br> union all <br> select * from student; </p> 
</blockquote> 
<h6 id="2-intersect进行交集运算">2、 intersect进行交集运算</h6> 
<p><strong>交集（相同部分）</strong> </p> 
<blockquote> 
 <p>select * from student where name like ‘ja%’ <br> intersect <br> select * from student; </p> 
</blockquote> 
<h6 id="3-except进行减集运算">3、 except进行减集运算</h6> 
<p><strong>减集（除相同部分）</strong> </p> 
<blockquote> 
 <p>select * from student where name like ‘ja%’ <br> except <br> select * from student where name like ‘jas%’; </p> 
</blockquote> 
<h6 id="公式表表达式">公式表表达式</h6> 
<p>查询表的时候，有时候中间表需要重复使用，这些子查询被重复查询调用，不但效率低，而且可读性低，不利于理解。那么公式表表达式可以解决这个问题。 <br> 我们可以将公式表表达式（CET）视为临时结果集，在select、insert、update、delete或是create view语句的执行范围内进行定义。 <br> <strong>表达式 </strong></p> 
<blockquote> 
 <p>with statNum(id, num) as <br> ( <br> select cid, count(*) <br> from student <br> where id &gt; 0 <br> group by cid <br> ) <br> select id, num from statNum order by id; <br> with statNum(id, num) as <br> ( <br> select cid, count(*) <br> from student <br> where id &gt; 0 <br> group by cid <br> ) <br> select max(id), avg(num) from statNum; </p> 
</blockquote> 
<h6 id="连接查询">连接查询</h6> 
<p>1、 简化连接查询 <br> –简化联接查询 </p> 
<blockquote> 
 <p>select s.id, s.name, c.id, c.name from student s, classes c where s.cid = c.id; </p> 
</blockquote> 
<p>2、 left join左连接 </p> 
<p><strong>左连接 </strong></p> 
<blockquote> 
 <p>select s.id, s.name, c.id, c.name from student s left join classes c on s.cid = c.id;</p> 
</blockquote> 
<p>3、 right join右连接 <br> <strong>右连接 </strong></p> 
<blockquote> 
 <p>select s.id, s.name, c.id, c.name from student s right join classes c on s.cid = c.id;</p> 
</blockquote> 
<p>4、 inner join内连接 <br> <strong>内连接</strong> </p> 
<blockquote> 
 <p>select s.id, s.name, c.id, c.name from student s inner join classes c on s.cid = c.id;</p> 
</blockquote> 
<p>inner可以省略 </p> 
<blockquote> 
 <p>select s.id, s.name, c.id, c.name from student s join classes c on s.cid = c.id; </p> 
</blockquote> 
<p>5、 cross join交叉连接 </p> 
<p><strong>交叉联接查询，结果是一个笛卡儿乘积</strong> </p> 
<blockquote> 
 <p>s.id, s.name, c.id, c.name from student s cross join classes c <br> where s.cid = c.id; </p> 
</blockquote> 
<p>6、 自连接（同一张表进行连接查询） <br> –自连接 <br> select distinct s.* from student s, student s1 where s.id &lt;&gt; s1.id and s.sex = s1.sex;</p> 
<h5 id="函数">函数</h5> 
<p><strong>1、 聚合函数 </strong> <br> max最大值、min最小值、count统计、avg平均值、sum求和、var求方差 </p> 
<blockquote> 
 <p>select <br> max(age) max_age, <br> min(age) min_age, <br> count(age) count_age, <br> avg(age) avg_age, <br> sum(age) sum_age, <br> var(age) var_age <br> from student; </p> 
</blockquote> 
<p><strong>2、 日期时间函数 </strong></p> 
<blockquote> 
 <p>select dateAdd(day, 3, getDate());–加天 <br> select dateAdd(year, 3, getDate());–加年 <br> select dateAdd(hour, 3, getDate());–加小时 </p> 
</blockquote> 
<p>返回跨两个指定日期的日期边界数和时间边界数 </p> 
<blockquote> 
 <p>select dateDiff(day, ‘2011-06-20’, getDate()); </p> 
</blockquote> 
<p>相差秒数 </p> 
<blockquote> 
 <p>select dateDiff(second, ‘2011-06-22 11:00:00’, getDate()); </p> 
</blockquote> 
<p>相差小时数 </p> 
<blockquote> 
 <p>select dateDiff(hour, ‘2011-06-22 10:00:00’, getDate()); <br> select dateName(month, getDate());–当前月份 <br> select dateName(minute, getDate());–当前分钟 <br> select dateName(weekday, getDate());–当前星期 <br> select datePart(month, getDate());–当前月份 <br> select datePart(weekday, getDate());–当前星期 <br> select datePart(second, getDate());–当前秒数 <br> select day(getDate());–返回当前日期天数 <br> select day(‘2011-06-30’);–返回当前日期天数 <br> select month(getDate());–返回当前日期月份 <br> select month(‘2011-11-10’); <br> select year(getDate());–返回当前日期年份 <br> select year(‘2010-11-10’); <br> select getDate();–当前系统日期 <br> select getUTCDate();–utc日期 </p> 
</blockquote> 
<p>3、 数学函数 </p> 
<blockquote> 
 <p>select pi();–PI函数 <br> select rand(100), rand(50), rand(), rand();–随机数 <br> select round(rand(), 3), round(rand(100), 5);–精确小数位 </p> 
</blockquote> 
<p>精确位数，负数表示小数点前 </p> 
<blockquote> 
 <p>select round(123.456, 2), round(254.124, -2); <br> select round(123.4567, 1, 2); </p> 
</blockquote> 
<p>4、 元数据 </p> 
<blockquote> 
 <p>select col_name(object_id(‘student’), 1);–返回列名 <br> select col_name(object_id(‘student’), 2); </p> 
</blockquote> 
<p>该列数据类型长度 </p> 
<blockquote> 
 <p>select col_length(‘student’, col_name(object_id(‘student’), 2)); </p> 
</blockquote> 
<p>该列数据类型长度 </p> 
<blockquote> 
 <p>select col_length(‘student’, col_name(object_id(‘student’), 1)); </p> 
</blockquote> 
<p>返回类型名称、类型id </p> 
<blockquote> 
 <p>select type_name(type_id(‘varchar’)), type_id(‘varchar’); </p> 
</blockquote> 
<p>返回列类型长度 </p> 
<blockquote> 
 <p>select columnProperty(object_id(‘student’), ‘name’, ‘PRECISION’); </p> 
</blockquote> 
<p>返回列所在索引位置 </p> 
<blockquote> 
 <p>select columnProperty(object_id(‘student’), ‘sex’, ‘ColumnId’); </p> 
</blockquote> 
<p>5、 字符串函数 </p> 
<blockquote> 
 <p>select ascii(‘a’);–字符转换ascii值 <br> select ascii(‘A’); <br> select char(97);–ascii值转换字符 <br> select char(65); <br> select nchar(65); <br> select nchar(45231); <br> select nchar(32993);–unicode转换字符 <br> select unicode(‘A’), unicode(‘中’);–返回unicode编码值 <br> select soundex(‘hello’), soundex(‘world’), soundex(‘word’); <br> select patindex(‘%a’, ‘ta’), patindex(‘%ac%’, ‘jack’), patindex(‘dex%’, ‘dexjack’);</p> 
</blockquote> 
<p>–匹配字符索引</p> 
<blockquote> 
 <p>select ‘a’ + space(2) + ‘b’, ‘c’ + space(5) + ‘d’;–输出空格 <br> select charIndex(‘o’, ‘hello world’);–查找索引 <br> select charIndex(‘o’, ‘hello world’, 6);–查找索引 <br> select quoteName(‘abc[]def’), quoteName(‘123]45’); </p> 
</blockquote> 
<p>–精确数字 </p> 
<blockquote> 
 <p>select str(123.456, 2), str(123.456, 3), str(123.456, 4); <br> select str(123.456, 9, 2), str(123.456, 9, 3), str(123.456, 6, 1), str(123.456, 9, 6); <br> select difference(‘hello’, ‘helloWorld’);–比较字符串相同 <br> select difference(‘hello’, ‘world’); <br> select difference(‘hello’, ‘llo’); <br> select difference(‘hello’, ‘hel’); <br> select difference(‘hello’, ‘hello’); <br> select replace(‘abcedef’, ‘e’, ‘E’);–替换字符串 <br> select stuff(‘hello world’, 3, 4, ‘ABC’);–指定位置替换字符串 <br> select replicate(‘abc#’, 3);–重复字符串 <br> select subString(‘abc’, 1, 1), subString(‘abc’, 1, 2), subString(‘hello Wrold’, 7, 5);</p> 
</blockquote> 
<p>截取字符串</p> 
<blockquote> 
 <p>select len(‘abc’);–返回长度 <br> select reverse(‘sqlServer’);–反转字符串 <br> select left(‘leftString’, 4);–取左边字符串 <br> select left(‘leftString’, 7); <br> select right(‘leftString’, 6);–取右边字符串 <br> select right(‘leftString’, 3); <br> select lower(‘aBc’), lower(‘ABC’);–小写 <br> select upper(‘aBc’), upper(‘abc’);–大写 </p> 
</blockquote> 
<p>去掉左边空格 </p> 
<blockquote> 
 <p>select ltrim(’ abc’), ltrim(‘# abc#’), ltrim(’ abc’); </p> 
</blockquote> 
<p>去掉右边空格 </p> 
<blockquote> 
 <p>select rtrim(’ abc ‘), rtrim(‘# abc# ‘), rtrim(‘abc’); </p> 
</blockquote> 
<p>6、 安全函数 </p> 
<blockquote> 
 <p>select current_user; <br> select user; <br> select user_id(), user_id(‘dbo’), user_id(‘public’), user_id(‘guest’); <br> select user_name(), user_name(1), user_name(0), user_name(2); <br> select session_user; <br> select suser_id(‘sa’); <br> select suser_sid(), suser_sid(‘sa’), suser_sid(‘sysadmin’), suser_sid(‘serveradmin’); <br> select is_member(‘dbo’), is_member(‘public’); <br> select suser_name(), suser_name(1), suser_name(2), suser_name(3); <br> select suser_sname(), suser_sname(0x01), suser_sname(0x02), suser_sname(0x03); <br> select is_srvRoleMember(‘sysadmin’), is_srvRoleMember(‘serveradmin’); <br> select permissions(object_id(‘student’)); <br> select system_user; <br> select schema_id(), schema_id(‘dbo’), schema_id(‘guest’); <br> select schema_name(), schema_name(1), schema_name(2), schema_name(3); </p> 
</blockquote> 
<p>7、 系统函数 </p> 
<blockquote> 
 <p>select app_name();–当前会话的应用程序名称 <br> select cast(2011 as datetime), cast(‘10’ as money), cast(‘0’ as varbinary);–类型转换 <br> select convert(datetime, ‘2011’);–类型转换 <br> select coalesce(null, ‘a’), coalesce(‘123’, ‘a’);–返回其参数中第一个非空表达式 <br> select collationProperty(‘Traditional_Spanish_CS_AS_KS_WS’, ‘CodePage’); <br> select current_timestamp;–当前时间戳 <br> select current_user; <br> select isDate(getDate()), isDate(‘abc’), isNumeric(1), isNumeric(‘a’); <br> select dataLength(‘abc’); <br> select host_id(); <br> select host_name(); <br> select db_name(); <br> select ident_current(‘student’), ident_current(‘classes’);–返回主键id的最大值 <br> select ident_incr(‘student’), ident_incr(‘classes’);–id的增量值 <br> select ident_seed(‘student’), ident_seed(‘classes’); <br> select @@identity;–最后一次自增的值 <br> select identity(int, 1, 1) as id into tab from student;–将studeng表的烈属，以/1自增形式创建一个tab <br> select * from tab; <br> select @@rowcount;–影响行数 <br> select @@cursor_rows;–返回连接上打开的游标的当前限定行的数目 <br> select @@error;–T-SQL的错误号 <br> select @@procid; </p> 
</blockquote> 
<p>8、 配置函数 </p> 
<blockquote> 
 <p>set datefirst 7;–设置每周的第一天，表示周日 <br> select @@datefirst as ‘星期的第一天’, datepart(dw, getDate()) AS ‘今天是星期’; <br> select @@dbts;–返回当前数据库唯一时间戳 <br> set language ‘Italian’; <br> select @@langId as ‘Language ID’;–返回语言id <br> select @@language as ‘Language Name’;–返回当前语言名称 <br> select @@lock_timeout;–返回当前会话的当前锁定超时设置（毫秒） <br> select @@max_connections;–返回SQL Server 实例允许同时进行的最大用户连接数 <br> select @@MAX_PRECISION AS ‘Max Precision’;–返回decimal 和numeric 数据类型所用的精度级别 <br> select @@SERVERNAME;–SQL Server 的本地服务器的名称 <br> select @@SERVICENAME;–服务名 <br> select @@SPID;–当前会话进程id <br> select @@textSize; <br> select @@version;–当前数据库版本信息 </p> 
</blockquote> 
<p>9、 系统统计函数 </p> 
<blockquote> 
 <p>select @@CONNECTIONS;–连接数 <br> select @@PACK_RECEIVED; <br> select @@CPU_BUSY; <br> select @@PACK_SENT; <br> select @@TIMETICKS; <br> select @@IDLE; <br> select @@TOTAL_ERRORS; <br> select @@IO_BUSY; <br> select @@TOTAL_READ;–读取磁盘次数 <br> select @@PACKET_ERRORS;–发生的网络数据包错误数 <br> select @@TOTAL_WRITE;–sqlserver执行的磁盘写入次数 <br> select patIndex(‘%soft%’, ‘microsoft SqlServer’); <br> select patIndex(‘soft%’, ‘software SqlServer’); <br> select patIndex(‘%soft’, ‘SqlServer microsoft’); <br> select patIndex(‘%so_gr%’, ‘Jsonisprogram’); <br> 10、 用户自定义函数 </p> 
</blockquote> 
<h2 id="查看当前数据库所有函数">查看当前数据库所有函数</h2> 
<p>–查询所有已创建函数 </p> 
<blockquote> 
 <p>select definition,* from sys.sql_modules m join sys.objects o on m.object_id = o.object_id <br> and type in(‘fn’, ‘if’, ‘tf’); </p> 
</blockquote> 
<h2 id="创建函数">创建函数</h2> 
<blockquote> 
 <p>if (object_id(‘fun_add’, ‘fn’) is not null) <br> drop function fun_add <br> go <br> create function fun_add(@num1 int, @num2 int) <br> returns int <br> with execute as caller <br> as <br> begin <br> declare @result int; <br> if (@num1 is null) <br> set @num1 = 0; <br> if (@num2 is null) <br> set @num2 = 0; <br> set @result = @num1 + @num2; <br> return @result; <br> end <br> go </p> 
</blockquote> 
<p>调用函数 </p> 
<blockquote> 
 <p>select dbo.fun_add(id, age) from student; </p> 
</blockquote> 
<p>自定义函数，字符串连接 </p> 
<blockquote> 
 <p>if (object_id(‘fun_append’, ‘fn’) is not null) <br> drop function fun_append <br> go <br> create function fun_append(@args nvarchar(1024), @args2 nvarchar(1024)) <br> returns nvarchar(2048) <br> as <br> begin <br> return @args + @args2; <br> end <br> go <br> select dbo.fun_append(name, ‘abc’) from student; </p> 
</blockquote> 
<h2 id="修改函数">修改函数</h2> 
<blockquote> 
 <p>alter function fun_append(@args nvarchar(1024), @args2 nvarchar(1024)) <br> returns nvarchar(1024) <br> as <br> begin <br> declare @result varchar(1024); <br> –coalesce返回第一个不为null的值 <br> set @args = coalesce(@args, ”); <br> set @args2 = coalesce(@args2, ”);; <br> set @result = @args + @args2; <br> return @result; <br> end <br> go <br> select dbo.fun_append(name, ‘#abc’) from student; </p> 
</blockquote> 
<h2 id="返回table类型函数">返回table类型函数</h2> 
<p>返回table对象函数 </p> 
<blockquote> 
 <p>select name, object_id, type from sys.objects where type in (‘fn’, ‘if’, ‘tf’) or type like ‘%f%’; <br> if (exists (select * from sys.objects where type in (‘fn’, ‘if’, ‘tf’) and name = ‘fun_find_stuRecord’)) <br> drop function fun_find_stuRecord <br> go <br> create function fun_find_stuRecord(@id int) <br> returns table <br> as <br> return (select * from student where id = @id); <br> go <br> select * from dbo.fun_find_stuRecord(2);</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb273f86f0e76096f31a833c03a08e49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式之Builder模式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0f1dcabfe0f5f70723eeb297dd939de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python Roberts算子、Sobel算子——举例说明 ^_^</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>