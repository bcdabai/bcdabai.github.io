<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql常用函数详解（一）——字符串截取 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql常用函数详解（一）——字符串截取" />
<meta property="og:description" content="1.substring函数——截取字符串 SUBSTRING ( expression, start, length )
expression——字符串、二进制字符串、文本、图像、列或包含列的表达式。请勿使用包含聚合函数的表达式。
start——整数或可以隐式转换为int 的表达式，指定子字符串的开始位置。
length——整数或可以隐式转换为 int 的表达式，指定子字符串的长度
left(field,length) ——函数返回field最左边的length个长度的字符串
right(field,length)——函数返回field最右边的length个长度的字符串
eg1:取定长定位置的字符串
select substring(&#39;abdcsef&#39;,1,3) result: abd
2.CHARINDEX函数——返回字符或者字符串在另一个字符串中的起始位置 CHARINDEX ( expression1 , expression2 [ , start_location ] ) —— CHARINDEX函数返回一个整数，返回的整数是要找的字符串在被找的字符串中的位置。Expression1是要到expression2中寻找的字符中，start_location是CHARINDEX函数开始在expression2中找expression1的位置。 CHARINDEX(&#39;SQL&#39;, &#39;Microsoft SQL Server&#39;) 这个函数命令将返回在“Microsoft SQL Server”中“SQL”的起始位置，在这个例子中，CHARINDEX函数将返回“S”在“Microsoft SQL Server”中的位置11。
eg1:取不定长不同位置的字符串
我们只想要得到&#39;roomno&#39;中的房间号，发现起始字符位置并不是固定的，而且，我们需要的房间号长度也不固定。
此时，我们可以运用‘charindex’这个函数就可以轻松搞定，它是用来定位某个特定字符在该字符串中的位置，即该函数
得到的结果是一个用来表示某个特定字符位置的数字。执行如下代码：
select room_stand=substring(roomno,charindex(&#39;元&#39;,roomno)&#43;1,charindex(&#39;室&#39;,roomno)-charindex(&#39;元&#39;,roomno)-1) from PROPERTY_room where roomno like &#39;%单元%室%&#39; result:
3.STUFF函数——删除指定长度的字符，并在指定的起点处插入另一组字符。 STUFF ( character_expression , start , length ,character_expression )
SELECT STUFF(&#39;abcde&#39;, 2, 3, &#39;123&#39;) result： a123e" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fab973b60d83847924636097ca99b6a4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-17T17:47:14+08:00" />
<meta property="article:modified_time" content="2018-08-17T17:47:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql常用函数详解（一）——字符串截取</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>1.substring函数——截取字符串</h4> 
<p>  SUBSTRING ( expression, start, length )</p> 
<p>    expression——字符串、二进制字符串、文本、图像、列或包含列的表达式。请勿使用包含聚合函数的表达式。</p> 
<p>    start——整数或可以隐式转换为int 的表达式，指定子字符串的开始位置。</p> 
<p>    length——整数或可以隐式转换为 int 的表达式，指定子字符串的长度</p> 
<p style="text-indent:0;">    left(field,length) ——函数返回field最左边的length个长度的字符串</p> 
<p>    right(field,length)——函数返回field最右边的length个长度的字符串</p> 
<p>eg1:取定长定位置的字符串</p> 
<pre class="has"><code>select substring('abdcsef',1,3)</code></pre> 
<p>result:  abd</p> 
<p> </p> 
<h4>2.CHARINDEX函数——返回字符或者字符串在另一个字符串中的起始位置</h4> 
<pre><code class="language-html hljs"> </code></pre> 
<p><strong>CHARINDEX ( expression1 , expression2 [ , start_location ] )</strong> ——  CHARINDEX函数返回一个整数，返回的整数是要找的字符串在被找的字符串中的位置。Expression1是要到expression2中寻找的字符中，start_location是CHARINDEX函数开始在expression2中找expression1的位置。 <strong> </strong></p> 
<pre class="has"><code class="language-sql">CHARINDEX('SQL', 'Microsoft SQL Server')</code></pre> 
<p>这个函数命令将返回在“Microsoft SQL Server”中“SQL”的起始位置，在这个例子中，CHARINDEX函数将返回“S”在“Microsoft SQL Server”中的位置11。</p> 
<p>eg1:取不定长不同位置的字符串</p> 
<p><img alt="" class="has" height="234" src="https://images2.imgbox.com/b6/76/wg8IIaM8_o.png" width="149">  </p> 
<p>       我们只想要得到'roomno'中的房间号，发现起始字符位置并不是固定的，而且，我们需要的房间号长度也不固定。</p> 
<p>此时，我们可以运用‘charindex’这个函数就可以轻松搞定，它是用来定位某个特定字符在该字符串中的位置，即该函数</p> 
<p>得到的结果是一个用来表示某个特定字符位置的数字。执行如下代码：</p> 
<pre class="has"><code class="language-sql">select 
room_stand=substring(roomno,charindex('元',roomno)+1,charindex('室',roomno)-charindex('元',roomno)-1) 
from PROPERTY_room
where roomno like '%单元%室%' </code></pre> 
<p>    result:</p> 
<p><img alt="" class="has" height="221" src="https://images2.imgbox.com/88/cb/KxkjIYoM_o.png" width="176"></p> 
<h4>3.STUFF函数——删除指定长度的字符，并在指定的起点处插入另一组字符。</h4> 
<p>STUFF ( character_expression , start , length ,character_expression )</p> 
<pre class="has"><code class="language-sql">SELECT STUFF('abcde', 2, 3, '123')</code></pre> 
<p>   result： a123e</p> 
<h4>4.patindex函数<span style="color:#002002;">——</span>返回pattern字符串在表达式expression里第一次出现的位置，起始值从1开始算。</h4> 
<p>1. PATINDEX ( '%pattern%' , expression )——'%pattern%'的用法类似于 like '%pattern%'的用法，也就是模糊查找其pattern字符串是否是expression找到，找到并返回其第一次出现的位置。</p> 
<p>eg1：</p> 
<pre class="has"><code class="language-sql">select patindex('%abb%','abcaabbeeabb')</code></pre> 
<p>结果5，也就是abb第一次出现的位置。</p> 
<p>2.PATINDEX ( '%pattern' , expression )——'%pattern' 类似于 like '%pattern'的用法，前面用模糊查找，也就是查找pattern的结束所在expression的位置，也就是从后面匹配起查找。</p> 
<p>eg2：</p> 
<pre class="has"><code class="language-sql">select patindex('%abb','abcaabbeeabb')</code></pre> 
<p>返回10，也就是abb在后面第一次出现的位置。</p> 
<pre class="has"><code class="language-sql">select patindex('%abb','abcaabbeeabbr')</code></pre> 
<p>返回0，后面的第一个字母r和abb不匹配，所以返回0</p> 
<p>3.PATINDEX ( 'pattern%' , expression )——这就相当于精确匹配查找，也就是pattern,expression完全相等。</p> 
<p>eg3：</p> 
<pre class="has"><code class="language-sql">select patindex('abb%','abbcaabbeeabb')</code></pre> 
<p>返回1，也就相当于起始值</p> 
<pre class="has"><code class="language-sql">select patindex('abb%','arbbcaabbeeabb')</code></pre> 
<p>返回0，开头找不到就返回0,后面无论有多少都不管。</p> 
<p>4.PATINDEX ( 'pattern' , expression )——这就相当于精确匹配查找，也就是pattern,expression完全相等。</p> 
<pre class="has"><code class="language-sql">select patindex('abb','abb')</code></pre> 
<p>返回1,完全相等</p> 
<pre class="has"><code class="language-sql">select patindex('abb','abbr')</code></pre> 
<p>返回0,不完全相等</p> 
<h3>5. patindex('%[pattern]%','ddabcaabbeeabbr')，</h3> 
<h3>   patindex('%[^pattern]%','ddabcaabbeeabbr')</h3> 
<p>在此先说[]的用法，[]是指定某些特殊的字符。[^]除[]之外的字符串,[]这其中的每一个</p> 
<p>如：</p> 
<p>Symbol Meaning</p> 
<p>LIKE '5[%]' 5%</p> 
<p>LIKE '[_]n' _n</p> 
<p>LIKE '[a-cdf]' a, b, c, d, or f</p> 
<p>LIKE '[-acdf]' -, a, c, d, or f</p> 
<p>LIKE '[ [ ]' [</p> 
<p>LIKE ']' ]</p> 
<p>LIKE 'abc[_]d%' abc_d and abc_de</p> 
<p>LIKE 'abc[def]' abcd, abce, and abcf</p> 
<p>如：</p> 
<p>select patindex('%[d]%','rcrdsddddaadadffdr')</p> 
<p>返回4，[]中d在字符串rcrdsddddaadadffdr的第一次出现的位置。</p> 
<p>select patindex('%[cd]%','rcrdsdddrdaadadffdr')</p> 
<p>返回2，[]中c,d在其中一个的位置，返回最先出现的这个位置，c在此字符串里第一次出现位置是2，而d是4，结果取最先的那个。</p> 
<p>select patindex('%[sd]%','rcrdsdddrdaadadffdr')</p> 
<p>返回4，[]中c,d在其中一个的位置，返回最先出现的这个位置，s在此字符串里第一次出现位置是5，而d是4，结果取最先的那个。</p> 
<p>select patindex('%[^r]%','rrrdsdddrdaadadffdr')</p> 
<p>返回4，除[]中的字符串的匹配字符，第一次出现d不在[^r]里，所以就找到第一次这位。</p> 
<p>select patindex('%[^rd]%','rrrdsdddrdaadadffdr')</p> 
<p>返回5，除[]中的字符串的匹配字符，第一次出现s不在[^rd]里，所以就找到第一次这位。</p> 
<p>select patindex('%[^rsd]%','rrrdsdddrdaadadffdr')</p> 
<p>返回11，除[]中的字符串的匹配字符，第一次出现a不在[^rsd]里，所以就找到第一次这位。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4>  eg：去除括号及括号内内容（批量化处理）</h4> 
<pre class="has"><code class="language-sql">--&gt; 测试数据：#
if object_id('tempdb.dbo.#') is not null drop table #新建临时表
create table #(col varchar(46))
insert into #
select '重庆唯远实业有限公司(2009年01月05日)' union all
select '江苏苏美达船舶工程有限公司(2009年01月05日)' union all
select '上海启门机电有限公司(2009年01月04日)' union all
select '小洋人生物乳业集团有限公司(2009年01月04日)' union all
select '沈阳鼎冷机电设备有限公司(2009年01月04日)' union all
select '嘉柏(中国)国际货运代理有限公司(2008年12月31日)' union all
select '广州宝洁有限公司(2008年12月31日)' union all
select '烟台华科食品有限公司(2008年12月31日)' union all
select '艾来得机械(上海)有限公司(2008年12月31日)' union all
select '上海晓舟船舶配件有限公司(2008年12月31日)' union all
select '上海力弘包装器材有限公司(2008年12月31日)'


/*
------------------------------
重庆唯远实业有限公司
江苏苏美达船舶工程有限公司
上海启门机电有限公司
小洋人生物乳业集团有限公司
沈阳鼎冷机电设备有限公司
嘉柏(中国)国际货运代理有限公司
广州宝洁有限公司
烟台华科食品有限公司
艾来得机械(上海)有限公司
上海晓舟船舶配件有限公司
上海力弘包装器材有限公司
*/
</code></pre> 
<p>解决方案一：</p> 
<pre class="has"><code class="language-sql">select reverse(stuff(reverse(col), 1, charindex('(', reverse(col)), '')) from #
</code></pre> 
<p>解决方案二：</p> 
<pre class="has"><code class="language-sql">update tb
set col = reverse(substring(reverse(col) ,charindex('(',reverse(col)) + 1 , len(col)))
select * from tb</code></pre> 
<p>解决方案三：</p> 
<pre class="has"><code class="language-sql">select 
left(name,patindex('%([0-9][0-9][0-9][0-9]年%',name)-1) as name from [tb]
</code></pre> 
<p>解决方案四：</p> 
<pre class="has"><code class="language-sql">select left(col,len(col) - 13) from tb</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e2f1c9f6b423b71b69c9e93ff0d5b4c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows 下 python调用Qt C&#43;&#43;( PyQt5 &#43; sip4.19)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a3577349a4e522950090a517aa0a8eb7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript导出图片和数据到Excel</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>