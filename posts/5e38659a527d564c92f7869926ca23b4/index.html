<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>生成树协议（STP）及链路聚合 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="生成树协议（STP）及链路聚合" />
<meta property="og:description" content="目录 STP介绍STP 算法选择根网桥（Root Bridge）选择根端口（Root Ports）选择指端口（Designated Ports） BPDU（桥协议数据单元）PVST（按VLAN生成树）链路聚合 STP介绍 STP（Spanning Tree Protocol）是生成树协议的英文缩写，可应用于计算机网络中树形拓扑结构建立。
应用场景：网络中的环路，当网络形成一个环路时自动启动。
主要作用：逻辑上断开环路防止广播风暴；备份线路（当其中一条线路出现故障，断开的接口被激活重新启用，从而恢复通信）
工作原理：利用STP算法，计算出阻塞端口，断开端口从而形成无环结构。
STP 算法 选择根网桥（Root Bridge） （1）如何选择根网桥？
根据网桥ID（BID）选择根网桥，谁的优先级小，谁就是根桥。如果优先级相同，谁的MAC地址小谁就是根桥。BID=优先级&#43;mac地址
（2）什么是网桥ID（BID）？
每个网络只能有一个根桥，根桥具有最低的桥ID，根桥上的所有端口都是指定端口，选择根网桥的目的是为了给将生成的树形结构确定一个树根。（交换机默认优先级为：32768。设备中加上了vlan的值。如vlan10就变成32778）
（3）选择根网桥举例
选择根端口（Root Ports） （1）如何选择根端口？
在非根网桥上选择一个到根网桥最近的端口作为根端口
选择根端口的依据是：
根路径成本（cost值）【从端口出发到根桥】最低
直连网桥的网桥ID最小
直连网桥的端口ID最小
（2）什么是cost值？
根路径成本是网桥到根网桥的路径上所有链路的成本之和。
根路径成本表
（3）什么是端口ID
即端口优先级（默认128）&#43;端口编号
（4）选择根端口举例
选择指端口（Designated Ports） 选择指定端口的依据是：
在每个网段上，选择1个指定端口，根桥上的端口全是指定端口。
非根桥上的指定端口：
根路径成本【从非根桥到根桥】最低
端口所在的网桥的ID值较小
直连网桥的端口ID值较小
BPDU（桥协议数据单元） 交换机就是使用BPDU来交换STP信息，从而计算出最优化路径成本。BPDU（Bridge Protocol Data Unit）使用组播发送BPDU，组播地址为：01-80-c2-00-00-00。
BPDU分为2种类型：
配置BPDU － 用于生成树计算
拓朴变更通告（TCN）BPDU － 用于通告网络拓朴的变化
生成树端口状态
PVST（按VLAN生成树） pvst是Cisco私有的，为每个VLAN构造一棵生成树
是用来配置网络中比较稳定的交换机为根网桥，利用PVST实现网络的负载分担
配置命令
启用生成树：Switch(config)#spanning-tree vlan vlan-list 设置根网桥：Switch(config)#spanning-tree vlan vlan-list root primary | secondary -设置为primary后，优先级变成24576 -设置为secondary后， 优先级变成28672 修改网桥的优先级：Switch(config)#spanning-tree vlan vlan-list priority Bridge-priority -优先级的值为4096的倍数 修改端口成本：Switch(config-if)#spanning-tree vlan vlan-list cost cost 修改端口优先级：Switch(config-if)#spanning-tree vlan vlan-list port-priority priority 配置上行速链路：Switch(config)#spanning-tree uplinkfast 配置端口速链路：Switch(config-if)#spanning-tree portfast 查看生成树的配置：Switch#show spanning-tree 查看某个VLAN的生成树详细信息：Switch#show spanning-tree vlan vlan-id detail 链路聚合 链路聚合又称为端口聚合，端口捆绑，英文名porttrunking。是一种聚合多个物理接口 ( that ) 创建一个逻辑接口。你可以捆扎( bundle ) 八个单独的活动链接到一个信道端口，以提供更高的带宽和冗余。端口通道也负载平衡这些物理接口上的通信量。只要端口通道中的至少一个物理接口可操作，端口通道就可以保持运行。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5e38659a527d564c92f7869926ca23b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-16T20:31:12+08:00" />
<meta property="article:modified_time" content="2019-12-16T20:31:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">生成树协议（STP）及链路聚合</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#STP_2" rel="nofollow">STP介绍</a></li><li><a href="#STP__9" rel="nofollow">STP 算法</a></li><li><ul><li><a href="#Root_Bridge_11" rel="nofollow">选择根网桥（Root Bridge）</a></li><li><a href="#Root_Ports_18" rel="nofollow">选择根端口（Root Ports）</a></li><li><a href="#Designated_Ports_34" rel="nofollow">选择指端口（Designated Ports）</a></li></ul> 
  </li><li><a href="#BPDU_43" rel="nofollow">BPDU（桥协议数据单元）</a></li><li><a href="#PVSTVLAN_53" rel="nofollow">PVST（按VLAN生成树）</a></li><li><a href="#_74" rel="nofollow">链路聚合</a></li></ul> 
</div> 
<p></p> 
<h2><a id="STP_2"></a>STP介绍</h2> 
<p>STP（Spanning Tree Protocol）是生成树协议的英文缩写，可应用于计算机网络中树形拓扑结构建立。<br> 应用场景：网络中的环路，当网络形成一个环路时自动启动。<br> 主要作用：逻辑上断开环路防止广播风暴；备份线路（当其中一条线路出现故障，断开的接口被激活重新启用，从而恢复通信）<br> 工作原理：利用STP算法，计算出阻塞端口，断开端口从而形成无环结构。</p> 
<h2><a id="STP__9"></a>STP 算法</h2> 
<h3><a id="Root_Bridge_11"></a>选择根网桥（Root Bridge）</h3> 
<p>（1）如何选择根网桥？<br> 根据网桥ID（BID）选择根网桥，谁的优先级小，谁就是根桥。如果优先级相同，谁的MAC地址小谁就是根桥。<strong>BID=优先级+mac地址</strong><br> （2）什么是网桥ID（BID）？<br> 每个网络只能有一个根桥，根桥具有最低的桥ID，根桥上的所有端口都是指定端口，选择根网桥的目的是为了给将生成的树形结构确定一个树根。（交换机默认优先级为：32768。设备中加上了vlan的值。如vlan10就变成32778）<br> （3）选择根网桥举例<br> <img src="https://images2.imgbox.com/04/cc/y9IQYL58_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Root_Ports_18"></a>选择根端口（Root Ports）</h3> 
<p>（1）如何选择根端口？<br> 在非根网桥上选择一个到根网桥最近的端口作为根端口<br> 选择根端口的依据是：<br> 根路径成本（cost值）【从端口出发到根桥】最低<br> 直连网桥的网桥ID最小<br> 直连网桥的端口ID最小<br> （2）什么是cost值？<br> 根路径成本是网桥到根网桥的路径上所有链路的成本之和。<br> 根路径成本表<br> <img src="https://images2.imgbox.com/60/fd/OfhsV9Bf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f7/c7/Qy5ARMQe_o.png" alt="在这里插入图片描述"><br> （3）什么是端口ID<br> 即端口优先级（默认128）+端口编号<br> （4）选择根端口举例<br> <img src="https://images2.imgbox.com/91/97/Rbqd2jkm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Designated_Ports_34"></a>选择指端口（Designated Ports）</h3> 
<p>选择指定端口的依据是：<br> 在每个网段上，选择1个指定端口，根桥上的端口全是指定端口。<br> 非根桥上的指定端口：<br> 根路径成本【从非根桥到根桥】最低<br> 端口所在的网桥的ID值较小<br> 直连网桥的端口ID值较小<br> <img src="https://images2.imgbox.com/6b/5e/S2YeMsB4_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="BPDU_43"></a>BPDU（桥协议数据单元）</h2> 
<p>交换机就是使用BPDU来交换STP信息，从而计算出最优化路径成本。BPDU（Bridge Protocol Data Unit）使用组播发送BPDU，组播地址为：01-80-c2-00-00-00。</p> 
<p><strong>BPDU分为2种类型：</strong><br> 配置BPDU － 用于生成树计算<br> 拓朴变更通告（TCN）BPDU － 用于通告网络拓朴的变化<br> <img src="https://images2.imgbox.com/25/07/imAjtOmf_o.png" alt="在这里插入图片描述"><br> 生成树端口状态<br> <img src="https://images2.imgbox.com/73/70/gl2LeuBN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="PVSTVLAN_53"></a>PVST（按VLAN生成树）</h2> 
<p>pvst是Cisco私有的，为每个VLAN构造一棵生成树<br> 是用来配置网络中比较稳定的交换机为根网桥，利用PVST实现网络的负载分担<br> <strong>配置命令</strong></p> 
<pre><code>启用生成树：Switch(config)#spanning-tree vlan vlan-list
设置根网桥：Switch(config)#spanning-tree vlan vlan-list root primary | secondary
-设置为primary后，优先级变成24576
-设置为secondary后， 优先级变成28672
修改网桥的优先级：Switch(config)#spanning-tree vlan vlan-list priority Bridge-priority 
-优先级的值为4096的倍数
修改端口成本：Switch(config-if)#spanning-tree vlan vlan-list cost cost
修改端口优先级：Switch(config-if)#spanning-tree vlan vlan-list port-priority priority
配置上行速链路：Switch(config)#spanning-tree uplinkfast

配置端口速链路：Switch(config-if)#spanning-tree portfast
查看生成树的配置：Switch#show spanning-tree
查看某个VLAN的生成树详细信息：Switch#show spanning-tree vlan vlan-id detail
</code></pre> 
<h2><a id="_74"></a>链路聚合</h2> 
<p>链路聚合又称为端口聚合，端口捆绑，英文名porttrunking。是一种聚合多个物理接口 ( that ) 创建一个逻辑接口。你可以捆扎( bundle ) 八个单独的活动链接到一个信道端口，以提供更高的带宽和冗余。端口通道也负载平衡这些物理接口上的通信量。只要端口通道中的至少一个物理接口可操作，端口通道就可以保持运行。<br> <img src="https://images2.imgbox.com/6c/f0/OOrsyabA_o.png" alt="在这里插入图片描述"><br> <strong>channel-group 模式</strong><br> PAgP 是 Cisco私有，只能在 Cisco Switch 上设定，PAgP 有两个模式，分別是 Desirable 与 Auto当 PAgP 成功建立 EtherChannel 后，PAgP Message 会继续定时传送去维持 EtherChannel。</p> 
<table><thead><tr><th>状态</th><th>Desirable</th><th>Auto</th><th>描述</th></tr></thead><tbody><tr><td>Desirable</td><td>√</td><td>√</td><td>主动发送PAgP报文</td></tr><tr><td>Auto</td><td>√</td><td>x</td><td>被动发送PAgP报文</td></tr><tr><td>On</td><td></td><td></td><td>手动设置，需要两边都设置</td></tr></tbody></table> 
<p>LACP 是 IEEE Standard</p> 
<table><thead><tr><th>状态</th><th>Active</th><th>Passive</th><th>描述</th></tr></thead><tbody><tr><td>Active</td><td>√</td><td>√</td><td>主动发送LACP报文</td></tr><tr><td>Passive</td><td>√</td><td>x</td><td>主动接收LACP报文</td></tr></tbody></table> 
<p><strong>channel-group说明</strong><br> （1）Cisco最多允许EtherChannel绑定8个端口；如果是百兆网络，总带宽可达1.6Gbit/s；如果是千兆网络，总带宽可达16Gbit/s。<br> （2）EtherChannel不支持10M端口；<br> （3）EtherChannel编号只在本地有效，链路两端的编号可以不一样；<br> （4）EtherChannel默认使用PAgP协议；<br> （5）EtherChannel默认情况下是基于源MAC地址的负载平衡；<br> （6）一个EtherChannel内所有的端口都必须具有相同的端口速率和双工模式，LACP只能是全双工模式；<br> （7）channel-group接口会自动继承最小物理接口，或最先配置的接口模式；<br> （8）cisco的交换机不仅可以支持第二层EtherChannel,还可以支持第三层EtherChannel。</p> 
<p><strong>配置端口聚合</strong></p> 
<pre><code>Switch(config)#int port-channel 1  #开启聚合端口，端口编号为1
Switch(config-if)#switchport mode trunk 
Switch(config)#int range f0/1-2 #同时选中1，2两个接口
Switch(config-if-range)#channel-group 1 mode on  #将1,2接口加入到聚合端口1中
</code></pre> 
<p><strong>配置流量均衡</strong></p> 
<pre><code>Switch(config)#int f0/1
Switch(config-if)#spanning-tree vlan 10 port-priority 16
Switch(config-if)#spanning-tree vlan 20 port-priority 32
Switch(config)#int f0/2
Switch(config-if)#spanning-tree vlan 10 port-priority 32
Switch(config-if)#spanning-tree vlan 20 port-priority 16
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8aacd5f0d098ff16a240674893246805/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大疆MANIFOLD 2（Jetson TX2）配置总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eb608979b962252add2c81397a79ae28/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MongoDB 未授权访问漏洞复现学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>