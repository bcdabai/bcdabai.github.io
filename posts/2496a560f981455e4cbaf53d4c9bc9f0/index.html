<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深度理解 Spring AOP - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深度理解 Spring AOP" />
<meta property="og:description" content="一、什么是AOP(面向切面编程)？🍉 AOP 为 Aspect Oriented Programming 的缩写，意思为面向切面编程，是通过预编译方式 和运行期 动态代理 实现程序功能的统一维护的一种技术。
AOP （面向切面编程）是 OOP（面向对象） 的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程 的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。
二、AOP 的作用及其优势🍉 作用：在程序运行期间，在不修改源码的情况下对方法进行功能增强
优势：减少重复代码，提高开发效率，并且便于维护
三、AOP 的底层实现🍉 实际上，AOP 的底层是通过 Spring 提供的的动态代理技术实现 的。在运行期间，Spring通过动态代理技术动态的生成代理对象，代理对象方法执行时进行增强功能的介入，在去调用目标对象的方法，从而完成功能的增强。
动态代理的作用：
1）在目标类源代码不改变的情况下，增加功能。2）减少代码的重复3）专注业务逻辑代码4）解耦合，让你的业务功能和日志，事务非业务功能分离。 四、AOP 相关概念🍉 Spring 的 AOP 实现底层就是对动态代理的代码进行了封装 ，封装后我们只需要对需要关注的部分进行代码编写，并通过配置的方式完成指定目标的方法增强。
在正式讲解 AOP 的操作之前，我们必须理解 AOP 的相关术语，常用的术语如下：
切面（Aspect）
一个切面就是一个代理对象= 要为那些类生成代理&#43;要添加的额外功能是那些 切入点（pointcut）：将来要为那些类生成代理对象通知/ 增强（advice）：就是要添加的额外功能 生活案例：给面包之间涂果酱
注意：切面（Aspect）=切入点（pointcut）&#43;通知点（advice，额外功能）
AOP中的（面向切面编程）通知
前置通知：目标方法之前的额外功能 MethodBeforeAdvice 环绕通知：它是spring框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式 MethodInterceptor（Interceptor [ɪntəˈsɛptə]拦截器）
后置通知：目标方法之后的额外功能 AfterReturningAdvice（returning[rɪˈtɜːrnɪŋ]）
异常通知：执行异常的额外功能 ThrowsAdvice
最终通知：一定执行的额外功能
Target(目标对象)：代理的目标对象代理（Proxy[ˈprɑːksi]）:一个类被AOP注入增强后，就产生一个结果代理类连接点（joinPoint）:所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法(额外功能)，因为spring只支持方法类型的连接点 五、切面编程步骤🍉 1、五种通知类🥝 AOP 切面=切入点&#43;通知
前置通知：MethodBeforeAdvice
后置通知:AfterReturnAdvice
环绕通知:MethodInterceptor
异常通知:ThrowsAdvice(throw [θroʊz])
最终通知" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2496a560f981455e4cbaf53d4c9bc9f0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-22T08:01:24+08:00" />
<meta property="article:modified_time" content="2023-07-22T08:01:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深度理解 Spring AOP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="AOP_0"></a>一、什么是AOP(面向切面编程)？🍉</h2> 
<p>AOP 为 Aspect Oriented Programming 的缩写，意思为面向切面编程，是通过预编译方式 和运行期 动态代理 实现程序功能的统一维护的一种技术。</p> 
<p>AOP （面向切面编程）是 OOP（面向对象） 的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程 的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p> 
<h2><a id="AOP__6"></a>二、AOP 的作用及其优势🍉</h2> 
<p>作用：在程序运行期间，在不修改源码的情况下对方法进行功能增强</p> 
<p>优势：减少重复代码，提高开发效率，并且便于维护</p> 
<h2><a id="AOP__11"></a>三、AOP 的底层实现🍉</h2> 
<p>实际上，AOP 的底层是通过 Spring 提供的的动态代理技术实现 的。在运行期间，Spring通过动态代理技术动态的生成代理对象，代理对象方法执行时进行增强功能的介入，在去调用目标对象的方法，从而完成功能的增强。</p> 
<p><strong>动态代理的作用</strong>：</p> 
<ul><li>1）在目标类源代码不改变的情况下，增加功能。</li><li>2）减少代码的重复</li><li>3）专注业务逻辑代码</li><li>4）解耦合，让你的业务功能和日志，事务非业务功能分离。</li></ul> 
<h2><a id="AOP__21"></a>四、AOP 相关概念🍉</h2> 
<p>Spring 的 AOP 实现底层就是对动态代理的代码进行了封装 ，封装后我们只需要对需要关注的部分进行代码编写，并通过配置的方式完成指定目标的方法增强。</p> 
<p>在正式讲解 AOP 的操作之前，我们必须理解 AOP 的相关术语，常用的术语如下：</p> 
<ol><li>切面（Aspect）<br> 一个切面就是一个代理对象= 要为那些类生成代理+要添加的额外功能是那些</li></ol> 
<p><img src="https://images2.imgbox.com/00/a8/lYs7Nuwp_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>切入点（pointcut）：将来要为那些类生成代理对象</li><li>通知/ 增强（advice）：就是要添加的额外功能</li></ol> 
<p>生活案例：给面包之间涂果酱<br> <img src="https://images2.imgbox.com/b6/eb/BnrsZeT9_o.png" alt="在这里插入图片描述"></p> 
<p>注意：切面（Aspect）=切入点（pointcut）+通知点（advice，额外功能）</p> 
<p><img src="https://images2.imgbox.com/62/ef/j56HQcGj_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>AOP中的（面向切面编程）通知<br> 前置通知：目标方法之前的额外功能 MethodBeforeAdvice</li></ol> 
<p>环绕通知：它是spring框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式 MethodInterceptor（Interceptor [ɪntəˈsɛptə]拦截器）</p> 
<p>后置通知：目标方法之后的额外功能 AfterReturningAdvice（returning[rɪˈtɜːrnɪŋ]）</p> 
<p>异常通知：执行异常的额外功能 ThrowsAdvice</p> 
<p>最终通知：一定执行的额外功能</p> 
<p><img src="https://images2.imgbox.com/7b/35/5tr0P9vt_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>Target(目标对象)：代理的目标对象</li><li>代理（Proxy[ˈprɑːksi]）:一个类被AOP注入增强后，就产生一个结果代理类</li><li>连接点（joinPoint）:所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法(额外功能)，因为spring只支持方法类型的连接点</li></ol> 
<h2><a id="_63"></a>五、切面编程步骤🍉</h2> 
<h3><a id="1_65"></a>1、五种通知类🥝</h3> 
<p>AOP 切面=切入点+通知</p> 
<p>前置通知：MethodBeforeAdvice<br> 后置通知:AfterReturnAdvice<br> 环绕通知:MethodInterceptor<br> 异常通知:ThrowsAdvice(throw [θroʊz])<br> 最终通知</p> 
<p>通知的配置语法：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>aop <span class="token operator">:</span> 通知类型 method<span class="token operator">=</span>“切面类中方法名” pointcut<span class="token operator">=</span>“切点表达式"<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>通知类型<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>切点表达式的抽取</li></ul> 
<p>当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用 pointcut-ref 属性代替 pointcut 属性来引用抽取后的切点表达式。</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>引用myAspect的<span class="token class-name">Bean</span>为切面对象<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>aop<span class="token operator">:</span>aspect ref<span class="token operator">=</span><span class="token string">"myAspect"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>pointcut id<span class="token operator">=</span><span class="token string">"myPointcut"</span> expression<span class="token operator">=</span><span class="token string">"execution(* com.tjcu.aop.*.*(..))"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>before method<span class="token operator">=</span><span class="token string">"before"</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"myPointcut"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>before<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>aspect<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
</code></pre> 
<p>aop植入的配置</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>aop<span class="token operator">:</span>aspect ref<span class="token operator">=</span>“切面类”<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>before method<span class="token operator">=</span>“通知方法名称” pointcut<span class="token operator">=</span>“切点表达式"<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>before<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>aspect<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
</code></pre> 
<p>切点表达式的写法：</p> 
<pre><code class="prism language-java"><span class="token function">execution</span><span class="token punctuation">(</span><span class="token punctuation">[</span>修饰符<span class="token punctuation">]</span> 返回值类型 包名<span class="token punctuation">.</span>类名<span class="token punctuation">.</span>方法名<span class="token punctuation">(</span>参数<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2AOP_111"></a>2、AOP的开发步骤🥝</h3> 
<p>1、开发目标类</p> 
<p>2、开发通知类，确定额外功能</p> 
<p>3、管理通知类</p> 
<p>4、配置切入点 确定要为那些类添加额外功能</p> 
<p>5、将目标类和切面类的对象创建权交给 spring</p> 
<p>6、组装切面 切入点+通知（额外功能）</p> 
<h3><a id="3AOP_125"></a>3、AOP编程所需要的依赖🥝</h3> 
<blockquote> 
 <p>这里是引用引入依赖<br> spring-aop<br> spring-expression<br> spring-aspects</p> 
</blockquote> 
<h2><a id="AOP_133"></a>六、AOP实现前置通知案例🍉</h2> 
<h3><a id="1_134"></a>1、目标接口类🥝</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_143"></a>2、目标实现类（核心功能）🥝</h3> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @Description:目标对象
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CityServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CityService</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//前置通知：System.out.println("嘻嘻哈哈");</span>

        <span class="token comment">//执行核心的业务逻辑 调用Dao</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录调用Dao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//前置通知：System.out.println("嘻嘻哈哈");</span>
        <span class="token comment">//执行核心的业务逻辑 调用Dao</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"添加调用Dao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_168"></a>3、前置通知（额外功能）动态代理代码🥝</h3> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @Description: 通知类。额外功能
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeforeAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">MethodBeforeAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 额外功能书写的方法
     * 参数1：代理对象当前调用的方法
     * 参数2：当前代理对象调用的方法的参数
     * 参数3：目标对象（被代理的对象）
     * @param method
     * @param objects
     * @param o
     * @throws Throwable
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"嘻嘻哈哈"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_spring_193"></a>4、将目标类和切面类的对象创建权交给 spring🥝</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>管理目标对象<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"before.CityServiceImpl"</span> id<span class="token operator">=</span><span class="token string">"cityService"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>管理通知类 动态代理实现<span class="token constant">AOP</span><span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"myBeforeAdvice"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"before.MyBeforeAdvice"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="5_springxml__202"></a>5、在 spring.xml 中配置织入关系（前置功能）🥝</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>组装切面<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置切入点
    id<span class="token operator">:</span>切入点的唯一标识
    expression<span class="token operator">:</span>切入点表达式，为那些类添加额外功能
     <span class="token function">execution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 切入点表达式的一种 精确到要添加到额外功能的方法
     <span class="token operator">*</span>：通配
     空格：
     <span class="token class-name"><span class="token namespace">before<span class="token punctuation">.</span></span>CityServiceImpl</span><span class="token punctuation">.</span>*：所有方法
     <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>：所有参数
    <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>pointcut id<span class="token operator">=</span><span class="token string">"pc1"</span> expression<span class="token operator">=</span><span class="token string">"execution(* before.CityServiceImpl.*(..))"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>组装切面<span class="token operator">=</span>切入点<span class="token operator">+</span>通知
      advice<span class="token operator">-</span>ref<span class="token operator">:</span>通知的id
      pointcut<span class="token operator">-</span>ref<span class="token operator">:</span>切入点的id
    <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>advisor advice<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"myBeforeAdvice"</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"pc1"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>advisor<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="6_225"></a>6、测试代码🥝</h3> 
<pre><code class="prism language-java">  <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethodBeforeAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//启动工厂</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"before/spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取组件 目标对象就是代理对象</span>
        <span class="token class-name">CityService</span> cityService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CityService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"cityService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//目标对象就是代理对象  class com.sun.proxy.$Proxy4</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cityService<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        
        <span class="token comment">//调用方法，通过代理类调用目标类</span>
        cityService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>注意：获取组件时，目标对象就是代理对象</p> 
<p><img src="https://images2.imgbox.com/cf/d7/MtzAOXNr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Spring_248"></a>七、Spring中的环绕通知案例🍉</h2> 
<h3><a id="1dao_249"></a>1、dao层接口🥝</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentDao</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 登录
     * @param name
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 分页
     * @param name
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pageShow</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2dao_268"></a>2、dao层实现类🥝</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentDao</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//循环10000次</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数据库实现登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pageShow</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//循环10000次</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数据库实现分页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_295"></a>3、目标接口类🥝</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 登录
     * @param name
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 分页
     * @param name
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pageShow</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_314"></a>4、目标实现类🥝</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentService</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">StudentDao</span> studentDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentDao</span><span class="token punctuation">(</span><span class="token class-name">StudentDao</span> studentDao<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentDao <span class="token operator">=</span> studentDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录日志"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      studentDao<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pageShow</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"分页日志"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> studentDao<span class="token punctuation">.</span><span class="token function">pageShow</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5_340"></a>5、环绕通知🥝</h3> 
<pre><code class="prism language-java">核心方法： <span class="token class-name">Object</span> proceed <span class="token operator">=</span> methodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 放行
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentAroundAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 参数 内部封装者当前的代理对象 方法的参数，执行方法等
     *
     * @param methodInvocation
     * @return
     * @throws Throwable
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> methodInvocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.控制事务</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"控制事务"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//method Invocation 方法调用</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前调用方法的名字"</span> <span class="token operator">+</span> methodInvocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//arguments参数 methodInvocation:方法调用</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前的参数为："</span> <span class="token operator">+</span> methodInvocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//记录当前的时间 单位毫秒</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用查询的数据库"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//放行，执行目标方法 proceed：继续做proceed</span>
        <span class="token class-name">Object</span> proceed <span class="token operator">=</span> methodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//记录结束的时间 单位毫秒</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dao执行所用时间"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> proceed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_spring_380"></a>6、将目标类和切面类的对象创建权交给 spring🥝</h3> 
<pre><code class="prism language-java">  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>管理dao组件<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"studentDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.tjcu.dao.StudentDaoImpl"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>管理<span class="token class-name">Service</span>组件<span class="token operator">/</span>目标对象<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"studentService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.tjcu.service.StudentServiceImpl"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>注入值<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"studentDao"</span> ref<span class="token operator">=</span><span class="token string">"studentDao"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>管理通知组件<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"studentAroundAdvice"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.tjcu.advice.StudentAroundAdvice"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="7_applicationContextxml_aop_396"></a>7、在 applicationContext.xml 中配置织入关系,aop相关配置🥝</h3> 
<pre><code class="prism language-java"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>aop相关配置  切面<span class="token operator">=</span>切点<span class="token operator">+</span>环绕通知<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>切入点 execution<span class="token operator">:</span><span class="token punctuation">[</span>eksɪˈkjuːʃn<span class="token punctuation">]</span>执行<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>pointcut id<span class="token operator">=</span><span class="token string">"pointcut"</span> expression<span class="token operator">=</span><span class="token string">"execution(* com.tjcu.service.StudentServiceImpl.*(..))"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>组装切面  advisor<span class="token punctuation">[</span> <span class="token punctuation">[</span>ædˈvaɪzər<span class="token punctuation">]</span><span class="token punctuation">]</span>：顾问  advice<span class="token operator">-</span>ref<span class="token operator">:</span>通知  pointcut<span class="token operator">-</span>ref<span class="token operator">:</span>切入点<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token operator">:</span>advisor advice<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"studentAroundAdvice"</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"pointcut"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>advisor<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="8_408"></a>8、测试代码🥝</h3> 
<pre><code class="prism language-java">  <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">AroundAdviceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//启动工厂</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"com/tjcu/Spring/ApplicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取组件 目标对象就是代理对象</span>
        <span class="token class-name">StudentService</span> studentService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">StudentService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"studentService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用方法，通过代理类调用目标类</span>
        studentService<span class="token punctuation">.</span><span class="token function">pageShow</span><span class="token punctuation">(</span><span class="token string">"通过代理类调用调用目标类"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b7ce77382fc9b3e2fc6e89f7f683652/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据库表查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49e1cc2f6acd23bc1556854fd968d1c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">docker和k8s、nginx、rpc、kafka的学习介绍和实战以及学习理念</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>