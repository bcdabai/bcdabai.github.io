<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gerrit用户代码审核提交流程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gerrit用户代码审核提交流程" />
<meta property="og:description" content="gerrit代码审核提交流程 简介注册gerrit用户注册账户邮箱配置秘钥1.获取秘钥2.设置秘钥 开发人员1.拉取项目2.修改提交项目3.增加审核人员审核结果 审核人员审核提交查看审核确认 QAQ总结1.提交被打回2.提交后发生冲突3.push服务端是失败4.推送出现权限问题 简介 Gerrit，一种免费、开放源代码的代码审查软件，使用网页界面。利用网页浏览器，同一个团队的软件程序员，可以相互审阅彼此修改后的程序代码，决定是否能够提交，退回或者继续修改。
本文主要记录一个gerrit的用户如何拉取代码，并做修改提交，等待审核的一个过程。
如果你是一个刚接触gerrit的用户使用者，可以继续往下阅读。如果你已经是一名old bird可以忽略~~~
注册gerrit用户 注册Gerrit账户，需给联系Gerrit管理者获取账号。
假如你已经有了账号，请登录你的gerrit服务。
注册账户邮箱 一旦你登录了账号，并且没有设置过邮箱，那么请注册：
用户注册邮箱请参考这里
配置秘钥 如果你是一个新用户，请将你工作的本机秘钥添加到你的gerrit账号下，以便可以正确拉取推送项目。
1.获取秘钥 Linux系统 # 查看当前用户是否存在秘钥, 如果不存在需要通过ssh-keygen进行生成 # 秘钥生成 ssh-keygen -t rsa -C &#34;youemail@xxx.com&#34; # 复制秘钥 cat ~/.ssh/id_rsa.pub 如果提示权限问题：可能是版本级别太高，通过以下方式生产秘钥 ssh-key -t ed25519 -C &#34;youemail@xxxx.com&#34; Windows系统
进入C:\Users\USER.ssh目录确认是否有秘钥， 如果没有通过以下命令生成 # 打开CMD DOS生成秘钥 ssh-keygen -t rsa -C &#34;youemail@xxx.com&#34; 拷贝id_rsa.pub公钥。
2.设置秘钥 当获取到了公钥之后，登录到gerrit服务，将公钥添加到gerrit账户中：
复制公钥：
开发人员 1.拉取项目 用户开发者一旦获取到自己的gerrit账号后，就已经有了自己相应的权限了。
开发者可以通过BROWES-&gt;Respositories中查看自己账号下挂载了的项目情况。
我们可以看到下图显示了只有一个tinyalsa的项目
那么我们如何拉取项目呢。 只有点击tinyalsa进入界面就可以看到有两种拉取方式：
with commit-msg hook
commit-msg 是一个脚本文件，该脚本对于 Gerrit 的使用非常重要，使用 Gerrit 必须要有此脚本，否则在本地的修改版本无法提交至 Gerrit 中，会报错：missing change-id in commmit message footer，表示该版本提交没有 change-id。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a9716d2ea6dd4b4295591e0ce91bf835/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-10T15:51:13+08:00" />
<meta property="article:modified_time" content="2023-01-10T15:51:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gerrit用户代码审核提交流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>gerrit代码审核提交流程</h4> 
 <ul><li><a href="#_1" rel="nofollow">简介</a></li><li><a href="#gerrit_7" rel="nofollow">注册gerrit用户</a></li><li><a href="#_11" rel="nofollow">注册账户邮箱</a></li><li><a href="#_15" rel="nofollow">配置秘钥</a></li><li><ul><li><a href="#1_18" rel="nofollow">1.获取秘钥</a></li><li><a href="#2_40" rel="nofollow">2.设置秘钥</a></li></ul> 
  </li><li><a href="#_44" rel="nofollow">开发人员</a></li><li><ul><li><a href="#1_45" rel="nofollow">1.拉取项目</a></li><li><a href="#2_73" rel="nofollow">2.修改提交项目</a></li><li><a href="#3_141" rel="nofollow">3.增加审核人员</a></li><li><a href="#_155" rel="nofollow">审核结果</a></li></ul> 
  </li><li><a href="#_164" rel="nofollow">审核人员</a></li><li><ul><li><a href="#_167" rel="nofollow">审核提交查看</a></li><li><a href="#_172" rel="nofollow">审核确认</a></li></ul> 
  </li><li><a href="#QAQ_183" rel="nofollow">QAQ总结</a></li><li><ul><li><a href="#1_184" rel="nofollow">1.提交被打回</a></li><li><a href="#2_192" rel="nofollow">2.提交后发生冲突</a></li><li><a href="#3push_209" rel="nofollow">3.push服务端是失败</a></li><li><a href="#4_270" rel="nofollow">4.推送出现权限问题</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>简介</h2> 
<p>Gerrit，一种免费、开放源代码的代码审查软件，使用网页界面。利用网页浏览器，同一个团队的软件程序员，可以相互审阅彼此修改后的程序代码，决定是否能够提交，退回或者继续修改。</p> 
<p>本文主要记录一个gerrit的用户如何拉取代码，并做修改提交，等待审核的一个过程。<br> 如果你是一个刚接触gerrit的用户使用者，可以继续往下阅读。如果你已经是一名old bird可以忽略~~~</p> 
<h2><a id="gerrit_7"></a>注册gerrit用户</h2> 
<p>注册Gerrit账户，需给联系Gerrit管理者获取账号。<br> 假如你已经有了账号，请登录你的gerrit服务。</p> 
<h2><a id="_11"></a>注册账户邮箱</h2> 
<p>一旦你登录了账号，并且没有设置过邮箱，那么请注册：<br> 用户注册邮箱<a href="https://blog.csdn.net/sevenjoin/article/details/118189159">请参考这里</a></p> 
<h2><a id="_15"></a>配置秘钥</h2> 
<p>如果你是一个新用户，请将你工作的本机秘钥添加到你的gerrit账号下，以便可以正确拉取推送项目。</p> 
<h3><a id="1_18"></a>1.获取秘钥</h3> 
<ul><li>Linux系统</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 查看当前用户是否存在秘钥, 如果不存在需要通过ssh-keygen进行生成</span>
<span class="token comment"># 秘钥生成</span>
ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"youemail@xxx.com"</span>
<span class="token comment"># 复制秘钥</span>
<span class="token function">cat</span> ~/.ssh/id_rsa.pub

如果提示权限问题：可能是版本级别太高，通过以下方式生产秘钥
ssh-key <span class="token parameter variable">-t</span> ed25519 <span class="token parameter variable">-C</span> <span class="token string">"youemail@xxxx.com"</span>
</code></pre> 
<ul><li>Windows系统<br> 进入C:\Users\USER.ssh目录确认是否有秘钥， 如果没有通过以下命令生成</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 打开CMD DOS生成秘钥</span>
ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"youemail@xxx.com"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/3d/rf8T4OZn_o.png" alt="在这里插入图片描述">拷贝id_rsa.pub公钥。</p> 
<h3><a id="2_40"></a>2.设置秘钥</h3> 
<p>当获取到了公钥之后，登录到gerrit服务，将公钥添加到gerrit账户中：<br> <img src="https://images2.imgbox.com/6d/da/Ah0NMC20_o.png" alt="在这里插入图片描述">复制公钥：<br> <img src="https://images2.imgbox.com/9e/8c/39GWlq7i_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_44"></a>开发人员</h2> 
<h3><a id="1_45"></a>1.拉取项目</h3> 
<p>用户开发者一旦获取到自己的gerrit账号后，就已经有了自己相应的权限了。<br> 开发者可以通过BROWES-&gt;Respositories中查看自己账号下挂载了的项目情况。<br> 我们可以看到下图显示了只有一个<strong>tinyalsa</strong>的项目<br> <img src="https://images2.imgbox.com/bd/a6/JN4kNA7D_o.png" alt="在这里插入图片描述">那么我们如何拉取项目呢。 只有点击tinyalsa进入界面就可以看到有两种拉取方式：</p> 
<ul><li> <p>with commit-msg hook<br> commit-msg 是一个脚本文件，该脚本对于 Gerrit 的使用非常重要，使用 Gerrit 必须要有此脚本，否则在本地的修改版本无法提交至 Gerrit 中，会报错：missing change-id in commmit message footer，表示该版本提交没有 change-id。<br> 所以我们必须使用这一种方式，不然无法得到审核。</p> </li><li> <p>without commit-msg hook<br> 这一种也是我们常用的git克隆方式，应该很熟悉。 如果项目被设置了权限，该方法是无法进行修改提交的，必须拉取commit-msg hook脚本才行</p> </li></ul> 
<p><img src="https://images2.imgbox.com/21/a4/ygjCn7Sp_o.png" alt="在这里插入图片描述"></p> 
<p>到这里，开始克隆代码</p> 
<pre><code class="prism language-bash"><span class="token comment"># 我们先创建一个测试目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/mtk/test_gerrit/own/user2
<span class="token comment"># 开始clone</span>
<span class="token function">git</span> clone <span class="token string">"ssh://test_user2@10.66.xxx.xx:29418/tinyalsa"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">scp</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-P</span> <span class="token number">29418</span> test_user2@10.66.xxx.xx:hooks/commit-msg <span class="token string">"tinyalsa/.git/hooks/"</span>
<span class="token builtin class-name">cd</span> tinyalsa
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$ <span class="token function">ls</span>
Android.bp  MODULE_LICENSE_BSD  NOTICE  README  include  mixer.c  pcm.c  tinycap.c  tinyhostless.c  tinymix.c  tinypcminfo.c  tinyplay.c
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$
</code></pre> 
<h3><a id="2_73"></a>2.修改提交项目</h3> 
<p>我们那到了代码之后， 修改和提交完全和git的操作一样。<br> 如下，我们对README进行修改并提交：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 修改README，增加test code review by user2 modfiy</span>
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$ <span class="token function">vi</span> README
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$ <span class="token function">git</span> <span class="token function">add</span> README
<span class="token comment"># 提交到版本库</span>
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"test code view user2"</span>
<span class="token punctuation">[</span>master 19d61bc<span class="token punctuation">]</span> <span class="token builtin class-name">test</span> code view user2
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
<span class="token comment"># 推送到远程仓 </span>
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$ <span class="token function">git</span> push origin HEAD:refs/for/master
Enumerating objects: <span class="token number">5</span>, done.
Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, done.
Delta compression using up to <span class="token number">48</span> threads
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">359</span> bytes <span class="token operator">|</span> <span class="token number">359.00</span> KiB/s, done.
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">2</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
remote: Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>
remote: Processing changes: refs: <span class="token number">1</span>, new: <span class="token number">1</span>, <span class="token keyword">done</span>
remote:
remote: SUCCESS
remote:
remote:   http://10.66.xxx.xx:8081/c/tinyalsa/+/41 <span class="token builtin class-name">test</span> code view user2 <span class="token punctuation">[</span>NEW<span class="token punctuation">]</span>
remote:
To ssh://localhost:29418/tinyalsa
 * <span class="token punctuation">[</span>new reference<span class="token punctuation">]</span>   HEAD -<span class="token operator">&gt;</span> refs/for/master
release@release:~/mtk/test_gerrit/own/user2/tinyalsa$
</code></pre> 
<p>以上开发者有没有注意到最后推送到远程仓用的是</p> 
<pre><code class="prism language-bash"><span class="token comment"># 用的是</span>
<span class="token function">git</span> push origin HEAD:refs/for/master  
<span class="token comment"># 而不是我们常用的</span>
<span class="token function">git</span> push origin master or <span class="token function">git</span> push  
</code></pre> 
<p>那是因为我们clone with commit-msg hook，推送代码必须得到审核，不经过审核的代码是没有权限直接推送到远程仓的。<br> HEAD:refs/for/master - 就是将本地HEAD推送到refs/for/master这个临时仓中待审核， 审核通过后自动推送到远程仓中并同步到gitlab远程服务器中。</p> 
<ul><li>错误的做法，将会得到提示</li></ul> 
<pre><code class="prism language-bash">release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">git</span> push origin HEAD:refs/for/master
Enumerating objects: <span class="token number">5</span>, done.
Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, done.
Delta compression using up to <span class="token number">48</span> threads
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">311</span> bytes <span class="token operator">|</span> <span class="token number">311.00</span> KiB/s, done.
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">2</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
remote: Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>
remote: Processing changes: refs: <span class="token number">1</span>, <span class="token keyword">done</span>
remote: ERROR: commit c8d5423: missing Change-Id <span class="token keyword">in</span> message footer
remote:
remote: Hint: to automatically insert a Change-Id, <span class="token function">install</span> the hook:
remote:   <span class="token assign-left variable">gitdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> rev-parse --git-dir<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token function">scp</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-P</span> <span class="token number">29418</span> test_user2@10.66.xx0.xx:hooks/commit-msg <span class="token variable">${gitdir}</span>/hooks/
remote: and <span class="token keyword">then</span> amend the commit:
remote:   <span class="token function">git</span> commit <span class="token parameter variable">--amend</span> --no-edit
remote: Finally, push your changes again
remote:
To ssh://10.66.xxx.xx:29418/tinyalsa
 <span class="token operator">!</span> <span class="token punctuation">[</span>remote rejected<span class="token punctuation">]</span> HEAD -<span class="token operator">&gt;</span> refs/for/master <span class="token punctuation">(</span>commit c8d5423: missing Change-Id <span class="token keyword">in</span> message footer<span class="token punctuation">)</span>
error: failed to push some refs to <span class="token string">'ssh://10.66.xxx.xx:29418/tinyalsa'</span>

</code></pre> 
<h3><a id="3_141"></a>3.增加审核人员</h3> 
<p>当代码正确提交到分支 refs/for/* 后，需要登录Gerrit界面为刚才的提交添加相应的审核者。</p> 
<p>1.这时我们登录到gerrit账户后，通过YOUR-&gt;Changer就可以看到刚才的提交记录：</p> 
<p><img src="https://images2.imgbox.com/28/82/XWtc3UBA_o.png" alt="在这里插入图片描述"></p> 
<p>2.查看状态，发现有一条需要被审核：<br> <img src="https://images2.imgbox.com/f5/7d/42sVTBwL_o.png" alt="在这里插入图片描述">3. 点击进去设置审核者<br> <img src="https://images2.imgbox.com/27/2b/Px75tqGp_o.png" alt="在这里插入图片描述">如此，我们增加了一个gerrit的账号进行审核。<br> <img src="https://images2.imgbox.com/fa/bc/Sq0MdEfL_o.png" alt="在这里插入图片描述">这样我就等待审核就可以了，如果项目提交顺利通过该过程就结束了。<br> 如果审核被打回，那我们就需要重新修改在提交。</p> 
<h3><a id="_155"></a>审核结果</h3> 
<p>当一个提交被审核者审批之后，会有相应的邮件通知，或者通过gerrit WebUI进行查看状态。<br> 主要有以下几个状态：</p> 
<ul><li>Active 等待审核者审核</li><li>Ready to submit 审核者已经审核，但还 没有提交到远程仓</li><li>Merge 审核者已经审核，并同意推送远程仓</li><li>abandoned 审核者驳回</li></ul> 
<h2><a id="_164"></a>审核人员</h2> 
<p>一旦开发者提交了审核，相应的审核人员将会接收到邮件提示通知，或者通过YOUR-&gt;Changes-&gt;Incomming reviews查看有待审核记录并做相应的审批。</p> 
<h3><a id="_167"></a>审核提交查看</h3> 
<ul><li>邮件通知<br> <img src="https://images2.imgbox.com/63/b2/wzcMggxi_o.png" alt="在这里插入图片描述"></li><li>gerrit账号查看<br> <img src="https://images2.imgbox.com/d0/23/1wPf84ek_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="_172"></a>审核确认</h3> 
<p>以上知道了有哪些待审核的提交之后，我们就可以针对这些提交做批示。</p> 
<p>在Incomming reviews中选择一个待提交的申请，点击进入：<br> 我们选择<strong>test code view user2</strong>这个提交：<br> <img src="https://images2.imgbox.com/2f/c1/1U49H1MG_o.png" alt="在这里插入图片描述"><br> 审核者认为可以通过审核，可以点击右上角 <strong>CODE-REVIEW+2</strong>确认通过审核了。同时左上角的状态也将跟着变成Active-&gt;Ready to submit. 同时状态的改变都会有邮件通知。<br> <img src="https://images2.imgbox.com/95/b8/Io8QQ0JT_o.png" alt="在这里插入图片描述">最后由审核者确认SUBMIT同意合并，一旦合并将会同步到gitlab远程服务器中。<br> <img src="https://images2.imgbox.com/43/97/ZeG7txk8_o.png" alt="在这里插入图片描述"><br> 登录gitlab进行确认一下，确实已经被提交了：<br> <img src="https://images2.imgbox.com/bb/6c/8KhYsf6E_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="QAQ_183"></a>QAQ总结</h2> 
<h3><a id="1_184"></a>1.提交被打回</h3> 
<p>当开发者的一个提交被审核者打回了，怎么办？<br> 主要分两种情况：</p> 
<ul><li> <p>只提交了一个commitA，被审核者驳回，本地没有其他提交</p> </li><li> <p>已经提交了一个commitA， 之后又提交了commitB， 但是commitA被审核者打回</p> </li></ul> 
<h3><a id="2_192"></a>2.提交后发生冲突</h3> 
<p>大多情况下一个项目都是有多人维护开发，有时自己刚修改好了某一功能，在提交后，在gerrit中状态中显示<strong>Merger conflict</strong>， 这是因为在你提交之前已经有其他人优先于你的提交。</p> 
<ul><li>1.那么接下来我们能做的就是，自己撤回abandon<br> <img src="https://images2.imgbox.com/d7/e7/pUrrr86t_o.png" alt="在这里插入图片描述"></li><li>2.然后在本地工作目录中进行解决冲突，和git的操作一样<br> <img src="https://images2.imgbox.com/12/59/8CmviBpP_o.png" alt="在这里插入图片描述">冲突的文件<br> <img src="https://images2.imgbox.com/9b/0a/MQDuY4MK_o.png" alt="在这里插入图片描述">- 3.冲突解决后重新做一次推送，gerrit WebUI查看<br> <img src="https://images2.imgbox.com/11/2f/xKNfDiuP_o.png" alt="在这里插入图片描述"></li><li>4.审核者gerritWebUI查看</li></ul> 
<p><img src="https://images2.imgbox.com/eb/57/UW55hvua_o.png" alt="在这里插入图片描述"></p> 
<ul><li>5.审核完后，开发者gerrit WebUI查看状态</li></ul> 
<p><img src="https://images2.imgbox.com/0a/0f/m8ZhnG1B_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3push_209"></a>3.push服务端是失败</h3> 
<ul><li>当修改完代码进行push推送时报下面错误：<br> 错误提示 ‘error: failed to push some refs to xxxx’</li></ul> 
<pre><code class="prism language-bash">release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">git</span> push origin master
To ssh://10.66.xxx.xx:29418/tinyalsa
 <span class="token operator">!</span> <span class="token punctuation">[</span>rejected<span class="token punctuation">]</span>        master -<span class="token operator">&gt;</span> master <span class="token punctuation">(</span>fetch first<span class="token punctuation">)</span>
error: failed to push some refs to <span class="token string">'ssh://10.66.xxx.xx:29418/tinyalsa'</span>
</code></pre> 
<p>这是因为你在拉取gerrit的代码是没有权限直接推送远端服务器，必须要经过审核才行。<br> 正确的做法应该是：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> push origin HEAD:refs/for/master   <span class="token comment"># master是要推送的分支名， 如developer</span>
</code></pre> 
<ul><li>当推送gerrit仓进行审核时报错：<br> 错误信息： ! [remote rejected] HEAD -&gt; refs/for/master (commit c8d5423: missing Change-Id in message footer)</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 修改文件</span>
release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">vi</span> README
release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">git</span> <span class="token function">add</span> README
<span class="token comment"># 提交文件到本地仓</span>
release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"test without ci-msg"</span>
<span class="token punctuation">[</span>master c8d5423<span class="token punctuation">]</span> <span class="token builtin class-name">test</span> without ci-msg
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
 <span class="token comment"># 推送到远端gerrit仓</span>
release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$ <span class="token function">git</span> push origin HEAD:refs/for/master
Enumerating objects: <span class="token number">5</span>, done.
Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, done.
Delta compression using up to <span class="token number">48</span> threads
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">311</span> bytes <span class="token operator">|</span> <span class="token number">311.00</span> KiB/s, done.
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">2</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
remote: Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>
remote: Processing changes: refs: <span class="token number">1</span>, <span class="token keyword">done</span>
remote: ERROR: commit c8d5423: missing Change-Id <span class="token keyword">in</span> message footer
remote:
remote: Hint: to automatically insert a Change-Id, <span class="token function">install</span> the hook:
remote:   <span class="token assign-left variable">gitdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> rev-parse --git-dir<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token function">scp</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-P</span> <span class="token number">29418</span> test_user2@10.66.xxx.xx:hooks/commit-msg <span class="token variable">${gitdir}</span>/hooks/
remote: and <span class="token keyword">then</span> amend the commit:
remote:   <span class="token function">git</span> commit <span class="token parameter variable">--amend</span> --no-edit
remote: Finally, push your changes again
remote:
To ssh://10.66.xxx.xx:29418/tinyalsa
 <span class="token operator">!</span> <span class="token punctuation">[</span>remote rejected<span class="token punctuation">]</span> HEAD -<span class="token operator">&gt;</span> refs/for/master <span class="token punctuation">(</span>commit c8d5423: missing Change-Id <span class="token keyword">in</span> message footer<span class="token punctuation">)</span>
error: failed to push some refs to <span class="token string">'ssh://10.66.xxx.xx:29418/tinyalsa'</span>
release@release:~/mtk/test_gerrit/own/user2/abandoned/tinyalsa$
</code></pre> 
<p>这时因为你在拉取gerrit仓时没有同步hook/commit-msg脚本文件， 这个文件对需要审核的gerrit必须要有。<br> 解决：<br> 方法一： 在拉取代码时直接通过gerrit WebUi提供的download连接克隆工程<br> <img src="https://images2.imgbox.com/e4/1c/wNLXuUhI_o.png" alt="在这里插入图片描述">方法二： 已经拉取了代码并也做了修改，此时不想在重新拉取工程。那么可以在原有的工程下只拉取commit-msg</p> 
<pre><code class="prism language-bash"><span class="token comment"># 进入工程目录 tinyalsa，执行以下命令</span>
<span class="token assign-left variable">gitdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> rev-parse --git-dir<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token function">scp</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-P</span> <span class="token number">29418</span> test_user2@10.66.xxx.xx:hooks/commit-msg <span class="token variable">${gitdir}</span>/hooks/
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/f7/Prvu7dJ7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_270"></a>4.推送出现权限问题</h3> 
<p>当你在做push的时候提示邮箱地址不匹配：</p> 
<p>remote: ERROR: commit bebf9e6: email address djzheng@xxxx.com.cn is not registered in your account, and you lack ‘forge committer’ permission.</p> 
<p>这是因为你gerrit账号没有注册邮箱，或者已经注册了但是本地git 配置中的user.email和注册的邮箱不一致所致。<br> 解决方法：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 1， 首先注册gerrit邮箱， 请参考邮箱注册小节</span>
<span class="token comment"># 2， 修改本地git user.email 配置</span>
<span class="token function">git</span> config user.email xxxx@xxx.com
</code></pre> 
<ul><li>如下截图显示，没有注册邮箱：<br> <img src="https://images2.imgbox.com/b0/6a/JKfbe6Ps_o.png" alt="在这里插入图片描述"></li><li>已经注册了， 但是和git config user.email 不匹配。<br> <img src="https://images2.imgbox.com/0c/84/GCarKsKt_o.png" alt="在这里插入图片描述"></li><li>重新push<br> <img src="https://images2.imgbox.com/5e/69/wzuP6uvt_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08c9be6d910bb6b368f327f9f8aae089/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# （江湖熟手）- Cefsharp 的使用（几行代码写个浏览器）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8993f6a9a9c67f61b17778916abdf406/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c&#43;&#43;小游戏（附源码）（可转载）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>