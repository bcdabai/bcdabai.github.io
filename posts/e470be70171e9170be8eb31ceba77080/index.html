<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue的加载顺序导致的：在export之外初始化window全局变量是undefined - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue的加载顺序导致的：在export之外初始化window全局变量是undefined" />
<meta property="og:description" content="question：最近写vue项目遇到一个问题，以下三个文件中，water.vue在export之外初始化window定义的全局变量，结果是undefined
//APP.vue &lt;template&gt; &lt;earth /&gt; &lt;water /&gt; &lt;/template&gt; //earth.vue &lt;template&gt;&lt;/template&gt; &lt;script&gt; export default{ name:&#39;earth&#39;, mounted(){ window.earth = new Earth(); } } &lt;/script&gt; //water.vue var earth = window.earth; export default{ name:&#39;water&#39;, methods:{ hello(){ console.log(earth); //打印结果是earth is undefined; } } } 后来才知道这个跟vue加载文件顺序有关：vue先加载export外的js代码，然后再加载export内的mounted。所以water.vue在export之外无法加载，earth.vue中mounted内部定义的全局变量。
index.html-&gt;APP.vue的export以外的js代码-&gt;main.js-&gt;APP.vue的export内代码-&gt;earth.vue的export外的js代码-&gt;water.vue的export外的js代码-&gt;meatrue.vue的export外的js代码-&gt;earth.vue的export内代码-&gt;water.vue的export内代码-&gt;meatrue.vue的export内代码
1，先加载全部组件export外的js代码，然后再加载全部组件export内的js代码；
2，export内的js代码先加载mounted函数
在app.vue中earth.vue组件是放在water.vue之前的，window.earth是在earth.vue的mounted内加载的，我在water.vue内的mounted内获取window.earth是成功的；假如我把earth.vue放在water.vue组件之后，理论上先加载water.vue的mounted再加载earth.vue的mounted，所以应该报错earth是undefined; 事实上确实报错了。但是water.vue的子组件却可以获取window.earth，说明以下两个问题：
1，vue是按照组件的摆放顺序加载的，同等级的组件，摆放越靠前越先加载；
2，父级组件总是先全部加载完毕，然后才轮到子组件加载
补充，以下是vue的启动流程，原文链接 VUE启动流程 1. package.json 在执行npm run dev的时候，会在当前目录中寻找 package.json 文件, 有点类似 Maven 的 pom.xml 文件，包含项目的名称版本、项目依赖等相关信息。
{　# 版本信息 &#34;name&#34;: &#34;kitty-ui&#34;, &#34;version&#34;: &#34;1.0.0&#34;, &#34;description&#34;: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e470be70171e9170be8eb31ceba77080/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-20T10:02:06+08:00" />
<meta property="article:modified_time" content="2020-10-20T10:02:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue的加载顺序导致的：在export之外初始化window全局变量是undefined</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>question：最近写vue项目遇到一个问题，以下三个文件中，water.vue在export之外初始化window定义的全局变量，结果是undefined</p> 
<pre><code class="language-html">//APP.vue
&lt;template&gt;
  &lt;earth /&gt;
  &lt;water /&gt;
&lt;/template&gt;</code></pre> 
<pre><code class="language-html">//earth.vue
 &lt;template&gt;&lt;/template&gt;

&lt;script&gt;
 export default{
  name:'earth',
  mounted(){
  window.earth = new Earth();
  }
 }
&lt;/script&gt;</code></pre> 
<pre><code class="language-javascript">//water.vue
var earth = window.earth;
export default{
  name:'water',
  methods:{
  hello(){
  console.log(earth);  //打印结果是earth  is undefined;
 }
}
}</code></pre> 
<p> 后来才知道这个跟vue加载文件顺序有关：vue先加载export外的js代码，然后再加载export内的mounted。所以water.vue在export之外无法加载，earth.vue中mounted内部定义的全局变量。</p> 
<p>index.html-&gt;APP.vue的export以外的js代码-&gt;main.js-&gt;APP.vue的export内代码-&gt;earth.vue的export外的js代码-&gt;water.vue的export外的js代码-&gt;meatrue.vue的export外的js代码-&gt;earth.vue的export内代码-&gt;water.vue的export内代码-&gt;meatrue.vue的export内代码<br> 1，先加载全部组件export外的js代码，然后再加载全部组件export内的js代码；<br> 2，export内的js代码先加载mounted函数</p> 
<p><s>在app.vue中earth.vue组件是放在water.vue之前的，window.earth是在earth.vue的mounted内加载的，我在water.vue内的mounted内获取window.earth是成功的；假如我把earth.vue放在water.vue组件之后，理论上先加载water.vue的mounted再加载earth.vue的mounted，所以应该报错earth是undefined; 事实上确实报错了。但是water.vue的子组件却可以获取window.earth，说明以下两个问题：</s></p> 
<p>1，vue是按照组件的摆放顺序加载的，同等级的组件，摆放越靠前越先加载；<br> 2，父级组件总是先全部加载完毕，然后才轮到子组件加载</p> 
<hr> 
<p> 补充，以下是vue的启动流程，<a href="https://www.cnblogs.com/xifengxiaoma/p/9493544.html" rel="nofollow">原文链接 </a></p> 
<h3>VUE启动流程</h3> 
<h4>1. package.json</h4> 
<p>在执行npm run dev的时候，会在当前目录中寻找 package.json 文件, 有点类似 Maven 的 pom.xml 文件，包含项目的名称版本、项目依赖等相关信息。</p> 
<p><img alt="复制代码" src="https://images2.imgbox.com/18/ca/Z4nWVmpo_o.png"></p> 
<pre><code class="language-html hljs">{　# 版本信息
  "name": "kitty-ui",
  "version": "1.0.0",
  "description": "kitty ui project",
  "author": "Louis",
  "private": true,
  "scripts": {
    "dev": "webpack-dev-server --inline --progress --config build/webpack.dev.conf.js",
    "start": "npm run dev",
    "build": "node build/build.js"
  },
  "dependencies": { # 项目依赖
    "vue": "^2.5.2",
    "vue-router": "^3.0.1"
  },
  "devDependencies": {  # 项目依赖
    "autoprefixer": "^7.1.2",
    "babel-core": "^6.22.1","vue-template-compiler": "^2.5.2",
    "webpack": "^3.6.0",
    "webpack-bundle-analyzer": "^2.9.0",
    "webpack-dev-server": "^2.9.1",
    "webpack-merge": "^4.1.0"
  },
  "engines": {　　# node、npm版本要求
    "node": "&gt;= 6.0.0",
    "npm": "&gt;= 3.0.0"
  },
  "browserslist": [
    "&gt; 1%",
    "last 2 versions",
    "not ie &lt;= 8"
  ]
}</code></pre> 
<p><img alt="复制代码" src="https://images2.imgbox.com/30/b9/KQbbJgL2_o.png"></p> 
<h4>2. webpack.dev.conf.js</h4> 
<p>从下图中可以看到， 启动 npm run dev 命令后，会加载 build/webpack.dev.conf.js 配置并启动 webpack-dev-server 。</p> 
<p><img alt="" src="https://images2.imgbox.com/6b/2f/HSRB7BqZ_o.png"></p> 
<h4>3.  config/*.js</h4> 
<p> webpack.dev.conf.js 中引入了很多模块的内容，其中就包括 config 目录下服务器环境的配置文件。</p> 
<p><img alt="" height="281" src="https://images2.imgbox.com/96/e1/Vx4LQQhu_o.png" width="758"></p> 
<h4>4.  config/index.js</h4> 
<p>可以看到，在 index.js 文件中包含服务器 host 和 port 以及入口文件的相关配置，默认启动端口是8080，这里可以进行修改。</p> 
<p> <img alt="" src="https://images2.imgbox.com/59/e9/iEffIXDH_o.png"></p> 
<h4>5.  index.html</h4> 
<p>index.html 的内容很简单，主要是提供一个 div 给 vue 挂载。</p> 
<p><img alt="" src="https://images2.imgbox.com/d6/b3/ogQyllS8_o.png"></p> 
<h4>6.  main.js</h4> 
<p>main.js 中， 引入了 vue、App 和 router 模块， 创建了一个 Vue 对象，并把 App.vue 模板的内容挂载到 index.html 的 id 为 app 的 div 标签下， 并绑定了一个路由配置。</p> 
<p><img alt="" src="https://images2.imgbox.com/d9/8f/XedfafXM_o.png"></p> 
<h4>7.  App.vue</h4> 
<p>上面 main.js 把 App.vue 模板的内容，放置在了 index.html 的 div 标签下面。查看 App.vue 的内容我们看到，这个页面的内容由一个 logo 和一个待放置内容的 router-view，router-view 的内容将由 router 配置决定。</p> 
<p> <img alt="" src="https://images2.imgbox.com/c3/e1/kvgv1AVt_o.png"></p> 
<h4>8.  index.js</h4> 
<p>查看 route 目录下的 index.js，我们发现这里配置了一个路由， 在访问路径 / 的时候， 会把 HelloWorld 模板的内容放置到上面的 router-view中。 </p> 
<p><img alt="" src="https://images2.imgbox.com/12/e1/ww71hHqA_o.png"></p> 
<h4>9.  HelloWorld.vue</h4> 
<p>HelloWorld 中主要是一些 Vue 介绍显示内容。</p> 
<p> <img alt="" src="https://images2.imgbox.com/e9/50/VTdSNMsj_o.png"></p> 
<h4>10. 页面组成</h4> 
<p>所以，页面关系组成是 index.html 包含 App.vue，App.vue 包含 HelloWorld.vue 。</p> 
<p> <img alt="" src="https://images2.imgbox.com/30/e0/arLzkPS9_o.png"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/01cb892be5f89d156cbb98c1d83ca639/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MapGIS出现“存储服务错误，可能未启动”问题解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/38e36c84fe2e220e4f8e880b49e83d99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【概率与统计】---均方误差，方差，协方差，协方差矩阵</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>