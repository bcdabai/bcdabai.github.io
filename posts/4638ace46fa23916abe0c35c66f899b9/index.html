<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>20190507(select()函数) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="20190507(select()函数)" />
<meta property="og:description" content="1.select()学习 学习select()是因为要用到了，要仿照写一个进程，
学习网站：https://blog.csdn.net/cstarbl/article/details/7645298
select函数用于在非阻塞中，当一个套接字或一组套接字有信号时通知你，系统提供select函数来实现多路复用输入/输出模型。
#include &lt;sys/time.h&gt; #include &lt;unistd.h&gt; int select(int maxfd,fd_set *rdset,fd_set *wrset,fd_set *exset,struct timeval *timeout); 功能：把当前符合要求的fd(可读，可写，有异常)分别放入rdset,wrset,exset中；
参数：maxfd：需要监视的最大的文件描述符值&#43;1；
rdset： 用来检查可读性的一组文件描述字
wrset：用来检查可写性的一组文件描述字
exset：用来检查是否有异常条件出现的文件描述字。(注：错误不包括在异常条件之内)
struct timeval结构用于描述一段时间长度，如果在这个时间内，需要监视的描述符没有事件发生则函数返回，返回值为0。有三种可能：
1.timeout=NULL（阻塞：select将一直被阻塞，直到某个文件描述符上发生了事件）
2.timeout所指向的结构设为非零时间（等待固定时间：如果在指定的时间段里有事件发生或者时间耗尽，函数均返回）
3.timeout所指向的结构，时间设为0（非阻塞：仅检测描述符集合的状态，然后立即返回，并不等待外部事件的发生）
PS： fd_set（数据类型）是一组文件描述字(fd)的集合，它用一位来表示一个fd，
对于fd_set类型通过下面四个宏来操作： FD_ZERO(fd_set *fdset);将指定的文件描述符集清空，在对文件描述符集合进行设置前，必须对其进行初始化，如果不清空，由于在系统分配内存空间后，通常并不作清空处理，所以结果是不可知的。
FD_SET(int fd,fd_set *fdset);用于在文件描述符集合中增加一个新的文件描述符。 FD_CLR(int fd,fd_set *fdset);用于在文件描述符集合中删除一个文件描述符。 FD_ISSET(int fd,fd_set *fdset);用于测试指定的文件描述符是否在该集合中。 过去，一个fd_set通常只能包含小于32的fd（文件描述字），因为fd_set其实只用了一个32位矢量来表示fd；现在,UNIX系统通常会在头文件&lt;sys/select.h&gt;中定义常量FD_SETSIZE，它是数据类型fd_set的描述字数量，其值通常是1024，这样就能表示小于1024的fd
PS: 注意fd的最大值必须&lt;FD_SETSIZE。
socket s; ..... fd_set set; while(1) { FD_ZERO(&amp;set);//将你的套节字集合清空 FD_SET(s, &amp;set);//加入你感兴趣的套节字到集合,这里是一个读数据的套节字s select(s&#43;1,&amp;set,NULL,NULL,NULL);//检查套节字是否可读, //很多情况下就是是否有数据(注意,只是说很多情况) //这里select是否出错没有写 if(FD_ISSET(s, &amp;set) //检查s是否在这个集合里面, { //select将更新这个集合,把其中不可读的套节字去掉 //只保留符合条件的套节字在这个集合里面 recv(s,...); } //do something here } 理解select模型的关键在于理解fd_set,为说明方便，取fd_set长度为1字节，fd_set中的每一bit可以对应一个文件描述符fd。则1字节长的fd_set最大可以对应8个fd。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4638ace46fa23916abe0c35c66f899b9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-22T10:37:30+08:00" />
<meta property="article:modified_time" content="2019-05-22T10:37:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">20190507(select()函数)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1.select()学习</h3> 
<p>学习select()是因为要用到了，要仿照写一个进程，</p> 
<p>学习网站：<a href="https://blog.csdn.net/cstarbl/article/details/7645298">https://blog.csdn.net/cstarbl/article/details/7645298</a></p> 
<p>select函数用于在非阻塞中，当一个套接字或一组套接字有信号时通知你，系统提供select函数来实现多路复用输入/输出模型。</p> 
<pre class="has"><code class="language-cpp">        #include &lt;sys/time.h&gt; 
        #include &lt;unistd.h&gt; 
        int select(int maxfd,fd_set *rdset,fd_set *wrset,fd_set *exset,struct timeval *timeout);</code></pre> 
<blockquote> 
 <p>功能：把当前符合要求的fd(<span style="color:#3399ea;">可读</span>，<span style="color:#e579b6;">可写</span>，<span style="color:#f33b45;">有异常</span>)分别放入<span style="color:#3399ea;">rdset</span>,<span style="color:#e579b6;">wrset</span>,<span style="color:#f33b45;">exset</span>中；</p> 
 <p>参数：maxfd：需要监视的最大的文件描述符值+1；</p> 
 <p>          rdset：  用来检查可读性的一组文件描述字</p> 
 <p>          wrset：用来检查可写性的一组文件描述字</p> 
 <p>          exset：用来检查是否有异常条件出现的文件描述字。(注：错误不包括在异常条件之内)</p> 
 <p>          struct timeval结构用于描述一段时间长度，如果在这个时间内，需要监视的描述符没有事件发生则函数返回，返回值为0。有三种可能：</p> 
 <p>                        <span style="color:#7c79e5;">1.timeout=NULL（阻塞：select将一直被阻塞，直到某个文件描述符上发生了事件）<br>                         2.timeout所指向的结构设为非零时间（等待固定时间：如果在指定的时间段里有事件发生或者时间耗尽，函数均返回）<br>                         3.timeout所指向的结构，时间设为0（非阻塞：仅检测描述符集合的状态，然后立即返回，并不等待外部事件的发生）</span></p> 
 <p>PS：  <span style="color:#86ca5e;">fd_set（数据类型）</span>是一组文件描述字(fd)的集合，它用一位来表示一个fd，</p> 
</blockquote> 
<blockquote> 
 <p>对于fd_set类型通过下面四个宏来操作：       </p> 
 <p>         FD_ZERO(fd_set *fdset);将指定的文件描述符集清空，在对文件描述符集合进行设置前，必须对其进行初始化，如果不清空，由于在系统分配内存空间后，通常并不作清空处理，所以结果是不可知的。<br>          FD_SET(int fd,fd_set *fdset);用于在文件描述符集合中增加一个新的文件描述符。 <br>          FD_CLR(int fd,fd_set *fdset);用于在文件描述符集合中删除一个文件描述符。 <br>          FD_ISSET(int fd,fd_set *fdset);用于测试指定的文件描述符是否在该集合中。 </p> 
</blockquote> 
<blockquote> 
 <p>         过去，一个fd_set通常只能包含小于32的fd（文件描述字），因为fd_set其实只用了一个32位矢量来表示fd；现在,UNIX系统通常会在头文件&lt;sys/select.h&gt;中定义常量<span style="color:#3399ea;">FD_SETSIZE</span>，它是数据类型fd_set的描述字数量，其值通常是<span style="color:#3399ea;">1024</span>，这样就能表示<span style="color:#3399ea;">小于1024</span>的fd</p> 
 <p>PS:   注意fd的最大值必须&lt;FD_SETSIZE。</p> 
</blockquote> 
<pre class="has"><code class="language-cpp">socket   s;   
.....   
fd_set   set;   
while(1)   
{       
      FD_ZERO(&amp;set);//将你的套节字集合清空   
      FD_SET(s,   &amp;set);//加入你感兴趣的套节字到集合,这里是一个读数据的套节字s   
      select(s+1,&amp;set,NULL,NULL,NULL);//检查套节字是否可读,   
                                                        //很多情况下就是是否有数据(注意,只是说很多情况)  
                                                        //这里select是否出错没有写   
      if(FD_ISSET(s,   &amp;set)   //检查s是否在这个集合里面,   
      {                                           //select将更新这个集合,把其中不可读的套节字去掉   
                                                  //只保留符合条件的套节字在这个集合里面                         
              recv(s,...);   
      }   
      //do   something   here   
}</code></pre> 
<p>  理解select模型的关键在于理解fd_set,为说明方便，取fd_set长度为1字节，fd_set中的每一bit可以对应一个文件描述符fd。则1字节长的fd_set最大可以对应8个fd。</p> 
<p>    （1）fd_set set;执行 FD_ZERO(&amp;set);则set用位表示是0000,0000。<br>     （2）若fd＝5,执行FD_SET(fd,&amp;set);后set变为0001,0000(第5位置为1)<br>     （3）若再加入fd＝2，fd=1,则set变为0001,0011<br>     （4）执行select(6,&amp;set,0,0,0)阻塞等待<br>     （5）若fd=1,fd=2上都发生可读事件，则select返回，此时set变为0000,0011。注意：没有事件发生的fd=5被清空。</p> 
<p> <strong>使用select函数的过程一般是：</strong><br>     先调用宏FD_ZERO将指定的fd_set清零；</p> 
<p>    然后调用宏FD_SET将需要测试的fd加入fd_set；</p> 
<p>    接着调用函数select测试fd_set中的所有fd；</p> 
<p>    最后用宏FD_ISSET检查某个fd在函数select调用后，相应位是否仍然为1。</p> 
<pre class="has"><code class="language-cpp">     int isready(int fd)
     {
         int rc;
         fd_set fds;
         struct tim tv;    
         FD_ZERO(&amp;fds);
         FD_SET(fd,&amp;fds);
         tv.tv_sec = tv.tv_usec = 0;    
         rc = select(fd+1, &amp;fds, NULL, NULL, &amp;tv);
         if (rc &lt; 0)   //error
         return -1;    
         return FD_ISSET(fd,&amp;fds) ? 1 : 0;
     }</code></pre> 
<p> </p> 
<hr> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1db0e5c4554b84731194c8abd6b33e03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用jersey组件向图片资源服务器上传图片报405 Method Not Allowed错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/08696c86f9ff2a5716c54264c105deeb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">推荐算法－NFM</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>