<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>分布式文件存储系统MinIO - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="分布式文件存储系统MinIO" />
<meta property="og:description" content="分布式文件存储系统MinIO实战 ​ 这份笔记是摘抄B站视频图灵课堂出品的Minio视频，视频链接如下
​ 【MinIO很强-让我放弃FastDFS拥抱MinIO的8大理由】https://www.bilibili.com/video/BV1AY411N7te?p=12&amp;vd_source=980fae9339fdf81599b0d192bd40fc67
​ 观看视频的时候没有找到笔记，所以自己把笔记记下来分享，笔记中很多步骤是根据我自己的实际情况来的，和视频中不一致。
1 分布式文件系统应用场景 ​ 互联网海量非结构化数据的存储需求，因为很多数据是非结构化的，非关系型的。
电商网站：海量商品图片视频网站：海量视频文件网盘：海量文件社交网站：海量图片 1.1 MinIO介绍 ​ Min0 是一个基于Apache license v2.0开源协议的对象存储服务。它兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而一个对象文件可以是任意大小，从几kb到最大5T不等。Minio是一个非常轻量的服务,可以很简单的和其他应用的结合，类似 NodeJS, Redis 或者 MySQL。
官网:
​ 英文官网：https://min.io/
​ 中文官网：http://www.minio.org.cn/
​ 建议直接看英文文档，中文文档更新不及时。
​ 对象存储服务(Object Storage Service，OSS) 是一种海量、安全、低成本、高可靠的云存储服务，适合存放任意类型的文件。容量和处理能力弹性扩展，多种存储类型供选择，全面优化存储成本。
​ 对于中小型企业，如果不选择存储上云，那么 MinIO是个不错的选择，麻雀虽小，五脏俱全。当然 MinIO除了直接作为对象存储使用还可以作为云上对象存储服务的网关层，无缝对接到Amazon S3、MicroSoft Azure。
​ 在中国：阿里巴巴、腾讯、百度、中国联通、华为、中国移动等等9000多家企业也都在使用MinlO产品。
MinIO优点 部署简单：一个single二进制文件及是一切，还可以支持各种平台。
minio支持海量存储，可按zone扩展(原zone不受任何影响)，支持单个对象最大5TB;
兼容Amazon S3接口，充分考虑开发人员的需求和体验;
低冗余且磁盘损坏高容忍，标准且最高的数据冗余系数为2(即存储一个1M的数据对象，实际占用磁盘空间为2M)。但在任意n/2块disk损坏的情况下依然可以读出数据(n为一个纠删码集合(Erasure Coding Set)中的disk数量)。并且这种损坏恢复是基于单个对象的而不是基于整个存储卷的。
读写性能优异
基准测试
1.2 MinIO的基础概念 object:：存储到 Minio 的基本对象，如文件、字节流，Anything…，比如存储一个文件到MinIO中，这个文件就成为一个objectBucket：用来存 Object的逻辑空间。每个 Bucket 之间的数据是相互隔离的。对于客户端而言，就相当于一个存放文件的顶层文件夹。Drive:：即存储数据的磁盘，在 MinIO 启动时，以参数的方式传入。Minio 中所有的对象数据都会存储在 Drive里。Set:即一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set，每个Set 中的 Drive 分布在不同位置，一个对象存." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/506f8c59ab7e6338376703d95439e3f3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-10T20:24:31+08:00" />
<meta property="article:modified_time" content="2023-02-10T20:24:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">分布式文件存储系统MinIO</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MinIO_0"></a>分布式文件存储系统MinIO实战</h2> 
<p>​ 这份笔记是摘抄B站视频<strong>图灵课堂出品的Minio视频</strong>，视频链接如下</p> 
<p>​ 【MinIO很强-让我放弃FastDFS拥抱MinIO的8大理由】https://www.bilibili.com/video/BV1AY411N7te?p=12&amp;vd_source=980fae9339fdf81599b0d192bd40fc67</p> 
<p>​ 观看视频的时候没有找到笔记，所以自己把笔记记下来分享，笔记中很多步骤是根据我自己的实际情况来的，和视频中不一致。</p> 
<h3><a id="1__10"></a>1 分布式文件系统应用场景</h3> 
<p>​ 互联网海量非结构化数据的存储需求，因为很多数据是非结构化的，非关系型的。</p> 
<ul><li>电商网站：海量商品图片</li><li>视频网站：海量视频文件</li><li>网盘：海量文件</li><li>社交网站：海量图片</li></ul> 
<h4><a id="11_MinIO_21"></a>1.1 MinIO介绍</h4> 
<p>​ Min0 是一个基于Apache license v2.0开源协议的对象存储服务。它兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而一个对象文件可以是任意大小，从几kb到最大5T不等。Minio是一个非常轻量的服务,可以很简单的和其他应用的结合，类似 NodeJS, Redis 或者 MySQL。</p> 
<p><img src="https://images2.imgbox.com/02/ed/aqGOkikW_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-uWjS1w8D-1676030558368)(image/image-20230207145358853.png)]"></p> 
<p>官网:</p> 
<p>​ 英文官网：https://min.io/</p> 
<p>​ 中文官网：http://www.minio.org.cn/</p> 
<p>​ 建议直接看英文文档，中文文档更新不及时。</p> 
<blockquote> 
 <p>​ 对象存储服务(Object Storage Service，OSS) 是一种海量、安全、低成本、高可靠的云存储服务，适合存放任意类型的文件。容量和处理能力弹性扩展，多种存储类型供选择，全面优化存储成本。</p> 
</blockquote> 
<p>​ 对于中小型企业，如果不选择存储上云，那么 MinIO是个不错的选择，麻雀虽小，五脏俱全。当然 MinIO除了直接作为对象存储使用还可以作为云上对象存储服务的网关层，无缝对接到Amazon S3、MicroSoft Azure。<br> ​ 在中国：阿里巴巴、腾讯、百度、中国联通、华为、中国移动等等9000多家企业也都在使用MinlO产品。</p> 
<h5><a id="MinIO_45"></a>MinIO优点</h5> 
<ul><li> <p>部署简单：一个single二进制文件及是一切，还可以支持各种平台。</p> </li><li> <p>minio支持海量存储，可按zone扩展(原zone不受任何影响)，支持单个对象最大5TB;</p> </li><li> <p>兼容Amazon S3接口，充分考虑开发人员的需求和体验;</p> </li><li> <p>低冗余且磁盘损坏高容忍，标准且最高的数据冗余系数为<strong>2</strong>(即存储一个1M的数据对象，实际占用磁盘空间为2M)。但在任意n/2块disk损坏的情况下依然可以读出数据(n为一个纠删码集合(Erasure Coding Set)中的disk数量)。并且这种损坏恢复是基于单个对象的而不是基于整个存储卷的。</p> </li><li> <p>读写性能优异</p> </li></ul> 
<p>基准测试</p> 
<p><img src="https://images2.imgbox.com/bf/f7/5x30yU4H_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12_MinIO_61"></a>1.2 MinIO的基础概念</h4> 
<ul><li>object:：存储到 Minio 的基本对象，如文件、字节流，Anything…，比如存储一个文件到MinIO中，这个文件就成为一个object</li><li>Bucket：用来存 Object的逻辑空间。每个 Bucket 之间的数据是相互隔离的。对于客户端而言，就相当于一个存放文件的顶层文件夹。</li><li>Drive:：即存储数据的磁盘，在 MinIO 启动时，以参数的方式传入。Minio 中所有的对象数据都会存储在 Drive里。</li><li>Set:即一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set，每个Set 中的 Drive 分布在不同位置，一个对象存.储在一个 Set 上 (For example: {1…64} is divided into 4 sets each of size 16.) 
  <ul><li>一个对象存储在一个Set上</li><li>一个集群划分为多个set</li><li>一个Set包含的Drive数量是固定的，默认由系统根据集群规模自动计算得出</li><li>一个SET中的Drive尽可能分布在不同的节点上</li></ul> </li></ul> 
<h4><a id="13_ECErasure_Code_74"></a>1.3 纠删码EC（Erasure Code）</h4> 
<p>​ MinIO 使用纠删码机制来保证高可靠性，使用 highwayhash 来处理数据损坏(Bit Rot Protection)。关于纠删码，简单来说就是可以通过数学计算，把丢失的数据进行还原，它可以将n份原始数据，增加m份数据，并能通过n+m份中的任意n份数据，还原为原始数据。即如果有任意小于等于m份的数据失效，仍然能通过剩下的数据还原出来。</p> 
<p><strong>举例：</strong><br> 比如此时存一个文件，存在六个盘中，四个盘存储数据（n=4），两个盘存储纠删码加密之后的文件（m=2）。如果这个时候丢失两个盘(2 &lt;= m)，这个时候数据是可以恢复的，但是如果损坏了3(3&gt;m)，此时数据不可恢复。</p> 
<p>所以MinIO是推荐一半一半分的，一半数据盘，一半纠删码加密的盘。如果此时坏掉的盘刚好坏掉一半，此时是不允许写的，只允许读，只有当没受损磁盘数量大于 n/2 + 1的时候才可以上传，因为这个时候才能保证至少有一块盘是纠删码加密过后的文件盘。</p> 
<h4><a id="14__85"></a>1.4 存储形式</h4> 
<p>​ 文件对象上传到 MinlO，会在对应的数据存储盘中，以 Bucket 名称为目录，文件名称为下一级目录，文件名下是 part.1和xl.meta(老版本，最新版本如下图)，前者是编码数据块及检验块，后者是元数据文件。</p> 
<p>​ 比如有四块盘，两块存数据，两块存纠删码加密后的文件。</p> 
<p>​ 一般来说是奇数盘存纠删码加密后的文件，偶数盘存元数据。</p> 
<p>​ 图中的754开头的是文件的hash。</p> 
<p><img src="https://images2.imgbox.com/4d/5c/jb8NrIsa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="15__100"></a>1.5 存储方案</h4> 
<p><img src="https://images2.imgbox.com/46/42/VSpdPVhP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_MinIO_106"></a>2 MinIO环境搭建</h3> 
<p>MinIO支持多种部署方式</p> 
<h4><a id="_110"></a>单机部署</h4> 
<p>单机部署示意图</p> 
<p><img src="https://images2.imgbox.com/21/c5/YNhjM22P_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_119"></a>分布式</h4> 
<p>分布式部署示意图</p> 
<p><img src="https://images2.imgbox.com/bb/1b/Pjz3GB3x_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="21__128"></a>2.1 单机部署</h4> 
<p>​ minio server的standalone模式，即要管理的磁盘都在host本地，该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为non-erasure code mode和erasure code mode。<br> ​ <strong>non-erasure code mode</strong><br> ​ 在此启动模式下，对于每一份对象数据，minio直接在data下面存储这份数据，不会建立副本，也不会启用纠删码机制。因此，这种模式无论是服务实例还是磁盘都是"单点”，无任何高可用保障，磁盘损坏就表示数据丢失。<br> ​ <strong>erasure code mode</strong><br> ​ 此模式为minio server实例传入多个本地磁盘参数。一日遇到多于一个磁盘参数，minio server会自动启用erasure code modeerasure code对磁盘的个数是有要求的，如不满足要求，实例启动将失败。erasure code启用后，要求传给minio server的endpoint(standalone模式下，即本地磁盘上的目录)至少为4个</p> 
<h5><a id="centos7_138"></a>基于centos7</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 获取minio</span>
<span class="token function">wget</span> <span class="token parameter variable">-q</span> http://dl.minio.org.cn/server/minio/release/linux-amd64/minio
<span class="token comment"># 授予文件权限</span>
<span class="token function">chmod</span> +x minio
<span class="token comment"># 启动minio server服务，指定数据存储目录/mnt/data，最好是指定控制台端口，我使用的这个版本是去访问9000端口，它会自己跳转到控制台端口（比如34292），这个跳转的端口是随机的，不方便后面nginx做转发，我刚开始是懒得做控制台端口映射，到后面吃亏了。</span>
./minio server /mnt/data --console-address :9090
</code></pre> 
<p>我用的这个版本启动之后是不会有日志的</p> 
<p><img src="https://images2.imgbox.com/0c/bc/uBmYQUUz_o.png" alt="在这里插入图片描述"></p> 
<p>基本账号密码</p> 
<pre><code class="prism language-bash">RootUser: minioadmin
RootPass: minioadmin
</code></pre> 
<p>可以指定控制台的端口，具体的可以看官网，官网比较详细。</p> 
<p>单机启动的话，此时是只有一块磁盘，没有办法使用纠删码，所以数据目录下存的就是元数据。</p> 
<h5><a id="docker_170"></a>基于docker</h5> 
<p>去官网看命令</p> 
<pre><code class="prism language-sh"><span class="token comment"># docker 挂载的目录</span>
<span class="token function">mkdir</span> /mnt/dockerData

<span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9090</span>:9090 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> minio <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/dockerData:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">"MINIO_ROOT_USER=ROOTNAME"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">"MINIO_ROOT_PASSWORD=ROOTNAME"</span> <span class="token punctuation">\</span>
quay.io/minio/minio server /data --console-address <span class="token string">":9090"</span>
</code></pre> 
<p>启动成功之后界面，这是非后台启动。这里摁住<code>ctrl + c</code>就能取消docker运行。<br> <img src="https://images2.imgbox.com/b9/b6/H1yfyBMF_o.png" alt="在这里插入图片描述"></p> 
<p>其它的一模一样。</p> 
<h5><a id="minio_199"></a>minio纠删码模式</h5> 
<p>​ Minio使用纠删码 <code>erasure code</code> 和校验和<code>checksum</code> 来保护据免受硬件故障和声数据损坏。即便您丢失一半数量 (N/2) 的硬盘您仍然可以恢复数据。</p> 
<blockquote> 
 <p>​ 纠删码是一种恢复丢失和损坏数的数学算法，Minio采用Reed-Solomon ode将对象拆分成N/2数据和N/2 奇校验块。这就意味着如果是12块盘，一个对象会被分成6个数据块、6个奇偶校验块，你可以丢失任意6块盘(不管其是存放的数据块还是奇偶校验块)，你仍可以从剩下的盘中的数据进行恢复。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/94/cb/Zp1XsrXu_o.png" alt="在这里插入图片描述"></p> 
<p>BLOCK的概念：<br> 在minio中，如果你的文件小于10M的话，那么就按照文件分块，如果大于10M的话，那么就是按照10M进行分块。</p> 
<p>使用Minio Docker镜像，在8块盘中中启动MinIO服务：</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9090</span>:9090 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> minio <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data1:/data1 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data2:/data2 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data3:/data3 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data4:/data4 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data5:/data5 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data6:/data6 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data7:/data7 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /mnt/data8:/data8 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">"MINIO_ROOT_USER=ROOTNAME"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">"MINIO_ROOT_PASSWORD=ROOTNAME"</span> <span class="token punctuation">\</span>
quay.io/minio/minio server /data<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span>.8<span class="token punctuation">}</span> --console-address <span class="token string">":9090"</span>
</code></pre> 
<p>启动之后增加文件</p> 
<p>可以在/mnt目录下看到被存储的文件</p> 
<p><img src="https://images2.imgbox.com/6e/3b/yoXx9utk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="22__244"></a>2.2 分部署集群部署</h4> 
<p>分布式Minio可以让你将多块硬盘(甚至在不同的机器上)组成一个对象存储服务。由于硬盘分布在不同的节点上，分布式Minio避免了单点故障。</p> 
<p><img src="https://images2.imgbox.com/8c/4c/FEBPiavt_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_254"></a>分布式存储可靠性常用方法</h5> 
<p>​ 分布式存储，很关键的点在于数据的可靠性，即保证数据的完整，不丢失，不损坏。只有在可靠性实现的前提下，才有了追求一致性、高可用、高性能的基础。而对于在存储领域，一般对于保证数据可靠性的方法主要有两类，一类是冗余法，一类是校验法。</p> 
<p>​ <strong>冗余</strong></p> 
<p>​ 冗余法最简单直接，即对存储的数据进行副本备份，当数据出现丢失，损坏，即可使用备份内容进行恢复，而副本 备份的多少，决定了数据可靠性的高低。这其中会有成本的考量，副本数据越多，数据越可靠，但需要的设备就越多，成本就越高。可靠性是允许丢失其中一份数据。当前已有很多分布式系统是采用此种方式实现，如 Hadoop 的文件系统(3个副本)，Redis 的集群，MySQL 的主备模式等。</p> 
<p>​ <strong>校验</strong></p> 
<p>​ 校验法即通过校验码的数学计算的方式，对出现丢失、损坏的数据进行校验、还原。注意，这里有两个作用，一个校验，通过对数据进行校验和(cheksum 进行计算，可以检查数据是否完整，有无损坏或更改，在数据传输和保存时经常用到，如 TCP 协议，二是恢复还原.通过对数据结合校验码，通过数学计算，还原丢失或损坏的数据，可以在保证数据可的前提下，降低几余，如单机硬盘存储中的 RAID技术，纠删码 (Erasure Code) 技术等。Minio 采用的就是纠删码技术。</p> 
<h5><a id="MinIO_268"></a>分布式MinIO的优势</h5> 
<p>​ <strong>数据保护</strong></p> 
<p>分布式Minio采用纠删码来防范多个节点宕机和位衰减bit rot</p> 
<p>分布式Minio至少需要4个硬盘，使用分布式Minio自动引入了纠删码功能。</p> 
<p>​ <strong>高可用</strong></p> 
<p>单机Minio服务存在单点故障，相反，如果是一个有N块硬盘的分布式Minio,只要有N/2硬盘在线，你的数据就是安全的。不过你需要至少有N/2+1个硬盘来创建新的对象。<br> 例如，一个16节点的Minio集群，每个节点16块硬盘，就算8台服务器宕机，这个集群仍然是可读的，不过你需要9台服移器才能写数据</p> 
<p>​ <strong>一致性</strong></p> 
<p>Minio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。</p> 
<h5><a id="Minio_287"></a>运行分布式Minio</h5> 
<p>​ 启动一个分布式Minio实例，你只需要把硬盘位置做为参数传给minio server命令即可，然后，你需要在所有其它节点运行同样的命令。</p> 
<ul><li>分布式Minio里所有的节点需要有<strong>同样的access秘钥和secret秘钥</strong>，这样这些节点才能建立联接。为了实现这个，你需要在执行minio server命令之前，先将access秘钥和secret秘钥export成环境变量。新版本使用MINIO_ROOT_USER&amp;MINIO_ROOT_PASSWORD。</li><li>分布式Minio使用的磁盘里必须是干净的，里面没有数据。</li><li>下面示例里的IP仅供示例参考，你需要改成你真实用到的IP和文件夹路径。</li><li>分布式Minio里的节点时间差不能超过3秒，你可以使用NTP 来保证时间一致。</li><li>在Windows下运行分布式Minio处于实验阶段，不建议使用。</li></ul> 
<p><strong>8个节点，每节点1块盘</strong><br> 启动分布式Minio实例，8个节点，每节点1块盘，需要在8个节点上都运行下面的命令:</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>
minio server <span class="token punctuation">\</span> 
http://192.68.0.1/export1 <span class="token punctuation">\</span>
http://192.68.0.2/export1 <span class="token punctuation">\</span>
http://192.68.0.3/export1 <span class="token punctuation">\</span>
http://192.68.0.4/export1 <span class="token punctuation">\</span>
http://192.68.0.5/export1 <span class="token punctuation">\</span>
http://192.68.0.6/export1 <span class="token punctuation">\</span>
http://192.68.0.7/export1 <span class="token punctuation">\</span>
http://192.68.0.8/export1 <span class="token punctuation">\</span> 
--console-address <span class="token string">":9090"</span>
</code></pre> 
<p>下面是部署示意图</p> 
<p><img src="https://images2.imgbox.com/02/71/Dcqturqo_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4 节点，每节点4个盘</strong></p> 
<p>​ 启动分布式MinIO示例，4节点，每个节点4块盘，需要在4个节点下都运行下面的命令；</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>
minio server <span class="token punctuation">\</span> 
http://192.68.0.1/export1 <span class="token punctuation">\</span>
http://192.68.0.1/export2 <span class="token punctuation">\</span>
http://192.68.0.1/export3 <span class="token punctuation">\</span>
http://192.68.0.1/export4 <span class="token punctuation">\</span>
http://192.68.0.2/export1 <span class="token punctuation">\</span>
http://192.68.0.2/export2 <span class="token punctuation">\</span>
http://192.68.0.2/export3 <span class="token punctuation">\</span>
http://192.68.0.2/export4 <span class="token punctuation">\</span>
http://192.68.0.3/export1 <span class="token punctuation">\</span>
http://192.68.0.3/export2 <span class="token punctuation">\</span>
http://192.68.0.3/export3 <span class="token punctuation">\</span>
http://192.68.0.3/export4 <span class="token punctuation">\</span>
http://192.68.0.4/export1 <span class="token punctuation">\</span>
http://192.68.0.4/export2 <span class="token punctuation">\</span>
http://192.68.0.4/export3 <span class="token punctuation">\</span>
http://192.68.0.4/export4 <span class="token punctuation">\</span>
--console-address <span class="token string">":9090"</span>
</code></pre> 
<p>下面是部署示意图</p> 
<p><img src="https://images2.imgbox.com/38/4a/v4oevqbj_o.png" alt="在这里插入图片描述"></p> 
<p>我的机器没有那么大的内存，所以采用四个节点，每个节点两个盘的配置。</p> 
<h5><a id="42_368"></a>（实际）配置4节点，每节点2个盘</h5> 
<p>这个是我实际配置的情况，我起了四台虚拟机，每台1G运行内存，20G硬盘。</p> 
<p>具体步骤如下：</p> 
<h6><a id="144ip_374"></a><strong>1、配置4个服务器，4个服务器的ip如下</strong></h6> 
<pre><code class="prism language-bash">minio01 <span class="token number">192.168</span>.246.162
minio02 <span class="token number">192.168</span>.246.163
minio03 <span class="token number">192.168</span>.246.164
minio03 <span class="token number">192.168</span>.246.165
</code></pre> 
<h6><a id="2minio_385"></a><strong>2、服务器分别下载minio</strong></h6> 
<p>如果下载很慢需要更换下载源</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> <span class="token parameter variable">-q</span> http://dl.minio.org.cn/server/minio/release/linux-amd64/minio
<span class="token comment"># 赋予权限</span>
<span class="token function">chmod</span> +x minio
</code></pre> 
<h6><a id="34_397"></a><strong>3、4台服务器建立好数据目录</strong></h6> 
<p>如果你的虚拟机只有一个硬盘的话，会提示不能挂载在根目录，无法使用，所以要多挂载一个磁盘，挂载磁盘的操作可以在这篇文章看到</p> 
<pre><code class="prism language-sh">https://blog.csdn.net/weixin_41352552/article/details/127878574
</code></pre> 
<p>此时我将第二个盘挂载到/data下，然后分别在各个机器新建文件夹</p> 
<pre><code class="prism language-sh"><span class="token function">mkdir</span> /data/export1
<span class="token function">mkdir</span> /data/export2

<span class="token function">mkdir</span> /data/export3
<span class="token function">mkdir</span> /data/export4

<span class="token function">mkdir</span> /data/export5
<span class="token function">mkdir</span> /data/export6

<span class="token function">mkdir</span> /data/export7
<span class="token function">mkdir</span> /data/export8
</code></pre> 
<h6><a id="44minio_423"></a><strong>4、分别在4个节点启动minio</strong></h6> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>

<span class="token function">nohup</span> ./minio server <span class="token punctuation">\</span>
http://192.168.246.162/data/export1 <span class="token punctuation">\</span>
http://192.168.246.162/data/export2 <span class="token punctuation">\</span>
http://192.168.246.163/data/export3 <span class="token punctuation">\</span>
http://192.168.246.163/data/export4 <span class="token punctuation">\</span>
http://192.168.246.164/data/export5 <span class="token punctuation">\</span>
http://192.168.246.164/data/export6 <span class="token punctuation">\</span>
http://192.168.246.165/data/export7 <span class="token punctuation">\</span>
http://192.168.246.165/data/export8 <span class="token punctuation">\</span>
--console-address :9090 <span class="token punctuation">\</span>
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>nohup.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<h6><a id="5minio_444"></a><strong>5、停止minio的命令</strong></h6> 
<p>如果有启动错误的，可以停止服务，直接在linux的终端运行即可。</p> 
<pre><code class="prism language-sh"><span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> minio <span class="token operator">|</span> <span class="token function">grep</span> server <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable">$pid</span>
</code></pre> 
<h6><a id="6_454"></a><strong>6、查看启动日志</strong></h6> 
<p>每台机器都启动成功。<br> <img src="https://images2.imgbox.com/0c/f3/TAi7KKDf_o.png" alt="在这里插入图片描述"></p> 
<p>随后在浏览器访问<code>http://192.168.246.162:9090</code>就可以访问到minio管理界面。</p> 
<h6><a id="7_464"></a><strong>7、测试扩展集群</strong></h6> 
<p>先停止集群</p> 
<pre><code class="prism language-sh"><span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> minio <span class="token operator">|</span> <span class="token function">grep</span> server <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable">$pid</span>
</code></pre> 
<p>​ 本次测试使用的区方法启动服务，4台机器上执行启动命令，需要建立export100~103四个文件夹。得使用这种方法的才能够扩展集群，使用之前方法，ip一个一个写好的，不能扩展集群，会提示磁盘空间已经使用过，这就不能达到扩展集群的初衷。</p> 
<p>​ 用区方法启动的话，要保证阶段大于等于4，磁盘大于等于4（四个文件夹即可），否则在启动的时候，它会提示 “{N…M}，M-N&gt;=4 ” 之类的提示。</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>

<span class="token function">nohup</span> ./minio server <span class="token punctuation">\</span>
http://192.168.246.16<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">..</span>.5<span class="token punctuation">}</span>/data/export<span class="token punctuation">{<!-- --></span><span class="token number">100</span><span class="token punctuation">..</span>.103<span class="token punctuation">}</span> <span class="token punctuation">\</span>
--console-address :9090 <span class="token punctuation">\</span>
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>nohup.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>​ 这个时候服务已经启动了。</p> 
<p>​ 此时来测试扩展集群，先停掉集群服务。再来添加一个集群，我使用伪集群，同台机器的不同文件夹，使用文件夹export200~203</p> 
<pre><code class="prism language-sh"><span class="token function">nohup</span> ./minio server <span class="token punctuation">\</span>
http://192.168.246.16<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">..</span>.5<span class="token punctuation">}</span>/data/export<span class="token punctuation">{<!-- --></span><span class="token number">100</span><span class="token punctuation">..</span>.103<span class="token punctuation">}</span> <span class="token punctuation">\</span>
http://192.168.246.16<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">..</span>.5<span class="token punctuation">}</span>/data/export<span class="token punctuation">{<!-- --></span><span class="token number">200</span><span class="token punctuation">..</span>.203<span class="token punctuation">}</span> <span class="token punctuation">\</span>
--console-address :9090 <span class="token punctuation">\</span>
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>nohup.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>​</p> 
<p>此时启动成功。</p> 
<p><img src="https://images2.imgbox.com/26/e7/LiRwFW2n_o.png" alt="在这里插入图片描述"></p> 
<p>​ 我总共起了四台机器，每台机器8个文件夹，所以4台服务器，32个驱动器。</p> 
<h6><a id="8_509"></a>8、重启集群</h6> 
<p>​ 重启服务器之后，需要重新挂载磁盘，可以按照上面文章提到的直接设置开机启动挂载，我这边没有设置。</p> 
<pre><code class="prism language-sh"><span class="token function">mount</span> /dev/sdb /data
</code></pre> 
<p>​ 然后执行启动命令，启动命令就是跟刚开始启动集群的命令一致。</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>

<span class="token function">nohup</span> ./minio server <span class="token punctuation">\</span>
http://192.168.246.162/data/export1 <span class="token punctuation">\</span>
http://192.168.246.162/data/export2 <span class="token punctuation">\</span>
http://192.168.246.163/data/export3 <span class="token punctuation">\</span>
http://192.168.246.163/data/export4 <span class="token punctuation">\</span>
http://192.168.246.164/data/export5 <span class="token punctuation">\</span>
http://192.168.246.164/data/export6 <span class="token punctuation">\</span>
http://192.168.246.165/data/export7 <span class="token punctuation">\</span>
http://192.168.246.165/data/export8 <span class="token punctuation">\</span>
--console-address :9090 <span class="token punctuation">\</span>
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>nohup.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<h5><a id="Docker_ComposeMinIO_540"></a>使用Docker Compose部署MinIO</h5> 
<p>这部分我只摘抄笔记，并未实践。</p> 
<p>要在Docker Compose上部署分布式MinIO，请下载docker-compose.yaml和nginx.conf到你的工作目录。</p> 
<pre><code class="prism language-sh"><span class="token function">docker-compose</span> pull
<span class="token function">docker-compose</span> up
</code></pre> 
<h5><a id="_553"></a>扩展现有的分布式集群</h5> 
<p>这个跟上面一致。</p> 
<p>例如我们是通过区的方式启动MinIO集群，命令行如下：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>
minio server http://host<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span>.32<span class="token punctuation">}</span>/export<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span>.32<span class="token punctuation">}</span>
</code></pre> 
<p>MinIO支持通过命令，指定新的集群来扩展现有集群（纠删码模式），命令行如下：</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_USER</span><span class="token operator">=</span>admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">12345678</span>
minio server http://host<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span>.32<span class="token punctuation">}</span>/export<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span>.32<span class="token punctuation">}</span> http://host<span class="token punctuation">{<!-- --></span><span class="token number">33</span><span class="token punctuation">..</span>.64<span class="token punctuation">}</span>/export<span class="token punctuation">{<!-- --></span><span class="token number">33</span><span class="token punctuation">..</span>.64<span class="token punctuation">}</span>
</code></pre> 
<p>​ 现在整个集群就扩展了1024个磁盘，总磁盘变为2048个，新的对象上传请求会自动分配到最少使用的集群上。通过以上扩展策略，您就可以按需扩展您的集群。重新配置后重启集群，会立即在集群中生效，并对现有集群无影响。如上命令中，我们可以把原来的集群看做一个区，新增集群看做另一个区，新对象按每个区域中的可用空间比例放置在区域中。在每个区域内，基于确定性哈希算法确定位置。</p> 
<h5><a id="nginx_579"></a>基于nginx实现</h5> 
<p>​ 因为我们起了多台服务器，为了使集群的性能发挥最大化，我们配置负载均衡。</p> 
<p>​ 配置nginx的负载均衡就可以，对于9090的端口进行负载均衡，要添加对webSocket的支持才可以。</p> 
<pre><code class="prism language-js">worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

events <span class="token punctuation">{<!-- --></span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>
	
	upstream minio<span class="token punctuation">{<!-- --></span>
		
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.162</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.163</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.164</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.165</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	
	server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">9001</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

		location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">minio</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
            
            # 添加了websocket支持
            proxy_http_version      <span class="token number">1.1</span><span class="token punctuation">;</span>
            proxy_set_header Upgrade $http_upgrade<span class="token punctuation">;</span>
            proxy_set_header Connection <span class="token string">"upgrade"</span><span class="token punctuation">;</span>
            proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header<span class="token punctuation">;</span>
            proxy_set_header        Host  $http_host<span class="token punctuation">;</span>
            proxy_set_header        <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 配置好了之后启动nginx，浏览器输入nginx的地址和端口就可以了。</p> 
<h3><a id="23_MinIO_633"></a>2.3 MinIO客户端使用</h3> 
<p>​ MinlO Client(mc为ls，cat，cp，mirror,dif,find等UNIX命令提供了一种替代方案。它支持文件系统和兼容Amazon S3的云存储服务(AWS Signature v2和v4) 。</p> 
<p><img src="https://images2.imgbox.com/11/23/AbEyYXP4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="mc_641"></a>部署客户端mc</h4> 
<table><thead><tr><th>平台</th><th>cpu</th><th>url</th></tr></thead><tbody><tr><td>linux</td><td>64 intel</td><td>https://min.io/docs/minio/linux/reference/minio-mc.html</td></tr></tbody></table> 
<p>可以在官网找到下载的地址，我在linux平台上使无法使用mc的，输入mc --help会卡住，具体的原因还没有查清楚。所以我下载了windows版本的，windows版本的可以直接使用。</p> 
<p>linux版本</p> 
<pre><code class="prism language-sh"><span class="token function">curl</span> https://dl.min.io/client/mc/release/linux-amd64/mc <span class="token punctuation">\</span>
  --create-dirs <span class="token punctuation">\</span>
  <span class="token parameter variable">-o</span> <span class="token environment constant">$HOME</span>/minio-binaries/mc

<span class="token function">chmod</span> +x <span class="token environment constant">$HOME</span>/minio-binaries/mc
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/minio-binaries/

<span class="token function">mc</span> <span class="token parameter variable">--help</span>
</code></pre> 
<p>windows版本</p> 
<pre><code class="prism language-sh">https://dl.min.io/client/mc/release/windows-amd64/mc.exe
</code></pre> 
<h4><a id="mc_670"></a>配置mc</h4> 
<p>因为没有使用linux的mc，所以以下的实操都是在windows上。</p> 
<p>mc将所有的配置信息都存储在<code>~/.mc/config.json</code>中</p> 
<pre><code class="prism language-sh"><span class="token comment"># 查看mchost配置</span>
<span class="token function">mc</span> config <span class="token function">host</span> <span class="token function">ls</span> 
<span class="token comment"># 添加minio服务</span>
<span class="token function">mc</span> config <span class="token function">host</span> <span class="token function">add</span> minio-server http://192.168.246.162:9000 admin <span class="token number">12345678</span>
<span class="token comment"># 删除host</span>
<span class="token function">mc</span> config <span class="token function">host</span> remove minio-server
</code></pre> 
<h4><a id="mc_687"></a>mc命令使用</h4> 
<p>官网里面有</p> 
<p>举例使用cp命令</p> 
<pre><code class="prism language-sh"><span class="token comment"># 查询minio服务上所有的bukets</span>
<span class="token function">mc</span> <span class="token function">ls</span> minio-server

<span class="token comment"># 上传文件</span>
<span class="token function">mc</span> <span class="token function">cp</span> D:<span class="token punctuation">\</span>programfile<span class="token punctuation">\</span>MinIOClient<span class="token punctuation">\</span><span class="token number">1</span>.jpg minio-server/test/

<span class="token comment"># 下载文件</span>
<span class="token function">mc</span> <span class="token function">cp</span> minio-server/test/1.jpg D:<span class="token punctuation">\</span>programfile<span class="token punctuation">\</span>MinIOClient<span class="token punctuation">\</span><span class="token number">1</span><span class="token punctuation">\</span>

<span class="token comment"># 删除文件</span>
<span class="token function">mc</span> <span class="token function">rm</span> minio-server/test/1.jpg
</code></pre> 
<h4><a id="Bucket_709"></a>Bucket管理</h4> 
<pre><code class="prism language-sh"><span class="token comment"># 创建bucket</span>
<span class="token function">mc</span> mb minio-server/bucket01

<span class="token comment"># 删除bucket，不加--force的话，那么如果有数据就无法删除。</span>
<span class="token function">mc</span> rb <span class="token parameter variable">--force</span> minio-server/bucket02

<span class="token comment"># bucket不为空，可以强制删除 慎用</span>
<span class="token function">mc</span> rb <span class="token parameter variable">--force</span> minio-server/bucket01

<span class="token comment"># 查询bucket03磁盘的使用情况</span>
<span class="token function">mc</span> <span class="token function">du</span> minio-server/bucket03
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/83/kzWZAThx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="mc_admin__731"></a>mc admin 使用</h4> 
<p>Minio Client (mc)提供了”admin”子命来对您的Minlo部署执行管理任务</p> 
<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>service</td><td>服务重启并停止所有MinIO服务器</td></tr><tr><td>update</td><td>更新更新所有MinIO服务器</td></tr><tr><td>info</td><td>信息显示MinIO服务器信息</td></tr><tr><td>user</td><td>用户管理用户</td></tr><tr><td>group</td><td>小组管理小组</td></tr><tr><td>policy</td><td>MinIO服务器中定义的策略管理策略</td></tr><tr><td>config</td><td>配置管理MinIO服务器配置</td></tr><tr><td>heal</td><td>修复MinIo服务器上的磁盘，存储桶和对象</td></tr><tr><td>profile</td><td>概要文件生成概要文件数据以进行调试</td></tr><tr><td>top</td><td>顶部提供MinIo的顶部统计信息</td></tr><tr><td>trace</td><td>跟踪显示MinIO服务器的http跟踪</td></tr><tr><td>console</td><td>控制台显示MinTo服务器的控制台日志</td></tr><tr><td>prometheus</td><td>Prometheus管理Prometheus配贸</td></tr><tr><td>kms</td><td>kms执行KMS管理操作</td></tr></tbody></table> 
<h5><a id="_754"></a>用户管理</h5> 
<pre><code class="prism language-sh"><span class="token function">mc</span> admin user <span class="token parameter variable">--help</span>
<span class="token comment"># 新建用户</span>
<span class="token function">mc</span> admin user <span class="token function">add</span> minio-server fox
<span class="token function">mc</span> admin user <span class="token function">add</span> minio-server fox02 <span class="token number">12345678</span>
<span class="token comment">#查看用户</span>
<span class="token function">mc</span> admin user list minio-server
<span class="token comment">#禁用用户</span>
<span class="token function">mc</span> admin user disable minio-server fox02
<span class="token comment">#启用用户</span>
<span class="token function">mc</span> admin user <span class="token builtin class-name">enable</span> minio-server fox02
<span class="token comment">#查看用户信息</span>
<span class="token function">mc</span> admin user info minio-server fox
<span class="token comment">#删除用户</span>
<span class="token function">mc</span> admin user remove minio-server fox02
</code></pre> 
<h5><a id="_775"></a>策略管理</h5> 
<p>policy命令，用于添加，删除，列出策略，获取有关策略的信息并为MiniO服务器上的用户设置策略.</p> 
<pre><code class="prism language-sh"><span class="token function">mc</span> admin policy <span class="token parameter variable">--help</span>
<span class="token comment">#列出MinIo上的所有固定策略</span>
<span class="token function">mc</span> admin policy list minio-server
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/c7/7LVXkpwg_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sh"><span class="token comment"># 查看policy信息</span>
<span class="token function">mc</span> admin policy info minio-server readwrite
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/7f/dMho0qdB_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_799"></a>添加新的策略</h6> 
<p>编写策略文件/root/tulingmall.json</p> 
<p>这个脚本规定是允许获取test下的buket和对象的策略。</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"s3:GetBucketLocation"</span><span class="token punctuation">,</span>
                <span class="token string">"s3:GetObject"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"arn:aws:s3:::test/*"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个脚本是可以对于test进行所有操作。</p> 
<p>tulingmall1.json</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"s3:*"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"arn:aws:s3:::test/*"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>将脚本添加到策略数据库</p> 
<pre><code class="prism language-bash"><span class="token comment"># 添加新的策略，/root/tulingmall.json取决于自己文件存放的位置，我直接把json放在了跟mc.exe同级目录下，所以我使用的命令是：mc admin policy add minio-server tulingmall-admin tulingmall.json</span>
<span class="token function">mc</span> admin policy <span class="token function">add</span> minio-server tulingmall-admin /root/tulingmall.json
<span class="token comment"># 查看所有的策略</span>
<span class="token function">mc</span> admin policy list minio-server
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/b4/qPZsTnbU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sh"><span class="token comment"># 设置用户访问策略</span>
<span class="token function">mc</span> admin policy <span class="token builtin class-name">set</span> minio-server tulingmall-admin <span class="token assign-left variable">user</span><span class="token operator">=</span>fox
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/8b/Zy7wX3BX_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-3jPNpfB1-1676030558380)(image/image-20230210151238398.png)]"></p> 
<p>使用fox用户登录</p> 
<p>只能查看</p> 
<p><img src="https://images2.imgbox.com/b0/f0/2t8jBG8B_o.png" alt="在这里插入图片描述"></p> 
<p>使用tulingmall1.json新建角色tulingmall-admin1，新建用户fox02，该用户可以对于test进行任何操作。</p> 
<h2><a id="3_MinIO_Java_Client_884"></a>3 MinIO Java Client使用</h2> 
<p>MinioJava Client SDK提供简单的API来访问任何与Amazon S3兼容的对象存储服务。</p> 
<p>官方文档地址：https://min.io/docs/minio/linux/developers/java/minio-java.html</p> 
<p>可以参照官方代码上传</p> 
<p>引入依赖</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="31__904"></a>3.1 文件上传</h3> 
<p>编码</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">pers<span class="token punctuation">.</span>lgq<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author linguiquan
 * @date 2023-02-10 15:52
 */</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">BucketExistsArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MakeBucketArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MinioClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">UploadObjectArgs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span>errors<span class="token punctuation">.</span></span><span class="token class-name">MinioException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploader</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 链接客户端</span>
            <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span>
                    <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">"http://192.168.246.162:9000"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"12345678"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 判断桶是否存在</span>
            <span class="token keyword">boolean</span> found <span class="token operator">=</span>
                    minioClient<span class="token punctuation">.</span><span class="token function">bucketExists</span><span class="token punctuation">(</span><span class="token class-name">BucketExistsArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// Make a new bucket called 'asiatrip'.</span>
                minioClient<span class="token punctuation">.</span><span class="token function">makeBucket</span><span class="token punctuation">(</span><span class="token class-name">MakeBucketArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Bucket 'asiatrip' test exists."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Upload '/home/user/Photos/asiaphotos.zip' as object name 'asiaphotos-2015.zip' to bucket</span>
            <span class="token comment">// 'asiatrip'.</span>
            minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span>
                    <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>
                            <span class="token comment">// 上传文件名，即minio要存储的名称</span>
                            <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">"test.jpg"</span><span class="token punctuation">)</span>
                            <span class="token comment">// 本地文件的位置</span>
                            <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">"1.jpg"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                    <span class="token string">"'/home/user/Photos/asiaphotos.zip' is successfully uploaded as "</span>
                            <span class="token operator">+</span> <span class="token string">"object 'asiaphotos-2015.zip' to bucket 'asiatrip'."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MinioException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error occurred: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP trace: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">httpTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="32__970"></a>3.2 文件下载</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDownloader</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 链接客户端</span>
            <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span>
                <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">"http://192.168.246.162:9000"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"12345678"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            minioClient<span class="token punctuation">.</span><span class="token function">downloadObject</span><span class="token punctuation">(</span>
                <span class="token class-name">DownloadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>
                <span class="token comment">// 下载文件名称</span>
                <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">"test.jpg"</span><span class="token punctuation">)</span>
                <span class="token comment">// 下载文件位置和保存名称</span>
                <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">"2.jpg"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MinioException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error occurred: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP trace: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">httpTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33_Spring_bootminio_1004"></a>3.3 Spring boot整合minio</h3> 
<h4><a id="1_pom_1006"></a>1 pom文件</h4> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.3.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="2__1032"></a>2 配置文件</h4> 
<p>application.properties</p> 
<pre><code class="prism language-properties">minio.host=127.0.0.1
minio.port=9002
minio.username=admin
minio.password=12345678

server.port=8089
</code></pre> 
<p>MinioProperties.java</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"minio"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinioProperties</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>MinioConfig.java</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinioConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MinioProperties</span> minioProperties<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MinioConfig</span><span class="token punctuation">(</span><span class="token class-name">MinioProperties</span> minioProperties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minioProperties <span class="token operator">=</span> minioProperties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MinioClient</span> <span class="token function">minioClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">"http://"</span> <span class="token operator">+</span> minioProperties<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> minioProperties<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span>minioProperties<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> minioProperties<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3__1089"></a>3 主启动</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableConfigurationProperties</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootMinioApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringBootMinioApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4_nginx_1105"></a>4 nginx配置</h4> 
<p>这里我采用的是连接集群的方式，nginx配置在本地，所以我的host配置成127.0.0.1。</p> 
<pre><code class="prism language-js">worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

events <span class="token punctuation">{<!-- --></span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>
	
	upstream minio<span class="token punctuation">{<!-- --></span>
		
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.162</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.163</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.164</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.165</span><span class="token operator">:</span><span class="token number">9090</span><span class="token punctuation">;</span>
        
	<span class="token punctuation">}</span>
	
	upstream api<span class="token punctuation">{<!-- --></span>
		
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.162</span><span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.163</span><span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.164</span><span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.246</span><span class="token number">.165</span><span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
        
	<span class="token punctuation">}</span>
	
	
	server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">9001</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
		
		 #必须 防止请求头丢失
		underscores_in_headers on<span class="token punctuation">;</span>
	
		location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">minio</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
			
			# 添加了websocket支持
            proxy_http_version      <span class="token number">1.1</span><span class="token punctuation">;</span>
            proxy_set_header Upgrade $http_upgrade<span class="token punctuation">;</span>
            proxy_set_header Connection <span class="token string">"upgrade"</span><span class="token punctuation">;</span>
            proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header<span class="token punctuation">;</span>
            proxy_set_header        Host  $http_host<span class="token punctuation">;</span>
            proxy_set_header        <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>  
	
	server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">9002</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
		
		 #必须 防止请求头丢失
		underscores_in_headers on<span class="token punctuation">;</span>
	
		location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
			
			# 添加了websocket支持
            proxy_http_version      <span class="token number">1.1</span><span class="token punctuation">;</span>
            proxy_set_header Upgrade $http_upgrade<span class="token punctuation">;</span>
            proxy_set_header Connection <span class="token string">"upgrade"</span><span class="token punctuation">;</span>
            proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header<span class="token punctuation">;</span>
            proxy_set_header        Host  $http_host<span class="token punctuation">;</span>
            proxy_set_header        <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="5__1187"></a>5 逻辑代码</h4> 
<p>这些部分由读者自己写，加深印象，可以把官方的demo下载下来看。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/65cd64ed53576fa89ee6a2197e13bf20/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">stm32f407探索者开发板（十四）——IO引脚复用和映射</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f4cfa8b5c1fc70391b6cfcdf00c2245/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在ios手机上图片之间存在白色间隙</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>