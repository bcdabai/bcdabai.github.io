<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch 搜索推荐 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch 搜索推荐" />
<meta property="og:description" content="搜索推荐
Suggester 搜索推荐
term suggester 语法 POST &lt;index&gt;/_search { &#34;suggest&#34;: { &#34;&lt;suggest_name&gt;&#34;: { &#34;text&#34;: &#34;&lt;search_content&gt;&#34;, &#34;term&#34;: { &#34;suggest_mode&#34;: &#34;&lt;suggest_mode&gt;&#34;, &#34;field&#34;: &#34;&lt;field_name&gt;&#34; } } } } 选项 text 用户搜索的文本
field field：要从哪个字段选取推荐数据
analyzer analyzer：使用哪种分词器
size size：每个建议返回的最大结果数
sort sort：如何按照提示词项排序，参数值只可以是以下两个枚举：
score：分数&gt;词频&gt;词项本身frequency：词频&gt;分数&gt;词项本身 suggest_mode missing：默认值，仅为不在索引中的词项生成建议词
popular：仅返回与搜索词文档词频或文档词频更高的建议词
always：根据 建议文本中的词项 推荐 任何匹配的建议词
missing 一种场景:
要搜的词: 五万的宝马; 拆解这个词一个是价格一个是品牌,然后把这两个词分别应用到价格字段和品牌字段做精准匹配
这样就避免了比如一些蹭热度的标题如:&#34;仅五万动力超过宝马&#34;这种,因为它实际品牌可能是宝骏,提高命中程度
其实这个意思是说,一旦我精准匹配了,还需要给你推荐似是而非的词项吗? 比如&#34;仅五万动力超过宝马&#34;这种命中是否还要推送给你?很明显不需要的
missing就是当精准匹配了,就不需要再推荐其他可能词项了,这就像你在京东搜索框搜索宝马,它下边会有很多推荐项.这的精准匹配指的在索引中匹配到了.
DELETE news POST _bulk { &#34;index&#34; : { &#34;_index&#34; : &#34;news&#34;,&#34;_id&#34;:1 } } { &#34;title&#34;: &#34;baoqiang bought a new hat with the same color of this font, which is very beautiful baoqiangba baoqiangda baoqiangdada baoqian baoqia&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/415e71f2e19f99e090fc9296d18f5f38/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-08T18:46:39+08:00" />
<meta property="article:modified_time" content="2023-07-08T18:46:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch 搜索推荐</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>搜索推荐</p> 
<h2><a id="Suggester_4"></a>Suggester</h2> 
<p>搜索推荐</p> 
<h3><a id="term_suggester_10"></a>term suggester</h3> 
<h5><a id="_14"></a>语法</h5> 
<pre><code class="prism language-json"><span class="token constant">POST</span> <span class="token operator">&lt;</span>index<span class="token operator">&gt;</span><span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span> 
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"&lt;suggest_name&gt;"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"&lt;search_content&gt;"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"suggest_mode"</span><span class="token operator">:</span> <span class="token string">"&lt;suggest_mode&gt;"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"&lt;field_name&gt;"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_35"></a>选项</h4> 
<h5><a id="text_37"></a>text</h5> 
<p>用户搜索的文本</p> 
<h5><a id="field_43"></a>field</h5> 
<p><strong>field</strong>：要从哪个字段选取推荐数据</p> 
<h5><a id="analyzer_49"></a>analyzer</h5> 
<p><strong>analyzer</strong>：使用哪种分词器</p> 
<h5><a id="size_55"></a>size</h5> 
<p><strong>size</strong>：每个建议返回的最大结果数</p> 
<h5><a id="sort_61"></a>sort</h5> 
<p><strong>sort</strong>：如何按照提示词项排序，参数值只可以是以下两个枚举：</p> 
<ul><li><strong>score</strong>：分数&gt;词频&gt;词项本身</li><li><strong>frequency</strong>：词频&gt;分数&gt;词项本身</li></ul> 
<h5><a id="suggest_mode_70"></a>suggest_mode</h5> 
<p>missing：默认值，仅为不在索引中的词项生成建议词</p> 
<p>popular：仅返回与搜索词文档词频或文档词频更高的建议词</p> 
<p>always：根据 建议文本中的词项 推荐 任何匹配的建议词</p> 
<h6><a id="missing_80"></a>missing</h6> 
<p>一种场景:</p> 
<p>要搜的词: 五万的宝马; 拆解这个词一个是价格一个是品牌,然后把这两个词分别应用到价格字段和品牌字段做精准匹配</p> 
<p>这样就避免了比如一些蹭热度的标题如:"仅五万动力超过宝马"这种,因为它实际品牌可能是宝骏,提高命中程度</p> 
<p>其实这个意思是说,一旦我精准匹配了,还需要给你推荐似是而非的词项吗? 比如"仅五万动力超过宝马"这种命中是否还要推送给你?很明显不需要的</p> 
<p>missing就是当精准匹配了,就不需要再推荐其他可能词项了,这就像你在京东搜索框搜索<code>宝马</code>,它下边会有很多推荐项.这的精准匹配指的在索引中匹配到了.</p> 
<pre><code class="prism language-json"><span class="token constant">DELETE</span> news
<span class="token constant">POST</span> _bulk
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"news"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"baoqiang bought a new hat with the same color of this font, which is very beautiful baoqiangba baoqiangda baoqiangdada baoqian baoqia"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"news"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"baoqiangge gave birth to two children, one is upstairs, one is downstairs baoqiangba baoqiangda baoqiangdada baoqian baoqia"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"news"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"baoqiangge 's money was rolled away baoqiangba baoqiangda baoqiangdada baoqian baoqia"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_index"</span> <span class="token operator">:</span> <span class="token string">"news"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"baoqiangda baoqiangda baoqiangda baoqiangda baoqiangda baoqian baoqia"</span><span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>news<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"my-suggestion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"baoqing baoqiang"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//"suggest_mode": "missing",</span>
        <span class="token comment">//大于等于搜索词频率</span>
        <span class="token string-property property">"suggest_mode"</span><span class="token operator">:</span> <span class="token string">"popular"</span><span class="token punctuation">,</span>
        <span class="token comment">//"suggest_mode":"always",</span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"title"</span><span class="token punctuation">,</span>
        <span class="token comment">//表示词项在多少个文档中出现的次数,统计文档的个数,一个文档出现多次不计算</span>
        <span class="token string-property property">"min_doc_freq"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="max_edits_129"></a>max_edits</h5> 
<h5><a id="prefix_length_135"></a>prefix_length</h5> 
<h5><a id="min_word_length_141"></a>min_word_length</h5> 
<h5><a id="min_doc_freq_149"></a>min_doc_freq</h5> 
<h5><a id="max_term_freq_159"></a>max_term_freq</h5> 
<h3><a id="phase_suggester_165"></a>phase suggester</h3> 
<p><strong>有什么特性和区别?</strong></p> 
<p>phrase suggester和term suggester相比，</p> 
<ul><li> <p>对建议的文本会参考上下文即其他token</p> </li><li> <p>同时也会基于token距离匹配</p> <p>它可以基于共生和频率选出更好的建议。</p> </li></ul> 
<p>为什么必须有一个mapping?</p> 
<h4><a id="shingle_181"></a>shingle</h4> 
<p>https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-shingle-tokenfilter.html</p> 
<p><strong>shingle是什么?</strong></p> 
<p>前面我们讲过基于字符的ngram切词组合,shingle是基于词项的;</p> 
<blockquote> 
 <p>concatenating adjacent tokens. 连接相邻词项</p> 
 <p>Shingles are often used to help speed up phrase queries, such as <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl-match-query-phrase.html" rel="nofollow"><code>match_phrase</code></a>. Rather than creating shingles using the <code>shingles</code> filter, we recommend you use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/index-phrases.html" rel="nofollow"><code>index-phrases</code></a> mapping parameter on the appropriate <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/text.html" rel="nofollow">text</a> field instead.</p> 
 <p>提高短语查询速度,如match_phase类型的查询</p> 
 <p>不建议把shingle用于shingle过滤器,建议在text字段用于应设参数<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/index-phrases.html" rel="nofollow"><code>index-phrases</code></a></p> 
</blockquote> 
<p>例子:<code>[ the, lazy, dog ]</code> = &gt; <code>[ the, the lazy, lazy, lazy dog, dog ]</code></p> 
<p>比如最大切词是2, 它会切1个的,然后切2个,包含空格</p> 
<p>有什么特点? 需要配置什么参数?参数分别什么作用?</p> 
<p>shingle用在哪里?哪些场景使用?</p> 
<h4><a id="_215"></a>推荐的短语</h4> 
<p>它会给你推荐一些短语,这些短语不一定是在文档中存在的, 它是根据你的搜索词和文档内容,自动生成的一些短语, 它认为你可能想搜索的</p> 
<p>这里的短语指的搜索结果中的:</p> 
<pre><code class="prism language-json">  <span class="token string-property property">"suggest"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"simple_phrase"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"text"</span> <span class="token operator">:</span> <span class="token string">"Luceen and elasticsearhc"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"length"</span> <span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
        <span class="token string-property property">"options"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//这个就是推荐短语,这个不一定是文档内容,可能是基于搜索词和文档内容自动生成的</span>
            <span class="token string-property property">"text"</span> <span class="token operator">:</span> <span class="token string">"lucene and elasticsearhc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"highlighted"</span> <span class="token operator">:</span> <span class="token string">"&lt;em&gt;lucene&lt;/em&gt; and elasticsearhc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"score"</span> <span class="token operator">:</span> <span class="token number">0.06261247</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"text"</span> <span class="token operator">:</span> <span class="token string">"lucene and elasticsearch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"highlighted"</span> <span class="token operator">:</span> <span class="token string">"&lt;em&gt;lucene&lt;/em&gt; and &lt;em&gt;elasticsearch&lt;/em&gt;"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"score"</span> <span class="token operator">:</span> <span class="token number">0.06183557</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"text"</span> <span class="token operator">:</span> <span class="token string">"luceen and elasticsearhc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"highlighted"</span> <span class="token operator">:</span> <span class="token string">"luceen and elasticsearhc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"score"</span> <span class="token operator">:</span> <span class="token number">0.036299694</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"text"</span> <span class="token operator">:</span> <span class="token string">"luceen and elasticsearch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"highlighted"</span> <span class="token operator">:</span> <span class="token string">"luceen and &lt;em&gt;elasticsearch&lt;/em&gt;"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"score"</span> <span class="token operator">:</span> <span class="token number">0.035849284</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="phrase_260"></a>phrase查询代码</h4> 
<pre><code class="prism language-json"><span class="token constant">DELETE</span> test_shingle
<span class="token constant">PUT</span> test_shingle
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//这个"index"名称不是可以自定义的</span>
    <span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//这个索引的存储属性</span>
      <span class="token string-property property">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token string-property property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string-property property">"analysis"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"mytrigram"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"custom"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"tokenizer"</span><span class="token operator">:</span><span class="token string">"standard"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"filter"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"lowercase"</span><span class="token punctuation">,</span> <span class="token string">"myfilter_shingle"</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"myfilter_shingle"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shingle"</span><span class="token punctuation">,</span>
            <span class="token comment">//这里虽然设置了2,3,但是一个单词还是存在的因为默认是保留一元组</span>
            <span class="token string-property property">"min_shingle_size"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token comment">//注意key不要空格,禁用一元组</span>
            <span class="token comment">//如果设置为false,可能会报错 "At least one unigram is required but all tokens were ngrams"</span>
            <span class="token comment">//"output_unigrams": false,</span>
            <span class="token string-property property">"max_shingle_size"</span><span class="token operator">:</span> <span class="token number">3</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">//这个是子字段,子字段是什么意思?好像就是自定义的analyzer的名字</span>
          <span class="token string-property property">"myfield"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"mytrigram"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

###测试数据
<span class="token constant">POST</span> test_shingle<span class="token operator">/</span>_bulk
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"lucene and elasticsearch"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"lucene and elasticsearhc"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"lucene"</span><span class="token punctuation">}</span>


##测试分词器
<span class="token constant">POST</span> test_shingle<span class="token operator">/</span>_analyze
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"mytrigram"</span><span class="token punctuation">,</span>
  <span class="token comment">//注意这里的组合在源数据是不一样的 前后都故意写错了</span>
  <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"luceen and elasticsearhc"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>










##注意这里是<span class="token constant">POST</span>
<span class="token constant">POST</span> test_shingle<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"Luceen and elasticsearhc"</span><span class="token punctuation">,</span>
    <span class="token comment">//这是类型还是自定义名称?</span>
    <span class="token string-property property">"myphrase"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"phrase"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"title.myfield"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"max_errors"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token comment">//候选词生成器</span>
        <span class="token string-property property">"direct_generator"</span><span class="token operator">:</span><span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"field"</span><span class="token operator">:</span><span class="token string">"title.myfield"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"suggest_mode"</span><span class="token operator">:</span><span class="token string">"always"</span>
          <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token constant">POST</span> test_shingle<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"Luceen and elasticsearhc"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"simple_phrase"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"phrase"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"title.myfield"</span><span class="token punctuation">,</span>
        <span class="token comment">//最大纠正几个单词个数;即你输入的关键字错误需要给你自动纠正 </span>
        <span class="token string-property property">"max_errors"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string-property property">"gram_size"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">"confidence"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"direct_generator"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"title.myfield"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"suggest_mode"</span><span class="token operator">:</span> <span class="token string">"always"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">//高亮标签就是命中的此项高亮显示 </span>
        <span class="token string-property property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"pre_tag"</span><span class="token operator">:</span> <span class="token string">"&lt;em&gt;"</span><span class="token punctuation">,</span>
          <span class="token string-property property">"post_tag"</span><span class="token operator">:</span> <span class="token string">"&lt;/em&gt;"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_392"></a>一些选项参数说明</h4> 
<p>文档: https://www.elastic.co/guide/en/elasticsearch/reference/7.17/search-suggesters.html</p> 
<h5><a id="real_word_error_likelihood_398"></a>real_word_error_likelihood</h5> 
<blockquote> 
 <pre><code class="prism language-english">The likelihood of a term being misspelled even if the term exists in the dictionary. The default is 0.95, meaning 5% of the real words are misspelled.
</code></pre> 
</blockquote> 
<p>即使单词在字典中存在，也有可能拼写错误的概率。默认值为0.95，表示有5%的真实单词是拼写错误的</p> 
<blockquote> 
 <ul><li>“likelihood of” 表示某个事件或情况发生的可能性。</li><li>“being misspelled” 是一个短语，表示某个单词被拼写错误。</li><li>“even if” 是一个连词，表示即使某个条件成立或某个情况存在。</li><li>“the term exists in the dictionary” 表示某个单词在字典中存在。</li></ul> 
 <p>整个句子的意思是，即使某个单词在字典中存在，仍然有可能被拼写错误。默认情况下，这个概率是0.95，也就是说有5%的真实单词会被拼写错误。</p> 
</blockquote> 
<h5><a id="max_errors_413"></a>max_errors</h5> 
<blockquote> 
 <pre><code>The maximum percentage of the terms considered to be misspellings in order to form a correction. This method accepts a float value in the range [0..1) as a fraction of the actual query terms or a number &gt;=1 as an absolute number of query terms. The default is set to 1.0, meaning only corrections with at most one misspelled term are returned. Note that setting this too high can negatively impact performance. Low values like 1 or 2 are recommended; otherwise the time spend in suggest calls might exceed the time spend in query execution.
</code></pre> 
</blockquote> 
<p>给定词项中最大纠正数量或者百分比数量,比如1就表示最大纠正一个错误词项。该方法接受一个浮点值，在范围[0…1)内作为实际查询术语的比例，或者一个大于等于1的数作为查询术语的绝对数量。默认设置为1.0，意味着只返回最多一个拼写错误术语的纠正。请注意，将此值设置得过高可能会对性能产生负面影响。建议使用较低的值，例如1或2；否则，在建议调用中花费的时间可能超过查询执行的时间。</p> 
<h5><a id="confidence_424"></a>confidence</h5> 
<blockquote> 
 <pre><code>The confidence level defines a factor applied to the input phrases score which is used as a threshold for other suggest candidates. Only candidates that score higher than the threshold will be included in the result. For instance a confidence level of 1.0 will only return suggestions that score higher than the input phrase. If set to 0.0 the top N candidates are returned. The default is 1.0.
</code></pre> 
</blockquote> 
<p>置信度定义了一个应用于输入短语得分的因子，该得分用作其他建议候选项的阈值。只有得分高于阈值的候选项才会包含在结果中。例如，置信度为1.0将仅返回得分高于输入短语的建议。如果设置为0.0，则返回排名前N的候选项。默认值为1.0。</p> 
<blockquote> 
 <pre><code>"confidence level" 表示置信度水平，即确定阈值的因子。
"factor applied to" 表示应用于某个因子的因子。
"input phrases score" 表示输入短语的得分。
"threshold for" 表示阈值，即一个标准或界限。
"suggest candidates" 表示建议的候选项。
"score higher than" 表示得分高于某个值。
"included in the result" 表示包含在结果中。
"confidence level of 1.0" 表示置信度水平为1.0。
"top N candidates" 表示排名前N的候选项。
"the default is 1.0" 表示默认值为1.0。
整个句子的意思是，置信度水平定义了一个应用于输入短语得分的因子，该得分用作其他建议候选项的阈值。只有得分高于阈值的候选项才会包含在结果中。例如，置信度为1.0将仅返回得分高于输入短语的建议。如果置信度设置为0.0，则返回排名前N的候选项。默认情况下，置信度为1.0。
</code></pre> 
</blockquote> 
<h5><a id="direct_generator_450"></a>direct_generator</h5> 
<p>phrase suggester使用候选生成器生成给定文本中每个项可能的项的列表。单个候选生成器类似于为文本中的每个单独的调用term suggester。生成器的输出随后与建议候选项中的候选项结合打分。目前只支持一种候选生成器，即direct_generator。建议API接受密钥直接生成器下的生成器列表；列表中的每个生成器都按原始文本中的每个项调用。</p> 
<h5><a id="collate_456"></a>collate</h5> 
<blockquote> 
 <pre><code>Checks each suggestion against the specified query to prune suggestions for which no matching docs exist in the index. The collate query for a suggestion is run only on the local shard from which the suggestion has been generated from. The query must be specified and it can be templated. See Search templates. The current suggestion is automatically made available as the {<!-- -->{suggestion}} variable, which should be used in your query. You can still specify your own template params — the suggestion value will be added to the variables you specify. Additionally, you can specify a prune to control if all phrase suggestions will be returned; when set to true the suggestions will have an additional option collate_match, which will be true if matching documents for the phrase was found, false otherwise. The default value for prune is false.
</code></pre> 
</blockquote> 
<ul><li> <p>参数 <code>collate</code> 是用于控制是否返回所有短语建议的选项。</p> <p>当 <code>collate</code> 参数设置为 <code>true</code> 时，短语建议结果将包含一个额外的选项 <code>collate_match</code>，用于指示与短语匹配的文档是否存在。如果 <code>collate_match</code> 为 <code>true</code>，则表示存在匹配的文档；如果 <code>collate_match</code> 为 <code>false</code>，则表示没有匹配的文档。</p> <p>这个参数的目的是对短语建议结果进行过滤，仅返回那些在索引中具有匹配文档的短语。通过设置 <code>collate</code> 参数为 <code>true</code>，您可以获取到更精确的建议结果，只包含在实际数据中有匹配的短语。</p> <p>需要注意的是，默认情况下 <code>collate</code> 参数的值为 <code>false</code>，即不进行过滤，返回所有短语建议。根据您的具体需求，您可以根据是否需要过滤匹配文档来调整 <code>collate</code> 参数的值。</p> </li><li> <p>需要提供一个具体的查询语句作为 <code>collate</code> 参数的值，该查询语句可以包含特定的搜索条件、过滤条件、排序规则等。同时，您也可以在查询语句中使用模板，以便根据实际情况动态生成查询条件。</p> <p>模板是一种在查询语句中使用占位符的方式，您可以在查询语句中定义占位符，然后在实际使用时将占位符替换为具体的值。这样可以使查询语句更加灵活和可复用。</p> <p>使用模板的好处是可以根据不同的场景和需求生成不同的查询语句，而不需要每次都手动编写和修改查询语句。这样可以提高代码的可维护性和灵活性。</p> <p>在使用 <code>collate</code> 参数时，您可以根据需要编写具体的查询语句，并在其中使用模板来灵活地生成查询条件，以便满足您的需求。</p> </li></ul> 
<h3><a id="Completion_Suggester_482"></a>Completion Suggester</h3> 
<p>自动补全，自动完成，支持三种查询【前缀查询（prefix）模糊查询（fuzzy）正则表达式查询（regex)】 ，主要针对的应用场景就是"Auto Completion"。 此场景下用户每输入一个字符的时候，就需要即时发送一次查询请求到后端查找匹配项，在用户输入速度较高的情况下对后端响应速度要求比较苛刻。因此实现上它和前面两个Suggester采用了不同的数据结构，索引并非通过倒排来完成，而是将analyze过的数据编码成FST和索引一起存放。对于一个open状态的索引，FST会被ES整个装载到内存里的，进行前缀查找速度极快。但是FST只能用于前缀查找，这也是Completion Suggester的局限所在。</p> 
<p>search_as_you_type类型构建FST存到内存中,支撑complete的高性能推荐<br> FST压缩比例的特别高,一个类似字母树的结构</p> 
<p><strong>它的高性能基于FST的压缩和内存</strong></p> 
<ul><li>completion：es的一种特有类型，专门为suggest提供，基于内存，性能很高。</li><li>prefix query：基于前缀查询的搜索提示，是最常用的一种搜索推荐查询。 
  <ul><li>prefix：客户端搜索词</li><li>field：建议词字段</li><li>size：需要返回的建议词数量（默认5）</li><li>skip_duplicates：是否过滤掉重复建议，默认false</li></ul> </li><li>fuzzy query 
  <ul><li>fuzziness：允许的偏移量，默认auto</li><li>transpositions：如果设置为true，则换位计为一次更改而不是两次更改，默认为true。</li><li>min_length：返回模糊建议之前的最小输入长度，默认 3</li><li>prefix_length：输入的最小长度（不检查模糊替代项）默认为 1</li><li>unicode_aware：如果为true，则所有度量（如模糊编辑距离，换位和长度）均以Unicode代码点而不是以字节为单位。这比原始字节略慢，因此默认情况下将其设置为false。</li></ul> </li><li>regex query：可以用正则表示前缀，不建议使用</li></ul> 
<h4><a id="_511"></a>缺点</h4> 
<ul><li> <p>内存代价太大 性能高是通过大量的内存换来的</p> </li><li> <p>只能前缀搜索,假如用户输入的不是前缀 召回率可能很低</p> </li><li> <p>只适合前缀推荐</p> </li><li> <p>需要结合特定的complete类型</p> </li></ul> 
<h4><a id="_520"></a>代码</h4> 
<pre><code class="prism language-json">
<span class="token constant">DELETE</span> test_idx_compolte_suggest
<span class="token comment">//POST 可以用来执行数据相关的查询插入操作</span>
<span class="token comment">//PUT可以用来进行元数据相关的操作,比如插入索引</span>
<span class="token constant">PUT</span> test_idx_compolte_suggest
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//字段名</span>
      <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"suggest_for_title"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"completion"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">//another column name</span>
      <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"analyzer"</span><span class="token operator">:</span><span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

##插入数据
<span class="token constant">POST</span> _bulk
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"宝马X5 两万公里准新车"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是宝马X5图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"宝马5系"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奥迪A6图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"宝马3系"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奔驰图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奥迪Q5 两万公里准新车"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是宝马X5图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奥迪A6 无敌车况"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奥迪A6图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奥迪双钻"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奔驰图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奔驰AMG 两万公里准新车"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是宝马X5图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奔驰大G 无敌车况"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奥迪A6图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"奔驰C260"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奔驰图文描述"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"index"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"_index"</span><span class="token operator">:</span><span class="token string">"test_idx_compolte_suggest"</span><span class="token punctuation">,</span><span class="token string-property property">"_id"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"title"</span><span class="token operator">:</span><span class="token string">"nir奔驰C260"</span><span class="token punctuation">,</span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"这里是奔驰图文描述"</span><span class="token punctuation">}</span>


##前缀匹配
<span class="token constant">GET</span> test_idx_compolte_suggest<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义suggest内容</span>
    <span class="token string-property property">"my_suggest_for_car"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//suggest定义前缀</span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span><span class="token string">"奔马"</span><span class="token punctuation">,</span>
      <span class="token comment">//如果使用正则就定义regex,正则性能很差不建议</span>
      <span class="token comment">//"regex":"baoma",</span>
      <span class="token comment">// suggest定义field及completion信息</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span><span class="token string">"title.suggest_for_title"</span><span class="token punctuation">,</span>
        <span class="token comment">//正则不可以使用fuzzy</span>
        <span class="token string-property property">"fuzzy"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
          <span class="token comment">//可以看设置为0,1,2的区别</span>
          <span class="token comment">//这个参数主要是为了对你的搜索词进行纠错</span>
          <span class="token string-property property">"fuzziness"</span><span class="token operator">:</span><span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">//是否去重</span>
        <span class="token string-property property">"skip_duplicates"</span><span class="token operator">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
##正则匹配
##正则性能很差不建议
##这里的正则也是匹配前缀
<span class="token constant">GET</span> test_idx_compolte_suggest<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"my_suggest_for_car"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"regex"</span><span class="token operator">:</span><span class="token string">".*"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span><span class="token string">"title.suggest_for_title"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"skip_duplicates"</span><span class="token operator">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="context_suggester_619"></a><strong>context suggester</strong></h3> 
<p>它的设计目的主要是针对completion Suggester的一些缺点进行改进,比如当数据量达到一定阈值的时候性能下降(比如内存不够进行磁盘置换),context希望通过数据过滤来达到降低数量提高性能的目的.</p> 
<p>它是建立在completion基础上增加了过滤功能.</p> 
<p>完成建议者会考虑索引中的所有文档，但是通常来说，我们在进行智能推荐的时候最好通过某些条件过滤，并且有可能会针对某些特性提升权重。</p> 
<ul><li>contexts：上下文对象，可以定义多个 
  <ul><li>name：<code>context</code>的名字，用于区分同一个索引中不同的 <code>context</code>对象。需要在查询的时候指定当前name</li><li>type：<code>context</code>对象的类型，目前支持两种：category和geo，分别用于对suggest item分类和指定地理位置。</li><li>boost：权重值，用于提升排名</li></ul> </li><li>path：如果没有path，相当于在PUT数据的时候需要指定context.name字段，如果在Mapping中指定了path，在PUT数据的时候就不需要了，因为 Mapping是一次性的，而PUT数据是频繁操作，这样就简化了代码。这段解释有木有很牛逼，网上搜到的都是官方文档的翻译，觉悟雷同。</li></ul> 
<h4><a id="_639"></a>地理位置筛选器</h4> 
<pre><code class="prism language-json"># 地理位置筛选器
<span class="token constant">PUT</span> place<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">3</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"input"</span><span class="token operator">:</span> <span class="token string">"timmy's"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"location"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"lat"</span><span class="token operator">:</span> <span class="token number">43.6624803</span><span class="token punctuation">,</span>
          <span class="token string-property property">"lon"</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">79.3863353</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"lat"</span><span class="token operator">:</span> <span class="token number">43.6624718</span><span class="token punctuation">,</span>
          <span class="token string-property property">"lon"</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">79.3873227</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token constant">POST</span> place<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"place_suggestion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"tim"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"lat"</span><span class="token operator">:</span> <span class="token number">43.662</span><span class="token punctuation">,</span>
            <span class="token string-property property">"lon"</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">79.380</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="context_suggest_688"></a>基本context_suggest使用语法</h4> 
<pre><code class="prism language-json">
<span class="token constant">DELETE</span> test_idx_context_suggest
##定义索引
<span class="token constant">PUT</span> test_idx_context_suggest
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//定义索引的suggest属性;这个是关键字</span>
      <span class="token string-property property">"suggest"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//它的type仍然是completion</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"completion"</span><span class="token punctuation">,</span>
        <span class="token comment">//可以定义多个</span>
        <span class="token comment">//这个是为了过滤用?TODO</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span><span class="token punctuation">[</span>
          <span class="token comment">//每个映射包含name和type基本属性</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//定义了这个名字如何使用呢? 这个相当于一个元字段</span>
            <span class="token comment">//插入数据时指定"my_context_name_category":["food","drink"],就相当于</span>
            <span class="token comment">//给这条数据指定了分类,在智能推荐时就可以只从这些分类或者类型的数据中进行筛选推荐</span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"my_context_name_category"</span><span class="token punctuation">,</span>
            <span class="token comment">//定义这个suggest支持的数据类型,数据类型是field type</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"category"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"my_context_name_localtion"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"geo"</span><span class="token punctuation">,</span>
            <span class="token comment">//地理精度1-12,分别代表单位厘米,分米..</span>
            <span class="token string-property property">"precision"</span><span class="token operator">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

##插入数据
<span class="token constant">POST</span> test_idx_context_suggest<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//这个表示可能的智能推荐的词</span>
    <span class="token string-property property">"input"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"timmy's"</span><span class="token punctuation">,</span> <span class="token string">"starbucks"</span><span class="token punctuation">,</span> <span class="token string">"dunkin donuts"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//这个就是上面说明的一个用户,给这个数据定义好分类</span>
    <span class="token comment">//,在推荐的时候只要满足这个分类才会被用作智能推荐</span>
    <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//这个分类的值是你自定义的</span>
      <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"cafe"</span><span class="token punctuation">,</span> <span class="token string">"food"</span> <span class="token punctuation">]</span>                
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
##插入<span class="token number">2</span>
<span class="token constant">PUT</span> test_idx_context_suggest<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//注意这条数据和上面有个重复的重复的数据,但是类型不一致</span>
    <span class="token string-property property">"input"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"monkey"</span><span class="token punctuation">,</span> <span class="token string">"timmy's"</span><span class="token punctuation">,</span> <span class="token string">"Lamborghini"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"money"</span><span class="token punctuation">]</span>                
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
##智能建议测试
<span class="token constant">GET</span> test_idx_context_suggest<span class="token operator">/</span>_search
<span class="token constant">POST</span> test_idx_context_suggest<span class="token operator">/</span>_search<span class="token operator">?</span>pretty
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//你的suggest自定义名称</span>
    <span class="token string-property property">"my_suggestion_name002"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//索引中匹配以sta前缀的词</span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"sta"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token comment">//如果不适用context就是对所有数据进行智能推荐</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"cafe"</span><span class="token punctuation">,</span> <span class="token string">"restaurants"</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

##限制分类<span class="token punctuation">,</span>测试否还能被匹配
<span class="token constant">POST</span> test_idx_context_suggest<span class="token operator">/</span>_search<span class="token operator">?</span>pretty
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//你的suggest自定义名称</span>
    <span class="token string-property property">"my_suggestion_name002"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//tim开头的在两个分类中都有,这里限制cafe分类,查看是否money分类的数据是否被匹配</span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"tim"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token comment">//如果不适用context就是对所有数据进行智能推荐</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"cafe"</span><span class="token punctuation">,</span> <span class="token string">"restaurants"</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

##增加money分类查看结果
<span class="token constant">POST</span> test_idx_context_suggest<span class="token operator">/</span>_search<span class="token operator">?</span>pretty
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//你的suggest自定义名称</span>
    <span class="token string-property property">"my_suggestion_name002"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//tim开头的在两个分类中都有,这里限制cafe分类,查看是否money分类的数据是否被匹配</span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"tim"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token comment">//如果不适用context就是对所有数据进行智能推荐</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">//增加分类后两个tim开头的都查出来了</span>
            <span class="token punctuation">{<!-- --></span><span class="token string-property property">"context"</span><span class="token operator">:</span><span class="token string">"cafe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string-property property">"context"</span><span class="token operator">:</span><span class="token string">"money"</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

##context增加排序权重
<span class="token constant">POST</span> test_idx_context_suggest<span class="token operator">/</span>_search<span class="token operator">?</span>pretty
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//你的suggest自定义名称</span>
    <span class="token string-property property">"my_suggestion_name002"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//tim开头的在两个分类中都有,这里限制cafe分类,查看是否money分类的数据是否被匹配</span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"tim"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token comment">//如果不适用context就是对所有数据进行智能推荐</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">//增加分类后两个tim开头的都查出来了</span>
            <span class="token punctuation">{<!-- --></span><span class="token string-property property">"context"</span><span class="token operator">:</span><span class="token string">"cafe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string-property property">"context"</span><span class="token operator">:</span><span class="token string">"money"</span><span class="token punctuation">,</span> <span class="token string-property property">"boost"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="context_suggest_path_849"></a>context_suggest path属性</h4> 
<pre><code class="prism language-json">

# 定义一个名为 my_context_name_category 的类别 Context，其中类别是从 my_category 字段中读取的。
# 定义一个名为 my_context_name_localtion 的地理 Context，其中的类别是从 my_location 字段中读取的
<span class="token constant">DELETE</span> test_idx_context_suggest_category_column
<span class="token constant">PUT</span> test_idx_context_suggest_category_column
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"completion"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"my_context_name_category"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"category"</span><span class="token punctuation">,</span>
            <span class="token comment">//path就是定义分类的字段,主要目的就是减少插入数据的语法简化</span>
            <span class="token comment">//可以对比插入数据的区别进行对比</span>
            <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"my_category"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"my_context_name_localtion"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"geo"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"precision"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"my_location"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">"my_location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"geo_point"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# 如果映射有路径，那么以下索引请求就足以添加类别
# 这些建议将与咖啡馆和食品类别相关联
# 如果上下文映射引用另一个字段并且类别被明确索引，则建议将使用两组类别进行索引
<span class="token constant">PUT</span> test_idx_context_suggest_category_column<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"timmy's"</span><span class="token punctuation">,</span> <span class="token string">"starbucks"</span><span class="token punctuation">,</span> <span class="token string">"dunkin donuts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"my_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"cafe"</span><span class="token punctuation">,</span> <span class="token string">"food"</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
<span class="token constant">POST</span> test_idx_context_suggest_category_column<span class="token operator">/</span>_search<span class="token operator">?</span>pretty
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"place_suggestion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"prefix"</span><span class="token operator">:</span> <span class="token string">"tim"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"completion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"field"</span><span class="token operator">:</span> <span class="token string">"suggest"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"contexts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"my_context_name_category"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                         
            <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"context"</span><span class="token operator">:</span> <span class="token string">"cafe"</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="esfield_917"></a>es支持的所有field类型</h2> 
<p>文档:</p> 
<pre><code>https://www.elastic.co/guide/en/elasticsearch/reference/7.17/mapping-types.html
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8535e78bcf4b13ee6c70d84a3eb7428/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java多线程(二)——Thread 类及常见方法和线程的基本操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22703799291365b05059e1309afeb0ff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">从OVF矢量场文件中获取磁斯格明子的位置和半径的粗略方法（trace skyrmion）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>