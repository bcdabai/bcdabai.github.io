<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用Python爬虫，查询12306车次信息 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用Python爬虫，查询12306车次信息" />
<meta property="og:description" content="效果展示： 分析目标网站： 进入12306官网以商丘南到汝州为例，在点击查询后会跳转到查询结果的网站 右键点检查或审查元素，在弹出的控制台中点网络或network，如果没有显示数据的话，刷新一下网页就有了；在点击Fetch/XHR后会发现有一个名为query...的请求，点开它后再点击预览会发现，车票的信息就在这个里面 4. 在找到存放的车票信息后，按常理直接对目标链接发送请求即可，但我们通过查看URL携带的参数时，不难发现：
- 第一个参数：查询的日期，固定格式(YYYY-MM-DD)
- 第二个和第三个参数：不同城市对应的英文代码
- 第四个参数：固定值
获取所有城市英文代码： 这里不在过多叙述，找到URL链接直接发送请求，获取响应的数据即可，代码如下： url = &#34;https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9053&#34; print(&#34;正在获取数据。&#34;) # 发送请求，获取返回的数据 res = requests.get(url) data = str(res.content, encoding=&#34;utf8&#34;) print(data) 通过返回的数据可以发现，所有的数据都是以|符号隔开的，所以使用split(&#34;|&#34;)对数据进行处理，代码如下： dict_data = dict() # 根据&#39;|&#39;分隔数据 list_data = data.split(&#39;|&#39;) # 从下标&#39;1&#39;开始, 每间隔5个为字典key result_x = list_data[1:len(list_data):5] # 从下标&#39;2&#39;开始, 每间隔5个为字典value result_y = list_data[2:len(list_data):5] # 循环将数据写入字典 for i in range(len(result_x)): dict_data[result_x[i].replace(&#34; &#34;, &#34;&#34;)] = result_y[i] print(dict_data) 将数据提取后保存到工作路径的data文件夹下，这样后期使用时，就无需再次对该网站发送请求了，代码如下： json_data = json.dumps(dict_data, indent=1, ensure_ascii=False) with open(&#34;./data/city_data.json&#34;, &#39;w&#39;) as w: w." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ec1acf1b69d3f803af7ee827f6ce4d25/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-13T11:46:48+08:00" />
<meta property="article:modified_time" content="2023-06-13T11:46:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用Python爬虫，查询12306车次信息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>效果展示：</h2> 
<p><img src="https://images2.imgbox.com/3b/6e/d8FMGlhF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/42/9f/QhMdAq6P_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_3"></a>分析目标网站：</h2> 
<ol><li>进入12306官网</li><li>以<code>商丘南</code>到<code>汝州</code>为例，在点击查询后会跳转到查询结果的网站</li></ol> 
<p><img src="https://images2.imgbox.com/11/d7/FQP83PQ0_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>右键点<code>检查</code>或<code>审查元素</code>，在弹出的控制台中点<code>网络</code>或<code>network</code>，如果没有显示数据的话，刷新一下网页就有了；在点击<code>Fetch/XHR</code>后会发现有一个名为<code>query...</code>的请求，点开它后再点击<code>预览</code>会发现，车票的信息就在这个里面</li></ol> 
<p><img src="https://images2.imgbox.com/e9/ff/SaZgpqKA_o.png" alt="在这里插入图片描述"><br> 4. 在找到存放的车票信息后，按常理直接对目标链接发送请求即可，但我们通过查看URL携带的参数时，不难发现：<br> - 第一个参数：查询的日期，固定格式(YYYY-MM-DD)<br> - 第二个和第三个参数：不同城市对应的英文代码<br> - 第四个参数：固定值</p> 
<p><img src="https://images2.imgbox.com/de/4a/LE1xtau3_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_19"></a>获取所有城市英文代码：</h2> 
<ol><li>这里不在过多叙述，找到<code>URL链接</code>直接发送请求，获取响应的数据即可，代码如下：</li></ol> 
<pre><code class="prism language-python">url <span class="token operator">=</span> <span class="token string">"https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9053"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在获取数据。"</span><span class="token punctuation">)</span>
<span class="token comment"># 发送请求，获取返回的数据</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/41/36/yj3pTtnu_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>通过返回的数据可以发现，所有的数据都是以<code>|</code>符号隔开的，所以使用<code>split("|")</code>对数据进行处理，代码如下：</li></ol> 
<pre><code class="prism language-python">dict_data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 根据'|'分隔数据</span>
list_data <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
<span class="token comment"># 从下标'1'开始, 每间隔5个为字典key</span>
result_x <span class="token operator">=</span> list_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment"># 从下标'2'开始, 每间隔5个为字典value</span>
result_y <span class="token operator">=</span> list_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment"># 循环将数据写入字典</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result_x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dict_data<span class="token punctuation">[</span>result_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> result_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dict_data<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>将数据提取后保存到工作路径的<code>data</code>文件夹下，这样后期使用时，就无需再次对该网站发送请求了，代码如下：</li></ol> 
<pre><code class="prism language-python">json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict_data<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./data/city_data.json"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> w<span class="token punctuation">:</span>
        w<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json_data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据保存完成！"</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>预览<code>city_data.json</code>文件，所有的数据都已保存在了该文件里，共三千多个不同的城市。</li></ol> 
<p><img src="https://images2.imgbox.com/46/af/IklQpLHU_o.png" alt=""></p> 
<h2><a id="_61"></a>完整版代码：</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json


<span class="token keyword">def</span> <span class="token function">get_city_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">"https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9053"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在获取数据。"</span><span class="token punctuation">)</span>
    <span class="token comment"># 发送请求，获取返回的数据</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
    <span class="token comment"># 格式化返回的数据</span>
    response_format<span class="token punctuation">(</span>data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">response_format</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dict_data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 根据'|'分隔数据</span>
    list_data <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
    <span class="token comment"># 从下标'1'开始, 每间隔5个为字典key</span>
    result_x <span class="token operator">=</span> list_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
    <span class="token comment"># 从下标'2'开始, 每间隔5个为字典value</span>
    result_y <span class="token operator">=</span> list_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
    <span class="token comment"># 循环将数据写入字典</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result_x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dict_data<span class="token punctuation">[</span>result_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> result_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment"># 保存数据</span>
    save_data<span class="token punctuation">(</span>dict_data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">save_data</span><span class="token punctuation">(</span>dict_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict_data<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./data/city_data.json"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> w<span class="token punctuation">:</span>
        w<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json_data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据保存完成！"</span><span class="token punctuation">)</span>


get_city_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="12306_104"></a>获取12306车次的信息：</h2> 
<ol><li>在前面成功获取所有城市对应的英文代码后，先让用户输入需要查询的日期、出发地和目的地信息，从文件中提取城市对应的英文代码，代码如下：</li></ol> 
<pre><code class="prism language-python">date <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入出发日期(YYYY-MM-DD)："</span><span class="token punctuation">)</span>
begin <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入出发地："</span><span class="token punctuation">)</span>
end <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入目的地："</span><span class="token punctuation">)</span>
<span class="token comment"># 读取生成的json文件</span>
city_list <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/city_data.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 获取城市对应的英文代码</span>
begin_id <span class="token operator">=</span> city_list<span class="token punctuation">[</span>begin<span class="token punctuation">]</span>
end_id <span class="token operator">=</span> city_list<span class="token punctuation">[</span>end<span class="token punctuation">]</span>
</code></pre> 
<ol start="2"><li>再获取到城市对应的英文代码后，构建请求头和需要携带的参数，代码如下：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 请求的目标链接</span>
self<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">"https://kyfw.12306.cn/otn/leftTicket/query"</span>
<span class="token comment"># 构建请求头</span>
self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment"># 失效时，需要更新cookie</span>
    <span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string">"JSESSIONID=5BCD4997EB7387D6F2F26CF860144AE6; RAIL_EXPIRATION=1653658158853; RAIL_DEVICEID=OYdRuCkXuonxJIyWihWNwMa5x-JAFt30BYWuZd9lAzHOtXh1TezSjz0oQm9n0TYq3InM3pJKfGexQCQEFpOqkTJq5XqXQ_taNYf1hTlQ6YWdWKWrJosRmvmDdUmt9omgZ2sDBAmcohSg662SJ-55JM97DtJQ0sfA; guidesStatus=off; highContrastMode=defaltMode; cursorStatus=off; BIGipServerotn=384827914.50210.0000; BIGipServerpool_passport=31719946.50215.0000; route=c5c62a339e7744272a54643b3be5bf64; _jc_save_toDate=2022-05-25; _jc_save_wfdc_flag=dc; _jc_save_fromStation=%u5546%u4E18%2CSQF; _jc_save_toStation=%u90D1%u5DDE%2CZZF; _jc_save_fromDate=2022-05-29"</span><span class="token punctuation">,</span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53"</span>
<span class="token punctuation">}</span>
<span class="token comment"># 构建请求所需参数</span>
self<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"leftTicketDTO.train_date"</span><span class="token punctuation">:</span> date<span class="token punctuation">,</span>
    <span class="token string">"leftTicketDTO.from_station"</span><span class="token punctuation">:</span> begin_id<span class="token punctuation">,</span>
    <span class="token string">"leftTicketDTO.to_station"</span><span class="token punctuation">:</span> end_id<span class="token punctuation">,</span>
    <span class="token string">"purpose_codes"</span><span class="token punctuation">:</span> <span class="token string">"ADULT"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/20/P3EIBhY2_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>构建完成必须的参数后，发送请求观察返回的数据发现，每条数据间也是由<code>|</code>隔开的，用同样的方法对数据进行分隔，代码如下：</li></ol> 
<pre><code class="prism language-python">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> params<span class="token operator">=</span>self<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_list <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> data <span class="token keyword">in</span> data_list<span class="token punctuation">:</span>
	all_data_list <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
	<span class="token comment"># 此处使用枚举，方便后期查看列表下标</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>all_data_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"[{i}__{j}]"</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>提取列表元素中的数据，获取车次的相关信息，这里直接分享我查找的，不同车次信息对应列表元素的各下标，代码如下：</li></ol> 
<pre><code class="prism language-python">trains_msg <span class="token operator">=</span> <span class="token punctuation">[</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
	all_data_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span>
<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>trains_msg<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>到此以可以获取到车次的信息了，但以这种方式显示显然并不友好，下面介绍美化方法！</li></ol> 
<h2><a id="_175"></a>以表格形式输出车次信息：</h2> 
<ol><li> <p>这里我们使用的是<code>prettytable</code>第三方库，这个库可以将我们的数据进行表格化显示，安装方法：<code>pip install prettytable</code></p> </li><li> <p>导入该模块，并实例化对象：</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token comment"># 实例化美化表格对象</span>
self<span class="token punctuation">.</span>pt<span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>构建表头，并将提取的数据以表格的形式显示出来：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 创建表头，即表格的首行信息</span>
header_list <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">[</span><span class="token string">'车次'</span><span class="token punctuation">,</span> <span class="token string">'出发时间'</span><span class="token punctuation">,</span> <span class="token string">'到达时间'</span><span class="token punctuation">,</span> <span class="token string">'历时'</span><span class="token punctuation">,</span> <span class="token string">'商务座'</span><span class="token punctuation">,</span> <span class="token string">'一等座'</span><span class="token punctuation">,</span> <span class="token string">'二等座'</span><span class="token punctuation">,</span> <span class="token string">'软卧'</span><span class="token punctuation">,</span> <span class="token string">'硬卧'</span><span class="token punctuation">,</span> <span class="token string">'硬座'</span><span class="token punctuation">,</span> <span class="token string">'无座'</span><span class="token punctuation">,</span> <span class="token string">'备注'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token comment"># 将表头信息添加进展示表格的表头</span>
self<span class="token punctuation">.</span>pt<span class="token punctuation">.</span>field_names <span class="token operator">=</span> header_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 将提取到的车次信息添加到表格的内容信息</span>
self<span class="token punctuation">.</span>pt<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>trains_msg<span class="token punctuation">)</span>
<span class="token comment"># 打印表格</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pt<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>此时的效果如下图所示，可以清晰的看出表格的对齐有点问题，所有此时为程序增加保存数据的功能！</li></ol> 
<p><img src="https://images2.imgbox.com/41/42/zJOGomcS_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Excel_206"></a>将数据保存为Excel表格：</h2> 
<ol><li> <p>这里我们使用的是<code>openpyxl</code>第三方库，这个库可以将我们的数据进行表格化显示，安装方法：<code>pip install openpyxl</code></p> </li><li> <p>导入该模块，并实例化对象：</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> Workbook
wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>因为车次信息是不定的，所有车次少时可以无需保存，这时就需要用户自己选择是否要保存信息了，代码如下：</li></ol> 
<pre><code class="prism language-python">num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"如果展示不清晰，需要保存时请扣1："</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
    wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span><span class="token string">"车次信息"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># 遍历表格索引，写入数据</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>trains_data_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>trains_data_list<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> trains_data_list<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span>
    wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>f<span class="token string">"./data/{date}_{begin}_{end}.xlsx"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据保存完成！"</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>为了更加人性化，这里通过用户输入的日期、出发地和目的地，再拼接出12306购票的直达链接，代码如下：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>
	<span class="token string">"12306直达链接(复制到浏览器打开)："</span><span class="token punctuation">,</span>
	<span class="token string">"https://kyfw.12306.cn/otn/leftTicket/init?"</span>
	<span class="token string">"linktypeid=dc&amp;"</span>
	f<span class="token string">"fs={begin},{begin_id}&amp;"</span>
	f<span class="token string">"ts={end},{end_id}&amp;"</span>
	f<span class="token string">"date={date}&amp;"</span>
	<span class="token string">"flag=N,N,Y"</span>
<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>此时就完全实现了这次的查票查询，谢谢观看~</li></ol> 
<p><img src="https://images2.imgbox.com/e2/93/XpoiFZve_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_250"></a>最终完整版代码：</h2> 
<ul><li>这个是我平时做爬虫练习时，汇总的案例的其中之一，代码比较适合新手学习，该Github仓库的爬虫案例也会在以后不断更新，有兴趣学习爬虫的可以来捧捧场哦QwQ。仓库链接：<a href="https://github.com/cjladmin/spider_cases">https://github.com/cjladmin/spider_cases</a></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> Workbook
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token keyword">from</span> save_city_list <span class="token keyword">import</span> get_city_data


<span class="token keyword">class</span> <span class="token class-name">GetTrains</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> date<span class="token punctuation">,</span> begin_id<span class="token punctuation">,</span> end_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">"https://kyfw.12306.cn/otn/leftTicket/query"</span>
        <span class="token comment"># 构建请求头</span>
        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment"># 失效时，需要更新cookie</span>
            <span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string">"JSESSIONID=5BCD4997EB7387D6F2F26CF860144AE6; RAIL_EXPIRATION=1653658158853; RAIL_DEVICEID=OYdRuCkXuonxJIyWihWNwMa5x-JAFt30BYWuZd9lAzHOtXh1TezSjz0oQm9n0TYq3InM3pJKfGexQCQEFpOqkTJq5XqXQ_taNYf1hTlQ6YWdWKWrJosRmvmDdUmt9omgZ2sDBAmcohSg662SJ-55JM97DtJQ0sfA; guidesStatus=off; highContrastMode=defaltMode; cursorStatus=off; BIGipServerotn=384827914.50210.0000; BIGipServerpool_passport=31719946.50215.0000; route=c5c62a339e7744272a54643b3be5bf64; _jc_save_toDate=2022-05-25; _jc_save_wfdc_flag=dc; _jc_save_fromStation=%u5546%u4E18%2CSQF; _jc_save_toStation=%u90D1%u5DDE%2CZZF; _jc_save_fromDate=2022-05-29"</span><span class="token punctuation">,</span>
            <span class="token comment"># "Referer": referer,</span>
            <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53"</span>
        <span class="token punctuation">}</span>
        <span class="token comment"># 构建请求所需参数</span>
        self<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"leftTicketDTO.train_date"</span><span class="token punctuation">:</span> date<span class="token punctuation">,</span>
            <span class="token string">"leftTicketDTO.from_station"</span><span class="token punctuation">:</span> begin_id<span class="token punctuation">,</span>
            <span class="token string">"leftTicketDTO.to_station"</span><span class="token punctuation">:</span> end_id<span class="token punctuation">,</span>
            <span class="token string">"purpose_codes"</span><span class="token punctuation">:</span> <span class="token string">"ADULT"</span>
        <span class="token punctuation">}</span>
        <span class="token comment"># 实例化美化表格对象</span>
        self<span class="token punctuation">.</span>pt <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 对目标网址发送请求</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> params<span class="token operator">=</span>self<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data_list <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span>
        <span class="token comment"># 构造表格的表头，用于展示和保存</span>
        header_list <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'车次'</span><span class="token punctuation">,</span> <span class="token string">'出发时间'</span><span class="token punctuation">,</span> <span class="token string">'到达时间'</span><span class="token punctuation">,</span> <span class="token string">'历时'</span><span class="token punctuation">,</span> <span class="token string">'商务座'</span><span class="token punctuation">,</span> <span class="token string">'一等座'</span><span class="token punctuation">,</span> <span class="token string">'二等座'</span><span class="token punctuation">,</span> <span class="token string">'软卧'</span><span class="token punctuation">,</span> <span class="token string">'硬卧'</span><span class="token punctuation">,</span> <span class="token string">'硬座'</span><span class="token punctuation">,</span> <span class="token string">'无座'</span><span class="token punctuation">,</span> <span class="token string">'备注'</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
        <span class="token comment"># 将表头信息添加进展示表格的表头</span>
        self<span class="token punctuation">.</span>pt<span class="token punctuation">.</span>field_names <span class="token operator">=</span> header_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> data_list<span class="token punctuation">:</span>
            <span class="token comment"># 格式化添加表数据</span>
            trains_msg <span class="token operator">=</span> self<span class="token punctuation">.</span>format_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token comment"># 将数据添加进列表，用于保存</span>
            header_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>trains_msg<span class="token punctuation">)</span>
        <span class="token comment"># 打印表格</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pt<span class="token punctuation">)</span>
        <span class="token comment"># 返回车次信息列表</span>
        <span class="token keyword">return</span> header_list

    <span class="token keyword">def</span> <span class="token function">format_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 将返回的数据以'|'进行分隔</span>
        all_data_list <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>
        <span class="token comment"># 提取车次的信息</span>
        trains_msg <span class="token operator">=</span> <span class="token punctuation">[</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span><span class="token punctuation">,</span>
            all_data_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> all_data_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token string">"--"</span>
        <span class="token punctuation">]</span>
        <span class="token comment"># 增添表内容</span>
        self<span class="token punctuation">.</span>pt<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>trains_msg<span class="token punctuation">)</span>
        <span class="token comment"># 将提取的信息返回，用于保存</span>
        <span class="token keyword">return</span> trains_msg

    <span class="token keyword">def</span> <span class="token function">save_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> trains_data_list<span class="token punctuation">,</span> date<span class="token punctuation">,</span> begin<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"如果展示不清晰，需要保存时请扣1："</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
            wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
            sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>create_sheet<span class="token punctuation">(</span><span class="token string">"车次信息"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># 遍历表格索引，写入数据</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>trains_data_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>trains_data_list<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> trains_data_list<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span>
            wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>f<span class="token string">"./data/{date}_{begin}_{end}.xlsx"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据保存完成！"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 更新城市对应的英文代码，需要时再启用</span>
    <span class="token comment"># get_city_data()</span>
    date <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入出发日期(YYYY-MM-DD)："</span><span class="token punctuation">)</span>
    begin <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入出发地："</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入目的地："</span><span class="token punctuation">)</span>
    <span class="token comment"># 读取生成的json文件</span>
    city_list <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/city_data.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取城市对应的英文代码</span>
    begin_id <span class="token operator">=</span> city_list<span class="token punctuation">[</span>begin<span class="token punctuation">]</span>
    end_id <span class="token operator">=</span> city_list<span class="token punctuation">[</span>end<span class="token punctuation">]</span>
    gt <span class="token operator">=</span> GetTrains<span class="token punctuation">(</span>date<span class="token punctuation">,</span> begin_id<span class="token punctuation">,</span> end_id<span class="token punctuation">)</span>
    trains_data_list <span class="token operator">=</span> gt<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 是否需要保存数据</span>
    gt<span class="token punctuation">.</span>save_data<span class="token punctuation">(</span>trains_data_list<span class="token punctuation">,</span> date<span class="token punctuation">,</span> begin<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>
        <span class="token string">"12306直达链接(复制到浏览器打开)："</span><span class="token punctuation">,</span>
        <span class="token string">"https://kyfw.12306.cn/otn/leftTicket/init?"</span>
        <span class="token string">"linktypeid=dc&amp;"</span>
        f<span class="token string">"fs={begin},{begin_id}&amp;"</span>
        f<span class="token string">"ts={end},{end_id}&amp;"</span>
        f<span class="token string">"date={date}&amp;"</span>
        <span class="token string">"flag=N,N,Y"</span>
    <span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36b7e0ad29d4883e8e91fe266125cb31/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TPS波动较大问题排查</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ac993f91ca66108b79d23e8c14ae2aa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于MATLAB的人脸识别系统（包含传统/深度学习方法）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>