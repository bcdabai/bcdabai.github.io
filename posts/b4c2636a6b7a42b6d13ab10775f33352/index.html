<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt中串口模块的使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt中串口模块的使用" />
<meta property="og:description" content="串口模块介绍 1、简介 在Qt的拓展模块中，Qt提供了许多的结果通讯模块，有串口、can、 ModBus等。下面就简单介绍一些Qt中的串口模块。
Qt串口提供基本功能，包括配置、I/O操作、获取和设置RS-232引脚的控制信号。
Qt串口模块不支持以下功能：
终端功能，如回声、控制CR/LF等。
文本模式。
配置读取或写入时的超时和延迟。
引脚输出信号更改通知。
特殊收发器条件，如帧错误、奇偶校验错误和中断条件错误。
2、包含类 在Qt串口模块中主要使用的类有两个：
QSerialPort提供访问串行端口的功能QSerialPortInfo提供有关现有串行端口的信息 串口模块使用 串口的使用步骤如下：
1、在项目中引入串口模块
QT &#43;= serialport 2、添加串口类相关头文件
#include &lt;QSerialPort&gt; #include &lt;QSerialPortInfo&gt; 3、使用QSerialPortInfo中的静态文件获取设备中的串口信息。availablePorts()函数返回的是一个串口信息的列表。
foreach(const QSerialPortInfo &amp;Info, QSerialPortInfo::availablePorts()) { //读取串口信息 m_serialPort-&gt;setPort(Info); if( m_serialPort-&gt;open(QIODevice::ReadWrite) ) { portnames.append(Info.portName()); m_serialPort-&gt;close(); } } 4、创建一个QSerialPort类对象，使用通过availablePorts()函数获取的串口信息，设置需要打开的串口号、波特率、校验位等一些串口信息。设置的函数如下：
boolsetBaudRate(qint32 baudRate, QSerialPort::Directions directions = AllDirections)设置波特率boolsetBreakEnabled(bool set = true)boolsetDataBits(QSerialPort::DataBits dataBits)设置数据位boolsetDataTerminalReady(bool set)boolsetFlowControl(QSerialPort::FlowControl flowControl)设置流量控制模式boolsetParity(QSerialPort::Parity parity)设置校验模式voidsetPort(const QSerialPortInfo &amp;serialPortInfo)voidsetPortName(const QString &amp;name)设置串口号voidsetReadBufferSize(qint64 size)设置读写缓存区大小boolsetRequestToSend(bool set)设置保持线路信号RTS的状态（高或低）boolsetStopBits(QSerialPort::StopBits stopBits)设置停止位 5、设置完各种参数之后就可以打开串口了，打开串口使用serialPort类中的open函数。此函数需要传入一个权限控制：读、写、读写等。
bool MySerialPort::openSeriaPort(QSerialPort::OpenMode openmode){ return m_serialPort-&gt;open(openmode); } 6、在Qt中使用QSerialPort::readyRead信号通知程序有数据上来。之后程序在使用readAll()函数获取缓存区中数据。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b4c2636a6b7a42b6d13ab10775f33352/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-01T12:51:37+08:00" />
<meta property="article:modified_time" content="2023-11-01T12:51:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt中串口模块的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>串口模块介绍</h3> 
<h4><a id="1_2"></a>1、简介</h4> 
<p>在Qt的拓展模块中，Qt提供了许多的结果通讯模块，有串口、can、 ModBus等。下面就简单介绍一些Qt中的串口模块。</p> 
<p>Qt串口提供基本功能，包括配置、I/O操作、获取和设置RS-232引脚的控制信号。</p> 
<p>Qt串口模块不支持以下功能：</p> 
<ul><li> <p>终端功能，如回声、控制CR/LF等。</p> </li><li> <p>文本模式。</p> </li><li> <p>配置读取或写入时的超时和延迟。</p> </li><li> <p>引脚输出信号更改通知。</p> </li><li> <p>特殊收发器条件，如帧错误、奇偶校验错误和中断条件错误。</p> </li></ul> 
<h4><a id="2_27"></a>2、包含类</h4> 
<p>在Qt串口模块中主要使用的类有两个：</p> 
<table><thead><tr><th>QSerialPort</th><th>提供访问串行端口的功能</th></tr></thead><tbody><tr><td>QSerialPortInfo</td><td>提供有关现有串行端口的信息</td></tr></tbody></table> 
<h3><a id="_35"></a>串口模块使用</h3> 
<p><strong>串口的使用步骤如下：</strong></p> 
<p>1、在项目中引入串口模块</p> 
<pre><code class="prism language-cpp">QT <span class="token operator">+=</span> serialport
</code></pre> 
<p>2、添加串口类相关头文件</p> 
<pre><code>#include &lt;QSerialPort&gt;
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPortInfo&gt;</span></span>
</code></pre> 
<p>3、使用QSerialPortInfo中的静态文件获取设备中的串口信息。availablePorts()函数返回的是一个串口信息的列表。</p> 
<pre><code class="prism language-cpp">    <span class="token function">foreach</span><span class="token punctuation">(</span><span class="token keyword">const</span> QSerialPortInfo <span class="token operator">&amp;</span>Info<span class="token punctuation">,</span> <span class="token class-name">QSerialPortInfo</span><span class="token double-colon punctuation">::</span><span class="token function">availablePorts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//读取串口信息</span>
         m_serialPort<span class="token operator">-&gt;</span><span class="token function">setPort</span><span class="token punctuation">(</span>Info<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadWrite<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             portnames<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>Info<span class="token punctuation">.</span><span class="token function">portName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             m_serialPort<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre> 
<p>4、创建一个QSerialPort类对象，使用通过availablePorts()函数获取的串口信息，设置需要打开的串口号、波特率、校验位等一些串口信息。设置的函数如下：</p> 
<table><thead><tr><th>bool</th><th>setBaudRate(qint32 <em>baudRate</em>, QSerialPort::Directions <em>directions</em> = AllDirections)</th><th>设置波特率</th></tr></thead><tbody><tr><td>bool</td><td>setBreakEnabled(bool <em>set</em> = true)</td><td></td></tr><tr><td>bool</td><td>setDataBits(QSerialPort::DataBits <em>dataBits</em>)</td><td>设置数据位</td></tr><tr><td>bool</td><td>setDataTerminalReady(bool <em>set</em>)</td><td></td></tr><tr><td>bool</td><td>setFlowControl(QSerialPort::FlowControl <em>flowControl</em>)</td><td>设置流量控制模式</td></tr><tr><td>bool</td><td>setParity(QSerialPort::Parity <em>parity</em>)</td><td>设置校验模式</td></tr><tr><td>void</td><td>setPort(const QSerialPortInfo &amp;<em>serialPortInfo</em>)</td><td></td></tr><tr><td>void</td><td>setPortName(const QString &amp;<em>name</em>)</td><td>设置串口号</td></tr><tr><td>void</td><td>setReadBufferSize(qint64 <em>size</em>)</td><td>设置读写缓存区大小</td></tr><tr><td>bool</td><td>setRequestToSend(bool <em>set</em>)</td><td>设置保持线路信号RTS的状态（高或低）</td></tr><tr><td>bool</td><td>setStopBits(QSerialPort::StopBits <em>stopBits</em>)</td><td>设置停止位</td></tr></tbody></table> 
<p>5、设置完各种参数之后就可以打开串口了，打开串口使用serialPort类中的open函数。此函数需要传入一个权限控制：读、写、读写等。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">openSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OpenMode openmode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span>openmode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>6、在Qt中使用QSerialPort::readyRead信号通知程序有数据上来。之后程序在使用readAll()函数获取缓存区中数据。</p> 
<pre><code class="prism language-cpp"><span class="token function">connect</span><span class="token punctuation">(</span>m_serialPort<span class="token punctuation">,</span><span class="token operator">&amp;</span>QSerialPort<span class="token double-colon punctuation">::</span>readyRead<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"MySerialPort createSeriaPort readDate"</span><span class="token punctuation">;</span>
        <span class="token function">readDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">readDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    QByteArray data <span class="token operator">=</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emit <span class="token function">haveReceive</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>7、Qt串口模块中使用QSerialPort中的write函数写入数据，并发送。</p> 
<pre><code class="prism language-cpp">qint64 <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">writeDate</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>至此，Qt中串口的基础使用已经完成，可以进行串口数据交互了，</p> 
<h4><a id="_117"></a>例子</h4> 
<p>一下自己是一个简单的串口使用Demo。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">MAINWINDOW_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAINWINDOW_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMainWindow&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPort&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPortInfo&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QTextBrowser&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLineEdit&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"myserialport.h"</span></span>
QT_BEGIN_NAMESPACE
<span class="token keyword">namespace</span> Ui <span class="token punctuation">{<!-- --></span> <span class="token keyword">class</span> <span class="token class-name">MainWindow</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
QT_END_NAMESPACE

<span class="token keyword">class</span> <span class="token class-name">MainWindow</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QMainWindow</span></span>
<span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MainWindow</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">MainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QSerialPort <span class="token operator">*</span>serial<span class="token punctuation">;</span>
    QLineEdit <span class="token operator">*</span>fasong<span class="token punctuation">;</span>
    QTextBrowser <span class="token operator">*</span>jieshou<span class="token punctuation">;</span>

    MySerialPort serialPort<span class="token punctuation">;</span>



<span class="token keyword">private</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButton_2_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_comboBox_currentTextChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_comboBox_2_currentTextChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">readBytes</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    Ui<span class="token double-colon punctuation">::</span>MainWindow <span class="token operator">*</span>ui<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// MAINWINDOW_H</span></span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mainwindow.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ui_mainwindow.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPort&gt;</span></span>

<span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">MainWindow</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QMainWindow</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>MainWindow<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"主窗口构造函数"</span><span class="token punctuation">;</span>

    fasong <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>fasong<span class="token punctuation">;</span>
    jieshou <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>jieshou<span class="token punctuation">;</span>
    serialPort<span class="token punctuation">.</span><span class="token function">createSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>Data8<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>NoParity<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>OneStop<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>NoFlowControl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>serialPort<span class="token punctuation">,</span><span class="token operator">&amp;</span>MySerialPort<span class="token double-colon punctuation">::</span>haveReceive<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>MainWindow<span class="token double-colon punctuation">::</span>readBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    QStringList lists <span class="token operator">=</span> serialPort<span class="token punctuation">.</span><span class="token function">getPortNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">foreach</span> <span class="token punctuation">(</span>QString str<span class="token punctuation">,</span> lists<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        ui<span class="token operator">-&gt;</span>comboBox<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ui<span class="token operator">-&gt;</span>comboBox_2<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token string">"1200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>comboBox_2<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token string">"2400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>comboBox_2<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token string">"4800"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>comboBox_2<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token string">"9600"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>comboBox_2<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token string">"19200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">MainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span>
    serialPort<span class="token punctuation">.</span><span class="token function">closeSeriaPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
     <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"发送数据"</span> <span class="token punctuation">;</span>

    QByteArray data <span class="token operator">=</span> fasong<span class="token operator">-&gt;</span><span class="token function">displayText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    serialPort<span class="token punctuation">.</span><span class="token function">writeDate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//串口发数据</span>
<span class="token punctuation">}</span>


<span class="token comment">//cpp</span>
<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">readBytes</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"接收数据"</span> <span class="token punctuation">;</span>
    jieshou<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_2_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
     <span class="token comment">//打开串口</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>serialPort<span class="token punctuation">.</span><span class="token function">openSeriaPort</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"串口打开失败"</span> <span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_comboBox_currentTextChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>arg1<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   serialPort<span class="token punctuation">.</span><span class="token function">setPortName</span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">on_comboBox_2_currentTextChanged</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>arg1<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//设置波特率</span>
    serialPort<span class="token punctuation">.</span><span class="token function">setBaudRate</span><span class="token punctuation">(</span>arg1<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">/***************************************************************
* 文件名称: MySerialPort
* 文件功能: 封装qt中的串口创建
* 开发时间: 
* 开发人:  
***************************************************************/</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">MYSERIALPORT_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MYSERIALPORT_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPort&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSerialPortInfo&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">MySerialPort</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QObject</span></span>
<span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/**
     * @brief MySerialPort 构造函数，没有具体意义
     * @param parent
     */</span>
    <span class="token function">MySerialPort</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief ~MySerialPort 析构函数，用于释放new 的串口实例
     */</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">MySerialPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief createSeriaPort 用于创建串口对象
     * @param dataBits   数据位数
     * @param parity     奇偶校验
     * @param stopBits   停止位数
     * @param flowControl 流量控制
     * @return
     */</span>
    <span class="token keyword">bool</span> <span class="token function">createSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>DataBits dataBits<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>Parity parity<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>StopBits stopBits<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>FlowControl flowControl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief readDate 读取数据，此函数会发送一个带参数的信号
     */</span>
    <span class="token keyword">void</span> <span class="token function">readDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief writeDate 发送数据
     * @param data      想要发送的数据
     * @param len       想要发送数据的长度
     * @return          是否发送成功
     */</span>
    qint64 <span class="token function">writeDate</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief setPortName 设置端口号
     * @param portName    端口号
     */</span>
    <span class="token keyword">void</span> <span class="token function">setPortName</span><span class="token punctuation">(</span>QString portName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief setBaudRate 设置波特率
     * @param baudRate    波特率
     * @return
     */</span>
    <span class="token keyword">bool</span> <span class="token function">setBaudRate</span><span class="token punctuation">(</span><span class="token keyword">int</span> baudRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief getPortNames  获取当前系统中可用的串口
     * @return              返回值为一个字符串列表
     */</span>
    QStringList <span class="token function">getPortNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief openSeriaPort 打开串口
     * @param openmode      打开串口模式
     * @return
     */</span>
    <span class="token keyword">bool</span> <span class="token function">openSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OpenMode openmode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * @brief closeSeriaPort 关闭串口
     */</span>
    <span class="token keyword">void</span> <span class="token function">closeSeriaPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

signals<span class="token operator">:</span>
    <span class="token comment">/**
     * @brief haveReceive 向外部发送接收串口数据的函数
     * @param data
     */</span>
    <span class="token keyword">void</span> <span class="token function">haveReceive</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">private</span><span class="token operator">:</span>
    QSerialPort <span class="token operator">*</span> m_serialPort <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// MYSERIALPORT_H</span></span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"myserialport.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">MySerialPort</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">MySerialPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m_serialPort <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">delete</span> m_serialPort<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">createSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>DataBits dataBits<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>Parity parity<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>StopBits stopBits<span class="token punctuation">,</span>QSerialPort<span class="token double-colon punctuation">::</span>FlowControl flowControl<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"MySerialPort createSeriaPort"</span><span class="token punctuation">;</span>
    m_serialPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSerialPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_serialPort<span class="token operator">-&gt;</span><span class="token function">setDataBits</span><span class="token punctuation">(</span>dataBits<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_serialPort<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>parity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_serialPort<span class="token operator">-&gt;</span><span class="token function">setStopBits</span><span class="token punctuation">(</span>stopBits<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_serialPort<span class="token operator">-&gt;</span><span class="token function">setFlowControl</span><span class="token punctuation">(</span>flowControl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>m_serialPort<span class="token punctuation">,</span><span class="token operator">&amp;</span>QSerialPort<span class="token double-colon punctuation">::</span>readyRead<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"MySerialPort createSeriaPort readDate"</span><span class="token punctuation">;</span>
        <span class="token function">readDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">readDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    QByteArray data <span class="token operator">=</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emit <span class="token function">haveReceive</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

qint64 <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">writeDate</span><span class="token punctuation">(</span>QByteArray data<span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">setPortName</span><span class="token punctuation">(</span>QString portName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    m_serialPort<span class="token operator">-&gt;</span><span class="token function">setPortName</span><span class="token punctuation">(</span>portName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">setBaudRate</span><span class="token punctuation">(</span><span class="token keyword">int</span> baudRate<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span>  m_serialPort<span class="token operator">-&gt;</span><span class="token function">setBaudRate</span><span class="token punctuation">(</span>baudRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QStringList <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">getPortNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    QStringList portnames<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m_serialPort <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span>  portnames<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">foreach</span><span class="token punctuation">(</span><span class="token keyword">const</span> QSerialPortInfo <span class="token operator">&amp;</span>Info<span class="token punctuation">,</span> <span class="token class-name">QSerialPortInfo</span><span class="token double-colon punctuation">::</span><span class="token function">availablePorts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//读取串口信息</span>
         m_serialPort<span class="token operator">-&gt;</span><span class="token function">setPort</span><span class="token punctuation">(</span>Info<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadWrite<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             portnames<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>Info<span class="token punctuation">.</span><span class="token function">portName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             m_serialPort<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
    <span class="token keyword">return</span> portnames<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">openSeriaPort</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OpenMode openmode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_serialPort<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span>openmode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">MySerialPort</span><span class="token double-colon punctuation">::</span><span class="token function">closeSeriaPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     m_serialPort<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9192342807c85dd0e6c5065677bceb96/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【安装】自建Rustdesk Server</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c53b7a6bfc45b117a705cf693f936d18/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java面试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>