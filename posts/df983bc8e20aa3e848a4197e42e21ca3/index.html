<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>三、高质量编程与性能调优实战 青训营笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="三、高质量编程与性能调优实战 青训营笔记" />
<meta property="og:description" content="高质量编程与性能调优实战 | 青训营笔记 这是我参与「第三届青训营 -后端场」笔记创作活动的的第3篇笔记
高质量原则：1、简单性 2、可读性 3、生产力
注释规范 代码是最好的注释，注释应该提供代码未表达出的上下文信息，公共符号始终要注释
注释应该解释代码作用注释应该解释代码如何做的注释应该解释代码实现的原因注释应该解释代码什么情况会出错 命名规范 变量命名 包含变量名的信息量有特定的含义避免传入错误的值，造成非预期的错误 函数命名 不携带包名的上下文信息
尽可能简短
eg：
包名命名 只由小写字母组成。不包含大写字母和下划线等字符包含一定上下文信息不与标准库同名。 编码规范 控制流程 避免嵌套
如果if else的两个分支都包含return语句，则可以去除冗余的else方便后续维护，else一般是正常流程，如过需要在正常流程新增判断逻辑，避免分支嵌套
优先处理错误和特殊情况，尽早返回或继续循环来减少嵌套
错误和异常处理 简单错误 优先使用errors.New来创建匿名变量来直接表示简单错误如果有格式化的需求，使用fmt.Errorf 复杂错误（Wrap和Unwrap） ​ Wrap提供了一个error嵌套另一个error的能力，从而生成一个error的跟踪链
​ 在fmt.Errorf中使用：%w关键字来将一个错误关联至错误链中
错误判定 特定错误：使用errors.Is来判断是否为特定错误。不同于使用==，使用该方法可以判定错误链上的所有错误是否含有特定错误
特定种类的错误：在错误链上获取特定种类的错误，使用errors.As
panic(注意！我项目里老爱用) 只用于真正异常的情况
不建议使用（当程序启动阶段发生不可逆转的错误时，可以在init或main函数中使用panic）
recover recover生效范围，在当前goroutine的被defer的函数中生效嵌套无法生效
defer的语句是后进先出
常见情况是记录panic的调用栈信息，出现问题时能够方便分析定位。如果需要更多的上下文信息，可以recover后在log中记录当前的调用栈
性能优化（Benchmark工具） slice使用建议 ​ slice预分配内存，预估空间
尽可能在使用make()初始化切片时提供容量信息，避免多次拓展（因为要在内存中新开辟一个更大的空间存放并并复制，很浪费）可使用copy代替新建一个slice（避免调用原切片占用的巨大空间，使得原切片的大内存得不到释放） map使用建议 ​ 预分配内存，预估空间，以减少内存拷贝和Rehash消耗
字符串处理 ​ 三种字符串拼接方式中，strings.Builder最快，bytes.Buffer其次，&#43;最慢
​ 当使用&#43;拼接2个字符串时，生成一个新的字符串，就需要开辟一段新的空间，新空间的大小是原来两个字符串的大小之和。拼接第三个字符串时，再开辟一段新空间、新空间大小是三个字符串的大小之和，以此类推
​ 而strings.Builder，bytes.Buffer底层都是[]byte 数组内存扩容策略，不需要每次拼接时重新分配内存
空结构体 ​ 空结构体不占据内存空间，可作为占位符使用
实现Set，可以考虑用map来代替对于这个场景，只需要用到map的键，而不需要值即使是将map的值设置为bool类型，也会多占据1个字节空间 atomic包和加锁的区别 锁是通过操作系统实现，属于系统调用
atomic操作是通过硬件实现，效率比锁高
sync.Mutex应该用来保护一段逻辑，不仅仅用于保护一个变量
对于非数值操作，可以使用atomic.Value，能承载一个interface{}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/df983bc8e20aa3e848a4197e42e21ca3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-03T21:43:16+08:00" />
<meta property="article:modified_time" content="2022-07-03T21:43:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">三、高质量编程与性能调优实战 青训营笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="___0"></a>高质量编程与性能调优实战 | 青训营笔记</h2> 
<p>这是我参与「第三届青训营 -后端场」笔记创作活动的的第3篇笔记</p> 
<p>高质量原则：1、简单性 2、可读性 3、生产力</p> 
<h3><a id="_6"></a>注释规范</h3> 
<p>代码是最好的注释，注释应该提供代码未表达出的上下文信息，公共符号始终要注释</p> 
<ul><li>注释应该解释代码作用</li><li>注释应该解释代码如何做的</li><li>注释应该解释代码实现的原因</li><li>注释应该解释代码什么情况会出错</li></ul> 
<h3><a id="_15"></a>命名规范</h3> 
<h4><a id="_17"></a>变量命名</h4> 
<ul><li>包含变量名的信息量</li><li>有特定的含义</li><li>避免传入错误的值，造成非预期的错误</li></ul> 
<h4><a id="_23"></a>函数命名</h4> 
<ul><li> <p>不携带包名的上下文信息</p> </li><li> <p>尽可能简短</p> <p>eg：</p> <p><img src="https://images2.imgbox.com/de/22/rcsDIcGg_o.png" alt="image-20220511203637170"></p> </li></ul> 
<h4><a id="_33"></a>包名命名</h4> 
<ul><li>只由小写字母组成。不包含大写字母和下划线等字符</li><li>包含一定上下文信息</li><li>不与标准库同名。</li></ul> 
<h3><a id="_39"></a>编码规范</h3> 
<h4><a id="_41"></a>控制流程</h4> 
<ul><li> <p>避免嵌套<br> 如果if else的两个分支都包含return语句，则可以去除冗余的else方便后续维护，else一般是正常流程，如过需要在正常流程新增判断逻辑，避免分支嵌套</p> <p><img src="https://images2.imgbox.com/5e/5f/eVQymBLn_o.png" alt="image-20220511204139403"></p> </li><li> <p>优先处理错误和特殊情况，尽早返回或继续循环来减少嵌套</p> </li></ul> 
<h4><a id="_50"></a>错误和异常处理</h4> 
<h5><a id="_52"></a>简单错误</h5> 
<ul><li>优先使用errors.New来创建匿名变量来直接表示简单错误</li><li>如果有格式化的需求，使用fmt.Errorf</li></ul> 
<h5><a id="WrapUnwrap_57"></a>复杂错误（Wrap和Unwrap）</h5> 
<p>​ Wrap提供了一个error嵌套另一个error的能力，从而生成一个error的跟踪链</p> 
<p>​ 在fmt.Errorf中使用：%w关键字来将一个错误关联至错误链中</p> 
<h5><a id="_63"></a>错误判定</h5> 
<ul><li> <p>特定错误：使用errors.Is来判断是否为特定错误。不同于使用==，使用该方法可以判定<strong>错误链上的所有错误</strong>是否含有特定错误</p> </li><li> <p>特定种类的错误：在错误链上获取特定种类的错误，使用errors.As</p> </li></ul> 
<h5><a id="panic_69"></a>panic(注意！我项目里老爱用)</h5> 
<ul><li> <p>只用于真正异常的情况</p> </li><li> <p>不建议使用（当程序启动阶段发生不可逆转的错误时，可以在init或main函数中使用panic）</p> </li></ul> 
<h5><a id="recover_75"></a>recover</h5> 
<ul><li> <p>recover生效范围，在当前goroutine的被defer的函数中生效嵌套无法生效</p> </li><li> <p>defer的语句是后进先出</p> </li><li> <p>常见情况是记录panic的调用栈信息，出现问题时能够方便分析定位。如果需要更多的上下文信息，可以recover后在log中记录当前的调用栈</p> </li></ul> 
<h3><a id="Benchmark_84"></a>性能优化（Benchmark工具）</h3> 
<h5><a id="slice_86"></a>slice使用建议</h5> 
<p>​ slice预分配内存，预估空间</p> 
<ul><li>尽可能在使用make()初始化切片时提供容量信息，避免多次拓展（因为要在内存中新开辟一个更大的空间存放并并复制，很浪费）</li><li>可使用copy代替新建一个slice（避免调用原切片占用的巨大空间，使得原切片的大内存得不到释放）</li></ul> 
<h5><a id="map_93"></a>map使用建议</h5> 
<p>​ 预分配内存，预估空间，以减少内存拷贝和Rehash消耗</p> 
<h5><a id="_97"></a>字符串处理</h5> 
<p>​ 三种字符串拼接方式中，strings.Builder最快，bytes.Buffer其次，+最慢</p> 
<p>​ 当使用+拼接2个字符串时，生成一个新的字符串，就需要开辟一段新的空间，新空间的大小是原来两个字符串的大小之和。拼接第三个字符串时，再开辟一段新空间、新空间大小是三个字符串的大小之和，以此类推</p> 
<p>​ 而strings.Builder，bytes.Buffer底层都是[]byte 数组内存扩容策略，不需要每次拼接时重新分配内存</p> 
<h5><a id="_105"></a>空结构体</h5> 
<p>​ 空结构体不占据内存空间，可作为占位符使用</p> 
<ul><li>实现Set，可以考虑用map来代替</li><li>对于这个场景，只需要用到map的键，而不需要值</li><li>即使是将map的值设置为bool类型，也会多占据1个字节空间</li></ul> 
<h5><a id="atomic_113"></a>atomic包和加锁的区别</h5> 
<ul><li> <p>锁是通过操作系统实现，属于系统调用</p> </li><li> <p>atomic操作是通过硬件实现，效率比锁高</p> </li><li> <p>sync.Mutex应该用来保护一段逻辑，不仅仅用于保护一个变量</p> </li><li> <p>对于非数值操作，可以使用atomic.Value，能承载一个interface{}</p> </li></ul> 
<h3><a id="_122"></a>性能调优</h3> 
<h5><a id="_124"></a>原则</h5> 
<ul><li>要依靠数据不是猜测</li><li>要定位最大瓶颈而不是细枝末节</li><li>不要过早优化</li><li>不要过度优化</li></ul> 
<h5><a id="pprof_131"></a>性能分析工具pprof</h5> 
<p>作，可以使用atomic.Value，能承载一个interface{}</p> 
<h3><a id="_135"></a>性能调优</h3> 
<h5><a id="_137"></a>原则</h5> 
<ul><li>要依靠数据不是猜测</li><li>要定位最大瓶颈而不是细枝末节</li><li>不要过早优化</li><li>不要过度优化</li></ul> 
<h5><a id="pprof_144"></a>性能分析工具pprof</h5> 
<p>官方文档：https://blog.wolfogre.com/posts/go-ppof-practice/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ab9e70d0441600a85558a13db36ba59c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux CFS调度 记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d5a26aa743bcdea9c0e204fd64e57482/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">四、高性能 Go 语言发行版优化与落地实践 青训营笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>