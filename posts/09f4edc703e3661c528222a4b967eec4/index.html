<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【数据压缩】--LZW算法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【数据压缩】--LZW算法" />
<meta property="og:description" content="文章目录 LZW算法原理LZW编码编码算法的思想数据结构分析主要功能模块初始化词典查找词典中是否有字符串将新串加入词典编码 LZW解码解码算法的思想解码LZWDecodeDecodeString 调试程序编码解码 压缩效率分析十种不同格式文件的压缩效率更改词典总数上限后的编码效率字符重复率很高的文本文档LZW算法的优缺点 程序代码 LZW算法原理 LZW编码 编码算法的思想 步骤1：将词典初始化为包含所有可能的单字符，当前前缀P初始化为空。
步骤2：当前字符C=字符流中的下一个字符。
步骤3：判断P&#43;C是否在词典中：
（1）如果是，则用C扩展P，即P=P&#43;C，返回到步骤2.
（2）如果否，则 输出与当前前缀P相对应的码字W;将P&#43;C添加到词典中；令P=C,并返回到步骤2.
数据结构分析 尾缀字符suffix母节点parent第一个孩子节点firstchild下一个兄弟节点nextsibling 树用数组表示，数组下标用pointer表示，dict[pointer]表示一个节点：
dict[pointer].suffix
dict[pointer].parent
dict[pointer].firstchild
dict[pointer].nextsibling
struct { int suffix; int parent, firstchild, nextsibling; } dictionary[MAX_CODE&#43;1]; int next_code; int d_stack[MAX_CODE]; // stack for decoding a phrase 主要功能模块 初始化词典 void InitDictionary( void){//初始化词典，将0-255根节点初始化 int i; for( i=0; i&lt;256; i&#43;&#43;){ dictionary[i].suffix = i;//尾缀字符 dictionary[i].parent = -1;//母节点初始化为空 dictionary[i].firstchild = -1;//子节点初始化为空 dictionary[i].nextsibling = i&#43;1;//下一个兄弟节点 } dictionary[255].nextsibling = -1;//最后一个节点无下一个兄弟 next_code = 256;//新词条编码为256 } 查找词典中是否有字符串 将当前字符依次与当前前缀的孩子节点进行比较，相同时说明词典中有该字符串，否则说明词典中没有该字符串，返回-1。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/09f4edc703e3661c528222a4b967eec4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-20T22:51:22+08:00" />
<meta property="article:modified_time" content="2022-04-20T22:51:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【数据压缩】--LZW算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#LZW_1" rel="nofollow">LZW算法原理</a></li><li><ul><li><a href="#LZW_2" rel="nofollow">LZW编码</a></li><li><ul><li><a href="#_3" rel="nofollow">编码算法的思想</a></li><li><a href="#_10" rel="nofollow">数据结构分析</a></li><li><a href="#_33" rel="nofollow">主要功能模块</a></li><li><ul><li><a href="#_34" rel="nofollow">初始化词典</a></li><li><a href="#_51" rel="nofollow">查找词典中是否有字符串</a></li><li><a href="#_66" rel="nofollow">将新串加入词典</a></li><li><a href="#_88" rel="nofollow">编码</a></li></ul> 
   </li></ul> 
   </li><li><a href="#LZW_120" rel="nofollow">LZW解码</a></li><li><ul><li><a href="#_122" rel="nofollow">解码算法的思想</a></li><li><a href="#_134" rel="nofollow">解码</a></li><li><ul><li><a href="#LZWDecode_138" rel="nofollow">LZWDecode</a></li><li><a href="#DecodeString_193" rel="nofollow">DecodeString</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_210" rel="nofollow">调试程序</a></li><li><ul><li><a href="#_216" rel="nofollow">编码</a></li><li><a href="#_236" rel="nofollow">解码</a></li></ul> 
  </li><li><a href="#_243" rel="nofollow">压缩效率分析</a></li><li><ul><li><a href="#_245" rel="nofollow">十种不同格式文件的压缩效率</a></li><li><a href="#_255" rel="nofollow">更改词典总数上限后的编码效率</a></li><li><a href="#_264" rel="nofollow">字符重复率很高的文本文档</a></li><li><a href="#LZW_273" rel="nofollow">LZW算法的优缺点</a></li></ul> 
  </li><li><a href="#_277" rel="nofollow">程序代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="LZW_1"></a>LZW算法原理</h2> 
<h3><a id="LZW_2"></a>LZW编码</h3> 
<h4><a id="_3"></a>编码算法的思想</h4> 
<p>步骤1：将词典初始化为包含所有可能的单字符，当前前缀P初始化为空。<br> 步骤2：当前字符C=字符流中的下一个字符。<br> 步骤3：判断P+C是否在词典中：<br> （1）如果是，则用C扩展P，即P=P+C，返回到步骤2.<br> （2）如果否，则 输出与当前前缀P相对应的码字W;将P+C添加到词典中；令P=C,并返回到步骤2.</p> 
<h4><a id="_10"></a>数据结构分析</h4> 
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>尾缀字符</td><td>suffix</td></tr><tr><td>母节点</td><td>parent</td></tr><tr><td>第一个孩子节点</td><td>firstchild</td></tr><tr><td>下一个兄弟节点</td><td>nextsibling</td></tr></tbody></table> 
<p>树用数组表示，数组下标用pointer表示，dict[pointer]表示一个节点：<br> dict[pointer].suffix<br> dict[pointer].parent<br> dict[pointer].firstchild<br> dict[pointer].nextsibling</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> suffix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> parent<span class="token punctuation">,</span> firstchild<span class="token punctuation">,</span> nextsibling<span class="token punctuation">;</span>
<span class="token punctuation">}</span> dictionary<span class="token punctuation">[</span>MAX_CODE<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> next_code<span class="token punctuation">;</span>
<span class="token keyword">int</span> d_stack<span class="token punctuation">[</span>MAX_CODE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// stack for decoding a phrase</span>
</code></pre> 
<h4><a id="_33"></a>主要功能模块</h4> 
<h5><a id="_34"></a>初始化词典</h5> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">InitDictionary</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//初始化词典，将0-255根节点初始化</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token comment">//尾缀字符</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//母节点初始化为空</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//子节点初始化为空</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//下一个兄弟节点</span>
	<span class="token punctuation">}</span>
	dictionary<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//最后一个节点无下一个兄弟</span>
	next_code <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span><span class="token comment">//新词条编码为256</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_51"></a>查找词典中是否有字符串</h5> 
<p>将当前字符依次与当前前缀的孩子节点进行比较，相同时说明词典中有该字符串，否则说明词典中没有该字符串，返回-1。</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">InDictionary</span><span class="token punctuation">(</span> <span class="token keyword">int</span> character<span class="token punctuation">,</span> <span class="token keyword">int</span> string_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//查找词典中是否有字符串</span>
	<span class="token keyword">int</span> sibling<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&gt;</span>string_code<span class="token punctuation">)</span> <span class="token keyword">return</span> character<span class="token punctuation">;</span><span class="token comment">//string_code==-1,当前词条无前缀，为单个字符，初始化后已经在词典中，返回此字符</span>
	sibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild<span class="token punctuation">;</span><span class="token comment">//如果不是单个字符，找当前前缀的第一个孩子节点</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>sibling<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> character <span class="token operator">==</span> dictionary<span class="token punctuation">[</span>sibling<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix<span class="token punctuation">)</span> <span class="token keyword">return</span> sibling<span class="token punctuation">;</span><span class="token comment">//如果此孩子节点的尾缀字符等于character，则当前词条在词典中，返回此孩子节点</span>
		sibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>sibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling<span class="token punctuation">;</span><span class="token comment">//否则，找当前前缀的下一个孩子节点</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//没有找到，返回-1</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_66"></a>将新串加入词典</h5> 
<p>将新串加入词典，则需要添加新节点，设置新节点的suffix,parent,nextsibling,firstchild，另外还需建立新节点与当前前缀其他孩子节点的关系。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">AddToDictionary</span><span class="token punctuation">(</span> <span class="token keyword">int</span> character<span class="token punctuation">,</span> <span class="token keyword">int</span> string_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//将新串加入词典</span>
	<span class="token keyword">int</span> firstsibling<span class="token punctuation">,</span> nextsibling<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&gt;</span>string_code<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//string_code==-1,当前词条无前缀，为单个字符，初始化后已经在词典中</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//添加新节点dictionary[next_code]，其尾缀字符为character</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> string_code<span class="token punctuation">;</span><span class="token comment">//新节点的母节点为string_code</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//新节点还没有下一个兄弟</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//新节点还没有孩子</span>
	firstsibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild<span class="token punctuation">;</span><span class="token comment">//firstsibling为当前前缀的第一个孩子</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>firstsibling<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// 如果当前前缀有孩子</span>
		nextsibling <span class="token operator">=</span> firstsibling<span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token punctuation">)</span> <span class="token comment">//只要nextsibling还有下一个兄弟</span>
			nextsibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling<span class="token punctuation">;</span><span class="token comment">//让nextsibling替换为它的下一个兄弟，这样可以找到当前前缀的最后一个孩子</span>
		dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> next_code<span class="token punctuation">;</span><span class="token comment">//当前前缀的最后一个孩子的下一个兄弟为新节点</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span><span class="token comment">// 当前前缀无孩子,则新节点为它的第一个孩子</span>
		dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> next_code<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	next_code <span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//为下一个新词条所用</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_88"></a>编码</h5> 
<p>如果当前字符串在词典中，将当前字符串设为前缀。如果当前字符串不在词典中，将当前字符串写入词典中，输出当前字符串前缀对应的码字，当前字符设为前缀。详见代码注释。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">LZWEncode</span><span class="token punctuation">(</span> FILE <span class="token operator">*</span>fp<span class="token punctuation">,</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//LZW编码</span>
	<span class="token keyword">int</span> character<span class="token punctuation">;</span><span class="token comment">//当前字符C</span>
	<span class="token keyword">int</span> string_code<span class="token punctuation">;</span><span class="token comment">//当前前缀P</span>
	<span class="token keyword">int</span> index<span class="token punctuation">;</span><span class="token comment">//定义索引</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> file_length<span class="token punctuation">;</span><span class="token comment">//定义文件长度</span>

	<span class="token function">fseek</span><span class="token punctuation">(</span> fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将指针置于文件末尾</span>
	file_length <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//得到当前文件长度</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span> fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将指针移回文件开始</span>
	<span class="token function">BitsOutput</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> file_length<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">InitDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化词典</span>
	string_code <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//初始化后的词典为单个字符，无前缀</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token constant">EOF</span><span class="token operator">!=</span><span class="token punctuation">(</span>character<span class="token operator">=</span><span class="token function">fgetc</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//EOF：END OF FILE，每次从文件中读取一个字符，直到文件的最后一个字符</span>
		index <span class="token operator">=</span> <span class="token function">InDictionary</span><span class="token punctuation">(</span> character<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查找当前字符串是否在词典中，如果不在，则index=-1,如果在，则返回的是当前字符串的后缀（单个字符时为该字符），index&gt;=0</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&lt;=</span>index<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// string+character in dictionary  如果当前字符串在词典中</span>
			string_code <span class="token operator">=</span> index<span class="token punctuation">;</span><span class="token comment">//将当前字符串设为前缀</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// string+character not in dictionary  如果当前字符串不在词典中</span>
			<span class="token function">output</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出当前前缀对应的码字</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span> MAX_CODE <span class="token operator">&gt;</span> next_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// free space in dictionary，只要未超过词典容限</span>
				<span class="token comment">// add string+character to dictionary</span>
				<span class="token function">AddToDictionary</span><span class="token punctuation">(</span> character<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将当前字符串加入到词典中</span>
			<span class="token punctuation">}</span>
			string_code <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//将当前字符C设为前缀P</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">output</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//最后一个前缀无下一个字符，将其对应的码字输出</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="LZW_120"></a>LZW解码</h3> 
<h4><a id="_122"></a>解码算法的思想</h4> 
<p>步骤1：在开始译码时词典包含所有可能的前缀根。<br> 步骤2：令CW=码字流中的第一个码字<br> 步骤3：输出CW对应的字符到字符流<br> 步骤4：先前码字PW=当前码字CW<br> 步骤5：当前码字CW等于码字流中的下一个码字<br> 步骤5：判断CW是否在词典中<br> （1）如果是，将CW对应的字符串输出到字符流中，当前前缀P=PW对应的字符串，当前字符C=CW对应字符串中的第一个字符，将P+C添加到词典中，先前码字PW=当前码字CW;<br> （2）如果否，即如果CW不在词典中，说明该词条刚写入词典就被使用，该字符串的第一个字符等于最后一个字符，当前前缀P=PW对应的字符串，当前字符C=PW对应字符串中的第一个字符，将P+C添加到词典中，将P+C输出到字符流中，先前码字PW=当前码字CW;<br> 步骤7：判断码字流中是否还有码字要译。<br> （1）如果”是”，就返回步骤4。<br> （2）如果”否”，结束。</p> 
<h4><a id="_134"></a>解码</h4> 
<p>当前码字不在词典中的情况：说明一个词条刚写入词典就被使用，举例：<br> <img src="https://images2.imgbox.com/1f/b3/26KjoNem_o.jpg" alt="在这里插入图片描述"><br> “aba”被写入词典后，输出“ab”对应的码字，'“a”作为新的前缀，判断“ab”在词典中，则“ab”作为新的前缀，判断"aba"在词典中，则刚写入词典的“aba”对应的码字被输出。但在解码端，收到码字就开始解码，解码到256时，"ba“刚被写入词典中，此时词典中还未写入”aba“对应的码字。只有编码端刚写入的词条就被使用时才会发生这种情况，而只有该字符串的第一个字符等于最后一个字符时，这种情况才会发生。因此，当前码字不在词典中时，说明当前码字对应的字符串为先前码字对应的字符串+先前码字对应字符串的第一个字符。</p> 
<h5><a id="LZWDecode_138"></a>LZWDecode</h5> 
<p>首先初始化词典，如果当前码字不在词典中，将character赋给d_stack[0]，并在d_stack[]中存储先前码字对应的字符串（倒序存放），如果当前码字在词典中，在d_stack[]中存储当前码字对应字符串（倒序存放），则可以得到先前码字或当前码字的第一个字符d_stack[phrase_length-1]。当前码字不在词典中时，新词条为当前前缀+当前前缀的第一个字符，将先前码字对应的字符串+先前码字对应字符串的第一个字符输出到字符流中。当前码字在词典中时，将当前码字对应的字符串输出到字符流中，新词条为当前前缀+当前字符串的第一个字符。最后将当前码字设为先前码字。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">LZWDecode</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> FILE <span class="token operator">*</span>fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//LZW解码</span>
	<span class="token comment">//需填充</span>
	<span class="token keyword">int</span> character<span class="token punctuation">;</span><span class="token comment">//定义当前字符</span>
	<span class="token keyword">int</span> new_code<span class="token punctuation">,</span> last_code<span class="token punctuation">;</span><span class="token comment">//定义当前码字和先前码字</span>
	<span class="token keyword">int</span> phrase_length<span class="token punctuation">;</span><span class="token comment">//定义字符串长度</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> file_length<span class="token punctuation">;</span><span class="token comment">//定义输出文件长度</span>

	file_length <span class="token operator">=</span> <span class="token function">BitsInput</span><span class="token punctuation">(</span>bf<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解码后文件的大小</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> file_length<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		file_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">InitDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化词典，使在开始译码时词典包含所有可能的前缀根</span>
	last_code <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//译码前无先前码字</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>file_length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//file_length &gt; 0表示解码未完成，继续解码</span>
	<span class="token punctuation">{<!-- --></span>
		new_code <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从输入文件中读出一个码字，为当前码字</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>new_code <span class="token operator">&gt;=</span> next_code<span class="token punctuation">)</span><span class="token comment">//如果当前码字不在词典中</span>
		<span class="token punctuation">{<!-- --></span>
			d_stack<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//先将character赋给d_stack[0]</span>
			phrase_length <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> last_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从d_stack[1]开始存储先前码字对应的字符串，</span>
			<span class="token comment">//d_stack[1]存储的是先前码字对应的字符串的最后一个字符，phrase_length为先前码字对应字符串的长度+1</span>
			<span class="token comment">//d_stack[phrase_length-1]存储的是先前码字对应字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token comment">//如果当前码字在词典中</span>
		<span class="token punctuation">{<!-- --></span>
			phrase_length <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> new_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从d_stack[0]开始存储当前码字对应的字符串，</span>
			<span class="token comment">//d_stack[0]存储的是当前码字对应字符串的最后一个字符,phrase_length为当前码字对应字符串的长度</span>
			<span class="token comment">// d_stack[phrase_length-1]存储的是当前码字对应字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		character <span class="token operator">=</span> d_stack<span class="token punctuation">[</span>phrase_length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//当前码字不在词典中时，character为先前码字对应字符串的第一个字符</span>
		<span class="token comment">//当前码字在词典中时，character为当前码字对应字符串的第一个字符</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> phrase_length<span class="token punctuation">)</span><span class="token comment">//循环，直到d_stack[]全部输出</span>
		<span class="token punctuation">{<!-- --></span>
			phrase_length<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token function">fputc</span><span class="token punctuation">(</span>d_stack<span class="token punctuation">[</span>phrase_length<span class="token punctuation">]</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//d_stack[]为倒序存放，这样可以正序输出</span>
		<span class="token comment">//当前码字不在词典中时，将先前码字对应的字符串+先前码字对应字符串的第一个字符输出到字符流中</span>
		<span class="token comment">//当前码字在词典中时，将当前码字对应的字符串输出到字符流中</span>
			file_length<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>MAX_CODE <span class="token operator">&gt;</span> next_code<span class="token punctuation">)</span><span class="token comment">//未超过词典容限时</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">AddToDictionary</span><span class="token punctuation">(</span>character<span class="token punctuation">,</span> last_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//当前码字不在词典中时，新词条为当前前缀+当前前缀的第一个字符</span>
			<span class="token comment">//当前码字在词典中时，新词条为当前前缀+当前字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		last_code <span class="token operator">=</span> new_code<span class="token punctuation">;</span><span class="token comment">//将当前码字设为先前码字</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="DecodeString_193"></a>DecodeString</h5> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//需填充</span>
	<span class="token keyword">int</span> count<span class="token punctuation">;</span>
	count <span class="token operator">=</span> start<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> code<span class="token punctuation">)</span><span class="token comment">//从最后一个节点开始，向上搜索并存入stack[]中，直到找到最后一个母节点</span>
	<span class="token punctuation">{<!-- --></span>
		d_stack<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix<span class="token punctuation">;</span>
		code <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
		count<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//记录次数</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> count<span class="token punctuation">;</span><span class="token comment">//count=code对应字符串的长度+start</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_210"></a>调试程序</h2> 
<p>代码补充完整后，我们首先用课件上的数据进行实验。新建文本文件test1.txt，内容为“abbababac”<br> 编码后的词典应为：<br> <img src="https://images2.imgbox.com/89/bb/6ha7po7d_o.png" alt="在这里插入图片描述"><br> 设置命令参数，待编码文件为test1.txt，编码后文件为test1.dat，dat文件多为程序使用的数据，它只是开发者为了清楚文件的意思而自己定义的。</p> 
<h3><a id="_216"></a>编码</h3> 
<p><img src="https://images2.imgbox.com/12/2c/pqWY7WSc_o.png" alt="在这里插入图片描述"><br> 调用PrintDictionary()函数来输出256之后的词典</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">PrintDictionary</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n<span class="token punctuation">;</span>
	<span class="token keyword">int</span> count<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span> n<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">;</span> n<span class="token operator">&lt;</span>next_code<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		count <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%4d-&gt;"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&lt;</span>count<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d_stack<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d5/99/ROY82QPl_o.png" alt="在这里插入图片描述"><br> 得到的结果和理论相同。编码正确。</p> 
<h3><a id="_236"></a>解码</h3> 
<p>接下来，我们用编码后得到的test1.dat进行解码，设置命令参数：<br> <img src="https://images2.imgbox.com/cb/cb/2yF3eRe7_o.png" alt="在这里插入图片描述"><br> 运行程序后，得到解码后的文件testd.txt，内容与编码前的内容相同。说明解码正确。<br> <img src="https://images2.imgbox.com/71/a1/qMPhKxNF_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_243"></a>压缩效率分析</h2> 
<h3><a id="_245"></a>十种不同格式文件的压缩效率</h3> 
<p>准备十种不同格式的文件，使用LZW编码器进行压缩得到输出的压缩比特流文件。<br> <img src="https://images2.imgbox.com/8a/c5/BkjgDzGb_o.png" alt="在这里插入图片描述"></p> 
<p>压缩后的文件：<br> <img src="https://images2.imgbox.com/15/bc/AnlTAJTT_o.png" alt="在这里插入图片描述"><br> 将压缩后文件的格式，数据量，压缩后文件的数据量，以及编码词典总数写入表格中进行比较：<br> <img src="https://images2.imgbox.com/b3/b1/uhKEkkgR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_255"></a>更改词典总数上限后的编码效率</h3> 
<p>不同格式的文件经LZW编码器压缩后，压缩效率有很大的不同。仅有7.rgb经过LZW编码后数据量减小了，其余九个文件经LZW压缩编码后数据量反而上升。本次实验词典总数上限为65535，其中第3，4，6，9，10个文件词典编码总数均已达到上限，因此我们增大词典总数上限，将MAXCODE设为200000，继续进行LZW编码，得到如下结果：<br> <img src="https://images2.imgbox.com/0a/46/SSvxe1V4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/b3/kGZgEEmU_o.png" alt="在这里插入图片描述"></p> 
<p>增大词典总数上限后，数据量较第一次压缩后的结果更小了，但除了6.avi数据量较原文件有所减小，其他文件压缩后的数据量还是大于原文件。对于词典编码总数仍达到上限的文件，可能是MAXCODE的值仍旧太小，数据量过大，导致压缩算法未充分利用。词典编码总数未达到上界，压缩后数据量大于原文件的，可能是文件中重复字符的概率小，LZW压缩算法不能发挥优势。</p> 
<h3><a id="_264"></a>字符重复率很高的文本文档</h3> 
<p>新建一个文本文档，内容为重复率很高的字符<br> <img src="https://images2.imgbox.com/f6/22/dOuJZmir_o.png" alt="在这里插入图片描述"><br> 使用LZW编码器进行压缩后，数据量有了很明显的减小<br> <img src="https://images2.imgbox.com/1b/f1/uIXctdtu_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/60/78/bSxUKQm9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="LZW_273"></a>LZW算法的优缺点</h3> 
<p>由此可见，字符串重复率低时，压缩效率受到很大的影响，这是LZW算法的一大局限。它的优点是只需一遍扫描，具有自适应的特点，算法简单，便于快速实现。</p> 
<h2><a id="_277"></a>程序代码</h2> 
<p><strong>bitio.h</strong></p> 
<pre><code class="prism language-c"><span class="token comment">/*
 * Declaration for bitwise IO
 *
 * vim: ts=4 sw=4 cindent
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__BITIO__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__BITIO__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
	FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> mask<span class="token punctuation">;</span>
	<span class="token keyword">int</span> rack<span class="token punctuation">;</span>
<span class="token punctuation">}</span>BITFILE<span class="token punctuation">;</span>

BITFILE <span class="token operator">*</span><span class="token function">OpenBitFileInput</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
BITFILE <span class="token operator">*</span><span class="token function">OpenBitFileOutput</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">CloseBitFileInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">CloseBitFileOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">BitInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">BitsInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">BitOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">int</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">BitsOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> code<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>	<span class="token comment">// __BITIO__</span></span>

</code></pre> 
<p><strong>bitio.c</strong></p> 
<pre><code class="prism language-c"><span class="token comment">/*
 * Definitions for bitwise IO
 *
 * vim: ts=4 sw=4 cindent
 */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bitio.h"</span></span>
BITFILE <span class="token operator">*</span><span class="token function">OpenBitFileInput</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	BITFILE <span class="token operator">*</span>bf<span class="token punctuation">;</span>
	bf <span class="token operator">=</span> <span class="token punctuation">(</span>BITFILE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>BITFILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> bf<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> filename<span class="token punctuation">)</span>	bf<span class="token operator">-&gt;</span>fp <span class="token operator">=</span> <span class="token constant">stdin</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> bf<span class="token operator">-&gt;</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span> filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>mask <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>rack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> bf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BITFILE <span class="token operator">*</span><span class="token function">OpenBitFileOutput</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	BITFILE <span class="token operator">*</span>bf<span class="token punctuation">;</span>
	bf <span class="token operator">=</span> <span class="token punctuation">(</span>BITFILE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>BITFILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> bf<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> filename<span class="token punctuation">)</span>	bf<span class="token operator">-&gt;</span>fp <span class="token operator">=</span> <span class="token constant">stdout</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> bf<span class="token operator">-&gt;</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span> filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token operator">==</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>mask <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>rack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> bf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">CloseBitFileInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">fclose</span><span class="token punctuation">(</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span> bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">CloseBitFileOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// Output the remaining bits</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0x80</span> <span class="token operator">!=</span> bf<span class="token operator">-&gt;</span>mask<span class="token punctuation">)</span> <span class="token function">fputc</span><span class="token punctuation">(</span> bf<span class="token operator">-&gt;</span>rack<span class="token punctuation">,</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span> bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">BitInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> value<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0x80</span> <span class="token operator">==</span> bf<span class="token operator">-&gt;</span>mask<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		bf<span class="token operator">-&gt;</span>rack <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">EOF</span> <span class="token operator">==</span> bf<span class="token operator">-&gt;</span>rack<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Read after the end of file reached\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	value <span class="token operator">=</span> bf<span class="token operator">-&gt;</span>mask <span class="token operator">&amp;</span> bf<span class="token operator">-&gt;</span>rack<span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>mask <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">==</span>bf<span class="token operator">-&gt;</span>mask<span class="token punctuation">)</span> bf<span class="token operator">-&gt;</span>mask <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span>value<span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">BitsInput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> mask<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> value<span class="token punctuation">;</span>
	mask <span class="token operator">=</span> <span class="token number">1L</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	value <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">!=</span>mask<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token function">BitInput</span><span class="token punctuation">(</span> bf<span class="token punctuation">)</span><span class="token punctuation">)</span>
			value <span class="token operator">|=</span> mask<span class="token punctuation">;</span>
		mask <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">BitOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">int</span> bit<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">!=</span> bit<span class="token punctuation">)</span> bf<span class="token operator">-&gt;</span>rack <span class="token operator">|=</span> bf<span class="token operator">-&gt;</span>mask<span class="token punctuation">;</span>
	bf<span class="token operator">-&gt;</span>mask <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">==</span> bf<span class="token operator">-&gt;</span>mask<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// eight bits in rack</span>
		<span class="token function">fputc</span><span class="token punctuation">(</span> bf<span class="token operator">-&gt;</span>rack<span class="token punctuation">,</span> bf<span class="token operator">-&gt;</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bf<span class="token operator">-&gt;</span>rack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		bf<span class="token operator">-&gt;</span>mask <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">BitsOutput</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> code<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> mask<span class="token punctuation">;</span>

	mask <span class="token operator">=</span> <span class="token number">1L</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">!=</span> mask<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">BitOutput</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>code<span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mask <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	BITFILE <span class="token operator">*</span>bfi<span class="token punctuation">,</span> <span class="token operator">*</span>bfo<span class="token punctuation">;</span>
	<span class="token keyword">int</span> bit<span class="token punctuation">;</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token operator">&lt;</span>argc<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">==</span><span class="token function">OpenBitFileInput</span><span class="token punctuation">(</span> bfi<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"fail open the file\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">==</span><span class="token function">OpenBitFileInput</span><span class="token punctuation">(</span> bfi<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"fail open stdin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token operator">&lt;</span>argc<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">==</span><span class="token function">OpenBitFileOutput</span><span class="token punctuation">(</span> bfo<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"fail open file for output\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">==</span><span class="token function">OpenBitFileOutput</span><span class="token punctuation">(</span> bfo<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"fail open stdout\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		bit <span class="token operator">=</span> <span class="token function">BitInput</span><span class="token punctuation">(</span> bfi<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
		count <span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>count<span class="token operator">&amp;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">BitOutput</span><span class="token punctuation">(</span> bfo<span class="token punctuation">,</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p><strong>lzw.c</strong></p> 
<pre><code class="prism language-c"><span class="token comment">/*
 * Definition for LZW coding 
 *
 * vim: ts=4 sw=4 cindent nowrap
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bitio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_CODE</span> <span class="token expression"><span class="token number">65535</span></span></span>
<span class="token comment">//#define MAX_CODE 200000</span>

<span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> suffix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> parent<span class="token punctuation">,</span> firstchild<span class="token punctuation">,</span> nextsibling<span class="token punctuation">;</span>
<span class="token punctuation">}</span> dictionary<span class="token punctuation">[</span>MAX_CODE<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> next_code<span class="token punctuation">;</span>
<span class="token keyword">int</span> d_stack<span class="token punctuation">[</span>MAX_CODE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// stack for decoding a phrase</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">input</span><span class="token expression"><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">BitsInput</span><span class="token punctuation">(</span> f<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">output</span><span class="token expression"><span class="token punctuation">(</span>f<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token function">BitsOutput</span><span class="token punctuation">(</span> f<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">InitDictionary</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">PrintDictionary</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n<span class="token punctuation">;</span>
	<span class="token keyword">int</span> count<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span> n<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">;</span> n<span class="token operator">&lt;</span>next_code<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		count <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%4d-&gt;"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&lt;</span>count<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d_stack<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//需填充</span>
	<span class="token keyword">int</span> count<span class="token punctuation">;</span>
	count <span class="token operator">=</span> start<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> code<span class="token punctuation">)</span><span class="token comment">//从最后一个节点开始，向上搜索并存入stack[]中，直到找到最后一个母节点</span>
	<span class="token punctuation">{<!-- --></span>
		d_stack<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix<span class="token punctuation">;</span>
		code <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
		count<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//记录次数</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> count<span class="token punctuation">;</span><span class="token comment">//count=code对应字符串的长度+start</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">InitDictionary</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//初始化词典，将0-255根节点初始化</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token comment">//尾缀字符</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//母节点初始化为空</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//子节点初始化为空</span>
		dictionary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//下一个兄弟节点</span>
	<span class="token punctuation">}</span>
	dictionary<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//最后一个节点无下一个兄弟</span>
	next_code <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span><span class="token comment">//新词条编码为256</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
 * Input: string represented by string_code in dictionary,
 * Output: the index of character+string in the dictionary
 * 		index = -1 if not found
 */</span>
<span class="token keyword">int</span> <span class="token function">InDictionary</span><span class="token punctuation">(</span> <span class="token keyword">int</span> character<span class="token punctuation">,</span> <span class="token keyword">int</span> string_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//查找词典中是否有字符串</span>
	<span class="token keyword">int</span> sibling<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&gt;</span>string_code<span class="token punctuation">)</span> <span class="token keyword">return</span> character<span class="token punctuation">;</span><span class="token comment">//string_code==-1,当前词条无前缀，为单个字符，初始化后已经在词典中，返回此字符</span>
	sibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild<span class="token punctuation">;</span><span class="token comment">//如果不是单个字符，找当前前缀的第一个孩子节点</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>sibling<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> character <span class="token operator">==</span> dictionary<span class="token punctuation">[</span>sibling<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix<span class="token punctuation">)</span> <span class="token keyword">return</span> sibling<span class="token punctuation">;</span><span class="token comment">//如果此孩子节点的尾缀字符等于character，则当前词条在词典中，返回此孩子节点</span>
		sibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>sibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling<span class="token punctuation">;</span><span class="token comment">//否则，找当前前缀的下一个孩子节点</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//没有找到，返回-1</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">AddToDictionary</span><span class="token punctuation">(</span> <span class="token keyword">int</span> character<span class="token punctuation">,</span> <span class="token keyword">int</span> string_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//将新串加入词典</span>
	<span class="token keyword">int</span> firstsibling<span class="token punctuation">,</span> nextsibling<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&gt;</span>string_code<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//string_code==-1,当前词条无前缀，为单个字符，初始化后已经在词典中</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>suffix <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//添加新节点dictionary[next_code]，其尾缀字符为character</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> string_code<span class="token punctuation">;</span><span class="token comment">//新节点的母节点为string_code</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//新节点还没有下一个兄弟</span>
	dictionary<span class="token punctuation">[</span>next_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//新节点还没有孩子</span>
	firstsibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild<span class="token punctuation">;</span><span class="token comment">//firstsibling为当前前缀的第一个孩子</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>firstsibling<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// 如果当前前缀有孩子</span>
		nextsibling <span class="token operator">=</span> firstsibling<span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span>dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token punctuation">)</span> <span class="token comment">//只要nextsibling还有下一个兄弟</span>
			nextsibling <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling<span class="token punctuation">;</span><span class="token comment">//让nextsibling替换为它的下一个兄弟，这样可以找到当前前缀的最后一个孩子</span>
		dictionary<span class="token punctuation">[</span>nextsibling<span class="token punctuation">]</span><span class="token punctuation">.</span>nextsibling <span class="token operator">=</span> next_code<span class="token punctuation">;</span><span class="token comment">//当前前缀的最后一个孩子的下一个兄弟为新节点</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span><span class="token comment">// 当前前缀无孩子,则新节点为它的第一个孩子</span>
		dictionary<span class="token punctuation">[</span>string_code<span class="token punctuation">]</span><span class="token punctuation">.</span>firstchild <span class="token operator">=</span> next_code<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	next_code <span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//为下一个新词条所用</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">LZWEncode</span><span class="token punctuation">(</span> FILE <span class="token operator">*</span>fp<span class="token punctuation">,</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//LZW编码</span>
	<span class="token keyword">int</span> character<span class="token punctuation">;</span><span class="token comment">//当前字符C</span>
	<span class="token keyword">int</span> string_code<span class="token punctuation">;</span><span class="token comment">//当前前缀P</span>
	<span class="token keyword">int</span> index<span class="token punctuation">;</span><span class="token comment">//定义索引</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> file_length<span class="token punctuation">;</span><span class="token comment">//定义文件长度</span>

	<span class="token function">fseek</span><span class="token punctuation">(</span> fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将指针置于文件末尾</span>
	file_length <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//得到当前文件长度</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span> fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将指针移回文件开始</span>
	<span class="token function">BitsOutput</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> file_length<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">InitDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化词典</span>
	string_code <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//初始化后的词典为单个字符，无前缀</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token constant">EOF</span><span class="token operator">!=</span><span class="token punctuation">(</span>character<span class="token operator">=</span><span class="token function">fgetc</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//EOF：END OF FILE，每次从文件中读取一个字符，直到文件的最后一个字符</span>
		index <span class="token operator">=</span> <span class="token function">InDictionary</span><span class="token punctuation">(</span> character<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查找当前字符串是否在词典中，如果不在，则index=-1,如果在，则返回的是当前字符串的后缀（单个字符时为该字符），index&gt;=0</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token operator">&lt;=</span>index<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// string+character in dictionary  如果当前字符串在词典中</span>
			string_code <span class="token operator">=</span> index<span class="token punctuation">;</span><span class="token comment">//将当前字符串初始化为前缀</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// string+character not in dictionary  如果当前字符串不在词典中</span>
			<span class="token function">output</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出当前前缀对应的码字</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span> MAX_CODE <span class="token operator">&gt;</span> next_code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// free space in dictionary，只要未超过词典容限</span>
				<span class="token comment">// add string+character to dictionary</span>
				<span class="token function">AddToDictionary</span><span class="token punctuation">(</span> character<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将当前字符串加入到词典中</span>
			<span class="token punctuation">}</span>
			string_code <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//将当前字符C设为前缀P</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">output</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> string_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//最后一个前缀无下一个字符，将其对应的码字输出</span>
	<span class="token function">PrintDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">LZWDecode</span><span class="token punctuation">(</span> BITFILE <span class="token operator">*</span>bf<span class="token punctuation">,</span> FILE <span class="token operator">*</span>fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//LZW解码</span>
	<span class="token comment">//需填充</span>
	<span class="token keyword">int</span> character<span class="token punctuation">;</span><span class="token comment">//定义当前字符</span>
	<span class="token keyword">int</span> new_code<span class="token punctuation">,</span> last_code<span class="token punctuation">;</span><span class="token comment">//定义当前码字和先前码字</span>
	<span class="token keyword">int</span> phrase_length<span class="token punctuation">;</span><span class="token comment">//定义字符串长度</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> file_length<span class="token punctuation">;</span><span class="token comment">//定义输出文件长度</span>

	file_length <span class="token operator">=</span> <span class="token function">BitsInput</span><span class="token punctuation">(</span>bf<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解码后文件的大小</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> file_length<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		file_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">InitDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化词典，使在开始译码时词典包含所有可能的前缀根</span>
	last_code <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//译码前无先前码字</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>file_length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//file_length &gt; 0表示解码未完成，继续解码</span>
	<span class="token punctuation">{<!-- --></span>
		new_code <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从输入文件中读出一个码字，为当前码字</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>new_code <span class="token operator">&gt;=</span> next_code<span class="token punctuation">)</span><span class="token comment">//如果当前码字不在词典中</span>
		<span class="token punctuation">{<!-- --></span>
			d_stack<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> character<span class="token punctuation">;</span><span class="token comment">//先将character赋给d_stack[0]</span>
			phrase_length <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> last_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从d_stack[1]开始存储先前码字对应的字符串，</span>
			<span class="token comment">//d_stack[1]存储的是先前码字对应的字符串的最后一个字符，phrase_length为先前码字对应字符串的长度+1</span>
			<span class="token comment">//d_stack[phrase_length-1]存储的是先前码字对应字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token comment">//如果当前码字在词典中</span>
		<span class="token punctuation">{<!-- --></span>
			phrase_length <span class="token operator">=</span> <span class="token function">DecodeString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> new_code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从d_stack[0]开始存储当前码字对应的字符串，</span>
			<span class="token comment">//d_stack[0]存储的是当前码字对应字符串的最后一个字符,phrase_length为当前码字对应字符串的长度</span>
			<span class="token comment">// d_stack[phrase_length-1]存储的是当前码字对应字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		character <span class="token operator">=</span> d_stack<span class="token punctuation">[</span>phrase_length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//当前码字不在词典中时，character为先前码字对应字符串的第一个字符</span>
		<span class="token comment">//当前码字在词典中时，character为当前码字对应字符串的第一个字符</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> phrase_length<span class="token punctuation">)</span><span class="token comment">//循环，直到d_stack[]全部输出</span>
		<span class="token punctuation">{<!-- --></span>
			phrase_length<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token function">fputc</span><span class="token punctuation">(</span>d_stack<span class="token punctuation">[</span>phrase_length<span class="token punctuation">]</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//d_stack[]为倒序存放，这样可以正序输出</span>
		<span class="token comment">//当前码字不在词典中时，将先前码字对应的字符串+先前码字对应字符串的第一个字符输出到字符流中</span>
		<span class="token comment">//当前码字在词典中时，将当前码字对应的字符串输出到字符流中</span>
			file_length<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>MAX_CODE <span class="token operator">&gt;</span> next_code<span class="token punctuation">)</span><span class="token comment">//未超过词典容限时</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">AddToDictionary</span><span class="token punctuation">(</span>character<span class="token punctuation">,</span> last_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//当前码字不在词典中时，新词条为当前前缀+当前前缀的第一个字符</span>
			<span class="token comment">//当前码字在词典中时，新词条为当前前缀+当前字符串的第一个字符</span>
		<span class="token punctuation">}</span>
		last_code <span class="token operator">=</span> new_code<span class="token punctuation">;</span><span class="token comment">//将当前码字设为先前码字</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
	BITFILE <span class="token operator">*</span>bf<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token number">4</span><span class="token operator">&gt;</span>argc<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"usage: \n%s &lt;o&gt; &lt;ifile&gt; &lt;ofile&gt;\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"\t&lt;o&gt;: E or D reffers encode or decode\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"\t&lt;ifile&gt;: input file name\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"\t&lt;ofile&gt;: output file name\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token char">'E'</span> <span class="token operator">==</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// do encoding</span>
		fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bf <span class="token operator">=</span> <span class="token function">OpenBitFileOutput</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">!=</span>fp <span class="token operator">&amp;&amp;</span> <span class="token constant">NULL</span><span class="token operator">!=</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">LZWEncode</span><span class="token punctuation">(</span> fp<span class="token punctuation">,</span> bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">fclose</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">CloseBitFileOutput</span><span class="token punctuation">(</span> bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"encoding done\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token char">'D'</span> <span class="token operator">==</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// do decoding</span>
		bf <span class="token operator">=</span> <span class="token function">OpenBitFileInput</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token constant">NULL</span><span class="token operator">!=</span>fp <span class="token operator">&amp;&amp;</span> <span class="token constant">NULL</span><span class="token operator">!=</span>bf<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">LZWDecode</span><span class="token punctuation">(</span> bf<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">fclose</span><span class="token punctuation">(</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">CloseBitFileInput</span><span class="token punctuation">(</span> bf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"decoding done\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>	<span class="token comment">// otherwise</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"not supported operation\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/abb21ec2a8eea10cce7518c3f3c47912/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于国产数据库表设计PDManer工具的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49959872a0ac39bd2fe0699cf78abc01/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">哈夫曼编码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>