<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FTP服务搭建（linux） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FTP服务搭建（linux）" />
<meta property="og:description" content="一、下载（在线安装可跳过） 1、下载（见网盘） 下载服务端 vsftpd：下载地址
下载客户端 ftp
注：如果需要使用ftp命令，则客户端必须安装，否则无法使用（-bash: ftp: command not found）
二、安装 1、检查是否已经安装了vsftp 首先查看系统中是否成功安装了vsftpd，执行下面命令(有内容则安装了ftp)
rpm -qa | grep vsftpd 2、开始安装 在线安装 yum install vsftpd -y 若linux处于离线状态则无法使用yum命令安装 离线下载vsftp： http://rpmfind.net/linux/rpm2html/search.php?query=vsftpd(x86-64) 上传安装包到服务器，放在安装目录，比如/home/ 下 离线安装 rpm -ivh vsftpd-3.0.2-22.el7.x86_64.rpm 安装过程可能会报错，缺少依赖：
解决：安装相关依赖（centos7 的最新依赖包在博客资源里，可自行去下载） rpm -ivh libcap-2.16-5.5.el6.x86_64.rpm rpm -ivh libcap-devel-2.16-5.5.el6.x86_64.rpm 检查是否安装成功
rpm -qa | grep vsftpd 服务启动
systemctl start vsftpd.service 三、配置 1、进入cd /etc/vsftpd目录 cd /etc/vsftpd 2、编辑vsftpd.conf文件 养成备份的好习惯 cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.backup.conf vim vsftpd.conf 修改如下：
#禁止匿名登录FTP服务器 anonymous_enable=NO #允许本地用户登录FTP服务器 local_enable=YES #本地用户上传文件的umask local_umask=022 #设置本地用户登录后所在目录 local_root=/home/vsftpd/ftpuser #全部用户是否被限制在主目录 #如果设置成YES会导致你用java代码创建文件夹时失败，因为他被限制在了宿主目录 #chroot_local_user=YES #开启被动模式 pasv_enable=YES pasv_addr_resolve=YES #FTP服务器公网IP（也就是当前阿里云服务器的公网 IP） pasv_address=120." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4df45a6d3bdbd55699ef12b80e4d16cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-27T09:47:43+08:00" />
<meta property="article:modified_time" content="2022-07-27T09:47:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FTP服务搭建（linux）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、下载（在线安装可跳过）</h2> 
<h3><a id="1_2"></a>1、下载（见网盘）</h3> 
<ul><li> <p>下载服务端 vsftpd：<a href="http://rpmfind.net/linux/rpm2html/search.php?query=vsftpd%28x86-64%29" rel="nofollow">下载地址</a></p> </li><li> <p>下载客户端 ftp</p> </li></ul> 
<p>注：如果需要使用ftp命令，则客户端必须安装，否则无法使用（-bash: ftp: command not found）</p> 
<h2><a id="_10"></a>二、安装</h2> 
<h3><a id="1vsftp_12"></a>1、检查是否已经安装了vsftp</h3> 
<p>首先查看系统中是否成功安装了vsftpd，执行下面命令(有内容则安装了ftp)</p> 
<pre><code>rpm -qa | grep vsftpd
</code></pre> 
<h3><a id="2_20"></a>2、开始安装</h3> 
<ul><li>在线安装</li></ul> 
<pre><code>yum install vsftpd -y 
</code></pre> 
<ul><li>若linux处于离线状态则无法使用yum命令安装</li></ul> 
<pre><code>离线下载vsftp：
http://rpmfind.net/linux/rpm2html/search.php?query=vsftpd(x86-64)

上传安装包到服务器，放在安装目录，比如/home/ 下

离线安装
rpm -ivh vsftpd-3.0.2-22.el7.x86_64.rpm 
</code></pre> 
<p>安装过程可能会报错，缺少依赖：</p> 
<pre><code>解决：安装相关依赖（centos7 的最新依赖包在博客资源里，可自行去下载）
rpm -ivh libcap-2.16-5.5.el6.x86_64.rpm
rpm -ivh libcap-devel-2.16-5.5.el6.x86_64.rpm
</code></pre> 
<p>检查是否安装成功</p> 
<pre><code>rpm -qa | grep vsftpd
</code></pre> 
<p>服务启动</p> 
<pre><code>systemctl start vsftpd.service
</code></pre> 
<h2><a id="_60"></a>三、配置</h2> 
<h3><a id="1cd_etcvsftpd_62"></a>1、进入cd /etc/vsftpd目录</h3> 
<pre><code>cd /etc/vsftpd
</code></pre> 
<h3><a id="2vsftpdconf_68"></a>2、编辑vsftpd.conf文件</h3> 
<pre><code>养成备份的好习惯

cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.backup.conf

vim vsftpd.conf 
</code></pre> 
<p>修改如下：</p> 
<pre><code>#禁止匿名登录FTP服务器
anonymous_enable=NO
#允许本地用户登录FTP服务器
local_enable=YES
#本地用户上传文件的umask
local_umask=022
#设置本地用户登录后所在目录
local_root=/home/vsftpd/ftpuser
#全部用户是否被限制在主目录
#如果设置成YES会导致你用java代码创建文件夹时失败，因为他被限制在了宿主目录
#chroot_local_user=YES
#开启被动模式
pasv_enable=YES
pasv_addr_resolve=YES
#FTP服务器公网IP（也就是当前阿里云服务器的公网 IP）
pasv_address=120.xx.xx.xx
#设置被动模式下，建立数据传输可使用port范围的最小值
pasv_min_port=10000
#设置被动模式下，建立数据传输可使用port范围的最大值
pasv_max_port=10088


#是否在进入新目录时显示 message_file 文件中的内容
dirmessage_enable=YES
#启用日志
xferlog_enable=YES
#日志是否进行格式化
xferlog_std_format=YES
#独立服务   
listen=YES
#centos7增加此设置，开启后默认监控ipv4和ipv6
listen_ipv6=NO
#认证模式 
pam_service_name=vsftpd
#启用用户列表 
userlist_enable=YES
#可以上传(全局控制)   
write_enable=YES
#允许下载  
download_enable=YES
</code></pre> 
<h3><a id="3ftp_123"></a>3、创建ftp用户</h3> 
<p><strong>这里主要需要创建的用户无法使用普通登录功能或者telnet，只允许使用ftp登录</strong></p> 
<pre><code>useradd -s /sbin/nologin -d /home/vsftpd/ftpuser ftpuser
</code></pre> 
<h3><a id="4_131"></a>4、为用户设置密码</h3> 
<pre><code>passwd ftpuser
</code></pre> 
<h3><a id="5_137"></a>5、将该用户加入到用户列表中(可选)</h3> 
<pre><code>vi /etc/vsftpd/user_list
</code></pre> 
<h3><a id="6_143"></a>6、防火墙设置</h3> 
<pre><code># 方法一：关闭防火墙
systemctl stop firewalld

# 方法二：开放端口
# 提示：防火墙iptables是centos7之前的服务，centos7开始是firewalld服务，开放端口流程请自行百度。另外注意云服务器需要在云平台上设置安全组开放端口
开启
# iptables -I INPUT -i eth0 -p tcp --dport 20 -j ACCEPT
# iptables  -I OUTPUT -o eth0 -p tcp --sport 20 -j ACCEPT
保存
# /etc/rc.d/init.d/iptables save
重启防火墙
# service iptables restart
</code></pre> 
<h3><a id="7selinuxSELINUXdisabled_160"></a>7、修改selinux，将SELINUX改为disabled</h3> 
<pre><code>SELINUX=disabled
</code></pre> 
<h3><a id="8_166"></a>8、设置自启</h3> 
<pre><code>chkconfig vsftpd on
</code></pre> 
<h3><a id="9_172"></a>9、服务重启</h3> 
<pre><code>systemctl restart vsftpd.service

其他命令

#开启
service vsftpd start
#停止
service vsftpd stop
#重启
service vsftpd restart
</code></pre> 
<h2><a id="_187"></a>四、测试</h2> 
<ul><li> <p>安装ftp客户端后，可以进行测试。<strong>230</strong>代表连接成功</p> <pre><code>#连接ftp服务
[root@fan102 ~]# ftp 172.16.1.102 21
Connected to 172.16.1.102 (172.16.1.102).
220 (vsFTPd 3.0.2)
Name (172.16.1.102:root): zion
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; quit
221 Goodbye.
</code></pre> </li><li> <p>windows使用FileZilla可以测试ftp是否可以登录</p> </li><li> <p>linux或mac使用命令</p> <pre><code>sftp 用户名@地址登录
</code></pre> </li></ul> 
<p>​ 注：如果登录出现提示331 Please specify the password，执行下面命令即可：</p> 
<pre><code>echo "/sbin/nologin" &gt;&gt; /etc/shells
</code></pre> 
<p>设置ftp用户只能在自己目录中，这里有两种方式</p> 
<p>第一种：</p> 
<pre><code>chroot_local_user=YES   #设置是否锁定本地用户在自己的主目录中，将所有用户限定在主目录内（登录后无法cd到父目录或同级目录中） 
chroot_list_enable=YES   #设置是否将用户锁定在自己的主目录中 ，YES表示要启用chroot_list_file
chroot_list_file=/etc/vsftpd/chroot_list      #定义哪些用户将会锁定在自己的主目录中，即全体用户都被“限定在主目录内”,所以总是作为“例外列表”的chroot_list_file这时列出的是那些“不会被限制在主目录下”的用户。
</code></pre> 
<p>第二种：</p> 
<pre><code>chroot_local_user=NO	#NO则所有用户不被限定在主目录内
chroot_list_enable=YES	#YES表示要启用chroot_list_file
chroot_list_file=/etc/vsftpd/chroot_list	#因为chroot_local_user=NO，这时列出的是那些“会被限制在主目录下”的用户。
</code></pre> 
<h2><a id="_238"></a>五、登录失败</h2> 
<h3><a id="1530_240"></a>1.错误代码：530</h3> 
<p><em><strong>530 Login incorrect</strong></em></p> 
<pre><code>#查看日志
tail /var/log/secure
</code></pre> 
<p><strong>日志内容：pam_unix(vsftpd:auth): authenticatio，pam_unix(vsftpd:auth): check pass pam_unix(vsftpd:auth): authentication failure,logname= uid=0</strong></p> 
<p><strong>原因</strong></p> 
<p>这个是因为你创建的用户是不需要登陆的你设置了<code>nologin</code>，然后登陆的时候会去<code>/etc/passwd</code>下面检查这个用户，必须为<code>/etc/shells</code>类型才能登陆。</p> 
<p><strong>解决</strong></p> 
<p>#第四行 设置为nologin，或者注释掉</p> 
<pre><code>#修改配置文件
[root@fan102 ~]# vi /etc/pam.d/vsftpd
#第四行 设置为nologin，或者注释掉
1 #%PAM-1.0
2 session    optional     pam_keyinit.so    force revoke
3 auth       required     pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed
4 auth       required     pam_nologin.so
5 auth       include      password-auth
6 account    include      password-auth
7 session    required     pam_loginuid.so
8 session    include      password-auth
</code></pre> 
<h3><a id="2500_273"></a>2.错误代码：500</h3> 
<p><strong>500 OOPS: could not read chroot() list file:/etc/vsftpd/chroot_list</strong></p> 
<p><strong>原因</strong>：用户没有变更根目录的权限，ftp用户默认的根目录是<code>/home/vsftpd/ftpuser</code>，如果要切换登陆目录，需要给予权限</p> 
<p><strong>解决</strong></p> 
<p><strong>第一步：</strong></p> 
<pre><code>#修改配置文件
vi /etc/vsftpd/vsftpd.conf
 
#内容如下
chroot_local_user=YES
chroot_list_enable=YES
chroot_list_file=/etc/vsftpd/chroot_list
</code></pre> 
<p>**第二步：**在<code>/etc/vsftpd/vsftpd</code>创建<code>chroot_list</code>并将用户(<code>ftpuser</code>)加入该文件</p> 
<pre><code>#创建chroot_list并将用户加入该文件
[root@fan102 ~]# /etc/vsftpd/vsftpd/chroot_list
#文件内容
ftpuser
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5e09a4127ab6a1d1d5c4dfdc6f91deb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一篇大数据调优</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1867e649207558fca496b71f63a39430/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jar包解压后再打包为jar</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>