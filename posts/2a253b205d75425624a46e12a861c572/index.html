<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis-Plus 字段类型处理器TypeHandler - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis-Plus 字段类型处理器TypeHandler" />
<meta property="og:description" content="字段类型处理器 类型处理器，用于 JavaType 与 JdbcType 之间的转换，用于 PreparedStatement 设置参数值和从 ResultSet 或 CallableStatement 中取出一个值，本文讲解 mybaits-plus 内置常用类型处理器如何通过TableField注解快速注入到 mybatis 容器中。
JSON 字段类型 @Data @Accessors(chain = true) @TableName(autoResultMap = true) public class User { private Long id; ... /** * 注意！！ 必须开启映射注解 * * @TableName(autoResultMap = true) * * 以下两种类型处理器，二选一 也可以同时存在 * * 注意！！选择对应的 JSON 处理器也必须存在对应 JSON 解析依赖包 */ @TableField(typeHandler = JacksonTypeHandler.class) // @TableField(typeHandler = FastjsonTypeHandler.class) private OtherInfo otherInfo; } 该注解对应了 XML 中写法为
&lt;result column=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2a253b205d75425624a46e12a861c572/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-14T16:08:24+08:00" />
<meta property="article:modified_time" content="2021-01-14T16:08:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis-Plus 字段类型处理器TypeHandler</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="字段类型处理器">字段类型处理器</h2> 
<blockquote> 
 <p>类型处理器，用于 JavaType 与 JdbcType 之间的转换，用于 PreparedStatement 设置参数值和从 ResultSet 或 CallableStatement 中取出一个值，本文讲解 <code>mybaits-plus</code> 内置常用类型处理器如何通过<code>TableField</code>注解快速注入到 <code>mybatis</code> 容器中。</p> 
</blockquote> 
<ul><li>JSON 字段类型</li></ul> 
<pre><code>@Data
@Accessors(chain = true)
@TableName(autoResultMap = true)
public class User {
    private Long id;

    ...


    /**
     * 注意！！ 必须开启映射注解
     *
     * @TableName(autoResultMap = true)
     *
     * 以下两种类型处理器，二选一 也可以同时存在
     *
     * 注意！！选择对应的 JSON 处理器也必须存在对应 JSON 解析依赖包
     */
    @TableField(typeHandler = JacksonTypeHandler.class)
    // @TableField(typeHandler = FastjsonTypeHandler.class)
    private OtherInfo otherInfo;

}
</code></pre> 
<p>该注解对应了 XML 中写法为</p> 
<pre><code>&lt;result column="other_info" jdbcType="VARCHAR" property="otherInfo" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler" /&gt;
</code></pre> 
<p> </p> 
<h2>实际使用</h2> 
<h4>1，准备工作</h4> 
<p>（1）MyBatis 中的 TypeHandler 类型处理器用于 JavaType 与 JdbcType 之间的转换，假设我们用户表中有一个联系方式字段，类型为字符串：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_2926.html#" rel="nofollow"><img alt="原文:SpringBoot - MyBatis-Plus使用详解16（字段类型处理器TypeHandler）" src="https://images2.imgbox.com/bb/ba/46NfCRIq_o.png"></a></p> 
<p> </p> 
<p>（2）而对应的实体类代码如下，可以看到实体类中 contact 属性类型为 Map。由于与数据库字段类型不匹配，如果不做任何处理的话无论是查询还是插入都会报错。</p> 
<p>    这里我们通过 @TableField 注解将 FastjsonTypeHandler 这个类型处理器快速注入到 mybatis 容器中：</p> 
<p>注意：使用字段类型处理器时，必须开启映射注解 @TableName(autoResultMap = true)。否则插入没问题，但查询时该字段会为空。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>@Data</code></p> <p><code>@TableName</code><code>(autoResultMap = </code><code>true</code><code>)</code></p> <p><code>public</code> <code>class</code> <code>UserInfo {<!-- --></code></p> <p><code>    </code><code>private</code> <code>Integer id;</code></p> <p><code>    </code><code>private</code> <code>String userName;</code></p> <p><code>    </code><code>private</code> <code>String passWord;</code></p> <p><code>    </code><code>private</code> <code>Integer age;</code></p> <p><code>    </code><code>@TableField</code><code>(typeHandler = FastjsonTypeHandler.</code><code>class</code><code>)</code></p> <p><code>    </code><code>private</code> <code>Map&lt;String, String&gt; contact;</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p><br> （3）由于这里用到了 Fastjson 这个 JSON 处理器，所以项目中也要添加相关的依赖：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> </td><td> <p><code>&lt;</code><code>dependency</code><code>&gt;</code></p> <p><code>    </code><code>&lt;</code><code>groupId</code><code>&gt;com.alibaba&lt;/</code><code>groupId</code><code>&gt;</code></p> <p><code>    </code><code>&lt;</code><code>artifactId</code><code>&gt;fastjson&lt;/</code><code>artifactId</code><code>&gt;</code></p> <p><code>    </code><code>&lt;</code><code>version</code><code>&gt;1.2.56&lt;/</code><code>version</code><code>&gt;</code></p> <p><code>&lt;/</code><code>dependency</code><code>&gt;</code></p> </td></tr></tbody></table> 
<p> </p> 
<h4>2，开始测试</h4> 
<p>（1）首先创建一个对象插入到数据库，可以看到虽然对象里的 contact 是一个 Map，但会自动转成 JSON 字符串存到数据库中：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> </td><td> <p><code>UserInfo user = </code><code>new</code> <code>UserInfo();</code></p> <p><code>user.setUserName(</code><code>"hangge"</code><code>);</code></p> <p><code>user.setPassWord(</code><code>"123"</code><code>);</code></p> <p><code>//添加联系方式</code></p> <p><code>Map&lt;String, String&gt; contact = </code><code>new</code> <code>HashMap&lt;&gt;();</code></p> <p><code>contact.put(</code><code>"phone"</code><code>, </code><code>"010-1234567"</code><code>);</code></p> <p><code>contact.put(</code><code>"tel"</code><code>, </code><code>"13388889999"</code><code>);</code></p> <p><code>user.setContact(contact);</code></p> <p><code>userInfoMapper.insert(user);</code></p> </td></tr></tbody></table> 
<p><a href="https://www.hangge.com/blog/cache/detail_2926.html#" rel="nofollow"><img alt="原文:SpringBoot - MyBatis-Plus使用详解16（字段类型处理器TypeHandler）" src="https://images2.imgbox.com/72/f1/aQzhgBTK_o.png"></a></p> 
<p><br> （2）接着测试下查询，可以发现数据库的 JSON 字符串也会自动转换成 Map：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>List&lt;UserInfo&gt; users = userInfoMapper.selectList(</code><code>null</code><code>);</code></p> <p><code>System.out.println(users);</code></p> </td></tr></tbody></table> 
<p><a href="https://www.hangge.com/blog/cache/detail_2926.html#" rel="nofollow"><img alt="原文:SpringBoot - MyBatis-Plus使用详解16（字段类型处理器TypeHandler）" src="https://images2.imgbox.com/3c/25/6GjN04tG_o.png"></a></p> 
<p> </p> 
<h3>附：自定义 TypeHandler 类型处理器</h3> 
<h4>1，准备工作</h4> 
<p>（1）如果我们需要实现一个自定义的 TypeHandler 类型处理器，则需继承 ListTypeHandler 接口，接口作用是用于指定 jdbc 与 java 的数据类型间对应关系处理。接口代码如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> </td><td> <p><code>public</code> <code>interface</code> <code>TypeHandler&lt;T&gt; {<!-- --></code></p> <p><code>  </code><code>// 保存操作，数据入库之前时数据处理</code></p> <p><code>  </code><code>void</code> <code>setParameter(PreparedStatement ps, </code><code>int</code> <code>i, T parameter, JdbcType jdbcType) </code><code>throws</code> <code>SQLException;</code></p> <p><code>  </code><code>//下面三个则是，从数据库加载数据后，vo对象封装前的数据处理</code></p> <p><code>  </code><code>T getResult(ResultSet rs, String columnName) </code><code>throws</code> <code>SQLException;</code></p> <p><code>  </code><code>T getResult(ResultSet rs, </code><code>int</code> <code>columnIndex) </code><code>throws</code> <code>SQLException;</code></p> <p><code>  </code><code>T getResult(CallableStatement cs, </code><code>int</code> <code>columnIndex) </code><code>throws</code> <code>SQLException;</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p><br> （2）这里我们定义一个 list 类型转 varchar（逗号隔开的字符串）的类型处理器，即 list [1,2,3] ==》varchar 1,2,3</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> <p>49</p> <p>50</p> <p>51</p> <p>52</p> <p>53</p> </td><td> <p><code>@MappedJdbcTypes</code><code>(JdbcType.VARCHAR)  </code><code>//数据库类型</code></p> <p><code>@MappedTypes</code><code>({List.</code><code>class</code><code>})          </code><code>//java数据类型</code></p> <p><code>@Log</code></p> <p><code>public</code> <code>class</code> <code>ListTypeHandler </code><code>implements</code> <code>TypeHandler&lt;List&lt;String&gt;&gt; {<!-- --></code></p> <p> </p> <p><code>    </code><code>@Override</code></p> <p><code>    </code><code>public</code> <code>void</code> <code>setParameter(PreparedStatement ps, </code><code>int</code> <code>i,</code></p> <p><code>                             </code><code>List&lt;String&gt; parameter, JdbcType jdbcType) </code><code>throws</code> <code>SQLException {<!-- --></code></p> <p><code>        </code><code>log.info(</code><code>"method ====&gt;&gt;&gt; setParameter"</code><code>);</code></p> <p><code>        </code><code>String hobbys = dealListToOneStr(parameter);</code></p> <p><code>        </code><code>ps.setString(i , hobbys);</code></p> <p><code>    </code><code>}</code></p> <p> </p> <p><code>    </code><code>/**</code></p> <p><code>     </code><code>* 集合拼接字符串</code></p> <p><code>     </code><code>* @param parameter</code></p> <p><code>     </code><code>* @return</code></p> <p><code>     </code><code>*/</code></p> <p><code>    </code><code>private</code> <code>String dealListToOneStr(List&lt;String&gt; parameter){<!-- --></code></p> <p><code>        </code><code>if</code><code>(parameter == </code><code>null</code> <code>|| parameter.size() &lt;=</code><code>0</code><code>)</code></p> <p><code>            </code><code>return</code> <code>null</code><code>;</code></p> <p><code>        </code><code>String res = </code><code>""</code><code>;</code></p> <p><code>        </code><code>for</code> <code>(</code><code>int</code> <code>i = </code><code>0</code> <code>;i &lt; parameter.size(); i++) {<!-- --></code></p> <p><code>            </code><code>if</code><code>(i == parameter.size()-</code><code>1</code><code>){<!-- --></code></p> <p><code>                </code><code>res+=parameter.get(i);</code></p> <p><code>                </code><code>return</code> <code>res;</code></p> <p><code>            </code><code>}</code></p> <p><code>            </code><code>res+=parameter.get(i)+</code><code>","</code><code>;</code></p> <p><code>        </code><code>}</code></p> <p><code>        </code><code>return</code> <code>null</code><code>;</code></p> <p><code>    </code><code>}</code></p> <p><code>    </code> </p> <p><code>    </code><code>@Override</code></p> <p><code>    </code><code>public</code> <code>List&lt;String&gt; getResult(ResultSet rs, String columnName)</code></p> <p><code>            </code><code>throws</code> <code>SQLException {<!-- --></code></p> <p><code>        </code><code>log.info(</code><code>"method ====&gt;&gt;&gt; getResult(ResultSet rs, String columnName)"</code><code>);</code></p> <p><code>        </code><code>return</code> <code>Arrays.asList(rs.getString(columnName).split(</code><code>","</code><code>));</code></p> <p><code>    </code><code>}</code></p> <p> </p> <p><code>    </code><code>@Override</code></p> <p><code>    </code><code>public</code> <code>List&lt;String&gt; getResult(ResultSet rs, </code><code>int</code> <code>columnIndex)</code></p> <p><code>            </code><code>throws</code> <code>SQLException {<!-- --></code></p> <p><code>        </code><code>log.info(</code><code>"method ====&gt;&gt;&gt; getResult(ResultSet rs, int columnIndex)"</code><code>);</code></p> <p><code>        </code><code>return</code> <code>Arrays.asList(rs.getString(columnIndex).split(</code><code>","</code><code>));</code></p> <p><code>    </code><code>}</code></p> <p> </p> <p><code>    </code><code>@Override</code></p> <p><code>    </code><code>public</code> <code>List&lt;String&gt; getResult(CallableStatement cs, </code><code>int</code> <code>columnIndex) </code><code>throws</code> <code>SQLException{<!-- --></code></p> <p><code>        </code><code>log.info(</code><code>"method ====&gt;&gt;&gt; getResult(CallableStatement cs, int columnIndex)"</code><code>);</code></p> <p><code>        </code><code>String hobbys = cs.getString(columnIndex);</code></p> <p><code>        </code><code>return</code> <code>Arrays.asList(hobbys.split(</code><code>","</code><code>));</code></p> <p><code>    </code><code>}</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p><br> （3）接着在对应的实例类中使用 @TableField 注解指定使用这个自定义的字段类型处理器：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>@Data</code></p> <p><code>@TableName</code><code>(autoResultMap = </code><code>true</code><code>)</code></p> <p><code>public</code> <code>class</code> <code>UserInfo {<!-- --></code></p> <p><code>    </code><code>private</code> <code>Integer id;</code></p> <p><code>    </code><code>private</code> <code>String userName;</code></p> <p><code>    </code><code>private</code> <code>String passWord;</code></p> <p><code>    </code><code>private</code> <code>Integer age;</code></p> <p><code>    </code><code>@TableField</code><code>(typeHandler = ListTypeHandler.</code><code>class</code><code>)</code></p> <p><code>    </code><code>private</code> <code>List&lt;String&gt; contact;</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p> </p> 
<h4>2，开始测试</h4> 
<p>（1）首先创建一个对象插入到数据库，可以看到虽然对象里的 contact 是一个 List，但会自动转成逗号隔开的字符串存到数据库中：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>UserInfo user = </code><code>new</code> <code>UserInfo();</code></p> <p><code>user.setUserName(</code><code>"hangge"</code><code>);</code></p> <p><code>user.setPassWord(</code><code>"123"</code><code>);</code></p> <p><code>//添加联系方式</code></p> <p><code>List&lt;String&gt; contact = </code><code>new</code> <code>ArrayList&lt;&gt;();</code></p> <p><code>contact.add(</code><code>"010-1234567"</code><code>);</code></p> <p><code>contact.add(</code><code>"13388889999"</code><code>);</code></p> <p><code>contact.add(</code><code>"10001"</code><code>);</code></p> <p><code>user.setContact(contact);</code></p> <p><code>userInfoMapper.insert(user);</code></p> </td></tr></tbody></table> 
<p><a href="https://www.hangge.com/blog/cache/detail_2926.html#" rel="nofollow"><img alt="原文:SpringBoot - MyBatis-Plus使用详解16（字段类型处理器TypeHandler）" src="https://images2.imgbox.com/19/a1/GSnRFi7j_o.png"></a></p> 
<p><br> （2）接着测试下查询，可以发现数据库的字符串也会自动还原成 List：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>List&lt;UserInfo&gt; users = userInfoMapper.selectList(</code><code>null</code><code>);</code></p> <p><code>System.out.println(users);</code></p> </td></tr></tbody></table> 
<p><a href="https://www.hangge.com/blog/cache/detail_2926.html#" rel="nofollow"><img alt="原文:SpringBoot - MyBatis-Plus使用详解16（字段类型处理器TypeHandler）" src="https://images2.imgbox.com/7e/ee/DXjBQpXe_o.png"></a></p> 
<p><br> 原文出自：<a href="https://www.hangge.com/" rel="nofollow">www.hangge.com</a>  转载请保留原文链接：<a href="https://www.hangge.com/blog/cache/detail_2926.html" rel="nofollow">https://www.hangge.com/blog/cache/detail_2926.html</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/539c6188ac495e0770777b1b57115b3c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">电脑进入pe时蓝屏_进入PE系统就蓝屏怎么办？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c77516057de7cb7e87030bd4cc15123a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">7段均衡器最佳参数_7段均衡器怎么调能达到最佳效果？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>