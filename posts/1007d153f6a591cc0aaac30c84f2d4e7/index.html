<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2022护网日记，护网工作内容、护网事件、告警流量分析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2022护网日记，护网工作内容、护网事件、告警流量分析" />
<meta property="og:description" content="「作者主页」：士别三日wyx
「作者简介」：CSDN top100、阿里云博客专家、华为云享专家、网络安全领域优质创作者
2022护网日记 一、监控设备二、工作内容三、安全事件 1）失陷主机排查2）后门网站修复 四、告警流量分析 1）信息泄露2）SQL注入3）文件上传4）XSS（跨站脚本）5）代码执行 今年HW总共15天，7月25号开始，到8月8号结束。
总的来说，人坐在电脑前的时候，风平浪静，时不时蹦出几个告警。
可一到换班或去厕所的时候，就会突然冒出几百条告警。
我一度怀疑我们的摄像头是不是已经被入侵了，一看到我人离开就开始攻击。
如果你问我，今年HW最大的收获是什么，我一定会说：我收获了一个强大的膀胱！！！
一、监控设备 首先是设备，（本人）这次HW使用的安全产品主要有两个：天眼和椒图。
产品全称天眼奇安信天眼威胁检测与分析系统椒图奇安信网神云锁服务器安全管理系统 天眼负责流量分析，部署在旁路，对交换机镜像过来的流量进行监测、分析和溯源。
椒图负责服务器的系统防护，通过在服务器上安装的客户端，将收集到的主机信息发送到控制中心集中分析。
二、工作内容 防守方主要分为三个组：安全监控组、事件研判组、应急处置组。
1）监控组分析安全设备的告警，确定是攻击就提交给处置组封禁IP；分析不出来就提交给研判组分析。
2）研判组负责分析监控组提交的告警是否为攻击，必要时可以访问受害网站复现攻击，或者联系受害网站的负责人验证是不是正常业务/人为操作。
3）处置组主要负责封禁IP，如果是webshell这种攻击，还需要联系受害网站的负责人，协助修复漏洞或者加固网站。
三个组通过指挥调度管理系统进行协作防护：
大家上班第一件事就是登录管理系统，监控组向管理系统提交告警的攻击/受害IP、告警类型以及payload，处置组/研判组看到管理系统上有新的告警了就封禁IP/分析告警事件。
原则上来说，我一个安全监控组，只需要盯着安全设备，简单分析一下然后提交告警就可以了。
由于公司就来了我一个，只要是我们产品相关的事，都会把我喊过去。
因此，除了设备监控外，我的工作还包括但不限于：分析webshell文件、分析病毒木马文件、升级/加固安全产品、对失陷主机进行后门扫描和病毒查杀、以及协助失陷网站修整加固。。。
三、安全事件 好了，撇开厕所不谈，下面分享几个印象比较深的攻击事件吧：
1）失陷主机排查 青藤云的蜜罐检查到，有个用户电脑访问了蜜罐的80端口，用户断网以后用360和火绒查杀了三个毒以后，重新上线，结果又踩了蜜罐，用户又用360和火绒扫了一遍，啥也没扫出来，就喊我过去处理。
当时我就一脸懵逼：这是我一个安全监控该干的事吗？
但架不住一群人直勾勾的盯着我，只能硬着头皮去干
先是用椒图扫了一遍webshell和后门文件。
确认没有后门以后，用专杀工具全盘扫描，扫出来7个病毒。
扔到ti威胁情报中心鉴定，确定就是高危病毒。
然后提交到二线做病毒分析，确认是远控木马类病毒，与触发蜜罐的告警有相关性。
最后删掉病毒，重新上线，没有再出现异常现象。
2）后门网站修复 椒图检测到一个服务器上存在webshell，通知用户紧急下线网站，开始排查和加固。
一群人围在哪里分析了半天，然后理所应当的把这事扔给了我：“你们家的设备，当然要你去处理呀~”
老规矩，先用椒图扫一下webshell和后门，在Temp目录下扫出来一个webshell。
跟用户的开发核实后，确认不是业务文件，是被人上传了文件。
于是删掉webshell，取消了Temp目录的所有用户权限，在椒图上吧这台服务器的防护全部开启（默认只检测不拦截）。
开发也临时关闭了上传的功能，然后准备重新上线。
结果上线后，网站访问不了。。。
在重新部署了n遍项目，外加换了两台备用服务器后，时间已经来到了凌晨六点，距离规定的上线时间还差三个小时。
“实在不行，咱们就写个静态主页跳404吧，点啥功能都给跳到404，最起码，他们一时半会儿不会怀疑是我们的问题，咱们也能多点时间排查问题。”
开发的嘴角慢慢上扬，空洞的眼神里重新亮起了光。
不幸的是，这话被项目经理偷听到了，在经理的谴责声中，我看到，开发的眼神，竟慢慢的黯淡下来，直到剩下两个黑黑的眼眶。
兴许是一晚上没去厕所的原因，在换到第三台备用服务器的时候，网站终于恢复了。
事后，我问开发：“你们的运维咋没过来呢？”
“我就是运维。”
“那，开发呢？”
“开发也是我。”
“？？？，那，你们项目组。。。”
“只有我自己~”
四、告警流量分析 平均下来，一天得有三千多条告警，但其中大部分都是误报，接下来分享一些简单的告警流量特征。
1）信息泄露 看访问路径中是否存在特殊文件或路径。
比如，访问备份文件.zip
访问默认文件
或者特殊类型的文件
客户授权的话，可以访问该路径，查看返回结果中是否包含敏感信息，以判断是否攻击成功。
2）SQL注入 看请求参数、请求头或请求体中是否包含SQL语句或关键字。
比如，GET请求中包含SQL语句（联合查询注入）：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1007d153f6a591cc0aaac30c84f2d4e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-31T19:53:23+08:00" />
<meta property="article:modified_time" content="2022-10-31T19:53:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2022护网日记，护网工作内容、护网事件、告警流量分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div id="content_views" class="markdown_views prism-tomorrow-night"> 
 <svg xmlns="http://www.w3.org/2000/svg"> 
  <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block"></path> 
 </svg> 
 <blockquote> 
  <p><font color="orange">「作者主页」：</font><a href="https://blog.csdn.net/wangyuxiang946">士别三日wyx</a><br> <font color="orange">「作者简介」：</font>CSDN top100、阿里云博客专家、华为云享专家、网络安全领域优质创作者</p> 
 </blockquote> 
 <p></p> 
 <div class="toc"> 
  <h4>2022护网日记 </h4> 
  <ul><li><a href="#_13" rel="nofollow noopener noreferrer" target="_self">一、监控设备</a></li><li><a href="#_24" rel="nofollow noopener noreferrer" target="_self">二、工作内容</a></li><li><a href="#_38" rel="nofollow noopener noreferrer" target="_self">三、安全事件</a></li><li> 
    <ul><li><a href="#1_40" rel="nofollow noopener noreferrer" target="_self">1）失陷主机排查</a></li><li><a href="#2_52" rel="nofollow noopener noreferrer" target="_self">2）后门网站修复</a></li></ul> </li><li><a href="#_86" rel="nofollow noopener noreferrer" target="_self">四、告警流量分析</a></li><li> 
    <ul><li><a href="#1_89" rel="nofollow noopener noreferrer" target="_self">1）信息泄露</a></li><li><a href="#2SQL_103" rel="nofollow noopener noreferrer" target="_self">2）SQL注入</a></li><li><a href="#3_127" rel="nofollow noopener noreferrer" target="_self">3）文件上传</a></li><li><a href="#4XSS_134" rel="nofollow noopener noreferrer" target="_self">4）XSS（跨站脚本）</a></li><li><a href="#5_142" rel="nofollow noopener noreferrer" target="_self">5）代码执行</a></li></ul> </li></ul> 
 </div> 
 <p></p> 
 <p>今年HW总共15天，7月25号开始，到8月8号结束。<br> 总的来说，人坐在电脑前的时候，风平浪静，时不时蹦出几个告警。<br> 可一到换班或去厕所的时候，就会突然冒出几百条告警。<br> <img src="https://images2.imgbox.com/d1/86/YRcJniOI_o.png" alt="在这里插入图片描述"></p> 
 <p>我一度怀疑我们的摄像头是不是已经被入侵了，一看到我人离开就开始攻击。</p> 
 <p>如果你问我，今年HW最大的收获是什么，我一定会说：我收获了一个强大的膀胱！！！</p> 
 <h2><a id="_13"></a>一、监控设备</h2> 
 <p>首先是设备，（本人）这次HW使用的安全产品主要有两个：天眼和椒图。</p> 
 <div class="table-box"> 
  <table><thead><tr><th>产品</th><th>全称</th></tr></thead><tbody><tr><td>天眼</td><td>奇安信天眼威胁检测与分析系统</td></tr><tr><td>椒图</td><td>奇安信网神云锁服务器安全管理系统</td></tr></tbody></table> 
 </div> 
 <p>天眼负责<a href="https://so.csdn.net/so/search?q=%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">流量分析</a>，部署在旁路，对交换机镜像过来的流量进行监测、分析和溯源。</p> 
 <p>椒图负责服务器的系统防护，通过在服务器上安装的客户端，将收集到的主机信息发送到控制中心集中分析。</p> 
 <h2><a id="_24"></a>二、工作内容</h2> 
 <p>防守方主要分为三个组：安全监控组、事件研判组、应急处置组。<br> 1）监控组分析安全设备的告警，确定是攻击就提交给处置组封禁IP；分析不出来就提交给研判组分析。<br> 2）研判组负责分析监控组提交的告警是否为攻击，必要时可以访问受害网站复现攻击，或者联系受害网站的负责人验证是不是正常业务/人为操作。<br> 3）处置组主要负责封禁IP，如果是webshell这种攻击，还需要联系受害网站的负责人，协助修复漏洞或者加固网站。</p> 
 <p>三个组通过指挥调度管理系统进行协作防护：<br> 大家上班第一件事就是登录管理系统，监控组向管理系统提交告警的攻击/受害IP、告警类型以及payload，处置组/研判组看到管理系统上有新的告警了就封禁IP/分析告警事件。</p> 
 <p>原则上来说，我一个安全监控组，只需要盯着安全设备，简单分析一下然后提交告警就可以了。<br> 由于公司就来了我一个，只要是我们产品相关的事，都会把我喊过去。<br> 因此，除了设备监控外，我的工作还包括但不限于：分析webshell文件、分析病毒木马文件、升级/加固安全产品、对失陷主机进行后门扫描和病毒查杀、以及协助失陷网站修整加固。。。</p> 
 <h2><a id="_38"></a>三、安全事件</h2> 
 <p>好了，撇开厕所不谈，下面分享几个印象比较深的攻击事件吧：</p> 
 <h3><a id="1_40"></a>1）失陷主机排查</h3> 
 <p>青藤云的蜜罐检查到，有个用户电脑访问了蜜罐的80端口，用户断网以后用360和火绒查杀了三个毒以后，重新上线，结果又踩了蜜罐，用户又用360和火绒扫了一遍，啥也没扫出来，就喊我过去处理。</p> 
 <p>当时我就一脸懵逼：这是我一个安全监控该干的事吗？<br> 但架不住一群人直勾勾的盯着我，只能硬着头皮去干</p> 
 <p>先是用椒图扫了一遍webshell和后门文件。<br> 确认没有后门以后，用专杀工具全盘扫描，扫出来7个病毒。<br> 扔到ti威胁情报中心鉴定，确定就是高危病毒。<br> 然后提交到二线做病毒分析，确认是远控木马类病毒，与触发蜜罐的告警有相关性。<br> 最后删掉病毒，重新上线，没有再出现异常现象。</p> 
 <h3><a id="2_52"></a>2）后门网站修复</h3> 
 <p>椒图检测到一个服务器上存在webshell，通知用户紧急下线网站，开始排查和加固。</p> 
 <p>一群人围在哪里分析了半天，然后理所应当的把这事扔给了我：“你们家的设备，当然要你去处理呀~”</p> 
 <p>老规矩，先用椒图扫一下webshell和后门，在Temp目录下扫出来一个webshell。<br> 跟用户的开发核实后，确认不是业务文件，是被人上传了文件。<br> 于是删掉webshell，取消了Temp目录的所有用户权限，在椒图上吧这台服务器的防护全部开启（默认只检测不拦截）。<br> 开发也临时关闭了上传的功能，然后准备重新上线。</p> 
 <p>结果上线后，网站访问不了。。。</p> 
 <p>在重新部署了n遍项目，外加换了两台备用服务器后，时间已经来到了凌晨六点，距离规定的上线时间还差三个小时。<br> “实在不行，咱们就写个静态主页跳404吧，点啥功能都给跳到404，最起码，他们一时半会儿不会怀疑是我们的问题，咱们也能多点时间排查问题。”<br> 开发的嘴角慢慢上扬，空洞的眼神里重新亮起了光。</p> 
 <p>不幸的是，这话被项目经理偷听到了，在经理的谴责声中，我看到，开发的眼神，竟慢慢的黯淡下来，直到剩下两个黑黑的眼眶。<br> <img src="https://images2.imgbox.com/ba/f6/ZQKaqKVg_o.png" alt="在这里插入图片描述"></p> 
 <p>兴许是一晚上没去厕所的原因，在换到第三台备用服务器的时候，网站终于恢复了。</p> 
 <p>事后，我问开发：“你们的运维咋没过来呢？”</p> 
 <p>“我就是运维。”</p> 
 <p>“那，开发呢？”</p> 
 <p>“开发也是我。”</p> 
 <p>“？？？，那，你们项目组。。。”</p> 
 <p>“只有我自己~”</p> 
 <h2><a id="_86"></a>四、告警流量分析</h2> 
 <p>平均下来，一天得有三千多条告警，但其中大部分都是误报，接下来分享一些简单的告警流量特征。</p> 
 <h3><a id="1_89"></a>1）信息泄露</h3> 
 <p>看访问路径中是否存在特殊文件或路径。<br> 比如，访问备份文件<code>.zip</code></p> 
 <p><img src="https://images2.imgbox.com/b2/08/dkQwa9Qs_o.png" alt="在这里插入图片描述"></p> 
 <p>访问默认文件</p> 
 <p><img src="https://images2.imgbox.com/36/b5/uCl1xoho_o.png" alt="在这里插入图片描述"></p> 
 <p>或者特殊类型的文件<br> <img src="https://images2.imgbox.com/6a/f2/W8dvrOHW_o.png" alt="在这里插入图片描述"><br> 客户授权的话，可以访问该路径，查看返回结果中是否包含敏感信息，以判断是否攻击成功。</p> 
 <h3><a id="2SQL_103"></a>2）SQL注入</h3> 
 <p>看请求参数、请求头或请求体中是否包含SQL语句或关键字。</p> 
 <p>比如，GET请求中包含SQL语句（联合查询注入）：</p> 
 <p><img src="https://images2.imgbox.com/68/a3/HiRnOzp9_o.png" alt="在这里插入图片描述"><br> 请求头中包含SQL语句：</p> 
 <p><img src="https://images2.imgbox.com/0c/b7/Cv2IPXNm_o.png" alt="在这里插入图片描述"></p> 
 <p>POST请求体中包含SQL语句：<br> <img src="https://images2.imgbox.com/5e/4a/dvk2qrg8_o.png" alt="在这里插入图片描述"></p> 
 <p>为了方便绕过，还会改变SQL关键字的大小写或编码。</p> 
 <p>比如：大小写绕过：</p> 
 <p><img src="https://images2.imgbox.com/09/39/fUQPFoTc_o.png" alt="在这里插入图片描述"><br> 编码绕过：</p> 
 <p><img src="https://images2.imgbox.com/d4/b2/OFoClK4z_o.png" alt="在这里插入图片描述"></p> 
 <p>客户授权的话，可以复现payload，根据页面的返回结果、响应时间来判断是否注入成功。</p> 
 <h3><a id="3_127"></a>3）文件上传</h3> 
 <p>看请求体中是否包含代码内容：</p> 
 <p><img src="https://images2.imgbox.com/2a/ab/PXpUIWxx_o.png" alt="在这里插入图片描述"></p> 
 <p>如果响应体中有 <code>success</code> 等上传成功的字样，或者有该文件的访问记录，则说明webshell上传成功。</p> 
 <h3><a id="4XSS_134"></a>4）XSS（跨站脚本）</h3> 
 <p>看请求参数或请求体中是否包含JavaScript代码：</p> 
 <p><img src="https://images2.imgbox.com/61/bc/3vHyhKIk_o.png" alt="在这里插入图片描述"><br> 将响应体的数据复制到文件中执行，如果弹窗，就说明攻击成功。<br> 如果没弹窗，就 <code>Ctrl+F</code> 搜JS代码，常见的有：</p> 
 <p><img src="https://images2.imgbox.com/0e/3e/W5YLMf07_o.png" alt="在这里插入图片描述"></p> 
 <h3><a id="5_142"></a>5）代码执行</h3> 
 <p>看请求参数、请求头、请求体中是否包含恶意代码。</p> 
 <p>比如，请求体中包含PHP代码：</p> 
 <p><img src="https://images2.imgbox.com/05/da/Qq1S9KFh_o.png" alt="在这里插入图片描述"></p> 
 <p>Dedecms V5.7后台任意代码执行：</p> 
 <p><img src="https://images2.imgbox.com/02/d0/2FA9Un0b_o.png" alt="在这里插入图片描述"><br> Fastjson反序列化漏洞攻击：</p> 
 <p><img src="https://images2.imgbox.com/e2/fd/xukykTFw_o.png" alt="在这里插入图片描述"><br> ThinkPHP 5.0.x—5.1 远程代码执行：</p> 
 <p><img src="https://images2.imgbox.com/df/36/LGF9gJ7I_o.png" alt="在这里插入图片描述"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd9318533c874f49a40225fd85129022/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">gitee码云平台上进行一次完整的pull、modify、push、pull request开源流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b08a2995b816fb8d83c8b377c0799c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java网上订餐管理系统餐饮就餐订餐餐厅（含源码&#43;论文&#43;答辩PPT等）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>