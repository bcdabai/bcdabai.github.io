<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python编程玩具有哪些_python 全栈开发，Day133(玩具与玩具之间的对话,基于jieba gensim  pypinyin实现的自然语言处理,打包apk)... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python编程玩具有哪些_python 全栈开发，Day133(玩具与玩具之间的对话,基于jieba gensim  pypinyin实现的自然语言处理,打包apk)..." />
<meta property="og:description" content="先下载github代码，下面的操作，都是基于这个版本来的！
注意：由于涉及到版权问题，此附件没有图片和音乐。请参考链接，手动采集一下！
请参考链接：
一、玩具与玩具之间的对话
app消息提醒
之前实现了App发送语音消息给web端玩具，web端有消息提醒。现在app端，也需要消息提醒！
那么在后端，需要判断。这个消息是人还是玩具发送的消息。加一个user_type
玩具表增加user_type
修改玩具表toys。这里的小鱼，表示用户！
增加user_type
toys表的其他记录，也需要一并修改
务必保证 friend_list里面的每一条记录。都有user_type字段！
务必保证，每一个玩具都有2个好友。一个是主人，一个是除自己之外的玩具。
用户表增加user_type
修改用户表
修改第一个好友，增加user_type字段，toy表示玩具
修改另外一条记录
完整数据如下：
{&#34;_id&#34; : ObjectId(&#34;5b9bb768e1253281608e96eb&#34;),&#34;username&#34; : &#34;xiao&#34;,&#34;password&#34; : &#34;202cb962ac59075b964b07152d234b70&#34;,&#34;age&#34; : &#34;20&#34;,&#34;nickname&#34; : &#34;xiao&#34;,&#34;gender&#34; : &#34;1&#34;,&#34;phone&#34; : &#34;1234567&#34;,&#34;avatar&#34; : &#34;boy.jpg&#34;,&#34;bind_toy&#34;: [&#34;5ba0f1f2e12532418089bf88&#34;,&#34;5ba21c84e1253229c4acbd12&#34;],&#34;friend_list&#34;: [
{&#34;friend_id&#34; : &#34;5ba0f1f2e12532418089bf88&#34;,&#34;friend_name&#34; : &#34;小可爱&#34;,&#34;friend_remark&#34; : &#34;小甜甜&#34;,&#34;friend_avatar&#34; : &#34;girl.jpg&#34;,&#34;friend_chat&#34; : &#34;5ba0f1f2e12532418089bf87&#34;,&#34;user_type&#34; : &#34;toy&#34;},
{&#34;friend_id&#34; : &#34;5ba21c84e1253229c4acbd12&#34;,&#34;friend_name&#34; : &#34;嘻嘻&#34;,&#34;friend_remark&#34; : &#34;小豆芽&#34;,&#34;friend_avatar&#34; : &#34;girl.jpg&#34;,&#34;friend_chat&#34; : &#34;5ba21c84e1253229c4acbd11&#34;,&#34;user_type&#34; : &#34;toy&#34;}
]
}
View Code
务必保证 friend_list里面的每一条记录。都有user_type字段！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5bec3801f89223811c77fca5722e2422/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-10T09:23:12+08:00" />
<meta property="article:modified_time" content="2020-12-10T09:23:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python编程玩具有哪些_python 全栈开发，Day133(玩具与玩具之间的对话,基于jieba gensim  pypinyin实现的自然语言处理,打包apk)...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>先下载github代码，下面的操作，都是基于这个版本来的！</p> 
 <p>注意：由于涉及到版权问题，此附件没有图片和音乐。请参考链接，手动采集一下！</p> 
 <p>请参考链接：</p> 
 <p>一、玩具与玩具之间的对话</p> 
 <p>app消息提醒</p> 
 <p>之前实现了App发送语音消息给web端玩具，web端有消息提醒。现在app端，也需要消息提醒！</p> 
 <p>那么在后端，需要判断。这个消息是人还是玩具发送的消息。加一个user_type</p> 
 <p>玩具表增加user_type</p> 
 <p>修改玩具表toys。这里的小鱼，表示用户！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>toys表的其他记录，也需要一并修改</p> 
 <p>务必保证 friend_list里面的每一条记录。都有user_type字段！</p> 
 <p>务必保证，每一个玩具都有2个好友。一个是主人，一个是除自己之外的玩具。</p> 
 <p>用户表增加user_type</p> 
 <p>修改用户表</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>修改第一个好友，增加user_type字段，toy表示玩具</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>修改另外一条记录</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>完整数据如下：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>{"_id" : ObjectId("5b9bb768e1253281608e96eb"),"username" : "xiao","password" : "202cb962ac59075b964b07152d234b70","age" : "20","nickname" : "xiao","gender" : "1","phone" : "1234567","avatar" : "boy.jpg","bind_toy": ["5ba0f1f2e12532418089bf88","5ba21c84e1253229c4acbd12"],"friend_list": [</p> 
 <p>{"friend_id" : "5ba0f1f2e12532418089bf88","friend_name" : "小可爱","friend_remark" : "小甜甜","friend_avatar" : "girl.jpg","friend_chat" : "5ba0f1f2e12532418089bf87","user_type" : "toy"},</p> 
 <p>{"friend_id" : "5ba21c84e1253229c4acbd12","friend_name" : "嘻嘻","friend_remark" : "小豆芽","friend_avatar" : "girl.jpg","friend_chat" : "5ba21c84e1253229c4acbd11","user_type" : "toy"}</p> 
 <p>]</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>务必保证 friend_list里面的每一条记录。都有user_type字段！</p> 
 <p>后台逻辑修改</p> 
 <p>进入flask项目，修改 serv--&gt; friend.py，增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from flask importBlueprint, request, jsonifyfrom setting importMONGO_DBfrom setting importRETfrom bson importObjectId</p> 
 <p>fri= Blueprint("fri", __name__)</p> 
 <p>@fri.route("/friend_list", methods=["POST"])def friend_list(): #好友列表</p> 
 <p>user_id = request.form.get("user_id")#查询用户id信息</p> 
 <p>res = MONGO_DB.users.find_one({"_id": ObjectId(user_id)})</p> 
 <p>friend_list= res.get("friend_list") #获取好友列表</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = ""RET["data"] =friend_listreturnjsonify(RET)</p> 
 <p>@fri.route("/add_req", methods=["POST"])def add_req(): #添加好友请求</p> 
 <p>user_id = request.form.get("user_id") #有可能是 toy_id or user_id</p> 
 <p>friend_id = request.form.get("friend_id") #100%是toy_id</p> 
 <p>req_type = request.form.get("req_type")</p> 
 <p>req_msg= request.form.get("req_msg") #描述</p> 
 <p>remark = request.form.get("remark") #备注</p> 
 <p>if req_type == "toy":</p> 
 <p>user_info= MONGO_DB.toys.find_one({"_id": ObjectId(user_id)})else:</p> 
 <p>user_info= MONGO_DB.users.find_one({"_id": ObjectId(user_id)})</p> 
 <p>req_str={"req_user": str(user_info.get("_id")),"req_type": req_type,"req_toy": friend_id,"req_msg": req_msg,"avatar": user_info.get("avatar"),"user_remark": remark,#昵称，玩具是没有的</p> 
 <p>"user_nick": user_info.get("nickname") if user_info.get("nickname") else user_info.get("baby_name"),#状态，1通过，2拒绝,0中间状态(可切换到1和2)。</p> 
 <p>"status": 0</p> 
 <p>}</p> 
 <p>MONGO_DB.req.insert_one(req_str)</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = "请求发送成功"RET["data"] ={}returnjsonify(RET)</p> 
 <p>@fri.route("/req_list", methods=["POST"])def req_list(): #添加请求列表</p> 
 <p>user_id = request.form.get("user_id")</p> 
 <p>user_info= MONGO_DB.users.find_one({"_id": ObjectId(user_id)})</p> 
 <p>bind_toy= user_info.get("bind_toy")</p> 
 <p>reqs= list(MONGO_DB.req.find({"req_toy": {"$in": bind_toy}, "status": 0}))for index, req inenumerate(reqs):</p> 
 <p>reqs[index]["_id"] = str(req.get("_id"))</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = ""RET["data"] =reqsreturnjsonify(RET)</p> 
 <p>@fri.route("/get_req", methods=["POST"])def get_req(): #获取一个好友请求</p> 
 <p>req_id = request.form.get("req_id")</p> 
 <p>req_info= MONGO_DB.req.find_one({"_id": ObjectId(req_id)})</p> 
 <p>req_info["_id"] = str(req_info.get("_id"))</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = ""RET["data"] =req_inforeturnjsonify(RET)</p> 
 <p>@fri.route("/acc_req", methods=["POST"])def acc_req(): #允许一个好友请求</p> 
 <p>req_id = request.form.get("req_id")</p> 
 <p>remark= request.form.get("remark")</p> 
 <p>req_info= MONGO_DB.req.find_one({"_id": ObjectId(req_id)})#1. 为 user 或 toy 添加 toy</p> 
 <p>if req_info.get("req_type") == "toy":</p> 
 <p>user_info= MONGO_DB.toys.find_one({"_id": ObjectId(req_info.get("req_user"))})</p> 
 <p>user_type= "toy"</p> 
 <p>else:</p> 
 <p>user_info= MONGO_DB.users.find_one({"_id": ObjectId(req_info.get("req_user"))})</p> 
 <p>user_type= "user"toy= MONGO_DB.toys.find_one({"_id": ObjectId(req_info.get("req_toy"))})</p> 
 <p>chat_window= MONGO_DB.chat.insert_one({"user_list": [str(toy.get("_id")), str(user_info.get("_id"))]})</p> 
 <p>friend_info={"friend_id": str(toy.get("_id")),"friend_name": toy.get("baby_name"),"friend_remark": req_info.get("user_remark"),"friend_avatar": toy.get("avatar"),"friend_chat": str(chat_window.inserted_id),"user_type": "toy"}if req_info.get("req_type") == "toy":</p> 
 <p>MONGO_DB.toys.update_one({"_id": ObjectId(req_info.get("req_user"))},</p> 
 <p>{"$push": {"friend_list": friend_info}})else:</p> 
 <p>MONGO_DB.users.update_one({"_id": ObjectId(req_info.get("req_user"))},</p> 
 <p>{"$push": {"friend_list": friend_info}})#2. 为 toy 添加 user 或 toy</p> 
 <p>user_name = user_info.get("nickname") if user_info.get("nickname") else user_info.get("baby_name")</p> 
 <p>friend_info2={"friend_id": str(user_info.get("_id")),"friend_name": user_name,#同意方的备注</p> 
 <p>"friend_remark": remark if remark elseuser_name,"friend_avatar": user_info.get("avatar"),"friend_chat": str(chat_window.inserted_id),"user_type":user_type #用户类型</p> 
 <p>}</p> 
 <p>MONGO_DB.toys.update_one({"_id": ObjectId(req_info.get("req_toy"))},</p> 
 <p>{"$push": {"friend_list": friend_info2}})</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = f"添加好友{remark}成功"RET["data"] ={}</p> 
 <p>MONGO_DB.req.update_one({"_id": ObjectId(req_id)}, {"$set": {"status": 1}})returnjsonify(RET)</p> 
 <p>@fri.route("/ref_req", methods=["POST"])def ref_req(): #拒绝一个好友请求</p> 
 <p>req_id = request.form.get("req_id")</p> 
 <p>MONGO_DB.req.update_one({"_id": ObjectId(req_id)}, {"$set": {"status": 2}})</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = "已拒绝好友请求"RET["data"] ={}return jsonify(RET)</p> 
 <p>View Code</p> 
 <p>修改 serv--&gt; devices.py，增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from flask importBlueprint, request, jsonifyfrom setting importMONGO_DBfrom setting importRETfrom bson importObjectId</p> 
 <p>devs= Blueprint("devs", __name__)</p> 
 <p>@devs.route("/yanzheng_qr", methods=["POST"])def yanzheng_qr(): #验证二维码</p> 
 <p>device_id = request.form.get("device_id") #获取设备id</p> 
 <p>print(device_id)if MONGO_DB.devices.find_one({"device_id": device_id}): #从数据库中查询设备id</p> 
 <p>#查询该玩具是不是已被用户绑定</p> 
 <p>toy_info = MONGO_DB.toys.find_one({"device_id": device_id})#未绑定开启绑定逻辑</p> 
 <p>if nottoy_info:</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = "感谢购买本公司产品"RET["data"] ={}#如果被绑定加好友逻辑开启</p> 
 <p>iftoy_info:</p> 
 <p>RET["code"] = 1RET["msg"] = "添加好友"RET["data"] = {"toy_id": str(toy_info.get("_id"))}else:</p> 
 <p>RET["code"] = 2RET["msg"] = "二货，这不是本公司设备，快去买正版!"RET["data"] ={}returnjsonify(RET)</p> 
 <p>@devs.route("/bind_toy", methods=["POST"])def bind_toy(): #绑定玩具</p> 
 <p>chat_window = MONGO_DB.chat.insert_one({}) #插入一个空数据</p> 
 <p>chat_id = chat_window.inserted_id #获取聊天id</p> 
 <p>user_id= request.form.get("user_id") #用户id</p> 
 <p>res = MONGO_DB.users.find_one({"_id": ObjectId(user_id)}) #查询用户id是否存在</p> 
 <p>device_id= request.form.get("device_id") #设备id</p> 
 <p>toy_name = request.form.get("toy_name") #玩具的昵称</p> 
 <p>baby_name = request.form.get("baby_name") #小主人的名字</p> 
 <p>remark = request.form.get("remark") #玩具主人对您的称呼</p> 
 <p>gender = request.form.get("gender") #性别</p> 
 <p>toy_info={"device_id": device_id,"toy_name": toy_name,"baby_name": baby_name,"gender": gender,"avatar": "boy.jpg" if gender == 1 else "girl.jpg",#绑定用户</p> 
 <p>"bind_user": str(res.get("_id")),#第一个好友</p> 
 <p>"friend_list": [{"friend_id": str(res.get("_id")), #好友id</p> 
 <p>"friend_name": res.get("nickname"), #好友昵称</p> 
 <p>"friend_remark": remark, #好友称呼</p> 
 <p>"friend_avatar": res.get("avatar"), #好友头像</p> 
 <p>"friend_chat": str(chat_id), #好友聊天id</p> 
 <p>"user_type":"user" #用户类型</p> 
 <p>}]</p> 
 <p>}</p> 
 <p>toy_res= MONGO_DB.toys.insert_one(toy_info) #插入玩具表数据</p> 
 <p>if res.get("friend_list"): #判断用户好友列表是否为空</p> 
 <p>#追加好友</p> 
 <p>res["bind_toy"].append(str(toy_res.inserted_id))</p> 
 <p>res["friend_list"].append({"friend_id": str(toy_res.inserted_id),"friend_name": toy_name,"friend_remark": baby_name,"friend_avatar": toy_info.get("avatar"),"friend_chat": str(chat_id),"user_type": "toy" #用户类型</p> 
 <p>})else:#更新好友</p> 
 <p>res["bind_toy"] =[str(toy_res.inserted_id)]</p> 
 <p>res["friend_list"] =[{"friend_id": str(toy_res.inserted_id),"friend_name": toy_name,"friend_remark": baby_name,"friend_avatar": toy_info.get("avatar"),"friend_chat": str(chat_id),"user_type": "toy" #用户类型</p> 
 <p>}]</p> 
 <p>MONGO_DB.users.update_one({"_id": ObjectId(user_id)}, {"$set": res}) #更新用户记录</p> 
 <p>#更新聊天表</p> 
 <p>#user_list有2个值。第一个是玩具id，第2个是用户id</p> 
 <p>#这样，用户和玩具就能通讯了</p> 
 <p>MONGO_DB.chat.update_one({"_id": chat_id},</p> 
 <p>{"$set":</p> 
 <p>{"user_list":</p> 
 <p>[str(toy_res.inserted_id),</p> 
 <p>str(res.get("_id"))]}})</p> 
 <p>RET["code"] =0</p> 
 <p>RET["msg"] = "绑定成功"RET["data"] ={}return jsonify(RET)</p> 
 <p>View Code</p> 
 <p>修改 utils--&gt;baidu_ai.py，增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from aip importAipSpeechimportos</p> 
 <p>BASE_DIR= os.path.dirname(os.path.dirname(os.path.abspath(__file__))) #项目根目录</p> 
 <p>importsys</p> 
 <p>sys.path.append(BASE_DIR)#加入到系统环境变量中</p> 
 <p>import setting #导入setting</p> 
 <p>from uuid importuuid4#from setting import MONGO_DB#import setting</p> 
 <p>importosfrom bson importObjectId</p> 
 <p>client=AipSpeech(setting.APP_ID,setting.API_KEY,setting.SECRET_KEY)deftext2audio(text):</p> 
 <p>res= client.synthesis(text, "zh", 1, setting.SPEECH)</p> 
 <p>file_name= f"{uuid4()}.mp3"file_path=os.path.join(setting.CHAT_FILE, file_name)</p> 
 <p>with open(file_path,"wb") as f:</p> 
 <p>f.write(res)returnfile_namedefget_file_content(filePath):</p> 
 <p>os.system(f"ffmpeg -y -i {filePath} -acodec pcm_s16le -f s16le -ac 1 -ar 16000 {filePath}.pcm")</p> 
 <p>with open(f"{filePath}.pcm", 'rb') as fp:returnfp.read()defaudio2text(file_name):#识别本地文件</p> 
 <p>liu =get_file_content(file_name)</p> 
 <p>res= client.asr(liu, 'pcm', 16000, {'dev_pid': 1536,</p> 
 <p>})if res.get("result"):return res.get("result")[0]else:returnres#text2audio("你好")</p> 
 <p>defmy_nlp(q,toy_id):#1. 假设玩具说：q = 我要给爸爸发消息</p> 
 <p>print(q,"百度q")if "发消息" inq:</p> 
 <p>toy= setting.MONGO_DB.toys.find_one({"_id":ObjectId(toy_id)})#print(toy.get("friend_list"))</p> 
 <p>for i in toy.get("friend_list"):#print(i.get("friend_remark"),i.get("friend_name"),'iiiiiiiii')</p> 
 <p>if i.get("friend_remark") in q or i.get("friend_name") inq :</p> 
 <p>res= text2audio(f"可以按消息键，给{i.get('friend_remark')}发消息了")</p> 
 <p>send_str={"code": 0,"from_user": i.get("friend_id"),"msg_type": "chat","data": res,"user_type":i.get("user_type")</p> 
 <p>}returnsend_strif "我要听" in q or "我想听" in q or "唱一首" inq:</p> 
 <p>sources=setting.MONGO_DB.sources.find({})for i insources:if i.get("title") inq:</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "music","data": i.get("audio")</p> 
 <p>}returnsend_str</p> 
 <p>res= text2audio("对不起，我没明白你的意思")</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "chat","data": res</p> 
 <p>}return send_str</p> 
 <p>View Code</p> 
 <p>修改 im_serv.py，增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from flask importFlask, requestfrom geventwebsocket.websocket importWebSocketfrom geventwebsocket.handler importWebSocketHandlerfrom gevent.pywsgi importWSGIServerimportjson, osfrom uuid importuuid4from setting importAUDIO_FILE,CHAT_FILEfrom serv importcontentfrom utils importbaidu_aifrom utils importchat_redisimportsettingfrom bson importObjectIdimporttime</p> 
 <p>app= Flask(__name__)</p> 
 <p>user_socket_dict= {} #空字典,用来存放用户名和发送消息</p> 
 <p>@app.route("/toy/")def toy(tid): #玩具连接</p> 
 <p>#获取请求的WebSocket对象</p> 
 <p>user_socket = request.environ.get("wsgi.websocket") #type:WebSocket</p> 
 <p>ifuser_socket:#设置键值对</p> 
 <p>user_socket_dict[tid] =user_socketprint(user_socket_dict)#{'123456': }</p> 
 <p>file_name= ""to_user= ""</p> 
 <p>#循环,接收消息</p> 
 <p>whileTrue:</p> 
 <p>msg=user_socket.receive()if type(msg) ==bytearray:</p> 
 <p>file_name= f"{uuid4()}.wav"file_path=os.path.join(CHAT_FILE, file_name)</p> 
 <p>with open(file_path,"wb") as f:</p> 
 <p>f.write(msg)else:</p> 
 <p>msg_dict=json.loads(msg)</p> 
 <p>to_user= msg_dict.get("to_user")</p> 
 <p>msg_type= msg_dict.get("msg_type")</p> 
 <p>user_type= msg_dict.get("user_type")if to_user andfile_name:</p> 
 <p>other_user_socket=user_socket_dict.get(to_user)if msg_type == "ai":</p> 
 <p>q=baidu_ai.audio2text(file_path)print(q)</p> 
 <p>ret=baidu_ai.my_nlp(q, tid)</p> 
 <p>other_user_socket.send(json.dumps(ret))else:if user_type == "toy":</p> 
 <p>res= setting.MONGO_DB.toys.find_one({"_id": ObjectId(to_user)})</p> 
 <p>fri= [i.get("friend_remark") for i in res.get("friend_list") if i.get("friend_id") ==tid][0]</p> 
 <p>msg_file_name= baidu_ai.text2audio(f"你有来自{fri}的消息")</p> 
 <p>send_str={"code": 0,"from_user": tid,"msg_type": "chat","user_type": "toy","data": msg_file_name</p> 
 <p>}else:</p> 
 <p>send_str={"code": 0,"from_user": tid,"msg_type": "chat","data": file_name,</p> 
 <p>}if other_user_socket: #当websocket连接存在时</p> 
 <p>chat_redis.save_msg(tid, to_user) #保存消息到redis</p> 
 <p>#发送数据</p> 
 <p>other_user_socket.send(json.dumps(send_str))else:#离线消息</p> 
 <p>chat_redis.save_msg(tid, to_user)#保存聊天记录到MongoDB</p> 
 <p>_add_chat(tid, to_user, send_str.get("data"))</p> 
 <p>to_user= ""file_name= ""@app.route("/app/")def user_app(uid): #手机app连接</p> 
 <p>user_socket = request.environ.get("wsgi.websocket") #type:WebSocket</p> 
 <p>ifuser_socket:</p> 
 <p>user_socket_dict[uid]=user_socket#{ uid : websocket}</p> 
 <p>print(user_socket_dict)</p> 
 <p>file_name= ""to_user= ""</p> 
 <p>while True: #手机听歌 把歌曲发送给 玩具 1.将文件直接发送给玩具 2.将当前听的歌曲名称或ID发送到玩具</p> 
 <p>msg =user_socket.receive()if type(msg) == bytearray: #判断类型为bytearray</p> 
 <p>file_name = f"{uuid4()}.amr" #文件后缀为amr，安卓和ios通用</p> 
 <p>file_path = os.path.join(CHAT_FILE, file_name) #存放在chat目录</p> 
 <p>print(msg)</p> 
 <p>with open(file_path,"wb") as f:</p> 
 <p>f.write(msg)#写入文件</p> 
 <p>#将amr转换为mp3,因为html中的audio不支持amr</p> 
 <p>os.system(f"ffmpeg -i {file_path} {file_path}.mp3")else:</p> 
 <p>msg_dict=json.loads(msg)</p> 
 <p>to_user= msg_dict.get("to_user") #获取目标用户</p> 
 <p>if msg_dict.get("msg_type") == "music":</p> 
 <p>other_user_socket=user_socket_dict.get(to_user)</p> 
 <p>send_str={"code": 0,"from_user": uid,"msg_type": "music","data": msg_dict.get("data")</p> 
 <p>}</p> 
 <p>other_user_socket.send(json.dumps(send_str))#res = content._content_one(content_id)</p> 
 <p>if file_name and to_user: #如果文件名和发送用户同上存在时</p> 
 <p>#查询玩具信息</p> 
 <p>res = setting.MONGO_DB.toys.find_one({"_id": ObjectId(to_user)})#获取friend_remark</p> 
 <p>fri = [i.get("friend_remark") for i in res.get("friend_list") if i.get("friend_id") ==uid][0]</p> 
 <p>msg_file_name= baidu_ai.text2audio(f"你有来自{fri}的消息")#获取websocket对象</p> 
 <p>other_user_socket =user_socket_dict.get(to_user)#构造数据</p> 
 <p>send_str ={"code": 0,"from_user": uid,"msg_type": "chat", #聊天类型</p> 
 <p>#后缀必须是mp3的</p> 
 <p>"data": msg_file_name</p> 
 <p>}ifother_user_socket:</p> 
 <p>chat_redis.save_msg(uid, to_user)#发送数据给前端页面</p> 
 <p>other_user_socket.send(json.dumps(send_str))else:#保存redis</p> 
 <p>chat_redis.save_msg(uid, to_user)#添加聊天记录到数据库</p> 
 <p>_add_chat(uid, to_user, f"{file_name}.mp3")#最后一定要清空这2个变量，否则造成混乱</p> 
 <p>file_name = ""to_user= ""</p> 
 <p>def _add_chat(sender, to_user, msg): #添加聊天记录到数据库</p> 
 <p>chat_window = setting.MONGO_DB.chat.find_one({"user_list": {"$all": [sender, to_user]}})if not chat_window.get("chat_list"):</p> 
 <p>chat_window["chat_list"] =[{"sender": sender,"msg": msg,"updated_at": time.time(),</p> 
 <p>}]</p> 
 <p>res= setting.MONGO_DB.chat.update_one({"_id": ObjectId(chat_window.get("_id"))}, {"$set": chat_window})else:</p> 
 <p>chat={"sender": sender,"msg": msg,"updated_at": time.time(),</p> 
 <p>}</p> 
 <p>res= setting.MONGO_DB.chat.update_one({"_id": ObjectId(chat_window.get("_id"))}, {"$push": {"chat_list": chat}})returnresif __name__ == '__main__':#创建一个WebSocket服务器</p> 
 <p>http_serv = WSGIServer(("0.0.0.0", 9528), app, handler_class=WebSocketHandler)#开始监听HTTP请求</p> 
 <p>http_serv.serve_forever()'''{<!-- --></p> 
 <p>"code": 0,</p> 
 <p>"from_user": uid, # APP用户id</p> 
 <p>"data": music_name # 歌曲名</p> 
 <p>}'''</p> 
 <p>View Code</p> 
 <p>修改 templates--&gt;index.html，增加user_type</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p>Title 
 <p>玩具开机键</p> 
 <p>开始废话</p> 
 <p>发送语音</p> 
 <p>录制消息</p> 
 <p>发送语音消息</p> 
 <p>收取消息</p> 
 <p></p> 
 <p>var ws_serv= "ws://127.0.0.1:9528";//获取音频文件</p> 
 <p>var get_music= serv + "/get_audio/";</p> 
 <p>var get_chat= serv + "/get_chat/";</p> 
 <p>var ws= null; //WebSocket 对象</p> 
 <p>var reco=null;//创建AudioContext对象</p> 
 <p>var audio_context=new AudioContext();</p> 
 <p>var toy_id=null;//要获取音频和视频</p> 
 <p>navigator.getUserMedia= (navigator.getUserMedia ||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);//拿到媒体对象，允许音频对象</p> 
 <p>navigator.getUserMedia({audio: true}, create_stream, function (err) {<!-- --></p> 
 <p>console.log(err)</p> 
 <p>});//创建媒体流容器</p> 
 <p>function create_stream(user_media) {<!-- --></p> 
 <p>var stream_input=audio_context.createMediaStreamSource(user_media);//给Recoder 创建一个空间，麦克风说的话，都可以录入。是一个流</p> 
 <p>reco=new Recorder(stream_input);</p> 
 <p>}</p> 
 <p>function start_reco() {//开始录音</p> 
 <p>reco.record();//往里面写流</p> 
 <p>}</p> 
 <p>function stop_reco() {//停止录音</p> 
 <p>reco.stop();//停止写入流</p> 
 <p>get_audio();//调用自定义方法</p> 
 <p>reco.clear();//清空容器</p> 
 <p>}</p> 
 <p>{#function get_audio() { // 获取音频#}</p> 
 <p>{#reco.exportWAV(function (wav_file) {#}</p> 
 <p>{#ws.send(wav_file); //使用websocket连接发送数据给后端#}</p> 
 <p>{#})#}</p> 
 <p>{#}#}</p> 
 <p>function send_reco() {<!-- --></p> 
 <p>reco.stop();</p> 
 <p>send_audio();</p> 
 <p>reco.clear();</p> 
 <p>}</p> 
 <p>function send_audio() {<!-- --></p> 
 <p>var to_user= document.getElementById("to_user").innerText;</p> 
 <p>var user_type= document.getElementById("user_type").innerText;</p> 
 <p>var send_str={"to_user": to_user,"user_type":user_type</p> 
 <p>};</p> 
 <p>ws.send(JSON.stringify(send_str));</p> 
 <p>reco.exportWAV(function (wav_file) {<!-- --></p> 
 <p>ws.send(wav_file);</p> 
 <p>})</p> 
 <p>}</p> 
 <p>function get_audio() {<!-- --></p> 
 <p>var send_str={"to_user": toy_id,"msg_type": "ai"};</p> 
 <p>ws.send(JSON.stringify(send_str));</p> 
 <p>reco.exportWAV(function (wav_file) {<!-- --></p> 
 <p>ws.send(wav_file);</p> 
 <p>})</p> 
 <p>}</p> 
 <p>function start_toy() {//玩具开机//获取输入的设备id</p> 
 <p>var device_id= document.getElementById("device_id").value;//发送post请求</p> 
 <p>$.post(// 这里的地址必须是127.0.0.1,否则会有跨域问题"http://127.0.0.1:9527/device_toy_id",//发送设备id</p> 
 <p>{device_id: device_id},</p> 
 <p>function (data) {<!-- --></p> 
 <p>console.log(data);</p> 
 <p>toy_id= data.data.toy_id; //玩具id//修改audio标签的src属性</p> 
 <p>document.getElementById("player").src = get_music +data.data.audio;if (toy_id) { //判断玩具id存在时</p> 
 <p>ws= new WebSocket(ws_serv + "/toy/" +toy_id);</p> 
 <p>ws.onmessage=function (data) {// console.log(get_music +data.data);</p> 
 <p>var content= JSON.parse(data.data); //反序列化数据</p> 
 <p>{#console.log(content);#}</p> 
 <p>//判断消息类型if (content.msg_type == "chat") {<!-- --></p> 
 <p>document.getElementById("player").src = get_chat +content.data;</p> 
 <p>document.getElementById("to_user").innerText =content.from_user;</p> 
 <p>document.getElementById("user_type").innerText =content.user_type;</p> 
 <p>console.log(content.from_user+ "给你发送了一条消息");</p> 
 <p>}if (content.msg_type == "music") {<!-- --></p> 
 <p>document.getElementById("player").src = get_music +content.data;</p> 
 <p>console.log(content.from_user+ "给你点播了歌儿");</p> 
 <p>}</p> 
 <p>};</p> 
 <p>ws.onclose=function () {<!-- --></p> 
 <p>window.location.reload();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>},"json"</p> 
 <p>//规定预期的服务器响应的数据类型为json</p> 
 <p>);</p> 
 <p>}</p> 
 <p>function recv_msg() {<!-- --></p> 
 <p>var to_user= document.getElementById("to_user").innerText;</p> 
 <p>var player= document.getElementById("player");</p> 
 <p>to_user= document.getElementById("to_user").innerText;</p> 
 <p>$.post(</p> 
 <p>serv+ "/get_msg",</p> 
 <p>{user_id: toy_id, sender: to_user},</p> 
 <p>function (data) {//shift() 方法用于把数组的第一个元素从其中删除，并返回第一个元素的值</p> 
 <p>var msg=data.data.shift();</p> 
 <p>document.getElementById("to_user").innerText =msg.sender;</p> 
 <p>player.src= get_chat + msg.msg; //修改audio标签src属性// onended 事件在视频/音频(audio/video)播放结束时触发</p> 
 <p>player.οnended=function () {//如果长度大于0,也就是有1条或者多条时if(data.data.length &gt;0){//修改audio标签src属性，有多条时，会轮询触发</p> 
 <p>player.src= get_chat +data.data.shift().msg;</p> 
 <p>}else{returnnull;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>},"json")</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>重启manager.py和im_serv.py</p> 
 <p>重新访问网页，让2个玩具开机。左边是小甜甜，右边是小豆芽</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>为了保证给对方发消息的时候，不造成混乱！</p> 
 <p>修改 玩具表toys，将toy_name和baby_name改成一样的。</p> 
 <p>完整数据如下：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>/* 1 createdAt:2018/9/19 下午5:53:08*/{"_id" : ObjectId("5ba21c84e1253229c4acbd12"),"device_id" : "02cc0fc7490b6ee08c31f38ac7a375eb","toy_name" : "小豆芽","baby_name" : "小豆芽","gender" : "2","avatar" : "girl.jpg","bind_user" : "5b9bb768e1253281608e96eb","friend_list": [</p> 
 <p>{"friend_id" : "5b9bb768e1253281608e96eb","friend_name" : "xiao","friend_remark" : "小鱼","friend_avatar" : "boy.jpg","friend_chat" : "5ba21c84e1253229c4acbd11","user_type" : "user"},</p> 
 <p>{"friend_id" : "5ba0f1f2e12532418089bf88","friend_name" : "小甜甜","friend_remark" : "小甜甜","friend_avatar" : "girl.jpg","friend_chat" : "5bab7c19e125327ffc804459","user_type" : "toy"}</p> 
 <p>]</p> 
 <p>},/* 2 createdAt:2018/9/18 下午8:39:14*/{"_id" : ObjectId("5ba0f1f2e12532418089bf88"),"device_id" : "01f9bf1bac93eddd8397d0455abbeddb","toy_name" : "小甜甜","baby_name" : "小甜甜","gender" : "2","avatar" : "girl.jpg","bind_user" : "5b9bb768e1253281608e96eb","friend_list": [</p> 
 <p>{"friend_id" : "5b9bb768e1253281608e96eb","friend_name" : "xiao","friend_remark" : "小鱼","friend_avatar" : "boy.jpg","friend_chat" : "5ba21c84e1253229c4acbd11","user_type" : "user"},</p> 
 <p>{"friend_id" : "5ba21c84e1253229c4acbd12","friend_name" : "小豆芽","friend_remark" : "小豆芽","friend_avatar" : "girl.jpg","friend_chat" : "5bab7c19e125327ffc804459","user_type" : "toy"}</p> 
 <p>]</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>修改 用户表users，也是将toy_name和baby_name改成一样的</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>{"_id" : ObjectId("5b9bb768e1253281608e96eb"),"username" : "xiao","password" : "202cb962ac59075b964b07152d234b70","age" : "20","nickname" : "xiao","gender" : "1","phone" : "1234567","avatar" : "boy.jpg","bind_toy": ["5ba0f1f2e12532418089bf88","5ba21c84e1253229c4acbd12"],"friend_list": [</p> 
 <p>{"friend_id" : "5ba0f1f2e12532418089bf88","friend_name" : "小甜甜","friend_remark" : "小甜甜","friend_avatar" : "girl.jpg","friend_chat" : "5ba0f1f2e12532418089bf87","user_type" : "toy"},</p> 
 <p>{"friend_id" : "5ba21c84e1253229c4acbd12","friend_name" : "小豆芽","friend_remark" : "小豆芽","friend_avatar" : "girl.jpg","friend_chat" : "5ba21c84e1253229c4acbd11","user_type" : "toy"}</p> 
 <p>]</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>修改 chat表，请确保 主人--&gt;小甜甜--&gt;小豆芽。这3者之间必须要有3条记录！</p> 
 <p>分别是:</p> 
 <p>主人--&gt; 小甜甜</p> 
 <p>主人--&gt; 小豆芽</p> 
 <p>小甜甜--&gt; 小豆芽</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这样，就可以实现3者之间的聊天通信了！</p> 
 <p>chat完整记录如下：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>/* 1 createdAt:2018/9/25 下午9:05:46*/{"_id" : ObjectId("5baa32aae125320598c912f3"),"user_list": ["5ba0f1f2e12532418089bf88","5ba21c84e1253229c4acbd12"]</p> 
 <p>},/* 2 createdAt:2018/9/19 下午5:53:08*/{"_id" : ObjectId("5ba21c84e1253229c4acbd11"),"user_list": ["5b9bb768e1253281608e96eb","5ba21c84e1253229c4acbd12"]</p> 
 <p>},/* 3 createdAt:2018/9/18 下午8:39:14*/{"_id" : ObjectId("5ba0f1f2e12532418089bf87"),"user_list": ["5b9bb768e1253281608e96eb","5ba0f1f2e12532418089bf88"]</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>进入左边网页，点击 开始废话，说： 发消息给 小豆芽 。再点击发送语音！</p> 
 <p>网页会说：可以按消息键，给 小豆芽 发消息了！</p> 
 <p>这里会出现 toy，表示给玩具发消息。左边的id，就是 小豆芽的id</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击 录制消息，说：你好， 我是小甜甜！</p> 
 <p>点击 发送语音消息</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这个时候，网页会有提示： 你有来自 小甜甜 的消息</p> 
 <p>切换到第二个网页，会出现设备id，这个是 小甜甜的。</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击 收取消息</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>会播放： 你好， 我是小甜甜！</p> 
 <p>这样，就实现了，玩具之间的通信了！</p> 
 <p>二、基于jieba gensim  pypinyin实现的自然语言处理</p> 
 <p>jieba</p> 
 <p>jieba分词，完全开源，有集成的python库，简单易用。</p> 
 <p>jieba分词是基于前缀词典实现高效的词图扫描，生成句子中汉字所有可能成词情况所构成的有向无环图 (DAG)，动态规划查找最大概率路径, 找出基于词频的最大切分组合</p> 
 <p>安装</p> 
 <p>pip install gensim</p> 
 <p>由于包很大，如果安装比较慢，可以使用国内更新源安装</p> 
 <p>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple jieba</p> 
 <p>使用</p> 
 <p>我们通常把这个库叫做 结巴分词 确实是结巴分词,而且这个词库是 made in china , 基本用一下这个结巴分词:</p> 
 <p>importjieba</p> 
 <p>key_word= "我的妈妈真伟大" #定义一句话,基于这句话进行分词</p> 
 <p>cut_word= jieba.cut(key_word) #使用结巴分词中的cut方法对"我的妈妈真伟大" 进行分词</p> 
 <p>print(cut_word) # 不懂生成器的话,就忽略这里</p> 
 <p>cut_word_list= list(cut_word) #如果不明白生成器的话,这里要记得把生成器对象做成列表</p> 
 <p>print(cut_word_list) #['我', '的', '妈妈', '真', '伟大']</p> 
 <p>测试代码就很明显了,它很清晰的把咱们的中文字符串转为列表存储起来了</p> 
 <p>如果需要将 "真伟大" 变成一个词，需要添加词库，使用add_word</p> 
 <p>importjieba</p> 
 <p>key_word= "我的妈妈真伟大" #定义一句话,基于这句话进行分词</p> 
 <p>jieba.add_word("真伟大") #添加词库</p> 
 <p>cut_word = jieba.cut(key_word) #使用结巴分词中的cut方法对"我的妈妈真伟大" 进行分词</p> 
 <p>cut_word_list= list(cut_word) #如果不明白生成器的话,这里要记得把生成器对象做成列表</p> 
 <p>print(cut_word_list) #['我', '的', '妈妈', '真伟大']</p> 
 <p>pypinyin</p> 
 <p>将汉字转为拼音。可以用于汉字注音、排序、检索(Russian translation) 。</p> 
 <p>特性</p> 
 <p>根据词组智能匹配最正确的拼音。</p> 
 <p>支持多音字。</p> 
 <p>简单的繁体支持, 注音支持。</p> 
 <p>支持多种不同拼音/注音风格。</p> 
 <p>安装</p> 
 <p>pip install pypinyin</p> 
 <p>使用</p> 
 <p>from pypinyin importlazy_pinyin,TONE2</p> 
 <p>key_word= "我的妈妈真伟大" #定义一句话</p> 
 <p>res = lazy_pinyin(key_word,style=TONE2) #设置拼音风格</p> 
 <p>print(res) #['wo3', 'de', 'ma1', 'ma1', 'zhe1n', 'we3i', 'da4']</p> 
 <p>拼音声调是指普通话中的声调，通常叫四声，即阴平(第一声)，用“ˉ”表示，如lā；阳平第二声，用“ˊ”表示，如lá；上声(第三声)，用“ˇ”表示，如lǎ；去声(第四声)，用“ˋ”表示，如；là。</p> 
 <p>wo3 最后面的3表示声调。它是第三声！</p> 
 <p>看下面的例子，这些字也是同音</p> 
 <p>from pypinyin importlazy_pinyin,TONE2</p> 
 <p>key_word= "贝贝蓓蓓背背" #定义一句话</p> 
 <p>res = lazy_pinyin(key_word,style=TONE2) #设置拼音风格</p> 
 <p>print(res) #['be4i', 'be4i', 'be4i', 'be4i', 'be4i', 'be4i']</p> 
 <p>gensim</p> 
 <p>Gensim是一款开源的第三方Python工具包，用于从原始的非结构化的文本中，无监督地学习到文本隐层的主题向量表达。</p> 
 <p>它支持包括TF-IDF，LSA，LDA，和word2vec在内的多种主题模型算法，</p> 
 <p>支持流式训练，并提供了诸如相似度计算，信息检索等一些常用任务的API接口</p> 
 <p>基本概念</p> 
 <p>语料(Corpus)：一组原始文本的集合，用于无监督地训练文本主题的隐层结构。语料中不需要人工标注的附加信息。在Gensim中，Corpus通常是一个可迭代的对象(比如列表)。每一次迭代返回一个可用于表达文本对象的稀疏向量。</p> 
 <p>向量(Vector)：由一组文本特征构成的列表。是一段文本在Gensim中的内部表达。</p> 
 <p>稀疏向量(SparseVector)：通常，我们可以略去向量中多余的0元素。此时，向量中的每一个元素是一个(key, value)的元组</p> 
 <p>模型(Model)：是一个抽象的术语。定义了两个向量空间的变换(即从文本的一种向量表达变换为另一种向量表达)。</p> 
 <p>安装</p> 
 <p>pip install jieba</p> 
 <p>使用</p> 
 <p>这个训练库很厉害, 里面封装很多机器学习的算法, 是目前人工智能的主流应用库,这个不是很好理解, 需要一定的Python数据处理的功底</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>importjiebaimportgensimfrom gensim importcorporafrom gensim importmodelsfrom gensim importsimilarities</p> 
 <p>l1= ["你的名字是什么", "你今年几岁了", "你有多高你心情怎么样", "你心情怎么样"]</p> 
 <p>a= "你今年多大了"</p> 
 <p>#制作语料库</p> 
 <p>all_doc_list =[]for doc inl1:</p> 
 <p>doc_list= [word for word injieba.cut(doc)]</p> 
 <p>all_doc_list.append(doc_list)print(all_doc_list)#[['你', '的', '名字', '是', '什么'],#1 4 2 3 0#['你', '今年', '几岁', '了'],#1 6 7 5</p> 
 <p>#将问题分词</p> 
 <p>doc_test_list = [word for word injieba.cut(a)]#['你', '今年', '多大', '了']#1 6 5</p> 
 <p>#制作词袋</p> 
 <p>dictionary =corpora.Dictionary(all_doc_list)#词袋的理解#词袋就是将很多很多的词,进行排列形成一个 词(key) 与一个 标志位(value) 的字典#例如: {'什么': 0, '你': 1, '名字': 2, '是': 3, '的': 4, '了': 5, '今年': 6, '几岁': 7, '多': 8, '心情': 9, '怎么样': 10, '有': 11, '高': 12}#至于它是做什么用的,带着问题往下看</p> 
 <p>print("token2id", dictionary.token2id)print("dictionary", dictionary, type(dictionary))</p> 
 <p>corpus= [dictionary.doc2bow(doc) for doc inall_doc_list]#语料库:#这里是将all_doc_list 中的每一个列表中的词语 与 dictionary 中的Key进行匹配#得到一个匹配后的结果,例如['你', '今年', '几岁', '了']#就可以得到 [(1, 1), (6, 1), (7, 1), (5, 1)]#1代表的的是 你 1代表出现一次, 5代表的是 了 1代表出现了一次, 以此类推 6 = 今年 , 7 = 几岁</p> 
 <p>print("corpus", corpus, type(corpus))#将需要寻找相似度的分词列表 做成 语料库 doc_test_vec</p> 
 <p>doc_test_vec =dictionary.doc2bow(doc_test_list)print("doc_test_vec", doc_test_vec, type(doc_test_vec))#将corpus语料库(初识语料库) 使用Lsi模型进行训练</p> 
 <p>lsi =models.LsiModel(corpus)#这里的只是需要学习Lsi模型来了解的,这里不做阐述</p> 
 <p>print("lsi", lsi, type(lsi))#语料库corpus的训练结果</p> 
 <p>print("lsi[corpus]", lsi[corpus])#获得语料库doc_test_vec 在 语料库corpus的训练结果 中的 向量表示</p> 
 <p>print("lsi[doc_test_vec]", lsi[doc_test_vec])#文本相似度#稀疏矩阵相似度 将 主 语料库corpus的训练结果 作为初始值</p> 
 <p>index = similarities.SparseMatrixSimilarity(lsi[corpus], num_features=len(dictionary.keys()))print("index", index, type(index))#将 语料库doc_test_vec 在 语料库corpus的训练结果 中的 向量表示 与 语料库corpus的 向量表示 做矩阵相似度计算</p> 
 <p>sim =index[lsi[doc_test_vec]]print("sim", sim, type(sim))#对下标和相似度结果进行一个排序,拿出相似度最高的结果#cc = sorted(enumerate(sim), key=lambda item: item[1],reverse=True)</p> 
 <p>cc = sorted(enumerate(sim), key=lambda item: -item[1])print(cc)</p> 
 <p>text=l1[cc[0][0]]print(a,text)</p> 
 <p>View Code</p> 
 <p>执行输出：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>[['你', '的', '名字', '是', '什么'], ['你', '今年', '几岁', '了'], ['你', '有', '多', '高', '你', '心情', '怎么样'], ['你', '心情', '怎么样']]</p> 
 <p>token2id {'什么': 0, '你': 1, '名字': 2, '是': 3, '的': 4, '了': 5, '今年': 6, '几岁': 7, '多': 8, '心情': 9, '怎么样': 10, '有': 11, '高': 12}</p> 
 <p>dictionary Dictionary(13 unique tokens: ['什么', '你', '名字', '是', '的']...) corpus [[(0,1), (1, 1), (2, 1), (3, 1), (4, 1)], [(1, 1), (5, 1), (6, 1), (7, 1)], [(1, 2), (8, 1), (9, 1), (10, 1), (11, 1), (12, 1)], [(1, 1), (9, 1), (10, 1)]] doc_test_vec [(1, 1), (5, 1), (6, 1)] lsi LsiModel(num_terms=13, num_topics=200, decay=1.0, chunksize=20000) lsi[corpus]lsi[doc_test_vec] [(0,0.900230201263672), (1, 0.3426436202483724), (2, -1.1659919622685817)]</p> 
 <p>indexsim [0.2956978 0.99180055 0.44080025 0.38174424] [(1, 0.99180055), (2, 0.44080025), (3, 0.38174424), (0, 0.2956978)]</p> 
 <p>你今年多大了 你今年几岁了</p> 
 <p>View Code</p> 
 <p>噼里啪啦写了这一堆代码，到底干了啥哟？看了一脸懵逼！</p> 
 <p>大概意思就是。我抛出了一个问题，就是变量a</p> 
 <p>你今年多大了</p> 
 <p>在问题库里面，有这些问题</p> 
 <p>["你的名字是什么", "你今年几岁了", "你有多高你心情怎么样", "你心情怎么样"]</p> 
 <p>经过 矩阵相似度计算之后，得到一个最优的结果</p> 
 <p>你今年几岁了</p> 
 <p>也就是说，我问：你今年多大了，机器认为我的问题是：你今天几岁了</p> 
 <p>这2句话，其实是一个意思！</p> 
 <p>集成到flask</p> 
 <p>进入flask项目，进入utils目录，新建文件lowB_plus.py</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>importjiebaimportsettingfrom gensim importcorporafrom gensim importmodelsfrom gensim importsimilarities</p> 
 <p>l1=[]for i insetting.MONGO_DB.sources.find({}):</p> 
 <p>l1.append(i.get("title"))defmy_nlp(text):#制作语料库</p> 
 <p>all_doc_list =[]for doc inl1:</p> 
 <p>doc_list= [word for word injieba.cut(doc)]</p> 
 <p>all_doc_list.append(doc_list)print(all_doc_list)#[['你', '的', '名字', '是', '什么'],</p> 
 <p>#1 4 2 3 0</p> 
 <p>#['你', '今年', '几岁', '了'],</p> 
 <p>#1 6 7 5</p> 
 <p>#['你', '有', '多', '高', '你', '胸多大'],</p> 
 <p>#1 9 8 11 1 10</p> 
 <p>#['你', '胸多大']]</p> 
 <p>#1 10</p> 
 <p>#将问题分词</p> 
 <p>doc_test_list = [word for word injieba.cut(text)]print(doc_test_list)#['你', '今年', '多大', '了']</p> 
 <p>#1 6 5</p> 
 <p>#制作词袋</p> 
 <p>dictionary =corpora.Dictionary(all_doc_list)#词袋的理解</p> 
 <p>#词袋就是将很多很多的词,进行排列形成一个 词(key) 与一个 标志位(value) 的字典</p> 
 <p>#例如: {'什么': 0, '你': 1, '名字': 2, '是': 3, '的': 4, '了': 5, '今年': 6, '几岁': 7, '多': 8, '有': 9, '胸多大': 10, '高': 11}</p> 
 <p>#至于它是做什么用的,带着问题往下看</p> 
 <p>print("token2id", dictionary.token2id)print("dictionary", dictionary, type(dictionary))</p> 
 <p>corpus= [dictionary.doc2bow(doc) for doc inall_doc_list]#语料库:</p> 
 <p>#这里是将all_doc_list 中的每一个列表中的词语 与 dictionary 中的Key进行匹配</p> 
 <p>#得到一个匹配后的结果,例如['你', '今年', '几岁', '了']</p> 
 <p>#就可以得到 [(1, 1), (5, 1), (6, 1), (7, 1)]</p> 
 <p>#1代表的的是 你 1代表出现一次, 5代表的是 了 1代表出现了一次, 以此类推 6 = 今年 , 7 = 几岁</p> 
 <p>print("corpus", corpus, type(corpus))#将需要寻找相似度的分词列表 做成 语料库 doc_test_vec</p> 
 <p>doc_test_vec =dictionary.doc2bow(doc_test_list)print("doc_test_vec", doc_test_vec, type(doc_test_vec))#[(1, 1), (5, 1), (6, 1)]</p> 
 <p>#将corpus语料库(初识语料库) 使用Lsi模型进行训练</p> 
 <p>lsi =models.LsiModel(corpus)#这里的只是需要学习Lsi模型来了解的,这里不做阐述</p> 
 <p>print("lsi", lsi, type(lsi))#语料库corpus的训练结果</p> 
 <p>print("lsi[corpus]", lsi[corpus])#获得语料库doc_test_vec 在 语料库corpus的训练结果 中的 向量表示</p> 
 <p>print("lsi[doc_test_vec]", lsi[doc_test_vec])#文本相似度</p> 
 <p>#稀疏矩阵相似度 将 主 语料库corpus的训练结果 作为初始值</p> 
 <p>index = similarities.SparseMatrixSimilarity(lsi[corpus], num_features=len(dictionary.keys()))print("index", index, type(index))#向量表示：</p> 
 <p>#(0.387654321,0.84382974,0.4297589245,1.2439785,3.9867462154)</p> 
 <p>#((0.387654321,0.84382974,0.4297589245,1.2439786,3.9867462154),(0.387654321,0.84382974,0.4297589245,1.2439786,3.9867462154),(0.387654321,0.84382974,0.4297589245,1.2439786,3.9867462154),(0.387654321,0.84382974,0.4297589245,1.2439786,3.9867462154))</p> 
 <p>#将 语料库doc_test_vec 在 语料库corpus的训练结果 中的 向量表示 与 语料库corpus的 向量表示 做矩阵相似度计算</p> 
 <p>sim =index[lsi[doc_test_vec]]print("sim", sim, type(sim))#对下标和相似度结果进行一个排序,拿出相似度最高的结果</p> 
 <p>#cc = sorted(enumerate(sim), key=lambda item: item[1],reverse=True)</p> 
 <p>cc = sorted(enumerate(sim), key=lambda item: -item[1])print(cc)</p> 
 <p>text=l1[cc[0][0]]return text</p> 
 <p>View Code</p> 
 <p>由于还不够智能，所以叫 lowB_plus</p> 
 <p>修改 utils--&gt;baidu_ai.py，使用 lowB_plus</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from aip importAipSpeechimportos</p> 
 <p>BASE_DIR= os.path.dirname(os.path.dirname(os.path.abspath(__file__))) #项目根目录</p> 
 <p>importsys</p> 
 <p>sys.path.append(BASE_DIR)#加入到系统环境变量中</p> 
 <p>import setting #导入setting</p> 
 <p>from uuid importuuid4#from setting import MONGO_DB#import setting</p> 
 <p>importosfrom bson importObjectIdfrom utils importlowB_plusfrom pypinyin importlazy_pinyin, TONE2</p> 
 <p>client=AipSpeech(setting.APP_ID,setting.API_KEY,setting.SECRET_KEY)deftext2audio(text):</p> 
 <p>res= client.synthesis(text, "zh", 1, setting.SPEECH)</p> 
 <p>file_name= f"{uuid4()}.mp3"file_path=os.path.join(setting.CHAT_FILE, file_name)</p> 
 <p>with open(file_path,"wb") as f:</p> 
 <p>f.write(res)returnfile_namedefget_file_content(filePath):</p> 
 <p>os.system(f"ffmpeg -y -i {filePath} -acodec pcm_s16le -f s16le -ac 1 -ar 16000 {filePath}.pcm")</p> 
 <p>with open(f"{filePath}.pcm", 'rb') as fp:returnfp.read()defaudio2text(file_name):#识别本地文件</p> 
 <p>liu =get_file_content(file_name)</p> 
 <p>res= client.asr(liu, 'pcm', 16000, {'dev_pid': 1536,</p> 
 <p>})if res.get("result"):return res.get("result")[0]else:returnres#text2audio("你好")</p> 
 <p>defmy_nlp(q,toy_id):#1. 假设玩具说：q = 我要给爸爸发消息</p> 
 <p>if "发消息" inq:</p> 
 <p>q= "".join(lazy_pinyin(q, style=TONE2))print(q)</p> 
 <p>toy= setting.MONGO_DB.toys.find_one({"_id": ObjectId(toy_id)})#print(toy.get("friend_list"))</p> 
 <p>for i in toy.get("friend_list"):#转换成拼音,即使同音字也能匹配</p> 
 <p>remark_pinyin = "".join(lazy_pinyin(i.get("friend_remark"), style=TONE2))</p> 
 <p>name_pinyin= "".join(lazy_pinyin(i.get("friend_name"), style=TONE2))print(name_pinyin)if remark_pinyin in q or name_pinyin inq:</p> 
 <p>res= text2audio(f"可以按消息键，给{i.get('friend_remark')}发消息了")</p> 
 <p>send_str={"code": 0,"from_user": i.get("friend_id"),"msg_type": "chat","data": res,"user_type":i.get("user_type")</p> 
 <p>}returnsend_strif "我要听" in q or "我想听" in q or "唱一首" inq:</p> 
 <p>q= str(q).replace("我要听", "")</p> 
 <p>q= str(q).replace("我想听", "")</p> 
 <p>q= str(q).replace("唱一首", "")print(q)</p> 
 <p>title=lowB_plus.my_nlp(q)</p> 
 <p>sources= setting.MONGO_DB.sources.find_one({"title": title})for i insources:if i.get("title") inq:</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "music","data": i.get("audio")</p> 
 <p>}returnsend_str</p> 
 <p>res= text2audio("对不起，我没明白你的意思")</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "chat","data": res</p> 
 <p>}return send_str</p> 
 <p>View Code</p> 
 <p>测试</p> 
 <p>重启 manager.py和im_serv.py</p> 
 <p>重新访问网页，让2个玩具开机。左边是小甜甜，右边是小豆芽</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>使用 小甜甜给小豆芽发送消息。注意：说话的时候，可以使用儿化音。</p> 
 <p>比如：发消息 给 小豆芽儿</p> 
 <p>查看Pycharm控制台输出：</p> 
 <p>发消息给小豆芽儿</p> 
 <p>fa1xia1oxi1ge3ixia3odo4uya2e2r</p> 
 <p>第二个网页，小豆芽，也可以接收消息！</p> 
 <p>测试同音字</p> 
 <p>打开玩具表toys，找到  小甜甜的记录，将小豆芽，改成晓逗牙</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>再次测试发送语音给 小豆芽</p> 
 <p>小豆芽，一样也可以收到消息！</p> 
 <p>注意：尽可能避免多音字。否则会无法匹配到！</p> 
 <p>接入图灵</p> 
 <p>如果说别的话，比如：今天天气怎么样？网页会提示： 对不起，我没明白你的意思</p> 
 <p>这样用户体验不好，那么这种匹配不到的问题，扔给图灵来处理就可以了！</p> 
 <p>修改 setting.py，增加图灵配置</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>importpymongoimportosimportredis#数据库配置</p> 
 <p>client = pymongo.MongoClient(host="127.0.0.1", port=27017)</p> 
 <p>MONGO_DB= client["bananabase"]</p> 
 <p>REDIS_DB= redis.Redis(host="127.0.0.1",port=6379)</p> 
 <p>RET={#0: false 2: True</p> 
 <p>"code": 0,"msg": "", #提示信息</p> 
 <p>"data": {}</p> 
 <p>}</p> 
 <p>XMLY_URL= "http://m.ximalaya.com/tracks/" #喜马拉雅链接</p> 
 <p>CREATE_QR_URL = "http://qr.liantu.com/api.php?text=" #生成二维码API</p> 
 <p>#文件目录</p> 
 <p>AUDIO_FILE= os.path.join(os.path.dirname(__file__), "audio") #音频</p> 
 <p>AUDIO_IMG_FILE = os.path.join(os.path.dirname(__file__), "audio_img") #音频图片</p> 
 <p>DEVICE_CODE_PATH= os.path.join(os.path.dirname(__file__), "device_code") #二维码</p> 
 <p>CHAT_FILE = os.path.join(os.path.dirname(__file__), "chat") #聊天</p> 
 <p>#百度AI配置</p> 
 <p>APP_ID = '11793552'API_KEY= 'uA6sToQWcvYt2lT6qTW6WFrG'SECRET_KEY= '5rZ1XGYMV39LQBVT4Y1yLNCsmueVe8RQ'SPEECH={"spd": 4,'vol': 5,"pit": 8,"per": 4}#图灵配置：</p> 
 <p>TL_URL = "http://openapi.tuling123.com/openapi/api/v2"TL_DATA={#请求的类型 0 文本 1 图片 2 音频</p> 
 <p>"reqType": 0,#// 输入信息(必要参数)</p> 
 <p>"perception": {#文本信息</p> 
 <p>"inputText": {#问题</p> 
 <p>"text": "北京未来七天，天气怎么样"}</p> 
 <p>},#用户必要信息</p> 
 <p>"userInfo": {#图灵机器人的apikey</p> 
 <p>"apiKey": "8fc493d348704ba4af5413e67e6fc90b",#用户唯一标识</p> 
 <p>"userId": "xiao"}</p> 
 <p>}</p> 
 <p>View Code</p> 
 <p>进入utils目录，新建文件  tuling.py</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>importrequestsimportjsonfrom setting importTL_URL as tuling_urlfrom setting importTL_DATA as datadefto_tuling(q,user_id):</p> 
 <p>data["perception"]["inputText"]["text"] =q</p> 
 <p>data["userInfo"]["userId"] =user_id</p> 
 <p>res= requests.post(tuling_url, json=data)</p> 
 <p>res_dic= json.loads(res.content.decode("utf8")) #type:dict</p> 
 <p>res_type = res_dic.get("results")[0].get("resultType")</p> 
 <p>result= res_dic.get("results")[0].get("values").get(res_type)print(result)return result</p> 
 <p>View Code</p> 
 <p>修改 utils--&gt;baidu_ai.py，接入图灵</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>from aip importAipSpeechimportos</p> 
 <p>BASE_DIR= os.path.dirname(os.path.dirname(os.path.abspath(__file__))) #项目根目录</p> 
 <p>importsys</p> 
 <p>sys.path.append(BASE_DIR)#加入到系统环境变量中</p> 
 <p>import setting #导入setting</p> 
 <p>from uuid importuuid4#from setting import MONGO_DB#import setting</p> 
 <p>importosfrom bson importObjectIdfrom utils importlowB_plusfrom pypinyin importlazy_pinyin, TONE2from utils importtuling</p> 
 <p>client=AipSpeech(setting.APP_ID,setting.API_KEY,setting.SECRET_KEY)deftext2audio(text):</p> 
 <p>res= client.synthesis(text, "zh", 1, setting.SPEECH)</p> 
 <p>file_name= f"{uuid4()}.mp3"file_path=os.path.join(setting.CHAT_FILE, file_name)</p> 
 <p>with open(file_path,"wb") as f:</p> 
 <p>f.write(res)returnfile_namedefget_file_content(filePath):</p> 
 <p>os.system(f"ffmpeg -y -i {filePath} -acodec pcm_s16le -f s16le -ac 1 -ar 16000 {filePath}.pcm")</p> 
 <p>with open(f"{filePath}.pcm", 'rb') as fp:returnfp.read()defaudio2text(file_name):#识别本地文件</p> 
 <p>liu =get_file_content(file_name)</p> 
 <p>res= client.asr(liu, 'pcm', 16000, {'dev_pid': 1536,</p> 
 <p>})if res.get("result"):return res.get("result")[0]else:returnres#text2audio("你好")</p> 
 <p>defmy_nlp(q,toy_id):#1. 假设玩具说：q = 我要给爸爸发消息</p> 
 <p>if "发消息" inq:</p> 
 <p>q= "".join(lazy_pinyin(q, style=TONE2))print(q)</p> 
 <p>toy= setting.MONGO_DB.toys.find_one({"_id": ObjectId(toy_id)})#print(toy.get("friend_list"))</p> 
 <p>for i in toy.get("friend_list"):#转换成拼音,即使同音字也能匹配</p> 
 <p>remark_pinyin = "".join(lazy_pinyin(i.get("friend_remark"), style=TONE2))</p> 
 <p>name_pinyin= "".join(lazy_pinyin(i.get("friend_name"), style=TONE2))print(name_pinyin)if remark_pinyin in q or name_pinyin inq:</p> 
 <p>res= text2audio(f"可以按消息键，给{i.get('friend_remark')}发消息了")</p> 
 <p>send_str={"code": 0,"from_user": i.get("friend_id"),"msg_type": "chat","data": res,"user_type":i.get("user_type")</p> 
 <p>}returnsend_strif "我要听" in q or "我想听" in q or "唱一首" inq:</p> 
 <p>q= str(q).replace("我要听", "")</p> 
 <p>q= str(q).replace("我想听", "")</p> 
 <p>q= str(q).replace("唱一首", "")print(q)</p> 
 <p>title=lowB_plus.my_nlp(q)</p> 
 <p>sources= setting.MONGO_DB.sources.find_one({"title": title})for i insources:if i.get("title") inq:</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "music","data": i.get("audio")</p> 
 <p>}returnsend_str</p> 
 <p>answer=tuling.to_tuling(q, toy_id)</p> 
 <p>res=text2audio(answer)</p> 
 <p>send_str={"code": 0,"from_user": toy_id,"msg_type": "chat","data": res</p> 
 <p>}return send_str</p> 
 <p>View Code</p> 
 <p>重启 manager.py和im_serv.py</p> 
 <p>让2个玩具开机，说一段话： 上海的天气怎么样</p> 
 <p>网页会播放： 上海:周四,多云转阴 东北风4-5级,最低气温22度，最高气温27度</p> 
 <p>查看Pycharm控制台输出：</p> 
 <p>上海的天气怎么样</p> 
 <p>上海:周四,多云转阴 东北风4-5级,最低气温22度，最高气温27度</p> 
 <p>三、打包apk</p> 
 <p>单击打原生安装包</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>必须要登录账号才行</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>注意：默认是使用HBuilder的图标，这样不好。</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击android。因为苹果要相关证书才行，我没有。</p> 
 <p>去掉下面的广告。点击参数配置</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>输入应用名称</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击图标配置</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>上传一个图标图片，必须是png格式的！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击自动生成并替换</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击启动图片配置，就是 app启动的时候，加载的图片</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>找到android，选择1080p图片，并上传！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这里有很多sdk，可以配置</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这里都不用sdk</p> 
 <p>点击模块权限配置</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>默认是这些权限，右侧可以增加</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击代码视图</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这个，就是刚刚所有的配置， 使用Ctrl+s 进行保存</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>保存就是这个文件</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>重新点击 打原生安装包</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击忽略</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击确认</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>它就会在云端打包，它会给你加一个壳子</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>如果提示报错</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击 重新打包原生，点击参数配置，在这类，重新云端获取！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>打包成功后，查看打包状态</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>这样，表示成功了！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>点击手动下载，下载成功！</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>直接将apk拖动过去，点击应用</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>效果如下：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p>总结：</p> 
 <p align="center"><img src="" alt=""></p> 
 <p align="center"><img src="" alt=""></p> 
 <p>1.说说你智能玩具的项目:</p> 
 <p>目的:关爱留守儿童, 让玩具成为父母间沟通的桥梁, 让玩具成为孩子的玩伴</p> 
 <p>实现无屏社交,依靠孩子的语音指令做出响应,例如我要和爸爸聊天,玩具会提示可以和爸爸聊天了并打开与app通讯的链接</p> 
 <p>我要听世上只有妈妈好,玩具就会依照指令播放相应的内容2.智能玩具有什么功能:</p> 
 <p>功能: 玩具可以语音点播朗诵诗歌,播放音乐,做游戏-成语接龙,与智能机器人聊天，玩具与玩具之间的通讯</p> 
 <p>手机app的im通讯 ,手机app可以为玩具点播歌曲,通过手机app管理玩具</p> 
 <p>高人：3.智能部分使用了什么算法:</p> 
 <p>两种回答:1.使用百度ai中的语音合成和语音识别,点播功能是使用Gensim jieba 库进行训练的,聊天做游戏是用的图灵机器人+百度语音合成2.使用百度ai中的语音合成和语音识别 NLP自然语言处理 点播功能基于百度NLP,聊天做游戏是用的图灵机器人+百度语音合成4.IM通讯使用了什么机制:</p> 
 <p>Websocket</p> 
 <p>magicString5.手机app是怎么做的(使用什么方式):</p> 
 <p>mui+html5plus6.谈谈你对人工智能的理解(说出人工智能技术的关键字至少5个):</p> 
 <p>语音类 : 语音识别 语音合成</p> 
 <p>图像类 : 图像识别 文字识别 人脸识别 视频审核</p> 
 <p>语言类 : 自然语言处理 机器翻译 词法分析 依存句法分析 文本纠错 对话情绪识别 词向量表示 短文本相似度</p> 
 <p>词义相似度 情感倾向分析7.mongodb相关:1.修改器: $push $set $pull $inc $pop2.说说你对 $ 的理解 : $ 我的理解就是代指符号,代指所查询到的数据或索引位置3.Mongodb中的数据类型 : ObjectID String Boolean Integer Double Arrays Object(Dict) Null Timestamp Date4.mongodb的比较符 : $lt $gt $lte $gte ":"</p> 
 <p>8.公司组织架构:1.综合人力财务行政：1个小姐姐2.营销部：老张3.产品部：老李 +UI小姐姐4.软件部：闫帅 + 前端小姐姐 +我5.硬件部：江老师9.项目不做底层,只使用三方的原因:</p> 
 <p>制作底层大量占用人力,公司资金不足以支撑底层研发</p> 
 <p>将大量成本投入到硬件研发中10. 项目中,涉及到的技术</p> 
 <p>智能语音识别-第三方百度ai</p> 
 <p>开机提示</p> 
 <p>自然语言处理(nlp)</p> 
 <p>点歌 ：内容点播</p> 
 <p>开启消息发送</p> 
 <p>基于通讯录的即时通讯(IM)</p> 
 <p>websocket</p> 
 <p>不用第三方的原因 保护隐私</p> 
 <p>管理玩具的功能：1.通过扫描二维码 绑定玩具2.玩具通讯录管理</p> 
 <p>View Code</p> 
 <p>完整终极代码，请参考github：</p> 
 <p>附带项目需要的所有文件，包括音频，图片，数据库等等</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4537cf7cc3a2405f09681db995f532df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python union函数_Python NumPy ufunc 集合操作(unique、union1d、intersect1d、setdiff1d、setxor1d)...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef4ed02b5d9d168a394065c48ac5c405/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">No EntityManager with actual transaction available for current thread - cannot reliably process</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>