<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>多线程并发Ping脚本 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="多线程并发Ping脚本" />
<meta property="og:description" content="1. 前言 最近需要ping地址，还是挺多的，就使用python搞一个ping脚本，记录一下，以免丢失了。
2. 脚本介绍 首先检查是否存在True.txt或False.txt文件，并在用户确认后进行删除，然后从IP.txt的文件中读取IP地址，然后使用多线程并发地对这些IP地址进行ping测试。根据测试结果，将可连接的IP地址写入True.txt文件，不可连接的IP地址写入False.txt文件。
IP.txt文件需要每一行为一个IP地址，不可放置网段，并且通信与不通信是暂存在列表中的，若中间结束ping，则数据会丢失，只有当全部运行完后，会一次性写入，之前也测试过一边测试一边写入，会出现频繁的读取文件和写入文件，总会出现IP丢失的情况。此次经过测试，无丢失情况。
测试环境：python3.10
测试结果：IP.txt中共计1.2011个IP地址，20线程，共计耗时32分钟。
2.1. 文件夹内容 文件夹中，False.txt和True.txt这两个文件是不需要创建的，程序会自动创建，而且IP.txt是需要创建的，并且放置~地址，每行一个，正常回车换行，或者在表格中弄好，直接复制过来。
每次执行只需要替换IP.txt中的IP地址就可以了。
2.2. 脚本源码 这里电脑性能好，而且想快的话，直接多上一些线程，一开始我测试的时候，线程没设定好，直接给我干了2400多线程，电脑直接卡死，预估100多线程应该都没问题。
import threading import subprocess import os from concurrent.futures import ThreadPoolExecutor &#34;&#34;&#34;判断是否存在True.txt或False.txt文，由于如果之前存在可能会导致执行添加了，但是测试好像不会，不过添加一个也无妨。&#34;&#34;&#34; def check_confirmation(): if os.path.exists(&#39;True.txt&#39;) or os.path.exists(&#39;False.txt&#39;): user_input = input(&#34;发现已存在的True.txt或False.txt文件，是否删除？(y/n): &#34;) if user_input.lower() == &#39;y&#39;: if os.path.exists(&#39;True.txt&#39;): os.remove(&#39;True.txt&#39;) if os.path.exists(&#39;False.txt&#39;): os.remove(&#39;False.txt&#39;) elif user_input.lower() == &#39;n&#39;: exit() else: print(&#34;无效的输入。请输入 &#39;y&#39; 或 &#39;n&#39;。&#34;) check_confirmation() def ping_ip(ip, true_ips, false_ips): &#34;&#34;&#34;如果IP地址能够ping通，则将其添加到true_ips列表中；否则添加到false_ips列表中。&#34;&#34;&#34; command = [&#39;ping&#39;, &#39;-n&#39;, &#39;1&#39;, ip] result = subprocess." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3dcacd8861cb10e6f9c22e089ca9b698/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-08T11:06:16+08:00" />
<meta property="article:modified_time" content="2023-12-08T11:06:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">多线程并发Ping脚本</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__0"></a>1. 前言</h2> 
<p>最近需要<code>ping</code>地址，还是挺多的，就使用<code>python</code>搞一个<code>ping</code>脚本，记录一下，以免丢失了。</p> 
<h2><a id="2__4"></a>2. 脚本介绍</h2> 
<p>首先检查是否存在<code>True.txt</code>或<code>False.txt</code>文件，并在用户确认后进行删除，然后从<code>IP.txt</code>的文件中读取<code>IP</code>地址，然后使用多线程并发地对这些IP地址进行ping测试。根据测试结果，将可连接的<code>IP</code>地址写入<code>True.txt</code>文件，不可连接的<code>IP</code>地址写入<code>False.txt</code>文件。</p> 
<p><code>IP.txt</code>文件需要每一行为一个<code>IP</code>地址，不可放置网段，并且通信与不通信是暂存在列表中的，若中间结束<code>ping</code>，则数据会丢失，只有当全部运行完后，会一次性写入，之前也测试过一边测试一边写入，会出现频繁的读取文件和写入文件，总会出现<code>IP</code>丢失的情况。此次经过测试，无丢失情况。</p> 
<p>测试环境：<code>python3.10</code></p> 
<p>测试结果：<code>IP.txt</code>中共计<code>1.2011</code>个IP地址，<code>20</code>线程，共计耗时<code>32</code>分钟。</p> 
<p><img src="https://images2.imgbox.com/21/13/rk3FBEkN_o.png" alt="image-20231208104023411"></p> 
<h3><a id="21__16"></a>2.1. 文件夹内容</h3> 
<p>文件夹中，<code>False.txt</code>和<code>True.txt</code>这两个文件是不需要创建的，程序会自动创建，而且<code>IP.txt</code>是需要创建的，并且放置~地址，每行一个，正常回车换行，或者在表格中弄好，直接复制过来。</p> 
<p>每次执行只需要替换<code>IP.txt</code>中的<code>IP</code>地址就可以了。</p> 
<p><img src="https://images2.imgbox.com/c0/2c/IIsWyapF_o.png" alt="image-20231208104342690"></p> 
<h3><a id="22__24"></a>2.2. 脚本源码</h3> 
<p>这里电脑性能好，而且想快的话，直接多上一些线程，一开始我测试的时候，线程没设定好，直接给我干了<code>2400</code>多线程，电脑直接卡死，预估<code>100</code>多线程应该都没问题。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> os
<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor

<span class="token triple-quoted-string string">"""判断是否存在True.txt或False.txt文，由于如果之前存在可能会导致执行添加了，但是测试好像不会，不过添加一个也无妨。"""</span>
<span class="token keyword">def</span> <span class="token function">check_confirmation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'True.txt'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'False.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"发现已存在的True.txt或False.txt文件，是否删除？(y/n): "</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'True.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'True.txt'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'False.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'False.txt'</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> user_input<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无效的输入。请输入 'y' 或 'n'。"</span><span class="token punctuation">)</span>
            check_confirmation<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">ping_ip</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> true_ips<span class="token punctuation">,</span> false_ips<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""如果IP地址能够ping通，则将其添加到true_ips列表中；否则添加到false_ips列表中。"""</span>
    command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ping'</span><span class="token punctuation">,</span> <span class="token string">'-n'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> ip<span class="token punctuation">]</span>
    result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>command<span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>DEVNULL<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>DEVNULL<span class="token punctuation">)</span>
    <span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        true_ips<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ip<span class="token punctuation">}</span></span><span class="token string"> 可以ping通!"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        false_ips<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ip<span class="token punctuation">}</span></span><span class="token string"> 无法ping通!"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    check_confirmation<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'IP.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        ips <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>

    true_ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    false_ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token triple-quoted-string string">"""控制线程，这里我写的是20线程。"""</span>
    <span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
        <span class="token keyword">for</span> ip <span class="token keyword">in</span> ips<span class="token punctuation">:</span>
            ip <span class="token operator">=</span> ip<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>ping_ip<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> true_ips<span class="token punctuation">,</span> false_ips<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""整个程序运行完将列表中的数据写入到相应的文件夹中。"""</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'True.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> ip <span class="token keyword">in</span> true_ips<span class="token punctuation">:</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>ip <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'False.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> ip <span class="token keyword">in</span> false_ips<span class="token punctuation">:</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>ip <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6d0f3b3821891081a969e849b136d57/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python-Django的“日志功能-日志模块(logging模块)-日志输出”的功能详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4dabfce9e5499e4e7debb160c2d2a85d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">React中每次渲染都会传入一个新的props.children到子组件?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>