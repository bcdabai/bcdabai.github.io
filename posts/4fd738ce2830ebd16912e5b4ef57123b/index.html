<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于 FPGA 实现 IIC(I2C) 协议控制 EEPROM 读写操作 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于 FPGA 实现 IIC(I2C) 协议控制 EEPROM 读写操作" />
<meta property="og:description" content="目录 一、源码1.1 顶层模块1.2 按键模块1.3 IIC模块1.4 数码管模块 二、仿真文件三、管脚配置文件四、验证结果 本文内容：FPGA 作为主机，控制 EEPROM 芯片，进行数据读写，同时将写入或读出的数据和地址显示在数码管上，并有标记
前一篇文章：基于 FPGA 使用 Verilog 实现 IIC(I2C) 协议回环数据传输 的 FPGA 作为从机，PC 作为主机，所以 FPGA 是以从机的形式写的源码本篇文章，是以 FPGA 作为主机，控制 EEPROM 芯片数据读写，区别也不是很大，协议也完全相同，原理就不介绍了，直接上源代码 一、源码 1.1 顶层模块 IIC_top.v
/*========================================*\ filename : IIC_top.v description : IIC顶层模块 up file : reversion : v1.0 : 2022-8-22 16:15:32 author : 张某某 \*========================================*/ module IIC_top ( input clk , input rst_n , input [ 1:0] key_in , inout SDA , output SCL , output [ 5:0] SEL , output [ 7:0] DIG ); // Parameter definition wire [ 1:0] press ; wire SDA_in ; wire SDA_out ; wire SDA_oe ; wire [ 7:0] data ; wire [ 7:0] address ; wire [ 1:0] eeprom_state ; // Signal definition // Module calls key_filter U_key_filter( /*input */ ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4fd738ce2830ebd16912e5b4ef57123b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-29T13:43:17+08:00" />
<meta property="article:modified_time" content="2022-08-29T13:43:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于 FPGA 实现 IIC(I2C) 协议控制 EEPROM 读写操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">一、源码</a></li><li><ul><li><a href="#11__7" rel="nofollow">1.1 顶层模块</a></li><li><a href="#12__80" rel="nofollow">1.2 按键模块</a></li><li><a href="#13_IIC_174" rel="nofollow">1.3 IIC模块</a></li><li><a href="#14__658" rel="nofollow">1.4 数码管模块</a></li></ul> 
  </li><li><a href="#_792" rel="nofollow">二、仿真文件</a></li><li><a href="#_868" rel="nofollow">三、管脚配置文件</a></li><li><a href="#_895" rel="nofollow">四、验证结果</a></li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p><font color="#ff0000">本文内容：</font>FPGA 作为主机，控制 EEPROM 芯片，进行数据读写，同时将写入或读出的数据和地址显示在数码管上，并有标记</p> 
</blockquote> 
<ul><li>前一篇文章：<a href="https://blog.csdn.net/ssj925319/article/details/126427237">基于 FPGA 使用 Verilog 实现 IIC(I2C) 协议回环数据传输</a> 的 FPGA 作为从机，PC 作为主机，所以 FPGA 是以从机的形式写的源码</li><li>本篇文章，是以 FPGA 作为主机，控制 EEPROM 芯片数据读写，区别也不是很大，协议也完全相同，原理就不介绍了，直接上源代码</li></ul> 
<h2><a id="_6"></a>一、源码</h2> 
<h3><a id="11__7"></a>1.1 顶层模块</h3> 
<p>IIC_top.v</p> 
<pre><code class="prism language-javascript"><span class="token comment">/*========================================*\
    filename        : IIC_top.v
    description     : IIC顶层模块
    up file         : 
    reversion       : 
        v1.0 : 2022-8-22 16:15:32
    author          : 张某某
\*========================================*/</span>

module <span class="token function">IIC_top</span> <span class="token punctuation">(</span>
    input                               clk             <span class="token punctuation">,</span>
    input                               rst_n           <span class="token punctuation">,</span>
    input           <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              key_in          <span class="token punctuation">,</span>

    inout                               <span class="token constant">SDA</span>             <span class="token punctuation">,</span>

    output                              <span class="token constant">SCL</span>             <span class="token punctuation">,</span>
    output          <span class="token punctuation">[</span> <span class="token number">5</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              <span class="token constant">SEL</span>             <span class="token punctuation">,</span>
    output          <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              <span class="token constant">DIG</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Parameter definition</span>
    wire            <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              press           <span class="token punctuation">;</span>
    wire                                SDA_in          <span class="token punctuation">;</span>        
    wire                                SDA_out         <span class="token punctuation">;</span>
    wire                                SDA_oe          <span class="token punctuation">;</span>
    wire            <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              data            <span class="token punctuation">;</span>
    wire            <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              address         <span class="token punctuation">;</span>
    wire            <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              eeprom_state    <span class="token punctuation">;</span>

<span class="token comment">// Signal definition</span>


<span class="token comment">// Module calls</span>
    key_filter          <span class="token function">U_key_filter</span><span class="token punctuation">(</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">clk</span>            <span class="token punctuation">(</span>clk            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">rst_n</span>          <span class="token punctuation">(</span>rst_n          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input           [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">key_in</span>         <span class="token punctuation">(</span>key_in         <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">press</span>          <span class="token punctuation">(</span>press          <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    iic_eeprom          <span class="token function">U_iic_eeprom</span><span class="token punctuation">(</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">clk</span>            <span class="token punctuation">(</span>clk            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">rst_n</span>          <span class="token punctuation">(</span>rst_n          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input           [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">press</span>          <span class="token punctuation">(</span>press          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">SDA_in</span>         <span class="token punctuation">(</span>SDA_in         <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token constant">SCL</span>            <span class="token punctuation">(</span><span class="token constant">SCL</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token function">SDA_out</span>        <span class="token punctuation">(</span>SDA_out        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token function">SDA_oe</span>         <span class="token punctuation">(</span>SDA_oe         <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">data_out</span>       <span class="token punctuation">(</span>data           <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">address_out</span>    <span class="token punctuation">(</span>address        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">state_out</span>      <span class="token punctuation">(</span>eeprom_state   <span class="token punctuation">)</span>  <span class="token comment">// 0表示空闲，1表示写，2表示读</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    display             <span class="token function">U_display</span><span class="token punctuation">(</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">clk</span>            <span class="token punctuation">(</span>clk            <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 50MHz</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">rst_n</span>          <span class="token punctuation">(</span>rst_n          <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 复位信号</span>
        <span class="token comment">/*input           [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">eeprom_state</span>   <span class="token punctuation">(</span>eeprom_state   <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input           [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">data</span>           <span class="token punctuation">(</span>data           <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input           [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">address</span>        <span class="token punctuation">(</span>address        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 5:0]*/</span>  <span class="token punctuation">.</span><span class="token constant">SEL</span>            <span class="token punctuation">(</span><span class="token constant">SEL</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// SEL信号</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token constant">DIG</span>            <span class="token punctuation">(</span><span class="token constant">DIG</span>            <span class="token punctuation">)</span>  <span class="token comment">// DIG信号</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Logic description</span>
    assign SDA_in <span class="token operator">=</span> <span class="token constant">SDA</span><span class="token punctuation">;</span>
    assign <span class="token constant">SDA</span> <span class="token operator">=</span> SDA_oe <span class="token operator">?</span> SDA_out <span class="token operator">:</span> <span class="token number">1</span>'bz<span class="token punctuation">;</span>

endmodule
</code></pre> 
<h3><a id="12__80"></a>1.2 按键模块</h3> 
<p>key_filter.v</p> 
<pre><code class="prism language-javascript"><span class="token comment">/*========================================*\
    filename        : key_filter.v
    description     : 按键消抖模块
    up file         : IIC_top.v
    reversion       : 
        v1.0 : 2022-8-22 16:15:09
    author          : 张某某
\*========================================*/</span>

module key_filter #<span class="token punctuation">(</span>parameter <span class="token constant">MS_20</span> <span class="token operator">=</span> <span class="token number">20</span>'d1000_000<span class="token punctuation">)</span><span class="token punctuation">(</span>
    input                               clk         <span class="token punctuation">,</span>
    input                               rst_n       <span class="token punctuation">,</span>
    input           <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              key_in      <span class="token punctuation">,</span>
  
    output  reg     <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              press
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 全局变量定义</span>

<span class="token comment">// 信号定义</span>
    reg             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              key_0       <span class="token punctuation">;</span> <span class="token comment">// 按键信号当前时钟周期电平</span>
    reg             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              key_1       <span class="token punctuation">;</span> <span class="token comment">// 按键信号下一个时钟周期电平</span>

    wire            <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              key_nedge   <span class="token punctuation">;</span> <span class="token comment">// 下降沿使能信号</span>
    reg                                 add_flag    <span class="token punctuation">;</span> <span class="token comment">// 计数使能信号</span>
    reg             <span class="token punctuation">[</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              delay_cnt   <span class="token punctuation">;</span> <span class="token comment">// 延时计数器</span>

<span class="token comment">// 模块功能</span>
    <span class="token comment">//打拍器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            key_0 <span class="token operator">&lt;=</span> 'b1<span class="token punctuation">;</span>
            key_1 <span class="token operator">&lt;=</span> 'b1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            key_0 <span class="token operator">&lt;=</span> key_in<span class="token punctuation">;</span>
            key_1 <span class="token operator">&lt;=</span> key_0<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// 检测下降沿</span>
    assign key_nedge <span class="token operator">=</span> <span class="token operator">~</span>key_0 <span class="token operator">&amp;</span> key_1<span class="token punctuation">;</span>

    <span class="token comment">// 计数使能信号</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            add_flag <span class="token operator">&lt;=</span> 'b0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key_nedge<span class="token punctuation">)</span> begin
            add_flag <span class="token operator">&lt;=</span> 'b1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delay_cnt <span class="token operator">&gt;=</span> <span class="token constant">MS_20</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> begin
            add_flag <span class="token operator">&lt;=</span> 'b0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            add_flag <span class="token operator">&lt;=</span> add_flag<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// 计数20ms</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            delay_cnt <span class="token operator">&lt;=</span> <span class="token number">20</span>'d0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_flag<span class="token punctuation">)</span> begin
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay_cnt <span class="token operator">&gt;=</span> <span class="token constant">MS_20</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> begin
                delay_cnt <span class="token operator">&lt;=</span> <span class="token number">20</span>'d0<span class="token punctuation">;</span>
            end
            <span class="token keyword">else</span> begin
                delay_cnt <span class="token operator">&lt;=</span> delay_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            end
        end
        <span class="token keyword">else</span> begin
            delay_cnt <span class="token operator">&lt;=</span> <span class="token number">20</span>'d0<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// 输出</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            press <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delay_cnt <span class="token operator">&gt;=</span> <span class="token constant">MS_20</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> begin
            press <span class="token operator">&lt;=</span> <span class="token operator">~</span>key_in<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            press <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
    end

endmodule
</code></pre> 
<h3><a id="13_IIC_174"></a>1.3 IIC模块</h3> 
<p>iic_eeprom.v</p> 
<pre><code class="prism language-javascript"><span class="token comment">/*========================================*\
    filename        : iic_eeprom.v
    description     : IIC控制EEPROM
    up file         : IIC_top.v
    reversion       : 
        v1.0 : 2022-8-22 16:14:06
    author          : 张某某
\*========================================*/</span>

module <span class="token function">iic_eeprom</span> <span class="token punctuation">(</span>
    input                               clk                 <span class="token punctuation">,</span>
    input                               rst_n               <span class="token punctuation">,</span>
    input           <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              press               <span class="token punctuation">,</span>
    input                               SDA_in              <span class="token punctuation">,</span>

    output  reg                         <span class="token constant">SCL</span>                 <span class="token punctuation">,</span>
    output  reg                         SDA_out             <span class="token punctuation">,</span>
    output  reg                         SDA_oe              <span class="token punctuation">,</span>
    output  reg     <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              data_out            <span class="token punctuation">,</span>
    output  reg     <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              address_out         <span class="token punctuation">,</span>
    output  reg     <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              state_out             <span class="token comment">// 0表示空闲，1表示写，2表示读</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Parameter definition</span>
    parameter       <span class="token constant">IDLE</span>        <span class="token operator">=</span>       <span class="token number">7</span>'b000_0001         <span class="token punctuation">,</span>
                    <span class="token constant">START</span>       <span class="token operator">=</span>       <span class="token number">7</span>'b000_0010         <span class="token punctuation">,</span>
                    <span class="token constant">WR_DATA</span>     <span class="token operator">=</span>       <span class="token number">7</span>'b000_0100         <span class="token punctuation">,</span>
                    <span class="token constant">RD_DATA</span>     <span class="token operator">=</span>       <span class="token number">7</span>'b000_1000         <span class="token punctuation">,</span>
                    <span class="token constant">CHECK_ACK</span>   <span class="token operator">=</span>       <span class="token number">7</span>'b001_0000         <span class="token punctuation">,</span>
                    <span class="token constant">SEND_NACK</span>   <span class="token operator">=</span>       <span class="token number">7</span>'b010_0000         <span class="token punctuation">,</span>
                    <span class="token constant">STOP</span>        <span class="token operator">=</span>       <span class="token number">7</span>'b100_0000         <span class="token punctuation">;</span>

<span class="token comment">// Signal definition    </span>
    reg             <span class="token punctuation">[</span> <span class="token number">6</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              state_c             <span class="token punctuation">;</span>
    reg             <span class="token punctuation">[</span> <span class="token number">6</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              state_n             <span class="token punctuation">;</span>

    wire                                idle2start          <span class="token punctuation">;</span>
    wire                                start2wr_data       <span class="token punctuation">;</span>
    wire                                wr_data2check_ack   <span class="token punctuation">;</span>
    wire                                check_ack2start     <span class="token punctuation">;</span>
    wire                                check_ack2wr_data   <span class="token punctuation">;</span>
    wire                                check_ack2rd_data   <span class="token punctuation">;</span>
    wire                                rd_data2send_nack   <span class="token punctuation">;</span>
    wire                                check_ack2stop      <span class="token punctuation">;</span>
    wire                                send_nack2stop      <span class="token punctuation">;</span>
    wire                                stop2idle           <span class="token punctuation">;</span>

    reg             <span class="token punctuation">[</span> <span class="token number">6</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              cnt_400KHz          <span class="token punctuation">;</span> <span class="token comment">// SCL频率计数器</span>
    wire                                add_cnt_400KHz      <span class="token punctuation">;</span>
    wire                                end_cnt_400KHz      <span class="token punctuation">;</span>

    reg                                 <span class="token constant">SCL_0</span>               <span class="token punctuation">;</span> <span class="token comment">// SCL打拍器</span>
    wire                                SCL_podge           <span class="token punctuation">;</span> <span class="token comment">// SCL上升沿</span>
    wire                                SCL_nedge           <span class="token punctuation">;</span> <span class="token comment">// SCL下降沿</span>

    reg             <span class="token punctuation">[</span> <span class="token number">2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              cnt_bit             <span class="token punctuation">;</span> <span class="token comment">// 比特计数器</span>
    wire                                add_cnt_bit         <span class="token punctuation">;</span>
    wire                                end_cnt_bit         <span class="token punctuation">;</span>

    reg             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              cnt_byte            <span class="token punctuation">;</span> <span class="token comment">// 字节计数器</span>
    wire                                add_cnt_byte        <span class="token punctuation">;</span>
    wire                                end_cnt_byte        <span class="token punctuation">;</span>

    reg             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              eeprom_state        <span class="token punctuation">;</span> <span class="token comment">// 0表示空闲，1表示写，2表示读</span>
    reg             <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              data_buffer         <span class="token punctuation">;</span> <span class="token comment">// 数据缓冲器</span>
    reg             <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              pointer_wr          <span class="token punctuation">;</span> <span class="token comment">// 写数据指针</span>
    reg             <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              pointer_rd          <span class="token punctuation">;</span> <span class="token comment">// 读数据指针</span>

    reg             <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              data_generate       <span class="token punctuation">;</span> <span class="token comment">// 生成写入EEPROM的数据</span>
    wire                                add_data_generate   <span class="token punctuation">;</span>
    wire                                end_data_generate   <span class="token punctuation">;</span>

<span class="token comment">// Logic description</span>
    <span class="token comment">/*************************************
        第一段 状态转移
    *************************************/</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            state_c <span class="token operator">&lt;=</span> <span class="token constant">IDLE</span><span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            state_c <span class="token operator">&lt;=</span> state_n<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">/*************************************
        第二段 状态转移规律
    *************************************/</span>
    always @<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> begin
        <span class="token keyword">case</span> <span class="token punctuation">(</span>state_c<span class="token punctuation">)</span>
            <span class="token constant">IDLE</span> <span class="token operator">:</span> 
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>idle2start<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">START</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">START</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>start2wr_data<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">WR_DATA</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">WR_DATA</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>wr_data2check_ack<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">CHECK_ACK</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">RD_DATA</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>rd_data2send_nack<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">SEND_NACK</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">CHECK_ACK</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>check_ack2start<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">START</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>check_ack2rd_data<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">RD_DATA</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>check_ack2wr_data<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">WR_DATA</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>check_ack2stop<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">STOP</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">SEND_NACK</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>send_nack2stop<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">STOP</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
            <span class="token constant">STOP</span> <span class="token operator">:</span>
                begin
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>stop2idle<span class="token punctuation">)</span> begin
                        state_n <span class="token operator">=</span> <span class="token constant">IDLE</span><span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        state_n <span class="token operator">=</span> state_c<span class="token punctuation">;</span>
                    end
                end
        endcase
    end

    assign idle2start           <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">IDLE</span> <span class="token operator">&amp;&amp;</span> press<span class="token punctuation">;</span>
    assign start2wr_data        <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">START</span> <span class="token operator">&amp;&amp;</span> SCL_nedge<span class="token punctuation">;</span>
    assign wr_data2check_ack    <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">WR_DATA</span> <span class="token operator">&amp;&amp;</span> end_cnt_bit <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">&lt;=</span> 'd3<span class="token punctuation">;</span>
    assign check_ack2start      <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">CHECK_ACK</span> <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">==</span> <span class="token string">'d1 &amp;&amp; SCL_nedge &amp;&amp; eeprom_state == '</span>d2<span class="token punctuation">;</span>
    assign check_ack2wr_data    <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">CHECK_ACK</span> <span class="token operator">&amp;&amp;</span> SCL_nedge <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">&lt;</span> 'd2<span class="token punctuation">;</span>
    assign check_ack2rd_data    <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">CHECK_ACK</span> <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">==</span> <span class="token string">'d2 &amp;&amp; SCL_nedge &amp;&amp; eeprom_state == '</span>d2<span class="token punctuation">;</span>
    assign rd_data2send_nack    <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">RD_DATA</span> <span class="token operator">&amp;&amp;</span> end_cnt_bit <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">&lt;=</span> 'd3<span class="token punctuation">;</span>
    assign check_ack2stop       <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">CHECK_ACK</span> <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">==</span> <span class="token string">'d2 &amp;&amp; SCL_nedge &amp;&amp; eeprom_state == '</span>d1<span class="token punctuation">;</span>
    assign send_nack2stop       <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">SEND_NACK</span> <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">==</span> 'd3 <span class="token operator">&amp;&amp;</span> SCL_nedge<span class="token punctuation">;</span>
    assign stop2idle            <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">STOP</span> <span class="token operator">&amp;&amp;</span> cnt_400KHz <span class="token operator">==</span> 'd57<span class="token punctuation">;</span>

    <span class="token comment">/*************************************
        第三段 描述输出
    *************************************/</span>
    <span class="token comment">// 按键控制EEPROM读写</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            eeprom_state <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stop2idle<span class="token punctuation">)</span> begin
            eeprom_state <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state_c <span class="token operator">==</span> <span class="token constant">IDLE</span><span class="token punctuation">)</span> begin
            <span class="token keyword">case</span> <span class="token punctuation">(</span>press<span class="token punctuation">)</span>
                <span class="token number">2</span><span class="token string">'b10 : eeprom_state &lt;= '</span>d1<span class="token punctuation">;</span> <span class="token comment">// 写状态</span>
                <span class="token number">2</span><span class="token string">'b01 : eeprom_state &lt;= '</span>d2<span class="token punctuation">;</span> <span class="token comment">// 读状态</span>
                <span class="token keyword">default</span><span class="token operator">:</span> eeprom_state <span class="token operator">&lt;=</span> eeprom_state<span class="token punctuation">;</span>
            endcase
        end
        <span class="token keyword">else</span> begin
            eeprom_state <span class="token operator">&lt;=</span> eeprom_state<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// 按键控制指针</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            pointer_wr <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            pointer_rd <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stop2idle<span class="token punctuation">)</span> begin
            <span class="token keyword">case</span> <span class="token punctuation">(</span>eeprom_state<span class="token punctuation">)</span>
                <span class="token string">'d1 : pointer_wr &lt;= pointer_wr + '</span>d1<span class="token punctuation">;</span>
                <span class="token string">'d2 : pointer_rd &lt;= pointer_rd + '</span>d1<span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> begin pointer_wr <span class="token operator">&lt;=</span> pointer_wr<span class="token punctuation">;</span> pointer_rd <span class="token operator">&lt;=</span> pointer_rd<span class="token punctuation">;</span>end
            endcase
        end
        <span class="token keyword">else</span> begin
            pointer_wr <span class="token operator">&lt;=</span> pointer_wr<span class="token punctuation">;</span>
            pointer_rd <span class="token operator">&lt;=</span> pointer_rd<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// SCL打拍器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            <span class="token constant">SCL_0</span> <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            <span class="token constant">SCL_0</span> <span class="token operator">&lt;=</span> <span class="token constant">SCL</span><span class="token punctuation">;</span>
        end
    end

    assign SCL_podge <span class="token operator">=</span> <span class="token constant">SCL</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token constant">SCL_0</span><span class="token punctuation">;</span> <span class="token comment">// SCL上升沿</span>
    assign SCL_nedge <span class="token operator">=</span> <span class="token operator">~</span><span class="token constant">SCL</span> <span class="token operator">&amp;</span> <span class="token constant">SCL_0</span><span class="token punctuation">;</span> <span class="token comment">// SCL下降沿</span>

    <span class="token comment">// SCL计数器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            cnt_400KHz <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_cnt_400KHz<span class="token punctuation">)</span> begin
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end_cnt_400KHz<span class="token punctuation">)</span> begin
                cnt_400KHz <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            end
            <span class="token keyword">else</span> begin
                cnt_400KHz <span class="token operator">&lt;=</span> cnt_400KHz <span class="token operator">+</span> 'd1<span class="token punctuation">;</span>
            end
        end
        <span class="token keyword">else</span> begin
            cnt_400KHz <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
    end
    assign add_cnt_400KHz <span class="token operator">=</span> state_c <span class="token operator">!=</span> <span class="token constant">IDLE</span><span class="token punctuation">;</span>
    assign end_cnt_400KHz <span class="token operator">=</span> add_cnt_400KHz <span class="token operator">&amp;&amp;</span> cnt_400KHz <span class="token operator">&gt;=</span> 'd124<span class="token punctuation">;</span>

    <span class="token comment">// SCL输出</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            <span class="token constant">SCL</span> <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            <span class="token keyword">case</span> <span class="token punctuation">(</span>cnt_400KHz<span class="token punctuation">)</span>
                <span class="token string">'d0  : SCL &lt;= '</span>d1<span class="token punctuation">;</span>
                <span class="token string">'d59 : SCL &lt;= '</span>d0<span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">SCL</span> <span class="token operator">&lt;=</span> <span class="token constant">SCL</span><span class="token punctuation">;</span>
            endcase
        end
    end

    <span class="token comment">// 比特计数器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            cnt_bit <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_cnt_bit<span class="token punctuation">)</span> begin
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end_cnt_bit<span class="token punctuation">)</span> begin
                cnt_bit <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            end
            <span class="token keyword">else</span> begin
                cnt_bit <span class="token operator">&lt;=</span> cnt_bit <span class="token operator">+</span> 'd1<span class="token punctuation">;</span>
            end
        end
        <span class="token keyword">else</span> begin
            cnt_bit <span class="token operator">&lt;=</span> cnt_bit<span class="token punctuation">;</span>
        end
    end
    assign add_cnt_bit <span class="token operator">=</span> <span class="token punctuation">(</span>state_c <span class="token operator">==</span> <span class="token constant">WR_DATA</span> <span class="token operator">||</span> state_c <span class="token operator">==</span> <span class="token constant">RD_DATA</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> SCL_nedge<span class="token punctuation">;</span>
    assign end_cnt_bit <span class="token operator">=</span> add_cnt_bit <span class="token operator">&amp;&amp;</span> cnt_bit <span class="token operator">&gt;=</span> 'd7<span class="token punctuation">;</span>

    <span class="token comment">// 字节计数器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            cnt_byte <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>check_ack2stop <span class="token operator">||</span> send_nack2stop<span class="token punctuation">)</span> begin
            cnt_byte <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_cnt_byte<span class="token punctuation">)</span> begin
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end_cnt_byte<span class="token punctuation">)</span> begin
                cnt_byte <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            end
            <span class="token keyword">else</span> begin
                cnt_byte <span class="token operator">&lt;=</span> cnt_byte <span class="token operator">+</span> 'd1<span class="token punctuation">;</span>
            end
        end
        <span class="token keyword">else</span> begin
            cnt_byte <span class="token operator">&lt;=</span> cnt_byte<span class="token punctuation">;</span>
        end
    end
    assign add_cnt_byte <span class="token operator">=</span> check_ack2wr_data <span class="token operator">||</span> check_ack2rd_data<span class="token punctuation">;</span>
    assign end_cnt_byte <span class="token operator">=</span> add_cnt_byte <span class="token operator">&amp;&amp;</span> cnt_byte <span class="token operator">&gt;=</span> 'd3<span class="token punctuation">;</span>

    <span class="token comment">// 生成顺序数据</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            data_generate <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_data_generate<span class="token punctuation">)</span> begin
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end_data_generate<span class="token punctuation">)</span> begin
                data_generate <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
            end
            <span class="token keyword">else</span> begin
                data_generate <span class="token operator">&lt;=</span> data_generate <span class="token operator">+</span> 'd1<span class="token punctuation">;</span>
            end
        end
        <span class="token keyword">else</span> begin
            data_generate <span class="token operator">&lt;=</span> data_generate<span class="token punctuation">;</span>
        end
    end
    assign add_data_generate <span class="token operator">=</span> state_c <span class="token operator">==</span> <span class="token constant">IDLE</span> <span class="token operator">&amp;&amp;</span> press <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
    assign end_data_generate <span class="token operator">=</span> add_data_generate <span class="token operator">&amp;&amp;</span> data_generate <span class="token operator">&gt;=</span> <span class="token number">8</span>'hff<span class="token punctuation">;</span>

    <span class="token comment">// 数据缓冲器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            data_buffer <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state_c <span class="token operator">==</span> <span class="token constant">WR_DATA</span> <span class="token operator">||</span> state_c <span class="token operator">==</span> <span class="token constant">RD_DATA</span><span class="token punctuation">)</span> begin
            <span class="token keyword">case</span> <span class="token punctuation">(</span>eeprom_state<span class="token punctuation">)</span>
                'd1 <span class="token operator">:</span> <span class="token comment">// 1表示写数据到EEPROM中</span>
                    begin
                        <span class="token keyword">case</span> <span class="token punctuation">(</span>cnt_byte<span class="token punctuation">)</span>
                            <span class="token string">'d0 : data_buffer &lt;= 8'</span>ha0<span class="token punctuation">;</span>
                            'd1 <span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> pointer_wr<span class="token punctuation">;</span>
                            'd2 <span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> data_generate<span class="token punctuation">;</span>
                            <span class="token keyword">default</span><span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        endcase
                    end
                'd2 <span class="token operator">:</span> <span class="token comment">// 2表示从EEPROM中读数据</span>
                    begin
                        <span class="token keyword">case</span> <span class="token punctuation">(</span>cnt_byte<span class="token punctuation">)</span>
                            <span class="token string">'d0 : data_buffer &lt;= 8'</span>ha0<span class="token punctuation">;</span>
                            'd1 <span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> pointer_rd<span class="token punctuation">;</span>
                            <span class="token string">'d2 : data_buffer &lt;= 8'</span>ha1<span class="token punctuation">;</span>
                            'd3 <span class="token operator">:</span> 
                                begin
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SCL</span><span class="token punctuation">)</span> begin
                                        data_buffer<span class="token punctuation">[</span><span class="token number">7</span> <span class="token operator">-</span> cnt_bit<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> SDA_in<span class="token punctuation">;</span>
                                    end
                                    <span class="token keyword">else</span> begin
                                        data_buffer <span class="token operator">&lt;=</span> data_buffer<span class="token punctuation">;</span>
                                    end
                                end
                            <span class="token keyword">default</span><span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        endcase
                    end
                <span class="token keyword">default</span><span class="token operator">:</span> data_buffer <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            endcase
        end
        <span class="token keyword">else</span> begin
            data_buffer <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// SDA_out输出</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
            SDA_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            <span class="token keyword">case</span> <span class="token punctuation">(</span>state_c<span class="token punctuation">)</span>
                <span class="token constant">START</span> <span class="token operator">:</span> 
                    begin
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd29<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd69<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> SDA_oe<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> SDA_out<span class="token punctuation">;</span>
                        end
                    end
                <span class="token constant">WR_DATA</span> <span class="token operator">:</span>
                    begin
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd69<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> data_buffer<span class="token punctuation">[</span><span class="token number">7</span> <span class="token operator">-</span> cnt_bit<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> SDA_oe<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> SDA_out<span class="token punctuation">;</span>
                        end
                    end
                <span class="token constant">RD_DATA</span> <span class="token operator">:</span>
                    begin
                        SDA_oe <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        SDA_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                    end
                <span class="token constant">CHECK_ACK</span> <span class="token operator">:</span>
                    begin
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd69<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> SDA_oe<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> SDA_out<span class="token punctuation">;</span>
                        end
                    end
                <span class="token constant">SEND_NACK</span> <span class="token operator">:</span>
                    begin
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd69<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> SDA_oe<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> SDA_out<span class="token punctuation">;</span>
                        end
                    end
                <span class="token constant">STOP</span> <span class="token operator">:</span>
                    begin
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd69<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt_400KHz <span class="token operator">==</span> 'd29<span class="token punctuation">)</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                        end
                        <span class="token keyword">else</span> begin
                            SDA_oe <span class="token operator">&lt;=</span> SDA_oe<span class="token punctuation">;</span>
                            SDA_out <span class="token operator">&lt;=</span> SDA_out<span class="token punctuation">;</span>
                        end
                    end
                <span class="token keyword">default</span><span class="token operator">:</span> 
                    begin
                        SDA_oe <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                        SDA_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
                    end
            endcase
        end
    end

    <span class="token comment">// 输出数据给数码管显示</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            data_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            address_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
            state_out <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>eeprom_state <span class="token operator">==</span> <span class="token string">'d1 &amp;&amp; wr_data2check_ack &amp;&amp; cnt_byte == '</span>d2<span class="token punctuation">)</span> begin
            data_out <span class="token operator">&lt;=</span> data_buffer<span class="token punctuation">;</span>
            address_out <span class="token operator">&lt;=</span> pointer_wr<span class="token punctuation">;</span>
            state_out <span class="token operator">&lt;=</span> 'd1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rd_data2send_nack<span class="token punctuation">)</span> begin
            data_out <span class="token operator">&lt;=</span> data_buffer<span class="token punctuation">;</span>
            address_out <span class="token operator">&lt;=</span> pointer_rd<span class="token punctuation">;</span>
            state_out <span class="token operator">&lt;=</span> 'd2<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            data_out <span class="token operator">&lt;=</span> data_out<span class="token punctuation">;</span>
            address_out <span class="token operator">&lt;=</span> address_out<span class="token punctuation">;</span>
            state_out <span class="token operator">&lt;=</span> state_out<span class="token punctuation">;</span>
        end
    end

endmodule
</code></pre> 
<h3><a id="14__658"></a>1.4 数码管模块</h3> 
<p>display.v</p> 
<pre><code class="prism language-javascript"><span class="token comment">/*========================================*\
  filename        : display.v
  description     : 滚动显示输入的数据
  up file         : 
  reversion       : 
      v1.0 : 2022-7-27 18:49:34
  author          : 张某某
\*========================================*/</span>

module display #<span class="token punctuation">(</span>parameter  <span class="token constant">MS_1</span><span class="token operator">=</span> <span class="token number">16</span>'d50000<span class="token punctuation">)</span><span class="token punctuation">(</span>
    input                               clk                 <span class="token punctuation">,</span> <span class="token comment">// 50MHz</span>
    input                               rst_n               <span class="token punctuation">,</span> <span class="token comment">// 复位信号</span>
    input           <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              eeprom_state        <span class="token punctuation">,</span>
    input           <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              data                <span class="token punctuation">,</span>
    input           <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              address             <span class="token punctuation">,</span>

    output  reg     <span class="token punctuation">[</span> <span class="token number">5</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              <span class="token constant">SEL</span>                 <span class="token punctuation">,</span> <span class="token comment">// SEL信号</span>
    output  reg     <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              <span class="token constant">DIG</span>                   <span class="token comment">// DIG信号</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 信号定义</span>
    reg             <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              cnt_flicker         <span class="token punctuation">;</span> <span class="token comment">// 计数1ms</span>
    wire                                SEL_change          <span class="token punctuation">;</span> <span class="token comment">// cnt_flicker计满使能信号</span>
    reg             <span class="token punctuation">[</span> <span class="token number">4</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              tmp_data            <span class="token punctuation">;</span> <span class="token comment">// 当前DIG的值</span>

    wire            <span class="token punctuation">[</span> <span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              num_2               <span class="token punctuation">;</span> <span class="token comment">// 百位</span>
    wire            <span class="token punctuation">[</span> <span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              num_1               <span class="token punctuation">;</span> <span class="token comment">// 十位</span>
    wire            <span class="token punctuation">[</span> <span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              num_0               <span class="token punctuation">;</span> <span class="token comment">// 个位</span>

    reg                                 pointer             <span class="token punctuation">;</span>
    
<span class="token comment">// 逻辑描述</span>
    <span class="token comment">// 闪烁频率计数器</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            cnt_flicker <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>SEL_change<span class="token punctuation">)</span> begin
            cnt_flicker <span class="token operator">&lt;=</span> 'd0<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            cnt_flicker <span class="token operator">&lt;=</span> cnt_flicker <span class="token operator">+</span> 'd1<span class="token punctuation">;</span> 
        end
    end
    assign SEL_change <span class="token operator">=</span> cnt_flicker <span class="token operator">&gt;=</span> <span class="token constant">MS_1</span> <span class="token operator">-</span> <span class="token string">'d1 ? 1'</span><span class="token literal-property property">b1</span> <span class="token operator">:</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>

    <span class="token comment">// SEL信号输出</span>
    always @<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> begin
            <span class="token constant">SEL</span> <span class="token operator">&lt;=</span> <span class="token number">6</span>'b011_111<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>SEL_change<span class="token punctuation">)</span> begin
            <span class="token constant">SEL</span> <span class="token operator">&lt;=</span> <span class="token punctuation">{<!-- --></span><span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            <span class="token constant">SEL</span> <span class="token operator">&lt;=</span> <span class="token constant">SEL</span><span class="token punctuation">;</span>
        end
    end

    <span class="token comment">// 获取地址的百位、十位、个位</span>
    assign num_2 <span class="token operator">=</span> address <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
    assign num_1 <span class="token operator">=</span> address <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
    assign num_0 <span class="token operator">=</span> address <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// tmp_data当前SEL位选所对应的DIG十进制值</span>
    always @<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> begin
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token constant">SEL</span><span class="token punctuation">)</span>
            <span class="token number">6</span><span class="token string">'b011_111 : begin tmp_data = data[3:0]; pointer = '</span>d1<span class="token punctuation">;</span>end
            <span class="token number">6</span><span class="token string">'b101_111 : begin tmp_data = data[7:4]; pointer = '</span>d1<span class="token punctuation">;</span>end
            <span class="token number">6</span><span class="token string">'b110_111 : begin tmp_data = num_0; pointer = '</span>d0<span class="token punctuation">;</span>end
            <span class="token number">6</span>'b111_011 <span class="token operator">:</span>
                begin
                    pointer <span class="token operator">=</span> 'd1<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>num_2 <span class="token operator">==</span> <span class="token string">'d0 &amp;&amp; num_1 == '</span>d0<span class="token punctuation">)</span> begin
                        tmp_data <span class="token operator">=</span> 'd16<span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        tmp_data <span class="token operator">=</span> num_1<span class="token punctuation">;</span>
                    end
                end
            <span class="token number">6</span>'b111_101 <span class="token operator">:</span> 
                begin
                    pointer <span class="token operator">=</span> 'd1<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>num_2<span class="token punctuation">)</span> begin
                        tmp_data <span class="token operator">=</span> num_2<span class="token punctuation">;</span>
                    end
                    <span class="token keyword">else</span> begin
                        tmp_data <span class="token operator">=</span> 'd16<span class="token punctuation">;</span>
                    end
                end
            <span class="token number">6</span>'b111_110 <span class="token operator">:</span> 
                begin
                    pointer <span class="token operator">=</span> 'd1<span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token punctuation">(</span>eeprom_state<span class="token punctuation">)</span>
                        <span class="token string">'d1 : tmp_data = '</span>d17<span class="token punctuation">;</span>
                        <span class="token string">'d2 : tmp_data = '</span>d18<span class="token punctuation">;</span>
                        <span class="token keyword">default</span><span class="token operator">:</span> tmp_data <span class="token operator">=</span> 'd16<span class="token punctuation">;</span>
                    endcase
                end
            <span class="token keyword">default</span><span class="token operator">:</span> begin tmp_data <span class="token operator">=</span> <span class="token string">'d0; pointer = '</span>d1<span class="token punctuation">;</span>end
        endcase
    end

    <span class="token comment">// DIG输出各数字对应的二进制</span>
    always @<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> begin
        <span class="token keyword">case</span> <span class="token punctuation">(</span>tmp_data<span class="token punctuation">)</span>
            <span class="token number">5</span><span class="token string">'d0 : DIG = {pointer, 7'</span>b100_0000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d1 : DIG = {pointer, 7'</span>b111_1001<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d2 : DIG = {pointer, 7'</span>b010_0100<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d3 : DIG = {pointer, 7'</span>b011_0000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d4 : DIG = {pointer, 7'</span>b001_1001<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d5 : DIG = {pointer, 7'</span>b001_0010<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d6 : DIG = {pointer, 7'</span>b000_0010<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d7 : DIG = {pointer, 7'</span>b111_1000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d8 : DIG = {pointer, 7'</span>b000_0000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d9 : DIG = {pointer, 7'</span>b001_0000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d10: DIG = {pointer, 7'</span>b000_1000<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d11: DIG = {pointer, 7'</span>b000_0011<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d12: DIG = {pointer, 7'</span>b100_0110<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d13: DIG = {pointer, 7'</span>b010_0001<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d14: DIG = {pointer, 7'</span>b000_0110<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d15: DIG = {pointer, 7'</span>b000_1110<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token string">'d16: DIG = {pointer, 7'</span>b111_1111<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 全黑</span>
            <span class="token number">5</span><span class="token string">'d17: DIG = {pointer, 7'</span>b001_1101<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 写数据标识符</span>
            <span class="token number">5</span><span class="token string">'d18: DIG = {pointer, 7'</span>b010_1011<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 读数据标识符</span>
            <span class="token keyword">default</span> <span class="token operator">:</span> <span class="token constant">DIG</span> <span class="token operator">=</span> <span class="token number">8</span>'b1111_1111<span class="token punctuation">;</span>
        endcase
    end

endmodule
</code></pre> 
<h2><a id="_792"></a>二、仿真文件</h2> 
<p>这里只需要对 iic_eeprom.v 文件进行仿真即可<br> tb_iic_eeprom.v</p> 
<pre><code class="prism language-javascript"><span class="token comment">/*========================================*\
    filename        : tb_iic_eeprom.v
    description     : iic_eeprom仿真
    up file         : 
    reversion       : 
        v1.0 : 2022-8-22 16:13:37
    author          : 张某某
\*========================================*/</span>

`timescale 1ns<span class="token operator">/</span>1ns

module tb_iic_eeprom<span class="token punctuation">;</span>

<span class="token comment">// Parameter definition</span>
    parameter       <span class="token constant">CYC_CLK</span>             <span class="token operator">=</span> <span class="token number">20</span>            <span class="token punctuation">;</span>

<span class="token comment">// Drive signal</span>
    reg                                 tb_clk          <span class="token punctuation">;</span>
    reg                                 tb_rst_n        <span class="token punctuation">;</span>
    reg             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              tb_press        <span class="token punctuation">;</span>
    reg                                 tb_SDA_in       <span class="token punctuation">;</span>

<span class="token comment">// Observation signal</span>
    wire                                tb_SCL          <span class="token punctuation">;</span>
    wire                                tb_SDA_out      <span class="token punctuation">;</span>
    wire                                tb_SDA_oe       <span class="token punctuation">;</span>
    wire            <span class="token punctuation">[</span> <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>              tb_data_out     <span class="token punctuation">;</span>

<span class="token comment">// Module calls</span>
    iic_eeprom              <span class="token function">U_iic_eeprom</span><span class="token punctuation">(</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">clk</span>            <span class="token punctuation">(</span>tb_clk         <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">rst_n</span>          <span class="token punctuation">(</span>tb_rst_n       <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input           [ 1:0]*/</span>  <span class="token punctuation">.</span><span class="token function">press</span>          <span class="token punctuation">(</span>tb_press       <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*input                 */</span>  <span class="token punctuation">.</span><span class="token function">SDA_in</span>         <span class="token punctuation">(</span>tb_SDA_in      <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token constant">SCL</span>            <span class="token punctuation">(</span>tb_SCL         <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token function">SDA_out</span>        <span class="token punctuation">(</span>tb_SDA_out     <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg           */</span>  <span class="token punctuation">.</span><span class="token function">SDA_oe</span>         <span class="token punctuation">(</span>tb_SDA_oe      <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">data_out</span>       <span class="token punctuation">(</span>tb_data_out    <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">address_out</span>    <span class="token punctuation">(</span>tb_address_out <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/*output  reg     [ 7:0]*/</span>  <span class="token punctuation">.</span><span class="token function">state_out</span>      <span class="token punctuation">(</span>tb_state_out   <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// System initialization</span>
    initial begin
        tb_clk <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
        tb_rst_n <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
        #<span class="token punctuation">(</span><span class="token constant">CYC_CLK</span><span class="token punctuation">)</span> tb_rst_n <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
    end
    always #<span class="token punctuation">(</span><span class="token constant">CYC_CLK</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> tb_clk <span class="token operator">=</span> <span class="token operator">~</span>tb_clk<span class="token punctuation">;</span>

    initial begin
        tb_press <span class="token operator">=</span> <span class="token number">2</span>'b00<span class="token punctuation">;</span>
        tb_SDA_in <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>

        #<span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token constant">CYC_CLK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 写数据</span>
        tb_press <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
        #<span class="token punctuation">(</span><span class="token constant">CYC_CLK</span><span class="token punctuation">)</span> tb_press <span class="token operator">=</span> <span class="token number">2</span>'b00<span class="token punctuation">;</span>

        #<span class="token punctuation">(</span><span class="token number">5000</span> <span class="token operator">*</span> <span class="token constant">CYC_CLK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 读数据</span>
        tb_press <span class="token operator">=</span> <span class="token number">2</span>'b01<span class="token punctuation">;</span>
        #<span class="token punctuation">(</span><span class="token constant">CYC_CLK</span><span class="token punctuation">)</span> tb_press <span class="token operator">=</span> <span class="token number">2</span>'b00<span class="token punctuation">;</span>

        #<span class="token punctuation">(</span><span class="token number">10000</span> <span class="token operator">*</span> <span class="token constant">CYC_CLK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        $stop<span class="token punctuation">;</span>
    end
endmodule
</code></pre> 
<h2><a id="_868"></a>三、管脚配置文件</h2> 
<ul><li>根据开发板原理图可以知道，EEPROM 采用 24LC04 芯片，再在原理图中找到对应管脚即可<br> <img src="https://images2.imgbox.com/23/d6/RqKGQBg4_o.png" alt="在这里插入图片描述"></li></ul> 
<p>tcl 文件</p> 
<pre><code class="prism language-javascript">set_location_assignment <span class="token constant">PIN_E1</span>  <span class="token operator">-</span>to clk
set_location_assignment <span class="token constant">PIN_E15</span> <span class="token operator">-</span>to rst_n
set_location_assignment <span class="token constant">PIN_E16</span> <span class="token operator">-</span>to key_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_M15</span> <span class="token operator">-</span>to key_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_L1</span>  <span class="token operator">-</span>to <span class="token constant">SCL</span>
set_location_assignment <span class="token constant">PIN_L2</span>  <span class="token operator">-</span>to <span class="token constant">SDA</span>
set_location_assignment <span class="token constant">PIN_A4</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B4</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A3</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B3</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A2</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B1</span>  <span class="token operator">-</span>to <span class="token constant">SEL</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B7</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A8</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A6</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B5</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B6</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A7</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_B8</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
set_location_assignment <span class="token constant">PIN_A5</span>  <span class="token operator">-</span>to <span class="token constant">DIG</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_895"></a>四、验证结果</h2> 
<ul><li>仿真结果，前面一部分是写的波形，后面一部分是读的波形<br> <img src="https://images2.imgbox.com/4f/7d/prOICOEn_o.png" alt="在这里插入图片描述"></li><li>板上结果</li></ul> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="UGY2cR6x-1661737194801" frameborder="0" src="https://live.csdn.net/v/embed/235237" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>IIC控制EEPROM</p> 
</div> 
<p></p> 
<ul><li>按左边的按键表示写操作，按右边按键表示读操作</li><li>最左边的符号，“u” 表示写数据到 EEPROM 中，“n” 表示从 EEPROM 中读出写入的数据</li><li>小数点左边的数字表示当前操作的 EEPROM 地址</li><li>小数点右边的数字表示写入或读出的数据</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20ffcf01511382f30a3b6f7d0fca54a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">element表单非空验证问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/443d2dfe7c82366982b9b0d1dda1a391/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Scrapy爬虫报错：NotImplementedError: TxmsSpider.parse callback is not defined</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>