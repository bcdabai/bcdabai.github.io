<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java.net.URLEncoder 与 java.net.URLDecoder.decode - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java.net.URLEncoder 与 java.net.URLDecoder.decode" />
<meta property="og:description" content="java.net.URLEncoder URLEncoder是用来对HTML表单编码，该类包含用于将字符串转换为application/x-www-form-urlencoded 格式的静态方法。 (application/x-www-form-urlencoded： 数据被编码为名/值对)
当发出get请求时，浏览器用x-www-form-urlencoded的编码方式把form数据转换成一个字串（name1=value1&amp;name2=value2…），然后把这个字串以请求参数形式附加到url后面。当发出post请求时，浏览器把form数据封装到http body中，然后发送到server。
URLEncoder编码时遵循的规则
a-z,A-Z,0-9保持原样。特殊字符.,-,*与_保持原样。空格被转换为&#43;号。其它字符转换为%xy的形式，xy由16进制数来表示。 import java.io.UnsupportedEncodingException; import java.net.URLEncoder; public class Main { public static void main(String[] args) throws InterruptedException, ExecutionException { try { String string = &#34;The string ü@foo-bar&#34;; String encodedString = URLEncoder.encode(string, &#34;UTF-8&#34;); System.out.println(&#34;Encoded String: &#34; &#43; encodedString); } catch (UnsupportedEncodingException e) { e.printStackTrace(); } } } 上述代码[1]使用UTF-8编码。The string ü@foo-bar被转换为The&#43;string&#43;%C3%BC%40foo-bar因为UTF-8，ü被编码为两字节C3(16进制),BC(16进制),@被编码为一字节40(16进制)。
java.net.URLDecoder URLDecoder用来解码，解格式为application/x-www-form-urlencoded的编码。
public class Main { public static void main(String[] args) throws UnsupportedEncodingException { System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a7291c63d8de6658c636e5dd7c8a4d04/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-04-04T20:15:00+08:00" />
<meta property="article:modified_time" content="2017-04-04T20:15:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java.net.URLEncoder 与 java.net.URLDecoder.decode</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="javaneturlencoder"><strong>java.net.URLEncoder</strong></h2> 
<p>URLEncoder是用来对HTML表单编码，该类包含用于将字符串转换为application/x-www-form-urlencoded 格式的静态方法。 <strong>(application/x-www-form-urlencoded： 数据被编码为名/值对)</strong></p> 
<p>当发出get请求时，浏览器用x-www-form-urlencoded的编码方式把form数据转换成一个字串（name1=value1&amp;name2=value2…），然后把这个字串以请求参数形式附加到url后面。当发出post请求时，浏览器把form数据封装到http body中，然后发送到server。</p> 
<p>URLEncoder编码时遵循的规则</p> 
<ul><li>a-z,A-Z,0-9保持原样。</li><li>特殊字符.,-,*与_保持原样。</li><li>空格被转换为+号。</li><li>其它字符转换为%xy的形式，xy由16进制数来表示。</li></ul> 
<pre class="prettyprint"><code class=" hljs cs">import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Main {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) throws InterruptedException, ExecutionException {
        <span class="hljs-keyword">try</span> {
            String <span class="hljs-keyword">string</span> = <span class="hljs-string">"The string ü@foo-bar"</span>;
            String encodedString = URLEncoder.encode(<span class="hljs-keyword">string</span>, <span class="hljs-string">"UTF-8"</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Encoded String: "</span> + encodedString);
        } <span class="hljs-keyword">catch</span> (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
    }
}</code></pre> 
<p>上述代码[1]使用UTF-8编码。The string ü@foo-bar被转换为The+string+%C3%BC%40foo-bar因为UTF-8，ü被编码为两字节C3(16进制),BC(16进制),@被编码为一字节40(16进制)。</p> 
<h2 id="javaneturldecoder"><strong>java.net.URLDecoder</strong></h2> 
<p>URLDecoder用来解码，解格式为application/x-www-form-urlencoded的编码。</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Main {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) throws  UnsupportedEncodingException {
        System.<span class="hljs-keyword">out</span>.println(URLDecoder.decode(<span class="hljs-string">"special+chars%3A+%26%25*+"</span>, <span class="hljs-string">"UTF-8"</span>));
    }
}</code></pre> 
<p>上面代码[2]解码使用UTF-8的格式，最终输出：</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">special <span class="hljs-keyword">chars</span>: &amp;%* 

</code></pre> 
<h3 id="javaneturldecoderdecodestringstring源码分析"><strong>java.net.URLDecoder.decode(String,String)源码分析</strong></h3> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">decode</span>(String s, String enc)
        <span class="hljs-keyword">throws</span> UnsupportedEncodingException{

        <span class="hljs-keyword">boolean</span> needToChange = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">int</span> numChars = s.length();
        StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer(numChars &gt; <span class="hljs-number">500</span> ? numChars / <span class="hljs-number">2</span> : numChars);
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (enc.length() == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedEncodingException (<span class="hljs-string">"URLDecoder: empty string enc parameter"</span>);
        }

        <span class="hljs-keyword">char</span> c;
        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">while</span> (i &lt; numChars) {
            c = s.charAt(i);
            <span class="hljs-keyword">switch</span> (c) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span>:
                sb.append(<span class="hljs-string">' '</span>);
                i++;
                needToChange = <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'%'</span>:
                <span class="hljs-comment">/*
                 * Starting with this instance of %, process all
                 * consecutive substrings of the form %xy. Each
                 * substring %xy will yield a byte. Convert all
                 * consecutive  bytes obtained this way to whatever
                 * character(s) they represent in the provided
                 * encoding.
                 */</span>

                <span class="hljs-keyword">try</span> {

                    <span class="hljs-comment">// (numChars-i)/3 is an upper bound for the number</span>
                    <span class="hljs-comment">// of remaining bytes</span>
                    <span class="hljs-keyword">if</span> (bytes == <span class="hljs-keyword">null</span>)
                        bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[(numChars-i)/<span class="hljs-number">3</span>];
                    <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>;

                    <span class="hljs-keyword">while</span> ( ((i+<span class="hljs-number">2</span>) &lt; numChars) &amp;&amp;
                            (c==<span class="hljs-string">'%'</span>)) {
                        <span class="hljs-keyword">int</span> v = Integer.parseInt(s.substring(i+<span class="hljs-number">1</span>,i+<span class="hljs-number">3</span>),<span class="hljs-number">16</span>);
                        <span class="hljs-keyword">if</span> (v &lt; <span class="hljs-number">0</span>)
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"URLDecoder: Illegal hex characters in escape (%) pattern - negative value"</span>);
                        bytes[pos++] = (<span class="hljs-keyword">byte</span>) v;
                        i+= <span class="hljs-number">3</span>;
                        <span class="hljs-keyword">if</span> (i &lt; numChars)
                            c = s.charAt(i);
                    }

                    <span class="hljs-comment">// A trailing, incomplete byte encoding such as</span>
                    <span class="hljs-comment">// "%x" will cause an exception to be thrown</span>

                    <span class="hljs-keyword">if</span> ((i &lt; numChars) &amp;&amp; (c==<span class="hljs-string">'%'</span>))
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(
                         <span class="hljs-string">"URLDecoder: Incomplete trailing escape (%) pattern"</span>);

                    sb.append(<span class="hljs-keyword">new</span> String(bytes, <span class="hljs-number">0</span>, pos, enc));
                } <span class="hljs-keyword">catch</span> (NumberFormatException e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(
                    <span class="hljs-string">"URLDecoder: Illegal hex characters in escape (%) pattern - "</span>
                    + e.getMessage());
                }
                needToChange = <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                sb.append(c);
                i++;
                <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-keyword">return</span> (needToChange? sb.toString() : s);</code></pre> 
<p><strong>解码可总结为：</strong></p> 
<p>1.对读入的字符串逐个遍历各个字符</p> 
<p>2.如果读入字符是+号，则转换为空格，如果不是以%号开头则不进行转换，直接返回。</p> 
<p>3.如果以%号开头 <br> 3.1预分配缓冲区，大小为最大可能剩余字符数</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-built_in">bytes</span> <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> byte<span class="hljs-preprocessor">[</span>(numChars<span class="hljs-attribute">-i</span>)/<span class="hljs-number">3</span><span class="hljs-preprocessor">]</span><span class="hljs-markup">;</span></code></pre> 
<p>numChars-i为剩余字符数，而%xy格式共3个字符。(numChars-i)/3表示最大剩余字符数。 <br> 因为最终转换时不包含%号，而xy以16进制表示，因此(numChars-i)/3表示转换所需要最大字节数。</p> 
<p>3.2进行相关错误处理，如果产生错误则抛出异常。 </p> 
<h2 id="参考"><strong>参考</strong></h2> 
<pre><code>[1]https://www.udemy.com/collection/java-code-geeks/all-courses/?pmtag=APRUDEMY17&amp;siteID=fauDoMV7FnU-Gz9kCuhFvRfa4V26e0XAig&amp;LSNPUBID=fauDoMV7FnU
[2]https://examples.javacodegeeks.com/core-java/net/urldecoder/java-net-urldecoder-example/
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/393591e201dfbd2d08ad744fc4c74b3f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">The package needs to be reinstalled,but I can&#39;t find an archive for it</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/767e76ae684bc5206c619149283dcdef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最全面的RecyclerView源码解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>