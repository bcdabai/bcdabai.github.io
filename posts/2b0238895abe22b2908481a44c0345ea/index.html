<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3的学习【超详细】 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3的学习【超详细】" />
<meta property="og:description" content="目录 一、vue3的优点1、vue3的优点 二、常用的API1、setup（Composition API）2、生命周期（Composition API）3、ref函数和reactive函数用法和区别（Composition API）1、ref2、reactive3、ref和reactive的区别 4、计算属性（computed）和侦听属性（watch）（Composition API）1、computed2、watch 5、nextTick（全局API）6、props（选项式API）1、非ts语法2、ts语法 7、toRefs（Composition API）8、vue3中的响应式原理1、vue2中的响应式原理2、vue3中的响应式原理 总结9、自定义指令1、什么是指令2、怎么实现3、应用场景 10、自定义修饰符11、vue的vueuse库（工具库） 三、新组件和新属性1、v-bind（内置内容）2、teleport 传送门3、Suspense 一、vue3的优点 1、vue3的优点 1、源码体积得到优化：
（1） API减少，移除一些冷门API，如filter、inline-template等；
（2）引入tree-shaking 减少打包体积；
2、源码的升级：
（1）Vue3使用Proxy进行数据劫持，可以很好的规避vue2使用Object.defineProperty进行数据劫持带来的缺陷；
3、拥抱TypeScript：
(1) 更好的支持Ts（typescript）
4、高级给与：
（1）暴露了更底层的API和提供更先进的内置组件；
5、 组合API（Composition API)：
（1) 能够更好的组织逻辑，封装逻辑，复用逻辑；
二、常用的API 1、setup（Composition API） 1、setup是vue3中的一个全新的配置项，值为一个函数；
2、setup是所有CompositionAPI（组合API）的基础，组件中所用到的数据、方法等都需要在setup中进行配置；
（1）：若返回一个对象，则对象中的属性、方法，均可以在模板中直接使用；
（2）：若返回一个渲染函数：则可以自定义渲染内容；
setup的两个注意点：
1、setup执行时机，在beforeCreate之前执行一次，this是undefined；
2、setup的参数：
（1）：props：指为对象，包含组件外部传递过来，且组件内部声明接收了的属性。
（2）：context：上下文对象
attrs：值为对象，包含组件外部传递过来，但没有在props配置中声明的属性，相当于this.$attrs；
slots：收到的插槽内容，相当于this.$slots;
emit:分发自定义事件的函数，相当于this.$emit。
2、生命周期（Composition API） vue3中的生命周期和vue2的区别:
beforeCreate=&gt;setup（）(创建实例前)
created=&gt;setup() （创建实例后)
beforeMount=&gt;onBeforeMount ( 挂载DOM前)
mounted=&gt;onMounted ( 挂载DOM后)
beforeUpdate=&gt;onBeforeUpdate （更新组件前）
updated=&gt;onUpdated （更新组件后）
beforeUnmount=&gt;onBeforeUnmount （卸载销毁前）
unmounted=&gt;onUnmounted （卸载销毁后）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2b0238895abe22b2908481a44c0345ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-24T11:22:31+08:00" />
<meta property="article:modified_time" content="2023-05-24T11:22:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3的学习【超详细】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#vue3_1" rel="nofollow">一、vue3的优点</a></li><li><ul><li><a href="#1vue3_2" rel="nofollow">1、vue3的优点</a></li></ul> 
  </li><li><a href="#API_18" rel="nofollow">二、常用的API</a></li><li><ul><li><a href="#1setupComposition_API_19" rel="nofollow">1、setup（Composition API）</a></li><li><a href="#2Composition_API_43" rel="nofollow">2、生命周期（Composition API）</a></li><li><a href="#3refreactiveComposition_API_61" rel="nofollow">3、ref函数和reactive函数用法和区别（Composition API）</a></li><li><ul><li><a href="#1ref_62" rel="nofollow">1、ref</a></li><li><a href="#2reactive_93" rel="nofollow">2、reactive</a></li><li><a href="#3refreactive_145" rel="nofollow">3、ref和reactive的区别</a></li></ul> 
   </li><li><a href="#4computedwatchComposition_API_167" rel="nofollow">4、计算属性（computed）和侦听属性（watch）（Composition API）</a></li><li><ul><li><a href="#1computed_169" rel="nofollow">1、computed</a></li><li><a href="#2watch_274" rel="nofollow">2、watch</a></li></ul> 
   </li><li><a href="#5nextTickAPI_410" rel="nofollow">5、nextTick（全局API）</a></li><li><a href="#6propsAPI_437" rel="nofollow">6、props（选项式API）</a></li><li><ul><li><a href="#1ts_443" rel="nofollow">1、非ts语法</a></li><li><a href="#2ts_490" rel="nofollow">2、ts语法</a></li></ul> 
   </li><li><a href="#7toRefsComposition_API_526" rel="nofollow">7、toRefs（Composition API）</a></li><li><a href="#8vue3_588" rel="nofollow">8、vue3中的响应式原理</a></li><li><ul><li><a href="#1vue2_589" rel="nofollow">1、vue2中的响应式原理</a></li><li><a href="#2vue3_627" rel="nofollow">2、vue3中的响应式原理</a></li></ul> 
   </li><li><a href="#_655" rel="nofollow">总结</a></li><li><a href="#9_658" rel="nofollow">9、自定义指令</a></li><li><ul><li><a href="#1_659" rel="nofollow">1、什么是指令</a></li><li><a href="#2_687" rel="nofollow">2、怎么实现</a></li><li><a href="#3_761" rel="nofollow">3、应用场景</a></li></ul> 
   </li><li><a href="#10_901" rel="nofollow">10、自定义修饰符</a></li><li><a href="#11vuevueuse_954" rel="nofollow">11、vue的vueuse库（工具库）</a></li></ul> 
  </li><li><a href="#_1031" rel="nofollow">三、新组件和新属性</a></li><li><ul><li><a href="#1vbind_1032" rel="nofollow">1、v-bind（内置内容）</a></li><li><a href="#2teleport__1070" rel="nofollow">2、teleport 传送门</a></li><li><a href="#3Suspense_1088" rel="nofollow">3、Suspense</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="vue3_1"></a>一、vue3的优点</h2> 
<h3><a id="1vue3_2"></a>1、vue3的优点</h3> 
<p><strong>1、源码体积得到优化：</strong><br> （1） API减少，移除一些冷门API，如filter、inline-template等；<br> （2）引入tree-shaking 减少打包体积；</p> 
<p><strong>2、源码的升级：</strong><br> （1）Vue3使用Proxy进行数据劫持，可以很好的规避vue2使用Object.defineProperty进行数据劫持带来的缺陷；</p> 
<p><strong>3、拥抱TypeScript：</strong><br> (1) 更好的支持Ts（typescript）</p> 
<p><strong>4、高级给与：</strong><br> （1）暴露了更底层的API和提供更先进的内置组件；</p> 
<p><strong>5、 组合API（Composition API)：</strong><br> （1) 能够更好的组织逻辑，封装逻辑，复用逻辑；</p> 
<h2><a id="API_18"></a>二、常用的API</h2> 
<h3><a id="1setupComposition_API_19"></a>1、setup（Composition API）</h3> 
<p>1、setup是vue3中的一个全新的配置项，值为一个函数；</p> 
<p>2、setup是所有CompositionAPI（组合API）的基础，组件中所用到的数据、方法等都需要在setup中进行配置；<br> （1）：若返回一个对象，则对象中的属性、方法，均可以在模板中直接使用；</p> 
<p>（2）：若返回一个渲染函数：则可以自定义渲染内容；</p> 
<p>setup的两个注意点：</p> 
<p>1、setup执行时机，在beforeCreate之前执行一次，this是undefined；</p> 
<p>2、setup的参数：</p> 
<p>（1）：props：指为对象，包含组件外部传递过来，且组件内部声明接收了的属性。</p> 
<p>（2）：context：上下文对象</p> 
<p>attrs：值为对象，包含组件外部传递过来，但没有在props配置中声明的属性，相当于this.$attrs；</p> 
<p>slots：收到的插槽内容，相当于this.$slots;</p> 
<p>emit:分发自定义事件的函数，相当于this.$emit。</p> 
<h3><a id="2Composition_API_43"></a>2、生命周期（Composition API）</h3> 
<p>vue3中的生命周期和vue2的区别:</p> 
<p>beforeCreate=&gt;setup（）(创建实例前)</p> 
<p>created=&gt;setup() （创建实例后)</p> 
<p>beforeMount=&gt;onBeforeMount ( 挂载DOM前)</p> 
<p>mounted=&gt;onMounted ( 挂载DOM后)</p> 
<p>beforeUpdate=&gt;onBeforeUpdate （更新组件前）</p> 
<p>updated=&gt;onUpdated （更新组件后）</p> 
<p>beforeUnmount=&gt;onBeforeUnmount （卸载销毁前）</p> 
<p>unmounted=&gt;onUnmounted （卸载销毁后）</p> 
<h3><a id="3refreactiveComposition_API_61"></a>3、ref函数和reactive函数用法和区别（Composition API）</h3> 
<h4><a id="1ref_62"></a>1、ref</h4> 
<p><strong>特点</strong></p> 
<p>（1）ref的参数一般是基本数据类型，也可以是对象类型</p> 
<p>（2）如果参数是对象类型，其实底层的本质还是reactive，系统会自动将ref转换为reactive，例如<br> ==ref(1) =<mark>&gt; reactive({value:1})</mark>=<br> （3）在模板中访问ref中的数据，系统会自动帮我们添加.value,在JS中访问ref中的数据，需要手动添加.value</p> 
<p>（4）ref的底层原理同reactive一样，都是Proxy</p> 
<pre><code class="prism language-typescript">
<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
 
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  count<span class="token punctuation">.</span>value<span class="token operator">++</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"increment"</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 无需 <span class="token punctuation">.</span>value <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="2reactive_93"></a>2、reactive</h4> 
<p><strong>特点</strong></p> 
<blockquote> 
 <p>（1）reactive的参数一般是对象或者数组,他能够将复杂数据类型变为响应式数据。<br> （2）reactive的响应式是深层次的，底层本质是将传入的数据转换为Proxy对象</p> 
</blockquote> 
<pre><code class="prism language-typescript">
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>名称：<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>主要爱好：<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>job<span class="token punctuation">.</span>hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"changeName"</span><span class="token operator">&gt;</span>修改姓名和爱好<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span>reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span> <span class="token comment">// 按需引入ref函数</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// ref定义对象类型响应式变量</span>
      title<span class="token operator">:</span><span class="token string">'赵丽颖'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
    <span class="token keyword">let</span> job <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// reactive定义对象类型响应式变量</span>
      <span class="token keyword">type</span><span class="token operator">:</span><span class="token string">'演员'</span><span class="token punctuation">,</span>
      hobby<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">type</span><span class="token operator">:</span><span class="token string">'演戏'</span><span class="token punctuation">,</span>
          degree<span class="token operator">:</span><span class="token string">'✨✨✨✨✨'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">type</span><span class="token operator">:</span><span class="token string">'看书'</span><span class="token punctuation">,</span>
          degree<span class="token operator">:</span><span class="token string">'✨✨✨'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">changeName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
      name<span class="token punctuation">.</span>value<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'刘亦菲'</span> <span class="token comment">// 对ref定义的响应式数据进行操作，需要使用.value</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span>job<span class="token punctuation">.</span>hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      job<span class="token punctuation">.</span>hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'运动'</span> <span class="token comment">// 对reactive定义的响应式数据进行操作，无需使用.value，且是深层次响应 </span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span>job<span class="token punctuation">.</span>hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将变量和函数返回，以便在模版中使用</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      name<span class="token punctuation">,</span>
      job<span class="token punctuation">,</span>
      changeName
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre> 
<h4><a id="3refreactive_145"></a>3、ref和reactive的区别</h4> 
<p><strong>1、从定义数据角度对比：</strong></p> 
<p>ref用来定义：基本数据类型；</p> 
<p>reactive用来定义：对象（或数组）类型数据；</p> 
<p>备注：ref也可以用来定义对象或数组类型数据，它内部会自动通过reactive转为代理对象；</p> 
<p><strong>2、从原理角度对比：</strong></p> 
<p>ref通过Object.defineProperty()的get和set来实现响应式；</p> 
<p>reactive通过使用Proxy来实现响应式（数据劫持），并通过Reflect操作源对象内部的数据。</p> 
<p><strong>3、从使用角度对比：</strong></p> 
<p>ref定义的数据：操作数据需要.value，读取数据时模板中直接读取不需要.value；</p> 
<p>reactive定义的数据：操作数据与读取数据均不需要.value；</p> 
<h3><a id="4computedwatchComposition_API_167"></a>4、计算属性（computed）和侦听属性（watch）（Composition API）</h3> 
<p><em><strong>computed和watch都是vue框架中的用于监听数据变化的属性，都能在数据改变时，针对改变的相关数据做成相应的变化</strong></em></p> 
<h4><a id="1computed_169"></a>1、computed</h4> 
<p>（1）计算属性的优点：<br> 计算属性是基于缓存来实现的，无论你后端调用十次还是几百次，只要计算属性依赖的相关值没有发生变化，那计算属性就可以通过缓存读取。例子如下：</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> reactive<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>


<span class="token keyword">const</span> allName <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  userName1<span class="token operator">:</span><span class="token string">'小'</span><span class="token punctuation">,</span>  <span class="token comment">//姓</span>
  userName2<span class="token operator">:</span><span class="token string">'明'</span><span class="token punctuation">,</span>   <span class="token comment">//名</span>
  age<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> userName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我是计算属性调用的"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> allName<span class="token punctuation">.</span>userName1 <span class="token operator">+</span>
    allName<span class="token punctuation">.</span>userName2<span class="token operator">+</span><span class="token string">"年龄"</span><span class="token operator">+</span>allName<span class="token punctuation">.</span>age
<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token keyword">const</span> <span class="token function-variable function">userAllName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我是方法调用的"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> allName<span class="token punctuation">.</span>userName1 <span class="token operator">+</span> allName<span class="token punctuation">.</span>userName2<span class="token operator">+</span><span class="token string">"年龄"</span><span class="token operator">+</span>allName<span class="token punctuation">.</span>age
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下面是通过方法得出的名字<span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token function">userAllName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下面是通过计算属性得出的名字<span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<p>从上面对应的浏览器中打印的我们可以看出，方法和计算属性调用了八次，但是与方法不一样的是，计算属性就打印了一次，就好像就第一次调用了这个函数一样，后面就没调用了。这就是计算属性的缓存，只要其依赖的值不发生相关的变化，那么无论你计算属性调用了好多次，但最终就只是执行一次。<br> <img src="https://images2.imgbox.com/84/7e/6hlWFzMk_o.png" alt="在这里插入图片描述"><br> （2）可写的计算属性<br> 当计算属性是只读的，你试着修改他的话，会收到一个警告，例如：</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

plusOne<span class="token punctuation">.</span>value<span class="token operator">++</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> plusOne <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<p>值既没有发生变化还会得到警告，如图：</p> 
<p><img src="https://images2.imgbox.com/6d/12/MnRWjptu_o.png" alt="在这里插入图片描述"></p> 
<p>正确的可写计算属性代码如下：</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">/*利用get和set函数*/</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> 
   <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    count<span class="token punctuation">.</span>value <span class="token operator">=</span> val <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

plusOne<span class="token punctuation">.</span>value<span class="token operator">++</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> plusOne <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

</code></pre> 
<p>结果如图：<br> <img src="https://images2.imgbox.com/f7/c7/pDHGujh3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2watch_274"></a>2、watch</h4> 
<p>默认是懒侦听的，即仅在侦听源发生变化时才执行回调函数。</p> 
<p>第一个参数是侦听器的源。这个来源可以是以下几种：</p> 
<p>一个函数，返回一个值<br> 一个 ref<br> 一个响应式对象<br> …或是由以上类型的值组成的数组</p> 
<p>第二个参数是在发生变化时要调用的回调函数。这个回调函数接受三个参数：新值、旧值，以及一个用于注册副作用清理的回调函数。<br> 第三个可选的参数是一个对象，支持以下这些选项：</p> 
<p>immediate：在侦听器创建时立即触发回调。第一次调用时旧值是 undefined。<br> deep：如果源是对象，强制深度遍历，以便在深层级变更时触发回调。<br> flush：使侦听器在侦听器回调中能访问被 Vue 更新之后的DOM。</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 挑战 1: Watch 一次
 * 确保副作用函数只执行一次
 * 使用stopWatch停止侦听器
*/</span>
<span class="token keyword">const</span> stopWatch<span class="token operator">=</span><span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Only triggered once"</span><span class="token punctuation">)</span>
  <span class="token function">stopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
count<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> count<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 挑战 2: Watch 对象
 * 确保副作用函数被正确触发
 * 使用deep深层次监听
*/</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">watch</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"The state.count updated"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
      deep<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>value<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span>

<span class="token comment">/**
 * 挑战 3: 副作用函数刷新时机
 * 确保正确访问到更新后的`eleRef`值
 * 一般侦听器是在Vue组件更新之前被调用，所以要使用flush访问被Vue更新后的DOM
*/</span>

<span class="token keyword">const</span> eleRef<span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>eleRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span> flush<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">18</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p ref<span class="token operator">=</span><span class="token string">"eleRef"</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> age <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>watch和watchEffect</strong><br> 相同点<br> 1、两者都可以监听data属性变化<br> 2、watch 与 watchEffect 在手动停止侦听、清除副作用 (将 onInvalidate 作为第三个参数传递给回调)、刷新时机和调试方面有相同的行为。</p> 
<p>区别<br> 1、watch不加immediate初始值监听不到，watchEffect一开始就能监听到；<br> 2、watch需要明确监听哪个属性;<br> 3、watchEffect会根据其中的属性，自动监听其变化;<br> 4、watcheffect初始化时，一定会执行一次（收集要监听的数据，不然不知道监听的是什么），watch只有你设置了初始化监听才会监听;<br> 5、watchEffect获取不到更改前的值,而watch可以同时获取更改前和更改后的值;</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>watch<span class="token punctuation">,</span>watchEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
			<span class="token comment">//数据</span>
			<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
				age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
				job<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
					j1<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
						salary<span class="token operator">:</span><span class="token number">20</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>

			<span class="token comment">//监视</span>
			
            <span class="token comment">/*watch(sum,(newValue,oldValue)=&gt;{
				console.log('sum的值变化了',newValue,oldValue)
			},{immediate:true})*/</span> 

			<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
				<span class="token keyword">const</span> x1 <span class="token operator">=</span> sum<span class="token punctuation">.</span>value
				<span class="token keyword">const</span> x2 <span class="token operator">=</span> person<span class="token punctuation">.</span>job<span class="token punctuation">.</span>j1<span class="token punctuation">.</span>salary
				<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watchEffect所指定的回调执行了'</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       sum<span class="token punctuation">.</span>value<span class="token operator">=</span>sum<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token number">1</span>
      <span class="token punctuation">}</span>
		
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>sum<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span>
      点我加一
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/f6/6c/8jE1foSa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5nextTickAPI_410"></a>5、nextTick（全局API）</h3> 
<p>在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM,例子</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span>nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  count<span class="token punctuation">.</span>value<span class="token operator">++</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>textContent <span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>textContent <span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">,</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>textContent <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button ref<span class="token operator">=</span><span class="token string">"counter"</span> @click<span class="token operator">=</span><span class="token string">"increment"</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/36/1a/4g2XNzyM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6propsAPI_437"></a>6、props（选项式API）</h3> 
<p>主要用在组件的父组件向子组件的传值，主要有两大类ts语法和非ts语法<br> default：默认值；<br> type：类型；<br> required：是否必传；<br> validator：props验证；</p> 
<h4><a id="1ts_443"></a>1、非ts语法</h4> 
<pre><code class="prism language-typescript"><span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 基础类型检查</span>
  <span class="token comment">// （给出 `null` 和 `undefined` 值则会跳过任何类型检查）</span>
  propA<span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token comment">// 多种可能的类型</span>
  propB<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 必传，且为 String 类型</span>
  propC<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Number 类型的默认值</span>
  propD<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 对象类型的默认值</span>
  propE<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token comment">// 对象或数组的默认值</span>
    <span class="token comment">// 必须从一个工厂函数返回。</span>
    <span class="token comment">// 该函数接收组件所接收到的原始 prop 作为参数。</span>
    <span class="token keyword">default</span><span class="token punctuation">(</span>rawProps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> message<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 自定义类型校验函数</span>
  propF<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">validator</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// The value must match one of these strings</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 函数类型的默认值</span>
  propG<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>
    <span class="token comment">// 不像对象或数组的默认，这不是一个工厂函数。这会是一个用来作为默认值的函数</span>
    <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token string">'Default function'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="2ts_490"></a>2、ts语法</h4> 
<pre><code class="prism language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// id</span>
    id<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token comment">// 宽度</span>
    width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token comment">// 高度?:</span>
    height<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否初始化</span>
    init<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    <span class="token comment">// 子项</span>
    list<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ganttChartItem<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否显示描述</span>
    desc<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token comment">// 描述颜色</span>
    descColor<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 高度默认20</span>
    height<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token comment">// 默认初始化</span>
    init<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 子项默认为空</span>
    <span class="token function-variable function">list</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否显示描述</span>
    desc<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token comment">// 描述颜色</span>
    descColor<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>通过定义interface接口来规范props的属性的格式<br> ?:表示可选属性<br> 定义默认属性值时需要使用withDefaults</p> 
<h3><a id="7toRefsComposition_API_526"></a>7、toRefs（Composition API）</h3> 
<p><strong>toref函数和toref函数与ref函数的区别：</strong></p> 
<p>toRef 函数会与源数据交互，修改响应式数据会造成源数据的修改，但是他的修改不会造成视图层数据的更新；</p> 
<p>ref 函数可以将对象里面的属性值变成响应式的数据，修改响应式数据，是不会影响到源数据，但是视图层上的数据会被更新</p> 
<p><strong>为啥要使用toRefs函数</strong>，原因：</p> 
<p>在<code>Vue.js</code>中，我们同样解构/扩展“响应式”对象，但它会失去响应性。toRefs函数才能保证解构/扩展不丢失响应性</p> 
<p><strong>一般都会使用toRefs函数而不是toRef函数</strong>，原因：</p> 
<p>（1）toRefs 函数用于批量设置多个数据为相应是数据。</p> 
<p>（2）toRefs 函数还可以与其他响应式数据相交互，更加方便处理视图层数据。</p> 
<p><strong>toRef函数的使用</strong>：</p> 
<pre><code class="prism language-typescript"><span class="token comment">//toRef 函数有两个参数</span>
<span class="token function">toRef</span><span class="token punctuation">(</span>操作对象<span class="token punctuation">,</span> 对象属性<span class="token punctuation">)</span>

</code></pre> 
<p><strong>toRefs函数的使用</strong>：</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> reactive <span class="token punctuation">,</span>toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">function</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>count <span class="token operator">=</span> value
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
     <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span>
    update<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ensure the destructured properties don't lose their reactivity  ...toRefs(state)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>  count <span class="token punctuation">,</span> update <span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">useCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span @click<span class="token operator">=</span><span class="token string">"update(count-1)"</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>span @click<span class="token operator">=</span><span class="token string">"update(count+1)"</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="8vue3_588"></a>8、vue3中的响应式原理</h3> 
<h4><a id="1vue2_589"></a>1、vue2中的响应式原理</h4> 
<p><strong>基本原理</strong></p> 
<p>vue2利用的是原生js下边的Object.defineProperty()进行数据劫持，在通过里面的getter和<br> setter方法，进行查看和数据的修改，通过发布、订阅者模式进行数据与视图的响应式。</p> 
<pre><code class="prism language-typescript"><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            name<span class="token operator">:</span><span class="token string">'路飞'</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span><span class="token number">18</span>
        <span class="token punctuation">}</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>      <span class="token comment">//有人读取name时调用</span>
        <span class="token keyword">return</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>      <span class="token comment">//有人修改name时调用</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"有人修改了name属性"</span><span class="token punctuation">)</span>
        person<span class="token punctuation">.</span>name <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>      <span class="token comment">//有人读取age时调用</span>
        <span class="token keyword">return</span> person<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>      <span class="token comment">//有人修改age时调用</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"有人修改了age属性"</span><span class="token punctuation">)</span>
        person<span class="token punctuation">.</span>age <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/e5/cb/XFfMseqo_o.png" alt="在这里插入图片描述"><br> vue2给对象增加和修改新属性用 $set;<br> vue2想删除已有的属性可以用 $delete;</p> 
<h4><a id="2vue3_627"></a>2、vue3中的响应式原理</h4> 
<p><strong>基本原理</strong></p> 
<p>1、对于基本数据类型来说，响应式依然是靠Object.defineProperty()的get和set来完成的</p> 
<p>2、对于对象类型的数据：</p> 
<p>通过Proxy代理：拦截对象中任意属性的变化，包括属性值得读写、添加、删除等操作等…<br> 通过Reflect反射函数进行操作</p> 
<pre><code class="prism language-typescript"><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//拦截读取属性值</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//拦截设置属性值或添加新属性</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//拦截删除属性</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="_655"></a>总结</h3> 
<p>在Vue2中，数据响应式主要借助Object.defineProperty()来实现，存在的缺陷是无法操作数据的增加和删除，在Vue3中，数据响应式主要借助proxy和Reffect配合实现，可以做到实现数据的增删改查。</p> 
<h3><a id="9_658"></a>9、自定义指令</h3> 
<h4><a id="1_659"></a>1、什么是指令</h4> 
<p>指令系统是计算机硬件的语言系统，也叫机器语言，它是系统程序员看到的计算机的主要属性。因此指令系统表征了计算机的基本功能决定了机器所要求的能力</p> 
<p>在vue中提供了一套为数据驱动视图更为方便的操作，这些操作被称为指令系统</p> 
<p>我们看到的v- 开头的行内属性，都是指令，不同的指令可以完成或实现不同的功能</p> 
<p>除了核心功能默认内置的指令 (v-model 和 v-show)，Vue 也允许注册自定义指令</p> 
<p><strong>指令使用的几种方式：</strong></p> 
<p>//会实例化一个指令，但这个指令没有参数<br> <code>v-xxx</code></p> 
<p>// – 将值传到指令中<br> <code>v-xxx="value"</code></p> 
<p>// – 将字符串传入到指令中，如<code>v-html="'&lt;p&gt;内容&lt;/p&gt;'"</code><br> <code>v-xxx="'string'"</code></p> 
<p>// – 传参数（<code>arg</code>），如<code>v-bind:class="className"</code><br> <code>v-xxx:arg="value"</code></p> 
<p>// – 使用修饰符（<code>modifier</code>）<br> <code>v-xxx:arg.modifier="value"</code></p> 
<h4><a id="2_687"></a>2、怎么实现</h4> 
<p>注册一个自定义指令有全局注册与局部注册</p> 
<p>全局注册注册主要是用过Vue.directive方法进行注册</p> 
<p>Vue.directive第一个参数是指令的名字（不需要写上v-前缀），第二个参数可以是对象数据，也可以是一个指令函数</p> 
<pre><code class="prism language-typescript"><span class="token comment">// 注册一个全局自定义指令 `v-focus`</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 当被绑定的元素插入到 DOM 中时……</span>
  <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 聚焦元素</span>
    el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 页面加载完成之后自动让输入框获取到焦点的小功能</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>局部注册通过组件options选项中设置directive属性</p> 
<pre><code class="prism language-typescript">directives<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  focus<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 指令的定义</span>
    <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 页面加载完成之后自动让输入框获取到焦点的小功能</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用新自定义指令</p> 
<pre><code class="prism language-typescript">  <span class="token operator">&lt;</span>input v<span class="token operator">-</span>focus<span class="token operator">=</span><span class="token string">"state"</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">"text"</span><span class="token operator">&gt;</span>
</code></pre> 
<p><strong>指令钩子</strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">const</span> myDirective <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 在绑定元素的 attribute 前</span>
  <span class="token comment">// 或事件监听器应用前调用</span>
  <span class="token function">created</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 下面会介绍各个参数的细节</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在元素被插入到 DOM 前调用</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在绑定元素的父组件</span>
  <span class="token comment">// 及他自己的所有子节点都挂载完成后调用</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件更新前调用</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在绑定元素的父组件</span>
  <span class="token comment">// 及他自己的所有子节点都更新后调用</span>
  <span class="token function">updated</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件卸载前调用</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件卸载后调用</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>钩子参数</strong><br> 指令的钩子会传递以下几种参数：</p> 
<p><code>el</code>：指令绑定到的元素。这可以用于直接操作 DOM。</p> 
<p><code>binding</code>：一个对象，包含以下属性。</p> 
<p>（1）value：传递给指令的值。例如在 v-my-directive=“1 + 1” 中，值是 2。<br> （2）oldValue：之前的值，仅在 beforeUpdate 和 updated 中可用。无论值是否更改，它都可用。<br> （3）arg：传递给指令的参数 (如果有的话)。例如在 v-my-directive:foo 中，参数是 “foo”。<br> （4）modifiers：一个包含修饰符的对象 (如果有的话)。例如在 v-my-directive.foo.bar 中，修饰符对象是 { foo: true, bar: true }。<br> （5）instance：使用该指令的组件实例。<br> （6）dir：指令的定义对象。<br> <code>vnode</code>：代表绑定元素的底层 VNode。</p> 
<p><code>prevNode</code>：之前的渲染中代表指令所绑定元素的 VNode。仅在 beforeUpdate 和 updated 钩子中可用。</p> 
<h4><a id="3_761"></a>3、应用场景</h4> 
<p>例子一：<strong>自定义防抖点击指令</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">/**
 * 实现以下自定义指令
 * 确保在一定时间内当快速点击按钮多次时只触发一次点击事件
 * 你需要支持防抖延迟时间选项, 用法如 `v-debounce-click:ms`
 *
*/</span>
<span class="token comment">// 简易版-防抖函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">debounce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">func<span class="token operator">:</span> Function<span class="token punctuation">,</span> delay<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> timer<span class="token operator">:</span> number <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    timer <span class="token operator">=</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> VDebounceClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> value<span class="token operator">:</span> cb<span class="token punctuation">,</span> arg<span class="token operator">:</span> delay <span class="token punctuation">}</span> <span class="token operator">=</span> binding
    <span class="token keyword">const</span> debounced <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>   
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> debounced<span class="token punctuation">)</span>
    el<span class="token punctuation">.</span>_debounced <span class="token operator">=</span> debounced
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>_debounced<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>_debounced<span class="token punctuation">)</span>
      el<span class="token punctuation">.</span>_debounced <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Only triggered once when clicked many times quickly"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-debounce-click:</span>1000</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Click on it many times quickly
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>例子二：<strong>自定义获取焦点指令</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 实现一个自定义指令,让元素获取焦点
 * 确保当切换`state`时,元素随着状态值获取/失去焦点
 *
*/</span>
<span class="token keyword">const</span> VFocus <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span>binding</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    binding<span class="token punctuation">.</span>value <span class="token operator">?</span> el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> el<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span>binding</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    binding<span class="token punctuation">.</span>value <span class="token operator">?</span> el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> el<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>value
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-focus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>state<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>例子三：<strong>一键copy功能</strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> vCopy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//</span>
  <span class="token comment">/*
    bind 钩子函数，第一次绑定时调用，可以在这里做初始化设置
    el: 作用的 dom 对象
    value: 传给指令的值，也就是我们要 copy 的值
  */</span>
  <span class="token function">bind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    el<span class="token punctuation">.</span>$value <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// 用一个全局属性来存传进来的值，因为这个值在别的钩子函数里还会用到</span>
    el<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>$value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 值为空的时候，给出提示，我这里的提示是用的 ant-design-vue 的提示，你们随意</span>
        Message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'无复制内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 动态创建 textarea 标签</span>
      <span class="token keyword">const</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 将该 textarea 设为 readonly 防止 iOS 下自动唤起键盘，同时将 textarea 移出可视区域</span>
      textarea<span class="token punctuation">.</span>readOnly <span class="token operator">=</span> <span class="token string">'readonly'</span><span class="token punctuation">;</span>
      textarea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
      textarea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'-9999px'</span><span class="token punctuation">;</span>
      <span class="token comment">// 将要 copy 的值赋给 textarea 标签的 value 属性</span>
      textarea<span class="token punctuation">.</span>value <span class="token operator">=</span> el<span class="token punctuation">.</span>$value<span class="token punctuation">;</span>
      <span class="token comment">// 将 textarea 插入到 body 中</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 选中值并复制</span>
      textarea<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// textarea.setSelectionRange(0, textarea.value.length);</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'Copy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'复制成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定点击事件，就是所谓的一键 copy 啦</span>
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 当传进来的值更新的时候触发</span>
  <span class="token function">componentUpdated</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    el<span class="token punctuation">.</span>$value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 指令与元素解绑的时候，移除事件绑定</span>
  <span class="token function">unbind</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> vCopy<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="10_901"></a>10、自定义修饰符</h3> 
<p>主要是用来进行数据表单的双向绑定的<br> 添加到组件 v-model 的修饰符将通过 modelModifiers prop 提供给组件。<br> 下面是自定义修饰符<code>capitalize</code>，自动将 <code>v-model</code> 绑定输入的字符串值首字母转为大写：<br> 父组件：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Renderer</span> <span class="token attr-name">v-model.capitalize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>data<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> {<!-- -->{modelValue}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span>  Renderer <span class="token keyword">from</span>  <span class="token string">"./Comp.vue"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span>  data <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>子组件：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ref<span class="token punctuation">,</span>computed<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    modelValue<span class="token operator">:</span> String<span class="token punctuation">,</span>
    modelModifiers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">capitalize</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>modelModifiers<span class="token punctuation">.</span>capitalize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> value<span class="token operator">=</span><span class="token function">capitalize</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//使默认值也能相应变化</span>
<span class="token keyword">const</span> modelValue <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">capitalize</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>modelValue<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">emitValue</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modelValue<span class="token punctuation">"</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateValue<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="11vuevueuse_954"></a>11、vue的vueuse库（工具库）</h3> 
<p><a href="https://vueuse.org/shared/useCounter/#usecounter" rel="nofollow">vueuse工具库链接</a></p> 
<p>1、实现一个计数器</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">interface</span> <span class="token class-name">UseCounterOptions</span> <span class="token punctuation">{<!-- --></span>
  min<span class="token operator">?</span><span class="token operator">:</span> number
  max<span class="token operator">?</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 实现计数器函数,确保功能正常工作
 * 1. 加 (+)
 * 2. 减 (-)
 * 3. 重置 
 * 4. 最小值 &amp; 最大值 选项支持
*/</span>
<span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token parameter">initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> options<span class="token operator">:</span> UseCounterOptions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>max<span class="token punctuation">,</span> min<span class="token punctuation">}</span> <span class="token operator">=</span> options
  <span class="token keyword">const</span> <span class="token function-variable function">inc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dec</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> count<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span>value <span class="token operator">=</span> initialValue<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> count<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> dec<span class="token punctuation">,</span> reset <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> count<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> dec<span class="token punctuation">,</span> reset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> min<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Count: {<!-- -->{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inc<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    inc
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dec<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    dec
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reset<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    reset
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2、实现一个切换状态的可组合函数</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">/**
 * 实现一个切换状态的可组合函数
 * 确保该功能正常工作
*/</span>
<span class="token keyword">function</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>boolean<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
                                     
 <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">!</span>status<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> toggle<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> toggle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>State: {<!-- -->{ state ? 'ON' : 'OFF' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toggle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Toggle state
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h2><a id="_1031"></a>三、新组件和新属性</h2> 
<h3><a id="1vbind_1032"></a>1、v-bind（内置内容）</h3> 
<p>Vue3中的新增的v-bind()的常用使用方式，主要包括在css,less,scss中的使用</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> width<span class="token operator">=</span><span class="token number">200</span>
<span class="token keyword">const</span> style<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
  height<span class="token operator">:</span><span class="token string">'50px'</span>
<span class="token punctuation">}</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  theme<span class="token punctuation">.</span>value <span class="token operator">=</span> colors<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token comment">/* 修改以下代码绑定动态颜色 */</span>
<span class="token selector">p</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span><span class="token string">'style.height'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span>solid<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>width+<span class="token string">'px'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2teleport__1070"></a>2、teleport 传送门</h3> 
<p>能将插槽内容渲染到 DOM 中的另一个指定位置。</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">"Hello World"</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- to='移动到指定DOM里'--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>teleport</span>  <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>teleport</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="3Suspense_1088"></a>3、Suspense</h3> 
<p>允许应用程序在等待异步组件时渲染一些其它内容，让用户有一个更好体验。<br> 使用步骤：</p> 
<p>1、异步引入组件；</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>defineAsyncComponent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> Child <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/Child.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>2、使用Suspense包裹组件，并配置好default 与 fallback<br> （1） 插槽包裹异步组件；<br> （2） 插槽包裹渲染异步组件渲染之前的内容；</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>default</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>fallback</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>加载中.....<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e303c3d610258a5051c398bab0c23f3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023最新版Java面试八股文大全（附各大厂面试真题及答案）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5b830a6aee2a25291cfc79764feb1d69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">雪花算法id值精度丢失问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>