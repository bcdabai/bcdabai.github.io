<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android中Java与web通信 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android中Java与web通信" />
<meta property="og:description" content="Android中Java与web通信不是新的技术了，在android发布之初就支持这种方式，2011年开始流行，而这种模式开发也称作Hybird模式。这里对android中的Java与web通信方式做一下总结。Android中有3种方式可以实现Java与web通信。
1、重写WebViewClient private class MyWebViewClient extends WebViewClient { @Override public boolean shouldOverrideUrlLoading(WebView view, String url) { if (Uri.parse(url).getHost().equals(&#34;www.example.com&#34;)) { // This is my web site, so do not override; let my WebView load the page Toast.makeText(WebViewClientActivity.this, url, Toast.LENGTH_SHORT).show(); return false; } return true; } } 通过 shouldOverrideUrlLoading(WebView view, String url)返回的url获取数据 例如：url=“www.example.com?body=loadurl” 可以截取后面的body数据。
在web中调用方式：
&lt;button οnclick=&#34;window.open(&#39;www.example.com?body=loadurl&#39;)&#34;&gt;showAndroidToast&lt;/button&gt; 2、重写WebChromeClient final class MyWebChromeClient extends WebChromeClient { @Override public boolean onJsAlert(WebView view, String url, String message, JsResult result) { Log." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8f16361d0e9239d2302b5dc2fbcfd3a8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-08-22T14:22:33+08:00" />
<meta property="article:modified_time" content="2015-08-22T14:22:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android中Java与web通信</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><br></p> 
<p><span style="font-family:SimSun;font-size:18px;">  Android中Java与web通信不是新的技术了，在android发布之初就支持这种方式，2011年开始流行，而这种模式开发也称作Hybird模式。这里对android中的<span style="font-family: SimSun;font-size:18px;">Java与web通信方式做一下总结。Android中有3种方式可以实现<span style="font-family: SimSun;font-size:18px;">Java与web通信。</span></span></span><br></p> 
<p><span style="font-family:SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><br></span></span></span></p> 
<h3><span style="font-family:SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;">1、重写WebViewClient</span></span></span></h3> 
<p><span style="font-family: SimSun;"><span style="font-family: SimSun;"><span style="font-family: SimSun;"></span></span></span></p> 
<pre><code class="language-java"> private class MyWebViewClient extends WebViewClient {
	        @Override
	        public boolean shouldOverrideUrlLoading(WebView view, String url) {
	            if (Uri.parse(url).getHost().equals("www.example.com")) {
	                // This is my web site, so do not override; let my WebView load the page
	                
	            	Toast.makeText(WebViewClientActivity.this, url, Toast.LENGTH_SHORT).show();
	    			
	            	return false;
	            }

				
	            return true;
	        }
	    }</code></pre> 
<br> 
<span style="font-size:18px;">通过</span> 
<span style="font-family: Menlo;"><span style="font-size:18px;">shouldOverrideUrlLoading(WebView view, String url)返回的url获取数据</span></span> 
<p></p> 
<p><span style="font-size:18px;"><span style="font-family: Menlo;">例如：url=“</span><span style="background-color: rgb(255, 255, 255);"><span style="font-family:SimSun;">www.example.com?body=loadurl</span></span><span style="font-family: Menlo;">” 可以截取后面的body数据。</span></span></p> 
<p><span style="font-size:18px;"><span style="font-family: Menlo;"><br></span></span></p> 
<p><span style="font-size:18px;"><span style="font-family: Menlo;">在web中调用方式：</span></span></p> 
<p><span style="font-size:18px;"><span style="font-family: Menlo;"></span></span></p> 
<pre><code class="language-html"> &lt;button οnclick="window.open('www.example.com?body=loadurl')"&gt;showAndroidToast&lt;/button&gt;</code></pre> 
<br> 
<p></p> 
<p><span style="font-size:18px;"><span style="font-family: Menlo;"><br></span></span></p> 
<h3><span style="font-family:SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;">2、重写</span></span></span><span style="font-family: Menlo; font-size: 12pt; background-color: rgb(255, 255, 255);">WebChromeClient</span></h3> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"></span></span></span></p> 
<pre><code class="language-java"> final class MyWebChromeClient extends WebChromeClient {
        @Override
        public boolean onJsAlert(WebView view, String url, String message, JsResult result) {
            Log.d("MyWebChromeClient", message);
            
            Toast.makeText(OnJsPromptActivity.this, message, Toast.LENGTH_SHORT).show();
            result.confirm();
            return true;
        }

		@Override
		public boolean onJsConfirm(WebView view, String url, String message,
				JsResult result) {
			// TODO Auto-generated method stub
			return super.onJsConfirm(view, url, message, result);
		}

		@Override
		public boolean onJsPrompt(WebView view, String url, String message,
				String defaultValue, JsPromptResult result) {
			
			 Toast.makeText(OnJsPromptActivity.this, message, Toast.LENGTH_SHORT).show();
			// TODO Auto-generated method stub
			//return super.onJsPrompt(view, url, message, defaultValue, result);
			 
			 result.confirm();
	         return true;
		}
        
        
    }</code></pre> 
<br> 
<span style="font-family: Menlo; font-size: 12pt;">使用onJsAlert或者</span> 
<span style="font-family: Menlo; font-size: 12pt;">onJsPrompt，<span style="font-family: Menlo; font-size: 12pt;">onJsAlert，</span><span style="font-family: Menlo; font-size: 12pt;">onJsPrompt分别对应JS中的alert和</span></span> 
<span style="font-family: Menlo; font-size: 12pt;">prompt。</span> 
<p></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: Menlo; font-size: 12pt;"><br></span></span></span></span></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: Menlo; font-size: 12pt;"><span style="font-family: Menlo;font-size:18px;">在web中调用方式：</span><br></span></span></span></span></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: Menlo; font-size: 12pt;"><span style="font-family: Menlo;font-size:18px;"></span></span></span></span></span></p> 
<pre><code class="language-html">&lt;button οnclick="showAndroidToast('Hello Android!');"&gt;showAndroidToast&lt;/button&gt;

&lt;script type="text/javascript"&gt;
    function showAndroidToast(toast) {
        prompt('js prompt');  
    }
  &lt;/script&gt;</code></pre> 
<br> 
<br> 
<p></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: SimSun;font-size:18px;"><span style="font-family: Menlo; font-size: 12pt;"><br></span></span></span></span></p> 
<h3><span style="font-size:18px;"><span style="font-family: SimSun;"><span style="font-family: SimSun;"><span style="font-family: SimSun;">3、</span></span></span><span style="font-family: Menlo;">addJavascriptInterface</span></span></h3> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"></span></span></p> 
<pre><code class="language-java">mWebView.addJavascriptInterface(new WebAppInterface(this), "Android");

public class WebAppInterface {
        Context mContext;

        /** Instantiate the interface and set the context */
        WebAppInterface(Context c) {
            mContext = c;
        }

        //在Android 4.2以上的，google作了修正，通过在Java的远程方法上面声明一个@JavascriptInterface，
        /** Show a toast from the web page */
        @JavascriptInterface
        public void showToast(String toast) {
            Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();
        }
    }</code></pre> 
<p></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><br></span></span></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;">addJavascriptInterface是Android提供的方法，包含两个参数。第一个是java中实现的类，类提供了javascript访问方法；第二个参数是java类映射到javascript的对象名。</span></span></p> 
<p><span style="font-family: Menlo;font-size:18px;"><br></span></p> 
<p><span style="font-family: Menlo;font-size:18px;">在web中调用方式：</span></p> 
<p><span style="font-family: SimSun;"><span style="font-family: SimSun;"></span></span></p> 
<pre><code class="language-html">  &lt;button οnclick="showAndroidToast('addjavascriptinterface');"&gt;showAndroidToast&lt;/button&gt;

  &lt;script type="text/javascript"&gt;
    function showAndroidToast(toast) {
        Android.showToast(toast);
    }
  &lt;/script&gt;</code></pre> 
<br> 
<span style="font-size:18px;"><br></span> 
<p></p> 
<p><span style="font-family:SimSun;font-size:18px;">   三种方法中后两种用的比较多。但是第三种方法在Android4.2一下存在安全漏洞，<span style="color: rgb(68, 68, 68); line-height: 25.2000007629395px; text-align: justify; text-indent: 28px; background-color: rgb(253, 253, 253);">详细的漏洞可以见乌云平台的这份报告：</span><a target="_blank" href="http://drops.wooyun.org/papers/548" rel="external noopener noreferrer" style="color: rgb(37, 166, 184); text-decoration: none; line-height: 25.2000007629395px; text-align: justify; text-indent: 28px; margin: 0px; padding: 0px;">WebView中接口隐患与手机挂马利用</a><span style="line-height: 25.2000007629395px; text-align: justify; text-indent: 28px;"><span style="color: rgb(68, 68, 68); background-color: rgb(253, 253, 253);">。这种漏洞尤为在访问第三方地址时出现。</span></span></span><span style="line-height: 25.2000007629395px; text-align: justify; text-indent: 28px;"><span style="font-family:SimSun;font-size:18px;">在Android 4.2以上的，google作了修正，通过在Java的远程方法上面声明一个@JavascriptInterface。Android4.2以下还没有好的方法，只能限制访问特定地址实现安全。但是对于我们自己的Hybird APP已足够。</span></span></p> 
<p><span style="line-height: 25.2000007629395px; text-align: justify; text-indent: 28px;"><span style="font-family:SimSun;font-size:18px;"></span></span></p> 
<p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><br></p> 
<p><span style="font-family: SimSun; font-size: 18px;"><span style="font-family: SimSun;font-size:18px;"><br></span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/034d4728cb26c2e888e9c8868787eca3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hdu5412CRB and Queries(整体二分)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a065ab1dbc7397d78bf386312a6e1b32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OIO与NIO区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>