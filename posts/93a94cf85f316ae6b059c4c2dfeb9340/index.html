<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>容器内安装CDH 6.3.2 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="容器内安装CDH 6.3.2" />
<meta property="og:description" content="参考资源
https://www.cnblogs.com/runnerjack/p/12693597.html
1.环境准备 1.1 安装vagrant虚拟机 node01
Vagrant.configure(&#34;2&#34;) do |config| config.vm.box = &#34;centos/7&#34; config.vm.hostname = &#34;node01&#34; config.vm.network &#34;private_network&#34;, ip: &#34;10.1.100.11&#34; # 虚拟机配置 config.vm.provider &#34;virtualbox&#34; do |vb| vb.gui = false vb.memory = &#34;1024&#34; vb.cpus = 2 end # 初始化安装脚本 config.vm.provision &#34;shell&#34;, inline: &lt;&lt;-SHELL yum update yum install -y vim wget sed -i &#39;s/PasswordAuthentication no/PasswordAuthentication yes/&#39; /etc/ssh/sshd_config systemctl restart sshd	# 关闭防火墙 systemctl stop firewalld.service systemctl disable firewalld.service # 关闭selinux sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config # 转发流量到iptables cat &gt; /etc/sysctl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/93a94cf85f316ae6b059c4c2dfeb9340/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-06T10:11:09+08:00" />
<meta property="article:modified_time" content="2021-09-06T10:11:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">容器内安装CDH 6.3.2</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://www.cnblogs.com/runnerjack/p/12693597.html" rel="nofollow">参考资源</a><br> https://www.cnblogs.com/runnerjack/p/12693597.html</p> 
<h4><a id="1_3"></a>1.环境准备</h4> 
<h5><a id="11_vagrant_5"></a>1.1 安装vagrant虚拟机</h5> 
<p><strong>node01</strong></p> 
<pre><code class="prism language-shell">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"centos/7"</span>
  config.vm.hostname <span class="token operator">=</span> <span class="token string">"node01"</span>
  config.vm.network <span class="token string">"private_network"</span>, ip: <span class="token string">"10.1.100.11"</span>
  <span class="token comment"># 虚拟机配置</span>
  config.vm.provider <span class="token string">"virtualbox"</span> <span class="token keyword">do</span> <span class="token operator">|</span>vb<span class="token operator">|</span>
    vb.gui <span class="token operator">=</span> <span class="token boolean">false</span>
    vb.memory <span class="token operator">=</span> <span class="token string">"1024"</span>
	vb.cpus <span class="token operator">=</span> <span class="token number">2</span>
  end
  <span class="token comment"># 初始化安装脚本</span>
  config.vm.provision <span class="token string">"shell"</span>, inline: <span class="token operator">&lt;&lt;-</span><span class="token environment constant">SHELL</span>
    yum update
    yum <span class="token function">install</span> -y <span class="token function">vim</span> <span class="token function">wget</span>
	<span class="token function">sed</span> -i <span class="token string">'s/PasswordAuthentication no/PasswordAuthentication yes/'</span>  /etc/ssh/sshd_config
	systemctl restart sshd	
	<span class="token comment"># 关闭防火墙</span>
	systemctl stop firewalld.service 
	systemctl disable firewalld.service
	<span class="token comment"># 关闭selinux</span>
	<span class="token function">sed</span> -i <span class="token string">'s/enforcing/disabled/'</span> /etc/selinux/config
	<span class="token comment"># 转发流量到iptables</span>
	<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> EOF 
	net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span> 
	net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span> 
	EOF 
	sysctl --system
	<span class="token comment"># 开启时间同步</span>
	yum <span class="token function">install</span> ntpdate -y 
	ntpdate time.windows.com
	<span class="token comment"># 时区</span>
	timedatectl set-timezone Asia/Shanghai
	<span class="token comment"># 安装lrzsz命令</span>
	yum <span class="token function">install</span> -y lrzsz
  <span class="token environment constant">SHELL</span>
end
</code></pre> 
<p><strong>node02</strong></p> 
<pre><code class="prism language-shell">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"centos/7"</span>
  config.vm.hostname <span class="token operator">=</span> <span class="token string">"node02"</span>
  config.vm.network <span class="token string">"private_network"</span>, ip: <span class="token string">"10.1.100.12"</span>
  <span class="token comment"># 虚拟机配置</span>
  config.vm.provider <span class="token string">"virtualbox"</span> <span class="token keyword">do</span> <span class="token operator">|</span>vb<span class="token operator">|</span>
    vb.gui <span class="token operator">=</span> <span class="token boolean">false</span>
    vb.memory <span class="token operator">=</span> <span class="token string">"1024"</span>
	vb.cpus <span class="token operator">=</span> <span class="token number">2</span>
  end
  <span class="token comment"># 初始化安装脚本</span>
  config.vm.provision <span class="token string">"shell"</span>, inline: <span class="token operator">&lt;&lt;-</span><span class="token environment constant">SHELL</span>
    yum update
    yum <span class="token function">install</span> -y <span class="token function">vim</span> <span class="token function">wget</span>
	<span class="token function">sed</span> -i <span class="token string">'s/PasswordAuthentication no/PasswordAuthentication yes/'</span>  /etc/ssh/sshd_config
	systemctl restart sshd	
	<span class="token comment"># 关闭防火墙</span>
	systemctl stop firewalld.service 
	systemctl disable firewalld.service
	<span class="token comment"># 关闭selinux</span>
	<span class="token function">sed</span> -i <span class="token string">'s/enforcing/disabled/'</span> /etc/selinux/config
	<span class="token comment"># 转发流量到iptables</span>
	<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> EOF 
	net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span> 
	net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span> 
	EOF 
	sysctl --system
	<span class="token comment"># 开启时间同步</span>
	yum <span class="token function">install</span> ntpdate -y 
	ntpdate time.windows.com
	<span class="token comment"># 时区</span>
	timedatectl set-timezone Asia/Shanghai
	<span class="token comment"># 安装lrzsz命令</span>
	yum <span class="token function">install</span> -y lrzsz
  <span class="token environment constant">SHELL</span>
end
</code></pre> 
<p><strong>node03</strong></p> 
<pre><code class="prism language-shell">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"centos/7"</span>
  config.vm.hostname <span class="token operator">=</span> <span class="token string">"node03"</span>
  config.vm.network <span class="token string">"private_network"</span>, ip: <span class="token string">"10.1.100.13"</span>
  <span class="token comment"># 虚拟机配置</span>
  config.vm.provider <span class="token string">"virtualbox"</span> <span class="token keyword">do</span> <span class="token operator">|</span>vb<span class="token operator">|</span>
    vb.gui <span class="token operator">=</span> <span class="token boolean">false</span>
    vb.memory <span class="token operator">=</span> <span class="token string">"1024"</span>
	vb.cpus <span class="token operator">=</span> <span class="token number">2</span>
  end
  <span class="token comment"># 初始化安装脚本</span>
  config.vm.provision <span class="token string">"shell"</span>, inline: <span class="token operator">&lt;&lt;-</span><span class="token environment constant">SHELL</span>
    yum update
    yum <span class="token function">install</span> -y <span class="token function">vim</span> <span class="token function">wget</span>
	<span class="token function">sed</span> -i <span class="token string">'s/PasswordAuthentication no/PasswordAuthentication yes/'</span>  /etc/ssh/sshd_config
	systemctl restart sshd	
	<span class="token comment"># 关闭防火墙</span>
	systemctl stop firewalld.service 
	systemctl disable firewalld.service
	<span class="token comment"># 关闭selinux</span>
	<span class="token function">sed</span> -i <span class="token string">'s/enforcing/disabled/'</span> /etc/selinux/config
	<span class="token comment"># 转发流量到iptables</span>
	<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> EOF 
	net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span> 
	net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span> 
	EOF 
	sysctl --system
	<span class="token comment"># 开启时间同步</span>
	yum <span class="token function">install</span> ntpdate -y 
	ntpdate time.windows.com
	<span class="token comment"># 时区</span>
	timedatectl set-timezone Asia/Shanghai
	<span class="token comment"># 安装lrzsz命令</span>
	yum <span class="token function">install</span> -y lrzsz
  <span class="token environment constant">SHELL</span>
end
</code></pre> 
<p><strong>安装</strong></p> 
<pre><code class="prism language-shell"><span class="token comment"># 分别创建三个目录node01、node02、node03，并把上面三个配置文件放入到其对应目录中执行下面命令</span>
<span class="token comment"># 安装启动</span>
vagrant up
<span class="token comment"># 进入当前安装系统，查看是否安装成功</span>
vagrant <span class="token function">ssh</span>
</code></pre> 
<h5><a id="12_yum_142"></a>1.2 修改yum源</h5> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y <span class="token function">wget</span> <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p /etc/yum.repos.d/repo_bak <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/repo_bak/ <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum makecache <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum update –y
</code></pre> 
<h5><a id="13_docker_157"></a>1.3 安装docker</h5> 
<pre><code class="prism language-shell"><span class="token comment"># 安装docker</span>
yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2 <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum makecache fast <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum -y <span class="token function">install</span> docker-ce <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> docker version

<span class="token comment"># 配置docker yum源、开机启动、重启</span>
<span class="token function">mkdir</span> -p /etc/docker/ <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
<span class="token punctuation">(</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{
  "data-root":"/home/docker",
  "registry-mirrors": ["https://1e7waog4.mirror.aliyuncs.com"]
}
EOF</span>
<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span>/etc/docker/daemon.json <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl start docker <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> docker <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> /etc/docker/daemon.json <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> docker version

<span class="token comment"># 补全工具</span>
yum <span class="token function">install</span> -y bash-completion <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> /usr/share/bash-completion/completions/docker <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> /usr/share/bash-completion/bash_completion <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all
</code></pre> 
<h5><a id="14__190"></a>1.4 安装基本工具</h5> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y <span class="token function">vim</span> <span class="token function">wget</span> ntp net-tools <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all
</code></pre> 
<h5><a id="15__197"></a>1.5 关闭防火墙</h5> 
<pre><code class="prism language-shell">systemctl stop firewalld <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl disable firewalld <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl status firewalld
</code></pre> 
<h5><a id="16_selinux_205"></a>1.6 设置selinux模式</h5> 
<pre><code class="prism language-shell">setenforce <span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token operator">||</span> <span class="token function">sed</span> -i <span class="token string">'s/enforcing/disabled/g'</span> /etc/selinux/config <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> -i <span class="token string">'s/permissive/disabled/g'</span> /etc/selinux/config <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> getenforce
</code></pre> 
<h5><a id="17__214"></a>1.7 配置时间同步</h5> 
<p><strong>配置文件</strong></p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> /etc/ntp.conf
</code></pre> 
<p><strong>添加配置</strong></p> 
<pre><code class="prism language-shell">server <span class="token number">0</span>.cn.pool.ntp.org
server <span class="token number">1</span>.cn.pool.ntp.org
server <span class="token number">2</span>.cn.pool.ntp.org       
server <span class="token number">3</span>.cn.pool.ntp.org
</code></pre> 
<p><strong>启动NTP服务</strong></p> 
<pre><code>systemctl start ntpd \
&amp;&amp; systemctl enable ntpd \
&amp;&amp; ntpdate -u 0.cn.pool.ntp.org \
&amp;&amp; hwclock --systohc \
&amp;&amp; date
</code></pre> 
<h5><a id="18__243"></a>1.8 创建网络</h5> 
<pre><code class="prism language-shell">docker network create --subnet<span class="token operator">=</span><span class="token number">172.10</span>.0.0/16 hadoop_net <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> docker network <span class="token function">ls</span>
</code></pre> 
<h5><a id="19__252"></a>1.9 自制系统镜像</h5> 
<p><strong>Dockerfile</strong></p> 
<pre><code class="prism language-shell">FROM docker.io/ansible/centos7-ansible
RUN yum -y <span class="token function">install</span> openssh-server
RUN yum -y <span class="token function">install</span> bind-utils
RUN yum -y <span class="token function">install</span> <span class="token function">which</span>
RUN yum -y <span class="token function">install</span> <span class="token function">sudo</span> 
</code></pre> 
<p>同级目录执行下面命令，生成centos7镜像</p> 
<pre><code class="prism language-shell">docker build -t centos7-cdh <span class="token builtin class-name">.</span>
</code></pre> 
<p><strong>解决警告Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</strong></p> 
<pre><code class="prism language-shell">yum makecache fast
</code></pre> 
<h5><a id="110__278"></a>1.10 启动容器</h5> 
<pre><code class="prism language-shell">docker run -d <span class="token punctuation">\</span>
--add-host cm.hadoop:172.10.0.2 <span class="token punctuation">\</span>
--net hadoop_net <span class="token punctuation">\</span>
--ip <span class="token number">172.10</span>.0.2 <span class="token punctuation">\</span>
-h cm.hadoop <span class="token punctuation">\</span>
-p <span class="token number">10022</span>:22 <span class="token punctuation">\</span>
-p <span class="token number">7180</span>:7180 <span class="token punctuation">\</span>
--restart always <span class="token punctuation">\</span>
--name cm.hadoop <span class="token punctuation">\</span>
--privileged <span class="token punctuation">\</span>
centos7-cdh <span class="token punctuation">\</span>
/usr/sbin/init <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> docker <span class="token function">ps</span>
</code></pre> 
<h4><a id="2_ClouderaManager_298"></a>2. 安装ClouderaManager</h4> 
<h5><a id="21_root_302"></a>2.1 创建容器并修改root密码</h5> 
<blockquote> 
 <p>进入第三步创建的容器中，并将root的登录密码改为root</p> 
</blockquote> 
<pre><code class="prism language-shell">docker <span class="token builtin class-name">exec</span> –it <span class="token punctuation">{<!-- --></span>dockerId<span class="token punctuation">}</span> /bin/bash
<span class="token function">su</span> root
<span class="token function">passwd</span>
root
root
</code></pre> 
<h5><a id="22__314"></a>2.2 安装基础环境</h5> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y kde-l10n-Chinese telnet reinstall glibc-common <span class="token function">vim</span> <span class="token function">wget</span> ntp net-tools <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all
</code></pre> 
<h5><a id="23__321"></a>2.3 配置中文环境</h5> 
<pre><code>(
cat &lt;&lt;EOF
export LC_ALL=zh_CN.utf8
export LANG=zh_CN.utf8
export LANGUAGE=zh_CN.utf8
EOF
) &gt;&gt; ~/.bashrc \
&amp;&amp; localedef -c -f UTF-8 -i zh_CN zh_CN.utf8 \
&amp;&amp; source ~/.bashrc \
&amp;&amp; echo $LANG
</code></pre> 
<h5><a id="24_NTP_338"></a>2.4 设置NTP时间同步</h5> 
<p><strong>配置文件</strong></p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> /etc/ntp.conf
</code></pre> 
<p><strong>添加配置</strong></p> 
<pre><code class="prism language-shell">server <span class="token number">0</span>.cn.pool.ntp.org
server <span class="token number">1</span>.cn.pool.ntp.org
server <span class="token number">2</span>.cn.pool.ntp.org       
server <span class="token number">3</span>.cn.pool.ntp.org
</code></pre> 
<p><strong>启动NTP服务</strong></p> 
<pre><code>systemctl start ntpd \
&amp;&amp; systemctl enable ntpd \
&amp;&amp; ntpdate -u 0.cn.pool.ntp.org \
&amp;&amp; hwclock --systohc \
&amp;&amp; date
</code></pre> 
<h5><a id="25_MySQL_367"></a>2.5 准备MySQL安装包</h5> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /root/hadoop_CHD/mysql <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/mysql/mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar <span class="token punctuation">\</span>
https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> /root/hadoop_CHD/mysql
</code></pre> 
<p>或</p> 
<pre><code># 离线下载安装包
docker cp mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar d1c71c8844be:/root/hadoop_CHD/mysql
</code></pre> 
<h5><a id="26_MySQL_385"></a>2.6 准备MySQL驱动</h5> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /root/hadoop_CHD/mysql-jdbc <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/mysql-jdbc/mysql-connector-java-5.1.48.tar.gz <span class="token punctuation">\</span>
https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.48.tar.gz <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> /root/hadoop_CHD/mysql-jdbc
</code></pre> 
<p>或</p> 
<pre><code># 离线下载安装包
docker cp mysql-connector-java-5.1.48.tar.gz d1c71c8844be:/root/hadoop_CHD/mysql
</code></pre> 
<h5><a id="27_CDH_403"></a>2.7 准备CDH安装包</h5> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /root/hadoop_CHD/cloudera-repos <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/allkeys.asc <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/allkeys.asc <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/cloudera-manager-agent-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/cloudera-manager-agent-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/cloudera-manager-daemons-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/cloudera-manager-daemons-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/cloudera-manager-server-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/cloudera-manager-server-db-2-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-db-2-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/enterprise-debuginfo-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/enterprise-debuginfo-6.3.0-1281944.el7.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/cloudera-repos/oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm <span class="token punctuation">\</span>
https://archive.cloudera.com/cm6/6.3.0/redhat7/yum/RPMS/x86_64/oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> ll /root/hadoop_CHD/cloudera-repos
</code></pre> 
<p>或</p> 
<pre><code class="prism language-shell">docker <span class="token function">cp</span> allkeys.asc d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> cloudera-manager-agent-6.3.0-1281944.el7.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> cloudera-manager-daemons-6.3.0-1281944.el7.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> cloudera-manager-server-6.3.0-1281944.el7.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> cloudera-manager-server-db-2-6.3.0-1281944.el7.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> enterprise-debuginfo-6.3.0-1281944.el7.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos
docker <span class="token function">cp</span> oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm d1c71c8844be:/root/hadoop_CHD/cloudera-repos 
</code></pre> 
<h5><a id="28_parcel_440"></a>2.8 准备parcel包</h5> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /root/hadoop_CHD/parcel <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/parcel/ CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel <span class="token punctuation">\</span>
https://archive.cloudera.com/cdh6/6.3.2/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O /root/hadoop_CHD/parcel/manifest.json <span class="token punctuation">\</span>
https://archive.cloudera.com/cdh6/6.3.2/parcels/manifest.json <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> ll /root/hadoop_CHD/parcel
</code></pre> 
<p>或</p> 
<pre><code class="prism language-sh">docker cp CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel d1c71c8844be:/root/hadoop_CHD/parcel
docker cp manifest.json d1c71c8844be:/root/hadoop_CHD/parcel
</code></pre> 
<h5><a id="29__460"></a>2.9 搭建本地源</h5> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> httpd createrepo <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl start httpd <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> httpd <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /root/hadoop_CHD/cloudera-repos/ <span class="token operator">&amp;&amp;</span> createrepo <span class="token builtin class-name">.</span> <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> /root/hadoop_CHD/cloudera-repos /var/www/html/ <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> ll /var/www/html/cloudera-repos
</code></pre> 
<h5><a id="210_jdk_474"></a>2.10 安装jdk</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /var/www/html/cloudera-repos/<span class="token punctuation">;</span><span class="token function">rpm</span> -ivh oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm
</code></pre> 
<h5><a id="211_MySQL_480"></a>2.11 安装MySQL</h5> 
<pre><code class="prism language-sh">cd /root/hadoop_CHD/mysql/;tar -xvf mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar \
&amp;&amp; yum install -y libaio numactl \
&amp;&amp; rpm -ivh mysql-community-common-5.7.27-1.el7.x86_64.rpm \
&amp;&amp; rpm -ivh mysql-community-libs-5.7.27-1.el7.x86_64.rpm \
&amp;&amp; rpm -ivh mysql-community-client-5.7.27-1.el7.x86_64.rpm \
&amp;&amp; rpm -ivh mysql-community-server-5.7.27-1.el7.x86_64.rpm \
&amp;&amp; rpm -ivh mysql-community-libs-compat-5.7.27-1.el7.x86_64.rpm \
&amp;&amp; echo character-set-server=utf8 &gt;&gt; /etc/my.cnf \
&amp;&amp; rm -rf /root/hadoop_CHD/mysql/ \
&amp;&amp; yum clean all \
&amp;&amp; rpm -qa |grep mysql
</code></pre> 
<h5><a id="212__496"></a>2.12 数据库授权</h5> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
set password for root@localhost = password('123456Aa.');
grant all privileges on *.* to 'root'@'%' identified by '123456Aa.';
flush privileges;
CREATE DATABASE scm DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE amon DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE rman DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE hue DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE metastore DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE sentry DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE nav DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE navms DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE oozie DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON scm.* TO 'scm'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON amon.* TO 'amon'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON rman.* TO 'rman'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON hue.* TO 'hue'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON metastore.* TO 'hive'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON sentry.* TO 'sentry'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON nav.* TO 'nav'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON navms.* TO 'navms'@'%' IDENTIFIED BY '123456Aa.';
GRANT ALL ON oozie.* TO 'oozie'@'%' IDENTIFIED BY '123456Aa.';
SHOW DATABASES;
EOF</span>
<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> /root/c.sql
</code></pre> 
<p><strong>获取MySQL初始密码</strong></p> 
<pre><code class="prism language-sh">systemctl start mysqld &amp;&amp; grep password /var/log/mysqld.log | sed 's/.*\(............\)$/\1/'
</code></pre> 
<p><strong>执行脚本</strong></p> 
<pre><code class="prism language-shell">mysql -uroot –p
</code></pre> 
<p><strong>执行</strong></p> 
<pre><code class="prism language-sql">source <span class="token operator">/</span>root<span class="token operator">/</span>c<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h5><a id="213_MySQL_547"></a>2.13 安装MySQL驱动</h5> 
<pre><code class="prism language-sh">mkdir -p /usr/share/java/ \
&amp;&amp; cd /root/hadoop_CHD/mysql-jdbc/;tar -zxvf mysql-connector-java-5.1.48.tar.gz \
&amp;&amp; cp  /root/hadoop_CHD/mysql-jdbc/mysql-connector-java-5.1.48/mysql-connector-java-5.1.48-bin.jar /usr/share/java/mysql-connector-java.jar \
&amp;&amp; rm -rf /root/hadoop_CHD/mysql-jdbc/ \
&amp;&amp; ls /usr/share/java/
</code></pre> 
<h5><a id="214_Cloudera_Manager_557"></a>2.14 安装Cloudera Manager</h5> 
<pre><code class="prism language-sh">(
cat &lt;&lt;EOF
[cloudera-manager]
name=Cloudera Manager 6.3.0
baseurl=http://172.10.0.2/cloudera-repos/
gpgcheck=0
enabled=1
EOF
) &gt;&gt; /etc/yum.repos.d/cloudera-manager.repo \
&amp;&amp; yum clean all \
&amp;&amp; yum makecache \
&amp;&amp; yum install -y cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server \
&amp;&amp; yum clean all \
&amp;&amp; rpm -qa | grep cloudera-manager
</code></pre> 
<h5><a id="215_parcel_576"></a>2.15 安装parcel</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /opt/cloudera/parcel-repo/<span class="token punctuation">;</span><span class="token function">mv</span> /root/hadoop_CHD/parcel/* ./ <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> sha1sum CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{ print <span class="token variable">$1</span> }'</span> <span class="token operator">&gt;</span> CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf /root/hadoop_CHD/parcel/ <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">chown</span> -R cloudera-scm:cloudera-scm /opt/cloudera/parcel-repo/* <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> ll /opt/cloudera/parcel-repo/
</code></pre> 
<h5><a id="216_scm_588"></a>2.16 初始化scm库</h5> 
<pre><code class="prism language-sh">/opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm 123456Aa.
</code></pre> 
<h5><a id="217_cloudera_manager_596"></a>2.17 启动cloudera manager服务</h5> 
<pre><code class="prism language-sh">systemctl start cloudera-scm-server \
&amp;&amp; sleep 2 \
&amp;&amp; tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log | grep "INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server"
</code></pre> 
<h4><a id="3_Woker_606"></a>3. 安装Woker节点</h4> 
<h5><a id="31_worker_610"></a>3.1 配置worker节点</h5> 
<p><strong>worker-1</strong></p> 
<pre><code>docker run -d \
--add-host cm.hadoop:172.10.0.2 \
--add-host cdh01.hadoop:172.10.0.3 \
--net hadoop_net \
--ip 172.10.0.3 \
-h cdh01.hadoop \
-p 20022:22 \
--restart always \
--name cdh01.hadoop \
--privileged \
centos7-cdh \
/usr/sbin/init \
&amp;&amp; docker ps
</code></pre> 
<p><strong>worker-2</strong></p> 
<pre><code>docker run -d \
--add-host cm.hadoop:172.10.0.2 \
--add-host cdh02.hadoop:172.10.0.4 \
--net hadoop_net \
--ip 172.10.0.4 \
-h cdh02.hadoop \
-p 30022:22 \
--restart always \
--name cdh02.hadoop \
--privileged \
centos7-cdh \
/usr/sbin/init \
&amp;&amp; docker ps
</code></pre> 
<h5><a id="32__648"></a>3.2 安装基本工具</h5> 
<h6><a id="321_worker_650"></a>3.2.1 修改worker容器密码</h6> 
<pre><code>docker exec –it {dockerId} /bin/bash
su root
passwd
root
root
</code></pre> 
<h6><a id="322__660"></a>3.2.2 安装工具</h6> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y kde-l10n-Chinese telnet reinstall glibc-common <span class="token function">vim</span> <span class="token function">wget</span> ntp net-tools <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> yum clean all
</code></pre> 
<h5><a id="32__669"></a>3.2 配置中文环境</h5> 
<pre><code>(
cat &lt;&lt;EOF
export LC_ALL=zh_CN.utf8
export LANG=zh_CN.utf8
export LANGUAGE=zh_CN.utf8
EOF
) &gt;&gt; ~/.bashrc \
&amp;&amp; localedef -c -f UTF-8 -i zh_CN zh_CN.utf8 \
&amp;&amp; source ~/.bashrc \
&amp;&amp; echo $LANG
</code></pre> 
<h5><a id="33_NTP_684"></a>3.3 设置NTP时间同步</h5> 
<p><strong>配置文件</strong></p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> /etc/ntp.conf
</code></pre> 
<p><strong>添加配置</strong></p> 
<pre><code class="prism language-shell">server <span class="token number">0</span>.cn.pool.ntp.org
server <span class="token number">1</span>.cn.pool.ntp.org
server <span class="token number">2</span>.cn.pool.ntp.org       
server <span class="token number">3</span>.cn.pool.ntp.org
</code></pre> 
<p><strong>启动NTP服务</strong></p> 
<pre><code>systemctl start ntpd \
&amp;&amp; systemctl enable ntpd \
&amp;&amp; ntpdate -u 0.cn.pool.ntp.org \
&amp;&amp; hwclock --systohc \
&amp;&amp; date
</code></pre> 
<h5><a id="34_MySQL_JDBC_713"></a>3.4 配置MySQL JDBC</h5> 
<pre><code>mkdir -p /usr/share/java/ \
&amp;&amp; wget -O /usr/share/java/mysql-connector-java-5.1.48.tar.gz \
https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.48.tar.gz \
&amp;&amp; cd /usr/share/java/;tar -zxvf mysql-connector-java-5.1.48.tar.gz \
&amp;&amp; cp /usr/share/java/mysql-connector-java-5.1.48/mysql-connector-java-5.1.48-bin.jar /usr/share/java/mysql-connector-java.jar \
&amp;&amp; rm -rf mysql-connector-java-5.1.48 mysql-connector-java-5.1.48.tar.gz \
&amp;&amp; ls /usr/share/java/
</code></pre> 
<h5><a id="35_CMhost_727"></a>3.5 修改CM主机的host文件</h5> 
<pre><code>echo "172.10.0.3      cdh01.hadoop cdh01" &gt;&gt; /etc/hosts
echo "172.10.0.4      cdh02.hadoop cdh02" &gt;&gt; /etc/hosts
</code></pre> 
<h5><a id="36__734"></a>3.6 安装客户端异常</h5> 
<blockquote> 
 <p>安装失败。 无法接收 Agent 发出的检测信号。请确保主机的名称已正确配置。请确保端口 7182 可在 Cloudera Manager Server 上访问（检查防火墙规则）。请确保正在添加的主机上的端口 9000 和 9001 空闲。检查正在添加的主机上 /var/log/cloudera-scm-agent/ 中的代理日志（某些日志可在安装详细信息中找到）。如果在 Cloudera Manager 中启用<strong>为代理使用 TLS 加密</strong>（管理 -&gt; 设置 -&gt; 安全），请确保 <code>/etc/cloudera-scm-agent/config.ini</code> 在正在添加的主机上有 <code>use_tls=1</code>。重启相应的代理，并单击此处的<strong>重试</strong>链接。</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 修改 /etc/cloudera-scm-agent/config.ini中use_tls为1</span>
<span class="token assign-left variable">use_tls</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31070e6b1e291f89443131215072be20/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2021年秋招面经分享·翱捷【ASIC设计工程师（成都）】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5738b0c03885afcc504b422d5d0c2a9a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C# 实现二维码详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>