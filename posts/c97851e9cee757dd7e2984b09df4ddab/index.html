<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VMware虚拟机扩展磁盘空间 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VMware虚拟机扩展磁盘空间" />
<meta property="og:description" content="在VMware虚拟机上使用Centos7，刚开始创建虚拟机时候磁盘空间设置小了，用久了发现虚拟机的磁盘空间不够了，可以通过以下步骤扩展磁盘空间。
1.先把虚拟机关机找到编辑虚拟机设置，操作如下 点击扩展后出现如下窗口
VMware会提示磁盘已成功扩展，您必须从客户机操作系统内部对磁盘重新进行分区和扩展文件系统。但是还没生效，需要在操作系统里面进行设置后才能使用。
2、启动操作系统Centos7，查看磁盘情况 输入指令
fdisk -l 找到如下文字
设备 Boot Start End Blocks Id System
/dev/sda1 * 2048 2099199 1048576 83 Linux
/dev/sda2 2099200 41943039 19921920 8e Linux LVM
目前是只有两个分区
3、创建第三个分区 输入指令
fdisk /dev/sda 出现如下情况
输入m查看帮助
可自行百度查翻译，我们注意看n那条，意思是添加新分区。我们输入n。
默认回车就行，出现如下代码时输入数字3
Partition number (3-4):3 # 输入3
后面的默认回车，最后输入w保存并退出
再次查看分区情况
fdisk -l 再次找到如下文字
设备 Boot Start End Blocks Id System
/dev/sda1 * 2048 2099199 1048576 83 Linux
/dev/sda2 2099200 41943039 19921920 8e Linux LVM" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c97851e9cee757dd7e2984b09df4ddab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-18T11:37:24+08:00" />
<meta property="article:modified_time" content="2023-08-18T11:37:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VMware虚拟机扩展磁盘空间</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在VMware虚拟机上使用Centos7，刚开始创建虚拟机时候磁盘空间设置小了，用久了发现虚拟机的磁盘空间不够了，可以通过以下步骤扩展磁盘空间。</p> 
<h6>1.先把虚拟机关机找到<strong>编辑虚拟机设置，操作如下</strong></h6> 
<p><strong><img alt="" src="https://images2.imgbox.com/c0/fa/gnsjpROs_o.png"></strong>点击扩展后出现如下窗口</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f4/9f/4pd1cURB_o.png"></p> 
<p> VMware会提示磁盘已成功扩展，您必须从客户机操作系统内部对磁盘重新进行分区和扩展文件系统。但是还没生效，需要在操作系统里面进行设置后才能使用。</p> 
<h6><strong>2、启动操作系统Centos7，查看磁盘情况</strong></h6> 
<p>输入指令</p> 
<pre><code>fdisk -l</code></pre> 
<p>  找到如下文字</p> 
<blockquote> 
 <p>设备 Boot      Start         End      Blocks   Id  System<br> /dev/sda1   *        2048     2099199     1048576   83  Linux<br> /dev/sda2         2099200    41943039    19921920   8e  Linux LVM</p> 
</blockquote> 
<p>目前是只有两个分区</p> 
<h6><strong>3、创建第三个分区</strong></h6> 
<p>输入指令</p> 
<pre><code>fdisk /dev/sda</code></pre> 
<p style="text-align:center;"> 出现如下情况</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/17/c2/RAU24enc_o.png"></p> 
<p> 输入m查看帮助</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e6/4c/XL4YIdqJ_o.png"></p> 
<p> 可自行百度查翻译，我们注意看n那条，意思是添加新分区。我们输入n。</p> 
<p>默认回车就行，出现如下代码时输入数字3</p> 
<blockquote> 
 <p> Partition number (3-4):3 # 输入3</p> 
</blockquote> 
<p>后面的默认回车，最后输入w保存并退出</p> 
<p>再次查看分区情况</p> 
<pre><code>fdisk -l</code></pre> 
<p>  再次找到如下文字</p> 
<blockquote> 
 <p>设备 Boot      Start         End      Blocks   Id  System<br> /dev/sda1   *        2048     2099199     1048576   83  Linux<br> /dev/sda2         2099200    41943039    19921920   8e  Linux LVM<br> /dev/sda3        41943040    83886079    20971520   83  Linux</p> 
</blockquote> 
<p>出现了分区sda3，就是刚刚创建的</p> 
<blockquote> 
 <p>输入reboot重启</p> 
</blockquote> 
<h6><strong>4.格式化新分区为ext3</strong></h6> 
<p>输入指令</p> 
<pre><code>mkfs -t ext3 /dev/sda3</code></pre> 
<h6> 5.<strong>将物理硬盘分区初始化为物理卷，以便被LVM使用，输入指令</strong></h6> 
<pre><code>lvs
pvcreate /dev/sda3</code></pre> 
<h6> 6.<strong>向卷组中添加物理卷来增加卷组的容量</strong></h6> 
<p>查看lvm组名，输入指令 df -h 如下</p> 
<blockquote> 
 <p>[root@root]# df -h<br> 文件系统                 容量  已用  可用 已用% 挂载点<br> devtmpfs                 1.2G     0  1.2G    0% /dev<br> /dev/mapper/centos-root   17G   15G  2.3G   87% /<br> /dev/sda1               1014M  185M  830M   19% /boot</p> 
</blockquote> 
<p>输入指令，增加卷组的容量，<span style="color:#fe2c24;">注意:</span><span style="color:#fe2c24;">centos-root </span>就是根所在的组名,自己是什么就填什么</p> 
<p><span style="color:#fe2c24;">接下来都会用到你自己的这个文件名</span></p> 
<pre><code>vgextend centos-root 1 /dev/sda3</code></pre> 
<h6><strong>7查看可扩展的空间大小</strong></h6> 
<p>输入指令，查看空间大小</p> 
<pre><code class="language-Go">vgdisplay</code></pre> 
<blockquote> 
 <p>找到如下文字  Free  PE / Size       5119 / &lt;20.00 GiB</p> 
</blockquote> 
<p>Free PE / Size 就是可供分配的自由空间，最多有 20G，你的扩展磁盘大小是多少就输入多少，在扩展时输入小于该值，不能超过这个值</p> 
<pre><code class="language-Go">lvextend -L+20G /dev/mapper/centos-root /dev/sda3 
#-L+20G是Free PE / Size里的数不能大于这个数值
#centos-root写自己的</code></pre> 
<p>如果出现大于就会出现如下</p> 
<blockquote> 
 <p>[root@hjl]# lvextend -L+20G /dev/mapper/centos-root /dev/sda3<br>   Insufficient free space: 5120 extents needed, but only 5119 available</p> 
</blockquote> 
<p>提示数值大了，把数值改成19.9就可以了</p> 
<h6><strong>8.使用resize2fs指令来增大或者收缩未加载的“ext2/ext3”文件系统的大小</strong></h6> 
<pre><code class="language-Go">resize2fs /dev/mapper/centos-root          #centos-root这个输入你自己的</code></pre> 
<p>可能有些人的会报错（没出错的不用看）</p> 
<blockquote> 
 <p>[root@hjl]# resize2fs /dev/mapper/centos-root;<br> resize2fs 1.42.9 (28-Dec-2013)<br> resize2fs: Bad magic number in super-block 当尝试打开 /dev/mapper/centos-root 时<br> 找不到有效的文件系统超级块.<br> 如果出现这个错误</p> 
</blockquote> 
<p> 解决方案</p> 
<p>首先，查看你的文件系统类型</p> 
<pre><code class="language-Go">mount |grep root</code></pre> 
<blockquote> 
 <p>找到如下</p> 
 <p> [root@hjl]# mount |grep root;<br> /dev/mapper/centos-root on /<span style="color:#fe2c24;"> type</span> <span style="color:#fe2c24;">xfs </span>(rw,relatime,seclabel,attr2,inode64,noquota)</p> 
 <p>我的类型是xfs</p> 
 <p style="margin-left:0;"><span style="color:#4d4d4d;"><span style="background-color:#ffffff;"><strong>resize2fs</strong> 命令 ：针对的是ext2、ext3、ext4文件系统</span></span></p> 
 <p style="margin-left:0;"><span style="color:#4d4d4d;"><span style="background-color:#ffffff;"><strong>xfs_growfs</strong> 命令 ：针对的是xfs文件系统</span></span></p> 
</blockquote> 
<p> 修改一下刚刚的指令</p> 
<pre><code class="language-Go">xfs_growfs /dev/mapper/centos-root;  #centos-root自己的
</code></pre> 
<h6>9.ok,完成了</h6> 
<p>输入df -h查看扩展结果</p> 
<p> [root@hjl]# df -h<br> 文件系统                 容量  已用  可用 已用% 挂载点<br> devtmpfs                 1.2G     0  1.2G    0% /dev<br> /dev/mapper/centos-root   37G   15G   23G   40% /<br> /dev/sda1               1014M  185M  830M   19% /boot</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad0e9c99a1139ebdc5a350538211aa59/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Tomcat启动闪退问题整理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d844b97f4ca19455694d2f4f2abf93a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1062：最高的分数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>