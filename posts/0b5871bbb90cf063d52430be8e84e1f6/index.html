<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DHCP原理与配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DHCP原理与配置" />
<meta property="og:description" content="一、DHCP概述 DHCP(Dynamic Host Configuration Protocol),动态主机配置协议，是一个应用层协议。当我们将客户主机ip地址设置为动态获取方式时，DHCP服务器就会根据DHCP协议给客户端分配IP，使得客户机能够利用这个IP上网。专门用于为TCP/IP网络中的计算机自动分配TCP/IP参数的协议。
1.使用DHCP的好处 减少管理员的工作量避免输入错误的可能性避免IP地址冲突当更改IP地址段时，不需要重新配置每个用户的IP地址提高了IP地址的利用率方便客户端的配置 2.DHCP的特点 DHCP可以自动分配IP、子网掩码、网关、DNS。DHCP客户端使用的端口68，服务端使用端口67，使用的UDP传输协议。DHCP分配的IP地址有租期，会周期性改变。一般不为服务器分配IP，因为他们要使用固定IP，所以DHCP一般只为办公环境的主机分配IP。DHCP服务器和客户端需要在一个局域网内，在为客户端分配IP的时候需要进行多次广播。但DHCP也可以为其他网段内主机分配IP，只要连接两个网段中间的路由器能转发DHCP配置请求即可，但这要求路由器配置中继功能。 二、DHCP工作原理 客户端广播发送DISCOVER报文寻找服务端；服务端广播发送OFFER报文响应给客户端，报文中还包含地址池中的一个可用IP；客户端只会接收第一个发来的OFFER报文并提取出可用IP,再向服务端广播发送REQUEST报文请求使用这个可用IP。服务端广播发送ACK报文响应给客户端，告知IP合法可用并提供租期信息。 重新登录
DHCP客户机每次重新登录网络时，不需要再发送Discover信息，而是直接发送包含前一次所分配的 IP地址的Request请求信息。 更新租约
当 DHCP服务器向客户机出租的 IP 地址租期达到 50%时，就需要更新租约。客户机直接向提供租约的服务器发送Request包，要求更新现有的地址租约。
IP地址分配顺序：从小到大
三、安装与配置DHCP vim /etc/dhcp/dhcpd.conf subnet 网段IP netmask 子网掩码 {	#声明要分配的网段地址 range IP地址池起始IP IP地址池终止IP;	#设置地址池 option routers 默认网关IP;	#指定默认网关地址 option domain-name-servers DNS服务器IP; #可选 default-lease-time 默认租期秒数; #可选 max-lease-time 最大租期秒数; #可选 } host 自定义名称 {	#指定需要分配固定 IP地址的客户机名称 hardware ethernet MAC地址用:分隔;	#指定该主机的 MAC地址 fixed-address IP地址;	#指定保留给该主机的 IP地址 } systemctl restart dhcpd 客户端主机设置自动获取IP Linux系统：网卡配置 BOOTPROTO=dhcp 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0b5871bbb90cf063d52430be8e84e1f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-17T19:46:25+08:00" />
<meta property="article:modified_time" content="2023-04-17T19:46:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DHCP原理与配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、DHCP概述</h2> 
<p><strong>DHCP</strong>(Dynamic Host  Configuration Protocol),动态主机配置协议，是一个<strong>应用层协议</strong>。当我们将客户主机ip地址设置为动态获取方式时，DHCP服务器就会根据DHCP协议给客户端分配IP，使得客户机能够利用这个IP上网。专门用于为TCP/IP网络中的计算机自动分配TCP/IP参数的协议。</p> 
<h3>1.使用DHCP的好处</h3> 
<ul><li>减少管理员的工作量</li><li>避免输入错误的可能性</li><li>避免IP地址冲突</li><li>当更改IP地址段时，不需要重新配置每个用户的IP地址</li><li>提高了IP地址的利用率</li><li>方便客户端的配置</li></ul> 
<h3>2.DHCP的特点</h3> 
<ul><li>DHCP可以自动分配IP、子网掩码、网关、DNS。</li><li><strong>DHCP客户端使用的端口68，服务端使用端口67，使用的UDP传输协议</strong>。</li><li>DHCP分配的IP地址有租期，会周期性改变。一般不为服务器分配IP，因为他们要使用固定IP，所以DHCP一般只为办公环境的主机分配IP。</li><li>DHCP服务器和客户端需要在一个局域网内，在为客户端分配IP的时候需要进行多次广播。但DHCP也可以为其他网段内主机分配IP，只要连接两个网段中间的路由器能转发DHCP配置请求即可，但这要求路由器配置中继功能。 </li></ul> 
<h2>二、DHCP工作原理</h2> 
<ol><li>客户端广播发送DISCOVER报文寻找服务端；</li><li>服务端广播发送OFFER报文响应给客户端，报文中还包含地址池中的一个可用IP；</li><li>客户端只会接收第一个发来的OFFER报文并提取出可用IP,再向服务端广播发送REQUEST报文请求使用这个可用IP。</li><li>服务端广播发送ACK报文响应给客户端，告知IP合法可用并提供租期信息。</li></ol> 
<p><strong>重新登录</strong><br> DHCP客户机每次重新登录网络时，不需要再发送Discover信息，而是直接发送包含前一次所分配的 IP地址的Request请求信息。 </p> 
<p><strong>更新租约</strong><br> 当 DHCP服务器向客户机出租的 IP 地址租期达到 50%时，就需要更新租约。客户机直接向提供租约的服务器发送Request包，要求更新现有的地址租约。</p> 
<p><strong>IP地址分配顺序：从小到大</strong></p> 
<p><img alt="" height="576" src="https://images2.imgbox.com/dd/f6/W8WFbnJi_o.png" width="809"></p> 
<h2>三、安装与配置DHCP</h2> 
<pre><code>vim /etc/dhcp/dhcpd.conf

subnet 网段IP netmask 子网掩码 {			      #声明要分配的网段地址
  range IP地址池起始IP  IP地址池终止IP;	      #设置地址池
  option routers 默认网关IP;					  #指定默认网关地址
  option domain-name-servers  DNS服务器IP;   #可选
  default-lease-time 默认租期秒数;             #可选
  max-lease-time 最大租期秒数;                 #可选
}

host 自定义名称 {							#指定需要分配固定 IP地址的客户机名称
  hardware ethernet MAC地址用:分隔;			#指定该主机的 MAC地址
  fixed-address IP地址;						#指定保留给该主机的 IP地址
}

systemctl restart dhcpd

客户端主机设置自动获取IP    Linux系统：网卡配置  BOOTPROTO=dhcp</code></pre> 
<h3>1.取消虚拟机dhcp服务 </h3> 
<h3><img alt="" height="735" src="https://images2.imgbox.com/7a/e6/Htc0bkHK_o.png" width="903"></h3> 
<p>首先打开虚拟机界面上方的编辑–虚拟网络编辑器，新建一个vmnet3，取消“使用本地DHCP服务将IP地址分配给虚拟机”这个选项，保存设置，应用退出。 </p> 
<p><img alt="" height="563" src="https://images2.imgbox.com/7d/80/RAIFfV05_o.png" width="835">  首先打开虚拟机界面上方的虚拟机-设置，点击网络适配器进行修改，然后确定退出。</p> 
<p></p> 
<h3> 2.编辑网卡信息</h3> 
<pre><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33  #配置静态IP
systemctl restart network                       #重启网卡
</code></pre> 
<p><img alt="" height="410" src="https://images2.imgbox.com/7d/a4/ySoRwyd6_o.png" width="1004"></p> 
<h3> 3.安装DHCP</h3> 
<pre><code>###为保证实验顺利，关闭防火墙和selinux
systemctl stop firewalld      #关闭防火墙
setenforce 0                  #关闭selinux

###安装dhcp
yum -y install dhcp

vim /etc/dhcp/dhcpd.conf      #打开dhcp配置文件

#
#DHCP Server configuration file.
#   see /usr/share/doc/dhcp*/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#

cp /usr/share/doc/dhcp*/dhcpd.conf.example /etc/dhcp/dhcpd.conf
#会看到该配置文件的路径在 /usr/share/doc/dhcp* 下，因此我们把该路径下的模板文件覆盖到 /etc/dhcp下
</code></pre> 
<h3>4.修改配置文件</h3> 
<pre><code>vim /etc/dhcp/dhcpd.conf

subnet 网段IP netmask 子网掩码 {			    #声明要分配的网段地址
  range IP地址池起始IP  IP地址池终止IP;		#设置地址池
  option routers 默认网关IP;					#指定默认网关地址
  option domain-name-servers  DNS服务器IP;    #可选
  default-lease-time 默认租期秒数;            #可选
  max-lease-time 最大租期秒数;                #可选
}


host 自定义名称 {							#指定需要分配固定 IP地址的客户机名称
  hardware ethernet MAC地址用:分隔;			#指定该主机的 MAC地址
  fixed-address IP地址;						#指定保留给该主机的 IP地址
}</code></pre> 
<p><img alt="" height="300" src="https://images2.imgbox.com/f9/8e/xLKJLTZR_o.png" width="1081"></p> 
<pre><code>systemctl start dhcpd  #启用DHCP服务

ss -lunp | grep 67     #查看DHCP服务，67是服务端使用的udp端口</code></pre> 
<p><img alt="" height="130" src="https://images2.imgbox.com/8f/ae/i5twq2RN_o.png" width="1200"></p> 
<h3>5.测试DHCP服务</h3> 
<p><img alt="" height="535" src="https://images2.imgbox.com/85/8f/pBTwdsij_o.png" width="838"></p> 
<p> 同上，将windows10网络适配器修改为vmnet3。</p> 
<h4>5.1打开windows系统的网络连接窗口</h4> 
<p><img alt="" height="451" src="https://images2.imgbox.com/03/a1/4PcIjiUt_o.png" width="733"></p> 
<h4>5.2 右击Ethernet0，点属性；选中（TCP/IPv4），点右下角的属性，选择自动获得IP地址，然后确定</h4> 
<p><img alt="" height="617" src="https://images2.imgbox.com/8f/a9/u9aOyPFe_o.png" width="577"></p> 
<p><img alt="" height="590" src="https://images2.imgbox.com/e3/c7/ogy0WGTm_o.png" width="509"></p> 
<h4>5.3进入cmd命令指示符</h4> 
<pre><code>ipconfig /release      #释放IP地址

ipconfig /renew        #重新获取IP地址</code></pre> 
<h4><img alt="" height="702" src="https://images2.imgbox.com/31/62/u3Ul8GVB_o.png" width="897"></h4> 
<p> <img alt="" height="621" src="https://images2.imgbox.com/65/45/qTmQde3d_o.png" width="485"></p> 
<p>可以看到，现在系统的IPv4地址变为了192.168.88.100；<br> 默认网关变为了192.168.88.254；<br> IPv4 DHCP服务器变为了192.168.88.10；<br> 均符合上述设置，证明DHCP部署成功。 </p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5d84bfeafc007b4c6ada427a554dda87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在ubuntu上安装gcc</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2aff5bba4e79b16a6ea8b65eb0818c69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CobaltStrike基础使用详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>