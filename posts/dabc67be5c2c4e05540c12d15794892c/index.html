<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JIT 与 C#热更 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JIT 与 C#热更" />
<meta property="og:description" content="JIT与AOT 一般程序运行有两种方式，静态编译与动态编译。 AOT: Ahead Of Time,预先（静态）编译 静态编译的程序，需要在执行之前全部翻译为机器码，运行前会使得程序安装时间相对较长，但程序运行的时候，性能和启动时间将会得到显著的优化，这种类型称为“AOT ”——提前编译。一般是用C/C&#43;&#43; 开发的应用。 JIT : Just-in-time, 动态（即时）编译 边解释边运行，可以根据当前硬件情况实时编译生成最优机器指令，也可以根据当前程序的运行情况生成最优的机器指令序列，但有时候会占用运行的资源，同时编译时间也会增加运行的时间，导致进程卡顿。一般是用 JavaScript 和 Python 的应用等。 所有脚本语言都支持 JIT 模式。但需要注意的是 JIT 和 AOT 指的是程序运行方式，和编程语言并非强关联的，有些语言既可以以 JIT 方式运行也可以以 AOT 方式运行，如 Java 、 Python 。 它们可以在第一次执行时编译成中间字节码、然后在之后执行时可以直接执行字节码，中间字节码并非机器码，在程序执行时仍然需要动态将字节码转为机器码，不过通常我们区分是否为 AOT 的标准就是看代码在执行之前是否需要编译，只要需要编译，无论其编译产物是字节码还是机器码，都属于 AOT 。 JIT 与热更新 为什么使用 Lua 作为热更新语言，不用 C# 热更新本身对于资源热更新是非常容易的，Unity 自带的 AB 包就可以轻松解决，难的是代码热更新，因为 Unity 中的 C# 是编译型语言， Unity 在打包后，会将 C# 编译成一种中间代码，再由 Mono 虚拟机编译成汇编代码供各个平台执行，它打包以后就变成了二进制了，会跟着程序同时启动，就无法进行任何修改了。 LUA 是解释型语言，并不需要事先编译成块，而是运行时动态解释执行的。这样 LUA 就和普通的游戏资源如图片，文本没有区别，因此可以在运行时直接从 WEB 服务器上下载到持久化目录并被其它 LUA 文件调用。 不用 C#热更的原因 准确的说，C# 在安卓上可以实现热更新，但在苹果上却不能。那 C# 为什么不做成解释型语言呢？因为 C# 的定位是一个追求效率且功能强大的编译型语言。在安卓上可以通过 C# 的语言特性 - 反射机制实现动态代码加载从而实现热更新。 具体做法是：将需要频繁更改的逻辑部分独立出来做成 DLL ，在主模块调用这些 DLL ，主模块代码是不修改的，只有作为业务（逻辑）模块的 DLL 部分需要修改。游戏运行时通过反射机制加载这些 DLL 就实现了热更新。 但苹果对反射机制有限制，不能实现这样的热更。为什么限制反射机制？安全起见，不能给程序太强的能力，因为反射机制实在太过强大，会给系统带来安全隐患。 解决：C#热更新 lLRuntime 项目为基于 C# 的平台 ( 例如 Unity) 提供了一个纯以实现， 快速、防便且可靠的 IL 运行时，使得能够在不支持 JIT 的硬件环境 ( 如iOS)能够实现代码的热更新。 编译原理：它把代码分为两个 dll 文件，启动的时候只启动一个，另一个 dll 通过反射启动，在没启动第二个热更的 dll ，将第一个 dll 文件替换掉。来达到一个热更的效果。 关于JIT" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/dabc67be5c2c4e05540c12d15794892c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-31T16:31:17+08:00" />
<meta property="article:modified_time" content="2023-07-31T16:31:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JIT 与 C#热更</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><strong style="color:#4f4f4f;font-size:22px;font-weight:bold;">JIT与AOT</strong></h4> 
<div> 
 <span style="color:#000000;">        一般程序运行有两种方式，<strong>静态编译</strong>与<strong>动态编译</strong>。 </span> 
</div> 
<h6><strong><span style="color:#000000;">     </span></strong><span style="color:#000000;">    AOT: Ahead Of Time,预先（静态）编译 </span></h6> 
<div> 
 <span style="color:#000000;">        静态编译的程序，需要在执行之前全部翻译为机器码，运行前会使得程序安装时间相对较长，但程序运行的时候，性能和启动时间将会得到显著的优化，这种类型称为“AOT</span> 
 <span style="color:#000000;">”——提前编译。一般是用C/C++ 开发的应用。 </span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;"><strong>        JIT : Just-in-time,</strong></span> 
 <strong><span style="color:#000000;">动态（即时）编译 </span></strong> 
</div> 
<div> 
 <span style="color:#000000;">        边解释边运行，可以根据当前硬件情况实时编译生成最优机器指令，也可以根据当前程序的运行情况生成最优的机器指令序列，但有时候会占用运行的资源，同时编译时间也会增加运行的时间，导致进程卡顿。一般是用 JavaScript </span> 
 <span style="color:#000000;">和 </span> 
 <span style="color:#000000;">Python </span> 
 <span style="color:#000000;">的应用等。</span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">        所有脚本语言都支持 </span> 
 <span style="color:#000000;">JIT </span> 
 <span style="color:#000000;">模式。但需要注意的是 </span> 
 <span style="color:#000000;">JIT </span> 
 <span style="color:#000000;">和 </span> 
 <span style="color:#000000;">AOT </span> 
 <span style="color:#000000;">指的是程序运行方式，和编程语言并非强关联的，有些语言既可以以 JIT </span> 
 <span style="color:#000000;">方式运行也可以以 AOT </span> 
 <span style="color:#000000;">方式运行，如 </span> 
 <span style="color:#000000;">Java</span> 
 <span style="color:#000000;">、</span> 
 <span style="color:#000000;">Python</span> 
 <span style="color:#000000;">。 </span> 
</div> 
<div> 
 <span style="color:#000000;">它们可以在第一次执行时编译成中间字节码、然后在之后执行时可以直接执行字节码，中间字节码并非机器码，在程序执行时仍然需要动态将字节码转为机器码，不过通常我们区分是否为 AOT </span> 
 <span style="color:#000000;">的标准就是看代码在执行之前是否需要编译，只要需要编译，无论其编译产物是字节码还是机器码，都属于 AOT</span> 
 <span style="color:#000000;">。 </span> 
</div> 
<div></div> 
<h4><a id="_10"></a><span style="color:#000000;"><strong>JIT 与热更新</strong></span></h4> 
<h6><span style="color:#000000;"><strong>        为什么使用 Lua </strong></span><span style="color:#000000;"><strong>作为热更新语言，不用 </strong></span><span style="color:#000000;"><strong>C#</strong></span></h6> 
<div> 
 <span style="color:#000000;">        热更新本身对于资源热更新是非常容易的，Unity </span> 
 <span style="color:#000000;">自带的 </span> 
 <span style="color:#000000;">AB </span> 
 <span style="color:#000000;">包就可以轻松解决，难的是代码热更新，因为 Unity </span> 
 <span style="color:#000000;">中的 </span> 
 <span style="color:#000000;">C#</span> 
 <span style="color:#000000;">是编译型语言， Unity 在打包后，会将 </span> 
 <span style="color:#000000;">C#</span> 
 <span style="color:#000000;">编译成一种中间代码，再由 </span> 
 <span style="color:#000000;">Mono </span> 
 <span style="color:#000000;">虚拟机编译成汇编代码供各个平台执行，它打包以后就变成了二进制了，会跟着程序同时启动，就无法进行任何修改了。 </span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">        LUA 是解释型语言，并不需要事先编译成块，而是运行时动态解释执行的。这样 LUA </span> 
 <span style="color:#000000;">就和普通的游戏资源如图片，文本没有区别，因此可以在运行时直接从 WEB </span> 
 <span style="color:#000000;">服务器上下载到持久化目录并被其它</span> 
 <span style="color:#000000;">LUA </span> 
 <span style="color:#000000;">文件调用。</span> 
</div> 
<div></div> 
<h6><a id="_16"></a><span style="color:#000000;"><strong>        不用 C#</strong></span><span style="color:#000000;"><strong>热更的原因</strong></span></h6> 
<div> 
 <span style="color:#000000;">        准确的说，C#</span> 
 <span style="color:#000000;">在安卓上可以实现热更新，但在苹果上却不能。那 C#</span> 
 <span style="color:#000000;">为什么不做成解释型语言呢？因为 </span> 
 <span style="color:#000000;">C#</span> 
 <span style="color:#000000;">的定位是一个追求效率且功能强大的编译型语言。在安卓上可以通过 C#</span> 
 <span style="color:#000000;">的语言特性</span> 
 <span style="color:#000000;">-</span> 
 <span style="color:#000000;">反射机制实现动态代码加载从而实现热更新。 </span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">        具体做法是：将需要频繁更改的逻辑部分独立出来做成 DLL</span> 
 <span style="color:#000000;">，在主模块调用这些 DLL</span> 
 <span style="color:#000000;">，主模块代码是不修改的，只有作为业务（逻辑）模块的 DLL </span> 
 <span style="color:#000000;">部分需要修改。游戏运行时通过反射机制加载这些 </span> 
 <span style="color:#000000;">DLL </span> 
 <span style="color:#000000;">就实现了热更新。 </span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">        但苹果对反射机制有限制，不能实现这样的热更。为什么限制反射机制？安全起见，不能给程序太强的能力，因为反射机制实在太过强大，会给系统带来安全隐患。</span> 
</div> 
<div></div> 
<h4><a id="_27"></a><span style="color:#000000;"><strong>解决：C#</strong></span><span style="color:#000000;"><strong>热更新</strong></span></h4> 
<div> 
 <span style="color:#000000;">        lLRuntime 项目为基于 </span> 
 <span style="color:#000000;">C#</span> 
 <span style="color:#000000;">的平台</span> 
 <span style="color:#000000;">(</span> 
 <span style="color:#000000;">例如 </span> 
 <span style="color:#000000;">Unity)</span> 
 <span style="color:#000000;">提供了一个纯以实现， 快速、防便且可靠的 IL </span> 
 <span style="color:#000000;">运行时，使得能够在不支持 </span> 
 <span style="color:#000000;">JIT </span> 
 <span style="color:#000000;">的硬件环境</span> 
 <span style="color:#000000;">(</span> 
 <span style="color:#000000;">如iOS)能够实现代码的热更新。 </span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">        编译原理：它把代码分为两个 dll </span> 
 <span style="color:#000000;">文件，启动的时候只启动一个，另一个 dll </span> 
 <span style="color:#000000;">通过反射启动，在没启动第二个热更的 </span> 
 <span style="color:#000000;">dll</span> 
 <span style="color:#000000;">，将第一个 </span> 
 <span style="color:#000000;">dll 文件替换掉。来达到一个热更的效果。</span> 
</div> 
<h3><a id="_34"></a> </h3> 
<p><strong>关于JIT</strong></p> 
<p><span style="color:#000000;">mono 的 </span><span style="color:#000000;">JIT </span><span style="color:#000000;">编译器目录 </span><span style="color:#000000;">mini </span><span style="color:#000000;">下的 </span><span style="color:#000000;">mini.c </span><span style="color:#000000;">文件 </span></p> 
<div> 
 <img alt="" height="262" src="https://images2.imgbox.com/6c/2f/qeb9WAqs_o.png" width="749"> 
 <span style="color:#000000;"> </span> 
</div> 
<div> 
 <span style="color:#000000;">        设定 mono </span> 
 <span style="color:#000000;">的编译模式为 </span> 
 <span style="color:#000000;">full-aot</span> 
 <span style="color:#000000;">（比如打 </span> 
 <span style="color:#000000;">IOS </span> 
 <span style="color:#000000;">安装包的时候），则在运行时试图使用 JIT 编译时，</span> 
 <span style="color:#000000;">mono </span> 
 <span style="color:#000000;">自身的 </span> 
 <span style="color:#000000;">JIT </span> 
 <span style="color:#000000;">编译器就会禁止这种行为进而报告这个异常。JIT </span> 
 <span style="color:#000000;">编译的过程根本还没开始，就被自己扼杀了。</span> 
</div> 
<div></div> 
<div>
  学习链接： 
 <span style="color:#0000ff;">https://www.cnblogs.com/murongxiaopifu/p/4278947.html</span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6998821409593d04f8a20aef6a22593a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浅谈Vue3 computed计算属性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65b59e781999f72c6907d0721e8ed09d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python解决-力扣001-两数之和</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>