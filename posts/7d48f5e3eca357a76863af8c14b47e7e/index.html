<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GAN生成手写数字（TensorFlow，Mnist数据集） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GAN生成手写数字（TensorFlow，Mnist数据集）" />
<meta property="og:description" content="目录 1.项目数据及源码2.GAN介绍3.设计网络并训练3.1.定义训练参数3.2.构建判别器和生成器3.3.构建模型3.4.查看mnist数据集图片3.5.进行训练 4.显示结果 1.项目数据及源码 可在github下载：
https://github.com/chenshunpeng/Handwritten-numeral-generation-based-on-GAN
2.GAN介绍 参考自：传送门
先介绍一下生成模型（Generative model）与判别模型（Discriminative mode）的概念：
生成模型：对联合概率进行建模，从统计的角度表示数据的分布情况，刻画数据是如何生成的，收敛速度快，例如朴素贝叶斯，GDA，HMM等判别模型：对条件概率 P ( Y ∣ X ) P(Y|X) P(Y∣X)进行建模，不关心数据如何生成，主要是寻找不同类别之间的最优分类面，例如LR，SVM等 判别模型在深度学习乃至机器学习领域取得了巨大成功，其本质是将样本的特征向量映射成对应的label；而生成模型由于需要大量的先验知识去对真实世界进行建模，且先验分布的选择直接影响模型的性能，因此此前人们更多关注于判别模型方法
生成式对抗网络（Generative Adversarial Networks，GAN）是蒙特利尔大学的Goodfellow Ian于2014年提出的一种生成模型， 在之后引起了业内人士的广泛关注与研究
GAN中包含了两个模型，一个是生成模型 G G G ，另一个是判别模型 D D D ，下面通过一个生成图片的例子来解释两个模型的作用：
生成模型 G G G ：不断学习训练集中真实数据的概率分布，目标是将输入的随机噪声转化为可以以假乱真的图片（生成的图片与训练集中的图片越相似越好）判别模型 D D D ：判断一个图片是否是真实的图片，目标是将生成模型 G G G 产生的“假”图片与训练集中的“真”图片分辨开 GAN的实现方法是让 D D D 和 G G G 进行博弈，训练过程中通过相互竞争让这两个模型同时得到增强。由于判别模型 D D D 的存在，使得 G G G 在没有大量先验知识以及先验分布的前提下也能很好的去学习逼近真实数据，并最终让模型生成的数据达到以假乱真的效果（即 D D D 无法区分 G G G 生成的图片与真实图片，从而 G G G 和 D D D 达到某种纳什均衡）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7d48f5e3eca357a76863af8c14b47e7e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-29T23:03:00+08:00" />
<meta property="article:modified_time" content="2022-08-29T23:03:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GAN生成手写数字（TensorFlow，Mnist数据集）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_2" rel="nofollow">1.项目数据及源码</a></li><li><a href="#2GAN_6" rel="nofollow">2.GAN介绍</a></li><li><a href="#3_29" rel="nofollow">3.设计网络并训练</a></li><li><ul><li><a href="#31_30" rel="nofollow">3.1.定义训练参数</a></li><li><a href="#32_60" rel="nofollow">3.2.构建判别器和生成器</a></li><li><a href="#33_133" rel="nofollow">3.3.构建模型</a></li><li><a href="#34mnist_161" rel="nofollow">3.4.查看mnist数据集图片</a></li><li><a href="#35_179" rel="nofollow">3.5.进行训练</a></li></ul> 
  </li><li><a href="#4_279" rel="nofollow">4.显示结果</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_2"></a>1.项目数据及源码</h2> 
<p>可在github下载：</p> 
<p><a href="https://github.com/chenshunpeng/Handwritten-numeral-generation-based-on-GAN">https://github.com/chenshunpeng/Handwritten-numeral-generation-based-on-GAN</a></p> 
<h2><a id="2GAN_6"></a>2.GAN介绍</h2> 
<p>参考自：<a href="https://blog.csdn.net/u010089444/article/details/78946039?spm=1001.2101.3001.6650.3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-78946039-blog-107080145.pc_relevant_multi_platform_featuressortv2dupreplace">传送门</a></p> 
<p>先介绍一下生成模型（Generative model）与判别模型（Discriminative mode）的概念：</p> 
<ul><li>生成模型：<strong>对联合概率进行建模</strong>，从统计的角度表示数据的分布情况，刻画数据是如何生成的，收敛速度快，例如朴素贝叶斯，GDA，HMM等</li><li>判别模型：对条件概率<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
          ( 
         
        
          Y 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
       
         P(Y|X) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span></span></span></span></span>进行建模，<strong>不关心数据如何生成</strong>，主要是寻找不同类别之间的最优分类面，例如LR，SVM等</li></ul> 
<p><strong>判别模型</strong>在深度学习乃至机器学习领域取得了巨大成功，其本质是将样本的特征向量映射成对应的label；而<strong>生成模型</strong>由于需要大量的先验知识去对真实世界进行建模，且先验分布的选择直接影响模型的性能，因此此前人们更多关注于判别模型方法</p> 
<p>生成式对抗网络（Generative Adversarial Networks，GAN）是蒙特利尔大学的Goodfellow Ian于2014年提出的一种<strong>生成模型</strong>， 在之后引起了业内人士的广泛关注与研究</p> 
<p>GAN中包含了两个模型，一个是生成模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> ，另一个是判别模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         D 
        
       
      
        D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> ，下面通过一个生成图片的例子来解释两个模型的作用：</p> 
<ul><li>生成模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
       
         G 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> ：不断学习训练集中真实数据的概率分布，<strong>目标是将输入的随机噪声转化为可以以假乱真的图片</strong>（生成的图片与训练集中的图片越相似越好）</li><li>判别模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
       
         D 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> ：判断一个图片是否是真实的图片，<strong>目标是将生成模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           G 
          
         
        
          G 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> 产生的“假”图片与训练集中的“真”图片分辨开</strong></li></ul> 
<p>GAN的实现方法是让 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         D 
        
       
      
        D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> 进行博弈，训练过程中通过相互竞争让这两个模型同时得到增强。由于判别模型 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         D 
        
       
      
        D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> 的存在，使得 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> <strong>在没有大量先验知识以及先验分布的前提下也能很好的去学习逼近真实数据</strong>，并最终让模型生成的数据达到以假乱真的效果（即 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         D 
        
       
      
        D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> 无法区分 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> 生成的图片与真实图片，从而 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         D 
        
       
      
        D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span> 达到某种纳什均衡）</p> 
<p>示意图如下：</p> 
<p><img src="https://images2.imgbox.com/1f/21/DD1Y7Ldd_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_29"></a>3.设计网络并训练</h2> 
<h3><a id="31_30"></a>3.1.定义训练参数</h3> 
<p>设置GPU环境</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

gpus <span class="token operator">=</span> tf<span class="token punctuation">.</span>config<span class="token punctuation">.</span>list_physical_devices<span class="token punctuation">(</span><span class="token string">"GPU"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> gpus<span class="token punctuation">:</span>
    tf<span class="token punctuation">.</span>config<span class="token punctuation">.</span>experimental<span class="token punctuation">.</span>set_memory_growth<span class="token punctuation">(</span>gpus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment">#设置GPU显存用量按需使用</span>
    tf<span class="token punctuation">.</span>config<span class="token punctuation">.</span>set_visible_devices<span class="token punctuation">(</span><span class="token punctuation">[</span>gpus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"GPU"</span><span class="token punctuation">)</span>
    
<span class="token comment"># 打印显卡信息，确认GPU可用</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gpus<span class="token punctuation">)</span>
</code></pre> 
<p><strong>设置参数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> datasets<span class="token punctuation">,</span> Sequential<span class="token punctuation">,</span> Model<span class="token punctuation">,</span> optimizers
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> LeakyReLU<span class="token punctuation">,</span> UpSampling2D<span class="token punctuation">,</span> Conv2D

<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy             <span class="token keyword">as</span> np
<span class="token keyword">import</span> sys<span class="token punctuation">,</span>os<span class="token punctuation">,</span>pathlib

<span class="token comment"># 定义图像大小(28, 28, 1)，输入噪声大小200*1</span>
img_shape  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
latent_dim <span class="token operator">=</span> <span class="token number">200</span>
</code></pre> 
<h3><a id="32_60"></a>3.2.构建判别器和生成器</h3> 
<p>构建生成器，输入一串随机数字，之后生成图片</p> 
<p>整个tf.layer.dense()参数如下：</p> 
<p>注意定义第一层的时候需要制定数据输入的形状，即<code>input_dim</code>，这样才能让数据正常传进网络</p> 
<pre><code class="prism language-python"> dense<span class="token punctuation">(</span>
    inputs<span class="token punctuation">,</span>  <span class="token comment">#tf.layers.dense 的Tensor输入，该层的输入</span>
    units<span class="token punctuation">,</span>   <span class="token comment">#整数或长整数，输出空间的维数，输出的大小（维数），整数或long</span>
    activation<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token comment">#激活功能（可调用），将其设置为“None”以保持线性激活</span>
    use_bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token comment">#Boolean，表示该层是否使用偏差；使用bias为True（默认使用），不用bias改成False即可</span>
    kernel_initializer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token comment">#权重矩阵的初始化函数；如果为None（默认），则使用tf.get_variable</span>
    bias_initializer<span class="token operator">=</span>tf<span class="token punctuation">.</span>zeros_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#偏置的初始化函数</span>
    kernel_regularizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token comment">#权重矩阵的正则化函数</span>
    bias_regularizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token comment">#正规函数的偏差</span>
    activity_regularizer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token comment">#输出的正则化函数</span>
    trainable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token comment">#Boolean，如果为True，还将变量添加到图集合</span>
    name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token comment">#String，图层的名称；具有相同名称的图层将共享权重，但为了避免错误，在这种情况下，我们需要reuse=True</span>
    reuse<span class="token operator">=</span><span class="token boolean">None</span><span class="token comment">#Boolean，是否以同一名称重用前一层的权重</span>
<span class="token punctuation">)</span>
</code></pre> 
<p><code>np.prod()</code>函数用来计算所有元素的乘积，对于有多个维度的数组可以指定轴（如axis=1指定计算每一行的乘积）</p> 
<p>代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">build_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> input_dim<span class="token operator">=</span>latent_dim<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 全连接层，节点大小是256</span>
        layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token comment"># 激活函数</span>
        layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span>momentum<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 归一化</span>
        
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span>momentum<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span>momentum<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span>np<span class="token punctuation">.</span>prod<span class="token punctuation">(</span>img_shape<span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'tanh'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>Reshape<span class="token punctuation">(</span>img_shape<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    noise <span class="token operator">=</span> layers<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>latent_dim<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 输入的初始图层</span>
    img <span class="token operator">=</span> model<span class="token punctuation">(</span>noise<span class="token punctuation">)</span>

    <span class="token keyword">return</span> Model<span class="token punctuation">(</span>noise<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
</code></pre> 
<p>构建判别器，判别输入图片的真假</p> 
<p><code>keras.layers.Flatten()</code>用于将输入层的数据压成一维的数据，一般用在卷积层和全连接层之间（因为全连接层只能接收一维数据，而卷积层可以处理二维数据，就是全连接层处理的是向量，而卷积层处理的是矩阵），在这里把<code>(28, 28, 1)</code>压缩成<code>(784, 1)</code></p> 
<p>代码</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">build_discriminator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
        layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span>input_shape<span class="token operator">=</span>img_shape<span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    img <span class="token operator">=</span> layers<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span>img_shape<span class="token punctuation">)</span>
    validity <span class="token operator">=</span> model<span class="token punctuation">(</span>img<span class="token punctuation">)</span>

    <span class="token keyword">return</span> Model<span class="token punctuation">(</span>img<span class="token punctuation">,</span> validity<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="33_133"></a>3.3.构建模型</h3> 
<pre><code class="prism language-python"><span class="token comment"># 创建判别器</span>
discriminator <span class="token operator">=</span> build_discriminator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 定义优化器</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">1e-4</span><span class="token punctuation">)</span>
discriminator<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span>
                      optimizer<span class="token operator">=</span>optimizer<span class="token punctuation">,</span>
                      metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 创建生成器 </span>
generator <span class="token operator">=</span> build_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>
gan_input <span class="token operator">=</span> layers<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>latent_dim<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> generator<span class="token punctuation">(</span>gan_input<span class="token punctuation">)</span>

<span class="token comment"># 在训练generate的时候不训练discriminator</span>
discriminator<span class="token punctuation">.</span>trainable <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token comment"># 对生成的假图片进行预测</span>
validity <span class="token operator">=</span> discriminator<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
combined <span class="token operator">=</span> Model<span class="token punctuation">(</span>gan_input<span class="token punctuation">,</span> validity<span class="token punctuation">)</span>
combined<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span>optimizer<span class="token punctuation">)</span>
</code></pre> 
<p>查看参数类型：</p> 
<p><img src="https://images2.imgbox.com/f2/72/a46YAtWR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34mnist_161"></a>3.4.查看mnist数据集图片</h3> 
<p>本例判别器是以<strong>mnist数据集</strong>为模板的，其加载方法可看：<a href="https://vimsky.com/examples/usage/python-tf.keras.datasets.mnist.load_data-tf.html" rel="nofollow">Pythontf.keras.datasets.mnist.load_data用法及代码示例<br> </a><br> <code>tf.keras.datasets.mnist.load_data()</code>的返回值是NumPy数组元组：<code>(x_train, y_train), (x_test, y_test)</code></p> 
<pre><code class="prism language-python"><span class="token punctuation">(</span>train_images1<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

pyplot<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>train_images1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_images1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<p><img src="https://images2.imgbox.com/67/29/pVqaJABy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35_179"></a>3.5.进行训练</h3> 
<p>定义保存样例图片的函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">sample_images</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    保存样例图片
    """</span>
    row<span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span>
    noise <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token operator">*</span>col<span class="token punctuation">,</span> latent_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
    gen_imgs <span class="token operator">=</span> generator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>noise<span class="token punctuation">)</span>

    fig<span class="token punctuation">,</span> axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span><span class="token punctuation">:</span>
            axs<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>gen_imgs<span class="token punctuation">[</span>cnt<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
            axs<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
            cnt <span class="token operator">+=</span> <span class="token number">1</span>
    fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">"images/%05d.png"</span> <span class="token operator">%</span> epoch<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>定义训练函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> sample_interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 加载数据</span>
    <span class="token comment"># 文件位置：C:\Users\HP ZBook15\.keras\datasets</span>
    <span class="token punctuation">(</span>train_images<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 将图片标准化到 [-1, 1] 区间内   </span>
    train_images <span class="token operator">=</span> <span class="token punctuation">(</span>train_images <span class="token operator">-</span> <span class="token number">127.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">127.5</span>
    <span class="token comment"># 数据</span>
    train_images <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建标签</span>
    true <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fake <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 进行循环训练</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span> 

        <span class="token comment"># 随机选择 batch_size 张图片</span>
        idx <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> train_images<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span>
        imgs <span class="token operator">=</span> train_images<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>      
        
        <span class="token comment"># 生成噪音</span>
        noise <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> latent_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 生成器通过噪音生成图片，gen_imgs的shape为：(128, 28, 28, 1)</span>
        gen_imgs <span class="token operator">=</span> generator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>noise<span class="token punctuation">)</span>
        
        <span class="token comment"># 训练鉴别器 </span>
        d_loss_true <span class="token operator">=</span> discriminator<span class="token punctuation">.</span>train_on_batch<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> true<span class="token punctuation">)</span>
        d_loss_fake <span class="token operator">=</span> discriminator<span class="token punctuation">.</span>train_on_batch<span class="token punctuation">(</span>gen_imgs<span class="token punctuation">,</span> fake<span class="token punctuation">)</span>
        <span class="token comment"># 返回loss值</span>
        d_loss <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>add<span class="token punctuation">(</span>d_loss_true<span class="token punctuation">,</span> d_loss_fake<span class="token punctuation">)</span>

        <span class="token comment"># 训练生成器</span>
        noise <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> latent_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        g_loss <span class="token operator">=</span> combined<span class="token punctuation">.</span>train_on_batch<span class="token punctuation">(</span>noise<span class="token punctuation">,</span> true<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%d [D loss: %f, acc.: %.2f%%] [G loss: %f]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> d_loss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token operator">*</span>d_loss<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> g_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 保存样例图片</span>
        <span class="token keyword">if</span> epoch <span class="token operator">%</span> sample_interval <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            sample_images<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>
</code></pre> 
<p>进行训练：</p> 
<pre><code class="prism language-python">train<span class="token punctuation">(</span>epochs<span class="token operator">=</span><span class="token number">50000</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> sample_interval<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-python"><span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 1s 3ms<span class="token operator">/</span>step
<span class="token number">0</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.564433</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">55.57</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.615958</span><span class="token punctuation">]</span>
<span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 87ms<span class="token operator">/</span>step
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">1</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.428365</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">61.04</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.601898</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">2</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.390525</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">64.84</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.629429</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">3</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.376864</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">69.53</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.637371</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">4</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.368233</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">70.31</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.672757</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">5</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.353537</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">74.02</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.707676</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">49995</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.703495</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">51.46</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.787212</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">49996</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.684776</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">57.23</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.798816</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">49997</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.706813</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">50.78</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.793404</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">49998</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.703113</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">50.10</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.774067</span><span class="token punctuation">]</span>
<span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 0s 2ms<span class="token operator">/</span>step
<span class="token number">49999</span> <span class="token punctuation">[</span>D loss<span class="token punctuation">:</span> <span class="token number">0.694413</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token number">53.81</span><span class="token operator">%</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>G loss<span class="token punctuation">:</span> <span class="token number">0.783364</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="4_279"></a>4.显示结果</h2> 
<p>绘制动图：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> imageio

<span class="token keyword">def</span> <span class="token function">compose_gif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 图片地址</span>
    data_dir <span class="token operator">=</span> <span class="token string">r"E:\demo_study\jupyter\Jupyter_notebook\Handwritten-numeral-generation-based-on-GAN\images"</span>
    data_dir <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span>
    paths    <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    k <span class="token operator">=</span> <span class="token number">0</span>
    gif_images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> path <span class="token keyword">in</span> paths<span class="token punctuation">:</span>
<span class="token comment">#         print(path)</span>
        k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span> k<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            gif_images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>imageio<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    imageio<span class="token punctuation">.</span>mimsave<span class="token punctuation">(</span><span class="token string">"test.gif"</span><span class="token punctuation">,</span>gif_images<span class="token punctuation">,</span>fps<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    
compose_gif<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果：</p> 
<p><img src="https://images2.imgbox.com/21/51/7rZo0cdh_o.gif" alt="在这里插入图片描述"></p> 
<p>后期比较清晰的图片：</p> 
<p><img src="https://images2.imgbox.com/0e/94/qDVNSMrL_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/95/d2/qTLqMHG1_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f25744bd82f0c0bdb846238df07546f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CNN进行猫狗识别（PyTorch）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/88ee84a6b6cfc272e649a44927a9b800/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">docker-java实现镜像管理的基本操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>