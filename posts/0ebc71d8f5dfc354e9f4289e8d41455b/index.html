<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>cocos creator制作微信抖音小游戏《黄金矿工》 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="cocos creator制作微信抖音小游戏《黄金矿工》" />
<meta property="og:description" content="微信小游戏，抖音小游戏，非常适合个人开发者创业，不用版号，门槛低，同时抖音小游戏的系统算法推荐，能让好的游戏脱颖而出, 你要做的就是把游戏做好就可以了。
这个系列的文章，配套了视频教程讲解与课程资源,课程源码。下面开始讲解黄金矿工的具体制作流程。
这里有个cocos creator学习交流小组点击可以直接加入，一起学习交流吧
1:开发工具的基本使用
教程的开发工具选用cocos creator, 开发语言选用TypeScript。首先我们创建项目，导入素材，素材如图:
项目路径不要使用中文和空格，使用英文或英文缩写，项目工程里面的目录结构要清晰，在Assets下面我们分成Res, Scene, Scripts,。
2: 搭建《黄金矿工》游戏场景
一般做一个2D游戏，我们会把一个游戏的场景分成下面几个层次:
a: 游戏背景层 b: 游戏地图层 c: 角色物品层, d: 游戏UI层,我们按照这个层次，把黄金矿工的游戏地图分类进行放好，如图:
BackGound: 背景层,
LogicMap: 逻辑地图层，黄金矿工还有什么地图呢？主要是要把边缘表示出来, 我们使用了碰撞检测系统， 所以把边缘堵上墙，作为我们的逻辑地图，也就是加Box碰撞器，如图:
GoldRoot 黄金物品的跟节点，所有的黄金生成出来后都放这个根节点下。
Player: 游戏主角，就是我们的矿工的绳子和钩子。这个制作的时候一个技巧，主角是由绳子，和绳子断点上的金属圆环组成。
Player的原点在绳子的一头，所以绳子作为Player的孩子，锚点要为[0.5, 1], 绳子的长度可能会变化，我们修改body的高度就可以让绳子有变化。比如绳子长度为200，我们把body这个节点的高度改成200，即可
金属探测圆环，我们命名为header, header 的位置是与绳子的高度相关的，在最下面，我们观察一下坐标，
得到一个结果, header的坐标: -(绳子长度 &#43; 10)。
UIRoot层：用来放我们用户的UI操作相关。
场景搭建就此搭建完毕。
3: Type Script代码开发
Step1: 新建一个组件类，被引擎识别, 这个非常简单，直接右键新建一个TS脚本即可
Step2: new 组件实例，到场景的节点上。这个有两种方式，可以编辑器添加组按钮来添加, 可以代码addComponent(类型)添加, 本质 new 组件类的实例添加到节点上。
Step3: 游戏引擎特定时期，调用特定的入口， 我们写代码如果没有人调用是不值钱的，所以必须要让引擎调用到，引擎会在特定的时期，调用我们特定的入口，我们只要往特定的入口插入代码即可，开始运行之前调用 组件实例.start();每次刷新的时候调用组件实例.update(),等这些规定的接口。引擎通过运行场景，找到场景的节点，找到节点上组件实例，来获得组件实例，这也就是组件实例为什么一定要添加到节点上就是这个原因。
4: TypeScript 代码模板介绍:
cc: cocos creator;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0ebc71d8f5dfc354e9f4289e8d41455b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-12T10:04:41+08:00" />
<meta property="article:modified_time" content="2021-08-12T10:04:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">cocos creator制作微信抖音小游戏《黄金矿工》</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>微信小游戏，抖音小游戏，非常适合个人开发者创业，不用版号，门槛低，同时抖音小游戏的系统算法推荐，能让好的游戏脱颖而出, 你要做的就是把游戏做好就可以了。</p> 
<p></p> 
<p>这个系列的文章，配套了视频教程讲解与课程资源,课程源码。下面开始讲解黄金矿工的具体制作流程。</p> 
<p>这里有个<strong><a href="https://jq.qq.com/?_wv=1027&amp;k=jDWaqQYw" rel="nofollow">cocos creator学习交流小组</a></strong>点击可以直接加入，一起学习交流吧</p> 
<p><strong>1:开发工具的基本使用</strong></p> 
<p>教程的开发工具选用cocos creator, 开发语言选用TypeScript。首先我们创建项目，导入素材，素材如图:</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/73/be/Klq1s6YB_o.png" width="482"></p> 
<p></p> 
<p>项目路径不要使用中文和空格，使用英文或英文缩写，项目工程里面的目录结构要清晰，在Assets下面我们分成Res, Scene, Scripts,。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/44/d5/zMGSkOLt_o.png" width="232"></p> 
<p></p> 
<p></p> 
<p><strong>2: 搭建《黄金矿工》游戏场景</strong></p> 
<p>一般做一个2D游戏，我们会把一个游戏的场景分成下面几个层次:</p> 
<p>a: 游戏背景层 b: 游戏地图层 c: 角色物品层, d: 游戏UI层,我们按照这个层次，把黄金矿工的游戏地图分类进行放好，如图:</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/14/0e/kD8X1EIO_o.png" width="915"></p> 
<p></p> 
<p>BackGound: 背景层,</p> 
<p>LogicMap: 逻辑地图层，黄金矿工还有什么地图呢？主要是要把边缘表示出来, 我们使用了碰撞检测系统， 所以把边缘堵上墙，作为我们的逻辑地图，也就是加Box碰撞器，如图:</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d0/a7/hPtShxtS_o.png" width="482"></p> 
<p></p> 
<p>GoldRoot 黄金物品的跟节点，所有的黄金生成出来后都放这个根节点下。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7b/f3/jfUBrgTU_o.png" width="562"></p> 
<p></p> 
<p>Player: 游戏主角，就是我们的矿工的绳子和钩子。这个制作的时候一个技巧，主角是由绳子，和绳子断点上的金属圆环组成。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d7/ef/puJVpiG2_o.png" width="733"></p> 
<p></p> 
<p>Player的原点在绳子的一头，所以绳子作为Player的孩子，锚点要为[0.5, 1], 绳子的长度可能会变化，我们修改body的高度就可以让绳子有变化。比如绳子长度为200，我们把body这个节点的高度改成200，即可</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c9/56/Pa0lZLMp_o.png" width="398"></p> 
<p>金属探测圆环，我们命名为header, header 的位置是与绳子的高度相关的，在最下面，我们观察一下坐标，</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/53/68/FzG0nnNo_o.png" width="417"></p> 
<p></p> 
<p>得到一个结果, header的坐标: -(绳子长度 + 10)。</p> 
<p></p> 
<p>UIRoot层：用来放我们用户的UI操作相关。</p> 
<p>场景搭建就此搭建完毕。</p> 
<p></p> 
<p><strong>3: Type Script代码开发</strong></p> 
<p>Step1: 新建一个组件类，被引擎识别, 这个非常简单，直接右键新建一个TS脚本即可</p> 
<p>Step2: new 组件实例，到场景的节点上。这个有两种方式，可以编辑器添加组按钮来添加, 可以代码addComponent(类型)添加, 本质 new 组件类的实例添加到节点上。</p> 
<p>Step3: 游戏引擎特定时期，调用特定的入口， 我们写代码如果没有人调用是不值钱的，所以必须要让引擎调用到，引擎会在特定的时期，调用我们特定的入口，我们只要往特定的入口插入代码即可，开始运行之前调用 组件实例.start();每次刷新的时候调用组件实例.update(),等这些规定的接口。引擎通过运行场景，找到场景的节点，找到节点上组件实例，来获得组件实例，这也就是组件实例为什么一定要添加到节点上就是这个原因。</p> 
<p></p> 
<p></p> 
<p><strong>4: TypeScript 代码模板介绍:</strong></p> 
<p>cc: cocos creator;</p> 
<p>cc._decorator: 名字空间，定义了装饰器/注解</p> 
<p>ccclass: 装饰/注解 一个类是一个组件类; property: 装饰/注解 一个类的数据成员 绑定到编辑器;</p> 
<p>@开头表示装饰注解</p> 
<p>cc.Component: 组件类的基类;</p> 
<p>export default: 外部要使用这个类，import default 来获取这个类型;</p> 
<p>@ccclass</p> 
<p>export default class GameMgr extends cc.Component {<!-- --></p> 
<p>// 权限 名字: 类型 = 默认值;</p> 
<p>@property</p> 
<p>private isDebug: boolean = false;</p> 
<p>}</p> 
<p><strong>5: 黄金矿工核心思路分析</strong></p> 
<p>黄金矿工游戏玩法中，要碰到黄金等物品，还有要碰到边缘等物品，所以我们要利用碰撞检测系统来做碰撞检测。</p> 
<p>Setp1: 开启碰撞检测, 分为两个步骤，代码如下:</p> 
<p>// 开启碰撞检测，一定要在onLoad里面</p> 
<p>onLoad () {<!-- --></p> 
<p></p> 
<p>// step1: 开启碰撞检测系统, 默认是关闭;</p> 
<p>cc.director.getCollisionManager().enabled = true;</p> 
<p></p> 
<p>// step2: 配置调试区域, debugDraw</p> 
<p>if(this.is_debug) {<!-- --></p> 
<p>cc.director.getCollisionManager().enabledDebugDraw = true;</p> 
<p>}</p> 
<p>else {<!-- --></p> 
<p>cc.director.getCollisionManager().enabledDebugDraw = false;</p> 
<p>}</p> 
<p>}</p> 
<p></p> 
<p>Step2: 编辑碰撞区域。</p> 
<p>黄金需要编辑碰撞区域，游戏地图的3个边需要编辑碰撞区域, 矿工的圆形金属探测器需要添加碰撞器。</p> 
<p></p> 
<p>Step3: 类型配置与碰撞关系配置。</p> 
<p>这个案例里面我们把物体分成了类型有：边缘(BORD), 黄金Gold, 探测器Header。分别设置好对应节点的类型。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/df/96/eV55KONL_o.png" width="396"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/98/6d/1psiG6T5_o.png" width="408"></p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/38/1c/StwwnHvk_o.png" width="396"></p> 
<p></p> 
<p></p> 
<p>Step4: 碰撞检测，我们让金属探测器Header来做碰撞，碰撞检测记住一点，那个碰撞器检测碰撞，就把碰撞检测的代码挂到那个碰撞器对应的节点上，所以新建一个代码来做碰撞检测，实现碰撞检测的函数入口</p> 
<p>const {ccclass, property} = cc._decorator;</p> 
<p>@ccclass</p> 
<p>export default class HeaderCtrl extends cc.Component {<!-- --></p> 
<p>onCollisionEnter(other, self): void {<!-- --></p> 
<p>}</p> 
<p>}</p> 
<p></p> 
<p>Step5：配置好碰撞关系,哪些类型与哪些类型碰撞，如图</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c4/6b/vxOcuh01_o.png" width="563"></p> 
<p></p> 
<p></p> 
<p></p> 
<p>黄金矿工会有多个游戏状态，我们这里将其进行分类:</p> 
<p>状体1: 我们的钩子摆来摆去; ---&gt;Idle</p> 
<p>状态2: 我们的钩子发射出去 ---&gt; Shoot</p> 
<p>状态3: 碰到边缘我们就弹回来; ---&gt; Back</p> 
<p>状态4: 如果状态的是黄金我们就把黄金拖回来; BackWithGold</p> 
<p>如果还有其他的状态，你也可以定义好, 我们编写一个GameMgr代码，管理整个游戏，在这个代码里面定义好状态：</p> 
<p>var State = {<!-- --></p> 
<p>Idle: 0,</p> 
<p>Shoot: 1,</p> 
<p>Back: 2,</p> 
<p>BackWithGold: 3,</p> 
<p>};</p> 
<p>状态定义完成以后，我们分析一下状态变化的条件，整理如下:</p> 
<p>状态1---》状态2: (用户点击了屏幕)</p> 
<p>状态2---》状态3：(钩子撞到了边缘)</p> 
<p>状态2----》状态4（碰到的是黄金）</p> 
<p>状态3/状态4 ---》状态1： 绳子拖回来以后，我们便回到状态1</p> 
<p></p> 
<p>每个状态的动画，我们编写一个函数，用来实现如下图，在update里面:</p> 
<p></p> 
<p></p> 
<p></p> 
<p>// 1===============1===============1===============1=======dt========1</p> 
<p>// dt: 迭代，100 * dt</p> 
<p>update(dt: number): void {<!-- --></p> 
<p>if(this.state === State.Idle) {<!-- --></p> 
<p>this.idleUpdate(dt);</p> 
<p>return;</p> 
<p>}</p> 
<p>else if (this.state === State.Shoot) {<!-- --></p> 
<p>this.shootUpdate(dt);</p> 
<p>return;</p> 
<p>}</p> 
<p>else if(this.state === State.Back) {<!-- --></p> 
<p>this.backUpdate(dt);</p> 
<p>return;</p> 
<p>}</p> 
<p>else if (this.state == State.BackWithGold) {<!-- --></p> 
<p>this.balckWithGoldUpdate(dt);</p> 
<p>return;</p> 
<p>}</p> 
<p>}</p> 
<p>把状态显示的接口完成后，接下来编写状态改变条件。</p> 
<p>用户点击屏幕，idle-Shoot状态，代码如图:</p> 
<p></p> 
<p>this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);</p> 
<p></p> 
<p></p> 
<p>private onTouchStart(): void {<!-- --></p> 
<p>if (this.state !== State.Idle) {<!-- --></p> 
<p>return;</p> 
<p>}</p> 
<p></p> 
<p>this.state = State.Shoot;</p> 
<p>}</p> 
<p>状态改变的代码一定要加一个逻辑，就是当前状态的判断。</p> 
<p>碰到物体后，状态改变，所以，当金属圆圈，检测到碰撞的时候，调用GameMgr的接口，进入判断检测函数。</p> 
<p>HeaderCtrl.ts 在碰撞函数里面添加</p> 
<p>GameMgr.Instance.onGameCollisionEnter(other, self);</p> 
<p></p> 
<p>GameMgr.ts里面实现:</p> 
<p>public onGameCollisionEnter(other, self): void {<!-- --></p> 
<p>if (this.state !== State.Shoot) {<!-- --></p> 
<p>return;</p> 
<p>}</p> 
<p></p> 
<p>if (other.node.groupIndex === 2) { // 边缘</p> 
<p>this.state = State.Back;</p> 
<p>}</p> 
<p>else if (other.node.groupIndex === 3) { // 黄金</p> 
<p>this.state = State.BackWithGold;</p> 
<p>}</p> 
<p>}</p> 
<p></p> 
<p></p> 
<p>状态迁移改变完成了以后，我们就是实现每种状态的动画了，这里我重点要介绍一个函数，</p> 
<p>private setRopeLen(len: number): void {<!-- --></p> 
<p>this.ropeBody.height = len;</p> 
<p>this.header.y = -(len + 10);</p> 
<p>}</p> 
<p>这个函数，可以修改绳子的长度，这样，等绳子抛出去，与拖回来都可以用。</p> 
<p></p> 
<p>状态迁移逻辑框架实现后，最后我们来往每种状态里面加代码。</p> 
<p>Idle:</p> 
<p>定义一个角速度，定义当前角度，update不断累加，如果超过左边，就转变方向</p> 
<p>如果超过右边，也换个方向到左边。</p> 
<p>private idleUpdate(dt: number): void {<!-- --></p> 
<p>this.nowDegree += (this.wSpeed * dt);</p> 
<p>this.player.angle = this.nowDegree;</p> 
<p>if (this.nowDegree &lt;= -60) {<!-- --></p> 
<p>this.wSpeed = -this.wSpeed;</p> 
<p>}</p> 
<p>else if(this.nowDegree &gt;= 60) {<!-- --></p> 
<p>this.wSpeed = -this.wSpeed;</p> 
<p>}</p> 
<p>}</p> 
<p></p> 
<p>Shoot:</p> 
<p>定一个绳子生长的速度，每次update, 绳子长度变化(速度*时间)</p> 
<p>private shootUpdate(dt: number): void {<!-- --></p> 
<p>this.nowLen += (this.shootSpeed * dt);</p> 
<p>this.setRopeLen(this.nowLen);</p> 
<p>}</p> 
<p></p> 
<p>Back:</p> 
<p>碰到边缘返回，直接把绳子的长度，由Shoot的变长，变成变短，所以是减。</p> 
<p>private backUpdate(dt: number): void {<!-- --></p> 
<p>this.nowLen -= (this.shootSpeed * dt);</p> 
<p>if (this.nowLen &lt;= 100) {<!-- --></p> 
<p>this.nowLen = 100;</p> 
<p>this.state = State.Idle;</p> 
<p>}</p> 
<p>this.setRopeLen(this.nowLen);</p> 
<p>}</p> 
<p></p> 
<p>BackWithGold:</p> 
<p>勾上黄金的状态，我就留给大家自己来写了。</p> 
<p>private balckWithGoldUpdate(dt: number): void {<!-- --></p> 
<p></p> 
<p>}</p> 
<p></p> 
<p></p> 
<p>这样就实现了黄金矿工的核心玩法。本次课除了有文字，还配备有 完整视频教程，游戏素材，课程代码，需要的可以进入交流小组。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/049c07fbc1bdec2846553d114cfb929b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mc屠龙后服务器显示,我的世界：玩家前往末地屠龙，却一无所获，返回家时才知道闯祸了...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/63e54c1d811303166f08e4ea53d86973/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">wcf服务器 性能差,WCF：无法让我的Web服务工作，在服务器上</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>