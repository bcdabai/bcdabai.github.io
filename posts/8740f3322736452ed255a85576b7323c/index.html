<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【案例】【技术难点（已解决）】vue 线上项目访问本地资源 访问不到、跨域等问题的解决方法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【案例】【技术难点（已解决）】vue 线上项目访问本地资源 访问不到、跨域等问题的解决方法" />
<meta property="og:description" content="需求 在访问线上项目，从访问的电脑本地获取资源。
真正需求就是要访问本地多个视频已打包好的项目中播放并循环播放
实现 环境 项目打包上线 对于项目如何打包上线，这里笔者就不多说啦，因为会遇到这个需求的肯定会布署项目
前后端分离：前端项目布署到服务器
nginx部署vue项目：多个项目、相同的端口下
nginx部署多个vue项目，不同端口号下
给需要访问的电脑安装nginx 下载nginx http://nginx.org/en/download.html
2. 安装这里就不说了
安装完成后，创建一个video文件夹，创建一个num.txt，写入视频的数量就可以了，其和视频资源都在video文件夹中 listen 8888; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location /video/ { add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;; add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;; add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET, POST, OPTIONS&#39;; add_header Access-Control-Allow-Headers &#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#39;; if ($request_method = &#39;OPTIONS&#39;) { return 204; } alias D:/nginx/video/; #视频资源存放的路径 autoindex on; } location / { root html; index index.html index.htm; } 代码 video_url是为了动态获取访问地址；
autoplay表示视频准备好就播放；
controls 视频控制按钮；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8740f3322736452ed255a85576b7323c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-22T19:00:00+08:00" />
<meta property="article:modified_time" content="2022-08-22T19:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【案例】【技术难点（已解决）】vue 线上项目访问本地资源 访问不到、跨域等问题的解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>需求</h4> 
<p>在访问线上项目，从访问的电脑本地获取资源。<br> 真正需求就是要访问本地多个视频已打包好的项目中播放并循环播放</p> 
<h4><a id="_3"></a>实现</h4> 
<h5><a id="_4"></a>环境</h5> 
<h6><a id="_6"></a>项目打包上线</h6> 
<p>对于项目如何打包上线，这里笔者就不多说啦，因为会遇到这个需求的肯定会布署项目<br> <a href="https://blog.csdn.net/weixin_45527702/article/details/114095696?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166115031816781790742813%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=166115031816781790742813&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-114095696-null-null.nonecase&amp;utm_term=%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2&amp;spm=1018.2226.3001.4450">前后端分离：前端项目布署到服务器</a><br> <a href="https://blog.csdn.net/weixin_45527702/article/details/118653005?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166115031816781790742813%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=166115031816781790742813&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-118653005-null-null.nonecase&amp;utm_term=%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2&amp;spm=1018.2226.3001.4450">nginx部署vue项目：多个项目、相同的端口下</a><br> <a href="https://blog.csdn.net/weixin_45527702/article/details/119002526?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166115031816781790742813%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=166115031816781790742813&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-3-119002526-null-null.nonecase&amp;utm_term=%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2&amp;spm=1018.2226.3001.4450">nginx部署多个vue项目，不同端口号下</a></p> 
<h6><a id="nginx_11"></a>给需要访问的电脑安装nginx</h6> 
<ol><li>下载nginx <a href="http://nginx.org/en/download.html" rel="nofollow">http://nginx.org/en/download.html</a><br> <img src="https://images2.imgbox.com/36/22/Y9gurEVw_o.png" alt="在这里插入图片描述">2. 安装这里就不说了<br> 安装完成后，创建一个video文件夹，创建一个num.txt，写入视频的数量就可以了，其和视频资源都在video文件夹中</li></ol> 
<pre><code class="prism language-javascript"> listen       <span class="token number">8888</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        #charset koi8<span class="token operator">-</span>r<span class="token punctuation">;</span>

        #access_log  logs<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>
        location <span class="token operator">/</span>video<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            add_header <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
            add_header <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
            add_header <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span><span class="token punctuation">;</span>
            add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Headers <span class="token string">'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>$request_method <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token keyword">return</span> <span class="token number">204</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            alias <span class="token constant">D</span><span class="token operator">:</span><span class="token operator">/</span>nginx<span class="token operator">/</span>video<span class="token operator">/</span><span class="token punctuation">;</span>   #视频资源存放的路径
            autoindex on<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            root   html<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_42"></a>代码</h5> 
<p>video_url是为了动态获取访问地址；<br> autoplay表示视频准备好就播放；<br> controls 视频控制按钮；<br> muted 静音；<br> loop 循环播放；<br> 更详细的video标签属性介绍：https://www.runoob.com/tags/tag-video.html<br> 这里为啥我没有用loop后面代码中说明到</p> 
<pre><code class="prism language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video_url<span class="token punctuation">"</span></span>  <span class="token attr-name">preload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span>meddle<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">controls</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">muted</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">watch_video_file</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//视频，这里i设置一个默认值1</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript">
<span class="token function">watch_video_file</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   <span class="token comment">//多个视频连续播放，并播放完成后，重头播放</span>
      <span class="token keyword">var</span> video_num <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token comment">//组装访问本地视频的接口</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video_url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:****/video/'</span><span class="token operator">+</span> i <span class="token operator">+</span><span class="token string">'.mp4'</span>  
        <span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当视频播放完成后，从第0秒开始播放</span>
        <span class="token keyword">function</span> <span class="token function">setCurTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            video<span class="token punctuation">.</span>currentTime<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//当一个视频播放完成后，i发生变化，地址发生变化，变为2，当i等于video_num时，i就有等于1，相当于从头播放</span>
        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'ended'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">Number</span><span class="token punctuation">(</span>video_num<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Number</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            i <span class="token operator">=</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            i<span class="token operator">++</span>
          <span class="token punctuation">}</span>
          <span class="token function">setCurTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video_url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:****/video/'</span><span class="token operator">+</span> i <span class="token operator">+</span><span class="token string">'.mp4'</span>
        
          video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>video_url<span class="token punctuation">;</span>
          video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过获取num.txt的值赋给video_num</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:****/video/num.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        video_num <span class="token operator">=</span> res<span class="token punctuation">.</span>data
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//这里就实现了多个视频的依次播放和循环播放</span>
</code></pre> 
<h5><a id="_95"></a>过程中遇到的问题及如何解决</h5> 
<ul><li> <p>本地localhost+指定端口,本地浏览器访问不到<br> 原因本地的nginx没有启动成功</p> </li><li> <p>nginx启动成功，但访问不到资源<br> 访问的路径对不对；<br> nginx.conf中的指定存放资源的路径是否正确；</p> </li><li> <p>前面两个都没问题，就是项目访问不到<br> （这里问题困扰了笔者好几天，还请教了朋友，就是找不到问题，这是为啥呢，因为有两台电脑都可以线上项目可以访问到本地资源，视频可以正常跑，但其余的都不行，他哥的，我就不信了，周末休假都在这是那的问题，一步一步的排查，回想，想到是有可能是啥问题后就立马回公司去调试，还是不行，成功的和不成功的配置过程中操作有哪些不同，忽然笔者想到了，就又回公司试试了，成功，此时还不确定是这个问题，周一用其它电脑试了试，确认是浏览器的问题，因为随着浏览器的版本更新，浏览器中默认设置了不允许私密访问，这是为了安全考虑的），说了这么多告诉你解决方案，其实很简单<br> <code>打开谷歌浏览器搜索Chrome://flags 找到 Block insecure private network requests. 修改为disabled</code>就好了<br> <img src="https://images2.imgbox.com/be/8c/FuyZuBR1_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h5><a id="_109"></a>本文重点</h5> 
<p>红色字体</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e0804501b9767ae30b97f5d6a477a7e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">type 和 interface区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/222fae16baf64717239a9c15a73b7b9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;类和对象的声明、解析、使用（构造、析构函数、友元、命名空间）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>