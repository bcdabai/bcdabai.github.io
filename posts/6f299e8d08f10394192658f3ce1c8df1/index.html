<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ansible的简介及部署 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ansible的简介及部署" />
<meta property="og:description" content="1. ansible简介 1.1 什么是ansible
ansible是一款开源自动化平台，是一个配置管理工具，自动化运维工具
1.2 ansible的优点
跨平台支持人类可读自动化: ansible提供linux，Windows，unix和网络设备的无代理支持，适用于物理、虚拟、云和容器环境完美描述应用：playbook轻松管理版本控制：playbook是纯文本，可视作源代码支持动态清单编排可与其他系统轻松集成：puppet、jenkins基础架构即代码减少人为错误 运行playbook时，如果目标主机处于正确状态，则不会进行任何更改。
1.3 安装ansible
1. 在虚拟机上安装ansible，充当控制节点
yum install -y ansible 2. 查看ansible版本信息
ansible --version 3. 使用setup模块验证python
ansible localhost -m setup | grep python_version 2. 部署ansible 2.1 构建ansible清单
清单：定义了ansible将要管理的一批主机 2.1.1. 静态清单
注：如果填写的是主机名，请确保可以解析主机名（/etc/hosts）
每行一个，填写主机名或ip，如：
还可以定义主机组：
注：一台主机可以存在于多个主机组&#39;
2.1.2 定义嵌套组
ansible主机清单可以包含多个主机组构成的组，如：
2.1.3 通过范围简化主机规格
可以指定主机名称或ip范围或者数字和字母范围
2.1.4 验证清单
ansible all --list-hosts 2.1.5 默认清单位置
/etc/ansible/hosts #一般不使用，而是自己新建 2.1.6 动态清单
可以从开源社区的脚本中获取
练习：
列出清单中所有受管主机
ansible all --list-hosts 列出不属于某个组的主机
ansible ungrouped --list-hosts 列出属于webservers组的主机" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f299e8d08f10394192658f3ce1c8df1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-26T12:30:13+08:00" />
<meta property="article:modified_time" content="2020-04-26T12:30:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ansible的简介及部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1. ansible简介</h3> 
<p><strong>1.1 什么是ansible</strong></p> 
<p>ansible是一款开源自动化平台，是一个配置管理工具，自动化运维工具</p> 
<p><strong>1.2 ansible的优点</strong></p> 
<ol><li>跨平台支持</li><li>人类可读自动化: ansible提供linux，Windows，unix和网络设备的无代理支持，适用于物理、虚拟、云和容器环境</li><li>完美描述应用：playbook</li><li>轻松管理版本控制：playbook是纯文本，可视作源代码</li><li>支持动态清单</li><li>编排可与其他系统轻松集成：puppet、jenkins</li><li>基础架构即代码</li><li>减少人为错误</li></ol> 
<p>运行playbook时，如果目标主机处于正确状态，则不会进行任何更改。</p> 
<p><strong>1.3 安装ansible</strong><br> 1. 在虚拟机上安装ansible，充当控制节点</p> 
<pre><code class="language-bash">yum install -y ansible</code></pre> 
<p>2. 查看ansible版本信息</p> 
<pre><code class="language-bash">ansible --version</code></pre> 
<p> <img alt="" height="189" src="https://images2.imgbox.com/89/a6/DvLX4xnE_o.png" width="742"></p> 
<p>3. 使用setup模块验证python</p> 
<pre><code class="language-bash">ansible localhost -m setup | grep python_version</code></pre> 
<p><img alt="" height="71" src="https://images2.imgbox.com/24/ab/JdRbZYqb_o.png" width="742"></p> 
<p> </p> 
<h3>2. 部署ansible</h3> 
<p><strong>2.1 构建ansible清单</strong></p> 
<ul><li>清单：定义了ansible将要管理的一批主机</li></ul> 
<p>2.1.1. 静态清单</p> 
<p>注：如果填写的是主机名，请确保可以解析主机名（/etc/hosts）</p> 
<p><img alt="" height="226" src="https://images2.imgbox.com/dc/44/Ik4qMaAz_o.png" width="740"></p> 
<p>每行一个，填写主机名或ip，如：</p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/21/ab/BuiNormZ_o.png" width="739"></p> 
<p>还可以定义主机组：</p> 
<p><img alt="" height="179" src="https://images2.imgbox.com/30/75/LVVuj4Bn_o.png" width="740"></p> 
<p>注：一台主机可以存在于多个主机组'</p> 
<p>2.1.2 定义嵌套组</p> 
<p>ansible主机清单可以包含多个主机组构成的组，如：</p> 
<p><img alt="" height="310" src="https://images2.imgbox.com/90/0e/dHlzTqT0_o.png" width="738"></p> 
<p>2.1.3 通过范围简化主机规格</p> 
<p>可以指定主机名称或ip范围或者数字和字母范围</p> 
<p><img alt="" height="156" src="https://images2.imgbox.com/b4/13/sfoFNS1Y_o.png" width="726"></p> 
<p><br> 2.1.4 验证清单</p> 
<pre><code class="language-bash">ansible all --list-hosts</code></pre> 
<p><img alt="" height="157" src="https://images2.imgbox.com/a8/6b/9FItwlKD_o.png" width="749"></p> 
<p>2.1.5 默认清单位置</p> 
<ul><li>/etc/ansible/hosts    #一般不使用，而是自己新建</li></ul> 
<p>2.1.6 动态清单</p> 
<p>可以从开源社区的脚本中获取</p> 
<p>练习：</p> 
<p>列出清单中所有受管主机</p> 
<pre><code class="language-bash">ansible all --list-hosts</code></pre> 
<p>列出不属于某个组的主机</p> 
<pre><code class="language-bash">ansible ungrouped --list-hosts</code></pre> 
<p> <img alt="" height="60" src="https://images2.imgbox.com/56/91/ro3CVXFS_o.png" width="733"></p> 
<p>列出属于webservers组的主机</p> 
<pre><code class="language-bash">ansible dbservers --list-hosts</code></pre> 
<p><img alt="" height="107" src="https://images2.imgbox.com/03/3a/IvwdMrul_o.png" width="755"></p> 
<p> </p> 
<p>自定义清单</p> 
<pre><code class="language-bash">mkdir demo    #建立目录</code></pre> 
<p>列出主机</p> 
<p><img alt="" height="301" src="https://images2.imgbox.com/67/a0/8hbINO62_o.png" width="749"></p> 
<p><img alt="" height="335" src="https://images2.imgbox.com/b7/f4/HcCPqpYA_o.png" width="747"></p> 
<p><br><strong>2.2 管理ansible配置文件</strong></p> 
<p>2.2.1 配置ansible</p> 
<p>配置文件：</p> 
<ol><li>/etc/ansible/ansible.cfg    #基本配置文件，如果找不到其他配置文件，使用这个</li><li>~/.ansible.cfg        #如果存在此文件且当前工作目录中没有ansible.cfg，此文件替代/etc/ansible/ansible.cfg</li><li>./ansible.cfg        #当前目录中的ansible.cfg，优先级最高</li></ol> 
<p><br> 显示使用的配置文件</p> 
<pre><code class="language-bash">ansible dbservers --list-hosts -v</code></pre> 
<p><img alt="" height="123" src="https://images2.imgbox.com/ad/77/UTbhHSkH_o.png" width="753"></p> 
<p>管理配置文件中的设置：</p> 
<ul><li>[defaults]        #部分设置ansible操作的默认值</li><li>[privilege_escalation]    #配置ansible如何在受管主机上执行特权升级</li></ul> 
<p>例：</p> 
<pre><code class="language-bash">vim ansible.cfg</code></pre> 
<p><img alt="" height="492" src="https://images2.imgbox.com/e3/fc/6lV3Ml6n_o.png" width="749"></p> 
<p><br> 注：如果登录的不是root用户，可以使用sudo进行权限下放。且做好免密登录<br>  </p> 
<p><strong>2.3 运行临时命令</strong></p> 
<p>使用临时命令可以快速测试和更改，不需要编写playbook</p> 
<p>2.3.1 格式：</p> 
<ul><li>ansible host-pattern -m module [-a 'module arguments'] [-i inventory]</li></ul> 
<p>2.3.2 检查能否在受管主机上运行python模块</p> 
<p><br><img alt="" height="306" src="https://images2.imgbox.com/ea/a7/IVL3IihT_o.png" width="763"></p> 
<p>2.3.3 使用临时命令通过模块执行任务</p> 
<ul><li>ansible-doc -l    #列出所有模块</li><li>ansible-doc ping    #查看ping模块帮助文档</li></ul> 
<p>ansible模块<br> 文件模块：    -copy：将本地文件复制到受管主机<br>         -file：设置文件的权限和其他属性<br>         -lineinfile：确保特定行是否在文件中<br>         -synchronize：使用rsync同步内容</p> 
<p>系统模块：    -firewalld：使用firewalld管理任意端口和服务<br>         -reboot：重启 <br>         -service：管理服务<br>         -user：添加、删除和管理用户账户</p> 
<p>Net Tools模块：    -get_url：通过http、https、或者ftp下载文件<br>         -nmcli：管理网络<br>         -uri：与web服务交互</p> 
<p><br> 例：</p> 
<p>使用user模块确保huayu用户存在于server1.huayu.com 且 uid=1000</p> 
<p><img alt="" height="338" src="https://images2.imgbox.com/fb/75/jA5Di4cQ_o.png" width="753"></p> 
<p>通过ansible的command模块，在受管主机上运行命令：<img alt="" height="119" src="https://images2.imgbox.com/3d/ef/5YVumWCG_o.png" width="752"></p> 
<p>ansible 加上-o参数，单行显示<img alt="" height="79" src="https://images2.imgbox.com/3e/3f/z9NMMkSd_o.png" width="748"></p> 
<p>注：command模块允许执行远程命令，但这些命令不是shell处理，无法访问shell环境变量，所以不能执行重定向、传送等操作</p> 
<p>使用command模块执行临时命令</p> 
<pre><code class="language-bash">ansible localhost -m command -a 'id'</code></pre> 
<p><img alt="" height="150" src="https://images2.imgbox.com/5e/19/fOjgjjwS_o.png" width="731"></p> 
<pre><code>ansible localhost -m command -a 'id' -u student    #通过-u选项使用huayu用户进行连接并执行id命令</code></pre> 
<p><img alt="" height="158" src="https://images2.imgbox.com/76/49/9mIUrwNz_o.png" width="747"></p> 
<p> </p> 
<p>使用copy模块</p> 
<p>1.首先使用student用户，因为huayu用户没有写权限，会失败</p> 
<pre><code class="language-bash">ansible localhost -m copy -a 'content="westos ansible\n" dest=/etc/motd' -u student</code></pre> 
<p><img alt="" height="208" src="https://images2.imgbox.com/bd/7a/6FbsCwkl_o.png" width="755"></p> 
<p>2.使用特权升级</p> 
<p><img alt="" height="68" src="https://images2.imgbox.com/0d/cf/X8qvupcR_o.png" width="735"></p> 
<p><img alt="" height="383" src="https://images2.imgbox.com/ef/e6/NXgMo0px_o.png" width="1001"></p> 
<p> </p> 
<p>使用主机组一次更改server1和server2</p> 
<p><img alt="" height="604" src="https://images2.imgbox.com/3f/01/NaIDNUNi_o.png" width="1012"><br> 可以看到server1显示SUCCESS，server2显示CHANGED，因为server1已经处于正确状态</p> 
<p><br> 查看<br><img alt="" height="119" src="https://images2.imgbox.com/aa/51/FzsMkUWH_o.png" width="971"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/134afba75bf3270e280ad7f86878bb06/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL中判断奇偶数的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03cd49694632a0e80109ad0dd51661b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">7.zabbix网页汉化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>