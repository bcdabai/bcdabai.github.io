<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习（十一） ------python实现标签传播算法(LP算法) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="机器学习（十一） ------python实现标签传播算法(LP算法)" />
<meta property="og:description" content="代码中实现了两种图的构建方法：RBF和KNN labelpropagation.py
import time import numpy as np def navie_knn(dataSet, query, k): numSamples = dataSet.shape[0] # 1. 计算欧氏距离 diff = np.tile(query, (numSamples, 1)) - dataSet squaredDiff = diff ** 2 squaredDist = np.sum(squaredDiff, axis=1) # 2. 对距离进行排序 sortedDistIndices = np.argsort(squaredDist) if k &gt; len(sortedDistIndices): k = len(sortedDistIndices) # 返回排序后的距离 return sortedDistIndices[0:k] # 建立一个大图 def buildGraph(MatX, kernel_type, rbf_sigma=None, knn_num_neighbors=None): num_samples = MatX.shape[0] affinity_matrix = np.zeros((num_samples, num_samples), np.float32) # 判断是否满足条件，是否为rbf类型 if kernel_type == &#39;type&#39;: if rbf_sigma == None: raise ValueError(&#39;You should input a sigma of rbf kernel!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/92dcf2c400de4c776cd7bb3c6c13acb7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-24T20:17:43+08:00" />
<meta property="article:modified_time" content="2021-10-24T20:17:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习（十一） ------python实现标签传播算法(LP算法)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="RBFKNN_0"></a>代码中实现了两种图的构建方法：RBF和KNN</h5> 
<p>labelpropagation.py</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">navie_knn</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">,</span> query<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    numSamples <span class="token operator">=</span> dataSet<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 1. 计算欧氏距离</span>
    diff <span class="token operator">=</span> np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">(</span>numSamples<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> dataSet
    squaredDiff <span class="token operator">=</span> diff <span class="token operator">**</span> <span class="token number">2</span>
    squaredDist <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>squaredDiff<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. 对距离进行排序</span>
    sortedDistIndices <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>squaredDist<span class="token punctuation">)</span>
    <span class="token keyword">if</span> k <span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sortedDistIndices<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sortedDistIndices<span class="token punctuation">)</span>

    <span class="token comment"># 返回排序后的距离</span>
    <span class="token keyword">return</span> sortedDistIndices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span>

<span class="token comment"># 建立一个大图</span>
<span class="token keyword">def</span> <span class="token function">buildGraph</span><span class="token punctuation">(</span>MatX<span class="token punctuation">,</span> kernel_type<span class="token punctuation">,</span> rbf_sigma<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> knn_num_neighbors<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_samples <span class="token operator">=</span> MatX<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    affinity_matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">,</span> num_samples<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token comment"># 判断是否满足条件，是否为rbf类型</span>
    <span class="token keyword">if</span> kernel_type <span class="token operator">==</span> <span class="token string">'type'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> rbf_sigma <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'You should input a sigma of rbf kernel!'</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
            row_sum <span class="token operator">=</span> <span class="token number">0.0</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 计算距离diff的值</span>
                diff <span class="token operator">=</span> MatX<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> MatX<span class="token punctuation">[</span>j<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
                affinity_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>diff <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.0</span> <span class="token operator">*</span> rbf_sigma <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                row_sum <span class="token operator">+=</span> affinity_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            affinity_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">/=</span> row_sum
    <span class="token keyword">elif</span> kernel_type <span class="token operator">==</span> <span class="token string">'knn'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> knn_num_neighbors <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'You should input a k of knn kernel!'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
            k_neighbors <span class="token operator">=</span> navie_knn<span class="token punctuation">(</span>MatX<span class="token punctuation">,</span> MatX<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> knn_num_neighbors<span class="token punctuation">)</span>
            affinity_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k_neighbors<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> knn_num_neighbors
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NameError<span class="token punctuation">(</span><span class="token string">'Not support kernel type! You can use knn of rbf!'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> affinity_matrix


<span class="token comment"># labelpropagation标签传播算法</span>
<span class="token keyword">def</span> <span class="token function">labelPropagation</span><span class="token punctuation">(</span>Mat_Label<span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> kernel_type<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> rbf_sigma<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> knn_num_neighbors<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                     max_iter<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># initialize 初始化</span>
    <span class="token comment"># 有标签样本数量</span>
    num_label_samples <span class="token operator">=</span> Mat_Label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 无标签样本数量</span>
    num_unlabel_samples <span class="token operator">=</span> Mat_Unlabel<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 总样本数量</span>
    num_samples <span class="token operator">=</span> num_label_samples <span class="token operator">+</span> num_unlabel_samples
    <span class="token comment"># 去除labels中的重复数据，并进行排序后输出</span>
    labels_list <span class="token operator">=</span> np<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>
    num_classes <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>labels_list<span class="token punctuation">)</span>
    <span class="token comment"># 实现数组垂直合并</span>
    MatX <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>Mat_Label<span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 返回一个给定形状和类型且填充为0的数组</span>
    clamp_data_label <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>num_label_samples<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_label_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
        clamp_data_label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>
    label_function <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

    label_function<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>num_label_samples<span class="token punctuation">]</span> <span class="token operator">=</span> clamp_data_label
    label_function<span class="token punctuation">[</span>num_label_samples<span class="token punctuation">:</span>num_samples<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># 构建图</span>
    affinity_matrix <span class="token operator">=</span> buildGraph<span class="token punctuation">(</span>MatX<span class="token punctuation">,</span> kernel_type<span class="token punctuation">,</span> rbf_sigma<span class="token punctuation">,</span> knn_num_neighbors<span class="token punctuation">)</span>
    <span class="token comment"># 开始标签传播</span>
    <span class="token builtin">iter</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    pre_label_function <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    changed <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>pre_label_function <span class="token operator">-</span> label_function<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token builtin">iter</span> <span class="token operator">&lt;</span> max_iter <span class="token keyword">and</span> changed <span class="token operator">&gt;</span> tol<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">iter</span> <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------&gt;&gt;&gt;迭代 %d/%d.changed: %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">,</span> max_iter<span class="token punctuation">,</span> changed<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pre_label_function <span class="token operator">=</span> label_function
        <span class="token builtin">iter</span> <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment"># propagation传播，使用np.dot函数计算矩阵乘积</span>
        label_function <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>affinity_matrix<span class="token punctuation">,</span> label_function<span class="token punctuation">)</span>
        <span class="token comment"># 将标签的数值限制在区间（一系列的值）内</span>
        label_function<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>num_label_samples<span class="token punctuation">]</span> <span class="token operator">=</span> clamp_data_label
        <span class="token comment"># check converge,计算数组各元素的绝对值</span>
        changed <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>pre_label_function <span class="token operator">-</span> label_function<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 得到未分类标签数据的类别</span>
    unlabel_data_labels <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_unlabel_samples<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_unlabel_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 取出label_function[i+num_label_samples]中元素最大值所对应的索引</span>
        unlabel_data_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>label_function<span class="token punctuation">[</span>i <span class="token operator">+</span> num_label_samples<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> unlabel_data_labels

</code></pre> 
<p>testlp.py</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> labelpropagation <span class="token keyword">import</span> labelPropagation
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math


<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>Mat_Label<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">,</span> unlabel_data_labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Mat_Label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Dr'</span><span class="token punctuation">)</span>  <span class="token comment"># 以Dr绘制图形</span>
        <span class="token keyword">elif</span> <span class="token builtin">int</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Db'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Label<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Dy'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Mat_Unlabel<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>unlabel_data_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'or'</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">int</span><span class="token punctuation">(</span>unlabel_data_labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'ob'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'oy'</span><span class="token punctuation">)</span>

    <span class="token comment"># 绘制分类图形</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'X1'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'X2'</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置取值区间</span>
    plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">loadCircleData</span><span class="token punctuation">(</span>num_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 定义中心点坐标</span>
    center <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">5.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 定义内圆半径值</span>
    radiu_inner <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token comment"># 定义外圆半径值</span>
    radiu_outer <span class="token operator">=</span> <span class="token number">4</span>
    <span class="token comment"># 计算内圆数量</span>
    num_inner <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num_data <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算外圆数量</span>
    num_outer <span class="token operator">=</span> num_data <span class="token operator">-</span> num_inner
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    theta <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_inner<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pho <span class="token operator">=</span> <span class="token punctuation">(</span>theta <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180</span>
        tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> radiu_inner <span class="token operator">*</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>pho<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        tmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> radiu_inner <span class="token operator">*</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>pho<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
        theta <span class="token operator">+=</span> <span class="token number">2</span>
    theta <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_outer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pho <span class="token operator">=</span> <span class="token punctuation">(</span>theta <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180</span>
        tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> radiu_outer <span class="token operator">*</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>pho<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        tmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> radiu_outer <span class="token operator">*</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>pho<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
        theta <span class="token operator">+=</span> <span class="token number">1</span>
    Mat_Label <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    Mat_Label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> center <span class="token operator">+</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span>radiu_inner <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    Mat_Label<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> center <span class="token operator">+</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span>radiu_outer <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
    Mat_Unlabel <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Mat_Label<span class="token punctuation">,</span>labels<span class="token punctuation">,</span>Mat_Unlabel


<span class="token keyword">def</span> <span class="token function">loadBandData</span><span class="token punctuation">(</span>num_unlabel_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Mat_label <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">8.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 定义分类标签</span>
    num_dim <span class="token operator">=</span> Mat_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    Mat_Unlabel <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>num_unlabel_samples<span class="token punctuation">,</span>num_dim<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token comment"># Mat_Unlabel赋值为0</span>
    <span class="token comment"># 以下代码得到两类分类后的数据</span>
    Mat_Unlabel<span class="token punctuation">[</span><span class="token punctuation">:</span>num_unlabel_samples<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>num_unlabel_samples<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>num_dim<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> Mat_label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    Mat_Unlabel<span class="token punctuation">[</span>num_unlabel_samples<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">:</span>num_unlabel_samples<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>num_unlabel_samples<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>num_dim<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> Mat_label<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> Mat_label<span class="token punctuation">,</span>labels<span class="token punctuation">,</span>Mat_Unlabel

<span class="token comment"># 主函数</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    num_unlabel_samples <span class="token operator">=</span> <span class="token number">800</span>
    Mat_label<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> Mat_Unlabel <span class="token operator">=</span> loadCircleData<span class="token punctuation">(</span>num_unlabel_samples<span class="token punctuation">)</span>
    <span class="token comment"># 使用rbf时，sigma参数的设置很重要，按照数据集选择的，具体要考虑</span>
    <span class="token comment"># 连个数据点之间的距离，他也会影响到收敛的速度，所以使用knn内核更好，更稳定</span>
    <span class="token comment"># unlabel_data_labels = labelPropagation(Mat_label,Mat_Unlabel,labels,kernel_type='rbf',rbf_sigma=0.2)</span>
    unlabel_data_labels <span class="token operator">=</span> labelPropagation<span class="token punctuation">(</span>Mat_label<span class="token punctuation">,</span> Mat_Unlabel<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> kernel_type<span class="token operator">=</span><span class="token string">'knn'</span><span class="token punctuation">,</span> knn_num_neighbors<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>max_iter<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示</span>
    show<span class="token punctuation">(</span>Mat_label<span class="token punctuation">,</span>labels<span class="token punctuation">,</span>Mat_Unlabel<span class="token punctuation">,</span>unlabel_data_labels<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_197"></a>结果展示</h4> 
<p>可视化结果<img src="https://images2.imgbox.com/3c/5f/8FUK8U7G_o.png" alt="在这里插入图片描述"><br> 迭代结果<img src="https://images2.imgbox.com/f2/79/mgSeGdKR_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61412c442f37d6e27b4bdc73b6caccdb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java8新特性（lambda表达式）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c0bfbf50f01c26782ffcb2ab6b79f97/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux C&#43;&#43; Commonapi环境搭建</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>