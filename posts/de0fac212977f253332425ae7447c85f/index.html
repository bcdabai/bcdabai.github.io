<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32 FFT DMA ADC THD - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32 FFT DMA ADC THD" />
<meta property="og:description" content="利用STM32 FFT算法计算THD 一、设备准备 ——&gt;粤嵌STM32F429IGT6开发板 1块
——&gt;串口调试助手
二、FFT算法意义 使用FFT算法，是为了获取信号在频域的相关参数，即信号的频谱。包括信号在频谱上各点的频率和该点的幅值。
由上面的调制信号和已调信号的频谱图，我们可以观察到正弦信号在未经过调制前，其频谱图仅仅在0频附近有一条谱线，这条谱线即为未调制信号的频谱。同时，我们可以观察到调制后的正弦信号的频谱发生了搬移，即从零频附近搬移到载波信号的频谱处。
首先让我们理解一个概念，信号的组成：任何连续测量的时序或信号，都可以表示为不同频率的正弦波信号的无限叠加。而根据该原理创立的傅立叶变换算法利用直接测量到的原始信号，以累加方式来计算该信号中不同正弦波信号的频率、振幅和相位。
其实，简单的理解，观察信号的角度从时域转换到频域，对观察者最大的好处是：在频域，信号的频谱图能够反映该信号所含的各种频率成分的信号及它们的幅值。
傅里叶级数的意义
三、DSP实际使用方法 我们使用ST公司提供的DSP库中的FFT算法。
使用步骤如下：
- STM32F4 DSP简介
STM32F4采用Cortex-M4内核，相比Cortex-M3系列除了内置硬件FPU单元（浮点运算单元)，FPU是专用于浮点运算的处理器，在数字信号处理方面还增加了DSP指令集，支持诸如单周期乘加指令（MAC），优化的单指令多数据指令(SIMD)，饱和算数等多种数字信号处理指令集。Cortex-M4执行所有的DSP指令都可以在单周期内完成，而Cortex-M3需要多个指令和多个周期才能完成同样的功能。
- 下载DSP_Lib源码包
找到DSP_Lib源码包，该文件夹目录结构如下图所示：
DSP_Lib源码包的Source文件夹是所有DSP库的源码，Examples文件夹是相对应的一些测试实例。这些测试实例都是带main函数的，也就是拿到工程中可以直接使用。
查阅原子STM32F4开发指南-寄存器版本，P699页，了解各种源码的功能介绍。
- 搭建DSP运行环境
只要DSP库运行环境搭建好了，使用DSP库里面的函数来做相关处理就非常简单。在MDK里面搭建STM32F4的DSP运行环境(使用.lib方式)是很简单的，分为3个步骤：
1、添加文件
在例程工程目录下新建：DSP_LIB文件夹，存放要添加的arm_correxM4lf_math.lib和相关头文件。
打开工程，新建DSP_LIB分组，并将arm_cortexM4lf_math.lib添加到工程里面。
如上面两图所示，这样添加文件就结束了。
2、添加头文件包含路径。
添加好了.lib文件后，我们要添加头文件包含路径，将第一步拷贝的Include文件夹和DSP_LIB文件夹，加入头文件包含路径，如下图所示。
3.添加全局变量宏
注意：这里两个宏之间用“,”隔开。这里我添加的宏包括：USE_STDPERIPH_DRIVER,STM32F429_439xx,ARM_MATH_CM4,__CC_ARM,ARM_MATH_MATRIX_CHECK,ARM_MATH_ROUNDING，如果没有在Target选项卡设置Code Generation选择use FPU,则必须在此处手动添加_FPU_USED。
这样，STM32F4DSP库运行环境就搭建完成了。
四、代码介绍 我采用在时域对信号进行采样，将时域采样数据进行4096点FFT变换，得到信号各频率成分的幅值，最后计算该信号的THD。
1.DMA介绍
DMA： 全称为： Direct Memory Access，即直接存储器访问。 DMA 传输方式无需 CPU 直接控制传输，也没有中断处理方式那样保留现场和恢复现场的过程，通过硬件为 RAM 与 I/O 设备开辟一条直接传送数据的通路， 能使 CPU 的效率大为提高。
STM32 最多有 2 个 DMA 控制器（DMA2 仅存在大容量产品中）， DMA1 有 7 个通道。 DMA2 有 5个通道。每个通道专门用来管理来自于一个或多个外设对存储器访问的请求。还有一个仲裁起来协调各个 DMA 请求的优先权。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/de0fac212977f253332425ae7447c85f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-30T21:28:58+08:00" />
<meta property="article:modified_time" content="2020-10-30T21:28:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32 FFT DMA ADC THD</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="STM32_FFTTHD_1"></a>利用STM32 FFT算法计算THD</h3> 
<h5><a id="_2"></a>一、设备准备</h5> 
<p>——&gt;粤嵌STM32F429IGT6开发板 1块<br> ——&gt;串口调试助手</p> 
<h5><a id="FFT_5"></a>二、FFT算法意义</h5> 
<p>使用FFT算法，是为了获取信号在频域的相关参数，即信号的频谱。包括信号在频谱上各点的频率和该点的幅值。<br> <img src="https://images2.imgbox.com/e3/cd/lehSmCtd_o.png" alt=""><br> 由上面的调制信号和已调信号的频谱图，我们可以观察到正弦信号在未经过调制前，其频谱图仅仅在0频附近有一条谱线，这条谱线即为未调制信号的频谱。同时，我们可以观察到调制后的正弦信号的频谱发生了搬移，即从零频附近搬移到载波信号的频谱处。<br> 首先让我们理解一个概念，信号的组成：任何连续测量的时序或信号，都可以表示为不同频率的正弦波信号的无限叠加。而根据该原理创立的傅立叶变换算法利用直接测量到的原始信号，以累加方式来计算该信号中不同正弦波信号的频率、振幅和相位。<br> 其实，简单的理解，观察信号的角度从时域转换到频域，对观察者最大的好处是：在频域，信号的频谱图能够反映该信号所含的各种频率成分的信号及它们的幅值。<br> <a href="https://zhidao.baidu.com/question/535001441.html" rel="nofollow">傅里叶级数的意义</a></p> 
<h5><a id="DSP_12"></a>三、DSP实际使用方法</h5> 
<p>我们使用ST公司提供的DSP库中的FFT算法。<br> 使用步骤如下：</p> 
<p><strong>- STM32F4 DSP简介</strong></p> 
<p>STM32F4采用Cortex-M4内核，相比Cortex-M3系列除了内置硬件FPU单元（浮点运算单元)，FPU是专用于浮点运算的处理器，在数字信号处理方面还增加了DSP指令集，支持诸如单周期乘加指令（MAC），优化的单指令多数据指令(SIMD)，饱和算数等多种数字信号处理指令集。Cortex-M4执行所有的DSP指令都可以在单周期内完成，而Cortex-M3需要多个指令和多个周期才能完成同样的功能。</p> 
<p><strong>- 下载DSP_Lib源码包</strong></p> 
<p>找到DSP_Lib源码包，该文件夹目录结构如下图所示：<br> <img src="https://images2.imgbox.com/ad/6f/FKSjNRKe_o.png" alt="在这里插入图片描述"><br> DSP_Lib源码包的Source文件夹是所有DSP库的源码，Examples文件夹是相对应的一些测试实例。这些测试实例都是带main函数的，也就是拿到工程中可以直接使用。<br> <img src="https://images2.imgbox.com/b5/f0/1NdB2sDK_o.png" alt="在这里插入图片描述"><br> 查阅原子STM32F4开发指南-寄存器版本，P699页，了解各种源码的功能介绍。</p> 
<p><strong>- 搭建DSP运行环境</strong><br> 只要DSP库运行环境搭建好了，使用DSP库里面的函数来做相关处理就非常简单。在MDK里面搭建STM32F4的DSP运行环境(使用.lib方式)是很简单的，分为3个步骤：</p> 
<p><strong>1、添加文件</strong><br> 在例程工程目录下新建：DSP_LIB文件夹，存放要添加的arm_correxM4lf_math.lib和相关头文件。<br> <img src="https://images2.imgbox.com/13/da/aWEINSkF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ac/0f/fAiLal3c_o.png" alt="在这里插入图片描述"></p> 
<p>打开工程，新建DSP_LIB分组，并将arm_cortexM4lf_math.lib添加到工程里面。</p> 
<p><img src="https://images2.imgbox.com/ac/8b/4nMIOs1K_o.png" alt="在这里插入图片描述"><br> 如上面两图所示，这样添加文件就结束了。</p> 
<p><strong>2、添加头文件包含路径。</strong><br> 添加好了.lib文件后，我们要添加头文件包含路径，将第一步拷贝的Include文件夹和DSP_LIB文件夹，加入头文件包含路径，如下图所示。<br> <img src="https://images2.imgbox.com/0e/65/xaygMzxL_o.png" alt="在这里插入图片描述"><br> <strong>3.添加全局变量宏</strong><br> <img src="https://images2.imgbox.com/b4/ac/2gjFGQad_o.png" alt="在这里插入图片描述"><br> <strong>注意</strong>：这里两个宏之间用“,”隔开。这里我添加的宏包括：USE_STDPERIPH_DRIVER,STM32F429_439xx,ARM_MATH_CM4,__CC_ARM,ARM_MATH_MATRIX_CHECK,ARM_MATH_ROUNDING，如果没有在Target选项卡设置Code Generation选择use FPU,则必须在此处手动添加_FPU_USED。</p> 
<p>这样，STM32F4DSP库运行环境就搭建完成了。</p> 
<h5><a id="_50"></a>四、代码介绍</h5> 
<p>我采用在时域对信号进行采样，将时域采样数据进行4096点FFT变换，得到信号各频率成分的幅值，最后计算该信号的THD。</p> 
<p><strong>1.DMA介绍</strong><br> DMA： 全称为： Direct Memory Access，即直接存储器访问。 DMA 传输方式无需 CPU 直接控制传输，也没有中断处理方式那样保留现场和恢复现场的过程，通过硬件为 RAM 与 I/O 设备开辟一条直接传送数据的通路， 能使 CPU 的效率大为提高。<br> STM32 最多有 2 个 DMA 控制器（DMA2 仅存在大容量产品中）， DMA1 有 7 个通道。 DMA2 有 5个通道。每个通道专门用来管理来自于一个或多个外设对存储器访问的请求。还有一个仲裁起来协调各个 DMA 请求的优先权。</p> 
<p><strong>2.编程思想</strong><br> 编程采用ADC+DMA+定时器触发的方式，简单的理解就是定时器具有生成PWM信号的功能，该脉冲信号在上升沿会触发ADC采样，采集的数据会直接被存储在用户自定义的内存单元中，当每次采集完4096个点的采样数据后，才会被再一次传输到用户自定义内存单元，即进行采样数据的更新。</p> 
<p><strong>3.采样定理介绍</strong><br> 在进行模拟/数字信号的转换过程中，当采样频率fs.max大于信号中最高频率fmax的2倍时(fs.max&gt;2fmax)，采样之后的数字信号完整地保留了原始信号中的信息，一般实际应用中保证采样频率为信号最高频率的2.56～4倍；采样定理又称奈奎斯特定理。即当满足采样定理时，可以不失真的恢复原信号，或者说得到原始信号的有用信息。</p> 
<p>采用ADC+DMA+定时器的方式实现信号的采样时，采样频率由定时器的频率决定，需要注意的是，定时器的频率必须小于ADC频率。关于这个问题可以看这里：<a href="https://blog.csdn.net/qq_41913635/article/details/98230608">STM32定时触发ADC 采样频率等问题总结</a></p> 
<p><strong>4、ADC配置</strong></p> 
<pre><code class="prism language-cpp">	ADC_InitTypeDef ADC_InitStructure<span class="token punctuation">;</span>
	ADC_CommonInitTypeDef ADC_CommonInitStructure<span class="token punctuation">;</span>
  <span class="token comment">// 开启ADC时钟</span>
  <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_CLK <span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// -------------------ADC Common 结构体 参数 初始化------------------------</span>
  <span class="token comment">// 独立ADC模式</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_Mode <span class="token operator">=</span> ADC_Mode_Independent<span class="token punctuation">;</span>
  <span class="token comment">// 时钟为fpclk x分频	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_Prescaler <span class="token operator">=</span> ADC_Prescaler_Div4<span class="token punctuation">;</span>
  <span class="token comment">// 禁止DMA直接访问模式	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_DMAAccessMode <span class="token operator">=</span> ADC_DMAAccessMode_Disabled<span class="token punctuation">;</span>
  <span class="token comment">// 采样时间间隔	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_TwoSamplingDelay <span class="token operator">=</span> ADC_TwoSamplingDelay_5Cycles<span class="token punctuation">;</span>  
  <span class="token function">ADC_CommonInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ADC_CommonInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// -------------------ADC Init 结构体 参数 初始化--------------------------</span>
  <span class="token function">ADC_StructInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ADC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ADC 分辨率</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_Resolution <span class="token operator">=</span> ADC_Resolution_12b<span class="token punctuation">;</span>
  <span class="token comment">// 禁止扫描模式，多通道采集才需要	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ScanConvMode <span class="token operator">=</span> DISABLE<span class="token punctuation">;</span> 
  <span class="token comment">// 连续转换	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ContinuousConvMode <span class="token operator">=</span> DISABLE<span class="token punctuation">;</span> 
  <span class="token comment">//禁止外部边沿触发</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ExternalTrigConvEdge <span class="token operator">=</span> ADC_ExternalTrigConvEdge_Rising<span class="token punctuation">;</span>
  <span class="token comment">//外部触发通道，本例子使用软件触发，此值随便赋值即可</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ExternalTrigConv <span class="token operator">=</span> ADC_ExternalTrigConv_T3_TRGO<span class="token punctuation">;</span>
  <span class="token comment">//数据右对齐	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_DataAlign <span class="token operator">=</span> ADC_DataAlign_Right<span class="token punctuation">;</span>
  <span class="token comment">//转换通道 1个</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_NbrOfConversion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                                    
  <span class="token function">ADC_Init</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ADC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//---------------------------------------------------------------------------</span>
	
  <span class="token comment">// 配置 ADC 通道转换顺序为1，第一个转换，采样时间为3个时钟周期</span>
  <span class="token function">ADC_RegularChannelConfig</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> RHEOSTAT_ADC_CHANNEL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>ADC_SampleTime_15Cycles<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使能DMA请求 after last transfer (Single-ADC mode)</span>
  <span class="token function">ADC_DMARequestAfterLastTransferCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 使能ADC DMA</span>
  <span class="token function">ADC_DMACmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	
  
 <span class="token comment">// 使能ADC</span>
    <span class="token function">ADC_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token comment">//开始adc转换，软件触发</span>
 <span class="token comment">//  ADC_SoftwareStartConv(RHEOSTAT_ADC);</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>5、DMA配置</strong></p> 
<pre><code class="prism language-cpp">   DMA_InitTypeDef DMA_InitStructure<span class="token punctuation">;</span>
   NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span>
  <span class="token comment">// ------------------DMA Init 结构体参数 初始化--------------------------</span>
  <span class="token comment">// ADC1使用DMA2，数据流0，通道0，这个是手册固定死的</span>
  <span class="token comment">// 开启DMA时钟</span>
    <span class="token function">RCC_AHB1PeriphClockCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_CLK<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token comment">// 外设基址为：ADC 数据寄存器地址</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralBaseAddr <span class="token operator">=</span> RHEOSTAT_ADC_DR_ADDR<span class="token punctuation">;</span>	
  <span class="token comment">// 存储器地址，实际上就是一个内部SRAM的变量	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Memory0BaseAddr <span class="token operator">=</span> <span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token operator">&amp;</span>ADC_ConvertedValue<span class="token punctuation">;</span>  
  <span class="token comment">// 数据传输方向为外设到存储器	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_DIR <span class="token operator">=</span> DMA_DIR_PeripheralToMemory<span class="token punctuation">;</span>	
	<span class="token comment">// 缓冲区大小为，指一次传输的数据量</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_BufferSize <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>	
	<span class="token comment">// 外设寄存器只有一个，地址不用递增</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralInc <span class="token operator">=</span> DMA_PeripheralInc_Disable<span class="token punctuation">;</span>
  <span class="token comment">// 存储器地址固定</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryInc <span class="token operator">=</span> DMA_MemoryInc_Enable<span class="token punctuation">;</span> 
   <span class="token comment">// // 外设数据大小为半字，即两个字节 </span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralDataSize <span class="token operator">=</span> DMA_PeripheralDataSize_HalfWord<span class="token punctuation">;</span> 
     <span class="token comment">//	存储器数据大小也为半字，跟外设数据大小相同</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryDataSize <span class="token operator">=</span> DMA_MemoryDataSize_HalfWord<span class="token punctuation">;</span>	
	<span class="token comment">// 循环传输模式</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Mode <span class="token operator">=</span> DMA_Mode_Circular<span class="token punctuation">;</span>
  <span class="token comment">// DMA 传输通道优先级为高，当使用一个DMA通道时，优先级设置不影响</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Priority <span class="token operator">=</span> DMA_Priority_High<span class="token punctuation">;</span>
	  <span class="token comment">// 禁止DMA FIFO	，使用直连模式</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_FIFOMode <span class="token operator">=</span> DMA_FIFOMode_Disable<span class="token punctuation">;</span>  
	  <span class="token comment">// FIFO 大小，FIFO模式禁止时，这个不用配置	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_FIFOThreshold <span class="token operator">=</span> DMA_FIFOThreshold_HalfFull<span class="token punctuation">;</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryBurst <span class="token operator">=</span> DMA_MemoryBurst_Single<span class="token punctuation">;</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralBurst <span class="token operator">=</span> DMA_PeripheralBurst_Single<span class="token punctuation">;</span>  
		<span class="token comment">// 选择 DMA 通道，通道存在于流中</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Channel <span class="token operator">=</span> RHEOSTAT_ADC_DMA_CHANNEL<span class="token punctuation">;</span> 
	  <span class="token comment">//初始化DMA流，流相当于一个大的管道，管道里面有很多通道</span>
	<span class="token function">DMA_Init</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>DMA_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span>	

    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> DMA2_Stream0_IRQn<span class="token punctuation">;</span>

    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
 
    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
	
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span>

    <span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    
<span class="token comment">// 使能DMA流</span>
    <span class="token function">DMA_ITConfig</span><span class="token punctuation">(</span>DMA2_Stream0<span class="token punctuation">,</span>DMA_IT_TC<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	 
   <span class="token function">DMA_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>6、定时器配置</strong></p> 
<p>一般情况下，定时器触发ADC转换并不需要中断，因此不需要配置定时器的中断优先级。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//使用通用定时器 触发ADC采样  TIM6，由于时钟频率不清楚，本身进行的配置</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">TIM_Mode_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//NVIC_InitTypeDef NVIC_InitStructure;</span>
	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure<span class="token punctuation">;</span>
	<span class="token comment">// 开启TIMx_CLK,x[6,7] </span>
    <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>GENERAL_TIM_CLK<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 

  <span class="token comment">/* 累计 TIM_Period个后产生一个更新或者中断*/</span>		
    <span class="token comment">//定时器初值，采样间隔0.05/1024s,初值为(0.05/1024)/(1/10M)=488</span>
    <span class="token comment">//TIM_TimeBaseStructure.TIM_Period = 81 //（原始设置的数值）      </span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> <span class="token number">3515</span><span class="token punctuation">;</span> 
	<span class="token comment">// 通用控制定时器时钟源TIMxCLK = HCLK/2=90MHz </span>
	<span class="token comment">// 设定定时器频率为=TIMxCLK/(TIM_Prescaler+1)=10MHz</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	
    <span class="token comment">// 采样时钟分频</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_ClockDivision<span class="token operator">=</span>TIM_CKD_DIV1<span class="token punctuation">;</span>
    <span class="token comment">// 计数方式</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_CounterMode<span class="token operator">=</span>TIM_CounterMode_Up<span class="token punctuation">;</span>
	
	<span class="token comment">// 初始化定时器TIMx, x[1,8]</span>
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 清除定时器更新中断标志位</span>
    <span class="token comment">// TIM_ClearFlag(GENERAL_TIM, TIM_FLAG_Update);</span>
	
	<span class="token comment">// 开启定时器更新中断</span>
    <span class="token comment">// TIM_ITConfig(GENERAL_TIM,TIM_IT_Update,ENABLE);</span>
	<span class="token function">TIM_SelectOutputTrigger</span><span class="token punctuation">(</span>TIM3<span class="token punctuation">,</span> TIM_TRGOSource_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//使能定时器</span>
	<span class="token comment">//TIM_Cmd(GENERAL_TIM, ENABLE);	</span>
   
    <span class="token comment">//使能定时器</span>
    <span class="token comment">//TIM_Cmd(GENERAL_TIM, DISABLE);	</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>7、进行FFT</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">//在main.c文件中调用，进行ADC DMA 定时器的先相关初始化</span>
<span class="token keyword">void</span> <span class="token function">Rheostat_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Rheostat_ADC_GPIO_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Rheostat_ADC_Mode_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//	TIMx_NVIC_Configuration();</span>
    <span class="token function">TIM_Mode_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//使能ADC DMA FFT功能，需要进行FFT运算时，调用该语句</span>
<span class="token keyword">void</span>  <span class="token function">ENABLE_deinit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">ADC_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">DMA_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//失能ADC DMA FFT功能</span>
<span class="token keyword">void</span>  <span class="token function">DISABLE_deinit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">ADC_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">DMA_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span>DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">DMA2_Stream0_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   u16 i<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">DMA_GetITStatus</span><span class="token punctuation">(</span>DMA2_Stream0<span class="token punctuation">,</span> DMA_IT_TCIF0<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//是否进入中断</span>
   <span class="token punctuation">{<!-- --></span> 
		<span class="token function">DISABLE_deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	    <span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"%d fft is running... please wait"</span><span class="token punctuation">,</span>counts0<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>		 <span class="token comment">//在第三行显示THD</span>
		 	
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">DMA_GetCurrentMemoryTarget</span><span class="token punctuation">(</span>DMA2_Stream0<span class="token punctuation">)</span> <span class="token operator">==</span> DMA_Memory_0<span class="token punctuation">)</span><span class="token comment">//</span>
        <span class="token punctuation">{<!-- --></span>
			
			<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4096</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>    
			ADC_Vol<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> ADC_ConvertedValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">4096</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token number">3.3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//电压转换</span>
<span class="token comment">//			printf("\r\n ADC_Vol[%d]：%f \r\n",i,ADC_Vol[i] );            //打印采样电压值</span>
					FFT_IN<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token operator">=</span>ADC_Vol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
					FFT_IN<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token comment">//虚部全部为0</span>
		 <span class="token punctuation">}</span>               
             <span class="token function">fft_transformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//基4FFT</span>
			 <span class="token comment">/*用LCD打印相关FFT变换后数组的输出值*/</span>
<span class="token comment">//                LCD_Clear(LCD_COLOR_WHITE);</span>
<span class="token comment">//                LCD_DisplayStringLine(LINE(1),(uint8_t* )" FFT ");</span>
								 
			  <span class="token comment">/*显示频谱*/</span>
<span class="token comment">//                  for(i=0;i&lt;799;i++){<!-- --></span>
<span class="token comment">                LCD_DrawUniLine(i+1, 480, i+1, (u16)(480-FFT_OUT[i]/8.53));</span>
<span class="token comment">//			      printf("\r\n FFTout[%d]=%f\r\n ",i,FFT_OUT[i]);</span>
<span class="token comment">//             }//先屏蔽串口打印测试</span>
         <span class="token punctuation">}</span>   
		<span class="token comment">//计算各种波形的总谐波失真</span>
		THD<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">320</span><span class="token punctuation">]</span><span class="token operator">*</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">320</span><span class="token punctuation">]</span><span class="token operator">+</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">480</span><span class="token punctuation">]</span><span class="token operator">*</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">480</span><span class="token punctuation">]</span><span class="token operator">+</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token operator">*</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token operator">+</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">]</span><span class="token operator">*</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//根据THD  计算的值 判断谐波失真的类型</span>
				 
		 <span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"1kHz-FFT_out[160]:%f  2kHz-FFT_out[320]:%f "</span><span class="token punctuation">,</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">,</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">320</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>	
				
        <span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"3kHz-FFT_out[480]:%f  4kHz-FFT_out[640]:%f "</span><span class="token punctuation">,</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">480</span><span class="token punctuation">]</span><span class="token punctuation">,</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>					 
			
		<span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"5kHz-FFT_out[800]:%f"</span><span class="token punctuation">,</span>FFT_OUT<span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>					 
	
		<span class="token comment">//</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"%d  DMA fft finished... a new THD"</span><span class="token punctuation">,</span>counts1<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
				
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>	 
		<span class="token comment">//		 </span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"THD=%f"</span><span class="token punctuation">,</span>THD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//串口打印显示</span>
				 
		<span class="token function">sprintf</span><span class="token punctuation">(</span>dispBuff<span class="token punctuation">,</span><span class="token string">"%d THD=%f"</span><span class="token punctuation">,</span>counts2<span class="token operator">++</span><span class="token punctuation">,</span>THD<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		<span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  
		<span class="token function">LCD_DisplayStringLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token operator">*</span> <span class="token punctuation">)</span>dispBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>		 <span class="token comment">//在第三行显示THD</span>
      <span class="token function">DMA_ClearITPendingBit</span><span class="token punctuation">(</span>DMA2_Stream0<span class="token punctuation">,</span> DMA_IT_TCIF0<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//清除中断标志位</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>8、adc.c源码</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"./adc/bsp_adc.h"</span></span>

__IO <span class="token keyword">uint16_t</span> ADC_ConvertedValue<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> FFT_IN<span class="token punctuation">[</span><span class="token number">4096</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> FFT_OUT<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Rheostat_ADC_GPIO_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	
	<span class="token comment">// 使能 GPIO 时钟</span>
	<span class="token function">RCC_AHB1PeriphClockCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_GPIO_CLK<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token comment">// 配置 IO</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin  <span class="token operator">=</span> RHEOSTAT_ADC_GPIO_PIN<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_AIN<span class="token punctuation">;</span>	    
    GPIO_InitStructure<span class="token punctuation">.</span>GPIO_PuPd <span class="token operator">=</span> GPIO_PuPd_NOPULL <span class="token punctuation">;</span> <span class="token comment">//不上拉不下拉</span>
	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>RHEOSTAT_ADC_GPIO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Rheostat_ADC_Mode_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	DMA_InitTypeDef DMA_InitStructure<span class="token punctuation">;</span>
	ADC_InitTypeDef ADC_InitStructure<span class="token punctuation">;</span>
    NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span>

	ADC_CommonInitTypeDef ADC_CommonInitStructure<span class="token punctuation">;</span>

  <span class="token comment">// ------------------DMA Init 结构体参数 初始化--------------------------</span>
  <span class="token comment">// ADC1使用DMA2，数据流0，通道0，这个是手册固定死的</span>
  <span class="token comment">// 开启DMA时钟</span>
    <span class="token function">RCC_AHB1PeriphClockCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_CLK<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token comment">// 外设基址为：ADC 数据寄存器地址</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralBaseAddr <span class="token operator">=</span> RHEOSTAT_ADC_DR_ADDR<span class="token punctuation">;</span>	
  <span class="token comment">// 存储器地址，实际上就是一个内部SRAM的变量	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Memory0BaseAddr <span class="token operator">=</span> <span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token operator">&amp;</span>ADC_ConvertedValue<span class="token punctuation">;</span>  
  <span class="token comment">// 数据传输方向为外设到存储器	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_DIR <span class="token operator">=</span> DMA_DIR_PeripheralToMemory<span class="token punctuation">;</span>	
	<span class="token comment">// 缓冲区大小为，指一次传输的数据量</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_BufferSize <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>	
	<span class="token comment">// 外设寄存器只有一个，地址不用递增</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralInc <span class="token operator">=</span> DMA_PeripheralInc_Disable<span class="token punctuation">;</span>
  <span class="token comment">// 存储器地址固定</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryInc <span class="token operator">=</span> DMA_MemoryInc_Enable<span class="token punctuation">;</span> 
   <span class="token comment">// // 外设数据大小为半字，即两个字节 </span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralDataSize <span class="token operator">=</span> DMA_PeripheralDataSize_HalfWord<span class="token punctuation">;</span> 
     <span class="token comment">//	存储器数据大小也为半字，跟外设数据大小相同</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryDataSize <span class="token operator">=</span> DMA_MemoryDataSize_HalfWord<span class="token punctuation">;</span>	
	<span class="token comment">// 循环传输模式</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Mode <span class="token operator">=</span> DMA_Mode_Normal<span class="token punctuation">;</span>
  <span class="token comment">// DMA 传输通道优先级为高，当使用一个DMA通道时，优先级设置不影响</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Priority <span class="token operator">=</span> DMA_Priority_High<span class="token punctuation">;</span>
	  <span class="token comment">// 禁止DMA FIFO	，使用直连模式</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_FIFOMode <span class="token operator">=</span> DMA_FIFOMode_Disable<span class="token punctuation">;</span>  
	  <span class="token comment">// FIFO 大小，FIFO模式禁止时，这个不用配置	</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_FIFOThreshold <span class="token operator">=</span> DMA_FIFOThreshold_HalfFull<span class="token punctuation">;</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_MemoryBurst <span class="token operator">=</span> DMA_MemoryBurst_Single<span class="token punctuation">;</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_PeripheralBurst <span class="token operator">=</span> DMA_PeripheralBurst_Single<span class="token punctuation">;</span>  
		<span class="token comment">// 选择 DMA 通道，通道存在于流中</span>
	DMA_InitStructure<span class="token punctuation">.</span>DMA_Channel <span class="token operator">=</span> RHEOSTAT_ADC_DMA_CHANNEL<span class="token punctuation">;</span> 
	  <span class="token comment">//初始化DMA流，流相当于一个大的管道，管道里面有很多通道</span>
	<span class="token function">DMA_Init</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>DMA_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span>	

    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> DMA2_Stream0_IRQn<span class="token punctuation">;</span>

    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
 
    NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
	
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span>

    <span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    
<span class="token comment">//使能DMA流</span>
    <span class="token function">DMA_ITConfig</span><span class="token punctuation">(</span>DMA2_Stream0<span class="token punctuation">,</span>DMA_IT_TC<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	 
<span class="token comment">//DMA_Cmd(RHEOSTAT_ADC_DMA_STREAM, ENABLE);</span>
	 
<span class="token comment">//DMA_Cmd(RHEOSTAT_ADC_DMA_STREAM, DISABLE);</span>
	 
		<span class="token comment">// 开启ADC时钟</span>
  <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_CLK <span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// -------------------ADC Common 结构体 参数 初始化------------------------</span>
	<span class="token comment">// 独立ADC模式</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_Mode <span class="token operator">=</span> ADC_Mode_Independent<span class="token punctuation">;</span>
  <span class="token comment">// 时钟为fpclk x分频	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_Prescaler <span class="token operator">=</span> ADC_Prescaler_Div4<span class="token punctuation">;</span>
  <span class="token comment">// 禁止DMA直接访问模式	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_DMAAccessMode <span class="token operator">=</span> ADC_DMAAccessMode_Disabled<span class="token punctuation">;</span>
  <span class="token comment">// 采样时间间隔	</span>
  ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_TwoSamplingDelay <span class="token operator">=</span> ADC_TwoSamplingDelay_5Cycles<span class="token punctuation">;</span>  
  <span class="token function">ADC_CommonInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ADC_CommonInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// -------------------ADC Init 结构体 参数 初始化--------------------------</span>
  <span class="token function">ADC_StructInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ADC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ADC 分辨率</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_Resolution <span class="token operator">=</span> ADC_Resolution_12b<span class="token punctuation">;</span>
  <span class="token comment">// 禁止扫描模式，多通道采集才需要	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ScanConvMode <span class="token operator">=</span> DISABLE<span class="token punctuation">;</span> 
  <span class="token comment">// 连续转换	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ContinuousConvMode <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span> 
  <span class="token comment">//禁止外部边沿触发</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ExternalTrigConvEdge <span class="token operator">=</span> ADC_ExternalTrigConvEdge_Rising<span class="token punctuation">;</span>
  <span class="token comment">//外部触发通道，本例子使用软件触发，此值随便赋值即可</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ExternalTrigConv <span class="token operator">=</span> ADC_ExternalTrigConv_T3_TRGO<span class="token punctuation">;</span>
  <span class="token comment">//数据右对齐	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_DataAlign <span class="token operator">=</span> ADC_DataAlign_Right<span class="token punctuation">;</span>
  <span class="token comment">//转换通道 1个</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_NbrOfConversion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                                    
  <span class="token function">ADC_Init</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ADC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//---------------------------------------------------------------------------</span>
	
  <span class="token comment">// 配置 ADC 通道转换顺序为1，第一个转换，采样时间为3个时钟周期</span>
  <span class="token function">ADC_RegularChannelConfig</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> RHEOSTAT_ADC_CHANNEL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ADC_SampleTime_15Cycles<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使能DMA请求 after last transfer (Single-ADC mode)</span>
  <span class="token function">ADC_DMARequestAfterLastTransferCmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 使能ADC DMA</span>
  <span class="token function">ADC_DMACmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 使能ADC</span>
<span class="token comment">//  ADC_Cmd(RHEOSTAT_ADC, ENABLE);  </span>

    <span class="token comment">// 使能ADC</span>
<span class="token comment">//  ADC_Cmd(RHEOSTAT_ADC, DISABLE); </span>
  <span class="token comment">//开始adc转换，软件触发</span>
<span class="token comment">//  ADC_SoftwareStartConv(RHEOSTAT_ADC);</span>
<span class="token punctuation">}</span>


<span class="token comment">//把DMA 和 ADC 和定时器都失能   在想要使用的时候  将定时器重新使能CMD</span>

<span class="token comment">//使用通用定时器 触发ADC采样  TIM6，由于时钟频率不清楚，本身进行的配置</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">TIM_Mode_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//NVIC_InitTypeDef NVIC_InitStructure;</span>
	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure<span class="token punctuation">;</span>
	<span class="token comment">// 开启TIMx_CLK,x[6,7] </span>
    <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>GENERAL_TIM_CLK<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 

  <span class="token comment">/* 累计 TIM_Period个后产生一个更新或者中断*/</span>		
    <span class="token comment">//定时器初值，采样间隔0.05/1024s,初值为(0.05/1024)/(1/10M)=488</span>
    <span class="token comment">//TIM_TimeBaseStructure.TIM_Period = 81 //（原始设置的数值）      </span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> <span class="token number">3515</span><span class="token punctuation">;</span> 
	<span class="token comment">// 通用控制定时器时钟源TIMxCLK = HCLK/2=90MHz </span>
	<span class="token comment">// 设定定时器频率为=TIMxCLK/(TIM_Prescaler+1)=10MHz</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	
    <span class="token comment">// 采样时钟分频</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_ClockDivision<span class="token operator">=</span>TIM_CKD_DIV1<span class="token punctuation">;</span>
    <span class="token comment">// 计数方式</span>
    TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_CounterMode<span class="token operator">=</span>TIM_CounterMode_Up<span class="token punctuation">;</span>
	
	<span class="token comment">// 初始化定时器TIMx, x[1,8]</span>
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 清除定时器更新中断标志位</span>
    <span class="token comment">// TIM_ClearFlag(GENERAL_TIM, TIM_FLAG_Update);</span>
	
	<span class="token comment">// 开启定时器更新中断</span>
    <span class="token comment">// TIM_ITConfig(GENERAL_TIM,TIM_IT_Update,ENABLE);</span>
	<span class="token function">TIM_SelectOutputTrigger</span><span class="token punctuation">(</span>TIM3<span class="token punctuation">,</span> TIM_TRGOSource_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">//使能定时器</span>
	<span class="token comment">//TIM_Cmd(GENERAL_TIM, ENABLE);	</span>
   
    <span class="token comment">//使能定时器</span>
    <span class="token comment">//TIM_Cmd(GENERAL_TIM, DISABLE);	</span>
<span class="token punctuation">}</span>

<span class="token comment">//static void TIMx_NVIC_Configuration(void)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//    NVIC_InitTypeDef NVIC_InitStructure; </span>
<span class="token comment">//    // 设置中断组为0</span>
<span class="token comment">//    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);		</span>
<span class="token comment">//    // 设置中断来源</span>
<span class="token comment">//    NVIC_InitStructure.NVIC_IRQChannel = GENERAL_TIM_IRQn; 	</span>
<span class="token comment">//	// 设置抢占优先级</span>
<span class="token comment">//    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;	 </span>
<span class="token comment">//	// 设置子优先级</span>
<span class="token comment">//    NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;</span>
<span class="token comment">//	</span>
<span class="token comment">//    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span>
<span class="token comment">//	</span>
<span class="token comment">//    NVIC_Init(&amp;NVIC_InitStructure);</span>
<span class="token comment">//}</span>

<span class="token comment">//采用通用定时器  TIM3 (原本的配置)</span>
<span class="token keyword">void</span> <span class="token function">Rheostat_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Rheostat_ADC_GPIO_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Rheostat_ADC_Mode_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//	TIMx_NVIC_Configuration();</span>
    <span class="token function">TIM_Mode_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>  <span class="token function">ENABLE_deinit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">ADC_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">DMA_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>  <span class="token function">DISABLE_deinit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>GENERAL_TIM<span class="token punctuation">,</span> DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">ADC_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC<span class="token punctuation">,</span> DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">DMA_Cmd</span><span class="token punctuation">(</span>RHEOSTAT_ADC_DMA_STREAM<span class="token punctuation">,</span>DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="_539"></a>五、需要注意的问题和相关的总结</h5> 
<p><strong>1、定时器决定采样频率的计算公式：</strong><br> Ft=TIMxCLK /TIM_ClockDivision/(1+TIM_Prescaler)/(TIM_Prescaler)</p> 
<p><strong>2、关于ADC扫描模式设置</strong></p> 
<pre><code class="prism language-cpp">   <span class="token comment">//禁止扫描模式，多通道采集才需要	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ScanConvMode <span class="token operator">=</span> DISABLE<span class="token punctuation">;</span> 
</code></pre> 
<p>多通道是指一个或多个ADC的多个通道对数据进行采集。在这里我使用的是单通道。记住<strong>扫描模式对应着多通道</strong>！！果只是用了一个通道的话，DISABLE就可以了，如果使用了多个通道的话，则必须将其设置为ENABLE。<br> <a href="https://www.cnblogs.com/smilingfrog/p/5192324.html" rel="nofollow">对扫描模式的理解</a></p> 
<p><strong>3、关于ADC独立模式</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 独立ADC模式</span>
 ADC_CommonInitStructure<span class="token punctuation">.</span>ADC_Mode <span class="token operator">=</span> ADC_Mode_Independent<span class="token punctuation">;</span>
</code></pre> 
<p>在这个模式下，双ADC不能同步，每个ADC接口独立工作。所以如果不需要ADC同步或者只是用了一个ADC的时候，就应该设成独立模式了。</p> 
<p><strong>4、关于ADC的连续转换</strong></p> 
<pre><code class="prism language-cpp">  <span class="token comment">// 连续转换	</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ContinuousConvMode <span class="token operator">=</span>ENABLE<span class="token punctuation">;</span> 
</code></pre> 
<p>第四个参数是ADC_ContinuousConvMode，这里设置为ENABLE，即连续转换。如果设置为DISABLE，则是单次转换。两者的区别在于连续转换直到所有的数据转换完成后才停止转换，而单次转换则只转换一次数据就停止，要再次触发转换才可以。所以如果需要一次性采集4096个数据或者更多，则采用连续转换。<br> <a href="https://www.cnblogs.com/yangxuli/p/6379474.html" rel="nofollow">关于STM32连续转换和单次转换</a></p> 
<p><strong>5、关于DMA传输模式</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 循环传输模式</span>
DMA_InitStructure<span class="token punctuation">.</span>DMA_Mode <span class="token operator">=</span> DMA_Mode_Normal <span class="token punctuation">;</span>
</code></pre> 
<p>DMA传输模式工作在正常缓存模式，那么每当ADC转换完4096个采样数据时，传输一次后DMA就会停止工作。<br> <a href="https://blog.csdn.net/seek97/article/details/81409996?utm_medium=distribute.pc_relevant.none-task-blog-title-14&amp;spm=1001.2101.3001.4242">关于DMA</a></p> 
<p><strong>6、关于定时器上升沿触发ADC时，定时器选择的问题</strong></p> 
<p>可以选择通用定时器2,3,8，能够生成PWM信号。<br> <img src="https://images2.imgbox.com/32/1b/A8XJumUP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp">  <span class="token comment">//外部触发通道，本例子使用软件触发，此值随便赋值即可</span>
  ADC_InitStructure<span class="token punctuation">.</span>ADC_ExternalTrigConv <span class="token operator">=</span> ADC_ExternalTrigConv_T3_TRGO<span class="token punctuation">;</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//定时器触发定义</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GENERAL_TIM           		TIM3</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GENERAL_TIM_CLK       		RCC_APB1Periph_TIM3</span>

</code></pre> 
<p><strong>7、DMA1通道资源</strong><br> <img src="https://images2.imgbox.com/3e/fc/nbnzCeSC_o.png" alt="在这里插入图片描述"><br> <strong>8、DMA2通道资源</strong><br> <img src="https://images2.imgbox.com/b1/09/fWl7AWLr_o.png" alt="在这里插入图片描述"><br> <strong>9、ADC资源</strong><br> <img src="https://images2.imgbox.com/bb/a2/JmG0nmSP_o.png" alt="在这里插入图片描述"><br> <strong>10、ADC_TwoSamplingDelay 用来设置两个采样阶段之间的延迟周期数</strong><br> 第1次采样和第二次采样之间间隔的周期数。计算方法如下：<br> <img src="https://images2.imgbox.com/c3/46/gpCuH2cc_o.png" alt="在这里插入图片描述"><br> x=ADC_TwoSamplingDelay(采样时间)<br> ADCCLK=45M<br> <img src="https://images2.imgbox.com/eb/63/7gtjBfra_o.png" alt="在这里插入图片描述"><br> 一定要清楚怎么判断每个外设挂载的时钟总线。看英文参考手册！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4842f383c1e62d15fc88c60d5d6a6991/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图像/视频超分之降质过程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/371ea77601087b2177c7c53a6a99c0ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AcWing算法基础课（一）基础算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>