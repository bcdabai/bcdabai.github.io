<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python中mock的使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python中mock的使用" />
<meta property="og:description" content="查了很多资料，很多资料都是把mock跟unittest结合在一起讲的，unittest本身是有一定难度的，其实我们完全可以单独使用mock的。参考文献1中把mock讲的很详细，只要静下心来看，必定收获很多，感谢译者的辛勤付出！参考文献2中有个pdf文档，是最详细的官方文档，大概100页，也很不错，没有深入读了，以后用到了再在这篇博客里更新。 我现在主要是在nose框架下使用的mock，mock主要有name，return_value,side_effect,和spec四个函数，其中的意义都看下面的文档吧。 四个主要的assert方法： assert_called_with 是否调用了这个函数 assert_called_once_with 是否只调用了一次这个函数 assert_has_calls 查看方法调用的顺序 assert_any_calls 是否调用了这个函数，前两个函数只能判断离它们最近的一次调用，这个是全局的。 参见代码： from mock import Mock, call class Order(object): # instance properties _orderItem = &#34;None&#34; _orderAmount = 0 _orderFilled = -1 # Constructor def __init__(self, argItem, argAmount): print &#34;Order:__init__&#34; # set the order item if (isinstance(argItem, str)): if (len(argItem) &gt; 0): self._orderItem = argItem # set the order amount if (argAmount &gt; 0): self._orderAmount = argAmount # Magic methods def __repr__(self): # assemble the dictionary locOrder = {&#39;item&#39;:self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d8a21a94e0b9b1664a626788d1b97c0b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-09-01T17:57:05+08:00" />
<meta property="article:modified_time" content="2014-09-01T17:57:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python中mock的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
      查了很多资料，很多资料都是把mock跟unittest结合在一起讲的，unittest本身是有一定难度的，其实我们完全可以单独使用mock的。参考文献1中把mock讲的很详细，只要静下心来看，必定收获很多，感谢译者的辛勤付出！参考文献2中有个pdf文档，是最详细的官方文档，大概100页，也很不错，没有深入读了，以后用到了再在这篇博客里更新。 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  我现在主要是在nose框架下使用的mock，mock主要有name，return_value,side_effect,和spec四个函数，其中的意义都看下面的文档吧。 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  四个主要的assert方法： 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  assert_called_with  是否调用了这个函数 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  assert_called_once_with  是否只调用了一次这个函数 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  assert_has_calls 查看方法调用的顺序 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  assert_any_calls  是否调用了这个函数，前两个函数只能判断离它们最近的一次调用，这个是全局的。 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit"> 
 <br> 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
  参见代码： 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit"> 
 <pre><code class="language-python">from mock import Mock, call

class Order(object):
    # instance properties
    _orderItem = "None"
    _orderAmount = 0
    _orderFilled = -1
     
    # Constructor
    def __init__(self, argItem, argAmount):
        print "Order:__init__"
         
        # set the order item
        if (isinstance(argItem, str)):
            if (len(argItem) &gt; 0):
                self._orderItem = argItem
         
        # set the order amount
        if (argAmount &gt; 0):
            self._orderAmount = argAmount
         
    # Magic methods
    def __repr__(self):
       # assemble the dictionary
        locOrder = {'item':self._orderItem, 'amount':self._orderAmount}
        return repr(locOrder)
     
    # Instance methods
    # attempt to fill the order
    def fill(self, argSrc):
        print "Order:fill_"
         
        try:
            # does the warehouse has the item in stock?
            if (argSrc is not None):
                if (argSrc.hasInventory(self._orderItem)):
                    # get the item
                    locCount =    argSrc.getInventory(self._orderItem, self._orderAmount)
                 
                    # update the following property
                    self._orderFilled = locCount
                else:
                    print "Inventory item not available"
            else:
                print "Warehouse not available"
        except TypeError:
            print "Invalid warehouse"
     
    # check if the order has been filled
    def isFilled(self):
        print "Order:isFilled_"
        return (self._orderAmount == self._orderFilled)
    
class Warehouse(object):    
    # private properties
    _houseName = None
    _houseList = None
         
    # accessors
    def warehouseName(self):
        return (self._houseName)
     
    def inventory(self):
        return (self._houseList)
     
     
    # -- INVENTORY ACTIONS
    # set up the warehouse
    def setup(self, argName, argList):
        pass
     
    # check for an inventory item
    def hasInventory(self, argItem):
        pass
     
    # retrieve an inventory item
    def getInventory(self, argItem, argCount):
        pass
         
    # add an inventory item
    def addInventory(self, argItem, argCount):
        pass


 
class Test_Order(object):
    # preparing to test
    # objective: creating an order

    def test_orderCheck(self):
        """Test routine C"""
        # creating a test order
        testOrder = Order("mushrooms", 10)
        print repr(testOrder)
         
        fooSource = Mock(spec = Warehouse)
        fooSource.hasInventory.return_value = True
        fooSource.getInventory.return_value = 0
        # perform the test
        assert fooSource != None
        testOrder.fill(fooSource)
         
        # perform the checks
        assert testOrder.isFilled() == False
        assert testOrder._orderFilled == 0
         
        fooSource.hasInventory.assert_called_once_with("mushrooms")
        print fooSource.mock_calls</code></pre> 
 <div style="font-family:微软雅黑; font-size:14px; background-color:inherit"> 
  <br> 
 </div> 参考文献：1.http://www.oschina.net/translate/unit-testing-with-the-python-mock-class 
</div> 
<div style="font-family:微软雅黑; font-size:14px; background-color:inherit">
                   2.https://pypi.python.org/pypi/mock 
 <br> 
 <br> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/345c415da8c0d2b5c045f8bf7c2ca52b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySql通过数据库文件恢复数据库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/839d5f1e0c75b44922379089ecaaa2e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">动态input text 取值（动态id）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>