<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>yolov5facce-landmarks（98点） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="yolov5facce-landmarks（98点）" />
<meta property="og:description" content="关于如何使用自己数据集来训练yolo5vface，主要包括两部分：(1) 数据集标签信息的理解与标签信息格式转换；(2) 基于yolov5face源代码进行后续的代码修改。
主要代码修改部分可直接参考长方形混凝土瞬间移动师-yolov5-face学习笔记
本文仅作为个人的一种记录~~
需要修改好的源码可直接下方留邮箱~
一 数据集 1.首先可根据自己的数据集的标签信息理解/理清每个标签数据的含义（可通过看readme、可视化等等~） 2.理清标注信息后，使用yolov5face源码中data/train2yolo.py进行数据格式的转换。 本文参考的是JD_WFLW合并得到的数据集的label进行label格式转换~
import os.path import sys import torch import torch.utils.data as data import cv2 import numpy as np class WiderFaceDetection(data.Dataset): def __init__(self, data_path, preproc=None): self.preproc = preproc self.imgs_path = [] self.words = [] txt_path = os.path.join(data_path, &#34;labels.txt&#34;) f = open(txt_path, &#39;r&#39;) lines = f.readlines() isFirst = True labels = [] for line in lines[:20]: line = line.strip().split() label = line[1:201] # type(line)：&lt;class &#39;list&#39;&gt;, len(line)：201 label = [float(x) for x in label] imgname = line[0] # 图片名，如：&#39;jd_train_9." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4c5c8bd560df9f2d940ec156b9657195/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-31T14:27:51+08:00" />
<meta property="article:modified_time" content="2022-10-31T14:27:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">yolov5facce-landmarks（98点）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>关于如何使用自己数据集来训练yolo5vface，主要包括两部分：(1) 数据集标签信息的理解与标签信息格式转换；(2) 基于yolov5face源代码进行后续的代码修改。</strong></p> 
<p>主要代码修改部分可直接参考<a href="https://blog.csdn.net/m0_58348465/article/details/121423964?spm=1001.2014.3001.5502">长方形混凝土瞬间移动师-yolov5-face学习笔记</a><br> 本文仅作为个人的一种记录~~</p> 
<p>需要修改好的源码可直接下方留邮箱~</p> 
<h2><a id="__7"></a>一 数据集</h2> 
<h3><a id="1readme_8"></a>1.首先可根据自己的数据集的标签信息理解/理清每个标签数据的含义（可通过看readme、可视化等等~）</h3> 
<h3><a id="2yolov5facedatatrain2yolopy_9"></a>2.理清标注信息后，使用yolov5face源码中data/train2yolo.py进行数据格式的转换。</h3> 
<p><img src="https://images2.imgbox.com/09/e9/3MRROOcp_o.png" alt=""></p> 
<p>本文参考的是JD_WFLW合并得到的数据集的label进行label格式转换~</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os<span class="token punctuation">.</span>path
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> data
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">WiderFaceDetection</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_path<span class="token punctuation">,</span> preproc<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>preproc <span class="token operator">=</span> preproc
        self<span class="token punctuation">.</span>imgs_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        txt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> <span class="token string">"labels.txt"</span><span class="token punctuation">)</span>
        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        isFirst <span class="token operator">=</span> <span class="token boolean">True</span>
        labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
            label <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">201</span><span class="token punctuation">]</span>  <span class="token comment"># type(line)：&lt;class 'list'&gt;, len(line)：201</span>
            label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> label<span class="token punctuation">]</span>
            imgname <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 图片名，如：'jd_train_9.jpg'</span>
            self<span class="token punctuation">.</span>imgs_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> <span class="token string">"images"</span><span class="token punctuation">,</span> imgname<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 图像路径</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>

        <span class="token comment"># self.words.append(labels)</span>
        self<span class="token punctuation">.</span>words <span class="token operator">=</span> labels

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>imgs_path<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>self<span class="token punctuation">.</span>imgs_path<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> _ <span class="token operator">=</span> img<span class="token punctuation">.</span>shape

        labels <span class="token operator">=</span> self<span class="token punctuation">.</span>words<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token comment"># annotations = np.zeros((0, 15))</span>
        annotations <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>labels<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> annotations
        annotation <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 1行201列</span>
        <span class="token comment"># bbox，原label.txt中的后4位是bbox相关坐标信息？</span>

        <span class="token comment"># labels[-4] = (labels[-4] + labels[-2]) / 2 # 中心点坐标x</span>
        <span class="token comment"># labels[-3] = (labels[-3] + labels[-1]) / 2 # 中心点坐标y</span>
        <span class="token comment"># labels[-2] = (labels[-2] - labels[-4]) / 2 # w</span>
        <span class="token comment"># labels[-1] = (labels[-1] - labels[-3]) / 2 # h</span>

        annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>  <span class="token comment"># x1       # annotation[0, 0]：第0行，第0列，即第一个数据</span>
        annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment"># y1</span>
        annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># x2</span>
        annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># y2</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"==============="</span><span class="token punctuation">)</span>
        <span class="token comment"># landmarks，1~196之间的是landmarks相关信息</span>

        <span class="token comment"># for idx, label in enumerate(labels):</span>
        <span class="token keyword">for</span> nx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">+</span>nx<span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span>nx<span class="token punctuation">]</span>

        <span class="token keyword">if</span> annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

        annotations <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>annotations<span class="token punctuation">,</span> annotation<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        target <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>annotations<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>preproc <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            img<span class="token punctuation">,</span> target <span class="token operator">=</span> self<span class="token punctuation">.</span>preproc<span class="token punctuation">(</span>img<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> target


<span class="token keyword">def</span> <span class="token function">detection_collate</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Custom collate fn for dealing with batches of images that have a different
    number of associated object annotations (bounding boxes).

    Arguments:
        batch: (tuple) A tuple of tensor images and lists of annotations

    Return:
        A tuple containing:
            1) (tensor) batch of images stacked on their 0 dim
            2) (list of tensors) annotations for a given image are stacked on 0 dim
    """</span>
    targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    imgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> sample <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> _<span class="token punctuation">,</span> tup <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>tup<span class="token punctuation">)</span><span class="token punctuation">:</span>
                imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tup<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tup<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                annos <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>tup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>annos<span class="token punctuation">)</span>

    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targets


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    original_path <span class="token operator">=</span> <span class="token string">'path'</span>
    save_path <span class="token operator">=</span> <span class="token string">'path'</span>

    aa <span class="token operator">=</span> WiderFaceDetection<span class="token punctuation">(</span>original_path<span class="token punctuation">)</span>
    <span class="token comment"># print(aa)</span>
    <span class="token comment"># print(type(aa))</span>
    <span class="token comment"># tmp = torch.utils.data.DataLoader(aa, batch_size=1)</span>
    <span class="token comment"># for i, (input, target) in enumerate(tmp):</span>
    <span class="token comment">#     print("当前批样例的input为：{}".format(input.size()))</span>
    <span class="token comment">#     print("当前样例的target为：{}".format(target))</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>aa<span class="token punctuation">.</span>imgs_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> aa<span class="token punctuation">.</span>imgs_path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>aa<span class="token punctuation">.</span>imgs_path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># 保存image与label</span>
        base_img <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>aa<span class="token punctuation">.</span>imgs_path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        base_txt <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>aa<span class="token punctuation">.</span>imgs_path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".txt"</span>
        save_img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> base_img<span class="token punctuation">)</span>
        save_txt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> base_txt<span class="token punctuation">)</span>

        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_txt_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> _ <span class="token operator">=</span> img<span class="token punctuation">.</span>shape
            <span class="token comment"># print("height为：{} || width为：{}".format(height, width))</span>
            labels <span class="token operator">=</span> aa<span class="token punctuation">.</span>words<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            annotations <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>labels<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>

            <span class="token comment"># for idx, label in enumerate(labels):</span>
            annotation <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># 注意：lables[-4]，labels[-3]为原标签中的bbox左上角坐标；labels[-2]，labels[-1]为原标签中的bbox的右下角坐标</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> width    <span class="token comment"># cx</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> height    <span class="token comment"># cy</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> width    <span class="token comment"># w</span>
            annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> height    <span class="token comment"># h</span>
            <span class="token comment"># annotation[0, 0] = (labels[0] + labels[2] / 2) / width  # cx</span>
            <span class="token comment"># annotation[0, 1] = (labels[1] + labels[3] / 2) / height  # cy</span>
            <span class="token comment"># annotation[0, 2] = labels[2] / width  # w</span>
            <span class="token comment"># annotation[0, 3] = labels[3] / height  # h</span>

            <span class="token keyword">for</span> nx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> nx <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                    annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">+</span> nx<span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token operator">/</span> width
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">+</span> nx<span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token operator">/</span> height
            str_label <span class="token operator">=</span> <span class="token string">"0"</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># str_label = str_label + " " + str(annotation[0][i])</span>
                str_label <span class="token operator">=</span> str_label <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>annotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># str_label = str_label.replace('[', '').replace(']', '')</span>
            <span class="token comment"># str_label = str_label.replace(',', '') + '\n'</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str_label<span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>save_img_path<span class="token punctuation">,</span> img<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="__179"></a>二 代码修改</h2> 
<p><strong>该部分主要是将yolov5face原有的5个关键点修改为98个关键点（其实其它个数的关键数据的匹配也类似，比如68）</strong></p> 
<p>此部分主要参考的是<a href="https://blog.csdn.net/m0_58348465/article/details/121423964?spm=1001.2014.3001.5502">长方形混凝土瞬间移动师-yoloV5-face学习笔记</a>。<br> 具体详细代码解释、逻辑分析直接跳转以上链接即可，本文仅记录自己98 landmarks的修改部分。</p> 
<h3><a id="1yolopy_Detect_184"></a>1.yolo.py Detect模块</h3> 
<p>由：</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>no <span class="token operator">=</span> nc <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">10</span>  <span class="token comment"># number of outputs per anchor</span>
</code></pre> 
<p>改写为：</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>no <span class="token operator">=</span> nc <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">196</span>  <span class="token comment"># number of outputs per anchor</span>
</code></pre> 
<p>差别就是landmarks的个数。 5 * 2 = 10； 98 * 2 = 196。</p> 
<p>Detect中forward函数内部也需要进行修改。</p> 
<pre><code class="prism language-python"> y <span class="token operator">=</span> y <span class="token operator">+</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token number">201</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">:</span><span class="token number">201</span><span class="token operator">+</span>self<span class="token punctuation">.</span>nc<span class="token punctuation">]</span><span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<p>为了简介，其他地方修改类似~~【把原来跟5 landmarks相关的值改为当前98 landmarks相关的值即可。】</p> 
<h3><a id="2face_datasetspy_203"></a>2.face_datasets.py改写</h3> 
<p>关键点镜像的修改，此处如果不进行修改，可能会造成在最后模型检测时候出现关键点标注错误的问题。</p> 
<pre><code class="prism language-python"> <span class="token comment"># 鼻下：55~59，包括55与59；</span>
                    noseLower_left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">]</span>
                    noseLower_right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">]</span>

                    <span class="token keyword">for</span> noseLower_i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>noseLower_left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        noseLower_tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> noseLower_left<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> noseLower_left<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> noseLower_left<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> noseLower_left<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> noseLower_right<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> noseLower_right<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> noseLower_right<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> noseLower_right<span class="token punctuation">[</span>noseLower_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> noseLower_tmp

                    <span class="token comment"># 唇部：76~95，包括76与95。</span>
                    lip_left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span>
                    lip_right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span>

                    <span class="token keyword">for</span> lip_i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lip_left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        lip_tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> lip_left<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> lip_left<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> lip_left<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> lip_left<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> lip_right<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> lip_right<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> lip_right<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> lip_right<span class="token punctuation">[</span>lip_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> lip_tmp

                    <span class="token comment"># 眼睛：60~75，包括60与75；左眼中心点：96；右眼中心点：97。 </span>
                    eye_left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">]</span>
                    eye_right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span>

                    <span class="token keyword">for</span> eye_i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>eye_left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        eye_tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> eye_left<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> eye_left<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 复制左边的landmarks，得到新变量存放</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> eye_left<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span> eye_left<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> eye_right<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> eye_right<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 将右边对应的镜像赋值给左侧对应的landmarks</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> eye_right<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> eye_right<span class="token punctuation">[</span>eye_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> eye_tmp   <span class="token comment"># 再将新变量中存放的左边镜像赋值给右边镜像中</span>

                    <span class="token comment"># 眉毛：33~50，包括33与50；公式：n * 2 + 5</span>
                    brow_left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span>
                    brow_right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">]</span>

                    <span class="token keyword">for</span> brow_i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>brow_left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        brow_tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> brow_left<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> brow_left<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> brow_left<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> brow_left<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> brow_right<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> brow_right<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> brow_right<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> brow_right<span class="token punctuation">[</span>brow_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> brow_tmp

                    <span class="token comment"># 面部轮廓：0~32，包括0与32；下巴中心为16。</span>
                    face_left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>
                    face_right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span>

                    <span class="token keyword">for</span> face_i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>face_left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        face_tmp <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> face_left<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> face_left<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> face_left<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> face_left<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> face_right<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> face_right<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                        labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> face_right<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> face_right<span class="token punctuation">[</span>face_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> face_tmp
</code></pre> 
<h2><a id="_255"></a>参考资料</h2> 
<p>1.https://blog.csdn.net/m0_58348465/article/details/121423964?spm=1001.2014.3001.5502（代码）；<br> 2.https://blog.csdn.net/IEEE_FELLOW/article/details/112194563?spm=1001.2014.3001.5506（数据）。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de71271b685824c6e5cf873e01282e03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL学习十八、在SQL中使用条件逻辑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d121dde1f58bbd5dae39152d4defec12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity官方FPS教程解析（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>