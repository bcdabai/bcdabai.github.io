<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JMX 介绍 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JMX 介绍" />
<meta property="og:description" content="1. 什么是 JMX JMX （Java Management Extensions）是一个为应用程序，设备，系统等植入管理功能的框架。
JMX 规范可以分为三层： 设备层， 代理层， 分布式服务层。 设备层规范定义了编写可由 JMX 管理的资源的标准，即如何写 MBean； 代理曾规范定义了创建代理的规范，封装了 MBean Server；分布式服务层主要定义了对代理层进行操作的管理接口和构件。
如果一个 Java 对象可以由一个遵循 JMX 规范的管理器应用管理，那么这个Java 对象就可以称为一个可由 JMX 管理的资源。
要使一个 Java 对象可管理，则必须创建相应的 MBean 对象，并通过这些 MBean 对象管理相应的 Java 对象。当拥有 MBean 类后，需要将其实例化并注册到 MBeanServer 上。
一共有四种类型的 MBean ， 分别是标准类型 MBean， 动态类型 MBean， 开放类型 MBean 和模型类型 MBean。我们在下文将分别进行介绍。
2. JMX API 简单介绍 本部分对 JMX 中常用的一些类进行简单的介绍。
2.1 MBeanServer public ObjectInstance createMBean(String className, ObjectName name). 创建 MBean，并将其注册到 MBeanServer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3fbd4bc467a89e337d737a3f8f9be3e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-07-03T21:52:41+08:00" />
<meta property="article:modified_time" content="2013-07-03T21:52:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JMX 介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1. 什么是 JMX</h3> 
<p>         JMX （Java Management Extensions）是一个为应用程序，设备，系统等植入管理功能的框架。</p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/58/4b/JcdJaNzM_o.jpg" alt=""></p> 
</blockquote> 
<p>        JMX 规范可以分为三层： 设备层， 代理层， 分布式服务层。 设备层规范定义了编写可由 JMX 管理的资源的标准，即如何写 MBean； 代理曾规范定义了创建代理的规范，封装了 MBean Server；分布式服务层主要定义了对代理层进行操作的管理接口和构件。</p> 
<p>        如果一个 Java 对象可以由一个遵循 JMX 规范的管理器应用管理，那么这个Java 对象就可以称为一个可由 JMX 管理的资源。</p> 
<p>        要使一个 Java 对象可管理，则必须创建相应的 MBean 对象，并通过这些 MBean 对象管理相应的 Java 对象。当拥有 MBean 类后，需要将其实例化并注册到 MBeanServer 上。</p> 
<p>       一共有四种类型的 MBean ， 分别是标准类型 MBean， 动态类型 MBean， 开放类型 MBean 和模型类型 MBean。我们在下文将分别进行介绍。<br> </p> 
<h3>2. JMX API 简单介绍</h3> 
<p>        本部分对 JMX 中常用的一些类进行简单的介绍。<br> </p> 
<h4>2.1 MBeanServer</h4> 
<h5>public ObjectInstance createMBean(String className, ObjectName name).</h5> 
<p>        创建 MBean，并将其注册到 MBeanServer.<br> </p> 
<h5>public ObjectInstance registerMBean(Object object, ObjectName name).</h5> 
<p>        将Java对象注册到 MBeanServer。<br> </p> 
<h5>public Set queryNames(ObjectName name, QueryExp query).</h5> 
<p>        根据对象名查找注册的 MBean， 返回的 Set 中包含的是查找到的 MBean  对应的 ObjectName。<br> </p> 
<h5>public Set queryMBeans(ObjectName name, QueryExp query).</h5> 
<p>        返回的 Set 中包含的是 ObjectInstance 对象。<br> </p> 
<h5>pubilc Attribute getAttribute(ObjectName name, String attributeName).</h5> 
<p>        返回指定 name 代表的 MBean 的名为 attributeName 的属性。<br> </p> 
<h5>public void setAttribute(ObjectName name, Attribute attr).</h5> 
<p>        设置属性<br> </p> 
<h5>public invoke(ObjectName name, String methodName, ..., ...).</h5> 
<p>       执行 指定 MBean 的指定方法。<br> </p> 
<h4>2.2 MBeanServerFactory</h4> 
<h5>public static MBeanServer createMBeanServer().</h5> 
<p>        创建 MBeanServer.<br> </p> 
<h4>2.3 ObjectName</h4> 
<p>        ObjectName 由两部分组成： domain 和 键/值对。如下面是一个是一个有效的对象名称： <br> </p> 
<p>        myDomain:type=Car,color=blue</p> 
<h5>public ObjectName(String name).</h5> 
<p>        根据 name 构造ObjectName  对象。<br> </p> 
<h4>2.4 ObjectInstance<br> </h4> 
<h4>2.5 Attribute<br> </h4> 
<h3>3. 标准 MBean</h3> 
<p>        标准 MBean 是最简单的 MBean 类型。通过标准 MBean 来管理一个 Java 对象需要以下步骤：</p> 
<p>        1. 创建一个接口， 命名规范为： Java 类名 + MBean 后缀。如 Java 类为 Car ，则需要创建 CarMBean 接口。</p> 
<p>        2. 修改 Java 类，使它实现创建的接口。如上面提到的 CarMBean。</p> 
<p>        3. 创建代理，该代理包含 MBeanServer 实例。</p> 
<p>        4. 为 MBean 创建 ObjectName 实例。</p> 
<p>        5. 实例化 MBeanServer。</p> 
<p>        6. 将 MBean 注册到 MBeanServer。</p> 
<p>        下面我们介绍一个标准 MBean 的例子。如我们有一个 Car 类：</p> 
<p></p> 
<pre><code class="language-java">package test;

public class Car{
	private String color = "red";
	
	public String getColor(){
		return color;
	}
	public void setColor(String color){
		this.color = color;
	}
	public void drive(){
		System.out.println("Baby you can drive my car.");
	}
}
</code></pre>        那么，第一步我们需要创建 名字为 CarMBean 的接口： 
<p></p> 
<p></p> 
<pre><code class="language-java">package test;

public interface CarMBean {
	public String getColor();
	public void setColor(String color);
	public void drive();
}
</code></pre> 
<br>         接下类使 Car 实现 CarMBean： 
<p></p> 
<p></p> 
<pre><code class="language-java">package test;

public class Car implements CarMBean{
	private String color = "red";
	
	public String getColor(){
		return color;
	}
	public void setColor(String color){
		this.color = color;
	}
	public void drive(){
		System.out.println("Baby you can drive my car.");
	}
}
</code></pre> 
<br>         然后创建代理： 
<p></p> 
<p></p> 
<pre><code class="language-java">package test;

import javax.management.Attribute;
import javax.management.MBeanServer;
import javax.management.MBeanServerFactory;
import javax.management.ObjectName;

public class StandardAgent {
	private MBeanServer mBeanServer = null;
	public StandardAgent(){
		mBeanServer = MBeanServerFactory.newMBeanServer();
	}
	
	public MBeanServer getMBeanServer(){
		return mBeanServer;
	}
	
	public ObjectName createObjectName(String name){
		ObjectName objectName = null;
		try{
			objectName = new ObjectName(name);
		}catch(Exception e){
		}
		return objectName;
	}
	private void createStandardBean(ObjectName objectName, String managedResourceClassName){
		try{
			mBeanServer.createMBean(managedResourceClassName, objectName);
		}catch(Exception e){}
	}
	
	public static  void main(String[] args){
		StandardAgent agent = new StandardAgent();
		MBeanServer mBeanServer = agent.getMBeanServer();
		String domain = mBeanServer.getDefaultDomain();
		String managedResourceClassName = "test.Car";
		ObjectName objectName = agent.createObjectName(domain + ":type=" + managedResourceClassName);
		System.out.println("objectName: " + objectName);
		agent.createStandardBean(objectName, managedResourceClassName);
		
		try{
			Attribute colorAttribute = new Attribute("Color", "blue");
			mBeanServer.setAttribute(objectName, colorAttribute);
			System.out.println(mBeanServer.getAttribute(objectName, "Color"));
			mBeanServer.invoke(objectName, "drive", null, null);
		}catch(Exception e){
			e.printStackTrace();
		}
	}
}
</code></pre> 
<br>          该类的 main() 方法首先创建 StandardAgent 的一个实例，并获取 MBeanServer。然后创建 ObjectName 实例，并使用 MBeanServer的默认域作为ObjectName 的域。然后通过 CarMBean 实例来管理 Car 对象。 
<br> 
<p></p> 
<h3>4. 动态 MBean（略）</h3> 
<h3>5. 开放 MBean （略）<br> </h3> 
<h3>6. 模型 MBean</h3> 
<p>        相对于标准 MBean，模型 MBean 更加灵活。如果我们不能修改已有的 Java 类，那么使用模型 MBean 是不错的选择。不过，模型 MBean 直接变成的难度更大一些。后面我们会介绍到使用 Apache 的 Common Modeler 来简化模型 MBean 过程。<br> </p> 
<h4>6.1 模型 MBean 的相关类和接口</h4> 
<h5>ModelMBean 接口</h5> 
<p>        使用模型 MBean，我们不需要像在标准 MBean 中那样定义接口。使用 ModelMBean 接口是不错的选择。<br> </p> 
<h5>RequiredModelMBean 类</h5> 
<p>        JMX 的参考实现中的一个 ModelMBean 接口的默认实现类。<br> </p> 
<h5>ModelMBeanInfo 接口</h5> 
<p>        编写模型 MBean 的最大挑战是告诉 ModelMBean 对象托管资源的哪些属性和方法可以暴露给代理。ModelMBeanInfo 对象描述了将会暴露给代理的构造函数、属性、操作甚至是监听器。</p> 
<p>        创建了 ModelMBeanInfo 对象后，需要将其与 ModelMBean 对象关联。目前有两种方式可以做到这一点：</p> 
<p>        1） 传入 ModelMBeanInfo 对象给 RequiredModelMBean 对象的构造函数。</p> 
<p>        2） 调用 RequiredModelMBean 对象的 setModelMBeanInfo 方法。</p> 
<p>        创建了 ModelMBean 对象后，需要调用 ModelMBean 接口的 setManagedResource() 方法将其与托管资源关联。该方法如下：</p> 
<p>         public void setManagedResource(Object managedResource, String managedResourceType) ;</p> 
<p>        managedResourceType 的值可以为 ObjectReference、Handle、IOR、EJBHandle 或 RMIReference，但当前只支持 ObjectReference。<br> </p> 
<h5>ModelMBeanInfoSupport 类</h5> 
<p>        ModelMBeanInfo 接口的默认实现。该类的构造函数如下：</p> 
<p>        public ModelMBeanInfoSupport(String className, String description, ModelMBeanAttributeInfo[] attributes, ModelMBeanConstructorInfo[] constructors, ModelMBeanOperationInfo[] operations, ModelMBeanNotificationInfo[] notifications);</p> 
<p>        我们接下来介绍参数中出现的几个类。<br> </p> 
<h5>ModelMBeanAttributeInfo 类</h5> 
<p>        模型 MBean 的属性信息。可以通过如下构造函数构造：</p> 
<p>        public ModelMBeanAttributeInfo(String name, String type, String description, boolean isReadable, boolean isWritable, boolean isIs, Descriptor descriptor);<br> </p> 
<h5>ModelMBeanConstructorInfo 类</h5> 
<h5>ModelMBeanOperationInfo 类</h5> 
<p>        构造函数如下：</p> 
<p>        public ModelMBeanOperationInfo(String name, String description, MBeanParameterInfo[] signature, String type, int impact, Descriptor descriptor);<br> </p> 
<h5>ModelMBeanNotificationInfo 类<br> </h5> 
<h4>6.2 模型 MBean 示例<br> </h4> 
<p>        我们需要使用模型 MBean 管理如下所示的 Car 对象：</p> 
<p></p> 
<pre><code class="language-java">package test;

public class Car implements CarMBean{
	private String color = "red";
	
	public String getColor(){
		return color;
	}
	public void setColor(String color){
		this.color = color;
	}
	public void drive(){
		System.out.println("Baby you can drive my car.");
	}
}
</code></pre> 
<br>         对于模型 MBean，不需要像使用标准 MBean 那样自己编写接口并使 Car 继承该接口，而只需实例化 RequiredMBean 类即可。如下的 ModelAgent 类用来创建 ModelMbean 用于管理 Car 对象。 
<p></p> 
<pre><code class="language-java">package test;

import javax.management.Attribute;
import javax.management.Descriptor;
import javax.management.MBeanOperationInfo;
import javax.management.MBeanParameterInfo;
import javax.management.MBeanServer;
import javax.management.MBeanServerFactory;
import javax.management.MalformedObjectNameException;
import javax.management.ObjectName;
import javax.management.modelmbean.DescriptorSupport;
import javax.management.modelmbean.ModelMBean;
import javax.management.modelmbean.ModelMBeanAttributeInfo;
import javax.management.modelmbean.ModelMBeanInfo;
import javax.management.modelmbean.ModelMBeanInfoSupport;
import javax.management.modelmbean.ModelMBeanOperationInfo;
import javax.management.modelmbean.RequiredModelMBean;

public class ModelAgent {
	private String MANAGED_CLASS_NAME = "test.Car";
	private MBeanServer mBeanServer = null;
	
	public ModelAgent(){
		mBeanServer = MBeanServerFactory.createMBeanServer();
	}
	
	public MBeanServer getMBeanServer(){
		return mBeanServer;
	}
	
	private ObjectName createObjectName(String name){
		ObjectName objectName = null;
		try{
			objectName = new ObjectName(name);
		}catch(MalformedObjectNameException e){
			e.printStackTrace();
		}
		return objectName;
	}
	
	private ModelMBean createMBean(ObjectName objectName, String mbeanName){
		ModelMBeanInfo mBeanInfo = createModelMBeanInfo(objectName, mbeanName);
		RequiredModelMBean modelMBean = null;
		try{
			modelMBean = new RequiredModelMBean(mBeanInfo);
		}catch(Exception e){
			e.printStackTrace();
		}
		return modelMBean;
	}
	
	private ModelMBeanInfo createModelMBeanInfo(ObjectName inMbeanObjectName, String inMbeanName){
		ModelMBeanInfo mBeanInfo = null;
		ModelMBeanAttributeInfo[] attributes = new ModelMBeanAttributeInfo[1];
		ModelMBeanOperationInfo[] operations = new ModelMBeanOperationInfo[3];
		try{
			attributes[0] = new ModelMBeanAttributeInfo("Color", "java.lang.String", "the color.", true, true, false, null);
			operations[0] = new ModelMBeanOperationInfo("drive", "the drive method", null, "void", MBeanOperationInfo.ACTION, null);
			operations[1] = new ModelMBeanOperationInfo("getColor", "get color attribute", null, "java.lang.String", MBeanOperationInfo.ACTION, null);
			Descriptor setColorDesc = new DescriptorSupport(new String[]{
					"name=setColor", "descriptorType=operation", "class="+MANAGED_CLASS_NAME, "role=operation"
			});
			MBeanParameterInfo[] setColorParams = new MBeanParameterInfo[]{
				(new MBeanParameterInfo("new color", "java.lang.String", "new Color value"))	
			};
			operations[2] = new ModelMBeanOperationInfo("setColor", "set Color attribute", setColorParams, "void", MBeanOperationInfo.ACTION, setColorDesc);
			mBeanInfo = new ModelMBeanInfoSupport(MANAGED_CLASS_NAME, null, attributes, null, operations, null);
		}catch(Exception e){
			e.printStackTrace();
		}
		return mBeanInfo;
	}
	
	public static void main(String[] args){
		ModelAgent agent = new ModelAgent();
		MBeanServer mBeanServer = agent.getMBeanServer();
		Car car = new Car();
		String domain = mBeanServer.getDefaultDomain();
		ObjectName objectName = agent.createObjectName(domain+":type=MyCar");
		String mBeanName = "myBean";
		ModelMBean modelMBean = agent.createMBean(objectName, mBeanName);
		try{
			//associate the Model MBean with our managed object
			modelMBean.setManagedResource(car, "ObjectReference");
			//register the model MBean to MBeanServer.
			mBeanServer.registerMBean(modelMBean, objectName);
		}catch(Exception e){}
		
		try{
			Attribute attribute = new Attribute("Color", "green");
			mBeanServer.setAttribute(objectName, attribute);
			String color = (String)mBeanServer.getAttribute(objectName, "Color");
			System.out.println("Color:" + color);
			
			attribute = new Attribute("Color", "blueeee");
			mBeanServer.setAttribute(objectName, attribute);
			color = (String)mBeanServer.getAttribute(objectName, "Color");
			System.out.println("Color:" + color);
			
			mBeanServer.invoke(objectName, "drive", null, null);
		}catch(Exception e){
			e.printStackTrace();
		}
	}
}
</code></pre> 
<br> 
<p></p> 
<p><br> </p> 
<h3>7. Apache 的 Commons Modeler 模型 MBean 库</h3> 
<p>        使用 Apache 的 Modeler 库创建 Model MBean 的最大帮助是，我们不需要再写复杂的代码来创建 ModelMBeanInfo 对象了。只需要一个 MBean 描述符来对模型 MBean 进行描述，就可以轻松的创建 Model MBean。<br> </p> 
<h4>1. mbean descriptor (MBean 描述符）</h4> 
<p>        我们先看一个 MBean 描述符的例子：</p> 
<p></p> 
<pre><code class="language-html">&lt;mbean name="StandardServer" 
  className="org.apache.catalina.mbeans.StandardServerMBean" 
  description="Standard Server Component"
  domain="Catalina" 
  group="Server" 
  type="org.apache.catalina.core.StandardServer"&gt;

  &lt;attribute name="debug"
    description="The debugging detail level for this component"
    type="int"/&gt;
  &lt;attribute name="managedResource"
    description="The managed resource this MBean is associated with"
    type="java.lang.Object"/&gt;
  &lt;attribute name="port"
    description="TCP port for shutdown message"
    type="int"/&gt;
  &lt;attribute name="shutdown"
    description="Shutdown password"
    type="java.lang.String"/&gt;
  &lt;operation name="store"
    description="Save current state to server.xml"
    impact="ACTION"
    returnType="void"&gt;
  &lt;/operation&gt;
&lt;/mbean&gt;</code></pre> 
<br>         上面所示代码生命了一个模型 MBean。这个 MBean 有以下特点： 
<p></p> 
<p>        1） 它的唯一标识是 StandardServer。</p> 
<p>        2） 该 MBean 是 StandardServerMBean 的一个对象。</p> 
<p>        3） 它负责管理的对象是 org.apache.catalina.core.StandardServer 类的实例。</p> 
<p>        4） domain 属性是 Catalina； group 属性石 Server</p> 
<p>        5） 这个 MBean 有四个暴露属性： debug、managedResource、port、shutdown，另外还有一个暴露方法 store().<br> </p> 
<p><br> </p> 
<h4>2. Tomcat Modeler 常用类介绍</h4> 
<h5>Registry 类</h5> 
<h5>ManagedBean 类</h5> 
<p>        对 Model MBean 的描述。<br> </p> 
<h5>BaseModelMBean 类</h5> 
<p>        实现了 ModelMBean 接口。使用这个类就不需要 RequiredModelMBean 类了。另外，该类有一个比较有用的字段 resource。resource 字段标识该模型 MBean 管理的资源。如果在 MBean 描述符的声明中没有指定 className，则默认使用 BaseModelMBean。<br> </p> 
<h4>3. 使用 Tomcat Model 实现模型 MBean</h4> 
<p>        我们仍然使用对 Car 类进行管理的例子。</p> 
<p></p> 
<pre><code class="language-java">package test;

public class Car{
	private String color = "red";
	
	public Car(){
		System.out.println("Car constructor");
	}

	public String getColor(){
		return color;
	}
	public void setColor(String color){
		this.color = color;
	}
	public void drive(){
		System.out.println("Baby you can drive my car.");
	}
}</code></pre> 
<br> 我们的 MBean 描述符文件 mbeans-descriptors.xml 文件如下： 
<p></p> 
<p></p> 
<pre><code class="language-html">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mbeans-descriptors PUBLIC
  "-//Apache Software Foundation//DTD Model MBeans Configuration File" 
  "http://jakarta.apache.org/commons/dtds/mbeans-descriptors.dtd"&gt;

&lt;mbeans-descriptors&gt;
  &lt;mbean name="myBean"
    className="javax.management.modelmbean.RequiredModelMBean"
    description="The ModelMBean that manages our Car object"
    type="test.Car"&gt;
  
    &lt;attribute name="Color"
      description="The car color"
      type="java.lang.String"/&gt;
    &lt;operation name="drive"
      description="drive method"
      impact="ACTION"
      returnType="void"&gt;
      &lt;parameter name="driver" description="the driver parameter" type="java.lang.String"/&gt;
    &lt;/operation&gt;
  &lt;/mbean&gt;
&lt;/mbeans-descriptors&gt;</code></pre> 
<br>         代理类 ModelAgent.java 如下所示： 
<br> 
<br> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe727acd8944a5953f27c1746fc798ee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[翻译完成] 用vcgencmd获取树莓派硬件状态数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02eb2a85b8d65689cee12f49020953cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java NIO系列教程（三） Buffer</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>