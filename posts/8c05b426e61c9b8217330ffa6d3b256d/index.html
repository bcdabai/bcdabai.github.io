<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>吃饱没事做——用chatGPT生成图像缩放代码，使用双线性插值 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="吃饱没事做——用chatGPT生成图像缩放代码，使用双线性插值" />
<meta property="og:description" content="这是一个 Verilog 的模块化代码，用于缩放图像。以下是对每行代码的注释解释：
module image_resize( input clk, rst_n, input [31:0] image_in, // 输入图像 input h_sync_in, // 输入水平同步信号 input v_sync_in, // 输入垂直同步信号 output reg [31:0] image_out, // 输出缩放后图像 output reg h_sync_out, // 输出缩放后水平同步信号 output reg v_sync_out // 输出缩放后垂直同步信号 ); 该代码的模块名为 image_resize，有几个输入和输出端口，分别是：clk（时钟信号）、rst_n（复位信号）、image_in（输入图像）、h_sync_in（输入水平同步信号）、v_sync_in（输入垂直同步信号）、image_out（输出缩放后图像）、h_sync_out（输出缩放后水平同步信号）、v_sync_out（输出缩放后垂直同步信号）。其中，[31:0] 表示信号的位宽为 32 位。
parameter W_IN = 2400; parameter H_IN = 1080; parameter W_OUT = 1540; parameter H_OUT = 720; 定义一些参数，分别表示输入图像的宽度和高度、输出图像的宽度和高度。
wire [10:0] h_sync_end = 1547; // 行同步信号结束时机 wire [10:0] v_sync_end = 725; // 场同步信号结束时机 定义行同步信号和场同步信号在输出图像中的结束位置。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8c05b426e61c9b8217330ffa6d3b256d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-23T18:31:58+08:00" />
<meta property="article:modified_time" content="2023-05-23T18:31:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">吃饱没事做——用chatGPT生成图像缩放代码，使用双线性插值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>这是一个 Verilog 的模块化代码，用于缩放图像。以下是对每行代码的注释解释：</p> 
<pre><code class="prism language-verilog">module image_resize(
    input clk, rst_n,
    input [31:0] image_in,        // 输入图像
    input h_sync_in,              // 输入水平同步信号
    input v_sync_in,              // 输入垂直同步信号
    output reg [31:0] image_out,  // 输出缩放后图像
    output reg h_sync_out,        // 输出缩放后水平同步信号
    output reg v_sync_out         // 输出缩放后垂直同步信号
);
</code></pre> 
<p>该代码的模块名为 <code>image_resize</code>，有几个输入和输出端口，分别是：<code>clk</code>（时钟信号）、<code>rst_n</code>（复位信号）、<code>image_in</code>（输入图像）、<code>h_sync_in</code>（输入水平同步信号）、<code>v_sync_in</code>（输入垂直同步信号）、<code>image_out</code>（输出缩放后图像）、<code>h_sync_out</code>（输出缩放后水平同步信号）、<code>v_sync_out</code>（输出缩放后垂直同步信号）。其中，<code>[31:0]</code> 表示信号的位宽为 32 位。</p> 
<pre><code class="prism language-verilog">parameter W_IN = 2400;
parameter H_IN = 1080;
parameter W_OUT = 1540;
parameter H_OUT = 720;
</code></pre> 
<p>定义一些参数，分别表示输入图像的宽度和高度、输出图像的宽度和高度。</p> 
<pre><code class="prism language-verilog">wire [10:0] h_sync_end = 1547; // 行同步信号结束时机
wire [10:0] v_sync_end = 725; // 场同步信号结束时机
</code></pre> 
<p>定义行同步信号和场同步信号在输出图像中的结束位置。</p> 
<pre><code class="prism language-verilog">reg [23:0] x;
reg [9:0] h_counter;
reg [9:0] v_counter;
</code></pre> 
<p>其中，<code>x</code> 表示当前处理到输入图像的第几个像素位置，<code>h_counter</code> 表示当前处理到输出图像的第几行，<code>v_counter</code> 表示当前处理到输出图像的第几场。</p> 
<pre><code class="prism language-verilog">ram ram_inst(   // 定义 RAM 实例
    .clk(clk),
    .rst_n(rst_n),
    .wr_en(h_sync_in &amp;&amp; v_counter &lt; H_OUT),   // 当满足输入同步信号并且输出行数小于输出图像的高度时，RAM 允许写入数据
    .data_in(image_in),
    .addr_in({(v_counter * W_IN + x) &gt;&gt; 2, 2'b00}),   // 将当前输入图像上的位置转换成 RAM 的地址
    .data_out(image_out)
);
</code></pre> 
<p>定义一个 RAM 模块实例，用于存储输入图像的像素值，并根据输出图像的大小进行缩放。其中，<code>.wr_en</code> 表示 RAM 写使能信号，当输出行数小于输出图像高度和输入行数小于输入图像高度都成立时，允许写入数据。<code>.addr_in</code> 表示将输入图像上的像素点转换成 RAM 中的地址。其中，<code>2'b00</code> 表示进一步将地址补齐到 32 位。</p> 
<pre><code class="prism language-verilog">// 行同步信号
always @(posedge clk or negedge rst_n) begin
    if (!rst_n) begin   // 复位时将行同步信号清零
        h_counter &lt;= 0;
        h_sync_out &lt;= 1'b0;
    end else begin
        if (x == h_sync_end) begin   // 当处理到输出图像中的行同步信号位置时，将行计数器清零，并将行同步信号设置为高电平
            h_counter &lt;= 0;
            h_sync_out &lt;= 1'b1;
        end else if (x == W_OUT - 1) begin   // 当处理完一行数据时，将行计数器加 1，并将行同步信号设置为低电平
            h_counter &lt;= h_counter + 1;
            h_sync_out &lt;= 1'b0;
        end
    end
end

// 场同步信号
always @(posedge clk or negedge rst_n) begin
    if (!rst_n) begin   // 复位时将场同步信号清零
        v_counter &lt;= 0;
        v_sync_out &lt;= 1'b0;
    end else begin
        if (v_counter == v_sync_end) begin   // 当处理到输出图像中的场同步信号位置时，将场计数器清零，并将场同步信号设置为高电平
            v_counter &lt;= 0;
            v_sync_out &lt;= 1'b1;
        end else if (x == W_OUT - 1) begin   // 当处理完一行数据时，将场计数器加 1，并将场同步信号设置为低电平
            v_counter &lt;= v_counter + 1;
            v_sync_out &lt;= 1'b0;
        end
    end
end
</code></pre> 
<p>定义两个模块，分别处理行同步信号和场同步信号。其中，行同步信号需要处理输出图像中的行同步信号位置，当处理到该位置时，清零行计数器并将行同步信号设置为高电平；当处理完一行数据时，将行计数器加 1。场同步信号的处理与行同步信号类似。</p> 
<pre><code class="prism language-verilog">always @(posedge clk or negedge rst_n) begin
    if (!rst_n) begin   // 复位时将 x 和输出图像数据清零
        x &lt;= 0;
        image_out &lt;= 0;
    end else begin
        if (v_counter &lt; H_OUT &amp;&amp; x &lt; W_OUT) begin   // 当输出行数小于输出图像高度并且处理到的像素点小于输出图像宽度时，进行缩放处理
            int x_f = (h_counter * W_IN &lt;&lt; 16) / W_OUT;   // 计算水平方向上缩放比例
            int y_f = (v_counter * H_IN &lt;&lt; 16) / H_OUT;   // 计算垂直方向上缩放比例
            
            // 边界处理
            if (x_f &gt;= W_IN) begin   // 当水平方向上的缩放比例大于等于输入图像宽度时，将其限定为输入图像宽度 - 1
                x_f = W_IN - 1;
            end
            
            if (y_f &gt;= H_IN) begin   // 当垂直方向上的缩放比例大于等于输入图像高度时，将其限定为输入图像高度 - 1
                y_f = H_IN - 1;
            end
            
            int x_0 = x_f &gt;&gt; 16;   // 计算缩放后所在像素点的坐标
            int y_0 = y_f &gt;&gt; 16;
            int x_1 = x_0 + 1;
            int y_1 = y_0 + 1;
            int a = x_f - (x_0 &lt;&lt; 16);   // 计算插值使用的系数
            int b = y_f - (y_0 &lt;&lt; 16);
            int A = ram_inst.read({y_0 * W_IN + x_0, 2'd0});   // 从 RAM 中读取数据
            int B = ram_inst.read({y_0 * W_IN + x_1, 2'd0});
            int C = ram_inst.read({y_1 * W_IN + x_0, 2'd0});
            int D = ram_inst.read({y_1 * W_IN + x_1, 2'd0});
            
            // 双线性插值计算
            int temp1 = (1 - a) * A + a * B;
            int temp2 = (1 - a) * C + a * D;
            int output_pixel = ((1 - b) * temp1 + b * temp2) &gt;&gt; 16;   // 将计算结果右移 16 位，转换成 8 位数据
            
            // 将数据放入输出寄存器中
            image_out &lt;= output_pixel;
        end
        
        // 更新 x 的值
        if (x &gt;= W_OUT - 1) begin   // 当处理到输出图像的最后一个像素点时，将 x 重置为 0；否则继续向后处理
            x &lt;= 0;
        end else begin
            x &lt;= x + 1;
        end
    end
end
</code></pre> 
<p>定义一个模块，实现对输入图像的缩放处理，并将处理后的数据放入输出寄存器中。其中，首先根据行计数器和输出宽度计算水平方向上的缩放比例和缩放后所在像素点的坐标，然后从 RAM 中读取这些像素点的数据，并进行双线性插值计算，最后将计算结果放入输出寄存器中。每处理完一个像素点时，更新 <code>x</code> 的取值，用于计算下一个像素点的输出。当处理完输出图像的最后一个像素点时，将 <code>x</code> 重置为 0。</p> 
<pre><code class="prism language-verilog">endmodule
</code></pre> 
<p>结束该 Verilog 模块的定义。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f0dda781149aafe8276926371d08f5f7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">未匹配到本域名(www.xxx.com)有效授权码，请到PbootCMS官网获取</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f37cfefdbae3d80c7aa46f9899cb9b1e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">采用simulink构建AWGN信道中分组码的BPSK数字通信系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>