<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>程序员们，只需三步，教你搭建一个区块链程序 | 经典好文 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="程序员们，只需三步，教你搭建一个区块链程序 | 经典好文" />
<meta property="og:description" content="区块链，大家或许都不陌生，或多或少都对它有一些了解。不过，这些了解可能都是支离破碎的。当问及其中一些概念是如何实现的，你可能就「蒙圈」了。那想了解其中的实现细节怎么办呢？
这篇文章可以手把手的教你搭建一个区块链程序，让你从技术层面，详细了解区块链的实现细节。我相信你把这篇文章的代码跑一遍，你会有一种「哦！原来是这么实现的」想法。下面，我们就来试试吧。
作者 | Daniel van Flymen
译者 | Aholiab、科科
你会点开这篇文章，说明你跟我一样，眼看加密货币价格的暴涨，很想弄清楚区块链到底是什么？背后有哪些技术。
不过，要完全理解区块链不是件容易的事，起码对我而言。为了搞懂区块链，我看过大量的视频、研究过各种教程和为数不多的几个案例，整个过程虐心之极。
所以，我决定在实践中学习。在实践中学习的一大好处是它能逼着你去理解区块链最底层的原理，并且容易让人坚持下去。如果你也想试试这个方法的话，建议你好好读完这篇文章，跟着步骤一步步地去操作。这样，你不仅可以亲自开发出一个功能完备的区块链，同时也搞清楚了区块链的机制到底是什么？
准备工作
在开始之前，我们需要做些准备工作，搞清楚一些问题。
什么是区块链？区块链是由不可变的、有顺序记录的区块组成。他们可以包含交易数据、文件数据或者其他你想要记录的数据。不过最重要的是这些区块通过哈希表链接在一起。
什么是散列？散列函数是一个输入值函数，从该输入创建一个确定输入值的输出值。更多解释可以点击下边这个链接：
﻿https://learncryptography.com/hash-functions/what-are-hash-functions
这篇文章适合谁，首先Python程序员，你只要能轻松地读写一些基本的Python代码就可以了；第二是HTTP程序员，因为我们接下来讲到的区块链，是构建在HTTP上面的，这需要你起码要了解HTTP请求的工作原理。
我需要做什么？首先要确保安装了Python 3.6以上的环境和Flask，此外还需要安装一个碉堡的Requests库。版本信息如下：
pip install Flask==0.12.2 requests==2.18.4 哦对了，你还需要一个HTTP客户端，比如 Postman 或者 cURL
在哪里下载完整代码，请猛戳：
https://github.com/dvf/blockchain。
下面跟着我一步一步来操作吧。
第一步：创建区块链
打开你常用的编辑器，我个人比较喜欢PyCharm。创建一个新的文件，命名为 blockchain.py。整个项目，我们都只会用到这一个文件。有不清楚的地方，可以参考源代码。
表示一个区块链
我们将创建一个 Blockchain 类，它的构造函数里创建了一个初始为空的列表（用于存储我们的区块链），和一个存储交易的列表。下边是这个类的代码：
class Blockchain(object):
def __init__(self):
self.chain = []
self.current_transactions = []
def new_block(self):
# Creates a new Block and adds it to the chain
pass
def new_transaction(self):
# Adds a new transaction to the list of transactions" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8c939f79f3c58106fdf16917a1e716f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-27T21:07:16+08:00" />
<meta property="article:modified_time" content="2018-06-27T21:07:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">程序员们，只需三步，教你搭建一个区块链程序 | 经典好文</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="rich_media_content" id="js_content"> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><img style="text-align:center;width:558px;" src="https://images2.imgbox.com/87/fe/mCImMof8_o.png" alt="640?wx_fmt=jpeg"></p> 
 <p style="margin-left:8px;text-align:justify;line-height:1.75em;"><strong style="font-family:inherit;text-decoration:inherit;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">区块链，大家或许都不陌生，或多或少都对它有一些了解。不过，这些了解可能都是支离破碎的。当问及其中一些概念是如何实现的，你可能就「蒙圈」了。那想了解其中的实现细节怎么办呢？</span></strong><br></p> 
 <p style="white-space:normal;"><br></p> 
 <p style="margin-left:8px;white-space:normal;text-align:justify;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">这篇文章可以手把手的教你搭建一个区块链程序，让你从技术层面，详细了解区块链的实现细节。我相信你把这篇文章的代码跑一遍，你会有一种「哦！原来是这么实现的」想法。下面，我们就来试试吧。</span></strong></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.5px;">作者 | Daniel van Flymen<br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">译者 | Aholiab、科科</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">你会点开这篇文章，说明你跟我一样，眼看加密货币价格的暴涨，很想弄清楚区块链到底是什么？背后有哪些技术。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">不过，要完全理解区块链不是件容易的事，起码对我而言。为了搞懂区块链，我看过大量的视频、研究过各种教程和为数不多的几个案例，整个过程虐心之极。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">所以，我决定在实践中学习。在实践中学习的一大好处是它能逼着你去理解区块链最底层的原理，并且容易让人坚持下去。如果你也想试试这个方法的话，建议你好好读完这篇文章，跟着步骤一步步地去操作。这样，你不仅可以亲自开发出一个功能完备的区块链，同时也搞清楚了区块链的机制到底是什么？</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="letter-spacing:.5px;color:rgb(0,122,170);">准备工作</span></strong></span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在开始之前，我们需要做些准备工作，搞清楚一些问题。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">什么是区块链？区块链是由不可变的、有顺序记录的区块组成。他们可以包含交易数据、文件数据或者其他你想要记录的数据。不过最重要的是这些区块通过哈希表链接在一起。</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"> </span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">什么是散列？散列函数是一个输入值函数，从该输入创建一个确定输入值的输出值。更多解释可以点击下边这个链接：</span></p> 
 <p style="text-align:left;margin-left:8px;line-height:1.75em;"><em><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">﻿https://learncryptography.com/hash-functions/what-are-hash-functions</span></em></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">这篇文章适合谁，首先Python程序员，你只要能轻松地读写一些基本的Python代码就可以了；第二是HTTP程序员，因为我们接下来讲到的区块链，是构建在HTTP上面的，这需要你起码要了解HTTP请求的工作原理。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我需要做什么？首先要确保安装了Python 3.6以上的环境和Flask，此外还需要安装一个碉堡的Requests库。版本信息如下：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs nginx" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"> <span class="hljs-attribute" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">pip</span> install Flask==<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>.<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">12</span>.<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">2</span> requests==<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">2</span>.<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">18</span>.<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">4</span> <br></code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">哦对了，你还需要一个HTTP客户端，比如 Postman 或者 cURL</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在哪里下载完整代码，请猛戳：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><em><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">https://github.com/dvf/blockchain</span></em><em><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">。</span></em></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面跟着我一步一步来操作吧。</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="letter-spacing:.5px;color:rgb(0,122,170);">第一步：创建区块链</span></strong></span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">打开你常用的编辑器，我个人比较喜欢PyCharm。创建一个新的文件，命名为 blockchain.py。整个项目，我们都只会用到这一个文件。有不清楚的地方，可以参考源代码。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">表示一个区块链</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们将创建一个 Blockchain 类，它的构造函数里创建了一个初始为空的列表（用于存储我们的区块链），和一个存储交易的列表。下边是这个类的代码：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs ruby" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span>(<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">object</span>):</span><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">__init__</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>)</span></span>:<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.chain = []<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.current_transactions = []<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_block</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>)</span></span>:<br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Creates a new Block and adds it to the chain</span><br>        pass<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_transaction</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>)</span></span>:<br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Adds a new transaction to the list of transactions</span><br>        pass<br><br>    @staticmethod<br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">hash</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(block)</span></span>:<br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Hashes a Block</span><br>        pass<br><br>    @property<br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">last_block</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>)</span></span>:<br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Returns the last Block in the chain</span><br>        pass</code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">Blockchain参数的作用是管理区块链，也用于存储交易信息和添加区块的方式。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">区块到底长什么样？</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">每一个区块包含一个索引、一个时间戳、一个交易列表、一个证明（之后更多）和前一个区块的哈希值。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">以下是一个区块的例子：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs bash" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">block = {<!-- --><br>    <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>: 1,<br>    <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'timestamp'</span>: 1506057125.900785,<br>    <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'transactions'</span>: [<br>        {<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'sender'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"8527147fe1f5426f9dd545de4b27ee00"</span>,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'recipient'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"a77f5cdfa2934df3954a5c7c7da5df1f"</span>,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'amount'</span>: 5,<br>        }<br>    ],<br>    <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>: 324984774000,<br>    <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'previous_hash'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824"</span><br>}</code></pre> 
 <p style="text-align:justify;margin-left:8px;"><span style="color:rgb(136,136,136);font-size:15px;">代码左滑可查看未显示部分（下同）</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">到这里，区块链的原理就很容易理解了：每一个区块包含它自己本身的一些变量，以及前一个区块的哈希值。这一点非常重要，因为哈希值保证了区块链不可篡改的特性。如果一个区块受到攻击哈希值变了，那么后面的所有区块的哈希值都会为之改变。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">你可能想，我还是不太理解。没关系，先接着往下看。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">在区块上添加交易</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">那么，我们怎么在区块上添加交易呢？可以使用new_transaction()参数。使用方法简单、直接，如下面代码所示：</span></p> 
 <p class="ql-text-indent-1"><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(object)</span>:</span><br>    ...<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_transaction</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self, sender, recipient, amount)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Creates a new transaction to go into the next mined Block<br><br>        :param sender: &lt;str&gt; Address of the Sender<br>        :param recipient: &lt;str&gt; Address of the Recipient<br>        :param amount: &lt;int&gt; Amount<br>        :return: &lt;int&gt; The index of the Block that will hold this transaction<br>        """</span><br><br>        self.current_transactions.append({<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'sender'</span>: sender,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'recipient'</span>: recipient,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'amount'</span>: amount,<br>        })<br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> self.last_block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>] + <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br></code></pre> 
 <p class="ql-text-indent-1"><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在 new_transaction() 添加交易信息到列表中后，它会返回下一个将被开采区块的索引号，交易信息将被打包到这个区块上。这对稍后提交交易的用户有用。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">创建新区块</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在区块链创建完成后，我们需要创建一个创世区块（也就是区块链上的第一个区块）。当然，创世区块也需要被证明，这需要通过PoW的挖矿机制。后边我们会更多的介绍挖矿，这儿就不做过多的介绍了。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">除了在构造函数中创建创始区块，我们还需要用new_block()、new_transaction() 和 hash()参数对其进行完善。代码如下：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> hashlib<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> json<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> time <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> time<br><br><br><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(object)</span>:</span><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">__init__</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self)</span>:</span><br>        self.current_transactions = []<br>        self.chain = []<br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Create the genesis block</span><br>        self.new_block(previous_hash=<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>, proof=<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">100</span>)<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_block</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self, proof, previous_hash=None)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Create a new Block in the Blockchain<br>        :param proof: &lt;int&gt; The proof given by the Proof of Work algorithm<br>        :param previous_hash: (Optional) &lt;str&gt; Hash of previous Block<br>        :return: &lt;dict&gt; New Block<br>        """</span><br><br>        block = {<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>: len(self.chain) + <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'timestamp'</span>: time(),<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'transactions'</span>: self.current_transactions,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>: proof,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'previous_hash'</span>: previous_hash <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">or</span> self.hash(self.chain[<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">-1</span>]),<br>        }<br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Reset the current list of transactions</span><br>        self.current_transactions = []<br><br>        self.chain.append(block)<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> block<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_transaction</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self, sender, recipient, amount)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Creates a new transaction to go into the next mined Block<br>        :param sender: &lt;str&gt; Address of the Sender<br>        :param recipient: &lt;str&gt; Address of the Recipient<br>        :param amount: &lt;int&gt; Amount<br>        :return: &lt;int&gt; The index of the Block that will hold this transaction<br>        """</span><br>        self.current_transactions.append({<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'sender'</span>: sender,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'recipient'</span>: recipient,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'amount'</span>: amount,<br>        })<br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> self.last_block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>] + <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br><br>    @property<br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">last_block</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self)</span>:</span><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> self.chain[<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">-1</span>]<br><br>    @staticmethod<br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">hash</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(block)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Creates a SHA-256 hash of a Block<br>        :param block: &lt;dict&gt; Block<br>        :return: &lt;str&gt;<br>        """</span><br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># We must make sure that the Dictionary is Ordered, or we'll have inconsistent hashes</span><br>        block_string = json.dumps(block, sort_keys=<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">True</span>).encode()<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> hashlib.sha256(block_string).hexdigest()<br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">为了方便大家理解，我在上面代码中加了一些注释。到这里，我们就已经对区块链属性有一个全面的了解了。不过我们还是要知道，区块链是怎么创建、怎么开发，以及跟矿工有什么关系。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">关于工作量证明(PoW）</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">工作证明算法（PoW）的作用，是对区块链上创建或开发新的区块的证明。其背后的核心是：找到一串解决某个数学问题的数字，这个数字必须符合两个条件：</span><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">第一，难找；第二，很容易被验证（而且是很容易被任何人验证）。</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们来举个非常简单的例子来帮助大家理解。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们来看一下这个例子，某个整数 x 乘以另外一个数 y ，得到的结果的哈希值必须是以 0 结尾。可以简单表示为：hash(x * y) = ac23dc...0。所以，我们的目标是找到满足这个条件的一个 y 值。为了方便理解，我们暂定x=5。下面我们就用Python来做这样一个运算：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> hashlib <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> sha256<br>x = <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">5</span><br>y = <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>  <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># We don't know what y should be yet...</span><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">while</span> sha256(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">f'<span class="hljs-subst" style="font-size:inherit;color:inherit;line-height:inherit;">{x*y}</span>'</span>.encode()).hexdigest()[<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">-1</span>] != <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"0"</span>:<br>    y += <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br>print(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">f'The solution is y = <span class="hljs-subst" style="font-size:inherit;color:inherit;line-height:inherit;">{y}</span>'</span>)<br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">最终，计算结果是 y=21。因此，生成的以 0 结尾的哈希值是：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs bash" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">hash</span>(5 * 21) = 1253e9373e...5e3600155e860</code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在比特币中，PoW算法被称为Hashcash，原理跟上面例子差不多。矿工们为了能创建一个新区块，铆足劲儿做着上面的数学题（只有胜出者才能添加区块）。一般而言，证明的难度取决于字符串中搜索的字符数量，先找到正确数字的旷工就能够在每笔交易中获得比特币作为奖励。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">系统能够很容易验证他们的解决方案。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">实现基本的工作量证明</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面在我们刚刚创建好的区块链上，来实现一个相似的工作量证明算法。规则与上边那个简单的例子相似：</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">找到一个数字 p ，它和前边一个区块的解决数字进行散列，生成前4位为 0 的哈希值。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面是具体的Python代码实现：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> hashlib<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> json<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> time <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> time<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> uuid <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> uuid4<br><br><br><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(object)</span>:</span><br>    ...<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">proof_of_work</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self, last_proof)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Simple Proof of Work Algorithm:<br>         - Find a number p' such that hash(pp') contains leading 4 zeroes, where p is the previous p'<br>         - p is the previous proof, and p' is the new proof<br>        :param last_proof: &lt;int&gt;<br>        :return: &lt;int&gt;<br>        """</span><br><br>        proof = <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">while</span> self.valid_proof(last_proof, proof) <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">is</span> <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">False</span>:<br>            proof += <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> proof<br><br>    @staticmethod<br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">valid_proof</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(last_proof, proof)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Validates the Proof: Does hash(last_proof, proof) contain 4 leading zeroes?<br>        :param last_proof: &lt;int&gt; Previous Proof<br>        :param proof: &lt;int&gt; Current Proof<br>        :return: &lt;bool&gt; True if correct, False if not.<br>        """</span><br><br>        guess = <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">f'<span class="hljs-subst" style="font-size:inherit;color:inherit;line-height:inherit;">{last_proof}</span><span class="hljs-subst" style="font-size:inherit;color:inherit;line-height:inherit;">{proof}</span>'</span>.encode()<br>        guess_hash = hashlib.sha256(guess).hexdigest()<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> guess_hash[:<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">4</span>] == <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"0000"</span><br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们可以通过修改哈希值前 0 的数量，来调整算法的难度，一般来说，4位已经是足够了。每在哈希值前多加一个0，计算所花费的时间将呈指数倍增加。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">到这儿，我们的类基本写好了。下面，我们准备通过 HTTP 请求与其交互。</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="font-size:18px;letter-spacing:.5px;color:rgb(0,122,170);">第二步：创建 API</span></strong></span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们打算使用 Python 的 Flask 框架，它是一个轻型框架，可以很容易实现端点到Python函数的映射。这样，我们就可以使用 HTTP 请求通过网页访问我们的区块链了。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们用以下三个方法创建：</span></p> 
 <p><br></p> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">/transactions/new 为一个区块创建一个新的交易；</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">/mine 告诉我们的服务器开采一个新的区块；</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">/chain 返回完整的 Blockchain 类。</span></p></li></ul> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"><br></span></strong></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">搭建 Flask 框架</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们的服务器会在区块链网络中形成单个节点。下面来创建一些样板代码：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> hashlib<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> json<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> textwrap <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> dedent<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> time <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> time<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> uuid <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> uuid4<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> flask <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> Flask<br><br><br><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(object)</span>:</span><br>    ...<br><br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Instantiate our Node</span><br>app = Flask(__name__)<br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Generate a globally unique address for this node</span><br>node_identifier = str(uuid4()).replace(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'-'</span>, <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">''</span>)<br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Instantiate the Blockchain</span><br>blockchain = Blockchain()<br><br><br><span class="hljs-meta" style="font-size:inherit;line-height:inherit;color:rgb(91,218,237);">@app.route('/mine', methods=['GET'])</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">mine</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span>:</span><br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"We'll mine a new Block"</span><br><br><span class="hljs-meta" style="font-size:inherit;line-height:inherit;color:rgb(91,218,237);">@app.route('/transactions/new', methods=['POST'])</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_transaction</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span>:</span><br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"We'll add a new transaction"</span><br><br><span class="hljs-meta" style="font-size:inherit;line-height:inherit;color:rgb(91,218,237);">@app.route('/chain', methods=['GET'])</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">full_chain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span>:</span><br>    response = {<!-- --><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'chain'</span>: blockchain.chain,<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'length'</span>: len(blockchain.chain),<br>    }<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> jsonify(response), <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">200</span><br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> __name__ == <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'__main__'</span>:<br>    app.run(host=<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'0.0.0.0'</span>, port=<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">5000</span>)</code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">我们来简单的解释一下上边的代码：</span></p> 
 <p><br></p> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第15行： 实例化我们的节点；加载 Flask 框架。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第18行：为我们的节点创建一个随机名称。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第21行：实例化 Blockchain 类。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第24-26行：创建 /mine 端点，这是一个GET请求。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第28-30行：创建 /transactions/new 端点，这是一个 POST 请求，我们将用它来发送数据。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第32-38行：创建 /chain 端点，它是用来返回整个 Blockchain 类。</span></p></li></ul> 
 <ul class="ql-long-8866642 list-paddingleft-2" style="margin-left:8px;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">第40-41行：设置服务器运行端口为 5000。</span></p></li></ul> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"><br></span></strong></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">交易节点</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">交易的请求是什么形式呢？下面我们看看用户发送到服务器的一段请求代码：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs json" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">{<!-- --><br> <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"sender"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"my address"</span>,<br> <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"recipient"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"someone else's address"</span>,<br> <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"amount"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">5</span><br>}<br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">因为我们已经写好了将交易打包到区块上的代码，剩下的部分就简单了。只需要调用这个方法，从而实现添加交易的功能。下面是具体代码实现：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> hashlib<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> json<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> textwrap <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> dedent<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> time <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> time<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> uuid <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> uuid4<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> flask <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> Flask, jsonify, request<br><br>...<br><br><span class="hljs-meta" style="font-size:inherit;line-height:inherit;color:rgb(91,218,237);">@app.route('/transactions/new', methods=['POST'])</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">new_transaction</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span>:</span><br>    values = request.get_json()<br><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Check that the required fields are in the POST'ed data</span><br>    required = [<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'sender'</span>, <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'recipient'</span>, <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'amount'</span>]<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">not</span> all(k <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">in</span> values <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">for</span> k <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">in</span> required):<br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'Missing values'</span>, <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">400</span><br><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Create a new Transaction</span><br>    index = blockchain.new_transaction(values[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'sender'</span>], values[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'recipient'</span>], values[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'amount'</span>])<br><br>    response = {<!-- --><span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'message'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">f'Transaction will be added to Block <span class="hljs-subst" style="font-size:inherit;color:inherit;line-height:inherit;">{index}</span>'</span>}<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> jsonify(response), <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">201</span><br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">挖矿节点</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">挖矿节点是整个过程中最有趣的部分，它必须要达到三个目的：</span></p> 
 <p><br></p> 
 <ol class="list-paddingleft-2" style="list-style-type:decimal;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">计算工作量证明；</span></p></li><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">通过打包交易奖励矿工一个币；</span></p></li><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">通过将新块添加到链中来伪造新块。</span></p><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"></span></p></li></ol> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"></span></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> hashlib<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> json<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> time <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> time<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> uuid <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> uuid4<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> flask <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> Flask, jsonify, request<br><br>...<br><br><span class="hljs-meta" style="font-size:inherit;line-height:inherit;color:rgb(91,218,237);">@app.route('/mine', methods=['GET'])</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">mine</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span>:</span><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># We run the proof of work algorithm to get the next proof...</span><br>    last_block = blockchain.last_block<br>    last_proof = last_block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>]<br>    proof = blockchain.proof_of_work(last_proof)<br><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># We must receive a reward for finding the proof.</span><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># The sender is "0" to signify that this node has mined a new coin.</span><br>    blockchain.new_transaction(<br>        sender=<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"0"</span>,<br>        recipient=node_identifier,<br>        amount=<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>    )<br><br>    <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Forge the new Block by adding it to the chain</span><br>    previous_hash = blockchain.hash(last_block)<br>    block = blockchain.new_block(proof, previous_hash)<br><br>    response = {<!-- --><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'message'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"New Block Forged"</span>,<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>: block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'index'</span>],<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'transactions'</span>: block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'transactions'</span>],<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>: block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>],<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'previous_hash'</span>: block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'previous_hash'</span>],<br>    }<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> jsonify(response), <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">200</span></code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">这儿要注意一下，开采区块的接收者是我们节点的地址。在这里完成的大部分工作只是与Blockchain类中的方法进行交互。下面可以开始与我们的区块链交互啦。</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="font-size:18px;letter-spacing:.5px;color:rgb(0,122,170);">第三步：实现与 Blockchain 类交互</span></strong></span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">你可以使用普通的 cURL 或者 Postman 通过网络和刚才生成的 API 进行交互。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">启动服务器：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs cs" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">$ python blockchain.py<br>* Running <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">on</span> http:<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//127.0.0.1:5000/ (Press CTRL+C to quit)</span><br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">通过向以下地址发送请求，我们可以尝试一下挖矿。</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs cpp" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">http:<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//localhost:5000/mine</span><br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">﻿</span><img class="gallery-image" height="438" width="611" src="https://images2.imgbox.com/4f/3d/f64UBWjQ_o.png" alt="640?wx_fmt=png"><span style="font-size:15px;letter-spacing:.5px;">﻿</span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:12px;">使用 Postman 发送 GET 请求</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面我们通过向下面链接发送post请求，来创建一个新的交易：</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><em><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">http://localhost:5000/transactions/new 。</span></em></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">请求中要包含我们的交易结构。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><img class="gallery-image" height="413" width="611" src="https://images2.imgbox.com/18/c7/ev3uj93t_o.png" alt="640?wx_fmt=png"><span style="font-size:15px;letter-spacing:.5px;">﻿</span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:12px;">使用 Postman 发送一个 POST 请求</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">如果你用的是cURL，则可以通过下面代码来实现。</span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"></span></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs makefile" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">$ curl -X POST -H <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"Content-Type: application/json"</span> -d '{<!-- --><br> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"sender"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"d4ee26eee15148ee92c6cd394edd974e"</span>,<br> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"recipient"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"someone-other-address"</span>,<br> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"amount"</span>: 5<br>}' <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"http://localhost:5000/transactions/new"</span></code></pre> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">完成上面步骤之后，需要重启下服务器。这时候，我挖出了2个区块，获得了3个币的奖励。这里，我们还可以像以下地址发送请求，来对整条链进行检查。</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs json" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">{<!-- --><br>  <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"chain"</span>: [<br>    {<!-- --><br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"index"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"previous_hash"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"proof"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">100</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"timestamp"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1506280650.770839</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"transactions"</span>: []<br>    },<br>    {<!-- --><br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"index"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">2</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"previous_hash"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"c099bc...bfb7"</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"proof"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">35293</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"timestamp"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1506280664.717925</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"transactions"</span>: [<br>        {<!-- --><br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"amount"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"recipient"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"8bbcb347e0634905b0cac7955bae152b"</span>,<br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"sender"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"0"</span><br>        }<br>      ]<br>    },<br>    {<!-- --><br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"index"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">3</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"previous_hash"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"eff91a...10f2"</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"proof"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">35089</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"timestamp"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1506280666.1086972</span>,<br>      <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"transactions"</span>: [<br>        {<!-- --><br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"amount"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>,<br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"recipient"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"8bbcb347e0634905b0cac7955bae152b"</span>,<br>          <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"sender"</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"0"</span><br>        }<br>      ]<br>    }<br>  ],<br>  <span class="hljs-attr" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">"length"</span>: <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">3</span><br>}</code></pre> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="font-size:18px;letter-spacing:.5px;color:rgb(0,122,170);"><br></span></strong></span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="font-size:18px;letter-spacing:.5px;color:rgb(0,122,170);"><br></span></strong></span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="font-size:18px;"><strong><span style="font-size:18px;letter-spacing:.5px;color:rgb(0,122,170);">第四步：形成共识</span></strong></span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">终于写到共识了，共识机制是我认为区块链中最有意思的部分。 在上面的步骤中，我们已经创建完成了一个简单的区块链，并且能够实现交易、挖矿等基本功能。 不过，区块链上的节点应该是分散的。 如果它们是分散的，我们究竟如何确保它们记录的都是同一条链？ 这就叫共识问题。如果我们的网络中需要多个节点，我们必须实现共识算法。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">注册新节点</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">在我们实现共识算法之前，需要解决一个问题：在同一个网络上，让其中一个节点知道它的相邻节点有哪些。每一个节点需要网络上的其他节点进行注册。因此，我们将需要更多的节点：</span></p> 
 <p><br></p> 
 <ol class="list-paddingleft-2" style="list-style-type:decimal;"><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">/nodes/register 接受URL形式的新节点列表。</span></p></li><li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">/nodes/resolve 实现我们的共识算法，它可以解决任何争议，保证节点具有正确的链。</span></p></li></ol> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><br></span></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面，我们需要修改Blockchain类的结构，以及找到注册节点实现的方法。</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs python" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">...<br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">from</span> urllib.parse <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">import</span> urlparse<br>...<br><br><br><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(object)</span>:</span><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">__init__</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self)</span>:</span><br>        ...<br>        self.nodes = set()<br>        ...<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">register_node</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(self, address)</span>:</span><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"""<br>        Add a new node to the list of nodes<br>        :param address: &lt;str&gt; Address of node. Eg. 'http://192.168.0.5:5000'<br>        :return: None<br>        """</span><br><br>        parsed_url = urlparse(address)<br>        self.nodes.add(parsed_url.netloc)</code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">这儿需要注意一下，set（）函数用来保存节点列表。 它是确保添加的新节点具有幂等性的方法，意思是无论我们使用这个方法添加特定节点多少次，它都只会出现一次。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">实现共识算法</span></strong></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">先前提到的，当某个节点与另一个节点的记录不一致时，会「打架」。为了解决这个冲突，我们需要制定一个规则，即最长而有效的链是最有权威性的。换句话说，网络上最长的链就是事实。使用这个算法，我们就可以在我们的网络上达成共识。</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs ruby" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">...<br>import requests<br><br><br><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">class</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Blockchain</span>(<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">object</span>)</span><br>    ...<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">valid_chain</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>, chain)</span></span>:<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">""</span><span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"<br>        Determine if a given blockchain is valid<br>        :param chain: &lt;list&gt; A blockchain<br>        :return: &lt;bool&gt; True if valid, False if not<br>        "</span><span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">""</span><br><br>        last_block = chain[<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>]<br>        current_index = <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">while</span> current_index &lt; len(chain):<br>            block = chain[current_index]<br>            print(f<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'{last_block}'</span>)<br>            print(f<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'{block}'</span>)<br>            print(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"\n-----------\n"</span>)<br>            <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Check that the hash of the block is correct</span><br>            <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'previous_hash'</span>] != <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.hash(last_block):<br>                <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> False<br><br>            <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Check that the Proof of Work is correct</span><br>            <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">not</span> <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.valid_proof(last_block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>], block[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'proof'</span>]):<br>                <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> False<br><br>            last_block = block<br>            current_index += <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span><br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> True<br><br>    <span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">resolve_conflicts</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>)</span></span>:<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">""</span><span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"<br>        This is our Consensus Algorithm, it resolves conflicts<br>        by replacing our chain with the longest one in the network.<br>        :return: &lt;bool&gt; True if our chain was replaced, False if not<br>        "</span><span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">""</span><br><br>        neighbours = <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.nodes<br>        new_chain = None<br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># We're only looking for chains longer than ours</span><br>        max_length = len(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.chain)<br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Grab and verify the chains from all the nodes in our network</span><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">for</span> node <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">in</span> <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">neighbours:</span><br>            response = requests.get(f<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'http://{node}/chain'</span>)<br><br>            <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> response.status_code == <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">200</span>:<br>                length = response.json()[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'length'</span>]<br>                chain = response.json()[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'chain'</span>]<br><br>                <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Check if the length is longer and the chain is valid</span><br>                <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> length &gt; max_length <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">and</span> <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.valid_chain(chain):<br>                    max_length = length<br>                    new_chain = chain<br><br>        <span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);"># Replace our chain if we discovered a new, valid chain longer than ours</span><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">new_chain:</span><br>            <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.chain = new_chain<br>            <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> True<br><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> False<br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">其中，valid_chain() 方法是负责校验这一条链是否是有效的，怎么校验呢？遍历每一个区块，验证它们的哈希值和工作量证明。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">resolve_conflicts() 是遍历我们所有相邻节点的方法，会下载它们的链，然后使用上述方法去验证它们。如果找到一个有效的链，其长度大于我们的链，就将我们的链条替换为该链。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">下面我们在API中，注册两个节点，一个用于添加相邻节点，另一个用于解决冲突：</span></p> 
 <p><br></p> 
 <pre style="font-size:inherit;color:inherit;line-height:inherit;"><code class="hljs ruby" style="margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);">@app.route(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'/nodes/register'</span>, methods=[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'POST'</span>])<br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">register_nodes</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span></span>:<br>    values = request.get_json()<br><br>    nodes = values.get(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'nodes'</span>)<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> nodes is <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">None:</span><br>        <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">"Error: Please supply a valid list of nodes"</span>, <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">400</span><br><br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">for</span> node <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">in</span> <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">nodes:</span><br>        blockchain.register_node(node)<br><br>    response = {<!-- --><br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'message'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'New nodes have been added'</span>,<br>        <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'total_nodes'</span>: list(blockchain.nodes),<br>    }<br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> jsonify(response), <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">201</span><br><br><br>@app.route(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'/nodes/resolve'</span>, methods=[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'GET'</span>])<br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">def</span> <span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">consensus</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span></span>:<br>    replaced = blockchain.resolve_conflicts()<br><br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span> <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">replaced:</span><br>        response = {<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'message'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'Our chain was replaced'</span>,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'new_chain'</span>: blockchain.chain<br>        }<br>    <span class="hljs-symbol" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">else:</span><br>        response = {<!-- --><br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'message'</span>: <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'Our chain is authoritative'</span>,<br>            <span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'chain'</span>: blockchain.chain<br>        }<br><br>    <span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span> jsonify(response), <span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">200</span><br></code></pre> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">此时，你可以使用不同机器（或使用同一台机器的不同端口）启动不同的节点。 我是使用的同一台机器，在另外一个端口上创建了另一个节点，并将其注册到当前节点。 因此，我有两个节点：http：// localhost：5000 和 http：// localhost：5001。</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">﻿</span><img class="gallery-image" height="347" width="611" src="https://images2.imgbox.com/61/67/sOZllmkq_o.png" alt="640?wx_fmt=png"><span style="font-size:15px;letter-spacing:.5px;">﻿</span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:12px;">注册一个新的节点</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">然后，我在第二个节点上挖出了一些新的区块，以确保第二个节点的链条比第一个节点的链条更长。 之后，我在第一个节点上调用 GET / nodes / resolve，使其中链通过共识算法被第二个节点的链条取代：</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><img class="gallery-image" height="388" width="611" src="https://images2.imgbox.com/2e/e3/hiqNULPG_o.png" alt="640?wx_fmt=png"><span style="font-size:15px;letter-spacing:.5px;">﻿</span></p> 
 <p style="text-align:center;margin-left:8px;line-height:1.75em;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:12px;">在工作的共识算法</span></p> 
 <p><br></p> 
 <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;">好啦，你已经成功创建好了一个区块链程序，快去叫上你的朋友们来测试一下吧！</span></p> 
 <p><br></p> 
 <p><br></p> 
 <p style="line-height:22px;font-size:18px;"><strong>最新热文：</strong></p> 
 <ul class="list-paddingleft-2" style="margin-left:8px;"><li><p><a target="_blank" href="https://blog.csdn.net/Blockchain_lemon/article/details/80809678" rel="noopener noreferrer">以太坊再爆高危漏洞！黑客增发ATN 1100万枚token事件始末</a><br></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247486930&amp;idx=1&amp;sn=d21cdfe8261a7f344b1de040a1e4100e&amp;chksm=fc7c532fcb0bda398f6c7eec65cabb5a427d26bfce68cb5e9be8ce4341ae9ddada525fd6d028&amp;mpshare=1&amp;scene=21&amp;srcid=0625qdPy1hs4t6AXggryxv30&amp;key=8c5e3354fc665e730fcf00902dcafe8d0c883d2b1f15288a8b35d18367bc7bc1c34cfc028f78ffb7f7ccfe13516ed2713e610750fc5e22cc4c85424348903daffd0db4ff7c52503df0b85c4f47ad7085&amp;ascene=0&amp;uin=MjQ0ODA5ODUwMQ==&amp;devicetype=iMac%20MacBookAir7,2%20OSX%20OSX%2010.12.4%20build%2816E195%29&amp;version=11020201&amp;lang=zh_CN&amp;pass_ticket=7m9eiJQ6ZDJe8BNAmxVWcRtKWV/VkrwssT%20sDCbarfw6rKlFVdyHE6iLlyH5o0LV#wechat_redirect" rel="nofollow" style="color:rgb(0,122,170);text-decoration:underline;font-size:15px;">千万别惹牛人！小哥被盗22元后，整出了这篇以太坊钱包安全攻略，黑客看完得哭了……</a><br></p></li><li><p style="line-height:1.75em;"><a target="_blank" href="https://blog.csdn.net/Blockchain_lemon/article/details/80749537" rel="noopener noreferrer">干货 | 以太坊工具集合，解决你的入门困难</a></p></li><li><p style="line-height:1.75em;"><a target="_blank" href="https://blog.csdn.net/Blockchain_lemon/article/details/80788251" rel="noopener noreferrer">炸了！这家交易所的逆天模式，让赵长鹏完全绷不住了</a></p></li></ul> 
 <br> 
 <br> 
 <p style="white-space:normal;color:rgb(51,51,51);text-align:center;"><img src="https://images2.imgbox.com/55/ff/xBugqAHB_o.png" alt="640?wx_fmt=png"></p> 
 <p style="margin-left:8px;white-space:normal;color:rgb(51,51,51);text-align:center;"><span style="color:rgb(63,63,63);letter-spacing:.5px;"><strong><span style="font-size:15px;">扫码加入区块链大本营读者群，群满加微信 qk15732632926 入群</span></strong></span></p> 
 <p style="white-space:normal;color:rgb(51,51,51);"><br></p> 
 <p style="white-space:normal;color:rgb(51,51,51);"><br></p> 
 <p style="margin-left:8px;white-space:normal;color:rgb(51,51,51);"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"></span></strong></p> 
 <p style="white-space:normal;color:rgb(51,51,51);"><img class="__bg_gif" width="22" style="margin-left:auto;line-height:28px;" src="https://images2.imgbox.com/da/39/ymFtlmVj_o.gif" alt="640?wx_fmt=gif"></p> 
 <p style="white-space:normal;color:rgb(51,51,51);"><br></p> 
 <p style="white-space:normal;color:rgb(51,51,51);"><br></p> 
 <p style="margin-left:8px;white-space:normal;color:rgb(51,51,51);text-align:center;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:14px;color:rgb(0,122,170);">了解更多区块链技术及应用内容</span></strong></span></p> 
 <p style="margin-left:8px;white-space:normal;color:rgb(51,51,51);text-align:center;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:14px;color:rgb(0,122,170);">敬请关注：</span></strong></span></p> 
 <p style="margin-left:8px;white-space:normal;color:rgb(51,51,51);text-align:center;"><img class="__bg_gif" width="512" src="https://images2.imgbox.com/c1/7b/wmKkQpIJ_o.gif" alt="640?wx_fmt=gif"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9dcba4a21e6a864b5e9f086e705c2939/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">idea jfinal tomcat 之打包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3b5e194ae838a3b09f0f375de113df6c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Boost Graph Library 快速入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>