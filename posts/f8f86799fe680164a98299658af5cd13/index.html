<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx的核心功能以及nginx的高可用性 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx的核心功能以及nginx的高可用性" />
<meta property="og:description" content="1.nginx的核心功能 1.1反向代理 反向代理：
反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。
正向代理:
是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。
正向代理和反向代理区别？ 正向代理，是在客户端的。比如需要访问某些国外网站，我们可能需要购买vpn。并且vpn是在我们的用户浏览器端设置的(并不是在远端的服务器设置)。浏览器先访问vpn地址，vpn地址转发请求，并最后将请求结果原路返回来。
反向代理是作用在服务器端的，是一个虚拟ip(VIP)。对于用户的一个请求，会转发到多个后端处理器中的一台来处理该具体请求。
1.1.1nginx如何实现反向代理 准备: (1)springboot项目--部署运行起来，在任意目录下拉入jar包并在当前目录下运行jar包
java -jar jar包名称
注：(1)安装jdk (2)连接的数据所在的服务器必须允许远程访问（3）linux中必须关闭防火墙
修改nginx的配置文件--代理springboot服务器
注：更改nginx配置文件需要重启nginx
/usr/nginx/sbin/nginx -s reload
请求资源：
1.2负载均衡 负载均衡就是一种计算机网络技术，用来在多个计算机（计算机集群）、网络连接、CPU、磁碟驱动器或其他资源中分配负载，以达到最佳化资源使用、最大化吞吐率、最小化响应时间、同时避免过载的目的。
常见负载均衡算法 轮询(Round Robin) 请求到达后，将客户端发送到负载均衡器的请求依次轮流地转发给服务集群的某个节点。
优点：实现简单，每个集群节点平均分担所有的请求。
缺点：当集群中服务器硬件配置不同、性能差别大时，无法区别对待。引出下面的算法。
随机(Random) 随机选取集群中的某个节点来处理该请求，由概率论的知识可知，随着请求量的变大，随机算法会逐渐演变为轮询算法，即集群各个节点会处理差不多数量的请求。
优点：简单使用，不需要额外的配置和算法。
缺点：随机数的特点是在数据量大到一定量时才能保证均衡，所以如果请求量有限的话，可能会达不到均衡负载的要求。
加权 加权算法主要是根据集群的节点对应机器的性能的差异，给每个节点设置一个权重值，其中性能好的机器节点设置一个较大的权重值，而性能差的机器节点则设置一个较小的权重值。权重大的节点能够被更多的选中。它是和随机、轮训一起使用的。
优点：可以根据机器的具体情况，分配不同的负载，达到能者多劳。
缺点：需要额外管理加权系数。
最小连接数 主要是根据集群的每个节点的当前连接数来决定将请求转发给哪个节点，即每次都将请求转发给当前存在最少并发连接的节点。
优点：可以根据集群节点的负载情况来进行请求的动态分发，即机器性能好，处理请求快，积压请求少的节点分配更多的请求。避免某个节点因为处理超过自身所能承受的请求量而导致宕机或者响应过慢。
hash 将对请求的IP地址或者URL计算一个哈希值，然后与集群节点的数量进行取模来决定将请求分发给哪个集群节点。它不是真正意义上的负载均衡，在某些意义上也是一个单点服务。
优点：实现简单
缺点：如果某个节点挂了，会使得一部分流量不可用。
1.2.1轮询 配置代理服务器的nginx.conf
注：更改nginx配置文件需要重启nginx
分别在IP为200的虚拟机开启端口号为8080的jar包和在IP为201的虚拟机开启端口号为8081的jar包。
在浏览器访问代理服务器监听地址，多次刷新，查看返回文本有什么规律
此处以IP地址为201的虚拟机暂时作为代理服务器使用，所以使用的IP地址为201
刷新一次
两个运行的真实服务器组成了服务器集群，使同一个IP地址却有不同的返回文本，访问了不同的端口。两个端口号循环交替访问，这就是轮询。
1.2.2权重 更改代理服务器的nginx.conf文件
权重策略：值越大，权重越高，被访问的频率越高
在浏览器访问代理服务器监听地址，多次刷新，查看返回文本有什么规律
经过多次刷新实验，发现端口号8080每被访问两次，端口号8081才会被访问一次，与我们设置的权重相符。
1.3动静结合 把静态资源和动态资源分离开。静态资源交于nginx服务器统一处理，而动态资源交给tomcat服务器处理。---适合前后端不分离的情况，降低修改和维护成本。
用户通过访问代理服务器的IP地址访问到真实服务器1和2，真实服务器加载动态资源后回到代理服务器访问被统一存放的静态资源，再展现给用户。
1.3.1配置nginx.conf
更改了nginx的配置文件别忘了重启nginx
在nginx目录下创建static目录，将需要的静态资源拉到static目录下
访问代理服务器的监听地址
css和jpg静态资源被加载 2nginx的高可用 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f8f86799fe680164a98299658af5cd13/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-21T17:49:31+08:00" />
<meta property="article:modified_time" content="2023-04-21T17:49:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx的核心功能以及nginx的高可用性</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.nginx的核心功能</h2> 
<h3>1.1反向代理</h3> 
<p><strong> 反向代理：</strong></p> 
<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p> 
<p><strong>正向代理:</strong></p> 
<p>是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。</p> 
<p></p> 
<h4>正向代理和反向代理区别？</h4> 
<p><strong>正向代理</strong>，<strong>是在客户端的。</strong>比如需要访问某些国外网站，我们可能需要购买vpn。并且<strong>vpn是在我们的用户浏览器端设置的</strong>(并不是在远端的服务器设置)。浏览器先访问vpn地址，vpn地址转发请求，并最后将请求结果原路返回来。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6f/76/U3hETCqm_o.png"></p> 
<p></p> 
<p></p> 
<p><strong>反向代理是作用在服务器端的，是一个虚拟ip(VIP)</strong>。对于用户的一个请求，会转发到多个后端处理器中的一台来处理该具体请求。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/54/16/4n5RxHII_o.png"></p> 
<h4>1.1.1nginx如何实现反向代理</h4> 
<p>准备: (1)springboot项目--部署运行起来，在任意目录下拉入jar包并在当前目录下运行jar包</p> 
<blockquote> 
 <p>java -jar jar包名称</p> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong> 注：(1)安装jdk (2)连接的数据所在的服务器必须允许远程访问（3）linux中必须关闭防火墙</strong></span></p> 
<p>修改nginx的配置文件--代理springboot服务器</p> 
<p><img alt="" height="163" src="https://images2.imgbox.com/3d/3a/CGGxoUe4_o.png" width="921"></p> 
<p><span style="color:#fe2c24;"><strong> 注：更改nginx配置文件需要重启nginx</strong></span></p> 
<blockquote> 
 <p>/usr/nginx/sbin/nginx -s reload</p> 
</blockquote> 
<p> 请求资源：<img alt="" height="198" src="https://images2.imgbox.com/11/04/x7ESP1Zp_o.png" width="1183"></p> 
<h3> 1.2负载均衡</h3> 
<p>负载均衡就是一种计算机网络技术，用来在多个计算机（计算机集群）、网络连接、CPU、磁碟驱动器或其他资源中分配负载，以达到最佳化资源使用、最大化吞吐率、最小化响应时间、同时避免过载的目的。</p> 
<p><img alt="" height="565" src="https://images2.imgbox.com/ff/62/ZTiwnzOw_o.png" width="1163"></p> 
<h3>常见负载均衡算法</h3> 
<h3>轮询(Round Robin)</h3> 
<p>请求到达后，将客户端发送到负载均衡器的请求依次轮流地转发给服务集群的某个节点。</p> 
<p>优点：实现简单，每个集群节点平均分担所有的请求。</p> 
<p>缺点：当集群中服务器硬件配置不同、性能差别大时，无法区别对待。引出下面的算法。</p> 
<h3>随机(Random)</h3> 
<p>随机选取集群中的某个节点来处理该请求，由概率论的知识可知，随着请求量的变大，随机算法会逐渐演变为轮询算法，即集群各个节点会处理差不多数量的请求。</p> 
<p>优点：简单使用，不需要额外的配置和算法。</p> 
<p>缺点：随机数的特点是在数据量大到一定量时才能保证均衡，所以如果请求量有限的话，可能会达不到均衡负载的要求。</p> 
<h3>加权</h3> 
<p>加权算法主要是根据集群的节点对应机器的性能的差异，给每个节点设置一个权重值，其中性能好的机器节点设置一个较大的权重值，而性能差的机器节点则设置一个较小的权重值。权重大的节点能够被更多的选中。它是和随机、轮训一起使用的。</p> 
<p>优点：可以根据机器的具体情况，分配不同的负载，达到能者多劳。</p> 
<p>缺点：需要额外管理加权系数。</p> 
<h3>最小连接数</h3> 
<p>主要是根据集群的每个节点的当前连接数来决定将请求转发给哪个节点，即每次都将请求转发给当前存在最少并发连接的节点。</p> 
<p>优点：可以根据集群节点的负载情况来进行请求的动态分发，即机器性能好，处理请求快，积压请求少的节点分配更多的请求。避免某个节点因为处理超过自身所能承受的请求量而导致宕机或者响应过慢。</p> 
<h3>hash</h3> 
<p>将对请求的IP地址或者URL计算一个哈希值，然后与集群节点的数量进行取模来决定将请求分发给哪个集群节点。它不是真正意义上的负载均衡，在某些意义上也是一个单点服务。</p> 
<p>优点：实现简单</p> 
<p>缺点：如果某个节点挂了，会使得一部分流量不可用。</p> 
<h4>1.2.1轮询</h4> 
<p>配置代理服务器的nginx.conf</p> 
<p><img alt="" height="260" src="https://images2.imgbox.com/46/60/tBIpkQRI_o.png" width="918"></p> 
<p><span style="color:#fe2c24;"><strong> 注：更改nginx配置文件需要重启nginx</strong></span></p> 
<p>         分别在IP为200的虚拟机开启端口号为8080的jar包和在IP为201的虚拟机开启端口号为8081的jar包。</p> 
<p>在浏览器访问代理服务器监听地址，多次刷新，查看返回文本有什么规律</p> 
<p>此处以IP地址为201的虚拟机暂时作为代理服务器使用，所以使用的IP地址为201</p> 
<p><img alt="" height="214" src="https://images2.imgbox.com/a4/bf/ZOV2LbrO_o.png" width="598"></p> 
<p>刷新一次</p> 
<p><img alt="" height="259" src="https://images2.imgbox.com/9d/15/mSxw7DGW_o.png" width="570"></p> 
<p><span style="color:#fe2c24;"><strong>两个运行的真实服务器组成了服务器集群，使同一个IP地址却有不同的返回文本，访问了不同的端口。两个端口号循环交替访问，这就是轮询。</strong></span></p> 
<h4><span style="color:#0d0016;">1.2.2权重</span></h4> 
<p><span style="color:#0d0016;">更改代理服务器的nginx.conf文件</span></p> 
<p><img alt="" height="265" src="https://images2.imgbox.com/16/a1/Acb5H2yF_o.png" width="915"></p> 
<p><span style="color:#fe2c24;"><strong> 权重策略：值越大，权重越高，被访问的频率越高</strong></span></p> 
<p><strong> 在浏览器访问代理服务器监听地址，多次刷新，查看返回文本有什么规律</strong></p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/9f/68/tmiwkra9_o.png" width="576"></p> 
<p> <img alt="" height="246" src="https://images2.imgbox.com/83/a8/HCGzCwuh_o.png" width="625"></p> 
<p> <img alt="" height="274" src="https://images2.imgbox.com/aa/39/gfZ9Auun_o.png" width="541"></p> 
<p> 经过多次刷新实验，发现端口号8080每被访问两次，端口号8081才会被访问一次，与我们设置的权重相符。</p> 
<h3>1.3动静结合</h3> 
<p>把静态资源和动态资源分离开。静态资源交于nginx服务器统一处理，而动态资源交给tomcat服务器处理。---适合前后端不分离的情况，降低修改和维护成本。</p> 
<p><img alt="" height="580" src="https://images2.imgbox.com/4d/d8/nxqX9L1O_o.png" width="933"></p> 
<p>        <span style="color:#fe2c24;"><strong> 用户通过访问代理服务器的IP地址访问到真实服务器1和2，真实服务器加载动态资源后回到代理服务器访问被统一存放的静态资源，再展现给用户。</strong></span></p> 
<p>1.3.1配置nginx.conf</p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/05/a8/Cc0I0zuk_o.png" width="919"></p> 
<p></p> 
<p><span style="color:#fe2c24;"><strong> 更改了nginx的配置文件别忘了重启nginx</strong></span></p> 
<p>在nginx目录下创建static目录，将需要的静态资源拉到static目录下</p> 
<p>访问代理服务器的监听地址</p> 
<p><img alt="" height="596" src="https://images2.imgbox.com/94/f9/WC4F3Z6U_o.png" width="1002"></p> 
<p><strong>        css和jpg静态资源被加载 </strong></p> 
<h2> 2nginx的高可用</h2> 
<p><img alt="" height="621" src="https://images2.imgbox.com/66/2f/xPbZ91UR_o.png" width="1125"></p> 
<p><strong> 2.1准备服务器200作为主节点，服务器201作为从节点</strong></p> 
<p><strong><span style="color:#0d0016;"> 2.2主从节点安装</span>keepalived</strong></p> 
<blockquote> 
 <p><strong>yum install -y keepalived  #安装keepalived</strong></p> 
</blockquote> 
<p>  默认安装路径: /etc/keepalived</p> 
<p><strong>2.3修改keepalived.conf的配置内容</strong></p> 
<p> <img alt="" height="942" src="https://images2.imgbox.com/34/26/maaHNPkG_o.png" width="599"></p> 
<p><span style="color:#fe2c24;"><strong> 注：主从节点都需要该配置文件，且内容有部分不同</strong></span></p> 
<p><strong>2.4创建nginx检测脚本</strong></p> 
<p><img alt="" height="465" src="https://images2.imgbox.com/0d/23/ZhSp3kpJ_o.png" width="600"></p> 
<p>两个服务器都开启nginx ，关闭防火墙 ，开启keepalived服务</p> 
<blockquote> 
 <p>systemctl start keepalived.service   开启keepalived服务</p> 
</blockquote> 
<p>测试：</p> 
<p><img alt="" height="446" src="https://images2.imgbox.com/e8/dd/GVYMn2cH_o.png" width="1200"></p> 
<p> 现在关闭主节点再次测试</p> 
<p><img alt="" height="80" src="https://images2.imgbox.com/fc/30/G6GhWt21_o.png" width="975"></p> 
<p> <img alt="" height="500" src="https://images2.imgbox.com/df/ab/ez9n6Mp6_o.png" width="1200"></p> 
<p> 再次打开主节点</p> 
<p><img alt="" height="569" src="https://images2.imgbox.com/79/11/56BFqNYJ_o.png" width="1200"></p> 
<p> 只要主节点开启，从节点就不会有机会被访问，即使主节点暂时挂掉，从节点被访问到，但是当主节点再次开启时，访问端口就会又一次来到主节点。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cad40bcf8c0ce010db646fa8001b804f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用pnpm安装依赖包时报错：EPERM: operation not permitted</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/125dd94e2f24f41ce8940da4e866a3c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu ISO镜像文件下载（Ubuntu 22.04.2 LTS）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>