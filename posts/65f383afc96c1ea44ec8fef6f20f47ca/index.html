<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>服务器中java项目调用Kettle转换脚本ktr - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="服务器中java项目调用Kettle转换脚本ktr" />
<meta property="og:description" content="项目背景 报表导出业务涉及了两个库，所以这就导致了要进行跨库进行查询，在原本的库设计层面，这两个库是完全物理隔绝的，是没办法进行跨表查询的，所以，我就想了个办法来进行数据的迁移，但是组内资金有限，又不可能在申请服务器，引发了我想用基本的 java 代码，写一个 job 定时任务来定时的调用 ktr 文件就可以了
实施过程 一、maven 本地安装 ktr 所需要的 jar 包 ktr 文件如果用编辑器打开的话，是可以看到就是 xml 的文件，所以，它只是个配置文件，其中需要用到好多 jar 包，那么我们需要下载哪些呢，这里我来详细的说明一下
我们在下载了 Kettle 整个项目的时候，我们可以看到它本地是有目录的，如下图所示，重点强调一下，这个 Kettle 是有 JDK 版本之分的，如果你用的是 1.7 的 JDK，你的服务器就要是 1.7 的 JDK，否则的话容易报数组越界，或者导出的数据会有乱码，简单一句话，你开发用的是 1.7 就用 1.7，你开发用的是 1.8 就用 1.8Kettle 下载地址我们把这三个基本的 jar 包通过 maven 的命令导入到我们的本地 maven 库中，我得做法是把这三个包放到一个文件夹目录下面，这样好些命令，然后通过 IDEA 的 maven 导入到本地导入的命令如下
mvn install:install-file -Dfile=D:\1\kettle-core-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=kettle-core -Dversion=8.2.0.0-342 -Dpackaging=jar mvn install:install-file -Dfile=D:\1\kettle-engine-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=kettle-engine -Dversion=8.2.0.0-342 -Dpackaging=jar mvn install:install-file -Dfile=D:\1\metastore-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=metastore -Dversion=8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/65f383afc96c1ea44ec8fef6f20f47ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-05T19:00:04+08:00" />
<meta property="article:modified_time" content="2022-09-05T19:00:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">服务器中java项目调用Kettle转换脚本ktr</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <h2>项目背景</h2> 
 <p>报表导出业务涉及了两个库，所以这就导致了要进行跨库进行查询，在原本的库设计层面，这两个库是完全物理隔绝的，是没办法进行跨表查询的，所以，我就想了个办法来进行数据的迁移，但是组内资金有限，又不可能在申请服务器，引发了我想用基本的 java 代码，写一个 job 定时任务来定时的调用 ktr 文件就可以了</p> 
 <h2>实施过程</h2> 
 <h3>一、maven 本地安装 ktr 所需要的 jar 包</h3> 
 <p>ktr 文件如果用编辑器打开的话，是可以看到就是 xml 的文件，所以，它只是个配置文件，其中需要用到好多 jar 包，那么我们需要下载哪些呢，这里我来详细的说明一下</p> 
 <ol><li><p>我们在下载了 Kettle 整个项目的时候，我们可以看到它本地是有目录的，如下图所示，重点强调一下，这个 Kettle 是有 JDK 版本之分的，如果你用的是 1.7 的 JDK，你的服务器就要是 1.7 的 JDK，否则的话容易报数组越界，或者导出的数据会有乱码，简单一句话，你开发用的是 1.7 就用 1.7，你开发用的是 1.8 就用 1.8Kettle 下载地址<img src="https://images2.imgbox.com/80/cc/9Ry62Fep_o.png" alt="6a974b9fc5cf423e822d1a93de7d3213.png"><img src="https://images2.imgbox.com/5d/c9/z1vJZJQT_o.png" alt="5ee7b14b9eeb0ad2ebb175cf9afaa939.png"><img src="https://images2.imgbox.com/7c/20/6Ym4wYpf_o.png" alt="dc3d97f174214a6259d715b3c678e68d.png">我们把这三个基本的 jar 包通过 maven 的命令导入到我们的本地 maven 库中，我得做法是把这三个包放到一个文件夹目录下面，这样好些命令，然后通过 IDEA 的 maven 导入到本地<img src="https://images2.imgbox.com/4b/98/suXaInWh_o.png" alt="1b6dd11de15123bd75f1ba0a38dbe068.png">导入的命令如下</p></li></ol> 
 <pre class="has"><code class="language-go">mvn install:install-file -Dfile=D:\1\kettle-core-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=kettle-core -Dversion=8.2.0.0-342 -Dpackaging=jar

mvn install:install-file -Dfile=D:\1\kettle-engine-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=kettle-engine -Dversion=8.2.0.0-342 -Dpackaging=jar

mvn install:install-file -Dfile=D:\1\metastore-8.2.0.0-342.jar -DgroupId=pentaho-kettle -DartifactId=metastore -Dversion=8.2.0.0-342 -Dpackaging=jar</code></pre> 
 <p>我是把这三个包复制到了本地的 D 盘中的文件夹 1 当中，如果你想直接用这个命令，就直接按照我的目录格式来，就可以了</p> 
 <h3>二、编写好 ktr 文件，确保本地是可以跑通的在说</h3> 
 <p>将编辑好的 ktr 文件放到本地当中，写一个测试单元来测试这个代码，并且，如果你是跨库的，用到了 mysql 和 Oracle，那么必须要把这两个驱动 jar 包安装到本地，并被引用 引用这三个 mavne 的地址，在 pom 文件中引用这三个 jar 包，</p> 
 <pre class="has"><code class="language-go">&lt;dependency&gt;
            &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
            &lt;artifactId&gt;kettle-core&lt;/artifactId&gt;
            &lt;version&gt;8.2.0.0-342&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
            &lt;artifactId&gt;kettle-engine&lt;/artifactId&gt;
            &lt;version&gt;8.2.0.0-342&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
            &lt;artifactId&gt;metastore&lt;/artifactId&gt;
            &lt;version&gt;8.2.0.0-342&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
 <p>然后写一个单元测试，代码如下</p> 
 <pre class="has"><code class="language-go">@Test
    public void test_path() {
//        可以把文件放到resources目录下面，然后用hutool读取这文件
//        File file = FileUtil.file("33.ktr");
//        这是我本地进行测试的，所以我把文件放到了桌面上了，写了根目录
        File file = FileUtil.file("C:\\Users\\Y\\Desktop\\33.ktr");
        String path = file.getPath();
        System.out.println(path);
//        初始化
        KettleEnvironment.init();
//        加载文件
        TransMeta transMeta = new TransMeta(path);
        Trans trans = new Trans(transMeta);
//        放入参数，这里其实可以从数据库中取到
//        如果没有参数，可以把这步忽略
        trans.setParameterValue("stade", "2019-04-24");
        trans.prepareExecution(null);
        trans.startThreads();
//        等待执行完毕
        trans.waitUntilFinished();
    }</code></pre> 
 <p>这段代码引用了哪些 jar 包呢，如下</p> 
 <pre class="has"><code class="language-go">import cn.hutool.core.io.FileUtil;
import com.google.common.collect.ImmutableMap;
import com.google.common.collect.MapDifference;
import com.google.common.collect.Maps;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.pentaho.di.core.KettleEnvironment;
import org.pentaho.di.trans.Trans;
import org.pentaho.di.trans.TransMeta;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;</code></pre> 
 <p>这些当你复制到文件的时候可能并不知道到底在 maven 中怎么引入这些 jar 包 复制下面的代码到 pom 文件就可以了</p> 
 <pre class="has"><code class="language-go">&lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-vfs2&lt;/artifactId&gt;
            &lt;version&gt;2.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/com.google.guava/guava --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
            &lt;artifactId&gt;guava&lt;/artifactId&gt;
            &lt;version&gt;27.1-jre&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;commons-io&lt;/groupId&gt;
            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
            &lt;version&gt;2.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/commons-lang/commons-lang --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-lang&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
            &lt;version&gt;2.6&lt;/version&gt;
        &lt;/dependency&gt;

      &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
            &lt;version&gt;4.5.6&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
 <p>只有把这些 jar 包都引全了，跑的测试单元代码就不会报错了</p> 
 <h2>End</h2> 
 <p>弄这点东西浪费一下午，不过成果还算可以，可以实现跨库的实现了，就是把另一个库的文件实时的迁移到了本地库中，很奈斯</p> 
 <hr> 
 <p>作者：lovePaul77<br></p> 
 <p>来源链接：</p> 
 <p>https://blog.csdn.net/lovePaul77/article/details/89740087</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/94/ca/YbFximMF_o.png" alt="2ba714654273b97fffc8da5ca8df2f1a.png"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/520a6ebf00aa73bb3726f32d6f0cb9f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VMware与CentOS8-stream的配置教程【2022-9-5】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/11d63205ee2d70a12116b9956c0d60be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java日期格式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>