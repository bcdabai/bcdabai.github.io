<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android全局异常捕获并弹窗提示 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android全局异常捕获并弹窗提示" />
<meta property="og:description" content="Android 难免有崩溃的时候，但是崩溃了该如何处理呢？虽然那天有位同仁说 “既然崩溃了，用户体验就差了，心里会想这是毛APP，下次也不想用了” ，所以检查BUG以防崩溃是必须的，但是也需要一个后备方案，崩溃了能友好些，我们也能收集一些崩溃的信息。 说到全局捕获异常的UncaughtExceptionHandler，就不得不说期间遇到的各种坑： 1. 初始化肯定在Application，网上说的Activity启各种不认同。但在Application启就存在不能弹AlertDialog的问题（目前不确定，不知道是自己哪里没处理好还是的确是这个问题，有时间再验证一下） 2. 崩溃不一定是单次，在多层Activity中，崩溃一个顶层的Activity可能导致下层的Activity连续崩溃，所以uncaughtException可能会捕获到多次崩溃信息（具体影响后面会说到） 先来张崩溃后的效果图： 背景是另一个APP，当前的APP已崩溃并弹出该提示 实现流程： 写个类继承于UncaughtExceptionHandler，实现方法 @Override public void uncaughtException(Thread thread, Throwable ex) { if (!handleException(ex) &amp;&amp; mDefaultHandler != null) { // 如果用户没有处理则让系统默认的异常处理器来处 mDefaultHandler.uncaughtException(thread, ex); } else { // 跳转到崩溃提示Activity Intent intent = new Intent(mContext, CrashDialog.class); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); mContext.startActivity(intent); System.exit(0);// 关闭已奔溃的app进程 } } 然后转handleException方法处理异常： private boolean handleException(Throwable ex) { if (ex == null) { return false; } // 收集错误信息 getCrashInfo(ex); return true; } 上面的代码很清楚了，如果异常被捕获到并且异常信息不会NULL，处理完则跳转到CrashDialog。为什么跳Activity用Dialog样式，而不直接弹AlertDialog，是因为的确弹不出来。 收集错误信息： private void getCrashInfo(Throwable ex) { Writer writer = new StringWriter(); PrintWriter printWriter = new PrintWriter(writer); ex." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1ad0a372a752e41aa4e732dc409953a4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-14T09:36:34+08:00" />
<meta property="article:modified_time" content="2016-12-14T09:36:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android全局异常捕获并弹窗提示</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5 id="android-难免有崩溃的时候但是崩溃了该如何处理呢虽然那天有位同仁说-既然崩溃了用户体验就差了心里会想这是毛app下次也不想用了-所以检查bug以防崩溃是必须的但是也需要一个后备方案崩溃了能友好些我们也能收集一些崩溃的信息">　　Android 难免有崩溃的时候，但是崩溃了该如何处理呢？虽然那天有位同仁说 “既然崩溃了，用户体验就差了，心里会想这是毛APP，下次也不想用了” ，所以检查BUG以防崩溃是必须的，但是也需要一个后备方案，崩溃了能友好些，我们也能收集一些崩溃的信息。</h5> 
<h5 id="说到全局捕获异常的uncaughtexceptionhandler就不得不说期间遇到的各种坑">　　说到全局捕获异常的UncaughtExceptionHandler，就不得不说期间遇到的各种坑：</h5> 
<h5 id="1-初始化肯定在application网上说的activity启各种不认同但在application启就存在不能弹alertdialog的问题目前不确定不知道是自己哪里没处理好还是的确是这个问题有时间再验证一下">　　1. 初始化肯定在Application，网上说的Activity启各种不认同。但在Application启就存在不能弹AlertDialog的问题（目前不确定，不知道是自己哪里没处理好还是的确是这个问题，有时间再验证一下）</h5> 
<h6 id="2-崩溃不一定是单次在多层activity中崩溃一个顶层的activity可能导致下层的activity连续崩溃所以uncaughtexception可能会捕获到多次崩溃信息具体影响后面会说到">　　2. 崩溃不一定是单次，在多层Activity中，崩溃一个顶层的Activity可能导致下层的Activity连续崩溃，所以uncaughtException可能会捕获到多次崩溃信息（具体影响后面会说到）</h6> 
<hr> 
<h3 id="先来张崩溃后的效果图">先来张崩溃后的效果图：</h3> 
<h5 id="背景是另一个app当前的app已崩溃并弹出该提示">背景是另一个APP，当前的APP已崩溃并弹出该提示</h5> 
<p><img src="https://images2.imgbox.com/94/33/VPsOFAIP_o.png" alt="崩溃后" title=""></p> 
<hr> 
<h3 id="实现流程">实现流程：</h3> 
<h5 id="写个类继承于uncaughtexceptionhandler实现方法">写个类继承于UncaughtExceptionHandler，实现方法</h5> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uncaughtException</span>(Thread thread, Throwable ex) {
        <span class="hljs-keyword">if</span> (!handleException(ex) &amp;&amp; mDefaultHandler != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// 如果用户没有处理则让系统默认的异常处理器来处</span>
            mDefaultHandler.uncaughtException(thread, ex);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 跳转到崩溃提示Activity</span>
            Intent intent = <span class="hljs-keyword">new</span> Intent(mContext, CrashDialog.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            mContext.startActivity(intent);
            System.exit(<span class="hljs-number">0</span>);<span class="hljs-comment">// 关闭已奔溃的app进程</span>
        }
    }</code></pre> 
<h5 id="然后转handleexception方法处理异常">然后转handleException方法处理异常：</h5> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">handleException</span>(Throwable ex) {
        <span class="hljs-keyword">if</span> (ex == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// 收集错误信息</span>
        getCrashInfo(ex);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }</code></pre> 
<h5 id="上面的代码很清楚了如果异常被捕获到并且异常信息不会null处理完则跳转到crashdialog为什么跳activity用dialog样式而不直接弹alertdialog是因为的确弹不出来">　　上面的代码很清楚了，如果异常被捕获到并且异常信息不会NULL，处理完则跳转到CrashDialog。为什么跳Activity用Dialog样式，而不直接弹AlertDialog，是因为的确弹不出来。</h5> 
<h5 id="收集错误信息">收集错误信息：</h5> 
<pre class="prettyprint"><code class=" hljs avrasm">private void getCrashInfo(Throwable ex) {
        Writer writer = new StringWriter()<span class="hljs-comment">;</span>
        PrintWriter printWriter = new PrintWriter(writer)<span class="hljs-comment">;</span>
        ex<span class="hljs-preprocessor">.printStackTrace</span>(printWriter)<span class="hljs-comment">;</span>
        Throwable cause = ex<span class="hljs-preprocessor">.getCause</span>()<span class="hljs-comment">;</span>
        while (cause != null) {
            cause<span class="hljs-preprocessor">.printStackTrace</span>(printWriter)<span class="hljs-comment">;</span>
            cause = cause<span class="hljs-preprocessor">.getCause</span>()<span class="hljs-comment">;</span>
        }
        printWriter<span class="hljs-preprocessor">.close</span>()<span class="hljs-comment">;</span>
        String errorMessage = writer<span class="hljs-preprocessor">.toString</span>()<span class="hljs-comment">;</span>
        if (Environment<span class="hljs-preprocessor">.getExternalStorageState</span>()<span class="hljs-preprocessor">.equals</span>(Environment<span class="hljs-preprocessor">.MEDIA</span>_MOUNTED)) {
            String mFilePath = Environment<span class="hljs-preprocessor">.getExternalStorageDirectory</span>() + <span class="hljs-string">"/"</span> + App<span class="hljs-preprocessor">.ERROR</span>_FILENAME<span class="hljs-comment">;</span>
            FileTxt<span class="hljs-preprocessor">.WirteTxt</span>(mFilePath, FileTxt<span class="hljs-preprocessor">.ReadTxt</span>(mFilePath) + <span class="hljs-string">'\n'</span> + errorMessage)<span class="hljs-comment">;</span>
        } else {
            Log<span class="hljs-preprocessor">.i</span>(App<span class="hljs-preprocessor">.TAG</span>, <span class="hljs-string">"哦豁，说好的SD呢..."</span>)<span class="hljs-comment">;</span>
        }
    }</code></pre> 
<h5 id="是的我把错误信息写到了存储并在刚才的crashdialog中读取为什么不直接传值呢因为刚说到的坑第2条多次崩溃的情况下将导致直接传值只会传最后一次崩溃信息而最后一次崩溃信息并不是主要引发崩溃的点收集上来的错误信息可读性不大那为什么我不写个全局变量来存储呢因为尝试过不知道是机型问题huawei-mate7-api-23还是全部问题变量压根就不记录数据最后只有将信息依次写到存储">　　是的，我把错误信息写到了存储并在刚才的CrashDialog中读取。为什么不直接传值呢？因为刚说到的坑第2条，多次崩溃的情况下，将导致直接传值只会传最后一次崩溃信息，而最后一次崩溃信息并不是主要引发崩溃的点，收集上来的错误信息可读性不大。那为什么我不写个全局变量来存储呢？因为尝试过，不知道是机型问题(Huawei Mate7 - API 23)还是全部问题，变量压根就不记录数据，最后只有将信息依次写到存储。</h5> 
<hr> 
<h3 id="主要代码">主要代码</h3> 
<h5 id="appjava">App.java</h5> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.qson.androidcrash;

<span class="hljs-javadoc">/**
 * <span class="hljs-javadoctag"> @author</span> x024
 */</span>

<span class="hljs-keyword">import</span> android.app.Application;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Application</span> {<!-- --></span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String TAG = <span class="hljs-string">"x024"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String ERROR_FILENAME = <span class="hljs-string">"x024_error.log"</span>;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>() {
        <span class="hljs-keyword">super</span>.onCreate();

        CrashHanlder.getInstance().init(<span class="hljs-keyword">this</span>);

    }
}</code></pre> 
<h5 id="crashhanlderjava">CrashHanlder.java</h5> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.qson.androidcrash;

<span class="hljs-javadoc">/**
 * <span class="hljs-javadoctag"> @author</span> x024
 */</span>

<span class="hljs-keyword">import</span> java.io.PrintWriter;
<span class="hljs-keyword">import</span> java.io.StringWriter;
<span class="hljs-keyword">import</span> java.io.Writer;
<span class="hljs-keyword">import</span> java.lang.Thread.UncaughtExceptionHandler;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.Environment;
<span class="hljs-keyword">import</span> android.util.Log;

<span class="hljs-javadoc">/**
 * 收集错误报告并上传到服务器
 * 
 *<span class="hljs-javadoctag"> @author</span> x024
 *
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrashHanlder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UncaughtExceptionHandler</span> {<!-- --></span>
    <span class="hljs-keyword">private</span> Thread.UncaughtExceptionHandler mDefaultHandler;
    <span class="hljs-comment">// CrashHandler实例</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CrashHanlder INSTANCE = <span class="hljs-keyword">new</span> CrashHanlder();
    <span class="hljs-comment">// 程序的Context对象</span>
    <span class="hljs-keyword">private</span> Context mContext;

    <span class="hljs-keyword">private</span> <span class="hljs-title">CrashHanlder</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CrashHanlder <span class="hljs-title">getInstance</span>() {
        <span class="hljs-keyword">return</span> INSTANCE;
    }

    <span class="hljs-javadoc">/**
     * 初始化
     * 
     *<span class="hljs-javadoctag"> @param</span> context
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span>(Context context) {
        mContext = context;
        <span class="hljs-comment">// 获取系统默认的UncaughtException处理</span>
        mDefaultHandler = Thread.getDefaultUncaughtExceptionHandler();
        <span class="hljs-comment">// 设置该CrashHandler为程序的默认处理</span>
        Thread.setDefaultUncaughtExceptionHandler(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-javadoc">/**
     * 异常捕获
     */</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uncaughtException</span>(Thread thread, Throwable ex) {
        <span class="hljs-keyword">if</span> (!handleException(ex) &amp;&amp; mDefaultHandler != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// 如果用户没有处理则让系统默认的异常处理器来处</span>
            mDefaultHandler.uncaughtException(thread, ex);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 跳转到崩溃提示Activity</span>
            Intent intent = <span class="hljs-keyword">new</span> Intent(mContext, CrashDialog.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            mContext.startActivity(intent);
            System.exit(<span class="hljs-number">0</span>);<span class="hljs-comment">// 关闭已奔溃的app进程</span>
        }
    }

    <span class="hljs-javadoc">/**
     * 自定义错误捕获
     * 
     *<span class="hljs-javadoctag"> @param</span> ex
     *<span class="hljs-javadoctag"> @return</span> true:如果处理了该异常信息;否则返回false.
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">handleException</span>(Throwable ex) {
        <span class="hljs-keyword">if</span> (ex == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// 收集错误信息</span>
        getCrashInfo(ex);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-javadoc">/**
     * 收集错误信息
     * 
     *<span class="hljs-javadoctag"> @param</span> ex
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getCrashInfo</span>(Throwable ex) {
        Writer writer = <span class="hljs-keyword">new</span> StringWriter();
        PrintWriter printWriter = <span class="hljs-keyword">new</span> PrintWriter(writer);
        ex.printStackTrace(printWriter);
        Throwable cause = ex.getCause();
        <span class="hljs-keyword">while</span> (cause != <span class="hljs-keyword">null</span>) {
            cause.printStackTrace(printWriter);
            cause = cause.getCause();
        }
        printWriter.close();
        String errorMessage = writer.toString();
        <span class="hljs-keyword">if</span> (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            String mFilePath = Environment.getExternalStorageDirectory() + <span class="hljs-string">"/"</span> + App.ERROR_FILENAME;
            FileTxt.WirteTxt(mFilePath, FileTxt.ReadTxt(mFilePath) + <span class="hljs-string">'\n'</span> + errorMessage);
        } <span class="hljs-keyword">else</span> {
            Log.i(App.TAG, <span class="hljs-string">"哦豁，说好的SD呢..."</span>);
        }

    }

}
</code></pre> 
<h5 id="crashdialogjava">CrashDialog.java</h5> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.qson.androidcrash;

<span class="hljs-javadoc">/**
 * <span class="hljs-javadoctag"> @author</span> x024
 */</span>

<span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.FileNotFoundException;
<span class="hljs-keyword">import</span> java.io.FileReader;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.app.ActivityManager;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.Build;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Environment;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.View.OnClickListener;
<span class="hljs-keyword">import</span> android.widget.Button;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrashDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> String mFilePath;
    <span class="hljs-keyword">private</span> Button btnExit, btnRestart;
    <span class="hljs-keyword">private</span> Boolean StorageState = <span class="hljs-keyword">false</span>;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_crash);
        CrashDialog.<span class="hljs-keyword">this</span>.setFinishOnTouchOutside(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">if</span> (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            mFilePath = Environment.getExternalStorageDirectory() + <span class="hljs-string">"/"</span> + App.ERROR_FILENAME;
            StorageState = <span class="hljs-keyword">true</span>;
        } <span class="hljs-keyword">else</span> {
            Log.i(App.TAG, <span class="hljs-string">"哦豁，说好的SD呢..."</span>);
        }

        <span class="hljs-keyword">new</span> Thread(upLog).start();
        initView();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>() {
        btnExit = (Button) findViewById(R.id.cash_exit);
        btnRestart = (Button) findViewById(R.id.cash_restart);

        btnExit.setOnClickListener(mOnClick);
        btnRestart.setOnClickListener(mOnClick);

    }

    OnClickListener mOnClick = <span class="hljs-keyword">new</span> OnClickListener() {

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View v) {
            <span class="hljs-keyword">switch</span> (v.getId()) {
            <span class="hljs-keyword">case</span> R.id.cash_exit:
                exit();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.cash_restart:
                restart();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">break</span>;
            }
        }
    };

    <span class="hljs-comment">// 上传错误信息</span>
    Runnable upLog = <span class="hljs-keyword">new</span> Runnable() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
            <span class="hljs-keyword">try</span> {

                String Mobile = Build.MODEL;
                String maxMemory = <span class="hljs-string">""</span> + getmem_TOLAL() / <span class="hljs-number">1024</span> + <span class="hljs-string">"m"</span>;
                String nowMemory = <span class="hljs-string">""</span> + getmem_UNUSED(CrashDialog.<span class="hljs-keyword">this</span>) / <span class="hljs-number">1024</span> + <span class="hljs-string">"m"</span>;
                String eMessage = <span class="hljs-string">"未获取到错误信息"</span>;
                <span class="hljs-keyword">if</span> (StorageState) {
                    eMessage = FileTxt.ReadTxt(mFilePath).replace(<span class="hljs-string">"'"</span>, <span class="hljs-string">""</span>);
                }
                Log.i(App.TAG, <span class="hljs-string">"Mobile:"</span> + Mobile + <span class="hljs-string">" | maxMemory:"</span> + maxMemory + <span class="hljs-string">" |nowMemory:"</span> + nowMemory
                        + <span class="hljs-string">" |eMessage:"</span> + eMessage);

                <span class="hljs-javadoc">/**
                 * 可以在这调你自己的接口上传信息
                 */</span>
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    };

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exit</span>() {
        FileTxt.deleteFile(mFilePath);
        System.exit(<span class="hljs-number">0</span>);
        android.os.Process.killProcess(android.os.Process.myPid());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">restart</span>() {
        Intent intent = getBaseContext().getPackageManager()
                .getLaunchIntentForPackage(getBaseContext().getPackageName());
        intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);
        startActivity(intent);
        exit();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBackPressed</span>() {
        <span class="hljs-keyword">super</span>.onBackPressed();
        exit();
    }

    <span class="hljs-comment">// 获取可用内存</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getmem_UNUSED</span>(Context mContext) {
        <span class="hljs-keyword">long</span> MEM_UNUSED;
        ActivityManager am = (ActivityManager) mContext.getSystemService(Context.ACTIVITY_SERVICE);
        ActivityManager.MemoryInfo mi = <span class="hljs-keyword">new</span> ActivityManager.MemoryInfo();
        am.getMemoryInfo(mi);

        MEM_UNUSED = mi.availMem / <span class="hljs-number">1024</span>;
        <span class="hljs-keyword">return</span> MEM_UNUSED;
    }

    <span class="hljs-comment">// 获取剩余内存</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getmem_TOLAL</span>() {
        <span class="hljs-keyword">long</span> mTotal;
        String path = <span class="hljs-string">"/proc/meminfo"</span>;
        String content = <span class="hljs-keyword">null</span>;
        BufferedReader br = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            br = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(path), <span class="hljs-number">8</span>);
            String line;
            <span class="hljs-keyword">if</span> ((line = br.readLine()) != <span class="hljs-keyword">null</span>) {
                content = line;
            }
        } <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
            e.printStackTrace();
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (br != <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">try</span> {
                    br.close();
                } <span class="hljs-keyword">catch</span> (IOException e) {
                    e.printStackTrace();
                }
            }
        }
        <span class="hljs-keyword">int</span> begin = content.indexOf(<span class="hljs-string">':'</span>);
        <span class="hljs-keyword">int</span> end = content.indexOf(<span class="hljs-string">'k'</span>);

        content = content.substring(begin + <span class="hljs-number">1</span>, end).trim();
        mTotal = Integer.parseInt(content);
        <span class="hljs-keyword">return</span> mTotal;
    }

}</code></pre> 
<h4 id="完整代码httpdownloadcsdnnetdetailhx70139710757">完整代码：<a href="http://download.csdn.net/detail/hx7013/9710757">http://download.csdn.net/detail/hx7013/9710757</a></h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1a52725e93b59e68190ba8f66d4a16f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【网络知识点】网络基本架构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a8f8d2e17adba5eda1414e8c7241c97b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分别使用sk-learn和mllib进行文本情感分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>