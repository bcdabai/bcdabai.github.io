<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>任意文件读取 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="任意文件读取" />
<meta property="og:description" content="文章目录 一、任意文件读取概述1.1 漏洞成因1.2 漏洞危害1.3 漏洞分类1.4 任意文件读取1.4.1 文件读取1.4.2 任意文件读取 1.5 任意文件下载1.5.1 一般情况1.5.2 PHP实现1.5.3 任意文件下载 二、任意文件读取攻防2.1 路径过滤2.1.1 过滤`../` 2.2 简单绕过2.2.1 双写绕过2.2.2 绝对路径2.2.3 使用`..\` 三、 任意文件读取挖掘3.1 手动挖掘3.2 经典案例 四、漏洞修复方案4.1 输入验证4.2 避免其他漏洞4.3 限定文件的访问范围 五、参考连接 一、任意文件读取概述 ​ 一些网站的需求，可能会提供文件查看与下载的功能。如果对用户查看或下载的文件没有限制或者限制绕过，就可以查看或下载任意文件。这些文件可以是源代码文件，配置文件，敏感文件等等。
任意文件读取会造成（敏感）信息泄露；
任意文件读取大多数是由于其他漏洞引发的，如，RCE、目录遍历、文件包含等。
任意文件读取与任意文件下载本质上没有区别，信息都是从服务端流向浏览器的。
​ 文件读取与下载可能形式不同，但是从本质上讲读取与下载没有区别，从权限角度来讲，读取与下载都
需要读权限。
1.1 漏洞成因 不管是任意文件读取还是任意文件下载，触发漏洞的条件都是相同的：
存在读取文件的功能（函数），也就是说，Web应用开放了文件读取功能；读取文件的路径客户端可控，完全控制或影响文件路径参数；没有对文件路径进行校验或者校验不严导致校验被绕过；输出了文件的内容。 1.2 漏洞危害 ​ 下载服务器任意文件，包括源代码文件、系统敏感文件、配置文件等等。
​ 可以配合其他漏洞，构成完整攻击链。对源代码文件进行代码审计，查找更多的漏洞。
​ 任意文件读取与下载重点关注的文件：
源代码配置文件敏感文件日志文件… 1.3 漏洞分类 任意文件读取任意文件下载 1.4 任意文件读取 以PHP脚本为例子，有一些函数可以实现文件读取功能。
1.4.1 文件读取 读取文件的函数函数特点readfile()直接读取文件内容
自带输出功能file_get_contents()直接读取文件内容
需要输出读取内容fread()打开文件
计算文件大小
读取文件
输出文件
关闭文件 readfile :" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b858ae869a30162f5b0269da4e6a3780/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-31T21:33:43+08:00" />
<meta property="article:modified_time" content="2023-08-31T21:33:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">任意文件读取</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、任意文件读取概述</a></li><li><ul><li><a href="#11___14" rel="nofollow">1.1 漏洞成因</a></li><li><a href="#12___23" rel="nofollow">1.2 漏洞危害</a></li><li><a href="#13___36" rel="nofollow">1.3 漏洞分类</a></li><li><a href="#14___43" rel="nofollow">1.4 任意文件读取</a></li><li><ul><li><a href="#141__49" rel="nofollow">1.4.1 文件读取</a></li><li><a href="#142___158" rel="nofollow">1.4.2 任意文件读取</a></li></ul> 
   </li><li><a href="#15___199" rel="nofollow">1.5 任意文件下载</a></li><li><ul><li><a href="#151___201" rel="nofollow">1.5.1 一般情况</a></li><li><a href="#152__PHP_213" rel="nofollow">1.5.2 PHP实现</a></li><li><a href="#153___233" rel="nofollow">1.5.3 任意文件下载</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_255" rel="nofollow">二、任意文件读取攻防</a></li><li><ul><li><a href="#21___257" rel="nofollow">2.1 路径过滤</a></li><li><ul><li><a href="#211___259" rel="nofollow">2.1.1 过滤`../`</a></li></ul> 
   </li><li><a href="#22___269" rel="nofollow">2.2 简单绕过</a></li><li><ul><li><a href="#221___271" rel="nofollow">2.2.1 双写绕过</a></li><li><a href="#222___282" rel="nofollow">2.2.2 绝对路径</a></li><li><a href="#223___290" rel="nofollow">2.2.3 使用`..\`</a></li></ul> 
  </li></ul> 
  </li><li><a href="#__330" rel="nofollow">三、 任意文件读取挖掘</a></li><li><ul><li><a href="#31___332" rel="nofollow">3.1 手动挖掘</a></li><li><a href="#32___340" rel="nofollow">3.2 经典案例</a></li></ul> 
  </li><li><a href="#_346" rel="nofollow">四、漏洞修复方案</a></li><li><ul><li><a href="#41___348" rel="nofollow">4.1 输入验证</a></li><li><a href="#42___352" rel="nofollow">4.2 避免其他漏洞</a></li><li><a href="#43___356" rel="nofollow">4.3 限定文件的访问范围</a></li></ul> 
  </li><li><a href="#_368" rel="nofollow">五、参考连接</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、任意文件读取概述</h2> 
<p>​ 一些网站的需求，可能会提供文件查看与下载的功能。如果对用户查看或下载的文件没有限制或者限制绕过，就可以查看或下载任意文件。这些文件可以是源代码文件，配置文件，敏感文件等等。</p> 
<ul><li> <p>任意文件读取会造成（敏感）信息泄露；</p> </li><li> <p>任意文件读取大多数是由于其他漏洞引发的，如，RCE、目录遍历、文件包含等。</p> </li><li> <p>任意文件读取与任意文件下载本质上没有区别，信息都是从服务端流向浏览器的。</p> <p>​ 文件读取与下载可能形式不同，但是从本质上讲读取与下载没有区别，从权限角度来讲，读取与下载都<br> 需要读权限。</p> </li></ul> 
<h3><a id="11___14"></a>1.1 漏洞成因</h3> 
<p>不管是任意文件读取还是任意文件下载，触发漏洞的条件都是相同的：</p> 
<ul><li>存在读取文件的功能（函数），也就是说，Web应用开放了文件读取功能；</li><li>读取文件的路径客户端可控，完全控制或影响文件路径参数；</li><li>没有对文件路径进行校验或者校验不严导致校验被绕过；</li><li>输出了文件的内容。</li></ul> 
<h3><a id="12___23"></a>1.2 漏洞危害</h3> 
<p>​ 下载服务器任意文件，包括源代码文件、系统敏感文件、配置文件等等。</p> 
<p>​ 可以配合其他漏洞，构成完整攻击链。对源代码文件进行代码审计，查找更多的漏洞。<br> ​ 任意文件读取与下载重点关注的文件：</p> 
<ul><li>源代码</li><li>配置文件</li><li>敏感文件</li><li>日志文件</li><li>…</li></ul> 
<h3><a id="13___36"></a>1.3 漏洞分类</h3> 
<ul><li>任意文件读取</li><li>任意文件下载</li></ul> 
<h3><a id="14___43"></a>1.4 任意文件读取</h3> 
<p>以PHP脚本为例子，有一些函数可以实现文件读取功能。</p> 
<h4><a id="141__49"></a>1.4.1 文件读取</h4> 
<table><thead><tr><th>读取文件的函数</th><th>函数特点</th></tr></thead><tbody><tr><td>readfile()</td><td>直接读取文件内容<br>自带输出功能</td></tr><tr><td>file_get_contents()</td><td>直接读取文件内容<br>需要输出读取内容</td></tr><tr><td>fread()</td><td>打开文件<br>计算文件大小<br>读取文件<br>输出文件<br>关闭文件</td></tr></tbody></table> 
<p><strong>readfile :</strong></p> 
<pre><code class="prism language-php"><span class="token comment">// readfile.php</span>

<span class="token variable">$fp</span><span class="token operator">=</span><span class="token string double-quoted-string">"../phpinfo.php"</span><span class="token punctuation">;</span>
<span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>解释：</p> 
 <p><strong><code>readfile()</code> :函数读取一个文件，并写入到输出缓冲。</strong></p> 
</blockquote> 
<p><strong>file_get_contents：</strong></p> 
<pre><code class="prism language-php"><span class="token comment">// file_get_contents.php</span>

<span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"../phpinfo.php"</span><span class="token punctuation">;</span> 
<span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>解释：</p> 
 <p><strong><code>file_get_contents()</code> :把整个文件读入一个字符串中</strong></p> 
 <p>语法：</p> 
 <pre><code class="prism language-php"><span class="token function">file_get_contents</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre> 
 <table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">path</td><td align="left">必需。规定要读取的文件。</td></tr></tbody></table> 
</blockquote> 
<p><strong>fread：</strong></p> 
<pre><code class="prism language-sh">// fread.php

<span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token string">"../phpinfo.php"</span><span class="token punctuation">;</span> <span class="token comment">#文件路径</span>

<span class="token variable">$f</span> <span class="token operator">=</span> fopen<span class="token punctuation">(</span><span class="token variable">$fp</span>,<span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#打开文件，操作是读文件</span>
<span class="token variable">$f_size</span> <span class="token operator">=</span> filesize<span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">#指定返回文件的大小</span>
<span class="token builtin class-name">echo</span> fread<span class="token punctuation">(</span><span class="token variable">$f</span>, <span class="token variable">$f_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">#读文件</span>
fclose<span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#关闭</span>
</code></pre> 
<blockquote> 
 <p>解释：</p> 
 <p><strong><code>fopen()</code> :函数打开一个文件或 URL。</strong></p> 
 <p>​ 语法：</p> 
 <pre><code class="prism language-php"><span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>mode<span class="token punctuation">,</span>include_path<span class="token punctuation">,</span>context<span class="token punctuation">)</span>
</code></pre> 
 <table><thead><tr><th>参数</th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>filename</td><td>必需。规定要打开的文件或 URL。</td></tr><tr><td>mode</td><td>必需。规定您请求到该文件/流的访问类型。<br>可能的值：<br>“r” （只读方式打开，将文件指针指向文件头）</td></tr><tr><td>include_path</td><td>可选。如果您还想在 include_path（在 php.ini 中）中搜索文件的话，请设置该参数为 ‘1’。</td></tr><tr><td>context</td><td>可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。</td></tr></tbody></table> 
 <p><strong><code>filesize()</code> :函数返回指定文件的大小。</strong></p> 
 <p>语法：</p> 
 <pre><code class="prism language-php"><span class="token function">filesize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
</code></pre> 
 <table><thead><tr><th>参数</th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>filename</td><td>必需。规定要检查的文件。</td></tr></tbody></table> 
 <p><strong><code>fread()</code> :函数读取打开的文件</strong></p> 
 <p>​ 语法：</p> 
 <pre><code class="prism language-php"><span class="token keyword type-declaration">string</span> <span class="token function">fread</span> <span class="token punctuation">(</span> <span class="token class-name type-declaration">resource</span> <span class="token variable">$handle</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$length</span> <span class="token punctuation">)</span>
</code></pre> 
 <table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>handle</td><td>文件系统指针，是典型地由 fopen() 创建的 resource(资源)。</td></tr><tr><td>length</td><td>必需。规定要读取的最大字节数。</td></tr></tbody></table> 
</blockquote> 
<p><img src="https://images2.imgbox.com/80/92/iMGni56J_o.png" alt="image-20230831093030943"></p> 
<h4><a id="142___158"></a>1.4.2 任意文件读取</h4> 
<p><strong>把路径换成变量</strong></p> 
<p>变量$fp，会捕获GET 方式传递过来的filepath 参数。</p> 
<pre><code class="prism language-sh"><span class="token variable">$fp</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'filepath'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>filepath 客户端可控，并且没有经过校验，会造成任意文件读取漏洞。我们就可以利用这一漏洞查看host文件、password文件、日志文件等。</p> 
<pre><code class="prism language-sh">?filepath<span class="token operator">=</span>index.php 
?filepath<span class="token operator">=</span>/etc/passwd
?filepath<span class="token operator">=</span>c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>drivers<span class="token punctuation">\</span>etc<span class="token punctuation">\</span>hosts 
?filepath<span class="token operator">=</span>c:<span class="token punctuation">\</span>phpstudy_2016<span class="token punctuation">\</span>apache<span class="token punctuation">\</span>conf<span class="token punctuation">\</span>httpd.conf 
?filepath<span class="token operator">=</span>c:<span class="token punctuation">\</span>phpstudy_2016<span class="token punctuation">\</span>mysql<span class="token punctuation">\</span>my.ini

?filePath<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>drivers<span class="token punctuation">\</span>etc<span class="token punctuation">\</span>hosts 
?filePath<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/etc/hosts

?filepath<span class="token operator">=</span><span class="token punctuation">..</span>/test.php
</code></pre> 
<p><img src="https://images2.imgbox.com/e5/e0/Qtyadpbq_o.png" alt="image-20230831202223286"></p> 
<pre><code class="prism language-sh">?filePath<span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>drivers<span class="token punctuation">\</span>etc<span class="token punctuation">\</span>hosts 
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/e7/TsIorxEx_o.png" alt="image-20230831202500463"></p> 
<h3><a id="15___199"></a>1.5 任意文件下载</h3> 
<h4><a id="151___201"></a>1.5.1 一般情况</h4> 
<p>​ 直接下载：例如图片另存为。</p> 
<p>​ a标签下载：</p> 
<pre><code class="prism language-sh"><span class="token operator">&lt;</span>a href <span class="token operator">=</span> <span class="token string">'./a.jpg'</span><span class="token operator">&gt;</span>IMG Download<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="152__PHP_213"></a>1.5.2 PHP实现</h4> 
<p>PHP 文件下载实现过程：</p> 
<ul><li> <p>先读取文件</p> </li><li> <p>在输出文件</p> </li><li> <p>提供下载</p> </li></ul> 
<pre><code class="prism language-sh">// file-download.php

<span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token string">'./a.jpg'</span><span class="token punctuation">;</span>
header<span class="token punctuation">(</span><span class="token string">'Content-Type:image/jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
header<span class="token punctuation">(</span><span class="token string">'Content-Disposition:attachment;fileName='</span>.basename<span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">))</span><span class="token punctuation">;</span> readfile<span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="153___233"></a>1.5.3 任意文件下载</h4> 
<p>任意文件下载的条件：</p> 
<ul><li>已知目标文件路径</li><li>目标文件路径，客户端可控</li><li>没有经过校验或校验不严格</li></ul> 
<pre><code>$fp = $_GET['filepath'];
</code></pre> 
<pre><code>?filepath=c:/windows/system32/drivers/etc/hosts ?filepath=/etc/passwd
</code></pre> 
<h2><a id="_255"></a>二、任意文件读取攻防</h2> 
<h3><a id="21___257"></a>2.1 路径过滤</h3> 
<h4><a id="211___259"></a>2.1.1 过滤<code>../</code></h4> 
<pre><code class="prism language-php"><span class="token variable">$fp</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filepath'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"../"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>突破该过滤可以采用双写或者绝对路径的方式绕过过滤：</strong></p> 
<h3><a id="22___269"></a>2.2 简单绕过</h3> 
<h4><a id="221___271"></a>2.2.1 双写绕过</h4> 
<pre><code class="prism language-sh"><span class="token comment">#双写</span>
?file_path<span class="token operator">=</span><span class="token punctuation">..</span><span class="token punctuation">..</span>//<span class="token punctuation">..</span><span class="token punctuation">..</span>//<span class="token punctuation">..</span><span class="token punctuation">..</span>//<span class="token punctuation">..</span><span class="token punctuation">..</span>//<span class="token punctuation">..</span><span class="token punctuation">..</span>//<span class="token punctuation">..</span><span class="token punctuation">..</span>//windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>drivers<span class="token punctuation">\</span>etc<span class="token punctuation">\</span>hosts 
</code></pre> 
<p><img src="https://images2.imgbox.com/49/b3/7RAFm6O4_o.png" alt="image-20230831204141293"></p> 
<h4><a id="222___282"></a>2.2.2 绝对路径</h4> 
<pre><code class="prism language-php"><span class="token operator">?</span>filepath<span class="token operator">=</span>c<span class="token punctuation">:</span><span class="token operator">/</span>windows\system32\drivers\etc\hosts
</code></pre> 
<h4><a id="223___290"></a>2.2.3 使用<code>..\</code></h4> 
<pre><code class="prism language-php"><span class="token operator">?</span>filepath<span class="token operator">=</span><span class="token operator">.</span><span class="token operator">.</span>\<span class="token operator">.</span><span class="token operator">.</span>\<span class="token operator">.</span><span class="token operator">.</span>\<span class="token operator">.</span><span class="token operator">.</span>\<span class="token operator">.</span><span class="token operator">.</span>\windows\system32\drivers\etc\hosts
</code></pre> 
<p><strong>现在想要进行防守可以考虑限制文件访问范围</strong></p> 
<p>例：只让访问a.php,b.php和c.php</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$fp</span><span class="token operator">=</span>@<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file_path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token operator">==</span><span class="token string single-quoted-string">'a.php'</span> <span class="token keyword">or</span> <span class="token variable">$fp</span><span class="token operator">==</span><span class="token string single-quoted-string">'b.php'</span> <span class="token keyword">or</span> <span class="token variable">$fp</span><span class="token operator">==</span><span class="token string single-quoted-string">'c.php'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Please stop!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>限制文件访问范围也可以通过<code>ini_set</code> 进行设置：</p> 
<pre><code class="prism language-sh"><span class="token operator">&lt;</span>?php
ini_set<span class="token punctuation">(</span><span class="token string">"open_basedir"</span>,<span class="token string">"c:\phpStudy\WWW"</span><span class="token punctuation">)</span>
<span class="token variable">$fp</span><span class="token operator">=</span>@<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file_path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
readfile<span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>说明：</p> 
 <p>​ <code>ini_set("open_basedir","c:\phpStudy\WWW")</code>：这行代码用于设置 PHP 的 <code>open_basedir</code> 配置选项，限制脚本能够访问的目录。在这里，设置的目录是 <code>c:\phpStudy\WWW</code>，表示脚本只能访问该目录下的文件。</p> 
 <p>​ <code>$fp=@$_GET['file_path'];</code>：这行代码从 GET 参数中获取名为 <code>file_path</code> 的值，并赋给变量 <code>$fp</code>。<code>@</code> 符号用于抑制可能的错误提示。</p> 
 <p>​ <code>readfile($fp);</code>：这行代码使用 <code>readfile()</code> 函数读取 <code>$fp</code> 变量所指定的文件，并将文件内容输出到浏览器。</p> 
</blockquote> 
<h2><a id="__330"></a>三、 任意文件读取挖掘</h2> 
<h3><a id="31___332"></a>3.1 手动挖掘</h3> 
<table><thead><tr><th>从文件名上看</th><th>从参数名上看</th></tr></thead><tbody><tr><td>readfile.php <br>filedownload.php <br>filelist.php</td><td>f=<br>file=<br>fp=<br>readfile=<br>path=<br>readpath=<br>rul=<br>menu=<br>META-INF=<br>WEB-INF=<br>content=</td></tr></tbody></table> 
<h3><a id="32___340"></a>3.2 经典案例</h3> 
<p><a href="https://blog.csdn.net/qq_45953122/article/details/132609654?spm=1001.2014.3001.5501">metinfo_6.0.0_file-read</a></p> 
<h2><a id="_346"></a>四、漏洞修复方案</h2> 
<h3><a id="41___348"></a>4.1 输入验证</h3> 
<ul><li>让web用户只能访问（读取），所需要的文件和路径。</li></ul> 
<h3><a id="42___352"></a>4.2 避免其他漏洞</h3> 
<ul><li>不能有文件包含漏洞，目录遍历漏洞或其他漏洞。</li></ul> 
<h3><a id="43___356"></a>4.3 限定文件的访问范围</h3> 
<ul><li> <p>让用户不能访问Web 根目录以外的路径。</p> </li><li> <p>php.ini 配置文件中，可以通过选项open_basedir 来限定文件访问的范围</p> </li></ul> 
<pre><code>open_basedir = c:\www\
</code></pre> 
<p><img src="https://images2.imgbox.com/8e/d8/hKIBbJBd_o.png" alt="image-20230831170957217"></p> 
<h2><a id="_368"></a>五、参考连接</h2> 
<pre><code class="prism language-sh">https://github.com/lijiejie/ds_store_exp https://blog.csdn.net/GitChat/article/details/79014538 
https://www.secpulse.com/archives/124398.html https://github.com/kost/dvcs-ripper 
https://github.com/lijiejie/GitHack http://www.vuln.cn/2225 https://github.com/admintony/svnExploit 
https://www.freebuf.com/vuls/181698.html
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64891672b5a782fc4fe9024e1d72cff2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA类的加载时机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc1014ec131adb1d4cb49360ba16c0a3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unable to make field final int java.math.BigInteger.signum accessible: module java.base does not ***</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>