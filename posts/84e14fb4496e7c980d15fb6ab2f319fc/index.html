<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>.net6 SqlSugar配置及增删改查（webapi项目） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content=".net6 SqlSugar配置及增删改查（webapi项目）" />
<meta property="og:description" content="NuGet包： 1.SqlSugarCore
2.System.Data.SqlClient
Program配置: builder.Services.AddScoped&lt;ISqlSugarClient&gt;(x =&gt; { SqlSugarClient db = new SqlSugarClient(new ConnectionConfig() { ConnectionString = &#34;Data Source=.;Initial Catalog=hx;Integrated Security=True;TrustServerCertificate=True&#34;, // 替换为实际的数据库连接字符串 DbType = DbType.SqlServer, // 数据库类型，这里以 SQL Server 为例 IsAutoCloseConnection = true, // 自动关闭连接 MoreSettings = new ConnMoreSettings() { IsWithNoLockQuery = true, // 默认查询时加上 WITH (NOLOCK) IsAutoRemoveDataCache = true// 自动清除缓存 } }); // 配置输出 SQL 语句到控制台 db.Aop.OnLogExecuting = (sql, pars) =&gt; { Console.WriteLine($&#34;Executing SQL: {sql}\nParameters: {JsonSerializer.Serialize(pars)}\n&#34;); }; return db; }); 生成实体类： 可以放在一个控制台程序中，需要的时候在运行就好" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/84e14fb4496e7c980d15fb6ab2f319fc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-09T00:17:48+08:00" />
<meta property="article:modified_time" content="2023-12-09T00:17:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">.net6 SqlSugar配置及增删改查（webapi项目）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>NuGet包：</h2> 
<p>1.SqlSugarCore</p> 
<p>2.System.Data.SqlClient</p> 
<p><img alt="" height="434" src="https://images2.imgbox.com/20/b3/NsujrJhG_o.png" width="1200"></p> 
<h2>Program配置:</h2> 
<pre><code class="language-cs">builder.Services.AddScoped&lt;ISqlSugarClient&gt;(x =&gt;
{
    SqlSugarClient db = new SqlSugarClient(new ConnectionConfig()
    {
        ConnectionString = "Data Source=.;Initial Catalog=hx;Integrated Security=True;TrustServerCertificate=True", // 替换为实际的数据库连接字符串
        DbType = DbType.SqlServer, // 数据库类型，这里以 SQL Server 为例
        IsAutoCloseConnection = true, // 自动关闭连接
        MoreSettings = new ConnMoreSettings()
        {
            IsWithNoLockQuery = true, // 默认查询时加上 WITH (NOLOCK)
            IsAutoRemoveDataCache = true// 自动清除缓存
        }
    });
    // 配置输出 SQL 语句到控制台
    db.Aop.OnLogExecuting = (sql, pars) =&gt;
    {
        Console.WriteLine($"Executing SQL: {sql}\nParameters: {JsonSerializer.Serialize(pars)}\n");
    };

    return db;
});</code></pre> 
<h2>生成实体类：</h2> 
<p>可以放在一个控制台程序中，需要的时候在运行就好</p> 
<pre><code class="language-cs">using SqlSugar;
using DbType = SqlSugar.DbType;

// 配置连接字符串
var db = new SqlSugarClient(new ConnectionConfig()
{
    ConnectionString = "Data Source=.;Initial Catalog=hx;Integrated Security=True;TrustServerCertificate=True",//数据库连接字符串
    DbType = DbType.SqlServer, // 数据库类型，这里以 SQL Server 为例
    IsAutoCloseConnection = true, // 自动关闭连接
    InitKeyType = InitKeyType.Attribute // 通过特性标识主键
});
// DbFirst是SQLSugar中的一个功能，可以让我们通过数据库表自动生成实体类(生成全部表)
db.DbFirst.CreateClassFile("生成文件路径", "命名空间");

//只生成YourTable表(要生成某个表直接改YourTable替换成要生成的表名)
db.DbFirst.Where("TableName='YourTable'").CreateClassFile("生成文件路径", "命名空间");

//不生成YourTable表
db.DbFirst.Where("YourTable").CreateClassFile("生成文件路径", "命名空间");</code></pre> 
<h2>增：</h2> 
<pre><code class="language-cs"> [HttpPost]
 public IActionResult Insert(Student add)//添加使用的是实体类
 {
     var result = _sqlSugarClient.Insertable(add)
                 .IgnoreColumns(it =&gt; it.ID)//不添加此字段
                 .ExecuteCommand() &gt; 0;
     JsonResult json = new JsonResult(new
     {
         msg = result ? "ok" : "no"
     });
     return json;
 }</code></pre> 
<h2>删：</h2> 
<pre><code class="language-cs">  [HttpPost]
  public IActionResult Delete(int id)
  {
      bool result = _sqlSugarClient
          .Deleteable&lt;Student&gt;(x =&gt; x.ID == id)//删除行的id
          .ExecuteCommandHasChange();
      JsonResult json = new JsonResult(new
      {
          msg = result ? "ok" : "no"
      });
      return json;
  }</code></pre> 
<h2>改：</h2> 
<pre><code class="language-cs"> [HttpPost]
 public IActionResult UpdateStudent(Stu_Update update)//修改使用DTO
 {
     var result = _sqlSugarClient.Updateable&lt;Student&gt;()
                  .SetColumns(it =&gt; new Student { Name = update.Name }) // 设置要更新的字段及其值
                  .Where(it =&gt; it.ID == update.ID) // 提供更新条件
                  .ExecuteCommandHasChange();
     JsonResult json = new JsonResult(new
     {
         msg = result ? "ok" : "no"
     });
     return json;
 }</code></pre> 
<h2>查（内连）：</h2> 
<pre><code class="language-cs"> [HttpGet]
 public IActionResult Select()
 {
     var result = _sqlSugarClient.Queryable&lt;Student, Classes, Teacher&gt;((t1, t2, t3) =&gt; t1.ClassId == t2.ID &amp;&amp; t2.ID == t3.ClassId)//关联条件
                                 .Select((t1, t2, t3) =&gt; new Stu
                                 {
                                     ID = t1.ID,
                                     Name = t1.Name,
                                     ClassName = t2.Name,
                                     TeacherName = t3.Name
                                 })
                                 .ToList();
     JsonResult json = new JsonResult(new
     {
         msg = result
     });
     return json;
 }</code></pre> 
<h2>查（左联）：</h2> 
<pre><code class="language-cs">  [HttpGet]
  public IActionResult Select()
  {
      var result = _sqlSugarClient.Queryable&lt;Student, Classes, Teacher&gt;((t1, t2, t3) =&gt; new JoinQueryInfos(
                                      JoinType.Left, t1.ClassId == t2.ID, //左连接 左链接 左联
                                      JoinType.Left, t2.ID == t3.ID
                                  ))//关联条件
                                 .Select((t1, t2, t3) =&gt; new Stu
                                 {
                                     ID = t1.ID,
                                     Name = t1.Name,
                                     ClassName = t2.Name,
                                     TeacherName = t3.Name
                                 })
                                 .ToList();
      JsonResult json = new JsonResult(new
      {
          msg = result
      });
      return json;
  }</code></pre> 
<h2>查（模糊查询）：</h2> 
<pre><code class="language-cs">[HttpGet]
public IActionResult Select_S(string Name)
{
    var result = _sqlSugarClient.Queryable&lt;Student, Classes, Teacher&gt;((t1, t2, t3) =&gt; new JoinQueryInfos(
                                    JoinType.Left, t1.ClassId == t2.ID, //左连接 左链接 左联
                                    JoinType.Left, t2.ID == t3.ID
                                ))//关联条件
                               .Select((t1, t2, t3) =&gt; new Stu
                               {
                                   ID = t1.ID,
                                   Name = t1.Name,
                                   ClassName = t2.Name,
                                   TeacherName = t3.Name
                               }).ToList();
    if (Name != null)
    {
        result = result.Where(x =&gt; x.Name.Contains(Name)).ToList();//模糊查询
    }
    JsonResult json = new JsonResult(new
    {
        msg = result
    });
    return json;
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e8ec31e120b08cb92b80139f5a8ca037/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浅谈linux缓冲区的认识！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5aff1aeebbb104c2f0cbfea671557b1a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">给你的Python程序添点Emoji魔法：使用Emoji模块增添趣味和个性！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>