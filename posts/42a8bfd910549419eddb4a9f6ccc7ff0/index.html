<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python | 轻量ORM框架Peewee的基础使用（增删改查、自动创建模型类、事务装饰器） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python | 轻量ORM框架Peewee的基础使用（增删改查、自动创建模型类、事务装饰器）" />
<meta property="og:description" content="文章目录 01 简介02 安装03 自动创建模型类04 基础使用4.1 查询4.2 新增4.3 更新4.4 删除 05 事务 01 简介 在使用python开发的过程中，有时需要一些简单的数据库操作，而Peewee正是理想的选择，它是一个小巧而灵活的 Python ORM（对象关系映射）框架，用于简化数据库操作。
本文基于mysql数据库，介绍最基础和常用的用法。
官方文档：
https://docs.peewee-orm.com/en/latest/index.html
GitHub上目前已有10.5k Star：
https://github.com/coleifer/peewee
02 安装 # 安装peewee库 pip install peewee # 安装mysql数据库客户端 pip install pymysql 03 自动创建模型类 假设我有一个名为test的数据库，其中有一张名为user的表，此时可以通过命令自动创建该数据库下各个表的映射模型类：
python -m pwiz -e &lt;db_type&gt; -H &lt;host&gt; -p &lt;port&gt; -u &lt;username&gt; -P &lt;db_name&gt; &gt; model.py 其中：
db_type：数据库类型，例如mysqlhost：数据库主机地址port：端口username：数据库连接的用户名db_name：数据库名称 示例：
python -m pwiz -e mysql -H 192.168.0.25 -p 3306 -u root -P test &gt; model." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/42a8bfd910549419eddb4a9f6ccc7ff0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-02T02:21:07+08:00" />
<meta property="article:modified_time" content="2023-12-02T02:21:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python | 轻量ORM框架Peewee的基础使用（增删改查、自动创建模型类、事务装饰器）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#01__7" rel="nofollow">01 简介</a></li><li><a href="#02__17" rel="nofollow">02 安装</a></li><li><a href="#03__25" rel="nofollow">03 自动创建模型类</a></li><li><a href="#04__84" rel="nofollow">04 基础使用</a></li><li><ul><li><a href="#41__86" rel="nofollow">4.1 查询</a></li><li><a href="#42__158" rel="nofollow">4.2 新增</a></li><li><a href="#43__166" rel="nofollow">4.3 更新</a></li><li><a href="#44__172" rel="nofollow">4.4 删除</a></li></ul> 
  </li><li><a href="#05__183" rel="nofollow">05 事务</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="01__7"></a>01 简介</h2> 
<p>在使用python开发的过程中，有时需要一些简单的数据库操作，而Peewee正是理想的选择，它是一个小巧而灵活的 Python ORM（对象关系映射）框架，用于简化数据库操作。</p> 
<p>本文基于mysql数据库，介绍最基础和常用的用法。</p> 
<p>官方文档：<br> <a href="https://docs.peewee-orm.com/en/latest/index.html" rel="nofollow">https://docs.peewee-orm.com/en/latest/index.html</a></p> 
<p>GitHub上目前已有10.5k Star：<br> <a href="https://github.com/coleifer/peewee">https://github.com/coleifer/peewee</a></p> 
<h2><a id="02__17"></a>02 安装</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 安装peewee库</span>
pip <span class="token function">install</span> peewee
<span class="token comment"># 安装mysql数据库客户端</span>
pip <span class="token function">install</span> pymysql
</code></pre> 
<h2><a id="03__25"></a>03 自动创建模型类</h2> 
<p>假设我有一个名为<code>test</code>的数据库，其中有一张名为<code>user</code>的表，此时可以通过命令自动创建该数据库下各个表的映射模型类：</p> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> pwiz <span class="token parameter variable">-e</span> <span class="token operator">&lt;</span>db_type<span class="token operator">&gt;</span> <span class="token parameter variable">-H</span> <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token parameter variable">-P</span> <span class="token operator">&lt;</span>db_name<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> model.py
</code></pre> 
<p>其中：</p> 
<ul><li><code>db_type</code>：数据库类型，例如mysql</li><li><code>host</code>：数据库主机地址</li><li><code>port</code>：端口</li><li><code>username</code>：数据库连接的用户名</li><li><code>db_name</code>：数据库名称</li></ul> 
<p>示例：</p> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> pwiz <span class="token parameter variable">-e</span> mysql <span class="token parameter variable">-H</span> <span class="token number">192.168</span>.0.25 <span class="token parameter variable">-p</span> <span class="token number">3306</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-P</span> <span class="token builtin class-name">test</span> <span class="token operator">&gt;</span> model.py
</code></pre> 
<p>执行后，会让输入数据库连接密码，而后会在cmd启动的所在目录下生成一个<code>model.py</code>文件。</p> 
<p><strong>注意</strong>：刚生成的model.py文件编码可能与系统不同，例如我显示是<code>UTF-16LE</code>编码，需要转换为与项目其他.py文件相同的编码。</p> 
<p><img src="https://images2.imgbox.com/13/3e/l5mOzV3y_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d7/59/L5cr4J5Q_o.png" alt="在这里插入图片描述"></p> 
<p>创建好的模型类：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> peewee <span class="token keyword">import</span> <span class="token operator">*</span>

database <span class="token operator">=</span> MySQLDatabase<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'charset'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token string">'sql_mode'</span><span class="token punctuation">:</span> <span class="token string">'PIPES_AS_CONCAT'</span><span class="token punctuation">,</span> <span class="token string">'use_unicode'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                                    <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">UnknownField</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>_<span class="token punctuation">,</span> <span class="token operator">**</span>__<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        database <span class="token operator">=</span> database


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    age <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> CharField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        table_name <span class="token operator">=</span> <span class="token string">'user'</span>
</code></pre> 
<p>这里面的<code>User</code>类对应的就是我数据库中的<code>user</code>表，模型类虽然不显式包含主键字段，但使用<code>user.id</code>可以查看得到。</p> 
<ul><li>操作结束后建议关闭连接：</li></ul> 
<pre><code class="prism language-python">database<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="04__84"></a>04 基础使用</h2> 
<h3><a id="41__86"></a>4.1 查询</h3> 
<ul><li>查询所有用户</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 查询所有用户</span>
users <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 看看有多少条数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 查看第0条数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 查看所有数据</span>
<span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># 每个user都是User模型对象 这里print会输出主键值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">,</span> user<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
</code></pre> 
<ul><li>查询特定属性</li></ul> 
<pre><code class="prism language-python">users <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
</code></pre> 
<ul><li>条件查询</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 使用where实现条件查询</span>
young_users<span class="token punctuation">:</span> ModelSelect <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">35</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> user <span class="token keyword">in</span> young_users<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">,</span> user<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
</code></pre> 
<ul><li>查询单个用户</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 使用get 直接返回一个User对象</span>
user <span class="token operator">=</span> User<span class="token punctuation">.</span>get<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'张三'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> 
<ul><li>根据主键查询</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># get_by_id()方法</span>
user <span class="token operator">=</span> User<span class="token punctuation">.</span>get_by_id<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> 
<ul><li>多条件、排序、LIMIT</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'张三'</span> <span class="token operator">AND</span> email <span class="token operator">=</span> <span class="token string">'xxx@qq.com'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> 
<p>转换为：</p> 
<pre><code class="prism language-python">query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
		<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'张三'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>User<span class="token punctuation">.</span>email <span class="token operator">==</span> <span class="token string">'xxx@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span>age<span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>子查询示例</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> user_new<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>转换：</p> 
<pre><code class="prism language-python">inner_query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">.</span>not_in<span class="token punctuation">(</span>inner_query<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="42__158"></a>4.2 新增</h3> 
<pre><code class="prism language-python"><span class="token comment"># 会在数据库新增数据 同时也会返回这个新对象</span>
user <span class="token operator">=</span> User<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"王五"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="43__166"></a>4.3 更新</h3> 
<pre><code class="prism language-python"><span class="token comment"># 注意最后要加execute()</span>
User<span class="token punctuation">.</span>update<span class="token punctuation">(</span>email<span class="token operator">=</span><span class="token string">'xxx@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'王五'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="44__172"></a>4.4 删除</h3> 
<pre><code class="prism language-python"><span class="token comment"># 条件删除</span>
User<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 按照id删除 不需要execute()</span>
User<span class="token punctuation">.</span>delete_by_id<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>更新和删除操作，往往要在最后加<code>execute()</code>。</p> 
<h2><a id="05__183"></a>05 事务</h2> 
<p>使用<code>atomic</code>装饰器实现原子操作：</p> 
<pre><code class="prism language-python"><span class="token comment"># 创建数据库连接</span>
database <span class="token operator">=</span> MySQLDatabase<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token comment"># 在方法上使用装饰器来保证原子操作 注意这里的()符号不能省略</span>
<span class="token decorator annotation punctuation">@database<span class="token punctuation">.</span>atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    User<span class="token punctuation">.</span>update<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    User<span class="token punctuation">.</span>update<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
   
<span class="token comment"># 结束后关闭连接</span>
database<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df527799da0ba3ee099fc0cc5d781d65/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AUTOSAR OS任务调度的底层逻辑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/544091050930e04c71f44d4a024508c0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IntelliJ IDEA创建springboot项目时不能选择java8的问题解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>