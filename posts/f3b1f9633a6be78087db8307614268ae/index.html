<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【超详细】Pytest全栈自动化测试指南-夹具入门，让你快速提高测试效率！ - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【超详细】Pytest全栈自动化测试指南-夹具入门，让你快速提高测试效率！" />
<meta property="og:description" content="二、夹具 2.1 什么是fixtures 在测试中，fixture为测试 提供了一个定义好的、可靠的和一致的上下文。这可能包括环境（例如配置有已知参数的数据库）或内容（例如数据集）。
2.2 使用上的理解 它是一个高级装饰器，通过被@Fixture标记的的函数，都叫做夹具.把使用@Fixture标记的函数名称，传到任意用例的参数列表里面，即可使用在不修改用例函数内部代码的前提下，扩展其功能，可以给用例提供数据，增强功能， 和测试前，测试后环境的初始化和清理工作。 2.3 初始化和清理 fixture 函数会在测试函数之前运行如fixtrue 函数包含yield,那么代码会在yield 处停止，转而运行测试函数，等测试函数执行完毕后，在回到fixtrue，继续执行yield 后面的代码。可以将yield 前、当做setup，yield后，当做teardown无论测试过程中发生了什么，yield后面的代码都会被执行。它的作用视为代码清理功能。类似UnitTest 里面的setup 和teardwn 2.4 共享夹具 conftest.py: 跨多个文件共享夹具该文件用作为整个目录提供共享Fixtrue 的一种方式，可以跨多个文件共享夹具，并且在用例模块中无需导入它们，pytest 会自动会发现conftest.py 中的夹具。您可以拥有多个包含测试的嵌套目录/包，并且每个目录都可以拥有conftest.py. 如果夹具出现重名，子级会覆盖父级中的夹具conftest.py ,只针对当前目录和子级目录有效，对它当前的父级目录，不起作用。 2.5 代码案例 2.5.1 fixtrue夹具入门案例 # ---------------------------------conftest.py------------------------------------ import pytest @pytest.fixture def some_data(): return 66 @pytest.fixture def student_score(): return {&#39;小明&#39;: 99, &#39;小红&#39;: 100} @pytest.fixture def student_name(): return [&#39;小明&#39;, &#39;小红&#39;] # ---------------------------------test_01_fixtures.py---------------------------- from pytest_assume.plugin import assume def test_some(some_data): assert some_data == 66 def test_student(student_score, student_name): with assume: # 实际的数据长度是否跟预期长度相同 assert len(student_score) == 2, \ f&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f3b1f9633a6be78087db8307614268ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-08T14:38:49+08:00" />
<meta property="article:modified_time" content="2023-06-08T14:38:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【超详细】Pytest全栈自动化测试指南-夹具入门，让你快速提高测试效率！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>二、夹具</h2> 
<h3><a id="21_fixtures_1"></a>2.1 什么是fixtures</h3> 
<p>在测试中，fixture为测试 提供了一个定义好的、可靠的和一致的上下文。这可能包括环境（例如配置有已知参数的数据库）或内容（例如数据集）。</p> 
<h3><a id="22__7"></a>2.2 使用上的理解</h3> 
<ol><li>它是一个高级装饰器，通过被@Fixture标记的的函数，都叫做夹具.</li><li>把使用@Fixture标记的函数名称，传到任意用例的参数列表里面，即可使用</li><li>在不修改用例函数内部代码的前提下，扩展其功能，可以给用例提供数据，增强功能， 和测试前，测试后环境的初始化和清理工作。</li></ol> 
<h3><a id="23__13"></a>2.3 初始化和清理</h3> 
<ul><li>fixture 函数会在测试函数之前运行</li><li>如fixtrue 函数包含yield,那么代码会在yield 处停止，转而运行测试函数，</li><li>等测试函数执行完毕后，在回到fixtrue，继续执行yield 后面的代码。</li><li>可以将yield 前、当做setup，yield后，当做teardown</li><li>无论测试过程中发生了什么，yield后面的代码都会被执行。它的作用视为代码清理功能。</li><li>类似UnitTest 里面的setup 和teardwn</li></ul> 
<h3><a id="24__22"></a>2.4 共享夹具</h3> 
<ul><li>conftest.py: 跨多个文件共享夹具</li><li>该文件用作为整个目录提供共享Fixtrue 的一种方式，可以跨多个文件共享夹具，并且在用例模块中无需导入它们，pytest 会自动会发现conftest.py 中的夹具。</li><li>您可以拥有多个包含测试的嵌套目录/包，并且每个目录都可以拥有conftest.py. 如果夹具出现重名，子级会覆盖父级中的夹具</li><li>conftest.py ,只针对当前目录和子级目录有效，对它当前的父级目录，不起作用。</li></ul> 
<h3><a id="25___29"></a>2.5 代码案例</h3> 
<h4><a id="251_fixtrue_30"></a>2.5.1 fixtrue夹具入门案例</h4> 
<pre><code class="prism language-python"><span class="token comment"># ---------------------------------conftest.py------------------------------------</span>
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">some_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">66</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">student_score</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'小明'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'小红'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">student_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'小红'</span><span class="token punctuation">]</span>


<span class="token comment"># ---------------------------------test_01_fixtures.py----------------------------</span>
<span class="token keyword">from</span> pytest_assume<span class="token punctuation">.</span>plugin <span class="token keyword">import</span> assume


<span class="token keyword">def</span> <span class="token function">test_some</span><span class="token punctuation">(</span>some_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> some_data <span class="token operator">==</span> <span class="token number">66</span>


<span class="token keyword">def</span> <span class="token function">test_student</span><span class="token punctuation">(</span>student_score<span class="token punctuation">,</span> student_name<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">with</span> assume<span class="token punctuation">:</span>  <span class="token comment"># 实际的数据长度是否跟预期长度相同</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>student_score<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">,</span> \
            <span class="token string-interpolation"><span class="token string">f"实际数据长度:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>student_score<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 与预期数据长度:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span></span><span class="token string">不相同!!"</span></span>


    <span class="token keyword">with</span> assume<span class="token punctuation">:</span>  <span class="token comment"># 预期数据是否在实际数据内</span>
        <span class="token keyword">assert</span> <span class="token string">'小红'</span> <span class="token keyword">in</span> student_name<span class="token punctuation">,</span> \
            <span class="token string-interpolation"><span class="token string">f"预期数据:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token string">'小红'</span><span class="token punctuation">}</span></span><span class="token string">没在实际数据中:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>student_name<span class="token punctuation">}</span></span><span class="token string">!!"</span></span>
</code></pre> 
<h4><a id="252___72"></a>2.5.2 完整邮件案例</h4> 
<p>测试步骤：</p> 
<ul><li> <p>step1: 创建发邮件用户</p> <p>setp2: 创建收邮件用户</p> <p>step3：编写收发邮件功能用例。验证发件人可以正常发邮件到收件人邮箱里的功能用例。</p> <p>step4: 删除收件用户</p> <p>step5: 删 除发件用户</p> <p>说明：step1、step2 为提供资源，由夹具来实现、step4、step5为清理，由夹具实现。</p> </li></ul> 
<pre><code class="prism language-python"><span class="token comment"># ---------------------------------mail.py----------------------------------------</span>

<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token punctuation">,</span> field
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List


<span class="token keyword">class</span> <span class="token class-name">MailAdminClient</span><span class="token punctuation">:</span> <span class="token comment"># 邮件管理后台</span>

    <span class="token keyword">def</span> <span class="token function">create_user</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 创建用户</span>
        <span class="token keyword">return</span> MailUser<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 删除用户，未完成</span>
        <span class="token comment"># do some cleanup</span>
        <span class="token keyword">pass</span>


<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">Email</span><span class="token punctuation">:</span>
    subject<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token comment"># 邮件主题</span>
    body<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token comment"># 邮件内容</span>


<span class="token comment"># 邮件使用人</span>
<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">MailUser</span><span class="token punctuation">:</span>
    <span class="token comment"># 收件箱</span>
    inbox<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Email<span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">send_email</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""发送邮件
        :param email: 邮件(包括主题、内容)
        :param other: 收件人
        :return: None
        """</span>
        other<span class="token punctuation">.</span>inbox<span class="token punctuation">.</span>append<span class="token punctuation">(</span>email<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">clear_mailbox</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""清空邮箱
        :return:None
        """</span>
        self<span class="token punctuation">.</span>inbox<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># ---------------------------------conftest.py------------------------------------</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">mail_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> btest<span class="token punctuation">.</span>Day3<span class="token punctuation">.</span>mail <span class="token keyword">import</span> MailAdminClient
    <span class="token keyword">return</span> MailAdminClient<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">sending_user</span><span class="token punctuation">(</span>mail_admin<span class="token punctuation">)</span><span class="token punctuation">:</span>

    user <span class="token operator">=</span> mail_admin<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n--sending_user创建发送用户-------\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">yield</span> user

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n--sending_user删除发送用户-------\n'</span><span class="token punctuation">)</span>
    mail_admin<span class="token punctuation">.</span>delete_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">receiving_user</span><span class="token punctuation">(</span>mail_admin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> mail_admin<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n--receiving_user创建接受用户-------\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">yield</span> user

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n--receiving_user删除接受用户-------\n'</span><span class="token punctuation">)</span>
    mail_admin<span class="token punctuation">.</span>delete_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>


<span class="token comment"># ---------------------------------test_02_email.py------------------------------</span>
<span class="token keyword">from</span> btest<span class="token punctuation">.</span>Day3<span class="token punctuation">.</span>mail <span class="token keyword">import</span> Email


<span class="token comment"># step1：执行sending_user 创建发件用户</span>
<span class="token comment"># step2: 执行receiving_user 创建收件用户</span>
<span class="token comment"># step3: 执行test_email_received 用例</span>
<span class="token comment"># step4: 执行receiving_user删除接受用户</span>
<span class="token comment"># step5: 执行sending_user删除发送用户</span>


<span class="token keyword">def</span> <span class="token function">test_email_received</span><span class="token punctuation">(</span>sending_user<span class="token punctuation">,</span> receiving_user<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n--test_email_received执行测试-------\n'</span><span class="token punctuation">)</span>
    <span class="token comment"># 构造邮件</span>
    email <span class="token operator">=</span> Email<span class="token punctuation">(</span>subject<span class="token operator">=</span><span class="token string">"Hey!"</span><span class="token punctuation">,</span> body<span class="token operator">=</span><span class="token string">"How's it going?"</span><span class="token punctuation">)</span>
    <span class="token comment"># 发送者发送邮件给接受者</span>
    sending_user<span class="token punctuation">.</span>send_email<span class="token punctuation">(</span>email<span class="token punctuation">,</span> receiving_user<span class="token punctuation">)</span>

    <span class="token comment"># 断言 邮件是否在接收人的邮箱中</span>
    <span class="token keyword">assert</span> email <span class="token keyword">in</span> receiving_user<span class="token punctuation">.</span>inbox

<span class="token comment"># 说明：</span>
<span class="token comment"># 同级别的夹具环境初始化是顺序、环境清理是逆序。</span>
<span class="token comment"># 夹具yield 前面代码是按照参数顺序执行。环境初始化是顺序。</span>
<span class="token comment"># 夹具yield 后面代码是按照参数逆序执行。环境清理是逆序。</span>
</code></pre> 
<h4><a id="253__189"></a>2.5.3 夹具执行顺序</h4> 
<p>当 pytest 想要执行测试时，一旦它知道将执行哪些夹具，它就必须弄清楚它们将执行的顺序。为此，它考虑了 3 个因素：</p> 
<ol><li>范围 ：首先执行更高范围的夹具 ,例如：顺序 session &gt; package &gt; moudle &gt; class &gt; method 。<br> 说明： 不管夹具在用例参数列表中，如何排列，都想先执行更高范围夹具</li><li>依赖关系 : 同级别夹具，当一个夹具请求另一个夹具时，首先执行另一个夹具。</li><li>自动夹具 : 同级别，在非自动夹具前执行。<br> 说明：标注为autouse=True的夹具，在同级别夹具中，</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">func_A</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"function_A"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">func_B</span><span class="token punctuation">(</span>func_A<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"function_B"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 同级别自动夹具，最先执行。</span>
<span class="token keyword">def</span> <span class="token function">func_C</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"function_C"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cls</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"module"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">mod</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"module"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"package"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">pack</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"package"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">sess</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"session"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">TestClass</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_order</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func_B<span class="token punctuation">,</span> func_A<span class="token punctuation">,</span> cls<span class="token punctuation">,</span> mod<span class="token punctuation">,</span> pack<span class="token punctuation">,</span> sess<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> order <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token string">'package'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'function_C'</span><span class="token punctuation">,</span> <span class="token string">'function_A'</span><span class="token punctuation">,</span> <span class="token string">'function_B'</span><span class="token punctuation">]</span>



</code></pre> 
<h4><a id="254___251"></a>2.5.4 夹具综合案例</h4> 
<pre><code class="prism language-python"><span class="token comment"># ----------------------------test_01_xh.py----------------------------------</span>
<span class="token comment"># ----------------------------test_02_xm.py----------------------------------</span>

<span class="token comment"># step1  夹具（session-自动） ：初始化测试环境 与清理测环境。</span>

<span class="token comment"># step2  夹具（module-自动）：  登陆与退出</span>

<span class="token comment"># step3  夹具（function） ： 函数级别提供输入信息 和 结束输入信息。</span>

<span class="token comment"># step4  用例（2个模块(4个)用例） ： 用例1学生查询成绩，用例2学生修改成绩</span>


<span class="token comment"># 注意：自动化夹具的使用场景，用例跟夹具，没有数据上的依赖时，可以使用自动化夹具。</span>

    
 <span class="token comment"># 通过关键字表达式进行测试,执行用例名字中包含searh和edit的用例</span>
 <span class="token comment"># pytest.main(['-qs', '-k', 'search or edit', '.\\Day4\\'])</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>session<span class="token punctuation">:</span>测试开始<span class="token operator">-</span>环境初始化<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_01_xh<span class="token punctuation">:</span>登陆成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xh_search<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
小红查询成绩
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xh_search<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>

<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xh_edit<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
小红修改成绩
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xh_edit<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_01_xh<span class="token punctuation">:</span>退出成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>


<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_02_xm<span class="token punctuation">:</span>登陆成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xm_search<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
小明查询成绩
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xm_search<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>

<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xm_edit<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
小明修改成绩
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_xm_edit<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_02_xm<span class="token punctuation">:</span>退出成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>


<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>session<span class="token punctuation">:</span>测试完毕<span class="token operator">-</span>环境清理<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># ----------------------------test_03_student.py----------------------------------</span>

<span class="token comment"># step1  夹具（session-自动） ：初始化测试环境 与清理测环境。</span>

<span class="token comment"># step2  夹具（module-自动）：  登陆与退出。</span>

<span class="token comment"># step3  夹具（class-手动） ： 类级别提供:  输入学生信息 和清空学生信息。</span>

<span class="token comment"># step4  夹具（function-自动） ： 函数级别提供:  开始输入信息 和 结束输入信息。</span>

<span class="token comment"># step5  用例（2个class） ： 用例1（判断小红是否在学成成绩表中），用例2(判断小明是否大于90分)</span>

    
<span class="token comment"># 通过关键字表达式进行测试,执行用例名字中包含student的用例</span>
<span class="token comment"># pytest.main(['-qs', '-k', 'student', '.\\Day4\\'])</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>session<span class="token punctuation">:</span>测试开始<span class="token operator">-</span>环境初始化<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_03_student<span class="token punctuation">:</span>登陆成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token keyword">class</span><span class="token punctuation">:</span>TestStudentName<span class="token punctuation">:</span>输入学生信息<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>
<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_name<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_name<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token keyword">class</span><span class="token punctuation">:</span>TestStudentName<span class="token punctuation">:</span>清空学生信息<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>

<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token keyword">class</span><span class="token punctuation">:</span>TestStudentScore<span class="token punctuation">:</span>输入学生信息<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>
<span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_score<span class="token punctuation">:</span>开始输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token punctuation">.</span><span class="token operator">**</span><span class="token operator">*</span>function<span class="token punctuation">:</span>test_score<span class="token punctuation">:</span>结束输入信息<span class="token operator">**</span><span class="token operator">*</span>
<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token keyword">class</span><span class="token punctuation">:</span>TestStudentScore<span class="token punctuation">:</span>清空学生信息<span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>module<span class="token punctuation">:</span>btest<span class="token punctuation">.</span>Day4<span class="token punctuation">.</span>test_03_student<span class="token punctuation">:</span>退出成功<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>


<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>session<span class="token punctuation">:</span>测试完毕<span class="token operator">-</span>环境清理<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span>

</code></pre> 
<h3><a id="_336"></a>夹具常用场景总结</h3> 
<ol><li> <p>session 级别夹具：整个测试用例中开头和结尾只运行一次或全局共享资源（全局参数关联）</p> </li><li> <p>module级别夹具 ：每个模块都需要重新初始化和运行，或在一个模块中共享某个资源（模块内部参数关联）</p> </li><li> <p>class级别夹具： 每个class都需要重新初始化和运行, 在一个类中共享某个资源（某个类中参数关联）</p> </li><li> <p>function级别夹具：每个用例都需要重新初始化和运行，用例之间不共享资源（不进行参数关联）</p> </li></ol> 
<p><em><strong>更多案例，更多内容，请点击： https://edu.csdn.net/course/detail/37237</strong></em></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b551cfeb81575df99407f78ca9fa9763/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python import 详解 全局变量 作用域</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5496862ce33b1516ec8798ec0bf1715c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">实用脚本一：python将文件夹中的视频文件按帧分割为图像并命名保存</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>