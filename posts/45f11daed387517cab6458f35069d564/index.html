<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux部署zookeeper单点和集群并使用zkweb.jar管理 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux部署zookeeper单点和集群并使用zkweb.jar管理" />
<meta property="og:description" content="单点部署 (1)下载zookeeper
wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.1/apache-zookeeper-3.8.1-bin.tar.gz (2)解压软件包
tar xf apache-zookeeper-3.8.1-bin.tar.gz -C /oldboyedu/softwares/ (3)配置环境变量 [root@elk101 ~]# cat /etc/profile.d/zk.sh #!/bin/bash export ZK_HOME=/oldboyedu/softwares/apache-zookeeper-3.8.1-bin export PATH=$PATH:$ZK_HOME/{bin} [root@elk101 ~]# source /etc/profile.d/zk.sh (4)创建配置文件
[root@elk101 ~]# cp /oldboyedu/softwares/apache-zookeeper-3.8.1-bin/conf/{zoo_sample,zoo}.cfg (5)启动zookeeper服务
[root@elk101 ~]# zkServer.sh start # 启动zookeeper服务 [root@elk101 ~]# zkServer.sh status # 查看zookeeper服务状态 [root@elk101 ~]# zkServer.sh stop # 停止zookeeper服务 [root@elk101 ~]# zkServer.sh restart # 重启zookeeper服务 (6)确定zookeeper服务后，测试zookeeper服务是否可用
[root@elk101 ~]# zkCli.sh .... [zk: localhost:2181(CONNECTED) 0] ls / [zookeeper] [zk: localhost:2181(CONNECTED) 1] zookeeper集群部署 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/45f11daed387517cab6458f35069d564/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-02T22:06:07+08:00" />
<meta property="article:modified_time" content="2023-06-02T22:06:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux部署zookeeper单点和集群并使用zkweb.jar管理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>单点部署</h3> 
<p>(1)下载zookeeper</p> 
<pre><code>wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.1/apache-zookeeper-3.8.1-bin.tar.gz</code></pre> 
<p>(2)解压软件包</p> 
<pre><code>tar xf apache-zookeeper-3.8.1-bin.tar.gz -C /oldboyedu/softwares/</code></pre> 
<p>(3)配置环境变量 </p> 
<pre><code>[root@elk101 ~]# cat /etc/profile.d/zk.sh
#!/bin/bash

export ZK_HOME=/oldboyedu/softwares/apache-zookeeper-3.8.1-bin
export PATH=$PATH:$ZK_HOME/{bin}

[root@elk101 ~]# source /etc/profile.d/zk.sh
</code></pre> 
<p>(4)创建配置文件</p> 
<pre><code>[root@elk101 ~]# cp /oldboyedu/softwares/apache-zookeeper-3.8.1-bin/conf/{zoo_sample,zoo}.cfg</code></pre> 
<p>(5)启动zookeeper服务</p> 
<pre><code>[root@elk101 ~]# zkServer.sh start  # 启动zookeeper服务
[root@elk101 ~]# zkServer.sh status  # 查看zookeeper服务状态
[root@elk101 ~]# zkServer.sh stop  # 停止zookeeper服务
[root@elk101 ~]# zkServer.sh restart  # 重启zookeeper服务</code></pre> 
<p> (6)确定zookeeper服务后，测试zookeeper服务是否可用</p> 
<pre><code>[root@elk101 ~]# zkCli.sh 
....
[zk: localhost:2181(CONNECTED) 0] ls /
[zookeeper]
[zk: localhost:2181(CONNECTED) 1]</code></pre> 
<h2> zookeeper集群部署</h2> 
<p>1.创建配置文件</p> 
<pre><code>[root@elk101 ~]# cat &gt; /oldboyedu/softwares/apache-zookeeper-3.8.1-bin/conf/zoo.cfg &lt;&lt;EOF
# 定义最小单元的时间范围tick。
tickTime=2000
# 启动时最长等待tick数量。
initLimit=5
# 数据同步时最长等待的tick时间进行响应ACK
syncLimit=2
# 指定数据目录
dataDir=/oldboyedu/data/zk
# 监听端口
clientPort=2181
# 开启四字命令允许所有的节点访问。
4lw.commands.whitelist=*
# server.ID=A:B:C[:D]
# ID:
#    zk的唯一编号。
# A:
#    zk的主机地址。
# B:
#    leader的选举端口，是谁leader角色，就会监听该端口。
# C: 
#    数据通信端口。
# D:
#    可选配置，指定角色。
server.101=10.0.0.101:2888:3888
server.102=10.0.0.102:2888:3888
server.103=10.0.0.103:2888:3888
EOF

</code></pre> 
<p>2.同步zookeeper软件包及目录结构</p> 
<pre><code>[root@elk101 ~]# mkdir /oldboyedu/data/zk
[root@elk101 ~]# 
[root@elk101 ~]# data_rsync.sh /oldboyedu/softwares/apache-zookeeper-3.8.1-bin/
[root@elk101 ~]# 
[root@elk101 ~]# data_rsync.sh /oldboyedu/data/zk
[root@elk101 ~]# 
[root@elk101 ~]# data_rsync.sh /etc/profile.d/zk.sh 

#编写同步脚本
[root@elk101 ~]# cat &gt; /usr/local/sbin/data_rsync.sh &lt;&lt;'EOF'
#!/bin/bash
# Auther: Jason Yin

if  [ $# -ne 1 ];then
   echo "Usage: $0 /path/to/file(绝对路径)"
   exit
fi 

# 判断文件是否存在
if [ ! -e $1 ];then
    echo "[ $1 ] dir or file not find!"
    exit
fi

# 获取父路径
fullpath=`dirname $1`

# 获取子路径
basename=`basename $1`

# 进入到父路径
cd $fullpath

for ((host_id=102;host_id&lt;=103;host_id++))
  do
    # 使得终端输出变为绿色
    tput setaf 2
    echo ===== rsyncing elk${host_id}: $basename =====
    # 使得终端恢复原来的颜色
    tput setaf 7
    # 将数据同步到其他两个节点
    rsync -apz $basename  `whoami`@elk${host_id}:$fullpath
    if [ $? -eq 0 ];then
      echo "命令执行成功!"
    fi
done
EOF</code></pre> 
<p>3.每个zookeeper节点创建唯一标识ID</p> 
<pre><code>[root@elk101 ~]# for ((host_id=101;host_id&lt;=103;host_id++)) do ssh elk${host_id} "echo ${host_id} &gt; /oldboyedu/data/zk/myid";done
</code></pre> 
<p>4.编写zookeeper集群管理脚本</p> 
<pre><code>[root@elk101 ~]# cat /usr/local/sbin/manager_zk.sh
#!/bin/bash

#判断用户是否传参
if [ $# -ne 1 ];then
    echo "无效参数，用法为: $0  {start|stop|restart|status}"
    exit
fi

#获取用户输入的命令
cmd=$1

#定义函数功能
function zookeeperManger(){
    case $cmd in
    start)
        echo "启动服务"        
        remoteExecution start
        ;;
    stop)
        echo "停止服务"
        remoteExecution stop
        ;;
    restart)
        echo "重启服务"
        remoteExecution restart
        ;;
    status)
        echo "查看状态"
        remoteExecution status
        ;;
    *)
        echo "无效参数，用法为: $0  {start|stop|restart|status}"
        ;;
    esac
}


#定义执行的命令
function remoteExecution(){
    for (( i=101 ; i&lt;=103 ; i++ )) ; do
            tput setaf 2
            echo ========== elk${i} zkServer.sh  $1 ================
            tput setaf 9
            ssh elk${i}  "source /etc/profile.d/zk.sh; zkServer.sh $1 2&gt;/dev/null"
    done
}

#调用函数
zookeeperManger

[root@elk101 ~]# 
[root@elk101 ~]# chmod +x /usr/local/sbin/manager_zk.sh</code></pre> 
<p>5.启动zookeeper集群</p> 
<pre><code>[root@elk101 ~]# manager_zk.sh start</code></pre> 
<p>6.查看集群状态</p> 
<pre><code>[root@elk101 ~]# manager_zk.sh status</code></pre> 
<p>使用zkWeb.jar来管理ZK集群：<br>     1.下载zkWeb.jar <br> [root@elk101 ~]# wget http://192.168.11.253/ElasticStack/day09/softwares/zkWeb-v1.2.1.jar</p> 
<p>    2.运行jar包<br> [root@elk101 ~]# nohup java -jar zkWeb-v1.2.1.jar &amp;&gt;/tmp/zkWeb.log &amp;</p> 
<p>    3.图形使用</p> 
<p>监听端口8099</p> 
<p>进入图形界面后需要设置名称、集群节点和超时时间</p> 
<p><img alt="" height="827" src="https://images2.imgbox.com/08/d3/lTlVTlwC_o.png" width="1200"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/92c22419cbf2d40e4a1e6af4f452864b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JQ动态粒子效果</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8282842c011ea7777c30630a8c39216/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c基础面试题汇总</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>