<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LGB、XGB、CBT参数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LGB、XGB、CBT参数" />
<meta property="og:description" content="LGB：
1、lgb.Dataset()
train_data = lgb.Dataset(data, label=label, feature_name=[&#39;c1&#39;, &#39;c2&#39;, &#39;c3&#39;], categorical_feature=[&#39;c3&#39;], weight=w ) LightGBM 可以直接使用 categorical features（分类特征）作为 input（输入）. 它不需要被转换成 one-hot coding（独热编码）, 并且它比 one-hot coding（独热编码）更快（约快上 8 倍） 注意: 在你构造 Dataset 之前, 你应该将分类特征转换为 int 类型的值. 需要时可以设置权重weight，也可用函数train_data.set_weight(w) 2、交叉验证cv
num_round = 10
lgb.cv(param, train_data, num_round, nfold=5)
3、
#创建成lgb特征的数据集格式
lgb_train = lgb.Dataset(X_train, y_train) # 将数据保存到LightGBM二进制文件将使加载更快
lgb_eval = lgb.Dataset(X_test, y_test, reference=lgb_train) # 创建验证数据
#将参数写成字典下形式
params = {
&#39;task&#39;: &#39;train&#39;, &#39;boosting_type&#39;: &#39;gbdt&#39;, # 设置提升类型 &#39;objective&#39;: &#39;regression&#39;, # 目标函数 &#39;metric&#39;: {&#39;l2&#39;, &#39;auc&#39;}, # 评估函数 &#39;num_leaves&#39;: 31, # 叶子节点数 &#39;learning_rate&#39;: 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d012edbcbeede2b2e45251e4eb99051e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-11T22:15:36+08:00" />
<meta property="article:modified_time" content="2019-10-11T22:15:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LGB、XGB、CBT参数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>LGB：</strong><br> 1、lgb.Dataset()</p> 
<pre><code>train_data = lgb.Dataset(data, label=label, feature_name=['c1', 'c2', 'c3'], categorical_feature=['c3'], weight=w )

LightGBM 可以直接使用 categorical features（分类特征）作为 input（输入）. 它不需要被转换成 one-hot coding（独热编码）, 并且它比 one-hot coding（独热编码）更快（约快上 8 倍）

注意: 在你构造 Dataset 之前, 你应该将分类特征转换为 int 类型的值.

需要时可以设置权重weight，也可用函数train_data.set_weight(w)
</code></pre> 
<p>2、交叉验证cv</p> 
<p>num_round = 10</p> 
<p>lgb.cv(param, train_data, num_round, nfold=5)</p> 
<p>3、</p> 
<p>#创建成lgb特征的数据集格式</p> 
<p>lgb_train = lgb.Dataset(X_train, y_train) # 将数据保存到LightGBM二进制文件将使加载更快</p> 
<p>lgb_eval = lgb.Dataset(X_test, y_test, reference=lgb_train) # 创建验证数据</p> 
<p>#将参数写成字典下形式</p> 
<p>params = {<!-- --></p> 
<pre><code>'task': 'train',

'boosting_type': 'gbdt',  # 设置提升类型

'objective': 'regression', # 目标函数

'metric': {'l2', 'auc'},  # 评估函数

'num_leaves': 31,   # 叶子节点数

'learning_rate': 0.05,  # 学习速率

'feature_fraction': 0.9, # 建树的特征选择比例

'bagging_fraction': 0.8, # 建树的样本采样比例

'bagging_freq': 5,  # k 意味着每 k 次迭代执行bagging

'verbose': 1 # &lt;0 显示致命的, =0 显示错误 (警告), &gt;0 显示信息
</code></pre> 
<p>}</p> 
<p>print(‘Start training…’)</p> 
<p>#训练 cv and train</p> 
<p>gbm = lgb.train(params,lgb_train,num_boost_round=20,valid_sets=lgb_eval,early_stopping_rounds=5) # 训练数据需要参数列表和数据集</p> 
<p>print(‘Save model…’)</p> 
<p>gbm.save_model(‘model.txt’) # 训练后保存模型到文件</p> 
<p>print(‘Start predicting…’)</p> 
<p>#预测数据集</p> 
<p>y_pred = gbm.predict(X_test, num_iteration=gbm.best_iteration) #如果在训练期间启用了早期停止，可以通过best_iteration方式从最佳迭代中获得预测</p> 
<p>#评估模型</p> 
<p>print(‘The rmse of prediction is:’, mean_squared_error(y_test, y_pred) ** 0.5) # 计算真实值和预测值之间的均方根误差</p> 
<pre><code class="prism language-python"><span class="token comment">#读模型数据</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">)</span>

<span class="token comment">#剔除模型无关变量和完全线性相关的变量</span>

<span class="token comment">#写入Train_X,test_X,train_y,test_y</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>cross_validation <span class="token keyword">import</span> train_test_split
train_X<span class="token punctuation">,</span> test_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_y <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> train_size <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> random_state <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">)</span>
 
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
lgb_train <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> free_raw_data<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
lgb_eval <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>test_X<span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> reference<span class="token operator">=</span>lgb_train<span class="token punctuation">,</span>free_raw_data<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
 
param <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'train'</span><span class="token punctuation">,</span>
<span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
<span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
<span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'l2'</span><span class="token punctuation">,</span> <span class="token string">'auc'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
<span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
<span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
<span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
<span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
param<span class="token punctuation">[</span><span class="token string">'is_unbalance'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'true'</span>
param<span class="token punctuation">[</span><span class="token string">'metric'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'auc'</span>

bst<span class="token operator">=</span>lgb<span class="token punctuation">.</span>cv<span class="token punctuation">(</span>param<span class="token punctuation">,</span>lgb_train<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> nfold<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> early_stopping_rounds<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
estimators <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>param<span class="token punctuation">,</span>lgb_train<span class="token punctuation">,</span>num_boost_round<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>bst<span class="token punctuation">[</span><span class="token string">'auc-mean'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Start training...'</span><span class="token punctuation">)</span>
 
 
y_pred <span class="token operator">=</span> estimators<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_X<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>estimators<span class="token punctuation">.</span>best_iteration<span class="token punctuation">)</span>
 
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The roc of prediction is:'</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span>roc_auc_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> <span class="token punctuation">)</span>
 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Feature names:'</span><span class="token punctuation">,</span> estimators<span class="token punctuation">.</span>feature_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Feature importances:'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>estimators<span class="token punctuation">.</span>feature_importance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>XGB</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">XGB_predict</span><span class="token punctuation">(</span>train_x<span class="token punctuation">,</span>train_y<span class="token punctuation">,</span>val_X<span class="token punctuation">,</span>val_Y<span class="token punctuation">,</span>test_x<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"XGB test"</span><span class="token punctuation">)</span>
    <span class="token comment"># create dataset for lightgbm</span>

    xgb_val <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>val_X<span class="token punctuation">,</span> label<span class="token operator">=</span>val_Y<span class="token punctuation">)</span>
    xgb_train <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train<span class="token punctuation">)</span>
    xgb_test <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
    <span class="token comment"># specify your configurations as a dict</span>
    params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">'booster'</span><span class="token punctuation">:</span> <span class="token string">'gbtree'</span><span class="token punctuation">,</span>
              <span class="token comment"># 'objective': 'multi:softmax', # 多分类的问题、</span>
              <span class="token comment"># 'objective': 'multi:softprob', # 多分类概率</span>
              <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary:logistic'</span><span class="token punctuation">,</span>
              <span class="token string">'eval_metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
              <span class="token comment"># 'num_class': 9, # 类别数，与 multisoftmax 并用</span>
              <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment"># 用于控制是否后剪枝的参数,越大越保守，一般0.1、0.2这样子。</span>
              <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment"># 构建树的深度，越大越容易过拟合</span>
              <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment"># L1正则化系数</span>
              <span class="token string">'lambda'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment"># 控制模型复杂度的权重值的L2正则化项参数，参数越大，模型越不容易过拟合。</span>
              <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token comment"># 随机采样训练样本</span>
              <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment"># 生成树时进行的列采样</span>
              <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
              <span class="token comment"># 这个参数默认是 1，是每个叶子里面 h 的和至少是多少，对正负样本不均衡时的 0-1 分类而言</span>
              <span class="token comment"># ，假设 h 在 0.01 附近，min_child_weight 为 1 意味着叶子节点中最少需要包含 100 个样本。</span>
              <span class="token comment"># 这个参数非常影响结果，控制叶子节点中二阶导的和的最小值，该参数值越小，越容易 overfitting。</span>
              <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment"># 设置成1则没有运行信息输出，最好是设置为0.</span>
              <span class="token string">'eta'</span><span class="token punctuation">:</span> <span class="token number">0.03</span><span class="token punctuation">,</span> <span class="token comment"># 如同学习率</span>
              <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
              <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># cpu 线程数</span>
              <span class="token string">'missing'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string">'scale_pos_weight'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 用来处理正负样本不均衡的问题,通常取：sum(negative cases) / sum(positive cases)</span>
              <span class="token comment"># 'eval_metric': 'auc'</span>
              <span class="token punctuation">}</span>

    plst <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    num_rounds <span class="token operator">=</span> <span class="token number">5000</span> <span class="token comment"># 迭代次数</span>
    watchlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>xgb_train<span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xgb_val<span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 交叉验证</span>
    <span class="token comment"># result = xgb.cv(plst, xgb_train, num_boost_round=200, nfold=4, early_stopping_rounds=200, verbose_eval=True, folds=StratifiedKFold(n_splits=4).split(X, y))</span>
    <span class="token comment"># 训练模型并保存</span>
    <span class="token comment"># early_stopping_rounds 当设置的迭代次数较大时，early_stopping_rounds 可在一定的迭代次数内准确率没有提升就停止训练</span>
    model <span class="token operator">=</span> xgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>plst<span class="token punctuation">,</span> xgb_train<span class="token punctuation">,</span> num_rounds<span class="token punctuation">,</span> watchlist<span class="token punctuation">,</span> early_stopping_rounds<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    res<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>xgb_test<span class="token punctuation">)</span>
    res<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'%.6f'</span> <span class="token operator">%</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
</code></pre> 
<p><strong>CBT</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/596c68cabeb9765036b8445e8a8e52b9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA 提交到远程仓库（Git）的详细图文步骤</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50b432a0a5018d79da7bba0b4b77dfcd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">双端队列（数据结构作业第七周的一道题目）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>