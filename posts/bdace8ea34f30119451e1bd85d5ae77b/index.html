<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>zigbee 使用串口来开关来控制灯 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="zigbee 使用串口来开关来控制灯" />
<meta property="og:description" content="#include &lt;ioCC2530.h&gt;
#define uint unsigned int
#define uchar unsigned char
#define LED1 P0_4 //定义P1_0为LED1的控制引脚
void Init_LED(); //声明LED初始化函数
void Init_Uart0(); //声明串口0初始化函数
void Init_Cfg_32M(); //声明初始化32M时钟初始化函数
void UR0SendByte(unsigned char Byte);//声明发送一个字节初始化函数
void UR0SendString(unsigned char *str);//声明发送字符串初始化函数
void Execute_CMD(); //声明执行上位机命令初始化函数 char RxBuf; //定义接收缓冲区
char Rx_flag; //定义串口接收标志位
/*====================主函数入口====================*/
void main()
{
Init_Uart0(); //初始化串口0
Init_LED(); //初始化LED端口
Init_Cfg_32M(); //初始化32M晶振
UR0SendString(&#34; Hello ZigBee!\r\n&#34;);
while(1)
{
if(Rx_flag == 1) //是否接收到上位机指令
{
Execute_CMD(); //判断并执行上位机指令
}
}
}
/*===================LED初始化函数==================*/
void Init_LED()
{" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bdace8ea34f30119451e1bd85d5ae77b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-20T09:04:07+08:00" />
<meta property="article:modified_time" content="2022-05-20T09:04:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">zigbee 使用串口来开关来控制灯</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>#include &lt;ioCC2530.h&gt;</p> 
<p> </p> 
<p>#define uint unsigned int</p> 
<p>#define uchar unsigned char</p> 
<p> </p> 
<p>#define LED1 P0_4 //定义P1_0为LED1的控制引脚</p> 
<p> </p> 
<p> </p> 
<p>void Init_LED(); //声明LED初始化函数</p> 
<p>void Init_Uart0(); //声明串口0初始化函数</p> 
<p>void Init_Cfg_32M(); //声明初始化32M时钟初始化函数</p> 
<p>void UR0SendByte(unsigned char Byte);//声明发送一个字节初始化函数</p> 
<p>void UR0SendString(unsigned char *str);//声明发送字符串初始化函数</p> 
<p>void Execute_CMD(); //声明执行上位机命令初始化函数 </p> 
<p> </p> 
<p>char RxBuf; //定义接收缓冲区</p> 
<p>char Rx_flag; //定义串口接收标志位</p> 
<p>/*====================主函数入口====================*/</p> 
<p>void main()</p> 
<p>{<!-- --></p> 
<p>  Init_Uart0(); //初始化串口0</p> 
<p>  Init_LED(); //初始化LED端口</p> 
<p> </p> 
<p>  Init_Cfg_32M(); //初始化32M晶振</p> 
<p>  </p> 
<p>  UR0SendString(" Hello ZigBee!\r\n");</p> 
<p>  </p> 
<p>  while(1)</p> 
<p>  {<!-- --></p> 
<p>    if(Rx_flag == 1) //是否接收到上位机指令</p> 
<p>    {<!-- --></p> 
<p>      </p> 
<p>      Execute_CMD(); //判断并执行上位机指令</p> 
<p>    }</p> 
<p>  }</p> 
<p>}</p> 
<p>/*===================LED初始化函数==================*/</p> 
<p>void Init_LED()</p> 
<p>{<!-- --></p> 
<p>  P0SEL &amp;= ~0x10; ; //将P0_4设置为I/O</p> 
<p>  P0DIR |= 0x10; //将P0_4端口设置为输出</p> 
<p>  LED1 = 0; //关闭LED1灯</p> 
<p> </p> 
<p>}</p> 
<p>/*==================32M晶振初始化函数===============*/</p> 
<p>void Init_Cfg_32M()</p> 
<p>{<!-- --></p> 
<p>  CLKCONCMD &amp;= ~0x40; //系统时钟源选择：外部32MHz 。</p> 
<p>  while(!(SLEEPSTA &amp; 0x40));//等待晶振稳定</p> 
<p>  CLKCONCMD &amp;= ~0x47; //128分频 CLKSPD不发分频</p> 
<p>  SLEEPCMD |= 0x04; //关闭不用的RC振荡器</p> 
<p>}</p> 
<p>/*==================串口0初始化函数=================*/</p> 
<p>void Init_Uart0()</p> 
<p>{<!-- --></p> 
<p>  PERCFG = 0x00; // USART 0 I/O location: alternative 1 location</p> 
<p>    P0SEL = 0x3c; // P0_2, P0_3 as peripheral function</p> 
<p>    P2DIR &amp;= ~0xc0; // Port 0 periphera 1st priority: USART 0</p> 
<p> </p> 
<p>    U0CSR |= 0x80; // USART mode select: UART mode</p> 
<p> </p> 
<p>    /* Baud: 115200 */</p> 
<p>    U0GCR |= 11; // BAUD_E</p> 
<p>    U0BAUD |= 216; // BAUD_M</p> 
<p> </p> 
<p>    UTX0IF = 0; // Clear tx-interrupt flag</p> 
<p>    URX0IF = 0; // Clear rx-interrupt flag</p> 
<p>    URX0IE = 1; // Enable rx interrupt</p> 
<p>    EA = 1; // Enable interrupts</p> 
<p> </p> 
<p>    U0CSR |= 0x40; // Enable UART-Rx</p> 
<p>}</p> 
<p>/*=================串口0接收中断函数=================*/</p> 
<p>#pragma vector = URX0_VECTOR</p> 
<p>__interrupt void URX0_ISR()</p> 
<p>{<!-- --></p> 
<p>  URX0IF = 0; //清中断标志位</p> 
<p>  RxBuf = U0DBUF; //将缓冲寄存器的数据给读出来</p> 
<p>  Rx_flag = 1; //接收标志位置1</p> 
<p>}</p> 
<p>/*================串口0发送一个字节函数==============*/</p> 
<p>void UR0SendByte(unsigned char Byte)</p> 
<p>{<!-- --></p> 
<p>  U0DBUF = Byte; //将要发送的一个字节数据写入U0DBUF</p> 
<p>  while(!UTX0IF); //等待TX中断标志，即数据发送完成</p> 
<p>  UTX0IF = 0; //清除TX中断标志，准备下一次发送</p> 
<p>}</p> 
<p>/*================串口0发送字符串函数================*/</p> 
<p>void UR0SendString(unsigned char *str)</p> 
<p>{<!-- --></p> 
<p>  while(*str != '\0')     </p> 
<p>  {<!-- --></p> 
<p>    UR0SendByte(*str++); //逐个发送字符串中的字节</p> 
<p>  }</p> 
<p>}</p> 
<p>/*================执行上位机指令函数=================*/</p> 
<p>void Execute_CMD()</p> 
<p>{<!-- --></p> 
<p>  Rx_flag = 0; //清0接收标志位</p> 
<p>         //如果PC发送00xE1 则点亮LED1 并串口发送字符串</p> 
<p> </p> 
<p>  switch(RxBuf){<!-- --></p> 
<p>  case '1':</p> 
<p>    LED1 = 1;</p> 
<p>    UR0SendString("The LED1 is Open!\r\n");</p> 
<p>    break;</p> 
<p>  case '2':</p> 
<p>    LED1 = 0;</p> 
<p>    UR0SendString("The LED1 is Close!\r\n");</p> 
<p>    break;</p> 
<p>  }</p> 
<p>  </p> 
<p>}</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3caa6418e52fb7a363688c0e949e12fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot邮件发送</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/afa300621096240712bf42b6adc821f3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java中动态脚本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>