<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>树状数组讲解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="树状数组讲解" />
<meta property="og:description" content="目录：
单点修改，区间查询：
题目描述：
lowbit()运算：
插入、修改单点数据：
计算前缀和：
完整代码：
区间修改，单点查询：
计算差分数组：
计算每个点的值：
完整代码：
单点修改，区间查询： 题目描述： 如题，已知一个数列，你需要进行下面两种操作：
将某一个数加上 x
求出某区间每一个数的和
输入格式
第一行包含两个正整数 n, m，分别表示该数列数字的个数和操作的总个数。
第二行包含 n 个用空格分隔的整数，其中第 i 个数字表示数列第 i 项的初始值。
接下来 m 行每行包含 3 个整数，表示一个操作，具体如下：
1 x k 含义：将第 x 个数加上 k
2 x y 含义：输出区间 [x, y] 内每个数的和
输出格式
输出包含若干行整数，即为所有操作 2 的结果。
lowbit()运算： //非负整数n在二进制表示下最低位1及其后面的0构成的数值 //eg.lowbit(12) = lowbit((1100)2) = (100)2 = 4 //将1100按位取反后加一得到0100，会发现除了最低位的一和后面的零，其余位上与原数均相反 //故两者按位与后正好得到最低位1及其后面的0构成的数值 //又取反加一为补码，故lowbit为k &amp; -k int lowbit(int k) { return k &amp; -k; } 插入、修改单点数据： //如图： //tree[x]保存以x为根的子树中叶节点值的和 //将x转化为二进制后，发现每一层的末尾的零的个数都相同 //且tree[x]覆盖的长度即为lowbit(x)的值 //tree[x]的父节点为tree[x &#43; lowbit(x)] void add(int x, int k) { while(x &lt;= n) { tree[x] &#43;= k; x &#43;= lowbit(x); } } 计算前缀和： //由图可知，若求前7项的和，则该值为tree[7] &#43; tree[6] &#43; tree[4] //故，通过循环可以求出结果 int sum(int x) { int ans = 0; while(x !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b8448660d523239df2a72d665a6ea8e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-04T15:09:16+08:00" />
<meta property="article:modified_time" content="2023-04-04T15:09:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">树状数组讲解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong>目录：</strong></p> 
 <p> </p> 
 <p><a href="#%E5%8D%95%E7%82%B9%E4%BF%AE%E6%94%B9%EF%BC%8C%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%EF%BC%9A" rel="nofollow">单点修改，区间查询：</a></p> 
 <p><a href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%EF%BC%9A" rel="nofollow">        </a><a href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%EF%BC%9A" rel="nofollow">题目描述：</a></p> 
 <p><a href="#lowbit%28%29%E8%BF%90%E7%AE%97%EF%BC%9A" rel="nofollow">        </a><a href="#lowbit%28%29%E8%BF%90%E7%AE%97%EF%BC%9A" rel="nofollow">lowbit()运算：</a></p> 
 <p><a href="#%C2%A0%E6%8F%92%E5%85%A5%E3%80%81%E4%BF%AE%E6%94%B9%E5%8D%95%E7%82%B9%E6%95%B0%E6%8D%AE%EF%BC%9A" rel="nofollow">        </a><a href="#%C2%A0%E6%8F%92%E5%85%A5%E3%80%81%E4%BF%AE%E6%94%B9%E5%8D%95%E7%82%B9%E6%95%B0%E6%8D%AE%EF%BC%9A" rel="nofollow">插入、修改单点数据：</a></p> 
 <p><a href="#%E8%AE%A1%E7%AE%97%E5%89%8D%E7%BC%80%E5%92%8C%EF%BC%9A" rel="nofollow">        </a><a href="#%E8%AE%A1%E7%AE%97%E5%89%8D%E7%BC%80%E5%92%8C%EF%BC%9A" rel="nofollow">计算前缀和：</a></p> 
 <p><a href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">        </a><a href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">完整代码：</a></p> 
 <p><a href="#%E5%8C%BA%E9%97%B4%E4%BF%AE%E6%94%B9%EF%BC%8C%E5%8D%95%E7%82%B9%E6%9F%A5%E8%AF%A2%EF%BC%9A" rel="nofollow">区间修改，单点查询：</a></p> 
 <p><a href="#%E8%AE%A1%E7%AE%97%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84%EF%BC%9A" rel="nofollow">        </a><a href="#%E8%AE%A1%E7%AE%97%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84%EF%BC%9A" rel="nofollow">计算差分数组：</a></p> 
 <p><a href="#%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E7%82%B9%E7%9A%84%E5%80%BC%EF%BC%9A" rel="nofollow">        </a><a href="#%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E7%82%B9%E7%9A%84%E5%80%BC%EF%BC%9A" rel="nofollow">计算每个点的值：</a></p> 
 <p><a href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">        </a><a href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow">完整代码：</a></p> 
</blockquote> 
<hr id="hr-toc"> 
<h3>单点修改，区间查询：</h3> 
<hr> 
<h4 id="%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%EF%BC%9A">题目描述：</h4> 
<p>如题，已知一个数列，你需要进行下面两种操作：</p> 
<ul><li> <p>将某一个数加上 x</p> </li><li> <p>求出某区间每一个数的和</p> </li></ul> 
<p><strong>输入格式</strong></p> 
<p>第一行包含两个正整数 n, m，分别表示该数列数字的个数和操作的总个数。</p> 
<p>第二行包含 n 个用空格分隔的整数，其中第 i 个数字表示数列第 i 项的初始值。</p> 
<p>接下来 m 行每行包含 3 个整数，表示一个操作，具体如下：</p> 
<ul><li> <p><code>1 x k</code> 含义：将第 x 个数加上 k</p> </li><li> <p><code>2 x y</code> 含义：输出区间 [x, y] 内每个数的和</p> </li></ul> 
<p><strong>输出格式</strong></p> 
<p>输出包含若干行整数，即为所有操作 2 的结果。</p> 
<h4 id="lowbit()%E8%BF%90%E7%AE%97%EF%BC%9A">lowbit()运算：</h4> 
<pre><code class="language-cpp">//非负整数n在二进制表示下最低位1及其后面的0构成的数值
//eg.lowbit(12) = lowbit((1100)2) = (100)2 = 4
//将1100按位取反后加一得到0100，会发现除了最低位的一和后面的零，其余位上与原数均相反
//故两者按位与后正好得到最低位1及其后面的0构成的数值
//又取反加一为补码，故lowbit为k &amp; -k
int lowbit(int k) {
    return k &amp; -k;
}</code></pre> 
<h4 id="%C2%A0%E6%8F%92%E5%85%A5%E3%80%81%E4%BF%AE%E6%94%B9%E5%8D%95%E7%82%B9%E6%95%B0%E6%8D%AE%EF%BC%9A"> 插入、修改单点数据：</h4> 
<p><img alt="" height="265" src="https://images2.imgbox.com/38/62/99vJ43Wo_o.jpg" width="424"></p> 
<pre><code class="language-cpp">//如图：
//tree[x]保存以x为根的子树中叶节点值的和
//将x转化为二进制后，发现每一层的末尾的零的个数都相同
//且tree[x]覆盖的长度即为lowbit(x)的值
//tree[x]的父节点为tree[x + lowbit(x)]
void add(int x, int k) {
    while(x &lt;= n) {
        tree[x] += k;
        x += lowbit(x);
    }
}</code></pre> 
<h4 id="%E8%AE%A1%E7%AE%97%E5%89%8D%E7%BC%80%E5%92%8C%EF%BC%9A">计算前缀和：</h4> 
<pre><code class="language-cpp">//由图可知，若求前7项的和，则该值为tree[7] + tree[6] + tree[4]
//故，通过循环可以求出结果
int sum(int x) {
    int ans = 0;
    while(x != 0) {
        ans += tree[x];
        x -= lowbit(x);
    }
    return ans;
}</code></pre> 
<h4 id="%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%9A">完整代码：</h4> 
<pre><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 5e5 + 10;
int n, m, a, flag, p, q, tree[N];

int lowbit(int k) {
    return k &amp; -k;
}

void add(int x, int k) {
    while(x &lt;= n) {
        tree[x] += k;
        x += lowbit(x);
    }
}

int sum(int x) {
    int ans = 0;
    while(x != 0) {
        ans += tree[x];
        x -= lowbit(x);
    }
    return ans;
}

int main() {
    scanf("%d %d", &amp;n, &amp;m);
    for(int i = 1; i &lt;= n; ++i) {
        scanf("%d", &amp;a);
        add(i, a);
    }
    for(int i = 1; i &lt;= m; ++i) {
        scanf("%d %d %d", &amp;flag, &amp;p, &amp;q);
        if(flag == 1)
            add(p, q);
        else
            printf("%d\n", sum(q) - sum(p - 1));
    }
    return 0;
}
</code></pre> 
<p></p> 
<p></p> 
<h3 id="%E5%8C%BA%E9%97%B4%E4%BF%AE%E6%94%B9%EF%BC%8C%E5%8D%95%E7%82%B9%E6%9F%A5%E8%AF%A2%EF%BC%9A">区间修改，单点查询：</h3> 
<hr> 
<h4 id="%E8%AE%A1%E7%AE%97%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84%EF%BC%9A">计算差分数组：</h4> 
<pre><code class="language-cpp">//与单点修改、区间查询类似
void add(int x, int k) {
    while(x &lt;= n) {
        tree[x] += k;
        x += lowbit(x);
    }
}</code></pre> 
<h4 id="%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E7%82%B9%E7%9A%84%E5%80%BC%EF%BC%9A">计算每个点的值：</h4> 
<pre><code class="language-cpp">//与单点修改、区间查询类似
//此时计算的结果为每个点的值
int query(int x) {
    int ans = 0;
    while(x != 0) {
        ans += tree[x];
        x -= lowbit(x);
    }
    return ans;
}</code></pre> 
<h4>完整代码：</h4> 
<pre><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 5e5 + 10;
int n, m, now, last, flag, p, q, num, tree[N];

int lowbit(int k) {
    return k &amp; -k;
}

void add(int x, int k) {
    while(x &lt;= n) {
        tree[x] += k;
        x += lowbit(x);
    }
}

int query(int x) {
    int ans = 0;
    while(x != 0) {
        ans += tree[x];
        x -= lowbit(x);
    }
    return ans;
}

int main() {
    scanf("%d %d", &amp;n, &amp;m);
    //计算差分数组，将相差的值放入数组中
    //eg.原本的数组应为a[] = {1, 6, 8, 5, 10}
    //则差分数组应为b[] = {1, 5, 2, -3, 5}
    for(int i = 1; i &lt;= n; ++i) {
        scanf("%d", &amp;now);
        add(i, now - last);
        last = now;
    }
    for(int i = 1; i &lt;= m; ++i) {
        scanf("%d", &amp;flag);
        //若要修改区间[p, q]的值
        //例如上述举的例子，若要将区间[2, 4]均加上3
        //则原数组变为a[] = {1, 9, 11, 8, 10}
        //差分数组变为b[] = {1, 8, 2, -3, 2}
        //即对差分数组来说只需修改下标为p的值，和下标为q + 1的值
        if(flag == 1) {
            scanf("%d %d %d", &amp;p, &amp;q, &amp;num);
            add(p, num);
            add(q + 1, -num);
        }
        //若查询某个点的值
        //前p个差分数组的值相加即为该点的值
        //与单点修改、区间查询中的求前缀和类似
        else {
            scanf("%d", &amp;p);
            printf("%d\n", query(p));
        }
    }
    return 0;
}
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a3455e4c5ab2ff1677640e5da5944b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">科普：什么是CPU？CPU和芯片关系？CPU怎么做的？CPU有什么用？不同CPU有什么区别？我们怎么选CPU？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/319ccd67a718e0fd22a97268689a03c9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">word文档中工具栏不显示mathtype处理方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>