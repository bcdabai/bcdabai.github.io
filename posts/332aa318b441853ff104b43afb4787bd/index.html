<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s1.15安装详细精华版（环境准备、etcd集群安装、harbor私服搭建、高可用集群部署） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s1.15安装详细精华版（环境准备、etcd集群安装、harbor私服搭建、高可用集群部署）" />
<meta property="og:description" content="文章目录 一、环境准备1、硬件配置2、修改主机名和配置hosts文件3、安装依赖包4、设置防火墙规则、禁用selinux、关闭交换分区1）关闭防火墙2）开启iptables3）关闭交换分区4）禁用selinux 5、调整k8s内核参数6、加载ip_vs模块7、时钟同步、关闭需不需要的系统服务、设置系统日志1）时钟同步2）关闭需不需要的系统服务3）设置系统日志 二、搭建etcd集群1、环境信息2、设置环境变量3、cfssl下载4、ETCD下载4、复制可执行文件到其余master节点5、生成etcd CA、etcd证书（仅在一台机器上操作，然后scp到其他机器）6、ETCD配置文件7、创建etcd.service配置文件8、复制配置文件及启动文件到其余主节点9、检查etcd集群状态（cd /root/etcd-v3.3.12/）10、etcd集群的相关命令操作11、etcd集群备份 三、Harbor - 企业级 Docker 私有仓库1、底层环境依赖2、habor地址1）解压软件包： tar xvf harbor-offline-installer-&lt;version&gt;.tgz2）配置文件harbor.cfg释义 3、制作自签名证书文件1）创建ca证书2）证书签名3）签证证书 4、运行脚本进行安装5、访问测试6、上传镜像进行上传测试1）指定镜像仓库地址2）下载测试镜像3）给镜像重新打标签4）登录进行认证并推送到私服 7、其它 Docker 客户端下载测试（远程机器）1）指定镜像仓库地址2）下载测试镜像 8、Harbor 原理说明1）软件资源介绍2）habor的主要组件（6个组件）3）Harbor 特性4）Harbor 认证过程5）Harbor 认证流程 四、k8s高可用集群1、硬件配置2、配置主机名3、ssh免秘钥登录4、初始化脚本5、安装docker18.06版本6、安装kube组件7、所有节点时间同步计划任务8、etcd集群安装以及高可用9、kubeadm初始化1、拉取镜像2、编写集群初始化的配置文件（某一个节点操作即可；如192.168.137.12）3、集群初始化（某一个节点操作即可；如192.168.137.12）4、完成会生成加入集群命令，在其余节点执行加入集群命令5、配置admin.conf文件来操作集群6、部署flannel网络（提前导入镜像quay.io/coreos/flannel:v0.11.0-amd64） 10、查看是否为IPVS模式11、验证dns12、查看apiserver信息13、将k8s集群中主节点也可以运行pod资源14、apiserer的高可用验证15、查看集群状态16、使用kubeadm创建完Kubernetes集群后, 默认会在/etc/kubernetes/pki目录下存放集群中需要用到的证书文件, 整体结构如下图所示: 一、环境准备 1、硬件配置 192.168.137.11 CentOS7.7.1908 2核2G&#43;50G存储 192.168.137.12	CentOS7.7.1908 2核2G&#43;50G存储 192.168.137.13	CentOS7.7.1908 2核2G&#43;50G存储 192.168.137.14	CentOS7.7.1908 2核2G&#43;50G存储 2、修改主机名和配置hosts文件 对应的主机上执行
hostnamectl set-hostname k8s-m1 hostnamectl set-hostname k8s-m2 hostnamectl set-hostname k8s-m3 hostnamectl set-hostname habor 所有主机上执行
echo &#39;192.168.137.11 k8s-m1&#39; &gt;&gt; /etc/hosts echo &#39;192.168.137.12 k8s-m2&#39; &gt;&gt; /etc/hosts echo &#39;192.168.137.13 k8s-m3&#39; &gt;&gt; /etc/hosts echo &#39;192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/332aa318b441853ff104b43afb4787bd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-11T23:58:24+08:00" />
<meta property="article:modified_time" content="2023-12-11T23:58:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s1.15安装详细精华版（环境准备、etcd集群安装、harbor私服搭建、高可用集群部署）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、环境准备</a></li><li><ul><li><a href="#1_2" rel="nofollow">1、硬件配置</a></li><li><a href="#2hosts_9" rel="nofollow">2、修改主机名和配置hosts文件</a></li><li><a href="#3_24" rel="nofollow">3、安装依赖包</a></li><li><a href="#4selinux_28" rel="nofollow">4、设置防火墙规则、禁用selinux、关闭交换分区</a></li><li><ul><li><a href="#1_29" rel="nofollow">1）关闭防火墙</a></li><li><a href="#2iptables_34" rel="nofollow">2）开启iptables</a></li><li><a href="#3_42" rel="nofollow">3）关闭交换分区</a></li><li><a href="#4selinux_46" rel="nofollow">4）禁用selinux</a></li></ul> 
    </li><li><a href="#5k8s_51" rel="nofollow">5、调整k8s内核参数</a></li><li><a href="#6ip_vs_71" rel="nofollow">6、加载ip_vs模块</a></li><li><a href="#7_85" rel="nofollow">7、时钟同步、关闭需不需要的系统服务、设置系统日志</a></li><li><ul><li><a href="#1_86" rel="nofollow">1）时钟同步</a></li><li><a href="#2_92" rel="nofollow">2）关闭需不需要的系统服务</a></li><li><a href="#3_96" rel="nofollow">3）设置系统日志</a></li></ul> 
   </li></ul> 
   </li><li><a href="#etcd_116" rel="nofollow">二、搭建etcd集群</a></li><li><ul><li><a href="#1_117" rel="nofollow">1、环境信息</a></li><li><a href="#2_123" rel="nofollow">2、设置环境变量</a></li><li><a href="#3cfssl_129" rel="nofollow">3、cfssl下载</a></li><li><a href="#4ETCD_135" rel="nofollow">4、ETCD下载</a></li><li><a href="#4master_140" rel="nofollow">4、复制可执行文件到其余master节点</a></li><li><a href="#5etcd_CAetcdscp_144" rel="nofollow">5、生成etcd CA、etcd证书（仅在一台机器上操作，然后scp到其他机器）</a></li><li><a href="#6ETCD_158" rel="nofollow">6、ETCD配置文件</a></li><li><a href="#7etcdservice_174" rel="nofollow">7、创建etcd.service配置文件</a></li><li><a href="#8_206" rel="nofollow">8、复制配置文件及启动文件到其余主节点</a></li><li><a href="#9etcdcd_rootetcdv3312_215" rel="nofollow">9、检查etcd集群状态（cd /root/etcd-v3.3.12/）</a></li><li><a href="#10etcd_232" rel="nofollow">10、etcd集群的相关命令操作</a></li><li><a href="#11etcd_261" rel="nofollow">11、etcd集群备份</a></li></ul> 
   </li><li><a href="#Harbor___Docker__266" rel="nofollow">三、Harbor - 企业级 Docker 私有仓库</a></li><li><ul><li><a href="#1_267" rel="nofollow">1、底层环境依赖</a></li><li><a href="#2habor_271" rel="nofollow">2、habor地址</a></li><li><ul><li><a href="#1__tar_xvf_harborofflineinstallerversiontgz_273" rel="nofollow">1）解压软件包： tar xvf harbor-offline-installer-&lt;version&gt;.tgz</a></li><li><a href="#2harborcfg_281" rel="nofollow">2）配置文件harbor.cfg释义</a></li></ul> 
    </li><li><a href="#3_292" rel="nofollow">3、制作自签名证书文件</a></li><li><ul><li><a href="#1ca_293" rel="nofollow">1）创建ca证书</a></li><li><a href="#2_300" rel="nofollow">2）证书签名</a></li><li><a href="#3_305" rel="nofollow">3）签证证书</a></li></ul> 
    </li><li><a href="#4_309" rel="nofollow">4、运行脚本进行安装</a></li><li><a href="#5_314" rel="nofollow">5、访问测试</a></li><li><a href="#6_316" rel="nofollow">6、上传镜像进行上传测试</a></li><li><ul><li><a href="#1_317" rel="nofollow">1）指定镜像仓库地址</a></li><li><a href="#2_328" rel="nofollow">2）下载测试镜像</a></li><li><a href="#3_332" rel="nofollow">3）给镜像重新打标签</a></li><li><a href="#4_336" rel="nofollow">4）登录进行认证并推送到私服</a></li></ul> 
    </li><li><a href="#7__Docker__341" rel="nofollow">7、其它 Docker 客户端下载测试（远程机器）</a></li><li><ul><li><a href="#1_342" rel="nofollow">1）指定镜像仓库地址</a></li><li><a href="#2_349" rel="nofollow">2）下载测试镜像</a></li></ul> 
    </li><li><a href="#8Harbor___353" rel="nofollow">8、Harbor 原理说明</a></li><li><ul><li><a href="#1_354" rel="nofollow">1）软件资源介绍</a></li><li><a href="#2habor6_365" rel="nofollow">2）habor的主要组件（6个组件）</a></li><li><a href="#3Harbor__375" rel="nofollow">3）Harbor 特性</a></li><li><a href="#4Harbor__384" rel="nofollow">4）Harbor 认证过程</a></li><li><a href="#5Harbor__392" rel="nofollow">5）Harbor 认证流程</a></li></ul> 
   </li></ul> 
   </li><li><a href="#k8s_398" rel="nofollow">四、k8s高可用集群</a></li><li><ul><li><a href="#1_400" rel="nofollow">1、硬件配置</a></li><li><a href="#2_413" rel="nofollow">2、配置主机名</a></li><li><a href="#3ssh_427" rel="nofollow">3、ssh免秘钥登录</a></li><li><a href="#4_432" rel="nofollow">4、初始化脚本</a></li><li><a href="#5docker1806_473" rel="nofollow">5、安装docker18.06版本</a></li><li><a href="#6kube_498" rel="nofollow">6、安装kube组件</a></li><li><a href="#7_511" rel="nofollow">7、所有节点时间同步计划任务</a></li><li><a href="#8etcd_520" rel="nofollow">8、etcd集群安装以及高可用</a></li><li><a href="#9kubeadm_523" rel="nofollow">9、kubeadm初始化</a></li><li><ul><li><a href="#1_524" rel="nofollow">1、拉取镜像</a></li><li><a href="#219216813712_536" rel="nofollow">2、编写集群初始化的配置文件（某一个节点操作即可；如192.168.137.12）</a></li><li><a href="#319216813712_559" rel="nofollow">3、集群初始化（某一个节点操作即可；如192.168.137.12）</a></li><li><a href="#4_563" rel="nofollow">4、完成会生成加入集群命令，在其余节点执行加入集群命令</a></li><li><a href="#5adminconf_571" rel="nofollow">5、配置admin.conf文件来操作集群</a></li><li><a href="#6flannelquayiocoreosflannelv0110amd64_577" rel="nofollow">6、部署flannel网络（提前导入镜像quay.io/coreos/flannel:v0.11.0-amd64）</a></li></ul> 
    </li><li><a href="#10IPVS_581" rel="nofollow">10、查看是否为IPVS模式</a></li><li><a href="#11dns_586" rel="nofollow">11、验证dns</a></li><li><a href="#12apiserver_590" rel="nofollow">12、查看apiserver信息</a></li><li><a href="#13k8spod_594" rel="nofollow">13、将k8s集群中主节点也可以运行pod资源</a></li><li><a href="#14apiserer_600" rel="nofollow">14、apiserer的高可用验证</a></li><li><a href="#15_605" rel="nofollow">15、查看集群状态</a></li><li><a href="#16kubeadmKubernetes_etckubernetespki__610" rel="nofollow">16、使用kubeadm创建完Kubernetes集群后, 默认会在/etc/kubernetes/pki目录下存放集群中需要用到的证书文件, 整体结构如下图所示:</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、环境准备</h3> 
<h4><a id="1_2"></a>1、硬件配置</h4> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.137.11         CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储
<span class="token number">192.168</span>.137.12		   CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储
<span class="token number">192.168</span>.137.13	       CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储
<span class="token number">192.168</span>.137.14	       CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储
</code></pre> 
<h4><a id="2hosts_9"></a>2、修改主机名和配置hosts文件</h4> 
<p>对应的主机上执行</p> 
<pre><code class="prism language-bash">hostnamectl set-hostname k8s-m1
hostnamectl set-hostname k8s-m2
hostnamectl set-hostname k8s-m3
hostnamectl set-hostname habor
</code></pre> 
<p>所有主机上执行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.11 k8s-m1'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.12 k8s-m2'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.13 k8s-m3'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.14 habor'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre> 
<h4><a id="3_24"></a>3、安装依赖包</h4> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> conntrack ntpdate ntp ipvsadm ipset jq iptables <span class="token function">curl</span> sysstat libseccomp <span class="token function">wget</span> <span class="token function">vim</span> net-tools <span class="token function">git</span>
</code></pre> 
<h4><a id="4selinux_28"></a>4、设置防火墙规则、禁用selinux、关闭交换分区</h4> 
<h5><a id="1_29"></a>1）关闭防火墙</h5> 
<pre><code class="prism language-bash">systemctl  stop firewalld
systemctl  disable firewalld   
</code></pre> 
<h5><a id="2iptables_34"></a>2）开启iptables</h5> 
<pre><code class="prism language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> iptables-services
systemctl start iptables
systemctl <span class="token builtin class-name">enable</span> iptables
iptables <span class="token parameter variable">-F</span>  			 <span class="token comment">#清空策略</span>
<span class="token function">service</span> iptables save    <span class="token comment">#保存策略</span>
</code></pre> 
<h5><a id="3_42"></a>3）关闭交换分区</h5> 
<pre><code class="prism language-bash">swapoff <span class="token parameter variable">-a</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab 
</code></pre> 
<h5><a id="4selinux_46"></a>4）禁用selinux</h5> 
<pre><code class="prism language-bash">setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=.*/SELINUX=disabled/'</span> /etc/selinux/config   
</code></pre> 
<h4><a id="5k8s_51"></a>5、调整k8s内核参数</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/kubernetes.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-iptables=1
net.bridge.bridge-nf-call-ip6tables=1
net.ipv4.ip_forward=1
net.ipv4.tcp_tw_recycle=0
vm.swappiness=0 		 #禁止使用 swap 空间，只有当系统 OOM 时才允许使用它
vm.overcommit_memory=1 	 #不检查物理内存是否够用
vm.panic_on_oom=0 # 开启 OOM  
fs.inotify.max_user_instances=8192
fs.inotify.max_user_watches=1048576
fs.file-max=52706963
fs.nr_open=52706963
net.ipv6.conf.all.disable_ipv6=1
net.netfilter.nf_conntrack_max=2310720
EOF</span>
modprobe br_netfilter
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span> /etc/sysctl.d/kubernetes.conf
</code></pre> 
<h4><a id="6ip_vs_71"></a>6、加载ip_vs模块</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysconfig/modules/ipvs.modules <span class="token operator">&lt;&lt;</span><span class="token string">EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF</span>
<span class="token function">chmod</span> <span class="token number">755</span> /etc/sysconfig/modules/ipvs.modules
<span class="token function">bash</span> /etc/sysconfig/modules/ipvs.modules
lsmod <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> ip_vs <span class="token parameter variable">-e</span> nf_conntrack_ipv4
</code></pre> 
<h4><a id="7_85"></a>7、时钟同步、关闭需不需要的系统服务、设置系统日志</h4> 
<h5><a id="1_86"></a>1）时钟同步</h5> 
<pre><code class="prism language-bash">timedatectl set-timezone Asia/Shanghai    				<span class="token comment">#将当前的UTC时间写入硬件时钟</span>
timedatectl set-local-rtc <span class="token number">0</span>                             <span class="token comment">#重启依赖于系统时间的服务</span>
systemctl restart rsyslog <span class="token operator">&amp;&amp;</span> systemctl restart crond
</code></pre> 
<h5><a id="2_92"></a>2）关闭需不需要的系统服务</h5> 
<pre><code class="prism language-bash">systemctl stop postfix <span class="token operator">&amp;&amp;</span> systemctl disable postfix
</code></pre> 
<h5><a id="3_96"></a>3）设置系统日志</h5> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /var/log/journal <span class="token comment">#持久化保存日志的目录</span>
<span class="token function">mkdir</span> /etc/systemd/journald.conf.d
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/systemd/journald.conf.d/99-prophet.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
[Journal]
Storage=persistent     #持久化保存到磁盘
Compress=yes 	       #压缩历史日志
SyncIntervalSec=5m
RateLimitInterval=30s
RateLimitBurst=1000
SystemMaxUse=10G       #最大占用空间10G
SystemMaxFileSize=200M #单日志文件最大 200M
MaxRetentionSec=2week  #日志保存时间 2 周
ForwardToSyslog=no     #不将日志转发到 syslog
EOF</span>
</code></pre> 
<pre><code class="prism language-bash">systemctl restart systemd-journald
</code></pre> 
<h3><a id="etcd_116"></a>二、搭建etcd集群</h3> 
<h4><a id="1_117"></a>1、环境信息</h4> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.11 etcd01'</span>  <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.12 etcd02'</span>  <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.13 etcd03'</span>  <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre> 
<h4><a id="2_123"></a>2、设置环境变量</h4> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCD_version</span><span class="token operator">=</span>v3.3.12
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCD_SSL_DIR</span><span class="token operator">=</span>/etc/etcd/ssl
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SYSTEM_SERVICE_DIR</span><span class="token operator">=</span>/usr/lib/systemd/system
</code></pre> 
<h4><a id="3cfssl_129"></a>3、cfssl下载</h4> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/cfssl
<span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/cfssljson
<span class="token function">chmod</span> +x /usr/local/bin/cfssl /usr/local/bin/cfssljson
</code></pre> 
<h4><a id="4ETCD_135"></a>4、ETCD下载</h4> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://github.com/etcd-io/etcd/releases/download/<span class="token variable">${ETCD_version}</span>/etcd-<span class="token variable">${ETCD_version}</span>-linux-amd64.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> etcd-<span class="token variable">${ETCD_version}</span>-linux-amd64.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> etcd-<span class="token variable">${ETCD_version}</span>-linux-amd64
</code></pre> 
<h4><a id="4master_140"></a>4、复制可执行文件到其余master节点</h4> 
<pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> etcd0<span class="token punctuation">{<!-- --></span><span class="token number">1,2</span>,3<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">scp</span> etcd* root@<span class="token variable">$node</span>:/usr/local/bin/<span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre> 
<h4><a id="5etcd_CAetcdscp_144"></a>5、生成etcd CA、etcd证书（仅在一台机器上操作，然后scp到其他机器）</h4> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${ETCD_SSL_DIR}</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">${ETCD_SSL_DIR}</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> ca-config.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{"signing":{"default":{"expiry":"87600h"},"profiles":{"kubernetes":{"usages":["signing","key encipherment","server auth","client auth"],"expiry":"87600h"}}}}
EOF</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> etcd-ca-csr.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF 
{"CN":"etcd","key":{"algo":"rsa","size":2048},"names":[{"C":"CN","ST":"BeiJing","L":"BeiJing","O":"etcd","OU":"etcd"}]}
EOF</span>
cfssl gencert <span class="token parameter variable">-initca</span> etcd-ca-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> etcd-ca
cfssl gencert <span class="token parameter variable">-ca</span><span class="token operator">=</span>etcd-ca.pem -ca-key<span class="token operator">=</span>etcd-ca-key.pem <span class="token parameter variable">-config</span><span class="token operator">=</span>ca-config.json <span class="token parameter variable">-hostname</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1,192.168.137.11,192.168.137.12,192.168.137.13 <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes etcd-ca-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> etcd
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> *.json *.csr
<span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> etcd0<span class="token punctuation">{<!-- --></span><span class="token number">2,3</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">ssh</span> root@<span class="token variable">$node</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${ETCD_SSL_DIR}</span> /var/lib/etcd<span class="token punctuation">;</span><span class="token function">scp</span> * root@<span class="token variable">$node</span><span class="token builtin class-name">:</span><span class="token variable">${ETCD_SSL_DIR}</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre> 
<h4><a id="6ETCD_158"></a>6、ETCD配置文件</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /etc/etcd/config 
<span class="token comment">#[Member]</span>
<span class="token assign-left variable">ETCD_NAME</span><span class="token operator">=</span><span class="token string">"etcd01"</span> 									   <span class="token comment">#多个节点的话，名字不一样；如etcd02</span>
<span class="token assign-left variable">ETCD_DATA_DIR</span><span class="token operator">=</span><span class="token string">"/var/lib/etcd/default.etcd"</span>
<span class="token assign-left variable">ETCD_LISTEN_PEER_URLS</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2380"</span>    <span class="token comment">#对应实例的IP地址；如：https://192.168.137.12:2380</span>
<span class="token assign-left variable">ETCD_LISTEN_CLIENT_URLS</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379"</span>  <span class="token comment">#对应实例的IP地址；如：https://192.168.137.12:2379</span>
<span class="token comment">#[Clustering]</span>
<span class="token assign-left variable">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2380"</span> <span class="token comment">#对应实例的IP地址；如：https://192.168.137.12:2380</span>
<span class="token assign-left variable">ETCD_ADVERTISE_CLIENT_URLS</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379"</span>  <span class="token comment">#对应实例的IP地址；如：https://192.168.137.12:2379</span>
<span class="token assign-left variable">ETCD_INITIAL_CLUSTER</span><span class="token operator">=</span><span class="token string">"etcd01=https://192.168.137.11:2380,etcd02=https://192.168.137.12:2380,etcd03=https://192.168.137.13:2380"</span>
<span class="token assign-left variable">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="token operator">=</span><span class="token string">"etcd-cluster"</span>
<span class="token assign-left variable">ETCD_INITIAL_CLUSTER_STATE</span><span class="token operator">=</span><span class="token string">"new"</span>
</code></pre> 
<h4><a id="7etcdservice_174"></a>7、创建etcd.service配置文件</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /usr/lib/systemd/system/etcd.service 
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Etcd Server
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>notify
<span class="token assign-left variable">EnvironmentFile</span><span class="token operator">=</span>-/etc/etcd/config   <span class="token comment">#也可以不要这个文件，下面的变量全部用config文件中的值代替</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/root/etcd-v3.3.12/etcd <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token variable">${ETCD_NAME}</span> <span class="token punctuation">\</span>
--data-dir<span class="token operator">=</span><span class="token variable">${ETCD_DATA_DIR}</span> <span class="token punctuation">\</span>
--listen-peer-urls<span class="token operator">=</span><span class="token variable">${ETCD_LISTEN_PEER_URLS}</span> <span class="token punctuation">\</span>
--listen-client-urls<span class="token operator">=</span><span class="token variable">${ETCD_LISTEN_CLIENT_URLS}</span>,http://127.0.0.1:2379 <span class="token punctuation">\</span>
--advertise-client-urls<span class="token operator">=</span><span class="token variable">${ETCD_ADVERTISE_CLIENT_URLS}</span> <span class="token punctuation">\</span>
--initial-advertise-peer-urls<span class="token operator">=</span><span class="token variable">${ETCD_INITIAL_ADVERTISE_PEER_URLS}</span> <span class="token punctuation">\</span>
--initial-cluster<span class="token operator">=</span><span class="token variable">${ETCD_INITIAL_CLUSTER}</span> <span class="token punctuation">\</span>
--initial-cluster-token<span class="token operator">=</span><span class="token variable">${ETCD_INITIAL_CLUSTER_TOKEN}</span> <span class="token punctuation">\</span>
--initial-cluster-state<span class="token operator">=</span>new <span class="token punctuation">\</span>
--cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem <span class="token punctuation">\</span>
--key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem <span class="token punctuation">\</span>
--peer-cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem <span class="token punctuation">\</span>
--peer-key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem <span class="token punctuation">\</span>
--trusted-ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem <span class="token punctuation">\</span>
--peer-trusted-ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> 
<h4><a id="8_206"></a>8、复制配置文件及启动文件到其余主节点</h4> 
<pre><code class="prism language-bash"><span class="token function">scp</span> /etc/etcd/config <span class="token number">192.168</span>.137.12:/etc/etcd/   <span class="token comment">#需要修改config中的配置信息</span>
<span class="token function">scp</span> /etc/etcd/config <span class="token number">192.168</span>.137.13:/etc/etcd/   <span class="token comment">#需要修改config中的配置信息</span>
<span class="token function">scp</span> /usr/lib/systemd/system/etcd.service <span class="token number">192.168</span>.137.12:/usr/lib/systemd/system/
<span class="token function">scp</span> /usr/lib/systemd/system/etcd.service <span class="token number">192.168</span>.137.13:/usr/lib/systemd/system/
<span class="token comment">#修改配置文件后，主节点分别启动etcd</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> etcd
</code></pre> 
<h4><a id="9etcdcd_rootetcdv3312_215"></a>9、检查etcd集群状态（cd /root/etcd-v3.3.12/）</h4> 
<pre><code class="prism language-bash">etcdctl <span class="token punctuation">\</span>
--ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem <span class="token punctuation">\</span>
--cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem <span class="token punctuation">\</span>
--key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem <span class="token punctuation">\</span>
<span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379,https://192.168.137.12:2379,https://192.168.137.13:2379"</span> cluster-health
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-bash">etcdctl --ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem --cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem --key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem cluster-health
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> 
etcdctl <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379,https://192.168.137.12:2379,https://192.168.137.13:2379"</span>  <span class="token parameter variable">--cert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span> <span class="token parameter variable">--key</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span> <span class="token parameter variable">--cacert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span>  endpoint health
</code></pre> 
<h4><a id="10etcd_232"></a>10、etcd集群的相关命令操作</h4> 
<p>摘除etcd节点</p> 
<pre><code class="prism language-bash">./etcdctl --ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem --cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem --key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem member  remove <span class="token operator">&lt;</span>member_id<span class="token operator">&gt;</span>
systemctl stop etcd   <span class="token comment">#停止etcd服务</span>
yum remove <span class="token parameter variable">-y</span> etcd-xxxx   <span class="token comment">#卸载etcd</span>
./etcdctl --ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem --cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem --key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem member list  <span class="token comment">#再次查看</span>
</code></pre> 
<p>新增etcd节点</p> 
<pre><code class="prism language-bash">./etcdctl --ca-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-ca.pem --cert-file<span class="token operator">=</span>/etc/etcd/ssl/etcd.pem --key-file<span class="token operator">=</span>/etc/etcd/ssl/etcd-key.pem member <span class="token function">add</span> <span class="token operator">&lt;</span>etcd_name<span class="token operator">&gt;</span> http://<span class="token operator">&lt;</span>etcd_node_address<span class="token operator">&gt;</span>:2380
systemctl start etcd
</code></pre> 
<p>更新etcd节点</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span>
etcdctl  member update  <span class="token operator">&lt;</span>member-ID<span class="token operator">&gt;</span> http://<span class="token operator">&lt;</span>etcd_node_address_ip<span class="token operator">&gt;</span>:2380
</code></pre> 
<p>查看集群成员</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> 
etcdctl <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379,https://192.168.137.12:2379,https://192.168.137.13:2379"</span> <span class="token parameter variable">--cert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span> <span class="token parameter variable">--key</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span> <span class="token parameter variable">--cacert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span> member list --write-out<span class="token operator">=</span>table
</code></pre> 
<p>查看节点状态（可以看到leader节点）</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> 
etcdctl <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379,https://192.168.137.12:2379,https://192.168.137.13:2379"</span> <span class="token parameter variable">--cert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span> <span class="token parameter variable">--key</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span> <span class="token parameter variable">--cacert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span> endpoint status --write-out<span class="token operator">=</span>table
</code></pre> 
<h4><a id="11etcd_261"></a>11、etcd集群备份</h4> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> 
etcdctl <span class="token parameter variable">--cert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd.pem"</span> <span class="token parameter variable">--key</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-key.pem"</span> <span class="token parameter variable">--cacert</span><span class="token operator">=</span><span class="token string">"/etc/etcd/ssl/etcd-ca.pem"</span> <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.137.11:2379,https://192.168.137.12:2379,https://192.168.137.13:2379"</span>  snapshot save  snapshot.db
</code></pre> 
<h3><a id="Harbor___Docker__266"></a>三、Harbor - 企业级 Docker 私有仓库</h3> 
<h4><a id="1_267"></a>1、底层环境依赖</h4> 
<p>Python应该是 2.7或更高版本<br> Docker引擎应为 1.10或更高版本<br> Docker Compose需要为 1.6.0或更高版本</p> 
<h4><a id="2habor_271"></a>2、habor地址</h4> 
<p>Harbor 官方地址： https://github.com/vmware/harbor/releases</p> 
<h5><a id="1__tar_xvf_harborofflineinstallerversiontgz_273"></a>1）解压软件包： tar xvf harbor-offline-installer-.tgz</h5> 
<pre><code class="prism language-bash">https://github.com/vmware/harbor/releases/download/v1.2.0/harbor-offline-installer-v1.2.0.tgz
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://storage.googleapis.com/harbor-releases/harbor-offline-installer-v1.5.0.tgz
</code></pre> 
<h5><a id="2harborcfg_281"></a>2）配置文件harbor.cfg释义</h5> 
<p>hostname：目标的主机名或者完全限定域名<br> ui_url_protocol：http或https。默认为 http，修改为https时必须要做<code>3、制作自签名证书文件</code>这步骤<br> db_password：用于 db_auth的MySQL数据库的根密码。更改此密码进行任何生产用途<br> max_job_workers：（默认值为 3）作业服务中的复制工作人员的最大数量。<br> 对于每个映像复制作业，工作人员将存储库的所有标签同步到远程目标。增加此数字允许系统中更多的并发复制作业。但是，由于每个工作人员都会消耗一定数量的网络/CPU/IO资源，请根据主机的硬件资源，仔细选择该属性的值<br> customize_crt：（ on或off。默认为 on）当此属性打开时，prepare脚本将为注册表的令牌的生成/验证创建私钥和根证书<br> ssl_cert：SSL证书的路径，仅当协议设置为https时才应用<br> ssl_cert_key：SSL密钥的路径，仅当协议设置为https时才应用<br> secretkey_path：用于在复制策略中加密或解密远程注册表的密码的密钥路径</p> 
<h4><a id="3_292"></a>3、制作自签名证书文件</h4> 
<h5><a id="1ca_293"></a>1）创建ca证书</h5> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/cert
<span class="token builtin class-name">cd</span> /data/cert
openssl req <span class="token parameter variable">-newkey</span> rsa:4096 <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-keyout</span> ca.key <span class="token parameter variable">-x509</span> <span class="token parameter variable">-days</span> <span class="token number">365</span> <span class="token parameter variable">-out</span> ca.crt 
<span class="token comment">#国家名称CN---&gt;省份BJ---&gt;城市BJ---&gt;公司名Myhabor(可以自定义)---&gt;组织名myhabor(可自定义)---&gt;主机名或者域名www.myhabor.com(最好接habor.cfg种对应)---&gt;邮箱号wkx_0422@163.com---&gt;回车即可</span>
</code></pre> 
<h5><a id="2_300"></a>2）证书签名</h5> 
<pre><code class="prism language-bash">openssl req <span class="token parameter variable">-newkey</span> rsa:4096 <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-keyout</span> harbor01.key <span class="token parameter variable">-out</span> harbor01.csr 
<span class="token comment">#国家名称CN---&gt;省份BJ---&gt;城市BJ---&gt;公司名Myhabor(可以自定义)---&gt;组织名myhabor(可自定义)---&gt;主机名或者域名www.myhabor.com(最好接habor.cfg种对应)---&gt;邮箱号wkx_0422@163.com---&gt;连续按两次回车即可</span>
</code></pre> 
<h5><a id="3_305"></a>3）签证证书</h5> 
<pre><code class="prism language-bash">openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-days</span> <span class="token number">365</span> <span class="token parameter variable">-in</span> harbor01.csr <span class="token parameter variable">-CA</span> ca.crt <span class="token parameter variable">-CAkey</span> ca.key <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-out</span> harbor01.crt 
</code></pre> 
<h4><a id="4_309"></a>4、运行脚本进行安装</h4> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> +x install.sh
./install.sh
</code></pre> 
<h4><a id="5_314"></a>5、访问测试</h4> 
<p>https://www.myhabor.com 的管理员门户（将 reg.yourdomain.com更改为您的主机名harbor.cfg）。请注意，默认管理员用户名 /密码为 admin / Harbor12345</p> 
<h4><a id="6_316"></a>6、上传镜像进行上传测试</h4> 
<h5><a id="1_317"></a>1）指定镜像仓库地址</h5> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /etc/docker/daemon.json
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"exec-opts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"native.cgroupdriver=systemd"</span><span class="token punctuation">]</span>,
  <span class="token string">"log-driver"</span><span class="token builtin class-name">:</span> <span class="token string">"json-file"</span>,
  <span class="token string">"log-opts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"max-size"</span><span class="token builtin class-name">:</span> <span class="token string">"100m"</span><span class="token punctuation">}</span>,
  <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"http://7eb68c46.m.daocloud.io"</span><span class="token punctuation">]</span>,
  <span class="token string">"insecure-registries"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://www.myhabor.com"</span>,<span class="token string">"https://pee6w651.mirror.aliyuncs.com"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2_328"></a>2）下载测试镜像</h5> 
<pre><code class="prism language-bash"><span class="token function">docker</span>  pull  centos
</code></pre> 
<h5><a id="3_332"></a>3）给镜像重新打标签</h5> 
<pre><code class="prism language-bash"><span class="token function">docker</span> tag centos:latest www.myhabor.com/library/centos:v1
</code></pre> 
<h5><a id="4_336"></a>4）登录进行认证并推送到私服</h5> 
<pre><code class="prism language-bash"><span class="token function">docker</span> login http://www.myhabor.com
<span class="token function">docker</span> push www.myhabor.com/library/centos:v1
</code></pre> 
<h4><a id="7__Docker__341"></a>7、其它 Docker 客户端下载测试（远程机器）</h4> 
<h5><a id="1_342"></a>1）指定镜像仓库地址</h5> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /etc/docker/daemon.json
<span class="token punctuation">{<!-- --></span>
 <span class="token string">"insecure-registries"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"serverip"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2_349"></a>2）下载测试镜像</h5> 
<pre><code class="prism language-bash"><span class="token function">docker</span> pull  www.myhabor.com/library/centos:v1
</code></pre> 
<h4><a id="8Harbor___353"></a>8、Harbor 原理说明</h4> 
<h5><a id="1_354"></a>1）软件资源介绍</h5> 
<p>Harbor是VMware公司开源的企业级DockerRegistry项目，项目地址为 https://github.com/vmware/harbor。其目标是帮助用户迅速搭建一个企业级的Dockerregistry服务。它以Docker公司开源的registry为基础，提供了管理UI，基于角色的访问控制(Role Based Access Control)，AD/LDAP集成、以及审计日志 (Auditlogging) 等企业用户需求的功<br> 能，同时还原生支持中文。Harbor的每个组件都是以Docker容器的形式构建的，使用Docker Compose来对它进行部署。用于部署 Harbor的Docker Compose模板位于/Deployer/docker-compose.yml，由 5个容器组成，这几个容器通过Docker link的形式连接在一起，在容器之间通过容器名字互相访问。对终端用户而言，只需要暴露proxy （ 即<br> Nginx）的服务端口</p> 
<ol><li>Proxy：由 Nginx 服务器构成的反向代理。</li><li>Registry：由 Docker官方的开源 registry 镜像构成的容器实例。</li><li>UI：即架构中的core services， 构成此容器的代码是Harbor 项目的主体。</li><li>MySQL：由官方MySQL 镜像构成的数据库容器。</li><li>og：运行着rsyslogd 的容器，通过log-driver 的形式收集其他容器的日志</li></ol> 
<h5><a id="2habor6_365"></a>2）habor的主要组件（6个组件）</h5> 
<ol><li>proxy：habor的registry，ui，token等服务通过一个前置的反向代理统一接受浏览器、docker客户端的请求，并将请求转给不同的服务</li><li>registry：负责存储docker镜像，并出炉docker pull/push命令。由于我们要对用户进行访问控制，即不同的用户具有不同的读写权限，registry会制定一个token服务，强制用户的每次docker pull/push请求都要携带一个合法的token，registry会通过公钥对token进行加密验证</li><li>core service：这是核心，主要提供以下服务：<br> UI:提供图像界面，帮助用户管理registry上的镜像，并对用户进行授权<br> webhook：为及时获取registry上image状态的变化，在registry上配置webhook，把状态变化传递给ui模块<br> token：负责根据用户权限给每个docker pull/push 命令签发token。docker 客户端向registry服务发起的请求，如果不包含token会被重定向到这里，获得token后在重定向registry进行请求</li><li>database：为core services提供数据服务，负责存储用户权限、审计日志、docker image分组信息等数据</li><li>job service：提供远程复制功能，可以把本地镜像同步到其他harbor实例中</li><li>log collector：为了帮助监控harbor运行，负责收集其他组件log，供日后进行分析</li></ol> 
<h5><a id="3Harbor__375"></a>3）Harbor 特性</h5> 
<ol><li>基于角色控制：用户和仓库都是基于项目进行组织的，而用户基于项目可以拥有不同的权限</li><li>基于镜像的复制策略：镜像可以在多个Harbor实例之间进行复制</li><li>支持 LDAP：Harbor的用户授权可以使用已经存在LDAP用户</li><li>用户 UI：用户可以轻松的浏览、搜索镜像仓库以及对项目进行管理</li><li>审计管理：所有针对镜像仓库的记录都可以被记录追溯，用户审计管理</li><li>轻松的部署功能：Harbor提供了 online、offline安装，除此之外还提供了virtualappliance安装</li><li>Harbor 和 docker registry 关系：Harbor实质上是对 docker registry 做了封装，扩展了自己的业务模块</li><li>镜像删除&amp;垃圾回收：Image可以被删除并且回收Image占用的空间，绝大部分的用户操作API，方便用户对系统进行扩展</li></ol> 
<h5><a id="4Harbor__384"></a>4）Harbor 认证过程</h5> 
<ol><li>dockerdaemon从docker registry拉取镜像。</li><li>如果 dockerregistry需要进行授权时，registry将会返回 401 Unauthorized响应，同时在响应中包含了docker client如何进行认证的信息。</li><li>dockerclient根据 registry返回的信息，向 auth server发送请求获取认证token。</li><li>auth server则根据自己的业务实现去验证提交的用户信息是否存符合业务要求。</li><li>用户数据仓库返回用户的相关信息。</li><li>auth server将会根据查询的用户信息，生成token令牌，以及当前用户所具有的相关权限信息.上述就是完整的授权过程<br> 当用户完成上述过程以后便可以执行相关的pull/push操作。认证信息会每次都带在请求头中</li></ol> 
<h5><a id="5Harbor__392"></a>5）Harbor 认证流程</h5> 
<ol><li>首先，请求被代理容器监听拦截，并跳转到指定的认证服务器。</li><li>如果认证服务器配置了权限认证，则会返回401。通知 dockerclient在特定的请求中需要带上一个合法的token。而认证的逻辑地址则指向架构图中的core services。</li><li>当docker client接受到错误 code。client就会发送认证请求 (带有用户名和密码 )到coreservices进行 basic auth认证。</li><li>当C的请求发送给 ngnix以后，ngnix会根据配置的认证地址将带有用户名和密码的请求发送到core serivces。</li><li>coreservices获取用户名和密码以后对用户信息进行认证(自己的数据库或者介入LDAP都可以)</li></ol> 
<h3><a id="k8s_398"></a>四、k8s高可用集群</h3> 
<p>1、3、4的操作同<code>一、环境准备</code>中的操作一样</p> 
<h4><a id="1_400"></a>1、硬件配置</h4> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.137.11		   CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储   
<span class="token number">192.168</span>.137.12	       CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储
<span class="token number">192.168</span>.137.13	       CentOS7.7.1908       <span class="token number">2</span>核2G+50G存储   
</code></pre> 
<p>主机说明</p> 
<pre><code class="prism language-bash">k8s-vip：192.168.137.100	
k8s-m1：192.168.137.11	
k8s-m2：192.168.137.12	
k8s-m3：192.168.137.13
</code></pre> 
<h4><a id="2_413"></a>2、配置主机名</h4> 
<p>对应的主机上执行</p> 
<pre><code class="prism language-bash">hostnamectl set-hostname k8s-m1
hostnamectl set-hostname k8s-m2
hostnamectl set-hostname k8s-m3
hostnamectl set-hostname habor
</code></pre> 
<p>所有主机上执行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.11 k8s-m1'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.12 k8s-m2'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'192.168.137.13 k8s-m3'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre> 
<h4><a id="3ssh_427"></a>3、ssh免秘钥登录</h4> 
<pre><code class="prism language-bash">ssh-keygen
ssh-copy-id root@192.168.137.11/12/13
</code></pre> 
<h4><a id="4_432"></a>4、初始化脚本</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> init_env.sh 
<span class="token comment">#!/bin/bash</span>
<span class="token comment">#关闭防火墙</span>
systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
<span class="token comment">#关闭SELINUX</span>
setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=enforcing$/SELINUX=disable/'</span> /etc/selinux/config
<span class="token comment">#关闭swap</span>
swapoff <span class="token parameter variable">-a</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.swappiness</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/.*swap.*/#&amp;/g'</span> /etc/fstab
<span class="token comment">#设置Docker所需参数</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/kubernetes.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-iptables=1
net.bridge.bridge-nf-call-ip6tables=1
net.ipv4.ip_forward=1
net.ipv4.tcp_tw_recycle=0
vm.swappiness=0 		 #禁止使用 swap 空间，只有当系统 OOM 时才允许使用它
vm.overcommit_memory=1 	 #不检查物理内存是否够用
vm.panic_on_oom=0 # 开启 OOM  
fs.inotify.max_user_instances=8192
fs.inotify.max_user_watches=1048576
fs.file-max=52706963
fs.nr_open=52706963
net.ipv6.conf.all.disable_ipv6=1
net.netfilter.nf_conntrack_max=2310720
EOF</span>
modprobe br_netfilter
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span> /etc/sysctl.d/kubernetes.conf
<span class="token comment">#加载ip_vs模块</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysconfig/modules/ipvs.modules <span class="token operator">&lt;&lt;</span><span class="token string">EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF</span>
<span class="token function">chmod</span> <span class="token number">755</span> /etc/sysconfig/modules/ipvs.modules <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> /etc/sysconfig/modules/ipvs.modules <span class="token operator">&amp;&amp;</span> lsmod <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> ip_vs <span class="token parameter variable">-e</span> nf_conntrack_ipv4
</code></pre> 
<h4><a id="5docker1806_473"></a>5、安装docker18.06版本</h4> 
<pre><code class="prism language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> yum-utils device-mapper-persistent-data lvm2 <span class="token function">wget</span> epel-release ipvsadm <span class="token function">vim</span> ntpdate
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce-18.06.1.ce-3.el7
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "registry-mirrors": ["https://gco4rcsp.mirror.aliyuncs.com"],
  "storage-driver": "overlay2",
  "storage-opts": [
    "overlay2.override_kernel_check=true"
  ],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
EOF</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
systemctl daemon-reload
systemctl restart <span class="token function">docker</span>
</code></pre> 
<h4><a id="6kube_498"></a>6、安装kube组件</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo <span class="token operator">&lt;&lt;</span><span class="token string">EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> kubelet-1.15.0 kubeadm-1.15.0 kubectl-1.15.0 <span class="token parameter variable">--disableexcludes</span><span class="token operator">=</span>kubernetes
</code></pre> 
<h4><a id="7_511"></a>7、所有节点时间同步计划任务</h4> 
<pre><code class="prism language-bash"><span class="token number">0</span> * * * * ntpdate <span class="token number">202.112</span>.10.36
</code></pre> 
<p>或</p> 
<pre><code class="prism language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/localtime
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime
</code></pre> 
<h4><a id="8etcd_520"></a>8、etcd集群安装以及高可用</h4> 
<p>参考<code>二、搭建etcd集群</code></p> 
<h4><a id="9kubeadm_523"></a>9、kubeadm初始化</h4> 
<h5><a id="1_524"></a>1、拉取镜像</h5> 
<pre><code class="prism language-bash">kubeadm config images list   <span class="token comment">#查看需要拉取的容器镜像</span>
<span class="token assign-left variable">images</span><span class="token operator">=</span><span class="token punctuation">(</span>kube-apiserver:v1.15.0 kube-controller-manager:v1.15.0 kube-scheduler:v1.15.0 kube-proxy:v1.15.0 pause:3.1 etcd:3.3.10 coredns:1.3.1<span class="token punctuation">)</span>  <span class="token comment">#下载要拉取的容器镜像组信息（三个主节点都要拉取）</span>
<span class="token comment">#写成for循环拉取镜像</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">image</span> <span class="token keyword">in</span> <span class="token variable">${images<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>
<span class="token keyword">do</span> 
<span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">${image}</span>
<span class="token function">docker</span> tag registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">${image}</span> k8s.gcr.io/<span class="token variable">${image}</span>
<span class="token function">docker</span> rmi registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">${image}</span>
<span class="token keyword">done</span>  
</code></pre> 
<h5><a id="219216813712_536"></a>2、编写集群初始化的配置文件（某一个节点操作即可；如192.168.137.12）</h5> 
<pre><code class="prism language-bash"><span class="token function">cat</span> kubeadm-config.yaml 
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.15.0
controlPlaneEndpoint: <span class="token string">"192.168.137.100:8443"</span>
etcd:
  external:
    endpoints:
    - https://192.168.137.11:2379
    - https://192.168.137.12:2379
    - https://192.168.137.13:2379
    caFile: /etc/etcd/ssl/etcd-ca.pem
    certFile: /etc/etcd/ssl/etcd.pem
    keyFile: /etc/etcd/ssl/etcd-key.pem
networking:
  podSubnet: <span class="token number">10.244</span>.0.0/16
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: ipvs
</code></pre> 
<h5><a id="319216813712_559"></a>3、集群初始化（某一个节点操作即可；如192.168.137.12）</h5> 
<pre><code class="prism language-bash">kubeadm init <span class="token parameter variable">--config</span><span class="token operator">=</span>kubeadm-config.yaml --upload-certs
</code></pre> 
<h5><a id="4_563"></a>4、完成会生成加入集群命令，在其余节点执行加入集群命令</h5> 
<pre><code class="prism language-bash">kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.137.100:8443 <span class="token punctuation">\</span>
<span class="token parameter variable">--token</span> vqisuo.iedkkpt9rp8mc8sj  <span class="token punctuation">\</span>
--discovery-token-ca-cert-hash sha256:c58d0ba7dc6249b031fb37be2e02000ee1ccc3c423f7dc24a94389fd72400cce <span class="token punctuation">\</span> 
--experimental-control-plane <span class="token punctuation">\</span>
--certificate-key 3729cfcb665558ab3adb007cde46b43399e7a1674493ba36b66e3c1ba9f88a3c
</code></pre> 
<h5><a id="5adminconf_571"></a>5、配置admin.conf文件来操作集群</h5> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre> 
<h5><a id="6flannelquayiocoreosflannelv0110amd64_577"></a>6、部署flannel网络（提前导入镜像quay.io/coreos/flannel:v0.11.0-amd64）</h5> 
<pre><code class="prism language-bash">kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/coreos/flannel/62e44c867a2846fefb68bd5f178daf4da3095ccb/Documentation/kube-flannel.yml
</code></pre> 
<h4><a id="10IPVS_581"></a>10、查看是否为IPVS模式</h4> 
<pre><code class="prism language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-tanlp</span> <span class="token operator">|</span><span class="token function">grep</span> kube-proxy  <span class="token comment">#查找kube-proxy占用本地的</span>
<span class="token function">curl</span> http://127.0.0.1:10249/proxyMode  <span class="token comment">#看是否是ipvs模式</span>
</code></pre> 
<h4><a id="11dns_586"></a>11、验证dns</h4> 
<pre><code class="prism language-bash">kubectl run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> busybox <span class="token parameter variable">--image</span><span class="token operator">=</span>busybox:1.28（输入nslookup kubernetes ）
</code></pre> 
<h4><a id="12apiserver_590"></a>12、查看apiserver信息</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /root/.kube/config
</code></pre> 
<h4><a id="13k8spod_594"></a>13、将k8s集群中主节点也可以运行pod资源</h4> 
<pre><code class="prism language-bash">kubectl describe <span class="token function">node</span> k8s-m1 <span class="token comment">#查看节点的信息</span>
kubectl taint <span class="token function">node</span> k8s-m1 node-role.kubernetes.io/master-  <span class="token comment">#让k8s-m1可以运行pod，可以承担work的功能</span>
kubectl taint nodes k8s-m1 node-role.kubernetes.io/master<span class="token operator">=</span>:NoSchedule  <span class="token comment">#让k8s-m1可以不运行pod，仅承担主节点的功能</span>
</code></pre> 
<h4><a id="14apiserer_600"></a>14、apiserer的高可用验证</h4> 
<pre><code class="prism language-bash">ipvsadm <span class="token parameter variable">-Ln</span>  查看里面的规则
关掉一个节点，仍可用说明已经高可用
</code></pre> 
<h4><a id="15_605"></a>15、查看集群状态</h4> 
<pre><code class="prism language-bash">kubectl get endpoints kube-controller-manager <span class="token parameter variable">--namespace</span><span class="token operator">=</span>kube-system <span class="token parameter variable">-o</span> yaml   <span class="token comment">#可以看到目前kube-controller-manager在哪个节点上运行,其他两个处于阻塞状态</span>
kubectl get endpoints kube-scheduler <span class="token parameter variable">--namespace</span><span class="token operator">=</span>kube-system <span class="token parameter variable">-o</span> yaml   <span class="token comment">#可以看到目前kube-scheduler在哪个节点上运行，其他两个处于阻塞状态</span>
</code></pre> 
<h4><a id="16kubeadmKubernetes_etckubernetespki__610"></a>16、使用kubeadm创建完Kubernetes集群后, 默认会在/etc/kubernetes/pki目录下存放集群中需要用到的证书文件, 整体结构如下图所示:</h4> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /etc/kubernetes/
<span class="token punctuation">[</span>root@node2 kubernetes<span class="token punctuation">]</span><span class="token comment"># tree </span>
<span class="token builtin class-name">.</span>
├── admin.conf
├── controller-manager.conf
├── kubelet.conf
├── manifests
│   ├── etcd.yaml
│   ├── kube-apiserver.yaml
│   ├── kube-controller-manager.yaml
│   └── kube-scheduler.yaml
├── pki
│   ├── apiserver.crt
│   ├── apiserver-etcd-client.crt
│   ├── apiserver-etcd-client.key
│   ├── apiserver.key
│   ├── apiserver-kubelet-client.crt
│   ├── apiserver-kubelet-client.key
│   ├── ca.crt   <span class="token comment">#Kubernetes</span>
│   ├── ca.key  <span class="token comment">#Kubernetes </span>
│   ├── etcd
│   │   ├── ca.crt
│   │   ├── ca.key
│   │   ├── healthcheck-client.crt
│   │   ├── healthcheck-client.key
│   │   ├── peer.crt
│   │   ├── peer.key
│   │   ├── server.crt
│   │   └── server.key
│   ├── front-proxy-ca.crt
│   ├── front-proxy-ca.key
│   ├── front-proxy-client.crt
│   ├── front-proxy-client.key
│   ├── sa.key
│   └── sa.pub
└── scheduler.conf

证书分组
Kubernetes把证书放在了两个文件夹中
	/etc/kubernetes/pki
	/etc/kubernetes/pki/etcd

Kubernetes 集群根证书
Kubernetes 集群根证书CA<span class="token punctuation">(</span>Kubernetes集群组件的证书签发机构<span class="token punctuation">)</span>
	/etc/kubernetes/pki/ca.crt
	/etc/kubernetes/pki/ca.key
以上这组证书为签发其他Kubernetes组件证书使用的根证书, 可以认为是Kubernetes集群中证书签发机构之一

由此根证书签发的证书有:
kube-apiserver 组件持有的服务端证书
	/etc/kubernetes/pki/apiserver.crt
	/etc/kubernetes/pki/apiserver.key

kubelet 组件持有的客户端证书, 用作 kube-apiserver 主动向 kubelet 发起请求时的客户端认证
	/etc/kubernetes/pki/apiserver-kubelet-client.crt
	/etc/kubernetes/pki/apiserver-kubelet-client.key
</code></pre> 
<p>注意: Kubernetes集群组件之间的交互是双向的, kubelet 既需要主动访问 kube-apiserver, kube-apiserver 也需要主动向 kubelet 发起请求, 所以双方都需要有自己的根证书以及使用该根证书签发的服务端证书和客户端证书. 在 kube-apiserver 中, 一般明确指定用于 https 访问的服务端证书和带有CN 用户名信息的客户端证书. 而在 kubelet 的启动配置中, 一般只指定了 ca 根证书, 而没有明确指定用于 https 访问的服务端证书, 这是因为, 在生成服务端证书时, 一般会指定服务端地址或主机名, kube-apiserver 相对变化不是很频繁, 所以在创建集群之初就可以预先分配好用作 kube-apiserver 的 IP 或主机名/域名, 但是由于部署在 node 节点上的 kubelet 会因为集群规模的变化而频繁变化, 而无法预知 node 的所有 IP 信息, 所以 kubelet 上一般不会明确指定服务端证书, 而是只指定 ca 根证书, 让 kubelet 根据本地主机信息自动生成服务端证书并保存到配置的cert-dir文件夹中.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6296edba4d4d0e3c65451423ae9d2767/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式——建造者模式（创建型）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bef600f0ab36439a9cfedaf2cfa74c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">事务的四个特性、四个隔离级别以及数据库的常用锁</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>