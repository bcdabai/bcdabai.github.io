<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue-cli-service build 不同环境的配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue-cli-service build 不同环境的配置" />
<meta property="og:description" content="目录
🤜 背景
🤜 vue-cli-service介绍
🤜 环境变量和模式
🤜 配置不同模式
🤜index.html使用环境变量
🤜 验证
🤜 参考资料
🤜 背景 在项目部署时，我们需要在测试环境和生产环境使用不同的变量。vue-cli提供了vue-cli-service build打包命令，然而vue-cli-service build默认的环境变量值则为production。那我们通过npm run build打包构建，想要实现不同环境使用不同变量，暂时不能实现。
🤜 vue-cli-service介绍 官方介绍：vue-cli-service
vue-cli生成项目时，在package.json中会设置：
&#34;scripts&#34;: { &#34;serve&#34;: &#34;vue-cli-service serve&#34;, &#34;build&#34;: &#34;vue-cli-service build&#34; } vue-cli-service serve 命令会启动一个开发服务器，默认指定的环境模式为development。
vue-cli-service build 会在 dist/ 目录产生一个可用于生产环境的包，带有 JS/CSS/HTML 的压缩，和为更好的缓存而做的自动的vendor chunk splitting。
🤜 环境变量和模式 在项目的根目录下我们可以创建不同模式的文件：
.env # 在所有的环境中被载入 .env.local # 在所有的环境中被载入，但会被 git 忽略 .env.[mode] # 只在指定的模式中被载入 .env.[mode].local # 只在指定的模式中被载入，但会被 git 忽略 一般来说，我们会存在本地环境、测试环境、线上环境，那我们就需要创建三个模式文件。
.env.development开发环境模式 // 环境变量 NODE_ENV=development // 以 VUE_APP_ 开头的变量会被 webpack." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1c2a7e27506a29a0eec0251b3a67bf3f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-22T09:42:22+08:00" />
<meta property="article:modified_time" content="2023-09-22T09:42:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue-cli-service build 不同环境的配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%F0%9F%A4%9C%20%E8%83%8C%E6%99%AF-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20%E8%83%8C%E6%99%AF" rel="nofollow">🤜 背景</a></p> 
<p id="%F0%9F%A4%9C%20vue-cli-service%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20vue-cli-service%E4%BB%8B%E7%BB%8D" rel="nofollow">🤜 vue-cli-service介绍</a></p> 
<p id="%F0%9F%A4%9C%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E6%A8%A1%E5%BC%8F-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E6%A8%A1%E5%BC%8F" rel="nofollow">🤜 环境变量和模式</a></p> 
<p id="%F0%9F%A4%9C%20%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E6%A8%A1%E5%BC%8F-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E6%A8%A1%E5%BC%8F" rel="nofollow">🤜 配置不同模式</a></p> 
<p id="%F0%9F%A4%9Cindex.html%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9Cindex.html%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" rel="nofollow">🤜index.html使用环境变量</a></p> 
<p id="%F0%9F%A4%9C%20%E9%AA%8C%E8%AF%81-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20%E9%AA%8C%E8%AF%81" rel="nofollow">🤜 验证</a></p> 
<p id="%F0%9F%A4%9C%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:40px;"><a href="#%F0%9F%A4%9C%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">🤜 参考资料</a></p> 
<hr id="hr-toc"> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/73/lzdQu39Q_o.jpg"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0c/52/Xw8AqGMY_o.gif">  </p> 
<h3 id="%F0%9F%A4%9C%20%E8%83%8C%E6%99%AF">🤜 背景</h3> 
<p>在项目部署时，我们需要在测试环境和生产环境使用不同的变量。<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">vue-cli</span></code></span></strong>提供了<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vue-cli-service build</span></code></strong></span>打包命令，然而<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vue-cli-service build</span></code></strong></span>默认的环境变量值则为<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">production</span></code></strong></span>。那我们通过<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">npm run build</span></code></strong></span>打包构建，想要实现不同环境使用不同变量，暂时不能实现。</p> 
<h3 id="%F0%9F%A4%9C%20vue-cli-service%E4%BB%8B%E7%BB%8D">🤜 vue-cli-service介绍</h3> 
<p><a href="https://cli.vuejs.org/zh/guide/cli-service.html" rel="nofollow" title="官方介绍：vue-cli-service">官方介绍：vue-cli-service</a></p> 
<p>vue-cli生成项目时，在<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">package.json</span></code></strong></span>中会设置：</p> 
<pre><code class="language-javascript">  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build"
}
</code></pre> 
<p><span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vue-cli-service serve</span></code><span style="background-color:#fef2f0;"> </span></strong></span>命令会启动一个开发服务器，默认指定的环境模式为<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">development</span></code></span></strong>。</p> 
<p><span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vue-cli-service build</span></code></strong></span> 会在 dist/ 目录产生一个可用于生产环境的包，带有<span style="color:#fe2c24;"><strong><span style="background-color:#fef2f0;"> </span><code><span style="background-color:#fef2f0;">JS/CSS/HTML</span></code><span style="background-color:#fef2f0;"> </span></strong></span>的压缩，和为更好的缓存而做的自动的<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vendor chunk splitting</span></code></strong></span>。</p> 
<h3 id="%F0%9F%A4%9C%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E6%A8%A1%E5%BC%8F">🤜 环境变量和模式</h3> 
<p>在项目的根目录下我们可以创建不同模式的文件：</p> 
<pre><code>.env                # 在所有的环境中被载入
.env.local          # 在所有的环境中被载入，但会被 git 忽略
.env.[mode]         # 只在指定的模式中被载入
.env.[mode].local   # 只在指定的模式中被载入，但会被 git 忽略
</code></pre> 
<p>一般来说，我们会存在<strong><span style="color:#fe2c24;"><code>本地环境</code></span></strong>、<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">测试环境</span></code></span></strong>、<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">线上环境</span></code></span></strong>，那我们就需要创建三个模式文件。</p> 
<ul><li><strong><span style="color:#fe2c24;"><code>.env.development</code></span></strong>开发环境模式</li></ul> 
<pre><code class="language-javascript">// 环境变量
NODE_ENV=development
// 以 VUE_APP_ 开头的变量会被 webpack.DefinePlugin 静态嵌入到客户端侧的包中
VUE_APP_ENV = 'development'
</code></pre> 
<ul><li><span style="color:#fe2c24;"><strong><code>.env.test</code></strong></span>测试环境模式</li></ul> 
<pre><code class="language-javascript">// 环境变量（这里的环境变量是跟打包有关的，production则会进行压缩代码等，真正跟每个环境有关的变量是下面以VUE_APP开头的变量）
NODE_ENV=production
// 以 VUE_APP_ 开头的变量会被 webpack.DefinePlugin 静态嵌入到客户端侧的包中
VUE_APP_ENV = 'test'
</code></pre> 
<ul><li><strong><span style="color:#fe2c24;"><code>.env.production</code></span></strong>线上环境模式</li></ul> 
<pre><code>// 环境变量
NODE_ENV=production
// 以 VUE_APP_ 开头的变量会被 webpack.DefinePlugin 静态嵌入到客户端侧的包中
VUE_APP_ENV = 'production'
</code></pre> 
<h3 id="%F0%9F%A4%9C%20%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E6%A8%A1%E5%BC%8F">🤜 配置不同模式</h3> 
<p>部署时，构建打包执行<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">npm run build</span></code></strong></span>，则会执行<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">vue-cli-service build</span></code></strong></span>，默认模式为<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">production</span></code></strong></span>，对应<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">.env.production</span></code></span></strong>文件，取此文件中的环境变量。</p> 
<p>想要配置测试环境，需要在scripts下增加脚本：</p> 
<pre><code class="language-javascript">"scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "build-test": "vue-cli-service build --mode test"
}
</code></pre> 
<p>测试环境打包构建时，执行<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">npm run build-test</span></code></strong></span>即可。</p> 
<h3 id="%F0%9F%A4%9Cindex.html%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">🤜index.html使用环境变量</h3> 
<p>在<span style="color:#fe2c24;"><strong><code><span style="background-color:#fef2f0;">index.html</span></code></strong></span>中可通过<strong><span style="color:#fe2c24;"><code><span style="background-color:#fef2f0;">&lt;%= process.env.VUE_APP_xxx %&gt;</span></code></span></strong>的方式获取不同模式下配置的环境变量。</p> 
<h3 id="%F0%9F%A4%9C%20%E9%AA%8C%E8%AF%81">🤜 验证</h3> 
<p>可通过不同模式下对应的环境变量，判断是否为对应的环境</p> 
<h3 id="%F0%9F%A4%9C%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">🤜 参考资料</h3> 
<p><a href="https://blog.51cto.com/u_3172968/5420080" rel="nofollow" title="Vue - 详解.env文件">Vue - 详解.env文件</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/e7/9CJ8pLy3_o.gif"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd4e66efefe2893be022753a71bb0089/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vuex —— 状态管理 | Module</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b3bd9a28da93e86f87afe7e47eeaecd4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为什么在token在http请求头中的Authorization要加Bearer前缀？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>