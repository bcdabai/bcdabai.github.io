<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>asp.net  Socket 实例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="asp.net  Socket 实例" />
<meta property="og:description" content="public class Socketclient{TextBox txt;TextBox send_txt;public Socketclient(TextBox txt, TextBox send_txt){this.txt = txt;this.send_txt = send_txt;}public void StartClient(){// Data buffer for incoming data.byte[] bytes = new byte[1024];// Connect to a remote device.try{// Establish the remote endpoint for the socket.// This example uses port 11000 on the local computer.IPHostEntry ipHostInfo = Dns.Resolve(Dns.GetHostName());IPAddress ipAddress = ipHostInfo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/da3bc26f8f139c815550a8eb2642732c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-03-13T14:19:13+08:00" />
<meta property="article:modified_time" content="2014-03-13T14:19:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">asp.net  Socket 实例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-csharp"> </code></pre> 
<pre><code class="language-csharp">public class Socketclient
    {
        TextBox txt;
        TextBox send_txt;
        public Socketclient(TextBox txt, TextBox send_txt)
        {
            this.txt = txt;
            this.send_txt = send_txt;
        }
        public void StartClient()
        {
            // Data buffer for incoming data.
            byte[] bytes = new byte[1024];

            // Connect to a remote device.
            try
            {
                // Establish the remote endpoint for the socket.
                // This example uses port 11000 on the local computer.
                IPHostEntry ipHostInfo = Dns.Resolve(Dns.GetHostName());
                IPAddress ipAddress = ipHostInfo.AddressList[0];
                IPEndPoint remoteEP = new IPEndPoint(ipAddress, 1234);
                // Create a TCP/IP  socket.
                Socket sender = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);

                // Connect the socket to the remote endpoint. Catch any errors.
                try
                {
                    sender.Connect(remoteEP);
                    // Console.WriteLine("Socket connected to {0}",sender.RemoteEndPoint.ToString());
                    txt.Text += "\r\n" + sender.RemoteEndPoint.ToString() + "\r\n";
                    // Encode the data string into a byte array.
                    byte[] msg = Encoding.ASCII.GetBytes(send_txt.Text + "&lt;EOF&gt;");
                    // Send the data through the socket.
                    int bytesSent = sender.Send(msg);
                    // Receive the response from the remote device.
                    int bytesRec = sender.Receive(bytes);
                    //Console.WriteLine("Echoed test = {0}",Encoding.ASCII.GetString(bytes,0,bytesRec));
                    txt.Text += "\r\n" + Encoding.ASCII.GetString(bytes, 0, bytesRec) + "\r\n";//接收远程服务器信息

                    // Release the socket.
                    sender.Shutdown(SocketShutdown.Both);
                    sender.Close();
                }
                catch (ArgumentNullException ane)
                {
                    // Console.WriteLine("ArgumentNullException : {0}",ane.ToString());
                    txt.Text += "\r\n" + ane.ToString() + "\r\n";
                }
                catch (SocketException se)
                {
                    // Console.WriteLine("SocketException : {0}",se.ToString());
                    txt.Text += "\r\n" + se.ToString() + "\r\n";
                }
                catch (Exception e)
                {
                    // Console.WriteLine("Unexpected exception : {0}", e.ToString());
                    txt.Text += "\r\n" + e.ToString() + "\r\n";
                }
            }
            catch (Exception e)
            {
                // Console.WriteLine( e.ToString());
                txt.Text += "\r\n" + e.ToString() + "\r\n";
            }
        }
    }
 public class SocketServer {
    
     int port;  //端口
     string host;//ip地址
     TextBox txt;
     /// &lt;summary&gt;
     /// 构造涵数
     /// &lt;/summary&gt;
     /// &lt;param name="ports"&gt;端口号&lt;/param&gt;
     public SocketServer(int ports, string host,TextBox txt)
     {
       this.port=ports;
       this.host = host;
       this.txt = txt;
     }    
     //开始监听
    public void beginListen(){        
        try
        {
            IPAddress ip = IPAddress.Parse(host);//把ip地址字符串转换为IPAddress类型的实例
            IPEndPoint ipe = new IPEndPoint(ip, port);//用指定的端口和ip初始化IPEndPoint类的新实例
            ///创建socket并开始监听
            Socket s = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);//创建一个socket对像，如果用udp协议，则要用SocketType.Dgram类型的套接字
            s.Bind(ipe);//绑定EndPoint对像（端口和ip地址）
            s.Listen(0);//开始监听
            txt.Text += "等待客户端连接";
           // Console.WriteLine("等待客户端连接");
            //定义循环，以便可以简历多次连接
            while (true)
            {
                Socket temp = s.Accept();//为新建连接创建新的socket               
                while (true)
                {
                    string recvStr = "";
                    byte[] recvBytes = new byte[1024];
                    int bytes;
                    bytes = temp.Receive(recvBytes, recvBytes.Length, 0);//从客户端接受信息
                    recvStr += Encoding.ASCII.GetString(recvBytes, 0, bytes);
                    txt.Text += "\r\n" + recvStr + "\r\n";
                    if (recvStr.IndexOf("&lt;EOF&gt;") &gt; -1)
                    {
                        break;
                    }
                }                
                //给client端返回信息
               // Console.WriteLine("server get message:{0}", recvStr);//把客户端传来的信息显示出来
               
                string sendStr = "jpeg upload OK";
                byte[] bs = Encoding.ASCII.GetBytes(sendStr);
                temp.Send(bs, bs.Length, 0);//返回信息给客户端
                temp.Shutdown(SocketShutdown.Both);
                temp.Close();            

            }
        }
        catch (Exception ex)
        {
            string str = ex.ToString();
            txt.Text += "\r\n" + str + "\r\n";
        }
    }
}}</code></pre> 
<p> </p> 
<p>客户端按钮事件</p> 
<pre><code class="language-csharp">   protected void Button1_Click(object sender, EventArgs e)
        {
                Socketclient client = new Socketclient(TextBox2, TextBox3);
                client.StartClient();
           
        }</code></pre> 
<p><br> //服务端监听执行线程 </p> 
<pre><code class="language-csharp">protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                SocketServer socket = new SocketServer(1234, "192.168.88.196", TextBox1);
                //启动线程
                Thread thread = new Thread(new ThreadStart(socket.beginListen));
                thread.Start();
                // 在应用程序启动时运行的代码
                //(new System.Threading.Thread(new System.Threading.ThreadStart(new Class1().CreatSocket))).Start();//开辟一个新线程
            }
        }</code></pre> 
<p><br> aspx</p> 
<pre><code class="language-html">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="JpegForSocketServer.aspx.cs" Inherits="WebForAndroid.JpegForSocketServer" %&gt;

&lt;!DOCTYPE html&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
    &lt;div&gt;
        &lt;asp:TextBox ID="TextBox1" runat="server" Height="206px" TextMode="MultiLine" Width="700px" &gt;&lt;/asp:TextBox&gt;
    &lt;/div&gt;
        &lt;hr /&gt;
        &lt;asp:TextBox ID="TextBox2" runat="server" Height="197px" TextMode="MultiLine" Width="376px"&gt;&lt;/asp:TextBox&gt;
        &lt;asp:TextBox ID="TextBox3" runat="server" Height="119px" TextMode="MultiLine"&gt;&lt;/asp:TextBox&gt;
        &lt;asp:Button ID="Button1" runat="server" Height="52px" OnClick="Button1_Click" Text="SEND" Width="138px" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p><br> 图：<img src="https://images2.imgbox.com/ae/d2/p5tfDpfx_o.jpg" alt=""><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b5fcedf517e4dc42d65481794c4d56d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UIView,UIButton,UIImageView等设置圆角，设置阴影，设置边框的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/87cd1b9079171dcbd289e84a48b69be1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[C#] Byte[]、Image、Bitmap 之间的相互转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>