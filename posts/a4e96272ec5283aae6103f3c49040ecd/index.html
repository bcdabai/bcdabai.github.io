<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis哨兵模式 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis哨兵模式" />
<meta property="og:description" content="Redis哨兵模式 一、服务器准备二、安装redis1.Master服务器2.SlaveFirst服务器3.SlaveSecond服务器 三、依次开启Redis服务器四、开启哨兵1.修改Master哨兵配置文件2.修改SlaveFirst哨兵配置文件3.修改SlaveSecond哨兵配置文件4.开启哨兵5.验证是否开启成功6.主从配置如下五、挂掉Master的Redis服务器，看服务器变化 六、哨兵配置文件自动更改七、再次开启原先Master 一、服务器准备 Kali安装无法定位软件包问题
Kali防火墙开关
Kali开启ssh端口
安装VM虚拟机，准备三台服务器，这里kali我是之前装的，随便什么linux服务器都行
二、安装redis 没有下载权限看这篇
Redis安装参考这篇
CentOs7：systemctl stop firewalld.service（关闭）firewall-cmd --state（查看状态） 三台服务器需要开放对应的端口，或者简单点直接关闭防火墙
kaili：关闭见上文文章链接
1.Master服务器 首先安装主服务器，这里安装Redis，之后修改redis.conf配置文件，来开启服务
1.bind 192.168.1.7 //绑定监听ip 2.daemonize yes //开启后台运行 3.protected-mode no //关闭守护模式，允许外部访问 4.port 6379 //开启监听端口 2.SlaveFirst服务器 安装第一台从Redis服务器，修改Redis.conf的配置
slaveof 192.168.1.5 6379 //从服务器需要这里在redis.conf中加上这句话
1.bind 192.168.1.5 //绑定监听ip 2.daemonize yes //开启后台运行 3.protected-mode no //关闭守护模式，允许外部访问 4.port 6379 //开启监听端口 5.slaveof 192.168.1.7 6379 //配置从服务器的主服务器 3.SlaveSecond服务器 安装第一台从Redis服务器，修改Redis.conf的配置
slaveof 192.168.1.5 6379 //从服务器需要这里在redis.conf中加上这句话
1.bind 192.168.1.6 //绑定监听ip 2.daemonize yes //开启后台运行 3.protected-mode no //关闭守护模式，允许外部访问 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a4e96272ec5283aae6103f3c49040ecd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-28T22:46:54+08:00" />
<meta property="article:modified_time" content="2023-07-28T22:46:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis哨兵模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Redis哨兵模式</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、服务器准备</a></li><li><a href="#redis_9" rel="nofollow">二、安装redis</a></li><li><ul><li><a href="#1Master_14" rel="nofollow">1.Master服务器</a></li><li><a href="#2SlaveFirst_23" rel="nofollow">2.SlaveFirst服务器</a></li><li><a href="#3SlaveSecond_34" rel="nofollow">3.SlaveSecond服务器</a></li></ul> 
  </li><li><a href="#Redis_45" rel="nofollow">三、依次开启Redis服务器</a></li><li><a href="#_61" rel="nofollow">四、开启哨兵</a></li><li><ul><li><a href="#1Master_62" rel="nofollow">1.修改Master哨兵配置文件</a></li><li><a href="#2SlaveFirst_78" rel="nofollow">2.修改SlaveFirst哨兵配置文件</a></li><li><a href="#3SlaveSecond_86" rel="nofollow">3.修改SlaveSecond哨兵配置文件</a></li><li><a href="#4_94" rel="nofollow">4.开启哨兵</a></li><li><a href="#5_100" rel="nofollow">5.验证是否开启成功</a></li><li><a href="#6_109" rel="nofollow">6.主从配置如下</a></li><li><a href="#MasterRedis_130" rel="nofollow">五、挂掉Master的Redis服务器，看服务器变化</a></li></ul> 
  </li><li><a href="#_144" rel="nofollow">六、哨兵配置文件自动更改</a></li><li><ul><li><a href="#Master_151" rel="nofollow">七、再次开启原先Master</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、服务器准备</h2> 
<p><a href="https://blog.csdn.net/Fitz_GuangChen/article/details/108584419">Kali安装无法定位软件包问题</a><br> <a href="https://www.cnblogs.com/linshengqian/p/15371728.html" rel="nofollow">Kali防火墙开关</a><br> <a href="https://blog.csdn.net/qq_33764650/article/details/125662220#:~:text=Kali%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4%E6%9C%AA%E5%BC%80%E6%94%BEssh%E7%AB%AF%E5%8F%A322%EF%BC%8C%E6%9C%89%E6%97%B6%E5%80%99%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%BF%9C%E7%A8%8Bssh%E8%BF%9E%E6%8E%A5%EF%BC%8C%E8%BF%99%E5%B0%B1%E9%9C%80%E8%A6%81%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A322%E3%80%82%20%E6%9C%AC%E6%96%87%E4%BB%A5kali2022%E7%89%88%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%9D%A5%E8%AE%B2%E8%A7%A3%E4%B8%8B%E5%A6%82%E4%BD%95%E5%BC%80%E6%94%BEssh%E7%AB%AF%E5%8F%A322%20%E7%AB%AF%E5%8F%A3%E5%BC%80%E5%90%AF%E6%AD%A5%E9%AA%A4%EF%BC%88ssh%E6%9C%8D%E5%8A%A1%EF%BC%89%201.%E5%9C%A8%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3%E5%89%8D%EF%BC%8C%E5%85%88%E7%94%A8%E6%8C%87%E4%BB%A4%22netstat%20%E2%80%93lnt%22%E7%A1%AE%E8%AE%A4%E4%B8%8B%E7%B3%BB%E7%BB%9F%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81%EF%BC%88%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%AB%AF%E5%8F%A322%E5%B9%B6%E6%9C%AA%E5%BC%80%E5%90%AF%EF%BC%89%20%E2%94%8C%E2%94%80%E2%94%80,%28root%E3%89%BFkali%29-%20etc/ssh%5D%20%E2%94%94%E2%94%80#%20netstat%20%E2%80%93lnt%202.%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B9%B6%E4%BF%9D%E5%AD%98%EF%BC%88%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E4%BF%AE%E6%94%B9%E9%94%99%E8%AF%AF%EF%BC%8C%E4%BF%AE%E6%94%B9%E4%B9%8B%E5%89%8D%E7%94%A8cp%E5%85%88%E6%8A%8Asshd_config%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E4%B8%80%E4%BB%BD%EF%BC%89">Kali开启ssh端口</a></p> 
<blockquote> 
 <p>安装VM虚拟机，准备三台服务器，这里kali我是之前装的，随便什么linux服务器都行</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7b/6d/2mC8HMBk_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="redis_9"></a>二、安装redis</h2> 
<p><a href="https://blog.csdn.net/daveluke/article/details/106653670">没有下载权限看这篇</a><br> <a href="https://editor.csdn.net/md/?articleId=131907424" rel="nofollow">Redis安装参考这篇</a></p> 
<blockquote> 
 <p>CentOs7：systemctl stop firewalld.service（关闭）firewall-cmd --state（查看状态） <mark>三台服务器需要开放对应的端口，或者简单点直接关闭防火墙</mark><br> kaili：关闭见上文文章链接</p> 
</blockquote> 
<h3><a id="1Master_14"></a>1.Master服务器</h3> 
<blockquote> 
 <p>首先安装主服务器，这里安装Redis，之后修改redis.conf配置文件，来开启服务</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">1</span>.bind <span class="token number">192.168</span>.1.7 //绑定监听ip
<span class="token number">2</span>.daemonize <span class="token function">yes</span> //开启后台运行
<span class="token number">3</span>.protected-mode no //关闭守护模式，允许外部访问
<span class="token number">4</span>.port <span class="token number">6379</span> //开启监听端口
</code></pre> 
<h3><a id="2SlaveFirst_23"></a>2.SlaveFirst服务器</h3> 
<blockquote> 
 <p>安装第一台从Redis服务器，修改Redis.conf的配置<br> slaveof 192.168.1.5 6379 //<mark>从服务器需要这里在redis.conf中加上这句话</mark></p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">1</span>.bind <span class="token number">192.168</span>.1.5 //绑定监听ip
<span class="token number">2</span>.daemonize <span class="token function">yes</span> //开启后台运行
<span class="token number">3</span>.protected-mode no //关闭守护模式，允许外部访问
<span class="token number">4</span>.port <span class="token number">6379</span> //开启监听端口
<span class="token number">5</span>.slaveof <span class="token number">192.168</span>.1.7 <span class="token number">6379</span> //配置从服务器的主服务器
</code></pre> 
<h3><a id="3SlaveSecond_34"></a>3.SlaveSecond服务器</h3> 
<blockquote> 
 <p>安装第一台从Redis服务器，修改Redis.conf的配置<br> slaveof 192.168.1.5 6379 //<mark>从服务器需要这里在redis.conf中加上这句话</mark></p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">1</span>.bind <span class="token number">192.168</span>.1.6 //绑定监听ip
<span class="token number">2</span>.daemonize <span class="token function">yes</span> //开启后台运行
<span class="token number">3</span>.protected-mode no //关闭守护模式，允许外部访问
<span class="token number">4</span>.port <span class="token number">6379</span> //开启监听端口
<span class="token number">5</span>.slaveof <span class="token number">192.168</span>.1.7 <span class="token number">6379</span> //配置从服务器的主服务器
</code></pre> 
<h2><a id="Redis_45"></a>三、依次开启Redis服务器</h2> 
<blockquote> 
 <p>顺序：1、开启Master -》2、开启SlaveFirst-》3、开启SlaveSecond</p> 
</blockquote> 
<pre><code class="prism language-bash">
<span class="token builtin class-name">cd</span> /opt/redis-7.0.5/   *进入redis的解压目录中

./src/redis-server ./redis.conf  *开启Redis服务

./src/redis-cli <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.1.7 <span class="token parameter variable">-p</span> <span class="token number">6379</span>   //打开redis的客户端，验证redis是否启动成功
				 （Redis本机服务器地址）（端口）  	

</code></pre> 
<blockquote> 
 <p>进入master，在cli中输入info信息查看如下，主从布置完毕，主服务器已经挂载两台从服务器</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b1/92/PUe6bD11_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_61"></a>四、开启哨兵</h2> 
<h3><a id="1Master_62"></a>1.修改Master哨兵配置文件</h3> 
<blockquote> 
 <p>这三台Redis，Master和Slave的哨兵配置文件都一致</p> 
</blockquote> 
<blockquote> 
 <p>编辑哨兵配置文件</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token function">vim</span> sentinel.conf
</code></pre> 
<blockquote> 
 <p>配置文件修改添加内容</p> 
</blockquote> 
<pre><code class="prism language-bash">daemonize <span class="token function">yes</span>

sentinel monitor mymaster <span class="token number">192.168</span>.1.7  <span class="token number">6379</span> <span class="token number">2</span>
                       <span class="token punctuation">(</span>Master服务器ip<span class="token punctuation">)</span> （端口） （投票数）
</code></pre> 
<h3><a id="2SlaveFirst_78"></a>2.修改SlaveFirst哨兵配置文件</h3> 
<pre><code class="prism language-bash">daemonize <span class="token function">yes</span>

sentinel monitor mymaster <span class="token number">192.168</span>.1.7  <span class="token number">6379</span> <span class="token number">2</span>
                       <span class="token punctuation">(</span>Master服务器ip<span class="token punctuation">)</span> （端口） （投票数）
</code></pre> 
<h3><a id="3SlaveSecond_86"></a>3.修改SlaveSecond哨兵配置文件</h3> 
<pre><code class="prism language-bash">daemonize <span class="token function">yes</span>

sentinel monitor mymaster <span class="token number">192.168</span>.1.7  <span class="token number">6379</span> <span class="token number">2</span>
                       <span class="token punctuation">(</span>Master服务器ip<span class="token punctuation">)</span> （端口） （投票数）
</code></pre> 
<h3><a id="4_94"></a>4.开启哨兵</h3> 
<blockquote> 
 <p><mark>注意，先开启上面三台主从Reids，然后再配置三台哨兵，并按master先开，再开slave顺序。</mark></p> 
</blockquote> 
<pre><code class="prism language-bash">./src/redis-sentinel ./sentinel.conf
</code></pre> 
<h3><a id="5_100"></a>5.验证是否开启成功</h3> 
<blockquote> 
 <p>Master设置key value</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6a/63/1OgjUD1V_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>两台从服务器查询内容，主从复制成功</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c7/33/q5Fqyvhv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d4/01/GX5QBL6J_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_109"></a>6.主从配置如下</h3> 
<blockquote> 
 <p>master配置如下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/41/50/9v9Avk49_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>salveFirst信息如下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7f/9d/z3NOE73f_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>salveSecond信息如下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c9/ca/wCI08i7m_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>现在三台机器的配置<br> 192.168.1.7 Master<br> 192.168.1.6 Slave<br> 192.168.1.5 Slvae</p> 
</blockquote> 
<h3><a id="MasterRedis_130"></a>五、挂掉Master的Redis服务器，看服务器变化</h3> 
<blockquote> 
 <p><mark>这里切换过程可能比较长点，可能要几分钟</mark><br> kill掉Master，然后查看另外两台服务器信息，发现自动推举一台从服务器为Master了</p> 
</blockquote> 
<blockquote> 
 <p>查看192.168.1.7 Master，发现无法访问，</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ac/68/7Lx53gUb_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>查看推举上来的Master，192.168.1.6 Slave 现在变为Mater</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b3/e8/CPmkJMBd_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>发现192.168.1.5 Slvae ，这台服务器的已经切换Master了。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f4/36/kfMPo4O6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_144"></a>六、哨兵配置文件自动更改</h2> 
<blockquote> 
 <p>哨兵模式下的Sentinel.conf哨兵文件，会随着Mater的宕机，自动更改文件配置，重新推举一台新的Master服务器。这里是有原Master 192.168.1.7切换为192.168.1.6了</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/39/e8/n0lvb3Ot_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>Master的redis.conf文件也会自动更改<br> <img src="https://images2.imgbox.com/72/5e/DehWmCwk_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h3><a id="Master_151"></a>七、再次开启原先Master</h3> 
<blockquote> 
 <p>发现即使重新开启了，仍无法变为master，只能甘当小弟了。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f1/c5/kMZZhKS4_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>攻守移位，现在原先的从服务器192.168.1.6变成了Master，并随着192.168.1.7原先Master的重启，192.168.1.6现在有了两个小弟</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/88/2e/ixBEixtO_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/054a59025fbefc446f347b6b2cfaef2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">开发板 在虚拟机中 通过 wifi 联网</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22d485bd4ed7d69ed465c6937b7650db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">py基础工具-路径：浅层路径 获取or分拣</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>