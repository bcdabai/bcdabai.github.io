<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime" />
<meta property="og:description" content="在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime
在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime
作者：WPFDevelopersOrg - ArcherSong
项目运行环境：
.Net Framework 4.5.2
Windows 7 x64 Service Pack 1
WebView2 Microsoft.WebView2.FixedVersionRuntime.120.0.2210.91.x64
考虑到很多老项目，本项目使用的是.Net Framework 4.5.2，.Net 更高版本的其实也是可以支持的。
1、下载 WebView2 固定版本 Runtime 首先下载自己想要的固定版本的 WebView2 Runtime[1]
下载下来的文件为 Cab 格式的文件，此文件为压缩文件
将其解压，可得到如下的目录
\MICROSOFT.WEBVIEW2.FIXEDVERSIONRUNTIME.120.0.2210.91.X64 ├─EBWebView │ ├─x64 │ └─x86 ├─edge_feedback ├─Extensions ├─Locales ├─MEIPreload ├─Notifications ├─PdfPreview ├─Trust Protection Lists │ ├─Mu │ └─Sigma └─WidevineCdm └─_platform_specific └─win_x64 2、创建项目，将Webview2 复制到项目中 创建.Net Framework 4.5.2 WPF 项目，将解压的Webview2 复制到项目中，如下图所示：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cc3d9d7ea7c8257cbd7c8da8bced75dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T08:20:48+08:00" />
<meta property="article:modified_time" content="2023-12-31T08:20:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p>  <strong>在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime</strong></p> 
 <blockquote> 
  <p>在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime</p> 
  <p>作者：WPFDevelopersOrg - <strong>ArcherSong</strong></p> 
 </blockquote> 
 <p>项目运行环境：</p> 
 <ul><li><p>.Net Framework 4.5.2</p></li><li><p>Windows 7 x64 Service Pack 1</p></li><li><p>WebView2 Microsoft.WebView2.FixedVersionRuntime.120.0.2210.91.x64</p></li></ul> 
 <p>考虑到很多老项目，本项目使用的是<code>.Net Framework 4.5.2</code>，<code>.Net</code> 更高版本的其实也是可以支持的。</p> 
 <h4>1、下载 WebView2 固定版本 Runtime</h4> 
 <p>首先下载自己想要的固定版本的 WebView2 Runtime<sup>[1]</sup></p> 
 <img src="https://images2.imgbox.com/fd/1f/JPLhMNXF_o.png" alt="1ba1e880b90f4242c9e881d996e23b3f.png"> 
 <p>下载下来的文件为 <code>Cab</code> 格式的文件，此文件为压缩文件</p> 
 <img src="https://images2.imgbox.com/0b/88/WDVuaaBM_o.png" alt="cf156c48434e79a566c9e5d5f1e2b194.png"> 
 <p>将其解压，可得到如下的目录</p> 
 <pre class="has"><code class="language-go">\MICROSOFT.WEBVIEW2.FIXEDVERSIONRUNTIME.120.0.2210.91.X64
├─EBWebView
│  ├─x64
│  └─x86
├─edge_feedback
├─Extensions
├─Locales
├─MEIPreload
├─Notifications
├─PdfPreview
├─Trust Protection Lists
│  ├─Mu
│  └─Sigma
└─WidevineCdm
    └─_platform_specific
        └─win_x64</code></pre> 
 <h4>2、创建项目，将<code>Webview2</code> 复制到项目中</h4> 
 <p>创建<code>.Net Framework 4.5.2 WPF</code> 项目，将解压的<code>Webview2</code> 复制到项目中，如下图所示：</p> 
 <img src="https://images2.imgbox.com/17/eb/4XTIfvYe_o.png" alt="e4433cc8c8e11f49517a01690eabf608.png"> 
 <img src="https://images2.imgbox.com/35/87/fTI7zjTo_o.png" alt="03ef03270e399dd17d83fda7eec237a2.png"> 
 <p>‍</p> 
 <p>文件夹 <code> WebView2</code> 中就是<code>cap</code>文件解压后的二进制文件以及文件夹</p> 
 <p>将 <code> WebView2</code> 文件夹中所有文件</p> 
 <p><code>属性</code> - <code>高级</code> - <code>复制到输入目录</code> 设置为 <code>如果较新则复制</code></p> 
 <p><code>属性</code> - <code>高级</code> - <code>生成操作</code> 设置为 <code>无</code></p> 
 <p>如下图所示：</p> 
 <img src="https://images2.imgbox.com/10/08/9WI6Xpcg_o.png" alt="37a9c569ff4b0c493b3792464387a5c8.png"> 
 <p>‍</p> 
 <h4>3、在项目的 MainWindow 后台代码中写逻辑</h4> 
 <p>在<code>MainWindow.cs</code> 文件中添加代码</p> 
 <pre class="has"><code class="language-go">Public partial class MainWindow : Window
    {
      public string Url { get; set; } = "https://www.bing.com";
      public MainWindow()
      {
          InitializeComponent();
      }

      protected override async void OnContentRendered(EventArgs e)
      {
          base.OnContentRendered(e);

          await webView.EnsureCoreWebView2Async(
              await CoreWebView2Environment.CreateAsync(Path.Combine(AppDomain.CurrentDomain.BaseDirectory;, "WebView2")));
          webView.Source = new Uri(Url);
      }
   }</code></pre> 
 <p>添加后，即可在无 <code>WebView2 Runtime</code> 的系统中运行</p> 
 <p>‍</p> 
 <h4>4、一些问题</h4> 
 <p>项目运行时，有些问题可能会出现，</p> 
 <ul><li><p>报错 <code>Microsoft.Web.WebView2.Core.WebView2RuntimeNotFoundException:“Couldn't find a compatible Webview2 Runtime installation to host WebViews.”</code> 这个可能是因为wenview2的文件没有设置为 <code>较新则复制</code> 导致的</p></li><li><p>报错 <code>System.ArgumentException:“WebView2 was already initialized with a different CoreWebView2Environment. Check to see if the Source property was already set or EnsureCoreWebView2Async was previously called with different values.</code> 这个可能是因为在执行 <code>OnContentRendered</code> 方法前，，对CoreWebview2设置了<code>source</code>属性，此时<code>webview2</code>会自动初始化环境，后面不能重复初始化<br>去掉<code>source</code>属性（设置属性或者在构造时去掉都可以）</p><p>上面代码可以看到，<code>Source</code> 属性是在 最后才指定的</p><pre class="has"><code class="language-go">protected override async void OnContentRendered(EventArgs e)
  {
      base.OnContentRendered(e);

      await webView.EnsureCoreWebView2Async(
          await CoreWebView2Environment.CreateAsync(Path.Combine(AppDomain.CurrentDomain.BaseDirectory;, "WebView2")));
      webView.Source = new Uri(Url);//最后才指定的Source
  }</code></pre></li></ul> 
 <p>‍</p> 
 <h4>5、运行</h4> 
 <p>将生成的 <code>Debug</code> 直接拷贝到不存在 <code>Webview2</code> 的系统中，是可以运行的，如果报错，请参考第四点进行检查项目</p> 
 <img src="https://images2.imgbox.com/3d/90/Xj8G4hGw_o.png" alt="415b36ec51f992eae23d4c2aff51eac0.png"> 
 <p>‍</p> 
 <h4>参考资料</h4> 
 <p>[1]</p> 
 <p>WebView2 Runtime: https://developer.microsoft.com/zh-CN/microsoft-edge/webview2/#download</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7e771bed8bf18746515a1e65453d810/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年总结：坚持一些看似无用的东西</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/db4ca56b9a534459fd81422c82cd372f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">初识SpringBoot（2023最后一篇文章）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>