<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IP 定位框架 GeoIP2 for Java - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IP 定位框架 GeoIP2 for Java" />
<meta property="og:description" content="IP 定位框架 GeoIP2 for Java 一、GeoIP2 简介二、GeoIP2 使用1、下载离线库2、添加 Maven 依赖3、封装 IP 定位工具类 三、GeoIP2 总结 一、GeoIP2 简介 GeoIP 官网：https://www.maxmind.com/en/geoip2-services-and-databases
MaxMind 是位于马萨诸塞州的数字地图公司，提供全世界的 IP 地址的位置数据。MaxMind 的定位服务在全球范围内享有盛誉，是应用最广泛的定位服务。其提供 Geoip 和 Geoip2 两个版本的 IP 地址定位服务，并提供开放源代码数据 GeoLite2，GeoLite2 数据库是 GeoIP2 的免费版，其准确率稍低于付费版。
GeoLite2 数据库由几部分组成：GeoLite2 国家库、GeoLite2 城市库和 Geolite2 ASN。他们分别满足不同的功能，GeoLite2 国家库仅能查询 IP 地址所在的国家和洲；GeoLite2 城市库可以查询到 IP 地址所在的国家、地区、城市、经纬度和邮政编码等信息；Geolite2 ASN 用于查询IP地址所属的自治域 AS 或者运营商 ISP。
GeoLite2 离线数据库每月更新一次，可以通过官方网站下载 MaxMind DB 格式的压缩文件。MaxMind 提供支持 7 种编程语言或软件的 API 支持，包括 C#、C、Java、Perl、PHP、Python、Apache（mod_maxminddb）。还有许多第三方 API 支持更多种编程语言或软件。GeoLite2 支持包括英语、汉语、俄语、日语和西班牙语等在内的多种语言。
二、GeoIP2 使用 1、下载离线库 官方下载地址：https://dev.maxmind.com/geoip/geoip2/downloadable/
百度网盘：https://pan.baidu.com/s/1BMirxMxrGN6G6qZwH597Cg 提取码: vxsb" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e4b6278f4416509cf1c34744d892973b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-19T20:40:29+08:00" />
<meta property="article:modified_time" content="2020-08-19T20:40:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IP 定位框架 GeoIP2 for Java</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>IP 定位框架 GeoIP2 for Java</h4> 
 <ul><li><a href="#GeoIP2__2" rel="nofollow">一、GeoIP2 简介</a></li><li><a href="#GeoIP2__13" rel="nofollow">二、GeoIP2 使用</a></li><li><ul><li><a href="#1_15" rel="nofollow">1、下载离线库</a></li><li><a href="#2_Maven__25" rel="nofollow">2、添加 Maven 依赖</a></li><li><a href="#3_IP__53" rel="nofollow">3、封装 IP 定位工具类</a></li></ul> 
  </li><li><a href="#GeoIP2__262" rel="nofollow">三、GeoIP2 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="GeoIP2__2"></a>一、GeoIP2 简介</h2> 
<p> <br> GeoIP 官网：<a href="https://www.maxmind.com/en/geoip2-services-and-databases" rel="nofollow">https://www.maxmind.com/en/geoip2-services-and-databases</a></p> 
<p><img src="https://images2.imgbox.com/13/dd/8xFtFlyB_o.png" alt="GeoIP2"><br> MaxMind 是位于马萨诸塞州的数字地图公司，提供全世界的 IP 地址的位置数据。MaxMind 的定位服务在全球范围内享有盛誉，是应用最广泛的定位服务。其提供 Geoip 和 Geoip2 两个版本的 IP 地址定位服务，并提供开放源代码数据 GeoLite2，GeoLite2 数据库是 GeoIP2 的免费版，其准确率稍低于付费版。</p> 
<p>GeoLite2 数据库由几部分组成：GeoLite2 国家库、GeoLite2 城市库和 Geolite2 ASN。他们分别满足不同的功能，GeoLite2 国家库仅能查询 IP 地址所在的国家和洲；GeoLite2 城市库可以查询到 IP 地址所在的国家、地区、城市、经纬度和邮政编码等信息；Geolite2 ASN 用于查询IP地址所属的自治域 AS 或者运营商 ISP。</p> 
<p>GeoLite2 离线数据库每月更新一次，可以通过官方网站下载 MaxMind DB 格式的压缩文件。MaxMind 提供支持 7 种编程语言或软件的 API 支持，包括 C#、C、Java、Perl、PHP、Python、Apache（mod_maxminddb）。还有许多第三方 API 支持更多种编程语言或软件。GeoLite2 支持包括英语、汉语、俄语、日语和西班牙语等在内的多种语言。<br>  </p> 
<h2><a id="GeoIP2__13"></a>二、GeoIP2 使用</h2> 
<p> </p> 
<h3><a id="1_15"></a>1、下载离线库</h3> 
<p> <br> 官方下载地址：<a href="https://dev.maxmind.com/geoip/geoip2/downloadable/" rel="nofollow">https://dev.maxmind.com/geoip/geoip2/downloadable/</a></p> 
<p>百度网盘：<a href="https://pan.baidu.com/s/1BMirxMxrGN6G6qZwH597Cg" rel="nofollow">https://pan.baidu.com/s/1BMirxMxrGN6G6qZwH597Cg</a> 提取码: vxsb</p> 
<p>下载文件解压后得到的 <strong>GeoLite2-City.mmdb</strong> 为 GeoIP2 离线库文件，大概 60M，不算小，可根据情况决定放在项目资源文件中或者服务器上。</p> 
<p><img src="https://images2.imgbox.com/9b/5f/WFptTc8B_o.png" alt="GeoIP2 离线库文件"><br>  </p> 
<h3><a id="2_Maven__25"></a>2、添加 Maven 依赖</h3> 
<p> </p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.maxmind.geoip2/geoip2 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.maxmind.geoip2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>geoip2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.13.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果 GeoIP2 运行时报错 com.fasterxml.jackson.databind.JsonMappingException：</p> 
<pre><code class="prism language-java">Exception in thread <span class="token string">"main"</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>NoSuchMethodError<span class="token operator">:</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>JsonMappingException<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Ljava<span class="token operator">/</span>io<span class="token operator">/</span>Closeable<span class="token punctuation">;</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span><span class="token punctuation">)</span>V
</code></pre> 
<p>因为缺少 jackson.databind 依赖包，引入 jackson 依赖即可解决：</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.11.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p> </p> 
<h3><a id="3_IP__53"></a>3、封装 IP 定位工具类</h3> 
<p> </p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>maxmind<span class="token punctuation">.</span>geoip2<span class="token punctuation">.</span>DatabaseReader<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>maxmind<span class="token punctuation">.</span>geoip2<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>GeoIp2Exception<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>maxmind<span class="token punctuation">.</span>geoip2<span class="token punctuation">.</span>model<span class="token punctuation">.</span>CityResponse<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>maxmind<span class="token punctuation">.</span>geoip2<span class="token punctuation">.</span>record<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>InetAddress<span class="token punctuation">;</span>

<span class="token comment">/**
 * IP 定位工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IpUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 全局静态常量，GeoIP2 离线库文件名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String geoip2DB <span class="token operator">=</span> <span class="token string">"GeoLite2-City.mmdb"</span><span class="token punctuation">;</span>

    <span class="token comment">// 全局静态变量，保证类加载时加载一次，避免反复读取 GeoIP2 离线库</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> DatabaseReader reader<span class="token punctuation">;</span>

    <span class="token comment">// 静态代码块, 初始化时执行一次</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        InputStream database<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 读取 GeoIP2 离线库，jar 包中的资源文件无法以 File 方式读取，需要用 InputStream 流式读取</span>
            database <span class="token operator">=</span> IpUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>geoip2DB<span class="token punctuation">)</span><span class="token punctuation">;</span>
            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseReader<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * IP 解析
     *
     * @param ip IP 地址
     * @return IpInfo
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> IpInfo <span class="token function">getIpInfo</span><span class="token punctuation">(</span>String ip<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        IpInfo info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IpInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 根据 IP 地址查询结果</span>
            InetAddress ipAddress <span class="token operator">=</span> InetAddress<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            CityResponse response <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">city</span><span class="token punctuation">(</span>ipAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 从查询结果中提取信息（国家，省份，城市，邮编，定位）</span>
            Country country <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Subdivision subdivision <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getMostSpecificSubdivision</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            City city <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Postal postal <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getPostal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Location location <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取信息的中文名称</span>
            info<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setCountryName</span><span class="token punctuation">(</span>country<span class="token punctuation">.</span><span class="token function">getNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setCountryCode</span><span class="token punctuation">(</span>country<span class="token punctuation">.</span><span class="token function">getIsoCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setProvinceName</span><span class="token punctuation">(</span>subdivision<span class="token punctuation">.</span><span class="token function">getNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setProvinceCode</span><span class="token punctuation">(</span>subdivision<span class="token punctuation">.</span><span class="token function">getIsoCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setCityName</span><span class="token punctuation">(</span>city<span class="token punctuation">.</span><span class="token function">getNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"zh-CN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setPostalCode</span><span class="token punctuation">(</span>postal<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setLongitude</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">setLatitude</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">GeoIp2Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * IP 信息实体类
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IpInfo</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// IP</span>
        <span class="token keyword">private</span> String ip<span class="token punctuation">;</span>

        <span class="token comment">// 国家</span>
        <span class="token keyword">private</span> String countryName<span class="token punctuation">;</span>
        <span class="token keyword">private</span> String countryCode<span class="token punctuation">;</span>

        <span class="token comment">// 省份</span>
        <span class="token keyword">private</span> String provinceName<span class="token punctuation">;</span>
        <span class="token keyword">private</span> String provinceCode<span class="token punctuation">;</span>

        <span class="token comment">// 城市</span>
        <span class="token keyword">private</span> String cityName<span class="token punctuation">;</span>

        <span class="token comment">// 邮政编码</span>
        <span class="token keyword">private</span> String postalCode<span class="token punctuation">;</span>

        <span class="token comment">// 经度</span>
        <span class="token keyword">private</span> Double longitude<span class="token punctuation">;</span>
        <span class="token comment">// 纬度</span>
        <span class="token keyword">private</span> Double latitude<span class="token punctuation">;</span>

        <span class="token keyword">public</span> String <span class="token function">getIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> ip<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIp</span><span class="token punctuation">(</span>String ip<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ip <span class="token operator">=</span> ip<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getCountryName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> countryName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCountryName</span><span class="token punctuation">(</span>String countryName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countryName <span class="token operator">=</span> countryName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getCountryCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> countryCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCountryCode</span><span class="token punctuation">(</span>String countryCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countryCode <span class="token operator">=</span> countryCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getProvinceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> provinceName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProvinceName</span><span class="token punctuation">(</span>String provinceName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>provinceName <span class="token operator">=</span> provinceName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getProvinceCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> provinceCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProvinceCode</span><span class="token punctuation">(</span>String provinceCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>provinceCode <span class="token operator">=</span> provinceCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getCityName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cityName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCityName</span><span class="token punctuation">(</span>String cityName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cityName <span class="token operator">=</span> cityName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> String <span class="token function">getPostalCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> postalCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPostalCode</span><span class="token punctuation">(</span>String postalCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>postalCode <span class="token operator">=</span> postalCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> Double <span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> longitude<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLongitude</span><span class="token punctuation">(</span>Double longitude<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>longitude <span class="token operator">=</span> longitude<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> Double <span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> latitude<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLatitude</span><span class="token punctuation">(</span>Double latitude<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latitude <span class="token operator">=</span> latitude<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"IpInfo{"</span> <span class="token operator">+</span>
                    <span class="token string">"ip='"</span> <span class="token operator">+</span> ip <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", countryName='"</span> <span class="token operator">+</span> countryName <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", countryCode='"</span> <span class="token operator">+</span> countryCode <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", provinceName='"</span> <span class="token operator">+</span> provinceName <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", provinceCode='"</span> <span class="token operator">+</span> provinceCode <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", cityName='"</span> <span class="token operator">+</span> cityName <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", postalCode='"</span> <span class="token operator">+</span> postalCode <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                    <span class="token string">", longitude="</span> <span class="token operator">+</span> longitude <span class="token operator">+</span>
                    <span class="token string">", latitude="</span> <span class="token operator">+</span> latitude <span class="token operator">+</span>
                    <span class="token string">'}'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>用自己的 IP 地址测试一下：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getIpInfo</span><span class="token punctuation">(</span><span class="token string">"112.20.83.138"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>测试结果：</p> 
<pre><code class="prism language-java">IpInfo<span class="token punctuation">{<!-- --></span>ip<span class="token operator">=</span><span class="token string">'112.20.83.138'</span><span class="token punctuation">,</span> countryName<span class="token operator">=</span><span class="token string">'中国'</span><span class="token punctuation">,</span> countryCode<span class="token operator">=</span><span class="token string">'CN'</span><span class="token punctuation">,</span> provinceName<span class="token operator">=</span><span class="token string">'江苏省'</span><span class="token punctuation">,</span> provinceCode<span class="token operator">=</span><span class="token string">'JS'</span><span class="token punctuation">,</span> cityName<span class="token operator">=</span><span class="token string">'南京'</span><span class="token punctuation">,</span> postalCode<span class="token operator">=</span><span class="token string">'null'</span><span class="token punctuation">,</span> longitude<span class="token operator">=</span><span class="token number">118.7778</span><span class="token punctuation">,</span> latitude<span class="token operator">=</span><span class="token number">32.0617</span><span class="token punctuation">}</span>
</code></pre> 
<p> </p> 
<h2><a id="GeoIP2__262"></a>三、GeoIP2 总结</h2> 
<p> <br> GeoLite2 基本上可以满足一般对精度要求不高的 IP 定位需求，离线运行查询速度很快，每秒能查询 2000+ 次，且数据信息较为丰富，唯一的不足是国内城市的查询准确性相对较差，这方面 ip.taobao.com 和 百度地图 api 做得更好，对国内这块的查询准确率和覆盖率上要更高，奈何这两货都是在线查询接口，查询次数和速度都有限制。当然如果项目组不缺钱直接埃文科技一步到位，全球最全 IP 定位数据库，不过我想既然你都看到这了，这钱估计还是得省下来，就老老实实用 GeoIP2 吧 23333~<br>  </p> 
<p><strong>参考文章：</strong></p> 
<p><a href="https://zhuanlan.zhihu.com/p/55075356" rel="nofollow">https://zhuanlan.zhihu.com/p/55075356</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eca80b15df14c8757cce17bb1ae2060f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【JVM系列4】new Object()到底占用几个字节，看完这篇就彻底明白了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5733192ea998170b0db527897c06f6d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">黑客秘籍:渗透测试实用指南_企业架构和开发人员经验的秘诀：走的路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>