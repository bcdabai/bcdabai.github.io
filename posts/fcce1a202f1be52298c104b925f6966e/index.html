<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java调用c&#43;&#43;的东西（内有转载的内容） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java调用c&#43;&#43;的东西（内有转载的内容）" />
<meta property="og:description" content="项目需要，要从java里边调用c&#43;&#43;写的一个模块，我本想用jni(java native interface)来着，用那个工程的dll文件，用native method 来加载。网上某位达人手把手教程序如下：
package jni;
public class CallDll {
static {
System.loadLibrary(&#34;CallDll&#34;);// no suffix,like .dll or .so
}
public native int getSquare(int i);
public static void main(String[] args) {
CallDll invoker = new CallDll();
int j = invoker.getSquare(4);
System.out.println(j);
}
}
1.再用 javah CallDll.java 将上述类变为 .h 文件，内容如下
/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class CallDll */" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fcce1a202f1be52298c104b925f6966e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2009-07-23T11:07:00+08:00" />
<meta property="article:modified_time" content="2009-07-23T11:07:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java调用c&#43;&#43;的东西（内有转载的内容）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>项目需要，要从java里边调用c++写的一个模块，我本想用jni(java native interface)来着，用那个工程的dll文件，用native method 来加载。网上某位达人手把手教程序如下：</p> 
<p> </p> 
<p>package jni;</p> 
<p> </p> 
<p>public class CallDll {<!-- --></p> 
<p>       static {<!-- --></p> 
<p>              System.loadLibrary("CallDll");// no suffix,like .dll or .so</p> 
<p>       }</p> 
<p>       public native int getSquare(int i);</p> 
<p>       public static void main(String[] args) {<!-- --></p> 
<p>              CallDll invoker = new CallDll();</p> 
<p>              int j = invoker.getSquare(4);</p> 
<p>              System.out.println(j);</p> 
<p>       }</p> 
<p>}</p> 
<p></p> 
<p> </p> 
<p>1.再用 javah CallDll.java 将上述类变为 .h 文件，内容如下</p> 
<p>    /* DO NOT EDIT THIS FILE - it is machine generated */</p> 
<p>#include &lt;jni.h&gt;</p> 
<p>/* Header for class CallDll */</p> 
<p> </p> 
<p>#ifndef _Included_CallDll</p> 
<p>#define _Included_CallDll</p> 
<p>#ifdef __cplusplus</p> 
<p>extern "C" {<!-- --></p> 
<p>#endif</p> 
<p> </p> 
<p>JNIEXPORT jint JNICALL Java_CallDll_getSquare</p> 
<p>  (JNIEnv *, jobject, jint);</p> 
<p> </p> 
<p>#ifdef __cplusplus</p> 
<p>}</p> 
<p>#endif</p> 
<p>#endif</p> 
<p> </p> 
<p>2.在vc中新建一个dll文件的工程，然后将这个投文件include，据此头文件写dll工程下的cpp文件，内容如下：</p> 
<p> </p> 
<p>// CallDll.cpp : 定义 DLL 应用程序的导出函数。</p> 
<p>//</p> 
<p> </p> 
<p> </p> 
<p>#include "stdafx.h"</p> 
<p>#include "CallDll.h"</p> 
<p>#include "jni.h"</p> 
<p>#include "jawt_md.h"</p> 
<p>#include "jni_md.h"</p> 
<p> </p> 
<p>JNIEXPORT jint JNICALL Java_CallDll_getSquare(JNIEnv *env, jobject obj, jint p)</p> 
<p>{<!-- --></p> 
<p>int j = p*p;</p> 
<p>return j;</p> 
<p>}</p> 
<p></p> 
<p> </p> 
<p>3.按F7进行编译，然后将debug下的CallDll.dll拷到java类目录下，运行java程序即可。</p> 
<p> </p> 
<p>本来想用上述的这一套方法的，但是太繁琐了，因为要将一个整个的工程变为dll的东西，而且这个工程里还调用了很多非程序类的外部资源，所以我想到了用另外一个方法：用java调用exe的方法（我可以修改c++程序将其输入输出位置确定，从而不用java和exe之间互相传递参数），网上找到的程序如下（这个版本在网上有很多，被转载的很厉害，呵呵）</p> 
<p> </p> 
<p>1.0 用Java调用windows系统的exe文件，比如notepad，calc之类： <br>　　public class Demo{ <br>　　public static void main(String args[]){ <br>　　Runtime rn=Runtime.getRuntime(); <br>　　Process p=null; <br>　　<br>　　try{ <br>　　p=rn.exec(notepad); <br>　　}catch(Exception e){ <br>　　System.out.println("Error exec notepad"); <br>　　} <br>　　} <br>　　} </p> 
<p><br>2.0调用其他的可执行文件，例如：自己制作的exe，或是下载安装的软件 </p> 
<p><br>　　public class Demo{ <br>　　public static void main(String args[]){ <br>　　Runtime rn=Runtime.getRuntime(); <br>　　Process p=null; <br>　　<br>　　try{ <br>　　p=rn.exec("/"D:/AnyQ/AnyQ.exe/""); <br>　　}catch(Exception e){ <br>　　System.out.println("Error exec AnyQ"); <br>　　} <br>　　} <br>　　}<br>　　(文章来源: baike.duba.net)</p> 
<p>上面是我搜到的程序，但是运行却看不到任何东西，运行时一闪即停，再搜，有人说是没有输出位置的问题，即那个程序运行了，但是输出终端不是eclipse的控制台，所以看不到，并给出程序如下：</p> 
<p> </p> 
<p>try {<!-- --></p> 
<p> </p> 
<p> p = rn.exec("test.exe");</p> 
<p> BufferedReader bufferedReader = new BufferedReader(</p> 
<p> new InputStreamReader(p.getInputStream()));</p> 
<p> </p> 
<p> while ((ss = bufferedReader.readLine()) != null)</p> 
<p> System.out.println(ss);</p> 
<p> } catch (Exception e) {<!-- --></p> 
<p> System.out.println("Error to run the exe");</p> 
<p> }</p> 
<p></p> 
<p> </p> 
<p>其中改动是用一个BufferedReader将输出吸收并输出在eclipse控制台，这样再运行就可以了。呵呵，真是一波三折。谁让你用java调c++呢！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3a21018d26fed8dc779474ba1b0f691/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何去掉流氓网站http://www.2345.com/?177</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/37e1c594af14a639d01af763c35213ba/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于“Invalid location of tag (form) ”错误或警告的解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>