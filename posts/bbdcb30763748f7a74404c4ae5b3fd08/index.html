<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot  MySql数据库中文乱码问题排查实纪 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot  MySql数据库中文乱码问题排查实纪" />
<meta property="og:description" content="引言： 最近用StringBoot开发了一个简单的小程序服务器，发现通过post请求插入的中文字段在数据库中是显示“???”的形式，本来不以为意，以为是显示的问题，谁知通过get请求获取数据的时候返回的也是“???”，这下就开始慌了，于是开始了问题的排查。以下为排查的过程。
首先上网搜索“mysql中文乱码”，结果倒是一大堆。 - 排除IDE编码问题 按照网上的信息，先排查IDE的问题，看IntellJ是否设置的了UTF-8的编码格式。 打开setting-&gt;editor-&gt;code Style-&gt;FileEncodings，发现IDE已经为UTF-8的编码，因此排除IDE的问题 - 查看服务器中数据库实际编码格式。 使用root用户登陆数据库，然后发送：show variables like &#39;character%&#39;; 结果显示： 可以看到服务器的编码方式是latin1。查阅资料后发现该编码是MySql的默认编码格式，且该编码不支持中文，因此需要将编码改为utf8格式。 问题找到了，接下来就是怎么样将该编码格式改为utf8的问题，本以为很简单的一件事，却费了我一天的时间来更改。
以下为修改MySql编码过程:
使用命令修改数据库编码 按照网上的说法，登陆数据库，使用命令set character_set_database = utf8; 发现竟然修改成功了，欣喜若狂。再使用命令show variables like &#39;character%&#39;;查看修改结果，显示编码方式已由latin1改为utf8了。 以为问题就这样解决的时候，再次post中文参数，发现还是“???”，更可气的是，该命令修改完的时候显示是utf8的，重启mysql后又重新变为了latin1。
修改my.cnf配置文件 上述方式无效，再查，说修改配置文件my.cnf。在etc/mysql目录下找到my.cnf文件，在该文件添加default-character-set = utf8 于是使用vim命令编辑该文件，将以上字段复制进去，保存退出。 然后用service mysql start启动Mysql。 结果： 再次泪奔。网上查了这个错误是指配置不正确导致不能正常启动。
再查，还有说在my.cnf里加default-character-set = utf8mb4 “mb4”是什么鬼？好吧，先试下，或许在服务器上utf8字段不一样呢？ 于是再次编辑启动。 结果： 再次失败告终。
再查，有说在工程jdbc连接添加编码的jdbc:mysql://localhost:3306/xjp?useUnicode=true&amp;characterEncoding=UTF-8 再试，或许是jdbc的锅。于是让my.cnf恢复原来样子。 于是再次启动mysql和工程。 能正常运行了，估计这次八九不离十了，然而再次post中文数据过去，还是“???”。天呐，要崩溃了，网上资料那么多，咋就没一个能用的呢？
或许是有隐藏打开方式？于是网上搜索“mysql my.cnf配置” 网上倒是很多对配置项的讲解，我也不深究那么多了，先跑起来再说。于是直接把别人的my.cnf配置复制粘贴到我的my.cnf。 再次启动mysql。 结果： 好吧！内心一万句MMP。
受到my.cnf配置的启发，于是用windows来做下实验，看下windows的配置是怎么样的。 windows下的mysql配置名为my.ini。于是打开搜索”character”，发现文件有一行#character-set-server=被注释起来了，再一看说明，原来就是用来设置默认编码的。于是赶紧取消注释并加上utf8。 然后重新启动Mysql，发现所有的编码方式已经修改为utf8。且应用运行后使用post传递数据，windows里的mysql居然能正常显示了。这时内心仿佛发现新大陆一样狂燥不已。更令人欣喜的是这个文件顶部的一行文字： 大意是可以直接复制这个文件内容到linux下的my.cnf。 于是把这些内容复制到服务器的my.cnf文件里，然后启动MySql。 结果： 居然连官方也欺骗我，仿佛全世界要把我抛弃了。泪奔。
就在我快要绝望的时候，一道灵光从天上直接打入了我的天灵盖，瞬间开窍了。既然老是提示配置出错，会不会是少加了点什么东西？于是重新去看windows版本的my.ini文件，发现配置下面那么多注释的英文中间会夹杂着[client]、[mysql]、[mysqld]的字样。然后查询了有关的概念。 于是有了这样配置： 就只是在原来的my.cnf文件后面加上了：
[mysqld] character-set-server=utf8 再次保存启动。 终于能正常运行了。于是激动地要去查看数据库编码。 编码也改为utf8了，感觉这次有戏。 于是把之前的测试数据库删掉（保险起见，删除重建，毕竟被坑怕了），再重新创建及启动应用。这次post终于能正常保存中文数据了。这简直比国足赢了世界杯还要高兴。 花了那么多时间，下面总结下这个问题简单的解决方法： 1、在etc/mysql/目录下找到my." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bbdcb30763748f7a74404c4ae5b3fd08/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-30T19:40:56+08:00" />
<meta property="article:modified_time" content="2018-07-30T19:40:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot  MySql数据库中文乱码问题排查实纪</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="引言">引言：</h3> 
<p>最近用StringBoot开发了一个简单的小程序服务器，发现通过post请求插入的中文字段在数据库中是显示“???”的形式，本来不以为意，以为是显示的问题，谁知通过get请求获取数据的时候返回的也是“???”，这下就开始慌了，于是开始了问题的排查。以下为排查的过程。</p> 
<p>首先上网搜索<strong>“mysql中文乱码”</strong>，结果倒是一大堆。 <br> <strong>- 排除IDE编码问题</strong> <br> 按照网上的信息，先排查IDE的问题，看IntellJ是否设置的了UTF-8的编码格式。 <br> 打开setting-&gt;editor-&gt;code Style-&gt;FileEncodings，发现IDE已经为UTF-8的编码，因此排除IDE的问题 <br> <img src="https://images2.imgbox.com/17/f0/xoWm52hw_o.png" alt="这里写图片描述" title=""></p> 
<p><strong>- 查看服务器中数据库实际编码格式。</strong> <br> 使用root用户登陆数据库，然后发送：<code>show variables like 'character%';</code> <br> 结果显示： <br> <img src="https://images2.imgbox.com/28/b5/kufP0xUu_o.png" alt="这里写图片描述" title=""></p> 
<p>可以看到服务器的编码方式是latin1。查阅资料后发现该编码是MySql的默认编码格式，且该编码不支持中文，因此需要将编码改为utf8格式。 <br> <strong>问题找到了，接下来就是怎么样将该编码格式改为utf8的问题，本以为很简单的一件事，却费了我一天的时间来更改。</strong></p> 
<p>以下为修改MySql编码过程:</p> 
<ul><li><p><strong>使用命令修改数据库编码</strong> <br> 按照网上的说法，登陆数据库，使用命令<code>set character_set_database = utf8;</code> <br> 发现竟然修改成功了，欣喜若狂。再使用命令<code>show variables like 'character%';</code>查看修改结果，显示编码方式已由latin1改为utf8了。 <br> 以为问题就这样解决的时候，再次post中文参数，发现还是“???”，更可气的是，该命令修改完的时候显示是utf8的，重启mysql后又重新变为了latin1。</p></li><li><p><strong>修改my.cnf配置文件</strong> <br> 上述方式无效，再查，说修改配置文件my.cnf。在etc/mysql目录下找到my.cnf文件，在该文件添加<code>default-character-set = utf8</code> <br> 于是使用vim命令编辑该文件，将以上字段复制进去，保存退出。 <br> 然后用<code>service mysql start</code>启动Mysql。 <br> 结果： <br> <img src="https://images2.imgbox.com/71/41/hyPPuAI9_o.png" alt="这里写图片描述" title=""> <br> 再次泪奔。网上查了这个错误是指配置不正确导致不能正常启动。</p></li></ul> 
<p><strong>再查，还有说在my.cnf里加</strong><code>default-character-set = utf8mb4</code> <br> “mb4”是什么鬼？好吧，先试下，或许在服务器上utf8字段不一样呢？ <br> 于是再次编辑启动。 <br> 结果： <br> <img src="https://images2.imgbox.com/10/6f/0SWuZTGa_o.png" alt="这里写图片描述" title=""> <br> 再次失败告终。</p> 
<p><strong>再查，有说在工程jdbc连接添加编码的</strong><code>jdbc:mysql://localhost:3306/xjp?useUnicode=true&amp;characterEncoding=UTF-8</code> <br> 再试，或许是jdbc的锅。于是让my.cnf恢复原来样子。 <br> 于是再次启动mysql和工程。 <br> 能正常运行了，估计这次八九不离十了，然而再次post中文数据过去，还是“???”。天呐，要崩溃了，网上资料那么多，咋就没一个能用的呢？</p> 
<p><strong>或许是有隐藏打开方式？于是网上搜索“mysql my.cnf配置”</strong> <br> 网上倒是很多对配置项的讲解，我也不深究那么多了，先跑起来再说。于是直接把别人的my.cnf配置复制粘贴到我的my.cnf。 <br> 再次启动mysql。 <br> 结果： <br> <img src="https://images2.imgbox.com/23/38/eXOkFiL4_o.png" alt="这里写图片描述" title=""> <br> 好吧！内心一万句MMP。</p> 
<p><strong>受到my.cnf配置的启发，于是用windows来做下实验，看下windows的配置是怎么样的。</strong> <br> windows下的mysql配置名为my.ini。于是打开搜索”character”，发现文件有一行<code>#character-set-server=</code>被注释起来了，再一看说明，原来就是用来设置默认编码的。于是赶紧取消注释并加上utf8。 <br> <img src="https://images2.imgbox.com/e0/ed/RWgpViOJ_o.png" alt="这里写图片描述" title=""> <br> 然后重新启动Mysql，发现所有的编码方式已经修改为utf8。且应用运行后使用post传递数据，windows里的mysql居然能正常显示了。这时内心仿佛发现新大陆一样狂燥不已。更令人欣喜的是这个文件顶部的一行文字： <br> <img src="https://images2.imgbox.com/23/70/I1Kr5MrF_o.png" alt="这里写图片描述" title=""> <br> 大意是可以直接复制这个文件内容到linux下的my.cnf。 <br> 于是把这些内容复制到服务器的my.cnf文件里，然后启动MySql。 <br> 结果： <br> <img src="https://images2.imgbox.com/15/33/tfae9JSd_o.png" alt="这里写图片描述" title=""> <br> 居然连官方也欺骗我，仿佛全世界要把我抛弃了。泪奔。</p> 
<p><strong>就在我快要绝望的时候，一道灵光从天上直接打入了我的天灵盖，瞬间开窍了。既然老是提示配置出错，会不会是少加了点什么东西？于是重新去看windows版本的my.ini文件，发现配置下面那么多注释的英文中间会夹杂着[client]、[mysql]、[mysqld]的字样。然后查询了有关的概念。</strong> <br> 于是有了这样配置： <br> <img src="https://images2.imgbox.com/79/ae/m1e2qSJw_o.png" alt="这里写图片描述" title=""> <br> 就只是在原来的my.cnf文件后面加上了：</p> 
<pre class="prettyprint"><code class=" hljs ini"><span class="hljs-title">[mysqld]</span>
<span class="hljs-setting">character-set-server=<span class="hljs-value">utf8</span></span></code></pre> 
<p>再次保存启动。 <br> 终于能正常运行了。于是激动地要去查看数据库编码。 <br> <img src="https://images2.imgbox.com/b6/e6/yTwnRYiw_o.png" alt="这里写图片描述" title=""> <br> 编码也改为utf8了，感觉这次有戏。 <br> <strong>于是把之前的测试数据库删掉（保险起见，删除重建，毕竟被坑怕了）</strong>，再重新创建及启动应用。这次post终于能正常保存中文数据了。这简直比国足赢了世界杯还要高兴。 <br> <img src="https://images2.imgbox.com/97/f0/2tTFebqT_o.png" alt="这里写图片描述" title=""></p> 
<p><strong>花了那么多时间，下面总结下这个问题简单的解决方法：</strong> <br> <strong>1、在etc/mysql/目录下找到my.cnf文件（该路径只限默认安装路径，自定义路径自行查找my.cnf的位置）</strong> <br> <strong>2、在该文件下方添加</strong></p> 
<pre class="prettyprint"><code class=" hljs ini"><span class="hljs-title">[mysqld]</span>
<span class="hljs-setting">character-set-server=<span class="hljs-value">utf8</span></span></code></pre> 
<p>然后退出保存重新启动mysql。<strong>如果还是不行，有可能是不支持原来的数据库直接修改为utf8编码，请删库重新测试。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/326c3d32169aaa548aebffd9618e366e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue中使用axios&#43;Promise二次封装ajax请求</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02f7cb1e29828ba5a8c344e47cfdd850/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ElasticSearch从入门到精通，史上最全（持续更新，未完待续，每天一点点）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>