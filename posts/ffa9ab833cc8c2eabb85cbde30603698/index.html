<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何使用 SigNoz 快速搭建一个可观测系统 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何使用 SigNoz 快速搭建一个可观测系统" />
<meta property="og:description" content="公众号关注 「奇妙的 Linux 世界」
设为「星标」，每天带你玩转 Linux ！
前言 SigNoz是一个开源的应用程序性能监控工具，可以帮助你监控你的应用程序并排除故障，它可以进行链路追踪、基础设施监控以及日志管理，可以说是Datalog的开源版本。
具体的能力如下：
监控应用程序指标，如延迟、每秒请求、错误率等
监测基础设施指标，如CPU利用率或内存使用情况
追踪跨服务的用户请求
对指标设置警报
通过查找导致问题的确切痕迹，找到问题的根本原因
查看单个请求追踪的详细火焰图
SigNoz包括以下组件。
OpenTelemetry Collector：从你的服务和应用中收集遥测数据。
ClickHouse：一个开源的、高性能的列式OLAP数据库管理系统。
Query Service：前端和ClickHouse之间的接口
Frontend：用户界面，用ReactJS和TypeScript构建。
安装 前提 Kubernetes &gt;= 1.21
仅支持x86/amd64架构
helm &gt;= 3.8
最低资源需求4C8G30G
有可用的默认storageclass
安装 （1）添加helm仓库
helm repo add signoz https://charts.signoz.io helm repo update （2）创建名称空间
kubectl create ns signoz （3）部署signoz
helm install sigonz -n signoz signoz/signoz （4）检查安装情况
# kubectl get po -n signoz NAME READY STATUS RESTARTS AGE chi-signoz-clickhouse-cluster-0-0-0 1/1 Running 0 46m signoz-alertmanager-0 1/1 Running 0 48m signoz-clickhouse-operator-7d4677bb47-dzbzm 2/2 Running 0 48m signoz-frontend-67db9bcf9b-l8x5h 1/1 Running 0 48m signoz-k8s-infra-otel-agent-hhjxb 1/1 Running 0 48m signoz-k8s-infra-otel-agent-t9wjr 1/1 Running 0 48m signoz-k8s-infra-otel-deployment-74fbb7d79-vkm2j 1/1 Running 0 48m signoz-otel-collector-789cf754fd-nsf6f 1/1 Running 0 48m signoz-otel-collector-metrics-67449f79f9-cgkm4 1/1 Running 0 48m signoz-query-service-0 1/1 Running 0 48m signoz-zookeeper-0 1/1 Running 0 48m （5）使用nodeport访问前端应用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ffa9ab833cc8c2eabb85cbde30603698/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-06T08:27:41+08:00" />
<meta property="article:modified_time" content="2023-05-06T08:27:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何使用 SigNoz 快速搭建一个可观测系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:center;">公众号关注 「奇妙的 Linux 世界」<br></p> 
 <p style="text-align:center;">设为「星标」，每天带你玩转 Linux ！</p> 
 <p style="text-align:center;"><img title="" src="https://images2.imgbox.com/97/1c/KBxJIqFt_o.jpg" alt="c95dad7d94519dd03129b030c4f4df23.jpeg"></p> 
 <h3>前言</h3> 
 <p>SigNoz是一个开源的应用程序性能监控工具，可以帮助你监控你的应用程序并排除故障，它可以进行链路追踪、基础设施监控以及日志管理，可以说是Datalog的开源版本。<br></p> 
 <p>具体的能力如下：</p> 
 <ul><li><p>监控应用程序指标，如延迟、每秒请求、错误率等</p></li><li><p>监测基础设施指标，如CPU利用率或内存使用情况</p></li><li><p>追踪跨服务的用户请求</p></li><li><p>对指标设置警报</p></li><li><p>通过查找导致问题的确切痕迹，找到问题的根本原因</p></li><li><p>查看单个请求追踪的详细火焰图</p></li></ul> 
 <img src="https://images2.imgbox.com/10/43/khZP947C_o.png" alt="outside_default.png"> 
 <p>SigNoz包括以下组件。</p> 
 <ul><li><p>OpenTelemetry Collector：从你的服务和应用中收集遥测数据。</p></li><li><p>ClickHouse：一个开源的、高性能的列式OLAP数据库管理系统。</p></li><li><p>Query Service：前端和ClickHouse之间的接口</p></li><li><p>Frontend：用户界面，用ReactJS和TypeScript构建。</p></li></ul> 
 <h3>安装</h3> 
 <h4>前提</h4> 
 <ul><li><p>Kubernetes &gt;= 1.21</p></li><li><p>仅支持x86/amd64架构</p></li><li><p>helm &gt;= 3.8</p></li><li><p>最低资源需求4C8G30G</p></li><li><p>有可用的默认storageclass</p></li></ul> 
 <h4>安装</h4> 
 <p>（1）添加helm仓库</p> 
 <pre class="has"><code class="language-go">helm repo add signoz https://charts.signoz.io
helm repo update</code></pre> 
 <p>（2）创建名称空间</p> 
 <pre class="has"><code class="language-go">kubectl create ns signoz</code></pre> 
 <p>（3）部署signoz</p> 
 <pre class="has"><code class="language-go">helm install sigonz -n signoz signoz/signoz</code></pre> 
 <p>（4）检查安装情况</p> 
 <pre class="has"><code class="language-go"># kubectl get po -n signoz 
NAME                                               READY   STATUS    RESTARTS   AGE
chi-signoz-clickhouse-cluster-0-0-0                1/1     Running   0          46m
signoz-alertmanager-0                              1/1     Running   0          48m
signoz-clickhouse-operator-7d4677bb47-dzbzm        2/2     Running   0          48m
signoz-frontend-67db9bcf9b-l8x5h                   1/1     Running   0          48m
signoz-k8s-infra-otel-agent-hhjxb                  1/1     Running   0          48m
signoz-k8s-infra-otel-agent-t9wjr                  1/1     Running   0          48m
signoz-k8s-infra-otel-deployment-74fbb7d79-vkm2j   1/1     Running   0          48m
signoz-otel-collector-789cf754fd-nsf6f             1/1     Running   0          48m
signoz-otel-collector-metrics-67449f79f9-cgkm4     1/1     Running   0          48m
signoz-query-service-0                             1/1     Running   0          48m
signoz-zookeeper-0                                 1/1     Running   0          48m</code></pre> 
 <p>（5）使用nodeport访问前端应用<img src="https://images2.imgbox.com/79/20/3uuvuAVy_o.png" alt="ea2c32c55d7864b910d234372ceeab9d.png"></p> 
 <p>第一次登录，需要注册一个账户，如下：<img src="https://images2.imgbox.com/a8/7c/TvI7Ffwd_o.png" alt="45b96cf2d075c012460ebc4f9bebab95.png"></p> 
 <p>然后，就进入前端面板。<img src="https://images2.imgbox.com/6f/06/I4iih5kE_o.png" alt="238814254c76d3d55ad2a598ec45404e.png"></p> 
 <h3>链路追踪</h3> 
 <h4>官方示例</h4> 
 <p>先部署一个官方demo，来感受一下链路追踪。</p> 
 <pre class="has"><code class="language-go"># curl -sL https://github.com/SigNoz/signoz/raw/main/sample-apps/hotrod/hotrod-install.sh   | HELM_RELEASE=signoz SIGNOZ_NAMESPACE=signoz bash
namespace/sample-application created
configmap/locust-cm created
configmap/scripts-cm created
deployment.apps/hotrod created
service/hotrod created
deployment.apps/locust-master created
service/locust-master created
deployment.apps/locust-slave created
✅ Successfully deployed HotROD sample application</code></pre> 
 <blockquote> 
  <p>!! HELM_RELEASE和SIGNOZ_NAMESPACE根据自己实际情况修改。</p> 
 </blockquote> 
 <p>然后看到所有服务都起来了。</p> 
 <pre class="has"><code class="language-go"># kubectl get po -n sample-application 
NAME                            READY   STATUS    RESTARTS   AGE
hotrod-794648c678-l226b         1/1     Running   0          54s
locust-master-b65744bbf-7hxhc   1/1     Running   0          54s
locust-slave-688c86bcb7-86snl   1/1     Running   0          54s</code></pre> 
 <p>然后使用下面的命令来模拟负载。</p> 
 <pre class="has"><code class="language-go">kubectl --namespace sample-application run strzal --image=djbingham/curl \
  --restart='OnFailure' -i --tty --rm --command -- curl -X POST -F \
  'locust_count=6' -F 'hatch_rate=2' http://locust-master:8089/swarm</code></pre> 
 <p>然后可以看到这些服务的请求链路。<img src="https://images2.imgbox.com/06/9a/ql4UKdHY_o.png" alt="4db7367b47197c911b8b674263d9e046.png"></p> 
 <p>点击其中一个请求，可以看到整个链路状态，如下：<img src="https://images2.imgbox.com/29/51/npKYrRFa_o.png" alt="56a0f053ffd547f06c5af4f196059bf0.png"></p> 
 <p>也可以看整个服务的链路图。<img src="https://images2.imgbox.com/82/16/fmjbXQsm_o.png" alt="6481abe4ecb7bc59383e917168ec3f52.png"></p> 
 <p>还可以查看每个服务的具体延时、错误等面板。<img src="https://images2.imgbox.com/a7/12/0H5XMq5E_o.png" alt="ed4a9e6fa35b4690859da3be8216f161.png"></p> 
 <p>然后停止负载模拟：</p> 
 <pre class="has"><code class="language-go">kubectl -n sample-application run strzal --image=djbingham/curl \
  --restart='OnFailure' -i --tty --rm --command -- curl \
  http://locust-master:8089/stop</code></pre> 
 <h4>应用接入</h4> 
 <p>SigNoz支持多种语言应用的接入，包括不限于Python、Java、Golang等。<img src="https://images2.imgbox.com/2b/72/GmbtKMYX_o.png" alt="9a339f82b342e874981eadd5273083ed.png"></p> 
 <p>以Java为例，我们只需要在启动命令中加入javaagent以及SigNoz地址配置即可，如下：</p> 
 <pre class="has"><code class="language-go">java -javaagent:/path/opentelemetry-javaagent.jar \
    -Dotel.exporter.otlp.endpoint=http://&lt;IP of SigNoz Backend&gt;:4317 \
    -Dotel.resource.attributes=service.name=&lt;app_name&gt; \
    -jar &lt;myapp&gt;.jar</code></pre> 
 <h3>监控</h3> 
 <p>SigNoz可以接受监控数据，不过我还没研究明白......</p> 
 <h3>日志</h3> 
 <p>安装完SigNoz过后，默认是打开了收集K8s Pod的日志，如下：<img src="https://images2.imgbox.com/66/d0/QbsPemtI_o.png" alt="8c9934e7618f712c702a2fe593f4fff1.png"></p> 
 <p>我们可以过滤日志，比如只看namespace=monitoring的日志，如下：<img src="https://images2.imgbox.com/83/3a/QP35wiyu_o.png" alt="59e83f623ae541a72cb5413423f649e2.png"></p> 
 <p>其具体的配置文件在value.yaml里，如下：</p> 
 <pre class="has"><code class="language-go">k8s-infra:
  presets:
    loggingExporter:
      enabled: false
    logsCollection:
      enabled: true
      include:
        - /var/log/pods/*/*/*.log
      startAt: beginning
      includeFilePath: true
      includeFileName: false
      blacklist:
        enabled: true
        signozLogs: false
        namespaces:
          - kube-system
        pods:
          - hotrod
          - locust
        containers: []
        additionalExclude: []</code></pre> 
 <p>在使用上还是有不少缺陷，日志查找不是很方便。</p> 
 <h3>告警</h3> 
 <p>（1）首先，添加通知渠道，这里选择使用Webhook<img src="https://images2.imgbox.com/03/19/GemP5DDW_o.png" alt="7eb20294dd6794828b786117e3064b26.png">由于对钉钉支持不友好，使用一个临时的webhook.sit进行测试。</p> 
 <p>（2）然后选择测试就可以再webhook.sit上接收到消息<img src="https://images2.imgbox.com/48/4b/oYMvMEkZ_o.png" alt="e8050fcc9fc7bd979812f8d30dc71596.png"></p> 
 <p>（3）然后就可以配置告警策略了<img src="https://images2.imgbox.com/ea/3c/8Ff157Fv_o.png" alt="2734f692784a48e2319b0e634b0d1459.png"><img src="https://images2.imgbox.com/70/b7/A5HwncYS_o.png" alt="bf747bd02209a5b8fc7707b812ee5187.png"></p> 
 <p>然后就能收到告警消息。<img src="https://images2.imgbox.com/1a/7f/5J1doEsZ_o.png" alt="b0c82f64a7ba896c463c4dc2eb2a7246.png"></p> 
 <blockquote> 
  <p>本文转载自：「运维开发故事」，原文：https://url.hi-linux.com/fR0Fo，版权归原作者所有。欢迎投稿，投稿邮箱: editor@hi-linux.com。</p> 
 </blockquote> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/0a/1e/VjfxRXF0_o.gif" alt="99b6b411824ea76092d34a3ebc52ec96.gif"><br><br></p> 
 <p>最近，我们建立了一个<strong>技术交流微信群</strong>。目前群里已加入了不少行业内的大神，有兴趣的同学可以加入和我们一起交流技术，在 <strong>「奇妙的 Linux 世界」</strong> 公众号直接回复 <strong>「加群」</strong> 邀请你入群。<br><br></p> 
 <p style="text-align:center;"><img title="" src="https://images2.imgbox.com/d1/0c/a10fhtte_o.png" alt="cdb5d16275f896d8890ffc82d7a32ab7.png"></p> 
 <p style="text-align:center;"><strong>你可能还喜欢</strong></p> 
 <p style="text-align:center;">点击下方图片即可阅读<br><br></p> 
 <p style="text-align:center;"><a href="" rel="nofollow"><img src="https://images2.imgbox.com/38/c2/1WlPy7CS_o.png" alt="7e5f1f48c79a3eca03af83c99ab1de3e.png"></a></p> 
 <p style="text-align:center;">如何使用 Argo Rollouts 和服务网格实现自动可控的金丝雀发布<br><br><a href="" rel="nofollow"><img src="https://images2.imgbox.com/42/ec/LfFNxAuG_o.png" alt="2da0b98d418cdff1b5657457639f1fc4.png"></a><br>点击上方图片，『美团|饿了么』外卖红包天天免费领<br><br></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d1/6d/442fLCOw_o.png" alt="f092295de212fccb0ce569384abc9910.png"></p> 
 <p style="text-align:center;">更多有趣的互联网新鲜事，关注「奇妙的互联网」视频号全了解！<br></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9bfeaa2b3ede5c8c89a38acee1c3802c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Warshall algorithm (transitive closure)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/64987e329f501abcb829fb27e6e69a02/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7 nbd 挂在qcow2或qcow，raw，虚机镜像，virsh，virt，使用qemu-nbd挂载qcow2镜像文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>