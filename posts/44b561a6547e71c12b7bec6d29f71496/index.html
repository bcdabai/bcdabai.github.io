<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python标出输出重定向到文件，（scapy show()函数的标注输出重定向到文件） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python标出输出重定向到文件，（scapy show()函数的标注输出重定向到文件）" />
<meta property="og:description" content="在进行scapy进行数据分析时，show（）函数的输出为标准输出，不好再做后续处理，因此想在代码中实现将函数的标准输出重定向到文件中，再读取文件进行处理。
将一个可写对象(如file-like对象)赋给sys.stdout，可使随后的print语句输出至该对象。重定向结束后，应将sys.stdout恢复最初的缺省值，即标准输出。
sys.stdout重定向 简单示例如下：
import sys savedStdout = sys.stdout #保存标准输出流 with open(&#39;out.txt&#39;, &#39;w&#43;&#39;) as file: sys.stdout = file #标准输出重定向至文件 print &#39;This message is for file!&#39; sys.stdout = savedStdout #恢复标准输出流 print &#39;This message is for screen!&#39; 在我代码中需要实现的功能：
def dnsstr(filename): rrname=[] rdata=[] &#39;&#39;&#39; dnstr =&#34;&#34;&#34; ###[ DNS Resource Record ]### rrname = &#39;hpd.baidu.com.&#39; type = CNAME rclass = IN ttl = 1564 rdlen = 18 rdata = &#39;hpd.a.shifen.com.&#39; ###[ DNS Resource Record ]### rrname = &#39;hpd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/44b561a6547e71c12b7bec6d29f71496/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-31T15:43:13+08:00" />
<meta property="article:modified_time" content="2020-03-31T15:43:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python标出输出重定向到文件，（scapy show()函数的标注输出重定向到文件）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> </p> 
<p>在进行scapy进行数据分析时，show（）函数的输出为标准输出，不好再做后续处理，因此想在代码中实现将函数的标准输出重定向到文件中，再读取文件进行处理。</p> 
<p>将一个可写对象(如file-like对象)赋给sys.stdout，可使随后的print语句输出至该对象。重定向结束后，应将sys.stdout恢复最初的缺省值，即标准输出。</p> 
<h3 id="23-sysstdout重定向">sys.stdout重定向</h3> 
<p>简单示例如下：</p> 
<pre><code>import sys
savedStdout = sys.stdout  #保存标准输出流
with open('out.txt', 'w+') as file:
    sys.stdout = file  #标准输出重定向至文件
    print 'This message is for file!'

sys.stdout = savedStdout  #恢复标准输出流
print 'This message is for screen!'</code></pre> 
<p> </p> 
<p>在我代码中需要实现的功能：</p> 
<pre><code class="language-html hljs">def dnsstr(filename):
    rrname=[]
    rdata=[]

    '''

    dnstr ="""
    ###[ DNS Resource Record ]### 
      rrname    = 'hpd.baidu.com.'
      type      = CNAME
      rclass    = IN
      ttl       = 1564
      rdlen     = 18
      rdata     = 'hpd.a.shifen.com.'
    ###[ DNS Resource Record ]### 
      rrname    = 'hpd.a.shifen.com.'
      type      = A
      rclass    = IN
      ttl       = 165
      rdlen     = 4
      rdata     = '180.101.212.33'
    """
    #re_set = r'rrname    = \'(.*?)\''
    #result_rrname = re.findall(re_set, dnstr)
    '''
    with open(filename,'r') as file:
        for r in file.readlines():
            if "rrname" in r:
                r = r.strip('\n ')
                r = (str(r).split('=')[1])
                r = r.strip(' ').strip('\'').strip('.')
                #print(r)
                rrname.append(r)

            if "rdata" in r:
                r = r.strip('\n ')
                r = r.strip('\n ')
                r = (str(r).split('=')[1])
                r = r.strip(' ').strip('\'').strip('.')
                rdata.append(r)
    #print(rrname,rdata)
    return rrname,rdata</code></pre> 
<p> </p> 
<pre><code class="language-html hljs">def handlePkt_modify(pcapfile):
    try:
        pcap = scapy.all.rdpcap(pcapfile)
    except Exception as e:
        print(e)
        return
    dnsdic={}

    savedStdout = sys.stdout#保存标准输出流

    with open('./file/dns.txt','w+') as file:
        for r in pcap:
            if r.getlayer('DNSRR'):                </code><code class="language-html">                sys.stdout = file#标准输出流重定向到文件</code><code class="language-html hljs">                r.getlayer('DNSRR').show()                
  
                #print(dnstr.show())

    sys.stdout = savedStdout#恢复标准输出流


    rrname_list,rdata_list = dnsstr('./file/dns.txt')

    for i in range(len(rrname_list)):
        if dnsdic.get(rrname_list[i])!=None:
            if rdata_list[i] not in dnsdic[rrname_list[i]]:
                dnsdic[rrname_list[i]].append(rdata_list[i])
        else:
            dnsdic[rrname_list[i]]=[]
            dnsdic[rrname_list[i]].append(rdata_list[i])
    
    #print(dnsdic)
    return dnsdic</code>
</pre> 
<p>Python标准输出重定向：<a href="https://www.cnblogs.com/clover-toeic/p/5491073.html" rel="nofollow">https://www.cnblogs.com/clover-toeic/p/5491073.html</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c45488738c04c52a86081fafe3d92fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CMAKE超级简单入门</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a5c084ba70465fe134e4a0830d1eb59/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Adobe Acrobat Reader DC 2019 (19.8)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>