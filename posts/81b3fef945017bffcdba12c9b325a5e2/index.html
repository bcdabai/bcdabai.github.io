<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>渗透测试神器CS(4.0)的使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="渗透测试神器CS(4.0)的使用" />
<meta property="og:description" content="CS CS简介CS功能安装CSCS的基本使用深入标题介绍 Beacon Commands基础操作演示 CS简介 CS 是Cobalt Strike的简称，是一款渗透测试神器，常被业界人称为CS神器。Cobalt Strike已经不再使用MSF而是作为单独的平台使用，它分为客户端与服务端，服务端是一个，客户端可以有多个，可被团队进行分布式协团操作。
CobaltStrike集成了端口转发、扫描多模式端口Listener、Windows exe程序生成、Windows dll动态链接库生成、java程序生成、office宏代码生成，包括站点克隆获取浏览器的相关信息等。
CS功能 Cobalt Strike可以使用 AggressorScripts脚本来加强自身，能够扩展菜单栏，Beacon命令行，提权脚本等。
Cobalt Strike通信配置文件是 Malleable C2，你可以修改CS的通讯特征，Beacon payload的一些行为。
Cobalt Strike可以引用其他的通讯框架ExternalC2，ExternalC2是由Cobalt Strike提出的一套规范/框架，它允许黑客根据需要对框架提供的默认HTTP(S)/DNS/SMB C2 通信通道进行扩展。
安装CS 下载并解压文件
目录如下
agscript 拓展应用的脚本
c2lint 用于检查profile的错误异常 teamserver 服务端程序 cobaltstrike，cobaltstrike.jar客户端程序(java跨平台) logs 目录记录与目标主机的相关信息 update，update.jar用于更新CS third-party 第三方工具 最核心的就是teamserver和cobaltstrike.jar，分别是服务端和客户端 启动服务端，我们首先给teamserver权限 chmod 777 teamserver 启动，第一个参数是地址，第二个参数是密码，地址是我们本机的地址，密码任意设置，这里为password
在服务端输入命令 ./teamserver 服务端ip地址 密码
接下来在客户端打开CS图形化界面
打开终端，输入
java -XX:&#43;AggressiveHeap -XX:&#43;UseParallelGC -jar cobaltstrike.jar命令启动。
界面如图
这里由于我们的服务端和客户端在一台机器上，我们就使用默认的host 127.0.0.1即可，port默认为50050，在启动服务端的时候通过回显也可以得知。如果更改了teamserver文件里的server_port值那么在此处就需要改成对应的。user可以随意设置，password为我们前面启动teamserver时的密码password
都设置好后，点击connect
启动后的界面如图
CS的基本使用 作为cobalt strike的第一课，直接简单地进行实战，先感受下cobalt strike最基础的使用流程及其魅力。
首先创建一个listener
左上角的cobaltstrike-&gt;listeners" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/81b3fef945017bffcdba12c9b325a5e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-27T17:56:51+08:00" />
<meta property="article:modified_time" content="2020-12-27T17:56:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">渗透测试神器CS(4.0)的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>CS</h4> 
 <ul><li><ul><li><a href="#CS_1" rel="nofollow">CS简介</a></li><li><a href="#CS_4" rel="nofollow">CS功能</a></li><li><a href="#CS_9" rel="nofollow">安装CS</a></li><li><a href="#CS_42" rel="nofollow">CS的基本使用</a></li><li><a href="#_60" rel="nofollow">深入标题介绍</a></li></ul> 
  </li><li><a href="#Beacon_Commands_98" rel="nofollow">Beacon Commands</a></li><li><ul><li><a href="#_191" rel="nofollow">基础操作演示</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="CS_1"></a>CS简介</h3> 
<p>CS 是Cobalt Strike的简称，是一款渗透测试神器，常被业界人称为CS神器。Cobalt Strike已经不再使用MSF而是作为单独的平台使用，它分为客户端与服务端，服务端是一个，客户端可以有多个，可被团队进行分布式协团操作。<br> CobaltStrike集成了端口转发、扫描多模式端口Listener、Windows exe程序生成、Windows dll动态链接库生成、java程序生成、office宏代码生成，包括站点克隆获取浏览器的相关信息等。</p> 
<h3><a id="CS_4"></a>CS功能</h3> 
<p>Cobalt Strike可以使用 AggressorScripts脚本来加强自身，能够扩展菜单栏，Beacon命令行，提权脚本等。<br> Cobalt Strike通信配置文件是 Malleable C2，你可以修改CS的通讯特征，Beacon payload的一些行为。<br> Cobalt Strike可以引用其他的通讯框架ExternalC2，ExternalC2是由Cobalt Strike提出的一套规范/框架，它允许黑客根据需要对框架提供的默认HTTP(S)/DNS/SMB C2 通信通道进行扩展。</p> 
<h3><a id="CS_9"></a>安装CS</h3> 
<p>下载并解压文件<br> <img src="https://images2.imgbox.com/2c/97/JYSH4oED_o.png" alt="在这里插入图片描述">目录如下<br> <img src="https://images2.imgbox.com/8f/5a/ymUZJkMh_o.png" alt="在这里插入图片描述">agscript 拓展应用的脚本</p> 
<pre><code>  c2lint 用于检查profile的错误异常

  teamserver 服务端程序

  cobaltstrike，cobaltstrike.jar客户端程序(java跨平台)

  logs 目录记录与目标主机的相关信息

  update，update.jar用于更新CS

  third-party 第三方工具

  最核心的就是teamserver和cobaltstrike.jar，分别是服务端和客户端

  启动服务端，我们首先给teamserver权限

  chmod 777 teamserver
</code></pre> 
<p><img src="https://images2.imgbox.com/cc/5f/TOJj0ml4_o.png" alt="在这里插入图片描述">启动，第一个参数是地址，第二个参数是密码，地址是我们本机的地址，密码任意设置，这里为password<br> 在服务端输入命令 <code>./teamserver 服务端ip地址 密码</code><br> <img src="https://images2.imgbox.com/5e/fa/2mqVrTbp_o.png" alt="在这里插入图片描述">接下来在客户端打开CS图形化界面<br> 打开终端，输入<br> <code>java -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar</code>命令启动。<br> <img src="https://images2.imgbox.com/84/62/0IrKfrNa_o.png" alt="在这里插入图片描述"> 界面如图<br> <img src="https://images2.imgbox.com/2b/8c/6zzZbh6V_o.png" alt="在这里插入图片描述">这里由于我们的服务端和客户端在一台机器上，我们就使用默认的host 127.0.0.1即可，port默认为50050，在启动服务端的时候通过回显也可以得知。如果更改了teamserver文件里的server_port值那么在此处就需要改成对应的。user可以随意设置，password为我们前面启动teamserver时的密码password<br> 都设置好后，点击connect<br> <img src="https://images2.imgbox.com/a1/a7/SP4MusPA_o.png" alt="在这里插入图片描述">启动后的界面如图<br> <img src="https://images2.imgbox.com/a3/c2/3BoXV6bk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="CS_42"></a>CS的基本使用</h3> 
<p>作为cobalt strike的第一课，直接简单地进行实战，先感受下cobalt strike最基础的使用流程及其魅力。<br> 首先创建一个listener<br> 左上角的cobaltstrike-&gt;listeners<br> <strong>复现</strong><br> 环境：<br> kali:192.168.175.147<br> win7:192.168.175.145<br> <img src="https://images2.imgbox.com/09/df/Z4WYxjTc_o.png" alt="在这里插入图片描述">开启个监听<br> <img src="https://images2.imgbox.com/7d/d2/Wcmjff0o_o.png" alt="在这里插入图片描述">点击add创建即可…<br> <img src="https://images2.imgbox.com/a0/0c/7I5io3o4_o.png" alt="在这里插入图片描述">选择生成后门-创建win.exe-payload…</p> 
<p><img src="https://images2.imgbox.com/c1/e9/gHhNsj5k_o.png" alt="在这里插入图片描述">创建好后<br> <img src="https://images2.imgbox.com/e4/1b/X53z07mz_o.png" alt="在这里插入图片描述">选择一个钓鱼链接<br> <img src="https://images2.imgbox.com/83/e8/7dII8CGy_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/70/90/oIud9jVU_o.png" alt="在这里插入图片描述">复制该链接到需要控制的靶机上下载即可<br> <img src="https://images2.imgbox.com/19/fb/ZqdRzTLZ_o.png" alt="在这里插入图片描述"><br> 下载好后，直接双击…<br> <img src="https://images2.imgbox.com/28/db/v8VYk1TQ_o.png" alt="在这里插入图片描述">可看到已经成功获得对方的shell，成功控制对方电脑…</p> 
<h3><a id="_60"></a>深入标题介绍</h3> 
<p><strong>Access</strong><br> <img src="https://images2.imgbox.com/58/13/6hDKOAUV_o.png" alt="在这里插入图片描述">Dump Hashes #获取hash<br> Elevate #提权<br> Golden Ticket #生成黄金票据注入当前会话<br> Make token #凭证转换<br> Run Mimikatz #运行 Mimikatz<br> Spawn As #用其他用户生成Cobalt Strike侦听器</p> 
<p><strong>Explore</strong><br> <img src="https://images2.imgbox.com/50/3c/PDXA0RMk_o.png" alt="在这里插入图片描述"><br> Browser Pivot #劫持目标浏览器进程<br> Desktop(VNC) #桌面交互<br> File Browser #文件浏览器<br> Net View #命令Net View<br> Port Scan #端口扫描<br> Process List #进程列表<br> Screenshot #截图</p> 
<p><strong>Pivoting</strong><br> <img src="https://images2.imgbox.com/3c/9f/Al6PmSZn_o.png" alt="在这里插入图片描述"><br> SOCKS Server #代理服务<br> Listener #反向端口转发<br> Deploy VPN #部署VPN</p> 
<p><strong>Spawn</strong></p> 
<p>外部监听器(如指派给MSF，获取meterpreter权限)</p> 
<p><strong>Session</strong><br> <img src="https://images2.imgbox.com/95/d6/5i7pudVD_o.png" alt="在这里插入图片描述">Note #备注<br> Remove #删除<br> Sleep #指定被控端休眠时间，默认60秒一次回传，让被控端每10秒来下载一次任务。实际中频率不宜过快,容易被发现。<br> Exit #退出</p> 
<p><strong>Interact(打开beacon)</strong><br> <img src="https://images2.imgbox.com/5b/56/sbSnT6ca_o.png" alt="在这里插入图片描述">beacon&gt; help</p> 
<h2><a id="Beacon_Commands_98"></a>Beacon Commands</h2> 
<p>Command Description</p> 
<hr> 
<p>argue 进程参数欺骗<br> blockdlls 阻止子进程加载非Microsoft DLL<br> browserpivot 注入受害者浏览器进程<br> bypassuac 绕过UAC提升权限<br> cancel 取消正在进行的下载<br> cd 切换目录<br> checkin 强制让被控端回连一次<br> clear 清除beacon内部的任务队列<br> connect Connect to a Beacon peer over TCP<br> covertvpn 部署Covert VPN客户端<br> cp 复制文件<br> dcsync 从DC中提取密码哈希<br> desktop 远程桌面(VNC)<br> dllinject 反射DLL注入进程<br> dllload 使用LoadLibrary将DLL加载到进程中<br> download 下载文件<br> downloads 列出正在进行的文件下载<br> drives 列出目标盘符<br> elevate 使用exp<br> execute 在目标上执行程序(无输出)<br> execute-assembly 在目标上内存中执行本地.NET程序<br> exit 终止beacon会话<br> getprivs Enable system privileges on current token<br> getsystem 尝试获取SYSTEM权限<br> getuid 获取用户ID<br> hashdump 转储密码哈希值<br> help 帮助<br> inject 在注入进程生成会话<br> jobkill 结束一个后台任务<br> jobs 列出后台任务<br> kerberos_ccache_use 从ccache文件中导入票据应用于此会话<br> kerberos_ticket_purge 清除当前会话的票据<br> kerberos_ticket_use Apply 从ticket文件中导入票据应用于此会话<br> keylogger 键盘记录<br> kill 结束进程<br> link Connect to a Beacon peer over a named pipe<br> logonpasswords 使用mimikatz转储凭据和哈希值<br> ls 列出文件<br> make_token 创建令牌以传递凭据<br> mimikatz 运行mimikatz<br> mkdir 创建一个目录<br> mode dns 使用DNS A作为通信通道(仅限DNS beacon)<br> mode dns-txt 使用DNS TXT作为通信通道(仅限D beacon)<br> mode dns6 使用DNS AAAA作为通信通道(仅限DNS beacon)<br> mode http 使用HTTP作为通信通道<br> mv 移动文件<br> net net命令<br> note 备注<br> portscan 进行端口扫描<br> powerpick 通过Unmanaged PowerShell执行命令<br> powershell 通过powershell.exe执行命令<br> powershell-import 导入powershell脚本<br> ppid Set parent PID for spawned post-ex jobs<br> ps 显示进程列表<br> psexec Use a service to spawn a session on a host<br> psexec_psh Use PowerShell to spawn a session on a host<br> psinject 在特定进程中执行PowerShell命令<br> pth 使用Mimikatz进行传递哈希<br> pwd 当前目录位置<br> reg Query the registry<br> rev2self 恢复原始令牌<br> rm 删除文件或文件夹<br> rportfwd 端口转发<br> run 在目标上执行程序(返回输出)<br> runas 以其他用户权限执行程序<br> runasadmin 在高权限下执行程序<br> runu Execute a program under another PID<br> screenshot 屏幕截图<br> setenv 设置环境变量<br> shell 执行cmd命令<br> shinject 将shellcode注入进程<br> shspawn 启动一个进程并将shellcode注入其中<br> sleep 设置睡眠延迟时间<br> socks 启动SOCKS4代理<br> socks stop 停止SOCKS4<br> spawn Spawn a session<br> spawnas Spawn a session as another user<br> spawnto Set executable to spawn processes into<br> spawnu Spawn a session under another PID<br> ssh 使用ssh连接远程主机<br> ssh-key 使用密钥连接远程主机<br> steal_token 从进程中窃取令牌<br> timestomp 将一个文件的时间戳应用到另一个文件<br> unlink Disconnect from parent Beacon<br> upload 上传文件<br> wdigest 使用mimikatz转储明文凭据<br> winrm 使用WinRM横向渗透<br> wmi 使用WMI横向渗透</p> 
<h3><a id="_191"></a>基础操作演示</h3> 
<p><img src="https://images2.imgbox.com/7b/55/hrX1vKYB_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/4a/05/UxLQeuLd_o.png" alt="在这里插入图片描述">右键目标interact来使用Beacon，用它来执行各种命令。在Cobalt Strike中，默认心跳为60s，执行命令的响应很慢，在下载文件时更加明显，所以根据实战环境把时间降低，建议不要太快，否则流量会相对明显。<br> <img src="https://images2.imgbox.com/b0/36/vC92TEQX_o.png" alt="在这里插入图片描述"><br> 在beacon中，如果想对目标进行命令管理，需要在前面加上shell，如shell whoami、shell ipconfig等…</p> 
<p><img src="https://images2.imgbox.com/12/7e/aYWLjF9M_o.png" alt="在这里插入图片描述">今天简单的简介入门级，简单的操作可自行搭建靶机操作<br> 后面会越来越深入的学习Cobalt Strike 4.0…加油！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27e34a5d05e8a0b942d29e326cf066d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">梯度和梯度算子(Roberts,Sobel,Laplace)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50cab800ec2382544c026d916b9fe105/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">oracle and or 优先级</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>