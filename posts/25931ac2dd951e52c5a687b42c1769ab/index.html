<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SqlServer  行转列，列转行   以及PIVOT函数快速实现行转列，UNPIVOT实现列转行 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SqlServer  行转列，列转行   以及PIVOT函数快速实现行转列，UNPIVOT实现列转行" />
<meta property="og:description" content="SqlServer 行转列，列转行 以及PIVOT函数快速实现行转列，UNPIVOT实现列转行 一 、列转行
创建所需的数据
CREATE TABLE [StudentScores](
[UserName] NVARCHAR(20), --学生姓名
[Subject] NVARCHAR(30), --科目
[Score] FLOAT, --成绩
)
INSERT INTO [StudentScores] SELECT &#39;张三&#39;, &#39;语文&#39;, 50
INSERT INTO [StudentScores] SELECT &#39;张三&#39;, &#39;数学&#39;, 90
INSERT INTO [StudentScores] SELECT &#39;张三&#39;, &#39;英语&#39;, 70
INSERT INTO [StudentScores] SELECT &#39;张三&#39;, &#39;生物&#39;, 95
INSERT INTO [StudentScores] SELECT &#39;李四&#39;, &#39;语文&#39;, 80
INSERT INTO [StudentScores] SELECT &#39;李四&#39;, &#39;数学&#39;, 92
INSERT INTO [StudentScores] SELECT &#39;李四&#39;, &#39;英语&#39;, 86
INSERT INTO [StudentScores] SELECT &#39;李四&#39;, &#39;生物&#39;, 88" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/25931ac2dd951e52c5a687b42c1769ab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-12T16:34:00+08:00" />
<meta property="article:modified_time" content="2018-07-12T16:34:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SqlServer  行转列，列转行   以及PIVOT函数快速实现行转列，UNPIVOT实现列转行</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="post"> 
 <h2 class="postTitle"> <a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/dashanboke/p/9300223.html" rel="nofollow">SqlServer 行转列，列转行 以及PIVOT函数快速实现行转列，UNPIVOT实现列转行</a> </h2> 
 <div class="clear"></div> 
 <div class="postBody"> 
  <div id="cnblogs_post_body" class="blogpost-body"> 
   <p><em> 一   、列转行</em></p> 
   <p>创建所需的数据</p> 
   <p>CREATE TABLE [StudentScores](</p> 
   <p><em id="__mceDel"> [UserName] NVARCHAR(20), --学生姓名<br> [Subject] NVARCHAR(30), --科目<br> [Score] FLOAT, --成绩<br>)</em></p> 
   <p>INSERT INTO [StudentScores] SELECT '张三', '语文', 50<br>INSERT INTO [StudentScores] SELECT '张三', '数学', 90<br>INSERT INTO [StudentScores] SELECT '张三', '英语', 70<br>INSERT INTO [StudentScores] SELECT '张三', '生物', 95<br>INSERT INTO [StudentScores] SELECT '李四', '语文', 80<br>INSERT INTO [StudentScores] SELECT '李四', '数学', 92<br>INSERT INTO [StudentScores] SELECT '李四', '英语', 86<br>INSERT INTO [StudentScores] SELECT '李四', '生物', 88</p> 
   <p>查询 结果</p> 
   <p><em>UserName Subject Score</em></p> 
   <p><em>Nick 语文 80<br>Nick 数学 90<br>Nick 英语 70<br>Nick 生物 85<br>Kent 语文 80<br>Kent 数学 90<br>Kent 英语 70<br>Kent 生物 85</em></p> 
   <p> </p> 
   <p><em>1.使用case when  then   else  end方法</em></p> 
   <p>select UserName ,</p> 
   <p>max( case [Subject] when '语文' then score else 0 end) as '语文',</p> 
   <p>max( case [Subject] when '数学' then score else 0 end) as '数学',</p> 
   <p>max( case [Subject] when '英语' then score else 0 end) as '英语',</p> 
   <p>max( case [Subject] when '生物' then score else 0 end) as '生物' from StudentScores group by UserName</p> 
   <p> </p> 
   <p><em>实现结果</em></p> 
   <p>UserName 语文 数学 英语 生物<br>Kent 80 90 70 85<br>Nick 80 90 70 85</p> 
   <p><em>2.使用pivot 函数解决</em></p> 
   <p>首先看pivot的函数的语法</p> 
   <p>PIVOT函数的格式如下</p> 
   <pre>PIVOT(&lt;聚合函数&gt;([聚合列值]) FOR [行转列前的列名] IN([行转列后的列名1],[行转列后的列名2],[行转列后的列名3],.......[行转列后的列名N]))</pre> 
   <ul><li>&lt;聚合函数&gt;就是我们使用的SUM,COUNT,AVG等Sql聚合函数，也就是行转列后计算列的聚合方式。</li><li>[聚合列值]要进行聚合的列名</li><li>[行转列前的列名]这个就是需要将行转换为列的列名。</li><li>[行转列后的列名]这里需要声明将行的值转换为列后的列名，因为转换后的列名其实就是转换前行的值，所以上面格式中的[行转列后的列名1],[行转列后的列名2],[行转列后的列名3],......[行转列后的列名N]其实就是[行转列前的列名]每一行的值。</li></ul> 
   <p>sql 语句如下：select * from StudentScores as A</p> 
   <p>pivot (max(score) for Subject in ([英语],[数学],[语文],[生物])) as M</p> 
   <p><em>  二 、行转列   </em></p> 
   <p><em>准备数据</em></p> 
   <p>CREATE TABLE ProgrectDetail<br>(<br> ProgrectName NVARCHAR(20), --工程名称<br> OverseaSupply INT, --海外供应商供给数量<br> NativeSupply INT, --国内供应商供给数量<br> SouthSupply INT, --南方供应商供给数量<br> NorthSupply INT --北方供应商供给数量<br>)</p> 
   <p>INSERT INTO ProgrectDetail<br>SELECT 'A', 100, 200, 50, 50<br>UNION ALL<br>SELECT 'B', 200, 300, 150, 150<br>UNION ALL<br>SELECT 'C', 159, 400, 20, 320<br>UNION ALL<br>SELECT 'D', 159, 400, 20, 320</p> 
   <p><em>1.使用 UNION ALL  方法</em></p> 
   <p>select ProgrectName,OverseaSupply（需要转列的名称） from ProgrectDetail <br>union all <br>select ProgrectName,NativeSupply from ProgrectDetail <br>union all <br>select ProgrectName,SouthSupply from ProgrectDetail <br>union all <br>select ProgrectName,NorthSupply from ProgrectDetail</p> 
   <p>2.使用 unpivot函数</p> 
   <p>UNPIVOT函数的格式如下：</p> 
   <pre>UNPIVOT([转换为行的列值在转换后对应的列名] for [转换为行的列名在转换后对应的列名] in ([转换为行的列1],[转换为行的列2],[转换为行的列3],...[转换为行的列N]))</pre> 
   <ul><li>[转换为行的列值在转换后对应的列名]这个是进行列转行的列其数据值在转换为行后的列名称</li><li>[转换为行的列名在转换后对应的列名]这个是进行列转行的列其列名在转换为行后的列名称</li><li>[转换为行的列]这个是声明哪些列要进行列转行</li></ul> 
   <p> </p> 
   <p>select p.ProgrectName,plvalue, typepl from (<br>select ProgrectName,OverseaSupply,NativeSupply,SouthSupply,NorthSupply from ProgrectDetail) t</p> 
   <p>unpivot ( plvalue for typepl in (OverseaSupply, NativeSupply, SouthSupply, NorthSupply ) ) p</p> 
   <p> </p> 
   <p> </p> 
   <p>坚持    写博客，把学过的东西记录下来</p> 
   <p> </p> 
  </div> 
  <div id="MySignature"></div> 
  <div class="clear"></div> 
  <div id="blog_post_info_block"> 
   <div id="BlogPostCategory"></div> 
   <div id="EntryTag"></div> 
   <div id="blog_post_info"> 
   </div> 
   <div class="clear"></div> 
   <div id="post_next_prev"></div> 
  </div> 
 </div> 
 <div class="postDesc">
   posted @ 
  <span id="post-date">2018-07-12 16:34</span> 
  <a href="https://www.cnblogs.com/dashanboke/" rel="nofollow">热爱生活。</a> 阅读( 
  <span id="post_view_count">...</span>) 评论( 
  <span id="post_comment_count">...</span>) 
  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=9300223" rel="nofollow">编辑</a> 
  <a href="#" rel="nofollow">收藏</a> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/010c4e6c5aaf0469dc7a91717a4ccd06/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">实际项目开发-GitLab CI持续集成</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bde5c23d3d96f39204b1d5318d67240c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C# winform 中控件禁用，但显示不变灰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>