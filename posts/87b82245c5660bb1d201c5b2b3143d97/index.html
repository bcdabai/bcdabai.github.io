<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Dokcer配置Tensorflow-1.15环境并使用VSCode开发 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Dokcer配置Tensorflow-1.15环境并使用VSCode开发" />
<meta property="og:description" content="使用Dokcer配置Tensorflow-1.15环境 目前学术界大部分深度学习的开源代码都是基于Pytorch的，但还有少部分工作或者以前的工作是基于Tensorflow 1.x的，由于tensorflow的版本和CUDA的版本有严格的对应关系，它需要依赖很多相应版本的CUDA的C&#43;&#43;动态库，而CUDA又和显卡型号存在对应关系，那此时在本机上直接部署tensorflow可能会破坏现有环境。所以我们可以选择使用Docker容器生成各种环境来执行代码。更棒的是VS Code的Remote-Container插件可以支持我们使用本地的Docker容器环境进行开发。
准备工作 首先需要在本机上安装NVIDIA的显卡驱动，剩下的CUDA库在Docker镜像中都配置好了
1. 拉取镜像 Tensorflow安装官网: https://www.tensorflow.org/install/docker?hl=zh-cn
Tensorflow官方docker hub链接： https://hub.docker.com/r/tensorflow/tensorflow/
拉取相应版本的cuda和tensorflow镜像
docker pull nvidia/cuda:10.0-devel-ubuntu18.04 docker pull tensorflow/tensorflow:1.15.3-gpu-jupyter 拉取镜像后直接运行，有一个报错
docker: Error response from daemon: Unknown runtime specified nvidia.
谷歌以后参考Stackoverflow: https://stackoverflow.com/questions/52865988/nvidia-docker-unknown-runtime-specified-nvidia
安装nvidia runtime, 并把它添加到docker runtime的配置文件
sudo apt-get install nvidia-container-runtime sudo vim /etc/docker/daemon.json 把下面内容添加到文件中
{ &#34;runtimes&#34;: { &#34;nvidia&#34;: { &#34;path&#34;: &#34;nvidia-container-runtime&#34;, &#34;runtimeArgs&#34;: [] } } } 重启docker
sudo systemctl daemon-reload sudo systemctl restart docker 2 启动容器 2.1 作为守护进程启动（启动后一直在后台运行） # 启动容器并后台运行 docker run -itd -v /home/qyz:/home/qyz --rm --runtime=nvidia --name tensorflow tensorflow/tensorflow:1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/87b82245c5660bb1d201c5b2b3143d97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-21T17:48:32+08:00" />
<meta property="article:modified_time" content="2022-08-21T17:48:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Dokcer配置Tensorflow-1.15环境并使用VSCode开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DokcerTensorflow115_0"></a>使用Dokcer配置Tensorflow-1.15环境</h2> 
<p>目前学术界大部分深度学习的开源代码都是基于Pytorch的，但还有少部分工作或者以前的工作是基于Tensorflow 1.x的，由于tensorflow的版本和CUDA的版本有严格的对应关系，它需要依赖很多相应版本的CUDA的C++动态库，而CUDA又和显卡型号存在对应关系，那此时在本机上直接部署tensorflow可能会破坏现有环境。所以我们可以选择使用Docker容器生成各种环境来执行代码。更棒的是VS Code的Remote-Container插件可以支持我们使用本地的Docker容器环境进行开发。</p> 
<h3><a id="_4"></a>准备工作</h3> 
<ul><li>首先需要在本机上安装NVIDIA的显卡驱动，剩下的CUDA库在Docker镜像中都配置好了<br> <img src="https://images2.imgbox.com/3f/60/5OEoAWef_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="1__9"></a>1. 拉取镜像</h3> 
<p>Tensorflow安装官网: <a href="https://www.tensorflow.org/install/docker?hl=zh-cn" rel="nofollow">https://www.tensorflow.org/install/docker?hl=zh-cn</a><br> Tensorflow官方docker hub链接： <a href="https://hub.docker.com/r/tensorflow/tensorflow/" rel="nofollow">https://hub.docker.com/r/tensorflow/tensorflow/</a></p> 
<p>拉取相应版本的cuda和tensorflow镜像</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> pull nvidia/cuda:10.0-devel-ubuntu18.04
<span class="token function">docker</span> pull tensorflow/tensorflow:1.15.3-gpu-jupyter
</code></pre> 
<p>拉取镜像后直接运行，有一个报错</p> 
<blockquote> 
 <p>docker: Error response from daemon: Unknown runtime specified nvidia.</p> 
</blockquote> 
<p>谷歌以后参考Stackoverflow: <a href="https://stackoverflow.com/questions/52865988/nvidia-docker-unknown-runtime-specified-nvidia" rel="nofollow">https://stackoverflow.com/questions/52865988/nvidia-docker-unknown-runtime-specified-nvidia</a></p> 
<p>安装nvidia runtime, 并把它添加到docker runtime的配置文件</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nvidia-container-runtime
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/docker/daemon.json
</code></pre> 
<p>把下面内容添加到文件中</p> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"runtimes"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"nvidia"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"nvidia-container-runtime"</span>,
            <span class="token string">"runtimeArgs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>重启docker</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre> 
<h3><a id="2__50"></a>2 启动容器</h3> 
<h4><a id="21__52"></a>2.1 作为守护进程启动（启动后一直在后台运行）</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 启动容器并后台运行</span>
<span class="token function">docker</span> run -itd -v /home/qyz:/home/qyz --rm --runtime<span class="token operator">=</span>nvidia --name tensorflow tensorflow/tensorflow:1.15.3-gpu-jupyter <span class="token function">bash</span>

<span class="token comment"># 查看所有的容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> -a

<span class="token comment"># 进入一个容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>容器ID<span class="token operator">&gt;</span> or <span class="token operator">&lt;</span>容器 name<span class="token operator">&gt;</span> <span class="token function">bash</span>
<span class="token comment"># 或</span>
<span class="token function">docker</span> attach <span class="token operator">&lt;</span>容器ID<span class="token operator">&gt;</span> or <span class="token operator">&lt;</span>容器 name<span class="token operator">&gt;</span>

<span class="token comment"># 停止容器</span>
<span class="token function">docker</span> stop <span class="token operator">&lt;</span>容器 ID<span class="token operator">&gt;</span> or <span class="token operator">&lt;</span>容器 name<span class="token operator">&gt;</span>

<span class="token comment"># 停止的容器可以通过restart重启</span>
<span class="token function">docker</span> restart <span class="token operator">&lt;</span>容器 ID<span class="token operator">&gt;</span> or <span class="token operator">&lt;</span>容器 name<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="22__75"></a>2.2 交互式启动（启动后直接进入容器，退出后容器自动停止）</h4> 
<p><strong>python交互式命令行启动</strong></p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run -it --rm --runtime<span class="token operator">=</span>nvidia tensorflow/tensorflow:1.15.3-gpu-jupyter python    
</code></pre> 
<p><strong>bash启动并指定挂载目录</strong></p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run -it --rm --runtime<span class="token operator">=</span>nvidia -v /home/qyz:/home/qyz tensorflow/tensorflow:1.15.3-gpu-jupyter <span class="token function">bash</span>
</code></pre> 
<p>此时就可以进入docker容器，利用其中的环境来执行本地的代码了.</p> 
<h4><a id="23_dockerjupyter_93"></a>2.3 docker中启动jupyter</h4> 
<pre><code class="prism language-bash">jupyter-notebook --no-browser --ip <span class="token number">0.0</span>.0.0 --port<span class="token operator">=</span><span class="token number">8888</span> --allow-root
</code></pre> 
<h3><a id="3_VS_Code_99"></a>3. VS Code连接容器</h3> 
<ol><li> <p>安装Remote-Containers插件</p> </li><li> <p>按<code>F1</code>，选择<code>remote-containers.attachToRunningContainer</code>命令，然后选择本地启动的容器</p> </li><li> <p>此时再点一下VS Code的插件，可以之前安装好的Python，Jupyter插件都是灰色的，不可用，需要根据VS Code的提示在Docker容器里再安装一下Python相关的插件，就可以正常写代码了。</p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/134258c2ae00732e2be28f9207da2562/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">应用层: HTTP 与 HTTPS协议</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20e792c5fea692f5b8582074b2a56202/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一些基本配色</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>