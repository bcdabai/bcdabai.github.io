<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s调试积累 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s调试积累" />
<meta property="og:description" content="文章目录 一、K8S 集群服务访问失败？二、K8S 集群服务访问失败？三、K8S 集群服务暴露失败？四、外网无法访问 K8S 集群提供的服务？五、pod 状态为 ErrImagePull？六、探测存活 pod 状态为 CrashLoopBackOff？七、POD 创建失败？八、POD 的 ready 状态未进入？九、pod 创建失败？十、kube-flannel-ds-amd64-ndsf7 插件 pod 的 status为 Init:0/1？十一、K8S 创建服务 status 为 ErrImagePull？十二、不能进入指定容器内部？十三、创建 PV 失败？十四、pod 使用 PV 后，无法访问其内容？十五、查看节点状态失败？十六、pod 一直处于 pending状态？十七、helm 安装组件失败？ 一、K8S 集群服务访问失败？ 问题：
原因分析：证书不能被识别，其原因为：自定义证书，过期等。解决方法：更新证书即可。 二、K8S 集群服务访问失败？ 问题：
curl: (7) Failed connect to 10.103.22.158:3000; Connection refused原因分析：端口映射错误，服务正常工作，但不能提供服务。解决方法：删除 svc，重新映射端口即可。kubectl delete svc nginx-deployment 三、K8S 集群服务暴露失败？ 问题：
Error from server (AlreadyExists): services “nginx-deployment” already exists原因分析：该容器已暴露服务了。解决方法：删除 svc，重新映射端口即可。 四、外网无法访问 K8S 集群提供的服务？ 原因分析：K8S 集群的 type 为 ClusterIP，未将服务暴露至外网。解决方法：修改 K8S 集群的 type 为 NodePort 即可，于是可通过所有 K8S 集群节点访问服务。修改命令kubectl edit svc nginx-deployment 五、pod 状态为 ErrImagePull？ 问题：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a880cbf035514fc6735bb46b8dac6e9c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-18T21:14:41+08:00" />
<meta property="article:modified_time" content="2024-01-18T21:14:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s调试积累</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#K8S__1" rel="nofollow">一、K8S 集群服务访问失败？</a></li><li><a href="#K8S__8" rel="nofollow">二、K8S 集群服务访问失败？</a></li><li><a href="#K8S__15" rel="nofollow">三、K8S 集群服务暴露失败？</a></li><li><a href="#_K8S__21" rel="nofollow">四、外网无法访问 K8S 集群提供的服务？</a></li><li><a href="#pod__ErrImagePull_25" rel="nofollow">五、pod 状态为 ErrImagePull？</a></li><li><a href="#_pod__CrashLoopBackOff_32" rel="nofollow">六、探测存活 pod 状态为 CrashLoopBackOff？</a></li><li><a href="#POD__37" rel="nofollow">七、POD 创建失败？</a></li><li><a href="#POD__ready__44" rel="nofollow">八、POD 的 ready 状态未进入？</a></li><li><a href="#pod__53" rel="nofollow">九、pod 创建失败？</a></li><li><a href="#kubeflanneldsamd64ndsf7__pod__status_Init01_59" rel="nofollow">十、kube-flannel-ds-amd64-ndsf7 插件 pod 的 status为 Init:0/1？</a></li><li><a href="#K8S__status__ErrImagePull_71" rel="nofollow">十一、K8S 创建服务 status 为 ErrImagePull？</a></li><li><a href="#_81" rel="nofollow">十二、不能进入指定容器内部？</a></li><li><a href="#_PV__89" rel="nofollow">十三、创建 PV 失败？</a></li><li><a href="#pod__PV__96" rel="nofollow">十四、pod 使用 PV 后，无法访问其内容？</a></li><li><a href="#_106" rel="nofollow">十五、查看节点状态失败？</a></li><li><a href="#pod__pending_114" rel="nofollow">十六、pod 一直处于 pending状态？</a></li><li><a href="#helm__122" rel="nofollow">十七、helm 安装组件失败？</a></li></ul> 
</div> 
<p></p> 
<h2><a id="K8S__1"></a>一、K8S 集群服务访问失败？</h2> 
<blockquote> 
 <ul><li><strong>问题：</strong><br> <img src="https://images2.imgbox.com/e1/43/RLe7tXGh_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/93/66/Wh9wE1YD_o.png" alt="在这里插入图片描述"></li><li><strong>原因分析</strong>：证书不能被识别，其原因为：自定义证书，过期等。</li><li><strong>解决方法</strong>：更新证书即可。</li></ul> 
</blockquote> 
<h2><a id="K8S__8"></a>二、K8S 集群服务访问失败？</h2> 
<blockquote> 
 <ul><li><strong>问题</strong>：<br> curl: (7) Failed connect to 10.103.22.158:3000; Connection refused</li><li><strong>原因分析</strong>：端口映射错误，服务正常工作，但不能提供服务。</li><li><strong>解决方法</strong>：删除 svc，重新映射端口即可。kubectl delete svc nginx-deployment</li></ul> 
</blockquote> 
<h2><a id="K8S__15"></a>三、K8S 集群服务暴露失败？</h2> 
<blockquote> 
 <ul><li><strong>问题</strong>：<br> Error from server (AlreadyExists): services “nginx-deployment” already exists</li><li><strong>原因分析</strong>：该容器已暴露服务了。</li><li><strong>解决方法</strong>：删除 svc，重新映射端口即可。</li></ul> 
</blockquote> 
<h2><a id="_K8S__21"></a>四、外网无法访问 K8S 集群提供的服务？</h2> 
<blockquote> 
 <ul><li><strong>原因分析</strong>：K8S 集群的 type 为 ClusterIP，未将服务暴露至外网。</li><li><strong>解决方法</strong>：修改 K8S 集群的 type 为 NodePort 即可，于是可通过所有 K8S 集群节点访问服务。修改命令kubectl edit svc nginx-deployment</li></ul> 
</blockquote> 
<h2><a id="pod__ErrImagePull_25"></a>五、pod 状态为 ErrImagePull？</h2> 
<blockquote> 
 <ul><li><strong>问题</strong>：<br> <img src="https://images2.imgbox.com/ae/09/XVxIOuWZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8b/f5/0uLTzitH_o.png" alt="在这里插入图片描述"></li><li><strong>原因分析</strong>：image 无法拉取。</li><li><strong>解决方法</strong>：更换镜像即可。</li></ul> 
</blockquote> 
<h2><a id="_pod__CrashLoopBackOff_32"></a>六、探测存活 pod 状态为 CrashLoopBackOff？</h2> 
<blockquote> 
 <ul><li><strong>原因分析</strong>：镜像问题，导致容器重启失败。</li><li><strong>解决方法</strong>：更换镜像即可。</li></ul> 
</blockquote> 
<h2><a id="POD__37"></a>七、POD 创建失败？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/8b/18/xjsB4Cx6_o.png" alt="在这里插入图片描述"></li><li><strong>原因分析</strong>：镜像问题导致容器无法启动。</li><li><strong>解决方法</strong>：更换镜像。</li></ul> 
</blockquote> 
<h2><a id="POD__ready__44"></a>八、POD 的 ready 状态未进入？</h2> 
<blockquote> 
 <ul><li>问题：</li></ul> 
 <p><img src="https://images2.imgbox.com/e5/bd/KN4HMvf1_o.png" alt="在这里插入图片描述"></p> 
 <ul><li><strong>原因分析</strong>：POD 的执行命令失败，无法获取资源。</li><li><strong>解决方法</strong>：进入容器内部，创建 yaml 定义的资源。<br> <img src="https://images2.imgbox.com/54/4f/QYwLndnJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/c5/gqo3Owp9_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="pod__53"></a>九、pod 创建失败？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/46/4a/d5lYvCoT_o.png" alt="在这里插入图片描述"></li><li><strong>原因分析</strong>：yml 文件内容出错—-使用中文字符：</li><li><strong>解决方法</strong>：修改 myregistrykey 内容即可。</li></ul> 
</blockquote> 
<h2><a id="kubeflanneldsamd64ndsf7__pod__status_Init01_59"></a>十、kube-flannel-ds-amd64-ndsf7 插件 pod 的 status为 Init:0/1？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/58/b1/DWOxJ81W_o.png" alt="在这里插入图片描述"></li><li>排查思路：kubectl -n kube-system describe pod kube-flannel-ds-amd64-ndsf7 #查询 pod 描述信息；<br> <img src="https://images2.imgbox.com/59/d5/XlBC6mP2_o.png" alt="在这里插入图片描述"></li><li>原因分析：k8s-slave1 节点拉取镜像失败。</li><li>解决方法： 
   <ol><li>登录 k8s-slave1，重启 docker 服务，手动拉取镜像。<br> <img src="https://images2.imgbox.com/e9/a9/P9YbRjNt_o.png" alt="在这里插入图片描述"></li><li>k8s-master 节点，重新安装插件即可。kubectl create -f kube-flannel.yml;kubectl get nodes<br> <img src="https://images2.imgbox.com/a1/0c/yaoFnhNr_o.png" alt="在这里插入图片描述"></li></ol> </li></ul> 
</blockquote> 
<h2><a id="K8S__status__ErrImagePull_71"></a>十一、K8S 创建服务 status 为 ErrImagePull？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/6d/d2/eeQKH7fS_o.png" alt="在这里插入图片描述"></li><li>排查思路：kubectl describe pod test-nginx<br> <img src="https://images2.imgbox.com/6d/dc/XfUBHDuV_o.png" alt="在这里插入图片描述"></li><li>原因分析：拉取镜像名称问题。</li><li>解决方法：删除错误 pod；重新拉取镜像；<br> kubectl delete pod test-nginx;kubectl run test-nginx --image=10.0.0.81:5000/nginx:alpine</li></ul> 
</blockquote> 
<h2><a id="_81"></a>十二、不能进入指定容器内部？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/ec/dc/nL3KxbEf_o.png" alt="在这里插入图片描述"></li><li>原因分析：yml 文件 comtainers 字段重复，导致该 pod 没有该容器。</li><li>解决方法：去掉 yml 文件中多余的 containers 字段，重新生成 pod。<br> <img src="https://images2.imgbox.com/1b/12/RkkLYugJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e8/23/HjG5XwGZ_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="_PV__89"></a>十三、创建 PV 失败？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/39/0c/EDxqQcIk_o.png" alt="在这里插入图片描述"></li><li>原因分析：pv 的 name 字段重复。</li><li>解决方法：修改 pv 的 name 字段即可。<br> <img src="https://images2.imgbox.com/a6/83/aKoJXtHy_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="pod__PV__96"></a>十四、pod 使用 PV 后，无法访问其内容？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/96/56/8oD5YeRo_o.png" alt="在这里插入图片描述"></li><li>原因分析：nfs 卷中没有文件或权限不对。<br> <img src="https://images2.imgbox.com/f6/6a/uS6A4RxJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7b/46/QjfAiSHw_o.png" alt="在这里插入图片描述"></li><li>解决方法：在 nfs 卷中创建文件并授予权限。<br> <img src="https://images2.imgbox.com/45/50/kRjTPLbk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3d/5c/xWOmTutS_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="_106"></a>十五、查看节点状态失败？</h2> 
<blockquote> 
 <ul><li>问题：<br> Error from server (NotFound): the server could not find the requested resource (get services http:heapster:)</li><li>原因分析：没有 heapster 服务。</li><li>解决方法：安装 promethus 监控组件即可。<br> <img src="https://images2.imgbox.com/f1/d6/YIDFiudz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/a0/4zFgifja_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="pod__pending_114"></a>十六、pod 一直处于 pending状态？</h2> 
<blockquote> 
 <ul><li>问题：<br> <img src="https://images2.imgbox.com/c0/d6/8uYgO8KJ_o.png" alt="在这里插入图片描述"></li><li>原因分析：由于已使用同样镜像发布了 pod，导致无节点可调度。<br> <img src="https://images2.imgbox.com/86/ef/KTXa5OYR_o.png" alt="在这里插入图片描述"></li><li>解决方法：删除所有 pod 后部署 pod 即可。<br> <img src="https://images2.imgbox.com/bf/44/zRd7UjIF_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<h2><a id="helm__122"></a>十七、helm 安装组件失败？</h2> 
<blockquote> 
 <ul><li>问题：</li></ul> 
 <pre><code>[root@k8s-master01 hello-world]# helm install
     Error: This command needs 1 argument: chart nam
[root@k8s-master01 hello-world]# helm install ./
     Error: no Chart.yaml exists in directory "/root/hello-world"
</code></pre> 
 <ul><li>原因分析：文件名格式不对。</li><li>解决方法：mv chart.yaml Chart.yaml</li></ul> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b75b4edc689c5bb70d9cd64f53fd78f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java设置可供下载的excel模板文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f359b4c6bb373713615448780a34b5f8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">翻译: Streamlit从入门到精通六 实战缓存Cache请求数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>