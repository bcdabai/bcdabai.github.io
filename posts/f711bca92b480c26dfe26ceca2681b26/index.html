<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Phantun: ä¸€æ¬¾çªç ´è¿è¥å•† QoS å°é”çš„é«˜æ€§èƒ½ UDP æµé‡ä¼ªè£…å·¥å…·ï¼Œæ”¯æŒ WireGuard åè®®... - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Phantun: ä¸€æ¬¾çªç ´è¿è¥å•† QoS å°é”çš„é«˜æ€§èƒ½ UDP æµé‡ä¼ªè£…å·¥å…·ï¼Œæ”¯æŒ WireGuard åè®®..." />
<meta property="og:description" content="å…¬ä¼—å·å…³æ³¨Â ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€
è®¾ä¸ºã€Œæ˜Ÿæ ‡ã€ï¼Œæ¯å¤©å¸¦ä½ ç©è½¬ Linux ï¼
åŸæ–‡é“¾æ¥ğŸ”—ï¼šhttps://icloudnative.io/posts/wireguard-over-tcp-using-phantun/
ğŸ‘‰WireGuardÂ ä½œä¸ºä¸€ä¸ªæ›´å…ˆè¿›ã€æ›´ç°ä»£çš„ VPN åè®®ï¼Œæ¯”èµ·ä¼ ç»Ÿçš„ IPSecã€OpenVPN ç­‰å®ç°ï¼Œæ•ˆç‡æ›´é«˜ï¼Œé…ç½®æ›´ç®€å•ï¼Œå¹¶ä¸”å·²ç»åˆå¹¶å…¥ Linux å†…æ ¸ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œç®€ç›´å°±æ˜¯ VPN ä¸­çš„æˆ˜æ–—æœºã€‚è¶Šæ¥è¶Šå¤šçš„é«˜äººåˆ©ç”¨ WireGuard å®ç°å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„éœ€æ±‚ã€‚ä¾‹å¦‚å›½å†…ä¸å›½å¤–æœºå™¨é€šè¿‡ WireGuard æ‰“é€šéš§é“ï¼Œå˜æˆä¼ª IPLC ä¸“çº¿ï¼›æˆ–è€…æ‰“é€šæœ¬åœ°ä¸ Kubernetes é›†ç¾¤çš„ç½‘ç»œã€‚
ä½†æ˜¯ WireGuard åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸‹ä¼šé‡åˆ°ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼šUDP å°é”/é™é€Ÿã€‚è™½ç„¶é€šè¿‡ WireGuard å¯ä»¥åœ¨éš§é“å†…ä¼ è¾“ä»»ä½•åŸºäº IP çš„åè®®ï¼ˆTCPã€UDPã€ICMPã€SCTPã€IPIPã€GRE ç­‰ï¼‰ï¼Œä½† WireGuard éš§é“æœ¬èº«æ˜¯é€šè¿‡ UDP åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œå›½å†…è¿è¥å•†æ ¹æœ¬æ²¡æœ‰èƒ½åŠ›å’Œç²¾åŠ›æ ¹æ® TCP å’Œ UDP çš„ä¸åŒå»æ·±åº¦å®šåˆ¶ä¸åŒçš„ QoS ç­–ç•¥ï¼Œå‡ ä¹å…¨éƒ¨é‡‡å–ä¸€åˆ€åˆ‡çš„æ‰‹æ®µï¼šå¯¹ UDP è¿›è¡Œé™é€Ÿç”šè‡³å°é”ã€‚
é²è¿…å…ˆç”Ÿè¯´è¿‡ï¼šç¾Šæ¯›å‡ºåœ¨ç¾Šèº«ä¸Šï¼çªç ´å£è¿˜æ˜¯åœ¨è¿è¥å•†èº«ä¸Šï¼šè™½ç„¶å¯¹ UDP ä¸å‹å¥½ï¼Œä½†å´æ— åŠ›æ·±åº¦æ£€æµ‹ TCP è¿æ¥çš„çœŸå®æ€§ã€‚
è¿™å°±å¥½åŠäº†ï¼Œæ—¢ç„¶ä½ å¯¹ TCP è¿æ¥çä¸€åªçœ¼é—­ä¸€åªçœ¼ï¼Œé‚£æˆ‘å°† UDP è¿æ¥ä¼ªè£…æˆ TCP è¿æ¥ä¸å°±è’™æ··è¿‡å…³äº†ã€‚ç›®å‰æ”¯æŒå°† UDP æµé‡ä¼ªè£…æˆ TCP æµé‡çš„ä¸»æµå·¥å…·æ˜¯Â udp2raw[1]ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´å¯¹è¿™ä¸ªå·¥å…·éƒ½è½»è½¦ç†Ÿè·¯äº†ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œä»Šå¤©çš„ä¸»è§’ä¸æ˜¯å®ƒï¼Œè€Œæ˜¯å¦ä¸€æ¬¾æ¯”å®ƒæ›´å¼ºå¤§çš„æ–°å·¥å…·ï¼šPhantun[2]ã€‚
Phantun ä»‹ç» Phantun æ•´ä¸ªé¡¹ç›®å®Œå…¨ä½¿ç”¨ Rust å®ç°ï¼Œæ€§èƒ½åŠæ‰“ udp2rawã€‚å®ƒçš„åˆè¡·å’Œ udp2raw ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†å®ç°ä¸€ç§ç®€å•çš„ç”¨æˆ·æ€ TCP çŠ¶æ€æœºæ¥å¯¹ UDP æµé‡åšä¼ªè£…ã€‚ä¸»è¦çš„ç›®çš„æ˜¯å¸Œæœ›èƒ½è®© UDP æµé‡çœ‹èµ·æ¥åƒæ˜¯ TCPï¼Œåˆä¸å¸Œæœ›å—åˆ° TCP retransmission æˆ–è€… congestion control çš„å½±å“ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f711bca92b480c26dfe26ceca2681b26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-11T08:42:25+08:00" />
<meta property="article:modified_time" content="2022-10-11T08:42:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Phantun: ä¸€æ¬¾çªç ´è¿è¥å•† QoS å°é”çš„é«˜æ€§èƒ½ UDP æµé‡ä¼ªè£…å·¥å…·ï¼Œæ”¯æŒ WireGuard åè®®...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:center;">å…¬ä¼—å·å…³æ³¨Â ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€<br></p> 
 <p style="text-align:center;">è®¾ä¸ºã€Œæ˜Ÿæ ‡ã€ï¼Œæ¯å¤©å¸¦ä½ ç©è½¬ Linux ï¼</p> 
 <p style="text-align:center;"><img title="" src="https://images2.imgbox.com/6c/29/GCzdKXvd_o.jpg" alt="e29ee7e673c6ab9a4b6aaf0d839f85e0.jpeg"></p> 
 <blockquote> 
  <p>åŸæ–‡é“¾æ¥ğŸ”—ï¼š<strong>https://icloudnative.io/posts/wireguard-over-tcp-using-phantun/</strong><br></p> 
 </blockquote> 
 <p><a href="" rel="nofollow">ğŸ‘‰WireGuard</a>Â ä½œä¸ºä¸€ä¸ªæ›´å…ˆè¿›ã€æ›´ç°ä»£çš„ VPN åè®®ï¼Œæ¯”èµ·ä¼ ç»Ÿçš„ IPSecã€OpenVPN ç­‰å®ç°ï¼Œæ•ˆç‡æ›´é«˜ï¼Œé…ç½®æ›´ç®€å•ï¼Œå¹¶ä¸”å·²ç»åˆå¹¶å…¥ Linux å†…æ ¸ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œç®€ç›´å°±æ˜¯ VPN ä¸­çš„æˆ˜æ–—æœºã€‚è¶Šæ¥è¶Šå¤šçš„é«˜äººåˆ©ç”¨ WireGuard å®ç°å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„éœ€æ±‚ã€‚ä¾‹å¦‚å›½å†…ä¸å›½å¤–æœºå™¨é€šè¿‡ WireGuard æ‰“é€šéš§é“ï¼Œå˜æˆä¼ª IPLC ä¸“çº¿ï¼›æˆ–è€…æ‰“é€šæœ¬åœ°ä¸ Kubernetes é›†ç¾¤çš„ç½‘ç»œã€‚</p> 
 <p>ä½†æ˜¯ WireGuard åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸‹ä¼šé‡åˆ°ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼š<strong>UDP å°é”/é™é€Ÿ</strong>ã€‚è™½ç„¶é€šè¿‡ WireGuard å¯ä»¥åœ¨éš§é“å†…ä¼ è¾“ä»»ä½•åŸºäº IP çš„åè®®ï¼ˆTCPã€UDPã€ICMPã€SCTPã€IPIPã€GRE ç­‰ï¼‰ï¼Œä½† WireGuard éš§é“æœ¬èº«æ˜¯é€šè¿‡ UDP åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œå›½å†…è¿è¥å•†æ ¹æœ¬æ²¡æœ‰èƒ½åŠ›å’Œç²¾åŠ›æ ¹æ® TCP å’Œ UDP çš„ä¸åŒå»æ·±åº¦å®šåˆ¶ä¸åŒçš„ QoS ç­–ç•¥ï¼Œå‡ ä¹å…¨éƒ¨é‡‡å–ä¸€åˆ€åˆ‡çš„æ‰‹æ®µï¼š<strong>å¯¹ UDP è¿›è¡Œé™é€Ÿç”šè‡³å°é”</strong>ã€‚</p> 
 <p>é²è¿…å…ˆç”Ÿè¯´è¿‡ï¼šç¾Šæ¯›å‡ºåœ¨ç¾Šèº«ä¸Šï¼çªç ´å£è¿˜æ˜¯åœ¨è¿è¥å•†èº«ä¸Šï¼šè™½ç„¶å¯¹ UDP ä¸å‹å¥½ï¼Œä½†å´<strong>æ— åŠ›æ·±åº¦æ£€æµ‹ TCP è¿æ¥çš„çœŸå®æ€§</strong>ã€‚</p> 
 <p>è¿™å°±å¥½åŠäº†ï¼Œæ—¢ç„¶ä½ å¯¹ TCP è¿æ¥çä¸€åªçœ¼é—­ä¸€åªçœ¼ï¼Œé‚£æˆ‘å°† UDP è¿æ¥ä¼ªè£…æˆ TCP è¿æ¥ä¸å°±è’™æ··è¿‡å…³äº†ã€‚ç›®å‰æ”¯æŒå°† UDP æµé‡ä¼ªè£…æˆ TCP æµé‡çš„ä¸»æµå·¥å…·æ˜¯Â udp2raw<sup>[1]</sup>ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´å¯¹è¿™ä¸ªå·¥å…·éƒ½è½»è½¦ç†Ÿè·¯äº†ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œä»Šå¤©çš„ä¸»è§’ä¸æ˜¯å®ƒï¼Œè€Œæ˜¯å¦ä¸€æ¬¾æ¯”å®ƒæ›´å¼ºå¤§çš„æ–°å·¥å…·ï¼šPhantun<sup>[2]</sup>ã€‚</p> 
 <img src="https://images2.imgbox.com/ed/24/QFNjOlF2_o.jpg" alt="2b438ee43f3cff6ce3ce6134d1264c7f.jpeg"> 
 <h3>Phantun ä»‹ç»</h3> 
 <p>Phantun æ•´ä¸ªé¡¹ç›®<strong>å®Œå…¨ä½¿ç”¨ Rust å®ç°</strong>ï¼Œæ€§èƒ½åŠæ‰“ udp2rawã€‚å®ƒçš„åˆè¡·å’Œ udp2raw ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†å®ç°ä¸€ç§ç®€å•çš„ç”¨æˆ·æ€ TCP çŠ¶æ€æœºæ¥å¯¹ UDP æµé‡åšä¼ªè£…ã€‚ä¸»è¦çš„ç›®çš„æ˜¯å¸Œæœ›èƒ½è®© UDP æµé‡çœ‹èµ·æ¥åƒæ˜¯ TCPï¼Œåˆä¸å¸Œæœ›å—åˆ° TCP retransmission æˆ–è€… congestion control çš„å½±å“ã€‚</p> 
 <p>éœ€è¦ç”³æ˜çš„æ˜¯ï¼Œ<strong>Phantun çš„ç›®æ ‡ä¸æ˜¯ä¸ºäº†æ›¿ä»£ udp2raw</strong>ï¼Œä»ä¸€å¼€å§‹ Phantun å°±å¸Œæœ›è®¾è®¡è¶³å¤Ÿçš„ç®€å•é«˜æ•ˆï¼Œæ‰€ä»¥ udp2raw æ”¯æŒçš„Â <strong>ICMP éš§é“ï¼ŒåŠ å¯†ï¼Œé˜²æ­¢é‡æ”¾</strong>ç­‰ç­‰åŠŸèƒ½ Phantun éƒ½é€‰æ‹©ä¸å®ç°ã€‚</p> 
 <p>Phantun å‡è®¾ UDP åè®®æœ¬èº«å·²ç»è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥æ•´ä¸ªè½¬å‘è¿‡ç¨‹å°±æ˜¯ç®€å•çš„æ˜æ–‡æ¢å¤´åŠ ä¸Šä¸€äº›å¿…è¦çš„ TCP Â çŠ¶æ€æ§åˆ¶ä¿¡æ¯ã€‚å¯¹äºæˆ‘æ—¥å¸¸ä½¿ç”¨çš„ WireGuard æ¥è¯´ï¼ŒPhantun è¿™ç§è®¾è®¡æ˜¯è¶³å¤Ÿå®‰å…¨çš„ï¼Œå› ä¸º WireGuard Â çš„åè®®å·²ç»æ›´å¥½çš„å®ç°äº†è¿™äº›å®‰å…¨åŠŸèƒ½ã€‚</p> 
 <p>Phantun ä½¿ç”¨ TUN æ¥å£æ¥æ”¶å‘ 3 å±‚æ•°æ®åŒ…ï¼Œudp2raw ä½¿ç”¨ Raw Socket + BFP è¿‡æ»¤å™¨ã€‚ä¸ªäººæ„Ÿè§‰åŸºäº TUN çš„å®ç°è¦ç¨å¾®çš„ä¼˜é›…ä¸€ç‚¹ï¼Œè€Œä¸”è·¨å¹³å°ç§»æ¤ä¹Ÿè¦æ›´å®¹æ˜“ã€‚</p> 
 <p>Phantun çš„ TCP è¿æ¥æ˜¯æŒ‰éœ€åˆ›å»ºçš„ï¼Œåªå¯åŠ¨ Client ä¸ä¼šä¸»åŠ¨å»è¿æ¥æœåŠ¡å™¨ï¼Œéœ€è¦ç¬¬ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾äº†åæ‰ä¼šæŒ‰éœ€åˆ›å»ºã€‚æ¯ä¸ª UDP Â æµéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ TCP è¿æ¥ã€‚è¿™ä¸€ç‚¹è·Ÿ udp2raw å¾ˆä¸ä¸€æ ·ï¼Œudp2raw æ‰€æœ‰çš„ UDP è¿æ¥å…±ç”¨ä¸€ä¸ª TCP è¿æ¥ã€‚è¿™æ ·åšçš„åå¤„å°±æ˜¯ udp2raw éœ€è¦é¢å¤–çš„å¤´éƒ¨ä¿¡æ¯æ¥åŒºåˆ†è¿æ¥ï¼Œæ›´åŠ å¢åŠ äº†å¤´éƒ¨çš„å¼€é”€ã€‚è·Ÿçº¯ UDP æ¯”è¾ƒï¼ŒPhantun æ¯ä¸ªæ•°æ®åŒ…çš„é¢å¤–å¤´éƒ¨å¼€é”€æ˜¯ 12 Â byteï¼Œudp2raw æ ¹æ®æˆ‘çš„æµ‹è¯•è¾¾åˆ°äº† 44 bytes ã€‚</p> 
 <p>ä¸‹é¢æ˜¯ Phantun ä¸ udp2raw çš„è¯¦ç»†å¯¹æ¯”ï¼š</p> 
 <table width="677"><thead><tr><th><br></th><th>Phantun</th><th>udp2raw</th></tr></thead><tbody><tr><td>UDP over FakeTCP æ··æ·†</td><td>âœ…</td><td>âœ…</td></tr><tr><td>UDP over ICMP æ··æ·†</td><td>âŒ</td><td>âœ…</td></tr><tr><td>UDP over UDP æ··æ·†</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å¤šçº¿ç¨‹</td><td>âœ…</td><td>âŒ</td></tr><tr><td>ååé‡</td><td>Better</td><td>Good</td></tr><tr><td>ä¸‰å±‚è½¬å‘æ¨¡å¼</td><td>TUN interface</td><td>Raw sockets + BPF</td></tr><tr><td>éš§é“ MTU å¼€é”€</td><td>12 bytes</td><td>44 bytes</td></tr><tr><td>æ¯ä¸ª UDP Â æµéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ TCP è¿æ¥</td><td>Client/Server</td><td>Server only</td></tr><tr><td>é˜²æ­¢é‡æ”¾ï¼ŒåŠ å¯†</td><td>âŒ</td><td>âœ…</td></tr><tr><td>IPv6</td><td>âœ…</td><td>âœ…</td></tr></tbody></table> 
 <h3>Phantun å·¥ä½œåŸç†</h3> 
 <img src="https://images2.imgbox.com/9d/c1/EQqacY7s_o.jpg" alt="9151d4c186881016c23956eb3aea7aff.jpeg"> 
 <p>Phantun åˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚ 4567ï¼ˆé€šè¿‡Â <code>--local</code>Â å‚æ•°æŒ‡å®šï¼‰ï¼Œå¹¶å°† UDP æ•°æ®åŒ…è½¬å‘åˆ° UDP æœåŠ¡ï¼ˆè¿™é‡ŒæŒ‡çš„å°±æ˜¯æœåŠ¡ç«¯ WireGuard çš„ç›‘å¬ç«¯å£å’Œåœ°å€ï¼Œé€šè¿‡Â <code>--remote</code>Â å‚æ•°æŒ‡å®šï¼‰ã€‚</p> 
 <p>å®¢æˆ·ç«¯ä¹Ÿä¼šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚Â <code>127.0.0.1:4567</code>ï¼ˆé€šè¿‡Â <code>--local</code>Â å‚æ•°æŒ‡å®šï¼‰ï¼Œå¹¶ä¸”é€šè¿‡Â <code>--remote</code>Â å‚æ•°ä¸æœåŠ¡ç«¯ï¼ˆæ¯”å¦‚Â <code>10.0.0.1:4567</code>ï¼‰å»ºç«‹è¿æ¥ã€‚</p> 
 <p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª TUN ç½‘å¡ï¼Œå®¢æˆ·ç«¯ TUN ç½‘å¡é»˜è®¤åˆ†é…çš„ IPv4/IPv6 åœ°å€åˆ†åˆ«æ˜¯Â <code>192.168.200.2</code>Â å’ŒÂ <code>fcc8::2</code>ï¼ŒæœåŠ¡ç«¯ TUN ç½‘å¡é»˜è®¤åˆ†é…çš„ IPv4/IPv6 åœ°å€åˆ†åˆ«æ˜¯Â <code>192.168.201.2</code>Â å’ŒÂ <code>fcc9::2</code>ã€‚</p> 
 <p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯éƒ½éœ€è¦å¼€å¯ IP forwardingï¼Œå¹¶ä¸”éœ€è¦åˆ›å»ºç›¸åº”çš„ NAT è§„åˆ™ã€‚å®¢æˆ·ç«¯åœ¨æµé‡ç¦»å¼€ç‰©ç†ç½‘å¡ä¹‹å‰ï¼Œéœ€è¦å¯¹ IP <code>192.168.200.2</code>Â è¿›è¡Œ SNATï¼›æœåŠ¡ç«¯åœ¨æµé‡è¿›å…¥ç½‘å¡ä¹‹å‰ï¼Œéœ€è¦å°† IP DNAT ä¸ºÂ <code>192.168.201.2</code>ã€‚</p> 
 <h3>Phantun é…ç½®æ­¥éª¤</h3> 
 <p>æ¥ä¸‹æ¥æˆ‘ä¼šé€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Phantun å°† WireGuard çš„ UDP æµé‡ä¼ªè£…æˆ TCPã€‚æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«å®‰è£… phantunï¼Œå¯ä»¥åˆ°Â release é¡µé¢<sup>[3]</sup>ä¸‹è½½ï¼Œæ¨èä¸‹è½½é™æ€ç¼–è¯‘ç‰ˆæœ¬Â <code>phantun_x86_64-unknown-linux-musl.zip</code>ã€‚</p> 
 <h4>æœåŠ¡ç«¯</h4> 
 <p>å‡è®¾æœåŠ¡ç«¯çš„å…¬ç½‘ IP åœ°å€æ˜¯Â <code>121.36.134.95</code>ï¼ŒWireGuard ç›‘å¬ç«¯å£æ˜¯Â <code>51822</code>ã€‚é¦–å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶Â <code>/etc/wireguard/wg0.conf</code>ï¼Œåœ¨Â <code>[Interface]</code>Â ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p> 
 <pre class="has"><code class="language-go">MTU = 1300
PreUp = iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 4567 -j DNAT --to-destination 192.168.201.2
PreUp = RUST_LOG=info phantun_server --local 4567 --remote 127.0.0.1:51822 &amp;&gt; /var/log/phantun_server.log &amp;
PostDown = iptables -t nat -D PREROUTING -p tcp -i eth0 --dport 4567 -j DNAT --to-destination 192.168.201.2
PostDown = killall phantun_server || true</code></pre> 
 <p>ä½ éœ€è¦å°† eth0 æ›¿æ¢ä¸ºä½ æœåŠ¡ç«¯çš„ç‰©ç†ç½‘å¡åã€‚MTU å€¼å…ˆä¸ç®¡ï¼Œåé¢å†å‘Šè¯‰å¤§å®¶è°ƒè¯•æ–¹æ³•ã€‚</p> 
 <pre class="has"><code class="language-go">PreUp = iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 4567 -j DNAT --to-destination 192.168.201.2</code></pre> 
 <p>è¿™æ¡ iptables è§„åˆ™è¡¨ç¤ºå°†Â <code>4567</code>Â ç«¯å£çš„å…¥ç«™æµé‡ DNAT ä¸º TUN ç½‘å¡çš„ IP åœ°å€ã€‚</p> 
 <pre class="has"><code class="language-go">PreUp = RUST_LOG=info phantun_server --local 4567 --remote 127.0.0.1:51822 &amp;&gt; /var/log/phantun_server.log &amp;</code></pre> 
 <p>è¿™é‡Œä¼šå¯åŠ¨ phantun_serverï¼Œç›‘å¬åœ¨Â <code>4567</code>Â ç«¯å£ï¼Œå¹¶å°† UDP æ•°æ®åŒ…è½¬å‘åˆ° WireGuardã€‚</p> 
 <p>æœåŠ¡ç«¯å®Œæ•´çš„ WireGuard é…ç½®ï¼š</p> 
 <pre class="has"><code class="language-go"># local settings for Endpoint B
[Interface]
PrivateKey = QH1BJzIZcGo89ZTykxls4i2DKgvByUkHIBy3BES2gX8= 
Address = 10.0.0.2/32
ListenPort = 51822
MTU = 1300
PreUp = iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 4567 -j DNAT --to-destination 192.168.201.2
PreUp = RUST_LOG=info phantun_server --local 4567 --remote 127.0.0.1:51822 &amp;&gt; /var/log/phantun_server.log &amp;
PostDown = iptables -t nat -D PREROUTING -p tcp -i eth0 --dport 4567 -j DNAT --to-destination 192.168.201.2
PostDown = killall phantun_server || true

# remote settings for Endpoint A
[Peer]
PublicKey = wXtD/VrRo92JHc66q4Ypmnd4JpMk7b1Sb0AcT+pJfwY= 
AllowedIPs = 10.0.0.1/32</code></pre> 
 <p>æœ€åé‡å¯ WireGuard å³å¯ï¼š</p> 
 <pre class="has"><code class="language-go">$Â systemctlÂ restartÂ wg-quick@wg0</code></pre> 
 <h4>å®¢æˆ·ç«¯</h4> 
 <p>å‡è®¾å®¢æˆ·ç«¯çš„ WireGuard ç›‘å¬ç«¯å£æ˜¯Â <code>51821</code>ã€‚é¦–å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶Â <code>/etc/wireguard/wg0.conf</code>ï¼Œåœ¨Â <code>[Interface]</code>Â ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p> 
 <pre class="has"><code class="language-go">MTU = 1300
PreUp = iptables -t nat -A POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4567 --remote 121.36.134.95:4567 &amp;&gt; /var/log/phantun_client.log &amp;
PostDown = iptables -t nat -D POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PostDown = killall phantun_client || true</code></pre> 
 <p>ä½ éœ€è¦å°† eth0 æ›¿æ¢ä¸ºä½ æœåŠ¡ç«¯çš„ç‰©ç†ç½‘å¡åã€‚</p> 
 <pre class="has"><code class="language-go">PreUp = iptables -t nat -A POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE</code></pre> 
 <p>è¿™æ¡ iptables è§„åˆ™è¡¨ç¤ºå¯¹æ¥è‡ªÂ <code>192.168.200.2</code>ï¼ˆTUN ç½‘å¡ï¼‰ çš„å‡ºç«™æµé‡è¿›è¡Œ MASQUERADEã€‚</p> 
 <pre class="has"><code class="language-go">PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4567 --remote 121.36.134.95:4567 &amp;&gt; /var/log/phantun_client.log &amp;</code></pre> 
 <p>è¿™é‡Œä¼šå¯åŠ¨ phantun_clientï¼Œç›‘å¬åœ¨Â <code>4567</code>Â ç«¯å£ï¼Œå¹¶ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼Œå°†ä¼ªè£…çš„ TCP æ•°æ®åŒ…ä¼ é€ç»™æœåŠ¡ç«¯ã€‚</p> 
 <p>é™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦ä¿®æ”¹ WireGuard peer çš„ Endpointï¼Œå°†å…¶ä¿®æ”¹ä¸º 127.0.0.1:4567ã€‚</p> 
 <pre class="has"><code class="language-go">Endpoint = 127.0.0.1:4567</code></pre> 
 <p>å®¢æˆ·ç«¯å®Œæ•´çš„ WireGuard é…ç½®ï¼š</p> 
 <pre class="has"><code class="language-go"># local settings for Endpoint A
[Interface]
PrivateKey = 0Pyz3cIg2gRt+KxZ0Vm1PvSIU+0FGufPIzv92jTyGWk=
Address = 10.0.0.1/32
ListenPort = 51821
MTU = 1300
PreUp = iptables -t nat -A POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4567 --remote 121.36.134.95:4567 &amp;&gt; /var/log/phantun_client.log &amp;
PostDown = iptables -t nat -D POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PostDown = killall phantun_client || true

# remote settings for Endpoint B
[Peer]
PublicKey = m40NDb5Cqtb78b1DVwY1+kxbG2yEcRhxlrLm/DlPpz8=
Endpoint = 127.0.0.1:4567
AllowedIPs = 10.0.0.2/32
PersistentKeepalive = 25</code></pre> 
 <p>æœ€åé‡å¯ WireGuard å³å¯ï¼š</p> 
 <pre class="has"><code class="language-go">$Â systemctlÂ restartÂ wg-quick@wg0</code></pre> 
 <p>æŸ¥çœ‹ phantun_client çš„æ—¥å¿—ï¼š</p> 
 <pre class="has"><code class="language-go">$Â tailÂ -fÂ /var/log/phantun_client.log
Â INFOÂ Â clientÂ &gt;Â RemoteÂ addressÂ is:Â 121.36.134.95:4567
Â INFOÂ Â clientÂ &gt;Â 1Â coresÂ available
Â INFOÂ Â clientÂ &gt;Â CreatedÂ TUNÂ deviceÂ tun0
Â INFOÂ Â clientÂ &gt;Â NewÂ UDPÂ clientÂ fromÂ 127.0.0.1:51821
Â INFOÂ Â fake_tcpÂ &gt;Â SentÂ SYNÂ toÂ server
Â INFOÂ Â fake_tcpÂ &gt;Â ConnectionÂ toÂ 121.36.134.95:4567Â established</code></pre> 
 <p>æŸ¥çœ‹ wg0 æ¥å£ï¼š</p> 
 <pre class="has"><code class="language-go">$Â wgÂ showÂ wg0
interface:Â wg0
Â Â publicÂ key:Â wXtD/VrRo92JHc66q4Ypmnd4JpMk7b1Sb0AcT+pJfwY=
Â Â privateÂ key:Â (hidden)
Â Â listeningÂ port:Â 51821

peer:Â m40NDb5Cqtb78b1DVwY1+kxbG2yEcRhxlrLm/DlPpz8=
Â Â endpoint:Â 127.0.0.1:4567
Â Â allowedÂ ips:Â 10.0.0.2/32
Â Â latestÂ handshake:Â 1Â minute,Â 57Â secondsÂ ago
Â Â transfer:Â 184Â BÂ received,Â 648Â BÂ sent
Â Â persistentÂ keepalive:Â everyÂ 25Â seconds</code></pre> 
 <p>æµ‹è¯•è¿é€šæ€§ï¼š</p> 
 <pre class="has"><code class="language-go">$Â pingÂ 10.0.0.2Â -cÂ 3
PINGÂ 10.0.0.2Â (10.0.0.2)Â 56(84)Â bytesÂ ofÂ data.
64Â bytesÂ fromÂ 10.0.0.2:Â icmp_seq=1Â ttl=64Â time=13.7Â ms
64Â bytesÂ fromÂ 10.0.0.2:Â icmp_seq=2Â ttl=64Â time=14.4Â ms
64Â bytesÂ fromÂ 10.0.0.2:Â icmp_seq=3Â ttl=64Â time=15.0Â ms

---Â 10.0.0.2Â pingÂ statisticsÂ ---
3Â packetsÂ transmitted,Â 3Â received,Â 0%Â packetÂ loss,Â timeÂ 2005ms
rttÂ min/avg/max/mdevÂ =Â 13.718/14.373/15.047/0.542Â ms</code></pre> 
 <h4>å®¢æˆ·ç«¯ï¼ˆå¤šæœåŠ¡ç«¯ï¼‰</h4> 
 <p>å¦‚æœå®¢æˆ·ç«¯æƒ³å’Œå¤šä¸ªæœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼Œåˆ™æ–°å¢çš„æœåŠ¡ç«¯é…ç½®å¦‚ä¸‹ï¼š</p> 
 <pre class="has"><code class="language-go">PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4568 --remote xxxx:4567 --tun-local=192.168.202.1 --tun-peer=192.168.202.2 &amp;&gt; /var/log/phantun_client.log &amp;
PostDown = iptables -t nat -D POSTROUTING -o eth0 -s 192.168.202.2 -j MASQUERADE</code></pre> 
 <p>æœ¬åœ°ç›‘å¬ç«¯å£éœ€è¦é€‰æ‹©ä¸€ä¸ªä¸ä¹‹å‰ä¸åŒçš„ç«¯å£ï¼ŒåŒç†ï¼ŒTUN ç½‘å¡çš„åœ°å€ä¹Ÿéœ€è¦ä¿®æ”¹ã€‚æœ€ç»ˆçš„é…ç½®å¦‚ä¸‹ï¼š</p> 
 <pre class="has"><code class="language-go"># local settings for Endpoint A
[Interface]
PrivateKey = 0Pyz3cIg2gRt+KxZ0Vm1PvSIU+0FGufPIzv92jTyGWk=
Address = 10.0.0.1/32
ListenPort = 51821
MTU = 1300
PreUp = iptables -t nat -A POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4567 --remote 121.36.134.95:4567 &amp;&gt; /var/log/phantun_client.log &amp;
PreUp = RUST_LOG=info phantun_client --local 127.0.0.1:4568 --remote xxxx:4567 --tun-local=192.168.202.1 --tun-peer=192.168.202.2 &amp;&gt; /var/log/phantun_client.log &amp;
PostDown = iptables -t nat -D POSTROUTING -o eth0 -s 192.168.200.2 -j MASQUERADE
PostDown = iptables -t nat -D POSTROUTING -o eth0 -s 192.168.202.2 -j MASQUERADE
PostDown = killall phantun_client || true

# remote settings for Endpoint B
[Peer]
PublicKey = m40NDb5Cqtb78b1DVwY1+kxbG2yEcRhxlrLm/DlPpz8=
Endpoint = 127.0.0.1:4567
AllowedIPs = 10.0.0.2/32
PersistentKeepalive = 25</code></pre> 
 <h3>MTU è°ƒä¼˜</h3> 
 <p>å¦‚æœä½ ä½¿ç”¨ ping æˆ–è€… dig ç­‰å·¥å…·ï¼ˆå°æ•°æ®åŒ…ï¼‰æµ‹è¯• WireGuard éš§é“èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½†æµè§ˆå™¨æˆ–è€…è¿œç¨‹æ¡Œé¢ï¼ˆå¤§æ•°æ®åŒ…ï¼‰å´æ— æ³•æ­£å¸¸è®¿é—®ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ MTU çš„é—®é¢˜ï¼Œä½ éœ€è¦å°† MTU çš„å€¼è°ƒå°ä¸€ç‚¹ã€‚</p> 
 <p>Phantun å®˜æ–¹å»ºè®®å°† MTU çš„å€¼è®¾ä¸ºÂ <code>1428</code>ï¼ˆå‡è®¾ç‰©ç†ç½‘å¡çš„ MTU æ˜¯ 1500ï¼‰ï¼Œä½†ç»æˆ‘æµ‹è¯•æ˜¯æœ‰é—®é¢˜çš„ã€‚å»ºè®®ç›´æ¥å°† MTU è®¾ç½®ä¸ºæœ€ä½å€¼Â <code>1280</code>ï¼Œç„¶åæ¸æ¸å¢åŠ ï¼Œç›´åˆ°æ— æ³•æ­£å¸¸å·¥ä½œä¸ºæ­¢ï¼Œæ­¤æ—¶ä½ çš„ MTU å°±æ˜¯æœ€ä½³å€¼ã€‚</p> 
 <p><strong>ä½ å­¦åºŸäº†å—ï¼Ÿ</strong></p> 
 <h3>å‚è€ƒèµ„æ–™</h3> 
 <ul><li><p style="text-align:left;">Phantun - Rust å†™çš„è½»é‡çº§ UDP -&gt; TCP æ··æ·†å™¨<sup>[4]</sup></p></li><li><p style="text-align:left;">Phantun GitHub Repo<sup>[5]</sup></p></li></ul> 
 <h4>å¼•ç”¨é“¾æ¥</h4> 
 <p>[1]</p> 
 <p>udp2raw:Â <em>https://github.com/wangyu-/udp2raw-tunnel</em></p> 
 [2] 
 <p>Phantun:Â <em>https://github.com/dndx/phantun</em></p> 
 [3] 
 <p>release é¡µé¢:Â <em>https://github.com/dndx/phantun/releases</em></p> 
 [4] 
 <p>Phantun - Rust å†™çš„è½»é‡çº§ UDP -&gt; TCP æ··æ·†å™¨:Â <em>https://www.v2ex.com/t/802949</em></p> 
 [5] 
 <p>Phantun GitHub Repo:Â <em>https://github.com/dndx/phantun<br><br></em></p> 
 <blockquote> 
  <p>æœ¬æ–‡è½¬è½½è‡ªï¼šã€Œäº‘åŸç”Ÿå®éªŒå®¤Â ã€ï¼ŒåŸæ–‡ï¼šhttps://url.hi-linux.com/L6lzwï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æ¬¢è¿æŠ•ç¨¿ï¼ŒæŠ•ç¨¿é‚®ç®±: editor@hi-linux.comã€‚</p> 
 </blockquote> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/b3/c1/TDCkrjzc_o.gif" alt="f48111cb2c9887d664b761d8c36a61b3.gif"><br><br></p> 
 <p>æœ€è¿‘ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª<strong>æŠ€æœ¯äº¤æµå¾®ä¿¡ç¾¤</strong>ã€‚ç›®å‰ç¾¤é‡Œå·²åŠ å…¥äº†ä¸å°‘è¡Œä¸šå†…çš„å¤§ç¥ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åŠ å…¥å’Œæˆ‘ä»¬ä¸€èµ·äº¤æµæŠ€æœ¯ï¼Œåœ¨ <strong>ã€Œå¥‡å¦™çš„ Linux ä¸–ç•Œã€</strong> å…¬ä¼—å·ç›´æ¥å›å¤ <strong>ã€ŒåŠ ç¾¤ã€</strong> é‚€è¯·ä½ å…¥ç¾¤ã€‚<br><br></p> 
 <p style="text-align:center;"><img title="" src="https://images2.imgbox.com/0f/e7/JgC5u1ji_o.png" alt="d6721e772cc7f320b29473125eaf9ccd.png"></p> 
 <p style="text-align:center;"><strong>ä½ å¯èƒ½è¿˜å–œæ¬¢</strong></p> 
 <p style="text-align:center;">ç‚¹å‡»ä¸‹æ–¹å›¾ç‰‡å³å¯é˜…è¯»<br><br></p> 
 <p style="text-align:center;"><a href="" rel="nofollow"><img src="https://images2.imgbox.com/9d/2e/J5pIxKa3_o.png" alt="58ed8ae5ce52f044db98e42c591ba50a.png"></a></p> 
 <p style="text-align:center;">å¦‚ä½•é€šè¿‡ç»ˆç«¯å¿«é€Ÿè®¿é—® Kubernetes èŠ‚ç‚¹ Shell çš„ Root ç¯å¢ƒ (æ— éœ€ SSH æƒé™ )<br><br><a href="" rel="nofollow"><img src="https://images2.imgbox.com/fa/13/4jNQ6yTg_o.png" alt="e9f618152478f37818fd397ccde7e43e.png"></a><br>ç‚¹å‡»ä¸Šæ–¹å›¾ç‰‡ï¼Œã€ç¾å›¢|é¥¿äº†ä¹ˆã€å¤–å–çº¢åŒ…å¤©å¤©å…è´¹é¢†<br><br></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/96/de/dbv6dG25_o.png" alt="d0ae0a7ca2d3cb208da9265cb31a680a.png"></p> 
 <p style="text-align:center;">æ›´å¤šæœ‰è¶£çš„äº’è”ç½‘æ–°é²œäº‹ï¼Œå…³æ³¨ã€Œå¥‡å¦™çš„äº’è”ç½‘ã€è§†é¢‘å·å…¨äº†è§£ï¼<br></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f871714079f67f500074f2df0063e67/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">arcgis pro3.0å®‰è£…</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/146fa4dbe23d7a852c1afc18cfa0ade7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">æ¶ˆæ¯è¿å‘ä»£ç </p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>