<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AttributeError: &#39;NoneType&#39; object has no attribute &#39;find_all&#39;(添加请求头信息) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AttributeError: &#39;NoneType&#39; object has no attribute &#39;find_all&#39;(添加请求头信息)" />
<meta property="og:description" content="今日份遇到错误的解决记录：
今天爬取豆瓣Top250个电影的时候，写好代码却报了这个错，一开始认为列表上用了find()方法，换成find_all（）之后还是不行，换了别的标签也不行，于是使用print(html.text)想的把解析之后的网页代码输出看看，结果啥都没有，连源代码都是空的什么都不输出！！！！
最后想查看一下获取网页源码状态：print(res.status_code)
发现了问题所在，一般源码获取成功的话执行状态码是200，这次却是418！！！
于是查了一下418是代表什么：
执行状态码：418解释（找到了一个介绍比较详细的博客）
原来这里的418是网页服务器的反爬虫程序返回的，意思就我们被该网页服务器的反爬虫程序发现了，并禁止我们爬取，所以下一步就是需要我们模拟浏览器，重新给服务器发送请求，并且添加头等信息headers，headers是解决requests请求反爬的方法之一，相当于我们进去这个网页的服务器本身，假装自己本身在爬取数据。对反爬虫网页，可以设置一些headers信息，模拟成浏览器取访问网站 。
下一步获取并添加这个headers信息：
找到了一个写的超详细的博客【点击字体即可查看】
获取headers信息的步骤：
第一步：找到headers
第二步：找到这个信息之后，把信息添加到代码里面
import requests from bs4 import BeautifulSoup headers = { &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36&#39;} href=&#39;https://movie.douban.com/top250?start=&#39;&#43;str((i-1)*25)&#43;&#39;&amp;filter=&#39;#网页链接URL res=requests.get(href,headers=headers) #头等信息 html=res.text soup=BeautifulSoup(html,&#39;html.parser&#39;) #解析网页代码 添加进去头信息之后就解决了禁止爬取的问题了。
我的完整代码：
import requests from bs4 import BeautifulSoup headers = { &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36&#39;} for i in range(1,11): #因为一页只有25个电影简介，所以需要10页 href=&#39;https://movie." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6e621a620a6f1c5170db4869df1d1d0a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-19T00:20:35+08:00" />
<meta property="article:modified_time" content="2020-03-19T00:20:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AttributeError: &#39;NoneType&#39; object has no attribute &#39;find_all&#39;(添加请求头信息)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>今日份遇到错误的解决记录：<br> 今天爬取豆瓣Top250个电影的时候，写好代码却报了这个错，一开始认为列表上用了find()方法，换成find_all（）之后还是不行，换了别的标签也不行，于是使用<code>print(html.text)</code>想的把解析之后的网页代码输出看看，结果啥都没有，连源代码都是空的什么都不输出！！！！</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/6a/82/FbbB5ssb_o.png"></p> 
<p>最后想查看一下获取网页源码状态：<code>print(res.status_code)</code><br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/cd/f2/njbH84n6_o.png"><br> 发现了问题所在，一般源码获取成功的话执行状态码是200，这次却是<code>418</code>！！！<br> 于是查了一下418是代表什么：</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f5/f6/cMu7Bg69_o.png"><br> <a href="https://blog.csdn.net/qq_41101213/article/details/104693780?fps=1&amp;locationNum=2">执行状态码：418解释（找到了一个介绍比较详细的博客）</a></p> 
<p><font color="blue">原来这里的418是网页服务器的反爬虫程序返回的，意思就我们被该网页服务器的反爬虫程序发现了，并禁止我们爬取，所以下一步就是需要我们模拟浏览器，重新给服务器发送请求，并且添加头等信息headers</font>，<font color="red">headers是解决requests请求反爬的方法之一，相当于我们进去这个网页的服务器本身，假装自己本身在爬取数据。对反爬虫网页，可以设置一些headers信息，模拟成浏览器取访问网站 。</font></p> 
<p><font color="green" size="6">下一步获取并添加这个headers信息：</font></p> 
<p><a href="https://blog.csdn.net/ysblogs/article/details/88530124">找到了一个写的超详细的博客【点击字体即可查看】</a></p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b3/af/avuCcCjR_o.png"></p> 
<p><font color="green" size="6">获取headers信息的步骤：</font></p> 
<p>第一步：找到headers</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/fe/6f/lyYeBZvB_o.png">第二步：找到这个信息之后，把信息添加到代码里面</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36'</span><span class="token punctuation">}</span>
href<span class="token operator">=</span><span class="token string">'https://movie.douban.com/top250?start='</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'&amp;filter='</span><span class="token comment">#网页链接URL</span>
res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>href<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment">#头等信息</span>
html<span class="token operator">=</span>res<span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> <span class="token comment">#解析网页代码</span></code></pre> 
<p>添加进去头信息之后就解决了禁止爬取的问题了。</p> 
<p>我的完整代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36'</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#因为一页只有25个电影简介，所以需要10页</span>
    href<span class="token operator">=</span><span class="token string">'https://movie.douban.com/top250?start='</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'&amp;filter='</span>
    res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>href<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token comment">#头等信息</span>
    html<span class="token operator">=</span>res<span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> <span class="token comment">#解析网页代码</span>
    <span class="token comment">#需要爬取 序号，电影名，评分，推荐语，链接</span>
    movies<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ol'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'grid_view'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
        movie_num<span class="token operator">=</span>movie<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'pic'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span> <span class="token comment">#电影序号</span>
        movie_name<span class="token operator">=</span>movie<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'title'</span><span class="token punctuation">)</span> <span class="token comment">#电影名称</span>
        movie_star<span class="token operator">=</span>movie<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'star'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'rating_num'</span><span class="token punctuation">)</span> <span class="token comment">#电影评分</span>
        movie_recommend<span class="token operator">=</span>movie<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'quote'</span><span class="token punctuation">)</span> <span class="token comment">#电影推荐语</span>
        movie_href<span class="token operator">=</span>movie<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'pic'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment">#电影链接 movie_href['href']</span>
        <span class="token keyword">if</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>movie_name<span class="token punctuation">,</span>movie_href<span class="token punctuation">,</span>movie_num<span class="token punctuation">,</span>movie_star<span class="token punctuation">,</span>movie_recommend<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#表示都不为空</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'排行第'</span><span class="token operator">+</span>movie_num<span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token string">'的电影:'</span><span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'电影名：'</span><span class="token operator">+</span>movie_name<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\t'</span><span class="token operator">+</span><span class="token string">'评分：'</span><span class="token operator">+</span>movie_star<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'推荐语：'</span><span class="token operator">+</span>movie_recommend<span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'链接：'</span><span class="token operator">+</span>movie_href<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token operator">+</span><span class="token string">'******************************'</span><span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span></code></pre> 
<p><code>#注释</code>：</p> 
<ol><li>获取Top250的时候豆瓣上写用10也显示的，这10页链接是有规律的（n-1）*25</li><li>当爬取到第245个电影的时候，该电影推荐语是空的，啥都没有，这时候又报了上述错误，就是空类型没有text方法<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/32/3a/7cpjyTGn_o.png"></li><li>这个时候就需要添加判断语句if，同时判断几个元素的方法<a href="https://www.colabug.com/2020/0222/7028890/amp/" rel="nofollow">https://www.colabug.com/2020/0222/7028890/amp/</a>找到了这个博客，里面有超详细的介绍<code>if all([movie_name,movie_href,movie_num,movie_star,movie_recommend]): #表示都不为空</code></li></ol> 
<p>运行结果：<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/a0/91/c41VE4BZ_o.png"></p> 
<p>最后所有问题都解决了，欧耶！！！！！</p> 
<p>作为初学python爬虫的菜鸟，以上问题解决真的花了我很长时间，真的！！！！不过真的学到了东西 ， 手动比心</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53bea458b2e886c4aec18f258620fe12/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Lua学习笔记——异常处理pcall、xpcall</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5d225e78d387cbfd574b7efcb78dbd17/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">广域网互联技术</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>