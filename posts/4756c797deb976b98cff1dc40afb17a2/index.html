<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu18.04实现bmask rcnn代码 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu18.04实现bmask rcnn代码" />
<meta property="og:description" content="Ubuntu18.04实现bmask rcnn 配置环境 cuda 11.1
cudnn
cudatoolkit 11.1.1
python 3.8 刚开始使用的是3.6，但是在安装torch1.9版本的时候冲突，需要python3.7及以上，所以直接安装了3.8
torch 1.9.0&#43;cu111
torchaudio 0.9.0
torchvision 0.10.0&#43;cu111
（选用 torch1.9是因为torch1.8和bmask rcnn使用的框架detectron2冲突，会出现错误RuntimeError: radix_sort: failed on 1st step: cudaErrorInvalidDevice: invalid device ordinal）
// 创建环境 conda create --name detectron2 python==3.8 //下载cudatoolkit，在base环境中安装过了cuda和cudnn,这里没有安装也可使用 conda activate detectron2 conda install -c anaconda cudatoolkit=11.1.1 //安装totch等 pip install torch==1.9.0&#43;cu111 torchvision==0.10.0&#43;cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html //安装detectron2 pip install fvcore pip install cython pip install pycocotools python -m pip install detectron2 -f https://dl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4756c797deb976b98cff1dc40afb17a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-23T16:15:05+08:00" />
<meta property="article:modified_time" content="2023-11-23T16:15:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu18.04实现bmask rcnn代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Ubuntu1804bmask_rcnn_0"></a>Ubuntu18.04实现bmask rcnn</h2> 
<h3><a id="_2"></a>配置环境</h3> 
<p>cuda 11.1<br> cudnn<br> cudatoolkit 11.1.1<br> python <strong>3.8</strong> <em>刚开始使用的是3.6，但是在安装torch1.9版本的时候冲突，需要python3.7及以上，所以直接安装了3.8</em><br> <mark>torch 1.9.0+cu111</mark><br> <mark>torchaudio 0.9.0</mark><br> <mark>torchvision 0.10.0+cu111</mark><br> （选用 torch1.9是因为torch1.8和bmask rcnn使用的框架detectron2冲突，会出现错误RuntimeError: radix_sort: failed on 1st step: cudaErrorInvalidDevice: invalid device ordinal）</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 创建环境</span>
conda create <span class="token operator">--</span>name detectron2 python<span class="token operator">==</span><span class="token number">3.8</span>
<span class="token comment">//下载cudatoolkit，在base环境中安装过了cuda和cudnn,这里没有安装也可使用</span>
conda activate detectron2
conda install <span class="token operator">-</span>c anaconda cudatoolkit<span class="token operator">=</span><span class="token number">11.1</span><span class="token number">.1</span>
<span class="token comment">//安装totch等</span>
pip install torch<span class="token operator">==</span><span class="token number">1.9</span><span class="token number">.0</span><span class="token operator">+</span>cu111 torchvision<span class="token operator">==</span><span class="token number">0.10</span><span class="token number">.0</span><span class="token operator">+</span>cu111 torchaudio<span class="token operator">==</span><span class="token number">0.9</span><span class="token number">.0</span> <span class="token operator">-</span>f https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>pytorch<span class="token punctuation">.</span>org<span class="token operator">/</span>whl<span class="token operator">/</span>torch_stable<span class="token punctuation">.</span>html
<span class="token comment">//安装detectron2</span>
 pip install fvcore
 pip install cython
 pip install pycocotools
 python <span class="token operator">-</span>m pip install detectron2 <span class="token operator">-</span>f   https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dl<span class="token punctuation">.</span>fbaipublicfiles<span class="token punctuation">.</span>com<span class="token operator">/</span>detectron2<span class="token operator">/</span>wheels<span class="token operator">/</span>cu111<span class="token operator">/</span>torch1<span class="token punctuation">.</span><span class="token number">9</span><span class="token operator">/</span>index<span class="token punctuation">.</span>html
  <span class="token comment">//最容易安装的一句话，和版本也对着，直接安装成功</span>
  <span class="token comment">//开始运行</span>
cd projects<span class="token operator">/</span>BMaskR<span class="token operator">-</span><span class="token constant">CNN</span>
python train_net<span class="token punctuation">.</span>py <span class="token operator">--</span>config<span class="token operator">-</span>file configs<span class="token operator">/</span>bmask_rcnn_R_50_FPN_1x<span class="token punctuation">.</span>yaml <span class="token operator">--</span>num<span class="token operator">-</span>gpus <span class="token number">1</span>
<span class="token comment">//看自己的GPU有几个，直接写就行</span>
</code></pre> 
<p>到这里大概率有点小错误，都是一些版本太高，不匹配的问题。<br> 1.AttributeError: module ‘numpy‘ has no attribute ‘bool‘.<br> 降低版本</p> 
<pre><code class="prism language-javascript">pip uninstall numpy
pip install numpy<span class="token operator">==</span><span class="token number">1.19</span><span class="token number">.2</span>
</code></pre> 
<p>2.安装opencv-python</p> 
<pre><code class="prism language-javascript">pip install opencv<span class="token operator">-</span>python
</code></pre> 
<p>3.AttributeError: module ‘PIL.Image’ has no attribute ‘LINEAR’.降低pillow版本</p> 
<pre><code class="prism language-javascript">pip uninstall pillow
pip install pillow<span class="token operator">==</span><span class="token number">8.4</span><span class="token number">.0</span>
</code></pre> 
<p>4.AttributeError: module ‘distutils‘ has no attribute ‘version‘，<br> 修改了这个函数，4，6，7，10加了注释，就可以了</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> tensorboard
from setuptools <span class="token keyword">import</span> distutils

#LooseVersion <span class="token operator">=</span> distutils<span class="token punctuation">.</span>version<span class="token punctuation">.</span>LooseVersion

#<span class="token keyword">if</span> not <span class="token function">hasattr</span><span class="token punctuation">(</span>tensorboard<span class="token punctuation">,</span> <span class="token string">'__version__'</span><span class="token punctuation">)</span> or <span class="token function">LooseVersion</span><span class="token punctuation">(</span>tensorboard<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">LooseVersion</span><span class="token punctuation">(</span><span class="token string">'1.15'</span><span class="token punctuation">)</span><span class="token operator">:</span>
#    raise <span class="token function">ImportError</span><span class="token punctuation">(</span><span class="token string">'TensorBoard logging requires TensorBoard version 1.15 or above'</span><span class="token punctuation">)</span>

del distutils
#del LooseVersion
del tensorboard

from <span class="token punctuation">.</span>writer <span class="token keyword">import</span> FileWriter<span class="token punctuation">,</span> SummaryWriter  # noqa<span class="token operator">:</span> <span class="token constant">F401</span>
from tensorboard<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>writer<span class="token punctuation">.</span>record_writer <span class="token keyword">import</span> RecordWriter  # noqa<span class="token operator">:</span> <span class="token constant">F401</span>
</code></pre> 
<p>5.FloatingPointError: Predicted boxes or scores contain Inf/Nan. Training has diverged.<br> 还有GPU内存不够的问题。</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">_BASE_</span><span class="token operator">:</span> Base<span class="token operator">-</span>BMask<span class="token operator">-</span><span class="token constant">R</span><span class="token operator">-</span><span class="token constant">CNN</span><span class="token operator">-</span><span class="token constant">FPN</span><span class="token punctuation">.</span>yaml
<span class="token constant">MODEL</span><span class="token operator">:</span>
  <span class="token constant">WEIGHTS</span><span class="token operator">:</span> detectron2<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ImageNetPretrained<span class="token operator">/</span><span class="token constant">MSRA</span><span class="token operator">/</span><span class="token constant">R</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">.</span>pkl
  <span class="token constant">MASK_ON</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token constant">RESNETS</span><span class="token operator">:</span>
    <span class="token constant">DEPTH</span><span class="token operator">:</span> <span class="token number">50</span>
<span class="token constant">INPUT</span><span class="token operator">:</span>
  <span class="token constant">MIN_SIZE_TRAIN</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token constant">TEST</span><span class="token operator">:</span>
  <span class="token constant">EVAL_PERIOD</span><span class="token operator">:</span> <span class="token number">10000</span>
<span class="token constant">DATASETS</span><span class="token operator">:</span>
  <span class="token constant">TRAIN</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"coco_2017_train"</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
  <span class="token constant">TEST</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"coco_2017_val"</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token constant">SOLVER</span><span class="token operator">:</span>
  #<span class="token constant">IMS_PER_BATCH</span><span class="token operator">:</span> <span class="token number">16</span>
  <span class="token constant">IMS_PER_BATCH</span><span class="token operator">:</span> <span class="token number">4</span>
  #<span class="token constant">BASE_LR</span><span class="token operator">:</span> <span class="token number">0.02</span>
  <span class="token constant">BASE_LR</span><span class="token operator">:</span> <span class="token number">0.001</span>
  <span class="token constant">STEPS</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">,</span> <span class="token number">80000</span><span class="token punctuation">)</span>
  <span class="token constant">MAX_ITER</span><span class="token operator">:</span> <span class="token number">90000</span>
<span class="token constant">OUTPUT_DIR</span><span class="token operator">:</span> <span class="token string">"output/bmask_rcnn_r50_1x"</span>
</code></pre> 
<p>主要修改IMS_PER_BATCH: 4， BASE_LR: 0.001</p> 
<p>好啦，到这里就配置完成了环境，再次运行语句，就可以成功运行了，一般来说，出现问题都是环境没有配置好，要认真检查。<br> 下面是一张成功运行的截图<br> <img src="https://images2.imgbox.com/57/a3/yBI9tLdu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="COCO_94"></a>COCO数据集下载链接，巨快！</h3> 
<p>https://aistudio.baidu.com/datasetdetail/7122<br> 下载后保存的格式如下<br> <img src="https://images2.imgbox.com/aa/d0/YxTMGLmq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e364825bebca6443559c0beb6336dab6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【分享】Java Builder 建造者模式之案例分享</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3e9cb3d7a9cef2638ea042cc9f4774f8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python pymodbus库使用教程（以Modbus RTU为例）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>