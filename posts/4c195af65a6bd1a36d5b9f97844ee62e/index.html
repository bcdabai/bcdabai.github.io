<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DNS域名查询过程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DNS域名查询过程" />
<meta property="og:description" content="目录
DNS（Domain Names System）
域名转IP
IP转域名 域名
域名查询流程
浏览器DNS缓存
操作系统缓存
本地host文件
完整流程
递归查询
迭代查询
DNS（Domain Names System） 域名系统，将域名和 IP 地址进行转换的服务器。
域名转IP 在命令行中通过nslookup &#43; 域名可以查看域名解析到ip
也可以在Chrome浏览器中chrome://net-internals/?#dns去输入域名查看ip IP转域名 nslookup -qt=ptr ip地址，可以查看ip到域名的解析
域名 url链接由协议&#43;主机&#43;端口&#43;路径组成，其中主机对应的部分为域名。域名组成是先写低级域名再写高级域名。
域名查询流程 1.查询浏览器的DNS缓存。（Chrome浏览器对每个域名会默认缓存60s，具体查看得通过网络日志查看）
浏览器DNS缓存 https://www.cnblogs.com/hls-code/p/17124489.html
2.查询操作系统DNS缓存
操作系统缓存 命令行中通过ipconfig/displaydns查看。
3.本地host文件
本地host文件 4.查询路由器DNS缓存（本地域名服务器）
5.迭代查询上级域名服务器，直到返回正确ip。
完整流程 1. 客户端发起一个DNS请求，先查看本地浏览器是否有这个域名的缓存，有解析结束
2. 没有则去看操作系统是否有缓存，有解析结束
3. 没有则去看本地host文件，有解析结束
4. 没有则发送该请求到本地DNS服务器，本地域名服务器采用递归查询自己的 DNS 缓存，如果本地DNS服务器存在则返回
5. 不存在本地DNS服务器则请求根域名服务器，比如请求&#34;www.baidu.com&#34;，根域名服务器告诉本地DNS “.com” 顶级域名服务器的位置
6. 本地DNS服务器收到顶级域名服务器位置后则向顶级域名服务器请求&#34;www.baidu.com&#34;的IP地址，顶级域名服务器收到后则告诉本地DNS服务器&#34;www.baidu.com&#34;的权威域名服务器地址
7. 本地DNS服务器再向权威DNS服务器发起请求，权威DNS服务器查询后将对应的IP地址告诉本地DNS
8. 本地DNS服务器缓存该域名与对应IP然后返回IP给客户端
9. 浏览器根据TTL缓存该值
1-4为递归查询，5-7为迭代查询
递归查询 转发器将相应的查询结果返回至本地DNS服务器192.168.16.1，本地DNS服务器将查询结果返回至主机，最终得出http://qq.com的ns记录。因为本地DNS服务器不是http://qq.com的授权解析服务器，所以查询得出的结果是非权威应答。
递归的意思是：只需要发出一次请求，就能得到相应的结果。比如主机-本地DNS、本地DNS-转发器，都是递归查询。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4c195af65a6bd1a36d5b9f97844ee62e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T14:44:54+08:00" />
<meta property="article:modified_time" content="2023-12-31T14:44:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DNS域名查询过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="DNS%EF%BC%88Domain%20Names%20System%EF%BC%89-toc" style="margin-left:0px;"><a href="#DNS%EF%BC%88Domain%20Names%20System%EF%BC%89" rel="nofollow">DNS（Domain Names System）</a></p> 
<p id="%E5%9F%9F%E5%90%8D%E8%BD%ACIP-toc" style="margin-left:80px;"><a href="#%E5%9F%9F%E5%90%8D%E8%BD%ACIP" rel="nofollow">域名转IP</a></p> 
<p id="IP%E8%BD%AC%E5%9F%9F%E5%90%8D%C2%A0-toc" style="margin-left:80px;"><a href="#IP%E8%BD%AC%E5%9F%9F%E5%90%8D%C2%A0" rel="nofollow">IP转域名 </a></p> 
<p id="%E5%9F%9F%E5%90%8D-toc" style="margin-left:0px;"><a href="#%E5%9F%9F%E5%90%8D" rel="nofollow">域名</a></p> 
<p id="%E5%9F%9F%E5%90%8D%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B-toc" style="margin-left:0px;"><a href="#%E5%9F%9F%E5%90%8D%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B" rel="nofollow">域名查询流程</a></p> 
<p id="%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98-toc" style="margin-left:40px;"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98" rel="nofollow">浏览器DNS缓存</a></p> 
<p id="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98-toc" style="margin-left:40px;"><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98" rel="nofollow">操作系统缓存</a></p> 
<p id="%E6%9C%AC%E5%9C%B0host%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E6%9C%AC%E5%9C%B0host%E6%96%87%E4%BB%B6" rel="nofollow">本地host文件</a></p> 
<p id="%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B" rel="nofollow">完整流程</a></p> 
<p id="%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2" rel="nofollow">递归查询</a></p> 
<p id="%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2" rel="nofollow">迭代查询</a></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="DNS%EF%BC%88Domain%20Names%20System%EF%BC%89">DNS（Domain Names System）</h2> 
<p>域名系统，将域名和 IP 地址进行转换的服务器。</p> 
<h4 id="%E5%9F%9F%E5%90%8D%E8%BD%ACIP">域名转IP</h4> 
<p>在命令行中通过<span style="color:#fe2c24;"><strong>nslookup</strong> </span>+ 域名可以查看域名解析到ip</p> 
<p><img alt="" height="140" src="https://images2.imgbox.com/b0/c8/Yz8yM5FF_o.png" width="378"></p> 
<p>也可以在Chrome浏览器中<span style="color:#fe2c24;"><strong>chrome://net-internals/?#dns</strong></span>去输入域名查看ip </p> 
<p><img alt="" height="282" src="https://images2.imgbox.com/8c/38/c3mq46Da_o.png" width="635"></p> 
<h4 id="IP%E8%BD%AC%E5%9F%9F%E5%90%8D%C2%A0">IP转域名 </h4> 
<p> <span style="color:#fe2c24;"><strong>nslookup -qt=ptr </strong></span>ip地址，可以查看ip到域名的解析</p> 
<p><img alt="" height="308" src="https://images2.imgbox.com/5e/2a/jQMsU1R0_o.png" width="468"></p> 
<p></p> 
<h2 id="%E5%9F%9F%E5%90%8D">域名</h2> 
<p>url链接由协议+主机+端口+路径组成，其中主机对应的部分为域名。域名组成是先写低级域名再写高级域名。</p> 
<p><img alt="" height="297" src="https://images2.imgbox.com/94/b7/NdOSlogg_o.png" width="621"></p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/f0/c1/rFaPncgs_o.png" width="1033"></p> 
<p></p> 
<h2 id="%E5%9F%9F%E5%90%8D%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B">域名查询流程</h2> 
<p><img alt="" height="208" src="https://images2.imgbox.com/16/5a/LXvIkVc0_o.png" width="663"></p> 
<p>1.查询<span style="color:#fe2c24;"><strong>浏览器的DNS缓存</strong></span>。（Chrome浏览器对每个域名会默认缓存60s，具体查看得通过网络日志查看）</p> 
<p></p> 
<h3 id="%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98">浏览器DNS缓存</h3> 
<p><a href="https://www.cnblogs.com/hls-code/p/17124489.html" rel="nofollow" title="https://www.cnblogs.com/hls-code/p/17124489.html">https://www.cnblogs.com/hls-code/p/17124489.html</a></p> 
<p>2.查询<span style="color:#fe2c24;"><strong>操作系统DNS缓存</strong></span></p> 
<p></p> 
<h3 id="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98">操作系统缓存</h3> 
<p>命令行中通过ipconfig/displaydns查看。</p> 
<p><img alt="" height="329" src="https://images2.imgbox.com/3d/51/iQCP7nI6_o.png" width="558"></p> 
<p>3.<span style="color:#fe2c24;"><strong>本地host文件</strong></span></p> 
<h3 id="%E6%9C%AC%E5%9C%B0host%E6%96%87%E4%BB%B6">本地host文件</h3> 
<p><img alt="" height="254" src="https://images2.imgbox.com/a8/59/5nn4Wl0d_o.png" width="936"></p> 
<p>4.查询<span style="color:#fe2c24;"><strong>路由器DNS缓存（本地域名服务器）</strong></span></p> 
<p>5.迭代查询上级域名服务器，直到返回正确ip。</p> 
<p></p> 
<h3 id="%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B">完整流程</h3> 
<p>1. 客户端发起一个DNS请求，先查看本地浏览器是否有这个域名的缓存，有解析结束<br> 2. 没有则去看操作系统是否有缓存，有解析结束<br> 3. 没有则去看本地host文件，有解析结束<br> 4. 没有则发送该请求到本地DNS服务器，<strong>本地域名服务器采用递归查询自己的 DNS 缓存</strong>，如果本地DNS服务器存在则返回<br> 5. 不存在本地DNS服务器则请求根域名服务器，比如请求"www.baidu.com"，根域名服务器告诉本地DNS “.com” 顶级域名服务器的位置<br> 6. 本地DNS服务器收到顶级域名服务器位置后则向顶级域名服务器请求"www.baidu.com"的IP地址，顶级域名服务器收到后则告诉本地DNS服务器"www.baidu.com"的权威域名服务器地址<br> 7. 本地DNS服务器再向权威DNS服务器发起请求，权威DNS服务器查询后将对应的IP地址告诉本地DNS<br> 8. 本地DNS服务器缓存该域名与对应IP然后返回IP给客户端<br> 9. 浏览器根据TTL缓存该值</p> 
<p>1-4为递归查询，5-7为迭代查询</p> 
<p></p> 
<h3 id="%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2">递归查询</h3> 
<p>转发器将相应的查询结果返回至本地DNS服务器192.168.16.1，本地DNS服务器将查询结果返回至主机，最终得出http://qq.com的ns记录。因为本地DNS服务器不是http://qq.com的授权解析服务器，所以查询得出的结果是非权威应答。</p> 
<p>　　递归的意思是：<strong>只需要发出一次请求，就能得到相应的结果</strong>。比如主机-本地DNS、本地DNS-转发器，都是递归查询。</p> 
<p id=""></p> 
<h3 id="%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2">迭代查询</h3> 
<p>本地域名服务器（本机）发起请求向根域名服务器，根域名服务器告诉本地域名服务器继续应该向谁查询，直到找到</p> 
<p><img alt="" height="314" src="https://images2.imgbox.com/34/2f/6q0cch6m_o.png" width="363"></p> 
<h3></h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/66bac4f3b7ae5ff5d2357a986ce7156f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">阿里云VPN网关IPsec VPN和SSL VPN功能区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae28266da79bc6a12fd422ab0734de50/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">yolov5 主要流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>