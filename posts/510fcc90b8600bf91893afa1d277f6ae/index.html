<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>火星坐标系，百度坐标系，wgs84坐标系转换算法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="火星坐标系，百度坐标系，wgs84坐标系转换算法" />
<meta property="og:description" content="一 坐标介绍
1 wgs84坐标系：是国际上通用的地理坐标系，也就是我们常说的经度纬度多少多少。比如08年汶川大地震报的经纬度就是基于这个坐标系。而我们常见的一些设备比如gps也是以这个坐标系为参考的。
2 火星坐标系：主要是因为国家安全的原因为了保护一些比较敏感的坐标位置，在大天朝所有获取地图数据的第一个关卡就是国家测绘局，在他们出产的所有地图在wgs84的基础上进行一次加密，也就是所谓的按照一定的坐标偏移算法到另外一个坐标系，这个坐标系是特有的切是变化的，大家习惯性的把他称为火星坐标系。正是因为火星坐标系的存在我们直接拿gps采集的数据在地图上显示始终都有偏差，原因就是因为两个坐标系都不一样造成的。
3 百度坐标系：百度的地图也是买的，他们买来的数据也是火星坐标系的，百度由于其平台非常知名，只要上过网的都知道百度，所以百度有这个能力搞一个自己的坐标系，再加之免费使用，用户多也就自然而然的逐渐让大家习惯了。
二 坐标换算
既然是三种坐标系，而且这些坐标系跟我们程序员息息相关，怎么实现他们的转换，要实现转换就得知道他们的转换算法。这里也是从网上东搜西搜的找到一些转换算法的代码。因为坐标的加密算法是会变化的，这些算法也并不是一定就是准确的，所以使用的时候作为参考吧。
1 WGS84坐标转火星坐标的算法最早成形的版本是https://on4wp7.codeplex.com/SourceControl/changeset/view/21483#353936
using System; namespace Navi { class EvilTransform { const double pi = 3.14159265358979324; // // Krasovsky 1940 // // a = 6378245.0, 1/f = 298.3 // b = a * (1 - f) // ee = (a^2 - b^2) / a^2; const double a = 6378245.0; const double ee = 0.00669342162296594323; // // World Geodetic System ==&gt; Mars Geodetic System public static void transform(double wgLat, double wgLon, out double mgLat, out double mgLon) { if (outOfChina(wgLat, wgLon)) { mgLat = wgLat; mgLon = wgLon; return; } double dLat = transformLat(wgLon - 105." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/510fcc90b8600bf91893afa1d277f6ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-11-21T14:44:51+08:00" />
<meta property="article:modified_time" content="2014-11-21T14:44:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">火星坐标系，百度坐标系，wgs84坐标系转换算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一 坐标介绍</p> 
<p>1 wgs84坐标系：是国际上通用的地理坐标系，也就是我们常说的经度纬度多少多少。比如08年汶川大地震报的经纬度就是基于这个坐标系。而我们常见的一些设备比如gps也是以这个坐标系为参考的。</p> 
<p>2 火星坐标系：主要是因为国家安全的原因为了保护一些比较敏感的坐标位置，在大天朝所有获取地图数据的第一个关卡就是国家测绘局，在他们出产的所有地图在wgs84的基础上进行一次加密，也就是所谓的按照一定的坐标偏移算法到另外一个坐标系，这个坐标系是特有的切是变化的，大家习惯性的把他称为火星坐标系。正是因为火星坐标系的存在我们直接拿gps采集的数据在地图上显示始终都有偏差，原因就是因为两个坐标系都不一样造成的。</p> 
<p>3 百度坐标系：百度的地图也是买的，他们买来的数据也是火星坐标系的，百度由于其平台非常知名，只要上过网的都知道百度，所以百度有这个能力搞一个自己的坐标系，再加之免费使用，用户多也就自然而然的逐渐让大家习惯了。</p> 
<p><br> </p> 
<p>二 坐标换算</p> 
<p>   既然是三种坐标系，而且这些坐标系跟我们程序员息息相关，怎么实现他们的转换，要实现转换就得知道他们的转换算法。这里也是从网上东搜西搜的找到一些转换算法的代码。因为坐标的加密算法是会变化的，这些算法也并不是一定就是准确的，所以使用的时候作为参考吧。</p> 
<p>1 WGS84坐标转火星坐标的算法最早成形的版本是<a target="_blank" href="https://on4wp7.codeplex.com/SourceControl/changeset/view/21483#353936" rel="nofollow noopener noreferrer" style="font-size:10.5pt; line-height:1.5">https://on4wp7.codeplex.com/SourceControl/changeset/view/21483#353936</a></p> 
<p></p> 
<pre><code class="language-csharp">using System;

namespace Navi
{
    class EvilTransform
    {
        const double pi = 3.14159265358979324;

        //
        // Krasovsky 1940
        //
        // a = 6378245.0, 1/f = 298.3
        // b = a * (1 - f)
        // ee = (a^2 - b^2) / a^2;
        const double a = 6378245.0;
        const double ee = 0.00669342162296594323;

        //
        // World Geodetic System ==&gt; Mars Geodetic System
        public static void transform(double wgLat, double wgLon, out double mgLat, out double mgLon)
        {
            if (outOfChina(wgLat, wgLon))
            {
                mgLat = wgLat;
                mgLon = wgLon;
                return;
            }
            double dLat = transformLat(wgLon - 105.0, wgLat - 35.0);
            double dLon = transformLon(wgLon - 105.0, wgLat - 35.0);
            double radLat = wgLat / 180.0 * pi;
            double magic = Math.Sin(radLat);
            magic = 1 - ee * magic * magic;
            double sqrtMagic = Math.Sqrt(magic);
            dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * pi);
            dLon = (dLon * 180.0) / (a / sqrtMagic * Math.Cos(radLat) * pi);
            mgLat = wgLat + dLat;
            mgLon = wgLon + dLon;
        }

        static bool outOfChina(double lat, double lon)
        {
            if (lon &lt; 72.004 || lon &gt; 137.8347)
                return true;
            if (lat &lt; 0.8293 || lat &gt; 55.8271)
                return true;
            return false;
        }

        static double transformLat(double x, double y)
        {
            double ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.Sqrt(Math.Abs(x));
            ret += (20.0 * Math.Sin(6.0 * x * pi) + 20.0 * Math.Sin(2.0 * x * pi)) * 2.0 / 3.0;
            ret += (20.0 * Math.Sin(y * pi) + 40.0 * Math.Sin(y / 3.0 * pi)) * 2.0 / 3.0;
            ret += (160.0 * Math.Sin(y / 12.0 * pi) + 320 * Math.Sin(y * pi / 30.0)) * 2.0 / 3.0;
            return ret;
        }

        static double transformLon(double x, double y)
        {
            double ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.Sqrt(Math.Abs(x));
            ret += (20.0 * Math.Sin(6.0 * x * pi) + 20.0 * Math.Sin(2.0 * x * pi)) * 2.0 / 3.0;
            ret += (20.0 * Math.Sin(x * pi) + 40.0 * Math.Sin(x / 3.0 * pi)) * 2.0 / 3.0;
            ret += (150.0 * Math.Sin(x / 12.0 * pi) + 300.0 * Math.Sin(x / 30.0 * pi)) * 2.0 / 3.0;
            return ret;
        }
    }
}</code></pre> 
<br> 2下面是 
<span style="font-size:10.5pt; line-height:1.5">图吧坐标转WGS84坐标的JavaScript实现，来源于图吧官方的JS文件。</span> 
<br> 
<p></p> 
<p><span style="font-size:10.5pt; line-height:1.5"></span></p> 
<pre><code class="language-javascript">function mapBar2WGS84(x, y) {  
    x = parseFloat(x) * 100000 % 36000000;  
    y = parseFloat(y) * 100000 % 36000000;  
  
    x1 = parseInt( - (((Math.cos(y / 100000)) * (x / 18000)) + ((Math.sin(x / 100000)) * (y / 9000))) + x);  
    y1 = parseInt( - (((Math.sin(y / 100000)) * (x / 18000)) + ((Math.cos(x / 100000)) * (y / 9000))) + y);  
  
    x2 = parseInt( - (((Math.cos(y1 / 100000)) * (x1 / 18000)) + ((Math.sin(x1 / 100000)) * (y1 / 9000))) + x + ((x &gt; 0) ? 1 : -1));  
    y2 = parseInt( - (((Math.sin(y1 / 100000)) * (x1 / 18000)) + ((Math.cos(x1 / 100000)) * (y1 / 9000))) + y + ((y &gt; 0) ? 1 : -1));  
  
    return [x2 / 100000.0, y2 / 100000.0];  
} </code></pre> 
<br> 这些代码都是在网上搜索到的，所以使用的时候作为参考并不一定准确。 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1ca40b2afd05615e902b44ee766daf9f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">两年外包女程序员的真实感受</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ce03ed5161d0d9b91ff84e31a08b9bba/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android混淆、反编译以及反破解的简单回顾</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>