<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>selenium模拟登陆(智慧南工) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="selenium模拟登陆(智慧南工)" />
<meta property="og:description" content="selenium模拟登陆 思路代码结果图 思路 使用selenium去模拟登陆比发送请求的方式更简单，所以本文采用selenium自动化模拟登陆，智慧南工(南京工业大学校园内网登陆验证界面)在更新过后，加入了验证码验证，故本文使用了深度学习的PaddleOCR进行验证码识别，识别准确率在百分之八十左右，作者在后期也会进行验证码图像处理，增加准确率。
而验证码识别思路，我提供两个：1.Tesseract识别pytesseract 2.深度学习网络识别。作者前期使用了第一个思路进行识别，但发现识别效果超级差，故改用了飞桨的OCR模型。
对于验证码的保存也有两种思路：1.找到验证码链接，直接使用request请求下载图片2.使用selenium的屏幕截图，并通过定位验证码的坐标和大小，后期截取验证码(需注意电脑默认的缩放比)。
仅供学习！！！
代码 由于实现过程较简单，故直接上代码了，selenium的环境什么的需要自己去配置。
from selenium import webdriver import time import cv2 as cv import numpy as np from selenium.webdriver.common.by import By import pytesseract from PIL import Image from selenium.webdriver.support.wait import WebDriverWait from selenium.common.exceptions import TimeoutException from paddleocr import PaddleOCR import operator class login: def __init__(self,account,passward) : self.account=account self.passward=passward self.url=&#34;https://u.njtech.edu.cn/cas/login?service=https%3A%2F%2Fu.njtech.edu.cn%2Foauth2%2Fauthorize%3Fclient_id%3DOe7wtp9CAMW0FVygUasZ%26response_type%3Dcode%26state%3Dnjtech%26s%3Df682b396da8eb53db80bb072f5745232&#34; print(&#34;自动化登陆开始！&#34;) # self.header={&#34;User-Agent&#34;:&#34; Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d7e3b5d5d3de2b780530656d4e9c5090/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-05T12:19:57+08:00" />
<meta property="article:modified_time" content="2023-06-05T12:19:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">selenium模拟登陆(智慧南工)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>selenium模拟登陆</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">思路</a></li><li><a href="#_7" rel="nofollow">代码</a></li><li><a href="#_126" rel="nofollow">结果图</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>思路</h3> 
<p>使用selenium去模拟登陆比发送请求的方式更简单，所以本文采用selenium自动化模拟登陆，智慧南工(南京工业大学校园内网登陆验证界面)在更新过后，加入了验证码验证，故本文使用了深度学习的PaddleOCR进行验证码识别，识别准确率在百分之八十左右，作者在后期也会进行验证码图像处理，增加准确率。<br> 而验证码识别思路，我提供两个：1.Tesseract识别<a href="https://blog.csdn.net/m0_53192838/article/details/127432761">pytesseract</a> 2.深度学习网络识别。作者前期使用了第一个思路进行识别，但发现识别效果超级差，故改用了飞桨的OCR模型。<br> 对于验证码的保存也有两种思路：1.找到验证码链接，直接使用request请求下载图片2.使用selenium的屏幕截图，并通过定位验证码的坐标和大小，后期截取验证码(需注意电脑默认的缩放比)。<br> <strong>仅供学习！！！</strong></p> 
<h3><a id="_7"></a>代码</h3> 
<p>由于实现过程较简单，故直接上代码了，selenium的环境什么的需要自己去配置。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token keyword">import</span> pytesseract
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>wait <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> TimeoutException
<span class="token keyword">from</span> paddleocr <span class="token keyword">import</span> PaddleOCR 
<span class="token keyword">import</span> operator
<span class="token keyword">class</span> <span class="token class-name">login</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>account<span class="token punctuation">,</span>passward<span class="token punctuation">)</span> <span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>account<span class="token operator">=</span>account
        self<span class="token punctuation">.</span>passward<span class="token operator">=</span>passward
        self<span class="token punctuation">.</span>url<span class="token operator">=</span><span class="token string">"https://u.njtech.edu.cn/cas/login?service=https%3A%2F%2Fu.njtech.edu.cn%2Foauth2%2Fauthorize%3Fclient_id%3DOe7wtp9CAMW0FVygUasZ%26response_type%3Dcode%26state%3Dnjtech%26s%3Df682b396da8eb53db80bb072f5745232"</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"自动化登陆开始！"</span><span class="token punctuation">)</span>
        <span class="token comment"># self.header={"User-Agent":" Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36 Edg/113.0.1774.42",</span>
        <span class="token comment">#              "Accept":" text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",</span>
        <span class="token comment">#              "Content-Type": "text/html;charset=UTF-8"}</span>
    <span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        options<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">"detach"</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        driver<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#全屏显示</span>
        <span class="token comment"># time.sleep(10)</span>
        <span class="token comment"># driver.implicitly_wait(5)#隐式等待</span>
        
        self<span class="token punctuation">.</span>save<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
        username<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">"username"</span><span class="token punctuation">)</span>
        username<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>self<span class="token punctuation">.</span>account<span class="token punctuation">)</span><span class="token comment">#账号</span>
        passward<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        passward<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>self<span class="token punctuation">.</span>passward<span class="token punctuation">)</span><span class="token comment">#密码</span>
        code<span class="token operator">=</span>self<span class="token punctuation">.</span>save<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
        <span class="token comment"># code=self.img_ocr()</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        yzm<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">"imgcaptcha"</span><span class="token punctuation">)</span>
        yzm<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        
        
        driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">"channelshow"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击，触发隐式下拉框</span>
        lis<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span><span class="token string">'//*[@id="fm1"]/div/div[1]/div[1]/div[5]/div/span[3]'</span><span class="token punctuation">)</span>
        lis<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># for li in lis:</span>
        <span class="token comment">#     if"中国电信"in lis.text:</span>
        <span class="token comment">#         li.click()</span>
        <span class="token comment">#         break</span>
        <span class="token comment"># driver.find_element(By.ID,"channelshow").send_keys("中国电信")</span>
        
        <span class="token comment"># js='document.querySelector("#channel").removeAttribute("readonly");'#修改只读属性</span>
        <span class="token comment"># driver.execute_script(js)</span>
        
        <span class="token comment"># driver.find_element(By.ID,"channel").clear()</span>
        <span class="token comment"># driver.find_element(By.ID,"channel").send_keys("中国电信")</span>
        button<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">"login"</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#跳转到新页面</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span><span class="token comment">#验证是否登陆成功</span>
            <span class="token builtin">str</span><span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span><span class="token string">'/html/body/div/div[1]/div[2]/div'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> operator<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"网络登陆:登录成功"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">#隐式等待</span>
                driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token comment"># try:</span>
        <span class="token comment">#     WebDriverWait(driver,10).until(ec.presence_of_element_located(By.PATH,'/html/body/div/div[1]/div[2]/div[contains(.,"网络登陆:登录成功")]'))</span>
        <span class="token comment">#     time.sleep(10)</span>
        <span class="token comment">#     driver.close()</span>
        <span class="token comment"># except TimeoutException:</span>
        <span class="token comment">#     return False</span>
    
    <span class="token comment">#selenium截图保存验证码图片,或者使用request直接下载验证码图片</span>
    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始保存图片"</span><span class="token punctuation">)</span>
        path<span class="token operator">=</span><span class="token string">'D:\\code\\python\\Reptile\\code\\'</span>
        code<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">'pc-captcha'</span><span class="token punctuation">)</span>
        <span class="token comment">#截图</span>
        driver<span class="token punctuation">.</span>save_screenshot<span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'page.png'</span><span class="token punctuation">)</span>
        loc<span class="token operator">=</span>code<span class="token punctuation">.</span>location
        size<span class="token operator">=</span>code<span class="token punctuation">.</span>size
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"验证码坐标："</span><span class="token punctuation">,</span>loc<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"验证码大小:"</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span>
        img<span class="token operator">=</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'page.png'</span><span class="token punctuation">)</span>
        <span class="token comment">##裁剪验证码</span>
        <span class="token comment">#电脑默认缩放比为1.25</span>
        code_img<span class="token operator">=</span>img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>loc<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>loc<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">1.25</span><span class="token operator">*</span><span class="token punctuation">(</span>loc<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token operator">+</span>size<span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">1.25</span><span class="token operator">*</span><span class="token punctuation">(</span>loc<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token operator">+</span>size<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#使用飞桨OCR进行验证码识别</span>
        ocr <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>use_angle_cls<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">"ch"</span><span class="token punctuation">)</span> 
        code_img<span class="token operator">=</span>code_img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'code_img.png'</span><span class="token punctuation">)</span>
        result<span class="token operator">=</span>ocr<span class="token punctuation">.</span>ocr<span class="token punctuation">(</span><span class="token string">"D:\\code\\python\\Reptile\\code\\code_img.png"</span><span class="token punctuation">,</span>det<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        text<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"验证码："</span><span class="token punctuation">,</span>text<span class="token punctuation">)</span>
        
        
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> text
        
        
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    acc<span class="token operator">=</span><span class="token string">'xxxxxxxxx'</span><span class="token comment">#自己账号</span>
    passward<span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token comment">#自己密码</span>
    login<span class="token operator">=</span>login<span class="token punctuation">(</span>acc<span class="token punctuation">,</span>passward<span class="token punctuation">)</span>
    
    login<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="_126"></a>结果图</h3> 
<p><img src="https://images2.imgbox.com/d0/89/aQMfZJr9_o.jpg" alt="请添加图片描述"></p> 
<p><img src="https://images2.imgbox.com/ed/aa/zPJBJjyU_o.png" alt="请添加图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61464cf68ad509391fca1bbe689806a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信企业服务商如何自建代开发应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a36c4bd7e3e0db77b9e8d815fa6602b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C#】控制台应用程序闪退解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>