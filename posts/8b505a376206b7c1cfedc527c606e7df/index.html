<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在Spring Boot中使用iTextPDF创建动态PDF文档 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在Spring Boot中使用iTextPDF创建动态PDF文档" />
<meta property="og:description" content="最近，我们的系统新增了一个客服模块，其中一个重要功能是能够以PDF格式导出客服与用户之间的聊天记录。这些聊天记录包含文字、图片和文件等多种内容。为了实现这一功能，我们首先使用了itextpdf 5.x版本制作了一个Demo。今天，我将与家人们分享一下这项进展。
iTextPDF 介绍 iTextPDF 是一个用于创建和操作 PDF（Portable Document Format）文档的流行的 Java 库。它提供了一套全面的功能，用于处理 PDF 文件，包括创建新文档、修改现有文档以及提取信息。以下是 iTextPDF 的一些关键方面的简要概述：
文档创建： iTextPDF 允许您从头开始创建新的 PDF 文档。
您可以向文档添加段落、表格、图像和其他元素。
文本操作： 该库提供了格式化和处理文本的方法。
页面布局： 您可以定义页面的布局，包括页面尺寸、边距等。
字体和颜色： iTextPDF 允许您选择字体和颜色，以定制文档的外观。
表格： 通过 iTextPDF，您可以创建包含表格的文档，设置表格的列数、行数和单元格内容。
图像处理： 您可以将图像插入到文档中，并设置图像的大小和位置。
文档安全性： iTextPDF 提供了对文档进行加密和数字签名的功能，以增强文档的安全性。
文档解析： 除了创建文档，iTextPDF 还允许您解析现有的 PDF 文档，提取文本、图像等信息。
代码示例 我们此处使用的 iTextPDF 5.x的版本实现的
添加依赖 在pom文件中添加如下依赖
&lt;dependency&gt; &lt;groupId&gt;com.itextpdf&lt;/groupId&gt; &lt;artifactId&gt;itextpdf&lt;/artifactId&gt; &lt;version&gt;5.5.13.2&lt;/version&gt; &lt;/dependency&gt; 代码编写 service代码
import cn.xj.xjdoc.system.entity.Message; import com.alibaba.fastjson2.JSONArray; import com.alibaba.fastjson2.JSONObject; import com.itextpdf.text.*; import com.itextpdf.text.Font; import com.itextpdf.text.Image; import com.itextpdf.text.pdf.BaseFont; import com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8b505a376206b7c1cfedc527c606e7df/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-26T09:23:49+08:00" />
<meta property="article:modified_time" content="2024-01-26T09:23:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在Spring Boot中使用iTextPDF创建动态PDF文档</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近，我们的系统新增了一个客服模块，其中一个重要功能是能够以PDF格式导出客服与用户之间的聊天记录。这些聊天记录包含文字、图片和文件等多种内容。为了实现这一功能，我们首先使用了itextpdf 5.x版本制作了一个Demo。今天，我将与家人们分享一下这项进展。</p> 
<p><img src="https://images2.imgbox.com/7e/db/1rcJ3TBQ_o.jpg" alt="itextpdf.jpg"></p> 
<h3><a id="iTextPDF__5"></a>iTextPDF 介绍</h3> 
<p>iTextPDF 是一个用于创建和操作 PDF（Portable Document Format）文档的流行的 Java 库。它提供了一套全面的功能，用于处理 PDF 文件，包括创建新文档、修改现有文档以及提取信息。以下是 iTextPDF 的一些关键方面的简要概述：</p> 
<ul><li>文档创建：</li></ul> 
<p>iTextPDF 允许您从头开始创建新的 PDF 文档。</p> 
<p>您可以向文档添加段落、表格、图像和其他元素。</p> 
<ul><li>文本操作：</li></ul> 
<p>该库提供了格式化和处理文本的方法。</p> 
<ul><li>页面布局：</li></ul> 
<p>您可以定义页面的布局，包括页面尺寸、边距等。</p> 
<ul><li>字体和颜色：</li></ul> 
<p>iTextPDF 允许您选择字体和颜色，以定制文档的外观。</p> 
<ul><li>表格：</li></ul> 
<p>通过 iTextPDF，您可以创建包含表格的文档，设置表格的列数、行数和单元格内容。</p> 
<ul><li>图像处理：</li></ul> 
<p>您可以将图像插入到文档中，并设置图像的大小和位置。</p> 
<ul><li>文档安全性：</li></ul> 
<p>iTextPDF 提供了对文档进行加密和数字签名的功能，以增强文档的安全性。</p> 
<ul><li>文档解析：</li></ul> 
<p>除了创建文档，iTextPDF 还允许您解析现有的 PDF 文档，提取文本、图像等信息。</p> 
<h3><a id="_44"></a>代码示例</h3> 
<p>我们此处使用的 iTextPDF 5.x的版本实现的</p> 
<h4><a id="_48"></a>添加依赖</h4> 
<p>在pom文件中添加如下依赖</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.itextpdf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>itextpdf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.5.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="_60"></a>代码编写</h4> 
<p>service代码</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>xj<span class="token punctuation">.</span>xjdoc<span class="token punctuation">.</span>system<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson2<span class="token punctuation">.</span></span><span class="token class-name">JSONArray</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson2<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Font</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Image</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span></span><span class="token class-name">BaseFont</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span></span><span class="token class-name">ColumnText</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span></span><span class="token class-name">PdfAction</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span></span><span class="token class-name">PdfWriter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PdfService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">DocumentException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messageList <span class="token operator">=</span> <span class="token function">getMsgList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建 PDF document</span>
        <span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PdfWriter</span> pdfWriter <span class="token operator">=</span> <span class="token class-name">PdfWriter</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> baos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取系统字体，如果是中文，则需注意linux中不存在windows字体，中文乱码或者写不进去</span>
        <span class="token class-name">FontFactory</span><span class="token punctuation">.</span><span class="token function">registerDirectories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Font</span> chineseFont <span class="token operator">=</span> <span class="token class-name">FontFactory</span><span class="token punctuation">.</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token string">"SimSun"</span><span class="token punctuation">,</span> <span class="token class-name">BaseFont</span><span class="token punctuation">.</span>IDENTITY_H<span class="token punctuation">,</span> <span class="token class-name">BaseFont</span><span class="token punctuation">.</span>NOT_EMBEDDED<span class="token punctuation">)</span><span class="token punctuation">;</span>

        document<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 发送人字体</span>
        <span class="token class-name">Font</span> senderFont <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span>chineseFont<span class="token punctuation">.</span><span class="token function">getBaseFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token class-name">Font</span><span class="token punctuation">.</span>BOLD<span class="token punctuation">,</span> <span class="token class-name">BaseColor</span><span class="token punctuation">.</span>ORANGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发送时间字体</span>
        <span class="token class-name">Font</span> senderTimeFont <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span>chineseFont<span class="token punctuation">.</span><span class="token function">getBaseFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token class-name">Font</span><span class="token punctuation">.</span>UNDEFINED<span class="token punctuation">,</span> <span class="token class-name">BaseColor</span><span class="token punctuation">.</span>BLUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 内容字体</span>
        <span class="token class-name">Font</span> defaultFont <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span>chineseFont<span class="token punctuation">.</span><span class="token function">getBaseFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将信息写入pdf中</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> msg <span class="token operator">:</span> messageList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token class-name">String</span> senderText <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s  "</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getSendUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> timeText <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getSendTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> messageText <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Integer</span> type <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Paragraph</span> paragraph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paragraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ColumnText</span> columnText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ColumnText</span><span class="token punctuation">(</span>pdfWriter<span class="token punctuation">.</span><span class="token function">getDirectContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            columnText<span class="token punctuation">.</span><span class="token function">addElement</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
            columnText<span class="token punctuation">.</span><span class="token function">setSimpleColumn</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">bottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Element</span><span class="token punctuation">.</span>ALIGN_LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chunk</span><span class="token punctuation">(</span>senderText<span class="token punctuation">,</span> senderFont<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chunk</span><span class="token punctuation">(</span>timeText <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span> senderTimeFont<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">float</span> proportion <span class="token operator">=</span> <span class="token number">1f</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//文字</span>
                paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chunk</span><span class="token punctuation">(</span>messageText <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span> defaultFont<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//图片</span>
                <span class="token comment">// 创建Image对象</span>
                <span class="token class-name">Image</span> image <span class="token operator">=</span> <span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//等比缩小图片</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    proportion <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">150</span><span class="token punctuation">;</span>
                    image<span class="token punctuation">.</span><span class="token function">scaleToFit</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>proportion<span class="token punctuation">,</span> image<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>proportion<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//加一空行</span>
                paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chunk</span><span class="token punctuation">(</span><span class="token class-name">Chunk</span><span class="token punctuation">.</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 判断当前页内容是否已满</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pdfWriter<span class="token punctuation">.</span><span class="token function">getVerticalPosition</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">-</span> image<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>proportion<span class="token punctuation">)</span> <span class="token operator">&lt;</span> document<span class="token punctuation">.</span><span class="token function">bottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    document<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Start a new page</span>
                    columnText<span class="token punctuation">.</span><span class="token function">setYLine</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//文件</span>
                <span class="token comment">// 创建Chunk，设置文件连接，点击下载</span>
                <span class="token class-name">Chunk</span> chunk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chunk</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>defaultFont<span class="token punctuation">)</span><span class="token punctuation">;</span>
                chunk<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PdfAction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toExternalForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                paragraph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            paragraph<span class="token punctuation">.</span><span class="token function">setIndentationLeft</span><span class="token punctuation">(</span><span class="token number">20f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paragraph<span class="token punctuation">.</span><span class="token function">setIndentationRight</span><span class="token punctuation">(</span><span class="token number">20f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paragraph<span class="token punctuation">.</span><span class="token function">setSpacingAfter</span><span class="token punctuation">(</span><span class="token number">10f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 判断当前页内容是否已满</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ColumnText</span><span class="token punctuation">.</span><span class="token function">hasMoreText</span><span class="token punctuation">(</span>columnText<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                document<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            document<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>paragraph<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        document<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回pdf</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"inline; filename=chat_export.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 获取数据的方法
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span>  <span class="token function">getMsgList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span>  jsonArrayString <span class="token operator">=</span><span class="token string">"[{\"type\": 1, \"content\": \"嘿，听说最近有点八卦，你有什么料吗？\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:46:12\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"当然啦！你知道吗，最近有个超级智能机器人在公司里开始工作了，听说能做我们的工作，让人有点担心啊。\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:47:17\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \" 哇，真的吗？那它是怎么工作的？会不会抢我们的饭碗？\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:48:22\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \" 别慌，听说它只是一个AI助手，能够处理一些重复性的任务，让我们有更多时间专注于创造性的工作。\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:49:12\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \" 哦，原来如此。不过，你觉得这个机器人有没有潜在的危险性啊？\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:50:18\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"哈哈，我也有点担心，但听说它的设计是为了帮助我们，而不是取代我们。还有，它可不会参与任何八卦。\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:51:42\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \" 哈哈，说到八卦，你有听说最近公司里有什么有趣的事情吗？\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:52:12\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"对呀，听说某某老板最近秘密约会了某某同事，整个公司都在传。你觉得是真的吗？照片都爆出来了，给你发下\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:53:12\", \"sendUser\": \"修己\"}, {\"type\": 2, \"content\": \"http://chevereto.xiuji.mynatapp.cc/images/2023/06/27/z_3b2fa0f1285d8071229631addebf3087.png\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:54:12\", \"sendUser\": \"修己\"}, {\"type\": 2, \"content\": \"http://chevereto.xiuji.mynatapp.cc/images/2023/06/23/_20230623212425.png\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:55:12\", \"sendUser\": \"修己\"}, {\"type\": 2, \"content\": \"http://chevereto.xiuji.mynatapp.cc/images/2023/06/27/z_73bc1ab1a92d68b15e9e1babc3d15afb.png\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:56:12\", \"sendUser\": \"修己\"}, {\"type\": 2, \"content\": \"http://chevereto.xiuji.mynatapp.cc/images/2023/06/23/_20230623212445.png\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:57:12\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \"哇，这可真是八卦大爆炸啊！我倒是没听说，但如果是真的，那可真是太有趣了。\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:58:12\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"是啊，公司里的八卦总是让人忍不住想知道更多。有时候我觉得，我们也是一群活在八卦世界里的AI助手。\", \"fileName\": null, \"sendTime\": \"2024-01-25 21:59:12\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \"哈哈，说得对！我们也需要一些八卦来调剂一下生活。不过，我还是觉得那个超级智能机器人有点神秘呢。\", \"fileName\": null, \"sendTime\": \"2024-01-25 22:02:36\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"是啊，或许我们也能通过它得知更多关于公司内幕的事情。要不要试试向它搭讪？\", \"fileName\": null, \"sendTime\": \"2024-01-25 22:05:36\", \"sendUser\": \"修己\"}, {\"type\": 1, \"content\": \" 哈哈，说不定它能告诉我们更多关于那对神秘约会的内幕。不过，我们还是小心点为好，免得被当成八卦机器人。\", \"fileName\": null, \"sendTime\": \"2024-01-25 22:08:36\", \"sendUser\": \"大雄\"}, {\"type\": 1, \"content\": \"顺便给你在发个我最近吃的瓜的pdf\", \"fileName\": null, \"sendTime\": \"2024-01-25 22:12:36\", \"sendUser\": \"修己\"}, {\"type\": 4, \"content\": \"http://chevereto.xiuji.mynatapp.cc/images/2023/06/23/西安外国语大学会计ACCA2001班丁玉婕出轨情况说明.pdf\", \"fileName\": \"西安外国语大学会计ACCA2001班丁玉婕出轨情况说明.pdf\", \"sendTime\": \"2024-01-25 22:18:36\", \"sendUser\": \"修己\"}]"</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用Fastjson将JsonArray字符串解析为JSONArray对象</span>
        <span class="token class-name">JSONArray</span> jsonArray <span class="token operator">=</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>jsonArrayString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messageList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历JsonArray，将每个JSON对象转换为Message对象并添加到List中</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> jsonMessage <span class="token operator">:</span> jsonArray<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JSONObject</span><span class="token punctuation">)</span> jsonMessage<span class="token punctuation">;</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJavaObject</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> messageList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>controller代码</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>xj<span class="token punctuation">.</span>xjdoc<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">PdfService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PdfController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PdfService</span> pdfService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/export"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">DocumentException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        pdfService<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>代码到这就完了，我们可以启动服务，查看下展示的效果：</p> 
<p><img src="https://images2.imgbox.com/f4/99/tRr0TPq6_o.jpg" alt="_20240126070304.jpg"></p> 
<p><img src="https://images2.imgbox.com/22/fa/ZNweCegA_o.jpg" alt="_20240126070314.jpg"></p> 
<p><img src="https://images2.imgbox.com/5f/9d/v9y70Mke_o.jpg" alt="_20240126070325.jpg"></p> 
<p>到这儿，如果不出意外的话肯定要出意外了，请继续阅读文章。</p> 
<h3><a id="Linux_239"></a>Linux上解决中文没写入或者乱码问题</h3> 
<p>如果我们将服务部署到Linux服务器上，可能会遇到中文未正确写入或乱码的问题。这是由于Linux系统上的字体库与Windows系统不同。为了解决这个问题，我们可以在代码中直接将所需字体的ttf文件复制到项目目录下，并使用itextpdf加载这些字体。此前，我们成功为服务器添加了Windows字体库，因此我们可以直接从系统中获取字体。接下来，我们将介绍在Linux中添加Windows字体的操作步骤。</p> 
<p>windows字体库的位置：<code>C:\Users\Administrator\AppData\Local\Microsoft\Windows\Fonts</code></p> 
<h4><a id="Linux_windows_245"></a>Linux 中添加windows字体库</h4> 
<ul><li>ubuntu</li></ul> 
<p>将windows的字体库Fonts 复制到目录 <code>/usr/share/fonts</code> 下,执行如下权限命令：</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">chmod</span> -R <span class="token number">777</span> Fonts
</code></pre> 
<p>然后执行以下命令使字体生效</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> fc-cache -fv
</code></pre> 
<ul><li>centos</li></ul> 
<p>将windows的字体库Fonts下的文件 复制到目录 <code>/usr/share/fonts</code> 下,依次执行如下命令：</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y mkfontscale

yum <span class="token function">install</span> -y fontconfig

<span class="token builtin class-name">cd</span> /usr/share/fonts/

mkfontscale

mkfontdir

fc-cache

fc-list
</code></pre> 
<h4><a id="windowsdocker_281"></a>构建具有windows字体库的docker镜像</h4> 
<ul><li>ubuntu</li></ul> 
<p>Dockerfile</p> 
<pre><code class="prism language-Dockerfile"># 基于哪个镜像
FROM ubuntu:20.10

# 维护者
MAINTAINER xj

# 拷贝文件到容器
ADD Fonts /usr/share/fonts/chinese_font/
RUN chmod -R 755 /usr/share/fonts/chinese_font
RUN fc-cache -fv
</code></pre> 
<ul><li>centos</li></ul> 
<p>Dockerfile</p> 
<pre><code class="prism language-Dockerfile"># 基于哪个镜像
FROM centos:centos7.1.1503
# 维护者
MAINTAINER xj
ADD Fonts/* /usr/share/fonts/
RUN yum install -y mkfontscale
RUN yum install -y fontconfig
RUN cd /usr/share/fonts/
RUN mkfontscale
RUN mkfontdir
RUN fc-cache
RUN fc-list
</code></pre> 
<h3><a id="_319"></a>总结</h3> 
<p>这个例子演示了如何使用Spring Boot和iTextPDF创建动态的、个性化的PDF文档。你可以根据实际需求扩展生成的PDF内容，包括图表、表格等，以满足项目的特定要求。希望这篇文章对你有所帮助！如果有任何问题或建议，请随时提出。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e3fa72f9bcf2acdc706c548758d2eb6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据库系统概论（第五版）——第五章参考答案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4f103bd178251e410cf70627eb084101/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里云负载均衡对接</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>