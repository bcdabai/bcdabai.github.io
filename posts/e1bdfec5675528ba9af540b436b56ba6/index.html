<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>stata数据处理 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="stata数据处理" />
<meta property="og:description" content="stata数据处理–潘登同学的stata笔记 文章目录 stata数据处理--潘登同学的stata笔记 数据导入、导出使表格第一行成为变量标注(label) 数据合并横向与纵向合并一对多与多对一横向合并 缺失值处理查看缺失值替换缺失值缺失值填充 离群值处理取对数的方法截尾处理、缩尾处理 分组统计列表统计分组回归 egen函数做数据处理其他egen函数 文字日期变量的处理将季度数据调整为月度数据 抽样不放回抽样有放回抽样 数据导入、导出 数据导入：
import excel auto.xls, firstrow sheet(Sheet1) clear br foreign encode foreign, gen(Cartype2) label(foreign) br Cartype2 label list foreign save myauto.dta, replace //保存为 Stata 格式数据文件 firstrow 表示把 Excel 的第一行视为变量名称sheet() 中填入 Excel 中的 sheet 名称Excel2003 文件后缀为 .xls, Excel2007 文件后缀为 .xlsx 数据导出：
sysuse auto.dta, clear export excel auto.xls, firstrow(variables) replace //首行为变量名称 shellout auto.xls // 打开 excel 文档 export excel auto.xlsx, firstrow(varlabels) replace //首行为变量标签 shellout auto." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e1bdfec5675528ba9af540b436b56ba6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-12T23:14:14+08:00" />
<meta property="article:modified_time" content="2023-04-12T23:14:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">stata数据处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="statastata_0"></a>stata数据处理–潘登同学的stata笔记</h3> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#statastata_0" rel="nofollow">stata数据处理--潘登同学的stata笔记</a></li></ul> 
  </li><li><a href="#_4" rel="nofollow">数据导入、导出</a></li><li><ul><li><a href="#label_46" rel="nofollow">使表格第一行成为变量标注(label)</a></li></ul> 
  </li><li><a href="#_59" rel="nofollow">数据合并</a></li><li><ul><li><a href="#_61" rel="nofollow">横向与纵向合并</a></li><li><a href="#_106" rel="nofollow">一对多与多对一横向合并</a></li></ul> 
  </li><li><a href="#_149" rel="nofollow">缺失值处理</a></li><li><ul><li><a href="#_151" rel="nofollow">查看缺失值</a></li><li><a href="#_181" rel="nofollow">替换缺失值</a></li><li><a href="#_203" rel="nofollow">缺失值填充</a></li></ul> 
  </li><li><a href="#_259" rel="nofollow">离群值处理</a></li><li><ul><li><a href="#_261" rel="nofollow">取对数的方法</a></li><li><a href="#_278" rel="nofollow">截尾处理、缩尾处理</a></li></ul> 
  </li><li><a href="#_315" rel="nofollow">分组统计</a></li><li><ul><li><a href="#_317" rel="nofollow">列表统计</a></li><li><a href="#_373" rel="nofollow">分组回归</a></li></ul> 
  </li><li><a href="#egen_427" rel="nofollow">egen函数做数据处理</a></li><li><ul><li><a href="#egen_487" rel="nofollow">其他egen函数</a></li></ul> 
  </li><li><a href="#_500" rel="nofollow">文字日期变量的处理</a></li><li><ul><li><a href="#_524" rel="nofollow">将季度数据调整为月度数据</a></li></ul> 
  </li><li><a href="#_561" rel="nofollow">抽样</a></li><li><ul><li><a href="#_563" rel="nofollow">不放回抽样</a></li><li><a href="#_613" rel="nofollow">有放回抽样</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_4"></a>数据导入、导出</h2> 
<p>数据导入：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">excel</span> auto<span class="token punctuation">.</span>xls<span class="token punctuation">,</span> firstrow <span class="token function">sheet</span><span class="token punctuation">(</span><span class="token class-name">Sheet1</span><span class="token punctuation">)</span> clear 
br foreign
encode foreign<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token class-name">Cartype2</span><span class="token punctuation">)</span> <span class="token function">label</span><span class="token punctuation">(</span>foreign<span class="token punctuation">)</span>
br <span class="token class-name">Cartype2</span> 
label list foreign

save myauto<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace  <span class="token comment">//保存为 Stata 格式数据文件</span>
</code></pre> 
<ul><li><code>firstrow</code> 表示把 Excel 的第一行视为变量名称</li><li><code>sheet()</code> 中填入 Excel 中的 sheet 名称</li><li>Excel2003 文件后缀为 .xls, Excel2007 文件后缀为 .xlsx</li></ul> 
<p>数据导出：</p> 
<pre><code class="prism language-java">sysuse auto<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
export excel auto<span class="token punctuation">.</span>xls<span class="token punctuation">,</span> <span class="token function">firstrow</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span> replace  <span class="token comment">//首行为变量名称</span>
shellout auto<span class="token punctuation">.</span>xls  <span class="token comment">// 打开 excel 文档 </span>

export excel auto<span class="token punctuation">.</span>xlsx<span class="token punctuation">,</span> <span class="token function">firstrow</span><span class="token punctuation">(</span>varlabels<span class="token punctuation">)</span> replace  <span class="token comment">//首行为变量标签</span>
shellout auto<span class="token punctuation">.</span>xlsx  <span class="token comment">// 打开 excel 文档 </span>
</code></pre> 
<ul><li><code>firstrow(varlabels)</code>：保存变量名称</li><li><code>nolabel</code>:不保存变量名称</li></ul> 
<p>其他导入方式</p> 
<pre><code class="prism language-java">help insheet  <span class="token comment">//导入 -tab- 分隔的数据</span>

help infile   <span class="token comment">//导入  逗号 分隔的数据 </span>

help usespss  <span class="token comment">//将 SPSS 格式的数据导入 STATA</span>

help fdasave  <span class="token comment">//Save and use datasets in FDA (SAS XPORT) format</span>

help usesas   <span class="token comment">//将 SAS 格式的数据导入 STATA </span>
</code></pre> 
<h3><a id="label_46"></a>使表格第一行成为变量标注(label)</h3> 
<p>有时在Excel整理数据时，会把第一行写为变量名，第二行写为变量标注(label)。在导入Stata中时，第一行可以自动转化为变量名，但第二行标注会在导入时成为第一个标量。</p> 
<pre><code class="prism language-java">foreach <span class="token keyword">var</span> of varlist <span class="token operator">*</span> <span class="token punctuation">{<!-- --></span>                                <span class="token comment">// 对每一个变量</span>
  label     variable    `<span class="token keyword">var</span>'             <span class="token string">"`=`var'[1]'"</span>   <span class="token comment">// 把变量标注为第一行的内容</span>
  replace               `<span class="token keyword">var</span>' <span class="token operator">=</span> <span class="token string">""</span>   <span class="token keyword">if</span>   _n <span class="token operator">==</span> <span class="token number">1</span>         <span class="token comment">// 把第一行改为空</span>
  destring              `<span class="token keyword">var</span>'        <span class="token punctuation">,</span>    replace         <span class="token comment">// 把变量destring</span>

<span class="token punctuation">}</span>
drop in <span class="token number">1</span>                                                 <span class="token comment">// 删除第一行</span>
</code></pre> 
<h2><a id="_59"></a>数据合并</h2> 
<h3><a id="_61"></a>横向与纵向合并</h3> 
<pre><code class="prism language-java">merge <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span> varlist using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>varlist</code>表示按照哪个变量来合并</li></ul> 
<p>横向合并：增加变量<br> <img src="https://images2.imgbox.com/d3/4f/MHPqp6aP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">// 查看待合并的数据</span>
use merge_m<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
browse
use merge_u<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
br 
<span class="token comment">// 横向合并：增加变量</span>
use merge_m<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear        <span class="token comment">// master dataset</span>
merge <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span> date using merge_u  <span class="token comment">// using  dataset</span>
des
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/b5/qcce5Xye_o.png" alt="在这里插入图片描述"></p> 
<p>纵向合并：追加样本<br> <img src="https://images2.imgbox.com/d9/af/Cfg3ZQvL_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">use append_m<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
br
use append_u<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
br

<span class="token comment">// 纵向追加</span>
use append_m<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
append using append_u<span class="token punctuation">.</span>dta
des
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/f8/SC0kegDN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_106"></a>一对多与多对一横向合并</h3> 
<p>多对一横向合并</p> 
<pre><code class="prism language-java">merge m<span class="token operator">:</span><span class="token number">1</span> varlist using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>varlist</code>表示按照哪个变量来合并</li></ul> 
<pre><code class="prism language-java">use GTA_FS<span class="token punctuation">.</span>dta<span class="token punctuation">,</span>clear    <span class="token comment">//上市公司财务资料, id-year, Panel</span>
br 
use <span class="token class-name">GTA_basic</span><span class="token punctuation">.</span>dta<span class="token punctuation">,</span>clear <span class="token comment">//上市公司基本资料,只有 id 没有 year</span>
br

use GTA_FS<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
merge m<span class="token operator">:</span><span class="token number">1</span> id using <span class="token class-name">GTA_basic</span><span class="token punctuation">.</span>dta
br
</code></pre> 
<p><img src="https://images2.imgbox.com/83/f2/q3aNzaXT_o.png" alt="在这里插入图片描述"></p> 
<p><code>_merge</code> 变量的含义：</p> 
<ul><li><code>_merge==1</code> obs. from master dataset</li><li><code>_merge==2</code> obs. from only using dataset</li><li><code>_merge==3</code> obs. from at least both datasets</li></ul> 
<p>一对多横向合并</p> 
<pre><code class="prism language-java">merge <span class="token number">1</span><span class="token operator">:</span>m varlist using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span>
</code></pre> 
<p>本质上跟上面的一样，只是master dataset不同</p> 
<pre><code class="prism language-java">use <span class="token class-name">GTA_basic</span><span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
merge <span class="token number">1</span><span class="token operator">:</span>m id using GTA_FS<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> nogen
browse
order id year
xtset id year 
</code></pre> 
<p><img src="https://images2.imgbox.com/df/f5/K8BGz2pV_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_149"></a>缺失值处理</h2> 
<h3><a id="_151"></a>查看缺失值</h3> 
<pre><code class="prism language-java">sysuse auto<span class="token punctuation">,</span> clear
count <span class="token keyword">if</span> rep78<span class="token operator">==</span><span class="token punctuation">.</span>
</code></pre> 
<p>需要注意的是：</p> 
<ul><li>有些命令，如 sum, regress, generate 等，会自动忽略缺漏值；</li><li>有些命令，如 count, keep 等，则会将 “.” 视为一个无穷大的数值</li></ul> 
<p>使用回归的方式来标记不包含缺失值的样本(注意是样本层面，只要有一个变量缺失，整个样本就算缺失)</p> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
sum wage industry tenure hours
reg wage industry tenure hours  <span class="token comment">//回归不是我本意</span>
ereturn list
<span class="token comment">//	e(sample) 如果一个样本中至少有一个变量有缺失值，则为0，变量齐全则为1</span>
sum wage industry tenure hours <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>

gen yes <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span>
sort yes
browse yes wage industry tenure hours

sum wage industry tenure hours <span class="token keyword">if</span> yes<span class="token operator">==</span><span class="token number">1</span>
keep <span class="token keyword">if</span> yes<span class="token operator">==</span><span class="token number">1</span>  <span class="token comment">// 删除缺漏值</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/8c/dZeYslQR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_181"></a>替换缺失值</h3> 
<p>常见的缺漏值标记符号：<code>N.A. | N/A | -99 | -97 | -9999</code></p> 
<pre><code class="prism language-java">insheet using <span class="token string">"D3_miss01.txt"</span><span class="token punctuation">,</span> clear
mvdecode x1 x2<span class="token punctuation">,</span> <span class="token function">mv</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">97</span> <span class="token operator">-</span><span class="token number">99</span> <span class="token operator">-</span><span class="token number">999</span><span class="token punctuation">)</span>    <span class="token comment">// 批量替换</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/83/Wq39ow4K_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">// 数值型缺漏值</span>
mvdecode x1 x2<span class="token punctuation">,</span> <span class="token function">mv</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">97</span> <span class="token operator">-</span><span class="token number">99</span> <span class="token operator">-</span><span class="token number">999</span><span class="token punctuation">)</span>    <span class="token comment">//批量替换</span>
<span class="token comment">// 文字型缺漏值</span>
replace x3 <span class="token operator">=</span><span class="token string">"."</span>  <span class="token keyword">if</span> x3<span class="token operator">==</span> <span class="token string">"N/A"</span>
replace x3 <span class="token operator">=</span><span class="token string">"."</span>  <span class="token keyword">if</span> x3<span class="token operator">==</span> <span class="token string">"N.A."</span>
destring x3<span class="token punctuation">,</span> replace  <span class="token comment">// 转换为数值变量</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/aa/ZZHJo2PJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_203"></a>缺失值填充</h3> 
<p><code>fillmissing</code>语法</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>bysort varlist<span class="token punctuation">]</span><span class="token operator">:</span> fillmissing varname <span class="token punctuation">[</span><span class="token keyword">if</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>in<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">with</span><span class="token punctuation">(</span>with_options<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>with(any)</code>：最好用来填充常量变量 (constant variable)，因为会任意从非缺失值中填充缺失值。如果未指定 with_options，则作为默认值；</li><li><code>with(previous)</code>：使用前面的值填充当前的缺失值。如果前面的值也缺失，则当前值保持缺失状态。另外，该选项并不对数据进行排序操作，因此无论当前数据的排序如何，填充都将使用当前的排序状态来标识当前缺失值和前面的观测值；</li><li><code>with(next)</code>：与 with(previous) 类似，使用后面的值填充当前的缺失值。如果后面的值也缺失，则当前值保持缺失状态。另外，该选项并不对数据进行排序操作，因此无论当前数据的排序如何，填充都将使用当前的排序状态来标识当前缺失值和后面的观测值；</li><li><code>with(first)</code>：使用当前排序状态下的第一个值替换所有的缺失值。或者搭配 bysort，将使用每个组的第一个值；</li><li><code>with(last)</code>：使用当前排序状态下的最后一个值替换所有的缺失值。或者搭配 bysort，将使用每个组的最后一个值；</li><li><code>with(mean)</code>：使用非缺失值的平均值替换缺失值。变量类型只能为数值型 (numeric variable)；</li><li><code>with(median)</code>：使用非缺失值的中位数替换缺失值。变量类型只能为数值型 (numeric variable)；</li><li><code>with(min)</code>：使用非缺失值的最小值替换缺失值。变量类型只能为数值型 (numeric variable)；</li><li><code>with(max)</code>：使用非缺失值的最大值替换缺失值。变量类型只能为数值型 (numeric variable)。</li></ul> 
<pre><code class="prism language-java">clear all
input id k
  id   k
  <span class="token number">1</span>   <span class="token number">3</span>
  <span class="token number">1</span>   <span class="token number">5</span>
  <span class="token number">1</span>   <span class="token punctuation">.</span>
  <span class="token number">1</span>   <span class="token punctuation">.</span>
  <span class="token number">1</span>   <span class="token number">7</span>
  <span class="token number">2</span>   <span class="token punctuation">.</span>
  <span class="token number">2</span>   <span class="token punctuation">.</span>
  <span class="token number">2</span>   <span class="token number">4</span>
  <span class="token number">2</span>   <span class="token number">8</span>
  <span class="token number">2</span>   <span class="token punctuation">.</span>
end

gen any <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing any<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span>
gen previous <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing previous<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>previous<span class="token punctuation">)</span>
gen next <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing next<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
gen first <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing first<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span>
gen last <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing last<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span>
gen mean_ <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing mean_<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>mean_<span class="token punctuation">)</span>
gen median_ <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing median_<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>median_<span class="token punctuation">)</span>
gen min <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing min<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span>
gen max <span class="token operator">=</span> k
bys id<span class="token operator">:</span> fillmissing max<span class="token punctuation">,</span> <span class="token keyword">with</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span>
list<span class="token punctuation">,</span>noobs
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/36/4lHtAzKN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_259"></a>离群值处理</h2> 
<h3><a id="_261"></a>取对数的方法</h3> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">,</span> clear
gen ln_wage <span class="token operator">=</span> <span class="token function">ln</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>

histogram wage
histogram ln_wage

twoway <span class="token punctuation">(</span>histogram    wage<span class="token punctuation">,</span> <span class="token function">color</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">///</span>
        <span class="token punctuation">(</span>histogram ln_wage<span class="token punctuation">,</span> <span class="token function">color</span><span class="token punctuation">(</span>yellow<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/23/ZtVVwTN5_o.png" alt="在这里插入图片描述"></p> 
<p>注意：对数转换后,系数估计值的含义会发生变化,解释结果时要慎重</p> 
<h3><a id="_278"></a>截尾处理、缩尾处理</h3> 
<p>截尾处理：</p> 
<pre><code class="prism language-java"><span class="token comment">// 以 1th 和 99th 百分位数值为临界点</span>
sysuse nlsw88<span class="token punctuation">,</span> clear
winsor2 wage<span class="token punctuation">,</span> <span class="token function">cuts</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">99</span><span class="token punctuation">)</span> <span class="token function">by</span><span class="token punctuation">(</span>collgrad<span class="token punctuation">)</span> <span class="token function">suffix</span><span class="token punctuation">(</span>_tr<span class="token punctuation">)</span> trim 
sum wage<span class="token operator">*</span>
des wage<span class="token operator">*</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/5f/NNUvZ5Cw_o.png" alt="在这里插入图片描述"></p> 
<p>缩尾处理：</p> 
<pre><code class="prism language-java"><span class="token comment">// *-基本原理</span>
sysuse nlsw88<span class="token punctuation">,</span> clear
sum wage<span class="token punctuation">,</span> detail

replace wage<span class="token operator">=</span><span class="token number">1.930993</span> <span class="token keyword">if</span> wage<span class="token operator">&lt;</span><span class="token number">1.930993</span> 
replace wage<span class="token operator">=</span><span class="token number">38.70926</span> <span class="token keyword">if</span> wage<span class="token operator">&gt;</span><span class="token number">38.70926</span>

<span class="token comment">// *-winsor2 命令</span>
sysuse nlsw88<span class="token punctuation">,</span> clear
winsor2 wage<span class="token punctuation">,</span> <span class="token function">cuts</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">99</span><span class="token punctuation">)</span> <span class="token comment">// cuts(1 99) 选项可以省略; 会自动生成新变量 wage_w</span>
sum wage<span class="token operator">*</span>
des wage<span class="token operator">*</span>

<span class="token comment">// *-一次性处理多个变量</span>
sysuse nlsw88<span class="token punctuation">,</span> clear
winsor2 wage hours tenure<span class="token punctuation">,</span> <span class="token function">cuts</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">99</span><span class="token punctuation">)</span> replace
des wage<span class="token operator">*</span> hours<span class="token operator">*</span> tenure<span class="token operator">*</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/45/34/aS1ct37E_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_315"></a>分组统计</h2> 
<h3><a id="_317"></a>列表统计</h3> 
<p>一维列表:</p> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
	
<span class="token comment">// *-频数列表</span>
tabulate industry      <span class="token comment">// tabulate 可以简写为 tab</span>
<span class="token comment">// *-柱状图</span>
graph hbar <span class="token punctuation">(</span>count<span class="token punctuation">)</span> idcode<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>industry<span class="token punctuation">)</span>         <span class="token comment">///</span>
      <span class="token function">blabel</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token function">position</span><span class="token punctuation">(</span>outside<span class="token punctuation">)</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">3.0f</span><span class="token punctuation">)</span> <span class="token comment">///</span>
      <span class="token function">color</span><span class="token punctuation">(</span>blue<span class="token punctuation">)</span> <span class="token function">size</span><span class="token punctuation">(</span>small<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/a9/lJ8zGJ29_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1b/f4/40kCh2zj_o.png" alt="在这里插入图片描述"></p> 
<p>二维列表:</p> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear

tab industry collgrad  <span class="token comment">// 频数</span>
tab industry collgrad<span class="token punctuation">,</span> column nofreq <span class="token comment">//占比</span>

tabplot industry collgrad <span class="token punctuation">,</span>  <span class="token comment">///</span>
	      <span class="token function">bfcolor</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span> horizontal <span class="token function">barw</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">///</span>
          <span class="token function">percent</span><span class="token punctuation">(</span>collgrad<span class="token punctuation">)</span> <span class="token function">subtitle</span><span class="token punctuation">(</span><span class="token operator">%</span> at each industry<span class="token punctuation">)</span> <span class="token comment">///</span>
		  <span class="token function">showval</span><span class="token punctuation">(</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/76/biuFbHGv_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/5c/f1/bhbPTkok_o.png" alt="在这里插入图片描述"></p> 
<p>变量的统计特征:</p> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear

<span class="token comment">// *-变量的统计特征</span>
tab industry collgrad<span class="token punctuation">,</span> <span class="token function">summarize</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span> means

<span class="token comment">// *-图形呈现</span>
graph hbar <span class="token punctuation">(</span>mean<span class="token punctuation">)</span> wage<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>industry<span class="token punctuation">)</span> <span class="token function">over</span><span class="token punctuation">(</span>collgrad<span class="token punctuation">)</span> <span class="token comment">///</span>
        <span class="token function">intensity</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token number">0.4</span><span class="token punctuation">)</span> <span class="token function">scheme</span><span class="token punctuation">(</span>s1mono<span class="token punctuation">)</span>                  <span class="token comment">///</span>
        <span class="token function">blabel</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token function">position</span><span class="token punctuation">(</span>outside<span class="token punctuation">)</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">3.1f</span><span class="token punctuation">)</span>     <span class="token comment">///</span>
                    <span class="token function">size</span><span class="token punctuation">(</span>small<span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/ea/62/ujcFqLPf_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/43/cb/cw560ODl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_373"></a>分组回归</h3> 
<p>先将<strong>连续变量转换为类别变量</strong></p> 
<pre><code class="prism language-java">sysuse nlsw88<span class="token punctuation">,</span> clear
sort wage
gen g_wage <span class="token operator">=</span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">//工资等分为五组</span>
br wage g_wage
tab g_wage
</code></pre> 
<p><img src="https://images2.imgbox.com/6c/40/kG6zt3aP_o.png" alt="在这里插入图片描述"></p> 
<p>做分组的描述性统计</p> 
<pre><code class="prism language-java">label define g_wage_label <span class="token number">1</span> <span class="token string">"Low"</span> <span class="token number">5</span> <span class="token string">"High"</span>
label value  g_wage g_wage_label
tabstat wage age married union collgrad south<span class="token punctuation">,</span> <span class="token comment">///</span>
            <span class="token function">stat</span><span class="token punctuation">(</span>mean<span class="token punctuation">)</span> <span class="token function">by</span><span class="token punctuation">(</span>g_wage<span class="token punctuation">)</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">4.2f</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/f8/VqMb8KGw_o.png" alt="在这里插入图片描述"></p> 
<p>做分组回归</p> 
<pre><code class="prism language-java">local x <span class="token string">"age ttl_exp married union collgrad south c_city"</span>
reg wage `x' <span class="token keyword">if</span> g_wage<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">,</span> robust
est store <span class="token class-name">Low</span>
reg wage `x' <span class="token keyword">if</span> g_wage<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">,</span> robust
est store <span class="token class-name">Mid</span>  
reg wage `x' <span class="token keyword">if</span> g_wage<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">,</span> robust
est store <span class="token class-name">High</span>
reg wage `x'             <span class="token punctuation">,</span> robust
est store <span class="token class-name">Full</span>

local m <span class="token string">"Low Mid High Full"</span>
esttab `m'<span class="token punctuation">,</span> <span class="token function">mtitle</span><span class="token punctuation">(</span>`m'<span class="token punctuation">)</span> nogap <span class="token function">s</span><span class="token punctuation">(</span>r2 r2_a <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">6.3f</span><span class="token punctuation">)</span> <span class="token comment">///</span>
        <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/cf/QLZwNKeR_o.png" alt="在这里插入图片描述"></p> 
<p>其他方法：根据分位数进行分组</p> 
<pre><code class="prism language-java"><span class="token comment">// 在每个行业内部根据 33th, 66th 百分位分成三组</span>
bysort industry<span class="token operator">:</span> quantiles wage<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>p_wage<span class="token punctuation">)</span> <span class="token function">nq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> 
tab p_wage
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/32/F0XjbfuU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="egen_427"></a>egen函数做数据处理</h2> 
<p><code>egen</code>函数是官方命令提供的函数，<code>egenmore</code>是Stata 用户提供的外部函数,文子处理的利器</p> 
<pre><code class="prism language-java">sysuse <span class="token string">"nlsw88.dta"</span><span class="token punctuation">,</span> clear

<span class="token comment">// 行业中位数</span>
bysort industry<span class="token operator">:</span> egen wage_p50 <span class="token operator">=</span> <span class="token function">median</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>
gen wage_diff <span class="token operator">=</span> wage<span class="token operator">-</span>wage_p50

<span class="token comment">// 行业标准差	</span>
bysort industry<span class="token operator">:</span> egen wage_sd <span class="token operator">=</span> <span class="token function">sd</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>

<span class="token comment">// 重新编码</span>
sort industry occupation
browse industry occupation
egen indocc123 <span class="token operator">=</span> <span class="token function">group</span><span class="token punctuation">(</span>industry occupation<span class="token punctuation">)</span> 
</code></pre> 
<p>应用实例：计算几何加权实际汇率<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          E 
         
        
          R 
         
        
          R 
         
        
          = 
         
         
         
           ∏ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           N 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
          
          
            w 
           
          
            i 
           
          
         
        
          ) 
         
        
       
         ERR = \prod_{i=1}^{N}(x_i^{w_i}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">ERR</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.106em; vertical-align: -1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.8283em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∏</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7463em;"><span class="" style="top: -2.4231em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span class="" style="top: -3.1449em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3281em;"><span class="" style="top: -2.357em; margin-left: -0.0269em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2769em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br> 其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        x 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span>是汇率，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
      
        w 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span></span></span></span></span>是权重</p> 
<pre><code class="prism language-java">clear
input firm country   exch     export 
    <span class="token number">1</span> 		<span class="token number">1</span> 	    <span class="token number">8</span> 	  	  <span class="token number">60</span> 
    <span class="token number">1</span> 		<span class="token number">2</span> 	    <span class="token number">0.03</span> 	  <span class="token number">50</span> 
    <span class="token number">1</span> 		<span class="token number">3</span> 	   <span class="token number">10</span> 	  	  <span class="token number">80</span> 
    <span class="token number">2</span> 		<span class="token number">2</span> 	    <span class="token number">0.03</span> 	  <span class="token number">68</span> 
    <span class="token number">2</span> 		<span class="token number">4</span> 	    <span class="token number">3</span> 	  	  <span class="token number">80</span> 
    <span class="token number">3</span> 		<span class="token number">2</span> 	    <span class="token number">0.03</span> 	  <span class="token number">200</span> 
    <span class="token number">3</span> 		<span class="token number">3</span> 	   <span class="token number">10</span> 	  	  <span class="token number">90</span> 
    <span class="token number">3</span> 		<span class="token number">4</span> 	    <span class="token number">3</span> 	  	  <span class="token number">250</span> 
    <span class="token number">3</span> 		<span class="token number">5</span> 	    <span class="token number">1.1</span> 	  <span class="token number">120</span>
end
</code></pre> 
<p>计算权重</p> 
<pre><code class="prism language-java">bysort firm<span class="token operator">:</span> egen weight <span class="token operator">=</span> <span class="token function">pc</span><span class="token punctuation">(</span>export<span class="token punctuation">)</span><span class="token punctuation">,</span> prop
list<span class="token punctuation">,</span> <span class="token function">sepby</span><span class="token punctuation">(</span>firm<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2c/e1/6yITy6ov_o.png" alt="在这里插入图片描述"></p> 
<p>计算EER：思路是将连乘积的问题转化为求和问题，对数化</p> 
<pre><code class="prism language-java">gen lnexch <span class="token operator">=</span> <span class="token function">ln</span><span class="token punctuation">(</span>exch<span class="token punctuation">)</span>
gen lnexch_x_weight <span class="token operator">=</span> lnexch<span class="token operator">*</span>weight
bysort firm<span class="token operator">:</span> egen sum_exch <span class="token operator">=</span> <span class="token function">total</span><span class="token punctuation">(</span>lnexch_x_weight<span class="token punctuation">)</span>
gen EER <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span>sum_exch<span class="token punctuation">)</span>
list<span class="token punctuation">,</span> <span class="token function">sepby</span><span class="token punctuation">(</span>firm<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/64/25/sD4uw0RE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="egen_487"></a>其他egen函数</h3> 
<ul><li><code>egen_inequal</code> // 生成不平等和贫困指数的函数</li><li><code>egenmmed</code> // create a moving median</li><li><code>egenmsd</code> // create a moving standard deviation</li><li><code>egenms</code> // create a moving sum</li><li><code>asgen</code> // generates weighted average mean using an existing variable as weight</li><li><code>egenmisc</code> // provide various egen functions</li><li><code>egenmore</code> // 各类新增的扩展函数</li><li><code>ereplace</code> // 这个一定要介绍</li><li><code>ewma</code> // calculates an exponentially weighted moving average</li><li><code>gtools</code> // provide a fast implementation of common group commands</li><li><code>tsegen</code> // call an egen function using a time-series varlist</li></ul> 
<h2><a id="_500"></a>文字日期变量的处理</h2> 
<p>导入数据</p> 
<pre><code class="prism language-java">clear
input str10 date 	str10 date_str 
	  <span class="token number">1967</span>q1    	<span class="token string">"01/29/1960"</span>
	  <span class="token number">1967</span>q2		<span class="token string">"01/30/1960"</span>
	  <span class="token number">1967</span>q3		<span class="token string">"01/31/1960"</span>
	  <span class="token number">1967</span>q4		<span class="token string">"02/01/1960"</span>
	  <span class="token number">1968</span>q1		<span class="token string">"02/02/1960"</span>
end
</code></pre> 
<p><img src="https://images2.imgbox.com/60/ab/19dj18Pq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">gen date_back1 <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span>date_str<span class="token punctuation">,</span> <span class="token string">"MDY"</span><span class="token punctuation">)</span> <span class="token comment">// 转化为数字格式</span>
format date_back1 <span class="token operator">%</span>td <span class="token comment">//定义日期显示格式</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/22/0b/fHj7u1I3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_524"></a>将季度数据调整为月度数据</h3> 
<pre><code class="prism language-java"><span class="token operator">*</span> 示例数据
clear
input str10 date <span class="token keyword">float</span> value
<span class="token string">"2017-03-31"</span> <span class="token number">10</span>
<span class="token string">"2017-06-30"</span> <span class="token number">20</span>
<span class="token string">"2017-09-30"</span> <span class="token number">30</span>
<span class="token string">"2017-12-31"</span> <span class="token number">40</span>
end

<span class="token operator">*</span> 将日期格式转换为日期变量
gen date_var <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token string">"YMD"</span><span class="token punctuation">)</span>

<span class="token operator">*</span> 按日期排序并设置为时间序列
sort date_var
tsset date_var

<span class="token operator">*</span> 将季度数据扩展到月度
expand <span class="token number">3</span>
sort date_var
scalar start_mon <span class="token operator">=</span> <span class="token function">mofd</span><span class="token punctuation">(</span>date_var<span class="token punctuation">)</span>
gen month <span class="token operator">=</span> start_mon <span class="token operator">+</span> _n <span class="token operator">-</span> <span class="token number">3</span>



<span class="token operator">*</span> 输出结果
format month <span class="token operator">%</span>tm
list
</code></pre> 
<p><img src="https://images2.imgbox.com/05/95/cb5p8OPa_o.png" alt="在这里插入图片描述"><br> 日期变量互转参考表<br> <img src="https://images2.imgbox.com/3b/b9/oHaDSVrw_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_561"></a>抽样</h2> 
<h3><a id="_563"></a>不放回抽样</h3> 
<p>随机抽样</p> 
<pre><code class="prism language-java"><span class="token comment">// 生成随机数</span>
clear 
set obs <span class="token number">10</span>
gen x <span class="token operator">=</span> _n
save <span class="token class-name">P4_data1</span><span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace

<span class="token comment">// *-抽取 30% 的观察值</span>
use <span class="token class-name">P4_data1</span><span class="token punctuation">,</span> clear
browse
sample <span class="token number">30</span>

<span class="token comment">// *-随机抽取 5 个观察值             </span>
use <span class="token class-name">P4_data1</span><span class="token punctuation">,</span> clear
sample <span class="token number">5</span><span class="token punctuation">,</span> count
browse
</code></pre> 
<p>分组抽样</p> 
<pre><code class="prism language-java"><span class="token comment">// *-抽取 50% 的观察值 by(id)</span>
use <span class="token class-name">P4_xtdata</span><span class="token punctuation">,</span> clear
browse
sample <span class="token number">50</span><span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
xtset id year

<span class="token comment">// *-抽取 50% 的观察值 by(race)</span>
sysuse nlsw88<span class="token punctuation">,</span> clear
table race
sample <span class="token number">50</span><span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>race<span class="token punctuation">)</span>
table race
</code></pre> 
<p><img src="https://images2.imgbox.com/54/e3/GraXV61y_o.png" alt="在这里插入图片描述"></p> 
<p>分块抽样</p> 
<pre><code class="prism language-java"><span class="token comment">// 机抽取三家公司 cluster(id)将id相同的样本合并为一个 wor 不放回抽样</span>
use <span class="token class-name">P4_xtdata</span><span class="token punctuation">,</span> clear
browse
gsample <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> wor

use <span class="token class-name">P4_xtdata</span><span class="token punctuation">,</span> clear
browse
gsample <span class="token number">40</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> wor percent <span class="token comment">//随机抽取 40% 的公司</span>
</code></pre> 
<h3><a id="_613"></a>有放回抽样</h3> 
<pre><code class="prism language-java">use <span class="token class-name">P4_data1</span><span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
browse
bsample
sort x
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/71/LfSlnBcD_o.png" alt="在这里插入图片描述"></p> 
<p>对面板数据的有放回抽样</p> 
<pre><code class="prism language-java">use <span class="token class-name">P4_xtdata</span><span class="token punctuation">,</span> clear
browse

bsample<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token function">idcluster</span><span class="token punctuation">(</span>idnew<span class="token punctuation">)</span>
xtset idnew year
</code></pre> 
<p>有放回抽样的应用：bootstrap 标准误</p> 
<pre><code class="prism language-java">sysuse auto<span class="token punctuation">,</span> clear
	
bootstrap<span class="token punctuation">,</span> <span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token operator">:</span>  <span class="token comment">///</span>
        reg price weight mpg foreign<span class="token punctuation">,</span> noheader

<span class="token comment">// *-等价写法:</span>
reg price weight mpg foreign<span class="token punctuation">,</span>  <span class="token comment">///</span>
        <span class="token function">vce</span><span class="token punctuation">(</span>bootstrap<span class="token punctuation">,</span> <span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token function">seed</span><span class="token punctuation">(</span><span class="token number">1357</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aee4d91f02e81adb31f9838117148475/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Segment Anything论文翻译，SAM模型，SAM论文，SAM论文翻译；一个用于图像分割的新任务、模型和数据集；SA-1B数据集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2dd7e6a911eeff9e0797b751b51f086d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">stata变量引用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>