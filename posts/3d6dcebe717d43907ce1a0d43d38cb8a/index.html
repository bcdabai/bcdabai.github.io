<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot 2.2.5 整合spring-boot-starter-mail邮件功能，实现发送多种邮件的功能 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot 2.2.5 整合spring-boot-starter-mail邮件功能，实现发送多种邮件的功能" />
<meta property="og:description" content="说明 以目前IT系统功能来看，邮件功能是非常重要的一个功能。例如：找回密码、邮箱验证，邮件动态码、忘记密码，邮件营销等，都需要用到邮件功能。spring-boot-starter-mail支持多种邮件，包括gmail，qq，163，126等等，本文用到的是网易126邮箱。
完整代码地址在结尾！！ 第一步，注册126邮箱， 并且在设置里面授权开通smtp服务，此时会获取到一个邮箱的授权吗，后面要用到，此处不多赘述，不懂请自行百度查询 第二步，在pom.xml加入依赖，如下 &lt;!-- mail --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt; &lt;/dependency&gt; 第三步，配置application.yml，避免端口冲突 server: port: 8081 spring: application: name: mail-demo-server mail: host: smtp.126.com # 不同的邮箱不一致，请自行百度查询 port: 25 # 126邮箱默认25 username: xxx # 发送邮箱 password: xxx # 授权码 protocol: smtp default-encoding: utf-8 # properties: # 此处可以添加ssl端口 # mail.smtp.auth: true # mail.smtp.starttls.enable: true # mail.smtp.starttls.required: true # mail.smtp.socketFactory.port: 465 # mail.smtp.socketFactory.class: javax.net.ssl.SSLSocketFactory # mail.smtp.socketFactory.fallback: false 第四步，创建类服务类，MailService，MailServiceImpl，如下 MailService public interface MailService { /** * 发送简单邮件的接口 * * @param mail 接收邮箱 * @param subject 主题 * @param text 内容 * @return */ boolean sendSimpleMail(String mail, String subject, String text); /** * 发送带附件邮件的接口 * * @param mail 接收邮箱 * @param subject 主题 * @param text 内容 * @param path 附近路径 * @return */ boolean sendMimeMail(String mail, String subject, String text, String path) throws Exception ; /** * 发送带附件邮件的接口，并且正文显示附件内容 * * @param mail 接收邮箱 * @param subject 主题 * @return */ boolean sendMimeMail(String mail, String subject) throws Exception ; } MailServiceImpl import com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3d6dcebe717d43907ce1a0d43d38cb8a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-20T11:45:00+08:00" />
<meta property="article:modified_time" content="2023-12-20T11:45:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot 2.2.5 整合spring-boot-starter-mail邮件功能，实现发送多种邮件的功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>说明</h3> 
<p>以目前IT系统功能来看，邮件功能是非常重要的一个功能。例如：找回密码、邮箱验证，邮件动态码、忘记密码，邮件营销等，都需要用到邮件功能。spring-boot-starter-mail支持多种邮件，包括gmail，qq，163，126等等，本文用到的是网易126邮箱。</p> 
<h3><a id="_3"></a>完整代码地址在结尾！！</h3> 
<h3><a id="126_5"></a>第一步，注册126邮箱，</h3> 
<ol><li>并且在设置里面授权开通smtp服务，此时会获取到一个邮箱的授权吗，后面要用到，此处不多赘述，不懂请自行百度查询</li></ol> 
<h3><a id="pomxml_8"></a>第二步，在pom.xml加入依赖，如下</h3> 
<pre><code>&lt;!-- mail --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre> 
<h3><a id="applicationyml_17"></a>第三步，配置application.yml，避免端口冲突</h3> 
<pre><code>server:
  port: 8081

spring:
  application:
    name: mail-demo-server
  mail:
    host: smtp.126.com # 不同的邮箱不一致，请自行百度查询
    port: 25 # 126邮箱默认25
    username: xxx # 发送邮箱
    password: xxx # 授权码
    protocol: smtp
    default-encoding: utf-8
#    properties: # 此处可以添加ssl端口
#      mail.smtp.auth: true
#      mail.smtp.starttls.enable: true
#      mail.smtp.starttls.required: true
#      mail.smtp.socketFactory.port: 465
#      mail.smtp.socketFactory.class: javax.net.ssl.SSLSocketFactory
#      mail.smtp.socketFactory.fallback: false
</code></pre> 
<h3><a id="MailServiceMailServiceImpl_41"></a>第四步，创建类服务类，MailService，MailServiceImpl，如下</h3> 
<h4><a id="MailService_42"></a>MailService</h4> 
<pre><code>public interface MailService {

    /**
     * 发送简单邮件的接口
     *
     * @param mail     接收邮箱
     * @param subject     主题
     * @param text     内容
     * @return
     */
    boolean sendSimpleMail(String mail, String subject, String text);

    /**
     * 发送带附件邮件的接口
     *
     * @param mail     接收邮箱
     * @param subject     主题
     * @param text     内容
     * @param path     附近路径
     * @return
     */
    boolean sendMimeMail(String mail, String subject, String text, String path) throws Exception ;

    /**
     * 发送带附件邮件的接口，并且正文显示附件内容
     *
     * @param mail     接收邮箱
     * @param subject     主题
     * @return
     */
    boolean sendMimeMail(String mail, String subject) throws Exception ;

}
</code></pre> 
<h4><a id="MailServiceImpl_79"></a>MailServiceImpl</h4> 
<pre><code>import com.luoyu.mail.service.MailService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;

import javax.mail.internet.MimeMessage;
import java.io.File;

@Slf4j
@Service
public class MailServiceImpl implements MailService {

    @Value("${spring.mail.username}")
    private String username;

    @Autowired
    private JavaMailSender mailSender;

    /**
     * 发送简单邮件的接口
     *
     * @param mail     接收邮箱
     * @param subject     主题
     * @param text     内容
     * @return
     */
    @Override
    public boolean sendSimpleMail(String mail, String subject, String text) {
        //创建邮件内容
        SimpleMailMessage message=new SimpleMailMessage();
        //这里指的是发送者的账号
        message.setFrom(username);
        message.setTo(mail);
        message.setSubject(subject);
        message.setText(text);
        //发送邮件
        mailSender.send(message);
        return true;
    }

    @Override
    public boolean sendMimeMail(String mail, String subject, String text, String path) throws Exception {
        MimeMessage mimeMessage = mailSender.createMimeMessage();
        // 设置utf-8或GBK编码，否则邮件会有乱码
        MimeMessageHelper messageHelper = new MimeMessageHelper(mimeMessage, true, "UTF-8");
        messageHelper.setFrom(username);
        messageHelper.setTo(mail);
        messageHelper.setSubject(subject);
        messageHelper.setText(text, true);
        FileSystemResource file = new FileSystemResource(new File(path));
        String fileName = path.substring(path.lastIndexOf(File.separator));
        messageHelper.addAttachment(fileName,file);
        mailSender.send(mimeMessage);
        return true;
    }

    @Override
    public boolean sendMimeMail(String mail, String subject) throws Exception {
        MimeMessage mimeMessage = mailSender.createMimeMessage();

        MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true);
        helper.setFrom(username);
        helper.setTo(mail);
        helper.setSubject(subject);
        // 注意&lt;img/&gt;标签，src='cid:jpg'，'cid'是contentId的缩写，'jpg'是一个标记
        helper.setText("&lt;html&gt;&lt;body&gt;&lt;img src=\"cid:jpg\"&gt;&lt;/body&gt;&lt;/html&gt;", true);
        // 加载文件资源，作为附件
        FileSystemResource file = new FileSystemResource(new File("/Users/luoyu/Downloads/赤瞳.jpg"));
        // 调用MimeMessageHelper的addInline方法替代成文件('jpg[标记]', file[文件])
        helper.addInline("jpg", file);
        // 发送邮件
        mailSender.send(mimeMessage);
        return true;
    }

}
</code></pre> 
<h3><a id="MailApplicationTests_164"></a>第五步，创建类单元测试类，MailApplicationTests，并进行测试，如下</h3> 
<pre><code>import com.luoyu.mail.service.MailService;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@Slf4j
// 获取启动类，加载配置，确定装载 Spring 程序的装载方法，它回去寻找 主配置启动类（被 @SpringBootApplication 注解的）
@SpringBootTest
class MailApplicationTests {

	@Autowired
	private MailService mailService;

	@Test
	void sendSimpleMailTest() {
		mailService.sendSimpleMail("xxx", "jhx测试邮件主题", "jhx测试邮件内容");
	}

	@Test
	void sendMimeMailTest1() throws Exception {
		mailService.sendMimeMail("xxx", "jhx测试邮件主题", "jhx测试邮件内容", "/Users/luoyu/Downloads/赤瞳.jpg");
	}

	@Test
	void sendMimeMailTest2() throws Exception {
		mailService.sendMimeMail("xxx", "jhx测试邮件主题");
	}

	@BeforeEach
	void testBefore(){
		log.info("测试开始!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
	}

	@AfterEach
	void testAfter(){
		log.info("测试结束!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
	}

}
</code></pre> 
<h4><a id="_210"></a>注意</h4> 
<ol><li>配置文件里面的密码是我们邮箱的授权码，不是登陆的密码</li><li>有上传到服务器中报错无法使用的，比如阿里云，腾讯云，默认是关闭的，可以去控制台申请解封25端口</li></ol> 
<h4><a id="httpsgithubcomJinhx128springbootdemohttpsgithubcomJinhx128springbootdemo_214"></a>完整代码地址：<a href="https://github.com/Jinhx128/springboot-demo">https://github.com/Jinhx128/springboot-demo</a></h4> 
<h4><a id="modulemaildemo_215"></a>注：此工程包含多个module，本文所用代码均在mail-demo模块下</h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/96d36689efa222f6846b54f7a9382935/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android开发中报错总结之一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/99034cefd92af815072200f0c16299fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue路由跳转传参</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>