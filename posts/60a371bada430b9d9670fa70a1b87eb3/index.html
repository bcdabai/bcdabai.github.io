<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解决PageHelper版本不匹配，结果可能全部返回问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="解决PageHelper版本不匹配，结果可能全部返回问题" />
<meta property="og:description" content="1.问题：
使用 pagehelper ，如果和mybatis版本不匹配，就会出现返回结果错误问题，比如：本来想返回pageNum：1，pageSize:1的数据，但却是全部返回。自己的代码没问题的情况下，最有可能的就是版本不匹配的问题。
2.解决方案：
出现这个问题很可能就是版本不匹配。可以使用下面的版本进行测试，本人测试成功。
&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.5&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt; &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.4.1&lt;/version&gt; &lt;/dependency&gt; 3.pagehelper使用示例如下：
可以看到：使用的时候只需要pagehelper.startPage方法；然后在new Page放入返回列表就行。
3.1.server impl层
@Override public PageInfo listForAdmin(Integer pageNum, Integer pageSize) { PageHelper.startPage(pageNum, pageSize, &#34;type, order_num&#34;); List&lt;Category&gt; categoryList = categoryMapper.selectList(); PageInfo pageInfo = new PageInfo(categoryList); return pageInfo; } 3.2.service层 PageInfo listForAdmin(Integer pageNum, Integer pageSize); 3.3.controller层
@ApiOperation(&#34;后台目录列表&#34;) @GetMapping(&#34;admin/category/list&#34;) @ResponseBody public ApiRestResponse listCategoryForAdmin(@RequestParam Integer pageNum, @RequestParam Integer pageSize) { PageInfo pageInfo = categoryService." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/60a371bada430b9d9670fa70a1b87eb3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-22T23:06:48+08:00" />
<meta property="article:modified_time" content="2022-12-22T23:06:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解决PageHelper版本不匹配，结果可能全部返回问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>1.问题：</strong></p> 
<p>使用 pagehelper ，如果和mybatis版本不匹配，就会出现返回结果错误问题，比如：本来想返回pageNum：1，pageSize:1的数据，但却是全部返回。自己的代码没问题的情况下，最有可能的就是版本不匹配的问题。</p> 
<p><strong>2.解决方案：</strong></p> 
<p>出现这个问题很可能就是版本不匹配。可以使用下面的版本进行测试，本人测试成功。</p> 
<pre><code class="language-XML">&lt;dependency&gt;
            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
            &lt;version&gt;3.5.5&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.1.3&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
            &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.4.1&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<p><strong>3.pagehelper使用示例如下：</strong></p> 
<p>可以看到：使用的时候只需要pagehelper.startPage方法；然后在new Page放入返回列表就行。</p> 
<p>3.1.server impl层</p> 
<pre><code class="language-java"> @Override
    public PageInfo listForAdmin(Integer pageNum, Integer pageSize) {
        PageHelper.startPage(pageNum, pageSize, "type, order_num");
        List&lt;Category&gt; categoryList = categoryMapper.selectList();
        PageInfo pageInfo = new PageInfo(categoryList);
        return pageInfo;
    }</code></pre> 
<p>3.2.service层 </p> 
<pre><code class="language-java">PageInfo listForAdmin(Integer pageNum, Integer pageSize);</code></pre> 
<p>3.3.controller层</p> 
<pre><code class="language-java">@ApiOperation("后台目录列表")
    @GetMapping("admin/category/list")
    @ResponseBody
    public ApiRestResponse listCategoryForAdmin(@RequestParam Integer pageNum,
            @RequestParam Integer pageSize) {
        PageInfo pageInfo = categoryService.listForAdmin(pageNum, pageSize);
        return ApiRestResponse.success(pageInfo);
    }</code></pre> 
<p>希望能够帮助你，谢谢！</p> 
<p>---------------------------------------------------------------------------------------------------------------------------------</p> 
<p><strong>看到的一个很好的pagehelper问题，在这里记录，以免下次自己遇到同样的问题：</strong></p> 
<h3>你知道的越多，不知道的就越多，业余的像一棵小草！</h3> 
<p>成功路上并不拥挤，因为坚持的人不多。</p> 
<h3><a name="t1"></a>编辑：业余草</h3> 
<p>blog.csdn.net/qq_35080796</p> 
<h3><a name="t2"></a>推荐：https://www.xttblog.com/?p=5184</h3> 
<h3><a name="t3"></a>1.问题</h3> 
<p>1.1.PageHelper先开启分页，后对list数据操作</p> 
<pre><code class="language-java">@Override

    public PageInfo&lt;HdQueryVo&gt; getRecordsByView(int pageNo, int pageSize) {

        PageHelper.startPage(pageNo,pageSize);

        List&lt;HdQueryVo&gt; hdQueryVosByView = actionMapper.getActionByView();


        List&lt;HdQueryVo&gt; hdQueryVos = new ArrayList&lt;&gt;();


        for (HdQueryVo hdQueryVo : hdQueryVosByView) {

            HdQueryVo hdQueryVoSingle = new HdQueryVo();

            hdQueryVoSingle.setHdId(hdQueryVo.getHdId());

            hdQueryVoSingle.setHdType(hdQueryVo.getHdType());

            hdQueryVoSingle.setHdTitle(hdQueryVo.getHdTitle());

            hdQueryVoSingle.setHdStartDate(hdQueryVo.getHdStartDate());

            hdQueryVoSingle.setHdEndDate(hdQueryVo.getHdEndDate());

            hdQueryVoSingle.setHdStatus(hdQueryVo.getHdStatus());

            hdQueryVoSingle.setHdImage(hdQueryVo.getHdImage());

            hdQueryVoSingle.setHdNumber(hdQueryVo.getHdNumber());

            hdQueryVoSingle.setGmtCreate(hdQueryVo.getGmtCreate());

            hdQueryVoSingle.setGmtModified(hdQueryVo.getGmtModified());

            hdQueryVoSingle.setUserId(hdQueryVo.getUserId());

            if (hdQueryVo.getHdType().equals(0)) {

                hdQueryVoSingle.setHdJoinUsers(onlineWorksMapper.getOnlineJoinUsers(hdQueryVo.getHdId()));

            } else {

                hdQueryVoSingle.setHdJoinUsers(offlineUsersMapper.getOfflineJoinUsers(hdQueryVo.getHdId()));

            }

            hdQueryVos.add(hdQueryVoSingle);

        }

        PageInfo&lt;HdQueryVo&gt; pageViewInfo = new PageInfo&lt;&gt;(hdQueryVos);


        return pageViewInfo;

    }</code></pre> 
<p>可以分页，但是数据量错误，total始终等于每页数据量，即pageSize</p> 
<p><img alt="" src="https://images2.imgbox.com/17/f7/j3ivqFo0_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/c4/f1/60dMJvkD_o.png"></p> 
<p>1.2.先对list数据进行操作，后开启分页</p> 
<pre><code class="language-java">@Override

    public PageInfo&lt;HdQueryVo&gt; getRecordsByView(int pageNo, int pageSize) {

        

        List&lt;HdQueryVo&gt; hdQueryVosByView = actionMapper.getActionByView();


        List&lt;HdQueryVo&gt; hdQueryVos = new ArrayList&lt;&gt;();


        for (HdQueryVo hdQueryVo : hdQueryVosByView) {

            HdQueryVo hdQueryVoSingle = new HdQueryVo();

            hdQueryVoSingle.setHdId(hdQueryVo.getHdId());

            hdQueryVoSingle.setHdType(hdQueryVo.getHdType());

            hdQueryVoSingle.setHdTitle(hdQueryVo.getHdTitle());

            hdQueryVoSingle.setHdStartDate(hdQueryVo.getHdStartDate());

            hdQueryVoSingle.setHdEndDate(hdQueryVo.getHdEndDate());

            hdQueryVoSingle.setHdStatus(hdQueryVo.getHdStatus());

            hdQueryVoSingle.setHdImage(hdQueryVo.getHdImage());

            hdQueryVoSingle.setHdNumber(hdQueryVo.getHdNumber());

            hdQueryVoSingle.setGmtCreate(hdQueryVo.getGmtCreate());

            hdQueryVoSingle.setGmtModified(hdQueryVo.getGmtModified());

            hdQueryVoSingle.setUserId(hdQueryVo.getUserId());

            if (hdQueryVo.getHdType().equals(0)) {

                hdQueryVoSingle.setHdJoinUsers(onlineWorksMapper.getOnlineJoinUsers(hdQueryVo.getHdId()));

            } else {

                hdQueryVoSingle.setHdJoinUsers(offlineUsersMapper.getOfflineJoinUsers(hdQueryVo.getHdId()));

            }

            hdQueryVos.add(hdQueryVoSingle);

        }

        PageHelper.startPage(pageNo,pageSize);

        PageInfo&lt;HdQueryVo&gt; pageViewInfo = new PageInfo&lt;&gt;(hdQueryVos);


        return pageViewInfo;

    }</code></pre> 
<p>​​​​​​​</p> 
<p>数据可以查询出来，总数total也正确，但是分页功能失效。</p> 
<p><img alt="" src="https://images2.imgbox.com/7d/22/DIB6KSkU_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/ca/20/2w94cAm8_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/30/d0/4aJ9mTbp_o.png"></p> 
<h2><a name="t4"></a><span style="color:#fe2c24;"><strong>2.原因（重点之重的地方）</strong></span></h2> 
<h2><strong><span style="color:#fe2c24;">PageHelper中startPage开启分页方法只对后面的sql查询起作用</span></strong></h2> 
<p>1.1 错误原因是提前开启分页后，对list操作，即<code>PageInfo pageViewInfo = new PageInfo&lt;&gt;(hdQueryVos);</code></p> 
<p><img alt="" src="https://images2.imgbox.com/3d/3a/ud9uDrWY_o.png"></p> 
<pre><code class="language-java">/**

* 包装Page对象

*

* @param list

*/

public PageInfo(List list) {

this(list, 8);

}</code></pre> 
<p>​​​​​​​</p> 
<p>只是把list转为PageInfo对象，不影响前面分页数据的操作</p> 
<p>1.2 错误原因是先对list操作后，开启翻页后没有sql语句</p> 
<p><img alt="" src="https://images2.imgbox.com/08/0c/aPx0XCtA_o.png"></p> 
<p>即sql语句没有参与分页查询</p> 
<h3><a name="t5"></a>3.解决方案</h3> 
<p>直接对分页后的PageInfo对象中的数据进行操作</p> 
<ul><li> <p>对list集合操作，先取出PageInfo里的list集合数据，再对数据进行相关操作</p> </li><li> <p>将操作完后的list集合再次存到PageInfo里，进行return</p> </li></ul> 
<p><img alt="" src="https://images2.imgbox.com/25/7e/RhVE1cGp_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/14/aa/eqU0UBDx_o.png"></p> 
<pre></pre> 
<pre><code class="language-java">@Override

    public PageInfo&lt;HdQueryVo&gt; getRecordsByView(int pageNo, int pageSize) {

        PageInfo&lt;HdQueryVo&gt; source = PageHelper.startPage(pageNo, pageSize).doSelectPageInfo(()-&gt;{

            actionMapper.getActionByView();

        });

        // 需要转换的对象

        PageInfo&lt;HdQueryVo&gt; target = new PageInfo&lt;&gt;();

        // 复制分页属性

        BeanUtils.copyProperties(source, target);

        // 对查询的list进行下一步操作，比如类型转换后

        List&lt;HdQueryVo&gt; collect = source.getList().stream().collect(Collectors.toList());

        List&lt;HdQueryVo&gt; hdQueryVos = new ArrayList&lt;&gt;();


        for (HdQueryVo hdQueryVo : collect) {

            HdQueryVo hdQueryVoSingle = new HdQueryVo();

            hdQueryVoSingle.setHdId(hdQueryVo.getHdId());

            hdQueryVoSingle.setHdType(hdQueryVo.getHdType());

            hdQueryVoSingle.setHdTitle(hdQueryVo.getHdTitle());

            hdQueryVoSingle.setHdStartDate(hdQueryVo.getHdStartDate());

            hdQueryVoSingle.setHdEndDate(hdQueryVo.getHdEndDate());

            hdQueryVoSingle.setHdStatus(hdQueryVo.getHdStatus());

            hdQueryVoSingle.setHdImage(hdQueryVo.getHdImage());

            hdQueryVoSingle.setHdNumber(hdQueryVo.getHdNumber());

            hdQueryVoSingle.setGmtCreate(hdQueryVo.getGmtCreate());

            hdQueryVoSingle.setGmtModified(hdQueryVo.getGmtModified());

            hdQueryVoSingle.setUserId(hdQueryVo.getUserId());

            if (hdQueryVo.getHdType().equals(0)) {

                hdQueryVoSingle.setHdJoinUsers(onlineWorksMapper.getOnlineJoinUsers(hdQueryVo.getHdId()));

            } else {

                hdQueryVoSingle.setHdJoinUsers(offlineUsersMapper.getOfflineJoinUsers(hdQueryVo.getHdId()));

            }

            hdQueryVos.add(hdQueryVoSingle);

        }

        // 加工后的数据放入新的pageinfo

        target.setList(hdQueryVos);


        return target;

    }</code></pre> 
<p>​​​​​​​<img alt="" src="https://images2.imgbox.com/3f/b6/BejA5x8C_o.png"> <img alt="" src="https://images2.imgbox.com/68/b3/PsE4mLuZ_o.png"> <img alt="" src="https://images2.imgbox.com/9f/8a/QRRcKWxL_o.png"></p> 
<p>问题看起来不复杂，但初级和中级程序员遇到后基本上都素手无策。不会看源码，不知道钻研，永远都只停留在CRUD上，最多也就算是入了个门。</p> 
<p>参考资料：</p> 
<ul><li> <p>PageHelper官方文档：apidoc.gitee.com/free/Mybatis_PageHelper</p> </li><li> <p>PageHelper分页查询结果后再对数据List操作的方法</p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8599672c054fd3e37ce22e6ccde1330c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决OpenSSL SSL_read: Connection was reset, errno 10054</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56903114238772c4a803623d3b337a4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络实验之VTP协议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>