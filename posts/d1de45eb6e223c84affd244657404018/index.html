<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>29.STM32红外遥控器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="29.STM32红外遥控器" />
<meta property="og:description" content="1.红外遥控器 红外遥控是一种无线、非接触控制技术，具有抗干扰能力强，信息传输可靠，功耗低，成本低，易实现等显著优点，被诸多电子设备特别是家用电器广泛采用，并越来越多的应用到计算机系统中。
红外遥控的编码目前广泛使用的是：NEC Protocol 的PWM(脉冲宽度调制)和Philips
RC-5 Protocol 的PPM(脉冲位置调制)。
2.NEC协议 1.8位地址和8位指令长度；
2.地址和命令2次传输（确保可靠性）
3.PWM脉冲宽度调制，以发射红外载波的占空比代表“0”和“1”；
4. 载波频率为38Khz；
5.位时间为1.125ms或2.25ms（高电平持续时间来区分）；
3.NEC码位定义 一个脉冲对应560us的连续载波
一个逻辑1需要2.25ms（560us的脉冲&#43;1680us的低电平）
一个逻辑0需要1.125ms（560us的脉冲&#43;560us的低电平）
故接收到的信息（信号会相反）
逻辑1为（560us的低电平&#43;1680us的高电平）
逻辑0为（560us的低电平&#43;560us的高电平）
4.NEC遥控器指命 NEC遥控指令的数据格式为：同步码头、地址码、地址反码、控制码、控制反码。
同步码由一个9ms的低电平和一个4.5ms的高电平组成（启动信号，有按键按下了）
地址码、地址反码、控制码、控制反码均是8位数据格式。按照低位在前，高位在后的顺序发送。
（地址码，确认遥控器的地址，就是编号，接收端会检测）
（控制码，控制信息）
采用反码是为了增加传输的可靠性（可用于校验）。
控制码为10101000，低位在前高位在后就是00010101
后面有一部分是连发码(由9ms低电平&#43;2.5m高电平&#43;0.56ms低电平&#43;97.94ms高电平组成)，
如果在一帧数据发送完毕之后，按键仍然没有放开，则发射重复码，即连发码，可以通过统计连发码的次数来标记按键按下的长短/次数。
5.硬件连接 明显，红外遥控有一个输出引脚，叫DATE，我们得到编码需要解析，这时候就需要定时器输出捕获功能的引脚。
6.程序思路 1.开启定时器输入捕获，默认上升沿捕获。定时器的计数频率为1MHz,自动装载值位1000，也就是溢出时间为1/110^61000 = 10 ms
2.开启捕获中断和更新中断
3.当捕获到上升沿，就设置为捕获下降沿捕获，计算定时器数值差别，然后设置定时器计数值为0（清空定时器），同时设置Rmtsta的位4设置为1，标记已经捕获到上升沿。
4.当捕获到下降沿，就设置为捕获上升沿捕获，计算定时器数值差别，然后设置定时器计数值为0（清空定时器），同时检测Rmtsta的位4设置是否为1
5.对捕获值进行分析，300-800之间为（560中间）说明收到数据为0。1400-1800之前数据为1.2200-2600，说明是连发码，4200-4700就是同步码
6.如果是定时器发生溢出中断（就只能是连发信号这么长，97.94会溢出），那么分析，如果之前接收到了同步码，并且是第一次溢出，标记完成一次按键信息采集。
7.相关程序源码 红外函数
#include &#34;remote.h&#34; #include &#34;delay.h&#34; //	//本程序只供学习使用，未经作者许可，不得用于其它任何用途 //ALIENTEK 阿波罗STM32F429开发板 //红外遥控解码驱动代码	//正点原子@ALIENTEK //技术论坛:www.openedv.com //创建日期:2016/1/16 //版本：V1.0 //版权所有，盗版必究。 //Copyright(C) 广州市星翼电子科技有限公司 2014-2024 //All rights reserved	// TIM_HandleTypeDef TIM1_Handler; //定时器1句柄 //红外遥控初始化 //设置IO以及TIM1_CH1的输入捕获 //TIM1挂载APB2上 void Remote_Init(void) { TIM_IC_InitTypeDef TIM1_CH1Config; TIM1_Handler." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d1de45eb6e223c84affd244657404018/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-25T10:24:16+08:00" />
<meta property="article:modified_time" content="2022-09-25T10:24:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">29.STM32红外遥控器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.红外遥控器</h3> 
<p>红外遥控是一种无线、非接触控制技术，具有抗干扰能力强，信息传输可靠，功耗低，成本低，易实现等显著优点，被诸多电子设备特别是家用电器广泛采用，并越来越多的应用到计算机系统中。<br> 红外遥控的编码目前广泛使用的是：NEC Protocol 的PWM(脉冲宽度调制)和Philips<br> RC-5 Protocol 的PPM(脉冲位置调制)。</p> 
<h3><a id="2NEC_4"></a>2.NEC协议</h3> 
<p>1.8位地址和8位指令长度；<br> 2.地址和命令2次传输（确保可靠性）<br> 3.PWM脉冲宽度调制，以发射红外载波的占空比代表“0”和“1”；<br> <img src="https://images2.imgbox.com/15/15/qfMSEGDJ_o.png" alt="请添加图片描述"><br> 4. 载波频率为38Khz；<br> 5.位时间为1.125ms或2.25ms（高电平持续时间来区分）；</p> 
<h3><a id="3NEC_11"></a>3.NEC码位定义</h3> 
<p>一个脉冲对应560us的连续载波<br> 一个逻辑1需要2.25ms（560us的脉冲+1680us的低电平）<br> 一个逻辑0需要1.125ms（560us的脉冲+560us的低电平）<br> 故接收到的信息（信号会相反）<br> 逻辑1为（560us的低电平+1680us的高电平）<br> 逻辑0为（560us的低电平+560us的高电平）</p> 
<h3><a id="4NEC_18"></a>4.NEC遥控器指命</h3> 
<p>NEC遥控指令的数据格式为：同步码头、地址码、地址反码、控制码、控制反码。<br> 同步码由一个9ms的低电平和一个4.5ms的高电平组成（启动信号，有按键按下了）<br> 地址码、地址反码、控制码、控制反码均是8位数据格式。按照低位在前，高位在后的顺序发送。<br> （地址码，确认遥控器的地址，就是编号，接收端会检测）<br> （控制码，控制信息）<br> 采用反码是为了增加传输的可靠性（可用于校验）。<br> 控制码为10101000，低位在前高位在后就是00010101<br> 后面有一部分是连发码(由9ms低电平+2.5m高电平+0.56ms低电平+97.94ms高电平组成)，<br> 如果在一帧数据发送完毕之后，按键仍然没有放开，则发射重复码，即连发码，可以通过统计连发码的次数来标记按键按下的长短/次数。<br> <img src="https://images2.imgbox.com/57/b7/gImgxUT8_o.png" alt="请添加图片描述"></p> 
<h3><a id="5_29"></a>5.硬件连接</h3> 
<p>明显，红外遥控有一个输出引脚，叫DATE，我们得到编码需要解析，这时候就需要定时器输出捕获功能的引脚。<br> <img src="https://images2.imgbox.com/ae/34/E9tQNe5j_o.png" alt="请添加图片描述"></p> 
<h3><a id="6_32"></a>6.程序思路</h3> 
<p>1.开启定时器输入捕获，默认上升沿捕获。定时器的计数频率为1MHz,自动装载值位1000，也就是溢出时间为1/1<em>10^6</em>1000 = 10 ms<br> 2.开启捕获中断和更新中断<br> 3.当捕获到上升沿，就设置为捕获下降沿捕获，计算定时器数值差别，然后设置定时器计数值为0（清空定时器），同时设置Rmtsta的位4设置为1，标记已经捕获到上升沿。<br> 4.当捕获到下降沿，就设置为捕获上升沿捕获，计算定时器数值差别，然后设置定时器计数值为0（清空定时器），同时检测Rmtsta的位4设置是否为1<br> 5.对捕获值进行分析，300-800之间为（560中间）说明收到数据为0。1400-1800之前数据为1.2200-2600，说明是连发码，4200-4700就是同步码<br> 6.如果是定时器发生溢出中断（就只能是连发信号这么长，97.94会溢出），那么分析，如果之前接收到了同步码，并且是第一次溢出，标记完成一次按键信息采集。</p> 
<h3><a id="7_39"></a>7.相关程序源码</h3> 
<p>红外函数</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"remote.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"delay.h"</span></span>
<span class="token comment">//	 </span>
<span class="token comment">//本程序只供学习使用，未经作者许可，不得用于其它任何用途</span>
<span class="token comment">//ALIENTEK 阿波罗STM32F429开发板</span>
<span class="token comment">//红外遥控解码驱动代码	   </span>
<span class="token comment">//正点原子@ALIENTEK</span>
<span class="token comment">//技术论坛:www.openedv.com</span>
<span class="token comment">//创建日期:2016/1/16</span>
<span class="token comment">//版本：V1.0</span>
<span class="token comment">//版权所有，盗版必究。</span>
<span class="token comment">//Copyright(C) 广州市星翼电子科技有限公司 2014-2024</span>
<span class="token comment">//All rights reserved									  </span>
<span class="token comment">// 	</span>

TIM_HandleTypeDef TIM1_Handler<span class="token punctuation">;</span>      <span class="token comment">//定时器1句柄</span>

<span class="token comment">//红外遥控初始化</span>
<span class="token comment">//设置IO以及TIM1_CH1的输入捕获</span>
<span class="token comment">//TIM1挂载APB2上</span>
<span class="token keyword">void</span> <span class="token function">Remote_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  
    TIM_IC_InitTypeDef TIM1_CH1Config<span class="token punctuation">;</span>  
    
    TIM1_Handler<span class="token punctuation">.</span>Instance<span class="token operator">=</span>TIM1<span class="token punctuation">;</span>                          <span class="token comment">//通用定时器1</span>
    TIM1_Handler<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Prescaler<span class="token operator">=</span><span class="token number">179</span><span class="token punctuation">;</span>                     <span class="token comment">//预分频器,1M的计数频率,1us加1.</span>
    TIM1_Handler<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CounterMode<span class="token operator">=</span>TIM_COUNTERMODE_UP<span class="token punctuation">;</span>    <span class="token comment">//向上计数器</span>
    TIM1_Handler<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Period<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">;</span>                      <span class="token comment">//自动装载值</span>
    TIM1_Handler<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>ClockDivision<span class="token operator">=</span>TIM_CLOCKDIVISION_DIV1<span class="token punctuation">;</span>
    <span class="token function">HAL_TIM_IC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//初始化TIM1输入捕获参数</span>
    TIM1_CH1Config<span class="token punctuation">.</span>ICPolarity<span class="token operator">=</span>TIM_ICPOLARITY_RISING<span class="token punctuation">;</span>    <span class="token comment">//上升沿捕获</span>
    TIM1_CH1Config<span class="token punctuation">.</span>ICSelection<span class="token operator">=</span>TIM_ICSELECTION_DIRECTTI<span class="token punctuation">;</span><span class="token comment">//映射到TI1上</span>
    TIM1_CH1Config<span class="token punctuation">.</span>ICPrescaler<span class="token operator">=</span>TIM_ICPSC_DIV1<span class="token punctuation">;</span>          <span class="token comment">//配置输入分频，不分频</span>
    TIM1_CH1Config<span class="token punctuation">.</span>ICFilter<span class="token operator">=</span><span class="token number">0x03</span><span class="token punctuation">;</span>                       <span class="token comment">//IC1F=0003 8个定时器时钟周期滤波</span>
    <span class="token function">HAL_TIM_IC_ConfigChannel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span><span class="token operator">&amp;</span>TIM1_CH1Config<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置TIM1通道1</span>
    <span class="token function">HAL_TIM_IC_Start_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//开始捕获TIM1的通道1</span>
    <span class="token function">__HAL_TIM_ENABLE_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_IT_UPDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//使能更新中断</span>
<span class="token punctuation">}</span>

<span class="token comment">//定时器1底层驱动，时钟使能，引脚配置</span>
<span class="token comment">//此函数会被HAL_TIM_IC_Init()调用</span>
<span class="token comment">//htim:定时器1句柄</span>
<span class="token keyword">void</span> <span class="token function">HAL_TIM_IC_MspInit</span><span class="token punctuation">(</span>TIM_HandleTypeDef <span class="token operator">*</span>htim<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    GPIO_InitTypeDef GPIO_Initure<span class="token punctuation">;</span>
    <span class="token function">__HAL_RCC_TIM1_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//使能TIM1时钟</span>
    <span class="token function">__HAL_RCC_GPIOA_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//开启GPIOA时钟</span>
	
    GPIO_Initure<span class="token punctuation">.</span>Pin<span class="token operator">=</span>GPIO_PIN_8<span class="token punctuation">;</span>            <span class="token comment">//PA8</span>
    GPIO_Initure<span class="token punctuation">.</span>Mode<span class="token operator">=</span>GPIO_MODE_AF_PP<span class="token punctuation">;</span>      <span class="token comment">//复用推挽输出</span>
    GPIO_Initure<span class="token punctuation">.</span>Pull<span class="token operator">=</span>GPIO_PULLUP<span class="token punctuation">;</span>          <span class="token comment">//上拉</span>
    GPIO_Initure<span class="token punctuation">.</span>Speed<span class="token operator">=</span>GPIO_SPEED_HIGH<span class="token punctuation">;</span>     <span class="token comment">//高速</span>
    GPIO_Initure<span class="token punctuation">.</span>Alternate<span class="token operator">=</span>GPIO_AF1_TIM1<span class="token punctuation">;</span>   <span class="token comment">//PA8复用为TIM1通道1</span>
    <span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_Initure<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">HAL_NVIC_SetPriority</span><span class="token punctuation">(</span>TIM1_CC_IRQn<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置中断优先级，抢占优先级1，子优先级3</span>
    <span class="token function">HAL_NVIC_EnableIRQ</span><span class="token punctuation">(</span>TIM1_CC_IRQn<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//开启ITM1中断</span>

    <span class="token function">HAL_NVIC_SetPriority</span><span class="token punctuation">(</span>TIM1_UP_TIM10_IRQn<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置中断优先级，抢占优先级1，子优先级2</span>
    <span class="token function">HAL_NVIC_EnableIRQ</span><span class="token punctuation">(</span>TIM1_UP_TIM10_IRQn<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//开启ITM1中断   </span>
<span class="token punctuation">}</span>

<span class="token comment">//遥控器接收状态</span>
<span class="token comment">//[7]:收到了引导码标志</span>
<span class="token comment">//[6]:得到了一个按键的所有信息</span>
<span class="token comment">//[5]:保留	</span>
<span class="token comment">//[4]:标记上升沿是否已经被捕获								   </span>
<span class="token comment">//[3:0]:溢出计时器</span>
u8 	RmtSta<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	  	  
u16 Dval<span class="token punctuation">;</span>		<span class="token comment">//下降沿时计数器的值</span>
u32 RmtRec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//红外接收到的数据	   		    </span>
u8  RmtCnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//按键按下的次数	 </span>

<span class="token comment">//定时器1更新（溢出）中断</span>
<span class="token keyword">void</span> <span class="token function">TIM1_UP_TIM10_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_TIM_IRQHandler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定时器共用处理函数</span>
<span class="token punctuation">}</span> 

<span class="token comment">//定时器1输入捕获中断服务程序	 </span>
<span class="token keyword">void</span> <span class="token function">TIM1_CC_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 	
	<span class="token function">HAL_TIM_IRQHandler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定时器共用处理函数</span>
<span class="token punctuation">}</span>

<span class="token comment">//定时器更新（溢出）中断回调函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_TIM_PeriodElapsedCallback</span><span class="token punctuation">(</span>TIM_HandleTypeDef <span class="token operator">*</span>htim<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>htim<span class="token operator">-&gt;</span>Instance<span class="token operator">==</span>TIM1<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 		<span class="token keyword">if</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">//上次有数据被接收到了</span>
		<span class="token punctuation">{<!-- --></span>	
			RmtSta<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token number">0X10</span><span class="token punctuation">;</span>						<span class="token comment">//取消上升沿已经被捕获标记</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0X0F</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0X00</span><span class="token punctuation">)</span>RmtSta<span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">//标记已经完成一次按键的键值信息采集</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0X0F</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">14</span><span class="token punctuation">)</span>RmtSta<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				RmtSta<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空引导标识</span>
				RmtSta<span class="token operator">&amp;=</span><span class="token number">0XF0</span><span class="token punctuation">;</span>	<span class="token comment">//清空计数器	</span>
			<span class="token punctuation">}</span>						 	   	
		<span class="token punctuation">}</span>	
 
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//定时器输入捕获中断回调函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_TIM_IC_CaptureCallback</span><span class="token punctuation">(</span>TIM_HandleTypeDef <span class="token operator">*</span>htim<span class="token punctuation">)</span><span class="token comment">//捕获中断发生时执行</span>
<span class="token punctuation">{<!-- --></span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>htim<span class="token operator">-&gt;</span>Instance<span class="token operator">==</span>TIM1<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">if</span><span class="token punctuation">(</span>RDATA<span class="token punctuation">)</span><span class="token comment">//上升沿捕获</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">TIM_RESET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//一定要先清除原来的设置！！</span>
        <span class="token function">TIM_SET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">,</span>TIM_ICPOLARITY_FALLING<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//CC1P=1 设置为下降沿捕获</span>
        <span class="token function">__HAL_TIM_SET_COUNTER</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//清空定时器值   	  </span>
		  	RmtSta<span class="token operator">|=</span><span class="token number">0X10</span><span class="token punctuation">;</span>					<span class="token comment">//标记上升沿已经被捕获</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token comment">//下降沿捕获</span>
	<span class="token punctuation">{<!-- --></span>
        Dval<span class="token operator">=</span><span class="token function">HAL_TIM_ReadCapturedValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取CCR1也可以清CC1IF标志位</span>
        <span class="token function">TIM_RESET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//一定要先清除原来的设置！！</span>
        <span class="token function">TIM_SET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM1_Handler<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">,</span>TIM_ICPOLARITY_RISING<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置TIM5通道1上升沿捕获</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0X10</span><span class="token punctuation">)</span>					<span class="token comment">//完成一次高电平捕获 </span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0X80</span><span class="token punctuation">)</span><span class="token comment">//接收到了引导码</span>
			<span class="token punctuation">{<!-- --></span>
						
				<span class="token keyword">if</span><span class="token punctuation">(</span>Dval<span class="token operator">&gt;</span><span class="token number">300</span><span class="token operator">&amp;&amp;</span>Dval<span class="token operator">&lt;</span><span class="token number">800</span><span class="token punctuation">)</span>			<span class="token comment">//560为标准值,560us</span>
				<span class="token punctuation">{<!-- --></span>
					RmtRec<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//左移一位.</span>
					RmtRec<span class="token operator">|=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//接收到0	   </span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Dval<span class="token operator">&gt;</span><span class="token number">1400</span><span class="token operator">&amp;&amp;</span>Dval<span class="token operator">&lt;</span><span class="token number">1800</span><span class="token punctuation">)</span>	<span class="token comment">//1680为标准值,1680us</span>
				<span class="token punctuation">{<!-- --></span>
					RmtRec<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//左移一位.</span>
					RmtRec<span class="token operator">|=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//接收到1</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Dval<span class="token operator">&gt;</span><span class="token number">2200</span><span class="token operator">&amp;&amp;</span>Dval<span class="token operator">&lt;</span><span class="token number">2600</span><span class="token punctuation">)</span>	<span class="token comment">//得到按键键值增加的信息 2500为标准值2.5ms</span>
				<span class="token punctuation">{<!-- --></span>
					RmtCnt<span class="token operator">++</span><span class="token punctuation">;</span> 		<span class="token comment">//按键次数增加1次</span>
					RmtSta<span class="token operator">&amp;=</span><span class="token number">0XF0</span><span class="token punctuation">;</span>	<span class="token comment">//清空计时器		</span>
				<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Dval<span class="token operator">&gt;</span><span class="token number">4200</span><span class="token operator">&amp;&amp;</span>Dval<span class="token operator">&lt;</span><span class="token number">4700</span><span class="token punctuation">)</span>		<span class="token comment">//4500为标准值4.5ms</span>
				<span class="token punctuation">{<!-- --></span>
					RmtSta<span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>	<span class="token comment">//标记成功接收到了引导码</span>
					RmtCnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//清除按键次数计数器</span>
				<span class="token punctuation">}</span>						 
			<span class="token punctuation">}</span>
		RmtSta<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>				 		     	    
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//处理红外键盘</span>
<span class="token comment">//返回值:</span>
<span class="token comment">//	 0,没有任何按键按下</span>
<span class="token comment">//其他,按下的按键键值.</span>
u8 <span class="token function">Remote_Scan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>        
	u8 sta<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       
  u8 t1<span class="token punctuation">,</span>t2<span class="token punctuation">;</span>  
	<span class="token keyword">if</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//得到一个按键的所有信息了</span>
	<span class="token punctuation">{<!-- --></span> 
	    t1<span class="token operator">=</span>RmtRec<span class="token operator">&gt;&gt;</span><span class="token number">24</span><span class="token punctuation">;</span>			<span class="token comment">//得到地址码</span>
	    t2<span class="token operator">=</span><span class="token punctuation">(</span>RmtRec<span class="token operator">&gt;&gt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">;</span>	<span class="token comment">//得到地址反码 </span>
  
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sta<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token punctuation">(</span>RmtSta<span class="token operator">&amp;</span><span class="token number">0X80</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//按键数据错误/遥控已经没有按下了</span>
		<span class="token punctuation">{<!-- --></span>
		 	RmtSta<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清除接收到有效按键标识</span>
			RmtCnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//清除按键次数计数器</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>  
    <span class="token keyword">return</span> sta<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>主函数</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sys.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"usart.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"led.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"key.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lcd.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sdram.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"remote.h"</span></span>
<span class="token comment">/************************************************
 ALIENTEK 阿波罗STM32F429开发板实验31
 红外遥控器实验-HAL库函数版
 技术支持：www.openedv.com
 淘宝店铺：http://eboard.taobao.com  
 关注微信公众平台微信号："正点原子"，免费获取STM32资料。
 广州市星翼电子科技有限公司  
 作者：正点原子 @ALIENTEK
************************************************/</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	u8 key<span class="token punctuation">;</span>
	u8 t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	
	u8 <span class="token operator">*</span>str<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化HAL库   </span>
	<span class="token function">Stm32_Clock_Init</span><span class="token punctuation">(</span><span class="token number">360</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//设置时钟,180Mhz</span>
    <span class="token function">delay_init</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//初始化延时函数</span>
    <span class="token function">uart_init</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//初始化USART</span>
    <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化LED </span>
    <span class="token function">KEY_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化按键</span>
    <span class="token function">SDRAM_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">//初始化SDRAM</span>
    <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化LCD</span>
	<span class="token function">Remote_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				    <span class="token comment">//初始化	红外接收	</span>
  	POINT_COLOR<span class="token operator">=</span>RED<span class="token punctuation">;</span>
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"Apollo STM32F4/F7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"REMOTE TEST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"ATOM@ALIENTEK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"2016/1/16"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	 		
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"KEYVAL:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
   	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"KEYCNT:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
   	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"SYMBOL:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	    
	POINT_COLOR<span class="token operator">=</span>BLUE<span class="token punctuation">;</span><span class="token comment">//设置字体为蓝色  														 	  		    							  </span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		key<span class="token operator">=</span><span class="token function">Remote_Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>	 
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//显示键值</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span>RmtCnt<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示按键次数		  </span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"ERROR"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>			   
				<span class="token keyword">case</span> <span class="token number">162</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"POWER"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	    
				<span class="token keyword">case</span> <span class="token number">98</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"UP"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	    
				<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"PLAY"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		 
				<span class="token keyword">case</span> <span class="token number">226</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"ALIENTEK"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		  
				<span class="token keyword">case</span> <span class="token number">194</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"RIGHT"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	   
				<span class="token keyword">case</span> <span class="token number">34</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"LEFT"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		  
				<span class="token keyword">case</span> <span class="token number">224</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"VOL-"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		  
				<span class="token keyword">case</span> <span class="token number">168</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"DOWN"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		   
				<span class="token keyword">case</span> <span class="token number">144</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"VOL+"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		    
				<span class="token keyword">case</span> <span class="token number">104</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		  
				<span class="token keyword">case</span> <span class="token number">152</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	   
				<span class="token keyword">case</span> <span class="token number">176</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"3"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	    
				<span class="token keyword">case</span> <span class="token number">48</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		    
				<span class="token keyword">case</span> <span class="token number">24</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"5"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		    
				<span class="token keyword">case</span> <span class="token number">122</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"6"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		  
				<span class="token keyword">case</span> <span class="token number">16</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"7"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>			   					
				<span class="token keyword">case</span> <span class="token number">56</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"8"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>	 
				<span class="token keyword">case</span> <span class="token number">90</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"9"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">66</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">82</span><span class="token operator">:</span>str<span class="token operator">=</span><span class="token string">"DELETE"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>		 
			<span class="token punctuation">}</span>
				<span class="token function">LCD_Fill</span><span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">,</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//清楚之前的显示</span>
				<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示SYMBOL</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  
		t<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">==</span><span class="token number">20</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			LED0<span class="token operator">=</span><span class="token operator">!</span>LED0<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>						    
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/776be2dda4bd2c58ecf5815c4b5e76f7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">30.STM32 DS18B20</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/926b034b0430a400f7e9a0a258ae15e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是token？token是用来干嘛的？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>