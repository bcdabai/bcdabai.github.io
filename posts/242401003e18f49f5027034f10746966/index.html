<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>EGE基础：图像操作篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="EGE基础：图像操作篇" />
<meta property="og:description" content="EGE专栏：EGE专栏
目录 一、EGE的图像功能二、图片读取绘制简单演示1. 找一张保存在电脑上的图片2. 查看图片的路径(File path)3. 读取图像文件并绘制到窗口上4. 查看运行结果 三、文件路径1. 文件扩展名显示设置2. 绝对路径和相对路径 四、EGE 中的图像1. 计算机如何表示图像2. EGE中的图像3. 如何定义全局图像 五、EGE图像的使用流程六、图像的创建和销毁1. 创建图像 newimage()2. 图像的销毁 delimage() 七、获取图像1. 获取图像的四种方式1.1 从图形窗口获取图像（截屏）1.2 从图像文件中获取1.3 从另一个 PIMAGE 中获取1.4 从资源文件获取 2. 如何检测是否成功读取到图像2.1 利用getimage返回值判断2.2 利用getwidth, getheight判断 3. 图像数组，加载多张图像4. 图像缩放4.1 图片缩放的考虑4.2 使用EGE接口改变图像大小4.3 从文件中加载图像并缩放至指定大小4.4 缩放原图像 5. 内存泄漏 八、 图像绘制1. 图像普通绘制1.1 putimage()1.1.1 全图绘制1.1.2 部分绘制1.1.3 部分缩放绘制1.2 putimage_withalpha() 支持带透明度图像 2. 图像透明绘制2.1 putimage_alphablend() 图像半透明混合2.3 putimage_transparent() 指定图像透明像素2.4 putimage_alphatransparent() 3. 旋转绘图3.1 putimage_rotate()3.2 putimage_rotatezoom() 4. 模糊滤镜 六、图像其它操作1. 图像属性1.1 重设图像尺寸1.2 获取图像宽度和高度 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/242401003e18f49f5027034f10746966/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-01T22:42:33+08:00" />
<meta property="article:modified_time" content="2022-12-01T22:42:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">EGE基础：图像操作篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>EGE专栏：<a href="https://blog.csdn.net/qq_39151563/category_9311717.html">EGE专栏</a></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#EGE_11" rel="nofollow">一、EGE的图像功能</a></li><li><a href="#_35" rel="nofollow">二、图片读取绘制简单演示</a></li><li><ul><li><a href="#1__41" rel="nofollow">1. 找一张保存在电脑上的图片</a></li><li><a href="#2_File_path_47" rel="nofollow">2. 查看图片的路径(File path)</a></li><li><a href="#3__82" rel="nofollow">3. 读取图像文件并绘制到窗口上</a></li><li><a href="#4__115" rel="nofollow">4. 查看运行结果</a></li></ul> 
  </li><li><a href="#_123" rel="nofollow">三、文件路径</a></li><li><ul><li><a href="#1__124" rel="nofollow">1. 文件扩展名显示设置</a></li><li><a href="#2__132" rel="nofollow">2. 绝对路径和相对路径</a></li></ul> 
  </li><li><a href="#EGE__141" rel="nofollow">四、EGE 中的图像</a></li><li><ul><li><a href="#1__142" rel="nofollow">1. 计算机如何表示图像</a></li><li><a href="#2_EGE_164" rel="nofollow">2. EGE中的图像</a></li><li><a href="#3__188" rel="nofollow">3. 如何定义全局图像</a></li></ul> 
  </li><li><a href="#EGE_225" rel="nofollow">五、EGE图像的使用流程</a></li><li><a href="#_241" rel="nofollow">六、图像的创建和销毁</a></li><li><ul><li><a href="#1__newimage_247" rel="nofollow">1. 创建图像 newimage()</a></li><li><a href="#2__delimage_276" rel="nofollow">2. 图像的销毁 delimage()</a></li></ul> 
  </li><li><a href="#_282" rel="nofollow">七、获取图像</a></li><li><ul><li><a href="#1__284" rel="nofollow">1. 获取图像的四种方式</a></li><li><ul><li><a href="#11__297" rel="nofollow">1.1 从图形窗口获取图像（截屏）</a></li><li><a href="#12__337" rel="nofollow">1.2 从图像文件中获取</a></li><li><a href="#13__PIMAGE__432" rel="nofollow">1.3 从另一个 PIMAGE 中获取</a></li><li><a href="#14__464" rel="nofollow">1.4 从资源文件获取</a></li></ul> 
   </li><li><a href="#2__484" rel="nofollow">2. 如何检测是否成功读取到图像</a></li><li><ul><li><a href="#21_getimage_496" rel="nofollow">2.1 利用getimage返回值判断</a></li><li><a href="#22_getwidth_getheight_513" rel="nofollow">2.2 利用getwidth, getheight判断</a></li></ul> 
   </li><li><a href="#3__526" rel="nofollow">3. 图像数组，加载多张图像</a></li><li><a href="#4__566" rel="nofollow">4. 图像缩放</a></li><li><ul><li><a href="#41__569" rel="nofollow">4.1 图片缩放的考虑</a></li><li><a href="#42_EGE_579" rel="nofollow">4.2 使用EGE接口改变图像大小</a></li><li><a href="#43__602" rel="nofollow">4.3 从文件中加载图像并缩放至指定大小</a></li><li><a href="#44__634" rel="nofollow">4.4 缩放原图像</a></li></ul> 
   </li><li><a href="#5__650" rel="nofollow">5. 内存泄漏</a></li></ul> 
  </li><li><a href="#__745" rel="nofollow">八、 图像绘制</a></li><li><ul><li><a href="#1__770" rel="nofollow">1. 图像普通绘制</a></li><li><ul><li><a href="#11_putimage_771" rel="nofollow">1.1 putimage()</a></li><li><a href="#111__783" rel="nofollow">1.1.1 全图绘制</a></li><li><a href="#112__804" rel="nofollow">1.1.2 部分绘制</a></li><li><a href="#113__828" rel="nofollow">1.1.3 部分缩放绘制</a></li><li><a href="#12__putimage_withalpha__847" rel="nofollow">1.2 putimage_withalpha() 支持带透明度图像</a></li></ul> 
   </li><li><a href="#2__885" rel="nofollow">2. 图像透明绘制</a></li><li><ul><li><a href="#21_putimage_alphablend__887" rel="nofollow">2.1 putimage_alphablend() 图像半透明混合</a></li><li><a href="#23_putimage_transparent__912" rel="nofollow">2.3 putimage_transparent() 指定图像透明像素</a></li><li><a href="#24_putimage_alphatransparent_944" rel="nofollow">2.4 putimage_alphatransparent()</a></li></ul> 
   </li><li><a href="#3__963" rel="nofollow">3. 旋转绘图</a></li><li><ul><li><a href="#31_putimage_rotate_965" rel="nofollow">3.1 putimage_rotate()</a></li><li><a href="#32_putimage_rotatezoom_999" rel="nofollow">3.2 putimage_rotatezoom()</a></li></ul> 
   </li><li><a href="#4__1018" rel="nofollow">4. 模糊滤镜</a></li></ul> 
  </li><li><a href="#_1044" rel="nofollow">六、图像其它操作</a></li><li><ul><li><a href="#1__1045" rel="nofollow">1. 图像属性</a></li><li><ul><li><a href="#11__1046" rel="nofollow">1.1 重设图像尺寸</a></li><li><a href="#12__1058" rel="nofollow">1.2 获取图像宽度和高度</a></li></ul> 
   </li><li><a href="#2__1072" rel="nofollow">2. 获取和设置图像像素</a></li><li><ul><li><a href="#21__getpixel_putpixel_1073" rel="nofollow">2.1 图像像素点: getpixel() 和putpixel()</a></li><li><a href="#22__1094" rel="nofollow">2.2 那如何获取窗口像素点颜色呢</a></li><li><a href="#22_getpixel_f__putpixel_f_1109" rel="nofollow">2.2 更快的像素操作:getpixel_f() 和 putpixel_f()</a></li><li><a href="#23_getbuffer_1139" rel="nofollow">2.3 获取图像缓冲区:getbuffer()</a></li></ul> 
   </li><li><a href="#3__1265" rel="nofollow">3. 图像保存</a></li><li><ul><li><a href="#31_BMP_1275" rel="nofollow">3.1 保存成BMP格式图片</a></li><li><a href="#32_png_1298" rel="nofollow">3.2 保存成png格式图片</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_1318" rel="nofollow">七、资源文件</a></li><li><ul><li><a href="#1__1326" rel="nofollow">1. 不同编译器读取资源文件方法</a></li><li><a href="#2_VCVS2017_1332" rel="nofollow">2. VC系列(VS2017)</a></li><li><ul><li><a href="#21__1333" rel="nofollow">2.1 添加图片资源文件</a></li><li><ul><li><a href="#211__1334" rel="nofollow">2.1.1 步骤</a></li><li><a href="#212_resourceh__1355" rel="nofollow">2.1.2 resource.h 头文件内容</a></li><li><a href="#213_rc__1360" rel="nofollow">2.1.3 项目名.rc 文件内容</a></li></ul> 
    </li><li><a href="#22__1368" rel="nofollow">2.2 资源文件的读取</a></li></ul> 
   </li><li><a href="#3_CodeBlocks_1440" rel="nofollow">3. CodeBlocks</a></li><li><ul><li><a href="#31_rc_1441" rel="nofollow">3.1 创建rc文件</a></li><li><a href="#32_rc_1449" rel="nofollow">3.2 编写rc文件</a></li><li><ul><li><a href="#321__1450" rel="nofollow">3.2.1 先把图片文件放到项目中</a></li><li><a href="#322_rc_1453" rel="nofollow">3.2.2 编写rc文件</a></li></ul> 
   </li></ul> 
   </li><li><a href="#4_DevC_1516" rel="nofollow">4. DevC++</a></li><li><ul><li><a href="#41_rc_1517" rel="nofollow">4.1 创建rc文件</a></li><li><a href="#42_RC_1524" rel="nofollow">4.2 编写RC文件</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><strong>EGE图像处理相关函数文档</strong></p> 
<blockquote> 
 <p><a href="http://xege.org/manual/api/img/index.htm" rel="nofollow">http://xege.org/manual/api/img/index.htm</a></p> 
</blockquote> 
<h2><a id="EGE_11"></a>一、EGE的图像功能</h2> 
<p>  读取和绘制图像对于一个图形界面程序来说是一项较为重要的功能，图像可以对界面起到美化的作用。<br>   对于程序来说，某些图像用基础图形来绘制是十分困难的，甚至是无法实现。这些图像大多是由插画师，美术工程师使用绘图软件精心绘制而成，十分精美，或者是由相机拍摄的摄影作品、界面截屏等。这些图像通常以文件的形式进行保存，如果能够直接从文件中读取图像，那将能免去许多设计的工作（实际上这些图自己也画不出来๑乛◡乛๑）。</p> 
<p>  EGE支持以下的图像功能：</p> 
<p><img src="https://images2.imgbox.com/21/3f/ekeSjysu_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>图像功能</th><th align="left"> 
    <center>
      功能描述 
    </center></th></tr></thead><tbody><tr><td>读取图片文件</td><td align="left">可读取 PNG, JPEG, BMP, GIF, EMF, WMF, ICO格式图片。多帧图像格式只读取第一帧</td></tr><tr><td>截取图像区域</td><td align="left">截取图像的部分区域作为新图像。</td></tr><tr><td>绘制图像</td><td align="left">可将读取的图像绘制到窗口上或其它图像中，可旋转、缩放绘制。</td></tr><tr><td>修改图像</td><td align="left">可对图像像素内容进行修改。</td></tr><tr><td>保存图像</td><td align="left">可以将图像保存成图片文件，支持BMP, PNG格式。</td></tr></tbody></table> 
<h2><a id="_35"></a>二、图片读取绘制简单演示</h2> 
<p>  现在做个简单的演示，读取图像文件，并将图像绘制在窗口上。</p> 
<h3><a id="1__41"></a>1. 找一张保存在电脑上的图片</h3> 
<p>  先找一张已经保存在电脑上的图片，需要是JPG格式或PNG格式的图片。</p> 
<p><img src="https://images2.imgbox.com/da/d2/gzab5LtL_o.png" alt="请添加图片描述" width="640"></p> 
<h3><a id="2_File_path_47"></a>2. 查看图片的路径(File path)</h3> 
<blockquote> 
 <p>  读取图像文件首先需要知道图片文件的路径，这样程序才能知道文件存放的位置。</p> 
</blockquote> 
<p>  如下图所示，对于存放于下方目录中的一个PNG图片。</p> 
<p><img src="https://images2.imgbox.com/6b/2d/oT6BWvvl_o.png" alt="在这里插入图片描述"></p> 
<p><strong>查看图片文件路径</strong></p> 
<p>  ① 鼠标左键单击图片文件，然后单击鼠标右键，在右键菜单中选择 <strong>“属性”</strong>。</p> 
<p><img src="https://images2.imgbox.com/64/20/tQ8XA4xO_o.png" alt="在这里插入图片描述"></p> 
<p>  ② 在属性对话框中，点击 <strong>安全</strong> 选项卡，可以看到<strong>对象名称</strong>有一串文本，这个就是<strong>文件的路径</strong>(绝对路径)。</p> 
<p><img src="https://images2.imgbox.com/0e/34/OtgF4PEg_o.png" alt="在这里插入图片描述"></p> 
<p>  可以看到，文件路径实际上就是由地址栏中的目录路径和文件名拼接而成。</p> 
<p><img src="https://images2.imgbox.com/22/dc/qhXMKfKY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/28/91/KzNFkJZo_o.png" alt="在这里插入图片描述"></p> 
<p>  将其复制粘贴，两边加上双引号，并把路径中间的目录分隔符 <code>\</code> ，改为正斜杠 <code>/</code>或双反斜杠 <code>\\</code> 即可得到文件路径字符串：<code>"‪E:/博客写作/博客专栏/EGE/鬼刀.png"</code></p> 
<blockquote> 
 <p>  在C/C++中，反斜杠字符<code>'\'</code>用于转义，所以表示反斜杠本身需要用两个反斜杠<code>'\\'</code>来表示。</p> 
</blockquote> 
<blockquote> 
 <p>  在测试图片时，<mark><strong>文件路径最好是全英文</strong></mark>，以免有编码不匹配问题的发生，或者代码文件的编码使用本地编码 <strong>GB2312</strong>，和电脑使用的代码页一致。<br>   例如，VS Code文件编码默认是 <strong>UTF-8</strong>，而Windows系统在中文环境下默认是 <strong>GB2312</strong>，第一次配置C++开发环境时，很有可能会遇到中文乱码的情况，文件路径中的中文也同理。</p> 
</blockquote> 
<h3><a id="3__82"></a>3. 读取图像文件并绘制到窗口上</h3> 
<p>  现在运行个简单的测试示例，目标是读取一张图片绘制到窗口上，如果能够成功，那图像操作就完成了一半。<br>   将下面代码第12行中 <code>getimage()</code>函数参数中的 <code>"图像文件路径"</code> 改成自己图片文件的实际路径。</p> 
<p><img src="https://images2.imgbox.com/2d/87/vPRyGD7x_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建图片对象</span>
	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//从文件中获取图像（和原图一样大小），输入实际的图像文件路径</span>
	<span class="token comment">//例如, getimage(pimg, "E:/博客写作/博客专栏/EGE/鬼刀.png");</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"图像文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//绘制图像，(0, 0)是图片绘制区域的左上角		</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//如果后面不用了的话就销毁图像，释放内存(图像是动态分配的，注意不要内存泄漏)</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4__115"></a>4. 查看运行结果</h3> 
<p>  运行结果如下图所示，由于使用的图片比窗口大，所以只显示了图片的一部分。<br>   如果显示是全黑，无法正确显示图片，那么请先检查一下填写的图片文件的路径是否正确，注意要将<code>\</code>修改为<code>/</code>。<br>   如果用的是其它图片，可以用windows自带的照片等工具先打开对应图片看看，查看一下是否是因为图片分辨率非常大并且左上角本身是黑色而导致分辨不出是显示的图片一角还是没有显示出图片。</p> 
<p><img src="https://images2.imgbox.com/b6/b2/mP0UeH9K_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_123"></a>三、文件路径</h2> 
<h3><a id="1__124"></a>1. 文件扩展名显示设置</h3> 
<p>  对于文件读取来说，<strong>文件路径</strong>是很重要的一个参数，文件名包含<strong>文件主名</strong>和<strong>文件扩展名</strong>两部分，平常情况下文件资源管理器可能默认<strong>隐藏文件扩展名</strong>，这不利于获取完整的文件名。</p> 
<p><strong>windows 10 资源管理器显文件扩展名的设置</strong></p> 
<p>  打开 <strong>文件资源管理器</strong>，点击 <strong>查看</strong>选项卡，勾选上<strong>文件扩展名</strong>选项，这样就能看到完整的文件名了。</p> 
<p><img src="https://images2.imgbox.com/f4/28/H4sj8LgX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2__132"></a>2. 绝对路径和相对路径</h3> 
<blockquote> 
 <p><a href="https://blog.csdn.net/qq_39151563/article/details/104343268">文件名 绝对路径与相对路径</a></p> 
</blockquote> 
<p>  在文件属性中的对象名称中写的路径是文件的绝对路径，以盘符和目录分隔符开头：<code>盘符:/</code>，可以唯一确定一个存储在计算机计算机中的文件。<br> <img src="https://images2.imgbox.com/d9/8a/hvNzNID7_o.png" alt="在这里插入图片描述"><br>   而相对路径是文件与<strong>当前目录</strong>的相对位置，一般情况下，项目中新建的源文件将放在项目的当前目录中，在集成开发环境中调试时，程序运行后的当前目录也是在这个位置。如果上图中的文件放在当前目录中，那么文件的相对路径为<code>"鬼刀.png"</code>，如果是在当前目录中的 <strong>resource</strong> 文件夹下，那么路径为 <code>"resource/鬼刀.png"</code>。</p> 
<blockquote> 
 <p>  代码中的文件路径尽量用 <strong>相对路径</strong>，当可执行文件改变存放位置时，绝对路径就会变化，这时文件就无法读取到。</p> 
</blockquote> 
<h2><a id="EGE__141"></a>四、EGE 中的图像</h2> 
<h3><a id="1__142"></a>1. 计算机如何表示图像</h3> 
<p>  目前大多数显示器的显像部分是由一个个像素点组成，这些像素点呈行列排布，组成一个二维点阵。显示器上显示的图像便是这些发出不同色光的像素点构成。因此，一个图像只需保存其包含的像素点的颜色值即可，系统读取后就可以根据这些颜色值改变对应像素点的颜色，在屏幕上显示出对应的图像。</p> 
<p><img src="https://images2.imgbox.com/a7/75/5RIiGmfN_o.png" alt="在这里插入图片描述" width="480"></p> 
<p>  图像所保存的像素区域通常是矩形形状，其中包含了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
      
        N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span>行 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
      
        M 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span></span></span></span></span>列个像素点。此时图像的宽度为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
      
        M 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span></span></span></span></span>个像素点，高度为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
      
        N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span> 个像素点，图像的分辨率通常就用 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         × 
        
       
         N 
        
       
      
        M \times N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span> 表示。</p> 
<p><img src="https://images2.imgbox.com/13/dc/Uisb75eS_o.png" alt="在这里插入图片描述"></p> 
<p>  查看一张图片的参数信息，可以看到分辨率参数。</p> 
<p><img src="https://images2.imgbox.com/b9/f6/AMjdz2Fu_o.png" alt="在这里插入图片描述"></p> 
<p>  在计算机内存中，系统会开辟一块可以保存 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         × 
        
       
         N 
        
       
      
        M \times N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span> 个像素颜色值的区域来存储图像像素点颜色数据。</p> 
<blockquote> 
 <p>  像素颜色通常用24位RGB颜色表示。ARGB颜色除了RGB通道外，另加一个Alpha通道，一共32位。</p> 
</blockquote> 
<p>  通用的图像文件格式中，一般有 <strong>矢量图格式</strong> 和 <strong>位图格式</strong> 两种。<br>   <strong>位图</strong> 格式记录了一个图像所有像素点的颜色值，并对这些数据和其它一些信息进行压缩编码。读取到文件后，只需对这些数据解码，就能还原出对应图像的像素点颜色值。<br>   <strong>矢量图</strong>格式则包含一些描述性的内容，描述图形如何通过一些基础图形绘制而成，而不是保存各个像素点的颜色值，实际的图像由程序按照其描述的步骤绘制而成。</p> 
<h3><a id="2_EGE_164"></a>2. EGE中的图像</h3> 
<p>  图像在EGE中用 <strong>IMAGE</strong> 类型表示，类中记录了图像各个像素的 <strong>ARGB颜色值</strong> 。从图像文件中读取的图像像素点颜色值不管原颜色格式是什么，读取后都会转换成 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         32 
        
       
      
        32 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">2</span></span></span></span></span> 位 <strong>ARGB</strong> 格式。</p> 
<p>  目前EGE中的 <strong>IMAGE</strong> 类是隐藏的，无法直接调用其成员变量和成员函数，EGE额外提供了一些接口，可以通过其指针类型 <strong>PIMAGE</strong> 操作图像。</p> 
<p><img src="https://images2.imgbox.com/e0/5b/2JzjEj5s_o.png" alt="在这里插入图片描述"></p> 
<p>  EGE中的表示图像对象的类为 <strong>IMAGE</strong>，<strong>IMAGE</strong> 类的定义并没有直接给出，所以无法直接创建和操作 <strong>IMAGE</strong> 对象，需要通过 <strong>newimage()</strong> 函数进行创建。<strong>newimage()</strong> 创建<strong>IMAGE</strong> 对象后返回 <strong>IMAGE</strong>对象的指针，IMAGE对象的指针类型用 <strong>PIMAGE</strong> 来表示。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> IMAGE<span class="token operator">*</span> PIMAGE<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//创建IMAGE对象，并返回其指针</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  另有一个 <strong>PCIMAGE</strong>类型，定义为指向 <strong>IMAGE常量</strong> 的指针，可以防止 <strong>IMAGE</strong> 被误修改。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">const</span> IMAGE <span class="token operator">*</span>PCIMAGE<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3__188"></a>3. 如何定义全局图像</h3> 
<p>  EGE使用的是图像指针类型 <strong>PIMAGE</strong>，指针可任意位置定义，但在 <strong>旧版本</strong>中(·EGE19.01版本及之前·) ,调用 <code>newimage()</code> 创建图像需要在 <code>initgraph()</code> 初始化环境之后，因此以下代码报错。(<code>提示：全局变量的初始化是在main()函数调用之前进行</code>)</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>
<span class="token comment">//EGE20.08版本以上允许，旧版本会报错</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>  EGE在20.08版本之后允许 <code>newimage()</code> 在 <code>initgraph()</code> 之前调用。</p> 
</blockquote> 
<p>  既然是指针类型，那么只需要在初始化环境后再调用 <strong>newimage()</strong> 创建图像对象，然后对 <strong>PIMAGE</strong>变量 进行赋值即可。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token comment">//这里仅定义指针变量，而不使用newimage()创建图像对象</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>	

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建图像放到 initgraph()调用之后</span>
	pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="EGE_225"></a>五、EGE图像的使用流程</h2> 
<p>  EGE图像的使用流程如下图所示，主要包括 <strong>创建图像</strong>、 <strong>构建图像内容</strong>、<strong>绘制图像</strong> 和 <strong>销毁图像</strong> 四个部分。<br>   图像内容可以从文件中读取，也可以是从另一个图像中得到，同时可以调用EGE绘图函数来对图像进行绘图。</p> 
<p><img src="https://images2.imgbox.com/4d/17/BYjtXsb6_o.png" alt="在这里插入图片描述"></p> 
<p>  单次绘图流程的代码如下所示：</p> 
<p><img src="https://images2.imgbox.com/ff/8d/quklfhni_o.png" alt="在这里插入图片描述"><br>   循环绘图流程的示例代码如下所示：</p> 
<p><img src="https://images2.imgbox.com/bb/c6/xx7PXmYw_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_241"></a>六、图像的创建和销毁</h2> 
<p><img src="https://images2.imgbox.com/34/90/KZPliOmU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1__newimage_247"></a>1. 创建图像 newimage()</h3> 
<p>  图像创建使用的是 <strong>newimage()</strong> 函数，<strong>newimage()</strong> 函数创建图像后，会返回其指针。</p> 
<p>  <strong>newimage()</strong> 函数有两种形式：</p> 
<table><thead><tr><th>函数形式</th><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>newimage()</code></td><td>无参数</td><td>创建一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1 
           
          
            × 
           
          
            1 
           
          
         
           1\times 1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span> 大小的图像或一个空的图像<code>(版本更新后，行为不同) </code></td></tr><tr><td><code>newimage(width, height)</code></td><td>  <code>width</code>:图像宽度<br><code>height</code>:图像高度</td><td>创建一个指定宽高的图像</td></tr></tbody></table> 
<p><strong>函数声明</strong><br>   创建了一个空的图像或1x1大小的图像</p> 
<pre><code class="prism language-cpp">PIMAGE  <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  创建一个宽高为 <code>width</code> x <code>height</code> 的图像</p> 
<pre><code class="prism language-cpp">PIMAGE  <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<p>  使用 <strong>newimage()</strong> 创建后，将返回值赋值给PIMAGE变量即可。</p> 
<pre><code class="prism language-cpp">PIMAGE pimg1 <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//创建默认大小的图像(空图像或1x1大小)</span>
PIMAGE pimg2 <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个宽为100，高为50的图像</span>
</code></pre> 
<h3><a id="2__delimage_276"></a>2. 图像的销毁 delimage()</h3> 
<p>  图像对象使用的是 <strong>动态内存分配</strong>，对分配的图像对象不再需要时，要使用 <strong>delimage(pimg)</strong> 销毁图像，释放内存，否则会造成内存泄漏。</p> 
<pre><code class="prism language-cpp"><span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_282"></a>七、获取图像</h2> 
<h3><a id="1__284"></a>1. 获取图像的四种方式</h3> 
<p>  获取图像使用 <strong>getimage()</strong> 函数，getimage() 有多个重载，分别以不同的方式获取图像。</p> 
<blockquote> 
 <p>  使用 <strong>getimage()</strong> 获取图像后得到的 <strong>IMAGE</strong> 大小会随实际图像大小而改变，而不是原先创建图像时设置的大小。</p> 
</blockquote> 
<p>  另外，有一个专门读取<strong>png</strong>图像文件的函数 <strong>getimage_pngfile()</strong>，因为<strong>getimage()</strong> 也能读取png图像，所以不常用。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">getimage_pngfile</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCSTR  filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">getimage_pngfile</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCWSTR filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="11__297"></a>1.1 从图形窗口获取图像（截屏）</h4> 
<p>  从图形窗口中获取图像，可以是整个窗口，也可以窗口的部分矩形区域。</p> 
<p><img src="https://images2.imgbox.com/57/ad/RID8yXKD_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<p><img src="https://images2.imgbox.com/c3/63/cfceYwFd_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 从屏幕获取图像</span>
<span class="token keyword">void</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
    PIMAGE pDstImg<span class="token punctuation">,</span>   <span class="token comment">// 保存图像的 IMAGE 对象指针</span>
    <span class="token keyword">int</span> srcX<span class="token punctuation">,</span>         <span class="token comment">// 要获取图像的矩形区域左上角 x 坐标</span>
    <span class="token keyword">int</span> srcY<span class="token punctuation">,</span>         <span class="token comment">// 要获取图像的矩形区域左上角 y 坐标</span>
    <span class="token keyword">int</span> srcWidth<span class="token punctuation">,</span>     <span class="token comment">// 要获取图像的矩形区域宽度</span>
    <span class="token keyword">int</span> srcHeight     <span class="token comment">// 要获取图像的矩形区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例程序</strong><br>   创建图像后，就可以使用 <code>getimage()</code> 截取窗口的部分矩形区域来作为图像。</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//设置区域位置和大小信息，这里直接就是整个窗口区域</span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//截取窗口中左上角坐标为(x,y)，宽为width, 高为height的矩形区域。</span>
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>	
</code></pre> 
<p>  这样就可以截取窗口某个区域，将图像存到pimg里了。<br>   截取整个窗口区域还可以这样简化代码：</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="12__337"></a>1.2 从图像文件中获取</h4> 
<p><strong>注意事项</strong><br>   从文件中读取图像是个耗时的过程，CPU从硬盘中读取文件非常慢，所以 <strong>不要在循环中重复读取同一个图像</strong> ， 这样会不断读取硬盘，非常耗时，还会引起卡顿。如果你忘记使用 <strong>delimage()</strong> 来销毁图像，还会造成内存泄漏，占用极大的内存。</p> 
<p>  文件中的图像都是固定的，如果要一直使用，只获取一次就可以了，后面可以一直绘制，不需要再次获取。<br>   可以先获取图像，再在帧循环中重复绘制，帧循环退出后再使用 <strong>delimage()</strong> 销毁图像。</p> 
<table><thead><tr><th>getimage()支持的图像文件格式</th><th>备注</th></tr></thead><tbody><tr><td>png / bmp / jpg / gif / emf / wmf / ico</td><td>包含多帧图像的文件只能获取第一帧，得到的只是一张静态的图片，而不是一个动图。</td></tr></tbody></table> 
<p><strong>函数声明</strong><br> <img src="https://images2.imgbox.com/ff/9f/u1vIrlei_o.png" alt="在这里插入图片描述"></p> 
<p>  第二个参数 <code>pImgFile</code>的类型<code>LPCTSTR</code> 其实是 <code>char *</code> 类型，需要填写图片文件的路径，这样才能找到文件存放的位置并读取。文件路径可以是绝对路径，也可以是相对路径。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 从图片文件获取图像(png/bmp/jpg/gif/emf/wmf/ico)</span>
<span class="token keyword">void</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
    PIMAGE pDstImg<span class="token punctuation">,</span>		<span class="token comment">// 保存图像的 IMAGE 对象指针</span>
    LPCTSTR pImgFile	<span class="token comment">// 图片文件路径</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp">	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"C:/ege/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>  从图像文件中获取图像的 <strong>getimage()</strong>, 它的第三和第四个参数虽然写着是缩放宽高，但目前实际上是未使用的参数，没有缩放的效果。想要缩放，可以借助 <strong>putimage()</strong>。</p> 
</blockquote> 
<center> 
 <font size="5"><b>不要在循环中从同一个文件中重复读取图像</b></font> 
</center> 
<p>  如下所示：draw函数用于绘图，都是同一个图片，什么都没变，为什么读这么多次呢？</p> 
<pre><code class="prism language-cpp"><span class="token comment">//draw会被循环调用</span>
<span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//都是同样的内容，读一次就好了呀</span>
	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"filename.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token function">is_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">delay_fps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">cleardevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  读一次就可以了，真是够了啊。</p> 
<pre><code class="prism language-cpp">
PIMAGE pimg<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"filename.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token function">is_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">delay_fps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">cleardevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="13__PIMAGE__432"></a>1.3 从另一个 PIMAGE 中获取</h4> 
<p>  可以截取一个图像的部分区域作为图像内容。<br> <img src="https://images2.imgbox.com/62/be/YC0PPdzY_o.png" alt="在这里插入图片描述"></p> 
<p>  截取图像区域如下所示：<br> <img src="https://images2.imgbox.com/c8/21/R9zbEhIe_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<p><img src="https://images2.imgbox.com/af/d6/RSByrkvi_o.png" alt="在这里插入图片描述" width="700"></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 从另一个 IMAGE 对象中获取图像</span>
<span class="token keyword">void</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
    PIMAGE pDstImg<span class="token punctuation">,</span>       <span class="token comment">// 保存图像的 IMAGE 对象指针</span>
    <span class="token keyword">const</span> IMAGE <span class="token operator">*</span>pSrcImg<span class="token punctuation">,</span> <span class="token comment">// 源图像 IMAGE 对象</span>
    <span class="token keyword">int</span> srcX<span class="token punctuation">,</span>             <span class="token comment">// 要获取图像的区域左上角 x 坐标</span>
    <span class="token keyword">int</span> srcY<span class="token punctuation">,</span>             <span class="token comment">// 要获取图像的区域左上角 y 坐标</span>
    <span class="token keyword">int</span> srcWidth<span class="token punctuation">,</span>         <span class="token comment">// 要获取图像的区域宽度</span>
    <span class="token keyword">int</span> srcHeight         <span class="token comment">// 要获取图像的区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<p>  源图像的图像指针为 <code>anotherPimg</code>, 从中截取部分区域保存到pimg中。</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> anotherPimg<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="14__464"></a>1.4 从资源文件获取</h4> 
<p>  资源文件就是编译器将图片集成进可执行文件中，图片不再作为外部文件的形式存在，程序运行时可以从可执行文件中提取图片，增加了程序的独立性。</p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 从资源文件获取图像(bmp/jpg/gif/emf/wmf/ico)</span>
<span class="token keyword">void</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
    PIMAGE pDstImg<span class="token punctuation">,</span>       <span class="token comment">// 保存图像的 IMAGE 对象指针</span>
    LPCTSTR pResType<span class="token punctuation">,</span>     <span class="token comment">// 资源类型</span>
    LPCTSTR pResName      <span class="token comment">// 资源名称</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>调用如下:</p> 
<pre><code class="prism language-cpp"><span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"资源类型"</span><span class="token punctuation">,</span> <span class="token string">"资源名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  关于资源文件的获取，在文章末尾说明，篇幅太长，就不放在这里了。</p> 
<h3><a id="2__484"></a>2. 如何检测是否成功读取到图像</h3> 
<p>  检测是否成功读取到图像，并不能单纯依靠查看绘制结果，原因如：</p> 
<ul><li>绘图函数调用时参数填写错误。</li><li>图像本身原因，如分辨率过大，部分区域是纯色的</li><li>绘图流程出现问题，图形可能被覆盖、清除，或者没有对内容进行刷新等。</li></ul> 
<table><thead><tr><th>判断方法</th><th>说明</th></tr></thead><tbody><tr><td>利用 <code>getimage()</code> 函数返回值</td><td>返回值为0说明读取成功，返回值为非0值说明读取失败。</td></tr><tr><td>利用<code>getwidth(), getheight()</code>查看图像宽高属性</td><td>如果图像宽高出现0或1这种不正确的数值，说明读取图片文件出现了问题。</td></tr></tbody></table> 
<h4><a id="21_getimage_496"></a>2.1 利用getimage返回值判断</h4> 
<p>  这种适合用于从文件中读取图像的操作，当从文件中读取图像失败时<code>(因找不到文件，文件格式错误等原因而导致读取失败)</code>，<strong>getimage()</strong> 将返回 <strong>非0值</strong>。</p> 
<p>  下面读取一张图片，根据 <strong>getimage()返回值</strong> 判断读取操作是否成功，<strong>读取操作结果输出到控制台中</strong>。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//创建图片对象</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				
<span class="token keyword">int</span> errorCode <span class="token operator">=</span> <span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"图片文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>errorCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//图片读取成功</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//图片读取失败</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22_getwidth_getheight_513"></a>2.2 利用getwidth, getheight判断</h4> 
<p>  <code>newimage()</code> 创建图像后，图像大小为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         0 
        
       
         × 
        
       
         0 
        
       
      
        0 \times 0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span> 或 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         1 
        
       
         × 
        
       
         1 
        
       
      
        1 \times 1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>，如果读取成功，图像大小将会被修改成读取的图片的宽高。此时读取图像宽高信息即可。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//创建图片对象</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"图片文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//输出图像宽高数据</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%d, %d]\n"</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3__526"></a>3. 图像数组，加载多张图像</h3> 
<p>  从文件中加载图像，其实只需要文件路径即可。我们可以将序列帧按一定格式顺序命名，然后生成对应的文件路径字符串，即可。<br>   假设下图中的图片文件保存在当前目录的 <code>img</code> 文件夹下。<br> <img src="https://images2.imgbox.com/30/89/NFrkzlkf_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>  生成字符串可以用标准库中的 <code>sprinf()</code> 函数, 它可以根据参数生成对应的字符串并存入字符数组中。</p> 
</blockquote> 
<p>  多张图像可以用 <strong>PIMAGE数组</strong> 保存，也可以使用 <strong>C++</strong> 标准模板库中的 <strong>vector</strong>, <strong>array</strong>等，创建后使用 <code>newimage()</code> 给PIMAGE 赋值即可。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//定义长度为20的数组</span>
PIMAGE images<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//数组也可以使用动态分配的方式，记得对images调用free释放内存</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> imageNum <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
PIMAGE<span class="token operator">*</span> images <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>imageNum <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PIMAGE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  如上图中的，图片文件名格式为：<code>image</code> + <code>数字</code>+<code>.jpg</code> 。图片保存在当前目录的<code>img</code> 文件夹下，文件路径对应格式字符串 为 <code>"img/image%d.jpg"</code>，用 <code>sprintf()</code> 生成即可。</p> 
<pre><code class="prism language-cpp">PIMAGE pimgs<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//字符数组，用于保存生成的文件名</span>
<span class="token keyword">char</span> fileName<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//根据格式生成文件名，保存到fileName[]中</span>
	<span class="token function">sprintf</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"img/image%d.jpg"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建图像，并根据文件名加载</span>
	pimgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  当图像不使用时，用 <code>delimage()</code> 来销毁图像。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pimgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4__566"></a>4. 图像缩放</h3> 
<p>  <strong>getimage()</strong> 实际是没有缩放功能的，那该如何处理图像缩放的问题。</p> 
<h4><a id="41__569"></a>4.1 图片缩放的考虑</h4> 
<p>  如果<strong>图像在绘图时是大小固定不变的</strong>，如做窗口背景：<br>   ① 首先考虑利用软件工具对图片文件进行缩放，调整至合适的分辨率后保存，这时读取到程序中，直接就是合适的大小<code>(可以使用PS等图片工具)</code>。<br>   ② 然后考虑先把图像读取到程序中，再利用EGE的函数改变图像大小 <code>(使用putimage()生成另一个合适大小的图像)</code>。<br>   ③ 不改变原始图像的大小，在绘制图像时，控制绘制出的图像大小<code>( putimage() 函数可以缩放绘制)</code>。<br> <img src="https://images2.imgbox.com/f3/99/1ZYlwySR_o.png" alt="在这里插入图片描述"><br>   如果<strong>图像在绘图时大小是会不断变化的</strong>：这种就不需要修改图片文件分辨率，选用一个较为高清的图片，在绘制图像时使用 <code>putimage()</code> 缩放绘制即可。</p> 
<h4><a id="42_EGE_579"></a>4.2 使用EGE接口改变图像大小</h4> 
<p>  <code>getimage()</code> 读取图片文件后，得到图像是原图大小，并且<code>getimage()</code>不能本身是不能设置图像大小的。如果想要缩放原图像，可以使用一个<strong>临时图像</strong>做中转，读取图片后再<strong>缩放绘制</strong>到目标图像中，完成后销毁临时图像，这样缩放后的图像就保存在了目标图像中。<br> <img src="https://images2.imgbox.com/2f/73/v5wdHumd_o.png" alt="在这里插入图片描述" width="700"></p> 
<p><strong>示例代码</strong><br>   假设需要的图像大小是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         320 
        
       
         × 
        
       
         320 
        
       
      
        320 \times 320 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mord">0</span></span></span></span></span>。</p> 
<pre><code class="prism language-cpp">PIMAGE temp <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//创建临时图像</span>
<span class="token function">getimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">"girl.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//读取图片</span>

<span class="token comment">//创建指定大小的图像</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//把图像绘制成需要的大小</span>
<span class="token function">putimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">delimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//临时的temp图像不需要了,销毁掉</span>
</code></pre> 
<p>  最后我们就得到了我们想要的宽和高为 <strong>320x320</strong> 的图像，保存在了 <strong>pimg</strong> 中，接下来就可以使用了。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//将图片绘制在窗口上</span>
<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="43__602"></a>4.3 从文件中加载图像并缩放至指定大小</h4> 
<p>  我们可以将图片缩放写成一个函数，将图片缩放成想要的大小。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//从图片文件中加载图像，并将图像缩放成 width x height 大小</span>
<span class="token keyword">void</span> <span class="token function">getZoomImage</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fileName<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pimg <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
		
	PIMAGE temp <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">!=</span> width<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">!=</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">resize</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token function">putimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">delimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用如下：</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getZoomImage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"girl.jpg"</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h4><a id="44__634"></a>4.4 缩放原图像</h4> 
<p>  下面这个函数是对原图像进行缩放，缩放后图像指针指向新的图像。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">zoomImage</span><span class="token punctuation">(</span>PIMAGE<span class="token operator">&amp;</span> pimg<span class="token punctuation">,</span> <span class="token keyword">int</span> zoomWidth<span class="token punctuation">,</span> <span class="token keyword">int</span> zoomHeight<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//pimg为空，或目标图像大小和原图像一样，则不用缩放，直接返回</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pimg <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>zoomWidth <span class="token operator">==</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> zoomHeight <span class="token operator">==</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	PIMAGE zoomImage <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span>zoomWidth<span class="token punctuation">,</span> zoomHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span>zoomImage<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> zoomWidth<span class="token punctuation">,</span> zoomHeight<span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pimg <span class="token operator">=</span> zoomImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5__650"></a>5. 内存泄漏</h3> 
<p>  先看看内存泄漏的情况(<code>不调用 delimage() 销毁图像的</code>)<br>   先调出 <strong>任务管理器</strong>：<strong>鼠标右击</strong>左下角的<strong>桌面图标</strong>，调出任务管理器或者快捷键(<strong>Ctrl + Alt + Del</strong>)， 然后点击 <strong>“任务管理器”</strong>。</p> 
<p><img src="https://images2.imgbox.com/f0/af/N2BWTNaD_o.png" alt="在这里插入图片描述" width="360"><br>   打开后注意现在的内存使用情况。<br> <img src="https://images2.imgbox.com/ad/59/zQ9L7YBy_o.png" alt="在这里插入图片描述"><br>   当然，如果你有安全管家悬浮球，也可以看这个<br> <img src="https://images2.imgbox.com/ff/4d/0qjUlffN_o.png" alt="在这里插入图片描述"><br>   接下来是查看内存泄漏情况。下面仅仅是加载一张图片，在循环里进行，没有 <strong>delimage()</strong>,。<br>   运行下面的程序：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setcolor</span><span class="token punctuation">(</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setfont</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"楷体"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">xyprintf</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">"按任意键继续，每按一次，注意一次内存情况"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token comment">//从屏幕截取图像，不释放内存</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">xyprintf</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">"第%2d 次，共10次， 现在内存泄漏约%4dMB"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  可以看到，按一次按键内存升高一点, 最后占用了约 <strong>2GB</strong> 的内存。<br>   运行结束后，内存才统一释放，恢复正常。</p> 
<p><img src="https://images2.imgbox.com/e1/7f/u2VSj3YK_o.png" alt="在这里插入图片描述" width="800"><br>   所以如果你在帧循环中不断地加载图像，而不使用 <strong>delimage()</strong>， 将会看到内存占用不断升高。<br>   大概是下面这种写法<br>   运行一下，看看不断升高的内存占用。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setcolor</span><span class="token punctuation">(</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setfont</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"楷体"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token function">is_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">delay_fps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  如果你仅仅是加载那一张图片，内存占用仅仅10MB<br> <img src="https://images2.imgbox.com/80/f0/yA1pT4vD_o.png" alt="在这里插入图片描述" width="700"><br>   下面是正确的写法，把加载图像放到帧循环外，同一个图像不必重复加载。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setcolor</span><span class="token punctuation">(</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setfont</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"楷体"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token function">is_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">delay_fps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token comment">//绘图</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//不用时释放内存</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="__745"></a>八、 图像绘制</h2> 
<blockquote> 
 <p><a href="http://xege.org/manual/api/img/index.htm" rel="nofollow">EGE 图像处理函数文档</a></p> 
</blockquote> 
<p>  图像的绘制分别有以下几个函数：</p> 
<table><thead><tr><th>功能</th><th>额外</th><th>函数</th></tr></thead><tbody><tr><td>普通绘制</td><td></td><td><strong>putimage()</strong></td></tr><tr><td>普通绘制</td><td>支持带透明度图像</td><td><strong>putimage_withalpha()</strong></td></tr></tbody></table> 
<table><thead><tr><th>功能</th><th>额外</th><th>函数</th></tr></thead><tbody><tr><td>透明绘制</td><td>指定图像整体透明度</td><td><strong>putimage_alphablend()</strong></td></tr><tr><td>透明绘制</td><td>指定某个颜色的像素透明</td><td><strong>putimage_transparent()</strong></td></tr><tr><td>透明绘制</td><td>指定某个颜色的像素透明，并指定图像整体透明度</td><td><strong>putimage_alphatransparent()</strong></td></tr></tbody></table> 
<table><thead><tr><th>功能</th><th>额外</th><th>函数</th></tr></thead><tbody><tr><td>旋转绘制</td><td></td><td><strong>putimage_rotate()</strong></td></tr><tr><td>旋转绘制</td><td>可缩放</td><td><strong>putimage_rotatezoom()</strong></td></tr></tbody></table> 
<blockquote> 
 <p>  函数声明具体请查看EGE官网文档及 ege.h头文件</p> 
</blockquote> 
<h3><a id="1__770"></a>1. 图像普通绘制</h3> 
<h4><a id="11_putimage_771"></a>1.1 putimage()</h4> 
<blockquote> 
 <p><a href="https://xege.org/manual/api/img/putimage.htm" rel="nofollow">图像处理相关函数：putimage</a></p> 
</blockquote> 
<p>   <strong>putimage()</strong> 函数可以将图像绘制到另一个图像上。同时，窗口中绘图区域也是一个图像，因此 <strong>putimage()</strong> 也可以绘制在窗口上。<br>   由于在窗口上绘制是个常用操作，所以EGE额外增加了一组用于绘制在窗口上的函数，可以从函数参数中看出来，这一组函数省略了目标图像参数，意为绘制到窗口上。<br>   <strong>这里就讲解直接绘制在窗口上的那一组函数，另一组指定目标图像的函数，添加一个 PIMAGE 参数即可</strong>。</p> 
<p>  <strong>putimage()</strong> 有三种形式，分别是<strong>全图绘制</strong>，<strong>部分绘制</strong> 和 <strong>部分缩放绘制</strong>。</p> 
<p><img src="https://images2.imgbox.com/55/d9/lr54YIgs_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="111__783"></a>1.1.1 全图绘制</h4> 
<p>  将原图以相同大小绘制到窗口的某个位置。<br> <img src="https://images2.imgbox.com/e0/a5/6INA77Mx_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> EGEAPI <span class="token function">putimage</span><span class="token punctuation">(</span>
	<span class="token keyword">int</span> dstX<span class="token punctuation">,</span>				<span class="token comment">//绘制区域左上角x坐标</span>
	<span class="token keyword">int</span> dstY<span class="token punctuation">,</span>				<span class="token comment">//绘制区域左上角y坐标</span>
	<span class="token keyword">const</span> PIMAGE pSrcImg	<span class="token comment">//源图像</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp"><span class="token function">putimage</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="112__804"></a>1.1.2 部分绘制</h4> 
<p>  截图源图像的部分区域，以相同大小绘制到窗口上。截取区域和绘制区域大小相同，所以省略了截取区域的宽高参数。</p> 
<p><img src="https://images2.imgbox.com/2f/19/MyrRtJgf_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> EGEAPI <span class="token function">putimage</span><span class="token punctuation">(</span>
	<span class="token keyword">int</span> dstX<span class="token punctuation">,</span>		<span class="token comment">//绘制区域左上角x坐标</span>
	<span class="token keyword">int</span> dstY<span class="token punctuation">,</span>		<span class="token comment">//绘制区域左上角y坐标</span>
	<span class="token keyword">int</span> dstWidth<span class="token punctuation">,</span>	<span class="token comment">//绘制区域宽度</span>
	<span class="token keyword">int</span> dstHeight<span class="token punctuation">,</span>	<span class="token comment">//绘制区域高度</span>
	<span class="token keyword">const</span> PIMAGE pSrcImg<span class="token punctuation">,</span>	<span class="token comment">//源图像</span>
	<span class="token keyword">int</span> srcX<span class="token punctuation">,</span>		<span class="token comment">//截取区域左上角x坐标</span>
	<span class="token keyword">int</span> srcY<span class="token punctuation">,</span>		<span class="token comment">//截取区域左上角y坐标</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp"><span class="token function">putimage</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> srcX<span class="token punctuation">,</span> srcY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="113__828"></a>1.1.3 部分缩放绘制</h4> 
<p>  截取图像部分区域，缩放绘制到窗口的目标区域上。因为图像会被缩放拉伸，如果两个区域宽高比例不一样，那么图像会变形，所以最好两个区域的宽高比例相等。<br> <img src="https://images2.imgbox.com/55/11/Icqs08sf_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> EGEAPI <span class="token function">putimage</span><span class="token punctuation">(</span>
	<span class="token keyword">int</span> dstX<span class="token punctuation">,</span>				<span class="token comment">//绘制区域左上角x坐标</span>
	<span class="token keyword">int</span> dstY<span class="token punctuation">,</span>				<span class="token comment">//绘制区域左上角y坐标</span>
	<span class="token keyword">int</span> dstWidth<span class="token punctuation">,</span>			<span class="token comment">//绘制区域宽度</span>
	<span class="token keyword">int</span> dstHeight<span class="token punctuation">,</span>			<span class="token comment">//绘制区域高度</span>
	<span class="token keyword">const</span> PIMAGE pSrcImg<span class="token punctuation">,</span>	<span class="token comment">//源图像</span>
	<span class="token keyword">int</span> srcX<span class="token punctuation">,</span>				<span class="token comment">//截取区域左上角x坐标</span>
	<span class="token keyword">int</span> srcY<span class="token punctuation">,</span>				<span class="token comment">//截取区域左上角y坐标</span>
	<span class="token keyword">int</span> srcWidth<span class="token punctuation">,</span>			<span class="token comment">//截取区域宽度</span>
	<span class="token keyword">int</span> srcHeight			<span class="token comment">//截取区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="12__putimage_withalpha__847"></a>1.2 putimage_withalpha() 支持带透明度图像</h4> 
<p>  <strong>putimage_withalpha()</strong> 支持带透明通道的图片，这样就可以使用带透明通道的图片素材。</p> 
<blockquote> 
 <p>  <strong>putimage_withalpha()</strong> 在EGE20.08及之前版本只支持部分绘制，不支持缩放绘制。</p> 
</blockquote> 
<p>  带透明度的图像可以将像素颜色和背景混合，图像的一部分有半透明或全透明的效果。JPG格式图片通常不带有透明，带透明度图像可以使用PNG格式。</p> 
<p><img src="https://images2.imgbox.com/e2/f2/uQ7TkIh0_o.png" alt="在这里插入图片描述"></p> 
<p>  如果想绘制到窗口上，目标图像的PIMAGE参数传入NULL即可。<br> <img src="https://images2.imgbox.com/4b/60/SJb4rEep_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">putimage_withalpha</span><span class="token punctuation">(</span>
	PIMAGE imgdest<span class="token punctuation">,</span>		<span class="token comment">// 目标图像</span>
	PIMAGE imgsrc<span class="token punctuation">,</span>		<span class="token comment">// 源图像</span>
    <span class="token keyword">int</span> dstX<span class="token punctuation">,</span>    		<span class="token comment">// 目标图像左上角x坐标 </span>
    <span class="token keyword">int</span> dstY<span class="token punctuation">,</span>    		<span class="token comment">// 目标图像左上角y坐标</span>
	<span class="token keyword">int</span> srcX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">// 源图像左上角x坐标</span>
    <span class="token keyword">int</span> srcY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">// 源图像左上角y坐标</span>
    <span class="token keyword">int</span> srcWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token comment">// 原图像混合区域宽度</span>
    <span class="token keyword">int</span> srcHeight <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment">// 源图像混合区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">//图像全图绘制到窗口上，绘制区域左上角坐标为(20, 30)</span>
<span class="token function">putimage_withalpha</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//图像全图绘制到目标图像上，绘制区域左上角坐标为(20, 30)</span>
<span class="token function">putimage_withalpha</span><span class="token punctuation">(</span>targetPimg<span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//截取图像的左上角部分绘制到窗口上，绘制区域左上角坐标为(20, 30)</span>
<span class="token function">putimage_withalpha</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2__885"></a>2. 图像透明绘制</h3> 
<h4><a id="21_putimage_alphablend__887"></a>2.1 putimage_alphablend() 图像半透明混合</h4> 
<p>  如下图所示，前两张是两张完全不透明的图片，经过半透明混合后，得到第三张图。可以看到，图片似乎变成了透明的，能看到后面的部分。<br> <img src="https://images2.imgbox.com/d4/6c/ki1XZfKX_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong><br>   混合两张图像，指定源图像的透明度。<br>   透明度参数alpha为0时，源图像全透明；alpha为255时，源图像完全不透明。<br> <img src="https://images2.imgbox.com/70/29/jZOmg4OS_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">putimage_alphablend</span><span class="token punctuation">(</span>
    PIMAGE imgdest<span class="token punctuation">,</span>		<span class="token comment">// 目标图像</span>
    PIMAGE imgsrc<span class="token punctuation">,</span>		<span class="token comment">// 源图像</span>
    <span class="token keyword">int</span> dstX<span class="token punctuation">,</span>			<span class="token comment">// 目标图像左上角x坐标 </span>
    <span class="token keyword">int</span> dstY<span class="token punctuation">,</span>			<span class="token comment">// 目标图像左上角y坐标</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> alpha<span class="token punctuation">,</span><span class="token comment">// alpha</span>
    <span class="token keyword">int</span> srcX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">// 源图像左上角x坐标</span>
    <span class="token keyword">int</span> srcY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">// 源图像左上角y坐标</span>
    <span class="token keyword">int</span> srcWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>	<span class="token comment">// 原图像混合区域宽度</span>
    <span class="token keyword">int</span> srcHeight <span class="token operator">=</span> <span class="token number">0</span>	<span class="token comment">// 源图像混合区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="23_putimage_transparent__912"></a>2.3 putimage_transparent() 指定图像透明像素</h4> 
<p>  用于指定源图像中某种颜色的像素变为全透明。<br>   下图中左边是原图，中间为在绘制时 <strong>指定源图像中的红色像素为透明色</strong>，绘制时红色就消失，看到的是<strong>背景色</strong>；右图为在绘制时 <strong>指定源图像中的绿色为透明色</strong> ， 绘制时绿色就变为透明，看到的是<strong>背景色</strong>。</p> 
<p><img src="https://images2.imgbox.com/01/63/gYyE0EV8_o.png" alt="在这里插入图片描述" width="600"><br> <strong>函数声明</strong><br>   目标图像参数传入NULL即绘制在窗口上。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">putimage_transparent</span><span class="token punctuation">(</span>
    PIMAGE imgdest<span class="token punctuation">,</span>			<span class="token comment">// 目标图像</span>
    PIMAGE imgsrc<span class="token punctuation">,</span>			<span class="token comment">// 源图像</span>
    <span class="token keyword">int</span> dstX<span class="token punctuation">,</span>				<span class="token comment">// 目标图像左上角x坐标 </span>
    <span class="token keyword">int</span> dstY<span class="token punctuation">,</span>				<span class="token comment">// 目标图像左上角y坐标</span>
    color_t crTransparent<span class="token punctuation">,</span>  <span class="token comment">// 源图像中要变成透明的像素颜色</span>
    <span class="token keyword">int</span> srcX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>			<span class="token comment">// 源图像左上角x坐标</span>
    <span class="token keyword">int</span> srcY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>			<span class="token comment">// 源图像左上角y坐标</span>
	<span class="token keyword">int</span> srcWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">// 原图像混合区域宽度</span>
    <span class="token keyword">int</span> srcHeight <span class="token operator">=</span> <span class="token number">0</span>		<span class="token comment">// 源图像混合区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  这个和 putimage_alphablend() 函数 只是有一个参数不同，透明度<strong>alpha</strong> 变成了一个颜色参数。</p> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
color_t transColor <span class="token operator">=</span> <span class="token function">EGERGB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">putimage_transparent</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> pimg<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> transColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="24_putimage_alphatransparent_944"></a>2.4 putimage_alphatransparent()</h4> 
<p>  这个就是上面两个的合体，把源图像的一些颜色为 crTransparent的像素点变透明，其它的地方进行透明度混合。<br> <strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">putimage_alphatransparent</span><span class="token punctuation">(</span>
    PIMAGE imgdest<span class="token punctuation">,</span>
    PIMAGE imgsrc<span class="token punctuation">,</span>
    <span class="token keyword">int</span> dstX
    <span class="token keyword">int</span> dstY<span class="token punctuation">,</span>
    color_t crTransparent<span class="token punctuation">,</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> alpha<span class="token punctuation">,</span>
    <span class="token keyword">int</span> srcX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">int</span> srcY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token keyword">int</span> srcWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">int</span> srcHeight <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3__963"></a>3. 旋转绘图</h3> 
<h4><a id="31_putimage_rotate_965"></a>3.1 putimage_rotate()</h4> 
<p>  将旋转一定角度后源图像绘制在目标图像上。</p> 
<p><img src="https://images2.imgbox.com/04/7f/mpQjvtRC_o.png" alt="在这里插入图片描述"><br>   这里需要注意的是旋转中心是以源图像的<strong>纹理坐标系</strong>来描述的。</p> 
<p><img src="https://images2.imgbox.com/7a/b1/9kRQ0atV_o.png" alt="在这里插入图片描述"></p> 
<p><strong>函数声明</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> EGEAPI <span class="token function">putimage_rotate</span><span class="token punctuation">(</span>
	PIMAGE imgdest<span class="token punctuation">,</span>			<span class="token comment">//目标图像</span>
	PIMAGE imgsrc<span class="token punctuation">,</span>			<span class="token comment">//源图像</span>
	<span class="token keyword">int</span> nXOriginDest<span class="token punctuation">,</span>		<span class="token comment">//目标绘制位置x坐标</span>
	<span class="token keyword">int</span> nYOriginDest<span class="token punctuation">,</span>		<span class="token comment">//目标绘制位置y坐标</span>
	<span class="token keyword">float</span> centerx<span class="token punctuation">,</span>			<span class="token comment">//旋转中心的纹理x坐标</span>
	<span class="token keyword">float</span> centery<span class="token punctuation">,</span>			<span class="token comment">//旋转中心的纹理y坐标</span>
	<span class="token keyword">float</span> radian<span class="token punctuation">,</span>			<span class="token comment">//旋转的弧度，弧度 = 角度 * π / 180  </span>
	<span class="token keyword">int</span> btransparent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>	<span class="token comment">//是否使用图像的透明通道</span>
	<span class="token keyword">int</span> alpha <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>			<span class="token comment">//图像整体透明度，范围为0~255, alpha=-1 意味着忽略透明度</span>
	<span class="token keyword">int</span> smooth <span class="token operator">=</span> <span class="token number">0</span>			<span class="token comment">//是否进行平滑处理</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>下面分别是旋转中心纹理坐标为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         − 
        
       
         0.5 
        
       
         , 
        
       
         − 
        
       
         0.5 
        
       
         ) 
        
       
      
        (-0.5, -0.5) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">−</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         0.0 
        
       
         , 
        
       
         0.0 
        
       
         ) 
        
       
      
        (0.0, 0.0) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         0.5 
        
       
         , 
        
       
         0.5 
        
       
         ) 
        
       
      
        (0.5, 0.5) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span> 的情况</p> 
<table><thead><tr><th></th><th>绕图像外部点旋转</th><th>绕图像左上角旋转</th><th>绕图像中心旋转</th></tr></thead><tbody><tr><td>旋转中心纹理坐标</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            − 
           
          
            0.5 
           
          
            , 
           
          
            − 
           
          
            0.5 
           
          
            ) 
           
          
         
           (-0.5, -0.5) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">−</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            0.0 
           
          
            , 
           
          
            0.0 
           
          
            ) 
           
          
         
           (0.0, 0.0) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            0.5 
           
          
            , 
           
          
            0.5 
           
          
            ) 
           
          
         
           (0.5, 0.5) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></td></tr><tr><td>效果图</td><td><img src="https://images2.imgbox.com/bf/0c/3zpqcSjP_o.gif" alt="在这里插入图片描述" width="200"></td><td><img src="https://images2.imgbox.com/71/4a/RlY4qWw0_o.gif" alt="在这里插入图片描述" width="200"></td><td><img src="https://images2.imgbox.com/ed/c5/RUMUIXgM_o.gif" alt="在这里插入图片描述" width="200"></td></tr></tbody></table> 
<h4><a id="32_putimage_rotatezoom_999"></a>3.2 putimage_rotatezoom()</h4> 
<p>  旋转的同时还允许缩放。 参数类似 <strong>putimage_rotate()</strong>，只多了个<strong>zoom</strong>参数， 表示缩放比例，1.0 表示不缩放。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> EGEAPI <span class="token function">putimage_rotatezoom</span><span class="token punctuation">(</span>
	PIMAGE imgdest<span class="token punctuation">,</span>
	PIMAGE imgtexture<span class="token punctuation">,</span>
	<span class="token keyword">int</span> nXOriginDest<span class="token punctuation">,</span>
	<span class="token keyword">int</span> nYOriginDest<span class="token punctuation">,</span>
	<span class="token keyword">float</span> centerx<span class="token punctuation">,</span>
	<span class="token keyword">float</span> centery<span class="token punctuation">,</span>
	<span class="token keyword">float</span> radian<span class="token punctuation">,</span>
	<span class="token keyword">float</span> zoom<span class="token punctuation">,</span>
	<span class="token keyword">int</span> btransparent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>           <span class="token comment">// transparent (1) or not (0)</span>
	<span class="token keyword">int</span> alpha <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>                  <span class="token comment">// in range[0, 256], alpha== -1 means no alpha</span>
	<span class="token keyword">int</span> smooth <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="4__1018"></a>4. 模糊滤镜</h3> 
<p>  对一图片区域进行模糊滤镜操作。</p> 
<p><strong>函数声明</strong><br>   对目标图像的某个区域进行模糊。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">imagefilter_blurring</span> <span class="token punctuation">(</span>
    PIMAGE imgdest<span class="token punctuation">,</span>				<span class="token comment">//目标图像</span>
    <span class="token keyword">int</span> intensity<span class="token punctuation">,</span>				<span class="token comment">//模糊度</span>
    <span class="token keyword">int</span> alpha<span class="token punctuation">,</span>					<span class="token comment">//亮度</span>
    <span class="token keyword">int</span> nXOriginDest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">//区域左上角坐标x</span>
    <span class="token keyword">int</span> nYOriginDest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>		<span class="token comment">//区域左上角坐标y</span>
    <span class="token keyword">int</span> nWidthDest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>			<span class="token comment">//区域宽度</span>
    <span class="token keyword">int</span> nHeightDest <span class="token operator">=</span> <span class="token number">0</span>			<span class="token comment">//区域高度</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数说明：</p> 
<ul><li>intensity, 模糊度，值越大越模糊。范围为0 ~ 0xFF(0~255)，值为0时和原图一样。 当值在 0x0 - 0x7F之间时，为四向模糊；当值在 0x80 - 0xFF之间时，为八向模糊，运算量会大一倍。</li><li>alpha<br> 图像亮度，越大越亮，。取值为0x100（即256）表示亮度不变，取值为0x0表示图像变成纯黑。</li></ul> 
<p>下面是效果，右边为模糊后的图。</p> 
<p><img src="https://images2.imgbox.com/e1/02/Ey2elMJ1_o.png" alt="在这里插入图片描述" width="600"></p> 
<h2><a id="_1044"></a>六、图像其它操作</h2> 
<h3><a id="1__1045"></a>1. 图像属性</h3> 
<h4><a id="11__1046"></a>1.1 重设图像尺寸</h4> 
<p>  重新分配内存，改变图像大小(原图像内容丢失)</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>  注意，我们不能用这个来对图像直接进行缩放，因为使用后图像内容会丢失，主要用于对图形的内存重新进行动态分配。</p> 
</blockquote> 
<p><strong>示例代码</strong></p> 
<pre><code class="prism language-cpp"><span class="token function">resize</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="12__1058"></a>1.2 获取图像宽度和高度</h4> 
<p>  假设有一张图片</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  那么可以获取图片的宽高（单位像素）</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span>
<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span>
</code></pre> 
<p>  其中，图像指针pimg默认值为NULL， 表示获取的是窗口。</p> 
<blockquote> 
 <p>   <strong>getmaxx()</strong>, 同 <strong>getwidth( )</strong>, <strong>getmaxy()</strong>, 同 <strong>getheight( )</strong></p> 
</blockquote> 
<p><br></p> 
<h3><a id="2__1072"></a>2. 获取和设置图像像素</h3> 
<h4><a id="21__getpixel_putpixel_1073"></a>2.1 图像像素点: getpixel() 和putpixel()</h4> 
<blockquote> 
 <p>  获取图像中某个像素点的颜色可使用 <code>getpixel()</code> 函数。<br>   设置图像中某个像素点的颜色可使用 <code>putpixel()</code> 函数。</p> 
</blockquote> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp">color_t <span class="token function">getpixel</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> PIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>    <span class="token function">putpixel</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> color_t color<span class="token punctuation">,</span> PIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>  注意，这个获取的是 <strong>ARGB</strong> 颜色。==</p> 
</blockquote> 
<p><strong>getpixel()使用示例:</strong></p> 
<pre><code class="prism language-cpp">color_t ARGBcolor <span class="token operator">=</span> <span class="token function">getpixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>putpixel()使用示例:</strong></p> 
<pre><code class="prism language-cpp">color_t ARGBcolor <span class="token operator">=</span> WHITE<span class="token punctuation">;</span>
<span class="token function">putpixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="22__1094"></a>2.2 那如何获取窗口像素点颜色呢</h4> 
<blockquote> 
 <p>  <strong>获取窗口像素点颜色</strong> 同样是使用 <code>getpixel()</code> ，可以看到 <code>getpixel()</code> 第三个参数是<code>PIMAGE</code>类型，默认参数为<code>NULL</code>，参数为<code>NULL</code> 时指的就是 <strong>窗口</strong>。<br>   同样地，<strong>设置窗口像素点颜色</strong> 也用<code>putpixel()</code>，<code>PIMAGE</code>参数传入<code>NULL</code>或使用默认参数即可。</p> 
</blockquote> 
<p><code>getpixel()</code> 第三个参数省略或者传入<code>NULL</code>时，即为获取窗口像素点颜色。</p> 
<p>获取窗口像素点的ARGB颜色:</p> 
<pre><code class="prism language-cpp">color_t ARGBcolor <span class="token operator">=</span> <span class="token function">getpixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>获取窗口像素点的RGB颜色，即将透明度设置为0xFF。</p> 
<pre><code class="prism language-cpp">color_t RGBcolor <span class="token operator">=</span> <span class="token function">EGEACOLOR</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token function">getpixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="22_getpixel_f__putpixel_f_1109"></a>2.2 更快的像素操作:getpixel_f() 和 putpixel_f()</h4> 
<p><strong>函数声明:</strong></p> 
<pre><code class="prism language-cpp">color_t <span class="token function">getpixel_f</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> PCIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>    <span class="token function">putpixel_f</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> color_t color<span class="token punctuation">,</span> PIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置图像像素</span>
</code></pre> 
<p>   <code>getpixel_f()</code> 函数和 <code>getpixel()</code> 函数相比 少了<strong>边界判断</strong>操作， 也就是说 <strong>不判断像素点坐标是否在图像范围内</strong>。这样带来的是更快的速度，但牺牲了安全性，可能发生访问越界。<mark><strong>可以在确保像素点坐标<code>(x, y)</code>在有效范围内时使用。</strong></mark></p> 
<p>  比如遍历图像所有像素点的情况下，就可以使用。遍历时已经确保了坐标的有效性，此时内部无需做边界判断。</p> 
<p><strong>示例：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">forEachPixel</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> width  <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//遍历图像像素点</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//获取图像像素点颜色</span>
			color_t color <span class="token operator">=</span> <span class="token function">getpixel_f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  <strong>实际上更快的是利用<code>getbuffer()</code>获取图像的内部缓冲区首地址，直接获取数组值，这样可节省函数调用的开销。</strong></p> 
<h4><a id="23_getbuffer_1139"></a>2.3 获取图像缓冲区:getbuffer()</h4> 
<p>  调用 **getbuffer()**可以得到图像内部缓冲区的首地址，我们可以通过直接读写缓冲区数据来达到高效进行图像处理的目的。</p> 
<p><strong>函数声明</strong>：</p> 
<pre><code class="prism language-cpp">color_t<span class="token operator">*</span>	<span class="token function">getbuffer</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
color_t<span class="token operator">*</span>	<span class="token function">getbuffer</span><span class="token punctuation">(</span>PCIMAGE pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  如果参数 <strong>pimg</strong> 为NULL，那么获取的是EGE窗口缓存的首地址，传入其它图像则获取该图像的帧缓冲首地址。</p> 
<p>  getbuffer()有两个重载，当参数是NULL时，将不确定调用的是哪个函数，所以需要强制转换一下：</p> 
<pre><code class="prism language-cpp"><span class="token function">getbuffer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PIMAGE<span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getbuffer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PCIMAGE<span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  <strong>getbuffer()<strong>返回的是</strong>缓冲区的首地址</strong>，是<strong>一维指针</strong>， 缓冲区大小可以通过 <strong>getwidth(), getheight()</strong> 获取得到的原图像大小来确定，缓冲区总像素个数为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         i 
        
       
         d 
        
       
         t 
        
       
         h 
        
       
         ⋅ 
        
       
         h 
        
       
         e 
        
       
         i 
        
       
         g 
        
       
         h 
        
       
         t 
        
       
      
        \mathrm{width \cdot height} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathrm" style="margin-right: 0.01389em;">w</span><span class="mord mathrm">i</span><span class="mord mathrm">d</span><span class="mord mathrm">t</span><span class="mord mathrm">h</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right: 0.01389em;">g</span><span class="mord mathrm">h</span><span class="mord mathrm">t</span></span></span></span></span></span>。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> width  <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  以下为遍历缓冲区所有像素：</p> 
<pre><code class="prism language-cpp">color_t<span class="token operator">*</span> buffer <span class="token operator">=</span> <span class="token function">getbuffer</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> len<span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> color<span class="token punctuation">;</span>
</code></pre> 
<p>  注意，因为是一维数组，所以对于图像上 <strong>坐标为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         (x, y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 的像素</strong>，表示是 <strong>buffer[y * width + x]</strong> , 而不是 <strong>buffer[y][x]</strong>。</p> 
<p>  如下图所示：<br> <img src="https://images2.imgbox.com/b4/8c/A01Vdddy_o.png" alt="在这里插入图片描述"></p> 
<p>  所以图像从上到下，从左到右遍历每个像素应该为：</p> 
<pre><code class="prism language-cpp">color_t<span class="token operator">*</span> buffer <span class="token operator">=</span> <span class="token function">getbuffer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PIMAGE<span class="token punctuation">)</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//这里面进行图像处理，将坐标为(x, y)的元素赋值一个颜色</span>
		buffer<span class="token punctuation">[</span>x <span class="token operator">+</span> y <span class="token operator">*</span> width<span class="token punctuation">]</span> <span class="token operator">=</span> color<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  下面做个利用 <strong>getbuffer()</strong> 返回的帧缓冲首地址 将 RGB彩色图像转灰度图 的示例。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//#define SHOW_CONSOLE</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token comment">//从图片文件fileName 中加载图像，图像缩放到成 width * height</span>
<span class="token keyword">void</span> <span class="token function">getZoomImage</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fileName<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	PIMAGE temp <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">!=</span> width <span class="token operator">||</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span> <span class="token operator">!=</span> height<span class="token punctuation">)</span>
		<span class="token function">resize</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">putimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getheight</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">delimage</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//设置为普通窗口, 设置窗口位置, 手动渲染模式</span>
	<span class="token function">setinitmode</span><span class="token punctuation">(</span>INIT_RENDERMANUAL<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//初始化窗口</span>
	<span class="token function">setcaption</span><span class="token punctuation">(</span><span class="token string">"EGE彩色图转灰度图"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//设置窗口标题</span>

	<span class="token comment">//设置窗口背景为白色</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//获取图片</span>
	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getZoomImage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"girl.jpg"</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//绘制原图，作参照</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//获取图像缓存区首地址</span>
	color_t<span class="token operator">*</span> buffer <span class="token operator">=</span> <span class="token function">getbuffer</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//计算图像大小</span>
	<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getwidth</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token function">getheight</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//彩色图转灰度图</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			color_t color <span class="token operator">=</span> buffer<span class="token punctuation">[</span>x <span class="token operator">+</span> y<span class="token operator">*</span>width<span class="token punctuation">]</span><span class="token punctuation">;</span>

			<span class="token comment">//获取颜色原来透明度，因为源图像可能是带有透明度的，这样可以保留下来</span>
			<span class="token keyword">unsigned</span> <span class="token keyword">int</span>  alpha <span class="token operator">=</span> <span class="token function">EGEGET_A</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//将原来RGB颜色转成灰色</span>
			color_t gray <span class="token operator">=</span> <span class="token function">RGBtoGRAY</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//将alpha值和计算出的灰度值合成对应的灰色			</span>
			buffer<span class="token punctuation">[</span>x <span class="token operator">+</span> y <span class="token operator">*</span> width<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">EGEAGRAY</span><span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//把修改后的图片绘制出来</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//如果原图带有透明度，可以用下面这个绘制图像</span>
	<span class="token comment">//putimage_withalpha(NULL, 0, 0, imgdest);</span>

	<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//销毁图像</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//绘图结束，关闭窗口</span>
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ab/4c/vbsigA6S_o.png" alt="在这里插入图片描述" width="640"></p> 
<h3><a id="3__1265"></a>3. 图像保存</h3> 
<p>  EGE可以将图像保存成 <strong>BMP</strong> 格式文件或 <strong>PNG</strong> 格式文件。</p> 
<table><thead><tr><th>保存的图片格式</th><th>函数</th></tr></thead><tbody><tr><td>BMP</td><td>saveimage()</td></tr><tr><td>PNG</td><td>savepng()</td></tr></tbody></table> 
<h4><a id="31_BMP_1275"></a>3.1 保存成BMP格式图片</h4> 
<p>  <strong>saveimage()</strong> 可将PIMAGE中的图像保存成BMP格式的图像文件中。</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span>  <span class="token function">saveimage</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCSTR  filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>  <span class="token function">saveimage</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCWSTR filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>  filename是文件名，如 <code>"image.bmp"</code>。如果文件名不带路径，则默认保存在当前目录中，会覆盖掉同名文件。</p> 
<blockquote> 
 <p>  文件扩展名应是 <strong>bmp</strong>, 因为保存的图片是BMP格式。虽然你写成jpg, png都可以用图像软件打开，但这只是因为大多图像软件都有自动识别文件格式的功能。应该按照图片实际格式来命名。</p> 
</blockquote> 
<p>使用示例:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//创建图像并获取</span>
PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getimage</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">//保存图像</span>
<span class="token function">saveimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"img.bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<h4><a id="32_png_1298"></a>3.2 保存成png格式图片</h4> 
<p>  <strong>savepng()</strong> 可将PIMAGE中的图像保存到PNG图像文件中。<br>   filename是文件名，如 <code>"image.bmp"</code>。如果文件名不带路径，则默认保存在当前目录中，会覆盖掉同名文件。</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span>  <span class="token function">savepng</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCSTR  filename<span class="token punctuation">,</span> <span class="token keyword">int</span> bAlpha <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>  <span class="token function">savepng</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">,</span> LPCWSTR filename<span class="token punctuation">,</span> <span class="token keyword">int</span> bAlpha <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数说明：</p> 
<blockquote> 
 <ul><li>pimg：PIMAGE 图像</li><li>filename: 保存的文件名。</li><li><strong>bAlpha</strong> ，是否保存Alpha透明通道， true是<strong>带alpha通道保存</strong>，false是不带alpha通道保存，默认为不保存。</li></ul> 
</blockquote> 
<p>使用示例:<code>(pimg为PIMAGE图像, 保存有图像数据)</code></p> 
<pre><code class="prism language-cpp"><span class="token function">savepng</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"img.png"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<h2><a id="_1318"></a>七、资源文件</h2> 
<blockquote> 
 <p>  <strong>资源文件在编译时会被压缩打包放入执行文件中，exe文件运行时无需从外部读取其它文件</strong>。这样制作成程序时，就不用担心因放在外面的图片音乐等文件丢失而导致运行出错的情况，<strong>因为文件已经嵌入exe执行文件中</strong>，不再依赖外部文件。</p> 
</blockquote> 
<p>  <strong>因为资源文件会被编译嵌入exe执行文件中，不再是文件的形式，所以就不能像普通文件那样通过路径来读取</strong>。</p> 
<p>  如下图所示，VS项目中有个<strong>资源文件</strong> 过滤器，这里就保存着资源文件和其它一些相关文件。<br> <img src="https://images2.imgbox.com/31/f7/JJ7rUmsY_o.png" alt="在这里插入图片描述" width="300"></p> 
<h3><a id="1__1326"></a>1. 不同编译器读取资源文件方法</h3> 
<p>  不同的编译器有其管理资源文件的方法，文件需要按其要求的方式进行配置，才会打包到执行文件中。</p> 
<p>  下面是各编译器以读取资源文件的方式获取图片。</p> 
<h3><a id="2_VCVS2017_1332"></a>2. VC系列(VS2017)</h3> 
<h4><a id="21__1333"></a>2.1 添加图片资源文件</h4> 
<h5><a id="211__1334"></a>2.1.1 步骤</h5> 
<ul><li>右键点击<strong>资源文件</strong>文件夹， 选择 <strong>添加-&gt;资源</strong><br> <img src="https://images2.imgbox.com/fa/23/x9WH0K31_o.png" alt="在这里插入图片描述"></li><li>选择<strong>Bitmap</strong>, 点击 <strong>“导入”</strong><br> <img src="https://images2.imgbox.com/ae/e4/TLsjItFB_o.png" alt="在这里插入图片描述" width="500"></li><li>这时进入到文件选择界面，设置文件类型为<strong>所有文件</strong><br> <img src="https://images2.imgbox.com/dc/32/ep12CD2b_o.png" alt="在这里插入图片描述"></li><li>然后就能选择自己想要添加的图片了，现在以 jpg图片为例。<br> 选中后会要求填写资源类型，JPG图片就写入JPG, 然后点击<strong>确定</strong><br> <img src="https://images2.imgbox.com/a9/75/XFXG0clf_o.png" alt="在这里插入图片描述" width="400"></li><li>然后就能看到项目中多出了<strong>resource.h头文件</strong> 和 <strong>项目名.rc资源文件</strong>， 还有我们添加的JPG图片<code>(并且会自动打开我们添加的图片，不用编辑，关闭就好)</code>。<br> <img src="https://images2.imgbox.com/19/7a/1RYgF4wl_o.png" alt="在这里插入图片描述"></li><li>点击<strong>资源视图</strong>，可以看到我们添加的资源文件。看到有个 <strong>“JPG”</strong> 文件夹， 这就是我们之前 <strong>填写的资源类型</strong><br> 可以看到下面有个<strong>IDR_JPG1</strong>, 这就是我们添加的资源文件的名字<br> <img src="https://images2.imgbox.com/ed/da/V4hPiJwe_o.png" alt="在这里插入图片描述"></li><li>可以点击<strong>资源文件名</strong>，然后点击 <strong>属性</strong>，修改成容易记的资源名<br> <img src="https://images2.imgbox.com/81/fd/VLHPuPhz_o.png" alt="在这里插入图片描述" width="400"></li><li>在ID这一栏修改，比如，我修改成JPG_BG<br> <img src="https://images2.imgbox.com/70/8c/fPlQ6D7d_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="212_resourceh__1355"></a>2.1.2 resource.h 头文件内容</h5> 
<p>打开resource.h 头文件，就会看到如下内容<br> 就是一些宏定义， 代表了我们<strong>添加的资源的编号</strong>, 我们就是根据这个编号读取资源的。<br> 下面有两个是相同的编号，是因为第二个是我刚才修改的名字，第一个现在已经没用了。<br> <img src="https://images2.imgbox.com/f2/8b/ledQPa9X_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="213_rc__1360"></a>2.1.3 项目名.rc 文件内容</h5> 
<p>对 <strong>.rc文件</strong> 右键，选择 <strong>查看代码F7</strong><br> <img src="https://images2.imgbox.com/a2/c6/1Knwfnwo_o.png" alt="在这里插入图片描述" width="500"></p> 
<ul><li>如果弹出这种框，选<strong>是</strong><br> <img src="https://images2.imgbox.com/a3/89/q8EPhg6f_o.png" alt="在这里插入图片描述" width="480"></li><li>往下拉看到下面这部分<br> 绿色的就是 <strong>资源名称</strong>， 蓝色的是 <strong>资源类型</strong>， 紫色的是 <strong>带相对路径的文件名</strong><br> <img src="https://images2.imgbox.com/36/e2/v7iDcRGk_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="22__1368"></a>2.2 资源文件的读取</h4> 
<p>  现在资源文件已经添加完成。那么在程序中如何读取资源文件呢？<br>   <mark>先在文件中 包含 <strong>resource.h</strong> 头文件<code>(注意了，那个头文件不一定是叫resource.h，因为生成时可能会因重名而重命名)</code></mark></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"resource.h"</span></span>
</code></pre> 
<p>然后就是查看资源文件的宏定义， 我之前命名是叫 <strong>JPG_BG</strong><br> <img src="https://images2.imgbox.com/03/4d/q5YhHeAu_o.png" alt="在这里插入图片描述"><br> 然后看看 <strong>getimage()</strong> 的参数要求，<strong>资源类型</strong>和<strong>资源名称</strong>都是<strong>字符串参数</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
	PIMAGE pimg<span class="token punctuation">,</span>			<span class="token comment">// 保存图像的 IMAGE 对象指针</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pResType<span class="token punctuation">,</span>	<span class="token comment">// 资源类型</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pResName<span class="token punctuation">,</span>	<span class="token comment">// 资源名称</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">getimage</span><span class="token punctuation">(</span>
	PIMAGE pimg<span class="token punctuation">,</span>			<span class="token comment">// 保存图像的 IMAGE 对象指针</span>
	<span class="token keyword">const</span> WCHAR<span class="token operator">*</span> pResType<span class="token punctuation">,</span>	<span class="token comment">// 资源类型</span>
	<span class="token keyword">const</span> WCHAR<span class="token operator">*</span> pResName<span class="token punctuation">,</span>	<span class="token comment">// 资源名称</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p>  <strong>资源类型</strong>前面说了，就是.rc 文件中写的 <strong>JPG</strong>， 所以填 <strong>“JPG”</strong>。<br>   而<strong>资源名称</strong>需要字符串，我们只是有一个数字编号， 宏定义是JPG_BG，需要通过宏定义<strong>MAKEINTRESOURCE()</strong> 来获取相应的字符串。<br>   <mark>因为上面有两个重载，有一个是用于char, 一个是用于宽字符WCHAR，当用于宽字符时，字符串需要加L</mark></p> 
<p>即，按照上面</p> 
<pre><code class="prism language-cpp"><span class="token string">"JPG"</span>  与 <span class="token function">MAKEINTRESOURCEA</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span> 配对
L<span class="token string">"JPG"</span> 与 <span class="token function">MAKEINTRESOURCEW</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span> 配对
</code></pre> 
<p>或者使用<code>TEXT</code>宏来帮助确定</p> 
<pre><code class="prism language-cpp"><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"JPG"</span><span class="token punctuation">)</span> 与 <span class="token function">MAKEINTRESOURCE</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span> 配对
</code></pre> 
<p>所以如下便可获取:</p> 
<pre><code class="prism language-cpp">PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"JPG"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MAKEINTRESOURCE</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
或者
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token function">MAKEINTRESOURCEA</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> L<span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token function">MAKEINTRESOURCEW</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p>下面是例程:</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"resource.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//从资源文件获取</span>
	PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token function">MAKEINTRESOURCEA</span><span class="token punctuation">(</span>JPG_BG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//在窗口上绘制</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/d8/b6/Xgc0oL9q_o.png" alt="在这里插入图片描述" width="600"></p> 
<h3><a id="3_CodeBlocks_1440"></a>3. CodeBlocks</h3> 
<h4><a id="31_rc_1441"></a>3.1 创建rc文件</h4> 
<p>在项目，点击工具栏<strong>文件(File) -&gt;新建(new)-&gt;空文件(empty file)</strong><br> 选择<strong>是</strong>(添加到项目中)<br> <img src="https://images2.imgbox.com/dd/f6/3aItfPeN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/54/31/KY7BpVJo_o.png" alt="在这里插入图片描述" width="600"></p> 
<ul><li>文件命名，<mark>扩展名需要是 <strong>rc</strong></mark>, 这里命名为 <strong>resource.rc</strong><br> <img src="https://images2.imgbox.com/71/e2/h2giekiz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/97/f8/kRdIbhFm_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="32_rc_1449"></a>3.2 编写rc文件</h4> 
<h5><a id="321__1450"></a>3.2.1 先把图片文件放到项目中</h5> 
<p>可以看到我图片的放在当前目录下的，文件名就是 <strong>“花火bg.jpg”</strong>，也可以自己新建个文件夹，把图片放进去，这样方便管理，<strong>不要随便扔桌面上</strong>。<br> <img src="https://images2.imgbox.com/2f/c1/a8bnE9T2_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="322_rc_1453"></a>3.2.2 编写rc文件</h5> 
<ul><li>rc文件中的资源格式：</li></ul> 
<pre><code class="prism language-cpp">资源名称		资源类型		<span class="token string">"带路径文件名"</span>
</code></pre> 
<p>资源类型和资源名称自己命名<code>(资源类型最好按照文件格式命名)</code>，这里命名</p> 
<ul><li>资源类型： <strong>JPG</strong></li><li>资源名称： <strong>IMAGE_JPG_BG</strong></li></ul> 
<p>  <mark>上面用到<strong>带路径文件名</strong>，如果不知道是什么，请去看 <strong>（二十一）文件名 绝对路径与相对路径</strong></mark>，推荐用<strong>相对路径</strong><br>   编写如下：</p> 
<pre><code class="prism language-cpp">IMAGE_JPG_BG            JPG     <span class="token string">"花火bg.jpg"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/77/fiylx80H_o.png" alt="在这里插入图片描述"><br> 然后程序中就可以用getimage()获取了</p> 
<pre><code class="prism language-cpp"><span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"资源类型"</span><span class="token punctuation">,</span> <span class="token string">"资源名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>按如上则填写为</p> 
<pre><code class="prism language-cpp"><span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token string">"IMAGE_JPG_BG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>源文件中完整程序如下：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setbkcolor</span><span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//从资源文件读取图像</span>
    PIMAGE pimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">,</span> <span class="token string">"JPG"</span><span class="token punctuation">,</span> <span class="token string">"IMAGE_JPG_BG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//绘制</span>
    <span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//释放图像</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后点击<strong>构建(Build)</strong>，查看有没有错误, 没有错误就可以点击运行了，就能看到显示的图片了。</p> 
<ul><li>如果编译出现错误，出现以下看不懂的汉字，说明 <strong>乱码</strong> 了, 因为图片名有汉字，汉字在不同的编码格式下编码是不同的，要么图片文件名<strong>不用汉字用英文</strong>，要么<strong>设置编码格式</strong><br> <img src="https://images2.imgbox.com/10/13/jQHlqtP3_o.png" alt="在这里插入图片描述"><br> <strong>CodeBlocks 设置编码</strong>：<br> 点击工具栏 <strong>设置(settings)-&gt;编辑器(editor…)</strong><br> <img src="https://images2.imgbox.com/f3/cd/2e6mHsAr_o.png" alt="在这里插入图片描述"></li><li>点击 左边 <strong>通用设置(Generak)</strong>, 点击 <strong>编码设置(Encoding settings)</strong><br> 编码中选择 <mark><strong>windows-936</strong></mark> , 即 <strong>GBK</strong> 编码, 在中文系统下，使用的还有<strong>GB2312</strong>编码。<br> 点击 <strong>确定(OK)</strong><br> <img src="https://images2.imgbox.com/6c/94/NApxbxQM_o.png" alt="在这里插入图片描述"><br> 然后<strong>rc资源文件</strong>中的文件名删去，重新输入一遍文件名，点击 <strong>重新构建(Rebuild)</strong>, 就可以看到编译没有问题了。运行即可<br> <mark>如果你的资源类型是ICON ， 文件是.ico文件，那么编译后自动使用这个ico文件作为程序的图标</mark></li></ul> 
<h3><a id="4_DevC_1516"></a>4. DevC++</h3> 
<h4><a id="41_rc_1517"></a>4.1 创建rc文件</h4> 
<ul><li>新建文件, 添加到项目中<br> <img src="https://images2.imgbox.com/35/32/mefPUv6o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d0/e2/X2Dj45CC_o.png" alt="在这里插入图片描述" width="240"></li><li>保存文件，扩展名为 <strong>rc</strong>, 命名随意，这里命名为 <strong>resource.rc</strong><br> <img src="https://images2.imgbox.com/07/4f/diTmfkOm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/57/c8/BDQPJaXw_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="42_RC_1524"></a>4.2 编写RC文件</h4> 
<p>  接下来是编写RC文件<code>(即资源文件)</code>，内容和 <strong>CodeBlocks</strong>是一样的，包括测试代码也相同，因为都是用的GCC编译器，所以可以翻到上面CodeBlocks部分查看RC文件的编写</p> 
<hr> 
<p>EGE专栏：<a href="https://blog.csdn.net/qq_39151563/category_9311717.html">EGE专栏</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4141fb799683827c7772bf1a97d85f7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于Event Loop事件循环</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fb9e95b0cfe58466dd7bee1326ffc98/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解开Kafka神秘的面纱(三)：kafka单机部署和集群部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>