<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python实现自动登录&#43;获取数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python实现自动登录&#43;获取数据" />
<meta property="og:description" content="前言 Dy这个东西想必大家都用过，而且还经常刷，今天就来用代码，获取它的视频数据
环境使用 Python 3.8
Pycharm
模块使用 requests
selenium
json
re
一. 数据来源分析 1. 明确需求
明确采集网站以及数据内容
网址: https://www.dy.com/user/MS4wLjABAAAAB0-gppwu15DtJJZmMpgUqakr7Jw_pmr7skR3IW6MwCQ?modal_id=7270865943398518050 数据: 视频链接 / 视频标题
2. 抓包分析
通过开发者工具进行抓包分析
I. 打开开发者工具: F12
II. 刷新网页
III. 找到数据链接
视频链接: https://v26-web.dyvod.com/295eea512e6f187309e6181297ec185e/64e8a7f8/video/tos/cn/tos-cn-ve-15c001-alinc2/o8vKACOD9NSbaA3mnggzfIO5QAgkqHnGr7sAeB/?a=6383&amp;ch=26&amp;cr=3&amp;dr=0&amp;lr=all&amp;cd=0%7C0%7C0%7C3&amp;cv=1&amp;br=609&amp;bt=609&amp;cs=2&amp;ds=3&amp;ft=bvTKJbQQqU-mfJ4ZPo0OW_EklpPiXV8zNMVJEdBqSpvPD-I&amp;mime_type=video_mp4&amp;qs=15&amp;rc=NTg8NzpoNGY2aGU0N2k1PEBpajhuNTY6ZmhtbTMzNGkzM0AtMy4xY2E0Xi4xYDNjX15iYSM2bl5scjRvLWdgLS1kLWFzcw%3D%3D&amp;btag=e00010000&amp;dy_q=1692965337&amp;l=20230825200856A1A3326D295C25055965 IV. 通过关键字搜索, 找到链接对应数据包
视频链接 / 标题 --&gt; 来自于网页源代码&lt;进行编码&gt;
数据包: https://www.dy.com/user/MS4wLjABAAAAB0-gppwu15DtJJZmMpgUqakr7Jw_pmr7skR3IW6MwCQ?modal_id=7270865943398518050 二. 代码实现步骤 发送请求, 模拟浏览器对于url地址发送请求获取数据, 获取服务器返回响应数据解析数据, 提取我们需要的数据内容保存数据, 保存视频数据 代码实现 发送请求 模拟浏览器: &lt;可以直接复制&gt;
response.text 获取响应文本数据
response.json() 获取响应json数据
response.content 获取响应二进制数据
我们使用requests.get()方法向指定的URL发送GET请求，并获取到响应的内容
headers = { # User-Agent 用户代理, 表示浏览器基本身份信息 &#39;User-Agent&#39;: &#39;Mozilla/5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3fd2a2fb50a3be790f505a519d4f1226/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-27T00:08:03+08:00" />
<meta property="article:modified_time" content="2023-08-27T00:08:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python实现自动登录&#43;获取数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>Dy这个东西想必大家都用过，而且还经常刷，今天就来用代码，获取它的视频数据</p> 
<h4><a id="_3"></a>环境使用</h4> 
<p>Python 3.8<br> Pycharm</p> 
<h4><a id="_7"></a>模块使用</h4> 
<p>requests<br> selenium<br> json<br> re</p> 
<h4><a id="__13"></a>一. 数据来源分析</h4> 
<p><strong>1. 明确需求</strong><br> 明确采集网站以及数据内容</p> 
<pre><code class="prism language-python">网址<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>dy<span class="token punctuation">.</span>com<span class="token operator">/</span>user<span class="token operator">/</span>MS4wLjABAAAAB0<span class="token operator">-</span>gppwu15DtJJZmMpgUqakr7Jw_pmr7skR3IW6MwCQ?modal_id<span class="token operator">=</span><span class="token number">7270865943398518050</span>
</code></pre> 
<p>数据: 视频链接 / 视频标题<br> <strong>2. 抓包分析</strong><br> 通过开发者工具进行抓包分析<br> I. 打开开发者工具: F12<br> II. 刷新网页<br> III. 找到数据链接</p> 
<pre><code class="prism language-python">视频链接<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>v26<span class="token operator">-</span>web<span class="token punctuation">.</span>dyvod<span class="token punctuation">.</span>com<span class="token operator">/</span>295eea512e6f187309e6181297ec185e<span class="token operator">/</span>64e8a7f8<span class="token operator">/</span>video<span class="token operator">/</span>tos<span class="token operator">/</span>cn<span class="token operator">/</span>tos<span class="token operator">-</span>cn<span class="token operator">-</span>ve<span class="token operator">-</span>15c001<span class="token operator">-</span>alinc2<span class="token operator">/</span>o8vKACOD9NSbaA3mnggzfIO5QAgkqHnGr7sAeB<span class="token operator">/</span>?a<span class="token operator">=</span><span class="token number">6383</span><span class="token operator">&amp;</span>ch<span class="token operator">=</span><span class="token number">26</span><span class="token operator">&amp;</span>cr<span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span>dr<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>lr<span class="token operator">=</span><span class="token builtin">all</span><span class="token operator">&amp;</span>cd<span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span>7C0<span class="token operator">%</span>7C0<span class="token operator">%</span>7C3<span class="token operator">&amp;</span>cv<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>br<span class="token operator">=</span><span class="token number">609</span><span class="token operator">&amp;</span>bt<span class="token operator">=</span><span class="token number">609</span><span class="token operator">&amp;</span>cs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>ds<span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span>ft<span class="token operator">=</span>bvTKJbQQqU<span class="token operator">-</span>mfJ4ZPo0OW_EklpPiXV8zNMVJEdBqSpvPD<span class="token operator">-</span>I<span class="token operator">&amp;</span>mime_type<span class="token operator">=</span>video_mp4<span class="token operator">&amp;</span>qs<span class="token operator">=</span><span class="token number">15</span><span class="token operator">&amp;</span>rc<span class="token operator">=</span>NTg8NzpoNGY2aGU0N2k1PEBpajhuNTY6ZmhtbTMzNGkzM0AtMy4xY2E0Xi4xYDNjX15iYSM2bl5scjRvLWdgLS1kLWFzcw<span class="token operator">%</span>3D<span class="token operator">%</span>3D<span class="token operator">&amp;</span>btag<span class="token operator">=</span>e00010000<span class="token operator">&amp;</span>dy_q<span class="token operator">=</span><span class="token number">1692965337</span><span class="token operator">&amp;</span>l<span class="token operator">=</span>20230825200856A1A3326D295C25055965
</code></pre> 
<p>IV. 通过关键字搜索, 找到链接对应数据包<br> 视频链接 / 标题 --&gt; 来自于网页源代码&lt;进行编码&gt;</p> 
<pre><code class="prism language-python">数据包<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>dy<span class="token punctuation">.</span>com<span class="token operator">/</span>user<span class="token operator">/</span>MS4wLjABAAAAB0<span class="token operator">-</span>gppwu15DtJJZmMpgUqakr7Jw_pmr7skR3IW6MwCQ?modal_id<span class="token operator">=</span><span class="token number">7270865943398518050</span>
</code></pre> 
<h4><a id="__33"></a>二. 代码实现步骤</h4> 
<ol><li>发送请求, 模拟浏览器对于url地址发送请求</li><li>获取数据, 获取服务器返回响应数据</li><li>解析数据, 提取我们需要的数据内容</li><li>保存数据, 保存视频数据</li></ol> 
<h2><a id="_39"></a>代码实现</h2> 
<h4><a id="_40"></a>发送请求</h4> 
<blockquote> 
 <p>模拟浏览器: &lt;可以直接复制&gt;<br> response.text 获取响应文本数据<br> response.json() 获取响应json数据<br> response.content 获取响应二进制数据<br> 我们使用requests.get()方法向指定的URL发送GET请求，并获取到响应的内容</p> 
</blockquote> 
<pre><code class="prism language-python">headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment"># User-Agent 用户代理, 表示浏览器基本身份信息</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 请求链接</span>
url <span class="token operator">=</span> <span class="token string">'https://www.dy.com/user/MS4wLjABAAAArgJe6h-DzQcvyZ1O71yXSdJFn19Tqq8lFCIffgy5SlhwYlkseK5aM5ETF8KoaGDK?modal_id=7270476649714421046&amp;vid=7269532986553552140'</span>
<span class="token comment"># 发送请求</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_58"></a>解析数据</h4> 
<blockquote> 
 <p>使用正则表达式来搜索和匹配HTML内容中的特定模式，以提取所需的数据。<br> 调用re模块里面findall方法<br> re.findall(‘数据: 你需要的数据’, ‘数据源: 从什么地方获取数据’) --&gt; 找到所有数据内容</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 获取响应文本数据  获取网页源代码内容</span>
html_data <span class="token operator">=</span> response<span class="token punctuation">.</span>text
<span class="token comment"># 提取标题</span>
title <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'video_title" content="(.*?)"/&gt;'</span><span class="token punctuation">,</span> html_data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 提取视频信息 &lt;经过了编码&gt;</span>
video_info <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;script id="RENDER_DATA" type="application/json"&gt;(.*?)&lt;/script&gt;'</span><span class="token punctuation">,</span> html_data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 解码</span>
info <span class="token operator">=</span> requests<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>video_info<span class="token punctuation">)</span>
<span class="token comment"># 把完整json数据格式字符串, 转成字典数据类型</span>
json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
<span class="token comment"># 根据冒号左边的内容[键], 提取冒号右边的内容[值]</span>
video_url <span class="token operator">=</span> <span class="token string">'https:'</span> <span class="token operator">+</span> json_data<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'videoDetail'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'bitRateList'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'playAddr'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="_77"></a>保存数据</h4> 
<blockquote> 
 <p>对于视频链接发送请求, 获取二进制数据内容, 保存本地文件夹</p> 
</blockquote> 
<pre><code class="prism language-python">video_content <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>video_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'video\\'</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">'.mp4'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>video_content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>video_url<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_88"></a>模拟登录</h2> 
<h4><a id="_89"></a>导入所需模块</h4> 
<pre><code class="prism language-python"><span class="token comment"># 自动化测试模块</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token comment"># demo</span>
<span class="token keyword">from</span> chaojiying <span class="token keyword">import</span> Chaojiying_Client
<span class="token keyword">from</span> password <span class="token keyword">import</span> account<span class="token punctuation">,</span> password
<span class="token comment"># 动作链</span>
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>action_chains <span class="token keyword">import</span> ActionChains
</code></pre> 
<h4><a id="_100"></a>自动登录浏览器</h4> 
<pre><code class="prism language-python"><span class="token comment"># 打开浏览器, 访问网站</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.dy.com/user/MS4wLjABAAAAB0-gppwu15DtJJZmMpgUqakr7Jw_pmr7skR3IW6MwCQ'</span><span class="token punctuation">)</span>
<span class="token comment"># 延时</span>
driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># 获取验证码图片</span>
img_label <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'.captcha_verify_container'</span><span class="token punctuation">)</span>
<span class="token comment"># 截图 保存验证码图片</span>
img_label<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span><span class="token string">'yzm.png'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_115"></a>调用</h4> 
<p><img src="https://images2.imgbox.com/78/38/CEvZtvnt_o.png" alt=""></p> 
<pre><code class="prism language-python"><span class="token comment"># 调用 --&gt; 帮助我们识别文字坐标</span>
chaojiying <span class="token operator">=</span> Chaojiying_Client<span class="token punctuation">(</span>账号<span class="token punctuation">,</span> 密码<span class="token punctuation">,</span> <span class="token string">'96001'</span><span class="token punctuation">)</span>
<span class="token comment"># 读取图片</span>
im <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'yzm.png'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> chaojiying<span class="token punctuation">.</span>PostPic<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token string">'9004'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'pic_str'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> res <span class="token keyword">in</span> result<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    y <span class="token operator">=</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>move_to_element_with_offset<span class="token punctuation">(</span>img_label<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'.captcha_verify_action div:last-of-type'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
lis <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_class_name<span class="token punctuation">(</span><span class="token string">'Eie04v01'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> li <span class="token keyword">in</span> lis<span class="token punctuation">:</span>
    video_id <span class="token operator">=</span> li<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_134"></a>最后代码运行结果展示</h2> 
<p><img src="https://images2.imgbox.com/72/8a/Dz3FjstO_o.gif" alt=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fb28be29476be02964a4e6ed986383cf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RuntimeError: CUDA error: initialization error when calling `cusparseCreate(handle)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8372b39ff909104bf16a344ddc88e20f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于javaweb&#43;mysql的springboot仓库管理系统(java&#43;springboot&#43;layui&#43;html&#43;thymeleaf&#43;mysql&#43;实训报告)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>