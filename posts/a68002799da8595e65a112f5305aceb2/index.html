<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php curl 抓网页,网页抓取,curl_php用curl抓取网页问题，网页抓取,curl,php - phpStudy - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php curl 抓网页,网页抓取,curl_php用curl抓取网页问题，网页抓取,curl,php - phpStudy" />
<meta property="og:description" content="php用curl抓取网页问题
封装了一个curl抓取网页的函数，在本地测没问题;放到测试服务器上后，如果通过浏览器访问
执行，大部分时候函数返回的HTTP状态码返回0，错误信息`Error:name lookup timed
out`，极其偶像的情况下返回200成功;但如果直接在测试服务器上直接用命令行执行，100%成功。
代码如下：
static public function curlGet($url, $data = array(), $header = array(), $timeout = 3, $port = 80)
{
$is_ssl = substr($url, 0, 5) == &#39;https&#39; ? 1 : 0;
$ch = curl_init();
if (!empty($data)) {
$data = is_array($data)?http_build_query($data): $data;
$url .= (strpos($url,&#39;?&#39;)? &#39;&amp;&#39;: &#34;?&#34;) . $data;
}
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, &#39;GET&#39;);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1); //是否抓取跳转后的页面
curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);
curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a68002799da8595e65a112f5305aceb2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-18T18:24:42+08:00" />
<meta property="article:modified_time" content="2021-03-18T18:24:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php curl 抓网页,网页抓取,curl_php用curl抓取网页问题，网页抓取,curl,php - phpStudy</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>php用curl抓取网页问题</p> 
 <p>封装了一个curl抓取网页的函数，在本地测没问题;放到测试服务器上后，如果通过浏览器访问</p> 
 <p>执行，大部分时候函数返回的HTTP状态码返回0，错误信息`Error:name lookup timed</p> 
 <p>out`，极其偶像的情况下返回200成功;但如果直接在测试服务器上直接用命令行执行，100%成功。</p> 
 <p>代码如下：</p> 
 <p>static public function curlGet($url, $data = array(), $header = array(), $timeout = 3, $port = 80)</p> 
 <p>{<!-- --></p> 
 <p>$is_ssl = substr($url, 0, 5) == 'https' ? 1 : 0;</p> 
 <p>$ch = curl_init();</p> 
 <p>if (!empty($data)) {<!-- --></p> 
 <p>$data = is_array($data)?http_build_query($data): $data;</p> 
 <p>$url .= (strpos($url,'?')? '&amp;': "?") . $data;</p> 
 <p>}</p> 
 <p>curl_setopt($ch, CURLOPT_URL, $url);</p> 
 <p>curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);</p> 
 <p>curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'GET');</p> 
 <p>curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1); //是否抓取跳转后的页面</p> 
 <p>curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);</p> 
 <p>curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);</p> 
 <p>curl_setopt($ch, CURLOPT_POST, 0);</p> 
 <p>//curl_setopt($ch, CURLOPT_PORT, $port);</p> 
 <p>curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</p> 
 <p>curl_setopt($ch, CURLOPT_REFERER, $url);</p> 
 <p>// curl_setopt($ch, CURLOPT_USERAGENT, self::url2useragent($url));</p> 
 <p>if($is_ssl){<!-- --></p> 
 <p>curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // 跳过证书检查</p> 
 <p>curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, true); // 从证书中检查SSL加密算法是否存在</p> 
 <p>}</p> 
 <p>$result = array();</p> 
 <p>$result['result'] = curl_exec($ch);</p> 
 <p>$result['http_code'] = curl_getinfo($ch,CURLINFO_HTTP_CODE);</p> 
 <p>if (0 != curl_errno($ch)) {<!-- --></p> 
 <p>$result['error'] = "Error:\n" . curl_error($ch);</p> 
 <p>}</p> 
 <p>curl_close($ch);</p> 
 <p>return $result;</p> 
 <p>}</p> 
 <p>我个人感觉和代码应该关系不大，不知是哪的问题。望各路大神不吝赐教，指点迷津，不胜</p> 
 <p>感激。</p> 
 <p>相关阅读:</p> 
 <p>json返回数据中包括html标签直接显示标签的问题</p> 
 <p>angular http问题</p> 
 <p>swig模板引擎中使用正则表达式报错</p> 
 <p>touchstart touchend 导致倒计时变慢</p> 
 <p>c的描述符register导致矩阵乘法结果错误</p> 
 <p>iOS 怎么把button的边缘变成虚线</p> 
 <p>node中使用log4js问题</p> 
 <p>请问antd里如何设置Input焦点？</p> 
 <p>请问正则如何匹配多层成对的括号？</p> 
 <p>安卓实现类似QQ刚换聊天背景的功能</p> 
 <p>怎样判断是否包含一些非法字符</p> 
 <p>jquery ui自动完成</p> 
 <p>各位php程序员，安装拓展或者框架，你们用composer用的多吗？</p> 
 <p>有了解嵌入式服务器appweb esp文件的吗</p> 
 <p>jquery通过fnAddData插入的行如何获取</p> 
 <p>关于Python的服务器客户端交互问题</p> 
 <p>微信小程序socket问题</p> 
 <p>配置jdk环境变量时，cmd无法识别path中的用百分号%引用的变量？</p> 
 <p>请问谁用过 ZSSRichTextEditor编辑器</p> 
 <p>金融系统为什么只保留两位小数，如果产生多余两位小数位的金额怎么办？</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff1bab632d770b861784e14c15b8e578/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PostgreSQL用户登录失败自动锁定的解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c5a6a3ccc103ce62de0c863a85bc6a1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">canvas绘制圆角矩形</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>