<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flink-经典案例WordCount快速上手以及安装部署 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Flink-经典案例WordCount快速上手以及安装部署" />
<meta property="og:description" content="2 Flink快速上手 2.1 批处理api 经典案例WordCount public class BatchWordCount { public static void main(String[] args) throws Exception { //1.创建一个执行环境 ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); //2.从文件中读取数据 //得到数据源,DataSource底层是DataSet这个数据集 DataSource&lt;String&gt; lineDataSource = env.readTextFile(&#34;input/words.txt&#34;); //3.将每行数据进行分词，转换成二元组类型 //FlatMapOperator返回的是一个算子，底层是DataSet这个数据集 FlatMapOperator&lt;String, Tuple2&lt;String, Long&gt;&gt; wordAndOneTuple = lineDataSource.flatMap((String line, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) -&gt; { //将一行文本进行分词 String[] words = line.split(&#34; &#34;); for (String word : words) { //collect是收集器的用法,of是构建二元组的实例，并输出 out.collect(Tuple2.of(word, 1L)); } }) //泛型擦除，指定tuple的类型 .returns(Types.TUPLE(Types.STRING, Types.LONG)); //4.按照word进行分组 //和spark不一样，没有groupby，所以要根据索引指定key UnsortedGrouping&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOneGroup = wordAndOneTuple.groupBy(0); //5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/70a74c7304f65f648ece3830966d9a40/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-16T00:47:26+08:00" />
<meta property="article:modified_time" content="2022-11-16T00:47:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flink-经典案例WordCount快速上手以及安装部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="2_Flink_0"></a>2 Flink快速上手</h2> 
<h3><a id="21_api_2"></a>2.1 批处理api</h3> 
<ol><li>经典案例WordCount</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchWordCount</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.创建一个执行环境</span>
        <span class="token class-name">ExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">ExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.从文件中读取数据</span>
        <span class="token comment">//得到数据源,DataSource底层是DataSet这个数据集</span>
        <span class="token class-name">DataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lineDataSource <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span><span class="token string">"input/words.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.将每行数据进行分词，转换成二元组类型</span>
        <span class="token comment">//FlatMapOperator返回的是一个算子，底层是DataSet这个数据集</span>
        <span class="token class-name">FlatMapOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneTuple <span class="token operator">=</span> lineDataSource<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//将一行文本进行分词</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//collect是收集器的用法,of是构建二元组的实例，并输出</span>
                        out<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>       <span class="token comment">//泛型擦除，指定tuple的类型</span>
                <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token function">TUPLE</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">LONG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.按照word进行分组</span>
        <span class="token comment">//和spark不一样，没有groupby，所以要根据索引指定key</span>
        <span class="token class-name">UnsortedGrouping</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneGroup <span class="token operator">=</span> wordAndOneTuple<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//5.所以分组内进行聚合统计</span>
        <span class="token comment">//也是需要索引指定需要对哪一个求和,然后得到一个聚合算子</span>
        <span class="token class-name">AggregateOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span> wordAndOneGroup<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.打印输出</span>
        sum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ol start="2"><li>说明</li></ol> 
<p>以上的代码还是基于DataSet的api，但是DataSet的api已经处于软弃用，默认流处理，需要批处理的时候，将提交任务时通过执行模式设为batch进行，脚本如下</p> 
<pre><code class="prism language-shell">$ bin/flink run -Dexecution.runtime-mode<span class="token operator">=</span>BATCH BatchWordCount.jar
</code></pre> 
<h3><a id="22__51"></a>2.2 流处理</h3> 
<h4><a id="221__53"></a>2.2.1 有界流</h4> 
<ol><li>代码</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundedStreamWordCount</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.创建流式执行环境</span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.读取文件</span>
        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lineDataStreamSource <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span><span class="token string">"input/words.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.转换计算</span>
        <span class="token comment">//底层是DataStream</span>
        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneTuple <span class="token operator">=</span> lineDataStreamSource<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                out<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token function">TUPLE</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">LONG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.分组</span>
        <span class="token comment">//keyby传一个lambda表达式，Tuple提取当前第一个字段，Tuple的第一个字段定义分别是f0,f1</span>
        <span class="token class-name">KeyedStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordAndOneKeyedStream <span class="token operator">=</span> wordAndOneTuple<span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//5.求和</span>
        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span> wordAndOneKeyedStream<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.打印输出</span>
        sum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//7.启动执行</span>
        <span class="token comment">//一直处于流状态，需要给他启动</span>
        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>输出结果</li></ol> 
<pre><code class="prism language-java"><span class="token number">10</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>flink<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">4</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>hello<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">2</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>java<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">4</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>hello<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">7</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>world<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">4</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>hello<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后结果和批处理一样，并伴随中间过程，而且乱序</p> 
<p>代码使用多线程模拟的分布式集群，也就是并行度(默认是电脑cpu的核数)，数字表示数字槽</p> 
<h4><a id="222__106"></a>2.2.2 无界流</h4> 
<ol><li>代码</li></ol> 
<p>主要注意1，2，3到最后都是跟上面一样</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamWordCount</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.创建流失执行环境</span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.读取文本流</span>
        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lineDataStream <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">"192.168.60.132"</span><span class="token punctuation">,</span> <span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.转换计算</span>
        <span class="token comment">//底层是DataStream</span>
        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneTuple <span class="token operator">=</span> lineDataStream<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                out<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token function">TUPLE</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">LONG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.分组</span>
        <span class="token comment">//keyby传一个lambda表达式，Tuple提取当前第一个字段，Tuple的第一个字段定义分别是f0,f1</span>
        <span class="token class-name">KeyedStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordAndOneKeyedStream <span class="token operator">=</span> wordAndOneTuple<span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//5.求和</span>
        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span> wordAndOneKeyedStream<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.打印输出</span>
        sum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//7.启动执行</span>
        <span class="token comment">//一直处于流状态，需要给他启动</span>
        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>或者直接配置好主机名和端口号的参数</li></ol> 
<ul><li>代码编写</li></ul> 
<pre><code class="prism language-java">        <span class="token comment">//从参数提取主机名和端口号</span>
        <span class="token class-name">ParameterTool</span> parameterTool <span class="token operator">=</span> <span class="token class-name">ParameterTool</span><span class="token punctuation">.</span><span class="token function">fromArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hostname <span class="token operator">=</span> parameterTool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> port <span class="token operator">=</span> parameterTool<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>idea设置</li></ul> 
<p><img src="https://images2.imgbox.com/28/6a/5ryE8PHP_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_Flink_162"></a>3 Flink部署</h2> 
<h3><a id="31__164"></a>3.1 部署模式</h3> 
<ol><li>会话模式</li></ol> 
<ul><li>内容</li></ul> 
<p>先确定集群，并且资源确定，提交的作业会竞争集群中的集群</p> 
<ul><li>缺点</li></ul> 
<p>资源不够，提交作业失败</p> 
<ul><li>使用范围</li></ul> 
<p>会话模式使用与单个规模小，执行时间短的大量作业</p> 
<ol start="2"><li>单作业模式</li></ol> 
<ul><li>内容</li></ul> 
<p>每个作业启动后启动集群，运行结束后，集群就会关闭</p> 
<ul><li>条件</li></ul> 
<p>单作业需要借助资源管理器</p> 
<ol start="3"><li>应用模式</li></ol> 
<ul><li>内容</li></ul> 
<p>根据一个应用而后启动集群，直接交给JobManager</p> 
<h3><a id="32_standalone_196"></a>3.2 独立模式(standalone)的部署</h3> 
<ol><li>会话模式</li></ol> 
<p>就刚刚的那些代码，先启动集群，在提交的作业</p> 
<ol start="2"><li>单作业模式</li></ol> 
<p>没有</p> 
<ol start="3"><li>应用模式部署</li></ol> 
<ul><li>先把jar包放到/lib下</li><li>然后根据flink自带的jar包启动，会去自动扫描lib下的jar启动</li><li>启动taskmanager</li><li>停掉集群</li></ul> 
<h3><a id="33_yarn_213"></a>3.3 yarn模式</h3> 
<h4><a id="331__215"></a>3.3.1 总体流程</h4> 
<ul><li>客户端把flink应用提交给Yarn的ResourceManager，然后RM再向NodeManager申请容器</li><li>flink会部署JobManager和TaskManager的实例</li><li>Flink会根据运行在JobManager上的作业所需要的Slot数量动态分配TaskManager资源</li></ul> 
<h4><a id="332__221"></a>3.3.2 安装部署</h4> 
<ol><li>解压</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop2 software<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> flink-1.13.0-bin-scala_2.12.tgz <span class="token parameter variable">-C</span> /opt/module/
</code></pre> 
<ol start="2"><li>分发</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop2 module<span class="token punctuation">]</span>$ xsync flink/
</code></pre> 
<ol start="3"><li>启动</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop2 bin<span class="token punctuation">]</span>$ ./start-cluster.sh 
</code></pre> 
<ol start="4"><li>网页看下</li></ol> 
<p>http://hadoop2:8081/</p> 
<p><img src="https://images2.imgbox.com/19/e0/6JBbJ53E_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>配置环境变量</li></ol> 
<ul><li>hadoop</li></ul> 
<pre><code class="prism language-shell"><span class="token comment">#HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/module/hadoop
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/sbin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token variable">${HADOOP_HOME}</span>/etc/hadoop
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CLASSPATH</span><span class="token operator">=</span>`hadoop classpath
</code></pre> 
<ul><li>激活</li></ul> 
<pre><code class="prism language-shell"><span class="token builtin class-name">source</span> /etc/profile.d/my_env.sh
</code></pre> 
<ul><li>分发</li></ul> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> /home/hadoop1/bin/xsync /etc/profile.d/my_env.sh 
</code></pre> 
<ul><li>群起hadoop</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop2 bin<span class="token punctuation">]</span>$ hdp.sh start
 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 启动 hadoop集群 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 --------------- 启动 hdfs ---------------
Starting namenodes on <span class="token punctuation">[</span>hadoop2<span class="token punctuation">]</span>
Starting datanodes
Starting secondary namenodes <span class="token punctuation">[</span>hadoop4<span class="token punctuation">]</span>
 --------------- 启动 <span class="token function">yarn</span> ---------------
Starting resourcemanager
Starting nodemanagers
hadoop4: nodemanager is running as process <span class="token number">2335</span>.  Stop it first.
 --------------- 启动 historyserver ---------------

</code></pre> 
<ul><li>检查情况</li></ul> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>hadoop1<span class="token annotation punctuation">@hadoop2</span> bin<span class="token punctuation">]</span>$ xcall jps
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> hadoop2 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">3092</span> <span class="token class-name">JobHistoryServer</span>
<span class="token number">2901</span> <span class="token class-name">NodeManager</span>
<span class="token number">3174</span> <span class="token class-name">Jps</span>
<span class="token number">2366</span> <span class="token class-name">NameNode</span>
<span class="token number">2527</span> <span class="token class-name">DataNode</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> hadoop3 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">2032</span> <span class="token class-name">DataNode</span>
<span class="token number">2258</span> <span class="token class-name">ResourceManager</span>
<span class="token number">2888</span> <span class="token class-name">Jps</span>
<span class="token number">2478</span> <span class="token class-name">NodeManager</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> hadoop4 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">2149</span> <span class="token class-name">Jps</span>
<span class="token number">2070</span> <span class="token class-name">SecondaryNameNode</span>
<span class="token number">1945</span> <span class="token class-name">DataNode</span>
<span class="token number">2854</span> <span class="token class-name">NodeManager</span>
</code></pre> 
<h4><a id="333__313"></a>3.3.3 会话模式部署</h4> 
<ol><li>去bin下启动会话</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop2 flink<span class="token punctuation">]</span>$ <span class="token function">ls</span> bin/
bash-java-utils.jar  jobmanager.sh              pyflink-shell.sh           stop-zookeeper-quorum.sh
config.sh            kubernetes-entry.sh        sql-client.sh              taskmanager.sh
find-flink-home.sh   kubernetes-session.sh      standalone-job.sh          yarn-session.sh
flink                mesos-appmaster-job.sh     start-cluster.sh           zookeeper.sh
flink-console.sh     mesos-appmaster.sh         start-scala-shell.sh
flink-daemon.sh      mesos-taskmanager.sh       start-zookeeper-quorum.sh
historyserver.sh     pyflink-gateway-server.sh  stop-cluster.sh
<span class="token punctuation">[</span>hadoop1@hadoop2 flink<span class="token punctuation">]</span>$ ./bin/yarn-session.sh <span class="token parameter variable">-nm</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-d</span>
</code></pre> 
<ol start="2"><li>网页</li></ol> 
<p><img src="https://images2.imgbox.com/7c/b1/DkaoizaS_o.png" alt="在这里插入图片描述"></p> 
<p>http://hadoop2:46082/ UI对应随着启动而变</p> 
<p><img src="https://images2.imgbox.com/ea/ab/bzZwhIfe_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>提交参数</li></ol> 
<p><img src="https://images2.imgbox.com/36/c2/07JpKXPs_o.png" alt="在这里插入图片描述"></p> 
<p>-n参数和-s参数表示TaskManager和slot数量，原来可以指定，到了flink1.11.0版本后，进行动态分配，避免资源设置过大造成的浪费</p> 
<ol start="4"><li>提交作业</li></ol> 
<ul><li>将jar包打包到flink</li><li>执行脚本</li></ul> 
<pre><code class="prism language-shell"> ./bin/flink run <span class="token parameter variable">-c</span> com.atguigu.wc.StreamWordCount ./FlinkTutorial-1.0-SNAPSHOT.jar
</code></pre> 
<p>会出现启动running的网页</p> 
<p><img src="https://images2.imgbox.com/d8/0b/8zTcCzeM_o.png" alt="在这里插入图片描述"></p> 
<ul><li>在hadoop2的7777端口输入一些数据</li></ul> 
<p><img src="https://images2.imgbox.com/56/8a/MLJQaGEb_o.png" alt="在这里插入图片描述"></p> 
<p>会出现结果</p> 
<p><img src="https://images2.imgbox.com/a9/d6/dGDIpblY_o.png" alt="在这里插入图片描述"></p> 
<ul><li>继续提交作业并且并行度设为2</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>hadoop1@hadoop3 flink<span class="token punctuation">]</span>$  ./bin/flink run <span class="token parameter variable">-c</span> com.atguigu.wc.StreamWordCount <span class="token parameter variable">-p</span> <span class="token number">2</span> ./FlinkTutorial-1.0-SNAPSHOT.jar
</code></pre> 
<p><img src="https://images2.imgbox.com/be/4c/T13XsEiq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/94/1b/QjzvXCa3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="334__385"></a>3.3.4 单作业模式部署</h4> 
<ol><li>提交</li></ol> 
<p>yarn-per-job表示作业模式</p> 
<pre><code class="prism language-shell">in/flink run <span class="token parameter variable">-d</span> <span class="token parameter variable">-t</span> yarn-per-job <span class="token parameter variable">-c</span> com.atguigu.wc.StreamWordCount 
FlinkTutorial-1.0-SNAPSHOT.jar
</code></pre> 
<h4><a id="335__396"></a>3.3.5 应用模式</h4> 
<ol><li>提交</li></ol> 
<p>run-application表示应用模式</p> 
<pre><code class="prism language-shell">$ bin/flink run-application <span class="token parameter variable">-t</span> yarn-application <span class="token parameter variable">-c</span> com.atguigu.wc.StreamWordCount 
FlinkTutorial-1.0-SNAPSHOT.jar

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6894ec05e8176ed5ef5d1a5c21cec008/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构：查找——按姓名查找学生信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/debb186344f4611f00e8f685346eef95/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nuxt3项目bug整理（一）： Nuxt3项目执行 nuxt build 的构建命令后控制台date-fns报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>