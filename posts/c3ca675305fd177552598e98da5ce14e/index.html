<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>讯为4412开发板Linux学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="讯为4412开发板Linux学习笔记" />
<meta property="og:description" content="嵌入式Linux学习笔记 嵌入式Linux的基本框架 为BootLoader、Linux内核、文件系统。 Linux 内核和文件系统之间，什么关系？
答案：文件系统是操作系统用于明确存储设备（常见的是磁盘，也有基于NAND Flash的固态硬盘）或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件机构称为文件管理系统，简称文件系统。
注意：
1.Linux必须要挂接一个文件系统
2.Linux启动到最后，等所以驱动初始化完成以后，最后一步才挂载文件系统
Linux系统编程 su/su root 进入超级用户
ls -il显示文件节点和详细信息 ls -a 显示隐藏文件 ls -i 显示文件节点
pwd 显示当前路径 ls -R 显示其子目录 ls -d 显示其目录名称
mkdir -p 建立文件夹及其上一级文件夹 mkdir -v 建立文件夹显示详细信息
touch 创建文件 cd … 回到上一级 cd /进入根目录 cd ~ 进入操作者主目录
mv 移动文件 cp -r 复制文件夹及其文件 cp -i 覆盖文件前询问用户
rm -rf 强制删除文件夹 rm 删除文件
ln 文件1 文件2 硬链接 ln -s 文件1 文件2 软链接
硬连接的优点是不同目录通过不同路径访问同一文件，节约磁盘空间，又便于数据一致性。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c3ca675305fd177552598e98da5ce14e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-14T22:47:15+08:00" />
<meta property="article:modified_time" content="2022-09-14T22:47:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">讯为4412开发板Linux学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Linux_0"></a>嵌入式Linux学习笔记</h2> 
<h3><a id="Linux_2"></a>嵌入式Linux的基本框架</h3> 
<h3><a id="BootLoaderLinux_4"></a>为BootLoader、Linux内核、文件系统。</h3> 
<p><img src="https://images2.imgbox.com/fe/c6/y8tSw2Fb_o.png" alt="image-20220720155447983"></p> 
<p><img src="https://images2.imgbox.com/17/6c/sl3jK74G_o.png" alt="image-20220720155553572"></p> 
<p><img src="https://images2.imgbox.com/49/3d/R3LN27Gf_o.png" alt="image-20220720155711763"></p> 
<p>Linux 内核和文件系统之间，什么关系？</p> 
<p>答案：文件系统是操作系统用于明确存储设备（常见的是磁盘，也有基于NAND Flash的固态硬盘）或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件机构称为文件管理系统，简称文件系统。</p> 
<p>注意：</p> 
<p>1.Linux必须要挂接一个文件系统</p> 
<p>2.Linux启动到最后，等所以驱动初始化完成以后，最后一步才挂载文件系统</p> 
<h3><a id="Linux_22"></a>Linux系统编程</h3> 
<p><img src="https://images2.imgbox.com/b4/42/BD4zbaFm_o.png" alt="image-20220722170747427"></p> 
<p><img src="https://images2.imgbox.com/d8/be/MXPTbfyv_o.png" alt="image-20220722171049938"></p> 
<p><img src="https://images2.imgbox.com/f9/97/Wb1knCdH_o.png" alt="image-20220722171310063"></p> 
<p><img src="https://images2.imgbox.com/90/51/h8dqwQYP_o.png" alt="image-20220722171548021"></p> 
<p><img src="https://images2.imgbox.com/ee/b3/Lo8qEdlS_o.png" alt="image-20220722193837003"></p> 
<p>su/su root 进入超级用户</p> 
<p><img src="https://images2.imgbox.com/a2/12/QNR8Uify_o.png" alt="image-20220722200425521"></p> 
<p><img src="https://images2.imgbox.com/72/b1/uHSSH2hP_o.png" alt="image-20220722201942632"></p> 
<p><img src="https://images2.imgbox.com/9f/4b/c3VutsoP_o.png" alt="image-20220722212138473"></p> 
<p>ls -il显示文件节点和详细信息 ls -a 显示隐藏文件 ls -i 显示文件节点</p> 
<p>pwd 显示当前路径 ls -R 显示其子目录 ls -d 显示其目录名称</p> 
<p>mkdir -p 建立文件夹及其上一级文件夹 mkdir -v 建立文件夹显示详细信息</p> 
<p>touch 创建文件 cd … 回到上一级 cd /进入根目录 cd ~ 进入操作者主目录</p> 
<p>mv 移动文件 cp -r 复制文件夹及其文件 cp -i 覆盖文件前询问用户</p> 
<p>rm -rf 强制删除文件夹 rm 删除文件</p> 
<p>ln 文件1 文件2 硬链接 ln -s 文件1 文件2 软链接</p> 
<p>硬连接的优点是不同目录通过不同路径访问同一文件，节约磁盘空间，又便于数据一致性。</p> 
<p>缺点是不能连接目录，不能跨越不同文件系统。</p> 
<p>adduser 用户名 只需配置密码就行 useradd 用户名 配置密码和文件等等</p> 
<p><img src="https://images2.imgbox.com/0a/12/rEBHIgTN_o.png" alt="image-20220722213943013"></p> 
<p><img src="https://images2.imgbox.com/1d/3f/JLqxuSDA_o.png" alt="image-20220722214005484"></p> 
<p><img src="https://images2.imgbox.com/04/f4/21oxzAtP_o.png" alt="image-20220722214035332"></p> 
<p><img src="https://images2.imgbox.com/fa/2f/nBbckLkj_o.png" alt="image-20220722214057043"></p> 
<p><img src="https://images2.imgbox.com/ca/38/SsG8jKQD_o.png" alt="image-20220722214136515"></p> 
<p><img src="https://images2.imgbox.com/44/da/mqeoctwq_o.png" alt="image-20220722214152484"></p> 
<p><img src="https://images2.imgbox.com/df/07/x9Tf3w7L_o.png" alt="image-20220722214207819"></p> 
<p><img src="https://images2.imgbox.com/ad/9e/JlLsSiJW_o.png" alt="image-20220722214301698"></p> 
<p><img src="https://images2.imgbox.com/cf/1a/XcOgTZs9_o.png" alt="image-20220722214315492"></p> 
<p><img src="https://images2.imgbox.com/6f/e5/e2AtiZJ3_o.png" alt="image-20220722214332346"></p> 
<p><img src="https://images2.imgbox.com/02/74/2RId8XK5_o.png" alt="image-20220722214354638"></p> 
<h4><a id="IOopen_84"></a>文件IO函数之open函数</h4> 
<p><img src="https://images2.imgbox.com/ef/61/1KjnCDfl_o.png" alt="image-20220723143919448"></p> 
<p><img src="https://images2.imgbox.com/a2/44/LkeEX1NT_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/91/f0/0RhZeFXl_o.png" alt="image-20220727153314471"></p> 
<p><img src="https://images2.imgbox.com/0b/98/SS0DqD5d_o.png" alt="image-20220727153239295"></p> 
<p><img src="https://images2.imgbox.com/41/bc/LQsEA5PG_o.png" alt="image-20220727164443176"></p> 
<p><img src="https://images2.imgbox.com/87/a7/m0mxyUEg_o.png" alt="image-20220727164428414"></p> 
<p><img src="https://images2.imgbox.com/04/d4/prmgAnB9_o.png" alt="image-20220727165534087"></p> 
<h4><a id="_100"></a><strong>实战</strong>字符设备控制**</h4> 
<p><img src="https://images2.imgbox.com/a5/9d/D9firq2T_o.png" alt="image-20220729215010934"></p> 
<h5><a id="_104"></a>点灯大师测试例程</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_NUM</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_C</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token comment">//cmd为0,则灭；为1，则亮</span>
<span class="token comment">//io为0则是靠近蜂鸣器，为1，则靠近独立按键的小灯</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> fd<span class="token punctuation">,</span>led_num<span class="token punctuation">,</span>led_c<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>leds <span class="token operator">=</span><span class="token string">"/dev/leds"</span><span class="token punctuation">;</span>
	led_c<span class="token operator">=</span>LED_C<span class="token punctuation">;</span>
	led_num <span class="token operator">=</span>LED_NUM<span class="token punctuation">;</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"argv1 is cmd;argv2 is io\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span>led_c<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"argv[1] is 0 or 1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span>led_c<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"argv[2] is 0 or 1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>leds<span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_NOCTTY<span class="token operator">|</span>O_NDELAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s failed\n"</span><span class="token punctuation">,</span>leds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ioctl %s success\n"</span><span class="token punctuation">,</span>leds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/ad/Ee4hSPva_o.png" alt="image-20220802093704702"></p> 
<h5><a id="_153"></a>蜂鸣器测试例程</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;termios.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUZZER_C</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 <span class="token keyword">char</span> <span class="token operator">*</span>buzzer_ctl <span class="token operator">=</span><span class="token string">"/dev/buzzer_ctl"</span><span class="token punctuation">;</span>
 <span class="token keyword">int</span> fd<span class="token punctuation">,</span>ret<span class="token punctuation">,</span>buzzer_c<span class="token punctuation">;</span>

   buzzer_c <span class="token operator">=</span>BUZZER_C<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span>buzzer_c <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"argv[1] is 0 or 1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span> <span class="token punctuation">(</span>buzzer_ctl<span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_NOCTTY<span class="token operator">|</span>O_NDELAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s failed\n"</span><span class="token punctuation">,</span>buzzer_ctl<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
   ret <span class="token operator">=</span><span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/5e/Li8wnFOb_o.png" alt="image-20220802094651975"></p> 
<p><img src="https://images2.imgbox.com/02/a8/Atz74vVo_o.png" alt="image-20220802094722024"></p> 
<p><img src="https://images2.imgbox.com/e3/bf/iiWixpnx_o.png" alt="image-20220802094747701"></p> 
<h5><a id="_197"></a>串口通信（重要掌握）</h5> 
<h6><a id="_199"></a>几个关于串口的基本概念</h6> 
<p><img src="https://images2.imgbox.com/d0/65/di90IIiv_o.png" alt="image-20220802110823547"></p> 
<p><img src="https://images2.imgbox.com/8a/2e/ovO501IT_o.png" alt="image-20220802110942201"></p> 
<p><img src="https://images2.imgbox.com/52/05/OtClIQCD_o.png" alt="image-20220802111009578"></p> 
<p><img src="https://images2.imgbox.com/bc/c8/NYRA7yyz_o.png" alt="image-20220802110423559"></p> 
<p><img src="https://images2.imgbox.com/7a/88/XkU9XgMR_o.png" alt="image-20220802111121381"></p> 
<h6><a id="_211"></a>串口编程之开机自启动测试程序</h6> 
<p>• 开机启动运行程序</p> 
<p>• 通过设置将helloworld程序开机运行</p> 
<p>• 实验操作</p> 
<p>1、cp -r 测试程序文件路径 /bin</p> 
<p>2、 vi /etc/init.d/rcS</p> 
<p><img src="https://images2.imgbox.com/65/be/yuYwdQvD_o.png" alt="image-20220802150800630"></p> 
<p>shift+g 调到最后一行添加 /bin/hello &amp;</p> 
<p><img src="https://images2.imgbox.com/35/84/iyxHM7FQ_o.png" alt="image-20220802150852303"></p> 
<p><img src="https://images2.imgbox.com/a1/fa/PDqDIdVZ_o.png" alt="image-20220802150947279"></p> 
<p>ESC 然后shift+；输入wq保存该文件</p> 
<p>在超级终端菜单栏的控制选择日志设置</p> 
<p>选择Log type 为Standard ，点击…保存日志在电脑自己指定位置</p> 
<p>点击日志文件Ctrl+f 查找测试程序打印结果</p> 
<p><img src="https://images2.imgbox.com/0c/0d/vaMrFneg_o.png" alt="image-20220802151406387"></p> 
<p>3、输入reboot重启开发板</p> 
<p><img src="https://images2.imgbox.com/56/1e/1FCT3jMv_o.png" alt="image-20220802151044870"></p> 
<p><img src="https://images2.imgbox.com/89/53/QW1DgUBk_o.png" alt="image-20220802150719518"></p> 
<h6><a id="_247"></a>串口编程之打开串口</h6> 
<p><img src="https://images2.imgbox.com/67/87/Z3WgIlbc_o.png" alt="image-20220802154635361"></p> 
<h6><a id="_251"></a>测试例程</h6> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
   <span class="token keyword">char</span> <span class="token operator">*</span>uart3<span class="token operator">=</span><span class="token string">"/bin/ttySAC3"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>uart3<span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_CREAT<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s failed\n"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>	   
   <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{<!-- --></span>
	  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s is success!\n"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_277"></a>串口初始化</h6> 
<p><img src="https://images2.imgbox.com/fd/b6/8lU17sP9_o.png" alt="image-20220802162952211"></p> 
<p><img src="https://images2.imgbox.com/99/cd/zf7ZcXIV_o.png" alt="image-20220802163004990"></p> 
<p><img src="https://images2.imgbox.com/05/4e/iwPHF1Kl_o.png" alt="image-20220802163026445"></p> 
<h6><a id="_285"></a>测试代码</h6> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> fd<span class="token punctuation">,</span>wr_static<span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>uart3<span class="token operator">=</span><span class="token string">"/dev/ttySAC3"</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token operator">=</span><span class="token string">"hello world!\n"</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\nitop4412 uart3 writetest start\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>uart3<span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_NOCTTY<span class="token operator">|</span>O_NDELAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s is failed"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>	
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s is success\n"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">set_opt</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token number">115200</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token char">'N'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
     wr_static <span class="token operator">=</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>wr_static<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"write failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">else</span>
	 <span class="token punctuation">{<!-- --></span>
		 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wr_static is %d\n"</span><span class="token punctuation">,</span>wr_static<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
      <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
              <span class="token comment">//标识符 波特率     数据位   奇偶效验位   停止位</span>
<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span><span class="token keyword">int</span> nSpeed<span class="token punctuation">,</span><span class="token keyword">int</span> nBits<span class="token punctuation">,</span><span class="token keyword">char</span> nEvent<span class="token punctuation">,</span><span class="token keyword">int</span> nStop<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">struct</span> <span class="token class-name">termios</span> newtio<span class="token punctuation">,</span>oldtio<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">tcgetattr</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>oldtio<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
    <span class="token function">perror</span> <span class="token punctuation">(</span><span class="token string">"SetupSerial 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
   <span class="token punctuation">}</span>
   <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>newtio<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CLOCAL <span class="token operator">|</span>CREAD<span class="token punctuation">;</span>   <span class="token comment">//控制模式</span>
   newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>CSIZE<span class="token punctuation">;</span>
   
   <span class="token keyword">switch</span><span class="token punctuation">(</span>nBits<span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CS7<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CS8<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>       		   
   <span class="token punctuation">}</span>
   
   <span class="token keyword">switch</span><span class="token punctuation">(</span>nEvent<span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token char">'O'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARENB<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARODD<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span><span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token char">'E'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARENB<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>PARODD<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span><span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
	 <span class="token keyword">case</span> <span class="token char">'N'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>PARENB<span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

    <span class="token keyword">switch</span><span class="token punctuation">(</span>nSpeed<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">2400</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">9600</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">115200</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">460800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>nSTOP <span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{<!-- --></span>
		 newtio<span class="token punctuation">.</span>c_cflag  <span class="token operator">&amp;=</span><span class="token operator">~</span>CSTOPB<span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	 <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>nSTOP <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{<!-- --></span>
		 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span><span class="token operator">~</span>CSTOPB<span class="token punctuation">;</span>
		 newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VTIME<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		 newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VMIN<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		 <span class="token function">tcflush</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCIFLUSH<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空数据函数</span>
		 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">tcsetattr</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCSANOW<span class="token punctuation">,</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//不等数据传输完毕立即改变属性</span>
		 <span class="token punctuation">{<!-- --></span>
			 <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"com set error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
		 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>	 
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_406"></a>串口编程之使用串口发送数据</h6> 
<p><img src="https://images2.imgbox.com/de/8d/gR4K84tW_o.png" alt="image-20220807195401762"></p> 
<h6><a id="_410"></a>测试代码</h6> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;termios.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> fd<span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>wr_static<span class="token punctuation">;</span>
	<span class="token keyword">char</span>  <span class="token operator">*</span>uart3<span class="token operator">=</span><span class="token string">"/dev/ttySAC3"</span><span class="token punctuation">;</span> <span class="token comment">//选择的串口</span>
	<span class="token keyword">char</span>  <span class="token operator">*</span>buffer<span class="token operator">=</span><span class="token string">"hello world!\n"</span><span class="token punctuation">;</span><span class="token comment">//发送的数据</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\nitop4412 uart3 writetest start\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>uart3<span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_CREAT<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s failed!\n"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s is success!\n"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">set_opt</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token number">115200</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token char">'N'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
		 <span class="token punctuation">{<!-- --></span>
			wr_static <span class="token operator">=</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>wr_static<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
                 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"write failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wr_static is %d\n"</span><span class="token punctuation">,</span>wr_static<span class="token punctuation">)</span><span class="token punctuation">;</span>				
			<span class="token punctuation">}</span>
			<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span><span class="token keyword">int</span> nSpeed<span class="token punctuation">,</span><span class="token keyword">int</span> nBits<span class="token punctuation">,</span><span class="token keyword">char</span> nEvent<span class="token punctuation">,</span><span class="token keyword">int</span> nStop<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">struct</span> <span class="token class-name">termios</span> newtio<span class="token punctuation">,</span>oldtio<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">tcgetattr</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>oldtio<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
    <span class="token function">perror</span> <span class="token punctuation">(</span><span class="token string">"SetupSerial 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
   <span class="token punctuation">}</span>
   <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>newtio<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CLOCAL <span class="token operator">|</span>CREAD<span class="token punctuation">;</span>   <span class="token comment">//控制模式</span>
   newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>CSIZE<span class="token punctuation">;</span>
   
   <span class="token keyword">switch</span><span class="token punctuation">(</span>nBits<span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CS7<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>CS8<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>       		   
   <span class="token punctuation">}</span>
   
   <span class="token keyword">switch</span><span class="token punctuation">(</span>nEvent<span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token char">'O'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARENB<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARODD<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span><span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token char">'E'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>PARENB<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>PARODD<span class="token punctuation">;</span>
	 newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span><span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
	 <span class="token keyword">case</span> <span class="token char">'N'</span><span class="token operator">:</span>
	 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span><span class="token operator">~</span>PARENB<span class="token punctuation">;</span>
	 <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

    <span class="token keyword">switch</span><span class="token punctuation">(</span>nSpeed<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">2400</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">9600</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">115200</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">460800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span>B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>nStop <span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{<!-- --></span>
		 newtio<span class="token punctuation">.</span>c_cflag  <span class="token operator">&amp;=</span><span class="token operator">~</span>CSTOPB<span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	 <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>nStop <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{<!-- --></span>
		 newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span><span class="token operator">~</span>CSTOPB<span class="token punctuation">;</span>
		 newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VTIME<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		 newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VMIN<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		 <span class="token function">tcflush</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCIFLUSH<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空数据函数</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">tcsetattr</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCSANOW<span class="token punctuation">,</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//不等数据传输完毕立即改变属性</span>
		 <span class="token punctuation">{<!-- --></span>
			 <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"com set error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
		 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>	 
</code></pre> 
<p>实验效果</p> 
<p><img src="https://images2.imgbox.com/08/e1/A3x3Q2vF_o.png" alt="image-20220809171026990"></p> 
<h6><a id="_539"></a>串口编程之使用串口接收数据</h6> 
<p><img src="https://images2.imgbox.com/bb/23/80laeJv7_o.png" alt="image-20220809171344988"></p> 
<h6><a id="_543"></a>测试代码</h6> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;termios.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//"/dev/ttySAC3"是con2，靠近耳机接口的串口</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> fd<span class="token punctuation">,</span>nByte<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>uart3 <span class="token operator">=</span> <span class="token string">"/dev/ttySAC3"</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>uart_out <span class="token operator">=</span> <span class="token string">"please input\r\n"</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>uart3<span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_NOCTTY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open %s is failed"</span><span class="token punctuation">,</span>uart3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">set_opt</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token char">'N'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>uart_out<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>uart_out<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nByte <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				buffer<span class="token punctuation">[</span>nByte<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>			
				<span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				nByte <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">set_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span><span class="token keyword">int</span> nSpeed<span class="token punctuation">,</span> <span class="token keyword">int</span> nBits<span class="token punctuation">,</span> <span class="token keyword">char</span> nEvent<span class="token punctuation">,</span> <span class="token keyword">int</span> nStop<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">termios</span> newtio<span class="token punctuation">,</span>oldtio<span class="token punctuation">;</span>
	<span class="token keyword">if</span>  <span class="token punctuation">(</span> <span class="token function">tcgetattr</span><span class="token punctuation">(</span> fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>oldtio<span class="token punctuation">)</span>  <span class="token operator">!=</span>  <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"SetupSerial 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">bzero</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span> newtio <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cflag  <span class="token operator">|=</span>  CLOCAL <span class="token operator">|</span> CREAD<span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span> <span class="token operator">~</span>CSIZE<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span> nBits <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
		newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span> CS7<span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
		newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span> CS8<span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">switch</span><span class="token punctuation">(</span> nEvent <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> <span class="token char">'O'</span><span class="token operator">:</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span> PARENB<span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span> PARODD<span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span> <span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token char">'E'</span><span class="token operator">:</span> 
	newtio<span class="token punctuation">.</span>c_iflag <span class="token operator">|=</span> <span class="token punctuation">(</span>INPCK <span class="token operator">|</span> ISTRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span> PARENB<span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span> <span class="token operator">~</span>PARODD<span class="token punctuation">;</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token char">'N'</span><span class="token operator">:</span>  
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span> <span class="token operator">~</span>PARENB<span class="token punctuation">;</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">switch</span><span class="token punctuation">(</span> nSpeed <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">2400</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B2400<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">4800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B4800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">9600</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">115200</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B115200<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">460800</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B460800<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token function">cfsetispeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cfsetospeed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">,</span> B9600<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span> nStop <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">&amp;=</span>  <span class="token operator">~</span>CSTOPB<span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> nStop <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">)</span>
	newtio<span class="token punctuation">.</span>c_cflag <span class="token operator">|=</span>  CSTOPB<span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VTIME<span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	newtio<span class="token punctuation">.</span>c_cc<span class="token punctuation">[</span>VMIN<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">tcflush</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCIFLUSH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">tcsetattr</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>TCSANOW<span class="token punctuation">,</span><span class="token operator">&amp;</span>newtio<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"com set error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//	printf("set done!\n\r");</span>
<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/0d/BYy4DLXu_o.png" alt="image-20220809200601168"></p> 
<h5><a id="TFTP_670"></a>TFTP服务器搭建</h5> 
<p><img src="https://images2.imgbox.com/45/23/2iMtEl6n_o.png" alt="image-20220729160019158"></p> 
<h6><a id="_674"></a><strong>搭建服务器</strong></h6> 
<p>首先输入命令“sudo apt-get install xinetd”，安装 xinetd。</p> 
<p>接下来输入命令“sudo apt-get install tftp tftpd”安装 tftp 和 tftpd，</p> 
<p>然后建立 TFTP 的配置文件，使用命令“vi /etc/xinetd.d/tftp”建立文件，</p> 
<p>写入下面的内容：</p> 
<pre><code class="prism language-c">service tftp
<span class="token punctuation">{<!-- --></span>
      socket_type 			<span class="token operator">=</span> dgram
      protocol  		    <span class="token operator">=</span> udp
      wait 				    <span class="token operator">=</span> yes
      user                   <span class="token operator">=</span> root
      server                 <span class="token operator">=</span> <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>in<span class="token punctuation">.</span>tftpd
      server_args  		     <span class="token operator">=</span> <span class="token operator">-</span>s <span class="token operator">/</span>var<span class="token operator">/</span>tftpboot<span class="token operator">/</span>
      disable 			    <span class="token operator">=</span> no
      per_source		     <span class="token operator">=</span> <span class="token number">11</span>
      cps                        <span class="token operator">=</span> <span class="token number">100</span> <span class="token number">2</span>
      flags                      <span class="token operator">=</span> IPv4
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/74/29/Ed8BOnxM_o.png" alt="image-20220729161040573"></p> 
<p>sudo /etc/init.d/xinetd restart 命令重启 xinetd 服务</p> 
<p>服务器到这一步就搭建好了，后面来进行测试。</p> 
<h6><a id="_706"></a><strong>服务器测试</strong></h6> 
<p><img src="https://images2.imgbox.com/46/5f/cR4azBSY_o.png" alt="image-20220729161711458"></p> 
<p><img src="https://images2.imgbox.com/8f/c2/LfoF5unJ_o.png" alt="image-20220729161722509"></p> 
<p><img src="https://images2.imgbox.com/89/b3/GiefwZj2_o.png" alt="image-20220729161802811"></p> 
<p><img src="https://images2.imgbox.com/40/5b/9teRoA8y_o.png" alt="image-20220729161822926"></p> 
<p>后面一个终端是客户端，前面那个是服务器端。</p> 
<h6><a id="_TFTP__720"></a>开发板实现 TFTP 文件传输</h6> 
<p><img src="https://images2.imgbox.com/f8/2c/uVm69OQe_o.png" alt="image-20220809220905200"></p> 
<p><img src="https://images2.imgbox.com/4e/16/Al7KbbMw_o.png" alt="image-20220809220932569"></p> 
<p><img src="https://images2.imgbox.com/25/8d/FTmBPhzL_o.png" alt="image-20220809221649619"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef9a46fc978fde53accce3418b6d6237/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pytorch实操笔记之基本数据操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f79b3e9a293c52cae69ba85883d58dc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win10安装TensorRT</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>