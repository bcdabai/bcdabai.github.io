<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【算法】模拟退火 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【算法】模拟退火" />
<meta property="og:description" content="文章目录 1.模拟退火介绍1.1模拟退火的可行性1.2退火模型 2.详解退火2.1退火过程2.2各变量说明2.2.1关于接收概率 3.退火模拟求根号n的值4.洛谷POJ-2420 1.模拟退火介绍 ​ 模拟退火是模拟物理上退火方法，通过N次迭代（退火），逼近函数的上的一个最值（最大或者最小值）。比如在下面函数去逼近最大值C点
1.1模拟退火的可行性 ​ 模拟退火算法得益于材料统计力学的研究成果。
​ 鉴于固体的退火原理，当固体的温度很高的时候，内能比较大，固体的内部粒子处于快速无序运动，当温度慢慢降低的过程中，固体的内能减小，粒子的慢慢趋于有序，最终，当固体处于常温时，内能达到最小，此时，粒子最为稳定。
​ 如果用粒子的能量定义材料的状态，退火算法用一个简单的数学模型描述了退火的过程。假设材料在状态i下的能量为E(i),那么材料在温度T时从状态i进入状态j就应该遵从以下规律：
（1）如果E(j)&lt;=E(i)，那么级接收该状态。
（2）如果E(j)&gt;E(i),那么就以一定的概率进入该状态：exp{(E(i)-E(j))/KT}
K为物理学中的玻尔兹曼常数，T为材料的温度
1.2退火模型 退火算法是一种循环算法需要先设定一个初始的问题T【需要一个高温，模拟粒子从高温向低温退火】每次循环进行一次退火然后降低的温度，我们通过让和一个“降温系数”（一个接近1的小数，比如0.999)相乘，达到慢慢降低温度的效果，直到接近于0（我们用来代表一个接近0的数(比如0.00001)。 代码架构
double T=2000;	//表示初始的温度为0.99 double dt=0.999;	//表示降温系数 double eps=1e-14;	//相对于1的负14次方，就是最后退出循环的温度 while(T&lt;eps) { //------------------ //进行一次退火操作 //------------------ T*=dt;	//降低温度 } 2.详解退火 ​ 我们要求的目标无法是两个：自变量x和对应的目标函数最值f(x)
2.1退火过程 先随机找一点x0,这也是初始粒子。【注意要随机】 找到对应的目标函数值 进行退火操作 ​ 刚才我们说了x0相当于是一个粒子，所以我们会进行一个无序运动，也就是向左或者向右随机移动：移动的幅度和当前的温度T有关。
​ 温度T越大，移动的幅度越大。温度T越小，移动的幅度就越小。这是在模拟粒子无序运动的状态。
接收更好的状态 ​ 假设我们移动到了x1处，那么这个点对应的f(x1)很明显答案是优于（大于）当前的f(x0)。
因此我们将答案进行更新。也就是将初始值进行替换：x0=x1,f(x0)=f(x1)。这是一种贪心的思想。
以一定概率接受(Accept)更差的状态
为什么需要按照一定的概率接受更差的状态。因为可能在一个较差的状态旁边会出现一个更加高的山峰
如果我们鼠目寸光，只盯着右半区，很容易随着温度的下降、左右跳转幅度的减小而迷失自己，最后困死在小山丘中。
而我们如果找到了左边山峰的低点，以一定的概率接受了它（概率大小和温度以及当前的值的关键程度有关），会在跳转幅度减少之前，尽可能找到最优点。
那么我们以多少的概率去接受它呢？我们用一个公式表示：exp{ Δf / KT }
注意
- 如果随机后的函数值如果结果更好，我们一定选择它(即x0=x1,f(x0)=f(x1)); - 随机后的函数值如果结果更差，我们以exp{ Δf / KT }的概率接受它 - e是自然对数，约等于2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0e6f5a828f2a690a72c37d98b382a4da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-09T09:38:27+08:00" />
<meta property="article:modified_time" content="2022-09-09T09:38:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【算法】模拟退火</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#1_1" rel="nofollow">1.模拟退火介绍</a></li><li><ul><li><a href="#11_7" rel="nofollow">1.1模拟退火的可行性</a></li><li><a href="#12_21" rel="nofollow">1.2退火模型</a></li></ul> 
    </li><li><a href="#2_44" rel="nofollow">2.详解退火</a></li><li><ul><li><a href="#21_48" rel="nofollow">2.1退火过程</a></li><li><a href="#22_108" rel="nofollow">2.2各变量说明</a></li><li><ul><li><a href="#221_126" rel="nofollow">2.2.1关于接收概率</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3n_198" rel="nofollow">3.退火模拟求根号n的值</a></li><li><a href="#4POJ2420_252" rel="nofollow">4.洛谷POJ-2420</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="1_1"></a>1.模拟退火介绍</h4> 
<p>​ 模拟退火是模拟物理上退火方法，通过N次迭代（退火），逼近函数的上的一个<strong>最值</strong>（最大或者最小值）。比如在下面函数去逼近最大值C点<br> <img src="https://images2.imgbox.com/ed/c7/Eu9ZZsZe_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="11_7"></a>1.1模拟退火的可行性</h5> 
<p>​ 模拟退火算法得益于材料统计力学的研究成果。</p> 
<p>​ 鉴于固体的退火原理，当固体的<strong>温度很高</strong>的时候，内能比较大，固体的内部粒子处于<strong>快速无序运动</strong>，当温度<strong>慢慢降低</strong>的过程中，固体的内能减小，粒子的慢慢<strong>趋于有序</strong>，最终，当固体处于常温时，<strong>内能达到最小</strong>，此时，粒子<strong>最为稳定</strong>。</p> 
<p>​ 如果用粒子的能量定义材料的状态，退火算法用一个简单的数学模型描述了退火的过程。假设材料在状态i下的能量为E(i),那么材料在温度T时从状态i进入状态j就应该遵从以下规律：</p> 
<p>（1）如果E(j)&lt;=E(i)，那么级接收该状态。</p> 
<p>（2）如果E(j)&gt;E(i),那么就以一定的概率进入该状态：exp{(E(i)-E(j))/KT}</p> 
<p><strong>K为物理学中的玻尔兹曼常数，T为材料的温度</strong></p> 
<h5><a id="12_21"></a>1.2退火模型</h5> 
<ul><li>退火算法是一种循环算法</li><li>需要先设定一个初始的问题T【需要一个高温，模拟粒子从高温向低温退火】</li><li>每次循环进行一次退火</li><li>然后降低的温度，我们通过让和一个“降温系数”（一个接近1的小数，比如0.999)相乘，达到<strong>慢慢降低</strong>温度的效果，直到接近于0（我们用来代表一个接近0的数(比如0.00001)。</li></ul> 
<p><strong>代码架构</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">double</span> T<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span>	    <span class="token comment">//表示初始的温度为0.99</span>
<span class="token keyword">double</span> dt<span class="token operator">=</span><span class="token number">0.999</span><span class="token punctuation">;</span>	<span class="token comment">//表示降温系数</span>
<span class="token keyword">double</span> eps<span class="token operator">=</span><span class="token number">1e-14</span><span class="token punctuation">;</span>	<span class="token comment">//相对于1的负14次方，就是最后退出循环的温度</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>T<span class="token operator">&lt;</span>eps<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//------------------</span>
    <span class="token comment">//进行一次退火操作</span>
    <span class="token comment">//------------------</span>
    T<span class="token operator">*=</span>dt<span class="token punctuation">;</span>		 <span class="token comment">//降低温度</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_44"></a>2.详解退火</h4> 
<p>​ 我们要求的目标无法是两个：自变量x和对应的目标函数最值f(x)</p> 
<h5><a id="21_48"></a>2.1退火过程</h5> 
<ul><li>先随机找一点x0,这也是初始粒子。【注意要随机】</li></ul> 
<p><img src="https://images2.imgbox.com/90/94/aZtpheRC_o.png" alt="在这里插入图片描述"></p> 
<ul><li>找到对应的目标函数值</li></ul> 
<p><img src="https://images2.imgbox.com/a3/11/kd3a6nVc_o.png" alt="在这里插入图片描述"></p> 
<ul><li>进行退火操作</li></ul> 
<p>​ 刚才我们说了x0相当于是<strong>一个粒子</strong>，所以我们会进行一个<strong>无序运动</strong>，也就是向左或者向右随机移动：移动的<strong>幅度</strong>和<strong>当前的温度T</strong>有关。</p> 
<p>​ 温度T越大，移动的幅度越大。温度T越小，移动的幅度就越小。这是在模拟粒子无序运动的状态。</p> 
<ul><li>接收更好的状态</li></ul> 
<p><img src="https://images2.imgbox.com/b3/c5/eSK5QhkD_o.png" alt="在这里插入图片描述"></p> 
<p>​ 假设我们移动到了x1处，那么这个点对应的f(x1)很明显答案是优于（大于）当前的f(x0)。</p> 
<p><img src="https://images2.imgbox.com/c8/71/QfkujFny_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>因此我们将答案进行<strong>更新</strong>。也就是将初始值进行替换：x0=x1,f(x0)=f(x1)。这是一种<strong>贪心</strong>的思想。</p> </li><li> <p>以一定概率接受(Accept)<strong>更差的状态</strong></p> </li></ul> 
<p>为什么需要按照一定的概率接受更差的状态。因为可能在一个较差的状态旁边会出现一个<strong>更加高</strong>的山峰</p> 
<p><img src="https://images2.imgbox.com/b7/f9/FU1Q9e7o_o.png" alt="在这里插入图片描述"></p> 
<p>如果我们<strong>鼠目寸光</strong>，只盯着右半区，很容易随着<strong>温度的下降、左右跳转幅度的减小</strong>而<strong>迷失自己</strong>，最后困死在小山丘中。</p> 
<p>而我们如果找到了左边山峰的低点，以<strong>一定的概率接受了它</strong>（概率大小和温度以及当前的值的关键程度有关），会在跳转幅度减少之前，<strong>尽可能找到最优点</strong>。</p> 
<p>那么我们以多少的概率去接受它呢？我们用一个公式表示：exp{ Δf / KT }</p> 
<p><strong>注意</strong></p> 
<pre><code>- 如果随机后的函数值如果结果更好，我们一定选择它(即x0=x1,f(x0)=f(x1));
- 随机后的函数值如果结果更差，我们以exp{ Δf /  KT }的概率接受它
- e是自然对数，约等于2.71。我们可以把右上角这一坨 Δf /  KT值看成一个整体x:
</code></pre> 
<p>而exp{x}的函数图像为：</p> 
<p><img src="https://images2.imgbox.com/d4/ee/sP8KdTwK_o.png" alt="在这里插入图片描述"></p> 
<p>而如果需要用exp{x}表示一个概率，那么x【Δf / KT】的取值范围只能为负数。</p> 
<p>负数部分的值域是在(0,1)开区间内，x越小，越接近0，越大越靠近1。</p> 
<h5><a id="22_108"></a>2.2各变量说明</h5> 
<p>K其实是个物理学玻尔兹曼常数，我们在代码中<strong>不会用到</strong>。</p> 
<p>T就是当前的温度。所以实际上这个分母就是T，K当做1使用。</p> 
<p>Δf：</p> 
<ul><li>我们想要函数来代表一个概率值，一定要让它的值域属于(0,1)，所以Δf / KT必须是个负数。但是在我们的模拟中KT一定是正数，那么Δf必须是个负数</li><li>Δf 就是当前解的函数值与目标解函数值之差</li><li>现在我们求一个函数的<strong>最大值</strong>，如果f(x0)&lt;f(x1)，那就说明结果<strong>变好了</strong>，我们<strong>肯定</strong>选择它</li><li>如果f(x0)&gt;f(x1)，那就说明结果<strong>变差了</strong>，我们需要概率选择它，因此Δf=-(f(x0)-f(x1));</li></ul> 
<p><img src="https://images2.imgbox.com/56/c6/WtpJWXZo_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="221_126"></a>2.2.1关于接收概率</h6> 
<p>关于接受概率e{x}和KT以及Δf的关系：</p> 
<p>当T越大时(温度越高)，由于是Δf一个负数，所以Δf / KT算出来的值会越大。比如-1 / 1000 等于 -0.001，很明显-0.001 &gt; -1，由于e{x}是个单调递增函数，所以温度越高时，接受的概率就越大。</p> 
<p>Δf越小【负的越多】，说明答案越糟糕，那么接受的概率就越小。</p> 
<blockquote> 
 <p>①对rand()函数</p> 
 <ol><li>rand()函数可以默认拿到[0,32767]内的随机整数</li><li>RAND_MAX = 32767，可以看作常量。本质是宏定义: #define RAND_MAX 32767</li><li>rand() * 2 的范围是[0,32767 * 2]</li><li>rand() * 2 - RAND_MAX 的范围是[-32767, 32767]</li></ol> 
 <p>②对exp()函数</p> 
 <ol><li>exp(x)代表e的x次方</li></ol> 
 <p>③关于exp((df - f) / T) * RAND_MAX &gt; rand()</p> 
 <ol><li>目的是要概率接受，但是exp{x}是个准确值，所以从理论上我们可以生成一个（0,1）的随机数，如果exp{x}比(0,1)这个随机数要大，那么我们就接受。</li><li>但是由于rand()只能产生[0,32767]内的随机整数，化成小数太过麻烦。所以我们可以把左边乘以RAND_MAX（也就是把概率同时扩大32767倍），效果就等同exp{x}于比(0,1)了。</li></ol> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">double</span> T <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span> <span class="token comment">//代表开始的温度</span>
<span class="token keyword">double</span> dT <span class="token operator">=</span> <span class="token number">0.999</span><span class="token punctuation">;</span> <span class="token comment">//代表系数delta T</span>
<span class="token keyword">double</span> eps <span class="token operator">=</span> <span class="token number">1e-14</span><span class="token punctuation">;</span> <span class="token comment">//相当于0.0000000000000001</span>

<span class="token comment">//用自变量计算函数值,这里可能存在多个自变量对应一个函数值的情况，比如f(x,y)</span>
<span class="token keyword">double</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//这里是对函数值进行计算</span>
    <span class="token keyword">double</span> ans <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//原始值</span>
<span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//x0取随机值</span>
<span class="token keyword">double</span> f <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过自变量算出f(x0)的值</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>T <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//--------------</span>
    <span class="token comment">//这里是每一次退火的操作</span>
    
    <span class="token comment">//x1可以左右随机移动，幅度和温度T正相关，所以*T</span>
    <span class="token comment">//注意这里移动可以左右移动，但是也可以单向移动</span>
    <span class="token comment">//关于rand()详细见开头注的①</span>
    <span class="token keyword">double</span> dx <span class="token operator">=</span> x<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span> 
    
    <span class="token comment">//让x落在定义域内，如果没在里面，就重新随机。</span>
    <span class="token comment">// ================</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token operator">?</span> <span class="token operator">||</span> x <span class="token operator">&lt;</span> <span class="token operator">?</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//保证x在作用域中</span>
        <span class="token keyword">double</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ================</span>
    
    <span class="token comment">//求出f(x1)的值</span>
    <span class="token keyword">double</span> df <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//这里需要具体问题具体分析，我们要接受更加优秀的情况。可能是df &lt; f(比如求最小值）</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>f <span class="token operator">&lt;</span> df<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        f <span class="token operator">=</span> df<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>y <span class="token operator">=</span> dy<span class="token punctuation">;</span><span class="token punctuation">]</span> <span class="token comment">// 接受，替换值，如果多个自变量，那么都替换</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//否则概率接受，注意这里df-f也要具体问题具体分析。</span>
    <span class="token comment">//详细见开头注的②③</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df <span class="token operator">-</span> f<span class="token punctuation">)</span> <span class="token operator">/</span> T<span class="token punctuation">)</span> <span class="token operator">*</span> RAND_MAX <span class="token operator">&gt;</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        f <span class="token operator">=</span> df<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>y <span class="token operator">=</span> dy<span class="token punctuation">;</span><span class="token punctuation">]</span> <span class="token comment">// 接受，替换值，如果多个自变量，那么都替换</span>
    <span class="token punctuation">}</span>
 <span class="token comment">//--------------</span>
    T <span class="token operator">=</span> T <span class="token operator">*</span> dT<span class="token punctuation">;</span> <span class="token comment">//温度每次下降一点点， T * 0.999</span>
<span class="token punctuation">}</span>
<span class="token comment">//最后输出靠近最优的自变量x值，和函数值f(x)</span>
cout <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> f <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3n_198"></a>3.退火模拟求根号n的值</h4> 
<p>我们试图通过退火找出一个值x0，使得x0的平方的值更加接近于n</p> 
<p>所以我们的目标函数就可以知道：f(x)=|x0^2-n|;</p> 
<pre><code class="prism language-cpp"><span class="token comment">//n代表我们最后函数要逼近的值</span>
<span class="token keyword">double</span> n<span class="token punctuation">;</span>
<span class="token comment">//x表示我们随机产生的那个数的平方和n的靠近程度</span>
<span class="token keyword">double</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">fabs</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>退火函数SA()</p> 
<pre><code class="prism language-cpp"><span class="token keyword">double</span> T <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span> <span class="token comment">//初始温度，初始温度主要是看题目开始需要跳转的幅度。</span>
<span class="token keyword">double</span> dT <span class="token operator">=</span> <span class="token number">0.995</span><span class="token punctuation">;</span> <span class="token comment">//变化率，这里需要速度稍微慢一点，写0.999 或者 0.997都可以，但是越靠近1速度就越慢 </span>
<span class="token keyword">const</span> <span class="token keyword">double</span> eps <span class="token operator">=</span> <span class="token number">1e-14</span><span class="token punctuation">;</span> <span class="token comment">//10的-14次方已经非常小了，写这个大概率没问题</span>
<span class="token keyword">void</span> <span class="token function">SA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//首先随机生成一个点x0，这里我用0代替。</span>
    <span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//算出x平方和n的差距f(x0)</span>
    <span class="token keyword">double</span> f <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>T <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//这里x0既可以变小，也可以变大，所以我们正负都要进行一个跳转,算出变换后的点dx</span>
        <span class="token keyword">double</span> dx <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span>
        <span class="token comment">//但是请注意，dx很明显要保证 &gt;= 0才行，因为算术平方根的定义域是&gt;=0，因此小于0就重新随机</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>dx <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            dx <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//算出变换后的点dx的平方和n的差距，f(dx)</span>
        <span class="token keyword">double</span> df <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里就是关键的地方了，很明显我们需要算出来的function值越小，自变量x更加接近那个根号值。</span>
        <span class="token comment">//所以如果新来的值df 比 f更小，我们百分百接受</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>df <span class="token operator">&lt;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意更新所有变量</span>
            f <span class="token operator">=</span> df<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//否则我们概率接受，这里的需要写 f - df了，因为这样才是负值。负值说明我们并不是贪心接受的，他是不太好的值。</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">-</span> df<span class="token punctuation">)</span><span class="token operator">/</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> RAND_MAX <span class="token operator">&gt;</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意更新所有变量</span>
            f <span class="token operator">=</span> df<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//温度下降一下</span>
        T <span class="token operator">*=</span> dT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.8lf"</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4POJ2420_252"></a>4.洛谷POJ-2420</h4> 
<p>题目描述</p> 
<p>给出平面上N（N&lt;=100）个点，你需要找到一个这样的点，使得这个点到N个点的距离之和尽可能小。输出这个最小的距离和（四舍五入到最近的整数）。</p> 
<p>Input输入</p> 
<p>第一行N，接下来N行每行两个整数，表示N个点</p> 
<p>Output输出</p> 
<p>一行一个正整数，最小的距离和。</p> 
<pre><code class="prism language-cpp">Sample Input样例输入
<span class="token number">4</span>
<span class="token number">0</span> <span class="token number">0</span>
<span class="token number">0</span> <span class="token number">10000</span>
<span class="token number">10000</span> <span class="token number">10000</span>
<span class="token number">10000</span> <span class="token number">0</span>
Sample Output样例输出
<span class="token number">28284</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/fc/WUVnhnMo_o.png" alt="在这里插入图片描述"></p> 
<p><strong>将所有的点存放入一个结构体point数组中</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1e5</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>e<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//main函数中输入N个点</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lf%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>关键的函数</p> 
<pre><code class="prism language-cpp"><span class="token comment">//输入我们随机生成的点A 坐标 x0, y0</span>
<span class="token keyword">double</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> xx <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> yy <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// xx 就是 xi ，yy 就是 yi</span>
        <span class="token keyword">double</span> p <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x0 - xi</span>
        <span class="token keyword">double</span> q <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// y0 - yi</span>
        ans <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">*</span> p <span class="token operator">+</span> q <span class="token operator">*</span> q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ans加上到随机点A到点i的距离</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后套用上面的公式，我们写出SA()模拟退火</p> 
<pre><code class="prism language-cpp"><span class="token keyword">double</span> T <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span> <span class="token comment">//初始温度</span>
<span class="token keyword">double</span> dT <span class="token operator">=</span> <span class="token number">0.993</span><span class="token punctuation">;</span> <span class="token comment">//变化率，这里需要速度稍微慢一点，写0.995 或者 0.997都可以，但是越靠近1速度就越慢 </span>
<span class="token keyword">const</span> <span class="token keyword">double</span> eps <span class="token operator">=</span> <span class="token number">1e-14</span><span class="token punctuation">;</span> <span class="token comment">//10的-14次方已经非常小了，写这个大概率没问题</span>
<span class="token keyword">void</span> <span class="token function">SA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//随机生成点A(x0,y0)，这里我直接赋值为了0。当然也可以写rand()，差别都不大。</span>
    <span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//生成的点A(x0,y0)对应的函数值f(x0, y0)</span>
    <span class="token keyword">double</span> f <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>T <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//这里对x和y同时进行一个偏移，很明显在一个平面中，上下左右都可以移动，所以我们选择了rand() * 2 - RAND_MAX</span>
        <span class="token comment">//对于每个点，我们的偏移幅度都要 * T,温度越高，偏移量越大</span>
        <span class="token keyword">double</span> dx <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span>
        <span class="token keyword">double</span> dy <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">*</span> T<span class="token punctuation">;</span>
        <span class="token comment">//算出偏移后的点B(dx, dy)对应的函数值f(dx, dy)</span>
        <span class="token keyword">double</span> df <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里就是关键的地方了，很明显我们需要算出来的function值越小，就更加优秀</span>
        <span class="token comment">//所以如果新来的值df 比 f更小，我们百分百接受</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>df <span class="token operator">&lt;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意更新所有变量</span>
            f <span class="token operator">=</span> df<span class="token punctuation">;</span> y <span class="token operator">=</span> dy<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//否则我们概率接受，这里的需要写 f - df了，因为这样才是负值</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">-</span> df<span class="token punctuation">)</span> <span class="token operator">/</span> T<span class="token punctuation">)</span> <span class="token operator">*</span> RAND_MAX <span class="token operator">&gt;</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意更新所有变量</span>
            f <span class="token operator">=</span> df<span class="token punctuation">;</span> y <span class="token operator">=</span> dy<span class="token punctuation">;</span> x <span class="token operator">=</span> dx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//降低温度</span>
        T <span class="token operator">=</span> T <span class="token operator">*</span> dT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//输出答案</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.f\n"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/25557e4f13389bd519729bdef32d088e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Failed to read the ‘handle‘ property from ‘MediaSource‘: MediaSourceHandle creation is currently sup</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/43a589a7d3b9df9fb3653ec30c440dd0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">socket编程之connect()</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>