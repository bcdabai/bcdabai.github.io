<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>x86 Kylin V10系统安装kvm并创建虚拟机 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="x86 Kylin V10系统安装kvm并创建虚拟机" />
<meta property="og:description" content="#内核版本和系统版本 [root@xa-radb-02 ~]# uname -a Linux xa-radb-02 4.19.90-24.4.v2101.ky10.x86_64 #1 SMP Mon May 24 12:14:55 CST 2021 x86_64 x86_64 x86_64 GNU/Linux [root@xa-radb-02 ~]# cat /etc/kylin-release Kylin Linux Advanced Server release V10 (Sword) #查看是否支持虚拟化，值大于0表示支持 [root@xa-radb-02 ~]# egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo 128 #确保BIOS里开启虚拟化功能，即查看是否加载KVM模块 [root@xa-radb-02 ~]# lsmod | grep kvm kvm_amd 106496 100 ccp 102400 1 kvm_amd kvm 753664 1 kvm_amd irqbypass 16384 43 kvm #如果没有加载，运行以下命令： [root@localhost ~]# modprobe kvm [root@localhost ~]# lsmod | grep kvm # 桥接网络，kylin V10没有network." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/89136b475c82dd6d2c5f7f0b688bf87d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T17:16:35+08:00" />
<meta property="article:modified_time" content="2023-11-20T17:16:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">x86 Kylin V10系统安装kvm并创建虚拟机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <pre><code class="prism language-shell"><span class="token comment">#内核版本和系统版本</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux xa-radb-02 <span class="token number">4.19</span>.90-24.4.v2101.ky10.x86_64 <span class="token comment">#1 SMP Mon May 24 12:14:55 CST 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/kylin-release </span>
Kylin Linux Advanced Server release V10 <span class="token punctuation">(</span>Sword<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"> <span class="token comment">#查看是否支持虚拟化，值大于0表示支持</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># egrep -c '(vmx|svm)' /proc/cpuinfo  </span>
<span class="token number">128</span>
<span class="token comment">#确保BIOS里开启虚拟化功能，即查看是否加载KVM模块</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># lsmod | grep kvm</span>
kvm_amd               <span class="token number">106496</span>  <span class="token number">100</span>
ccp                   <span class="token number">102400</span>  <span class="token number">1</span> kvm_amd
kvm                   <span class="token number">753664</span>  <span class="token number">1</span> kvm_amd
irqbypass              <span class="token number">16384</span>  <span class="token number">43</span> kvm
<span class="token comment">#如果没有加载，运行以下命令：</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># modprobe kvm</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsmod | grep kvm</span>

<span class="token comment"># 桥接网络，kylin V10没有network.service服务</span>
<span class="token comment"># 如果没有brctl命令（用来管理网桥的工具），则需要安装bridge-utils ，</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># yum -y install bridge-utils</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cp ifcfg-enp11s0f0 ifcfg-br0</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># more ifcfg-enp11s0f0</span>
<span class="token comment"># Generated by dracut initrd</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"enp11s0f0"</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span><span class="token string">"enp11s0f0"</span>
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">NETBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token comment">#BOOTPROTO=static</span>
<span class="token comment">#IPADDR=192.168.0.18</span>
<span class="token comment">#PREFIX=22</span>
<span class="token comment">#GATEWAY=192.168.3.254</span>
<span class="token comment">#DNS1=114.114.114.114</span>
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">BRIDGE</span><span class="token operator">=</span>br0

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-br0</span>
<span class="token comment"># Generated by dracut initrd</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"br0"</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span><span class="token string">"br0"</span>
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">NETBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.0.18
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token number">22</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.3.254
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Bridge

<span class="token comment">### 重启网卡服务，Kylin V10没有network.service服务</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart network</span>
<span class="token comment">#Kylin V10没有network.service服务，配置好后可以重启服务器</span>
<span class="token comment">#通过重启的方式来重启网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># reboot</span>

<span class="token comment">#查看网卡</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name	bridge <span class="token function">id</span>		STP enabled	interfaces
br0		<span class="token number">8000</span>.e8611f3eed33	no		p29p1
<span class="token comment">#查看ip信息</span>
<span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: p29p1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq master br0 state UP group default qlen <span class="token number">1000</span>
    link/ether e8:61:1f:3e:ed:33 brd ff:ff:ff:ff:ff:ff
<span class="token number">3</span>: p29p2: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state DOWN group default qlen <span class="token number">1000</span>
    link/ether e8:61:1f:3e:ed:34 brd ff:ff:ff:ff:ff:ff
<span class="token number">4</span>: enp36s0f3u1u2c2: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc fq_codel state UNKNOWN group default qlen <span class="token number">1000</span>
    link/ether ce:3b:0c:8a:60:99 brd ff:ff:ff:ff:ff:ff
<span class="token number">5</span>: br0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default qlen <span class="token number">1000</span>
    link/ether e8:61:1f:3e:ed:33 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.0.42/22 brd <span class="token number">192.168</span>.3.255 scope global noprefixroute br0
       valid_lft forever preferred_lft forever
    inet6 fe80::ea61:1fff:fe3e:ed33/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever

</code></pre> 
<pre><code class="prism language-shell"><span class="token comment">#安装软件</span>
yum <span class="token function">install</span> libvirt* qemu* <span class="token parameter variable">-y</span>
或
yum <span class="token function">install</span> qemu-kvm libvirt virt-install virt-manager libvirt-client virt-clone <span class="token parameter variable">-y</span>

Centos/redhat
yum <span class="token function">install</span> qemu-kvm libvirt virt-install libvirt-python virt-manager libvirt-client virt-clone <span class="token parameter variable">-y</span>

<span class="token comment">#启动服务器并设置开机自启</span>
<span class="token comment">#设置开机自启</span>
systemctl <span class="token builtin class-name">enable</span> libvirtd
systemctl start libvirtd

<span class="token comment">#安装virt-manager或者vnc</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> virt-manager
</code></pre> 
<p><a href="https://blog.csdn.net/weixin_46031767/article/details/127556804">Kylin V10安装VNC参考链接</a><br> 查看服务状态：systemctl status libvirtd<br> <img src="https://images2.imgbox.com/cf/32/AkWNmGY6_o.png" alt="在这里插入图片描述"><br> virsh list 出现下面内容则安装成功<br> <img src="https://images2.imgbox.com/bb/f0/ZconMFQO_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>命令行安装虚拟机：</strong> (kvm安装kylin系统的虚拟机时需要同意“认证许可”，如果vnc无法显示页面则在命令行<code>virsh console 虚拟机名称</code>方式同意认证)</p> 
<pre><code class="prism language-bash"><span class="token comment">#安装工具</span>
<span class="token comment"># yum install -y virt-install </span>
<span class="token comment">#安装kvm虚机，修改实例名字(name),内存大小(ram),cpu核数(vcpus)，虚机磁盘存放路径(path),磁盘格式(format),磁盘大小(size),iso文件位置(cdrom),vnc端口(vncport),桥接网络(bridge)</span>
 virt-install <span class="token parameter variable">--name</span><span class="token operator">=</span>ceph1  <span class="token parameter variable">--ram</span> <span class="token number">32768</span> <span class="token parameter variable">--vcpus</span><span class="token operator">=</span><span class="token number">8</span> <span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/kvm/kvms/ceph1.qcow2,format<span class="token operator">=</span>qcow2,size<span class="token operator">=</span><span class="token number">100</span>,bus<span class="token operator">=</span>virtio <span class="token parameter variable">--accelerate</span> <span class="token parameter variable">--cdrom</span> /kvm/rhel-server-7.9-x86_64-dvd.iso <span class="token parameter variable">--vnc</span> <span class="token parameter variable">--vncport</span><span class="token operator">=</span><span class="token number">5910</span> <span class="token parameter variable">--vnclisten</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token parameter variable">--network</span> <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0,model<span class="token operator">=</span>virtio <span class="token parameter variable">--noautoconsole</span>
<span class="token comment">#####</span>
name: kvm虚机实例显示名称
 <span class="token punctuation">[</span>root@xa-radb-02 ~<span class="token punctuation">]</span><span class="token comment"># virsh list</span>
 Id   名称    状态
----------------------
 <span class="token number">8</span>    ceph1   运行中
<span class="token function">ram</span> 实例分配内存大小
vcpus: cpu核数
disk: 磁盘，实例客户机存储的媒体
size: 磁盘大小。默认GB
formate: 磁盘的映像格式,raw，qcow2,vmdk等
bus: 等于target.bus 磁盘总线类型，<span class="token string">'ide'</span>, <span class="token string">'sata'</span>, <span class="token string">'scsi'</span>, <span class="token string">'usb'</span>, <span class="token string">'virtio'</span> or <span class="token string">'xen'</span>
cdrom: 指定iso镜像文件
noautoconsole: 不要自动尝试连接到客户端控制台

<span class="token comment">#使用 man virt-install 查看更多详细参数</span>
<span class="token comment">#安装好后使用VNC连接实例安装系统并完成其他配置</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@xa-radb-01 kvms<span class="token punctuation">]</span><span class="token comment"># virt-install --name=ceph1  --ram 32768 --vcpus=8 --disk path=/kvm/kvms/ceph1.qcow2,format=qcow2,size=100,bus=virtio --accelerate --cdrom /kvm/rhel-server-7.9-x86_64-dvd.iso --vnc --vncport=5900 --vnclisten=0.0.0.0 --network bridge=br0,model=virtio --noautoconsole</span>

Starting install<span class="token punctuation">..</span>.
Allocating <span class="token string">'ceph1.qcow2'</span>                                                                                       <span class="token operator">|</span> <span class="token number">100</span> GB  00:00:00     
Domain installation still <span class="token keyword">in</span> progress. You can reconnect to 
the console to complete the installation process.
</code></pre> 
<pre><code class="prism language-bash"><span class="token parameter variable">--network</span> <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0,model<span class="token operator">=</span>virtio
安装虚拟机时,model默认类型为rtl8139。（使用rtl8139类型可能会出现虚拟机卡顿、卡死需要重启的问题。推荐使用virtio）
<span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 和 <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 是两种不同的网卡类型，主要有以下区别：

<span class="token number">1</span>. **性能差异：**
   - <span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 是一种基于软件的实现，性能相对较低。它模拟了一个 Realtek RTL8139 网卡。
   - <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 是一种高性能的虚拟化网络设备，提供了专用于虚拟机的驱动程序，与底层宿主系统的网络设备进行更有效的交互。

<span class="token number">2</span>. **驱动程序支持：**
   - <span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 通常无需额外的驱动程序，因为它的驱动程序通常已经包含在大多数操作系统中。
   - <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 则需要虚拟机中安装相应的 virtio 驱动程序，这通常提供了更好的性能和功能支持。

<span class="token number">3</span>. **性能特性：**
   - <span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 可能在高负载下表现不佳，并且不支持一些现代的虚拟化特性。
   - <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 具有更好的性能，支持多队列和直接 I/O <span class="token punctuation">(</span>IOV<span class="token punctuation">)</span>，这些功能有助于提高网络性能。

<span class="token number">4</span>. **主机和客户机兼容性：**
   - <span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 是一种通用的模拟设备，可能在各种虚拟化平台上都能使用，但它可能无法发挥一些高级特性。
   - <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 通常需要对应虚拟化平台的支持，并且在某些平台上可能需要手动配置。

在大多数情况下，建议选择 <span class="token variable"><span class="token variable">`</span>virtio<span class="token variable">`</span></span> 网卡类型，因为它通常提供更好的性能和功能支持。然而，如果你在特定环境中遇到兼容性问题，或者对性能要求不高，<span class="token variable"><span class="token variable">`</span>rtl8139<span class="token variable">`</span></span> 也是一个可行的选择。
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4abd3305d339c2f06c8f674df6db4a6f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">搭建centos代理服务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/76e63c9232313eb258aa9605bb1d9e49/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Dev C&#43;&#43;使用简明教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>