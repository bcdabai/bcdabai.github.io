<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从树莓派系统安装小白到系统SD卡复制克隆高手 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="从树莓派系统安装小白到系统SD卡复制克隆高手" />
<meta property="og:description" content="为了快速复制克隆嵌入式设备，把当前已经调试好的设备的系统做成image系统镜像，无疑是最快捷的。对于树莓派系统来说，属于嵌入式设备，使用树莓派的imager去烧写出系统，然后安装必要的软件，当系统完全设置好之后就可以克隆了，下面讲述整个过程。
1、安装准备 安装操作系统，需要使用树莓派的烧写程序，将SD卡放入读卡器，查到电脑上，当U盘使用
imager下载地址：https://downloads.raspberrypi.org/imager/imager_latest.exe
如果是linux，可以用命令行安装：
sudo apt install rpi-imager 2、安装ubuntu 此次将安装ubuntu，对于这种嵌入式设备，选择ubuntu server no desktop的版本，因为图形桌面太耗费资源，虽然树莓派已经算是比较强的，但是desktop版的系统在树莓派上运行，还是会出现各种问题的。
3、系统设置 3.1、修改系统密码 该版本系统安装好之后，默认的账号密码是ubuntu/ubuntu，第一次登陆会强制修改密码。按照系统引导提示去修改默认密码就可以。
3.2、修改IP地址 树莓派默认的是dhcp配置，嵌入式设备一版都是设置静态IP，这就需要修改配置文件，按照下面的格式写这个配置文件，空格什么的最好都不要错：
sudo vim /etc/netplan/50-cloud-init.yaml
3.3、打开树莓派串口 树莓派默认已经打开uart1，其他的串口需要配置重启才能生效：
sudo vim /boot/firmware/config.txt
打开改文件最后增加如下配置：
dtoverlay=uart2
dtoverlay=uart3
dtoverlay=uart4
dtoverlay=uart5
重启之后你可以看到下面这些设备
3.4、关闭NTP ntp是树莓派提供的一个从互联网自动同步时间的服务，我们如果想让树莓派设定自己想要的时间，那么就需要关闭这个服务即可：
- open:sudo timedatectl set-ntp true - close:sudo timedatectl set-ntp false
3.5、安装必要软件 树莓派的ubuntu安装好之后很多基础的软件都不具备，因此需要手动安装
3.5.1、安装软件时总是报错，可以修改配置文件 系统安装好之后，每次安装软件总是会报一些错误，需要修改如下配置：
sudo vim /etc/needrestart/needrestart.conf
找到这样内容：#$nrconf{ucodehints} = 0;
删掉#，保存退出
3.5.2、安装python2.7 python3并不是完全向下兼容的，有些老项目调用的python函数到python3并不支持，那么就需要安装老版本
sudo apt-get install python2.7
做好符号链接
sudo ln -s /usr/bin/python2.7 /usr/bin/python
3.5.3、安装make sudo apt install make" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/44e808b426907a5c1336129f41c504e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-11T10:20:57+08:00" />
<meta property="article:modified_time" content="2022-07-11T10:20:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从树莓派系统安装小白到系统SD卡复制克隆高手</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>为了快速复制克隆嵌入式设备，把当前已经调试好的设备的系统做成image系统镜像，无疑是最快捷的。对于树莓派系统来说，属于嵌入式设备，使用树莓派的imager去烧写出系统，然后安装必要的软件，当系统完全设置好之后就可以克隆了，下面讲述整个过程。</p> 
<h2>1、安装准备</h2> 
<p>安装操作系统，需要使用树莓派的烧写程序，将SD卡放入读卡器，查到电脑上，当U盘使用</p> 
<p>imager下载地址：<a href="https://downloads.raspberrypi.org/imager/imager_latest.exe" rel="nofollow" title="https://downloads.raspberrypi.org/imager/imager_latest.exe">https://downloads.raspberrypi.org/imager/imager_latest.exe</a></p> 
<p>如果是linux，可以用命令行安装：</p> 
<p>sudo apt install rpi-imager </p> 
<h2>2、安装ubuntu</h2> 
<p>此次将安装ubuntu，对于这种嵌入式设备，选择ubuntu server no desktop的版本，因为图形桌面太耗费资源，虽然树莓派已经算是比较强的，但是desktop版的系统在树莓派上运行，还是会出现各种问题的。</p> 
<p><img alt="" height="454" src="https://images2.imgbox.com/62/16/Z3RNOgxh_o.png" width="683"></p> 
<p><img alt="" height="452" src="https://images2.imgbox.com/30/e3/SZFTYY1J_o.png" width="679"></p> 
<p><img alt="" height="371" src="https://images2.imgbox.com/b1/26/NgkzNdf6_o.png" width="633"></p> 
<p> <img alt="" height="372" src="https://images2.imgbox.com/22/57/beIU5Bhb_o.png" width="614"></p> 
<p> <img alt="" height="376" src="https://images2.imgbox.com/60/53/ZC9jvUQf_o.png" width="587"></p> 
<p><img alt="" height="455" src="https://images2.imgbox.com/8e/33/OufKADiC_o.png" width="683"></p> 
<p><img alt="" height="109" src="https://images2.imgbox.com/2a/df/gu2JgsZV_o.png" width="597"></p> 
<p><img alt="" height="459" src="https://images2.imgbox.com/ba/bb/fcOCdlm2_o.png" width="688"></p> 
<h2> 3、系统设置</h2> 
<h3>3.1、修改系统密码</h3> 
<p>该版本系统安装好之后，默认的账号密码是ubuntu/ubuntu，第一次登陆会强制修改密码。按照系统引导提示去修改默认密码就可以。</p> 
<h3>3.2、修改IP地址</h3> 
<p> 树莓派默认的是dhcp配置，嵌入式设备一版都是设置静态IP，这就需要修改配置文件，按照下面的格式写这个配置文件，空格什么的最好都不要错：</p> 
<p><em>sudo vim /etc/netplan/50-cloud-init.yaml</em></p> 
<p><img alt="" height="505" src="https://images2.imgbox.com/a2/19/1bqbBkl6_o.png" width="1000"></p> 
<h3>3.3、打开树莓派串口</h3> 
<p>树莓派默认已经打开uart1，其他的串口需要配置重启才能生效：</p> 
<p>sudo vim /boot/firmware/config.txt</p> 
<p>打开改文件最后增加如下配置：</p> 
<blockquote> 
 <p style="margin-left:0;"><em>dtoverlay=uart2</em></p> 
 <p style="margin-left:0;"><em>dtoverlay=uart3</em></p> 
 <p style="margin-left:0;"><em>dtoverlay=uart4</em></p> 
 <p style="margin-left:0;"><em>dtoverlay=uart5</em></p> 
</blockquote> 
<p> 重启之后你可以看到下面这些设备</p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/16/af/nxok7pkK_o.png" width="938"></p> 
<h3> 3.4、关闭NTP</h3> 
<p>ntp是树莓派提供的一个从互联网自动同步时间的服务，我们如果想让树莓派设定自己想要的时间，那么就需要关闭这个服务即可：</p> 
<blockquote> 
 <p style="margin-left:0;"><em>- open:sudo timedatectl set-ntp true </em></p> 
 <p style="margin-left:0;"><em>- close:sudo timedatectl set-ntp false</em></p> 
</blockquote> 
<h3>3.5、安装必要软件</h3> 
<p>树莓派的ubuntu安装好之后很多基础的软件都不具备，因此需要手动安装</p> 
<h4>3.5.1、安装软件时总是报错，可以修改配置文件</h4> 
<p>系统安装好之后，每次安装软件总是会报一些错误，需要修改如下配置：</p> 
<p>sudo vim /etc/needrestart/needrestart.conf</p> 
<p>找到这样内容：#$nrconf{ucodehints} = 0;</p> 
<p>删掉#，保存退出</p> 
<h4>3.5.2、安装python2.7</h4> 
<p>python3并不是完全向下兼容的，有些老项目调用的python函数到python3并不支持，那么就需要安装老版本</p> 
<p><em>sudo apt-get install python2.7</em></p> 
<p>做好符号链接</p> 
<p><em>sudo ln -s /usr/bin/python2.7 /usr/bin/python</em></p> 
<h4>3.5.3、安装make</h4> 
<p>sudo apt install make</p> 
<h4>3.5.4、安装gcc</h4> 
<p>sudo apt-get install gcc</p> 
<h4>3.5.5、设置应用程序自动启动</h4> 
<p>sudo vim /lib/systemd/system/rc-local.service</p> 
<p>在这个文件最后增加：</p> 
<pre><code>[Install] 
WantedBy=multi-user.target
Alias=rc-local.service
</code></pre> 
<p>修改文件权限：</p> 
<p>sudo chmod 777 /lib/systemd/system/rc-local.service</p> 
<p>打开此文件增加启动脚本：</p> 
<p>sudo vim /etc/rc.local</p> 
<p>如果文件不存在，则新建文件，在文件最后增加：</p> 
<pre><code>#!/bin/sh
cd /home/ubuntu/app
sudo nohup ./myprogramme.bin &amp;
echo "myprogramme start ok!"
exit 0
</code></pre> 
<p> 增加可执行权限</p> 
<p>sudo chmod +x /etc/rc.local</p> 
<p>做符号链接：</p> 
<p>sudo ln -s /lib/systemd/system/rc-local.service /etc/systemd/system/</p> 
<h2> 4、克隆SD卡</h2> 
<p>一个系统安装设置好之后，为了快速克隆到其他设备上，就需要将当前的系统做成image，这样就避免重复去做这些繁琐的安装和配置了。树莓派是一个嵌入式系统，和普通的PC上的系统不同，它的文件系统需要时busybox构建出来，和sd卡大小、分区、等因素相关，所以必须把文件系统也克隆过去，不能简单的只克隆操作系统文件，因此在PC上普通的那种制作依赖于文件目录的ISO的方式，IMAGE都不可行了，以下方法在此种情形下不可用：</p> 
<pre><code>sudo apt-get install genisoimage
sudo genisoimage -l -r -J -o /home/one/project/fs20/tool/simulator.iso /mnt/usb/</code></pre> 
<p>只能使用linux系统下的dd命令进行整个SD卡的克隆，而且如果克隆的不是整个SD卡，那么系统也将不可用。</p> 
<h3>4.1、挂在SD卡</h3> 
<p> 先查看linux下挂在了哪些设备</p> 
<p>sudo fdisk -lu</p> 
<p>lsblk</p> 
<p>创建挂在目录</p> 
<p>sudo mkdir /mnt/usb</p> 
<p>挂在设备：</p> 
<p>sudo mount /dev/sdc2 /mnt/usb</p> 
<p>卸载设备：</p> 
<p>sudo umount /mnt usb</p> 
<h3>4.2、整盘克隆</h3> 
<p>如果是32G的sd卡，整盘复制下来还是挺大的，有32G，因此复制过程中，同时使用压缩算法，进行文件压缩，这样结果文件会小一些。</p> 
<p>sudo dd if=/dev/sdd | bzip2 &gt; /home/tool/raspberry_32G.img</p> 
<p>这个img文件就可以随意拷贝其他目录下，往相同容量大小的sd卡进行恢复了</p> 
<p>sudo bzip2 -dc /home/tool/raspberry_32G.img | sudo dd of=/dev/sde</p> 
<h2>5、总结</h2> 
<p>在嵌入式系统上做这些实验还是很耗费时间的，前后花了几天时间，某些操作也不能拿PC系统上的经验来做，经过不断摸索，还是有很多收获，对于嵌入式系统也有了更深入的了解。</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b76bc337f6405423eac0c592614974c2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">达梦数据库统计信息和执行计划的命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d3244f0a41e069369fd5be665982d6b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java通过TCP实现HL7医疗系统传输协议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>