<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt 软件开发框架（详细版） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt 软件开发框架（详细版）" />
<meta property="og:description" content="该文章用图例&#43;代码方式演示了，一个线上软件基本框架（精简）。开发工具Qt&#43;VS2015
一. 基本要素 这里会用简单的图例和完整代码(这里以Qt代码为例)，说明一个线上软件基本的框架。
一个线上windows软件，一般分为几个大的部分
1 UI模块 负责处理来自业务逻辑层或者其它模块的数据展示
2 网络模块 A http、https请求
B websocket（该文章不做赘述）
封装post或get请求，处理请求返回、超时等
3 业务逻辑模块 这里主要处理的是网络模块返回数据的处理，并把结果通知UI模块
4 中间层 负责关联网络模块和业务逻辑模块
5 独立模块（守护进程、更新模块、日志收集模块…） 该文章不做赘述
这里UI模块并非纯UI，其中也有业务逻辑处理。 UI模块和业务逻辑模块 可以做成更低耦合，但是会有降低效率的代价
二. 图例部分 这里用精简代码演示了
1 从用户操作UI（调用UIMainWnd::sendAsk()）
2 发送网络请求（Network::_post(),Network::_get()）
3 到请求结果返回（Network::requestFinished()）
4 对返回数据处理（BusinessLogicManager::onAskAction()）
5 通知UI模块显示（UIMainWnd::on_ask_action()）
三. 代码部分 这里使用精简Qt代码演示
1 配置文件模块 #pragma once /********************************************************************* *@file ConfigDef.h *@brief 管理枚举enum、定义define、QString... *@author *@date *********************************************************************/ ///@ 网路请求消息结构 typedef struct _tagNetMessage { QString _type; // 类型 int _flag; // 标识 QString _url; // 接口Url QString _method; // 请求方式 QByteArray _byte; // 参数 }NetMessage; // 请求接口 /// @brief 发送聊天消息 #define API_POST_ASK_ACTION &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cc03cb63f6ef0acb3fd9723da8841612/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-23T16:04:13+08:00" />
<meta property="article:modified_time" content="2019-12-23T16:04:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt 软件开发框架（详细版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>该文章用图例+代码方式演示了，一个线上软件基本框架（精简）。开发工具Qt+VS2015</p> 
<h6><a id="__2"></a>一. 基本要素</h6> 
<p>这里会用简单的图例和完整代码(这里以Qt代码为例)，说明一个线上软件基本的框架。</p> 
<p>一个线上windows软件，一般分为几个大的部分</p> 
<h6><a id="1_UI_6"></a>1 UI模块</h6> 
<p>负责处理来自业务逻辑层或者其它模块的数据展示</p> 
<h6><a id="2__9"></a>2 网络模块</h6> 
<p>A http、https请求<br> B websocket（该文章不做赘述）<br> 封装post或get请求，处理请求返回、超时等</p> 
<h6><a id="3__14"></a>3 业务逻辑模块</h6> 
<p>这里主要处理的是网络模块返回数据的处理，并把结果通知UI模块</p> 
<h6><a id="4__17"></a>4 中间层</h6> 
<p>负责关联网络模块和业务逻辑模块</p> 
<h6><a id="5__20"></a>5 独立模块（守护进程、更新模块、日志收集模块…）</h6> 
<p>该文章不做赘述</p> 
<p><strong>这里UI模块并非纯UI，其中也有业务逻辑处理。 UI模块和业务逻辑模块 可以做成更低耦合，但是会有降低效率的代价</strong></p> 
<h6><a id="__25"></a>二. 图例部分</h6> 
<p><img src="https://images2.imgbox.com/60/4d/9Ho6o4m4_o.png" alt="在这里插入图片描述"></p> 
<p>这里用精简代码演示了<br> 1 从用户操作UI（调用UIMainWnd::sendAsk()）<br> 2 发送网络请求（Network::_post(),Network::_get()）<br> 3 到请求结果返回（Network::requestFinished()）<br> 4 对返回数据处理（BusinessLogicManager::onAskAction()）<br> 5 通知UI模块显示（UIMainWnd::on_ask_action()）</p> 
<h6><a id="__34"></a>三. 代码部分</h6> 
<p>这里使用精简Qt代码演示</p> 
<h6><a id="1__37"></a>1 配置文件模块</h6> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token comment">/*********************************************************************
*@file       ConfigDef.h
*@brief      管理枚举enum、定义define、QString...
*@author   
*@date       
*********************************************************************/</span>
<span class="token comment">///@ 网路请求消息结构</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _tagNetMessage
<span class="token punctuation">{<!-- --></span>
	QString _type<span class="token punctuation">;</span>  <span class="token comment">// 类型</span>
	<span class="token keyword">int</span>  _flag<span class="token punctuation">;</span>     <span class="token comment">// 标识</span>
	QString _url<span class="token punctuation">;</span>   <span class="token comment">// 接口Url</span>
	QString _method<span class="token punctuation">;</span>  <span class="token comment">// 请求方式</span>
	QByteArray _byte<span class="token punctuation">;</span> <span class="token comment">// 参数</span>
<span class="token punctuation">}</span>NetMessage<span class="token punctuation">;</span>

<span class="token comment">// 请求接口</span>
<span class="token comment">/// @brief 发送聊天消息</span>
<span class="token macro property">#<span class="token directive keyword">define</span> API_POST_ASK_ACTION "http://www.xxxx.com/tztv/ask_action.php"</span>

<span class="token comment">// 请求类型标识</span>
<span class="token comment">/// @brief 消息类型(用来在发送和接收网络请求时，区分是哪种消息类型)</span>
<span class="token keyword">namespace</span> RequestType <span class="token punctuation">{<!-- --></span>
<span class="token macro property">#<span class="token directive keyword">define</span> REQUEST_TYPE_ASK_ACTION "ask_action" </span><span class="token comment">// 直播间发送文本消息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<h6><a id="2_UI_67"></a>2 UI模块</h6> 
<pre><code class="prism language-cpp"><span class="token comment">// 头文件</span>
<span class="token comment">/*********************************************************************
*@file       UIMainWnd.h
*@brief      交互界面
*@author      
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">UIMainWnd</span> <span class="token operator">:</span> <span class="token keyword">public</span> QWidget
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">UIMainWnd</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> Q_NULLPTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">UIMainWnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> Q_SLOTS<span class="token operator">:</span>
	<span class="token comment">// 文本消息（网络请求返回处理）</span>
    <span class="token keyword">void</span> <span class="token function">on_ask_action</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span> _error_code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">initUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送文本消息（网络请求）</span>
	<span class="token keyword">void</span> <span class="token function">sendText</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span>_text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">// 源文件</span>
UIMainWnd<span class="token operator">::</span><span class="token function">UIMainWnd</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

UIMainWnd<span class="token operator">::</span><span class="token operator">~</span><span class="token function">UIMainWnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> UIMainWnd<span class="token operator">::</span><span class="token function">initUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">connect</span><span class="token punctuation">(</span>BridgeManager<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">businessIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>BusinessLogicManager<span class="token operator">::</span>sigAskAction<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>UIDiscuss<span class="token operator">::</span>on_ask_action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 发送文本消息
*/</span>
<span class="token keyword">void</span> UIMainWnd<span class="token operator">::</span><span class="token function">sendText</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span>_text<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	QByteArray data<span class="token punctuation">;</span>
	data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"channel="</span> <span class="token operator">+</span> DataMgr<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocalUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_user_group<span class="token punctuation">)</span><span class="token punctuation">;</span>

	std<span class="token operator">::</span>string str <span class="token operator">=</span> Utils<span class="token operator">::</span><span class="token function">_urlencode</span><span class="token punctuation">(</span>_text<span class="token punctuation">.</span><span class="token function">toStdString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QString msg_param <span class="token operator">=</span> QString<span class="token operator">::</span><span class="token function">fromStdString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

	data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&amp;message="</span> <span class="token operator">+</span> msg_param<span class="token punctuation">)</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&amp;client_type=client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	NetMessage msg<span class="token punctuation">;</span>
	msg<span class="token punctuation">.</span>_type <span class="token operator">=</span> REQUEST_TYPE_ASK_ACTION<span class="token punctuation">;</span>
	msg<span class="token punctuation">.</span>_flag <span class="token operator">=</span> rt_ask_action<span class="token punctuation">;</span>
	msg<span class="token punctuation">.</span>_url <span class="token operator">=</span> API_POST_ASK_ACTION<span class="token punctuation">;</span>
	msg<span class="token punctuation">.</span>_method <span class="token operator">=</span> <span class="token string">"post"</span><span class="token punctuation">;</span>
	msg<span class="token punctuation">.</span>_byte <span class="token operator">=</span> data<span class="token punctuation">;</span>

	BridgeManager<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">businessIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">networkRequest</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 文本消息</span>
<span class="token keyword">void</span> UIMainWnd<span class="token operator">::</span><span class="token function">on_ask_action</span><span class="token punctuation">(</span><span class="token keyword">bool</span> bsuccess<span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span>_content<span class="token punctuation">,</span> <span class="token keyword">int</span> _error_code<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理来自业务逻辑层的消息</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bsuccess<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="2__151"></a>2 网络模块</h6> 
<p>分为网络模块和网络管理模块，以及超时处理，cookie处理<br> 1）网络模块和超时处理</p> 
<pre><code class="prism language-cpp"><span class="token comment">/*********************************************************************
*@file       Network.h
*@brief      网络模块封装
*@author      
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QNetworkAccessManager&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QNetworkReply&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Network</span> <span class="token operator">:</span> <span class="token keyword">public</span> QObject
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Network</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">Network</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token function">_get</span><span class="token punctuation">(</span><span class="token keyword">const</span> QUrl<span class="token operator">&amp;</span> _url<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">_post</span><span class="token punctuation">(</span><span class="token keyword">const</span> QUrl<span class="token operator">&amp;</span> _url<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span> _bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">_setType</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置该请求的类型RequestType</span>
	<span class="token keyword">void</span> <span class="token function">_setCookieJar</span><span class="token punctuation">(</span>QNetworkCookieJar <span class="token operator">*</span>cookieJar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置cookie</span>

Q_SIGNALS<span class="token operator">:</span>
	<span class="token comment">// 网络模块-&gt;通知网络管理层</span>
    <span class="token comment">/// 网络请求返回数据</span>
	<span class="token keyword">void</span> <span class="token function">sigReply</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type_net<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray <span class="token operator">&amp;</span>_byte_array<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/// 网络请求失败</span>
	<span class="token keyword">void</span> <span class="token function">sigReplyError</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type_net<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>_error_code<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_error_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/// 网络请求超时</span>
	<span class="token keyword">void</span> <span class="token function">sigTimeout</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type_net<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> Q_SLOTS<span class="token operator">:</span>
    <span class="token comment">// 对于网络请求返回的处理一般有三种情况：返回成功，返回失败，请求超时</span>
    <span class="token keyword">void</span> <span class="token function">requestFinished</span><span class="token punctuation">(</span>QNetworkReply<span class="token operator">*</span> _reply<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 网络请求返回处理（返回成功、返回失败）</span>
	<span class="token keyword">void</span> <span class="token function">on_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 超时处理</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	QString m_netType <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 配置模块中RequestType</span>
	QNetworkRequest m_httpRequest<span class="token punctuation">;</span>
	QNetworkAccessManager m_networkAccessManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 超时处理</span>
<span class="token keyword">class</span> <span class="token class-name">QReplyTimeout</span> <span class="token operator">:</span> <span class="token keyword">public</span> QObject 
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">QReplyTimeout</span><span class="token punctuation">(</span>QNetworkReply <span class="token operator">*</span>reply<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

signals<span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">sigTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> slots<span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">on_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Network.h"</span></span>

Network<span class="token operator">::</span><span class="token function">Network</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	QMetaObject<span class="token operator">::</span>Connection connRet <span class="token operator">=</span> QObject<span class="token operator">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_networkAccessManager<span class="token punctuation">,</span> <span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">finished</span><span class="token punctuation">(</span>QNetworkReply<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">requestFinished</span><span class="token punctuation">(</span>QNetworkReply<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>connRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Network<span class="token operator">::</span><span class="token operator">~</span><span class="token function">Network</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m_networkAccessManager<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">_setType</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m_netType <span class="token operator">=</span> _type<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">_setCookieJar</span><span class="token punctuation">(</span>QNetworkCookieJar <span class="token operator">*</span>cookieJar<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m_networkAccessManager<span class="token punctuation">.</span><span class="token function">setCookieJar</span><span class="token punctuation">(</span>cookieJar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">_get</span><span class="token punctuation">(</span><span class="token keyword">const</span> QUrl<span class="token operator">&amp;</span> _url<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m_httpRequest<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>_url<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QNetworkReply <span class="token operator">*</span>_reply <span class="token operator">=</span> m_networkAccessManager<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>m_httpRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 请求超时</span>
	QReplyTimeout <span class="token operator">*</span>pTimeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QReplyTimeout</span><span class="token punctuation">(</span>_reply<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>pTimeout<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QReplyTimeout<span class="token operator">::</span>sigTimeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Network<span class="token operator">::</span>on_timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">_post</span><span class="token punctuation">(</span><span class="token keyword">const</span> QUrl<span class="token operator">&amp;</span> _url<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span> _bytes<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	QNetworkRequest _request<span class="token punctuation">;</span>
	_request<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>_url<span class="token punctuation">)</span><span class="token punctuation">;</span>

	QNetworkReply <span class="token operator">*</span>_reply <span class="token operator">=</span> m_networkAccessManager<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>_request<span class="token punctuation">,</span> _bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 请求超时</span>
	QReplyTimeout <span class="token operator">*</span>pTimeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QReplyTimeout</span><span class="token punctuation">(</span>_reply<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>pTimeout<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QReplyTimeout<span class="token operator">::</span>sigTimeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Network<span class="token operator">::</span>on_timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">requestFinished</span><span class="token punctuation">(</span>QNetworkReply<span class="token operator">*</span> _reply<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> QNetworkReply<span class="token operator">::</span>NoError<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token comment">// request success</span>
		QByteArray _byteArray <span class="token operator">=</span> _reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里是日志，方便在日志文件中查看。关于日志生成的看后续文章</span>
		QString _str_error <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1 : request_reply_source_data = %2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span>_byteArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LINFO</span><span class="token punctuation">(</span>L<span class="token string">"%s"</span><span class="token punctuation">,</span> _str_error<span class="token punctuation">.</span><span class="token function">toStdWString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		emit <span class="token function">sigReply</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">,</span> _byteArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span><span class="token comment">// request fail</span>
		<span class="token keyword">int</span> _error_code <span class="token operator">=</span> _reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		QString _log_error <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1 : request_reply_network_error_code = %2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>_error_code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LINFO</span><span class="token punctuation">(</span>L<span class="token string">"%s"</span><span class="token punctuation">,</span> _log_error<span class="token punctuation">.</span><span class="token function">toStdWString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		QString _error_str <span class="token operator">=</span> _reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">errorString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigReplyError</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">,</span> _error_code<span class="token punctuation">,</span> _error_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	_reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">deleteLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Network<span class="token operator">::</span><span class="token function">on_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token comment">// request timeout</span>
	QNetworkReply<span class="token operator">*</span> _reply <span class="token operator">=</span> <span class="token punctuation">(</span>QNetworkReply<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _error_code <span class="token operator">=</span> _reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	QString _log_error <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1 : request_reply_timeout = %2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>_error_code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LINFO</span><span class="token punctuation">(</span>L<span class="token string">"%s"</span><span class="token punctuation">,</span> _log_error<span class="token punctuation">.</span><span class="token function">toStdWString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	emit <span class="token function">sigTimeout</span><span class="token punctuation">(</span>m_netType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QReplyTimeout<span class="token operator">::</span><span class="token function">QReplyTimeout</span><span class="token punctuation">(</span>QNetworkReply <span class="token operator">*</span>reply<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>reply <span class="token operator">&amp;&amp;</span> reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 启动单次定时器</span>
		QTimer<span class="token operator">::</span><span class="token function">singleShot</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">on_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> QReplyTimeout<span class="token operator">::</span><span class="token function">on_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  <span class="token comment">// 处理超时</span>
	QNetworkReply <span class="token operator">*</span>reply <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>QNetworkReply<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		reply<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">deleteLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		emit <span class="token function">sigTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2）网络管理模块</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token comment">/*********************************************************************
*@file       NetWorkManager.h
*@brief      网络管理层(接收来自业务层请求，把请求结果返回业务层，通过中间层关联)
*@author   
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">NetworkManager</span> <span class="token operator">:</span> <span class="token keyword">public</span> QObject
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">NetworkManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">NetworkManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Q_SIGNALS<span class="token operator">:</span>
	<span class="token comment">/// @网络层-&gt;业务层（网络层通知业务层）</span>
	<span class="token keyword">void</span> <span class="token function">sigReply</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span> _byte_array<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">sigReplyError</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type_net<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>_error_code<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_error_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">sigTimeout</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type_net<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> Q_SLOTS<span class="token operator">:</span>
	<span class="token comment">/// @来自业务层的请求</span>
	<span class="token keyword">void</span> <span class="token function">on_net_request_activated</span><span class="token punctuation">(</span>NetMessage <span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"NetworkManager.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Network.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"NetworkCookie.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QNetworkConfiguration&gt;</span></span>

NetworkManager<span class="token operator">::</span><span class="token function">NetworkManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//gu_networkManager-&gt;activeConfiguration();</span>
<span class="token punctuation">}</span>

NetworkManager<span class="token operator">::</span><span class="token operator">~</span><span class="token function">NetworkManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> NetworkManager<span class="token operator">::</span><span class="token function">on_net_request_activated</span><span class="token punctuation">(</span>NetMessage <span class="token operator">&amp;</span>_msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Network <span class="token operator">*</span>_network <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Network</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 通知业务层</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>_network<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Network<span class="token operator">::</span>sigReply<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type_net<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray <span class="token operator">&amp;</span>_byte_array<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		emit <span class="token function">sigReply</span><span class="token punctuation">(</span>_type_net<span class="token punctuation">,</span> _byte_array<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>_network<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Network<span class="token operator">::</span>sigReplyError<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type_net<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>_error_code<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_error_string<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		emit <span class="token function">sigReplyError</span><span class="token punctuation">(</span>_type_net<span class="token punctuation">,</span>  _error_code<span class="token punctuation">,</span> _error_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>_network<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Network<span class="token operator">::</span>sigTimeout<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> _type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		emit <span class="token function">sigTimeout</span><span class="token punctuation">(</span>_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	_network<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">_setType</span><span class="token punctuation">(</span>_msg<span class="token punctuation">.</span>_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_network<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">_setCookieJar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NetworkCookie<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 请求方式</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_msg<span class="token punctuation">.</span>_method <span class="token operator">==</span> <span class="token string">"post"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_network<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">_post</span><span class="token punctuation">(</span>_msg<span class="token punctuation">.</span>_url<span class="token punctuation">,</span> _msg<span class="token punctuation">.</span>_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_msg<span class="token punctuation">.</span>_method <span class="token operator">==</span> <span class="token string">"get"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_network<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">_get</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span>_msg<span class="token punctuation">.</span>_url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3）cookie处理</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token comment">/*********************************************************************
*@file        NetworkCookie.h
*@brief      cookie
*@author   
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork/QNetworkCookie&gt;</span>  </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork/QNetworkCookieJar&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">NetworkCookie</span> <span class="token operator">:</span> <span class="token keyword">public</span> QNetworkCookieJar
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> NetworkCookie<span class="token operator">&amp;</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	QList<span class="token operator">&lt;</span>QNetworkCookie<span class="token operator">&gt;</span> <span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setCookies</span><span class="token punctuation">(</span><span class="token keyword">const</span> QList<span class="token operator">&lt;</span>QNetworkCookie<span class="token operator">&gt;</span><span class="token operator">&amp;</span> cookieList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token function">NetworkCookie</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">NetworkCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"NetworkCookie.h"</span></span>

NetworkCookie<span class="token operator">::</span><span class="token function">NetworkCookie</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QNetworkCookieJar</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

NetworkCookie<span class="token operator">::</span><span class="token operator">~</span><span class="token function">NetworkCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

NetworkCookie<span class="token operator">&amp;</span> NetworkCookie<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> NetworkCookie <span class="token function">_uniqueInstance</span><span class="token punctuation">(</span>Q_NULLPTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> _uniqueInstance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QList<span class="token operator">&lt;</span>QNetworkCookie<span class="token operator">&gt;</span> NetworkCookie<span class="token operator">::</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">allCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> NetworkCookie<span class="token operator">::</span><span class="token function">setCookies</span><span class="token punctuation">(</span><span class="token keyword">const</span> QList<span class="token operator">&lt;</span>QNetworkCookie<span class="token operator">&gt;</span><span class="token operator">&amp;</span> cookieList<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setAllCookies</span><span class="token punctuation">(</span>cookieList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3__455"></a>3 业务逻辑模块</h6> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token comment">/*********************************************************************
*@file       BusinessLogicManager.h
*@brief      业务逻辑层
*@author   
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;map&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;functional&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">BusinessLogicManager</span> <span class="token operator">:</span> <span class="token keyword">public</span> QObject
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">BusinessLogicManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">BusinessLogicManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token function">networkRequest</span><span class="token punctuation">(</span>NetMessage<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Q_SIGNALS<span class="token operator">:</span>
	<span class="token comment">/// @ 业务层-&gt;网络层（UI层通过业务层发送网络请求）</span>
	<span class="token keyword">void</span> <span class="token function">sigNetworkRequest</span><span class="token punctuation">(</span>NetMessage<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> Q_SLOTS<span class="token operator">:</span>
    <span class="token comment">// 网络请求返回成功消息通知</span>
	<span class="token keyword">void</span> <span class="token function">on_comming_msg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 网络请求返回失败消息通知</span>
	<span class="token keyword">void</span> <span class="token function">on_comming_error</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>_error_code<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_error_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 网络请求超时消息通知</span>
	<span class="token keyword">void</span> <span class="token function">on_comming_timeout</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">)</span><span class="token punctuation">;</span>

Q_SIGNALS<span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span><span class="token punctuation">,</span>  <span class="token keyword">int</span> _error_code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">/// @发送文本消息</span>
    <span class="token keyword">void</span> <span class="token function">onAskAction</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span> _byte_array<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"BusinessLogicManager.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"NetWorkLayer\NetworkCookie.h"</span></span>
BusinessLogicManager<span class="token operator">::</span><span class="token function">BusinessLogicManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	
<span class="token punctuation">}</span>

BusinessLogicManager<span class="token operator">::</span><span class="token operator">~</span><span class="token function">BusinessLogicManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> BusinessLogicManager<span class="token operator">::</span><span class="token function">networkRequest</span><span class="token punctuation">(</span>NetMessage<span class="token operator">&amp;</span>_msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	emit <span class="token function">sigNetRequest</span><span class="token punctuation">(</span>_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 【这里如果请求过多 会出现打来你给ifelse，后续会出关于优化ifelse文章】</span>
<span class="token keyword">void</span> BusinessLogicManager<span class="token operator">::</span><span class="token function">on_comming_msg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span>_byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">==</span> NET_TYPE_ASK_ACTION<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token comment">// 网络请求成功</span>
		<span class="token function">onAskAction</span><span class="token punctuation">(</span>_type<span class="token punctuation">,</span> _byte_array<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> BusinessLogicManager<span class="token operator">::</span><span class="token function">on_comming_error</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>_error_code<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_error_string<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">==</span> NET_TYPE_ASK_ACTION<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token comment">// 网络请求错误通知</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"网络请求错误通知"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> BusinessLogicManager<span class="token operator">::</span><span class="token function">on_comming_timeout</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">==</span> NET_TYPE_ASK_ACTION<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token comment">// 超时处理</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"超时处理"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 发送文本消息
*/</span>
<span class="token keyword">void</span> BusinessLogicManager<span class="token operator">::</span><span class="token function">onAskAction</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>_type<span class="token punctuation">,</span> <span class="token keyword">const</span> QByteArray<span class="token operator">&amp;</span> _byte_array<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 这里是对网络请求返回的数据进行处理，然后通知UI模块</span>
	std<span class="token operator">::</span>string _f <span class="token operator">=</span> Jsonc<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJsonValueStringByKey</span><span class="token punctuation">(</span>Utils<span class="token operator">::</span><span class="token function">byteArray2string</span><span class="token punctuation">(</span>_byte_array<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QString f <span class="token operator">=</span> QString<span class="token operator">::</span><span class="token function">fromStdString</span><span class="token punctuation">(</span>_f<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QString _context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"回复成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"回复成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		 _context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"未登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigReLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"3"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"字数大于80"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"字数大于80"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"4"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		 _context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"内容为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"内容为空"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"5"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"3秒后再发言"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"3秒后再发言"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"6"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"您已被禁言"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"您已被禁言"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token string">"7"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		 _context <span class="token operator">=</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"未绑定手机号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emit <span class="token function">sigAskAction</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">"未绑定手机号"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="4__588"></a>4 中间层</h6> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>
<span class="token comment">/*********************************************************************
*@file        BridgeManager.h
*@brief      中间控制层（UI、业务逻辑、网络）
*@author  
*@date       
*********************************************************************/</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"NetWorkLayer\NetworkManager.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"BusinessLogicLayer\BusinessLogicManager.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">BridgeManager</span> <span class="token operator">:</span> <span class="token keyword">public</span> QObject
<span class="token punctuation">{<!-- --></span>
	Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> BridgeManager<span class="token operator">&amp;</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 得到网络层 和 业务逻辑层 实例</span>
	BusinessLogicManager<span class="token operator">*</span> <span class="token function">businessIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
	NetworkManager<span class="token operator">*</span> <span class="token function">networkIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token function">BridgeManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">BridgeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	NetworkManager <span class="token operator">*</span>m_networkManager <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	BusinessLogicManager <span class="token operator">*</span>m_businessLogicManager <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"BridgeManager.h"</span></span>

BridgeManager<span class="token operator">::</span><span class="token function">BridgeManager</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m_businessLogicManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">BusinessLogicManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_networkManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">NetworkManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里的实例化得注意了(this 会导致NetWork崩溃)</span>

	<span class="token comment">// 业务层-&gt;网络层</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>m_businessLogicManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>BusinessLogicManager<span class="token operator">::</span>sigNetworkRequest<span class="token punctuation">,</span> m_networkManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NetworkManager<span class="token operator">::</span>on_net_request_activated<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 网络层-&gt;业务层</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>m_networkManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NetworkManager<span class="token operator">::</span>sigReply<span class="token punctuation">,</span> m_businessLogicManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>BusinessLogicManager<span class="token operator">::</span>on_comming_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>m_networkManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NetworkManager<span class="token operator">::</span>sigReplyError<span class="token punctuation">,</span> m_businessLogicManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>BusinessLogicManager<span class="token operator">::</span>on_comming_error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>m_networkManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NetworkManager<span class="token operator">::</span>sigTimeout<span class="token punctuation">,</span> m_businessLogicManager<span class="token punctuation">,</span> <span class="token operator">&amp;</span>BusinessLogicManager<span class="token operator">::</span>on_comming_timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BridgeManager<span class="token operator">::</span><span class="token operator">~</span><span class="token function">BridgeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

BridgeManager<span class="token operator">&amp;</span> BridgeManager<span class="token operator">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> BridgeManager <span class="token function">_uniqueInstance</span><span class="token punctuation">(</span>Q_NULLPTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> _uniqueInstance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BusinessLogicManager<span class="token operator">*</span> BridgeManager<span class="token operator">::</span><span class="token function">businessIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> m_businessLogicManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

NetworkManager<span class="token operator">*</span> BridgeManager<span class="token operator">::</span><span class="token function">networkIns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> m_networkManager<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a32b65e16d41a9601d815a7121db7502/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">7-5 jmu-Java-01入门-取数字浮点数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fd0f3668b5d022027031a93542431147/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iframe子页面调用父页面的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>