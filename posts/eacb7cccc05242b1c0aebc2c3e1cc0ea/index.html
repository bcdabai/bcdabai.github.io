<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FPGA设计时序约束十五、Set_Bus_Skew - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FPGA设计时序约束十五、Set_Bus_Skew" />
<meta property="og:description" content="目录
一、序言
二、Set Bus Skew
2.1 基本概念
2.2 设置界面
2.3 命令语法
2.4 报告分析
三、工程示例
3.1 工程代码
3.2 时序报告
四、参考资料
一、序言 在时序约束中，对时钟的约束除了set clock latency,set clock uncertainty,set input jitter外，还有一条set bus skew的约束命令。该命令主要用于跨时钟域的场景中，下面将对set bus skew的使用进行详细的介绍。
二、Set Bus Skew 2.1 基本概念 Set Bus Skew用于在多个跨时钟域路径中设置一个最大的偏斜要求，可以限制用于发送数据的源时钟沿的数目以及被目的时钟沿捕获。和普通路径上的时钟偏斜不同，bus skew对应的是约束下所有路径中最大的捕获时钟偏斜值，该值同时应用到fast corner和slow corner。
Bus skew约束通常用于以下几种跨时钟域的拓扑结构中：
a) 格雷码总线切换中，例如异步FIFOs
b)带有CE，MUX或MUX hold的多比特跨时钟域电路中
c) 配置寄存器的跨时钟域
尽管set_bus_skew命令可以设置一个总线偏斜约束到同步跨时钟域中，但这种做法是多余的，因为setup和hold检查已经可以确保在两个时序安全的同步跨时钟域路径间安全切换。
总线偏斜约束不属于时序例外，和set_data_check一样，它属于时序断言。因此，总线偏斜约束不会被时序例外约束，如set_clock_group,set_false_path,set_max_delay,set_multicycle_path约束影响，仅可能会被route_design优化掉。
约束设置时建议将总线偏斜约束到没有扇出fanout的路径上，并且，每个总线偏斜约束必须覆盖最少两个起点和两个终点。
2.2 设置界面 进入Timing Constraints界面，在左侧Assertions栏中选中Set Bus Skew，右侧即显示Set Bus Skew
设置界面中Specify bus skew设置总线信号上最快的信号和最慢的信号间的偏斜，start points和end points分别设置起点和终点，Through points设置中间路径，也可不设。同时，也可指定只分析rise、fall或都分析
约束from/to的对象，只能为Cells或cell pins或clocks" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/eacb7cccc05242b1c0aebc2c3e1cc0ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T21:38:53+08:00" />
<meta property="article:modified_time" content="2024-01-04T21:38:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FPGA设计时序约束十五、Set_Bus_Skew</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc" style="text-align:center;"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%BA%8F%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%BA%8F%E8%A8%80" rel="nofollow">一、序言</a></p> 
<p id="%E4%BA%8C%E3%80%81Set%20Bus%C2%A0Skew-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81Set%20Bus%C2%A0Skew" rel="nofollow">二、Set Bus Skew</a></p> 
<p id="2.1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-toc" style="margin-left:40px;"><a href="#2.1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" rel="nofollow">2.1 基本概念</a></p> 
<p id="2.2%C2%A0%E8%AE%BE%E7%BD%AE%E7%95%8C%E9%9D%A2-toc" style="margin-left:40px;"><a href="#2.2%C2%A0%E8%AE%BE%E7%BD%AE%E7%95%8C%E9%9D%A2" rel="nofollow">2.2 设置界面</a></p> 
<p id="2.3%C2%A0%E5%91%BD%E4%BB%A4%E8%AF%AD%E6%B3%95-toc" style="margin-left:40px;"><a href="#2.3%C2%A0%E5%91%BD%E4%BB%A4%E8%AF%AD%E6%B3%95" rel="nofollow">2.3 命令语法</a></p> 
<p id="2.4%20%E6%8A%A5%E5%91%8A%E5%88%86%E6%9E%90-toc" style="margin-left:40px;"><a href="#2.4%20%E6%8A%A5%E5%91%8A%E5%88%86%E6%9E%90" rel="nofollow">2.4 报告分析</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%B7%A5%E7%A8%8B%E7%A4%BA%E4%BE%8B-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%B7%A5%E7%A8%8B%E7%A4%BA%E4%BE%8B" rel="nofollow">三、工程示例</a></p> 
<p id="3.1%20%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#3.1%20%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81" rel="nofollow">3.1 工程代码</a></p> 
<p id="3.2%C2%A0%E6%97%B6%E5%BA%8F%E6%8A%A5%E5%91%8A-toc" style="margin-left:40px;"><a href="#3.2%C2%A0%E6%97%B6%E5%BA%8F%E6%8A%A5%E5%91%8A" rel="nofollow">3.2 时序报告</a></p> 
<p id="%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">四、参考资料</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%BA%8F%E8%A8%80">一、序言</h2> 
<p>    在时序约束中，对时钟的约束除了set clock latency,set clock uncertainty,set input jitter外，还有一条set bus skew的约束命令。该命令主要用于跨时钟域的场景中，下面将对set bus skew的使用进行详细的介绍。</p> 
<h2 id="%E4%BA%8C%E3%80%81Set%20Bus%C2%A0Skew">二、Set Bus Skew</h2> 
<h3 id="2.1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><strong>2.1 基本概念</strong></h3> 
<p>   Set Bus Skew用于在多个跨时钟域路径中设置一个最大的偏斜要求，可以限制用于发送数据的源时钟沿的数目以及被目的时钟沿捕获。和普通路径上的时钟偏斜不同，bus skew对应的是约束下所有路径中最大的捕获时钟偏斜值，该值同时应用到fast corner和slow corner。</p> 
<p>    Bus skew约束通常用于以下几种跨时钟域的拓扑结构中：</p> 
<p>    a) 格雷码总线切换中，例如异步FIFOs</p> 
<p>    b)带有CE，MUX或MUX hold的多比特跨时钟域电路中</p> 
<p>    c) 配置寄存器的跨时钟域</p> 
<p> 尽管set_bus_skew命令可以设置一个总线偏斜约束到同步跨时钟域中，但这种做法是多余的，因为setup和hold检查已经可以确保在两个时序安全的同步跨时钟域路径间安全切换。</p> 
<p>    总线偏斜约束不属于时序例外，和set_data_check一样，它属于时序断言。因此，总线偏斜约束不会被时序例外约束，如set_clock_group,set_false_path,set_max_delay,set_multicycle_path约束影响，仅可能会被route_design优化掉。</p> 
<p>    <strong>约束设置时建议将总线偏斜约束到没有扇出fanout的路径上，并且，每个总线偏斜约束必须覆盖最少两个起点和两个终点。</strong></p> 
<h3 id="2.2%C2%A0%E8%AE%BE%E7%BD%AE%E7%95%8C%E9%9D%A2"><strong>2.2 设置界面</strong></h3> 
<p>进入Timing Constraints界面，在左侧Assertions栏中选中Set Bus Skew，右侧即显示Set Bus Skew</p> 
<p></p> 
<p class="img-center"><img alt="" height="194" src="https://images2.imgbox.com/20/f3/cqKi27R5_o.png" width="1200"></p> 
<p>  </p> 
<p>设置界面中Specify bus skew设置总线信号上最快的信号和最慢的信号间的偏斜，start points和end points分别设置起点和终点，Through points设置中间路径，也可不设。同时，也可指定只分析rise、fall或都分析</p> 
<p></p> 
<p class="img-center"><img alt="" height="588" src="https://images2.imgbox.com/79/5d/Ex0uLwJQ_o.png" width="730"></p> 
<p>  </p> 
<p>约束from/to的对象，只能为Cells或cell pins或clocks</p> 
<p></p> 
<p class="img-center"><img alt="" height="362" src="https://images2.imgbox.com/af/42/4dKzjtkn_o.png" width="875"></p> 
<p>  </p> 
<p>through的对象则只能为Cells,Nets或Cell Pins</p> 
<p></p> 
<p class="img-center"><img alt="" height="328" src="https://images2.imgbox.com/a0/f9/Go17vIm0_o.png" width="882"></p> 
<h3 id="2.3%C2%A0%E5%91%BD%E4%BB%A4%E8%AF%AD%E6%B3%95"><strong>2.3 命令语法</strong></h3> 
<p>命令格式</p> 
<pre><code>set_bus_skew [-from &lt;args&gt;] [-to &lt;args&gt;] [-through &lt;args&gt;] &lt;value&gt;</code></pre> 
<p></p> 
<p></p> 
<p class="img-center"><img alt="" height="121" src="https://images2.imgbox.com/8c/65/qyHWbLrR_o.png" width="514"></p> 
<p>  </p> 
<h3 id="2.4%20%E6%8A%A5%E5%91%8A%E5%88%86%E6%9E%90"><strong>2.4 报告分析</strong></h3> 
<p>    set_bus_skew的分析报告和普通时序报告结果查看有些不一致。可以通过tcl console使用命令或界面运行Report Bus Skew，进入Reports → Timing → Report Bus Skew</p> 
<p></p> 
<p class="img-center"><img alt="" height="477" src="https://images2.imgbox.com/c9/6a/Q8v0pW2r_o.png" width="794"></p> 
<p>  </p> 
<p>对报告进行显示设置</p> 
<p></p> 
<p class="img-center"><img alt="" height="729" src="https://images2.imgbox.com/08/86/aoZhkCX2_o.png" width="615"></p> 
<p>  </p> 
<p>也命令执行report_bus_skew -delay_type max -max_paths 10 -name bus_skew_2，bus_skew_2为报告名</p> 
<p></p> 
<p class="img-center"><img alt="" height="205" src="https://images2.imgbox.com/99/ca/YB5I7Izi_o.png" width="783"></p> 
<p>  </p> 
<h2 id="%E4%B8%89%E3%80%81%E5%B7%A5%E7%A8%8B%E7%A4%BA%E4%BE%8B">三、工程示例</h2> 
<h3 id="3.1%20%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81"><strong>3.1 工程代码</strong></h3> 
<p>设计中跨时钟域是握手机制的一部分，当数据被采样时源时钟发送数据。目的时钟域用了一个4阶同步器来同步发送信号。在4阶同步器之后，信号驱动跨时钟域寄存器的时钟使能端口CE.在这种场景下，必须设置总线偏斜来调整包含CE端口路径上的阶段数，因为它代表了数据有效时目的时钟周期的数目。</p> 
<pre><code>module set_bus_skew(src_clk,dest_clk,rst,ce,d,in,out);
input src_clk,dest_clk,rst,ce;
input  d;
input [1:0] in;
output reg [1:0] out;
reg [3:0] syn_reg;
reg src_send;
reg [1:0] src_data;
always@(posedge src_clk)
    begin
    if(!rst)
        src_send&lt;=0;
    else 
        src_send&lt;=d;
    end

always@(posedge dest_clk)
    if(!rst)
        begin
            syn_reg[0]&lt;=0;
            syn_reg[1]&lt;=0;  
            syn_reg[2]&lt;=0;  
            syn_reg[3]&lt;=0;      
        end
    else
        begin
            syn_reg[0]&lt;=src_send;
            syn_reg[1]&lt;=syn_reg[0];  
            syn_reg[2]&lt;=syn_reg[1];  
            syn_reg[3]&lt;=syn_reg[2];                
        end
assign des_infer=~syn_reg[3];
always@(posedge src_clk)
    if(!rst)
        begin
        src_data[0]&lt;=0;
        src_data[1]&lt;=0;
        end
    else 
        begin
        src_data[0]&lt;=in[0];
        src_data[1]&lt;=in[1];            
        end

always@(posedge dest_clk)
    if(!ce)
        begin
        out[0]&lt;=0;
        out[1]&lt;=0;
        end
    else
        if(des_infer) 
            begin
            out[0]&lt;=src_data[0];
            out[1]&lt;=src_data[1];           
            end

endmodule</code></pre> 
<p>综合网表连接图如下图所示</p> 
<p></p> 
<p class="img-center"><img alt="" height="636" src="https://images2.imgbox.com/dd/5d/2dOiDTwq_o.png" width="1200"></p> 
<p>  </p> 
<p></p> 
<p>约束文件，源时钟周期为5ns,目的时钟周期为2.5ns，set_bus_skew对两个起点src_data_reg[0]/src_data_reg[1]和两个终点out_reg[0]/out_reg[1]设置总线偏斜约束</p> 
<pre><code>create_clock -period 5.000 -name src_clk -waveform {0.000 2.500} [get_ports src_clk]
create_clock -period 2.500 -name dest_clk -waveform {0.000 1.250} [get_ports dest_clk]
set_max_delay -from [get_cells src_send_reg] -through [get_cells {<!-- -->{out_reg[0]} {out_reg[1]}}] 10.000
set_bus_skew -from [get_cells {<!-- -->{src_data_reg[0]} {src_data_reg[1]}}] -to [get_cells {<!-- -->{out_reg[0]} {out_reg[1]}}] 0.100</code></pre> 
<h3 id="3.2%C2%A0%E6%97%B6%E5%BA%8F%E6%8A%A5%E5%91%8A"><strong>3.2 时序报告</strong></h3> 
<p>    先对总线偏斜设置为0ns，此时路径时序违例</p> 
<p></p> 
<p class="img-center"><img alt="" height="676" src="https://images2.imgbox.com/5a/e1/pgKdpoMk_o.png" width="1118"></p> 
<p>  </p> 
<p>    将总线偏斜约束设置为0.5ns，违例消失，设置的0.5ns补偿违例的0.492ns，因此，结果为0.008ns</p> 
<p></p> 
<p class="img-center"><img alt="" height="606" src="https://images2.imgbox.com/71/dd/iaMSgOjz_o.png" width="1073"></p> 
<p>  </p> 
<h2 id="%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">四、参考资料</h2> 
<p>用户手册：ug903-vivado-using-constraints-en-us-2022.2.pdf</p> 
<p>链接：https://pan.baidu.com/s/17AK_-J4wRXiFLtLTorlrwg?pwd=mylt </p> 
<p>提取码：mylt   </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a63b9d15467f9a4c74fc5b183f89f13/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">es索引数据过滤查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/769f3986182b25b40ab47b838c246032/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Clickhouse 为什么快</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>