<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Python去除C/C&#43;&#43;源程序中的所有注释和空行 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Python去除C/C&#43;&#43;源程序中的所有注释和空行" />
<meta property="og:description" content="转载https://www.cnblogs.com/feisky/archive/2010/12/09/1901349.html
说明 使用Python的字符串处理和正则表达式处理实现了一个删除C/C&#43;&#43;源程序中所有注释和空行的小脚本。
使用字符串处理 1: # delete all the comments and empty line of a C/C&#43;&#43; source file 2: import os, sys,string 3: 4: #------------------------------------------------------------- 5: def usage(): 6: print u&#39;&#39;&#39; 7: help: del_comment.py &lt;filename | dirname&gt; 8: &#39;&#39;&#39; 9: #-------------------------------------------------------------- 10: def deal_file(src): 11: # file exist or not 12: if not os.path.exists(src): 13: print &#39;Error: file - %s doesn\&#39;t exist.&#39;% src 14: return False 15: if os.path.islink(src): 16: print &#39;Error: file - %s is a link." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0712b380fd5ac9756cef04dbcb4c548d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-17T17:50:05+08:00" />
<meta property="article:modified_time" content="2019-06-17T17:50:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Python去除C/C&#43;&#43;源程序中的所有注释和空行</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://www.cnblogs.com/feisky/archive/2010/12/09/1901349.html" rel="nofollow">转载https://www.cnblogs.com/feisky/archive/2010/12/09/1901349.html</a></p> 
<h2>说明</h2> 
<p>使用Python的字符串处理和正则表达式处理实现了一个删除C/C++源程序中所有注释和空行的小脚本。</p> 
<h2>使用字符串处理</h2> 
<pre>   1: # delete all the comments and empty line of a C/C++ source file</pre> 
<pre>   2: import os, sys,string</pre> 
<pre>   3:  </pre> 
<pre>   4: #-------------------------------------------------------------</pre> 
<pre>   5: def usage():</pre> 
<pre>   6:     print u'''</pre> 
<pre>   7:     help: del_comment.py &lt;filename | dirname&gt;</pre> 
<pre>   8:     '''</pre> 
<pre>   9: #--------------------------------------------------------------</pre> 
<pre>  10: def deal_file(src):</pre> 
<pre>  11:     # file exist or not</pre> 
<pre>  12:     if not os.path.exists(src):</pre> 
<pre>  13:         print 'Error: file - %s doesn\'t exist.'% src</pre> 
<pre>  14:         return False</pre> 
<pre>  15:     if os.path.islink(src):</pre> 
<pre>  16:         print 'Error: file - %s is a link.'</pre> 
<pre>  17:         return False</pre> 
<pre>  18:     filetype = (os.path.splitext(src))[1]</pre> 
<pre>  19:     if not filetype in ['.c','.h','.cpp','.hh','.cc']:</pre> 
<pre>  20:         return False</pre> 
<pre>  21:     try:</pre> 
<pre>  22:         if not os.access(src, os.W_OK):</pre> 
<pre>  23:             os.chmod(src, 0664)</pre> 
<pre>  24:     except:</pre> 
<pre>  25:         print 'Error: you can not chang %s\'s mode.'% src</pre> 
<pre>  26:  </pre> 
<pre>  27:     inputf = open(src, 'r')</pre> 
<pre>  28:     outputfilename = (os.path.splitext(src))[0] + '_no_comment'+filetype</pre> 
<pre>  29:     outputf = open(outputfilename, 'w')    </pre> 
<pre>  30:  </pre> 
<pre>  31:     try:</pre> 
<pre>  32:         #-----find /*.....*/</pre> 
<pre>  33:         rFlag=0</pre> 
<pre>  34:         line=inputf.readline()</pre> 
<pre>  35:         while(line):</pre> 
<pre>  36:             fm=string.find(line,'/*')</pre> 
<pre>  37:             if fm!=-1:  # find a /*</pre> 
<pre>  38:                 if fm&gt;1:# not empty line</pre> 
<pre>  39:                     outputf.write(line[:fm]+'\n')</pre> 
<pre>  40:                 rFlag=1</pre> 
<pre>  41:                 # find */</pre> 
<pre>  42:                 fm=string.find(line,'*/')</pre> 
<pre>  43:                 if fm!=-1:</pre> 
<pre>  44:                     rFlag=0</pre> 
<pre>  45:                 else:</pre> 
<pre>  46:                     line=inputf.readline()</pre> 
<pre>  47:                     while line:</pre> 
<pre>  48:                         fm=string.find(line,'*/')</pre> 
<pre>  49:                         if fm!=-1:</pre> 
<pre>  50:                             rFlag=0</pre> 
<pre>  51:                             break</pre> 
<pre>  52:                         line=inputf.readline()</pre> 
<pre>  53:                     if not line:</pre> 
<pre>  54:                         print 'Match /*...*/ error'</pre> 
<pre>  55:             else: # deal with //</pre> 
<pre>  56:                 fm=string.find(line,'//')</pre> 
<pre>  57:                 if fm==-1:</pre> 
<pre>  58:                     if len(line)&gt;1: # not empty line</pre> 
<pre>  59:                         outputf.write(line)</pre> 
<pre>  60:                 elif fm!=-1 and (not rFlag):</pre> 
<pre>  61:                     if fm&gt;1: # not empty line</pre> 
<pre>  62:                         outputf.write(line[:fm]+'\n')</pre> 
<pre>  63:             #read nextline</pre> 
<pre>  64:             line=inputf.readline()</pre> 
<pre>  65:     except:</pre> 
<pre>  66:         print 'Error: unexcept error.'</pre> 
<pre>  67:         inputf.close()</pre> 
<pre>  68:         outputf.close()</pre> 
<pre>  69:     return True</pre> 
<pre>  70:  </pre> 
<pre>  71: #--------------------------------------------------------------</pre> 
<pre>  72: def deal_dir(src):</pre> 
<pre>  73:     #  dir exist or not</pre> 
<pre>  74:     if not os.path.exists(src):</pre> 
<pre>  75:         print 'Error: dir - %s is not exist.'%s (src)</pre> 
<pre>  76:         return False</pre> 
<pre>  77:     filelists = os.listdir(src)</pre> 
<pre>  78:     for eachfile in filelists:</pre> 
<pre>  79:         eachfile = src + '/' +eachfile</pre> 
<pre>  80:         if os.path.isdir(eachfile):</pre> 
<pre>  81:             deal_dir(eachfile)</pre> 
<pre>  82:         elif os.path.isfile(eachfile):</pre> 
<pre>  83:             deal_file(eachfile)</pre> 
<pre>  84:     return True</pre> 
<pre>  85:  </pre> 
<pre>  86: #--------------------------------------------------------------</pre> 
<pre>  87: def main():</pre> 
<pre>  88:     if len(sys.argv) &lt; 2:</pre> 
<pre>  89:         usage()</pre> 
<pre>  90:         sys.exit(1)</pre> 
<pre>  91:     src = sys.argv[1]</pre> 
<pre>  92:     # get absolute dir/file path</pre> 
<pre>  93:     if os.path.isdir(src):</pre> 
<pre>  94:         dire = os.path.abspath(src)</pre> 
<pre>  95:         dirFlag = True</pre> 
<pre>  96:     elif os.path.isfile(src):</pre> 
<pre>  97:         fl = os.path.abspath(src)</pre> 
<pre>  98:         dirFlag = False</pre> 
<pre>  99:     else:</pre> 
<pre> 100:         print 'File input error'</pre> 
<pre> 101:  </pre> 
<pre> 102:     # deal</pre> 
<pre> 103:     if dirFlag:</pre> 
<pre> 104:         deal_dir(dire)</pre> 
<pre> 105:     else:</pre> 
<pre> 106:         deal_file(fl)</pre> 
<pre> 107:     print 'Successful handle file.'</pre> 
<pre> 108:  </pre> 
<pre> 109: #--------------------------------------------------------------</pre> 
<pre> 110: if __name__ == '__main__':</pre> 
<pre> 111:     main()</pre> 
<h2>使用正则表达式</h2> 
<pre>   1: # delete all the comments and empty line of a C/C++ source file</pre> 
<pre>   2: import os, sys,string,re,glob</pre> 
<pre>   3:  </pre> 
<pre>   4: # /*..*/  //...</pre> 
<pre>   5: <span style="color:#f33b45;"><strong>Rule1 = "(\/\*(\s|.)*?\*\/)|(\/\/.*)"</strong></span></pre> 
<pre>   6: c1=re.compile(Rule1)</pre> 
<pre>   7:  </pre> 
<pre>   8: #-------------------------------------------------------------</pre> 
<pre>   9: def usage():</pre> 
<pre>  10:     print u'''</pre> 
<pre>  11:     help: del_comment.py &lt;filename | dirname&gt;</pre> 
<pre>  12:     '''</pre> 
<pre>  13: #--------------------------------------------------------------</pre> 
<pre>  14: def deal_file(src):</pre> 
<pre>  15:     # file exist or not</pre> 
<pre>  16:     if not os.path.exists(src):</pre> 
<pre>  17:         print 'Error: file - %s doesn\'t exist.'% src</pre> 
<pre>  18:         return False</pre> 
<pre>  19:     if os.path.islink(src):</pre> 
<pre>  20:         print 'Error: file - %s is a link.'</pre> 
<pre>  21:         return False</pre> 
<pre>  22:     filetype = (os.path.splitext(src))[1]</pre> 
<pre>  23:     if not filetype in ['.c','.h','.cpp','.hh','.cc']:</pre> 
<pre>  24:         return False</pre> 
<pre>  25:     try:</pre> 
<pre>  26:         if not os.access(src, os.W_OK):</pre> 
<pre>  27:             os.chmod(src, 0664)</pre> 
<pre>  28:     except:</pre> 
<pre>  29:         print 'Error: you can not chang %s\'s mode.'% src</pre> 
<pre>  30:  </pre> 
<pre>  31:     inputf = open(src, 'r')</pre> 
<pre>  32:     outputfilename = (os.path.splitext(src))[0] + '_no_comment'+filetype</pre> 
<pre>  33:     outputf = open(outputfilename, 'w')</pre> 
<pre>  34:  </pre> 
<pre>  35:     lines=inputf.read()</pre> 
<pre>  36:     inputf.close()</pre> 
<pre>  37:     lines=re.sub(Rule1,"",lines)</pre> 
<pre>  38:     outputf.write(lines)    </pre> 
<pre>  39:     outputf.close()</pre> 
<pre>  40:     return True</pre> 
<pre>  41:  </pre> 
<pre>  42: #--------------------------------------------------------------</pre> 
<pre>  43: def deal_dir(src):</pre> 
<pre>  44:     #  dir exist or not</pre> 
<pre>  45:     if not os.path.exists(src):</pre> 
<pre>  46:         print 'Error: dir - %s is not exist.'%s (src)</pre> 
<pre>  47:         return False</pre> 
<pre>  48:     filelists = os.listdir(src)</pre> 
<pre>  49:     for eachfile in filelists:</pre> 
<pre>  50:         eachfile = src + '/' +eachfile</pre> 
<pre>  51:         if os.path.isdir(eachfile):</pre> 
<pre>  52:             deal_dir(eachfile)</pre> 
<pre>  53:         elif os.path.isfile(eachfile):</pre> 
<pre>  54:             deal_file(eachfile)</pre> 
<pre>  55:     return True</pre> 
<pre>  56:  </pre> 
<pre>  57: #--------------------------------------------------------------</pre> 
<pre>  58: def main():</pre> 
<pre>  59:     if len(sys.argv) &lt; 2:</pre> 
<pre>  60:         usage()</pre> 
<pre>  61:         sys.exit(1)</pre> 
<pre>  62:     src = sys.argv[1]</pre> 
<pre>  63:     # get absolute dir/file path</pre> 
<pre>  64:     if os.path.isdir(src):</pre> 
<pre>  65:         dire = os.path.abspath(src)</pre> 
<pre>  66:         dirFlag = True</pre> 
<pre>  67:     elif os.path.isfile(src):</pre> 
<pre>  68:         fl = os.path.abspath(src)</pre> 
<pre>  69:         dirFlag = False</pre> 
<pre>  70:     else:</pre> 
<pre>  71:         print 'File input error'</pre> 
<pre>  72:  </pre> 
<pre>  73:     # deal</pre> 
<pre>  74:     if dirFlag:</pre> 
<pre>  75:         deal_dir(dire)</pre> 
<pre>  76:     else:</pre> 
<pre>  77:         deal_file(fl)</pre> 
<pre>  78:     print 'Successful handle file.'</pre> 
<pre>  79:  </pre> 
<pre>  80: #--------------------------------------------------------------</pre> 
<pre>  81: if __name__ == '__main__':</pre> 
<pre>  82:     main()</pre> 
<h2>使用示例</h2> 
<p> </p> 
<p>待处理文件：</p> 
<pre>   1: #ifndef _RS232_H_</pre> 
<pre>   2: #define _RS232_H_</pre> 
<pre>   3:  </pre> 
<pre>   4: /* the maximum number of ports we are willing to open */</pre> 
<pre>   5: #define MAX_PORTS 4</pre> 
<pre>   6:  </pre> 
<pre>   7: /*this array hold information about each port we have opened */</pre> 
<pre>   8: struct PortInfo{<!-- --></pre> 
<pre>   9:     int busy;</pre> 
<pre>  10:     char name[32];</pre> 
<pre>  11:     int handle;</pre> 
<pre>  12: };</pre> 
<pre>  13:  </pre> 
<pre>  14: int OpenCom(int portNo,const char deviceName[],long baudRate);</pre> 
<pre>  15: int CloseCom(int portNo);</pre> 
<pre>  16: int ComRd(int portNo,char buf[],int maxCnt,int Timeout);</pre> 
<pre>  17: int ComWrt(int portNo,const char * buf,int maxCnt);</pre> 
<pre>  18:  </pre> 
<pre>  19: //long GetBaudRate(long baudRate);</pre> 
<pre>  20: //int OpenComConfig(int port,</pre> 
<pre>  21: //                  const char deviceName[],</pre> 
<pre>  22: //                  long baudRate,</pre> 
<pre>  23: //                  int parity,</pre> 
<pre>  24: //                  int dataBits,</pre> 
<pre>  25: //                  int stopBits,</pre> 
<pre>  26: //                  int iqSize,</pre> 
<pre>  27: //                  int oqSize);</pre> 
<pre>  28:  </pre> 
<pre>  29: #endif</pre> 
<p>处理结果：</p> 
<pre>   1: #ifndef _RS232_H_</pre> 
<pre>   2: #define _RS232_H_</pre> 
<pre>   3: #define MAX_PORTS 4</pre> 
<pre>   4: struct PortInfo{<!-- --></pre> 
<pre>   5:     int busy;</pre> 
<pre>   6:     char name[32];</pre> 
<pre>   7:     int handle;</pre> 
<pre>   8: };</pre> 
<pre>   9: int OpenCom(int portNo,const char deviceName[],long baudRate);</pre> 
<pre>  10: int CloseCom(int portNo);</pre> 
<pre>  11: int ComRd(int portNo,char buf[],int maxCnt,int Timeout);</pre> 
<pre>  12: int ComWrt(int portNo,const char * buf,int maxCnt);</pre> 
<pre>  13: #endif</pre> 
<p>在使用Python正则表达式处理的时候，有一个问题，就是没法删除文件中的空行。如果想删除空行，可能还得一行行读进来，把长度为0的行不保存。这是目前感觉到的难点。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/378ab3aec9266c737bfde5a7c4bf1462/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">microsoft store错误代码0x80131500解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef16184e6b810c8ee9c4ec9c85eef87b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Word双栏和单栏的转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>