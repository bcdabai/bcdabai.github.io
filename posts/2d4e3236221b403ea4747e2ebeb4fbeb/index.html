<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>汇编学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="汇编学习笔记" />
<meta property="og:description" content="汇编学习笔记 劳动成果声明： 我是跟着B站小甲鱼和海蓬莱学的，我主要做的是是整理思维和总结，笔记中部分图片和代码并非我原创，有网上的也有这两位大佬的劳动成果。
开机BIOS和DOS工作流程 (1) 开机后, CPU一加电,初始化(CS)=0FFFFH,(IP)=0,自动从 FFFF:0单元开始执行程序。FFFF:0处有一条转跳指令, CPU执行该指令后,转去执行BIOS中的硬件系统检测和初始化程序。 (2) 初始化程序将建立 BIOS所支持的中断向量,就是将 BIOS提供的中断例程的入口地址登记在中断向量表中。 (3) 硬件系统检测和初始化完成后,调用 int19h 进行操作至统引导。从此将计管机交由操作统控制。 (4) DOS启动后,除完成其它工作外,还将它所提供的中断例程装入内存,并建立相应的中断向量。 汇编指令 汇编语言寄存器的英文全称中英对照表 reg(寄存器) #ax、bx、cx、dx、sp、bp、si、di sreg(段地址寄存器) #ds、ss、cs、es AH&amp;AL=AX(accumulator):累加寄存器 BH&amp;BL=BX(base):基址/偏移地址寄存器 CH&amp;CL=CX(count):计数寄存器 DH&amp;DL=DX(data):数据寄存器 SS(Stack Segment):堆栈段地址寄存器 SP(Stack Pointer):堆栈指针寄存器 # SS:SP CS(Code Segment)：代码段地址寄存器 IP(Instruction Pointer):指令指针寄存器（代码段偏移地址） # CS:IP DS(Data Segment):数据段地址寄存器,配合偏移段地址[]使用；# DS:0000 ES(Extra Segment):附加段寄存器,用于 #缓冲区,也可以写入中断代码,然后在code段初始化时修改中断向量表0000:0000指向ES movsb指令的功能是将DS:SI指向的内存单元中的字节送入ES:DI中，然后根据标志寄存器DF位的值，将SI和DI递增或递	减。同理应有movsw,movsd,movsq	ES的值在asm文件中可声明segment或在代码里mov es,xx 常和rep搭配使用, cld rep movsb #rep的作用重复执行后面的movsb,次数为cx的值,传输方向用cld,和std指令控制 DF direcion flag,DF=l时，每次操作后使SI和DI减小,DF=O时则增大, cld std # 修改方式, cld	指令df=0增大，增大的尺度取决于是movsb(自增1),还是movsw(自增2) std	指令df=1减小 SI(Source Index):源偏移址寄存器 DI(Destination Index):目的偏移址寄存器 # 这两个和BX都能当作偏移地址，即[BX] [SI] [DI] [1] [BX&#43;1] [BX&#43;SI] [BX&#43;DI&#43;3], 错[BX&#43;SI&#43;DI] # [BX&#43;1]——[BX][1]——[BP]." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2d4e3236221b403ea4747e2ebeb4fbeb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-02T07:51:24+08:00" />
<meta property="article:modified_time" content="2023-07-02T07:51:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">汇编学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>汇编学习笔记</h2> 
<h3><a id="_2"></a>劳动成果声明：</h3> 
<p>我是跟着B站小甲鱼和海蓬莱学的，我主要做的是是整理思维和总结，笔记中部分图片和代码并非我原创，有网上的也有这两位大佬的劳动成果。</p> 
<h2>开机BIOS和DOS工作流程</h2> 
<pre><code class="prism language-xml-dtd">(1) 
	开机后, CPU一加电,初始化(CS)=0FFFFH,(IP)=0,自动从 FFFF:0单元开始执行程序。FFFF:0处有一条转跳指令, CPU执行该指令后,转去执行BIOS中的硬件系统检测和初始化程序。

(2)
	初始化程序将建立 BIOS所支持的中断向量,就是将 BIOS提供的中断例程的入口地址登记在中断向量表中。

(3)
	硬件系统检测和初始化完成后,调用 int19h 进行操作至统引导。从此将计管机交由操作统控制。

(4)
	DOS启动后,除完成其它工作外,还将它所提供的中断例程装入内存,并建立相应的中断向量。
</code></pre> 
<p><img src="https://images2.imgbox.com/31/2d/vDYs9pq6_o.png" alt="在这里插入图片描述"></p> 
<h2>汇编指令</h2> 
<p><img src="https://images2.imgbox.com/f0/a4/fxIz9p1P_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-php">汇编语言寄存器的英文全称中英对照表

<span class="token function">reg</span><span class="token punctuation">(</span>寄存器<span class="token punctuation">)</span>
<span class="token comment">#ax、bx、cx、dx、sp、bp、si、di</span>
<span class="token function">sreg</span><span class="token punctuation">(</span>段地址寄存器<span class="token punctuation">)</span>
<span class="token comment">#ds、ss、cs、es</span>


<span class="token constant">AH</span><span class="token operator">&amp;</span><span class="token constant">AL</span><span class="token operator">=</span><span class="token function">AX</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">)</span><span class="token punctuation">:</span>累加寄存器
<span class="token constant">BH</span><span class="token operator">&amp;</span><span class="token constant">BL</span><span class="token operator">=</span><span class="token function">BX</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">:</span>基址<span class="token operator">/</span>偏移地址寄存器
<span class="token constant">CH</span><span class="token operator">&amp;</span><span class="token constant">CL</span><span class="token operator">=</span><span class="token function">CX</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>计数寄存器
<span class="token constant">DH</span><span class="token operator">&amp;</span><span class="token constant">DL</span><span class="token operator">=</span><span class="token function">DX</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>数据寄存器

<span class="token function">SS</span><span class="token punctuation">(</span>Stack Segment<span class="token punctuation">)</span><span class="token punctuation">:</span>堆栈段地址寄存器
<span class="token function">SP</span><span class="token punctuation">(</span>Stack Pointer<span class="token punctuation">)</span><span class="token punctuation">:</span>堆栈指针寄存器 <span class="token comment"># SS:SP</span>

<span class="token function">CS</span><span class="token punctuation">(</span>Code Segment<span class="token punctuation">)</span>：代码段地址寄存器
<span class="token function">IP</span><span class="token punctuation">(</span>Instruction Pointer<span class="token punctuation">)</span><span class="token punctuation">:</span>指令指针寄存器（代码段偏移地址） <span class="token comment"># CS:IP</span>

<span class="token function">DS</span><span class="token punctuation">(</span>Data Segment<span class="token punctuation">)</span><span class="token punctuation">:</span>数据段地址寄存器<span class="token punctuation">,</span>配合偏移段地址<span class="token punctuation">[</span><span class="token punctuation">]</span>使用；<span class="token comment"># DS:0000</span>

<span class="token function">ES</span><span class="token punctuation">(</span>Extra Segment<span class="token punctuation">)</span><span class="token punctuation">:</span>附加段寄存器<span class="token punctuation">,</span>用于
<span class="token comment">#缓冲区,也可以写入中断代码,然后在code段初始化时修改中断向量表0000:0000指向ES</span>
    movsb指令的功能是将<span class="token constant">DS</span><span class="token punctuation">:</span><span class="token constant">SI</span>指向的内存单元中的字节送入<span class="token constant">ES</span><span class="token punctuation">:</span><span class="token constant">DI</span>中，然后根据标志寄存器<span class="token constant">DF</span>位的值，将<span class="token constant">SI</span>和<span class="token constant">DI</span>递增或递		减。同理应有movsw<span class="token punctuation">,</span>movsd<span class="token punctuation">,</span>movsq		<span class="token constant">ES</span>的值在asm文件中可声明segment或在代码里mov es<span class="token punctuation">,</span>xx
    常和rep搭配使用<span class="token punctuation">,</span>
    	cld
    	rep movsb <span class="token comment">#rep的作用重复执行后面的movsb,次数为cx的值,传输方向用cld,和std指令控制</span>

    
<span class="token constant">DF</span> direcion flag<span class="token punctuation">,</span><span class="token constant">DF</span><span class="token operator">=</span>l时，每次操作后使<span class="token constant">SI</span>和<span class="token constant">DI</span>减小<span class="token punctuation">,</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">O</span>时则增大<span class="token punctuation">,</span>   cld  std
    <span class="token comment"># 修改方式,</span>
    cld		指令df<span class="token operator">=</span><span class="token number">0</span>增大，增大的尺度取决于是<span class="token function">movsb</span><span class="token punctuation">(</span>自增<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>还是<span class="token function">movsw</span><span class="token punctuation">(</span>自增<span class="token number">2</span><span class="token punctuation">)</span>
    std		指令df<span class="token operator">=</span><span class="token number">1</span>减小    
    
<span class="token function">SI</span><span class="token punctuation">(</span>Source Index<span class="token punctuation">)</span><span class="token punctuation">:</span>源偏移址寄存器
<span class="token function">DI</span><span class="token punctuation">(</span>Destination Index<span class="token punctuation">)</span><span class="token punctuation">:</span>目的偏移址寄存器
<span class="token comment"># 这两个和BX都能当作偏移地址，即[BX] [SI] [DI] [1] [BX+1] [BX+SI] [BX+DI+3], 错[BX+SI+DI]</span>
<span class="token comment"># [BX+1]——[BX][1]——[BP].1——1[DI]——[BX][SI],都表示相加,BX、BP只用一个,DI、SI只用一个</span>



<span class="token function">BP</span><span class="token punctuation">(</span>Base Pointer<span class="token punctuation">)</span><span class="token punctuation">:</span>（栈段偏移地址）基址指针寄存器
<span class="token comment"># 可以代替BX的偏移地址作用，在[]中使用BP时(mov cx,[bp]),</span>
<span class="token comment"># 若指令没有规定段地址(如[bp],而没写cs:[bp])，则默认段地址为SS. </span>
<span class="token comment"># 也就是说[BX]-&gt;DS:BX;[BP]-&gt;SS:BP ,BP作用临时替代SP,实现保护SP的作用不会被更改           </span>
<span class="token comment"># 用于把栈段当数据段读写</span>
lp<span class="token punctuation">:</span>	push bp			<span class="token comment"># 此时sp-1了</span>
	mov<span class="token punctuation">,</span>bp<span class="token punctuation">,</span>sp
	…………		此过程凡是涉及<span class="token constant">SS</span>修改的操作全用bp。mov <span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'xx'</span> 或 mov ss<span class="token punctuation">:</span><span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'xx'</span>
	call far ptr lpret
	pop bp			<span class="token comment"># 此时sp+1了,正好恢复为初始状态</span>
lpret<span class="token punctuation">:</span>
	…………		此过程凡是涉及<span class="token constant">SS</span>修改的操作全用bp。mov <span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'xx'</span> 或 mov ss<span class="token punctuation">:</span><span class="token punctuation">[</span>bp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'xx'</span>
	retf

<span class="token comment">#	运算结果记录 标志位--------------------------标志寄存器----------------------------</span>
                            <span class="token constant">OV</span>     <span class="token constant">UP</span> 	 <span class="token constant">EI</span>	    <span class="token constant">NG</span>    <span class="token constant">ZR</span> 	<span class="token constant">NA</span>   <span class="token constant">PE</span>   <span class="token constant">CY</span>
                    	符号溢出进位            负正   零         偶奇  进位
                            <span class="token constant">OF</span>     <span class="token constant">UP</span> 	 <span class="token constant">EI</span>	    <span class="token constant">SF</span>    <span class="token constant">ZF</span> 	<span class="token constant">NA</span>   <span class="token constant">PF</span>   <span class="token constant">CY</span>
                           

    <span class="token constant">ZF</span> zero flag零标志运算结果等于<span class="token number">0</span>时为l否则为<span class="token number">0</span> 					<span class="token function">ZR</span><span class="token punctuation">(</span>Zero<span class="token punctuation">)</span>			<span class="token function">NZ</span><span class="token punctuation">(</span>Not zero<span class="token punctuation">)</span>
	<span class="token comment">#等于0</span>
    
    <span class="token constant">SF</span> sign Flag符号标志记录运算结果的符号，结果负时为<span class="token number">1</span>，		<span class="token function">NG</span><span class="token punctuation">(</span>负数Negteive<span class="token punctuation">)</span>		<span class="token function">PL</span><span class="token punctuation">(</span>正数Positive<span class="token punctuation">)</span>
    <span class="token comment"># -127存储为(01111111-反码&gt;10000000-加1&gt;10000001), (11110000)既表示+240也表示-16(00010000)</span>
        
    <span class="token constant">CF</span> carry flag进位标志最高有效位产生进位时为<span class="token number">1</span>，否侧为<span class="token number">0</span>， 	<span class="token function">CY</span><span class="token punctuation">(</span>溢出进位Carry<span class="token punctuation">)</span>	 <span class="token function">NC</span><span class="token punctuation">(</span>未溢出Not carry<span class="token punctuation">)</span>
    <span class="token comment">#进位溢出  </span>
    <span class="token constant">AF</span> auxiliary carry flag辅助进位标志运算时，第<span class="token number">3</span>位向第<span class="token number">4</span>位产生进位时为<span class="token number">1</span>，否则为<span class="token number">0</span>
    <span class="token comment"># 和CF的区别是不判断 mov al,xx</span>
    
    <span class="token constant">OF</span> overflow flag溢出标志操作数超出机器能表示的范围表示溢出，溢出时为<span class="token number">1</span> 	<span class="token function">OV</span><span class="token punctuation">(</span>符号溢出<span class="token punctuation">)</span>	<span class="token function">NV</span><span class="token punctuation">(</span>未溢出<span class="token punctuation">)</span>
    <span class="token comment">#符号溢出,对于8位的有符号数据，机器所能表示的范围就是-128~127。对于16位是-32768~32767</span>

	<span class="token constant">PF</span> parity flag奇偶标志运算结果操作数位为<span class="token number">1</span>的个数为偶数个时为<span class="token number">1</span>否则为<span class="token number">0</span>       <span class="token function">PE</span><span class="token punctuation">(</span>偶Even<span class="token punctuation">)</span>		<span class="token function">PO</span><span class="token punctuation">(</span>奇Odd<span class="token punctuation">)</span>
    <span class="token comment"># 奇偶</span>
    
   
    <span class="token keyword">IF</span> interrupt flag 中断标志<span class="token keyword">IF</span><span class="token operator">=</span>l时，允许<span class="token constant">CPU</span>响应可屏蔽中断，否则关闭中断
    <span class="token constant">TF</span> trap flag      用于调试单步操作
    <span class="token keyword">IF</span><span class="token operator">/</span><span class="token constant">TF</span>修改的操作如下图
    标志寄存器<span class="token punctuation">(</span><span class="token number">0000</span> <span class="token number">00</span>IT <span class="token number">0000</span> <span class="token number">0000</span><span class="token punctuation">)</span>
    
</code></pre> 
<p>-e 修改内存数据<br> <img src="https://images2.imgbox.com/1e/f0/pTJCZTnb_o.png" alt="在这里插入图片描述"></p> 
<p>-e 交互模式修改 0000回车，AB空格</p> 
<p><img src="https://images2.imgbox.com/de/cd/f0qApG1Z_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/53/29/zSOstnpK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/30/ed/VisTULrN_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql">h 高<span class="token number">8</span>位
l 低<span class="token number">8</span>位
AX<span class="token operator">=</span><span class="token number">0008</span> BX<span class="token operator">=</span><span class="token number">0008</span> CX<span class="token operator">=</span><span class="token number">1000</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">010</span>B

<span class="token operator">-</span>a
<span class="token number">073</span>F:<span class="token number">010</span>B mov ah<span class="token punctuation">,</span><span class="token number">13</span>
<span class="token number">073</span>F:<span class="token number">010</span>D mov bl<span class="token punctuation">,</span><span class="token number">33</span>
<span class="token number">073</span>F:<span class="token number">010</span>F mov ch<span class="token punctuation">,</span>al
<span class="token number">073</span>F:<span class="token number">0111</span>

<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0008</span> CX<span class="token operator">=</span><span class="token number">1000</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">010</span>D
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0033</span> CX<span class="token operator">=</span><span class="token number">1000</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">010</span>F
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0033</span> CX<span class="token operator">=</span><span class="token number">0800</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">0111</span>



AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0033</span> CX<span class="token operator">=</span><span class="token number">0800</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">0111</span>
<span class="token operator">-</span>a
<span class="token number">073</span>F:<span class="token number">0111</span> <span class="token keyword">add</span> ax<span class="token punctuation">,</span><span class="token number">03</span>
<span class="token number">073</span>F:<span class="token number">0114</span> mov bx<span class="token punctuation">,</span><span class="token number">04</span>
<span class="token number">073</span>F:<span class="token number">0117</span> mov cx<span class="token punctuation">,</span>ax
<span class="token number">073</span>F:<span class="token number">0119</span>

<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">130</span>B BX<span class="token operator">=</span><span class="token number">0033</span> CX<span class="token operator">=</span><span class="token number">0800</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">0114</span>
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0037</span> CX<span class="token operator">=</span><span class="token number">0800</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">0117</span>
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1308</span> BX<span class="token operator">=</span><span class="token number">0037</span> CX<span class="token operator">=</span><span class="token number">0837</span> CS<span class="token operator">=</span><span class="token number">073</span>F IP<span class="token operator">=</span><span class="token number">0119</span>

<span class="token comment">-- 加</span>
<span class="token keyword">add</span> bh<span class="token punctuation">,</span>F1
如果加和结果为<span class="token number">1</span>F236<span class="token punctuation">,</span>只显示为F236<span class="token comment">-- (无论高八位还是低八位有进借位都会舍给CF记录(CY,NC))</span>
<span class="token comment">-- 减</span>
sub减
sub ax<span class="token punctuation">(</span><span class="token number">000</span>F<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span> 结果为FFFF
<span class="token punctuation">(</span>减的结果越界会向前借<span class="token number">1</span>，即使没有<span class="token punctuation">,</span>如果操作的是高低八位，不会互相影响<span class="token punctuation">)</span>

<span class="token comment">-- 含进位加</span>
adc ax<span class="token punctuation">,</span><span class="token number">1</span> 即 ax<span class="token operator">=</span>ax<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span>cf
<span class="token comment">-- 含进位减</span>
sbb ax<span class="token punctuation">,</span><span class="token number">1</span> 即 ax<span class="token operator">=</span>ax<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>cf


<span class="token comment">-- mul乘(低于255的数相乘，AX=AL*BL)</span>
计算<span class="token number">100</span><span class="token operator">*</span><span class="token number">10</span>
AX<span class="token operator">=</span><span class="token number">0064</span>
BL<span class="token operator">=</span><span class="token number">0</span>A
<span class="token operator">-</span>a
mul bl
会使
AX<span class="token operator">=</span><span class="token number">03</span>E8
<span class="token comment">-- mul乘(高于255的数相乘，结果为DXAX)</span>
计算<span class="token number">100</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">(</span>结果为<span class="token number">64</span><span class="token operator">*</span><span class="token number">2710</span><span class="token operator">=</span>F4240<span class="token punctuation">)</span>
AX<span class="token operator">=</span><span class="token number">0064</span>
BX<span class="token operator">=</span><span class="token number">2710</span>
<span class="token operator">-</span>a
mul bx
输出
DX<span class="token operator">=</span><span class="token number">000</span>F AX<span class="token operator">=</span><span class="token number">4240</span> 
总结
	AX<span class="token operator">=</span>AL<span class="token operator">*</span>BL
	DXAX<span class="token operator">=</span>AX<span class="token operator">*</span>BX
										<span class="token comment">#   imul,idiv是对有符号负数运算的乘除</span>

<span class="token operator">div</span>除
<span class="token comment">-- 10000(2710)/100(64)=100(64)</span>
AX<span class="token operator">=</span><span class="token number">2710</span>
BL<span class="token operator">=</span><span class="token number">64</span>									 除以        商   余
<span class="token operator">-</span>a											   
<span class="token operator">div</span> bl									AX <span class="token operator">/</span> BL		AL	AH
结果为AX<span class="token operator">=</span><span class="token number">0064</span> AH<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">(</span>余数<span class="token punctuation">)</span>						 
<span class="token comment">-- 1000000(F4240)/10000(2710)=100(64)			   </span>
DX<span class="token operator">=</span><span class="token number">000</span>F
AX<span class="token operator">=</span><span class="token number">4240</span>
BX<span class="token operator">=</span><span class="token number">2710</span>					
<span class="token operator">-</span>a
<span class="token operator">div</span> bx									DXAX <span class="token operator">/</span> BX	AX	DX
结果为AX<span class="token operator">=</span><span class="token number">0064</span> DX<span class="token operator">=</span><span class="token number">0000</span><span class="token punctuation">(</span>余数<span class="token punctuation">)</span>


<span class="token comment">-- 与and运算</span>
mov al<span class="token punctuation">,</span><span class="token number">01100011</span>B<span class="token punctuation">(</span>debug中要写成十六进制<span class="token punctuation">)</span>
<span class="token operator">and</span> al<span class="token punctuation">,</span><span class="token number">00111011</span>B
结果
al<span class="token operator">=</span><span class="token number">00100011</span>B
<span class="token comment">-- 或or运算</span>
mov al<span class="token punctuation">,</span><span class="token number">01100011</span>B
<span class="token operator">or</span> al<span class="token punctuation">,</span><span class="token number">00111011</span>B
结果
al<span class="token operator">=</span><span class="token number">01111011</span>B
<span class="token comment">-- 异或xor运算</span>
<span class="token operator">xor</span> ax<span class="token punctuation">,</span>bx		<span class="token punctuation">(</span>对ax和bx进行异或运算<span class="token punctuation">,</span>对应两位相异则为<span class="token number">1</span><span class="token punctuation">,</span>相同为<span class="token number">0</span>，结果赋值ax<span class="token punctuation">)</span>



<span class="token comment">-- 左移一位(右侧补0,进的位覆盖给标志寄存器的cf),	乘2</span>
shl al<span class="token punctuation">,</span><span class="token number">1</span>
想一次性移动<span class="token number">2</span>位
mov cl<span class="token punctuation">,</span><span class="token number">2</span>
shl al<span class="token punctuation">,</span>cl

<span class="token comment">-- 右移一位(左侧补0，最后一位移出覆盖给cf),		除以2</span>
shr al<span class="token punctuation">,</span><span class="token number">1</span>

循环移动<span class="token punctuation">(</span>不补<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0110</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">1100</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">1001</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">0011</span><span class="token punctuation">)</span>
rol ax<span class="token punctuation">,</span><span class="token number">1</span>
ror ax<span class="token punctuation">,</span><span class="token number">1</span>
移动<span class="token punctuation">(</span>带进位<span class="token punctuation">)</span>
rcl和rcr

<span class="token comment">-- 加1减1(自增自减，越位会借inc FFFF即0000,同add和sub)</span>
inc ax  加<span class="token number">1</span>
<span class="token keyword">dec</span> ax  减<span class="token number">1</span>

<span class="token comment">-- 交换数据</span>
xchg ax<span class="token punctuation">,</span>bx

<span class="token comment">-- 取反，反码</span>
neg ax

<span class="token comment">-- 中断</span>
<span class="token keyword">int</span>

</code></pre> 
<p>-d 段地址:偏移位/地址 查看多少位</p> 
<p><img src="https://images2.imgbox.com/63/ce/G48TotAg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_coloryellow16font_269"></a><font color="yellow">段地址*<code>16</code>(即左移一位)+偏移位/地址=物理地址</font></h3> 
<pre><code class="prism language-sql">段		偏		物理
<span class="token number">2000</span> 	<span class="token number">1</span>F60	<span class="token number">21</span>F60
<span class="token number">2100</span>	<span class="token number">0</span>F60	<span class="token number">21</span>F60
<span class="token number">21</span>F0	<span class="token number">0060</span>	<span class="token number">21</span>F60
<span class="token number">21</span>F6	<span class="token number">0000</span>	<span class="token number">21</span>F60
<span class="token number">1</span>F00	<span class="token number">2</span>F60	<span class="token number">21</span>F60


mov ax<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span> <span class="token comment">-- 将ds:0060处的数据(高低八位)赋给ax</span>
mov al<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span> <span class="token comment">-- 将ds:0060处的数据(八位)赋给al</span>
mov ax<span class="token punctuation">,</span><span class="token punctuation">[</span>bx<span class="token punctuation">]</span> <span class="token comment">-- 将ds:[bx]处的数据赋给ax</span>
mov ax<span class="token punctuation">,</span><span class="token punctuation">[</span>bx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">-- 也合法，因为bx有做偏移地址的功能,将ds:[bx+1]处的数据</span>
mov <span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>bx   <span class="token comment">-- 将bx的值x写到ds:[si]处,推荐写法 mov word ptr [si],bx</span>

DS修改方式
mov ax<span class="token punctuation">,</span><span class="token number">21</span>F0
mov ds<span class="token punctuation">,</span>ax
</code></pre> 
<p>修改寄存器数据</p> 
<pre><code class="prism language-elixir">-r cs
CS 073F
:输入要修改为数据(直接回车不修改)
</code></pre> 
<h3><a id="jmpCS_299"></a>jmp指令（跳转CS偏移地址）</h3> 
<p><img src="https://images2.imgbox.com/e3/a1/3ZOYazJe_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql">CS<span class="token operator">=</span><span class="token number">2000</span> IP<span class="token operator">=</span><span class="token number">0000</span>
<span class="token operator">-</span>t执行
经分析后，可知指令执行序列为：
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>mov ax<span class="token punctuation">,</span><span class="token number">6622</span>H
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>jmp <span class="token number">1000</span>:<span class="token number">3</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>mov ax<span class="token punctuation">,</span><span class="token number">0000</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>mov bx<span class="token punctuation">,</span>ax
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>jmp bx  <span class="token comment">-- 相当于 ip &lt;--  bx(mov ip,bx不合法)</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>mov ax<span class="token punctuation">,</span><span class="token number">0123</span>H
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>转到第<span class="token number">3</span>步执行<span class="token punctuation">(</span>死循环<span class="token punctuation">)</span>

</code></pre> 
<h3><a id="cmp_318"></a>cmp指令(比较大小，条件跳转)</h3> 
<pre><code class="prism language-xml-dtd">————————————————————————————————————————————非重点作为了解—————————————————————————————————————————————
mov ax,8
mov bx,3
cmp ax,bx(判断 ax-bx 的结果)
执行后：zf=0,cf=0。说明 ax-bx 的结果不为 0 且不用借 1减，所以 ax&gt;bx

如果(ax)=(bx)则(ax)-(bx)=0, 所以：			         zf=1;
如果(ax)≠(bx)则(ax)-(bx)≠0，所以：			    	    zf=0;
如果(ax)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>(bx)则(ax)-(bx)将产生借位，所以：</span> 		 	    <span class="token attr-name">cf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>1;</span>
<span class="token attr-name">如果(ax)≥(bx)则(ax)-(bx)不必借位，所以：</span>	 	 	     <span class="token attr-name">cf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>0;</span>
<span class="token attr-name">如果(ax)</span><span class="token punctuation">&gt;</span></span>(bx)则(ax)-(bx)既不必借位，结果又不为0，所以：   cf=0 &amp;&amp; zf=0;
如果(ax)≤(bx)则(ax)-(bx)既可能借位，结果也可能为0，所以： cf=1 || zf=1。

下面是常用的根据无符号数的比较结果进行转移的条件转移指令。
例子： 
cmp ah,bh
je 073F:0100

————————————————————————————————————————————重点——————————————————————————————————————————————————————
指令 		含义 			检测的相关标志位
je/z 	等于则跳转		 zf=1			equal
jne		不等于则跳转		zf=0
jb		低于则跳转		 cf=1			below
jnb		不低于则跳转		cf=0
ja		高于则跳转		 cf=0且zf=0		above
jna		不高于则跳转		cf=1或zf=1
jcxz	此时先判断 cx==0 才跳转		

</code></pre> 
<h3><a id="font_coloryellowfont_353"></a>栈<font color="yellow">自动跟位补位特性</font></h3> 
<p>SS:SP指向栈顶<font color="yellow">(左栈顶60 10 00 F0 08 00栈底右)</font></p> 
<p>高八位先入栈</p> 
<pre><code class="prism language-sql"><span class="token operator">-</span>d <span class="token number">0000</span>:<span class="token number">0000</span> <span class="token number">5</span>
<span class="token number">0000</span>:<span class="token number">0000</span> <span class="token number">60</span> <span class="token number">10</span> <span class="token number">00</span> F0 <span class="token number">08</span> <span class="token number">00</span>
<span class="token operator">-</span>r
AX<span class="token operator">=</span><span class="token number">0000</span> BX<span class="token operator">=</span><span class="token number">0000</span> DS<span class="token operator">=</span><span class="token number">073</span>F 
<span class="token operator">-</span>a
 mov ds<span class="token punctuation">,</span>bx
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">0000</span> BX<span class="token operator">=</span><span class="token number">0000</span> DS<span class="token operator">=</span><span class="token number">0000</span> 
<span class="token operator">-</span>a
mov ax<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0000</span><span class="token punctuation">]</span>
<span class="token operator">-</span>t
AX<span class="token operator">=</span><span class="token number">1060</span> BX<span class="token operator">=</span><span class="token number">0000</span> DS<span class="token operator">-</span><span class="token number">0000</span> <span class="token comment">-- 60 10 00 的10即高八位，60低八位</span>

<span class="token comment">-- 入栈(push入栈的位置取决于SS:SP）</span>
push ax		也可以push <span class="token punctuation">[</span><span class="token number">0000</span><span class="token punctuation">]</span>参考当前段地址ds
<span class="token comment">-- 出栈并赋值(pop出栈的值取决于SS:SP，pop空格后的用于接收值，pop完SP重新指向栈顶，原位置填充数据A301)</span>
pop ax		也可以pop <span class="token punctuation">[</span><span class="token number">0000</span><span class="token punctuation">]</span>

pushf 	<span class="token comment">-- 把标志寄存器的值入栈</span>
popf	<span class="token comment">-- 出栈给标志寄存器的赋值</span>

栈的内存标志
已知操作完栈的下一条指令的cs:ip <span class="token number">1234</span>:<span class="token number">5678</span>
则栈为  <span class="token number">78</span> <span class="token number">56</span> <span class="token number">34</span> <span class="token number">12</span> A3 <span class="token number">01</span> xx    <span class="token punctuation">(</span>xx即sp位置<span class="token punctuation">)</span>A3 <span class="token number">01</span> 会一直包裹栈顶

</code></pre> 
<h2>编译程序</h2> 
<p>1、工作目录创建code.asm文件，此文件的汇编代码不区分大小写</p> 
<p>写入</p> 
<pre><code class="prism language-sql">assume cs:codesg  			<span class="token comment">-- 声明代码段cs为codesg,同理 ds:xxx,ss:xxx</span>

codesg segment  		<span class="token comment">-- codesg segment 和 codesg ends 包裹汇编指令</span>

    mov ax<span class="token punctuation">,</span><span class="token number">0123</span>H
    mov bx<span class="token punctuation">,</span><span class="token number">0456</span>H		<span class="token comment">-- 不写H编译器会认为是十进制数,写B代表二进制数，O代表八进制</span>
    <span class="token keyword">add</span> ax<span class="token punctuation">,</span>bx
    <span class="token keyword">add</span> ax<span class="token punctuation">,</span>ax
    mov ax<span class="token punctuation">,</span><span class="token number">4</span>c00H		<span class="token comment">-- 用于程序退出时返回之前的启动程序</span>
    <span class="token keyword">int</span> <span class="token number">21</span>H
    					<span class="token comment">-- 编译器可以操作 +-*/ 运算</span>
codesg ends

<span class="token keyword">end</span>
</code></pre> 
<p>2、用masm.exe编译asm文件</p> 
<pre><code class="prism language-sql">C:<span class="token operator">&gt;</span>\masm<span class="token punctuation">.</span>exe
Source filename <span class="token punctuation">[</span><span class="token punctuation">.</span>ASM<span class="token punctuation">]</span>:键入code<span class="token punctuation">.</span>asm  
Object filename <span class="token punctuation">[</span>code<span class="token punctuation">.</span>OBJ<span class="token punctuation">]</span>:
Source listing  <span class="token punctuation">[</span>NUL LST<span class="token punctuation">]</span>:
<span class="token keyword">Cross</span><span class="token operator">-</span>reference <span class="token punctuation">[</span>NUL CRF<span class="token punctuation">]</span>:

  <span class="token number">51800</span> <span class="token operator">+</span> <span class="token number">464744</span> Bytes symbol space free
    <span class="token number">0</span> Warning <span class="token keyword">Errors</span>
    <span class="token number">0</span> Severe <span class="token keyword">Errors</span>
    
同级目录生成一个code<span class="token punctuation">.</span>obj文件    		<span class="token comment">-- 乱码诞生</span>
</code></pre> 
<p>3、用link.exe将code.obj转成exe文件</p> 
<pre><code class="prism language-sql">C:<span class="token operator">&gt;</span>\link<span class="token punctuation">.</span>exe
Object Modules <span class="token punctuation">[</span>OBJ<span class="token punctuation">]</span>:code<span class="token punctuation">.</span>obj
Run <span class="token keyword">File</span> <span class="token punctuation">[</span>CODE<span class="token punctuation">.</span>EXE<span class="token punctuation">]</span>:
List <span class="token keyword">File</span> <span class="token punctuation">[</span>NUL<span class="token punctuation">.</span>MAP<span class="token punctuation">]</span>:
Libraries <span class="token punctuation">[</span><span class="token punctuation">.</span>LIB<span class="token punctuation">]</span>:
LINK warning L4021:<span class="token keyword">no</span> stack segment <span class="token comment">-- 此警告是因为没写基段地址</span>

同级目录生成一个code<span class="token punctuation">.</span>exe文件

</code></pre> 
<p>4、此exe文件可以用debug打开——C:&gt;\debug.exe code.exe</p> 
<h3><a id="212font_coloryellowloopjmpcxfont_446"></a>计算<code>2**12</code><font color="yellow">(loop指令相当于jmp指令不过会牵扯cx计数)</font></h3> 
<pre><code class="prism language-sql"><span class="token comment"># --------------------------------------------方法一----------------------------------------------#</span>

assume cs:code  

code segment  		

    mov ax<span class="token punctuation">,</span><span class="token number">0002</span>H
    mov bx<span class="token punctuation">,</span><span class="token number">0002</span>H
    mov cx<span class="token punctuation">,</span><span class="token number">000</span>BH		<span class="token comment">-- 计数器，每次loop时，自减1</span>
    s:
        mul bx   <span class="token comment">-- ax=ax*bx，2*2---这是起始状态2^2，说明还需乘10次才是2^12，则loop应运行11次，故cx=B</span>
        <span class="token keyword">loop</span> s	 <span class="token comment">-- 循环s定义的代码段,每次修改IP为s：的偏移地址(debug界面显示loop 0006,0006即s:的偏移)，					loop时先dec cx,当结果为0时，不在跳转ip,继续往下执行其他代码</span>
    mov ax<span class="token punctuation">,</span> <span class="token number">4</span>C00H
    <span class="token keyword">int</span> <span class="token number">21</span>H
    
code ends

<span class="token keyword">end</span>

<span class="token comment"># --------------------------------------------方法二----------------------------------------------#</span>

assume cs:code  

code segment  		

    mov ax<span class="token punctuation">,</span><span class="token number">0002</span>H
    mov cx<span class="token punctuation">,</span><span class="token number">000</span>BH		<span class="token comment">-- 计数器，每次loop时，自减1</span>
    s:
        <span class="token keyword">add</span> ax<span class="token punctuation">,</span>ax   <span class="token comment">-- ax=ax*2</span>
        <span class="token keyword">loop</span> s	 <span class="token comment">-- 循环几次cx就写几</span>
    mov ax<span class="token punctuation">,</span> <span class="token number">4</span>C00H
    <span class="token keyword">int</span> <span class="token number">21</span>H
    
code ends

<span class="token keyword">end</span>

<span class="token comment">-- 死循环</span>
s:inc cx


调试时如果想直接看运算结果，<span class="token operator">-</span>u查看代码终止的偏移地址为<span class="token number">0012</span>
当前 IP<span class="token operator">=</span><span class="token number">0000</span>
输入 <span class="token operator">-</span>g <span class="token number">0012</span>
即可直接运算完之间的指令
<span class="token operator">-</span>p 回车 可以直接运算完循环，IP指向循环下一条指令<span class="token punctuation">(</span>pass<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="callret_497"></a>call和ret指令</h3> 
<pre><code class="prism language-sql">assume cs:code  			

code segment  		

    mov ax<span class="token punctuation">,</span><span class="token number">2</span>
    mov cx<span class="token punctuation">,</span><span class="token number">11</span>
    <span class="token keyword">call</span> s				<span class="token comment"># ip指向s:的偏移地址，即add ax,ax debug实例 CALL	000F</span>
    <span class="token keyword">int</span> <span class="token number">21</span>H					
    s:					<span class="token comment"># s字符可以自定义，作用标注</span>
    	<span class="token keyword">add</span> ax<span class="token punctuation">,</span>ax
    	<span class="token keyword">loop</span> s
    ret					<span class="token comment"># ip指向call的下一条指令，即int 21H</span>
    
code ends

<span class="token keyword">end</span>

<span class="token comment">-- call和ret的本质</span>

<span class="token keyword">call</span>  实质是    push ip  <span class="token punctuation">(</span><span class="token keyword">call</span>的下一条指令对应的的ip<span class="token punctuation">)</span>
ret   实质是    pop ip   <span class="token punctuation">(</span>当前ip接收值<span class="token punctuation">)</span>

如果<span class="token keyword">call</span>和ret需要修改段地址CS<span class="token punctuation">,</span>

写法与实质：
    <span class="token comment">-- call far ptr s    </span>
         先
         push cs 
         push ip<span class="token punctuation">(</span><span class="token keyword">call</span>的下一条指令对应的的ip<span class="token punctuation">)</span>
         再把
         cs:ip指向s:的段地址:偏移地址，debug实例 <span class="token keyword">CALL</span>	<span class="token number">076</span>A:<span class="token number">000</span>F	
    <span class="token comment">-- retf</span>
		pop ip
         pop cs




</code></pre> 
<h3><a id="_542"></a>数据存储类型</h3> 
<pre><code class="prism language-sql">类型	  	   debug命令<span class="token punctuation">(</span>define byte<span class="token punctuation">)</span>    长度
BYTE  <span class="token punctuation">(</span><span class="token number">1</span>字节<span class="token punctuation">)</span>    db 	<span class="token number">12</span><span class="token punctuation">,</span><span class="token number">23</span>   		 <span class="token number">8</span>	   <span class="token comment"># 内存里是 12 34</span>
WORD  <span class="token punctuation">(</span><span class="token number">2</span>字节<span class="token punctuation">)</span>    dw   <span class="token number">1234</span><span class="token punctuation">,</span><span class="token number">0033</span>         <span class="token number">16</span>	<span class="token comment"># 内存里是 34 12 33 00</span>
DWORD <span class="token punctuation">(</span><span class="token number">4</span>字节<span class="token punctuation">)</span>    dd 	 			     <span class="token number">32</span>
QWORD <span class="token punctuation">(</span><span class="token number">8</span>字节<span class="token punctuation">)</span>    dq				     <span class="token number">64</span>

主要用于往地址中写数据时，
如 mov word ptr <span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>bx
如 mov dword ptr <span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">000</span>A<span class="token punctuation">,</span><span class="token number">0057</span>
如 mov dword ptr <span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">056</span>A<span class="token punctuation">,</span><span class="token number">5729</span>
如 mov qword ptr <span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">568</span>A<span class="token punctuation">,</span><span class="token number">5789</span><span class="token punctuation">,</span><span class="token number">568</span>A<span class="token punctuation">,</span><span class="token number">5789</span> 
</code></pre> 
<pre><code class="prism language-sql">assume cs:code
codesg segment  
	dw <span class="token number">123</span>H<span class="token punctuation">,</span><span class="token number">456</span>H<span class="token punctuation">,</span><span class="token number">0</span>ABCH<span class="token punctuation">,</span><span class="token number">0</span>F569H   <span class="token comment">-- 语法十六进制数不能以字母开头，头要加0</span>
	<span class="token keyword">start</span>：	
			mov ax<span class="token punctuation">,</span><span class="token number">0</span>		<span class="token comment">-- start 用于区分数据和指令防止混肴,将cs:ip指向mov而不是dw</span>
			<span class="token keyword">add</span> ax<span class="token punctuation">,</span><span class="token number">1</span>
code ends
<span class="token keyword">end</span> <span class="token keyword">start</span>
</code></pre> 
<h3><a id="_575"></a>分段存储</h3> 
<pre><code class="prism language-sql">assume ss:stack<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>cs:code

<span class="token comment">-- 先写栈，方便代码初始化sp</span>
stack segment				
	db <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>  可简写为 db <span class="token number">16</span> dup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">-- 不加h就是十进制数</span>
	<span class="token comment"># 写字符 db 3 dup('hello','aliak')  接着前面会自动根据ascii码写入</span>
    <span class="token comment"># db 1,2,3,1,2,3,1,2,3      可简写为 db 3 dup(1，2，3),接着前面写，不满16个后面会写入0  </span>
stack ends

<span class="token keyword">data</span> segment				
	<span class="token comment">#dw 012fH,0235H,666</span>
	<span class="token comment">#db '你好HeLLo'				-- 写入的字节取决于asm文件的编码是UTF还是GBK</span>
	db <span class="token number">1</span> dup<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">'aliak'</span><span class="token punctuation">)</span> 		<span class="token comment">-- 接着前面写，不满16个后面会写入0,单双引号都兼容</span>
<span class="token keyword">data</span> ends

code segment
<span class="token keyword">start</span>:
	mov ax<span class="token punctuation">,</span>stack				<span class="token comment">-- 将栈段地址赋给ax</span>
	mov ss<span class="token punctuation">,</span>ax					<span class="token comment">-- 段寄存器只能接收普通寄存器的mov</span>
	mov sp<span class="token punctuation">,</span><span class="token number">0010</span>H				<span class="token comment">-- 如果stack写的是dw,则此处为0020H，相应start调整的cs更靠后了</span>
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
	mov ds<span class="token punctuation">,</span>ax					<span class="token comment">-- 将数据段地址赋给ds</span>
	
	<span class="token comment">-- 上面代码必须写作为初始化条件,下面才是真正要做的事的写代码的位置</span>
	mov ax<span class="token punctuation">,</span> <span class="token number">4</span>C00H
    <span class="token keyword">int</span> <span class="token number">21</span>H
code ends
<span class="token keyword">end</span> <span class="token keyword">start</span>

最终连续存储
数据段<span class="token punctuation">(</span><span class="token number">076</span>A<span class="token punctuation">)</span><span class="token number">076</span>A:<span class="token number">0000</span>	<span class="token number">68</span> <span class="token number">65</span> <span class="token number">6</span>C <span class="token number">6</span>C <span class="token number">6</span>F <span class="token number">61</span> <span class="token number">6</span>C <span class="token number">69</span><span class="token operator">-</span><span class="token number">61</span> <span class="token number">6</span>B <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> helloaliak
和栈段<span class="token punctuation">(</span><span class="token number">076</span>B<span class="token punctuation">)</span><span class="token number">076</span>A:<span class="token number">0010</span>	<span class="token number">06</span> <span class="token number">06</span> <span class="token number">06</span> <span class="token number">06</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 
代码段<span class="token punctuation">(</span><span class="token number">076</span>C<span class="token punctuation">)</span><span class="token number">076</span>A:<span class="token number">0020</span>	B8 <span class="token number">6</span>B <span class="token number">07</span> <span class="token number">8</span>E <span class="token keyword">DO</span> BC <span class="token number">20</span> <span class="token number">00</span><span class="token operator">-</span>B8 <span class="token number">6</span>A <span class="token number">07</span> <span class="token number">8</span>E D8 FF FF <span class="token number">74</span>
谁大谁小取决于 asm 文件写的代码顺序<span class="token punctuation">(</span>不是assume那一行而是下面的<span class="token punctuation">)</span><span class="token punctuation">,</span>


</code></pre> 
<h3>代码篡改可能，疯狂pop</h3> 
<pre><code class="prism language-xml-dtd">—————————————————————————————栈的安全性取决于 ss，sp无论怎么变都不会改变 sp,会循环
防止溢出，应在
stack db 0fff1h dup(0) , 
sp == 8000h
data db 0fff1h dup(0)
这样于段和段之间的物理地址才不会有重叠
code segment
	

如下图，当 sp=ffff时，再 pop 往后不够两个字节，结果会是 01A3而不是 A3A3， 但 sp 会变成 0001

同理， mov [ffff],2345h 会把下一个代码段的第一个字节改为 23



所以初始化  -----------------------------------------
	mov ax,stack
	mov ss,ax
	mov sp,8000h
	
	mov ax,data
	mov ds,ax
----------------------------------------------------------
</code></pre> 
<p><img src="https://images2.imgbox.com/df/e5/sC39O62o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e1/fc/FxWcSWX1_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b7/de/m22vch6V_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="offsetfont_coloryellowDISIBPBXfont_654"></a>offset指令<font color="yellow">获取偏移地址，多用DI、SI、BP、BX接收</font></h3> 
<pre><code class="prism language-sql"> <span class="token comment">-- 运行两次mov,bx,bx来学习offset和nop</span>
code segment
<span class="token keyword">start</span>:
	mov si<span class="token punctuation">,</span><span class="token keyword">offset</span> s 	 :<span class="token number">0000</span>	   <span class="token comment"># 将s对应指令的偏移地址赋给si, 即mov si,0006</span>
	mov di<span class="token punctuation">,</span><span class="token keyword">offset</span> s0	 :<span class="token number">0003</span>	   <span class="token comment"># 将s0对应指令的偏移地址赋给di,即mov di,000E</span>
	s:	mov bx<span class="token punctuation">,</span>bx    	 :<span class="token number">0006</span>     debug里下面有个CS：命令<span class="token punctuation">,</span>机器码<span class="token number">2</span>E 
    	mov cx<span class="token punctuation">,</span>cs:<span class="token punctuation">[</span>si<span class="token punctuation">]</span>   :<span class="token number">0009</span>     <span class="token comment"># 把cs:[si]对应的数据赋给cx,此数据就是mov bx,bx的机器码(89DB)</span>
    	mov cs:<span class="token punctuation">[</span>di<span class="token punctuation">]</span><span class="token punctuation">,</span>cx	 :<span class="token number">000</span>C	   <span class="token comment"># 将nop指令改为mov bx,bx,即当执行到nop指令处，nop指令变为 mov,bx,bx</span>
    s0:
    	nop						<span class="token comment">-- 占位，机器码为00，常用于计算代码长度，比如offset s0 - offset s，就是</span>
        nop						 <span class="token comment">-- s:代码的长度，然后配合movsb,cld来拷贝指令代码到其他位置</span>
    						<span class="token comment">-- 为什么写两次，因为mov cs:[di],cx是传入的word，而nop机器码为90只有一个</span>
code ends									<span class="token comment">-- 其实写一个nop也没关系，反正会覆盖掉后面的机器码</span>

<span class="token comment">-----------------------------------------</span>
mov cx<span class="token punctuation">,</span>cs:<span class="token punctuation">[</span>di<span class="token punctuation">]</span> 是伪指令，debug要写成
<span class="token operator">-</span>a	
	cs:
	mov cx<span class="token punctuation">,</span><span class="token punctuation">[</span>di<span class="token punctuation">]</span>
但asm不能这样写，因为此时cs:会被解析类似s:的含义
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/86/Ay2TiTBO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="jmp_684"></a>jmp的机器码与长短跳转</h3> 
<pre><code class="prism language-sql"><span class="token comment">##	近跳转</span>
jmp short s			<span class="token comment">-- EB 03    此处的03 代表ip(下条指令)加几的数，取决于此指令和s对应指令之间的机器码个数</span>
<span class="token keyword">add</span> ax<span class="token punctuation">,</span><span class="token number">1</span>			<span class="token comment">-- 05 01 00							|</span>
s: inc ax			<span class="token comment">-- 40							    |</span>
<span class="token comment">#													   V</span>
<span class="token comment">#												因此最大机器码个数为FF个(255)</span>


近跳转也可以
jmp near ptr s    <span class="token comment">-- 区别  EB XX 90,也就是在后面会补一个nop(机器码90)指令</span>

<span class="token comment">##	远跳转</span>
jmp far ptr s					<span class="token comment">-- EA 0C 01 6A 07     -u 显示为 jmp   076A:010C 不再是相对此指令的距离</span>
db <span class="token number">256</span> dup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
s: inc ax      <span class="token number">076</span>A:<span class="token number">010</span>C



跳转目的到内存地址
一直数据段 <span class="token number">23</span>DF:<span class="token number">0000</span> <span class="token number">12</span> <span class="token number">32</span> <span class="token number">55</span> <span class="token number">00</span>
jmp word ptr ds:<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">-- word 表示读取ds:[1]的两个字节(高低八位)作为jmp的偏移地址 即 jmp  5532</span>

对应debug版本写法  
<span class="token operator">-</span>a
	ds:
	jmp word ptr <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	
	
若要远跳转即想改变cs
	已知ds:<span class="token number">0000</span>  <span class="token number">01</span> <span class="token number">23</span> <span class="token number">66</span> <span class="token number">55</span>
	jmp dword ptr ds:<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>     <span class="token comment">-- 此指令效果相当于, ip=2301, cs=5566</span>
	<span class="token comment">-- 想要给ds:0000写入 00 00, 写法为：</span>
		mov word ptr ds:<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span>



</code></pre> 
<h3><a id="font_coloryellowdbfont_725"></a>数组<font color="yellow">(本质就是偏移字节<code>[]</code>和偏移地址的转换,只有db的<code>[]</code>才真是数组下标)</font></h3> 
<pre><code class="prism language-sql"><span class="token keyword">data</span>：	
    arr db <span class="token string">"a234"</span>
    arr1 dw <span class="token string">"哈"</span><span class="token punctuation">,</span><span class="token string">"在"</span>   <span class="token comment">-- asm是gbk编码才可以,就是相当于 arr1 dw 0B9FEh,0D4DAh</span>
    arr2 dd <span class="token number">2222</span>h<span class="token punctuation">,</span><span class="token string">"哈"</span><span class="token punctuation">,</span><span class="token string">"哈"</span>
    arr3 dq <span class="token number">2222</span>h
code：
    mov ax<span class="token punctuation">,</span><span class="token keyword">type</span> arr			即 mov ax<span class="token punctuation">,</span><span class="token number">0001</span>	<span class="token comment">-- 一维数组</span>
    mov ax<span class="token punctuation">,</span><span class="token keyword">type</span> arr1		即 mov ax<span class="token punctuation">,</span><span class="token number">0002</span>	<span class="token comment">-- 二维数组</span>
    mov ax<span class="token punctuation">,</span><span class="token keyword">type</span> arr2		即 mov ax<span class="token punctuation">,</span><span class="token number">0004</span>	<span class="token comment">-- 四维数组</span>
    mov ax<span class="token punctuation">,</span><span class="token keyword">type</span> arr3		即 mov ax<span class="token punctuation">,</span><span class="token number">0008</span>	<span class="token comment">-- 八维数组</span>


___________________________________________________________________________________________
<span class="token keyword">data</span>：
    arr db <span class="token string">"a234"</span>
    arr1 dw <span class="token string">"哈"</span><span class="token punctuation">,</span><span class="token string">"在"</span>  <span class="token comment">-- asm是gbk编码才可以</span>
    arr2 dd <span class="token number">2222</span>h<span class="token punctuation">,</span><span class="token number">36</span>
    arr3 dq <span class="token number">2222</span>h
code：
<span class="token comment">-- 中括号内代表arr的字节位,不是字符位,作此运算前一定要先把stack--&gt;ds</span>
    mov al<span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token punctuation">[</span>arr<span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">]</span>	 即 mov al<span class="token punctuation">,</span><span class="token string">'a'</span>的ASCII值<span class="token punctuation">(</span>位置在此时的ds:xx处，xx是arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>所在的偏移地址<span class="token punctuation">)</span>
    mov arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>al			相当与写入数组的操作
    mov ax<span class="token punctuation">,</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>			即 mov ax<span class="token punctuation">,</span><span class="token string">'哈'</span>的gbk值<span class="token punctuation">(</span>位置在此时的ds:xx处，xx是arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>所在的偏移地址<span class="token punctuation">)</span>
    mov ax<span class="token punctuation">,</span>arr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>			即 mov ax<span class="token punctuation">,</span><span class="token string">'在'</span>的gbk值<span class="token punctuation">(</span>位置在此时的ds:xx处，xx是arr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>所在的偏移地址<span class="token punctuation">)</span>
    
    mov word ptr arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
    mov byte ptr arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>al
    
    mov ax<span class="token punctuation">,</span>word ptr arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      	
    mov al<span class="token punctuation">,</span>byte ptr arr3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  		

</code></pre> 
<h3><a id="debugAAAcom_763"></a>用debug写一个打印AAA.com程序</h3> 
<pre><code class="prism language-sql"><span class="token operator">-</span>e <span class="token number">0130</span> <span class="token string">"AAA$"</span>		<span class="token comment"># 0130会当作ds的偏移地址</span>
<span class="token operator">-</span>d <span class="token number">100</span>
<span class="token number">0</span>F2F:<span class="token number">0100</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0110</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0120</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0130</span>	<span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">24</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>		<span class="token comment">-- 即AAA$</span>
<span class="token number">0</span>F2F:<span class="token number">0140</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token operator">-</span>a
<span class="token number">0</span>F2F:<span class="token number">0100</span> mov dx<span class="token punctuation">,</span><span class="token number">0130</span>	<span class="token comment">-- (数据地址)</span>
<span class="token number">0</span>F2F:<span class="token number">0103</span> mov ah<span class="token punctuation">,</span><span class="token number">09</span>		<span class="token comment">-- (代表输出ds:dx的字符串，$结束标志)</span>
<span class="token number">0</span>F2F:<span class="token number">0105</span> <span class="token keyword">int</span> <span class="token number">21</span>		<span class="token comment">-- (退出程序)</span>
<span class="token number">0</span>F2F:<span class="token number">0107</span> mov ah<span class="token punctuation">,</span><span class="token number">4</span>c 	<span class="token comment">-- (扫尾)</span>
<span class="token number">0</span>F2F:<span class="token number">0109</span> <span class="token keyword">int</span> <span class="token number">21</span>
<span class="token number">0</span>F2F:<span class="token number">010</span>B 
<span class="token operator">-</span>d <span class="token number">100</span>
<span class="token number">0</span>F2F:<span class="token number">0100</span>	BA <span class="token number">30</span> <span class="token number">01</span> B4 <span class="token number">09</span> CD <span class="token number">21</span> B4<span class="token operator">-</span><span class="token number">4</span>C CD <span class="token number">21</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0110</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0120</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token number">0</span>F2F:<span class="token number">0130</span>	<span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">24</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	<span class="token comment">-- 即AAA$</span>
<span class="token number">0</span>F2F:<span class="token number">0140</span>	<span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span><span class="token operator">-</span><span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>
<span class="token operator">-</span>r
CX <span class="token number">0000</span>
:<span class="token number">34</span>		<span class="token comment">-- 表示机器码的长度</span>
<span class="token operator">-</span>n C:\AAA<span class="token punctuation">.</span>com <span class="token comment">#保存为文件，其中没有ds的信息,因为dubug默认打开DS=CS</span>
<span class="token operator">-</span>w
<span class="token operator">-</span>q

C:\<span class="token operator">&gt;</span>AAA<span class="token punctuation">.</span>COM
AAA
C:\<span class="token operator">&gt;</span>

<span class="token comment">-- DOS默认打开时DS=CS,而IP默认等于0100</span>
以上代码还可以进一步压缩和优化，<span class="token number">0110</span><span class="token operator">-</span><span class="token number">0120</span>空间用不到都浪费了
还有一点性能快慢问题<span class="token punctuation">,</span> 立即数<span class="token operator">&gt;</span>寄存器<span class="token operator">&gt;</span>内存<span class="token punctuation">,</span>com文件默认打开的CS<span class="token operator">=</span>DS<span class="token punctuation">,</span>IP偏移为<span class="token number">0100</span><span class="token punctuation">,</span>优化后的com文件用winhex打开如下:
<span class="token keyword">Offset</span>      <span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">2</span>  <span class="token number">3</span>  <span class="token number">4</span>  <span class="token number">5</span>  <span class="token number">6</span>  <span class="token number">7</span>   <span class="token number">8</span>  <span class="token number">9</span>  A  B  C  D  E  F
<span class="token number">00000000</span>   BA <span class="token number">0</span>B <span class="token number">01</span> B4 <span class="token number">09</span> CD <span class="token number">21</span> B4  <span class="token number">4</span>C CD <span class="token number">21</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">24</span>  
BA <span class="token number">0</span>B <span class="token number">01</span> 表示dx<span class="token operator">=</span><span class="token number">010</span>B
B4 <span class="token number">09</span>	表示AH<span class="token operator">=</span><span class="token number">09</span>
CD <span class="token number">21</span>	表示<span class="token keyword">int</span> <span class="token number">21</span>H
B4  <span class="token number">4</span>C	表示AH<span class="token operator">=</span><span class="token number">4</span>c
<span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">41</span> <span class="token number">24</span>	表示 AAAA$ 的ASCII
</code></pre> 
<h3><a id="exe_809"></a>用编译器写一个打印程序，直接运行编译后的exe文件</h3> 
<pre><code class="prism language-sql">assume ds:<span class="token keyword">data</span><span class="token punctuation">,</span>cs:code

<span class="token keyword">data</span> segment				
	str db <span class="token string">"hello world"</span><span class="token punctuation">,</span><span class="token string">"$"</span><span class="token punctuation">(</span><span class="token number">36</span>、<span class="token number">24</span>H均可<span class="token punctuation">)</span>  <span class="token comment">-- 打印时遇到24会停止,想换行用0ah	</span>
<span class="token keyword">data</span> ends

code segment
<span class="token keyword">start</span>:
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>				<span class="token comment">-- 将数据段地址赋给ax</span>
	mov ds<span class="token punctuation">,</span>ax				<span class="token comment">-- 将数据段地址赋给ds</span>
	mov dx<span class="token punctuation">,</span><span class="token keyword">offset</span> str
	mov ah<span class="token punctuation">,</span><span class="token number">9</span>					
	<span class="token keyword">int</span> <span class="token number">21</span>h					<span class="token comment">-- 根据ah值,会自动打印ds:dx往后的字节直到24h</span>
	mov ah<span class="token punctuation">,</span><span class="token number">4</span>ch
	<span class="token keyword">int</span> <span class="token number">21</span>h					<span class="token comment">-- 根据ah值,做程序退出处理,移交CPU控制权还给启动自身的程序	</span>
code ends
<span class="token keyword">end</span> <span class="token keyword">start</span>
</code></pre> 
<h2> 8086cpu打印原理 </h2> 
<pre><code class="prism language-xml-dtd">b800h段存放程序退出中断时的屏幕输出信息,可以用es把数据写到这个区域，写其他区域不行
屏幕
左上角字符对应的ASCII码存放在偏移00a0
左上角第二行偏移是  00a0+00a0
右上角偏移是00a0h+00a0-0002
左下角偏移是00a0h*0018h		#其实左下角是00ah*0019h,不过程序返回时接手程序又把最后一行像素重写了
右下角偏移是00a0h*0019h-2h	#同理右下角想回显也只能往上提一行
每一行像素的和正好也是是AOh个，0b800:00a0的 word值高位是属性信息,低位是 Ascii


高八位解析
7 		6 		5		4	 	3 		2		1		0
BL 		R————————G————————B		 I		 R————————G————————B
闪烁为1 	  	 背景色 		   高亮为1  		 字符颜色
</code></pre> 
<pre><code class="prism language-sql">        mov ax<span class="token punctuation">,</span> <span class="token number">0</span>b800h			
        mov es<span class="token punctuation">,</span> ax		  	
		
		mov ah<span class="token punctuation">,</span><span class="token number">01010000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"L"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0010</span>H<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">01010000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"O"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0010</span>H<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">01010000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"V"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0010</span>H<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov al<span class="token punctuation">,</span><span class="token string">"E"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0010</span>H<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		<span class="token comment">-- 可以用loop循环或者栈或者movsb/movsw</span>
		mov ah<span class="token punctuation">,</span><span class="token number">00110000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"H"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0018</span>H<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">00110000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"E"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0018</span>h<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">01010000</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"L"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0018</span>h<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">00000111</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"L"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0018</span>h<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		mov ah<span class="token punctuation">,</span><span class="token number">10110010</span>b
		mov al<span class="token punctuation">,</span><span class="token string">"O"</span>
		mov es:<span class="token punctuation">[</span><span class="token number">00</span>a0h<span class="token operator">*</span><span class="token number">0018</span>h<span class="token operator">+</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ax
		
		屏幕打印和ES没关系<span class="token punctuation">,</span>和cpu显存制造初始任务定义的物理地址才有关
		也就是
		mov ax<span class="token punctuation">,</span><span class="token number">0</span>
		mov es<span class="token punctuation">,</span>ax
		mov ax<span class="token punctuation">,</span><span class="token number">4</span>c00h
		<span class="token keyword">int</span> <span class="token number">21</span>h	
		<span class="token punctuation">;</span>输出结果如下图
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/be/MBWo8xcQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_900"></a>注释</h3> 
<pre><code class="prism language-sql"><span class="token punctuation">;</span>kjlsahjsfhashjfkhj		<span class="token comment">-- 分号直到换行进行单行注释</span>
<span class="token keyword">comment</span><span class="token operator">*</span>多行注释可换行<span class="token operator">*</span><span class="token keyword">comment</span>  	<span class="token comment">--comment是关键字不能随便改</span>

</code></pre> 
<h3><a id="ASCII_908"></a>ASCII</h3> 
<pre><code class="prism language-sql">已知ASCII码	
大写字母ASCII <span class="token operator">+</span> <span class="token number">20</span>H  <span class="token operator">=</span> 小写字母ASCII

A<span class="token operator">-</span>Z		xx0xxxxx		
a<span class="token operator">-</span>z		xx1xxxxx
<span class="token number">20</span>H		<span class="token number">00100000</span>	即空格ASCII<span class="token punctuation">,</span>与或 <span class="token number">00100000</span>B 运算是自己
小写字母转大写即
减 <span class="token number">00100000</span><span class="token punctuation">,</span>结果和与运算即 <span class="token operator">and</span> <span class="token number">11011111</span>B没区别<span class="token punctuation">,</span>节省性能开销
大写转大写也可以用	<span class="token operator">and</span> <span class="token number">11011111</span>B

同理
字母转小写
<span class="token operator">or</span> <span class="token number">00100000</span>B

总结
<span class="token operator">and</span> <span class="token number">11011111</span>B <span class="token comment">-- 转大写</span>
<span class="token operator">or</span>  <span class="token number">00100000</span>B <span class="token comment">-- 转小写</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/08/VdVY4ez5_o.jpg" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token comment">-- -------------------------------数组转大小写输出-----------------------------------------------------</span>
assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span>

<span class="token keyword">data</span> segment
	str db <span class="token string">'heLLo World'</span><span class="token punctuation">,</span><span class="token string">'$'</span>
<span class="token keyword">data</span> ends

codesg segment
	<span class="token keyword">start</span>:	
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>			<span class="token comment">-- data 是段地址</span>
	mov ds<span class="token punctuation">,</span>ax
	
	mov bx<span class="token punctuation">,</span><span class="token number">0</span>
	mov cx<span class="token punctuation">,</span><span class="token number">11</span>			<span class="token comment">-- 循环次数，即数组长度</span>
	s:
		mov al<span class="token punctuation">,</span><span class="token punctuation">[</span>bx<span class="token punctuation">]</span>		<span class="token comment">-- ds:[bx]的值</span>
		<span class="token operator">or</span> al<span class="token punctuation">,</span><span class="token number">0100000</span>B		<span class="token comment">-- or转小写，and转大写</span>
		mov <span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">,</span>al		<span class="token comment">-- 写入ds:[bx]的值</span>
		inc bx
		<span class="token keyword">loop</span> s
		
		<span class="token punctuation">;</span>mov dx<span class="token punctuation">,</span><span class="token keyword">offset</span> str <span class="token comment">-- 单行注释，str代表str[0]的字节偏移地址</span>
		lea dx<span class="token punctuation">,</span>str		  <span class="token comment">-- 等价上面写法</span>
		mov ah<span class="token punctuation">,</span><span class="token number">09</span>h
		<span class="token keyword">int</span> <span class="token number">21</span>H

		mov ah<span class="token punctuation">,</span><span class="token number">4</span>ch
		<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>

</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- -------------------------------数组求最大ASCII值字符并输出------------------------------------------</span>
assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span>

<span class="token keyword">data</span> segment
	str db <span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'$$'</span>
<span class="token keyword">data</span> ends

codesg segment
	<span class="token keyword">start</span>:	
	
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
	mov ds<span class="token punctuation">,</span>ax
	
	mov bx<span class="token punctuation">,</span><span class="token keyword">offset</span> str		<span class="token comment">-- str代表str[0]的字节偏移地址</span>
	mov cx<span class="token punctuation">,</span><span class="token number">11</span>
	mov ah<span class="token punctuation">,</span><span class="token number">0</span>
	s:
		mov al<span class="token punctuation">,</span><span class="token punctuation">[</span>bx<span class="token punctuation">]</span>
		cmp ah<span class="token punctuation">,</span>al
		jnb s1		<span class="token comment">-- 不小于则跳转</span>
		mov ah<span class="token punctuation">,</span>al
		
	s1:
		
		inc bx
		<span class="token keyword">loop</span> s
		
		mov <span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">,</span>ah		<span class="token comment">-- 或者 mov al,24h  然后 mov [bx],ah mov [bx+1],al</span>
		mov dx<span class="token punctuation">,</span>bx
		mov ah<span class="token punctuation">,</span><span class="token number">9</span>
		<span class="token keyword">int</span> <span class="token number">21</span>H

		mov ah<span class="token punctuation">,</span><span class="token number">4</span>cH
		<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>

</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- -------------------------------数组求和并输出------------------------------------------</span>

assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>ss:stack

stack segment
	db <span class="token number">0</span>fff1h dup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
stack ends

<span class="token keyword">data</span> segment
	str db <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'$'</span>
	db <span class="token number">0</span>fff1h<span class="token operator">-</span><span class="token number">9</span> dup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>			<span class="token punctuation">;</span><span class="token comment">-- 因为上面写了9个字节所以减9</span>
<span class="token keyword">data</span> ends

codesg segment
	<span class="token keyword">start</span>:	
	mov ax<span class="token punctuation">,</span>stack
	mov ss<span class="token punctuation">,</span>ax
	mov sp<span class="token punctuation">,</span><span class="token number">8000</span>H
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
	mov ds<span class="token punctuation">,</span>ax			
	
	<span class="token punctuation">;</span><span class="token comment">###################### 上面是初始化模板 #######################</span>
	
	mov bx<span class="token punctuation">,</span><span class="token keyword">offset</span> str		<span class="token punctuation">;</span><span class="token comment">-- str代表第一个的字节偏移地址,即str[0]也是[str+0]，ds:str的值机器码为01</span>
	mov cx<span class="token punctuation">,</span><span class="token number">8</span>				
	mov al<span class="token punctuation">,</span><span class="token number">0</span>
	s:
		<span class="token keyword">add</span> al<span class="token punctuation">,</span><span class="token punctuation">[</span>bx<span class="token punctuation">]</span>
		inc bx
		<span class="token keyword">loop</span> s
		
		mov <span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">,</span>al		<span class="token comment">-- 低八位一个字节</span>
		mov byte ptr <span class="token punctuation">[</span>bx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">24</span>h			<span class="token punctuation">;</span><span class="token comment">-- 24h即'$',只有一位字节</span>
		
		mov dx<span class="token punctuation">,</span>bx
		mov ah<span class="token punctuation">,</span><span class="token number">9</span>
		<span class="token keyword">int</span> <span class="token number">21</span>H
		
		mov ah<span class="token punctuation">,</span><span class="token number">4</span>cH
		<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>

数组的拷贝	bx用作循环因子
        mov al<span class="token punctuation">,</span><span class="token punctuation">[</span>arr1<span class="token operator">+</span>bx<span class="token punctuation">]</span>
        mov <span class="token punctuation">[</span>arr2<span class="token operator">+</span>bx<span class="token punctuation">]</span><span class="token punctuation">,</span>al
        inc bx		
反转拷贝
		
		mov cx<span class="token punctuation">,</span>xxx  <span class="token comment">-- xxxx是arr1数组的长度</span>
		mov bx<span class="token punctuation">,</span><span class="token number">0</span> 
		mov di<span class="token punctuation">,</span>xxx  <span class="token comment">-- xxx是arr1数组的长度减1</span>
		s:
		mov al<span class="token punctuation">,</span><span class="token punctuation">[</span>arr1<span class="token operator">+</span>bx<span class="token punctuation">]</span>
		mov <span class="token punctuation">[</span>arr2<span class="token operator">+</span>di<span class="token punctuation">]</span><span class="token punctuation">,</span>al
		inc bx
		mov di<span class="token punctuation">,</span>xxx	<span class="token comment">-- xxx是arr1数组的长度减1</span>
		sub di<span class="token punctuation">,</span>bx	
		<span class="token keyword">loop</span> s
<span class="token comment">#########或者</span>
		mov si<span class="token punctuation">,</span><span class="token number">0</span>
		mov di<span class="token punctuation">,</span>xx <span class="token comment">-- xx就是要拷贝的数组arr1的长度减1</span>
		s:
		mov al<span class="token punctuation">,</span><span class="token punctuation">[</span>arr1<span class="token operator">+</span>si<span class="token punctuation">]</span>
		mov <span class="token punctuation">[</span>arr2<span class="token operator">+</span>di<span class="token punctuation">]</span><span class="token punctuation">,</span>al
		inc si
		<span class="token keyword">dec</span> di
		<span class="token keyword">loop</span> s
<span class="token comment">#########或者用栈,栈只适合作用word型,栈十分适合反转word数组，因为先push的最后pop</span>
	arr1 dw <span class="token number">0001</span><span class="token punctuation">,</span><span class="token number">0002</span><span class="token punctuation">,</span><span class="token number">0003</span><span class="token punctuation">,</span><span class="token number">0004</span><span class="token punctuation">,</span><span class="token number">0005</span>
    arr2 dw <span class="token number">0</span>
    
    
   	mov cx<span class="token punctuation">,</span><span class="token number">5</span>  <span class="token punctuation">;</span><span class="token comment">-- 是arr1数组的字符长度</span>
	mov si<span class="token punctuation">,</span><span class="token keyword">offset</span> arr1
	mov di<span class="token punctuation">,</span><span class="token number">9</span>	<span class="token punctuation">;</span> <span class="token comment">-- 9 是arr1的字节长度减1</span>
	
	s:
	push  word ptr <span class="token punctuation">[</span>arr1<span class="token operator">+</span>si<span class="token punctuation">]</span>	<span class="token comment">-- push和pop只能作用word不能作用byte</span>
	pop  word ptr <span class="token punctuation">[</span>arr2<span class="token operator">+</span>di<span class="token punctuation">]</span>
	<span class="token keyword">add</span> si<span class="token punctuation">,</span><span class="token number">2</span>
	sub di<span class="token punctuation">,</span><span class="token number">2</span>
	<span class="token keyword">loop</span> s
<span class="token comment">###想作用byte型</span>
	mov si<span class="token punctuation">,</span>xx
	mov ds:<span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>al
	
</code></pre> 
<h3><a id="_1097"></a>双循环</h3> 
<pre><code class="prism language-sql">外<span class="token number">5</span>内<span class="token number">5</span>

mov ax<span class="token punctuation">,</span><span class="token number">0</span>
mov dx<span class="token punctuation">,</span><span class="token number">0</span>
mov cx<span class="token punctuation">,</span><span class="token number">5</span>
<span class="token keyword">for</span>:
	mov bx<span class="token punctuation">,</span>cx
	
	mov cx<span class="token punctuation">,</span><span class="token number">5</span>
	<span class="token comment">#-------------------内循环</span>
	for1:
		inc dx
	<span class="token keyword">loop</span> for1
	<span class="token comment">#-------------------内循环</span>
	mov cx<span class="token punctuation">,</span>bx
inc ax
<span class="token keyword">loop</span> <span class="token keyword">for</span>
结果ax <span class="token number">5</span>  dx <span class="token number">5</span><span class="token operator">*</span><span class="token number">5</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/e2/P2JgN8WS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1123"></a>二维数组</h3> 
<pre><code class="prism language-sql">
怎么表示
xxx<span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span>f<span class="token punctuation">,</span>a<span class="token punctuation">,</span>s<span class="token punctuation">,</span>d<span class="token punctuation">,</span>f<span class="token punctuation">]</span>
    <span class="token punctuation">]</span>


str db <span class="token string">'123'</span>
    db <span class="token string">'abc'</span>
    db <span class="token string">'9fasdf'</span>

mov al<span class="token punctuation">,</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 	<span class="token comment"># 即al为3对应xxx[0][2]</span>
mov al<span class="token punctuation">,</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>	<span class="token comment"># 即al为'b'对应xxx[1][1]</span>
mov al<span class="token punctuation">,</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>	<span class="token comment"># 即al为'a'对应xxx[2][3]</span>


mov al<span class="token punctuation">,</span>ds:str<span class="token punctuation">[</span>bx<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">]</span>  str<span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span>str<span class="token operator">+</span>bx<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">]</span>  都一样
<span class="token comment">-- -----------------------------------二重循环把指定矩形转大写---------------------------------------</span>

assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>ss:stack
<span class="token keyword">data</span> segmeNT
	str db <span class="token string">'aaaaabbbbbccccc '</span>
	db <span class="token string">'aaaaabbbbbccccc '</span>
	db <span class="token string">'aaaaabbbbbccccc '</span>
	db <span class="token string">'aaaaabbbbbccccc '</span><span class="token punctuation">,</span><span class="token string">'$'</span>

<span class="token keyword">data</span> ends
stack segment
	db <span class="token number">10</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
stack ends
codesg SEgment
	<span class="token keyword">start</span>:	
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
	mov ds<span class="token punctuation">,</span>ax
	
	mov bx<span class="token punctuation">,</span><span class="token number">0</span>
	mov cx<span class="token punctuation">,</span><span class="token number">4</span>
	<span class="token keyword">for</span>:
	      mov dx<span class="token punctuation">,</span>cx
		mov si<span class="token punctuation">,</span><span class="token number">0</span>
		mov cx<span class="token punctuation">,</span><span class="token number">5</span>
		for1:
			mov al<span class="token punctuation">,</span>ds:str<span class="token punctuation">[</span>bx<span class="token operator">+</span>si<span class="token punctuation">]</span>
			<span class="token operator">and</span> al<span class="token punctuation">,</span><span class="token number">11011111</span>B
			mov ds:str<span class="token punctuation">[</span>bx<span class="token operator">+</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>al
		inc si
		<span class="token keyword">loop</span> for1
	     mov cx<span class="token punctuation">,</span>dx
	<span class="token keyword">add</span> bx<span class="token punctuation">,</span><span class="token number">16</span>
	<span class="token keyword">loop</span> <span class="token keyword">for</span>
		
	lea dx<span class="token punctuation">,</span>str	<span class="token punctuation">;</span>即 mov dx<span class="token punctuation">,</span><span class="token keyword">offset</span> str	优相比mov的优点 可以 lea dx<span class="token punctuation">,</span><span class="token punctuation">[</span>str<span class="token operator">-</span><span class="token number">0</span>c5h<span class="token punctuation">]</span>
	mov ah<span class="token punctuation">,</span><span class="token number">9</span>
	<span class="token keyword">int</span> <span class="token number">21</span>H

	mov ah<span class="token punctuation">,</span><span class="token number">4</span>cH
	<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>

</code></pre> 
<h3><a id="font_coloryellowfont_1191"></a><font color="yellow">冒泡排序</font></h3> 
<pre><code class="prism language-sql">
assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>ss:stack
<span class="token keyword">data</span> segmeNT
	arr db <span class="token number">0</span>A2H<span class="token punctuation">,</span><span class="token number">24</span>H<span class="token punctuation">,</span><span class="token number">07</span>H<span class="token punctuation">,</span><span class="token number">3</span>AH<span class="token punctuation">,</span><span class="token number">1</span>BH<span class="token punctuation">,</span><span class="token number">0</span>F1H<span class="token punctuation">,</span><span class="token number">3</span>BH<span class="token punctuation">,</span><span class="token number">25</span>H<span class="token punctuation">,</span><span class="token number">81</span>H
<span class="token keyword">data</span> ends
stack segment
	db <span class="token number">10</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
stack ends
codesg SEgment
	<span class="token keyword">start</span>:	
	mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
	mov ds<span class="token punctuation">,</span>ax
	
	mov bx<span class="token punctuation">,</span><span class="token number">0</span>
	mov cx<span class="token punctuation">,</span><span class="token number">8</span>
	<span class="token keyword">for</span>:
	      mov dx<span class="token punctuation">,</span>cx
		mov si<span class="token punctuation">,</span><span class="token number">8</span>
		mov cx<span class="token punctuation">,</span><span class="token number">8</span>
		sub cx<span class="token punctuation">,</span>bx
		for1:
			mov ah<span class="token punctuation">,</span>ds:arr<span class="token punctuation">[</span>si<span class="token punctuation">]</span>
			mov al<span class="token punctuation">,</span>ds:arr<span class="token punctuation">[</span>si<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
			cmp ah<span class="token punctuation">,</span>al
			jnb <span class="token keyword">all</span>
				xchg ah<span class="token punctuation">,</span>al
				mov ds:arr<span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>ah
				mov ds:arr<span class="token punctuation">[</span>si<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>al				
	
			<span class="token keyword">all</span>:
				
		<span class="token keyword">dec</span> si
		<span class="token keyword">loop</span> for1
	     mov cx<span class="token punctuation">,</span>dx
	<span class="token keyword">add</span> bx<span class="token punctuation">,</span><span class="token number">1</span>
	<span class="token keyword">loop</span> <span class="token keyword">for</span>

	mov ah<span class="token punctuation">,</span><span class="token number">4</span>cH
	<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>
<span class="token comment">-- C++写法</span>
<span class="token keyword">comment</span><span class="token operator">*</span>
	 	bx
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>循环<span class="token number">4</span>次<span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>{
				si
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>循环五次<span class="token punctuation">;</span>j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>{
			arr<span class="token punctuation">[</span>j<span class="token operator">+</span>i<span class="token punctuation">]</span>转大写
		}
	}
	
	
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
		arr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">]</span>转大写

	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>{
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>{
				cout <span class="token operator">&lt;&lt;</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token string">" "</span><span class="token punctuation">;</span>	
}cout<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
}
<span class="token operator">*</span><span class="token keyword">comment</span> 

<span class="token keyword">comment</span><span class="token operator">*</span>
c<span class="token operator">+</span><span class="token operator">+</span>
数组当中的最大值
<span class="token keyword">int</span> res<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token operator">&lt;</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>res<span class="token operator">=</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> res

求最小值
<span class="token keyword">int</span> res<span class="token operator">=</span>FF
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token operator">&gt;</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>res<span class="token operator">=</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> res

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span>转大写
<span class="token operator">*</span><span class="token keyword">comment</span>	

</code></pre> 
<h3><a id="_1275"></a>斐波那契数列求和</h3> 
<pre><code class="prism language-sql">assume cs:code<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>ss:stack
<span class="token keyword">data</span> segment 
	arr dw <span class="token number">1</span>H<span class="token punctuation">,</span><span class="token number">1</span>H<span class="token punctuation">,</span><span class="token number">100</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	res db <span class="token number">800</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">data</span> ends

stack segment 
	db <span class="token number">100</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
stack ends

code segment 
	<span class="token keyword">start</span>:
		mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
		mov ds<span class="token punctuation">,</span>ax
		mov ax<span class="token punctuation">,</span>stack
		mov ss<span class="token punctuation">,</span>ax
		
		mov bx<span class="token punctuation">,</span><span class="token number">4</span>
		mov cx<span class="token punctuation">,</span><span class="token number">30</span>
		<span class="token keyword">for</span> :
			mov dx<span class="token punctuation">,</span><span class="token number">0</span>
			<span class="token keyword">add</span> dx<span class="token punctuation">,</span>ds:arr<span class="token punctuation">[</span>bx<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
			<span class="token keyword">add</span> dx<span class="token punctuation">,</span>ds:arr<span class="token punctuation">[</span>bx<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>
			mov ds:arr<span class="token punctuation">[</span>bx<span class="token punctuation">]</span><span class="token punctuation">,</span>dx
		<span class="token keyword">add</span> bx<span class="token punctuation">,</span><span class="token number">2</span>
		<span class="token keyword">loop</span> <span class="token keyword">for</span>
			
		mov ax<span class="token punctuation">,</span><span class="token number">4</span>c00H
		<span class="token keyword">int</span> <span class="token number">21</span>h
code ends
<span class="token keyword">end</span> <span class="token keyword">start</span>
</code></pre> 
<h3><a id="_1313"></a>十进制转十六进制并输出</h3> 
<pre><code class="prism language-sql">assume cs:codesg<span class="token punctuation">,</span>ds:<span class="token keyword">data</span><span class="token punctuation">,</span>ss:stack
<span class="token keyword">data</span> segmeNT
	str db <span class="token string">'00002333'</span><span class="token punctuation">,</span><span class="token string">'$'</span>
	res db <span class="token string">'0000'</span><span class="token punctuation">,</span><span class="token string">'$'</span>
<span class="token keyword">data</span> ends
stack segment
	db <span class="token number">100</span> dup <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
stack ends
codesg SEgment
	<span class="token keyword">start</span>:	
		mov ax<span class="token punctuation">,</span><span class="token keyword">data</span>
		mov ds<span class="token punctuation">,</span>ax
		mov ax<span class="token punctuation">,</span>stack
		mov ss<span class="token punctuation">,</span>ax		
		mov sp<span class="token punctuation">,</span><span class="token number">10</span>
		mov si<span class="token punctuation">,</span><span class="token number">4</span>

		mov bx<span class="token punctuation">,</span><span class="token number">0</span>
		mov cx<span class="token punctuation">,</span><span class="token number">8</span>
		mov ax<span class="token punctuation">,</span><span class="token number">0</span>
		s:
			mov dx<span class="token punctuation">,</span>ax
			shl ax<span class="token punctuation">,</span><span class="token number">1</span>
			shl ax<span class="token punctuation">,</span><span class="token number">1</span>	
			shl ax<span class="token punctuation">,</span><span class="token number">1</span>
			shl dx<span class="token punctuation">,</span><span class="token number">1</span>
			<span class="token keyword">add</span> ax<span class="token punctuation">,</span>dx
<span class="token punctuation">;</span>乘<span class="token number">10</span>

			<span class="token keyword">add</span> al<span class="token punctuation">,</span>str<span class="token punctuation">[</span>bx<span class="token punctuation">]</span>
			adc ah<span class="token punctuation">,</span><span class="token number">0</span>
			sub ax<span class="token punctuation">,</span><span class="token number">30</span>H		
		
			inc bx 
			<span class="token keyword">loop</span> s
		
<span class="token punctuation">;</span>ax<span class="token operator">=</span><span class="token number">3039</span>
	
		mov cx<span class="token punctuation">,</span><span class="token number">4</span>
		l:
			mov dx<span class="token punctuation">,</span>ax
			<span class="token operator">and</span> dx<span class="token punctuation">,</span><span class="token number">0</span>FH
			<span class="token keyword">add</span> dx<span class="token punctuation">,</span><span class="token number">30</span>H
			cmp dx<span class="token punctuation">,</span><span class="token number">3</span>AH
			jb s1
			<span class="token keyword">add</span> dx<span class="token punctuation">,</span><span class="token number">7</span>H
<span class="token punctuation">;</span>求出<span class="token number">3039</span>的ASCII码，push
		s1:
			<span class="token keyword">dec</span> si
			mov ds:res<span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">,</span>dl
			shr ax<span class="token punctuation">,</span><span class="token number">1</span>
			shr ax<span class="token punctuation">,</span><span class="token number">1</span>
			shr ax<span class="token punctuation">,</span><span class="token number">1</span>
			shr ax<span class="token punctuation">,</span><span class="token number">1</span>
			<span class="token keyword">loop</span> l

		<span class="token punctuation">;</span>mov dx<span class="token punctuation">,</span><span class="token keyword">offset</span> res
	 	lea  dx<span class="token punctuation">,</span>res
		mov ah<span class="token punctuation">,</span><span class="token number">9</span>
		<span class="token keyword">int</span> <span class="token number">21</span>H

		mov ax<span class="token punctuation">,</span><span class="token number">4</span>c00H	<span class="token comment">-- al是返回码</span>
		<span class="token keyword">int</span> <span class="token number">21</span>H
codesg ends
<span class="token keyword">end</span> <span class="token keyword">start</span>
</code></pre> 
<h3><a id="_1383"></a>端口读写</h3> 
<pre><code class="prism language-sql">					端口为word长度 <span class="token number">00000000</span> <span class="token number">00000000</span>
对<span class="token identifier"><span class="token punctuation">`</span>0~255<span class="token punctuation">`</span></span>以内的端口进行读写：

    <span class="token operator">in</span> al<span class="token punctuation">,</span><span class="token number">0020</span>h	<span class="token punctuation">;</span>从<span class="token number">20</span>h端口读入一个字节
    <span class="token keyword">out</span> <span class="token number">0020</span>h<span class="token punctuation">,</span>al  <span class="token punctuation">;</span>往<span class="token number">20</span>h端口写入一个字节

对<span class="token identifier"><span class="token punctuation">`</span>256~65535<span class="token punctuation">`</span></span>的端口进行读写时，端口号放在dX中

    mov dx<span class="token punctuation">,</span><span class="token number">03</span>f8h
    <span class="token operator">in</span> al<span class="token punctuation">,</span>dx<span class="token punctuation">;</span>从<span class="token number">03</span>f8h端口读入一个字节给AL
    <span class="token keyword">out</span> dx<span class="token punctuation">,</span>al<span class="token punctuation">;</span>向<span class="token number">3</span>f8h端口写入一个AL字节
    
 必须用AX和端口交互
 
 	猜测
 	<span class="token operator">in</span> ax<span class="token punctuation">,</span><span class="token number">00</span>ffh 是在ffh端口读两个字节
 	
 	
 	端口<span class="token number">70</span>h是时钟CMOS RAM接口
 		                                    <span class="token number">00</span>   <span class="token number">00</span>    <span class="token number">00</span>   <span class="token number">00</span> 	  <span class="token number">00</span>    <span class="token number">00</span>	  <span class="token number">00</span>
 											  年    月   日    时	 分	   秒
 		      用BCD码判断
 	端口<span class="token number">60</span>h是键盘输入接收端口
</code></pre> 
<h3><a id="font_coloryellowBCDfont_1415"></a><font color="yellow">BCD码</font></h3> 
<p>​ 00010100B表示14（十四）</p> 
<p>​ 10010001B表示91（九十一）</p> 
<p><img src="https://images2.imgbox.com/4c/ea/naEbLZm9_o.png" alt="在这里插入图片描述"></p> 
<p>BCD码值 + 30h = 对应数字的ASCII</p> 
<h3><a id="64_1428"></a><code>64</code>位操作系统的寄存器</h3> 
<p>eax,ebx,ecx,edx，每个可以存8个字节，6A3C 12E9</p> 
<h2>中断向量表</h2> 
<h3><a id="font_coloryellow8086cpu8_int00H__int_FFHfont_1436"></a><font color="yellow"><code>8086</code>cpu中断类型码8位 <code>int00H -- int FFH</code></font></h3> 
<h3><a id="font_coloryellow_00000000000003FFfont_1438"></a><font color="yellow">中断向量表(空间) <code>0000:0000-0000:03FF</code></font></h3> 
<pre><code class="prism language-elixir">0000:0200
之间是空的，可以用于存放用户的中断代码，注意是代码，不是向量，因此应把对应中断的向量表改为此处的CSIP
0000:02FF

2FF-200长度是256个字节,因此机器码长度最后不用超过256
</code></pre> 
<p><img src="https://images2.imgbox.com/95/39/wpZ2LLA4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1457"></a>规律如下</h3> 
<h3><a id="int_00H_csip__00A71068___cs_ip_1459"></a>int <code>00H</code> 即cs:ip 改为 <code>00A7:1068</code>中断时的 标志寄存器的值 和 cs ip保存在栈中了</h3> 
<h3><a id="int_01H_csip__0070018B___cs_ip_1461"></a>int <code>01H</code> 即cs:ip 改为 <code>0070:018B</code>中断时的 标志寄存器的值 和 cs ip保存在栈中了</h3> 
<h3><a id="int_02H_csip__03A50016___cs_ip_1463"></a>int <code>02H</code> 即cs:ip 改为 <code>03A5:0016</code>中断时的 标志寄存器的值 和 cs ip保存在栈中了</h3> 
<h2>中断本质(挂起/退出)</h2> 
<pre><code class="prism language-sql"><span class="token keyword">int</span> N		<span class="token comment">-- 十六进制N	挂起(如果有人iret)、退出(没人iret他的话就是编写退出了,是否回收内存取决于int 几)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>取得中断类型码N
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>pushf		<span class="token comment">-- 标志寄存器入栈</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>TF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">IF</span><span class="token operator">=</span><span class="token number">0</span>	<span class="token comment">--   IF interrupt flag 中断标志IF=l时，允许CPU响应可屏蔽中断，否则关闭中断</span>
   			 	<span class="token comment">--  TF trap flag      用于调试单步操作</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>push CS
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>push IP
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>IP<span class="token operator">=</span><span class="token number">0000</span>:<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>CS<span class="token operator">=</span><span class="token number">0000</span>:<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>	
对应中断类型码查找中断向量表<span class="token punctuation">(</span>位置ES:BX<span class="token punctuation">)</span>赋值CSIP

<span class="token comment"># int 的反操作	 iret				激活原来挂起的程序</span>
恢复中断前的操作<span class="token punctuation">,</span>此指令应放在中断指令紧接着的后方，而不是中断前的源位置
本质
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>	pop ip
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>	pop cs
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>	popf		也就是说<span class="token keyword">int</span>和iret都会改变sp的值<span class="token punctuation">,</span>之所以简化写是因为iret的指令机器码只有一个Byte<span class="token punctuation">(</span>CF<span class="token punctuation">)</span>
														  <span class="token keyword">int</span> <span class="token number">0</span>H 的机器码为 CD <span class="token number">00</span>
	
<span class="token comment">########################################对比call和retf##########################################</span>
<span class="token comment">-- call和ret的本质(在本段跳转)</span>

<span class="token keyword">call</span>  实质是    push ip  <span class="token punctuation">(</span><span class="token keyword">call</span>的下一条指令对应的的ip<span class="token punctuation">)</span>
ret   实质是    pop ip   <span class="token punctuation">(</span>当前ip接收值<span class="token punctuation">)</span>

如果<span class="token keyword">call</span>和ret需要修改段地址CS<span class="token punctuation">,</span>

 <span class="token comment">-- call far ptr s    (跨段跳转)</span>
         先
         push cs 
         push ip<span class="token punctuation">(</span><span class="token keyword">call</span>的下一条指令对应的的ip<span class="token punctuation">)</span>
         再把
         cs:ip指向s:的段地址:偏移地址，debug实例 <span class="token keyword">CALL</span>	<span class="token number">076</span>A:<span class="token number">000</span>F	
    <span class="token comment">-- retf			此指令应放在跳转后的位置,放在跳转前的源位置是错误的做法</span>
		pop ip
         pop cs
</code></pre> 
<h3><a id="int_0Hfont_coloryellowfont_1507"></a>更改<code>int 0H</code>中断的操作<font color="yellow">本质是修改中断向量表段空间</font></h3> 
<pre><code class="prism language-sql">		mov ax<span class="token punctuation">,</span> <span class="token number">0</span>               <span class="token comment">#设置中断向量表</span>
		mov es<span class="token punctuation">,</span> ax
		mov word ptr es:<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> xx		xx是自定义操作代码对应的IP
		mov word ptr es:<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> yy		yy是自定义操作代码对应的CS

</code></pre> 
<h2>手工写一个int 7CH的中断，实现AX转大写</h2> 
<pre><code class="prism language-sql">assume cs:code
code segment
		mov ax<span class="token punctuation">,</span>cs
		mov ds<span class="token punctuation">,</span>ax
		mov si<span class="token punctuation">,</span><span class="token keyword">offset</span> coverA
		
		mov ax<span class="token punctuation">,</span><span class="token number">0</span>
		mov es<span class="token punctuation">,</span>ax
		mov di<span class="token punctuation">,</span><span class="token number">200</span>h
		mov cx<span class="token punctuation">,</span><span class="token keyword">offset</span> len <span class="token operator">-</span> <span class="token keyword">offset</span> coverA
		cld
		rep movsb
		
		mov es:<span class="token punctuation">[</span><span class="token number">7</span>ch<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">200</span>h
		mov word ptr es:<span class="token punctuation">[</span><span class="token number">7</span>ch<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span>h
		mov ax<span class="token punctuation">,</span><span class="token string">'al'</span>
		<span class="token keyword">int</span> <span class="token number">7</span>ch		
		
		mov bx<span class="token punctuation">,</span>cs
		mov ds<span class="token punctuation">,</span>bx
		mov byte ptr ds:<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ah
		mov byte ptr ds:<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>al
		mov byte ptr ds:<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'$'</span>
		mov dx<span class="token punctuation">,</span><span class="token number">0</span>h
		mov ah<span class="token punctuation">,</span><span class="token number">9</span>h
		<span class="token keyword">int</span> <span class="token number">21</span>H
		
		mov ax<span class="token punctuation">,</span><span class="token number">4</span>c00h
		<span class="token keyword">int</span> <span class="token number">21</span>h
	coverA:
		<span class="token comment">-- 这个位置最好这样写，来保护局部变量</span>
		<span class="token comment">-- start: push cx</span>
         <span class="token comment">-- 	  posh si</span>
		<span class="token operator">and</span> ax<span class="token punctuation">,</span><span class="token number">1101111111011111</span>b	<span class="token punctuation">;</span>执行转换从大写，此操作并没有更改cx<span class="token punctuation">,</span>si<span class="token punctuation">,</span>所以就注释了保护局部表里的操作
		<span class="token comment">-- 这个位置最好这样写，来恢复之前的局部变量</span>
		<span class="token comment">-- ok: pop si</span>
		<span class="token comment">-- 	   pop cx</span>
		iret							
	len:
		nop
	code ends
<span class="token keyword">end</span>
		
</code></pre> 
<h2>单步中断`int 01H`</h2> 
<pre><code class="prism language-elixir">标志寄存器的TF位标志单步中断			# 即debug界面的 	-t指令
TF trap flag      用于调试单步操作
CPU执行完指令后检测TF,TF=1则产生单步中断

产生单步中断后的要做动作
	push 标志寄存器
	TF IF 重新设为0
	push CS
	push IP
	(ip)=(1*4),(cs)=(1*4+2) # 根据中断向量表int 01H 记录的信息,将当前CSIP指针指向int 01H机器码指令的位置
																					^
																			  		|
																			  		|
																			  		|
																			  即1号中断处理程序
1号中断处理程序的功能,显示所有寄存器中的内容后，等待输入命令


#特殊情况
当cpu修改SS栈段时,即便检测到 TF=1,也不会触发中断
原因是假如触发中断,
由于sp并没有指向合理的位置,所以会引起错误

因此,修改SP的指令要紧随修改SS的指令,连续存放
</code></pre> 
<p><img src="https://images2.imgbox.com/8c/95/Kv82ShVD_o.png" alt="在这里插入图片描述"></p> 
<h2>中断类型码功能或触发条件</h2> 
<pre><code class="prism language-Q">								中断的作用十分像调用函数
							不同的函数/中断程序封装不同的功能
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/5c/tqXqHD5X_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-SQL">;编程：在屏幕中间依次显示“a”~“z”，并可以让人看清。在显示的过程中，按下'Esc'键后，改变显示的颜色。
;完整功能代码：
assume cs:code

stack segment
	db 128 dup (0)
stack ends

data segment
	dw 0,0
data ends

code segment
start:	
	mov ax,stack
	mov ss,ax
	mov sp,128
	mov ax,data
	mov ds,ax
	mov ax,0
	mov es,ax

	push es:[9*4]
	pop ds:[0]
	push es:[9*4+2]
	pop ds:[2]		;将原来的int 9中断例程的入口地址保存在ds:0、ds:2单元中

	mov word ptr es:[9*4],offset int9
	mov es:[9*4+2],cs	;在中断向量表中设置新的int 9中断例程的入口地址

	mov ax,0b800h
	mov es,ax
	mov ah,'a'
s:	
	mov  es:[160*12+40*2],ah
	call delay
	inc ah
	cmp ah,'z'
	jna s
	mov ax,0
	mov es,ax

	push ds:[0]
	pop es:[9*4]
	push ds;[2]
	pop es;[9*4+2]   	;将中断向量表中int 9中断例程的入口恢复为原来的地址

	mov ax,4c00h
	int 21h

delay:	
	push ax
	push dx
	mov dx,2000h
	mov ax,0
s1: 	
	sub ax,1
	sbb dx,0
	cmp ax,0
	jne s1
	cmp dx,0
	jne s1
	pop dx
	pop ax
	ret

;------以下为新的int 9中断例程--------------------

int9:	
	push ax
	push bx
	push es

	in al,60h

	pushf
	pushf
	pop bx
	and bh,11111100b
	push bx
	popf
	call dword ptr ds:[0] 	;对int指令进行模拟，调用原来的int 9中断例程

	cmp al,1
	jne int9ret

	mov ax,0b800h
	mov es,ax
	inc byte ptr es:[160*12+40*2+1]  ;属性增加1，改变颜色

int9ret:
	pop es
	pop bx
	pop ax
	iret

code ends

end start

</code></pre> 
<h3><a id="80x86_1723"></a><code>80x86</code></h3> 
<table><thead><tr><th>I/O ADDR</th><th>INT TYPE（16进制）</th><th>FUNCTION</th></tr></thead><tbody><tr><td>00 ~ 03</td><td>0</td><td>除法溢出中断</td></tr><tr><td>04 ~ 07</td><td>1</td><td>单步(用于DEBUG)</td></tr><tr><td>08 ~ 0B</td><td>2</td><td>非屏蔽中断(NMI)</td></tr><tr><td>0C ~ 0F</td><td>3</td><td><strong><a href="https://baike.baidu.com/item/%E6%96%AD%E7%82%B9" rel="nofollow">断点</a>中断(用于DEBUG)</strong></td></tr><tr><td>10 ~ 13</td><td>4</td><td>溢出中断</td></tr><tr><td>14 ~ 17</td><td>5</td><td>打印屏幕</td></tr><tr><td>18 ~ 1F</td><td>6/7</td><td>保留</td></tr></tbody></table> 
<h4><a id="8259_1737"></a><code>8259</code>主片</h4> 
<table><thead><tr><th>I/O ADDR</th><th>INT TYPE（16进制）</th><th>FUNCTION</th></tr></thead><tbody><tr><td>20 ~ 23</td><td>8</td><td>定时器（IRQ0）</td></tr><tr><td>24 ~ 27</td><td>9</td><td>键盘（IRQ1）</td></tr><tr><td>28 ~ 2B</td><td>A</td><td>彩色/图形（IRQ2）</td></tr><tr><td>2C ~ 2F</td><td>B</td><td>串行通信COM2（IRQ3）</td></tr><tr><td>30 ~ 33</td><td>C</td><td>串行通信COM1（IRQ4）</td></tr><tr><td>34 ~ 37</td><td>D</td><td>LPT2控制器中断（IRQ5）</td></tr><tr><td>38 ~ 3B</td><td>E</td><td>磁盘控制器中断（IRQ6）</td></tr><tr><td>3C ~ 3F</td><td>F</td><td>LPT1控制器中断（IRQ7）</td></tr></tbody></table> 
<h4><a id="BIOS_1752"></a>BIOS</h4> 
<table><thead><tr><th>I/O ADDR</th><th>INT TYPE（16进制）</th><th>FUNCTION</th></tr></thead><tbody><tr><td>40 ~43</td><td>10</td><td>视频显示 I/O根据ax,bx,dx等确定干啥</td></tr><tr><td>44 ~ 47</td><td>11</td><td>设备检验</td></tr><tr><td>48 ~ 4B</td><td>12</td><td>测定<a href="https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E5%99%A8" rel="nofollow">存储器</a>容量</td></tr><tr><td>4C ~ 4F</td><td>13</td><td>磁盘 I/O</td></tr><tr><td>50 ~ 53</td><td>14</td><td><a href="https://baike.baidu.com/item/RS-232" rel="nofollow">RS-232</a> <a href="https://baike.baidu.com/item/%E4%B8%B2%E8%A1%8C%E5%8F%A3" rel="nofollow">串行口</a> I/O</td></tr><tr><td>54 ~ 57</td><td>15</td><td>系统描述表<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88" rel="nofollow">指针</a></td></tr><tr><td>58 ~ 5B</td><td>16</td><td>键盘 I/O</td></tr><tr><td>5C ~ 5F</td><td>17</td><td>打印机 I/O</td></tr><tr><td>60 ~ 63</td><td>18</td><td>ROM BASIC 入口代码</td></tr><tr><td>64 ~ 67</td><td>19</td><td>引导装入程序</td></tr><tr><td>68 ~ 6B</td><td>1A</td><td>日时钟</td></tr></tbody></table> 
<h4><a id="_1770"></a>提供用户中断</h4> 
<table><thead><tr><th>I/O ADDR</th><th>INT TYPE（16进制）</th><th>FUNCTION</th></tr></thead><tbody><tr><td>6C ~ 6F</td><td>1B</td><td>Ctrl - Break 控制的<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%B8%AD%E6%96%AD" rel="nofollow">软中断</a></td></tr><tr><td>70 ~ 73</td><td>1C</td><td><a href="https://baike.baidu.com/item/%E5%AE%9A%E6%97%B6%E5%99%A8" rel="nofollow">定时器</a>控制的<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%B8%AD%E6%96%AD" rel="nofollow">软中断</a></td></tr><tr><td>74 ~ 77</td><td>1D</td><td>视频参数块</td></tr><tr><td>78 ~ 7B</td><td>1E</td><td>软盘参数块</td></tr><tr><td>7C ~ 7F</td><td>1F</td><td>图形字符扩展码</td></tr></tbody></table> 
<p>在DOS系统（实模式）下，从0x20开始，用于操作系统本身。</p> 
<h4><a id="DOS_1784"></a>DOS</h4> 
<table><thead><tr><th>I/O ADDR</th><th>INT TYPE（16进制）</th><th>FUNCTION</th></tr></thead><tbody><tr><td>80 ~ 83</td><td>20</td><td>DOS 中断返回</td></tr><tr><td>84 ~ 87</td><td>21</td><td><strong>DOS 系统功能调用</strong></td></tr><tr><td>88 ~ 8B</td><td>22</td><td>程序中止时 DOS 返回地址(用户不能直接调用)</td></tr><tr><td>8C ~ 8F</td><td>23</td><td>Ctrl - Break 处理地址(用户不能直接调用)</td></tr><tr><td>90 ~ 93</td><td>24</td><td>严重错误处理(用户不能直接调用)</td></tr><tr><td>94 ~ 97</td><td>25</td><td>绝对磁盘读功能</td></tr><tr><td>98 ~ 9B</td><td>26</td><td>绝对磁盘写功能</td></tr><tr><td>9C ~ 9F</td><td>27</td><td>终止并<a href="https://baike.baidu.com/item/%E9%A9%BB%E7%95%99%E7%A8%8B%E5%BA%8F" rel="nofollow">驻留程序</a></td></tr><tr><td>A0 ~ A3</td><td>28</td><td>DOS安全使用</td></tr></tbody></table> 
<table><thead><tr><th>A4 ~ A7</th><th>29</th><th>快速写字符</th></tr></thead><tbody><tr><td>A8 ~ AB</td><td>2A</td><td>Microsoft 网络接口</td></tr><tr><td>B8 ~ BB</td><td>2E</td><td>基本 SHELL 程序装入</td></tr><tr><td>BC ~ BF</td><td>2F</td><td>多路服务中断</td></tr><tr><td>CC ~ CF</td><td>33</td><td>鼠标中断</td></tr><tr><td>104 ~ 107</td><td>41</td><td>硬盘参数块</td></tr><tr><td>118 ~ 11B</td><td>46</td><td>第二硬盘参数块</td></tr><tr><td>11C ~ 3FF</td><td>47 ~ FF</td><td>BASIC 中断</td></tr></tbody></table> 
<h4><a id="_1810"></a>保护模式</h4> 
<p>在Linux下（保护模式），没有使用BIOS设置的中断向量表，0x00 ~ 0x1F是CPU保护模式下的默认中断向量，而0x20开始，都是被Linux系统重新设置的。</p> 
<p>X86占用的中断向量表如下：</p> 
<table><thead><tr><th align="left">向量号</th><th align="left">助记符</th><th align="left">说明</th><th align="left">类型</th><th align="left">错误号</th><th align="left">产生源</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">#DE</td><td align="left">除出错</td><td align="left">故障</td><td align="left">无</td><td align="left">DIV或IDIV指令。</td></tr><tr><td align="left">1</td><td align="left">#DB</td><td align="left">调试</td><td align="left">故障/陷阱</td><td align="left">无</td><td align="left">任何代码或数据引用，或是INT 1指令。</td></tr><tr><td align="left">2</td><td align="left">–</td><td align="left">NMI中断</td><td align="left">中断</td><td align="left">无</td><td align="left">非屏蔽外部中断。</td></tr><tr><td align="left">3</td><td align="left">#BP</td><td align="left">断点</td><td align="left">陷阱</td><td align="left">无</td><td align="left">INT 3指令。</td></tr><tr><td align="left">4</td><td align="left">#OF</td><td align="left">溢出</td><td align="left">陷阱</td><td align="left">无</td><td align="left">INTO指令。</td></tr><tr><td align="left">5</td><td align="left">#BR</td><td align="left">边界范围超出</td><td align="left">故障</td><td align="left">无</td><td align="left">BOUND指令。</td></tr><tr><td align="left">6</td><td align="left">#UD</td><td align="left">无效操作码</td><td align="left">故障</td><td align="left">无</td><td align="left">UD2指令或保留的操作码。</td></tr><tr><td align="left">7</td><td align="left">#NM</td><td align="left">设备不存在</td><td align="left">故障</td><td align="left">无</td><td align="left">浮点或WAIT/FWAIT指令。</td></tr><tr><td align="left">8</td><td align="left">#DF</td><td align="left">双重错误</td><td align="left">异常终止</td><td align="left">有（0）</td><td align="left">任何可产生异常、NMI或INTR的指令。</td></tr><tr><td align="left">9</td><td align="left">–</td><td align="left">协处理器段超越（保留）</td><td align="left">故障</td><td align="left">无</td><td align="left">浮点指令</td></tr></tbody></table> 
<table><thead><tr><th>10</th><th>#TS</th><th>无效的任务状态段TSS</th><th>故障</th><th>有</th><th>任务交换或访问TSS</th></tr></thead><tbody><tr><td>11</td><td>#NP</td><td>段不存在</td><td>故障</td><td>有</td><td>加载段寄存器或访问系统段</td></tr><tr><td>12</td><td>#SS</td><td>堆栈段错误</td><td>故障</td><td>有</td><td>堆栈操作或SS寄存器加载</td></tr><tr><td>13</td><td>#GP</td><td>一般保护错误</td><td>故障</td><td>有</td><td>任何内存引用和其他保护检查</td></tr><tr><td>14</td><td>#PF</td><td>页面错误</td><td>故障</td><td>有</td><td>任何内存引用</td></tr><tr><td>15</td><td>–</td><td>（intel保留）</td><td></td><td>无</td><td></td></tr><tr><td>16</td><td>#MF</td><td>x87 FPU浮点错误</td><td>故障</td><td>无</td><td></td></tr><tr><td>17</td><td>#AC</td><td>对齐检查</td><td>故障</td><td>有（0）</td><td>对内存中任何数据的引用。</td></tr><tr><td>18</td><td>#MC</td><td>机器检查</td><td>异常终止</td><td>无</td><td>错误码（若有）和产生源与CPU类型有关。</td></tr><tr><td>19</td><td>#XF</td><td>SIMD浮点异常</td><td>故障</td><td>无</td><td></td></tr></tbody></table> 
<h2>INT 21H的功能</h2> 
<table><tbody><tr><td> AH </td><td> 功能 </td><td> 调用参数 </td><td> 返回参数 </td></tr><tr><td> 00 </td><td> 程序终止(同INT 20H) </td><td> CS=程序段前缀 </td><td> 　 </td></tr><tr><td> 01 </td><td> 键盘输入并回显 </td><td> 　 </td><td> AL=输入字符 </td></tr><tr><td> 02 </td><td> 显示输出 </td><td> DL=输出字符 </td><td> 　 </td></tr><tr><td> 03 </td><td> 异步通迅输入 </td><td> 　 </td><td> AL=输入数据 </td></tr><tr><td> 04 </td><td> 异步通迅输出 </td><td> DL=输出数据 </td><td> 　 </td></tr><tr><td> 05 </td><td> 打印机输出 </td><td> DL=输出字符 </td><td> 　 </td></tr><tr><td> 06 </td><td> 直接控制台I/O </td><td> DL=FF(输入)<br> DL=字符(输出) </td><td> AL=输入字符 </td></tr><tr><td> 07 </td><td> 键盘输入(无回显) </td><td> 　 </td><td> AL=输入字符 </td></tr><tr><td> 08 </td><td> 键盘输入(无回显)<br> 检测Ctrl-Break </td><td> 　 </td><td> AL=输入字符 </td></tr><tr><td> 09 </td><td> 显示字符串 </td><td> DS:DX=字符串地址起点偏移地址<br> '$'结束字符串 </td><td> 　 </td></tr><tr><td> 0A </td><td> 键盘输入到缓冲区 </td><td> DS:DX=缓冲区首地址<br> (DS:DX)=缓冲区最大字符数 </td><td> (DS:DX+1)=实际输入的字符数 </td></tr><tr><td> 0B </td><td> 检验键盘状态 </td><td> 　 </td><td> AL=00 有输入<br> AL=FF 无输入 </td></tr><tr><td> 0C </td><td> 清除输入缓冲区并<br> 请求指定的输入功能 </td><td> AL=输入功能号<br> (1,6,7,8,A) </td><td> 　 </td></tr><tr><td> 0D </td><td> 磁盘复位 </td><td> 　 </td><td> 清除文件缓冲区 </td></tr><tr><td> 0E </td><td> 指定当前缺省的磁盘驱动器 </td><td> DL=驱动器号 0=A,1=B,... </td><td> AL=驱动器数 </td></tr><tr><td> 0F </td><td> 打开文件 </td><td> DS:DX=FCB首地址 </td><td> AL=00 文件找到<br> AL=FF 文件未找到 </td></tr><tr><td> 10 </td><td> 关闭文件 </td><td> DS:DX=FCB首地址 </td><td> AL=00 目录修改成功<br> AL=FF 目录中未找到文件 </td></tr><tr><td> 11 </td><td> 查找第一个目录项 </td><td> DS:DX=FCB首地址 </td><td> AL=00 找到<br> AL=FF 未找到 </td></tr><tr><td> 12 </td><td> 查找下一个目录项 </td><td> DS:DX=FCB首地址<br> (文件中带有*或?) </td><td> AL=00 找到<br> AL=FF 未找到 </td></tr><tr><td> 13 </td><td> 删除文件 </td><td> DS:DX=FCB首地址 </td><td> AL=00 删除成功<br> AL=FF 未找到 </td></tr><tr><td> 14<br> </td><td> 顺序读<br> </td><td> DS:DX=FCB首地址<br> </td><td> AL=00 读成功<br> =01 文件结束,记录中无数据<br> =02 DTA空间不够<br> =03 文件结束,记录不完整 </td></tr><tr><td> 15 </td><td> 顺序写 </td><td> DS:DX=FCB首地址 </td><td> AL=00 写成功<br> =01 盘满<br> =02 DTA空间不够 </td></tr><tr><td> 16 </td><td> 建文件 </td><td> DS:DX=FCB首地址 </td><td> AL=00 建立成功<br> =FF 无磁盘空间 </td></tr><tr><td> 17 </td><td> 文件改名 </td><td> DS:DX=FCB首地址<br> (DS:DX+1)=旧文件名<br> (DS:DX+17)=新文件名 </td><td> AL=00 成功<br> AL=FF 未成功 </td></tr><tr><td> 19 </td><td> 取当前缺省磁盘驱动器 </td><td> 　 </td><td> AL=缺省的驱动器号 0=A,1=B,2=C,... </td></tr><tr><td> 1A </td><td> 置DTA地址 </td><td> DS:DX=DTA地址 </td><td> 　 </td></tr><tr><td> 1B<br> </td><td> 取缺省驱动器FAT信息<br> </td><td> 　 </td><td> AL=每簇的扇区数<br> DS:BX=FAT标识字节<br> CX=物理扇区大小<br> DX=缺省驱动器的簇数 </td></tr><tr><td> 1C </td><td> 取任一驱动器FAT信息 </td><td> DL=驱动器号 </td><td> 同上 </td></tr><tr><td> 21<br> </td><td> 随机读<br> </td><td> DS:DX=FCB首地址<br> </td><td> AL=00 读成功<br> =01 文件结束<br> =02 缓冲区溢出<br> =03 缓冲区不满 </td></tr><tr><td> 22 </td><td> 随机写 </td><td> DS:DX=FCB首地址 </td><td> AL=00 写成功<br> =01 盘满<br> =02 缓冲区溢出 </td></tr><tr><td> 23 </td><td> 测定文件大小 </td><td> DS:DX=FCB首地址 </td><td> AL=00 成功(文件长度填入FCB)<br> AL=FF 未找到 </td></tr><tr><td> 24 </td><td> 设置随机记录号 </td><td> DS:DX=FCB首地址 </td><td> 　 </td></tr><tr><td> 25 </td><td> 设置中断向量 </td><td> DS:DX=中断向量<br> AL=中断类型号 </td><td> 　 </td></tr><tr><td> 26 </td><td> 建立程序段前缀 </td><td> DX=新的程序段前缀 </td><td> 　 </td></tr><tr><td> 27<br> </td><td> 随机分块读<br> </td><td> DS:DX=FCB首地址<br> CX=记录数 </td><td> AL=00 读成功<br> =01 文件结束<br> =02 缓冲区太小,传输结束<br> =03 缓冲区不满 </td></tr><tr><td> 28 </td><td> 随机分块写 </td><td> DS:DX=FCB首地址<br> CX=记录数 </td><td> AL=00 写成功<br> =01 盘满<br> =02 缓冲区溢出 </td></tr><tr><td> 29 </td><td> 分析文件名 </td><td> ES:DI=FCB首地址<br> DS:SI=ASCIIZ串<br> AL=控制分析标志 </td><td> AL=00 标准文件<br> =01 多义文件<br> =02 非法盘符 </td></tr><tr><td> 2A </td><td> 取日期 </td><td> 　 </td><td> CX=年<br> DH:DL=月:日(二进制) </td></tr><tr><td> 2B </td><td> 设置日期 </td><td> CX:DH:DL=年:月:日 </td><td> AL=00 成功<br> =FF 无效 </td></tr><tr><td> 2C </td><td> 取时间 </td><td> 　 </td><td> CH:CL=时:分<br> DH:DL=秒:1/100秒 </td></tr><tr><td> 2D </td><td> 设置时间 </td><td> CH:CL=时:分<br> DH:DL=秒:1/100秒 </td><td> AL=00 成功<br> =FF 无效 </td></tr><tr><td> 2E </td><td> 置磁盘自动读写标志 </td><td> AL=00 关闭标志<br> AL=01 打开标志 </td><td> 　 </td></tr><tr><td> 2F </td><td> 取磁盘缓冲区的首址 </td><td> 　 </td><td> ES:BX=缓冲区首址 </td></tr><tr><td> 30 </td><td> 取DOS版本号 </td><td> 　 </td><td> AH=发行号,AL=版本 </td></tr><tr><td> 31 </td><td> 结束并驻留 </td><td> AL=返回码<br> DX=驻留区大小 </td><td> 　 </td></tr><tr><td> 33<br> </td><td> Ctrl-Break检测<br> </td><td> AL=00 取状态<br> =01 置状态(DL)<br> DL=00 关闭检测<br> =01 打开检测 </td><td> DL=00 关闭Ctrl-Break检测<br> =01 打开Ctrl-Break检测 </td></tr><tr><td> 35 </td><td> 取中断向量 </td><td> AL=中断类型 </td><td> ES:BX=中断向量 </td></tr><tr><td> 36<br><br> </td><td> 取空闲磁盘空间<br><br> </td><td> DL=驱动器号 <br> 0=缺省,1=A,2=B,...<br> </td><td> 成功:AX=每簇扇区数<br> BX=有效簇数<br> CX=每扇区字节数<br> DX=总簇数<br> 失败:AX=FFFF </td></tr><tr><td> 38 </td><td> 置/取国家信息 </td><td> DS:DX=信息区首地址 </td><td> BX=国家码(国际电话前缀码)<br> AX=错误码 </td></tr><tr><td> 39 </td><td> 建立子目录(MKDIR) </td><td> DS:DX=ASCIIZ串地址 </td><td> AX=错误码 </td></tr><tr><td> 3A </td><td> 删除子目录（RMDIR） </td><td> DS:DX=ASCIIZ串地址 </td><td> AX=错误码 </td></tr><tr><td> 3B </td><td> 改变当前目录(CHDIR) </td><td> DS:DX=ASCIIZ串地址 </td><td> AX=错误码 </td></tr><tr><td> 3C </td><td> 建立文件 </td><td> DS:DX=ASCIIZ串地址<br> CX=文件属性 </td><td> 成功:AX=文件代号<br> 错误:AX=错误码 </td></tr><tr><td> 3D<br> </td><td> 打开文件<br> </td><td> DS:DX=ASCIIZ串地址<br> AL=0 读<br> =1 写<br> =3 读/写 </td><td> 成功:AX=文件代号<br> 错误:AX=错误码 </td></tr><tr><td> 3E </td><td> 关闭文件 </td><td> BX=文件代号 </td><td> 失败:AX=错误码 </td></tr><tr><td> 3F<br> </td><td> 读文件或设备<br> </td><td> DS:DX=数据缓冲区地址<br> BX=文件代号<br> CX=读取的字节数 </td><td> 读成功:<br> AX=实际读入的字节数<br> AX=0 已到文件尾<br> 读出错:AX=错误码 </td></tr><tr><td> 40 </td><td> 写文件或设备 </td><td> DS:DX=数据缓冲区地址<br> BX=文件代号<br> CX=写入的字节数 </td><td> 写成功:<br> AX=实际写入的字节数<br> 写出错:AX=错误码 </td></tr><tr><td> 41 </td><td> 删除文件 </td><td> DS:DX=ASCIIZ串地址 </td><td> 成功:AX=00<br> 出错:AX=错误码(2,5) </td></tr><tr><td> 42<br><br> </td><td> 移动文件指针<br><br> </td><td> BX=文件代号<br> CX:DX=位移量<br> AL=移动方式(0:从文件头绝对位移,1:从当前位置相对移动,2:从文件尾绝对位移) </td><td> 成功:DX:AX=新文件指针位置<br> 出错:AX=错误码<br> </td></tr><tr><td> 43<br> </td><td> 置/取文件属性<br> </td><td> DS:DX=ASCIIZ串地址<br> AL=0 取文件属性<br> AL=1 置文件属性<br> CX=文件属性 </td><td> 成功:CX=文件属性<br> 失败:CX=错误码 </td></tr><tr><td> 44<br><br><br><br> </td><td> 设备文件I/O控制<br><br><br><br> </td><td> BX=文件代号<br> AL=0 取状态<br> =1 置状态DX<br> =2 读数据<br> =3 写数据<br> =6 取输入状态<br> =7 取输出状态 </td><td> DX=设备信息<br><br><br><br> </td></tr><tr><td> 45 </td><td> 复制文件代号 </td><td> BX=文件代号1 </td><td> 成功:AX=文件代号2<br> 失败:AX=错误码 </td></tr><tr><td> 46 </td><td> 人工复制文件代号 </td><td> BX=文件代号1<br> CX=文件代号2 </td><td> 失败:AX=错误码 </td></tr><tr><td> 47 </td><td> 取当前目录路径名 </td><td> DL=驱动器号<br> DS:SI=ASCIIZ串地址 </td><td> (DS:SI)=ASCIIZ串<br> 失败:AX=出错码 </td></tr><tr><td> 48 </td><td> 分配内存空间 </td><td> BX=申请内存容量 </td><td> 成功:AX=分配内存首地<br> 失败:BX=最大可用内存 </td></tr><tr><td> 49 </td><td> 释放内容空间 </td><td> ES=内存起始段地址 </td><td> 失败:AX=错误码 </td></tr><tr><td> 4A </td><td> 调整已分配的存储块 </td><td> ES=原内存起始地址<br> BX=再申请的容量 </td><td> 失败:BX=最大可用空间<br> AX=错误码 </td></tr><tr><td> 4B<br> </td><td> 装配/执行程序<br> </td><td> DS:DX=ASCIIZ串地址<br> ES:BX=参数区首地址<br> AL=0 装入执行<br> AL=3 装入不执行 </td><td> 失败:AX=错误码<br> </td></tr><tr><td> 4C </td><td> 带返回码结束 </td><td> AL=返回码 </td><td> 回显B800:00A0-B800:103F的显存空间信息 </td></tr><tr><td> 4D </td><td> 取返回代码 </td><td> 　 </td><td> AX=返回代码 </td></tr><tr><td> 4E </td><td> 查找第一个匹配文件 </td><td> DS:DX=ASCIIZ串地址<br> CX=属性 </td><td> AX=出错代码(02,18) </td></tr><tr><td> 4F </td><td> 查找下一个匹配文件 </td><td> DS:DX=ASCIIZ串地址<br> (文件名中带有?或*) </td><td> AX=出错代码(18) </td></tr><tr><td> 54 </td><td> 取盘自动读写标志 </td><td> 　 </td><td> AL=当前标志值 </td></tr><tr><td> 56 </td><td> 文件改名 </td><td> DS:DX=ASCIIZ串(旧)<br> ES:DI=ASCIIZ串(新) </td><td> AX=出错码(03,05,17) </td></tr><tr><td> 57 </td><td> 置/取文件日期和时间 </td><td> BX=文件代号<br> AL=0 读取<br> AL=1 设置(DX:CX) </td><td> DX:CX=日期和时间<br> 失败:AX=错误码 </td></tr><tr><td> 58 </td><td> 取/置分配策略码 </td><td> AL=0 取码<br> AL=1 置码(BX) </td><td> 成功:AX=策略码<br> 失败:AX=错误码 </td></tr><tr><td> 59<br> </td><td> 取扩充错误码<br> </td><td> 　 </td><td> AX=扩充错误码<br> BH=错误类型<br> BL=建议的操作<br> CH=错误场所 </td></tr><tr><td> 5A </td><td> 建立临时文件 </td><td> CX=文件属性<br> DS:DX=ASCIIZ串地址 </td><td> 成功:AX=文件代号<br> 失败:AX=错误码 </td></tr><tr><td> 5B </td><td> 建立新文件 </td><td> CX=文件属性<br> DS:DX=ASCIIZ串地址 </td><td> 成功:AX=文件代号<br> 失败:AX=错误码 </td></tr><tr><td> 5C<br><br> </td><td> 控制文件存取<br><br> </td><td> AL=00封锁<br> =01开启<br> BX=文件代号<br> CX:DX=文件位移<br> SI:DI=文件长度 </td><td> 失败:AX=错误码<br><br> </td></tr><tr><td> 62 </td><td> 取程序段前缀 </td><td> 　 </td><td> BX=PSP地址 </td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93f846fce1317d8f66757e251e2fc41a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS7离线安装Python3</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba728c504b3e5188335ea18b9e539ad4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python-docx实现保留原格式的批量替换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>