<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>延迟渲染总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="延迟渲染总结" />
<meta property="og:description" content="延迟渲染总结 1 准备阶段1. G-buffer创建(1) 创建G-buffer帧缓冲(2) 为G-buffer创建三个纹理附件(颜色附件)(3) 用多渲染目标（MRT）方法将对应数据分配到各个颜色附件 2. 着色器，模型和光源设置(1)着色器设置(2)模型设置(3)光源设置 2 几何阶段1 顶点着色器2 片元着色器 3 光照处理阶段1 cpp程序2 shaderlightingpass着色器(1)顶点着色器(2) 片元着色器 4 问题1 延时是啥呢，和正向渲染有啥区别呢2 延时渲染的缺点 5 代码 1 准备阶段 1. G-buffer创建 (1) 创建G-buffer帧缓冲 创建了G-buffer,因为接下来的操作要在该帧缓冲上进行，第三行我们在这里绑定到G-buffer帧缓冲上；
unsigned int gBuffer; glGenFramebuffers(1, &amp;gBuffer);//Gbuffer创建 glBindFramebuffer(GL_FRAMEBUFFER, gBuffer);//绑定该缓冲 如果没有第三行绑定到gbuffer缓冲上的话，会出现什么问题呢？
没有第三行的绑定的话后面的三个纹理附件就会绑定在默认的帧缓冲上，即前置缓冲器中，也就是屏幕显示帧缓冲上；这样的话就会把第一次没有光照的场景渲染到G-buffer中，而后面的三个纹理附件就没有任何数据，后面的光照计算也就没有数据了，会导致黑屏；
(2) 为G-buffer创建三个纹理附件(颜色附件) gPosition顶点位置信息；gNormal法线信息；gAlbedoSpec颜色信息和镜面强度值； //position-位置信息作为一个例子 //1.纹理创建以及绑定 glGenTextures(1, &amp;gPosition); glBindTexture(GL_TEXTURE_2D, gPosition); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB16F, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGB, GL_FLOAT, NULL); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST); //2.将相应的纹理绑定到帧缓冲的对应缓冲区 glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, gPosition, 0); (3) 用多渲染目标（MRT）方法将对应数据分配到各个颜色附件 多渲染目标技术：将每个像素的数据保存到帧缓冲不同的缓冲区中，使得这些缓冲区的数据由此可以进行后续的计算；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f0c4359a3c8ec1f3809335486ca56ccb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-29T12:56:48+08:00" />
<meta property="article:modified_time" content="2019-10-29T12:56:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">延迟渲染总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>延迟渲染总结</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 准备阶段</a></li><li><ul><li><a href="#1_Gbuffer_3" rel="nofollow">1. G-buffer创建</a></li><li><ul><li><a href="#1_Gbuffer_4" rel="nofollow">(1) 创建G-buffer帧缓冲</a></li><li><a href="#2_Gbuffer_16" rel="nofollow">(2) 为G-buffer创建三个纹理附件(颜色附件)</a></li><li><a href="#3_MRT_32" rel="nofollow">(3) 用多渲染目标（MRT）方法将对应数据分配到各个颜色附件</a></li></ul> 
   </li><li><a href="#2__45" rel="nofollow">2. 着色器，模型和光源设置</a></li><li><ul><li><a href="#1_46" rel="nofollow">(1)着色器设置</a></li><li><a href="#2_57" rel="nofollow">(2)模型设置</a></li><li><a href="#3_65" rel="nofollow">(3)光源设置</a></li></ul> 
  </li></ul> 
  </li><li><a href="#2__85" rel="nofollow">2 几何阶段</a></li><li><ul><li><a href="#1__104" rel="nofollow">1 顶点着色器</a></li><li><a href="#2__123" rel="nofollow">2 片元着色器</a></li></ul> 
  </li><li><a href="#3__158" rel="nofollow">3 光照处理阶段</a></li><li><ul><li><a href="#1_cpp_159" rel="nofollow">1 cpp程序</a></li><li><a href="#2_shaderlightingpass_189" rel="nofollow">2 shaderlightingpass着色器</a></li><li><ul><li><a href="#1_190" rel="nofollow">(1)顶点着色器</a></li><li><a href="#2__199" rel="nofollow">(2) 片元着色器</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4__208" rel="nofollow">4 问题</a></li><li><ul><li><a href="#1__209" rel="nofollow">1 延时是啥呢，和正向渲染有啥区别呢</a></li><li><a href="#2___213" rel="nofollow">2 延时渲染的缺点</a></li></ul> 
  </li><li><a href="#5__220" rel="nofollow">5 代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 准备阶段</h2> 
<h3><a id="1_Gbuffer_3"></a>1. G-buffer创建</h3> 
<h4><a id="1_Gbuffer_4"></a>(1) 创建G-buffer帧缓冲</h4> 
<p><strong>创建了G-buffer,因为接下来的操作要在该帧缓冲上进行，第三行我们在这里绑定到G-buffer帧缓冲上；</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> gBuffer<span class="token punctuation">;</span>
<span class="token function">glGenFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Gbuffer创建</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绑定该缓冲</span>
</code></pre> 
<blockquote> 
 <p><em><strong>如果没有第三行绑定到gbuffer缓冲上的话，会出现什么问题呢？</strong></em><br> 没有第三行的绑定的话后面的三个纹理附件就会绑定在默认的帧缓冲上，即前置缓冲器中，也就是屏幕显示帧缓冲上；这样的话就会把第一次没有光照的场景渲染到G-buffer中，而后面的三个纹理附件就没有任何数据，后面的光照计算也就没有数据了，会导致黑屏；</p> 
</blockquote> 
<h4><a id="2_Gbuffer_16"></a>(2) 为G-buffer创建三个纹理附件(颜色附件)</h4> 
<ul><li>gPosition顶点位置信息；</li><li>gNormal法线信息；</li><li>gAlbedoSpec颜色信息和镜面强度值；</li></ul> 
<pre><code class="prism language-c"><span class="token comment">//position-位置信息作为一个例子</span>
<span class="token comment">//1.纹理创建以及绑定</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB16F<span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.将相应的纹理绑定到帧缓冲的对应缓冲区</span>
<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> gPosition<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3_MRT_32"></a>(3) 用多渲染目标（MRT）方法将对应数据分配到各个颜色附件</h4> 
<blockquote> 
 <p><strong>多渲染目标技术</strong>：将每个像素的数据保存到帧缓冲不同的缓冲区中，使得这些缓冲区的数据由此可以进行后续的计算；</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//MRT-Multiple Render Targets 多渲染目标技术</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> attachments<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span>GL_COLOR_ATTACHMENT1<span class="token punctuation">,</span>GL_COLOR_ATTACHMENT2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//MRT代码的实现:表示缓冲区的个数和缓冲区的名称</span>
<span class="token function">glDrawBuffers</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> attachments<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行片段着色器以后就可以将数据分别分配到各个颜色附件</p> 
<h3><a id="2__45"></a>2. 着色器，模型和光源设置</h3> 
<h4><a id="1_46"></a>(1)着色器设置</h4> 
<p>几何着色器：存储所需的数据<br> 光照着色器：进行光照计算</p> 
<pre><code class="prism language-c"><span class="token comment">//载入着色器</span>
Shader <span class="token function">shaderGeometryPass</span><span class="token punctuation">(</span><span class="token string">"res/shader/g_buffer.vs"</span><span class="token punctuation">,</span><span class="token string">"res/shader/g_buffer.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Shader <span class="token function">shaderLightingPass</span><span class="token punctuation">(</span><span class="token string">"res/shader/deferred_shading.vs"</span><span class="token punctuation">,</span><span class="token string">"res/shader/deferred_shading.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_57"></a>(2)模型设置</h4> 
<pre><code class="prism language-c">Model <span class="token function">BB8</span><span class="token punctuation">(</span><span class="token string">"res/models/BB8 New/bb8.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> objectPositions<span class="token punctuation">;</span>
objectPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
objectPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3_65"></a>(3)光源设置</h4> 
<pre><code class="prism language-c"><span class="token comment">//多光源</span>
std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> lightPositions<span class="token punctuation">;</span>
std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> lightColors<span class="token punctuation">;</span>
<span class="token function">srand</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NR_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">float</span> xPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> yPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">4.0</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> zPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
	lightPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> rColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> gColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> bColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	lightColors<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span>rColor<span class="token punctuation">,</span> gColor<span class="token punctuation">,</span> bColor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="2__85"></a>2 几何阶段</h2> 
<p><mark>注意</mark>：在进行这个过程中先要绑定G-buffer;因为我们要把数据传给帧缓冲，从渲染的过程中并没有看到数据传到G-buffer中，shader装进去，G-buffer数据的传输在GPU中进行；</p> 
<pre><code class="prism language-c"><span class="token comment">//1.激活着色器</span>
shaderGeometryPass<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.设置PVM矩阵</span>
shaderGeometryPass<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
shaderGeometryPass<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objectPositions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> objectPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scale</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.02f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	shaderGeometryPass<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
	BB8<span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span>shaderGeometryPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="1__104"></a>1 顶点着色器</h3> 
<p><mark>注意</mark>：和一般的顶点着色器不一样的地方是要<strong>获取顶点在世界坐标系下的坐标</strong>，传给片元着色器，目的是为了将数据分配到不同的纹理附件；<br> <strong>纹理坐标和法线坐标和平常一样传给片元着色器中；</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

<span class="token comment">//--------------------------------------------------------------</span>
<span class="token comment">//为了将数据分配到不同的纹理附件，我们需要计算顶点在世界坐标系下的坐标</span>
vec4 worldPos <span class="token operator">=</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
FragPos <span class="token operator">=</span> worldPos<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
<span class="token comment">//--------------------------------------------------------------</span>
TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
mat3 normalMatrix <span class="token operator">=</span> <span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token function">mat3</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Normal <span class="token operator">=</span> normalMatrix <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>
gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> worldPos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2__123"></a>2 片元着色器</h3> 
<ol><li>顶点着色器的数据传到片元着色器中，通过下面的代码</li></ol> 
<pre><code class="prism language-c">in vec2 TexCoords<span class="token punctuation">;</span>
in vec3 FragPos<span class="token punctuation">;</span>
in vec3 Normal<span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>从模型的纹理提取颜色和镜面高光值</li></ol> 
<pre><code class="prism language-c"><span class="token comment">///-----------------------=====================</span>
<span class="token comment">//输出到3个颜色缓冲区</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> out vec3 gPosition<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> out vec3 gNormal<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> out vec4 gAlbedoSpec<span class="token punctuation">;</span>
<span class="token comment">//=====================================</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
gPosition <span class="token operator">=</span> FragPos<span class="token punctuation">;</span>
gNormal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//===========================</span>
<span class="token comment">//从模型的贴图中提取相应的数据</span>
gAlbedoSpec<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture_diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
gAlbedoSpec<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture_specular1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span>
<span class="token comment">//==================================</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>通过layout关键词将颜色，法线以及镜面高光值传到前面创建的G-buffer相应的颜色缓冲区内，这样就可以在光照阶段进行使用了；</li></ol> 
<pre><code class="prism language-c">layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> out vec3 gPosition<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> out vec3 gNormal<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> out vec4 gAlbedoSpec<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="3__158"></a>3 光照处理阶段</h2> 
<h3><a id="1_cpp_159"></a>1 cpp程序</h3> 
<pre><code class="prism language-c"><span class="token comment">///======================================</span>
<span class="token comment">///1.将帧缓冲绑定到默认缓冲即屏幕显示的帧缓冲上</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//============================================</span>
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.激活纹理通道，绑定纹理附件</span>
shaderLightingPass<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//激活shaderLightingPass</span>
<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//激活纹理通道</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">,</span> gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绑定纹理附件</span>
<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gAlbedoSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">///3.设置好光源的位置和颜色信息，用renderQuad（）函数进行绘制</span>
<span class="token comment">//num参数用于削弱最后光照结果，因为光源数量较多时叠加后亮度过高</span>
shaderLightingPass<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span> NR_LIGHTS <span class="token operator">/</span> <span class="token punctuation">(</span>NR_LIGHTS <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lightPositions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	shaderLightingPass<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"lights["</span> <span class="token operator">+</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to_string</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"].Position"</span><span class="token punctuation">,</span> lightPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	shaderLightingPass<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"lights["</span> <span class="token operator">+</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to_string</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"].Color"</span><span class="token punctuation">,</span> lightColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
shaderLightingPass<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"viewPos"</span><span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">renderQuad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>renderQuad()函数的功能：绘制铺满整个屏幕的四边形，通过shaderlightingpass着色器直接从三个纹理附件提取每个像素的数据进行绘制</p> 
</blockquote> 
<h3><a id="2_shaderlightingpass_189"></a>2 shaderlightingpass着色器</h3> 
<h4><a id="1_190"></a>(1)顶点着色器</h4> 
<p>直接传入四边形的顶点坐标和纹理坐标就可以了；</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
	gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2__199"></a>(2) 片元着色器</h4> 
<p>从纹理附件中提取数据，然后进行phone的光照模型进行光照计算，从而得到最终的结果；</p> 
<pre><code class="prism language-c">vec3 FragPos <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gPosition<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
vec3 Normal <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gNormal<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
vec3 Diffuse <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gAlbedoSpec<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
<span class="token keyword">float</span> Specular <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gAlbedoSpec<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>a
</code></pre> 
<h2><a id="4__208"></a>4 问题</h2> 
<h3><a id="1__209"></a>1 延时是啥呢，和正向渲染有啥区别呢</h3> 
<p><mark>延时</mark>其实指的是在渲染场景之后，再来进行光照计算，也就是延时光照计算在后期进行，<br> <mark>正向渲染</mark>的着色器采取物体+光照同时进行计算，也就是在渲染物体的时候，直接利用物体的物质，法线和颜色进行光照计算；<br> 而<mark>延时渲染</mark>，是先渲染场景，在G-buffer中存储光照计算所需要的数据</p> 
<h3><a id="2___213"></a>2 延时渲染的缺点</h3> 
<ul><li>不可以用混合技术，因此透明对象无法渲染</li><li>没法实现基于硬件实现的多重采样抗锯齿功能；因为渲染过程发生在上面的第二步，第二步只有一个样本，但是基于硬件实现的多重采样抗锯齿需要多个样本</li><li>需要高带宽的显卡</li><li>显卡不支持mrt技术，还可以实现延时渲染吗?<br> 可以做，可以通过建立三个帧缓冲，分别存储位置，法线和延时信息，渲染三次场景提取信息并存储在三个附件中，但是不建议，这样显卡的负担会很大；</li></ul> 
<h2><a id="5__220"></a>5 代码</h2> 
<pre><code class="prism language-c"><span class="token comment">/*
延迟渲染主要步骤：
1.几何处理阶段；
2.光照处理阶段；
*/</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Camera.h"</span></span><span class="token comment">//相机类</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Shader.h"</span></span><span class="token comment">//着色器类</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Model.h"</span></span><span class="token comment">//模型类，载入模型</span>


<span class="token keyword">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword">double</span> ypos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword">double</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">renderQuad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">renderCube</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//光源数量</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> NR_LIGHTS <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> SCR_WIDTH <span class="token operator">=</span> <span class="token number">1280</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> SCR_HEIGHT <span class="token operator">=</span> <span class="token number">720</span><span class="token punctuation">;</span>

Camera <span class="token function">camera</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">5.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> lastX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>SCR_WIDTH <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> lastY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>SCR_HEIGHT <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
bool firstMouse <span class="token operator">=</span> true<span class="token punctuation">;</span>
bool LightBox <span class="token operator">=</span> false<span class="token punctuation">;</span>

<span class="token keyword">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE<span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	GLFWwindow<span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span>SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token string">"Deferred Rendering"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>window <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to create GLFW window"</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
		<span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to initialize GLAD"</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// G-buffer的创建</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> gBuffer<span class="token punctuation">;</span>
	<span class="token function">glGenFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> gPosition<span class="token punctuation">,</span> gNormal<span class="token punctuation">,</span> gAlbedoSpec<span class="token punctuation">;</span>
	<span class="token comment">//position-位置信息</span>
	<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB16F<span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> gPosition<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//normal-法线信息</span>
	<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB16F<span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT1<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> gNormal<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//albedospec-颜色信息</span>
	<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gAlbedoSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gAlbedoSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB16F<span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT2<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> gAlbedoSpec<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//深度附件</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> rboDepth<span class="token punctuation">;</span>
	<span class="token function">glGenRenderbuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rboDepth<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindRenderbuffer</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> rboDepth<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glRenderbufferStorage</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> GL_DEPTH_COMPONENT<span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glFramebufferRenderbuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_ATTACHMENT<span class="token punctuation">,</span> GL_RENDERBUFFER<span class="token punctuation">,</span> rboDepth<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//MRT-Multiple Render Targets  多渲染目标技术</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> attachments<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span>GL_COLOR_ATTACHMENT1<span class="token punctuation">,</span>GL_COLOR_ATTACHMENT2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">glDrawBuffers</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> attachments<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//判断帧缓冲是否创建成功</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glCheckFramebufferStatus</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">)</span> <span class="token operator">!=</span> GL_FRAMEBUFFER_COMPLETE<span class="token punctuation">)</span>
		std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Framebuffer not complete!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
	<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//载入着色器和模型</span>
	Shader <span class="token function">shaderGeometryPass</span><span class="token punctuation">(</span><span class="token string">"res/shader/g_buffer.vs"</span><span class="token punctuation">,</span> <span class="token string">"res/shader/g_buffer.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Shader <span class="token function">shaderLightingPass</span><span class="token punctuation">(</span><span class="token string">"res/shader/deferred_shading.vs"</span><span class="token punctuation">,</span> <span class="token string">"res/shader/deferred_shading.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Shader <span class="token function">shaderLightBox</span><span class="token punctuation">(</span><span class="token string">"res/shader/deferred_light_box.vs"</span><span class="token punctuation">,</span> <span class="token string">"res/shader/deferred_light_box.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Model <span class="token function">ourModel</span><span class="token punctuation">(</span><span class="token string">"res/models/character.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> objectPositions<span class="token punctuation">;</span>
	objectPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	objectPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	shaderLightingPass<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetInt</span><span class="token punctuation">(</span><span class="token string">"gPosition"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetInt</span><span class="token punctuation">(</span><span class="token string">"gNormal"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetInt</span><span class="token punctuation">(</span><span class="token string">"gAlbedoSpec"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">//多光源</span>
	std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> lightPositions<span class="token punctuation">;</span>
	std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span>vec3<span class="token operator">&gt;</span> lightColors<span class="token punctuation">;</span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NR_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>

		<span class="token keyword">float</span> xPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> yPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">4.0</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> zPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
		lightPositions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">float</span> rColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> gColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> bColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
		lightColors<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span>rColor<span class="token punctuation">,</span> gColor<span class="token punctuation">,</span> bColor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//渲染步骤</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> currentFrame <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
		lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

		<span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.34f</span><span class="token punctuation">,</span> <span class="token number">0.57f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.34f</span><span class="token punctuation">,</span> <span class="token number">0.57f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		glm<span class="token punctuation">:</span><span class="token punctuation">:</span>mat4 projection <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">radians</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>Zoom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>SCR_WIDTH <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		glm<span class="token punctuation">:</span><span class="token punctuation">:</span>mat4 view <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		glm<span class="token punctuation">:</span><span class="token punctuation">:</span>mat4 model<span class="token punctuation">;</span>
		<span class="token comment">//几何处理阶段</span>
		shaderGeometryPass<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		shaderGeometryPass<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
		shaderGeometryPass<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objectPositions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> objectPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scale</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.4f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			shaderGeometryPass<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
			ourModel<span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span>shaderGeometryPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//光照处理阶段</span>
		<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		shaderLightingPass<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> gAlbedoSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

		shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetFloat</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span> NR_LIGHTS<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lightPositions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetVec3</span><span class="token punctuation">(</span><span class="token string">"lights["</span> <span class="token operator">+</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to_string</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"].Position"</span><span class="token punctuation">,</span> lightPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetVec3</span><span class="token punctuation">(</span><span class="token string">"lights["</span> <span class="token operator">+</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to_string</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"].Color"</span><span class="token punctuation">,</span> lightColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		shaderLightingPass<span class="token punctuation">.</span><span class="token function">SetVec3</span><span class="token punctuation">(</span><span class="token string">"viewPos"</span><span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">renderQuad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>LightBox<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//绘制光源</span>
			<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_READ_FRAMEBUFFER<span class="token punctuation">,</span> gBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_DRAW_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">glBlitFramebuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


			shaderLightBox<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			shaderLightBox<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
			shaderLightBox<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lightPositions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> lightPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				model <span class="token operator">=</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scale</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.125f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				shaderLightBox<span class="token punctuation">.</span><span class="token function">SetMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
				shaderLightBox<span class="token punctuation">.</span><span class="token function">SetVec3</span><span class="token punctuation">(</span><span class="token string">"lightColor"</span><span class="token punctuation">,</span> lightColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">renderCube</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> cubeVAO <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> cubeVBO <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//绘制立方体</span>
<span class="token keyword">void</span> <span class="token function">renderCube</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>cubeVAO <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>        
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>

			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
	
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
	
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>      
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>    
		
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
		
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span>        
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> cubeVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//绘制铺满整个屏幕的矩形</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> quadVAO <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> quadVBO<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">renderQuad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>quadVAO <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> quadVertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
			<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>quadVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> quadVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>quadVertices<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>quadVertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLE_STRIP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		<span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>FORWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>BACKWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//是否显示光源 "Z"-显示   "X"-关闭显示</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_Z<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		LightBox <span class="token operator">=</span> true<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_X<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		LightBox <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword">double</span> ypos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
		lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
		firstMouse <span class="token operator">=</span> false<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
	<span class="token keyword">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span>

	lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
	lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

	camera<span class="token punctuation">.</span><span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span>xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	camera<span class="token punctuation">.</span><span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span>yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>g-buffer.fs</p> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>

out vec3 FragPos<span class="token punctuation">;</span>
out vec2 TexCoords<span class="token punctuation">;</span>
out vec3 Normal<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    vec4 worldPos <span class="token operator">=</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FragPos <span class="token operator">=</span> worldPos<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span> 
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
    
    mat3 normalMatrix <span class="token operator">=</span> <span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token function">mat3</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Normal <span class="token operator">=</span> normalMatrix <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> worldPos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>g-buffer.vs</p> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> out vec3 gPosition<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> out vec3 gNormal<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> out vec4 gAlbedoSpec<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>
in vec3 FragPos<span class="token punctuation">;</span>
in vec3 Normal<span class="token punctuation">;</span>

uniform sampler2D texture_diffuse1<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>    

    gPosition <span class="token operator">=</span> FragPos<span class="token punctuation">;</span>

    gNormal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gAlbedoSpec<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture_diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>deferred_shading.vs</p> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>deferred_shading.fs</p> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>

uniform sampler2D gPosition<span class="token punctuation">;</span>
uniform sampler2D gNormal<span class="token punctuation">;</span>
uniform sampler2D gAlbedoSpec<span class="token punctuation">;</span>
uniform <span class="token keyword">float</span> num<span class="token punctuation">;</span>

<span class="token keyword">struct</span> Light <span class="token punctuation">{<!-- --></span>
    vec3 Position<span class="token punctuation">;</span>
    vec3 Color<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> NR_LIGHTS <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
uniform Light lights<span class="token punctuation">[</span>NR_LIGHTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
uniform vec3 viewPos<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>             
    <span class="token comment">// 从G-buffer中提取数据</span>
    vec3 FragPos <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gPosition<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
    vec3 Normal <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gNormal<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
    vec3 Diffuse <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>gAlbedoSpec<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
    <span class="token keyword">float</span> Specular <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 光照计算</span>
    vec3 lighting  <span class="token operator">=</span> Diffuse <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span> 
    vec3 viewDir  <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NR_LIGHTS<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//环境光</span>
		vec3 ambient <span class="token operator">=</span> Diffuse <span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
        <span class="token comment">// 漫反射</span>
        vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Position <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        vec3 diffuse <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>Normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> Diffuse <span class="token operator">*</span> lights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Color<span class="token punctuation">;</span>
        <span class="token comment">// 镜面高光</span>
        vec3 halfwayDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lightDir <span class="token operator">+</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>Normal<span class="token punctuation">,</span> halfwayDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vec3 specular <span class="token operator">=</span> lights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Color <span class="token operator">*</span> spec <span class="token operator">*</span> Specular<span class="token punctuation">;</span>

        lighting <span class="token operator">+</span><span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>lighting<span class="token operator">/</span>num<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/114e5f6650ed01f5cde839585f274118/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">手机已连接但无法访问互联网，碰到这个情况怎么破？想不到是这样</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3c4ba6e45adf2f36fddd316ec3eb8189/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">BigDecimal做运算，保留小数位四舍五入取舍问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>