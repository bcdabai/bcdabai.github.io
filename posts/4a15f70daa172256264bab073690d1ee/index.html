<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>聊一聊C&#43;&#43;设计模式、函数式编程等 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="聊一聊C&#43;&#43;设计模式、函数式编程等" />
<meta property="og:description" content="文章目录 1.variant技巧2.std::enable_if_t用法（1）C&#43;&#43;模板 SFINAE（2）C&#43;&#43;模板 匿名类型参数（3）enable_if（4）enable_if_t（5）后面那个 = 0 是个什么东西? 3.PIMPL模式4.二维数组5.折叠表达式 1.variant技巧 自定义match模板函数可以将多个lamda打包成一个，通过重载来调用
#include &lt;iostream&gt; #include &lt;variant&gt; template &lt;class ...Fs&gt; struct match: protected Fs...{ explicit match(Fs const&amp;... fs) :Fs(fs)... {} using Fs::operator()...; }; template &lt;class ...Fs&gt; match(Fs const&amp;... fs) -&gt; match&lt;Fs...&gt;; int main() { std::variant&lt;float, int, std::string&gt; v; v = &#34;abcd&#34;; std::visit(match[&amp;](auto x){ std::cout&lt;&lt;x&lt;&lt;std::endl;}, [&amp;](std::string x){std::cout&lt;&lt;x&lt;&lt;std::endl;},v) return 0; } 测试：
也可以利用C&#43;&#43;17 新增的 overloaded 模板，可以直接生成匿名访问器，简化代码， 下面的代码是等价的 int main() { std::variant&lt;int, float, string&gt; value = 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4a15f70daa172256264bab073690d1ee/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-02T14:32:02+08:00" />
<meta property="article:modified_time" content="2023-06-02T14:32:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">聊一聊C&#43;&#43;设计模式、函数式编程等</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1variant_2" rel="nofollow">1.variant技巧</a></li><li><a href="#2stdenable_if_t_157" rel="nofollow">2.std::enable_if_t用法</a></li><li><ul><li><a href="#1C_SFINAE_158" rel="nofollow">（1）C++模板 SFINAE</a></li><li><a href="#2C__240" rel="nofollow">（2）C++模板 匿名类型参数</a></li><li><a href="#3enable_if_393" rel="nofollow">（3）enable_if</a></li><li><a href="#4enable_if_t_458" rel="nofollow">（4）enable_if_t</a></li><li><a href="#5__0__492" rel="nofollow">（5）后面那个 = 0 是个什么东西?</a></li></ul> 
   </li><li><a href="#3PIMPL_585" rel="nofollow">3.PIMPL模式</a></li><li><a href="#4_640" rel="nofollow">4.二维数组</a></li><li><a href="#5_764" rel="nofollow">5.折叠表达式</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1variant_2"></a>1.variant技巧</h3> 
<p>自定义match模板函数可以将多个lamda打包成一个，通过重载来调用</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;variant&gt;</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Fs<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">match</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">Fs</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">explicit</span> <span class="token function">match</span><span class="token punctuation">(</span>Fs <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Fs</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">using</span> <span class="token class-name">Fs</span><span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Fs<span class="token operator">&gt;</span>
<span class="token function">match</span><span class="token punctuation">(</span>Fs <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fs<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> match<span class="token operator">&lt;</span>Fs<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> v<span class="token punctuation">;</span>
	v <span class="token operator">=</span> <span class="token string">"abcd"</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">visit</span><span class="token punctuation">(</span>match<span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>x<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>x<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>测试：<br> <img src="https://images2.imgbox.com/84/1f/rLo1emo5_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-cpp">也可以利用C<span class="token operator">++</span><span class="token number">17</span> 新增的 overloaded 模板，可以直接生成匿名访问器，简化代码， 下面的代码是等价的
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">,</span> string<span class="token operator">&gt;</span> value <span class="token operator">=</span> <span class="token number">1.0</span>；
  std<span class="token double-colon punctuation">::</span><span class="token function">visit</span><span class="token punctuation">(</span>overloaded<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"int: "</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"float: "</span> <span class="token operator">&lt;&lt;</span> f <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"str: "</span> <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre> 
<p>用static可以检测实例化了几次</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;variant&gt;</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Fs<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">match</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">Fs</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">explicit</span> <span class="token function">match</span><span class="token punctuation">(</span>Fs <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Fs</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">using</span> <span class="token class-name">Fs</span><span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">auto</span> func <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 		<span class="token keyword">static</span> <span class="token keyword">int</span> _<span class="token operator">=</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"instance\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 		std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>val<span class="token operator">&gt;&gt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">3.14f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以在编译器进行判断</p> 
<ul><li>编译器可以进行优化</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;variant&gt;</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Fs<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">match</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">Fs</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">explicit</span> <span class="token function">match</span><span class="token punctuation">(</span>Fs <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Fs</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">using</span> <span class="token class-name">Fs</span><span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">auto</span> func <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 		<span class="token keyword">static</span> <span class="token keyword">int</span> _<span class="token operator">=</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"instance\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 		<span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span>
 			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"true"</span> <span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
 		<span class="token keyword">else</span>
 			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"false"</span> <span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">func</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>integral_constant<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等价于std::false_type</span>
	<span class="token function">func</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>integral_constant<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等价于std::true_type</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><a href="https://en.cppreference.com/w/cpp/types/integral_constant" rel="nofollow">std::integral_constant</a></li><li>测试：实例化了两次<br> <img src="https://images2.imgbox.com/d0/a5/MFYxHYai_o.png" alt="在这里插入图片描述"></li></ul> 
<p>运行期判断转变成编译器判断</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;variant&gt;</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Fs<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">match</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">Fs</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">explicit</span> <span class="token function">match</span><span class="token punctuation">(</span>Fs <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fs<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Fs</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">using</span> <span class="token class-name">Fs</span><span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//bool转std::variant</span>
<span class="token comment">//编译器就知道是true类型，false类型</span>
std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>false_type<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>true_type<span class="token operator">&gt;</span>
<span class="token function">bool_variant</span><span class="token punctuation">(</span><span class="token keyword">bool</span> x<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span>
		<span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span>true_type<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span>false_type<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">saxpy</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> a<span class="token punctuation">,</span> <span class="token keyword">float</span> b<span class="token punctuation">,</span> <span class="token keyword">float</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">auto</span> has_b <span class="token operator">=</span> <span class="token function">bool_variant</span><span class="token punctuation">(</span>b<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> has_c <span class="token operator">=</span> <span class="token function">bool_variant</span><span class="token punctuation">(</span>c<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> has_b<span class="token punctuation">,</span> <span class="token keyword">auto</span> has_c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> ai<span class="token operator">:</span> a<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//编译器会自动产生4个分支</span>
			<span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>has_b<span class="token punctuation">)</span>
				ai<span class="token operator">*</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>has_c<span class="token punctuation">)</span>
				ai<span class="token operator">+</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">saxpy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">saxpy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3.14f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>参考：<a href="https://blog.csdn.net/hang_ning/article/details/123826220#:~:text=std::visit,%E6%98%AF%E9%85%8D%E5%90%88std::variant%E7%9A%84%E4%B8%80%E4%B8%AA%E8%AE%BF%E9%97%AE%E5%99%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BB%A5%E5%87%BD%E6%95%B0%E5%BC%8F%E6%96%B9%E6%B3%95%E8%AE%BF%E9%97%AEstd::variant%E5%8F%98%E9%87%8F%E3%80%82">std::variant 与 std::visit</a></li><li>进一步：有很多静态多态的小工具<br> <img src="https://images2.imgbox.com/a0/dc/7cHVZPua_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="2stdenable_if_t_157"></a>2.std::enable_if_t用法</h3> 
<h4><a id="1C_SFINAE_158"></a>（1）C++模板 SFINAE</h4> 
<blockquote> 
 <p>SFINAE: Substitution Failure Is Not An Error (替换失败不是错误)</p> 
</blockquote> 
<blockquote> 
 <p>SFINAE 可用于模板类型参数 和 返回值类型 两个地方,<br> 在这两个地方做类型不正确的操作 它不会报错和退出程序, 而是跳过当前匹配去尝试其他匹配.</p> 
</blockquote> 
<ul><li>eg：函数体内做类型不正确的操作, 会报错</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>


<span class="token keyword">struct</span> <span class="token class-name">book</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 重新定义一个类型, 这个类型叫做 page_type</span>
    <span class="token comment">// page_type 属于 book 作用域中的一个成员.</span>
    <span class="token keyword">typedef</span> <span class="token keyword">int</span> page_type<span class="token punctuation">;</span>      

    <span class="token comment">// 使用另外一种语法来重新定义一个类型, 这个类型叫做 name_type,</span>
    <span class="token comment">// name_type 属于 book 作用域中的一个成员.</span>
    <span class="token keyword">using</span> name_type <span class="token operator">=</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 使用book结构中的类型别名来定义变量.</span>
    book<span class="token double-colon punctuation">::</span>page_type a <span class="token operator">=</span> <span class="token number">1099</span><span class="token punctuation">;</span>
    book<span class="token double-colon punctuation">::</span>name_type b <span class="token operator">=</span> <span class="token string">"C++ Standard Library"</span><span class="token punctuation">;</span>

    <span class="token comment">// author_type 不存在于 book 结构中, 因此会报错.</span>
    book<span class="token double-colon punctuation">::</span>author_type c <span class="token operator">=</span> <span class="token string">"Nicolai M.Josuttis"</span><span class="token punctuation">;</span>         <span class="token comment">// error.</span>

    <span class="token comment">// output:</span>
    <span class="token comment">// 'author_type': is not a member of 'book'</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>eg：模板尖括号里做类型不正确的操作, 不会报错.</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">book</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">typedef</span> <span class="token keyword">int</span> page_type<span class="token punctuation">;</span>
    <span class="token keyword">using</span> name_type <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// T::author_type 是一个不存在的东西, 在这里叫做替换失败, 不是类型操作错误.</span>
<span class="token comment">// 当替换失败时, 编译器会跳过这个匹配, 继续寻找下一个模板函数.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">U</span> <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token double-colon punctuation">::</span>author_type<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"void example(book b)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    book b<span class="token punctuation">;</span>
    <span class="token function">example</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2C__240"></a>（2）C++模板 匿名类型参数</h4> 
<p>模板的类型参数, 除了能够定义默认类型之外.</p> 
<blockquote> 
 <p>还可以定义匿名类型参数, 这个匿名类型参数不能被函数体使用, 也不能被返回值使用.<br> 匿名类型参数利用替换失败不是错误的特性来判定, 如果没有出现替换失败, 那么就是符合匹配的.</p> 
</blockquote> 
<p>什么场景下需要用到匿名类型参数?</p> 
<ul><li>以上面的eg为例，这个函数声明了 class U 这个类型参数, 并且设定了一个默认值T::author_type,<br> 但是函数体、返回值中都没有使用到 U 这个类型, 如果实际项目中函数体的代码非常复杂,<br> 多出一个不明确的类型是非常恐怖的一件事情, 而匿名类型参数可以减少这个心里负担.</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">U</span> <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token double-colon punctuation">::</span>author_type<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>所以, 匿名类型参数就是用来降低心里复杂度的蜜枣.</p> 
<ul><li>由于 struct book 没有定义 author_type 这个成员类型, 因此 T::author_type 是一个无效的调用, 编译器不会报错, 而是选择跳过当前匹配进而去寻找其他匹配.</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">book</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">typedef</span> <span class="token keyword">int</span> page_type<span class="token punctuation">;</span>
    <span class="token keyword">using</span> name_type <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// class = typename T::author_type 就是一个匿名类型参数.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token double-colon punctuation">::</span>author_type<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// template&lt;typename T, class = typename T::page_type&gt;</span>
<span class="token comment">// 等同于</span>
<span class="token comment">// template&lt;typename T, typename = int&gt;</span>
<span class="token comment">// 第二个类型参数是一个匿名类型参数(没有提供一个identifier), 并且提供了一个int作为默认类型.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token double-colon punctuation">::</span>page_type<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"void example(book b)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    book b<span class="token punctuation">;</span>
    <span class="token function">example</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>模板参数的定义方式</p> 
<p>什么是 Identifier?</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>    <span class="token comment">// T 就是 Identifier.</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>Identifier 的命名不能跟 C++ 中的关键字出现冲突.</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 错误的</span>
<span class="token comment">// 因为 identifier 占用和覆盖了 int , 会导致后续功能不正常, 因此编译是不会通过的.</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">normal</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"normal: "</span> <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正确的</span>
<span class="token comment">// 但是建议使用常见的 T 或者 U 来当作 Identifier.</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">aaa</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">normal</span><span class="token punctuation">(</span>aaa s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"normal: "</span> <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>template &lt;&gt; 中 typename 和 class 有什么区别?</p> 
<blockquote> 
 <p>没有区别, 但是建议统一风格, 只使用其中任意一种,<br> 我个人基本都是使用typename.</p> 
</blockquote> 
<p>typename 这个关键字是什么含义?</p> 
<blockquote> 
 <p>它是一个标识符, 即便不放在 template &lt;&gt; 中, 也可以在常规的函数体中使用, 例如: typename int a = 10;<br> 但是在 template&lt;&gt; 中, 要声明一个类型, 必须要使用 typename 或 class 标识符, 用来标识它是一个Identifier.</p> 
</blockquote> 
<ul><li>eg：</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token comment">// 具体化</span>
<span class="token comment">// int 是一个具体的类型</span>
<span class="token comment">// n 是一个Identifier 也是一个具体值, 所以不能用 n 来声明一个变量.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int</span> n<span class="token operator">&gt;</span> <span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">specialization</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> n <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 具体化 和 匿名类型参数</span>
<span class="token comment">// 因为 int 是一个具体类型, 所以不能也没必要定义一个 Identifier , 所以函数体无法使用这个参数.</span>
<span class="token comment">// 匿名类型参数必须要有一个默认值.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&gt;</span> <span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token function">specialization_and_anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"specialization_and_anonymous"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token generic-function"><span class="token function">specialization</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须这样使用.</span>
    <span class="token function">specialization_and_anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// output:</span>
    <span class="token comment">// 10</span>
    <span class="token comment">// specialization_and_anonymous</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//typename和匿名类型</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token operator">=</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span>
T <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<ul><li>参考：<a href="https://www.jianshu.com/p/2a0a78fd38fa" rel="nofollow">C++模板 按条件匹配(enable_if_t)</a>，<a href="https://www.jianshu.com/p/dae1976239da" rel="nofollow">C++模板 SFINAE</a>，<a href="https://www.jianshu.com/p/3deec1ac6430" rel="nofollow">C++模板 匿名类型参数</a></li></ul> 
<h4><a id="3enable_if_393"></a>（3）enable_if</h4> 
<p>模板的主要任务就是推导/替换, 将调用时传递的具体值推导出其类型, 然后将 T 替换成该值的类型.</p> 
<ul><li> <p>模板支持推导和替换任意类型参数, 但每种类型支持的操作并非都相同, 因此一份模板函数不可能解决所有情况.</p> </li><li> <p><strong>当一份标准模板函数无法解决特定情况时，按条件匹配进入特定模板函数就变成了不可或缺.</strong></p> </li></ul> 
<p>enable_if 利用了模板匹配的技巧和struct结构, 巧妙的将条件匹配分割成两种情况,</p> 
<blockquote> 
 <p>一种是true的情况: 为结构绑定一个type<br> 一种是false的情况: 采取留空策略</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> _Test<span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ty</span> <span class="token operator">=</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">enable_if</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// no member "type" when !_Test</span>

<span class="token comment">// 这个实现叫做部分具体化(partial specialization), 即: 第一个参数 (&lt;true&gt;) 采用具体值.</span>
<span class="token comment">// 这个模板函数简要但是浓缩了几个规则:</span>
<span class="token comment">// 当调用时传递的参数是true时, 一定会进入这个函数.</span>
<span class="token comment">// 当调用时传递的参数是true且不提供其他参数时, &lt;class _Ty&gt; 会把自动合并上面一个enable_if的 &lt;class _Ty = void&gt;;</span>
<span class="token comment">// 当调用时传递的参数是true且提供其他参数时, _Ty 会替换成传递参数的类型(放弃void).</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Ty</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">enable_if</span><span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token punctuation">,</span> _Ty<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// type is _Ty for _Test</span>
    <span class="token keyword">using</span> type <span class="token operator">=</span> _Ty<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>eg：</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;type_traits&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token comment">//template &lt;typename T,  std::enable_if&lt;true, int&gt;::type = 0&gt;也可以编译通过</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">std</span><span class="token double-colon punctuation">::</span>enable_if<span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>type <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&gt;</span>
T <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">example</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>enable_if&lt;is_integral::value, int&gt; 等同于 enable_if&lt;true, int&gt; 或者 enable_if&lt;false, int&gt;，如果第一个参数是 true , 那么 enable_if 这个结构就有一个 type 成员, 这时调用 enable_if::type 就是OK的.</p> 
</blockquote> 
<blockquote> 
 <p>如果第一个参数是 false, 那么 enable_if 这个结构就没有一个 type 成员, 这时调用 enable_if::type 就是失败的, 但是不会报错而是跳过当前匹配.</p> 
</blockquote> 
<blockquote> 
 <p>enable_if 的第二个参数提供了一个int, 所以 enable_if::type 其实就是一个 int, 也就是说<br> &lt;typename T, typename enable_if&lt;is_integral&lt;T&gt;::value, int&gt;::type = 0&gt; 等同于<br> &lt;typename T, typename int = 0&gt; 等同于<br> &lt;typename T, int = 0&gt;</p> 
</blockquote> 
<h4><a id="4enable_if_t_458"></a>（4）enable_if_t</h4> 
<p>它基于模板的 SFINAE 和 匿名类型参数 的基础概念上进行了简洁且完美的封装(落地).<br> enable_if_t 强制使用 enable_if 的 ::type 来触发 SFINAE 规则, 如果失败则跳过当前匹配进入下一个匹配.</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> _Test<span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ty</span> <span class="token operator">=</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token keyword">using</span> enable_if_t <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">enable_if</span><span class="token operator">&lt;</span>_Test<span class="token punctuation">,</span> _Ty<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>type<span class="token punctuation">;</span>
</code></pre> 
<p>enable_if_t 节省掉了 typename 和 ::type , 是因为它背后使用 using 帮我们多写了typename 和 ::type (即: 强行重定义了类型).</p> 
<ul><li>eg：</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;type_traits&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token comment">// 省略了 typename</span>
<span class="token comment">// 省略了 ::type</span>
<span class="token comment">//template &lt;typename T, typename std::enable_if_t&lt;std::is_integral&lt;T&gt;::value, int&gt; = 0&gt;也可以编译通过</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>enable_if_t<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>is_integral<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">example</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="5__0__492"></a>（5）后面那个 = 0 是个什么东西?</h4> 
<p>由于 enable_if 第二个类型设定了默认为 void 类型</p> 
<ul><li>模板的非类型参数不能用void，如果使用void会报错</li><li>因此 typename enable_if::void = 0(typename enable_if::void = nullptr） 是失败的, 它会导致程序跳过这个匹配.</li><li>eg：</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;type_traits&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">std</span><span class="token double-colon punctuation">::</span>enable_if<span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>type <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">&gt;</span>
T <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">example</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>测试：<br> <img src="https://images2.imgbox.com/d2/61/3EArabQp_o.png" alt="在这里插入图片描述"></li></ul> 
<p>由于 enable_if 或 enable_if_t 都是采取 匿名类型参数 形式来完成判断行为。</p> 
<ul><li><strong>由于 匿名类型参数 必须要有一个默认值</strong></li><li>因此 大部分的STL、TR1 的代码都会在使用 enable_if 或者 enable_if_t 时, 为第二个类型提供一个 int, 然后设定一个 0 为默认值.</li><li>eg：</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;type_traits&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">std</span><span class="token double-colon punctuation">::</span>enable_if<span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>type<span class="token operator">&gt;</span>
T <span class="token function">example</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"template&lt;typename T = book::author_type &gt; void example();"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">example</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>测试：<br> <img src="https://images2.imgbox.com/8a/75/6D2PFMw4_o.png" alt="在这里插入图片描述"></p> </li><li> <p>eg：</p> </li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">//不是int类型</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>enable_if_t<span class="token operator">&lt;</span><span class="token operator">!</span>std<span class="token double-colon punctuation">::</span>is_interal_v<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span>T <span class="token keyword">const</span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span> t <span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//是int类型</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>enable_if_t<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>is_interal_v<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span>T <span class="token keyword">const</span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"is intarage: "</span><span class="token operator">&lt;&lt;</span>t<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">func</span><span class="token punctuation">(</span><span class="token char">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">3.14f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>测试：<br> <img src="https://images2.imgbox.com/67/cc/yNmem9lj_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="3PIMPL_585"></a>3.PIMPL模式</h3> 
<p>目的：由于具体的实现在Course.cpp中，所以在给Course（ Course::Impl）增加属性的时候，main.cc是不会重新编译的</p> 
<pre><code class="prism language-cpp"><span class="token comment">//Course.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">Course</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">Impl</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Impl<span class="token operator">&gt;</span> impl<span class="token punctuation">;</span>

	<span class="token function">Course</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">Course</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//Course.cc</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Course.h"</span></span>

<span class="token keyword">struct</span> <span class="token class-name">Course</span><span class="token operator">:</span><span class="token base-clause"><span class="token operator">:</span><span class="token class-name">Impl</span></span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		x<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Course</span><span class="token double-colon punctuation">::</span><span class="token function">Course</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">impl</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>Impl<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token class-name">Course</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Course</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">Course</span><span class="token double-colon punctuation">::</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	impl<span class="token operator">-&gt;</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>目的：传值进行浅拷贝，因为Course本身就是一个指针（内部有智能指针）</p> 
<pre><code class="prism language-cpp"><span class="token comment">//main.cc</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Course.h"</span></span>

<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span>Course course<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	course<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Course co<span class="token punctuation">;</span>
	<span class="token function">func</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_640"></a>4.二维数组</h3> 
<pre><code class="prism language-cpp"><span class="token comment">//不好的做法</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">Grid</span><span class="token punctuation">{<!-- --></span>
	vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> p<span class="token punctuation">;</span>
	size_t nx<span class="token punctuation">;</span>
	<span class="token function">Grid</span><span class="token punctuation">(</span>size_t x<span class="token punctuation">,</span> size_t y<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">p</span><span class="token punctuation">(</span>x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nx</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">int</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>size_t x<span class="token punctuation">,</span>size_t y<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token operator">*</span>nx<span class="token operator">+</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



<span class="token keyword">int</span> <span class="token function">java_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">;</span> 
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//好的做法</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//等价于vector&lt;int&gt; p(N*N);</span>
	<span class="token keyword">int</span><span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span> <span class="token punctuation">[</span>N<span class="token operator">*</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>N<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i<span class="token operator">*</span>N<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">;</span>
	<span class="token comment">//更近一步</span>
    Grid <span class="token function">g</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">g</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试访问效率</p> 
<ul><li>eg：my_course/course/tools/POC/04/grid.cpp</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;execution&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ticktock.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">TICK</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">auto</span> bench_</span><span class="token punctuation">##</span><span class="token expression">x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">TOCK</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> #x </span><span class="token string">": "</span> <span class="token expression"><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">duration_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>duration<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> bench_</span><span class="token punctuation">##</span><span class="token expression">x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> </span><span class="token string">"s"</span> <span class="token expression"><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span></span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Grid</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> p<span class="token punctuation">;</span>
    size_t nx<span class="token punctuation">;</span>

    <span class="token function">Grid</span><span class="token punctuation">(</span>size_t nx<span class="token punctuation">,</span> size_t ny<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">p</span><span class="token punctuation">(</span>nx <span class="token operator">*</span> ny<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nx</span><span class="token punctuation">(</span>nx<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>size_t x<span class="token punctuation">,</span> size_t y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> p<span class="token punctuation">[</span>y <span class="token operator">*</span> nx <span class="token operator">+</span> x<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">TICK</span><span class="token punctuation">(</span>java<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            p<span class="token punctuation">[</span>std<span class="token double-colon punctuation">::</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> N<span class="token punctuation">]</span><span class="token punctuation">[</span>std<span class="token double-colon punctuation">::</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> N<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">;</span>
    <span class="token function">TOCK</span><span class="token punctuation">(</span>java<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">TICK</span><span class="token punctuation">(</span>cpp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Grid <span class="token function">g</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//%N防止越界</span>
            <span class="token function">g</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> N<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> N<span class="token punctuation">)</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">TOCK</span><span class="token punctuation">(</span>cpp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="5_764"></a>5.折叠表达式</h3> 
<ul><li> <p><a href="https://blog.csdn.net/zwvista/article/details/53981696">fold expression（折叠表达式）</a></p> </li><li> <p><a href="https://blog.csdn.net/u011436427/article/details/125212802?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166299111216782428694492%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=166299111216782428694492&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125212802-null-null.nonecase&amp;utm_term=forward&amp;spm=1018.2226.3001.4450">（P40-P41）move资源的转移、forward完美转发</a></p> </li><li> <p>eg：my_course/course/tools/POC/04/test.cpp</p> </li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;numeric&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>T<span class="token operator">&gt;</span>
<span class="token keyword">auto</span> <span class="token function">sum</span><span class="token punctuation">(</span>T <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//sum()也可以运行,return (+...+t)也行，但是sum()中必须有值才行</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>eg：course/tools/POC/04/main.cpp</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;numeric&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>T<span class="token operator">&gt;</span>
<span class="token keyword">constexpr</span> <span class="token keyword">auto</span> <span class="token function">sum</span><span class="token punctuation">(</span>T <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T0</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span>T0 <span class="token keyword">const</span> <span class="token operator">&amp;</span>t0<span class="token punctuation">,</span> T <span class="token keyword">const</span> <span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> t0<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span> <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Ts<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">printAll</span><span class="token punctuation">(</span>Ts<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> mXs<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&lt;&lt;</span> mXs<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">const</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"int const &amp;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"int &amp;&amp;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//std::forward作用：</span>
<span class="token comment">//当T为左值引用类型时，t将被转换为T类型的左值</span>
<span class="token comment">//当T不是左值引用类型时，t将被转换为T类型的右值</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">func1</span><span class="token punctuation">(</span>T <span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">func2</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等价于： func2(std::forward&lt;(T)&gt;(t)...);</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printAll</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">generate_n</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">size</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">sin</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">accumulate</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>minus<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//std::reduce可以reduce一个vector的数组</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> arr<span class="token punctuation">;</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">reduce</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//为了支持vector和C数组，可以使用std::begin().std::end(), std::reduce();来自C++17</span>
    <span class="token keyword">float</span> arr<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//等价于float sum = std::reduce(std::begin(arr), std::end(arr),0.f, std::plus&lt;float&gt;{});//std::plus{};是针对所有类型的加法</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">reduce</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">float</span> a<span class="token punctuation">,</span> <span class="token keyword">float</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// std::reduce 比std::accumulate更准确而已</span>

    <span class="token keyword">float</span> arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">generate</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li> <p>其他：<a href="https://blog.csdn.net/challenglistic/article/details/128771677">遍历 “可变参数模板” 的模板参数</a></p> </li><li> <p>参考：<a href="https://www.bilibili.com/video/BV1pq4y1y7oN?spm_id_from=333.337.search-card.all.click&amp;vd_source=32de30d5fa72b146ca37e82aa5fc5934" rel="nofollow">【录播】聊一聊C++设计模式、函数式编程等（持续更新中）</a></p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f24b5ecb1402ca12b4fd1aeb04b43f0d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue-Rules表单验证组件的相关使用:</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22ce148806839fbc8b77911f87ad7fcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c&#43;&#43; 字符串替换replace函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>