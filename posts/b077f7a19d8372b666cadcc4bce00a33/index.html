<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>异步上传图片-ajaxSubmit提交-Poison - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="异步上传图片-ajaxSubmit提交-Poison" />
<meta property="og:description" content="异步上传是一个很蛋疼的问题，今天就来说说异步上传的故事
第一步 引入ajaxSubmit这个js插件
&lt;!--异步提交图片--&gt; &lt;script src=&#34;__PUBLIC__/js/jquery.ajaxSubmit.js&#34;&gt;&lt;/script&gt; 这时候开始页面处理
&lt;input type=&#34;file&#34; id=&#34;file&#34; name=&#34;b_head&#34; class=&#34;col-xs-6 ttee&#34; onchange=&#34;changePhoto();&#34; style=&#34;display: none&#34; /&gt; &lt;label for=&#34;file&#34;&gt; &lt;img &lt;if condition=&#34;$data.user_b_head neq &#39;&#39;&#34;&gt;src=&#34;upload/{$data.user_b_head}&#34;&lt;else/&gt;src=&#34;__PUBLIC__/image/ic_upload.png&#34;&lt;/if&gt; id=&#34;new_pic&#34; alt=&#34;&#34; class=&#34;col-xs-6 img-responsive&#34;/&gt; &lt;/label&gt; &lt;input type=&#34;hidden&#34; name=&#34;user_b_head&#34; id=&#34;head&#34;/&gt; 讲file文件关联到img标签里面，点击img图片就能触发file进行选择文件
开始js处理
&lt;script&gt; $(&#34;.ttee&#34;).click(function () { $(this).wrap(&#34;&lt;form id=&#39;addPic&#39; method=&#39;post&#39; action=&#34;&#43;&#34;{:U(&#39;upload&#39;)}&#34;&#43;&#34; enctype=&#39;multipart/form-data&#39;&gt;&lt;/form&gt;&#34;); }); function changePhoto() { $(&#39;#addPic&#39;).ajaxSubmit({ dataType:&#39;json&#39;, success:function(data){ $(&#39;.ttee&#39;).unwrap(); $(&#39;#new_pic&#39;).attr(&#39;src&#39;,&#34;upload/&#34;&#43;data.src); $(&#34;#head&#34;).val(data.id); }, error:function(err){ $(&#39;.ttee&#39;).unwrap(); console.log(JSON.stringify(err)); } }) } &lt;/script&gt; 这里不难看的出来 在点击的时候给父级包裹一层form表单
当图片选择完时候触发时间 进行插件的提交
$(&#39;.ttee&#39;).unwrap(); 这个则是进行移除form表单
后台接收和平常是一样一样的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b077f7a19d8372b666cadcc4bce00a33/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-12T11:27:15+08:00" />
<meta property="article:modified_time" content="2017-12-12T11:27:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">异步上传图片-ajaxSubmit提交-Poison</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>异步上传是一个很蛋疼的问题，今天就来说说异步上传的故事</p> 
<p> </p> 
<p>第一步 引入ajaxSubmit这个js插件</p> 
<p> </p> 
<p> </p> 
<pre class="has"><code class="language-html">&lt;!--异步提交图片--&gt;
    &lt;script src="__PUBLIC__/js/jquery.ajaxSubmit.js"&gt;&lt;/script&gt;</code></pre> 
<p><br> 这时候开始页面处理</p> 
<p> </p> 
<p> </p> 
<pre class="has"><code class="language-html"> &lt;input type="file" id="file" name="b_head" class="col-xs-6 ttee" onchange="changePhoto();" style="display: none"  /&gt;
                           &lt;label for="file"&gt;
                               &lt;img &lt;if condition="$data.user_b_head neq ''"&gt;src="upload/{$data.user_b_head}"&lt;else/&gt;src="__PUBLIC__/image/ic_upload.png"&lt;/if&gt;  id="new_pic"  alt="" class="col-xs-6 img-responsive"/&gt;
                           &lt;/label&gt;
                           &lt;input type="hidden" name="user_b_head" id="head"/&gt;</code></pre> 
<p><br> 讲file文件关联到img标签里面，点击img图片就能触发file进行选择文件</p> 
<p> </p> 
<p> </p> 
<p>开始js处理</p> 
<p> </p> 
<p> </p> 
<pre class="has"><code class="language-javascript"> &lt;script&gt;
        $(".ttee").click(function () {
            $(this).wrap("&lt;form id='addPic' method='post' action="+"{:U('upload')}"+" enctype='multipart/form-data'&gt;&lt;/form&gt;");
        });
        function changePhoto() {
            $('#addPic').ajaxSubmit({
                dataType:'json',
                success:function(data){
                    $('.ttee').unwrap();
                        $('#new_pic').attr('src',"upload/"+data.src);
                    $("#head").val(data.id);
                },
                error:function(err){
                    $('.ttee').unwrap();
                    console.log(JSON.stringify(err));
                }
            })
        }



    &lt;/script&gt;</code></pre> 
<p><br> 这里不难看的出来 在点击的时候给父级包裹一层form表单</p> 
<p> </p> 
<p>当图片选择完时候触发时间 进行插件的提交</p> 
<p> </p> 
<pre class="has"><code class="language-javascript"> $('.ttee').unwrap();</code></pre> 
<p>这个则是进行移除form表单</p> 
<p> </p> 
<p>后台接收和平常是一样一样的</p> 
<p>我这里是用tp写的</p> 
<p> </p> 
<p> </p> 
<pre class="has"><code class="language-php">//上传图片
    public function upload(){
        $file = $this-&gt;setUpload($_FILES['b_head']);
        $src =  $file['savepath'].$file['savename'];
        $data['src'] = $src;
        //进行数据插入
        $id = M('picture')-&gt;add(array('path'=&gt;$src));
        $data['id'] = $id;
        echo json_encode($data);
    }
    //上传图片
    private function setUpload($file){
        header("Content-Type: text/html;charset=utf-8");
        $upload = new \Think\Upload();// 实例化上传类
        $upload-&gt;maxSize   =     3145728 ;// 设置附件上传大小
        $upload-&gt;exts      =     array('jpg', 'gif', 'png', 'jpeg');// 设置附件上传类型
        $upload-&gt;rootPath  =     './upload/'; // 设置附件上传根目录
        $upload-&gt;savePath  =     date("Y",time())."/".date("m",time())."/".date("d",time())."/"; // 设置附件上传（子）目录
        // 上传文件
        $info   =   $upload-&gt;uploadOne($file);
        if(!$info) {// 上传错误提示错误信息
            $this-&gt;success($upload-&gt;getError());exit;
        }else{// 上传成功
            return $info;
        }
    }</code></pre> 
<p>这样 异步上传图片就完事了，欢迎评论，私人博客还在建设当中</p> 
<p> </p> 
<p>www.poison2016.cn<br>  </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d16b4a0fa20aefe8cd14e98c39d5d39d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">javax.script详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/08138b52741713edec42194250a222e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jsp开发</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>