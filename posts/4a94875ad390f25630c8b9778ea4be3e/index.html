<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ESP32的UART串口通信（基于micropython） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ESP32的UART串口通信（基于micropython）" />
<meta property="og:description" content="ESP32的UART串口通信（基于micropython） ESP32的UART串口通信（基于micropython）摘要软硬件环境正文I have an ESP32I have a 串口屏Ehn！ ESP32串口屏所有文件 碎碎念 摘要 关于esp32基于micropython开发的资料不多，如MicroPython 文档，里面的例程不多。在UART串口通信上的例程更少，故今日来分享一下个人的学习收获。
软硬件环境 硬件有ESP-WROOM-32，TJC3224K028_011串口屏，USB转串口模块，杜邦线若干
软件有thonny，正点原子的XCOM，USART HMI，win10系统，还需要装好串口驱动。
正文 I have an ESP32 我学习ESP32的途径主要有MicroPython 文档和randomnerdtutorials。
esp32 上有三对UART串口，一般情况下esp32开发板的串口0是用来烧录的，串口1接了外置sd卡，所以最好使用闲置的串口2，避免发生冲突，方便调试。
首先，初始化串口2，并设置波特率为115200。关于初始化串口，还有一些参数可添加，此处这两个就够了，详情可参考此处。
from machine import UART #　导入串口模块 uart = UART(2, 115200) #　初始化一个串口　然后通过几个函数，进行数据的收发。
uart.read() # 读取所有收到的信息 uart.write(&#39;abc&#39;) # 发送abc三个字符 关于发送数据，有点py基础的人应该都知道字符串前加上标识表是不同类型的字符，如：详情可参考此处
&#39;\xff&#39; # 默认字符串，该转义的会转义 u&#39;\xff&#39; # 同上 r&#39;\xff&#39; # 不转义字符串 b&#39;\xff&#39; # 二进制字符串 而对于串口屏的数据发送，最好还是采用b&#39;\xff&#39;的格式，否则会出现结束符无法被串口屏识别的情况。如
上图中有效的结束符只有第四句uart.write(b&#34;\xff\xff\xff&#34;)，uart.write(r&#34;\xFF\xFF\xFF&#34;)也不行，我试过了，反正用二进制发送准没错。
建议修改句也用二进制发送，以免出现莫名其妙不可预知的问题。
好了，此时基础的数据收发已经学会了，现在我们需要整串口屏了
I have a 串口屏 关于串口屏的学习建议参考此处，讲的非常清楚。
通过USART HMI搭一个用来演示的界面，图中蓝框选中的是数字控件n0，右下角选中的是控件所显示的值val，我们可以通过修改n0的val值n0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4a94875ad390f25630c8b9778ea4be3e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-17T00:40:37+08:00" />
<meta property="article:modified_time" content="2021-05-17T00:40:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ESP32的UART串口通信（基于micropython）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ESP32UARTmicropython_0"></a>ESP32的UART串口通信（基于micropython）</h2> 
<p></p> 
<div class="toc"> 
 <h4> </h4> 
 <ul><li><a href="#ESP32UARTmicropython_0" rel="nofollow">ESP32的UART串口通信（基于micropython）</a></li><li><ul><li><a href="#_2" rel="nofollow">摘要</a></li><li><a href="#_4" rel="nofollow">软硬件环境</a></li><li><a href="#_8" rel="nofollow">正文</a></li><li><ul><li><a href="#I_have_an_ESP32_9" rel="nofollow">I have an ESP32</a></li><li><a href="#I_have_a__40" rel="nofollow">I have a 串口屏</a></li><li><a href="#Ehn_ESP32_73" rel="nofollow">Ehn！ ESP32串口屏</a></li><li><a href="#_77" rel="nofollow">所有文件</a></li></ul> 
   </li><li><a href="#_80" rel="nofollow">碎碎念</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>摘要</h3> 
<p>关于esp32基于micropython开发的资料不多，如<a href="http://docs.micropython.01studio.org/zh_CN/latest/index.html" rel="nofollow">MicroPython 文档</a>，里面的例程不多。在UART串口通信上的例程更少，故今日来分享一下个人的学习收获。</p> 
<h3><a id="_4"></a>软硬件环境</h3> 
<p>硬件有ESP-WROOM-32，TJC3224K028_011串口屏，USB转串口模块，杜邦线若干</p> 
<p>软件有thonny，正点原子的XCOM，USART HMI，win10系统，还需要装好串口驱动。</p> 
<h3><a id="_8"></a>正文</h3> 
<h4><a id="I_have_an_ESP32_9"></a>I have an ESP32</h4> 
<p>我学习ESP32的途径主要有<a href="http://docs.micropython.01studio.org/zh_CN/latest/index.html" rel="nofollow">MicroPython 文档</a>和<a href="https://randomnerdtutorials.com/" rel="nofollow">randomnerdtutorials</a>。</p> 
<blockquote> 
 <p>esp32 上有三对UART串口，一般情况下esp32开发板的串口0是用来烧录的，串口1接了外置sd卡，所以最好使用闲置的串口2，避免发生冲突，方便调试。</p> 
</blockquote> 
<p>首先，初始化串口2，并设置波特率为115200。关于初始化串口，还有一些参数可添加，此处这两个就够了，详情可参考<a href="http://docs.micropython.01studio.org/zh_CN/latest/library/machine.UART.html#machine.UART.init" rel="nofollow">此处</a>。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> UART     <span class="token comment">#　导入串口模块</span>
uart <span class="token operator">=</span> UART<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>       <span class="token comment">#　初始化一个串口　</span>
</code></pre> 
<p>然后通过几个函数，进行数据的收发。</p> 
<pre><code class="prism language-python">uart<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment"># 读取所有收到的信息</span>
uart<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>            <span class="token comment"># 发送abc三个字符</span>
</code></pre> 
<p>关于发送数据，有点py基础的人应该都知道字符串前加上标识表是不同类型的字符，如：详情可参考<a href="https://blog.csdn.net/qq_35290785/article/details/90634344">此处</a></p> 
<pre><code class="prism language-python"><span class="token string">'\xff'</span>                       <span class="token comment"># 默认字符串，该转义的会转义</span>
u<span class="token string">'\xff'</span>                      <span class="token comment"># 同上</span>
r<span class="token string">'\xff'</span>                      <span class="token comment"># 不转义字符串</span>
b<span class="token string">'\xff'</span>                      <span class="token comment"># 二进制字符串</span>
</code></pre> 
<p>而对于串口屏的数据发送，最好还是采用<code>b'\xff'</code>的格式，否则会出现结束符无法被串口屏识别的情况。如<img src="https://images2.imgbox.com/0c/c0/mGWXg09h_o.png" alt="用正点的xcom的所反馈结果" width="350" height="150"><br> <img src="https://images2.imgbox.com/05/2c/1wBq5or8_o.png" alt="USART HMI上串口调试结果" width="350" height="150"><br> 上图中有效的结束符只有第四句<code>uart.write(b"\xff\xff\xff")</code>，<code>uart.write(r"\xFF\xFF\xFF")</code>也不行，我试过了，反正用二进制发送准没错。<br> 建议修改句也用二进制发送，以免出现莫名其妙不可预知的问题。</p> 
<p>好了，此时基础的数据收发已经学会了，现在我们需要整串口屏了</p> 
<h4><a id="I_have_a__40"></a>I have a 串口屏</h4> 
<p>关于串口屏的学习建议参考<a href="http://wiki.tjc1688.com/doku.php?id=start" rel="nofollow">此处</a>，讲的非常清楚。<br> 通过USART HMI搭一个用来演示的界面，图中蓝框选中的是数字控件<code>n0</code>，右下角选中的是控件所显示的值<code>val</code>，我们可以通过修改n0的val值<code>n0.val</code>来改变显示的数字。<br> <img src="https://images2.imgbox.com/dd/52/uWz3HJ0z_o.png" alt="串口屏界面"></p> 
<p>参考<a href="http://wiki.tjc1688.com/doku.php?id=6.%E6%8C%87%E4%BB%A4%E9%9B%86:7.%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1" rel="nofollow">此处</a>可知，通过外界串口改变串口屏控件的值需要以三个十六位进制数<code>\xff\xff\xff</code>作为结束符。</p> 
<p>好的，那我们通过usb转串口模块把ESP32的串口2连接到电脑，先在USART HMI上调试一下。</p> 
<p>先把上面的代码稍加修改后复制下来粘到thonny里</p> 
<pre><code class="prism language-python"><span class="token comment"># code: gb2312</span>
<span class="token keyword">from</span> machine <span class="token keyword">import</span> UART     <span class="token comment"># 导入串口模块</span>
<span class="token keyword">import</span> time                  <span class="token comment"># 导入时间模块</span>

uart <span class="token operator">=</span> UART<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">)</span>       <span class="token comment"># 初始化串口2，并设置波特率为115200</span>

uart<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"n0.val=700"</span><span class="token punctuation">)</span>    <span class="token comment"># 以二进制形式发送修改文本</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                <span class="token comment"># 休息两秒，此行和上面那个导入时间模块的代码删了也行</span>
                             <span class="token comment"># 加上是为了在回显中能让修改式和结束符能分行</span>
uart<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"\xff\xff\xff"</span><span class="token punctuation">)</span>  <span class="token comment"># 发送结束符</span>

uart<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"n0.val=600"</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 
uart<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">"\xff\xff\xff"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                     <span class="token comment"># 打印个1以表结束</span>

</code></pre> 
<p>我们来看看输出<br> <img src="https://images2.imgbox.com/a1/5c/Ck2U00NG_o.gif" alt="gif"></p> 
<h4><a id="Ehn_ESP32_73"></a>Ehn！ ESP32串口屏</h4> 
<p>用杜邦线把串口屏和ESP32链接起来，<s>相信应该不用我讲怎么用杜邦线连接串口屏和ESP32吧。</s> 注意rx和tx要反接。<br> 接好后我们就能通过ESP32向串口屏发送修改指令了。<br> 介于桌面太乱，就不拍实物展示了。</p> 
<h4><a id="_77"></a>所有文件</h4> 
<p>https://download.csdn.net/download/m0_50696464/18788059</p> 
<h3><a id="_80"></a>碎碎念</h3> 
<blockquote> 
 <p>你问我为什么用mpy（thonny）而不用c（arduino IDE）？这不重要。个人对py情有独钟，但凡能用py的绝不用c。</p> 
</blockquote> 
<blockquote> 
 <p>相比于串口屏，纯lcd模块太难用了。接口多就算了，各种函数看的我脑壳痛，写了几百行，界面还是丑的要命。串口屏就四个接口，VCC、GND、RX、TX用起来真心比lcd方便多了，还有上位机软件能搭建漂亮的图形界面，操作起来非常友好。如果不想在这方面走太深学个串口屏完全够用了，学lcd模块操作真没啥必要。不过价格上确实是lcd便宜，这没话说。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/72c8beeccdc4751aa6d40da2d69a57b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">笔记-软件质量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62780f4fde2868075f2c6d8e7693e78f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c语言对比两个字符串相等,c语言中如何判断两个字符串相等</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>