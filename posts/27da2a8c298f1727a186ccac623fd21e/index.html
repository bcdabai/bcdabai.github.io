<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python项目实践-客户流失预测 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python项目实践-客户流失预测" />
<meta property="og:description" content="一、概述 1.1 项目背景：
客户是企业的重要资源，也是企业的无形资产，客户的流失，也就意味着资产的流失，因此进行流失分析是十分重要的，进行客户流失分析的目的，就是阻止或者避免客户的流失，特高企业的盈利水平和竞争力。
1.2 目的：
深入了解用户画像及行为偏好，挖掘出影响用户流失的关键因素，并通过算法预测客户访问的转化结果，从而更好地完善产品设计、提升用户体验。
1.3 数据说明：
此次数据是携程用户一周的访问数据，为保护客户隐私，已经将数据经过了脱敏，和实际商品的订单量、浏览量、转化率等有一些差距，不影响问题的可解性。
二、读取数据 2.1 理解数据
可以看到变量比较的多，先进行分类，除去目标变量label，此数据集的字段可以分成三个类别：订单相关指标、客户行为相关指标、酒店相关指标。
2.2 导入相关库及数据
import numpy as np import pandas as pd import seaborn as sns import matplotlib.pyplot as plt %matplotlib inline # 显示全部特征 pd.set_option(&#39;display.max_columns&#39;, None) df = pd.read_csv(r&#34;./userlostprob.txt&#34;,sep=&#34;\t&#34;,encoding=&#34;UTF-8&#34;) df.head() # 查看数据维度 df.shape 总共689945条样本数据，除去标签和id列，总共49个特征。
# 查看数据类型 df.info() 只有d和arrival列为字符型，其余均为数值型，后面将d和arrival列处理为数值型即可。 # 查看缺失值占比 df.isnull().mean() 数据集的缺失情况比较严重，有44列存在缺失情况 # 查看标签分布 df[&#39;label&#39;].value_counts() # 描述性统计 df.describe() 数据存在负值和极值 三、特征工程 # 将数据copy一份 rawdf=df.copy() 3.1 数据预处理
3.1.1 数据类型转换" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/27da2a8c298f1727a186ccac623fd21e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-05T18:00:08+08:00" />
<meta property="article:modified_time" content="2020-01-05T18:00:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python项目实践-客户流失预测</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <h3>一、概述</h3> 
 <p><b>1.1 项目背景：</b></p> 
 <p> 客户是企业的重要资源，也是企业的无形资产，客户的流失，也就意味着资产的流失，因此进行流失分析是十分重要的，进行客户流失分析的目的，就是阻止或者避免客户的流失，特高企业的盈利水平和竞争力。</p> 
 <p><b>1.2 目的：</b></p> 
 <p> 深入了解用户画像及行为偏好，挖掘出影响用户流失的关键因素，并通过算法预测客户访问的转化结果，从而更好地完善产品设计、提升用户体验。</p> 
 <p><b>1.3 数据说明：</b></p> 
 <p> 此次数据是携程用户一周的访问数据，为保护客户隐私，已经将数据经过了脱敏，和实际商品的订单量、浏览量、转化率等有一些差距，不影响问题的可解性。</p> 
 <h3><b>二、读取数据</b></h3> 
 <p><b>2.1 理解数据</b></p> 
 <p>可以看到变量比较的多，先进行分类，除去目标变量label，此数据集的字段可以分成三个类别：订单相关指标、客户行为相关指标、酒店相关指标。</p> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ab/61/1CwtFSkF_o.png" width="622" alt="v2-fd05bb4803eb1eec99cad7001048033d_b.jpg"> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/45/dd/SjlBrhwR_o.png" width="1200" alt="v2-c5765d9f706c2e8f45e29e5b512d5a52_b.jpg"> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/6a/7b/QwhqqmFo_o.png" width="1200" alt="v2-e36516db5611249bf25a3608c4f3924b_b.jpg"> 
 </div> 
 <p><b>2.2 导入相关库及数据</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># 显示全部特征</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"./userlostprob.txt"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c5/db/LjEPP6mk_o.png" width="1013" alt="v2-fceffdb86d7edbc09f8fc389b6e32521_b.jpg"> 
 </div> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 查看数据维度</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span></code></pre> 
 </div> 
 <p>总共689945条样本数据，除去标签和id列，总共49个特征。</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 查看数据类型</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c4/29/wxj0wK2T_o.png" width="877" alt="v2-c58c466ba6d914946d313faa0c67d42a_b.jpg"> 
 </div> 
 <figcaption>
   只有d和arrival列为字符型，其余均为数值型，后面将d和arrival列处理为数值型即可。 
 </figcaption> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 查看缺失值占比</span>
<span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ba/bd/72XixNxc_o.png" width="705" alt="v2-7fc63c6fccfca916a96a70d8fb47def7_b.jpg"> 
 </div> 
 <figcaption>
   数据集的缺失情况比较严重，有44列存在缺失情况 
 </figcaption> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 查看标签分布</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/76/8d/WAFTGKzI_o.jpg" width="236" alt="v2-53a4e55f281ae3d70efb77dc175c8450_b.jpg"> 
 </div> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 描述性统计</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/92/da/hEMpZe7L_o.png" width="1016" alt="v2-927b67298680d786d5cfc7c483bcd8a8_b.jpg"> 
 </div> 
 <figcaption>
   数据存在负值和极值 
 </figcaption> 
 <h3>三、特征工程</h3> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 将数据copy一份</span>
<span class="n">rawdf</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></code></pre> 
 </div> 
 <p><b>3.1 数据预处理</b></p> 
 <p><b>3.1.1 数据类型转换</b></p> 
 <p>字符串类型的特征需要处理成数值型才能建模,将arrival和d相减得到"提前预定的天数",作为新的特征.</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1">## 增加列</span>
<span class="c1"># 将两个日期变量由字符串转换为日期型格式</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'arrival'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="s1">'arrival'</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'d'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="s1">'d'</span><span class="p">])</span>
<span class="c1"># 生成提前预定时间列(衍生变量)</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'day_advanced'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="s1">'arrival'</span><span class="p">]</span><span class="o">-</span><span class="n">rawdf</span><span class="p">[</span><span class="s1">'d'</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>

<span class="c1">## 删除列</span>
<span class="n">rawdf</span><span class="o">=</span><span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'sampleid'</span><span class="p">,</span><span class="s1">'d'</span><span class="p">,</span><span class="s1">'arrival'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre> 
 </div> 
 <p><b>3.1.2 异常值处理</b></p> 
 <ul><li>将customer_value_profit、ctrip_profits中的负值按0处理</li><li>将delta_price1、delta_price2、lowestprice中的负值按中位数处理</li></ul> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">filter_one</span><span class="o">=</span><span class="p">[</span><span class="s1">'customer_value_profit'</span><span class="p">,</span><span class="s1">'ctrip_profits'</span><span class="p">]</span>
<span class="n">filter_two</span><span class="o">=</span><span class="p">[</span><span class="s1">'delta_price1'</span><span class="p">,</span><span class="s1">'delta_price2'</span><span class="p">,</span><span class="s1">'lowestprice'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filter_one</span><span class="p">:</span>
    <span class="n">rawdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rawdf</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filter_two</span><span class="p">:</span>
    <span class="n">rawdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rawdf</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">rawdf</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

<span class="n">rawdf</span><span class="p">[[</span><span class="s1">'customer_value_profit'</span><span class="p">,</span><span class="s1">'ctrip_profits'</span><span class="p">,</span><span class="s1">'delta_price1'</span><span class="p">,</span><span class="s1">'delta_price2'</span><span class="p">,</span><span class="s1">'lowestprice'</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/a5/8b/lXDyNb6f_o.jpg" width="611" alt="v2-711cb9090a30fe8cd591f2e4bd9a78b8_b.jpg"> 
 </div> 
 <p><b>3.1.3 缺失值处理</b></p> 
 <p><b>3.1.3.1 空值删除</b></p> 
 <p>特征值中只有iforderpv_24h、sid、h、day_advanced这四个是不存在缺失的,其他的44个特征都是存在缺失值的,并且大部分的缺失值都挺多的,因此需要对缺失值进行处理.</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 定义删除空值行列的函数</span>
<span class="k">def</span> <span class="nf">nan_drop</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axi</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axi</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">axi</span><span class="p">]</span><span class="o">*</span><span class="n">rate</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
<span class="c1"># 删除缺失值比例大于80%的行和列</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'删除空值前数据维度是:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rawdf</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">nan_drop</span><span class="p">(</span><span class="n">rawdf</span><span class="p">,</span><span class="n">axi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">nan_drop</span><span class="p">(</span><span class="n">rawdf</span><span class="p">,</span><span class="n">axi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">'删除空值后数据维度是:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rawdf</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/bb/a6/GQkFV9Pr_o.png" width="260" alt="v2-980dc859bc1c62a0a03067e6b3c5ead1_b.png"> 
 </div> 
 <p><b>3.1.3.2 缺失值填充</b></p> 
 <p>趋于正态分布的字段,使用均值填充:businessrate_pre2、cancelrate_pre、businessrate_pre;偏态分布的字段,使用中位数填充.</p> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/87/1a/ZFU0EFeE_o.png" width="559" alt="v2-cca90c09488d2787f9c9dcfaa4fa8c78_b.jpg"> 
 </div> 
 <div class="has"> 
  <pre><code class="language-python"><span class="k">def</span> <span class="nf">nan_fill</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">filter_mean</span><span class="o">=</span><span class="p">[</span><span class="s1">'businessrate_pre2'</span><span class="p">,</span><span class="s1">'cancelrate_pre'</span><span class="p">,</span><span class="s1">'businessrate_pre'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">filter_mean</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">rawdf</span><span class="o">=</span><span class="n">nan_fill</span><span class="p">(</span><span class="n">rawdf</span><span class="p">)</span></code></pre> 
 </div> 
 <p><b>3.1.4 极值处理</b></p> 
 <p>有些特征明显有异常大和异常小的值,这里分别使用1%和99%分位数替换超过上下限的值.</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rawdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">rawdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rawdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">99</span><span class="p">),</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">99</span><span class="p">)</span></code></pre> 
 </div> 
 <p><b>3.2 相关性分析</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 用户特征的相关性分析</span>
<span class="c1"># 用户特征提取</span>
<span class="n">user_features</span><span class="o">=</span><span class="p">[</span><span class="s1">'visitnum_oneyear'</span><span class="p">,</span><span class="s1">'starprefer'</span><span class="p">,</span><span class="s1">'sid'</span><span class="p">,</span><span class="s1">'price_sensitive'</span><span class="p">,</span><span class="s1">'ordernum_oneyear'</span><span class="p">,</span><span class="s1">'ordercanncelednum'</span><span class="p">,</span><span class="s1">'ordercanceledprecent'</span><span class="p">,</span><span class="s1">'lastpvgap'</span><span class="p">,</span>
               <span class="s1">'lasthtlordergap'</span><span class="p">,</span><span class="s1">'landhalfhours'</span><span class="p">,</span><span class="s1">'iforderpv_24h'</span><span class="p">,</span><span class="s1">'historyvisit_totalordernum'</span><span class="p">,</span><span class="s1">'historyvisit_avghotelnum'</span><span class="p">,</span><span class="s1">'h'</span><span class="p">,</span>
               <span class="s1">'delta_price2'</span><span class="p">,</span><span class="s1">'delta_price1'</span><span class="p">,</span><span class="s1">'decisionhabit_user'</span><span class="p">,</span><span class="s1">'customer_value_profit'</span><span class="p">,</span><span class="s1">'ctrip_profits'</span><span class="p">,</span><span class="s1">'cr'</span><span class="p">,</span><span class="s1">'consuming_capacity'</span><span class="p">,</span><span class="s1">'avgprice'</span><span class="p">]</span>
<span class="c1"># 生成用户特征的相关性矩阵</span>
<span class="n">corr_mat</span><span class="o">=</span><span class="n">rawdf</span><span class="p">[</span><span class="n">user_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># 绘制用户特征的相关性矩阵热度图</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_mat</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Oranges'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/用户特征的相关性分析.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/6c/3e/XwwwUsa8_o.png" width="1200" alt="v2-b63b507402aaefe35a5c3c2eb84ed20a_b.jpg"> 
 </div> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 酒店信息特征的相关性分析</span>
<span class="n">hotel_features</span><span class="o">=</span><span class="p">[</span><span class="s1">'hotelcr'</span><span class="p">,</span><span class="s1">'hoteluv'</span><span class="p">,</span><span class="s1">'commentnums'</span><span class="p">,</span><span class="s1">'novoters'</span><span class="p">,</span><span class="s1">'cancelrate'</span><span class="p">,</span><span class="s1">'lowestprice'</span><span class="p">,</span><span class="s1">'cr_pre'</span><span class="p">,</span><span class="s1">'uv_pre'</span><span class="p">,</span><span class="s1">'uv_pre2'</span><span class="p">,</span><span class="s1">'businessrate_pre'</span><span class="p">,</span>
                <span class="s1">'businessrate_pre2'</span><span class="p">,</span><span class="s1">'customereval_pre2'</span><span class="p">,</span><span class="s1">'commentnums_pre'</span><span class="p">,</span><span class="s1">'commentnums_pre2'</span><span class="p">,</span><span class="s1">'cancelrate_pre'</span><span class="p">,</span><span class="s1">'novoters_pre'</span><span class="p">,</span><span class="s1">'novoters_pre2'</span><span class="p">,</span>
                <span class="s1">'deltaprice_pre2_t1'</span><span class="p">,</span><span class="s1">'lowestprice_pre'</span><span class="p">,</span><span class="s1">'lowestprice_pre2'</span><span class="p">,</span><span class="s1">'firstorder_bu'</span><span class="p">,</span><span class="s1">'historyvisit_visit_detailpagenum'</span><span class="p">]</span>
<span class="c1"># 生成用户特征的相关性矩阵</span>
<span class="n">corr_mat1</span><span class="o">=</span><span class="n">rawdf</span><span class="p">[</span><span class="n">hotel_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_mat1</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Oranges_r'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/酒店信息特征的相关性分析.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c4/d5/JRIZCSyv_o.png" width="1200" alt="v2-d2cfeaec1b3532c2c543c14f5749de19_b.jpg"> 
 </div> 
 <p><b>3.3 降维</b></p> 
 <p><b>3.3.1 主成分分析法(PCA)</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">c_value</span><span class="o">=</span><span class="p">[</span><span class="s1">'customer_value_profit'</span><span class="p">,</span><span class="s1">'ctrip_profits'</span><span class="p">]</span>                   <span class="c1"># 用户价值</span>
<span class="n">consume_level</span><span class="o">=</span><span class="p">[</span><span class="s1">'avgprice'</span><span class="p">,</span><span class="s1">'consuming_capacity'</span><span class="p">]</span>                     <span class="c1"># 用户消费水平</span>
<span class="n">price_prefer</span><span class="o">=</span><span class="p">[</span><span class="s1">'delta_price1'</span><span class="p">,</span><span class="s1">'delta_price2'</span><span class="p">]</span>                        <span class="c1"># 用户偏好价格</span>
<span class="n">hotel_hot</span><span class="o">=</span><span class="p">[</span><span class="s1">'commentnums'</span><span class="p">,</span><span class="s1">'novoters'</span><span class="p">]</span>                                <span class="c1"># 酒店热度</span>
<span class="n">hotel_hot_pre</span><span class="o">=</span><span class="p">[</span><span class="s1">'commentnums_pre'</span><span class="p">,</span><span class="s1">'novoters_pre'</span><span class="p">]</span>                    <span class="c1"># 24小时内浏览次数最多的酒店热度</span>
<span class="n">hotel_hot_pre2</span><span class="o">=</span><span class="p">[</span><span class="s1">'commentnums_pre2'</span><span class="p">,</span><span class="s1">'novoters_pre2'</span><span class="p">]</span>                 <span class="c1"># 24小时内浏览酒店的平均热度</span>

<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="n">pca</span><span class="o">=</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'c_value'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">c_value</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'consume_level'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">consume_level</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'price_prefer'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">price_prefer</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'hotel_hot'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">hotel_hot</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'hotel_hot_pre'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">hotel_hot_pre</span><span class="p">])</span>
<span class="n">rawdf</span><span class="p">[</span><span class="s1">'hotel_hot_pre2'</span><span class="p">]</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawdf</span><span class="p">[</span><span class="n">hotel_hot_pre2</span><span class="p">])</span>

<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">c_value</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">consume_level</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">price_prefer</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">hotel_hot</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">hotel_hot_pre</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">hotel_hot_pre2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'historyvisit_totalordernum'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1">###把重复的一列删了</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'PCA降维后数据维度是：{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rawdf</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c7/cf/MWF5nV1g_o.png" width="256" alt="v2-cb8aa94041df9cc557294e3a09fdd35b_b.png"> 
 </div> 
 <p><b>3.4 数据标准化</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 数据标准化</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">y</span><span class="o">=</span><span class="n">rawdf</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span>
<span class="n">x</span><span class="o">=</span><span class="n">rawdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'label'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">X</span><span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre> 
 </div> 
 <h3><b>四、建模与模型评估</b></h3> 
 <p>数据集的划分原则上应当在缺失值和异常值处理之前就进行，也就是说从数据预处理阶段开始，验证集和测试集就不应参与到模型构建的各个阶段中来，而应仅使用训练集得到的信息，这样才能有效严谨的保证模型验证和评估不会出现潜在的过拟合问题。</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>

<span class="n">X_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">420</span><span class="p">)</span></code></pre> 
 </div> 
 <p><b>4.1 逻辑回归</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>                                        <span class="c1"># 实例化一个LR模型</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                                          <span class="c1"># 训练模型</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>                           <span class="c1"># 预测1类的概率</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                                      <span class="c1"># 模型对测试集的预测结果</span>
<span class="n">fpr_lr</span><span class="p">,</span><span class="n">tpr_lr</span><span class="p">,</span><span class="n">threshold_lr</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>    <span class="c1"># 获取真阳率、伪阳率、阈值</span>
<span class="n">auc_lr</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_lr</span><span class="p">,</span><span class="n">tpr_lr</span><span class="p">)</span>                              <span class="c1"># AUC得分</span>
<span class="n">score_lr</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>                 <span class="c1"># 模型准确率</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_lr</span><span class="p">,</span><span class="n">auc_lr</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/6b/7c/icLDX0Oo_o.jpg" width="455" alt="v2-f48826eaaa777eab4d1aa7f77e5d11e7_b.jpg"> 
 </div> 
 <p><b>4.2 朴素贝叶斯</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>

<span class="n">gnb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>                                                <span class="c1"># 实例化一个LR模型</span>
<span class="n">gnb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                                          <span class="c1"># 训练模型</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>                           <span class="c1"># 预测1类的概率</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                                      <span class="c1"># 模型对测试集的预测结果</span>
<span class="n">fpr_gnb</span><span class="p">,</span><span class="n">tpr_gnb</span><span class="p">,</span><span class="n">threshold_gnb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>  <span class="c1"># 获取真阳率、伪阳率、阈值</span>
<span class="n">auc_gnb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_gnb</span><span class="p">,</span><span class="n">tpr_gnb</span><span class="p">)</span>                            <span class="c1"># AUC得分</span>
<span class="n">score_gnb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>                 <span class="c1"># 模型准确率</span>


<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_gnb</span><span class="p">,</span><span class="n">auc_gnb</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/95/c4/NAJ8SeTQ_o.jpg" width="463" alt="v2-d70d474ce86023b71d5da1e76a77cb2d_b.jpg"> 
 </div> 
 <p><b>4.3 支持向量机</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">'rbf'</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                              <span class="c1"># 决策边界距离</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                                        <span class="c1"># 模型对测试集的预测结果</span>
<span class="n">fpr_svc</span><span class="p">,</span><span class="n">tpr_svc</span><span class="p">,</span><span class="n">threshold_svc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>    <span class="c1"># 获取真阳率、伪阳率、阈值</span>
<span class="n">auc_svc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_svc</span><span class="p">,</span><span class="n">tpr_svc</span><span class="p">)</span>                              <span class="c1"># 模型准确率</span>
<span class="n">score_svc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_svc</span><span class="p">,</span><span class="n">auc_svc</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/36/9b/AA9zDMce_o.jpg" width="443" alt="v2-5ae9e8074dbded78ee23ee435cd98256_b.jpg"> 
 </div> 
 <p><b>4.4 决策树</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>

<span class="n">dtc</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">()</span>                              <span class="c1"># 建立决策树模型</span>
<span class="n">dtc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                                         <span class="c1"># 训练模型</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">dtc</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>                          <span class="c1"># 预测1类的概率</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">dtc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                                     <span class="c1"># 模型对测试集的预测结果 </span>
<span class="n">fpr_dtc</span><span class="p">,</span><span class="n">tpr_dtc</span><span class="p">,</span><span class="n">threshod_dtc</span><span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>   <span class="c1"># 获取真阳率、伪阳率、阈值</span>
<span class="n">score_dtc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>                
<span class="n">auc_dtc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_dtc</span><span class="p">,</span><span class="n">tpr_dtc</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_dtc</span><span class="p">,</span><span class="n">auc_dtc</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/7e/d9/DJ1UO4WL_o.jpg" width="434" alt="v2-070c3f439973fcaecc9ed6100cb26b95_b.jpg"> 
 </div> 
 <p><b>4.5 随机森林</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>                                     <span class="c1"># 建立随机森林分类器</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                                           <span class="c1"># 训练随机森林模型</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>                            <span class="c1"># 预测1类的概率</span>
<span class="n">y_pred</span><span class="o">=</span><span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                                         <span class="c1"># 模型对测试集的预测结果</span>
<span class="n">fpr_rfc</span><span class="p">,</span><span class="n">tpr_rfc</span><span class="p">,</span><span class="n">threshold_rfc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>   <span class="c1"># 获取真阳率、伪阳率、阈值  </span>
<span class="n">auc_rfc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_rfc</span><span class="p">,</span><span class="n">tpr_rfc</span><span class="p">)</span>                             <span class="c1"># AUC得分</span>
<span class="n">score_rfc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>                  <span class="c1"># 模型准确率</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_rfc</span><span class="p">,</span><span class="n">auc_rfc</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c5/f4/uzJnd3JM_o.jpg" width="448" alt="v2-bdfe38781c2d4b81fa8d326fbdce26ec_b.jpg"> 
 </div> 
 <p><b>4.6 XGBoost</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">import</span> <span class="nn">xgboost</span> <span class="kn">as</span> <span class="nn">xgb</span>

<span class="c1"># 读入训练数据集和测试集</span>
<span class="n">dtrain</span><span class="o">=</span><span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">dtest</span><span class="o">=</span><span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># 设置xgboost建模参数</span>
<span class="n">params</span><span class="o">=</span><span class="p">{<!-- --></span><span class="s1">'booster'</span><span class="p">:</span><span class="s1">'gbtree'</span><span class="p">,</span><span class="s1">'objective'</span><span class="p">:</span> <span class="s1">'binary:logistic'</span><span class="p">,</span><span class="s1">'eval_metric'</span><span class="p">:</span> <span class="s1">'auc'</span><span class="p">,</span>
    <span class="s1">'max_depth'</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s1">'gamma'</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">'lambda'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'subsample'</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span><span class="s1">'colsample_bytree'</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="s1">'min_child_weight'</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">'eta'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span><span class="s1">'nthread'</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s1">'silent'</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="c1"># 训练模型</span>
<span class="n">watchlist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dtrain</span><span class="p">,</span><span class="s1">'train'</span><span class="p">)]</span>
<span class="n">bst</span><span class="o">=</span><span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">dtrain</span><span class="p">,</span><span class="n">num_boost_round</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">evals</span><span class="o">=</span><span class="n">watchlist</span><span class="p">)</span>

<span class="c1"># 输入预测为正类的概率值</span>
<span class="n">y_prob</span><span class="o">=</span><span class="n">bst</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dtest</span><span class="p">)</span>

<span class="c1"># 设置阈值为0.5，得到测试集的预测结果</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_prob</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span>

<span class="c1"># 获取真阳率、伪阳率、阈值</span>
<span class="n">fpr_xgb</span><span class="p">,</span><span class="n">tpr_xgb</span><span class="p">,</span><span class="n">threshold_xgb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_prob</span><span class="p">)</span>   
<span class="n">auc_xgb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr_xgb</span><span class="p">,</span><span class="n">tpr_xgb</span><span class="p">)</span>    <span class="c1"># AUC得分</span>
<span class="n">score_xgb</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>    <span class="c1"># 模型准确率</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'模型准确率为:{0},AUC得分为:{1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_xgb</span><span class="p">,</span><span class="n">auc_xgb</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'============================================================'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">target_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/18/76/Y1E6fk0P_o.jpg" width="437" alt="v2-9ce0a9cfbc247de75e40d3ef48a2a41e_b.jpg"> 
 </div> 
 <p><b>4.7 模型比较</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'bmh'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_lr</span><span class="p">,</span><span class="n">tpr_lr</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'lr: {0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_lr</span><span class="p">))</span>            <span class="c1"># 逻辑回归</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_gnb</span><span class="p">,</span><span class="n">tpr_gnb</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'gnb:{0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_gnb</span><span class="p">))</span>         <span class="c1"># 朴素贝叶斯</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_svc</span><span class="p">,</span><span class="n">tpr_svc</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'svc:{0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_svc</span><span class="p">))</span>         <span class="c1"># 支持向量机</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_dtc</span><span class="p">,</span><span class="n">tpr_dtc</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'dtc:{0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_dtc</span><span class="p">))</span>         <span class="c1"># 决策树</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_rfc</span><span class="p">,</span><span class="n">tpr_rfc</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'rfc:{0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_rfc</span><span class="p">))</span>         <span class="c1"># 随机森林</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_rfc</span><span class="p">,</span><span class="n">tpr_rfc</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'xgb:{0:.3f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score_xgb</span><span class="p">))</span>         <span class="c1"># XGBoost</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower right'</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{<!-- --></span><span class="s1">'size'</span><span class="p">:</span><span class="mi">25</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'伪阳率'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'真阳率'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'ROC曲线'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/模型比较图.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/27/c9/DwIVO6Ei_o.png" width="1200" alt="v2-d81ecd83218728fb8d3ef414b30c57ba_b.jpg"> 
 </div> 
 <p><b>4.8 重要特征</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">plot_importance</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plot_importance</span><span class="p">(</span><span class="n">bst</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">max_num_features</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'chocolate'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/重要特征图.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/27/62/D17EfFCU_o.png" width="1200" alt="v2-6d57a371aa1dc94ef5fd70b9fcba7360_b.jpg"> 
 </div> 
 <p>重要的特征：24小时内是否访问订单填写页(24小时内是否访问订单填写页)、近3个月用户历史日均访问酒店数(historyvisit_avghotelnum)、当前酒店转换率(hotelcr)、当前酒店历史订单取消率(ordercanceledprecent)、星级偏好(starprefer)、用户历史取消率(cancelrate)、 7天内访问酒店详情页数(historyvisit_visit_detailpagenum)、价格敏感指数price_sensitive)、当前酒店访客量(hoteluv)、浏览最多的酒店商务属性(businessrate_pre)。</p> 
 <h3>五、 RFM模型和用户画像</h3> 
 <p><b>5.1 RFM分析</b></p> 
 <p>RFM模型，即为：</p> 
 <ul><li>R(Rencency):最近一次消费</li><li>F(Frequency):消费频率</li><li>M(Monetary):消费金额</li></ul> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/91/eb/8pz8Jp7V_o.png" width="1149" alt="v2-e697454bdadc7e84430adca118810731_b.jpg"> 
 </div> 
 <p>选择lasthtlordergap(距离上次下单的时长)、ordernum_oneyear(用户年订单数)、consume_level(用户消费水平)分别作为R、F、M的值,对我们的用户群体进行聚类.</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">rfm</span> <span class="o">=</span> <span class="n">rawdf</span><span class="p">[[</span><span class="s1">'lasthtlordergap'</span><span class="p">,</span><span class="s1">'ordernum_oneyear'</span><span class="p">,</span><span class="s1">'consume_level'</span><span class="p">]]</span>

<span class="c1"># 归一化</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rfm</span><span class="p">)</span>
<span class="n">rfm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rfm</span><span class="p">),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'recency'</span><span class="p">,</span><span class="s1">'frequency'</span><span class="p">,</span><span class="s1">'monetary'</span><span class="p">])</span>

<span class="c1"># 分箱</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'R'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s2">"recency"</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'F'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s2">"frequency"</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'M'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s2">"monetary"</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># 编码</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'R'</span><span class="p">]</span><span class="o">=</span><span class="n">LabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'R'</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'R'</span><span class="p">])</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'F'</span><span class="p">]</span><span class="o">=</span><span class="n">LabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'F'</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'F'</span><span class="p">])</span>
<span class="n">rfm</span><span class="p">[</span><span class="s1">'M'</span><span class="p">]</span><span class="o">=</span><span class="n">LabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'M'</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rfm</span><span class="p">[</span><span class="s1">'M'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'高价值客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'重点保持客户'</span>
    <span class="k">if</span><span class="p">((</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
        <span class="k">return</span> <span class="s1">'重点发展客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'重点挽留客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'一般价值客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'一般保持客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'一般发展客户'</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'潜在客户'</span>

<span class="k">def</span> <span class="nf">RFM_convert</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'Label of Customer'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">get_label</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'R'</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s1">'F'</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s1">'M'</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s1">'R'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'R'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">'高'</span><span class="p">,</span><span class="s1">'低'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'F'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'F'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="s1">'高'</span><span class="p">,</span><span class="s1">'低'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'M'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'M'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="s1">'高'</span><span class="p">,</span><span class="s1">'低'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'R'</span><span class="p">,</span><span class="s1">'F'</span><span class="p">,</span><span class="s1">'M'</span><span class="p">,</span><span class="s1">'Label of Customer'</span><span class="p">]]</span>

<span class="n">rfm0</span><span class="o">=</span><span class="n">RFM_convert</span><span class="p">(</span><span class="n">rfm</span><span class="p">)</span>
<span class="n">rfm0</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ff/f1/DwP9RYGp_o.jpg" width="234" alt="v2-3c46e4e49c1a02ae706e8c24c4330917_b.jpg"> 
 </div> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">temp</span><span class="o">=</span><span class="n">rfm0</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'Label of Customer'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
<span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">'orangered'</span><span class="p">,</span><span class="s1">'lightsalmon'</span><span class="p">,</span><span class="s1">'sienna'</span><span class="p">,</span><span class="s1">'seashell'</span><span class="p">,</span><span class="s1">'chocolate'</span><span class="p">,</span><span class="s1">'peru'</span><span class="p">,</span><span class="s1">'sandybrown'</span><span class="p">,</span><span class="s1">'peachpuff'</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">autopct</span><span class="o">=</span><span class="s1">'</span><span class="si">%.1f%%</span><span class="s1">'</span><span class="p">,</span><span class="n">pctdistance</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'客户细分情况'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/客户细分情况.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/e2/c7/bCW5AUCS_o.png" width="1200" alt="v2-9ced3a2cfff92ab4286426cda39f08a3_b.jpg"> 
 </div> 
 <ul><li>潜在客户占比达12.3%,这类客户是rmf指标均不是很好的客户,有待开发;</li><li>高价值客户11%,重点保持客户10.1%,重点发展客户7%,这是要重点关注的客户群体.</li></ul> 
 <p><b>5.2 用户画像</b></p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="c1"># 选取出几个刻画用户的重要指标</span>
<span class="n">user_feature</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'decisionhabit_user'</span><span class="p">,</span><span class="s1">'ordercanncelednum'</span><span class="p">,</span><span class="s1">'ordercanceledprecent'</span><span class="p">,</span><span class="s1">'consume_level'</span><span class="p">,</span><span class="s1">'starprefer'</span><span class="p">,</span><span class="s1">'lasthtlordergap'</span><span class="p">,</span><span class="s1">'lastpvgap'</span><span class="p">,</span><span class="s1">'h'</span><span class="p">,</span><span class="s1">'sid'</span><span class="p">,</span>
                <span class="s1">'c_value'</span><span class="p">,</span><span class="s1">'landhalfhours'</span><span class="p">,</span><span class="s1">'price_sensitive'</span><span class="p">,</span><span class="s1">'price_prefer'</span><span class="p">,</span><span class="s1">'day_advanced'</span><span class="p">,</span><span class="s1">'historyvisit_avghotelnum'</span><span class="p">,</span><span class="s1">'ordernum_oneyear'</span><span class="p">]</span>
<span class="n">user_attributes</span> <span class="o">=</span> <span class="n">rawdf</span><span class="p">[</span><span class="n">user_feature</span><span class="p">]</span>
<span class="n">user_attributes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># 数据标准化</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)</span>

<span class="n">user_attributes</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">Kmeans</span><span class="o">=</span><span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>                                                     <span class="c1"># 建立KMean模型</span>
<span class="n">Kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)</span>                                                     <span class="c1"># 训练模型</span>
<span class="n">k_char</span><span class="o">=</span><span class="n">Kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>                                                  <span class="c1"># 得到每个分类的质心</span>
<span class="n">personas</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">k_char</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">user_feature</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'0类'</span><span class="p">,</span><span class="s1">'1类'</span><span class="p">,</span><span class="s1">'2类'</span><span class="p">])</span>  <span class="c1"># 用户画像表</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">personas</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Oranges'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/用户画像表.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/82/0e/LiQz8WJJ_o.png" width="1200" alt="v2-190aea17425f08feefd2a6262b78e3bd_b.jpg"> 
 </div> 
 <p>2类用户的R(lasthtlordergap)为-0.17非常小(R越小越好,这里是反的),F(ordernum_oneyear)为1.1比较高了,M(consume_level)为1.3也几乎是最高的.很明显,2类客户为我们的"高价值客户";而0类中几乎都是白格子,无论是客户价值还是消费水平值都是最低的,很明显,这一类我们将其归为"低价值客户";剩下的1类我们将其称为"中等群体".</p> 
 <div class="has"> 
  <pre><code class="language-python"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">class_k</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Kmeans</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>                          <span class="c1"># 每个类别的用户个数</span>
<span class="n">percent</span><span class="o">=</span><span class="p">[</span><span class="n">class_k</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">),</span><span class="n">class_k</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">),</span><span class="n">class_k</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)]</span>   <span class="c1"># 每个类别用户个数占比</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">'chocolate'</span><span class="p">,</span><span class="s1">'sandybrown'</span><span class="p">,</span><span class="s1">'peachpuff'</span><span class="p">]</span>
<span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s1">'中等群体'</span><span class="p">,</span><span class="s1">'低价值用户'</span><span class="p">,</span><span class="s1">'高价值用户'</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">percent</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">autopct</span><span class="o">=</span><span class="s1">'</span><span class="si">%.2f%%</span><span class="s1">'</span><span class="p">,</span><span class="n">pctdistance</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">types</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'./Photo/用户画像.jpg'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre> 
 </div> 
 <p style="text-align:center;"></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/03/45/FkeCiLm5_o.png" width="1200" alt="v2-a08ae0da5948c6ae861d2002fac3bfdf_b.jpg"> 
 </div> 
 <p><b>5.3 用户画像分析</b></p> 
 <p><b>5.3.1 高价值用户分析</b></p> 
 <p>消费水平高，客户价值大，追求高品质，对酒店星级要求高，访问频率和预定频率都较高，提前预定的时间都较短，决策一般都较快（日均访问数少），订单取消率较高，可以分析出这类客户商务属性偏重，可能随时要出差，因此都不会提前预定，可能出差随时会取消，因此酒店取消率也会更高一点。sid的值较大，说明高价值客户群体多集中在老客户中。价格敏感度较高，说明可能比较要求性价比。h值非常小，可能访问和预定时间多在半夜或是清晨。</p> 
 <p>这部分客户对于我们而言是非常重要的，因此我们需要对其实施个性化的营销：</p> 
 <ul><li>1、为客户提供更多差旅地酒店信息;</li><li>2、多推荐口碑好、性价比高的商务酒店连锁酒店房源吸引用户;</li><li>3、在非工作日的11点、17点等日间流量小高峰时段进行消息推送。</li></ul> 
 <p><b>5.3.2 中等群体分析</b></p> 
 <p>消费水平和客户价值都偏低，对酒店品质也不太追求，访问和预定频率也都较高，提前预定的时间是三类中最长的，最值得注意的是，0类客户中有两个颜色非常深的蓝色格子，是用户决策和近3个月的日均访问数。可以看出，这类客户通常很喜欢逛酒店界面，在决定要订哪家酒店前通常会花费非常多的时间进行浏览才能做出选择，并且一般都会提前很久订好房。我们可以给这类客户打上“谨慎”的标签。我们可以合理推断，这一类客户，可能预定酒店的目的多为出门旅行。</p> 
 <p>针对这部分客户，我们需要：</p> 
 <ul><li>1、在节假日前两、三星期定期推送国外高星级酒店，尽可能多地进行推送，因为此类客户通常比较喜欢浏览；</li><li>2、推送高端酒店以及当地的旅行资讯，吸引用户关注，因为这类客户旅游出行的概率较大；</li><li>3、和景区酒店代理商合作，针对此类用户制定个性化推荐，多推荐价格相对实惠的酒店。</li></ul> 
 <p><b>5.3.3 低价值用户分析</b></p> 
 <p>消费水平和客户价值极低，对酒店品质不追求，偏好价格较低，决策时间很短，访问和预定频率很低，sid值很低，说明新客户居多。</p> 
 <p>针对这部分客户，我们需要：</p> 
 <ul><li>1、不建议花费过多营销成本，但因为新用户居多，属于潜在客户，建议把握用户初期体验（如初期消费有优惠、打卡活动等），还可以定期推送实惠的酒店给此类用户，以培养客户消费惯性为主；</li><li>2、推送的内容应多为大减价、大酬宾、跳楼价之类的；</li><li>3、由于这部分用户占比较多，可结合该群体流失情况分析流失客户因素，进行该群体市场的开拓，进一步进行下沉分析，开拓新的时长。</li></ul> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba8b096b7a0a93064d5051c58777fb00/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">（2.1）Linux Shell脚本的自动化编程之shell变量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77d2f49d574051afb77ecd8c45c9fed6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">eclipse maven项目 找不到或无法加载主类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>