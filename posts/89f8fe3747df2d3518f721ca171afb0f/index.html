<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx 1.12安装 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx 1.12安装" />
<meta property="og:description" content="准备工作 使用root用户安装。 到nginx官网下载Linux源码或者执行：wget http://nginx.org/download/nginx-1.12.2.tar.gz。 到pcre站点下载zlilb源码或者执行：wget https://ftp.pcre.org/pub/pcre/pcre-8.41.tar.gz。 到zlib官网下载zlilb源码或者执行：wget https://ncu.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.gz。 到openssl官网下载openssl源码或者执行：wget https://www.openssl.org/source/openssl-1.1.0g.tar.gz。 一般编译nginx时，都要先安装pcre、zlib、openssl等，然后编译安装nginx时指定这些程序的安装目录，这样nginx在每次启动的时候，就会去动态加载这些程序了。但是也可以将这些程序静态编译到nginx里面，这样nginx启动时就不用动态加载了，这种方式效率更高，也更方面替换这些程序的版本，因为像zlib会被很多程序依赖，不好升级。因此下载完以上4个tar.gz后，全部解压缩到/home/test： tar -zxvf nginx-1.12.2.tar.gz -C /home/test tar -zxvf pcre-8.41.tar.gz -C /home/test tar -zxvf zlib-1.2.11.tar.gz -C /home/test ar -zxvf openssl-1.1.0g.tar.gz -C /home/test 构建和安装 构建时使用configure命令进行配置，它定义了系统的各个方面，包括nginx被允许用于连接处理的方法。最后，它创建了一个Makefile。configure支持的参数可以使用./configure --help查看： --prefix：定义一个将保存服务器文件的目录。此目录也将用于configure命令配置的(除库源文件路径外)和nginx.conf配置文件中的所有相对路径。默认路径为/usr/local/nginx。 --sbin-path=path：设置nginx可执行文件的路径。此路径仅在安装期间使用。默认路径为prefix/ sbin/nginx。 --conf-path=path：设置nginx.conf的路径。如有必要，总是可以 在nginx启动时通过命令行参数-c file指定一个不同的配置文件路径。 默认路径为prefix/conf/nginx.conf。 --pid-path=path：设置nginx.pid文件的路径，这个文件将存储主进程的进程ID。安装完成后，此路径可以在nginx.conf文件中使用pid指令更改。默认路径为prefix/ logs/nginx. pid。 --error-log-path=path：设置记录主要错误、警告以及诊断文件的路径。安装完成后， 该路径总是可以在nginx.conf文件中用 error_log 指令更改。 默认路径为prefix/logs/error.log。 --http-log-path=path：设置记录HTTP服务器主要请求日志的完整路径。安装完成后， 该路径总是可以在nginx.conf文件用 access_log 指令来修改。 默认路径为prefix/logs/access.log。 --build=name：设置一个可选的nginx构建名称。 --user=name： 设置工作进程以某非特权用户的身份运行。安装完成后，该用户名总是可以在 nginx.conf文件用user指令来修改。 默认值为nobody。 --group=name：设置工作进程以某非特权用户组的身份运行。安装完成后，该用户名总是可以在 nginx.conf用user指令来修改。 默认名称与--user相同。 --with-select_module：启用或禁用构建一个允许服务器使用select()方法的模块。如果平台不支持更合适的方法比如 kqueue，epoll，/dev/poll，则该模块是自动构建的。 --with-poll_module：启用或禁用构建一个允许服务器使用poll()方法的模块。如果平台不支持更合适的方法比如 kqueue，epoll，/dev/poll，则该模块是自动构建的。 --without-http_gzip_module：不构建HTTP服务器的压缩响应模块ngx_http_gzip_module。该模块需要zlib库才能构建和运行。 --without-http_rewrite_module：不构建允许HTTP服务器重定向请求和更改请求的URI的模块ngx_http_rewrite_module。该模块需要PCRE库才能构建和运行。 --without-http_proxy_module：不构建HTTP服务器代理模块ngx_http_proxy_module。 --with-http_ssl_module：构建一个让HTTP服务器支持https协议的模块，这个模块默认不会构建。该模块需要OpenSSL库才能构建和运行。 --with-pcre=path：设置PCRE库源文件的路径。PCRE库的发行版(version 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/89f8fe3747df2d3518f721ca171afb0f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-20T17:13:00+08:00" />
<meta property="article:modified_time" content="2018-03-20T17:13:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx 1.12安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <div id="7131-1509788830388" style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="font-size:28px;font-weight:bold;">准备工作</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   使用root用户安装。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   到nginx官网下载Linux源码或者执行：wget http://nginx.org/download/nginx-1.12.2.tar.gz。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   到pcre站点下载zlilb源码或者执行：wget https://ftp.pcre.org/pub/pcre/pcre-8.41.tar.gz。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   到zlib官网下载zlilb源码或者执行：wget https://ncu.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.gz。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   到openssl官网下载openssl源码或者执行：wget https://www.openssl.org/source/openssl-1.1.0g.tar.gz。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   一般编译nginx时，都要先安装pcre、zlib、openssl等，然后编译安装nginx时指定这些程序的安装目录，这样nginx在每次启动的时候，就会去动态加载这些程序了。但是也可以将这些程序静态编译到nginx里面，这样nginx启动时就不用动态加载了，这种方式效率更高，也更方面替换这些程序的版本，因为像zlib会被很多程序依赖，不好升级。因此下载完以上4个tar.gz后，全部解压缩到/home/test： 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   tar -zxvf nginx-1.12.2.tar.gz -C /home/test 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   tar -zxvf pcre-8.41.tar.gz -C /home/test 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   tar -zxvf zlib-1.2.11.tar.gz -C /home/test 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   ar -zxvf openssl-1.1.0g.tar.gz -C /home/test 
 </div> 
 <div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div id="3962-1509788862866" style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="font-size:28px;font-weight:bold;">构建和安装</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   构建时使用configure命令进行配置，它定义了系统的各个方面，包括nginx被允许用于连接处理的方法。最后，它创建了一个Makefile。configure支持的参数可以使用./configure --help查看： 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --prefix：定义一个将保存服务器文件的目录。此目录也将用于configure命令配置的(除库源文件路径外)和nginx.conf配置文件中的所有相对路径。默认路径为/usr/local/nginx。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --sbin-path=path：设置nginx可执行文件的路径。此路径仅在安装期间使用。默认路径为prefix/ sbin/nginx。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --conf-path=path：设置nginx.conf的路径。如有必要，总是可以 在nginx启动时通过命令行参数-c file指定一个不同的配置文件路径。 默认路径为prefix/conf/nginx.conf。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --pid-path=path：设置nginx.pid文件的路径，这个文件将存储主进程的进程ID。安装完成后，此路径可以在nginx.conf文件中使用pid指令更改。默认路径为prefix/ logs/nginx. pid。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --error-log-path=path：设置记录主要错误、警告以及诊断文件的路径。安装完成后， 该路径总是可以在nginx.conf文件中用 error_log 指令更改。 默认路径为prefix/logs/error.log。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --http-log-path=path：设置记录HTTP服务器主要请求日志的完整路径。安装完成后， 该路径总是可以在nginx.conf文件用 access_log 指令来修改。 默认路径为prefix/logs/access.log。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --build=name：设置一个可选的nginx构建名称。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --user=name： 设置工作进程以某非特权用户的身份运行。安装完成后，该用户名总是可以在 nginx.conf文件用user指令来修改。 默认值为nobody。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --group=name：设置工作进程以某非特权用户组的身份运行。安装完成后，该用户名总是可以在 nginx.conf用user指令来修改。 默认名称与--user相同。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-select_module：启用或禁用构建一个允许服务器使用select()方法的模块。如果平台不支持更合适的方法比如 kqueue，epoll，/dev/poll，则该模块是自动构建的。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-poll_module：启用或禁用构建一个允许服务器使用poll()方法的模块。如果平台不支持更合适的方法比如 kqueue，epoll，/dev/poll，则该模块是自动构建的。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --without-http_gzip_module：不构建HTTP服务器的压缩响应模块ngx_http_gzip_module。该模块需要zlib库才能构建和运行。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --without-http_rewrite_module：不构建允许HTTP服务器重定向请求和更改请求的URI的模块ngx_http_rewrite_module。该模块需要PCRE库才能构建和运行。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --without-http_proxy_module：不构建HTTP服务器代理模块ngx_http_proxy_module。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-http_ssl_module：构建一个让HTTP服务器支持https协议的模块，这个模块默认不会构建。该模块需要OpenSSL库才能构建和运行。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-pcre=path：设置PCRE库源文件的路径。PCRE库的发行版(version 4.4 — 8.41)需要先从PCRE站点下载并解压缩。接下来的操作由nginx的./configure和make命令来完成。该库用于location指令的正则表达式支持以及ngx_http_rewrite_module模块。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-pcre-jit：构建PCRE库以支持即时编译。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-zlib=path：设置zlib库源文件的路径。zlib库的发行版(version 1.1.3 — 1.2.11)需要先从zlib站点下载并解压缩。接下来的操作由nginx的./configure和make命令来完成。该库用于ngx_http_gzip_module模块。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-openssl=path：设置openssl库源文件的路径。openssl库的发行版需要先从openssl站点下载并解压缩。接下来的操作由nginx的./configure和make命令来完成。该库用于ngx_http_gzip_module模块。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-cc-opt=parameters：设置将添加到CFLAGS变量中的额外参数。当在FreeBSD下使用系统PCRE库时，需要指定--with-cc-opt="-I /usr/local/include"。 如果需要增加select()方法所支持的文件数量，也可以参照如下方式指定：--with-cc-opt="-D FD_SETSIZE=2048"。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-ld-opt=parameters： 设置将会在链接过程中使用的额外参数。当在FreeBSD下使用系统PCRE库时，需要指定--with-ld-opt="-L /usr/local/lib"。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   --with-http_stub_status_module：ngx_http_stub_status_module模块提供了对基本状态信息的访问。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   步骤： 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   1.cd /home/test/nginx-1.12.2 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   2../configure --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-http_ssl_module --with-pcre=/home/test/pcre-8.41 --with-zlib=/home/test/zlib-1.2.11 --with-openssl=/home/test/openssl-1.1.0g --with-http_stub_status_module 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   3.make 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   4.make install 
 </div> 
 <div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div id="9185-1509875327111" style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="font-size:28px;font-weight:bold;">配置服务</span> 
 </div> 
 <div id="7632-1509875371855" style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="font-size:20px;font-weight:bold;">sysvinit</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   参考脚本地址：https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">#!/bin/sh</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">#</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># nginx - this script starts and stops the nginx daemon</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">#</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># chkconfig: 35 85 15</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># description: NGINX is an HTTP(S) server, HTTP(S) reverse \</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># proxy and IMAP/POP3 proxy server</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># Source function library.</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">. /etc/rc.d/init.d/functions</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># Source networking configuration.</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">. /etc/sysconfig/network</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"># Check that networking is up.</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">test "$NETWORKING" = "no" &amp;&amp; exit 0</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">nginx="/usr/sbin/nginx"</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">prog=$(basename $nginx)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">NGINX_CONF_FILE="/etc/nginx/nginx.conf"</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">test -f /etc/sysconfig/nginx &amp;&amp; . /etc/sysconfig/nginx</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">lockfile=/var/lock/subsys/nginx</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">make_dirs() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> # make required directories</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> user=`$nginx -V 2&gt;&amp;1 | grep "configure arguments:.*--user=" | sed 's/[^*]*--user=\([^ ]*\).*/\1/g' -`</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> if test -n "$user" ; then</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> if test -z "`grep $user /etc/passwd`" ; then</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> useradd -M -s /bin/nologin $user</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> fi</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> options=`$nginx -V 2&gt;&amp;1 | grep 'configure arguments:'`</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> for opt in $options; do</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> if test `echo $opt | grep '.*-temp-path'` ; then</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> value=`echo $opt | cut -d "=" -f 2`</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> if test ! -d "$value" ; then</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> # echo "creating" $value</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> mkdir -p $value &amp;&amp; chown -R $user $value</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> fi</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> fi</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> done</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> fi</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">start() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> test -x $nginx || exit 5</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> test -f $NGINX_CONF_FILE || exit 6</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> make_dirs</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo -n $"Starting $prog: "</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> daemon $nginx -c $NGINX_CONF_FILE</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> retval=$?</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> test $retval -eq 0 &amp;&amp; touch $lockfile</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> return $retval</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">stop() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo -n $"Stopping $prog: "</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> killproc $prog -QUIT</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> retval=$?</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> test $retval -eq 0 &amp;&amp; rm -f $lockfile</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> return $retval</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">restart() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> configtest || return $?</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> stop</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> sleep 1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> start</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">reload() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> configtest || return $?</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo -n $"Reloading $prog: "</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> killproc $nginx -HUP</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> RETVAL=$?</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;"> echo</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">force_reload() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">restart</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">configtest() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">$nginx -t -c $NGINX_CONF_FILE</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">status $prog</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status_q() {<!-- --></span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status &gt; /dev/null 2&gt;&amp;1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">}</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">case "$1" in</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">start)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status_q &amp;&amp; exit 0</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">$1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">stop)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status_q || exit 0</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">$1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">restart|configtest)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">$1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">reload)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status_q || exit 7</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">$1</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">force-reload)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">force_reload</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">status)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">condrestart|try-restart)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">rh_status_q || exit 0</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">;;</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">*)</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}"</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">exit 2</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">esac</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   将以上脚本保存到/etc/rc.d/init.d/nginx文件。nginx="/usr/sbin/nginx"修改为正确的nginx文件路径。NGINX_CONF_FILE="/etc/nginx/nginx.conf"修改为正确的nginx.conf文件路径。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   35代表在3和5运行级别下开机启动，85代表启动时脚本的执行顺序，15代表关闭时脚本的执行顺序。master进程由root用户启动，worker进程由配置文件的user指令指定，默认是nobody。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   让所有用户可以执行这个服务：chmod a+x /etc/rc.d/init.d/nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   添加nginx服务：chkconfig --add nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   查看nginx服务：chkconfig --list nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   开启nginx服务：service nginx start 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   关闭nginx服务：service nginx restart 
 </div> 
 <div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   如何卸载？ 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   1.service nginx stop停止服务 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   2.chkconfig --del nginx删除服务 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   3.删除/etc/rc.d/init.d/nginx文件 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   4.删除/usr/local/nginx/目录 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div id="9070-1509897969522" style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="font-size:20px;font-weight:bold;">CentOS7</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   参考脚本地址：https://www.nginx.com/resources/wiki/start/topics/examples/systemd/。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">[Unit]</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">Description=The NGINX HTTP and reverse proxy server</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">After=syslog.target network.target remote-fs.target nss-lookup.target</span> 
 </div> 
 <div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">[Service]</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">Type=forking</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">ExecStartPre=/usr/sbin/nginx -t</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">ExecStart=/usr/sbin/nginx</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">ExecReload=/bin/kill -s HUP $MAINPID</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">ExecStop=/bin/kill -s QUIT $MAINPID</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">PrivateTmp=true</span> 
 </div> 
 <div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">[Install]</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;"> 
  <span style="color:#df402a;">WantedBy=multi-user.target</span> 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   将以上脚本保存到/usr/lib/systemd/system/nginx.service。ExecStartPre=/usr/sbin/nginx -t 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   和ExecStart=/usr/sbin/nginx 修改为正确的nginx文件路径。master进程由root用户启动，worker进程由配置文件的user指令指定，默认是nobody。 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   #启动，服务名为 nginx.service 文件名中的前半部分即“nginx” 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   systemctl start nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   #检测状态 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   systemctl status nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   #设置为开机启动 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   systemctl enable nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   #检测是否开机启动 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   systemctl is-enabled nginx 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   如何卸载？ 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   1.systemctl stop nginx 停止服务 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   2.systemctl disenable nginx 禁止开机启动 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   3.删除/usr/lib/systemd/system/nginx.service文件 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
   4.删除/usr/local/nginx/目录 
 </div> 
 <div style="text-align:left;line-height:1.75;font-size:14px;">
     
 </div> 
</div> 
<p>转载于:https://www.cnblogs.com/gjb724332682/p/8610690.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0c30c622ae8993787b33b8ecd1f7a619/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">启动hive错误：Exception in thread &#34;main&#34; java.lang.IllegalArgumentException</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/750a1034c365d993801a056dad394137/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里巴巴电话面试C/C&#43;&#43;基础知识整理【面试经验】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>