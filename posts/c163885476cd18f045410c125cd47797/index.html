<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>响应式编程WebFlux基础API - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="响应式编程WebFlux基础API" />
<meta property="og:description" content="WebFlux的工作流程 在WebFlux中，主要的组件包括：
Reactor: Reactor是WebFlux底层使用的响应式编程库，提供了Mono和Flux这两种响应式类型，分别用于表示0-1个和0-N个异步序列元素。WebHandler: 是处理请求的核心接口，所有的请求都会被分配给一个WebHandler来处理。HandlerMapping: 用于将请求映射到对应的WebHandler。HandlerAdapter: 用于适配WebHandler的执行，使其能够处理请求并返回响应。WebFilter: 类似于Servlet中的Filter，可以在请求处理前后进行拦截和处理。ServerResponse和ServerRequest: 分别代表HTTP的响应和请求，在WebFlux中用于处理非阻塞的请求和响应。RouterFunction: 用于声明式地定义路由规则，将请求映射到处理器函数。 工作流程图 Request Dispatch Map to Filter Process Response Return Use Async Processing Client Server HandlerMapping WebHandler WebFilter HandlerAdapter ServerResponse Reactor 在这个流程中：
客户端发送请求到服务器。服务器接收到请求，并将其分发给HandlerMapping。HandlerMapping根据请求信息将其映射到对应的WebHandler。WebFilter可以在请求到达WebHandler之前或之后进行拦截和处理。WebHandler处理请求，可能会使用Reactor库中的Mono或Flux进行异步处理。HandlerAdapter将WebHandler的处理结果适配成服务器可以发送的响应。ServerResponse将响应返回给客户端。 WebFlux核心API 1. HttpHandler与HttpServer HttpHandler HttpHandler是WebFlux中处理HTTP请求的核心接口之一。它代表一个能够处理HTTP请求并生成响应的组件。HttpHandler可以被看作是一个函数，接受一个HTTP请求并返回一个表示HTTP响应的Publisher。典型的HttpHandler可以是一个Lambda表达式或一个实现了接口的类。可用于 Reactor Netty 的适配器， Undertow、Tomcat、Jetty 和任何 Servlet 容器。
HttpServer HttpServer是Reactor Netty提供的一个用于构建HTTP服务器的类。它允许你配置服务器的主机名、端口、SSL支持等信息。
public class SimpleHttpHandlerServerExample { public static void main(String[] args) throws IOException { HttpHandler httpHandler = RouterFunctions.toHttpHandler( RouterFunctions.route() .GET(&#34;/hello&#34;, request -&gt; ServerResponse.ok().bodyValue(&#34;Hello, WebFlux!&#34;)) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c163885476cd18f045410c125cd47797/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T19:42:20+08:00" />
<meta property="article:modified_time" content="2024-01-12T19:42:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">响应式编程WebFlux基础API</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="WebFlux_0"></a>WebFlux的工作流程</h3> 
<p>在WebFlux中，主要的组件包括：</p> 
<ul><li><code>Reactor</code>: Reactor是WebFlux底层使用的响应式编程库，提供了<code>Mono</code>和<code>Flux</code>这两种响应式类型，分别用于表示0-1个和0-N个异步序列元素。</li><li><code>WebHandler</code>: 是处理请求的核心接口，所有的请求都会被分配给一个<code>WebHandler</code>来处理。</li><li><code>HandlerMapping</code>: 用于将请求映射到对应的<code>WebHandler</code>。</li><li><code>HandlerAdapter</code>: 用于适配<code>WebHandler</code>的执行，使其能够处理请求并返回响应。</li><li><code>WebFilter</code>: 类似于Servlet中的Filter，可以在请求处理前后进行拦截和处理。</li><li><code>ServerResponse</code>和<code>ServerRequest</code>: 分别代表HTTP的响应和请求，在WebFlux中用于处理非阻塞的请求和响应。</li><li><code>RouterFunction</code>: 用于声明式地定义路由规则，将请求映射到处理器函数。</li></ul> 
<h4><a id="_12"></a>工作流程图</h4> 
<div class="mermaid"> 
 <svg id="mermaid-svg-3Zrkvn45iOLWfh9L" width="365.5234375" xmlns="http://www.w3.org/2000/svg" height="794" viewbox="0 0 365.5234375 794" class="mermaid-svg"> 
  <style>#mermaid-svg-3Zrkvn45iOLWfh9L {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .error-icon{fill:#552222;}#mermaid-svg-3Zrkvn45iOLWfh9L .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-3Zrkvn45iOLWfh9L .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-3Zrkvn45iOLWfh9L .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-3Zrkvn45iOLWfh9L .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-3Zrkvn45iOLWfh9L .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-3Zrkvn45iOLWfh9L .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-3Zrkvn45iOLWfh9L .marker{fill:#333333;stroke:#333333;}#mermaid-svg-3Zrkvn45iOLWfh9L .marker.cross{stroke:#333333;}#mermaid-svg-3Zrkvn45iOLWfh9L svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-3Zrkvn45iOLWfh9L .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .cluster-label text{fill:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .cluster-label span{color:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .label text,#mermaid-svg-3Zrkvn45iOLWfh9L span{fill:#333;color:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .node rect,#mermaid-svg-3Zrkvn45iOLWfh9L .node circle,#mermaid-svg-3Zrkvn45iOLWfh9L .node ellipse,#mermaid-svg-3Zrkvn45iOLWfh9L .node polygon,#mermaid-svg-3Zrkvn45iOLWfh9L .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-3Zrkvn45iOLWfh9L .node .label{text-align:center;}#mermaid-svg-3Zrkvn45iOLWfh9L .node.clickable{cursor:pointer;}#mermaid-svg-3Zrkvn45iOLWfh9L .arrowheadPath{fill:#333333;}#mermaid-svg-3Zrkvn45iOLWfh9L .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-3Zrkvn45iOLWfh9L .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-3Zrkvn45iOLWfh9L .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-3Zrkvn45iOLWfh9L .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-3Zrkvn45iOLWfh9L .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-3Zrkvn45iOLWfh9L .cluster text{fill:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L .cluster span{color:#333;}#mermaid-svg-3Zrkvn45iOLWfh9L div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-3Zrkvn45iOLWfh9L :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;"> 
      <path class="path" d="M181.4296875,44.931841475913906L163.78515625,52.776534563261585C146.140625,60.62122765060926,110.8515625,76.31061382530463,93.20703125,90.48864024598565C75.5625,104.66666666666667,75.5625,117.33333333333333,75.5625,123.66666666666667L75.5625,130" marker-end="url(#arrowhead187)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead187" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-C" style="opacity: 1;" id="L-B-C"> 
      <path class="path" d="M75.5625,176L75.5625,182.33333333333334C75.5625,188.66666666666666,75.5625,201.33333333333334,75.5625,214C75.5625,226.66666666666666,75.5625,239.33333333333334,75.5625,245.66666666666666L75.5625,252" marker-end="url(#arrowhead188)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead188" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-D" style="opacity: 1;" id="L-C-D"> 
      <path class="path" d="M75.5625,298L75.5625,304.3333333333333C75.5625,310.6666666666667,75.5625,323.3333333333333,83.9889643101093,336C92.41542862021858,348.6666666666667,109.26835724043717,361.3333333333333,117.69482155054645,367.6666666666667L126.12128586065575,374" marker-end="url(#arrowhead189)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead189" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-E LE-D" style="opacity: 1;" id="L-E-D"> 
      <path class="path" d="M237.8828125,298L237.8828125,304.3333333333333C237.8828125,310.6666666666667,237.8828125,323.3333333333333,229.45634818989072,336C221.02988387978144,348.6666666666667,204.17695525956285,361.3333333333333,195.75049094945356,367.6666666666667L187.32402663934425,374" marker-end="url(#arrowhead190)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead190" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-D LE-F" style="opacity: 1;" id="L-D-F"> 
      <path class="path" d="M138.11027151639345,420L132.98512209699456,426.3333333333333C127.85997267759564,432.6666666666667,117.60967383879783,445.3333333333333,112.48452441939891,461.8333333333333C107.359375,478.3333333333333,107.359375,498.6666666666667,107.359375,519C107.359375,539.3333333333334,107.359375,559.6666666666666,112.48452441939891,576.1666666666666C117.60967383879783,592.6666666666666,127.85997267759564,605.3333333333334,132.98512209699456,611.6666666666666L138.11027151639345,618" marker-end="url(#arrowhead191)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead191" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-F LE-G" style="opacity: 1;" id="L-F-G"> 
      <path class="path" d="M156.72265625,664L156.72265625,670.3333333333334C156.72265625,676.6666666666666,156.72265625,689.3333333333334,162.54132513661202,702C168.35999402322406,714.6666666666666,179.9973317964481,727.3333333333334,185.8160006830601,733.6666666666666L191.63466956967213,740" marker-end="url(#arrowhead192)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead192" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-G LE-A" style="opacity: 1;" id="L-G-A"> 
      <path class="path" d="M258.4033043032787,740L270.9702015027322,733.6666666666666C283.5370987021858,727.3333333333334,308.6708931010929,714.6666666666666,321.23779030054646,698.1666666666666C333.8046875,681.6666666666666,333.8046875,661.3333333333334,333.8046875,641C333.8046875,620.6666666666666,333.8046875,600.3333333333334,333.8046875,580C333.8046875,559.6666666666666,333.8046875,539.3333333333334,333.8046875,519C333.8046875,498.6666666666667,333.8046875,478.3333333333333,333.8046875,458C333.8046875,437.6666666666667,333.8046875,417.3333333333333,333.8046875,397C333.8046875,376.6666666666667,333.8046875,356.3333333333333,333.8046875,336C333.8046875,315.6666666666667,333.8046875,295.3333333333333,333.8046875,275C333.8046875,254.66666666666666,333.8046875,234.33333333333334,333.8046875,214C333.8046875,193.66666666666666,333.8046875,173.33333333333334,333.8046875,153C333.8046875,132.66666666666666,333.8046875,112.33333333333333,318.8541666666667,94.63205963983735C303.9036458333333,76.93078594634136,274.0026041666667,61.86157189268272,259.0520833333333,54.3269648658534L244.1015625,46.79235783902408" marker-end="url(#arrowhead193)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead193" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-D LE-H" style="opacity: 1;" id="L-D-H"> 
      <path class="path" d="M187.35348360655738,420L195.78805925546445,426.3333333333333C204.22263490437157,432.6666666666667,221.09178620218577,445.3333333333333,229.5263618510929,458C237.9609375,470.6666666666667,237.9609375,483.3333333333333,237.9609375,489.6666666666667L237.9609375,496" marker-end="url(#arrowhead194)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead194" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-H LE-F" style="opacity: 1;" id="L-H-F"> 
      <path class="path" d="M237.9609375,542L237.9609375,548.3333333333334C237.9609375,554.6666666666666,237.9609375,567.3333333333334,229.5263618510929,580C221.09178620218577,592.6666666666666,204.22263490437157,605.3333333333334,195.7880592554645,611.6666666666666L187.35348360655738,618" marker-end="url(#arrowhead195)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead195" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(75.5625,92)" style="opacity: 1;"> 
      <g transform="translate(-28.296875,-13)" class="label"> 
       <rect rx="0" ry="0" width="56.59375" height="26"></rect> 
       <foreignobject width="56.59375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B">Request</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(75.5625,214)"> 
      <g transform="translate(-30.59375,-13)" class="label"> 
       <rect rx="0" ry="0" width="61.1875" height="26"></rect> 
       <foreignobject width="61.1875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-C" class="edgeLabel L-LS-B' L-LE-C">Dispatch</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(75.5625,336)"> 
      <g transform="translate(-24.2109375,-13)" class="label"> 
       <rect rx="0" ry="0" width="48.421875" height="26"></rect> 
       <foreignobject width="48.421875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-D" class="edgeLabel L-LS-C' L-LE-D">Map to</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(237.8828125,336)"> 
      <g transform="translate(-19.484375,-13)" class="label"> 
       <rect rx="0" ry="0" width="38.96875" height="26"></rect> 
       <foreignobject width="38.96875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-E-D" class="edgeLabel L-LS-E' L-LE-D">Filter</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(107.359375,519)"> 
      <g transform="translate(-26.2890625,-13)" class="label"> 
       <rect rx="0" ry="0" width="52.578125" height="26"></rect> 
       <foreignobject width="52.578125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-D-F" class="edgeLabel L-LS-D' L-LE-F">Process</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(156.72265625,702)"> 
      <g transform="translate(-32.65625,-13)" class="label"> 
       <rect rx="0" ry="0" width="65.3125" height="26"></rect> 
       <foreignobject width="65.3125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-F-G" class="edgeLabel L-LS-F' L-LE-G">Response</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(333.8046875,397)"> 
      <g transform="translate(-23.71875,-13)" class="label"> 
       <rect rx="0" ry="0" width="47.4375" height="26"></rect> 
       <foreignobject width="47.4375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-G-A" class="edgeLabel L-LS-G' L-LE-A">Return</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(237.9609375,458)"> 
      <g transform="translate(-12.7890625,-13)" class="label"> 
       <rect rx="0" ry="0" width="25.578125" height="26"></rect> 
       <foreignobject width="25.578125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-D-H" class="edgeLabel L-LS-D' L-LE-H">Use</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(237.9609375,580)"> 
      <g transform="translate(-59.6015625,-13)" class="label"> 
       <rect rx="0" ry="0" width="119.203125" height="26"></rect> 
       <foreignobject width="119.203125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-H-F" class="edgeLabel L-LS-H' L-LE-F">Async Processing</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="flowchart-A-90" transform="translate(212.765625,31)" style="opacity: 1;"> 
      <rect rx="0" ry="0" x="-31.3359375" y="-23" width="62.671875" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-21.3359375,-13)"> 
        <foreignobject width="42.671875" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Client 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-91" transform="translate(75.5625,153)"> 
      <rect rx="0" ry="0" x="-32.7109375" y="-23" width="65.421875" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-22.7109375,-13)"> 
        <foreignobject width="45.421875" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Server 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-93" transform="translate(75.5625,275)"> 
      <rect rx="0" ry="0" x="-67.5625" y="-23" width="135.125" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-57.5625,-13)"> 
        <foreignobject width="115.125" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           HandlerMapping 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-D-95" transform="translate(156.72265625,397)"> 
      <rect rx="0" ry="0" x="-53.3671875" y="-23" width="106.734375" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-43.3671875,-13)"> 
        <foreignobject width="86.734375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           WebHandler 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-E-96" transform="translate(237.8828125,275)"> 
      <rect rx="0" ry="0" x="-44.7578125" y="-23" width="89.515625" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-34.7578125,-13)"> 
        <foreignobject width="69.515625" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           WebFilter 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-F-99" transform="translate(156.72265625,641)"> 
      <rect rx="0" ry="0" x="-66.578125" y="-23" width="133.15625" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-56.578125,-13)"> 
        <foreignobject width="113.15625" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           HandlerAdapter 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-G-101" transform="translate(212.765625,763)"> 
      <rect rx="0" ry="0" x="-65.3671875" y="-23" width="130.734375" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-55.3671875,-13)"> 
        <foreignobject width="110.734375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           ServerResponse 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-H-105" transform="translate(237.9609375,519)"> 
      <rect rx="0" ry="0" x="-37.4375" y="-23" width="74.875" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-27.4375,-13)"> 
        <foreignobject width="54.875" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Reactor 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>在这个流程中：</p> 
<ol><li>客户端发送请求到服务器。</li><li>服务器接收到请求，并将其分发给<code>HandlerMapping</code>。</li><li><code>HandlerMapping</code>根据请求信息将其映射到对应的<code>WebHandler</code>。</li><li><code>WebFilter</code>可以在请求到达<code>WebHandler</code>之前或之后进行拦截和处理。</li><li><code>WebHandler</code>处理请求，可能会使用<code>Reactor</code>库中的<code>Mono</code>或<code>Flux</code>进行异步处理。</li><li><code>HandlerAdapter</code>将<code>WebHandler</code>的处理结果适配成服务器可以发送的响应。</li><li><code>ServerResponse</code>将响应返回给客户端。</li></ol> 
<h3><a id="WebFluxAPI_37"></a>WebFlux核心API</h3> 
<h4><a id="1_HttpHandlerHttpServer_39"></a>1. HttpHandler与HttpServer</h4> 
<h5><a id="HttpHandler_41"></a>HttpHandler</h5> 
<p><code>HttpHandler</code>是WebFlux中处理HTTP请求的核心接口之一。它代表一个能够处理HTTP请求并生成响应的组件。<code>HttpHandler</code>可以被看作是一个函数，接受一个HTTP请求并返回一个表示HTTP响应的<code>Publisher</code>。典型的<code>HttpHandler</code>可以是一个Lambda表达式或一个实现了接口的类。可用于 Reactor Netty 的适配器， Undertow、Tomcat、Jetty 和任何 Servlet 容器。</p> 
<h5><a id="HttpServer_45"></a>HttpServer</h5> 
<p><code>HttpServer</code>是Reactor Netty提供的一个用于构建HTTP服务器的类。它允许你配置服务器的主机名、端口、SSL支持等信息。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleHttpHandlerServerExample</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpHandler</span> httpHandler <span class="token operator">=</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">toHttpHandler</span><span class="token punctuation">(</span>
                <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span> request <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"Hello, WebFlux!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ReactorHttpHandlerAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactorHttpHandlerAdapter</span><span class="token punctuation">(</span>httpHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//启动Netty服务器</span>
        <span class="token class-name">HttpServer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span> <span class="token comment">//用指定的处理器处理请求</span>
                <span class="token punctuation">.</span><span class="token function">bindNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//现在就绑定</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器启动完成....监听8080，接受请求"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器停止...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试</p> 
<blockquote> 
 <p>GET http://localhost:8080/hello 响应：Hello, WebFlux!</p> 
</blockquote> 
<h4><a id="2_DispatcherHandler_78"></a>2. DispatcherHandler</h4> 
<blockquote> 
 <p>前中讲到WebFlux的工作流程第5步中<code>WebHandler</code>用于处理请求</p> 
</blockquote> 
<p>在 Spring WebFlux 中，<code>DispatcherHandler</code> 实现了 <code>WebHandler</code> 接口，因此 <code>DispatcherHandler</code> 是 <code>WebHandler</code> 的一种具体实现。 <code>WebHandler</code> 接口定义了处理 HTTP 请求的方法，而 <code>DispatcherHandler</code> 实现了这个接口，提供了处理请求的具体实现。</p> 
<p><code>WebHandler</code> 接口的主要方法是 <code>handle</code>，用于处理 HTTP 请求。<code>DispatcherHandler</code> 通过实现这个接口，提供了对请求的分发和处理的支持。下面是 <code>WebHandler</code> 接口的声明：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WebHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>而 <code>DispatcherHandler</code> 通过实现 <code>WebHandler</code> 接口，定义了处理请求的具体逻辑。在 <code>DispatcherHandler</code> 中，<code>handle</code> 方法被实现为请求的分发和处理，如代码所示。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 如果 handlerMappings 为 null，返回一个包含错误信息的 Mono</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">createNotFoundError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 如果是预检请求（CORS pre-flight request），处理预检请求</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CorsUtils</span><span class="token punctuation">.</span><span class="token function">isPreFlightRequest</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">handlePreFlight</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从 handlerMappings 中获取处理器函数</span>
    <span class="token keyword">return</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">)</span>
            <span class="token comment">// 依次尝试每个 HandlerMapping，获取处理器函数（是开发者编写的处理器函数，Controller中的接口），也是工作流程中第3步</span>
            <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>mapping <span class="token operator">-&gt;</span> mapping<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token comment">// 取第一个非空的处理器函数，如果都为空，则返回 createNotFoundError</span>
            <span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 如果获取处理器函数失败，也返回 createNotFoundError</span>
            <span class="token punctuation">.</span><span class="token function">switchIfEmpty</span><span class="token punctuation">(</span><span class="token function">createNotFoundError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 处理可能发生的错误，比如处理器函数执行时的异常</span>
            <span class="token punctuation">.</span><span class="token function">onErrorResume</span><span class="token punctuation">(</span>ex <span class="token operator">-&gt;</span> <span class="token function">handleDispatchError</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 处理请求，传递 ServerWebExchange 和处理器函数</span>
            <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>handler <span class="token operator">-&gt;</span> <span class="token function">handleRequestWith</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>所以，<code>DispatcherHandler</code> 是 <code>WebHandler</code> 的一种实现，用于实现对请求的分发和处理。在 Spring WebFlux 中，<code>DispatcherHandler</code> 是整个请求处理流程的核心组件之一。</p> 
<h3><a id="WebFluxAPI_125"></a>WebFlux常用API</h3> 
<ol><li> <p><strong>RouterFunctions：</strong><br> <code>RouterFunctions</code> 是用于定义路由的主要接口。通过它，你可以定义请求的映射和处理。</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRouterConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">myRoutes</span><span class="token punctuation">(</span><span class="token class-name">MyHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/api/resource/{id}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">::</span><span class="token function">handleResource</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/api/resource"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token operator">::</span><span class="token function">createResource</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>HandlerFunction：</strong><br> <code>HandlerFunction</code> 用于处理请求，并返回响应。你需要为每个路由定义一个处理函数。</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理 GET 请求逻辑</span>
        <span class="token comment">// 返回 Mono&lt;ServerResponse&gt;</span>
        <span class="token class-name">String</span> resourceId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">pathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/api/resource/{id}"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response: "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理逻辑</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"Resource ID: "</span> <span class="token operator">+</span> resourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">createResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理 POST 请求逻辑</span>
        <span class="token comment">// 返回 Mono&lt;ServerResponse&gt;</span>
        <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">"Hello, WebFlux!"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>ServerRequest 和 ServerResponse：</strong><br> <code>ServerRequest</code> 表示一个 HTTP 请求，而 <code>ServerResponse</code> 表示一个 HTTP 响应。在处理函数中，你可以通过这两个对象来获取请求信息和构建响应。</p> <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理 GET 请求逻辑</span>
        <span class="token comment">// 返回 Mono&lt;ServerResponse&gt;</span>
        <span class="token class-name">String</span> resourceId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">pathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/api/resource/{id}"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response: "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理逻辑</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"Resource ID: "</span> <span class="token operator">+</span> resourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Mono 和 Flux：</strong><br> <code>Mono</code> 和 <code>Flux</code> 是 Reactor 框架中的概念，但在 Spring WebFlux 中也经常用到。<code>Mono</code> 用于表示包含零个或一个元素的异步序列，而 <code>Flux</code> 用于表示包含零个或多个元素的异步序列。</p> <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">createResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理 POST 请求逻辑</span>
        <span class="token comment">// 返回 Mono&lt;ServerResponse&gt;</span>
        <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">"Hello, WebFlux!"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>WebClient：</strong><br> <code>WebClient</code> 是 Spring WebFlux 提供的用于进行 HTTP 请求的客户端。它支持异步和响应式编程。</p> <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理 GET 请求逻辑</span>
        <span class="token comment">// 返回 Mono&lt;ServerResponse&gt;</span>
        <span class="token class-name">String</span> resourceId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">pathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/api/resource/{id}"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response: "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理逻辑</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"Resource ID: "</span> <span class="token operator">+</span> resourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>MediaType 和 Content-Type：</strong><br> <code>MediaType</code> 类用于表示媒体类型，而 <code>Content-Type</code> 则是 HTTP 请求和响应中用于指定实体主体的媒体类型。</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResource</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">bodyValue</span><span class="token punctuation">(</span><span class="token string">"{ \"message\": \"Hello, WebFlux!\" }"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>ExceptionHandler：</strong><br> <code>ExceptionHandler</code> 用于全局处理异常，你可以通过实现 <code>WebExceptionHandler</code> 接口来自定义异常处理逻辑。</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 定义处理器的顺序</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token keyword">implements</span> <span class="token class-name">WebExceptionHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理其他异常</span>
        exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<blockquote> 
 <p>学习打卡day09：响应式编程WebFlux基础API</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/435fc8c7fcf12539e5ec779774ee0b2c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">响应式编程初探-自定义实现Reactive Streams规范</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f7bad57198cfd1a8136978e9329e5806/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在微服务架构中认证和授权的那些事儿</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>