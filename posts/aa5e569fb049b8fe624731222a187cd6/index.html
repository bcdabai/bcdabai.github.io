<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>U-Boot学习(3)：.config、defconfig文件对比及图形化配置Kconfig - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="U-Boot学习(3)：.config、defconfig文件对比及图形化配置Kconfig" />
<meta property="og:description" content="在上一节中，我们介绍了U-Boot编译和.config配置文件生成分析，我们可以通过make xxx__defconfig来进行一些配置，其中xxx__defconfig对应config目录下的基于不同开发板的一些配置，指令执行完后会根据对应的配置在根目录下生成一个.config配置文件。而这个配置文件也可以通过图形化配置页面来生成，这一节就来介绍一下。
文章目录 1 xxx_defconfig和.config文件1.1 文件对比1.2 总结 2 图形化配置之Kconfig2.1 介绍2.1 U-Boot的图形配置 3 .config中的配置是如何使用的 1 xxx_defconfig和.config文件 1.1 文件对比 1、imx6ul_isiot_emmc_defconfig及其对应.config对比
我们对比一下两个文件，左边是imx6ul_isiot_emmc_defconfig文件，右边是make imx6ul_isiot_emmc_defconfig生成的.config文件，可以看到配置文件里有的，.config文件里都有，除此之外.config文件里还有一些其它的配置。
文件中#开头的为注释 2、imx6ul_isiot_emmc_defconfig和imx6ul_isiot_nand_defconfig对比
这里找一个与imx6ul_isiot_emmc_defconfig类似的配置imx6ul_isiot_nand_defconfig，来看一下区别：
可以看到，如果要使能NAND的话，需要多定义几个宏定义。
3、nand的.config和emmc的.config对比
左边是nand的.config，右边是emmc的.config：
可以看出，比如nand的一行CONFIG_MTD_RAW_NAND=y，生成出来后可能对应了多个与此相关的配置。
1.2 总结 1、xxx_defconfig
在U-Boot的defconfig文件中，配置项之间存在依赖关系。当你在defconfig文件中启用或禁用某个配置项时，可能会触发相关的配置项引申或取消。
直接依赖关系： 在defconfig文件中，一些配置项可能有直接的依赖关系。这意味着启用或禁用一个配置项可能会导致与之直接相关的其他配置项的状态发生变化。这通常是通过配置项的名称来指定的。间接依赖关系： 有些配置项可能存在间接的依赖关系。这意味着启用或禁用一个配置项可能会触发一系列的配置项状态变化，这些变化可能是由于其他配置项的依赖关系而产生的。 所以在生成的.config文件中，xxx_defconfig的一项配置可能有与之相关的多个配置。
2、.config
.config文件是一个文本文件，包含了一系列的宏定义，用于指定U-Boot的构建选项。这些宏定义决定了编译过程中使用的各种配置，如开启或关闭某个功能、指定交叉编译工具链的路径等。例如，在C代码中可以使用类似以下的方式来检查某个配置是否被定义：
#ifdef CONFIG_MY_FEATURE // 这段代码只有在 CONFIG_MY_FEATURE 被定义时才会被编译 #endif 2 图形化配置之Kconfig 2.1 介绍 Kconfig(Kernel Configuration)是Linux内核中用于配置构建选项的工具之一。它允许开发者通过一个文本界面或图形界面来选择、配置和调整内核的各种功能和模块。Kconfig文件包含了内核的配置信息，这些信息指定了内核编译时的各种选项，如支持的硬件、文件系统、网络协议等。
以下是Kconfig的一些主要特点和用法：
配置系统的基本原理： Kconfig采用了一种树状结构的配置系统。用户可以通过选择配置项，打开或关闭功能、模块或驱动，以满足特定需求。配置文件： Kconfig的配置信息存储在内核源代码树中的Kconfig文件中。每个子目录都可以包含一个Kconfig文件，用于配置该目录下的源代码。菜单配置界面： Kconfig提供了一个文本界面，也可以通过图形界面工具(如menuconfig、nconfig、xconfig等)进行配置。这些工具允许用户在配置过程中浏览选项，选择开启或关闭功能，并设置相应的参数。依赖关系： Kconfig支持配置项之间的依赖关系。某些功能可能依赖于其他功能的开启或关闭，Kconfig会确保用户不能选择不合理的配置。自动生成配置： Kconfig支持自动检测系统硬件和软件环境，从而生成适用于当前系统的默认配置。这有助于简化配置过程。配置文件生成： 在用户完成配置后，Kconfig会生成一个.config文件，其中包含了用户选择的所有配置信息。这个文件将用于实际的内核编译过程。make命令： 用户可以使用make menuconfig、make nconfig等命令来启动配置工具。在配置完成后，使用make命令即可开始内核的编译过程。 make menuconfig是Linux内核编译中使用的一个命令，它打开一个文本菜单界面，允许用户配置内核的各种选项。在执行make menuconfig之前，相关的文件主要包括：
Kconfig文件： Kconfig文件包含了内核的配置信息，以树状结构的形式组织。每个功能、模块或驱动都有对应的Kconfig条目。这些文件通常位于内核源代码树的各个目录中，例如，arch/目录、drivers/目录等。make menuconfig通过这些文件构建菜单界面。Makefile： 内核源代码中的Makefile包含了编译内核的相关规则和指令。make menuconfig命令会使用Makefile中的规则来创建配置菜单并执行相应的操作。.config文件： 在用户使用make menuconfig过程中，配置的结果会保存在一个名为." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/aa5e569fb049b8fe624731222a187cd6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T07:00:00+08:00" />
<meta property="article:modified_time" content="2024-01-16T07:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">U-Boot学习(3)：.config、defconfig文件对比及图形化配置Kconfig</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在上一节中，我们介绍了<a href="https://blog.csdn.net/tilblackout/article/details/135179594">U-Boot编译和.config配置文件生成分析</a>，我们可以通过<code>make xxx__defconfig</code>来进行一些配置，其中<code>xxx__defconfig</code>对应<code>config</code>目录下的基于不同开发板的一些配置，指令执行完后会根据对应的配置在根目录下生成一个<code>.config</code>配置文件。而这个配置文件也可以通过图形化配置页面来生成，这一节就来介绍一下。</p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_xxx_defconfigconfig_5" rel="nofollow">1 xxx_defconfig和.config文件</a></li><li><ul><li><a href="#11__7" rel="nofollow">1.1 文件对比</a></li><li><a href="#12__36" rel="nofollow">1.2 总结</a></li></ul> 
  </li><li><a href="#2_Kconfig_57" rel="nofollow">2 图形化配置之Kconfig</a></li><li><ul><li><a href="#21__58" rel="nofollow">2.1 介绍</a></li><li><a href="#21_UBoot_83" rel="nofollow">2.1 U-Boot的图形配置</a></li></ul> 
  </li><li><a href="#3_config_100" rel="nofollow">3 .config中的配置是如何使用的</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_xxx_defconfigconfig_5"></a>1 xxx_defconfig和.config文件</h2> 
<h3><a id="11__7"></a>1.1 文件对比</h3> 
<p><strong>1、<code>imx6ul_isiot_emmc_defconfig</code>及其对应<code>.config</code>对比</strong></p> 
<p>我们对比一下两个文件，左边是<code>imx6ul_isiot_emmc_defconfig</code>文件，右边是<code>make imx6ul_isiot_emmc_defconfig</code>生成的<code>.config</code>文件，可以看到配置文件里有的，<code>.config</code>文件里都有，除此之外<code>.config</code>文件里还有一些其它的配置。</p> 
<ul><li>文件中<code>#</code>开头的为注释</li></ul> 
<p><img src="https://images2.imgbox.com/0a/83/06dvHBh4_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2、<code>imx6ul_isiot_emmc_defconfig</code>和<code>imx6ul_isiot_nand_defconfig</code>对比</strong></p> 
<p>这里找一个与<code>imx6ul_isiot_emmc_defconfig</code>类似的配置<code>imx6ul_isiot_nand_defconfig</code>，来看一下区别：</p> 
<p><img src="https://images2.imgbox.com/94/12/dRe3irGE_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，如果要使能NAND的话，需要多定义几个宏定义。</p> 
<p><strong>3、nand的<code>.config</code>和emmc的<code>.config</code>对比</strong></p> 
<p>左边是nand的<code>.config</code>，右边是emmc的<code>.config</code>：</p> 
<p><img src="https://images2.imgbox.com/0d/3f/sr8qkQee_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出，比如nand的一行<code>CONFIG_MTD_RAW_NAND=y</code>，生成出来后可能对应了多个与此相关的配置。</p> 
<h3><a id="12__36"></a>1.2 总结</h3> 
<p>1、<code>xxx_defconfig</code></p> 
<p>在U-Boot的<code>defconfig</code>文件中，配置项之间存在依赖关系。当你在<code>defconfig</code>文件中启用或禁用某个配置项时，可能会触发相关的配置项引申或取消。</p> 
<ol><li><strong>直接依赖关系：</strong> 在<code>defconfig</code>文件中，一些配置项可能有直接的依赖关系。这意味着启用或禁用一个配置项可能会导致与之直接相关的其他配置项的状态发生变化。这通常是通过配置项的名称来指定的。</li><li><strong>间接依赖关系：</strong> 有些配置项可能存在间接的依赖关系。这意味着启用或禁用一个配置项可能会触发一系列的配置项状态变化，这些变化可能是由于其他配置项的依赖关系而产生的。</li></ol> 
<p>所以在生成的<code>.config</code>文件中，<code>xxx_defconfig</code>的一项配置可能有与之相关的多个配置。</p> 
<p>2、<code>.config</code></p> 
<p><code>.config</code>文件是一个文本文件，包含了一系列的宏定义，用于指定U-Boot的构建选项。这些宏定义决定了编译过程中使用的各种配置，如开启或关闭某个功能、指定交叉编译工具链的路径等。例如，在C代码中可以使用类似以下的方式来检查某个配置是否被定义：</p> 
<pre><code>#ifdef CONFIG_MY_FEATURE
    // 这段代码只有在 CONFIG_MY_FEATURE 被定义时才会被编译
#endif
</code></pre> 
<h2><a id="2_Kconfig_57"></a>2 图形化配置之Kconfig</h2> 
<h3><a id="21__58"></a>2.1 介绍</h3> 
<p>Kconfig(<code>Kernel Configuration</code>)是Linux内核中用于配置构建选项的工具之一。它允许开发者通过一个文本界面或图形界面来选择、配置和调整内核的各种功能和模块。Kconfig文件包含了内核的配置信息，这些信息指定了内核编译时的各种选项，如支持的硬件、文件系统、网络协议等。</p> 
<p>以下是Kconfig的一些主要特点和用法：</p> 
<ol><li><strong>配置系统的基本原理：</strong> Kconfig采用了一种树状结构的配置系统。用户可以通过选择配置项，打开或关闭功能、模块或驱动，以满足特定需求。</li><li><strong>配置文件：</strong> Kconfig的配置信息存储在内核源代码树中的Kconfig文件中。每个子目录都可以包含一个Kconfig文件，用于配置该目录下的源代码。</li><li><strong>菜单配置界面：</strong> Kconfig提供了一个文本界面，也可以通过图形界面工具(如<code>menuconfig</code>、<code>nconfig</code>、<code>xconfig</code>等)进行配置。这些工具允许用户在配置过程中浏览选项，选择开启或关闭功能，并设置相应的参数。</li><li><strong>依赖关系：</strong> Kconfig支持配置项之间的依赖关系。某些功能可能依赖于其他功能的开启或关闭，Kconfig会确保用户不能选择不合理的配置。</li><li><strong>自动生成配置：</strong> Kconfig支持自动检测系统硬件和软件环境，从而生成适用于当前系统的默认配置。这有助于简化配置过程。</li><li><strong>配置文件生成：</strong> 在用户完成配置后，Kconfig会生成一个<code>.config</code>文件，其中包含了用户选择的所有配置信息。这个文件将用于实际的内核编译过程。</li><li><strong>make命令：</strong> 用户可以使用<code>make menuconfig</code>、<code>make nconfig</code>等命令来启动配置工具。在配置完成后，使用<code>make</code>命令即可开始内核的编译过程。</li></ol> 
<p><code>make menuconfig</code>是Linux内核编译中使用的一个命令，它打开一个文本菜单界面，允许用户配置内核的各种选项。在执行<code>make menuconfig</code>之前，相关的文件主要包括：</p> 
<ol><li><strong>Kconfig文件：</strong> Kconfig文件包含了内核的配置信息，以树状结构的形式组织。每个功能、模块或驱动都有对应的Kconfig条目。这些文件通常位于内核源代码树的各个目录中，例如，<code>arch/</code>目录、<code>drivers/</code>目录等。<code>make menuconfig</code>通过这些文件构建菜单界面。</li><li><strong>Makefile：</strong> 内核源代码中的Makefile包含了编译内核的相关规则和指令。<code>make menuconfig</code>命令会使用Makefile中的规则来创建配置菜单并执行相应的操作。</li><li><strong>.config文件：</strong> 在用户使用<code>make menuconfig</code>过程中，配置的结果会保存在一个名为<code>.config</code>的文件中。这个文件包含了用户在配置过程中所做的选择，即内核的具体配置。<code>.config</code>文件将在后续的编译过程中被使用。</li></ol> 
<p>执行<code>make menuconfig</code>后，系统会读取Kconfig文件和已经存在的<code>.config</code>文件，然后在终端中打开一个菜单，用户可以在菜单中选择和配置不同的内核功能。选择保存并退出后，配置的结果会被写入<code>.config</code>文件中。</p> 
<p>虽然Kconfig是设计用来配置Linux内核的工具，但是U-Boot也使用了这个图形工具。使用这个图形化工具需要安装<code>libncurses-dev</code>库：</p> 
<pre><code>sudo apt-get install libncurses-dev
</code></pre> 
<h3><a id="21_UBoot_83"></a>2.1 U-Boot的图形配置</h3> 
<p>我们直接使用<code>make menuconfig</code>就可以打开图形配置界面了，在上一节中我们已经修改了Makefile指定了<code>CROSS_COMPILE</code>，如果没有指定的话需要指定这个变量：</p> 
<pre><code>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig
</code></pre> 
<p>如下图所示：<br> <img src="https://images2.imgbox.com/09/41/5Owee10H_o.png" alt="在这里插入图片描述"><br> 如上面的提示，输入<code>Y</code>可以将某个功能编译进U-Boot源码，输入<code>N</code>则是取消编译，输入<code>M</code>则是将功能编译成模块。</p> 
<p>比如我们进入下面的<code>Command Line Interface</code>，这个界面就是用来配置U-Boot命令行中支持的指令：<br> <img src="https://images2.imgbox.com/56/ff/sJMj4t4X_o.png" alt="在这里插入图片描述"><br> 我们进去<code>Memory commands</code>看一下：<br> <img src="https://images2.imgbox.com/c5/99/qALGvhdP_o.png" alt="在这里插入图片描述"><br> 我们可以通过按下<code>Y</code>或<code>N</code>来使能和取消某些不需要支持的指令。所有的选项配置完之后选择下面的<code>Save</code>即可保存配置到<code>.config</code>中。</p> 
<p>实际上这些配置都对应代码中的宏定义，我们可以根据我们的需求打开或关闭一些功能，从而实现U-Boot的裁剪。当然如果有必要的话，还是建议把每一个配置项都理解一遍。</p> 
<h2><a id="3_config_100"></a>3 .config中的配置是如何使用的</h2> 
<p><code>.config</code> 文件通常不是直接包含在代码中的头文件(<code>.h</code> 文件)中。它是通过Makefile中的一些规则和变量传递给预处理器的。</p> 
<p>U-Boot的Makefile通常会包含一个名为<code>config.mk</code>的文件，这个文件会包含<code>.config</code>文件的内容并将其转换为Makefile变量。通过这种方式，Makefile 中的规则可以使用这些变量，将它们传递给编译器进行条件编译。</p> 
<p>下面举一个简单的例子说明U-Boot的Makefile中如何处理<code>.config</code>文件：</p> 
<pre><code># Makefile

# Include the configuration file
-include config.mk

# Compiler flags
CFLAGS += -Wall

# Conditional compilation based on configuration options
ifeq ($(CONFIG_FEATURE_A),y)
  CFLAGS += -DFEATURE_A_ENABLED
endif

ifeq ($(CONFIG_FEATURE_B),y)
  CFLAGS += -DFEATURE_B_ENABLED
endif

# Target rule
all: my_program

my_program: some_code.c
    $(CC) $(CFLAGS) $^ -o $@
</code></pre> 
<ul><li><code>-include config.mk</code>用于包含<code>config.mk</code>文件，该文件会根据<code>.config</code>文件的内容生成相应的变量。</li><li><code>ifeq ($(CONFIG_FEATURE_A),y)</code>和<code>ifeq ($(CONFIG_FEATURE_B),y)</code>用于检查配置文件中的选项是否为 <code>y</code>(启用)，如果是，则在<code>CFLAGS</code>变量中添加相应的编译选项。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/94bdbd9c50d9ceb3e37ccd93fa029d3a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java如何修改windows计算机本地日期和时间？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae920f5d7ef1c11dc89f484c57a7e884/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【教3妹学编程-算法题】3006. 找出数组中的美丽下标 I</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>