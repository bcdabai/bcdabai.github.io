<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¦‚ä½•ä½¿ç”¨Entity FrameworkæŸ¥è¯¢Mysqlæ•°æ®åº“ å¹¶å®ç°å¤šè¡¨è”æŸ¥ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¦‚ä½•ä½¿ç”¨Entity FrameworkæŸ¥è¯¢Mysqlæ•°æ®åº“ å¹¶å®ç°å¤šè¡¨è”æŸ¥" />
<meta property="og:description" content="ç®€ä»‹ ğŸ€é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œä½¿ç”¨ORMå·¥å…·Entity FrameworkæŸ¥è¯¢Mysqlæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¹¶å®ç°å¤šè¡¨è”æŸ¥
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªuserç”¨æˆ·è¡¨ï¼Œå…¶ä¸­occupationidå¯¹åº”çš„å°±æ˜¯ä¸‹é¢èŒä¸šè¡¨ä¸­çš„id
èŒä¸šè¡¨Occupations
ç°åœ¨æˆ‘ä»¬éœ€è¦æŸ¥å‡ºç”¨æˆ·çš„èŒä¸šæ˜¯ä»€ä¹ˆï¼Œåœ¨MySQLä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡LEFT JOINå®ç°å¤šè¡¨æŸ¥è¯¢ã€‚å¦‚ä¸‹sqlè¯­å¥ã€‚
SELECT name,opname FROM Users LEFT JOIN Occupations ON Users.opid = Occupations.id å¦‚æœæƒ³è¦åœ¨EFCoreä¸­å®Œæˆè¿™ç§éœ€æ±‚åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ã€‚
å®‰è£…nugetåŒ… åˆ†åˆ«å®‰è£…å¦‚ä¸‹ä¸¤ä¸ªnugetåŒ…ï¼Œå…·ä½“ç‰ˆæœ¬è¦å‚è€ƒè‡ªå·±å®é™…çš„MySQLç‰ˆæœ¬
NuGet\Install-Package Microsoft.Extensions.Hosting -Version 8.0.0 NuGet\Install-Package Pomelo.EntityFrameworkCore.MySql -Version 7.0.0 åˆ›å»ºä¸Šä¸‹æ–‡ç±» é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªÂ DbContextÂ çš„ä¸Šä¸‹æ–‡ç±»ï¼Œä½¿ç”¨DbSetÂ å±æ€§æ¥è¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨
public class MyContext : DbContext { public MyContext(DbContextOptions&lt;MyContext&gt; options) : base(options) { } public virtual DbSet&lt;User&gt; Users { get; set; } = null!; public virtual DbSet&lt;Occupation&gt; Occupations { get; set; } = null!; } ç„¶ååˆ†åˆ«åˆ›å»ºæˆ‘ä»¬æ•°æ®åº“ä¸¤å¼ è¡¨çš„å®ä½“ç±»ï¼Œå®ƒä»¬é€šè¿‡å¯¼èˆªå±æ€§ occupationid ç›¸äº’å…³è”" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0ac9a9d20969c924e0d5aa6a11cc5556/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T22:23:23+08:00" />
<meta property="article:modified_time" content="2024-01-16T22:23:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¦‚ä½•ä½¿ç”¨Entity FrameworkæŸ¥è¯¢Mysqlæ•°æ®åº“ å¹¶å®ç°å¤šè¡¨è”æŸ¥</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>ç®€ä»‹</h2> 
<p>ğŸ€é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œä½¿ç”¨ORMå·¥å…·Entity FrameworkæŸ¥è¯¢Mysqlæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¹¶å®ç°å¤šè¡¨è”æŸ¥</p> 
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªuserç”¨æˆ·è¡¨ï¼Œå…¶ä¸­occupationidå¯¹åº”çš„å°±æ˜¯ä¸‹é¢èŒä¸šè¡¨ä¸­çš„id</p> 
<p><img alt="" height="129" src="https://images2.imgbox.com/6e/86/pYLPTJUu_o.png" width="323"></p> 
<p>Â èŒä¸šè¡¨Occupations</p> 
<p>Â <img alt="" height="120" src="https://images2.imgbox.com/5c/6b/nAbQklwh_o.png" width="351"></p> 
<p>Â ç°åœ¨æˆ‘ä»¬éœ€è¦æŸ¥å‡ºç”¨æˆ·çš„èŒä¸šæ˜¯ä»€ä¹ˆï¼Œåœ¨MySQLä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡LEFT JOINå®ç°å¤šè¡¨æŸ¥è¯¢ã€‚å¦‚ä¸‹sqlè¯­å¥ã€‚</p> 
<pre><code class="language-sql">SELECT name,opname FROM Users 
LEFT JOIN Occupations ON Users.opid = Occupations.id</code></pre> 
<p><img alt="" height="239" src="https://images2.imgbox.com/eb/f5/F8XOsRHd_o.png" width="471"></p> 
<p>Â å¦‚æœæƒ³è¦åœ¨EFCoreä¸­å®Œæˆè¿™ç§éœ€æ±‚åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ã€‚</p> 
<h2>å®‰è£…nugetåŒ…</h2> 
<p>åˆ†åˆ«å®‰è£…å¦‚ä¸‹ä¸¤ä¸ªnugetåŒ…ï¼Œå…·ä½“ç‰ˆæœ¬è¦å‚è€ƒè‡ªå·±å®é™…çš„MySQLç‰ˆæœ¬</p> 
<pre><code class="language-sql">NuGet\Install-Package Microsoft.Extensions.Hosting -Version 8.0.0</code></pre> 
<pre><code class="language-sql">NuGet\Install-Package Pomelo.EntityFrameworkCore.MySql -Version 7.0.0</code></pre> 
<p><img alt="" height="105" src="https://images2.imgbox.com/95/a7/vKzVJcKN_o.png" width="723"></p> 
<h2>åˆ›å»ºä¸Šä¸‹æ–‡ç±»</h2> 
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªÂ <code>DbContext</code>Â çš„ä¸Šä¸‹æ–‡ç±»ï¼Œä½¿ç”¨<code>DbSet</code>Â å±æ€§æ¥è¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨</p> 
<pre><code class="language-cs">public class MyContext : DbContext
{
    public MyContext(DbContextOptions&lt;MyContext&gt; options)
        : base(options)
    {
    }

    public virtual DbSet&lt;User&gt; Users { get; set; } = null!;
    
    public virtual DbSet&lt;Occupation&gt; Occupations { get; set; } = null!;
}</code></pre> 
<p>ç„¶ååˆ†åˆ«åˆ›å»ºæˆ‘ä»¬æ•°æ®åº“ä¸¤å¼ è¡¨çš„å®ä½“ç±»ï¼Œå®ƒä»¬é€šè¿‡å¯¼èˆªå±æ€§ occupationid ç›¸äº’å…³è”</p> 
<pre><code class="language-cs">public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    
    public int occupationid { get; set; }
    
    public Occupation Occupation { get; set; }
}

public class Occupation
{
    public int Id { get; set; }
    
    public string opname { get; set; }
}</code></pre> 
<h2>ä¾èµ–æ³¨å…¥</h2> 
<p>æ‰“å¼€æˆ‘ä»¬çš„programç±»ï¼Œåˆ›å»ºä¸€ä¸ªä¸»æœºæ„å»ºå™¨ï¼Œé€šè¿‡AddDbContextPoolæ³¨å†ŒÂ <code>MyContext</code>Â ç±»å‹åˆ°æœåŠ¡å®¹å™¨ä¸­ã€‚</p> 
<p>ç„¶åé€šè¿‡<code>AddHostedService</code>Â æ–¹æ³•æ·»åŠ ä¸€ä¸ªåå°æœåŠ¡ï¼Œè¯¥æœåŠ¡å°†åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œï¼Œè¿™é‡Œæˆ‘æ·»åŠ çš„æ˜¯selectUseræœåŠ¡ï¼Œä¹Ÿå°±æ˜¯é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šæ‰§è¡Œå®ƒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»å†™selectUseræœåŠ¡</p> 
<pre><code class="language-cs">class Program
{
    public static void Main(string[] args)
    {
         // åˆ›å»ºä¸€ä¸ªä¸»æœºæ„å»ºå™¨ï¼Œç”¨äºé…ç½®åº”ç”¨ç¨‹åºçš„å¯åŠ¨å’Œä¾èµ–æ³¨å…¥ã€‚
        HostApplicationBuilder builder = Host.CreateApplicationBuilder(args);

        // é…ç½®æœåŠ¡ï¼Œè¿™é‡Œæ·»åŠ äº†æ•°æ®åº“ä¸Šä¸‹æ–‡æ± ï¼Œç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥ã€‚
        builder.Services.AddDbContextPool&lt;MyContext&gt;(
            p =&gt;
            {
                p.UseMySql("server=127.0.0.1;uid=root;pwd=password;database=mydb", new MySqlServerVersion("5.7"),
                    opt =&gt; opt.UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery));
                p.LogTo(Console.WriteLine, LogLevel.Information);
                p.EnableSensitiveDataLogging(true);
            }, 150);

        // æ·»åŠ å®¿ä¸»æœåŠ¡ï¼Œæˆ‘ä»¬ç¨ååˆ›å»ºselectUseræœåŠ¡
        builder.Services.AddHostedService&lt;selectUser&gt;();

         // æ„å»ºå®¿ä¸»ã€‚
        using IHost host = builder.Build();

        // è¿è¡Œå®¿ä¸»ï¼Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚
        host.Run();
    }
}</code></pre> 
<p>å®šä¹‰ä¸€ä¸ªåä¸ºselectUserçš„ç±»ï¼Œç»§æ‰¿è‡ª<code>BackgroundService</code>Â ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ å‚æ•°MyContext ï¼Œé¡¹ç›®è¿è¡Œæ—¶ä¼šé€šè¿‡ä¾èµ–æ³¨å…¥ç»™å½“å‰ç±»æä¾›ä¸€ä¸ªMyContextä¸Šä¸‹æ–‡ï¼Œè¿™æ ·ï¼Œ<code>selectUser</code>Â ç±»å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªÂ <code>DbContext</code>Â å®ä¾‹æ¥è®¿é—®æ•°æ®åº“ã€‚</p> 
<p>ä½¿ç”¨Â <code>_myContext.Users</code>Â æ¥è®¿é—®æ•°æ®åº“ä¸­çš„Â <code>Users</code>Â è¡¨ã€‚<code>Include(p =&gt; p.Occupation)</code>Â è¡¨ç¤ºåœ¨æŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œè¿˜è¦åŒ…æ‹¬å…³è”çš„Â <code>Occupation</code>Â å®ä½“</p> 
<pre><code class="language-cs">public class selectUser : BackgroundService
{
    private readonly MyContext _myContext;

    public selectUser(MyContext myContext)
    {
        _myContext = myContext;
    }
    

    protected override async Task&lt;int&gt; ExecuteAsync(CancellationToken stoppingToken)
    {
        var find = _myContext.Users
            .Include(p =&gt; p.Occupation)
            .ToList();
        foreach (var user in find)
        {
            Console.WriteLine(user.Name);
        }

        return 0;
    }
}</code></pre> 
<p>è¿™æ ·åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¤šè¡¨è”æŸ¥è·å¾—ç”¨æˆ·çš„èŒä¸š</p> 
<p><img alt="" height="588" src="https://images2.imgbox.com/10/5b/auUJ12f0_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/37ae634a139cf0e713a6a5c02a326ad8/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">CMU15-445-Spring-2023-Project #3 - å‰ç½®çŸ¥è¯†ï¼ˆlec10-14ï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/80b06c19284989bbba85202242798d53/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">çˆ¬è™«ä¹‹Cookieè·å–ï¼šåˆ©ç”¨æµè§ˆå™¨æ¨¡æ‹Ÿä¸€ä¸ªcookieå‡ºæ¥ã€é¢å¯¹åçˆ¬è™«ã€åŠ å¯†çš„cookieçš„åº”å¯¹æ–¹æ³•</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>