<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32-(SysTick定时器,EXTI外部中断/事件控制器) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32-(SysTick定时器,EXTI外部中断/事件控制器)" />
<meta property="og:description" content="Systick系统定时器 介绍：systick定时器上属于CM3内核中的一个外设，内嵌在NVIC中。系统定时器是一个24位向下计数的计数器，计数器每一次计数的时间是1/SYSTICK，一般我们设置SYSTICK为72M。当重载数值寄存器的值递减到0时，系统定时器产生一次中断，以此循环。
使用范围：1.一般用于操作系统，用于产生时基，维持操作系统的心跳。
使用的寄存器：CTRL,LOAD,VAL,CALIB;
例程1：利用systick产生1s的时基。 步骤：
1.设置重载寄存器的值
2.清除当前数值寄存器的值
3.配置控制于状态寄存器
systick配置库函数：
_STATIC_INLINE uint32_t SysTick_Config(uint32_t ticks) { //不可能的重装载值，超出范围 if((ticks - 1UL)&gt;SysTick_LOAD_RELOAD_Msk){ return (1UL); } //设置重装载寄存器 SysTick-&gt;LOAD = (uint32_t)(tiicks - 1UL); //设置中断优先级 NVIC_SetPriority(SysTick_IRQn,(1UL&lt;&lt;NVIC_PRIO_BITS)-1UL); //设置当前数值寄存器 SysTick-&gt;VAL = OUL; //设置系统定时时钟源为AHBCLK=72M //使能系统定时器中断 //使能定时器 SysTick-&gt;CTRL = SysTIck_CTRL_CLKSOURCE_Msk | SysTick_CTRL_TICKINT_Msk | SysTick_CTRL_ENABLE_Msk; return (OUL); } 用固件库编程的时候我们只需要调用库函数SysTick_Config()即可，形参ticks用来设置重装载寄存器的值，最大不能超过重装载寄存器的值2^24,当重载寄存器的值递减到0的时候产生中断，然后重载寄存器的值又重新装载往下计数，以此循环。
设置中断优先级：
void NVIC_SetPriority(IRQn_Type IRQn,uin32_t priority) { if((int32_t) IRQ&lt;0){ SCB-&gt;SHP[(((uint32_t)(int32_t))IRQn)&amp;0XFUL)-4UL] = (uint8_t)((priority&lt;&lt;(8-_NVIC_PRIO_BITS)) &amp;(uint32_t)0xffUL); } } 使用：NVIC_SetPriority(Systick_IRQn,(1UL&lt;&lt;_NVIC_PRIO_BITS)-1UL); 配置系统定时器的时钟（AHBCLK）为72M：
SysTick初始化函数：
void SysTick__Init(void) { /*systickFrequency / 1000 1ms中断一次*/ /*systickFrequency / 100000 10us中断一次*/ /*systickFrequency / 1000000 1us中断一次*/ if(SysTick_Config(SystemCoreClock / 100000)){ while(1); } } 这个函数决定了多长时间产生一次中断。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7486e1e0e7564ea45a63f047cfd16b57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-10-24T19:49:18+08:00" />
<meta property="article:modified_time" content="2018-10-24T19:49:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32-(SysTick定时器,EXTI外部中断/事件控制器)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Systick_0"></a>Systick系统定时器</h2> 
<p>介绍：systick定时器上属于CM3内核中的一个外设，内嵌在NVIC中。系统定时器是一个24位向下计数的计数器，计数器每一次计数的时间是1/SYSTICK，一般我们设置SYSTICK为72M。当重载数值寄存器的值递减到0时，系统定时器产生一次中断，以此循环。<br> 使用范围：1.一般用于操作系统，用于产生时基，维持操作系统的心跳。<br> 使用的寄存器：CTRL,LOAD,VAL,CALIB;</p> 
<h3><a id="1systick1s_4"></a>例程1：利用systick产生1s的时基。</h3> 
<p>步骤：<br> 1.设置重载寄存器的值<br> 2.清除当前数值寄存器的值<br> 3.配置控制于状态寄存器<br> systick配置库函数：</p> 
<pre><code>_STATIC_INLINE uint32_t SysTick_Config(uint32_t ticks)
{
	//不可能的重装载值，超出范围
	if((ticks - 1UL)&gt;SysTick_LOAD_RELOAD_Msk){
	return (1UL);
	}
	//设置重装载寄存器
	SysTick-&gt;LOAD = (uint32_t)(tiicks - 1UL);
	//设置中断优先级
	NVIC_SetPriority(SysTick_IRQn,(1UL&lt;&lt;NVIC_PRIO_BITS)-1UL);
	//设置当前数值寄存器
	SysTick-&gt;VAL = OUL;
	//设置系统定时时钟源为AHBCLK=72M
	//使能系统定时器中断
	//使能定时器
	SysTick-&gt;CTRL = SysTIck_CTRL_CLKSOURCE_Msk | SysTick_CTRL_TICKINT_Msk | SysTick_CTRL_ENABLE_Msk;
	return (OUL);
}
</code></pre> 
<p>用固件库编程的时候我们只需要调用库函数SysTick_Config()即可，形参ticks用来设置重装载寄存器的值，最大不能超过重装载寄存器的值2^24,当重载寄存器的值递减到0的时候产生中断，然后重载寄存器的值又重新装载往下计数，以此循环。</p> 
<p>设置中断优先级：</p> 
<pre><code>void NVIC_SetPriority(IRQn_Type IRQn,uin32_t priority)
{
	if((int32_t) IRQ&lt;0){
	SCB-&gt;SHP[(((uint32_t)(int32_t))IRQn)&amp;0XFUL)-4UL] = (uint8_t)((priority&lt;&lt;(8-_NVIC_PRIO_BITS)) &amp;(uint32_t)0xffUL);
	}
}

使用：NVIC_SetPriority(Systick_IRQn,(1UL&lt;&lt;_NVIC_PRIO_BITS)-1UL);
</code></pre> 
<p>配置系统定时器的时钟（AHBCLK）为72M：<br> SysTick初始化函数：</p> 
<pre><code>void SysTick__Init(void)
{
/*systickFrequency / 1000    1ms中断一次*/
/*systickFrequency / 100000   10us中断一次*/
/*systickFrequency / 1000000   1us中断一次*/
	if(SysTick_Config(SystemCoreClock / 100000)){
		while(1);
	}
}
</code></pre> 
<p>这个函数决定了多长时间产生一次中断。<br> 使能定时器和定时器中断：<br> <img src="https://images2.imgbox.com/66/a1/7orsQICx_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/24/26/iPWpSjCm_o.png" alt="在这里插入图片描述"><br> 函数Delay_us()中我们等待TimingDelay为0，当它为零时表示延时时间到了。所以systick每进一次中断即10us时间</p> 
<p>SysTick中断服务函数：</p> 
<pre><code>void TimingDelay_Decrement(void)
{
	if(TimingDelay !=0x00)
	{
	TimingDelay--;
	}
}
void SysTick_Handler(void)
{
	TimingDelay_Decrement();
}
</code></pre> 
<p>TimingDelay的值等于延时函数中传进去的nTime的值，比如nTime=100000，则延时时间等于100000*10us = 1s。</p> 
<h2><a id="EXTI_81"></a>EXTI外部中断/事件控制器</h2> 
<p>EXTI(external interrupt/event controller) 一外部中断/事件控制器，管理了控制器的20个中断/事件线。每个中断/事件线都对应有一个边沿检测器，可以实现输入信号的上升沿检测和下降沿的检测。EXTI可以实现对每个中断/事件进行单独配置，可以单独配置为中断或者事件，以及触发事件的属性。<br> EXTI的功能框图：<br> <img src="https://images2.imgbox.com/3a/b0/iupbLsak_o.png" alt="在这里插入图片描述"></p> 
<p>EXTI可以分为两部分功能，一个产生中断，一个产生事件，这两个功能在硬件上就有所不同。<br> **中断与事件的区别：产生中断的线路的目的上把输入信号输入到NVIC，进一步会运行中断服务函数，实现功能，这样是软件级别的。而产生事件线路目的就是传输一个脉冲信号给其他外设使用，并且是电路级别的信号传输，属于硬件级别的。</p> 
<p>红色线路上EXTI产生中断的线路，绿色线路上EXTI产生事件的线路。</p> 
<p><img src="https://images2.imgbox.com/23/7f/EWZITLIQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="EXTI_94"></a>EXTI初始化结构体详解</h3> 
<pre><code>typedef struct{
		uint32_t EXTI_Line;	//中断/事件线
		EXTIMode_TypeDef  EXTI_Mode;//EXTI模式
		EXTITrigger_TypeDef EXTI_Trigger;//触发类型
		FunctionalState EXTI_LineCmd;//EXTI使能
}EXTI_InitTypeDef;
</code></pre> 
<p>1.EXTI_Line:EXTI中断/事件选择，参考上表。<br> 2.EXTI_MODE:EXTI模式选择，可以选择是产生中断还是事件。<br> 3.EXTI_Trigger:EXTI边沿触发事件，可以选择上升沿触发还是下降沿触发或者是边沿触发。<br> 4.EXTI_LineCmd:控制是否使能EXTI线，可选使能EXTI线(ENABLE)或禁用(DISABLE).</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/895ea0be3c3c751957e78bd0e7671c6c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">url重定向,vue路由重定向,vue路由守卫</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dfb568ecdb9d1f01d4ae80d829c2a4db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sublime Text3 编译运行java</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>