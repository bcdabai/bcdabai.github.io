<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nacos(先解释专属名词，然后大白话讲解&#43;安装配置教程&#43;代码实例 信我，看了必会！！点进来吧各位大佬们) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nacos(先解释专属名词，然后大白话讲解&#43;安装配置教程&#43;代码实例 信我，看了必会！！点进来吧各位大佬们)" />
<meta property="og:description" content="Nacos 先来一个注意：以下涉及到配置和项目的创建，我的jdk是jdk17，idea是2023.2.4，并且是社区版的idea
1.什么是Nacos Nacos是Dyamic Naming and Configuration Service的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。Nacos致力于帮助我们发现、配置和管理微服务。Nacos提供了一组简单易用的特性集，帮助我们快速实现动态服务发现，服务配置，服务元数据及流量管理。Nacos帮助我们更敏捷和容易的构建、交付和管理微服务平台。Nacos是构建以“服务”为中心的现代应用架构。
2.上面的话我想你听了肯定还很摸棱两可，下面我用通俗易懂的话来解释一下！！！ 想象一下，你是一个指挥家，负责指挥一个由许多乐器组成的交响乐团。每个乐器就像是一个微服务，它们各自演奏自己的部分，但需要协调一致才能演奏出美妙的音乐。在这个比喻中，Nacos 就像是你的助手，帮助你管理这些乐器（微服务）。
服务发现和管理：就好比乐器需要知道何时该演奏，何时该停止。Nacos 会告诉每个微服务（乐器）其他服务（乐器）的位置和状态，确保它们能够协调一致地工作。
配置管理：想象一下，如果乐团中某个部分的演奏风格或速度需要改变，你需要通知到相关的乐器。Nacos 允许你轻松地调整和传达这些改变（配置），确保每个微服务都按照最新的要求来执行。
服务健康监测：这就像确保每个乐器都能正常演奏，没有出现问题。Nacos 不断检查每个微服务的健康状态，如果发现问题，就会及时通知，确保整个系统的稳定运行。
所以，Nacos 基本上是在帮助你指挥这个庞大的微服务交响乐团，确保每个部分都能和谐地工作，最终演奏出美妙的“音乐”（即流畅、高效的应用程序）
3.Nacos功能 Nacos主要功能主要有以下两个
1.配置中心
2.注册中心
3.1配置中心 配置中心是一种集中化管理配置的服务，它的主要作用主要有以下几个：
1.集中管理配置信息：配置中心将不同服务的配置信息集中放在一起进行管理，实现了配置信息的集中存储
2.动态更新配置：配置中心的配置信息可以通过操作界面或者API进行动态更新，无需重启服务就可以应用到最新的配置信息
3.配置信息共享：将配置集中在配置中心中，不同的服务实例可以共享同一套配置信息
4.配置信息安全：配置中心可以对配置信息提供安全管理，权限控制等管理功能
5.信息追溯：指出配置版本管理，历史记录等管理功能
下面我来对上面五条用人话解释
集中管理配置信息：
比方说，你有一个在线购物应用，其中包含用户服务、订单服务和支付服务等微服务。每个服务都有自己的配置信息，例如数据库连接、缓存设置等。通过配置中心，你可以将这些服务的配置信息集中存放和管理，而不是分散在各个服务中。
动态更新配置：
假设你的购物应用需要更改支付服务的某个参数，比如交易超时时间。通过配置中心，你可以直接更新这个参数，而不需要重启支付服务。服务会自动获取最新的配置并应用更改。
配置信息共享：
如果你的购物应用的多个服务都需要访问相同的数据库，你可以在配置中心设置数据库连接信息。这样，所有服务都可以共享这一配置，而无需在每个服务中单独配置数据库信息。
配置信息安全：
在配置中心，你可以设置权限，以确保只有授权的人员能够访问和修改配置信息。比如，你可能只允许高级开发人员修改数据库的连接字符串，以防止未授权的更改。
信息追溯：
假设你更新了购物应用中某个服务的配置，但这导致了一些问题。通过配置中心的版本管理和历史记录功能，你可以轻松查看哪些更改被做了，并且回滚到之前的配置版本，恢复服务的正常运行。
3.2注册中心 注册中心是微服务架构一个重要的组件，用于实现服务的注册与发现，注册中心的主要作用包括以下几个：
1.服务注册： 服务实例启动的时候，将自身信息注册到注册中心，包括服务名称、地址、端口等。
2.服务发现： 消费者向注册中心查询服务，并获取服务实例来访问服务
3.服务健康检查： 注册中心定期检查服务实例健康情况，过滤不健康实例
4.服务路由： 提供服务的路由与负载均衡功能
5.服务监控： 统计服务调用次数，时长等，用于监控服务状态
6.服务更新： 当服务实例信息变更时，向注册中心发送更新信息通知
人话解释
服务注册：
假设你有一个在线书店应用，其中包含一个&#34;书籍搜索服务&#34;。当这个服务启动时，它会向Nacos注册中心注册自己的信息，如服务名称是&#34;book-search-service&#34;，地址可能是&#34;192.168.1.5&#34;，端口是8080。这样，注册中心就知道了这个服务的存在和如何访问它。
服务发现：
在同一个在线书店应用中，假设有一个&#34;用户界面服务&#34;需要调用&#34;书籍搜索服务&#34;来显示书籍数据。&#34;用户界面服务&#34;会询问Nacos注册中心&#34;书籍搜索服务&#34;的位置，注册中心返回&#34;书籍搜索服务&#34;的地址和端口，然后&#34;用户界面服务&#34;可以直接调用该服务。
服务健康检查：
Nacos定期检查&#34;书籍搜索服务&#34;是否正常运行，例如通过发送心跳信号或进行实际的服务调用。如果服务没有响应或响应时间过长，Nacos会认为这个实例不健康，并从可用服务列表中移除它。
服务路由和负载均衡：
假设&#34;书籍搜索服务&#34;有多个实例运行在不同的服务器上。当&#34;用户界面服务&#34;请求&#34;书籍搜索服务&#34;时，Nacos根据设定的路由策略（如轮询、最少连接等）决定应该将请求发送到哪个实例，实现负载均衡。
服务监控：
Nacos可以记录每次对&#34;书籍搜索服务&#34;的调用次数、响应时间等信息。这些数据可以用于监控服务的性能、发现潜在的问题或进行容量规划。
服务更新：
如果&#34;书籍搜索服务&#34;的某个实例因为升级或维护改变了其地址或端口，该实例会向Nacos发送更新信息。Nacos注册中心会更新其记录，确保其他服务能够获取到最新的访问信息。
4.Nacos优点 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3f39469f413e64489d185d8057483844/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-28T17:49:52+08:00" />
<meta property="article:modified_time" content="2024-01-28T17:49:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nacos(先解释专属名词，然后大白话讲解&#43;安装配置教程&#43;代码实例 信我，看了必会！！点进来吧各位大佬们)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Nacos_0"></a>Nacos</h2> 
<p><strong>先来一个注意：以下涉及到配置和项目的创建，我的jdk是jdk17，idea是2023.2.4，并且是社区版的idea</strong></p> 
<h3><a id="1Nacos_2"></a>1.什么是Nacos</h3> 
<p>Nacos是Dyamic Naming and Configuration Service的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。Nacos致力于帮助我们发现、配置和管理微服务。Nacos提供了一组简单易用的特性集，帮助我们快速实现动态服务发现，服务配置，服务元数据及流量管理。Nacos帮助我们更敏捷和容易的构建、交付和管理微服务平台。Nacos是构建以“服务”为中心的现代应用架构。</p> 
<h3><a id="2_5"></a>2.<strong>上面的话我想你听了肯定还很摸棱两可，下面我用通俗易懂的话来解释一下！！！</strong></h3> 
<p>想象一下，你是一个指挥家，负责指挥一个由许多乐器组成的交响乐团。每个乐器就像是一个微服务，它们各自演奏自己的部分，但需要协调一致才能演奏出美妙的音乐。在这个比喻中，Nacos 就像是你的助手，帮助你管理这些乐器（微服务）。</p> 
<p>服务发现和管理：就好比乐器需要知道何时该演奏，何时该停止。Nacos 会告诉每个微服务（乐器）其他服务（乐器）的位置和状态，确保它们能够协调一致地工作。</p> 
<p>配置管理：想象一下，如果乐团中某个部分的演奏风格或速度需要改变，你需要通知到相关的乐器。Nacos 允许你轻松地调整和传达这些改变（配置），确保每个微服务都按照最新的要求来执行。</p> 
<p>服务健康监测：这就像确保每个乐器都能正常演奏，没有出现问题。Nacos 不断检查每个微服务的健康状态，如果发现问题，就会及时通知，确保整个系统的稳定运行。</p> 
<p>所以，Nacos 基本上是在帮助你指挥这个庞大的微服务交响乐团，确保每个部分都能和谐地工作，最终演奏出美妙的“音乐”（即流畅、高效的应用程序）</p> 
<h3><a id="3Nacos_16"></a>3.Nacos功能</h3> 
<p>Nacos主要功能主要有以下两个<br> 1.配置中心<br> 2.注册中心</p> 
<h4><a id="31_20"></a>3.1配置中心</h4> 
<p>配置中心是一种集中化管理配置的服务，它的主要作用主要有以下几个：<br> 1.<strong>集中管理配置信息</strong>：配置中心将不同服务的配置信息集中放在一起进行管理，实现了配置信息的集中存储<br> 2.<strong>动态更新配置</strong>：配置中心的配置信息可以通过操作界面或者API进行动态更新，无需重启服务就可以应用到最新的配置信息<br> 3.<strong>配置信息共享</strong>：将配置集中在配置中心中，不同的服务实例可以共享同一套配置信息<br> 4.<strong>配置信息安全</strong>：配置中心可以对配置信息提供安全管理，权限控制等管理功能<br> 5.<strong>信息追溯</strong>：指出配置版本管理，历史记录等管理功能</p> 
<p><strong>下面我来对上面五条用人话解释</strong><br> 集中管理配置信息：<br> 比方说，你有一个在线购物应用，其中包含用户服务、订单服务和支付服务等微服务。每个服务都有自己的配置信息，例如数据库连接、缓存设置等。通过配置中心，你可以将这些服务的配置信息集中存放和管理，而不是分散在各个服务中。</p> 
<p>动态更新配置：<br> 假设你的购物应用需要更改支付服务的某个参数，比如交易超时时间。通过配置中心，你可以直接更新这个参数，而不需要重启支付服务。服务会自动获取最新的配置并应用更改。</p> 
<p>配置信息共享：<br> 如果你的购物应用的多个服务都需要访问相同的数据库，你可以在配置中心设置数据库连接信息。这样，所有服务都可以共享这一配置，而无需在每个服务中单独配置数据库信息。</p> 
<p>配置信息安全：<br> 在配置中心，你可以设置权限，以确保只有授权的人员能够访问和修改配置信息。比如，你可能只允许高级开发人员修改数据库的连接字符串，以防止未授权的更改。</p> 
<p>信息追溯：<br> 假设你更新了购物应用中某个服务的配置，但这导致了一些问题。通过配置中心的版本管理和历史记录功能，你可以轻松查看哪些更改被做了，并且回滚到之前的配置版本，恢复服务的正常运行。</p> 
<h4><a id="32_43"></a>3.2注册中心</h4> 
<p>注册中心是微服务架构一个重要的组件，用于实现服务的注册与发现，注册中心的主要作用包括以下几个：<br> <strong>1.服务注册：</strong> 服务实例启动的时候，将自身信息注册到注册中心，包括服务名称、地址、端口等。<br> <strong>2.服务发现：</strong> 消费者向注册中心查询服务，并获取服务实例来访问服务<br> <strong>3.服务健康检查：</strong> 注册中心定期检查服务实例健康情况，过滤不健康实例<br> <strong>4.服务路由：</strong> 提供服务的路由与负载均衡功能<br> <strong>5.服务监控：</strong> 统计服务调用次数，时长等，用于监控服务状态<br> <strong>6.服务更新：</strong> 当服务实例信息变更时，向注册中心发送更新信息通知</p> 
<p><strong>人话解释</strong><br> 服务注册：</p> 
<p>假设你有一个在线书店应用，其中包含一个"书籍搜索服务"。当这个服务启动时，它会向Nacos注册中心注册自己的信息，如服务名称是"book-search-service"，地址可能是"192.168.1.5"，端口是8080。这样，注册中心就知道了这个服务的存在和如何访问它。</p> 
<p>服务发现：<br> 在同一个在线书店应用中，假设有一个"用户界面服务"需要调用"书籍搜索服务"来显示书籍数据。"用户界面服务"会询问Nacos注册中心"书籍搜索服务"的位置，注册中心返回"书籍搜索服务"的地址和端口，然后"用户界面服务"可以直接调用该服务。</p> 
<p>服务健康检查：<br> Nacos定期检查"书籍搜索服务"是否正常运行，例如通过发送心跳信号或进行实际的服务调用。如果服务没有响应或响应时间过长，Nacos会认为这个实例不健康，并从可用服务列表中移除它。</p> 
<p>服务路由和负载均衡：<br> 假设"书籍搜索服务"有多个实例运行在不同的服务器上。当"用户界面服务"请求"书籍搜索服务"时，Nacos根据设定的路由策略（如轮询、最少连接等）决定应该将请求发送到哪个实例，实现负载均衡。</p> 
<p>服务监控：<br> Nacos可以记录每次对"书籍搜索服务"的调用次数、响应时间等信息。这些数据可以用于监控服务的性能、发现潜在的问题或进行容量规划。</p> 
<p>服务更新：<br> 如果"书籍搜索服务"的某个实例因为升级或维护改变了其地址或端口，该实例会向Nacos发送更新信息。Nacos注册中心会更新其记录，确保其他服务能够获取到最新的访问信息。</p> 
<h3><a id="4Nacos_71"></a>4.Nacos优点</h3> 
<p><strong>1.简单易用：</strong> 例如，一个小型创业团队正在开发一个电子商务应用。他们选择使用Nacos，因为它提供了简单直观的界面来管理服务注册和配置。即便是没有丰富微服务经验的开发者，也能轻松上手，快速部署和管理他们的服务。<br> <strong>2.特性丰富：</strong> 假设有一个企业正在进行数字化转型，他们需要管理多种语言编写的微服务（如Java、Python、Node.js）。Nacos提供了服务发现、动态配置管理、服务健康检查等多种特性，可以跨语言和环境支持这些微服务的运行和协作。<br> <strong>3.超高性能：</strong> 想象一个大型在线零售商在双11大促销期间，面临巨大的访问量。Nacos能够快速处理成千上万个服务实例的注册和发现请求，确保整个微服务架构的高效运行，没有性能瓶颈。<br> <strong>4.超大容量：</strong> 对于一个全球性的金融服务公司来说，他们可能在全球部署了数以千计的微服务实例。Nacos可以轻松管理如此大规模的服务实例，不会因为服务数量的增加而影响其性能和稳定性。<br> <strong>5.高可用：</strong> 在一个在线视频流服务平台，稳定性是关键。Nacos提供了高可用的配置，即使在部分服务节点发生故障的情况下，也能保证服务注册和配置的持续可用，确保用户体验不受影响。</p> 
<h3><a id="5Nacos_78"></a>5.Nacos使用场景举例</h3> 
<p><strong>例子背景</strong><br> 假设我们有一个在线购物平台，该平台包括商品服务、订单服务、用户服务等微服务。随着业务的增长和技术的演进，这些服务可能需要频繁地进行扩展、更新或迁移。<br> <strong>使用Nacos的场景</strong></p> 
<p><strong>1.服务发现和注册</strong><br> 场景描述：在微服务架构中，服务实例经常动态变化（如因扩展、更新或故障恢复）。例如，如果订单服务需要调用商品服务，它需要知道商品服务的当前可用实例和它们的网络位置。<br> Nacos的作用：商品服务的所有实例在启动时向Nacos注册自己的信息（如IP地址和端口）。订单服务通过查询Nacos获取商品服务的实时实例列表，从而知道该向哪个实例发送请求。<br> <strong>2. 动态配置管理</strong><br> 场景简化：假设在线购物平台的商品服务需要根据特定节日或促销活动调整其显示的商品类型或数量。这种调整通常涉及更改服务的配置，例如修改推荐商品的数量或类型。<br> 如何使用Nacos：<br> 在没有Nacos的情况下，每次更改配置可能需要重新启动服务，这会导致服务中断。<br> 使用Nacos后，可以将这些配置存储在Nacos的配置中心。<br> 当配置需要更改时，只需在Nacos中更新配置，Nacos会自动通知商品服务。<br> 商品服务接收到更新通知后，动态读取新的配置，而无需重启服务。<br> 这样可以实现无缝地调整服务行为，响应业务需求的变化。<br> <strong>3. 服务健康监控</strong><br> 场景描述：确保所有微服务正常运行是至关重要的。如果用户服务出现故障，可能会影响整个购物体验。<br> Nacos的作用：Nacos提供服务健康检查，可以监控服务是否运行正常。如果检测到服务实例不健康，Nacos将从服务列表中剔除该实例，保证请求不会被路由到故障的实例上。<br> <strong>4.流量管理和路由</strong><br> 假设你有一个网上商店，在大促销日（比如“双十一”）那天，你的网站会有很多访客。这时候，你需要确保网站运行流畅，让每个人都能快速浏览和购买商品。</p> 
<p>使用Nacos的流量管理和路由，可以这样操作：<br> (1).准备多个服务器：你有好几台服务器来支持网站。有些是旧服务器，运行稳定；有些是新服务器，上面有最新的功能。<br> (2).分配访客：在大促销日，你想要让更多的访客去使用那些新服务器，因为新服务器更快更强大。<br> (3).Nacos的作用：<br> 智能分流：Nacos可以自动帮你把访客分配到不同的服务器。比如，它可以让来自北京的访客使用一个服务器，上海的访客使用另一个服务器。<br> 灰度测试：如果你想试试新功能，又不想让所有人都立刻用上这个功能，Nacos可以只让一部分人（比如10%的访客）使用有新功能的服务器。<br> 结果：这样一来，你的网站既可以应对大量访客，又可以平稳地测试和推出新功能，而不会影响所有人的使用体验。<br> 简单来说:Nacos就像是一个聪明的交通指挥官，它可以根据你的需求，把网站的访客智能地分配到不同的服务器，确保网站运行顺畅，同时也能在需要时试验新功能。</p> 
<h3><a id="6Nacos_109"></a>6.Nacos基本使用</h3> 
<h4><a id="61_110"></a>6.1部署方式</h4> 
<p>Nacos有以下三种部署方式：<br> 1.单机模式：将注册中心、配置中心等功能集成在一个进程内，全部部署在一台及其上，适用于测试和单机试用<br> 2.集群模式：多个Nacos服务器实例组成一个集群。这些实例通过相互通信和协调工作，共同提供服务注册、配置管理和服务发现等功能。在集群模式下，所有的实例共享相同的数据，数据变更会自动同步到所有的实例中，客户端可以随机选择任意一个实例进行注册和发现服务。<br> 3.多集群模式：多集群模式是为了在满足不同区域或者网络中进行部署或者扩展的需求。在多集群模式中，可以选择不同的nacos实例组成多个相互独立的集群，每个集群可以拥有自己独立的配置和注册中心，并且可以跨集群进行服务注册和发现。多集群模式适用于分布式系统的多区域部署，并可以使用不同的网络和存储设施。每个集群具有独立的数据和配置，但是可以通过自定义的同步机制在集群之间共享数据。<br> 多集群的作用：<br> 不同机房的部署：将Nacos集群分布在不同的机房，实现异地多活，提高服务的可用性。当单个机房不可用的时候，通过域名解析可以快速切换到另一个机房<br> 不同运营商的部署：跨运营商部署Nacos集群，避免单一运营商网络问题导致服务中断</p> 
<p><strong>上面的集群模式和但集群模式你可能模糊不清，下面我还是用人话来解释</strong><br> <strong>Nacos集群部署模式：</strong><br> 场景：想象一个在线教育平台，他们的服务需求随着用户数量的增长而增长，需要保证服务的高可用性和负载均衡。<br> 部署方式：在这种情况下，他们可能会在一个数据中心内部署一个Nacos集群。这个集群包括多个Nacos服务器节点，这些节点之间相互协作，以确保服务注册和配置信息的高可用性。<br> 优势：如果其中一个节点发生故障，其它节点能够接管工作，保证服务的连续性。此外，集群模式还可以平衡负载，提高处理请求的能力。</p> 
<p><strong>Nacos多集群部署模式：</strong><br> 场景：假设有一家全球运营的电商企业，他们在多个地理位置（例如北美、欧洲和亚洲）有运营中心。<br> 部署方式：为了更好地服务于全球用户并保证服务的高可用性，他们可能在每个主要的地理位置部署一个Nacos集群。这些集群彼此独立，但通过网络相互连接，形成一个多集群部署。<br> 优势：这种部署方式<strong>使得每个地区的用户都能快速访问到最近的服务实例</strong>，降低了延迟，并且在一个地区的集群出现问题时，不会影响到其它地区的服务。</p> 
<p>在这两种部署模式中，集群部署模式主要用于提高单个数据中心的可用性和负载能力，而多集群部署模式更适用于跨地域的全球服务需求，旨在提高跨地域的服务可用性和用户体验。</p> 
<h4><a id="62_132"></a>6.2安装并启动</h4> 
<p>1.预备环境准备：<br> Nacos安装和运行需要依赖JDK环境，因此在安装之前，需要先在电脑安装JDK1.8+的环境<br> 2.安装并启动<br> Nacos有两种安装方式<br> 1).源码安装<br> 2).编译压缩包安装<br> PS：推荐使用编译压缩包安装，操作更简单，出现问题的概率更小<br> 下面我只说编译压缩包安装流程<br> 第一步：你先下载压缩包：<a href="https://github.com/alibaba/nacos/releases">点击这里下载最新的版本</a><br> 第二步：把它解压，这步太简单了，不教了<br> 第三步：打开你电脑的终端，进入你的nacos的bin目录<br> <img src="https://images2.imgbox.com/d2/a2/50j4FqTm_o.png" alt="在这里插入图片描述"><br> 第四步：启动Nacos服务<br> Linus/MacOS输入命令：<strong>sh startup.sh -m standalone</strong> 启动<br> Windows:<strong>startup.cmd -m standalone</strong> 启动<br> 下图就是启动成功了<br> <img src="https://images2.imgbox.com/f1/e5/ZYgbjFj8_o.png" alt="在这里插入图片描述"><br> 然后你就找下图这个链接，把它复制<br> <img src="https://images2.imgbox.com/48/f9/5RQb6qXQ_o.png" alt="在这里插入图片描述"><br> <strong>但是注意来了，你先在你的浏览器上粘贴上述链接，但是先别进去呢，你还得改呢，改成<br> localhost:8848/nacos/index.html</strong>再进去<br> <img src="https://images2.imgbox.com/e5/01/LRVSynPm_o.png" alt="在这里插入图片描述"><br> 第五步：配置数据源<br> Nacos单机模式默认使用的是内置的嵌入式数据库Derby，但是它不适合承载生产环境大规模部署，因为它有以下限制：<br> 1.数据存储容量最大只有2GB<br> 2.不支持集群模式下数据的高可用性<br> 3.性能和并发能力有限<br> 因此在使用单机模式的Nacos的时候，可以把数据库换了，比如我使用的就是mysql，下面我说一下切换mysql的步骤<br> 1.安装mysql数据库，版本需要5.6.5+<br> 2.下载完了之后在你的mysql直接复制下面代码</p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">DATABASE</span> <span class="token keyword">if</span> <span class="token keyword">EXISTS</span> nacos<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> nacos <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">;</span>
<span class="token keyword">use</span> nacos<span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = config_info                  */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>config_info<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">longtext</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'content'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>md5<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'md5'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_user<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'source user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_ip<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>app_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>c_desc<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'configuration description'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>c_use<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'configuration usage'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>effect<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'配置生效的描述'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">type</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'配置的类型'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>c_schema<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'配置的模式'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>encrypted_data_key<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密钥'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_configinfo_datagrouptenant<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>data_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'config_info'</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = config_info_aggr             */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>config_info_aggr<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>datum_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'datum_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">longtext</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'内容'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>app_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_configinfoaggr_datagrouptenantdatum<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>data_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>datum_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'增加租户字段'</span><span class="token punctuation">;</span>


<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = config_info_beta             */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>config_info_beta<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>app_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">longtext</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'content'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>beta_ips<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'betaIps'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>md5<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'md5'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_user<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'source user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_ip<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>encrypted_data_key<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密钥'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_configinfobeta_datagrouptenant<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>data_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'config_info_beta'</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = config_info_tag              */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>config_info_tag<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tag_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'tag_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>app_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">longtext</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'content'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>md5<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'md5'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_user<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'source user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_ip<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_configinfotag_datagrouptenanttag<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>data_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tag_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'config_info_tag'</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = config_tags_relation         */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>config_tags_relation<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tag_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'tag_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tag_type<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'tag_type'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>nid<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'nid, 自增长标识'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>nid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_configtagrelation_configidtag<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tag_name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tag_type<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_tenant_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'config_tag_relation'</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = group_capacity               */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>group_capacity<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'Group ID，空字符表示整个集群'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>quota<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'配额，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">usage</span><span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'使用量'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_size<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_aggr_count<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'聚合子配置最大个数，，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_aggr_size<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_history_count<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'最大变更历史数量'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_group_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'集群、各Group容量信息表'</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = his_config_info              */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>his_config_info<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>nid<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'nid, 自增标识'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>data_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>group_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>app_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">longtext</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'content'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>md5<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'md5'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_user<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'source user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>src_ip<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>op_type<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'operation type'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>encrypted_data_key<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密钥'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>nid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_gmt_create<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_gmt_modified<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_did<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>data_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'多租户改造'</span><span class="token punctuation">;</span>


<span class="token comment">/******************************************/</span>
<span class="token comment">/*   表名称 = tenant_capacity              */</span>
<span class="token comment">/******************************************/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tenant_capacity<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'Tenant ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>quota<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'配额，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">usage</span><span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'使用量'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_size<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_aggr_count<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'聚合子配置最大个数'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_aggr_size<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>max_history_count<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'最大变更历史数量'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_tenant_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'租户容量信息表'</span><span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tenant_info<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>kp<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'kp'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'tenant_name'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tenant_desc<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'tenant_desc'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_source<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'create_source'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uk_tenant_info_kptenantid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>kp<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_tenant_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'tenant_info'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span>
	<span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">'username'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>enabled<span class="token punctuation">`</span> <span class="token keyword">boolean</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'enabled'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>roles<span class="token punctuation">`</span> <span class="token punctuation">(</span>
	<span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'username'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>role<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'role'</span><span class="token punctuation">,</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>idx_user_role<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">ASC</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>role<span class="token punctuation">`</span> <span class="token keyword">ASC</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>permissions<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>role<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'role'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>resource<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'resource'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span><span class="token keyword">action</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'action'</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>uk_role_permission<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>role<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>resource<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span><span class="token keyword">action</span><span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> enabled<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> roles <span class="token punctuation">(</span>username<span class="token punctuation">,</span> role<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'ROLE_ADMIN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>3.修改Nacos安装目录下的conf文件下的application.properties文件（你可以安装一个VSCode，用它打开，反正我是这么打开的），增加如下代码</p> 
<pre><code class="prism language-javascript">spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>platform<span class="token operator">=</span>mysql
db<span class="token punctuation">.</span>num<span class="token operator">=</span><span class="token number">1</span>
db<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>nacos<span class="token operator">?</span>characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span>connectTimeout<span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span>socketTimeout<span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span>autoReconnect<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>useUnicode<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>useSSL<span class="token operator">=</span><span class="token boolean">false</span><span class="token operator">&amp;</span>serverTimezone<span class="token operator">=</span><span class="token constant">UTC</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">=</span>root
db<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">021018</span>
</code></pre> 
<p>这个password是你自己的mysql设置的密码，没有就不写<br> 第六步：<br> 开启登录权限，也就是上面我让你往下看的那个图<br> 还是在Nacos安装目录下的conf文件下的application.properties里面加如下代码</p> 
<pre><code class="prism language-javascript">nacos<span class="token punctuation">.</span>core<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>enabled<span class="token operator">=</span><span class="token boolean">true</span>
nacos<span class="token punctuation">.</span>core<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>token<span class="token punctuation">.</span>secret<span class="token punctuation">.</span>key<span class="token operator">=</span>SecretKey012345678901234567890123456789012345678901234567890123456789
nacos<span class="token punctuation">.</span>core<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>server<span class="token punctuation">.</span>identity<span class="token punctuation">.</span>key<span class="token operator">=</span>nacos
nacos<span class="token punctuation">.</span>core<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>server<span class="token punctuation">.</span>identity<span class="token punctuation">.</span>value<span class="token operator">=</span>nacos
</code></pre> 
<p><strong>有注意事项了：<br> 第五步和第六步加代码的时候，你可以用vscode的搜索功能看看有没有代码，比如人家原始的代码可能把需要加的注释掉了，你只需要去掉注释就行了，或者人家原始代码最后是false，你只需要变成true就行了</strong></p> 
<h3><a id="7_390"></a>7.注意</h3> 
<p>Nacos安装注意事项：<br> 1.不要将Nacos安装在C盘下<br> 2安装包不能出现在中文路径下！！！</p> 
<p>Nacos启动注意事项：<br> 1.本地权限<br> 2.JDK的版本<br> 3.口令输入的是否正确</p> 
<p>部署问题：此处我的安装部署只是第一种单机部署</p> 
<h3><a id="8_402"></a>8.配置中心的使用</h3> 
<p>1.创建配置信息</p> 
<p><img src="https://images2.imgbox.com/96/05/7ALWR9DA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/01/bc/U6ox6TeU_o.png" alt="在这里插入图片描述"><br> <strong>命名空间</strong>：Nacos的命名空间（Namespace）是一种逻辑上的隔离机制，它用于将不同的服务实例或配置分隔开来。每个命名空间都有一个独特的ID，可以包含一组服务或配置。<br> 假设一个公司有开发（Dev）、测试（Test）和生产（Prod）三个环境。他们可以在 Nacos 中为每个环境创建一个单独的命名空间：<br> Dev Namespace: 用于开发环境，开发人员可以在这里自由地测试和修改配置，而不会影响到其他环境。<br> Test Namespace: 用于测试环境，测试团队可以在这个环境中进行各种测试，确保应用的稳定性。<br> Prod Namespace: 生产环境的命名空间，这里的配置必须是经过严格测试和验证的，以确保应用的稳定运行。<br> 通过这种方式，公司可以确保不同环境的配置互不干扰，同时保持各个环境的配置同步和一致性。<br> <strong>Data ID</strong>:配置的唯一标识，用于查找配置文件<br> <strong>Group</strong>:在特定命名空间内，用于细分和组织配置。它是在命名空间内的进一步细化，通常用于区分不同应用或服务的配置。</p> 
<p>命名空间和Group区别</p> 
<p>Nacos 配置中心中的命名空间（Namespace）和分组（Group）是两个用于隔离和组织配置的概念，但它们的作用范围和用途有所不同。让我通过例子来解释这两者的区别：</p> 
<p>命名空间（Namespace）<br> 命名空间通常用于隔离不同的环境或租户。每个命名空间都有一个唯一的 ID，并且在不同的命名空间中可以有相同的分组和 Data ID。</p> 
<p>例子：<br> 开发环境 Namespace：用于开发环境的配置管理。<br> 测试环境 Namespace：用于测试环境的配置管理。<br> 生产环境 Namespace：用于生产环境的配置管理。<br> 在这个例子中，三个环境的配置是隔离的，开发环境的改动不会影响到测试或生产环境。</p> 
<p>分组（Group）<br> 分组是命名空间内的一个进一步划分，用于组织相关的配置项。同一个命名空间中的不同分组可以包含具有相同 Data ID 的配置。</p> 
<p>例子：<br> 假设在开发环境 Namespace中，有两个应用程序：App1 和 App2。我们可以为它们创建不同的分组：</p> 
<p>App1 Group：包含 App1 的所有配置。<br> App2 Group：包含 App2 的所有配置。<br> 这样，尽管两个应用程序在同一个命名空间中，但它们的配置被组织在不同的分组中，便于管理。</p> 
<p>区别总结：<br> 命名空间：用于隔离不同的环境、租户或者大范围的项目。它是更高层级的隔离，通常用于环境隔离。<br> 分组：在特定命名空间内，用于细分和组织配置。它是在命名空间内的进一步细化，通常用于区分不同应用或服务的配置。<br> 通过这样的设置，Nacos 能够提供灵活且强大的配置管理，适应不同规模和复杂度的应用场景。</p> 
<p>2.创建SpringBoot项目<br> <img src="https://images2.imgbox.com/12/75/feyHfG4u_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f3/80/AFcelPsG_o.png" alt="在这里插入图片描述"><br> 然后添加下面两个框架<br> <img src="https://images2.imgbox.com/3c/26/ZEfkCzXr_o.png" alt="在这里插入图片描述"><br> 进去之后删除下面两个（不删也行，因为没用，我怕我乱套，所以删了）<br> <img src="https://images2.imgbox.com/9e/b9/epIohUyL_o.png" alt="在这里插入图片描述"><br> 3.配置nacos<br> 点开下图的文件，在这里配置<br> <img src="https://images2.imgbox.com/55/c5/hO7PnCtl_o.png" alt="在这里插入图片描述"><br> 你点开之后可能出现一堆你看不懂的乱码，你需要修改编码方式，看下面俩张图就能不乱码了<br> <img src="https://images2.imgbox.com/43/34/za1CofsZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0b/93/witSfyUu_o.png" alt="在这里插入图片描述"><br> 然后就可以配置了，<strong>仔细看我的配置跟你的原始配置有啥不同</strong>！！！</p> 
<pre><code class="prism language-javascript"># 应用服务 <span class="token constant">WEB</span> 访问端口
server<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">8080</span>
# Nacos帮助文档<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nacos<span class="token punctuation">.</span>io<span class="token operator">/</span>zh<span class="token operator">-</span>cn<span class="token operator">/</span>docs<span class="token operator">/</span>concepts<span class="token punctuation">.</span>html
# Nacos认证信息
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>username<span class="token operator">=</span>nacos
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>password<span class="token operator">=</span>nacos
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>contextPath<span class="token operator">=</span><span class="token operator">/</span>nacos
# 设置配置中心服务端地址
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>server<span class="token operator">-</span>addr<span class="token operator">=</span>localhost<span class="token operator">:</span><span class="token number">8848</span>
# Nacos 配置中心的namespace。需要注意，如果使用 <span class="token keyword">public</span> 的 namcespace ，请不要填写这个值，直接留空即可
# spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>namespace<span class="token operator">=</span>
# spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>group<span class="token operator">=</span>
# 注意，下面一行的代码中的  nacos<span class="token operator">:</span>  的后面的玩意一定要和你的配  置中心的Data <span class="token constant">ID</span>一样
spring<span class="token punctuation">.</span>config<span class="token punctuation">.</span>import<span class="token operator">=</span>nacos<span class="token operator">:</span>nacos<span class="token operator">-</span>config<span class="token operator">-</span>example
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>file<span class="token operator">-</span>extension<span class="token operator">=</span>properties
</code></pre> 
<p>最后一步，创建个java文件，可以开始写代码了<br> 这个文件的位置如图，仔细看，位置错了运行不起来的<br> <img src="https://images2.imgbox.com/6d/d0/L6XC3e4J_o.png" alt="在这里插入图片描述"><br> 下面是我的代码</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RefreshScope</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RefreshScope</span><span class="token comment">//这个注解是当你的配置中心的配置修改的时候，你通过url在浏览器访问了之后，可以获取到你修改之后的配置，也就是刷新你的配置</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//@Value用于将 myconfig 配置项的值注入到 myConfig 字段中。</span>
    <span class="token comment">// 这个值通常是从外部配置源（如properties文件、YAML文件或者Spring Cloud Config Server）加载的。</span>
    <span class="token comment">//也就是说这个注解从properties配置文件知道了我用的nacos,然后去nacos的配置中找到了myconfig这个字段</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${myconfig}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> myConfig<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/myconfig"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> myConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我的配置中心如下图，仔细看我的myconfig和上述代码中的@Value(“${myconfig}”)是对应的<br> <img src="https://images2.imgbox.com/7a/93/87Jk7TJv_o.png" alt="在这里插入图片描述"><br> 访问浏览器如下图<br> <img src="https://images2.imgbox.com/ce/f8/Rq0JrJ0i_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="9_507"></a>9.注册中心的使用</h3> 
<h4><a id="91_508"></a>9.1注册中心的流程</h4> 
<p>注册中心通常有两个角色：<br> 1.服务提供者（生产者）：对外提供服务的微服务应用。它会把自身的服务地址注册到注册中心，以供消费者发现和调用<br> 2.服务调用者（消费者）：调用其他微服务的应用程序。它会向注册中心订阅自己需要的服务，并基于服务提供者注册的信息发起远程调用。<br> 流程：<br> 1.首先，比如有三个生产者（内容都一样比如都是“西瓜”），他们仨都把自己的服务注册到了注册中心<br> 2.这时候注册中心就有一张表，这张表就是注册到注册中心的生产者<br> 3.这时候来了消费者吃“西瓜了”，于是就从注册中心的那个列表看了一下可用的生产者（西瓜）<br> 4.然后发现三个西瓜都一样，这时候就通过负载均衡器给这个消费者分配一个西瓜<br> <strong>（为什么用负载均衡器呢？你这么想，一个西瓜只能让10个人吃，A西瓜已经有10个人了，再让这个消费者去吃就11个人了，这时候负载均衡器看看B和C西瓜有几个人吃，假如C有8个，B有6个，就让这个消费者去吃B西瓜）</strong></p> 
<h4><a id="92_519"></a>9.2多模块项目</h4> 
<p>注册中心是要实现生产者和消费者的，于是你就需要有多模块项目了，生产者是一个模块，消费者是一个模块，下图为步骤<br> <img src="https://images2.imgbox.com/28/35/8CF0UBy6_o.png" alt="在这里插入图片描述"><br> 然后添加下图四个框架<br> <img src="https://images2.imgbox.com/f4/bd/EtzbNF2q_o.png" alt="在这里插入图片描述"><br> 进去之后，删除到剩我这样<br> <img src="https://images2.imgbox.com/2d/a8/kAVKlNo0_o.png" alt="在这里插入图片描述"><br> 然后打开pom.xml,红色框框这两行跟我一样<br> <img src="https://images2.imgbox.com/56/21/VF1WYDdR_o.png" alt="在这里插入图片描述"><br> 然后下面红框框几行删了<br> <img src="https://images2.imgbox.com/09/f1/kEVs64Df_o.png" alt="在这里插入图片描述"><br> 然后加上下面这行，意思是把当前标记为父模块<br> <img src="https://images2.imgbox.com/a9/14/y12ABov7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="93_532"></a>9.3生产者实现</h4> 
<p>现在来建生产者为上述的子模块<br> <img src="https://images2.imgbox.com/53/93/96HQC5nZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4f/e4/zJVOiGiT_o.png" alt="在这里插入图片描述"><br> 然后直接点cerete,因为父模块把需要添加的框架都添加了，所以子模块只需要继承就行了，啥也不需要添加<br> <img src="https://images2.imgbox.com/9c/f8/WFDAgeog_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/3f/OmtvCULC_o.png" alt="在这里插入图片描述"><br> 然后打开pom.xml，把红色框的内容删了，因为父模块已经有了，而且更全，子模块再有可能会出错，保守起见还是删了最好<br> <img src="https://images2.imgbox.com/da/fe/h7y5Yeei_o.png" alt="在这里插入图片描述"><br> 下面也删<br> <img src="https://images2.imgbox.com/c1/3f/SJIRPki3_o.png" alt="在这里插入图片描述"><br> 下面还删<br> <img src="https://images2.imgbox.com/5e/37/6vlgjaGa_o.png" alt="在这里插入图片描述"></p> 
<p>然后加上下面这段，告诉这个模块谁是它爹<br> <img src="https://images2.imgbox.com/dd/e8/dlnwJMeT_o.png" alt="在这里插入图片描述"><br> 然后打开你的父模块的pom.xml，加上下面这段，告诉这个父亲，它的儿子是谁<br> <img src="https://images2.imgbox.com/36/86/VYyoM3Iw_o.png" alt="在这里插入图片描述"></p> 
<p>然后点下面这个<br> <img src="https://images2.imgbox.com/c5/d1/f0KAzKkb_o.png" alt="在这里插入图片描述"><br> 然后<br> <img src="https://images2.imgbox.com/1a/28/dWWOffme_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/60/26/rmWIRO2m_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/46/c0/3Rm8S4fW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a6/04/UxagsXeO_o.png" alt="在这里插入图片描述"><br> 然后在这个配置文件复制下列代码</p> 
<pre><code class="prism language-java">spring<span class="token operator">:</span>
  application<span class="token operator">:</span>
    name<span class="token operator">:</span> nacos<span class="token operator">-</span>discovery<span class="token operator">-</span>demo #<span class="token class-name">Nacos</span>注册的服务名（很重要，命名不要使用下划线）
  cloud<span class="token operator">:</span>
    nacos<span class="token operator">:</span>
      discovery<span class="token operator">:</span>
        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span>
        username<span class="token operator">:</span> nacos
        password<span class="token operator">:</span> nacos
        ephemeral<span class="token operator">:</span> <span class="token boolean">true</span> # <span class="token boolean">false</span>是设置此服务为永久实例
server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">0</span> #动态端口号  因为微服务的时候端口号会放到注册中心，而不是给用户，消费者用端口号的时候由注册中心分配
</code></pre> 
<p>然你就直接启动这个项目，然后你打开你的nacos,你就会发现下图那样<br> <img src="https://images2.imgbox.com/1c/f4/DMZ1SQJV_o.png" alt="在这里插入图片描述"><br> 你点开详情之后就看到了这个服务的ip地址和端口号<br> <img src="https://images2.imgbox.com/93/bf/w8ezh31V_o.png" alt="在这里插入图片描述"></p> 
<p>接下来我的代码如下<br> <img src="https://images2.imgbox.com/4c/25/TMKjPZIi_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"getnamebyid"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"producerName+"</span><span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后你运行项目之后，登录这个url地址就可以访问了<br> <img src="https://images2.imgbox.com/68/b8/mjzjtnA8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="94_598"></a>9.4消费者实现</h4> 
<p>1.先添加框架：Nacos Discovery 、Spring Cloud LoadBalancer、Spring Cloud OpenFeign<br> 框架也是父节点就有了，别忘了在consumer的pom.xml里面声明父亲，在父亲的pom.xml声明这个儿子，其他步骤都跟上面一样<br> 2.配置Nacos<br> 在consumer的application.yml文件复制下列代码</p> 
<pre><code class="prism language-java">spring<span class="token operator">:</span>
  application<span class="token operator">:</span>
    name<span class="token operator">:</span> nacos<span class="token operator">-</span>consumer<span class="token operator">-</span>demo
  cloud<span class="token operator">:</span>
    nacos<span class="token operator">:</span>
      discovery<span class="token operator">:</span>
        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span>
        username<span class="token operator">:</span> nacos
        password<span class="token operator">:</span> nacos
        register<span class="token operator">-</span>enabled<span class="token operator">:</span> <span class="token boolean">false</span> # 消费者（不需要将此服务注册到nacos）
server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">8080</span>
</code></pre> 
<p>3.开启OpenFeign功能<br> 在你的consumer的启动类加下面注解<br> <img src="https://images2.imgbox.com/23/e4/NsEoHuus_o.png" alt="在这里插入图片描述"></p> 
<p>4.编写OpenFeign调用代码<br> 看好了，是个接口<br> <img src="https://images2.imgbox.com/33/3f/ny92CLSk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"nacos-discovery-demo"</span><span class="token punctuation">)</span><span class="token comment">//表示调用nacos的nacos-discovery-demo服务</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TestService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//这个路径一定要等于producer的启动类的那个路径之和，含义是调用生产者的/user/getnamebyid接口</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user/getnamebyid"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>5.编写代码通过OpenFeign调用生产者</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">TestService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TestService</span> testService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/getnamebyid"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> testService<span class="token punctuation">.</span><span class="token function">getNameById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>逻辑如下<br> 1.客户端向TestController的/getnamebyid发送HTTP请求，并带上参数id。<br> 2.TestController接收到请求后，调用testService.getNameById(id)方法。<br> 3.TestService是一个Feign客户端，它将请求转发到nacos-discovery-demo服务的/user/getnamebyid路径，并且通过@RequestParam(“id”)注解把id传给producer的</p> 
<pre><code class="prism language-java"> <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"啊啊啊啊啊producerName+"</span><span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这个方法。<br> 4.nacos-discovery-demo服务处理请求并返回结果。<br> 5.TestController接收到结果，并将结果返回给客户端。<br> 最后在浏览器的显示如下<br> <img src="https://images2.imgbox.com/1e/08/PoANlNp9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="95_675"></a>9.5注册中心参数说明</h4> 
<p><img src="https://images2.imgbox.com/1d/10/scwXPqNe_o.png" alt="在这里插入图片描述"></p> 
<p>分组（Group）:<br> 分组是将服务进行逻辑上的分类，类似于文件夹。比如，你可以有多个环境的服务，如开发环境、测试环境和生产环境，你可以为每个环境设置一个分组，使得同一个服务在不同的环境中不会相互干扰。<br> 例子：假设你有一个用户服务，在开发环境中注册为"DEV-GROUP"分组，在生产环境中注册为"PROD-GROUP"分组。</p> 
<p>保护阈值（Protect Threshold）:<br> 保护阈值是一个用于服务保护的阈值。当一个服务的健康实例数量低于这个阈值时，Nacos会将这个服务标记为保护状态，这时候即使服务实例非常少，也不会全部下线，保证了服务的可用性。<br> 例子：如果一个服务设置了保护阈值为0.6，那么在服务实例总数的60%是健康的情况下，服务就不会全部下线。</p> 
<p>服务路由类型（Service Routing Type）:<br> 服务路由是决定服务请求调用哪个实例的规则。比如，可以根据版本号、区域或其他元数据来路由请求。<br> 例子：如果你有一个服务有A、B两个版本，你可以设置路由规则，使得来自某些特定用户的请求只会路由到A版本。</p> 
<p>临时实例（Ephemeral Instance）:<br> 临时实例是指那些不需要持久存储的服务实例，通常在服务提供者关闭时会自动注销。这对于服务的弹性伸缩非常有用。<br> 例子：当你使用容器服务时，容器启动时会注册为临时实例，容器停止时实例会自动注销。</p> 
<p>权重（Weight）:<br> 权重是用于服务调用时负载均衡策略的一个参数。实例的权重越高，它被调用的概率就越大。<br> 例子：如果服务A的实例有两个，实例1的权重为1.0，实例2的权重为3.0，那么在负载均衡时，实例2接收到的请求是实例1的三倍。</p> 
<h3><a id="10Nacos_697"></a>10.Nacos底层原理</h3> 
<h4><a id="101Nacos_698"></a>10.1Nacos底层执行流程</h4> 
<p>1.服务提供者启动后，将自己的信息注册到 Nacos Server 的命名服务中。<br> 2.服务消费者需要调用服务时，会向 Nacos Server 的命名服务查询服务提供者的信息。<br> 3.Nacos Server 返回服务提供者的信息，服务消费者据此连接服务提供者。<br> 4.同时，服务消费者和提供者都可能需要从 Nacos Server 的配置服务中获取或更新配置信息。<br> 5.管理员或用户可以通过 Nacos Console 进行服务和配置的管理操作。</p> 
<h4><a id="102_704"></a>10.2配置中心自动刷新原理</h4> 
<p>Nacos配置中心是支持配置项自动刷新的（<strong>也就是代码中的@RefreshScope注解</strong>），原理通过长轮询+事件驱动的方式来实现的，具体来说：</p> 
<p><strong>长轮询（Long Polling）</strong><br> 长轮询是一种客户端和服务器之间通信的技术，其中客户端发起一个请求到服务器，然后服务器保持连接打开直到有更新可发送。这避免了客户端需要不断重新发送请求来检查更新。<br> 在Nacos的上下文中，长轮询可以这样理解：<br> 1.客户端（例如Spring Cloud应用）向Nacos服务器发送一个请求，询问某个配置是否有更新。<br> 2.Nacos服务器不会立即响应，而是等待直到有更新发生或超时。<br> 3.如果配置更新了，Nacos服务器将新的配置数据发送回客户端，然后客户端处理这些数据（例如，刷新@RefreshScope标记的beans）。<br> 4.客户端处理完毕后，会再次发起请求，开始下一个长轮询周期。</p> 
<p><strong>事件驱动（Event-Driven）</strong><br> 事件驱动是一种编程范式，在这种模式中，系统的流程是由事件控制的。这些事件可以是用户行为，也可以是系统内部的更新通知。<br> 在配置自动刷新的情况下，事件驱动工作流程如下：<br> 1.当配置更新时，Nacos服务器将触发一个事件。<br> 2.客户端监听这些事件。一旦检测到配置更改事件，它将执行相应的操作（例如，刷新配置）。<br> 3.这种模式使得系统能够做出快速反应，因为一旦发生了更改，就会立即有通知，而不是等待下一个轮询周期。</p> 
<p>这两种机制都是为了减少不必要的通信，并确保配置更新可以快速而有效地传播到需要它们的服务。在实际应用中，Nacos客户端库通常抽象了这些细节，开发者只需要按照文档配置和编码即可享受自动配置刷新带来的便利。</p> 
<p>以下是合并了长轮询和事件驱动的Nacos配置中心的执行流程：</p> 
<p><strong>1.启动时加载配置</strong>：<br> 客户端应用启动时，通过Nacos客户端向Nacos服务器请求加载所需的配置信息。</p> 
<p><strong>2.建立长轮询连接：</strong><br> 客户端建立一个长轮询连接到Nacos服务器，询问配置是否有更新。<br> 这个连接请求通常会包含当前客户端所拥有的配置的版本信息。</p> 
<p><strong>3.服务器端配置更新检测：</strong><br> Nacos服务器接收到长轮询请求后，检查是否有配置更新。<br> 如果没有更新，服务器保持连接打开，并在一定时间内（比如30秒）等待。</p> 
<p><strong>4.更新事件触发：</strong><br> 如果在等待期间配置发生了变化，Nacos服务器就会立即将更新的配置信息推送给客户端。<br> 如果等待期间没有变化，连接超时后，服务器将返回一个响应告知客户端没有变化。</p> 
<p><strong>5.客户端处理更新：</strong><br> 客户端接收到更新后，会触发内部的事件，如Spring Cloud环境中的EnvironmentChangeEvent或者RefreshScope相关的事件。<br> 监听这些事件的组件将会根据新的配置进行自动刷新。</p> 
<p><strong>6.重启长轮询：</strong><br> 客户端处理完配置更新后，会再次发送长轮询请求到Nacos服务器，开始新的监听周期。</p> 
<p><strong>7.健康检查和状态同步：</strong><br> 在整个过程中，Nacos服务器会定期进行健康检查，以确保只有健康的实例参与服务。客户端也会定期同步自身状态到Nacos，以便于管理和监控。<br> 通过这种机制，Nacos能够实现几乎实时的配置更新分发，同时保持网络和服务器的高效性，避免频繁的轮询带来的性能问题。</p> 
<h4><a id="103_753"></a>10.3注册中心底层实现</h4> 
<p>Nacos注册中心的底层实现主要依赖于两个关键组件：服务注册和服务发现。<br> <strong>服务注册:</strong> 是指将服务实例的元数据(包括 IP 地址、端口号、服务名称等)注册到nacos 服务器上，以便其他服务能够发现和访问该服务。在服务启动时，它会向 Nacos 服务器发送一个注册请求，将自身的信息注册到特定的命名空间和分组中。<br> <strong>服务发现:</strong> 是指根据服务名称从 Nacos 服务器获取已注册的服务实例列表，并将其提供给需要调用该服务的服务消费者。消费者可以通过调用 Nacos 提供的API或集成Nacos 客户端库来获取服务实例列表<br> 具体来说，Nacos注册中心的实现包括以下几个步骤:</p> 
<ol><li><strong>服务注册:</strong> 当服务启动时，它会 Nacos 服务器发送一个注册请求，包含自己的元数据信息。Nacos 服务器接收到注册请求后，在内存中维护一个注册表，将服务实例的元数据保存起来，用于后续的服务发现。</li><li><strong>心跳机制:</strong> 注册成功后，服务实例会定期向 Nacos 服务器发送心跳请求，以表明自己的健康状态和可用性。这样Nacos 服务器可以监控各个服务实例的状态，并及时剔除不可用或下线的实例。</li><li><strong>服务发现:</strong> 当消费者需要访问某个服务时，它会向 Nacos 服务器发送一个服务发现请求，包含所需服务的名称。Nacos服务器根据服务名称查找注册表，并返回该服务的实例列表给消费者。</li><li>**负载均衡:**在服务发现的过程中，Nacos 还提供了负载均衡的支持。消费者可以洗择合适的负载均衡策略来选来选择其中一个或者多个服务实例进行调用。</li></ol> 
<h3><a id="11_762"></a>11.思考题</h3> 
<p><strong>1.长连接和长轮询的区别？</strong><br> <strong>长连接</strong>：客户端和服务器之间建立的是一个持久的TCP连接，这个连接会保持活动状态，直到一方显式地关闭它。长连接适合于消息必须尽快送达的实时通信场景。<br> <strong>长轮询</strong>：客户端发起一个到服务器的请求，但服务器会延迟响应，直到有数据可发送或者达到超时。长轮询保持HTTP连接在服务器有新的信息之前不会被关闭，但一旦完成数据传输，连接就会关闭，然后客户端会立即再次发起新的轮询请求。<br> <strong>2.为什么Nacos使用长轮询而不是长连接？</strong><br> Nacos使用长轮询而不是长连接的主要原因在于资源和消息管理的高效性。长连接意味着客户端和服务器之间建立持久的连接，这种连接会一直保持直到被显式关闭。虽然长连接可以实时传输数据，但在处理大量客户端时，会占用更多的服务器资源（如文件描述符、内存等）。长轮询是一种准长连接的方式，它通过不断重新发起请求来模拟持续的连接，从而减少了服务器持续保持连接的资源消耗。当需要向客户端推送更新时，服务器只需要在有更新时响应挂起的请求，这种方式适用于配置更新这种低频、高延迟容忍的场景。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/048dddc23e27b1184632038b324a7c95/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">rke2 Online Deploy Rancher latest （helm 在线部署 rancher）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d6bf756bececb9625e5f23f5e169636/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电脑和手机连接酒店的wifi，网络不通导致charles无法抓手机的包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>