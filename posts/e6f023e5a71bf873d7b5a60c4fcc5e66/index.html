<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android11安装应用触发桌面图标刷新流程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android11安装应用触发桌面图标刷新流程" />
<meta property="og:description" content="Android系统启动篇 1，《android系统启动流程简介》
2，《android init进程启动流程》
3，《android zygote进程启动流程》
4，《Android SystemServer进程启动流程》
5，《android launcher启动流程》
6，《Android Activity启动过程详解》
Android系统开发准备篇 1，《Android 源码下载和编译》
2，《android 11源码编译和pixel3 刷机》
3，《Android Framework代码IDE加载和调试》
Android系统开发实践篇 1，《android设置默认输入法》
2，《android framework预制APK应用》
3，《Android系统层面限制应用开机自启动详解》
4，《android单独编译framework模块并push》
5，《Android Framework开发系统问题分析》
Android系统开发核心知识储备篇 1，《Android编译系统-envsetup和lunch代码篇》
2，《Android编译系统-概念篇》
3，《android日志系统详解》
4，《Android系统Handler详解》
5，《Android系统Binder详解》
6，《Android中Activity、View和Window关系详解》
7，《android view绘制流程详解》
8，《Android读取系统属性详解》
9，《android 窗口管理机制详解》
10，《初识Android系统》
11，《android中AMS进程通知Zygote进程fork新进程的通信方式》
Android核心功能详解篇 1，《android应用市场点击下载APK安装详解》
2，《Android 手势导航（从下往上滑动进入多任务页面）》
3，《android手势分析（应用界面左往右边滑动退出应用）》
4，《android应用安装流程详解》
5，《android11安装应用触发桌面图标刷新流程》
6，《Android系统多任务Recents详解》
7，《android系统导航栏视图分析》
———————————————————————————————————————————
应用安装调用流程:
1, 注册监听 LauncherAppState.java
public LauncherAppState(Context context) { mInstallSessionTracker = InstallSessionHelper.INSTANCE.get(context) .registerInstallTracker(mModel, MODEL_EXECUTOR); } InstallSessionHelper.java
public InstallSessionTracker registerInstallTracker( InstallSessionTracker." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e6f023e5a71bf873d7b5a60c4fcc5e66/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T10:54:21+08:00" />
<meta property="article:modified_time" content="2023-06-14T10:54:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android11安装应用触发桌面图标刷新流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>  Android系统启动篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130699710?spm=1001.2014.3001.5502" title="1，《android系统启动流程简介》">1，《android系统启动流程简介》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130701425?spm=1001.2014.3001.5502" title="2，《android init进程启动流程》">2，《android init进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131052014?spm=1001.2014.3001.5502" title="3，《android zygote进程启动流程》">3，《android zygote进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130747522?spm=1001.2014.3001.5502" title="4，《Android SystemServer进程启动流程》">4，《Android SystemServer进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130759962?spm=1001.2014.3001.5502" title="5，《android launcher启动流程》">5，《android launcher启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131167564?spm=1001.2014.3001.5502" title="6，《Android Activity启动过程详解》">6，《Android Activity启动过程详解》</a></p> 
<h2>Android系统开发准备篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130446397?spm=1001.2014.3001.5502" title="1，《Android 源码下载和编译》">1，《Android 源码下载和编译》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447055?spm=1001.2014.3001.5502" title="2，《android 11源码编译和pixel3 刷机》">2，《android 11源码编译和pixel3 刷机》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130492532?spm=1001.2014.3001.5502" title="3，《Android Framework代码IDE加载和调试》">3，《Android Framework代码IDE加载和调试》</a></p> 
<h2>Android系统开发实践篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130481555?spm=1001.2014.3001.5502" title="1，《android设置默认输入法》">1，《android设置默认输入法》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447956?spm=1001.2014.3001.5502" title="2，《android framework预制APK应用》">2，《android framework预制APK应用》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447956?spm=1001.2014.3001.5502" title="3，《Android系统层面限制应用开机自启动详解》">3，《Android系统层面限制应用开机自启动详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130683203?spm=1001.2014.3001.5502" title="4，《android单独编译framework模块并push》">4，《android单独编译framework模块并push》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130592784?spm=1001.2014.3001.5502" title="5，《Android Framework开发系统问题分析》">5，《Android Framework开发系统问题分析》</a></p> 
<h2>Android系统开发核心知识储备篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130601545?spm=1001.2014.3001.5502" title="1，《Android编译系统-envsetup和lunch代码篇》">1，《Android编译系统-envsetup和lunch代码篇》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130601069?spm=1001.2014.3001.5502" title="2，《Android编译系统-概念篇》">2，《Android编译系统-概念篇》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130554120?spm=1001.2014.3001.5502" title="3，《android日志系统详解》">3，《android日志系统详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131150340?spm=1001.2014.3001.5502" title="4，《Android系统Handler详解》">4，《Android系统Handler详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131123375?spm=1001.2014.3001.5502" title="5，《Android系统Binder详解》">5，《Android系统Binder详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131109579?spm=1001.2014.3001.5502" title="6，《Android中Activity、View和Window关系详解》">6，《Android中Activity、View和Window关系详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131090905?spm=1001.2014.3001.5502" title="7，《android view绘制流程详解》">7，《android view绘制流程详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130964613?spm=1001.2014.3001.5502" title="8，《Android读取系统属性详解》">8，《Android读取系统属性详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130777822?spm=1001.2014.3001.5502" title="9，《android 窗口管理机制详解》">9，《android 窗口管理机制详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130686397?spm=1001.2014.3001.5502" title="10，《初识Android系统》">10，《初识Android系统》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131067430?spm=1001.2014.3001.5502" title="11，《android中AMS进程通知Zygote进程fork新进程的通信方式》">11，《android中AMS进程通知Zygote进程fork新进程的通信方式》</a></p> 
<h2>Android核心功能详解篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130770012?spm=1001.2014.3001.5502" title="1，《android应用市场点击下载APK安装详解》">1，《android应用市场点击下载APK安装详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130678948?spm=1001.2014.3001.5502" title="2，《Android 手势导航（从下往上滑动进入多任务页面）》">2，《Android 手势导航（从下往上滑动进入多任务页面）》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130678786?spm=1001.2014.3001.5502" title="3，《android手势分析（应用界面左往右边滑动退出应用）》">3，《android手势分析（应用界面左往右边滑动退出应用）》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130677276?spm=1001.2014.3001.5502" title="4，《android应用安装流程详解》">4，《android应用安装流程详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130654543?spm=1001.2014.3001.5502" title="5，《android11安装应用触发桌面图标刷新流程》">5，《android11安装应用触发桌面图标刷新流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130654543?spm=1001.2014.3001.5502" title="6，《Android系统多任务Recents详解》">6，《Android系统多任务Recents详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130644539?spm=1001.2014.3001.5502" title="7，《android系统导航栏视图分析》">7，《android系统导航栏视图分析》</a></p> 
<p>———————————————————————————————————————————</p> 
<p id="u9f192c51">应用安装调用流程:</p> 
<p id="ud7074254">1, 注册监听 LauncherAppState.java</p> 
<pre><code>public LauncherAppState(Context context) {

    mInstallSessionTracker = InstallSessionHelper.INSTANCE.get(context)

    .registerInstallTracker(mModel, MODEL_EXECUTOR);



}</code></pre> 
<p id="ua39adc1b"></p> 
<p id="u12b85ca5">InstallSessionHelper.java</p> 
<pre><code>public InstallSessionTracker registerInstallTracker(

InstallSessionTracker.Callback callback, LooperExecutor executor) {



//创建跟踪器

InstallSessionTracker tracker = new InstallSessionTracker(this, callback);



if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.Q) {

mInstaller.registerSessionCallback(tracker, executor.getHandler());

} else {

//注册应用安装回调，当系统安装应用时会回调注册的tracker

mLauncherApps.registerPackageInstallerSessionCallback(executor, tracker);

}

return tracker;

}</code></pre> 
<p id="u67829430"></p> 
<p id="u87c812fe">LauncherApps.java</p> 
<pre><code>public void registerPackageInstallerSessionCallback(

@NonNull @CallbackExecutor Executor executor, @NonNull SessionCallback callback) {

if (executor == null) {

throw new NullPointerException("Executor must not be null");

}



synchronized (mDelegates) {

final SessionCallbackDelegate delegate = new SessionCallbackDelegate(callback,

executor);

try {

mService.registerPackageInstallerCallback(mContext.getPackageName(),

delegate);

} catch (RemoteException e) {

throw e.rethrowFromSystemServer();

}

mDelegates.add(delegate);

}

}</code></pre> 
<p id="u2e401ca1"></p> 
<p id="u14dd3c9e">2，安装事件回调</p> 
<p id="uc35dd182">PackageInstaller.java</p> 
<p id="uf934fa27">PackageInstaller#SessionCallbackDelegate#onSessionProgressChanged</p> 
<p id="u62a4c5b7"></p> 
<pre><code>public void onSessionProgressChanged(int sessionId, float progress) {

mExecutor.execute(PooledLambda.obtainRunnable(SessionCallback::onProgressChanged,

mCallback, sessionId, progress).recycleOnUse());

}</code></pre> 
<p id="u0de4bc84"></p> 
<p id="u4bf0ea00"></p> 
<p id="ubd2eacf6"></p> 
<p id="u7f1d9c0f">InstallSessionTracker.java</p> 
<pre><code>public void onProgressChanged(int sessionId, float progress) {

SessionInfo session = mInstallerCompat.getVerifiedSessionInfo(sessionId);

if (session != null &amp;&amp; session.getAppPackageName() != null) {

mCallback.onPackageStateChanged(PackageInstallInfo.fromInstallingState(session));

}

}</code></pre> 
<p id="ud998f576"></p> 
<p id="u26ddd747"></p> 
<p id="ub0fc23c9">LauncherModel.java</p> 
<pre><code>public void onPackageStateChanged(PackageInstallInfo installInfo) {

enqueueModelUpdateTask(new PackageInstallStateChangedTask(installInfo));

}</code></pre> 
<p id="u93edb72a"></p> 
<p id="uf77e331d"></p> 
<p id="u21bec37b">BaseModelUpdateTask.java</p> 
<pre><code>//起新线程执行

public final void run() {

if (!mModel.isModelLoaded()) {

if (DEBUG_TASKS) {

Log.d(TAG, "Ignoring model task since loader is pending=" + this);

}

// Loader has not yet run.

return;

}

execute(mApp, mDataModel, mAllAppsList);

}</code></pre> 
<p id="u47aed884"></p> 
<p id="u84a93b92"></p> 
<p id="ub0d33986">PackageUpdatedTask.java</p> 
<pre><code>public void execute(LauncherAppState app, BgDataModel dataModel, AllAppsList appsList) {

//mAllAppsList新增同步修改数据

switch (mOp) {

case OP_ADD: {

for (int i = 0; i &lt; N; i++) {

if (DEBUG) Log.d(TAG, "mAllAppsList.addPackage " + packages[i]);

iconCache.updateIconsForPkg(packages[i], mUser);

if (FeatureFlags.PROMISE_APPS_IN_ALL_APPS.get()) {

appsList.removePackage(packages[i], mUser);

}

appsList.addPackage(context, packages[i], mUser);



// Automatically add homescreen icon for work profile apps for below O device.

if (!Utilities.ATLEAST_OREO &amp;&amp; !Process.myUserHandle().equals(mUser)) {

SessionCommitReceiver.queueAppIconAddition(context, packages[i], mUser);

}

}

flagOp = FlagOp.removeFlag(WorkspaceItemInfo.FLAG_DISABLED_NOT_AVAILABLE);

break;

}





bindApplicationsIfNeeded();



}</code></pre> 
<p id="u03d1542a"></p> 
<p id="ud54d9a54"></p> 
<p id="u1647f28e"></p> 
<p id="u5a4393db"></p> 
<p id="u4603f51b"></p> 
<p id="u45b0d040">BaseModelUpdateTask.java</p> 
<pre><code>public void bindApplicationsIfNeeded() {

if (mAllAppsList.getAndResetChangeFlag()) {

AppInfo[] apps = mAllAppsList.copyData();

int flags = mAllAppsList.getFlags();

scheduleCallbackTask(c -&gt; c.bindAllApplications(apps, flags));

}

}





Launcher.java

public void bindAllApplications(AppInfo[] apps, int flags) {

mAppsView.getAppsStore().setApps(apps, flags);

}







</code></pre> 
<p id="u99885414">AllAppsStore.java</p> 
<pre><code>public void setApps(AppInfo[] apps, int flags) {

mApps = apps;

mModelFlags = flags;

notifyUpdate();

}</code></pre> 
<p id="ud4797f24">桌面应用list刷新</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bfda0a7a7adb5e4deebb00328b568913/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android编译系统-概念篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9a7a5eb6f6a5eb7b8853f81d5d13e547/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">（Appium_apk package）查询apk包名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>