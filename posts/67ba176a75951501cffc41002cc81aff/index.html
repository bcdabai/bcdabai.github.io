<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>file_get_contens  POST传值 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="file_get_contens  POST传值" />
<meta property="og:description" content="&lt;?php echo &#34;&lt;pre&gt;&#34;; print_r($_POST); print_r($_COOKIE); ?&gt; 本文讲述的只是http post请求的发送,所以,目标页只是回显所收到的post和cookie
2.请求页
request.php
&lt;? $data = array(&#34;name&#34; =&gt; &#39;tim&#39;,&#34;content&#34; =&gt; &#39;test&#39;); $data = http_build_query($data); $opts = array( &#39;http&#39;=&gt;array( &#39;method&#39;=&gt;&#34;POST&#34;, &#39;header&#39;=&gt;&#34;Content-type: application/x-www-form-urlencoded\r\n&#34;. &#34;Content-length:&#34;.strlen($data).&#34;\r\n&#34; . &#34;Cookie: foo=bar\r\n&#34; . &#34;\r\n&#34;, &#39;content&#39; =&gt; $data, ) ); $cxContext = stream_context_create($opts); $sFile = file_get_contents(&#34;http://localhost/response.php&#34;, false, $cxContext); echo $sFile; ?&gt; 这个文件首先使用stream_context_create()构造了一个http请求,然后使用file_get_contents发送出去,返回的结果是:
Array ( [name] =&gt; tim [content] =&gt; test ) Array ( [foo] =&gt; bar ) 所以上可以看出,只要你了解http协议,完全可以使用这两个函数构造出所有正常的http请求,比如代理,断点续传等…
&lt;?php $option = array( &#39;http&#39; =&gt; array( &#39;method&#39; =&gt; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/67ba176a75951501cffc41002cc81aff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-07T11:23:00+08:00" />
<meta property="article:modified_time" content="2016-07-07T11:23:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">file_get_contens  POST传值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <pre><code class="language-php"><span style="color:#000000;font-weight:bold;">&lt;?php  
 <span style="color:#b1b100;">echo <span style="color:#0000ff;">"&lt;pre&gt;"<span style="color:#339933;">;  
 <span style="color:#990000;">print_r<span style="color:#009900;">(<span style="color:#000088;">$_POST<span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#990000;">print_r<span style="color:#009900;">(<span style="color:#000088;">$_COOKIE<span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#000000;font-weight:bold;">?&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre> 
 <p>本文讲述的只是http post请求的发送,所以,目标页只是回显所收到的post和cookie<br><span id="more-1203"><br>2.请求页<br>request.php</span></p> 
 <pre><code class="language-php"><span style="color:#000000;font-weight:bold;">&lt;?
 <span style="color:#000088;">$data <span style="color:#339933;">= <span style="color:#990000;">array<span style="color:#009900;">(<span style="color:#0000ff;">"name" <span style="color:#339933;">=&gt; <span style="color:#0000ff;">'tim'<span style="color:#339933;">,<span style="color:#0000ff;">"content" <span style="color:#339933;">=&gt; <span style="color:#0000ff;">'test'<span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#000088;">$data <span style="color:#339933;">= <span style="color:#990000;">http_build_query<span style="color:#009900;">(<span style="color:#000088;">$data<span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#000088;">$opts <span style="color:#339933;">= <span style="color:#990000;">array<span style="color:#009900;">( <span style="color:#0000ff;">'http'<span style="color:#339933;">=&gt;array<span style="color:#009900;">( <span style="color:#0000ff;">'method'<span style="color:#339933;">=&gt;<span style="color:#0000ff;">"POST"<span style="color:#339933;">, <span style="color:#0000ff;">'header'<span style="color:#339933;">=&gt;<span style="color:#0000ff;">"Content-type: application/x-www-form-urlencoded<span style="color:#000099;font-weight:bold;">\r<span style="color:#000099;font-weight:bold;">\n"<span style="color:#339933;">. <span style="color:#0000ff;">"Content-length:"<span style="color:#339933;">.<span style="color:#990000;">strlen<span style="color:#009900;">(<span style="color:#000088;">$data<span style="color:#009900;">)<span style="color:#339933;">.<span style="color:#0000ff;">"<span style="color:#000099;font-weight:bold;">\r<span style="color:#000099;font-weight:bold;">\n" <span style="color:#339933;">. <span style="color:#0000ff;">"Cookie: foo=bar<span style="color:#000099;font-weight:bold;">\r<span style="color:#000099;font-weight:bold;">\n" <span style="color:#339933;">. <span style="color:#0000ff;">"<span style="color:#000099;font-weight:bold;">\r<span style="color:#000099;font-weight:bold;">\n"<span style="color:#339933;">, <span style="color:#0000ff;">'content' <span style="color:#339933;">=&gt; <span style="color:#000088;">$data<span style="color:#339933;">, <span style="color:#009900;">) <span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#000088;">$cxContext <span style="color:#339933;">= <span style="color:#990000;">stream_context_create<span style="color:#009900;">(<span style="color:#000088;">$opts<span style="color:#009900;">)<span style="color:#339933;">; <span style="color:#000088;">$sFile <span style="color:#339933;">= <span style="color:#990000;">file_get_contents<span style="color:#009900;">(<span style="color:#0000ff;">"http://localhost/response.php"<span style="color:#339933;">, <span style="color:#009900;font-weight:bold;">false<span style="color:#339933;">, <span style="color:#000088;">$cxContext<span style="color:#009900;">)<span style="color:#339933;">;   <span style="color:#b1b100;">echo <span style="color:#000088;">$sFile<span style="color:#339933;">;   <span style="color:#000000;font-weight:bold;">?&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre> 
 <p>这个文件首先使用stream_context_create()构造了一个http请求,然后使用file_get_contents发送出去,返回的结果是:</p> 
 <table><tbody><tr><td class="code"> <pre><code class="language-php"> <span style="color:#990000;">Array
 <span style="color:#009900;">(  
     <span style="color:#009900;">[name<span style="color:#009900;">] <span style="color:#339933;">=&gt; tim <span style="color:#009900;">[content<span style="color:#009900;">] <span style="color:#339933;">=&gt; test <span style="color:#009900;">) <span style="color:#990000;">Array <span style="color:#009900;">( <span style="color:#009900;">[foo<span style="color:#009900;">] <span style="color:#339933;">=&gt; bar <span style="color:#009900;">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre> </td></tr></tbody></table> 
 <p>所以上可以看出,只要你了解http协议,完全可以使用这两个函数构造出所有正常的http请求,比如代理,断点续传等…</p> 
 <pre><code class="language-php">&lt;?php      <br>$option = array(      <br>'http' =&gt; array(      <br>'method' =&gt; "POST", // 常用 POST 或者 GET      <br>'header' =&gt; "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) \r\n Accept: */*", // Header 域内容，用于定义如 Cookie 之类的信息      <br>'content' =&gt; "domain=www.kalvin.cn&amp;author=kalvin", // POST 时提交的内容      <br>)      <br>);      <br>$xoption = stream_context_create($option); // 生成请求所用的头信息      <br>echo $str = file_get_contents("http://www.kalvin.cn", false, $xoption); // 执行请求  <br>print_r($http_response_header); // 显示返回的头信息  <br>?&gt; </code></pre> 
 <div> 
  <p>因为要用<span style="text-decoration:underline;"><strong>php</strong>去向我的虚拟主机管理系统发送开通空间等的请求，需要Post传值，由于开通空间过程很慢，同时需要延时处理。以下找到了一下file_get_contents的超时处理，网上有人用2个方法<span style="text-decoration:underline;"><strong>解决</strong>：</span></span></p> 
  <p>在使用file_get_contents函数的时候，经常会出现超时的情况，在这里要通过查看一下错误提示，看看是哪种错误，比较常见的是读取超时，这种情况大家可以通过一些方法来尽量的避免或者解决。这里就简单介绍两种：</p> 
  <p>一、增加超时的时间限制</p> 
  <p>这里需要注意：set_time_limit只是<span style="text-decoration:underline;"><strong>设置</strong>你的PHP程序的超时时间，而不是file_get_contents函数读取URL的超时时间。<br>我一开始以为set_time_limit也能影响到file_get_contents，后来经测试，是无效的。真正的修改file_get_contents延时可以用resource $context的timeout参数：</span></p> 
  <div> 
   <div>
     $opts = array( 
    <br>'http'=&gt;array( 
    <br>'method'=&gt;"GET", 
    <br>'timeout'=&gt;60, 
    <br>) 
    <br>); 
    <br> 
    <br>$context = stream_context_create($opts); 
    <br> 
    <br>$html =file_get_contents('http://www.example.com', false, $context); 
    <br>fpassthru($fp); 
   </div> 
  </div> 
  <p>二、一次有延时的话那就多试几次</p> 
  <p>有时候失败是因为网络等因素造成，没有解决<span style="text-decoration:underline;"><strong>办法</strong>，但是可以修改程序，失败时重试几次，仍然失败就放弃，因为file_get_contents()如果失败将返回 FALSE，所以可以下面这样编写代码：</span></p> 
  <div> 
   <div>
     $cnt=0; 
    <br>while($cnt &lt; 3 &amp;&amp; ($str=@file_get_contents('http...'))===FALSE) $cnt++; 
   </div> 
  </div> 
  <p>以上方法对付超时已经OK了。那么Post呢？细心点有人发现了'method'=&gt;"GET", 对！是不是能设置成post呢？百度找了下相关资料，还真可以！而且有人写出了山寨版的post传值函数，如下：</p> 
  <p>function Post($url, $post = null)<br>{<!-- --><br>     $context = array();<br><br>     if (is_array($post))<br>     {<!-- --><br>         ksort($post);<br><br>         $context['http'] = array<br>         (   </p> 
  <p>             'timeout'=&gt;60,<br>             'method' =&gt; 'POST',<br>             'content' =&gt; http_build_query($post, '', '&amp;'),<br>         );<br>     }<br><br>     return file_get_contents($url, false, stream_context_create($context));<br>}<br><br>$data = array<br>(<br>   换成你自己数组的值<br>);<br>$arr = post('https://api.weibo.com/oauth2/access_token', $data);<br> $tt=json_decode($arr,true);</p> 
 </div> 
</div> 
<p>转载于:https://www.cnblogs.com/haoyu521/p/5649437.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9461100baabd3663d2ef799a2ae088b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android模块化编程——WebView使用之清理缓存</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b693967581847dfbb8202d991388e0da/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编程开发经验谈:其实Unix很简单</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>