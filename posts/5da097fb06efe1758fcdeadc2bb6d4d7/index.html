<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pythonè„šæœ¬å®æˆ˜ã€å¤§éº¦ç½‘ã€‘æŠ¢ç¥¨ç¨‹åºï¼Œæˆ‘ç»ˆäºå¯ä»¥å»çœ‹æˆ‘æ°å“¥çš„æ¼”å”±ä¼šå•¦ï¼ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Pythonè„šæœ¬å®æˆ˜ã€å¤§éº¦ç½‘ã€‘æŠ¢ç¥¨ç¨‹åºï¼Œæˆ‘ç»ˆäºå¯ä»¥å»çœ‹æˆ‘æ°å“¥çš„æ¼”å”±ä¼šå•¦ï¼" />
<meta property="og:description" content="å‰è¨€ å¤§éº¦ç½‘ï¼Œæ˜¯ä¸­å›½ç»¼åˆç±»ç°åœºå¨±ä¹ç¥¨åŠ¡è¥é”€å¹³å°ï¼Œä¸šåŠ¡è¦†ç›–æ¼”å”±ä¼šã€ è¯å‰§ã€éŸ³ä¹å‰§ã€ä½“è‚²èµ›äº‹ç­‰é¢†åŸŸã€‚
ä½†æ˜¯å› ä¸ºç¥¨æ•°æœ‰é™ï¼Œè¿˜æœ‰é»„ç‰›ä»¬ä¸èƒ½ä¸¢äº†é¥­ç¢—ï¼Œæ‰€ä»¥å¯¼è‡´äº†ï¼Œå¾ˆå¤šäººéƒ½æŠ¢ä¸åˆ°ç¥¨
é‚£ä¹ˆï¼Œä»Šå¤©å¸¦å¤§å®¶ç”¨Pythonæ¥åˆ¶ä½œä¸€ä¸ªè‡ªåŠ¨æŠ¢ç¥¨çš„è„šæœ¬å°ç¨‹åº
çŸ¥è¯†ç‚¹ï¼š é¢å‘å¯¹è±¡ç¼–ç¨‹selenium æ“ä½œæµè§ˆå™¨pickle ä¿å­˜å’Œè¯»å–Cookieå®ç°å…ç™»é™†time åšå»¶æ—¶æ“ä½œos åˆ›å»ºæ–‡ä»¶ï¼Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ å¼€å‘ç¯å¢ƒï¼š ç‰ˆ æœ¬ï¼šanaconda5.2.0ï¼ˆpython3.6.5ï¼‰ç¼–è¾‘å™¨ï¼špycharm å…ˆå¯¼å…¥æœ¬æ¬¡æ‰€éœ€çš„æ¨¡å— import os import time import pickle from time import sleep from selenium import webdriver ç¬¬ä¸€æ­¥ï¼Œå®ç°å…ç™»å½• ç¡®å®šç›®æ ‡ï¼Œè®¾ç½®å…¨å±€å˜é‡
# å¤§éº¦ç½‘ä¸»é¡µ damai_url = &#34;https://www.damai.cn/&#34; # ç™»å½•é¡µ login_url = &#34;https://passport.damai.cn/login?ru=https%3A%2F%2Fwww.damai.cn%2F&#34; # æŠ¢ç¥¨ç›®æ ‡é¡µ target_url = &#39;https://detail.damai.cn/item.htm?spm=a2oeg.search_category.0.0.77f24d15RWgT4o&amp;id=654534889506&amp;clicktitle=%E5%A4%A7%E4%BC%97%E7 åˆå§‹åŒ–åŠ è½½
class Concert: def __init__(self): self.status = 0 # çŠ¶æ€,è¡¨ç¤ºå¦‚ä»Šè¿›è¡Œåˆ°ä½•ç§ç¨‹åº¦ self.login_method = 1 # {0:æ¨¡æ‹Ÿç™»å½•,1:Cookieç™»å½•}è‡ªè¡Œé€‰æ‹©ç™»å½•æ–¹å¼ self.driver = webdriver.Chrome(executable_path=&#39;chromedriver.exe&#39;) # é»˜è®¤Chromeæµè§ˆå™¨ ç™»å½•è°ƒç”¨è®¾ç½®cookie
~~~python def set_cookie(self): self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5da097fb06efe1758fcdeadc2bb6d4d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-18T11:47:21+08:00" />
<meta property="article:modified_time" content="2023-05-18T11:47:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pythonè„šæœ¬å®æˆ˜ã€å¤§éº¦ç½‘ã€‘æŠ¢ç¥¨ç¨‹åºï¼Œæˆ‘ç»ˆäºå¯ä»¥å»çœ‹æˆ‘æ°å“¥çš„æ¼”å”±ä¼šå•¦ï¼</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>å‰è¨€</h3> 
<p>å¤§éº¦ç½‘ï¼Œæ˜¯ä¸­å›½ç»¼åˆç±»ç°åœºå¨±ä¹ç¥¨åŠ¡è¥é”€å¹³å°ï¼Œä¸šåŠ¡è¦†ç›–æ¼”å”±ä¼šã€ è¯å‰§ã€éŸ³ä¹å‰§ã€ä½“è‚²èµ›äº‹ç­‰é¢†åŸŸã€‚</p> 
<p>ä½†æ˜¯å› ä¸ºç¥¨æ•°æœ‰é™ï¼Œè¿˜æœ‰é»„ç‰›ä»¬ä¸èƒ½ä¸¢äº†é¥­ç¢—ï¼Œæ‰€ä»¥å¯¼è‡´äº†ï¼Œå¾ˆå¤šäººéƒ½æŠ¢ä¸åˆ°ç¥¨</p> 
<p>é‚£ä¹ˆï¼Œä»Šå¤©å¸¦å¤§å®¶ç”¨Pythonæ¥åˆ¶ä½œä¸€ä¸ªè‡ªåŠ¨æŠ¢ç¥¨çš„è„šæœ¬å°ç¨‹åº</p> 
<h3>çŸ¥è¯†ç‚¹ï¼š</h3> 
<ul><li>é¢å‘å¯¹è±¡ç¼–ç¨‹</li><li>selenium æ“ä½œæµè§ˆå™¨</li><li>pickle ä¿å­˜å’Œè¯»å–Cookieå®ç°å…ç™»é™†</li><li>time åšå»¶æ—¶æ“ä½œ</li><li>os åˆ›å»ºæ–‡ä»¶ï¼Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li></ul> 
<p></p> 
<h3>å¼€å‘ç¯å¢ƒï¼š</h3> 
<ul><li>ç‰ˆ æœ¬ï¼šanaconda5.2.0ï¼ˆpython3.6.5ï¼‰</li><li>ç¼–è¾‘å™¨ï¼špycharm</li></ul> 
<h3>å…ˆå¯¼å…¥æœ¬æ¬¡æ‰€éœ€çš„æ¨¡å—</h3> 
<pre><code>import os
import time
import pickle
from time import sleep
from selenium import webdriver</code></pre> 
<h3>ç¬¬ä¸€æ­¥ï¼Œå®ç°å…ç™»å½•</h3> 
<p><strong>ç¡®å®šç›®æ ‡ï¼Œè®¾ç½®å…¨å±€å˜é‡</strong></p> 
<pre><code># å¤§éº¦ç½‘ä¸»é¡µ
damai_url = "https://www.damai.cn/"
# ç™»å½•é¡µ
login_url = "https://passport.damai.cn/login?ru=https%3A%2F%2Fwww.damai.cn%2F"
# æŠ¢ç¥¨ç›®æ ‡é¡µ
target_url = 'https://detail.damai.cn/item.htm?spm=a2oeg.search_category.0.0.77f24d15RWgT4o&amp;id=654534889506&amp;clicktitle=%E5%A4%A7%E4%BC%97%E7</code></pre> 
<p><strong>åˆå§‹åŒ–åŠ è½½</strong></p> 
<pre><code>class Concert:
    def __init__(self):
        self.status = 0         # çŠ¶æ€,è¡¨ç¤ºå¦‚ä»Šè¿›è¡Œåˆ°ä½•ç§ç¨‹åº¦
        self.login_method = 1   # {0:æ¨¡æ‹Ÿç™»å½•,1:Cookieç™»å½•}è‡ªè¡Œé€‰æ‹©ç™»å½•æ–¹å¼
        self.driver = webdriver.Chrome(executable_path='chromedriver.exe')        # é»˜è®¤Chromeæµè§ˆå™¨</code></pre> 
<p><strong>ç™»å½•è°ƒç”¨è®¾ç½®cookie</strong></p> 
<pre><code>~~~python
def set_cookie(self):
    self.driver.get(damai_url)
    print("###è¯·ç‚¹å‡»ç™»å½•###")
    while self.driver.title.find('å¤§éº¦ç½‘-å…¨çƒæ¼”å‡ºèµ›äº‹å®˜æ–¹è´­ç¥¨å¹³å°') != -1:
        sleep(1)
    print('###è¯·æ‰«ç ç™»å½•###')

    while self.driver.title != 'å¤§éº¦ç½‘-å…¨çƒæ¼”å‡ºèµ›äº‹å®˜æ–¹è´­ç¥¨å¹³å°-100%æ­£å“ã€å…ˆä»˜å…ˆæŠ¢ã€åœ¨çº¿é€‰åº§ï¼':
       sleep(1)
    print("###æ‰«ç æˆåŠŸ###")
    pickle.dump(self.driver.get_cookies(), open("cookies.pkl", "wb"))
    print("###Cookieä¿å­˜æˆåŠŸ###")
    self.driver.get(target_url)
~~~</code></pre> 
<p><strong>è·å–cookie</strong></p> 
<pre><code>~~~python
def get_cookie(self):
    try:
        cookies = pickle.load(open("cookies.pkl", "rb"))  # è½½å…¥cookie
        for cookie in cookies:
            cookie_dict = {
                'domain':'.damai.cn',  # å¿…é¡»æœ‰ï¼Œä¸ç„¶å°±æ˜¯å‡ç™»å½•
                'name': cookie.get('name'),
                'value': cookie.get('value')
            }
            self.driver.add_cookie(cookie_dict)
        print('###è½½å…¥Cookie###')
    except Exception as e:
        print(e)
~~~</code></pre> 
<p><strong>ç™»å½•</strong></p> 
<pre><code>    def login(self):
        if self.login_method==0:
            self.driver.get(login_url)                                
            # è½½å…¥ç™»å½•ç•Œé¢
            print('###å¼€å§‹ç™»å½•###')

        elif self.login_method==1:
            if not os.path.exists('cookies.pkl'):                     
            # å¦‚æœä¸å­˜åœ¨cookie.pkl,å°±è·å–ä¸€ä¸‹
                self.set_cookie()
            else:
                self.driver.get(target_url)
                self.get_cookie()</code></pre> 
<p><strong>æ‰“å¼€æµè§ˆå™¨</strong></p> 
<pre><code>def enter_concert(self):
    """æ‰“å¼€æµè§ˆå™¨"""
    print('###æ‰“å¼€æµè§ˆå™¨ï¼Œè¿›å…¥å¤§éº¦ç½‘###')
    # self.driver.maximize_window()           # æœ€å¤§åŒ–çª—å£
    # è°ƒç”¨ç™»é™†
    self.login()                            # å…ˆç™»å½•å†è¯´
    self.driver.refresh()                   # åˆ·æ–°é¡µé¢
    self.status = 2                         # ç™»å½•æˆåŠŸæ ‡è¯†
    print("###ç™»å½•æˆåŠŸ###")
    # åç»­å¾·äº‘ç¤¾å¯ä»¥è®²
    if self.isElementExist('/html/body/div[2]/div[2]/div/div/div[3]/div[2]'):
        self.driver.find_element_by_xpath('/html/body/div[2]/div[2]/div/div/div[3]/div[2]').click()</code></pre> 
<h3>ç¬¬äºŒæ­¥ï¼ŒæŠ¢ç¥¨å¹¶ä¸‹å•</h3> 
<p><strong>åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</strong></p> 
<pre><code>def isElementExist(self, element):
    flag = True
    browser = self.driver
    try:
        browser.find_element_by_xpath(element)
        return flag

    except:
        flag = False
        return flag</code></pre> 
<p><strong>é€‰ç¥¨æ“ä½œ</strong></p> 
<pre><code>def choose_ticket(self):
    if self.status == 2:                  #ç™»å½•æˆåŠŸå…¥å£
        print("="*30)
        print("###å¼€å§‹è¿›è¡Œæ—¥æœŸåŠç¥¨ä»·é€‰æ‹©###")
        while self.driver.title.find('ç¡®è®¤è®¢å•') == -1:           # å¦‚æœè·³è½¬åˆ°äº†è®¢å•ç»“ç®—ç•Œé¢å°±ç®—è¿™æ­¥æˆåŠŸäº†ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œæ­¤æ­¥
            try:
                buybutton = self.driver.find_element_by_class_name('buybtn').text
                if buybutton == "æäº¤ç¼ºè´§ç™»è®°":
                    # æ”¹å˜ç°æœ‰çŠ¶æ€
                    self.status=2
                    self.driver.get(target_url)
                    print('###æŠ¢ç¥¨æœªå¼€å§‹ï¼Œåˆ·æ–°ç­‰å¾…å¼€å§‹###')
                    continue
                elif buybutton == "ç«‹å³é¢„å®š":
                    self.driver.find_element_by_class_name('buybtn').click()
                    # æ”¹å˜ç°æœ‰çŠ¶æ€
                    self.status = 3
                elif buybutton == "ç«‹å³è´­ä¹°":
                    self.driver.find_element_by_class_name('buybtn').click()
                    # æ”¹å˜ç°æœ‰çŠ¶æ€
                    self.status = 4
                # é€‰åº§è´­ä¹°æš‚æ—¶æ— æ³•å®Œæˆè‡ªåŠ¨åŒ–
                elif buybutton == "é€‰åº§è´­ä¹°":
                    self.driver.find_element_by_class_name('buybtn').click()
                    self.status = 5
            except:
                print('###æœªè·³è½¬åˆ°è®¢å•ç»“ç®—ç•Œé¢###')
            title = self.driver.title
            if title == 'é€‰åº§è´­ä¹°':
                # å®ç°é€‰åº§ä½è´­ä¹°çš„é€»è¾‘
                self.choice_seats()
            elif title == 'ç¡®è®¤è®¢å•':
                while True:
                    # å¦‚æœæ ‡é¢˜ä¸ºç¡®è®¤è®¢å•
                    print('waiting ......')
                    if self.isElementExist('//*[@id="container"]/div/div[9]/button'):
                        self.check_order()
                        break</code></pre> 
<p><strong>é€‰æ‹©åº§ä½</strong></p> 
<pre><code>    def choice_seats(self):
        while self.driver.title == 'é€‰åº§è´­ä¹°':
            while self.isElementExist('//*[@id="app"]/div[2]/div[2]/div[1]/div[2]/img'):
                # åº§ä½æ‰‹åŠ¨é€‰æ‹© é€‰ä¸­åº§ä½ä¹‹å//*[@id="app"]/div[2]/div[2]/div[1]/div[2]/img å°±ä¼šæ¶ˆå¤±
                print('è¯·å¿«é€Ÿçš„é€‰æ‹©æ‚¨çš„åº§ä½ï¼ï¼ï¼')
            # æ¶ˆå¤±ä¹‹åå°±ä¼šå‡ºç° //*[@id="app"]/div[2]/div[2]/div[2]/div
            while self.isElementExist('//*[@id="app"]/div[2]/div[2]/div[2]/div'):
                # æ‰¾åˆ°ä¹‹åè¿›è¡Œç‚¹å‡»ç¡®è®¤é€‰åº§
                self.driver.find_element_by_xpath('//*[@id="app"]/div[2]/div[2]/div[2]/button').click()</code></pre> 
<p><strong>ä¸‹å•æ“ä½œ</strong></p> 
<pre><code>def check_order(self):
    if self.status in [3,4,5]:
        print('###å¼€å§‹ç¡®è®¤è®¢å•###')
        try:
            # é»˜è®¤é€‰ç¬¬ä¸€ä¸ªè´­ç¥¨äººä¿¡æ¯
            self.driver.find_element_by_xpath('//*[@id="container"]/div/div[2]/div[2]/div[1]/div/label').click()
        except Exception as e:
            print("###è´­ç¥¨äººä¿¡æ¯é€‰ä¸­å¤±è´¥ï¼Œè‡ªè¡ŒæŸ¥çœ‹å…ƒç´ ä½ç½®###")
            print(e)
        # æœ€åä¸€æ­¥æäº¤è®¢å•
        time.sleep(0.5)  # å¤ªå¿«ä¼šå½±å“åŠ è½½ï¼Œå¯¼è‡´æŒ‰é’®ç‚¹å‡»æ— æ•ˆ
        self.driver.find_element_by_xpath('//div[@class = "w1200"]//div[2]//div//div[9]//button[1]').click()</code></pre> 
<p><strong>æŠ¢ç¥¨å®Œæˆï¼Œé€€å‡º</strong></p> 
<pre><code>def finish(self):
    self.driver.quit()</code></pre> 
<p><strong>æµ‹è¯•ä»£ç æ˜¯å¦æˆåŠŸ</strong></p> 
<pre><code>if __name__ == '__main__':
    try:
        con = Concert()             # å…·ä½“å¦‚æœå¡«å†™è¯·æŸ¥çœ‹ç±»ä¸­çš„åˆå§‹åŒ–å‡½æ•°
        con.enter_concert()         # æ‰“å¼€æµè§ˆå™¨
        con.choose_ticket()         # å¼€å§‹æŠ¢ç¥¨

    except Exception as e:
        print(e)
        con.finish()</code></pre> 
<h3>æœ€åçœ‹ä¸‹æ•ˆæœå¦‚ä½•</h3> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/5c/36/pw5vwZ1n_o.jpg"></p> 
<p></p> 
<h3>Â Â çŸ¥é“ä½ å¯¹pythonæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥ç»™ä½ å‡†å¤‡äº†ä¸‹é¢çš„èµ„æ–™~</h3> 
<p>Â è¿™ä»½å®Œæ•´ç‰ˆçš„Pythonå®Œæ•´æºç å·²ç»ä¸Šä¼ ï¼Œæœ‹å‹ä»¬å¦‚æœéœ€è¦å¯ä»¥ç‚¹å‡»é“¾æ¥å…è´¹é¢†å–æˆ–è€…æ»‘åˆ°æœ€åæ‰«æäºŒvç åŠ æˆ‘è€—æ²¹ã€<strong><code>ä¿è¯100%å…è´¹</code></strong>ã€‘</p> 
<p><img alt="" src="https://images2.imgbox.com/e0/66/GOtMdDtZ_o.jpg"></p> 
<p></p> 
<h3><strong>å¦‚æœä½ æ˜¯é›¶åŸºç¡€éœ€è¦pythonå­¦ä¹ èµ„æºæˆ‘ä¹Ÿå¯ä»¥å…è´¹åˆ†äº«ï¼Œä¿è¯100%å…è´¹ï¼ï¼ï¼</strong></h3> 
<p>éœ€è¦çš„è¯å¯ä»¥ç‚¹å‡»è¿™é‡Œ<strong>ğŸ‘‰</strong><a href="https://mp.weixin.qq.com/s/UVxw0daFCgAMFhz9cfrjAQ" rel="nofollow" title="Pythonå­¦ä¹ è·¯çº¿ï¼ˆ2023ä¿®æ­£ç‰ˆï¼‰é™„æ¶‰åŠèµ„æ–™">Pythonå­¦ä¹ è·¯çº¿ï¼ˆ2023ä¿®æ­£ç‰ˆï¼‰é™„æ¶‰åŠèµ„æ–™</a>Â ï¼ˆå®‰å…¨é“¾æ¥ï¼Œæ”¾å¿ƒç‚¹å‡»ï¼‰</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e12dfd70ecb9b922ad523c803f090b8a/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Jetson TX2 NX(Ubuntu 18.04) &#43; ROS melodic &#43; turtlebotåŠŸèƒ½åŒ… &#43; realsense d455 &#43; ORB-SLAM2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5bc34e5bf4ee0cd84ebda2bd3c9f7cfe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ChatGPTå¾—åˆ°Kubernetesä¸€äº›æ¦‚å¿µ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>