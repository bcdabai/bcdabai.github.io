<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python之使用深度学习创建自己的表情符号 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python之使用深度学习创建自己的表情符号" />
<meta property="og:description" content="目录 环境搭建部署项目1、首先运行train.py训练模型2、接下运行gui.py测试 一、使用 CNN 进行面部情绪识别二、GUI 代码和表情符号映射 在这个深度学习项目中，我们将对人类面部表情进行分类，以过滤和映射相应的表情符号或头像。
数据集（面部表情识别）由48*48像素的灰度人脸图像组成。图像居中并占据相等的空间。该数据集由以下类别的面部情绪组成：
0：生气
1：厌恶
2：壮举
3：快乐
4：悲伤
5：惊喜
6：自然
下载项目代码：click or click
环境搭建 python版本我们选择3.9~3.11：python-3.11.5-amd64.exe
因为我们的tensorflow库需要与python版本相对应
pycharm 我们选择专业版功能多：pycharm-professional-2023.2.3.exe
转载：具体安装详细教程：Python安装教程（新手)
我们将构建一个深度学习模型，从图像中对面部表情进行分类。然后，我们将分类的情感映射到表情符号或头像。
部署项目 没有相应的模块自己pip安装吧
1、首先运行train.py训练模型 等待训练完成生成emotion_model.h5
2、接下运行gui.py测试 一、使用 CNN 进行面部情绪识别 在以下步骤中，将构建卷积神经网络架构，并在数据集上训练模型FER2013以便从图像中进行情感识别。从上面的链接下载数据集。将其提取到具有单独训练和测试目录的数据文件夹中。
1、import
import numpy as np import cv2 from keras.models import Sequential from keras.layers import Dense, Dropout, Flatten from keras.layers import Conv2D from keras.optimizers import Adam from keras.layers import MaxPooling2D from keras.preprocessing.image import ImageDataGenerator numpy: 用于在Python中进行数值计算的库。cv2: OpenCV库，用于计算机视觉任务，例如图像处理和人脸检测。Sequential, Dense, Dropout, Flatten, Conv2D, MaxPooling2D:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bdb131321e950546df7e6e656ddcb7b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-04T23:41:36+08:00" />
<meta property="article:modified_time" content="2023-12-04T23:41:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python之使用深度学习创建自己的表情符号</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_15" rel="nofollow">环境搭建</a></li><li><a href="#_29" rel="nofollow">部署项目</a></li><li><ul><li><a href="#1trainpy_34" rel="nofollow">1、首先运行train.py训练模型</a></li><li><a href="#2guipy_37" rel="nofollow">2、接下运行gui.py测试</a></li></ul> 
   </li><li><a href="#_CNN__42" rel="nofollow">一、使用 CNN 进行面部情绪识别</a></li><li><a href="#GUI__205" rel="nofollow">二、GUI 代码和表情符号映射</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p>在这个深度学习项目中，我们将对人类面部表情进行分类，以过滤和映射相应的表情符号或头像。</p> 
</blockquote> 
<p>数据集（面部表情识别）由48*48像素的灰度人脸图像组成。图像居中并占据相等的空间。该数据集由以下类别的面部情绪组成：</p> 
<p>0：生气<br> 1：厌恶<br> 2：壮举<br> 3：快乐<br> 4：悲伤<br> 5：惊喜<br> 6：自然</p> 
<p>下载项目代码：<a href="https://www.123pan.com/s/bT07Vv-TiOcv.html" rel="nofollow">click or click</a></p> 
<h3><a id="_15"></a>环境搭建</h3> 
<p><mark>python版本我们选择3.9~3.11</mark>：<a href="https://www.123pan.com/s/bT07Vv-YTRcv.html" rel="nofollow">python-3.11.5-amd64.exe</a></p> 
<p>因为我们的tensorflow库需要与python版本相对应<br> <img src="https://images2.imgbox.com/1d/cc/E3Co1pUz_o.png" alt="在这里插入图片描述"><br> pycharm 我们选择专业版功能多：<a href="https://www.123pan.com/s/bT07Vv-GTRcv.html" rel="nofollow">pycharm-professional-2023.2.3.exe</a></p> 
<p>转载：具体安装详细教程：<a href="https://blog.csdn.net/qq_45502336/article/details/109531599">Python安装教程（新手)</a></p> 
<p>我们将构建一个深度学习模型，从图像中对面部表情进行分类。然后，我们将分类的情感映射到表情符号或头像。</p> 
<h3><a id="_29"></a>部署项目</h3> 
<p><mark>没有相应的模块自己pip安装吧</mark><br> <img src="https://images2.imgbox.com/3b/72/zIeRTkMF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7f/45/CVKByfrh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1trainpy_34"></a>1、首先运行train.py训练模型</h4> 
<p>等待训练完成生成emotion_model.h5<br> <img src="https://images2.imgbox.com/92/a8/iTmk5oXk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2guipy_37"></a>2、接下运行gui.py测试</h4> 
<p><img src="https://images2.imgbox.com/d7/e4/UfFL8xAH_o.png" alt="请添加图片描述"></p> 
<h3><a id="_CNN__42"></a>一、使用 CNN 进行面部情绪识别</h3> 
<p>在以下步骤中，将构建卷积神经网络架构，并在数据集上训练模型FER2013以便从图像中进行情感识别。从上面的链接下载数据集。将其提取到具有单独训练和测试目录的数据文件夹中。</p> 
<p><strong>1、import</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Dense<span class="token punctuation">,</span> Dropout<span class="token punctuation">,</span> Flatten
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Conv2D
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>optimizers <span class="token keyword">import</span> Adam

<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> MaxPooling2D
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>image <span class="token keyword">import</span> ImageDataGenerator
</code></pre> 
<ul><li>numpy: 用于在Python中进行数值计算的库。</li><li>cv2: OpenCV库，用于计算机视觉任务，例如图像处理和人脸检测。</li><li>Sequential, Dense, Dropout, Flatten, Conv2D, MaxPooling2D:<br> 这些是Keras库中用于构建卷积神经网络（CNN）的类。</li><li>Adam: 优化算法，用于训练神经网络。</li><li>ImageDataGenerator: 用于在训练期间生成图像数据的类。</li></ul> 
<p><strong>2、初始化训练</strong></p> 
<pre><code class="prism language-python">train_dir <span class="token operator">=</span> <span class="token string">'train'</span>
val_dir <span class="token operator">=</span> <span class="token string">'test'</span>
train_datagen <span class="token operator">=</span> ImageDataGenerator<span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">)</span>
val_datagen <span class="token operator">=</span> ImageDataGenerator<span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>train_dir 训练集 val_dir验证集</li><li>ImageDateGenerator：是Keras提供的用于图像数据生成的类，它允许你通过图像进行多种处理来增强数据集，同时也支持对数据进行标准化。</li><li>rescale=1./255：图像标准化，将图像的每个像素除以255，将像素缩放到0,1范围内。标准化有助于保证神经网络的输入数据在一个相对较小的范围内，提高训练的稳定性。</li></ul> 
<p><strong>3、验证生成器</strong></p> 
<pre><code class="prism language-python">train_generator <span class="token operator">=</span> train_datagen<span class="token punctuation">.</span>flow_from_directory<span class="token punctuation">(</span>
        train_dir<span class="token punctuation">,</span>
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
        color_mode<span class="token operator">=</span><span class="token string">"grayscale"</span><span class="token punctuation">,</span>
        class_mode<span class="token operator">=</span><span class="token string">'categorical'</span><span class="token punctuation">)</span>

validation_generator <span class="token operator">=</span> val_datagen<span class="token punctuation">.</span>flow_from_directory<span class="token punctuation">(</span>
        val_dir<span class="token punctuation">,</span>
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
        color_mode<span class="token operator">=</span><span class="token string">"grayscale"</span><span class="token punctuation">,</span>
        class_mode<span class="token operator">=</span><span class="token string">'categorical'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>flow_from_directory：用于从目录中加载图像并生成批量的数据。该方法适用于处理大量图像数据，适用于计算机视觉任务</li><li>train_dir：目标目录的路径，每一个类别一个字文件夹</li><li>target_size=(48,48)：将图像调整为48*48像素大小</li><li>batch_size=64：每次生成器生成64个图像</li><li>color_mode=“grayscale”：指定图像的颜色模式，采用灰度模式 ，表示图像是单通道的灰度图像。灰度图像只有亮度信息，不包括颜色信息，对于人脸表情识别，使用灰度图像足够，并且减少了计算的复杂度</li><li>class_mode=‘categorical’：指定返回的标签组的类型。采用了categorical，表示返回的标签是one-hot编码的类别标签。这种编码方式适用于多类别分类任务。</li></ul> 
<p><strong>3、构建卷积网络架构</strong></p> 
<pre><code class="prism language-python">emotion_model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>

emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># emotion_model.load_weights('emotion_model.h5')</span>
</code></pre> 
<ul><li>emotion_model = Sequential()：定义了一个线性的层堆栈，适用于简单的层序列结构</li><li>第一个卷积层（Conv2D）——使用了32个卷积核，每个卷积核大小为（3,3）——激活函数使用了ReLU，这是一种常用于卷积神经函数的非线性激活函数——input_shape=(48, 48, 1)：指定了输入图像的大小，并且是灰度图像</li><li>第二个卷积层（Conv2D）——使用了64个卷积核，每个卷积核大小为（3,3）——同样使用了ReLU激活函数</li><li>最大池化层（MaxPooling2D）——采用（2,2）池化窗口，将特征图的尺寸减小一半</li><li>Dropout层——随机丢掉20%的神经元，有助于减少过拟合</li></ul> 
<p><strong>4、编译和训练模型</strong></p> 
<pre><code class="prism language-python">cv2<span class="token punctuation">.</span>ocl<span class="token punctuation">.</span>setUseOpenCL<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

emotion_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"Angry"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"Disgusted"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"Fearful"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"Happy"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"Neutral"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"Sad"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"Surprised"</span><span class="token punctuation">}</span>


emotion_model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span>optimizer<span class="token operator">=</span>Adam<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
emotion_model_info <span class="token operator">=</span> emotion_model<span class="token punctuation">.</span>fit_generator<span class="token punctuation">(</span>
        train_generator<span class="token punctuation">,</span>
        steps_per_epoch<span class="token operator">=</span><span class="token number">28709</span> <span class="token operator">//</span> <span class="token number">64</span><span class="token punctuation">,</span>
        epochs<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>
        validation_data<span class="token operator">=</span>validation_generator<span class="token punctuation">,</span>
        validation_steps<span class="token operator">=</span><span class="token number">7178</span> <span class="token operator">//</span> <span class="token number">64</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>cv2.ocl.setUseOpenCL(False）：禁用OpenCL加速，在OpenCV中，当OpenCL可用时，它会尝试使用GPU进行一些操作，以提高性能。然而在某些环境或硬件配置下，OpenCL会导致一些问题</li><li>emotion_dict：定义了表情字典，上面我们说的6个表情+1自然</li><li>compile：方法用于配置模型的学习过程——使用了交叉损失函数categorical_crossentropy作为损失函数——Adam优化器learning_rate=0.0001学习率较小，模型参数更新步幅越小——精度accuracy作为评估指标</li><li>fit_generator：从生成器中获取批量数据进行训练——train_generator训练数据的生成器——steps_per_epoch:每个训练周期（epoch）中迭代的步数通常是训练集样本数除以批次大小——epochs训练的周期数，表示模型将遍历整个训练集的—— validation_data验证数据生成器——validation_steps验证周期的迭代次数</li></ul> 
<p><strong>5、保存模型权重</strong></p> 
<pre><code class="prism language-python">emotion_model<span class="token punctuation">.</span>save_weights<span class="token punctuation">(</span><span class="token string">'emotion_model.h5'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>6、使用openCV haarcascade xml检测网络摄像头中面部的边界框并预测情绪</strong></p> 
<pre><code class="prism language-python">cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 查找haar级联以在面部周围绘制边界框</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
        <span class="token comment"># 此处为自己文件夹下的haarcascade_frontalface_default.xml需要自己修改</span>
    bounding_box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'E:\pycharm_python\\venv\Lib\site-packages\cv2\data\haarcascade_frontalface_default.xml'</span><span class="token punctuation">)</span>
    gray_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2gray_frame<span class="token punctuation">)</span>
    num_faces <span class="token operator">=</span> bounding_box<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray_frame<span class="token punctuation">,</span>scaleFactor<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">,</span> minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> num_faces<span class="token punctuation">:</span>
    	<span class="token comment"># 人脸周围绘制蓝色矩形框</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span> y<span class="token operator">+</span>h<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment"># 提取人脸区域</span>
        roi_gray_frame <span class="token operator">=</span> gray_frame<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
        <span class="token comment"># 调整人脸图像大小</span>
        cropped_img <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>roi_gray_frame<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># 使用预先训练的 emotion_model 模型对提取的人脸进行情感预测</span>
        emotion_prediction <span class="token operator">=</span> emotion_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>cropped_img<span class="token punctuation">)</span>
        <span class="token comment"># 预测结果</span>
        maxindex <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>emotion_prediction<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 绘制在图像上</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> emotion_dict<span class="token punctuation">[</span>maxindex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">,</span> y<span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Video'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">,</span><span class="token number">860</span><span class="token punctuation">)</span><span class="token punctuation">,</span>interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>cap = cv2.VideoCapture(0)：创建名为cap的OpenCV视频捕捉对象，用于从计算机摄像头获取视频流。参数0表示使用默认的摄像头设备</li><li>ret, frame = cap.read()：使用cap对象读取一帧图像数据，ret是一个布尔值，表示是否成功读取了一帧图像成功True失败False——frame标签当前帧的图像数据</li><li>cv2.CascadeClassifier：加载Haar级联分类器用于人脸检测，haarcascade_frontalface_default.xml训练好的人脸检测模型</li><li>cv2.cvtColor：将彩色图像frame（BGR格式）转换为灰度图像cv2.COLOR_BGR2GRAY</li><li>detectMultiScale：在灰度图像（gray_frame）上检测人脸——scaleFactor图像缩放比例，控制了图像尺度的变化，用于检测不同大小的人脸——minNeighbors每个候选矩形框应该拥有的邻居数，可以过滤掉一些可能的噪声或有误检测。</li><li>cv2.imshow：显示图像，Video窗口标题——（1200,800）图像大小——cv2.INTER_CUBIC 是插值方法，用于在调整大小时平滑图像。</li></ul> 
<h3><a id="GUI__205"></a>二、GUI 代码和表情符号映射</h3> 
<p>创建一个名为 emojis 的文件夹，并将与数据集中七种情绪中的每一种对应的表情符号保存在一起<br> 将以下代码粘贴到 gui.py 中并运行该文件<br> <strong>1、导入库</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tkinter <span class="token keyword">as</span> tk
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageTk
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Conv2D<span class="token punctuation">,</span> MaxPooling2D
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Dense<span class="token punctuation">,</span> Dropout<span class="token punctuation">,</span> Flatten
</code></pre> 
<ul><li>thinker：模块(Tk 接口)是 Python 的标准 Tk GUI 工具包的接口 .Tk 和 Tkinter 可以在大多数的 Unix 平台下使用,同样可以应用在 Windows 和 Macintosh 系统里。Tk8.0 的后续版本可以实现本地窗口风格,并良好地运行在绝大多数平台中</li><li>PIL：全称 Python Imaging Library，是 Python 平台一个功能非常强大而且简单易用的图像处理库。</li><li>keras：深度学习框架</li></ul> 
<p><strong>2、数据初始化</strong></p> 
<pre><code class="prism language-python">cv2<span class="token punctuation">.</span>ocl<span class="token punctuation">.</span>setUseOpenCL<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
emotion_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"   Angry   "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"Disgusted"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"  Fearful  "</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"   Happy   "</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"  Neutral  "</span><span class="token punctuation">,</span>
                <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"    Sad    "</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"Surprised"</span><span class="token punctuation">}</span>
emoji_dist <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"../emojis/angry.png"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"../emojis/disgusted.png"</span><span class="token punctuation">,</span>
              <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"../emojis/fearful.png"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"../emojis/happy.png"</span><span class="token punctuation">,</span>
              <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"../emojis/neutral.png"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"../emojis/sad.png"</span><span class="token punctuation">,</span>
              <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"../emojis/surpriced.png"</span><span class="token punctuation">}</span>
</code></pre> 
<ul><li>禁止OpenCL启动，用CPU计算</li><li>定义情绪字典</li><li>定义表情字典</li></ul> 
<p><strong>3、定义一个层级架构</strong></p> 
<pre><code class="prism language-python">emotion_model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Conv2D<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaxPooling2D<span class="token punctuation">(</span>pool_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
emotion_model<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span><span class="token string">'emotion_model.h5'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>4、全局变量</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">global</span> last_frame1
last_frame1 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token keyword">global</span> cap1
show_text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
exit_flag <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 退出标志</span>
</code></pre> 
<ul><li>np.zeros:创建多维数组来生成图像。特别对于空白、黑色、白色、随机等特殊图像，用 Numpy 创建图像非常方便。</li></ul> 
<p><strong>5、人脸识别函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">show_vid_combined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> last_frame1<span class="token punctuation">,</span> exit_flag
    cap1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> cap1<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"摄像头没打开"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'摄像头已经打开'</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token keyword">not</span> exit_flag<span class="token punctuation">:</span>
        flag1<span class="token punctuation">,</span> frame1 <span class="token operator">=</span> cap1<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        frame1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        bounding_box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>
            <span class="token string">'E:\\pycharm_python\\venv\\Lib\\site-packages\\cv2\\data\\haarcascade_frontalface_default.xml'</span><span class="token punctuation">)</span>
        gray_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        num_faces <span class="token operator">=</span> bounding_box<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray_frame<span class="token punctuation">,</span> scaleFactor<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">,</span> minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> num_faces<span class="token punctuation">:</span>
            <span class="token comment"># 人脸周围绘制蓝色矩形框</span>
            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame1<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token comment"># 提取人脸区域</span>
            roi_gray_frame <span class="token operator">=</span> gray_frame<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
            <span class="token comment"># 调整人脸图像大小</span>
            cropped_img <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>roi_gray_frame<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment"># 使用预先训练的 emotion_model 模型对提取的人脸进行情感预测</span>
            prediction <span class="token operator">=</span> emotion_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>cropped_img<span class="token punctuation">)</span>
            <span class="token comment"># 预测结果</span>
            maxindex <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>prediction<span class="token punctuation">)</span><span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame1<span class="token punctuation">,</span> emotion_dict<span class="token punctuation">[</span>maxindex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
            show_text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> maxindex

        <span class="token keyword">if</span> flag1 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># 当前捕获的帧 frame1 复制给 last_frame1</span>
            last_frame1 <span class="token operator">=</span> frame1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 将 last_frame1 从 BGR 格式转换为 RGB 格式</span>
            pic <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>last_frame1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
            <span class="token comment"># 将 NumPy 数组转换为图像对象</span>
            img <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>pic<span class="token punctuation">)</span>
            <span class="token comment"># 将 PIL 图像对象转换为 Tkinter 图像对象，以便在 Tkinter 窗口中显示</span>
            imgtk <span class="token operator">=</span> ImageTk<span class="token punctuation">.</span>PhotoImage<span class="token punctuation">(</span>image<span class="token operator">=</span>img<span class="token punctuation">)</span>
            <span class="token comment"># lmain（Tkinter 中的 Label 控件）的 imgtk 属性设置为新的 Tkinter 图像对象。</span>
            lmain<span class="token punctuation">.</span>imgtk <span class="token operator">=</span> imgtk
            <span class="token comment"># 用 configure 方法更新 lmain 的图像，实现图像的实时显示</span>
            lmain<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>image<span class="token operator">=</span>imgtk<span class="token punctuation">)</span>
        cap1<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 调度 show_vid_combined</span>
        <span class="token comment"># 周期性地调度执行 show_vid_combined 函数，实现了实时更新图像的效果。每隔 10 毫秒，就会调用一次函数</span>
        root<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_vid_combined<span class="token punctuation">)</span>
</code></pre> 
<p><strong>6、表情显示函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">show_vid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> show_text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">in</span> emoji_dist<span class="token punctuation">:</span>
        frame2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>emoji_dist<span class="token punctuation">[</span>show_text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> frame2 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            pic2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
            img2 <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>pic2<span class="token punctuation">)</span>
            imgtk2 <span class="token operator">=</span> ImageTk<span class="token punctuation">.</span>PhotoImage<span class="token punctuation">(</span>image<span class="token operator">=</span>img2<span class="token punctuation">)</span>
            lmain2<span class="token punctuation">.</span>imgtk2 <span class="token operator">=</span> imgtk2
            lmain3<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>text<span class="token operator">=</span>emotion_dict<span class="token punctuation">[</span>show_text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'arial'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            lmain2<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>image<span class="token operator">=</span>imgtk2<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'无法加载图像'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'表情文件不存在'</span><span class="token punctuation">)</span>

    <span class="token comment"># 调度 show_vid2</span>
    root<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_vid2<span class="token punctuation">)</span>
</code></pre> 
<p><strong>7、主函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    root <span class="token operator">=</span> tk<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> ImageTk<span class="token punctuation">.</span>PhotoImage<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"logo.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    heading <span class="token operator">=</span> Label<span class="token punctuation">(</span>root<span class="token punctuation">,</span> image<span class="token operator">=</span>img<span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>

    heading<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
    heading2 <span class="token operator">=</span> Label<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"Photo to Emoji"</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'arial'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">'#CDCDCD'</span><span class="token punctuation">)</span>

    heading2<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
    lmain <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>master<span class="token operator">=</span>root<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> bd<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    lmain2 <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>master<span class="token operator">=</span>root<span class="token punctuation">,</span> bd<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

    lmain3 <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>master<span class="token operator">=</span>root<span class="token punctuation">,</span> bd<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"#CDCDCD"</span><span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>
    lmain<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">)</span>
    lmain<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">)</span>
    lmain3<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
    lmain3<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">960</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">)</span>
    lmain2<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>RIGHT<span class="token punctuation">)</span>
    lmain2<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">900</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">350</span><span class="token punctuation">)</span>

    root<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Photo To Emoji"</span><span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string">"1400x800+100+10"</span><span class="token punctuation">)</span>
    root<span class="token punctuation">[</span><span class="token string">'bg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'black'</span>
    exitbutton <span class="token operator">=</span> Button<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'Quit'</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>root<span class="token punctuation">.</span>destroy<span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'arial'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>BOTTOM<span class="token punctuation">)</span>

    <span class="token comment"># 调度 show_vid_combined 和 show_vid2</span>
    root<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_vid_combined<span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_vid2<span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d5164ac14da3412b2cc0e6043fe6a55/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">硬件SPI通信协议</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bb727e9b519418ca7c7487f36907c8d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">公开Java框架开源到Maven中央仓库（避坑）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>