<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>影响linux服务器性能的因素 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="影响linux服务器性能的因素" />
<meta property="og:description" content="操作系统级
CPU
内存
磁盘I/O带宽
网络I/O带宽程序应用级 二、系统性能评估标准
影响性能因素
其中：
%user：表示CPU处在用户模式下的时间百分比。
%sys：表示CPU处在系统模式下的时间百分比。
%iowait：表示CPU等待输入输出完成时间的百分比。
swap in：即si，表示虚拟内存的页导入，即从SWAP DISK交换到RAM
swap out：即so，表示虚拟内存的页导出，即从RAM交换到SWAP DISK。
三、系统性能分析工具
1.常用系统命令
Vmstat、sar、iostat、netstat、free、ps、top等
2.常用组合方式
• 用vmstat、sar、iostat检测是否是CPU瓶颈
• 用free、vmstat检测是否是内存瓶颈
• 用iostat检测是否是磁盘I/O瓶颈
• 用netstat检测是否是网络带宽瓶颈
四、Linux性能评估与优化
系统整体性能评估（uptime命令）
这里需要注意的是：load average这个输出值，这三个值的大小一般不能大于系统CPU的个数，例如，本输出中系统有8个CPU,如果load average的三个值长期大于8时，说明CPU很繁忙，负载很高，可能会影响系统性能，但是偶尔大于8时，倒不用担心，一般不会影响系统性能。相反，如果load average的输出值小于CPU的个数，则表示CPU还有空闲的时间片，比如本例中的输出，CPU是非常空闲的。
CPU性能评估
（1）利用vmstat命令监控系统CPU
该命令可以显示关于系统各种资源之间相关性能的简要信息，这里我们主要用它来看CPU一个负载情况。
下面是vmstat命令在某个系统的输出结果：
Procs
r列表示运行和等待cpu时间片的进程数，这个值如果长期大于系统CPU的个数，说明CPU不足，需要增加CPU。
b列表示在等待资源的进程数，比如正在等待I/O、或者内存交换等。
Cpu
us列显示了用户进程消耗的CPU 时间百分比。us的值比较高时，说明用户进程消耗的cpu时间多，但是如果长期大于50%，就需要考虑优化程序或算法。
sy列显示了内核进程消耗的CPU时间百分比。Sy的值较高时，说明内核消耗的CPU资源很多。
根据经验，us&#43;sy的参考值为80%，如果us&#43;sy大于 80%说明可能存在CPU资源不足。
（2）利用sar命令监控系统CPU
sar功能很强大，可以对系统的每个方面进行单独的统计，但是使用sar命令会增加系统开销，不过这些开销是可以评估的，对系统的统计结果不会有很大影响。
下面是sar命令对某个系统的CPU统计输出：
对上面每项的输出解释如下：
%user列显示了用户进程消耗的CPU 时间百分比。
%nice列显示了运行正常进程所消耗的CPU 时间百分比。
%system列显示了系统进程消耗的CPU时间百分比。
%iowait列显示了IO等待所占用的CPU时间百分比
%steal列显示了在内存相对紧张的环境下pagein强制对不同的页面进行的steal操作 。
%idle列显示了CPU处在空闲状态的时间百分比。
问题
1.你是否遇到过系统CPU整体利用率不高，而应用缓慢的现象？
在一个多CPU的系统中，如果程序使用了单线程，会出现这么一个现象，CPU的整体使用率不高，但是系统应用却响应缓慢，这可能是由于程序使用单线程的原因，单线程只使用一个CPU，导致这个CPU占用率为100%，无法处理其它请求，而其它的CPU却闲置，这就导致了整体CPU使用率不高，而应用缓慢现象的发生。
内存性能评估
（1）利用free指令监控内存
free是监控linux内存使用状况最常用的指令，看下面的一个输出：
一般有这样一个经验公式：应用程序可用内存/系统物理内存&gt;70%时，表示系统内存资源非常充足，不影响系统性能，应用程序可用内存/系统物理内存&lt;20%时，表示系统内存资源紧缺，需要增加系统内存，20%&lt;应用程序可用内存/系统物理内存&lt;70%时，表示系统内存资源基本能满足应用需求，暂时不影响系统性能。
（2）利用vmstat命令监控内存" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b56afe117448bd538a6f47e7b4b70d12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-14T15:03:23+08:00" />
<meta property="article:modified_time" content="2019-05-14T15:03:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">影响linux服务器性能的因素</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ol><li>操作系统级<br> CPU<br> 内存<br> 磁盘I/O带宽<br> 网络I/O带宽</li><li>程序应用级</li></ol> 
<p>二、系统性能评估标准<br> 影响性能因素</p> 
<p>其中：<br> %user：表示CPU处在用户模式下的时间百分比。<br> %sys：表示CPU处在系统模式下的时间百分比。<br> %iowait：表示CPU等待输入输出完成时间的百分比。<br> swap in：即si，表示虚拟内存的页导入，即从SWAP DISK交换到RAM<br> swap out：即so，表示虚拟内存的页导出，即从RAM交换到SWAP DISK。</p> 
<p>三、系统性能分析工具<br> 1.常用系统命令<br> Vmstat、sar、iostat、netstat、free、ps、top等</p> 
<p>2.常用组合方式<br> • 用vmstat、sar、iostat检测是否是CPU瓶颈<br> • 用free、vmstat检测是否是内存瓶颈<br> • 用iostat检测是否是磁盘I/O瓶颈<br> • 用netstat检测是否是网络带宽瓶颈</p> 
<p>四、Linux性能评估与优化</p> 
<p>系统整体性能评估（uptime命令）</p> 
<p>这里需要注意的是：load average这个输出值，这三个值的大小一般不能大于系统CPU的个数，例如，本输出中系统有8个CPU,如果load average的三个值长期大于8时，说明CPU很繁忙，负载很高，可能会影响系统性能，但是偶尔大于8时，倒不用担心，一般不会影响系统性能。相反，如果load average的输出值小于CPU的个数，则表示CPU还有空闲的时间片，比如本例中的输出，CPU是非常空闲的。</p> 
<p>CPU性能评估<br> （1）利用vmstat命令监控系统CPU<br> 该命令可以显示关于系统各种资源之间相关性能的简要信息，这里我们主要用它来看CPU一个负载情况。<br> 下面是vmstat命令在某个系统的输出结果：<br> Procs<br> r列表示运行和等待cpu时间片的进程数，这个值如果长期大于系统CPU的个数，说明CPU不足，需要增加CPU。<br> b列表示在等待资源的进程数，比如正在等待I/O、或者内存交换等。</p> 
<p>Cpu<br> us列显示了用户进程消耗的CPU 时间百分比。us的值比较高时，说明用户进程消耗的cpu时间多，但是如果长期大于50%，就需要考虑优化程序或算法。</p> 
<p>sy列显示了内核进程消耗的CPU时间百分比。Sy的值较高时，说明内核消耗的CPU资源很多。<br> 根据经验，us+sy的参考值为80%，如果us+sy大于 80%说明可能存在CPU资源不足。</p> 
<p>（2）利用sar命令监控系统CPU</p> 
<p>sar功能很强大，可以对系统的每个方面进行单独的统计，但是使用sar命令会增加系统开销，不过这些开销是可以评估的，对系统的统计结果不会有很大影响。</p> 
<p>下面是sar命令对某个系统的CPU统计输出：</p> 
<p>对上面每项的输出解释如下：</p> 
<p>%user列显示了用户进程消耗的CPU 时间百分比。<br> %nice列显示了运行正常进程所消耗的CPU 时间百分比。<br> %system列显示了系统进程消耗的CPU时间百分比。<br> %iowait列显示了IO等待所占用的CPU时间百分比<br> %steal列显示了在内存相对紧张的环境下pagein强制对不同的页面进行的steal操作 。<br> %idle列显示了CPU处在空闲状态的时间百分比。<br> 问题<br> 1.你是否遇到过系统CPU整体利用率不高，而应用缓慢的现象？</p> 
<p>在一个多CPU的系统中，如果程序使用了单线程，会出现这么一个现象，CPU的整体使用率不高，但是系统应用却响应缓慢，这可能是由于程序使用单线程的原因，单线程只使用一个CPU，导致这个CPU占用率为100%，无法处理其它请求，而其它的CPU却闲置，这就导致了整体CPU使用率不高，而应用缓慢现象的发生。</p> 
<p>内存性能评估<br> （1）利用free指令监控内存<br> free是监控linux内存使用状况最常用的指令，看下面的一个输出：</p> 
<p>一般有这样一个经验公式：应用程序可用内存/系统物理内存&gt;70%时，表示系统内存资源非常充足，不影响系统性能，应用程序可用内存/系统物理内存&lt;20%时，表示系统内存资源紧缺，需要增加系统内存，20%&lt;应用程序可用内存/系统物理内存&lt;70%时，表示系统内存资源基本能满足应用需求，暂时不影响系统性能。</p> 
<p>（2）利用vmstat命令监控内存</p> 
<p>swpd列表示切换到内存交换区的内存数量（以k为单位）。如果swpd的值不为0，或者比较大，只要si、so的值长期为0，这种情况下一般不用担心，不会影响系统性能。<br> free列表示当前空闲的物理内存数量（以k为单位）<br> buff列表示buffers cache的内存数量，一般对块设备的读写才需要缓冲。<br> cache列表示page cached的内存数量，一般作为文件系统cached，频繁访问的文件都会被cached，如果cache值较大，说明cached的文件数较多，如果此时IO中bi比较小，说明文件系统效率比较好。</p> 
<p>swap<br> si列表示由磁盘调入内存，也就是内存进入内存交换区的数量。<br> so列表示由内存调入磁盘，也就是内存交换区进入内存的数量。<br> 一般情况下，si、so的值都为0，如果si、so的值长期不为0，则表示系统内存不足。需要增加系统内存。</p> 
<p>4.磁盘I/O性能评估<br> （1）磁盘存储基础</p> 
<p>熟悉RAID存储方式，可以根据应用的不同，选择不同的RAID方式。<br> 尽可能用内存的读写代替直接磁盘I/O，使频繁访问的文件或数据放入内存中进行操作处理，因为内存读写操作比直接磁盘读写的效率要高千倍。<br> 将经常进行读写的文件与长期不变的文件独立出来，分别放置到不同的磁盘设备上。<br> 对于写操作频繁的数据，可以考虑使用裸设备代替文件系统。<br> 使用裸设备的优点有：</p> 
<p>数据可以直接读写，不需要经过操作系统级的缓存，节省了内存资源，避免了内存资源争用。<br> 避免了文件系统级的维护开销，比如文件系统需要维护超级块、I-node等。<br> 避免了操作系统的cache预读功能，减少了I/O请求。<br> 使用裸设备的缺点是：</p> 
<p>数据管理、空间管理不灵活，需要很专业的人来操作。<br> （2）利用iostat评估磁盘性能</p> 
<p>对上面每项的输出解释如下：</p> 
<p>Blk_read/s表示每秒读取的数据块数。<br> Blk_wrtn/s表示每秒写入的数据块数。<br> Blk_read表示读取的所有块数。<br> Blk_wrtn表示写入的所有块数。<br> 可以通过Blk_read/s和Blk_wrtn/s的值对磁盘的读写性能有一个基本的了解，如果Blk_wrtn/s值很大，表示磁盘的写操作很频繁，可以考虑优化磁盘或者优化程序，如果Blk_read/s值很大，表示磁盘直接读取操作很多，可以将读取的数据放入内存中进行操作。<br> 对于这两个选项的值没有一个固定的大小，根据系统应用的不同，会有不同的值，但是有一个规则还是可以遵循的：长期的、超大的数据读写，肯定是不正常的，这种情况一定会影响系统性能。<br> （3）利用sar评估磁盘性能<br> 通过“sar –d”组合，可以对系统的磁盘IO做一个基本的统计，请看下面的一个输出：</p> 
<p>需要关注的几个参数含义：</p> 
<p>await表示平均每次设备I/O操作的等待时间（以毫秒为单位）。<br> svctm表示平均每次设备I/O操作的服务时间（以毫秒为单位）。<br> %util表示一秒中有百分之几的时间用于I/O操作。<br> 对以磁盘IO性能，一般有如下评判标准：</p> 
<p>正常情况下svctm应该是小于await值的，而svctm的大小和磁盘性能有关，CPU、内存的负荷也会对svctm值造成影响，过多的请求也会间接的导致svctm值的增加。</p> 
<p>await值的大小一般取决与svctm的值和I/O队列长度以及I/O请求模式，如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，系统上运行的应用程序将变慢，此时可以通过更换更快的硬盘来解决问题。</p> 
<p>%util项的值也是衡量磁盘I/O的一个重要指标，如果%util接近100%，表示磁盘产生的I/O请求太多，I/O系统已经满负荷的在工作，该磁盘可能存在瓶颈。长期下去，势必影响系统的性能，可以通过优化程序或者通过更换更高、更快的磁盘来解决此问题。</p> 
<p>网络性能评估<br> （1）通过ping命令检测网络的连通性<br> （2）通过netstat –i组合检测网络接口状况<br> （3）通过netstat –r组合检测系统的路由表信息<br> （4）通过sar –n组合显示系统的网络运行状态</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8bfb20e280ed1746a17cde85f2a293a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TCP的三次握手和四次挥手</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/540bc1d6e2586d42337ac7b8c78473df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">好压压缩文件目录乱码的解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>