<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>elasticsearch 内网下如何以离线的方式上传任意的huggingFace上的NLP模型（国内避坑指南） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="elasticsearch 内网下如何以离线的方式上传任意的huggingFace上的NLP模型（国内避坑指南）" />
<meta property="og:description" content="es自2020年的8.x版本以来，就提供了机器学习的能力。我们可以使用es官方提供的工具eland，将hugging face上的NLP模型，上传到es集群中。利用es的机器学习模块，来运维部署管理模型。配合es的管道处理，来更加便捷的处理数据。 但是在国内操作，根据官方文档或者根据官方博客操作，有无穷无尽的坑。看着官方的文档写的很清楚，实际上操作的时候，还是操作不下来。这里写一个闭坑指南。 在你上车体验ES的机器学习之前，看看我这篇文章，肯定是会有收获的。因为我已经花了时间，踩了坑，并解决了它。 上传模型存在的坑 第一个坑是，es的机器学习，是收费的功能，白金版才能使用。这里需要开启试用才能用（试用期限为一个月）。如果只是体验，一个月已经足够了。体验效果不错，就可以找老板花钱了。（不过网上也有很多绿色的方案，可以用，不推荐，有法律风险，特别是商用）开启白金试用，需要开启xpack安全认证，开启用户认证，在kibana上登录的时候，要使用elastic用户登录，否则无法开启试用，会告诉你无权限。网络环境问题。如果你能开启科学上网，肯定可以避免问题。但是即使有科学上网，也只是体验一下。并不是生产实践方案，生产环境通常都是在内网环境下，即使能上网，也肯定是在国内网络环境下。这会有各种各样的问题。所以要做我们就做生产环境版本，要做就做离线版本。举一个最简答的例子，国内的网络，很难访问huggingface，去拉取模型。 这里是我直接使用eland，上传模型的时候遇到的错误。
docker run -it -v /u01/isi/.cache/huggingface/hub/:/usr/local/bin/eland_import_hub_model --rm elastic/eland \ eland_import_hub_model \ --url http://elastic:123123@10.99.100.49:9200 \ --hub-model-id sentence-transformers/clip-ViT-B-32-multilingual-v1 \ --task-type text_embedding \ --start 报错为无法访问huggingface.co 国内域名污染导致的。如果可以挂代理，可以解决。如果没有代理，则看下边离线安装版本
2023-11-22 09:40:30,738 INFO : Establishing connection to Elasticsearch 2023-11-22 09:40:30,751 INFO : Connected to cluster named &#39;es&#39; (version: 8.8.0) 2023-11-22 09:40:30,752 INFO : Loading HuggingFace transformer tokenizer and model &#39;sentence-transformers/clip-ViT-B-32-multilingual-v1&#39; &#39;HTTPSConnectionPool(host=&#39;huggingface.co&#39;, port=443): Max retries exceeded with url: /sentence-transformers/clip-ViT-B-32-multilingual-v1/resolve/main/tokenizer_config.json (Caused by ConnectTimeoutError(&lt;urllib3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ca39eee0599c37f418996e7b683048be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-03T15:02:24+08:00" />
<meta property="article:modified_time" content="2023-12-03T15:02:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">elasticsearch 内网下如何以离线的方式上传任意的huggingFace上的NLP模型（国内避坑指南）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <div>
           es自2020年的8.x版本以来，就提供了机器学习的能力。我们可以使用es官方提供的工具eland，将hugging face上的NLP模型，上传到es集群中。利用es的机器学习模块，来运维部署管理模型。配合es的管道处理，来更加便捷的处理数据。 
 </div> 
 <div>
           但是在国内操作，根据官方文档或者根据官方博客操作，有无穷无尽的坑。看着官方的文档写的很清楚，实际上操作的时候，还是操作不下来。这里写一个闭坑指南。 
 </div> 
 <div>
           在你上车体验ES的机器学习之前，看看我这篇文章，肯定是会有收获的。因为我已经花了时间，踩了坑，并解决了它。 
 </div> 
</blockquote> 
<h2>上传模型存在的坑</h2> 
<ol><li>第一个坑是，es的机器学习，是收费的功能，白金版才能使用。这里需要开启试用才能用（试用期限为一个月）。如果只是体验，一个月已经足够了。体验效果不错，就可以找老板花钱了。（不过网上也有很多绿色的方案，可以用，不推荐，有法律风险，特别是商用）</li><li>开启白金试用，需要开启xpack安全认证，开启用户认证，在kibana上登录的时候，要使用elastic用户登录，否则无法开启试用，会告诉你无权限。</li><li>网络环境问题。如果你能开启科学上网，肯定可以避免问题。但是即使有科学上网，也只是体验一下。并不是生产实践方案，生产环境通常都是在内网环境下，即使能上网，也肯定是在国内网络环境下。这会有各种各样的问题。所以要做我们就做生产环境版本，要做就做离线版本。举一个最简答的例子，国内的网络，很难访问huggingface，去拉取模型。 <p>这里是我直接使用eland，上传模型的时候遇到的错误。</p> <pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">docker run </span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">it   </span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v </span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">u01</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">isi</span><span style="color:#9a6e3a;">/</span><span style="color:#999999;">.</span><span style="color:#000000;">cache</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">huggingface</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">hub</span><span style="color:#9a6e3a;">/</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">usr</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">local</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">bin</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">eland_import_hub_model  </span><span style="color:#708090;">--rm elastic/eland \</span>
<span style="color:#000000;">eland_import_hub_model \</span>
<span style="color:#708090;">--url http://elastic:123123@10.99.100.49:9200 \</span>
<span style="color:#708090;">--hub-model-id sentence-transformers/clip-ViT-B-32-multilingual-v1 \</span>
<span style="color:#708090;">--task-type text_embedding \</span>
<span style="color:#708090;">--start</span>
</code></span>
</pre> <p style="margin-left:0;text-align:left;"><span style="color:#333333;">报错为无法访问</span><a href="http://huggingface.co" rel="nofollow" title="huggingface.co">huggingface.co</a><span style="color:#333333;"> 国内域名污染导致的。如果可以挂代理，可以解决。如果没有代理，则看下边离线安装版本</span></p> <pre><span style="background-color:#fafafa;"><code><span style="color:#990055;">2023</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">11</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">22</span> <span style="color:#990055;">09</span><span style="color:#999999;">:</span><span style="color:#990055;">40</span><span style="color:#999999;">:</span><span style="color:#990055;">30</span><span style="color:#999999;">,</span><span style="color:#990055;">738</span><span style="color:#000000;"> INFO </span><span style="color:#999999;">:</span><span style="color:#000000;"> Establishing connection </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> Elasticsearch</span>
<span style="color:#990055;">2023</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">11</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">22</span> <span style="color:#990055;">09</span><span style="color:#999999;">:</span><span style="color:#990055;">40</span><span style="color:#999999;">:</span><span style="color:#990055;">30</span><span style="color:#999999;">,</span><span style="color:#990055;">751</span><span style="color:#000000;"> INFO </span><span style="color:#999999;">:</span><span style="color:#000000;"> Connected </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> cluster named 'es' </span><span style="color:#999999;">(</span><span style="color:#000000;">version</span><span style="color:#999999;">:</span> <span style="color:#990055;">8.8.0</span><span style="color:#999999;">)</span>
<span style="color:#990055;">2023</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">11</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">22</span> <span style="color:#990055;">09</span><span style="color:#999999;">:</span><span style="color:#990055;">40</span><span style="color:#999999;">:</span><span style="color:#990055;">30</span><span style="color:#999999;">,</span><span style="color:#990055;">752</span><span style="color:#000000;"> INFO </span><span style="color:#999999;">:</span><span style="color:#000000;"> Loading HuggingFace transformer tokenizer </span><span style="color:#9a6e3a;">and</span><span style="color:#000000;"> model 'sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1'</span>
<span style="color:#000000;">'</span><span style="color:#dd4a68;">HTTPSConnectionPool</span><span style="color:#999999;">(</span><span style="color:#000000;">host</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">'huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co'</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">port</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">443</span><span style="color:#999999;">):</span><span style="color:#000000;"> Max retries exceeded </span><span style="color:#0077aa;">with</span><span style="color:#000000;"> url</span><span style="color:#999999;">:</span> <span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">tokenizer_config</span><span style="color:#999999;">.</span><span style="color:#000000;">json </span><span style="color:#999999;">(</span><span style="color:#000000;">Caused by </span><span style="color:#dd4a68;">ConnectTimeoutError</span><span style="color:#999999;">(</span><span style="color:#9a6e3a;">&lt;</span><span style="color:#000000;">urllib3</span><span style="color:#999999;">.</span><span style="color:#000000;">connection</span><span style="color:#999999;">.</span><span style="color:#000000;">HTTPSConnection object at </span><span style="color:#990055;">0</span><span style="color:#000000;">x7f50eb16cc10</span><span style="color:#9a6e3a;">&gt;</span><span style="color:#999999;">,</span><span style="color:#000000;"> 'Connection </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co timed </span><span style="color:#0077aa;">out</span><span style="color:#999999;">.</span> <span style="color:#999999;">(</span><span style="color:#000000;">connect timeout</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">10</span><span style="color:#999999;">)</span><span style="color:#000000;">'</span><span style="color:#999999;">))</span><span style="color:#000000;">' thrown </span><span style="color:#0077aa;">while</span><span style="color:#000000;"> requesting HEAD https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">tokenizer_config</span><span style="color:#999999;">.</span><span style="color:#000000;">json</span>
<span style="color:#990055;">2023</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">11</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">22</span> <span style="color:#990055;">09</span><span style="color:#999999;">:</span><span style="color:#990055;">40</span><span style="color:#999999;">:</span><span style="color:#990055;">41</span><span style="color:#999999;">,</span><span style="color:#990055;">125</span><span style="color:#000000;"> WARNING </span><span style="color:#999999;">:</span><span style="color:#000000;"> '</span><span style="color:#dd4a68;">HTTPSConnectionPool</span><span style="color:#999999;">(</span><span style="color:#000000;">host</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">'huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co'</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">port</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">443</span><span style="color:#999999;">):</span><span style="color:#000000;"> Max retries exceeded </span><span style="color:#0077aa;">with</span><span style="color:#000000;"> url</span><span style="color:#999999;">:</span> <span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">tokenizer_config</span><span style="color:#999999;">.</span><span style="color:#000000;">json </span><span style="color:#999999;">(</span><span style="color:#000000;">Caused by </span><span style="color:#dd4a68;">ConnectTimeoutError</span><span style="color:#999999;">(</span><span style="color:#9a6e3a;">&lt;</span><span style="color:#000000;">urllib3</span><span style="color:#999999;">.</span><span style="color:#000000;">connection</span><span style="color:#999999;">.</span><span style="color:#000000;">HTTPSConnection object at </span><span style="color:#990055;">0</span><span style="color:#000000;">x7f50eb16cc10</span><span style="color:#9a6e3a;">&gt;</span><span style="color:#999999;">,</span><span style="color:#000000;"> 'Connection </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co timed </span><span style="color:#0077aa;">out</span><span style="color:#999999;">.</span> <span style="color:#999999;">(</span><span style="color:#000000;">connect timeout</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">10</span><span style="color:#999999;">)</span><span style="color:#000000;">'</span><span style="color:#999999;">))</span><span style="color:#000000;">' thrown </span><span style="color:#0077aa;">while</span><span style="color:#000000;"> requesting HEAD https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">tokenizer_config</span><span style="color:#999999;">.</span><span style="color:#000000;">json</span>
<span style="color:#000000;">'</span><span style="color:#dd4a68;">HTTPSConnectionPool</span><span style="color:#999999;">(</span><span style="color:#000000;">host</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">'huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co'</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">port</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">443</span><span style="color:#999999;">):</span><span style="color:#000000;"> Max retries exceeded </span><span style="color:#0077aa;">with</span><span style="color:#000000;"> url</span><span style="color:#999999;">:</span> <span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">config</span><span style="color:#999999;">.</span><span style="color:#000000;">json </span><span style="color:#999999;">(</span><span style="color:#000000;">Caused by </span><span style="color:#dd4a68;">ConnectTimeoutError</span><span style="color:#999999;">(</span><span style="color:#9a6e3a;">&lt;</span><span style="color:#000000;">urllib3</span><span style="color:#999999;">.</span><span style="color:#000000;">connection</span><span style="color:#999999;">.</span><span style="color:#000000;">HTTPSConnection object at </span><span style="color:#990055;">0</span><span style="color:#000000;">x7f50eb16cfd0</span><span style="color:#9a6e3a;">&gt;</span><span style="color:#999999;">,</span><span style="color:#000000;"> 'Connection </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co timed </span><span style="color:#0077aa;">out</span><span style="color:#999999;">.</span> <span style="color:#999999;">(</span><span style="color:#000000;">connect timeout</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">10</span><span style="color:#999999;">)</span><span style="color:#000000;">'</span><span style="color:#999999;">))</span><span style="color:#000000;">' thrown </span><span style="color:#0077aa;">while</span><span style="color:#000000;"> requesting HEAD https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">config</span><span style="color:#999999;">.</span><span style="color:#000000;">json</span>
<span style="color:#990055;">2023</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">11</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">22</span> <span style="color:#990055;">09</span><span style="color:#999999;">:</span><span style="color:#990055;">40</span><span style="color:#999999;">:</span><span style="color:#990055;">51</span><span style="color:#999999;">,</span><span style="color:#990055;">583</span><span style="color:#000000;"> WARNING </span><span style="color:#999999;">:</span><span style="color:#000000;"> '</span><span style="color:#dd4a68;">HTTPSConnectionPool</span><span style="color:#999999;">(</span><span style="color:#000000;">host</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">'huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co'</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">port</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">443</span><span style="color:#999999;">):</span><span style="color:#000000;"> Max retries exceeded </span><span style="color:#0077aa;">with</span><span style="color:#000000;"> url</span><span style="color:#999999;">:</span> <span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">config</span><span style="color:#999999;">.</span><span style="color:#000000;">json </span><span style="color:#999999;">(</span><span style="color:#000000;">Caused by </span><span style="color:#dd4a68;">ConnectTimeoutError</span><span style="color:#999999;">(</span><span style="color:#9a6e3a;">&lt;</span><span style="color:#000000;">urllib3</span><span style="color:#999999;">.</span><span style="color:#000000;">connection</span><span style="color:#999999;">.</span><span style="color:#000000;">HTTPSConnection object at </span><span style="color:#990055;">0</span><span style="color:#000000;">x7f50eb16cfd0</span><span style="color:#9a6e3a;">&gt;</span><span style="color:#999999;">,</span><span style="color:#000000;"> 'Connection </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co timed </span><span style="color:#0077aa;">out</span><span style="color:#999999;">.</span> <span style="color:#999999;">(</span><span style="color:#000000;">connect timeout</span><span style="color:#9a6e3a;">=</span><span style="color:#990055;">10</span><span style="color:#999999;">)</span><span style="color:#000000;">'</span><span style="color:#999999;">))</span><span style="color:#000000;">' thrown </span><span style="color:#0077aa;">while</span><span style="color:#000000;"> requesting HEAD https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">resolve</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">main</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">config</span><span style="color:#999999;">.</span><span style="color:#000000;">json</span>
<span style="color:#000000;">Traceback </span><span style="color:#999999;">(</span><span style="color:#000000;">most recent call last</span><span style="color:#999999;">):</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/utils/hub.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">409</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> cached_file</span>
<span style="color:#000000;">    resolved_file </span><span style="color:#9a6e3a;">=</span> <span style="color:#dd4a68;">hf_hub_download</span><span style="color:#999999;">(</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/huggingface_hub/utils/_validators.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">118</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> _inner_fn</span>
    <span style="color:#0077aa;">return</span> <span style="color:#dd4a68;">fn</span><span style="color:#999999;">(</span><span style="color:#9a6e3a;">*</span><span style="color:#000000;">args</span><span style="color:#999999;">,</span> <span style="color:#9a6e3a;">**</span><span style="color:#000000;">kwargs</span><span style="color:#999999;">)</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/huggingface_hub/file_download.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">1291</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> hf_hub_download</span>
<span style="color:#000000;">    raise </span><span style="color:#dd4a68;">LocalEntryNotFoundError</span><span style="color:#999999;">(</span>
<span style="color:#000000;">huggingface_hub</span><span style="color:#999999;">.</span><span style="color:#000000;">utils</span><span style="color:#999999;">.</span><span style="color:#000000;">_errors</span><span style="color:#999999;">.</span><span style="color:#000000;">LocalEntryNotFoundError</span><span style="color:#999999;">:</span><span style="color:#000000;"> Connection error</span><span style="color:#999999;">,</span> <span style="color:#9a6e3a;">and</span><span style="color:#000000;"> we cannot find the requested files </span><span style="color:#0077aa;">in</span><span style="color:#000000;"> the disk cache</span><span style="color:#999999;">.</span><span style="color:#000000;"> Please try again </span><span style="color:#9a6e3a;">or</span><span style="color:#000000;"> make sure your Internet connection </span><span style="color:#0077aa;">is</span> <span style="color:#0077aa;">on</span><span style="color:#999999;">.</span>

<span style="color:#000000;">During handling </span><span style="color:#0077aa;">of</span><span style="color:#000000;"> the above exception</span><span style="color:#999999;">,</span><span style="color:#000000;"> another exception occurred</span><span style="color:#999999;">:</span>

<span style="color:#000000;">Traceback </span><span style="color:#999999;">(</span><span style="color:#000000;">most recent call last</span><span style="color:#999999;">):</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/bin/eland_import_hub_model"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">219</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span> <span style="color:#9a6e3a;">&lt;</span><span style="color:#000000;">module</span><span style="color:#9a6e3a;">&gt;</span>
<span style="color:#000000;">    tm </span><span style="color:#9a6e3a;">=</span> <span style="color:#dd4a68;">TransformerModel</span><span style="color:#999999;">(</span><span style="color:#000000;">model_id</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">args</span><span style="color:#999999;">.</span><span style="color:#000000;">hub_model_id</span><span style="color:#999999;">,</span><span style="color:#000000;"> task_type</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">args</span><span style="color:#999999;">.</span><span style="color:#000000;">task_type</span><span style="color:#999999;">,</span><span style="color:#000000;"> es_version</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">cluster_version</span><span style="color:#999999;">,</span><span style="color:#000000;"> quantize</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">args</span><span style="color:#999999;">.</span><span style="color:#000000;">quantize</span><span style="color:#999999;">)</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/eland/ml/pytorch/transformers.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">613</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> __init__</span>
<span style="color:#000000;">    self</span><span style="color:#999999;">.</span><span style="color:#000000;">_tokenizer </span><span style="color:#9a6e3a;">=</span><span style="color:#000000;"> transformers</span><span style="color:#999999;">.</span><span style="color:#000000;">AutoTokenizer</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">from_pretrained</span><span style="color:#999999;">(</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/models/auto/tokenization_auto.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">634</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> from_pretrained</span>
<span style="color:#000000;">    config </span><span style="color:#9a6e3a;">=</span><span style="color:#000000;"> AutoConfig</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">from_pretrained</span><span style="color:#999999;">(</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/models/auto/configuration_auto.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">896</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> from_pretrained</span>
<span style="color:#000000;">    config_dict</span><span style="color:#999999;">,</span><span style="color:#000000;"> unused_kwargs </span><span style="color:#9a6e3a;">=</span><span style="color:#000000;"> PretrainedConfig</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">get_config_dict</span><span style="color:#999999;">(</span><span style="color:#000000;">pretrained_model_name_or_path</span><span style="color:#999999;">,</span> <span style="color:#9a6e3a;">**</span><span style="color:#000000;">kwargs</span><span style="color:#999999;">)</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/configuration_utils.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">573</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> get_config_dict</span>
<span style="color:#000000;">    config_dict</span><span style="color:#999999;">,</span><span style="color:#000000;"> kwargs </span><span style="color:#9a6e3a;">=</span><span style="color:#000000;"> cls</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">_get_config_dict</span><span style="color:#999999;">(</span><span style="color:#000000;">pretrained_model_name_or_path</span><span style="color:#999999;">,</span> <span style="color:#9a6e3a;">**</span><span style="color:#000000;">kwargs</span><span style="color:#999999;">)</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/configuration_utils.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">628</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> _get_config_dict</span>
<span style="color:#000000;">    resolved_config_file </span><span style="color:#9a6e3a;">=</span> <span style="color:#dd4a68;">cached_file</span><span style="color:#999999;">(</span>
  <span style="color:#0077aa;">File</span> <span style="color:#669900;">"/usr/local/lib/python3.9/dist-packages/transformers/utils/hub.py"</span><span style="color:#999999;">,</span><span style="color:#000000;"> line </span><span style="color:#990055;">443</span><span style="color:#999999;">,</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> cached_file</span>
<span style="color:#000000;">    raise </span><span style="color:#dd4a68;">EnvironmentError</span><span style="color:#999999;">(</span>
<span style="color:#000000;">OSError</span><span style="color:#999999;">:</span><span style="color:#000000;"> We couldn't connect </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> 'https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co' </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> load this </span><span style="color:#0077aa;">file</span><span style="color:#999999;">,</span><span style="color:#000000;"> couldn't find it </span><span style="color:#0077aa;">in</span><span style="color:#000000;"> the cached files </span><span style="color:#9a6e3a;">and</span><span style="color:#000000;"> it looks like sentence</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">clip</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">ViT</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">B</span><span style="color:#9a6e3a;">-</span><span style="color:#990055;">32</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">multilingual</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">v1 </span><span style="color:#0077aa;">is</span> <span style="color:#9a6e3a;">not</span><span style="color:#000000;"> the path </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> a directory containing a </span><span style="color:#0077aa;">file</span><span style="color:#000000;"> named config</span><span style="color:#999999;">.</span><span style="color:#000000;">json</span><span style="color:#999999;">.</span>
<span style="color:#000000;">Checkout your internet connection </span><span style="color:#9a6e3a;">or</span><span style="color:#000000;"> see how </span><span style="color:#0077aa;">to</span><span style="color:#000000;"> run the </span><span style="color:#990055;">library</span> <span style="color:#0077aa;">in</span><span style="color:#000000;"> offline mode at 'https</span><span style="color:#999999;">:</span><span style="color:#9a6e3a;">//</span><span style="color:#000000;">huggingface</span><span style="color:#999999;">.</span><span style="color:#000000;">co</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">docs</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">transformers</span><span style="color:#9a6e3a;">/</span><span style="color:#000000;">installation#offline</span><span style="color:#9a6e3a;">-</span><span style="color:#000000;">mode'</span><span style="color:#999999;">.</span>
</code></span></pre> <p></p> </li><li>官方指定的向es中导入NLP模型的工具是Eland，下载和构建镜像也是有网络问题，这里需要指定国内的镜像源。</li><li>关于从hugging face上拉取NLP模型的问题。使用eland，它可以根据我们指定的模型id，去hugging face上拉取模型，但是还是国内的网络环境问题，死活拉不下来。因为无法访问huggingface域名。</li><li>目前，截止到2023年12月2号为止。es所谓的机器学习能力，仅支持文本类操作的模型。官方一直在说拥有跨模态的能力。实际上es并不支持，将图片转向量的模型导入到es中（例如常用的CLIP多模态模型，其实它是两部分，双塔模型，一个是将图片做embedding，转成向量。另一个模型是将我们的文本内容做embedding转为向量。其中图片转向量的模型，在es中是不支持上传的，文本转向量的模型是可以上传的）。如下所示，上传clip 将图片转为向量的模型。会报错</li></ol> 
<pre><code>docker run -it   -v /u01/isi/.cache/huggingface/hub/sentence-transformers/clip-vit-base-patch32:/eland/sentence-transformers/clip-vit-base-patch32   --rm elastic/eland \
eland_import_hub_model \
--url http://elastic:123123@10.99.100.49:9200 \
--hub-model-id sentence-transformers/clip-vit-base-patch32 \
--task-type text_embedding \
--start</code></pre> 
<p>报错如下</p> 
<p><img alt="" height="442" src="https://images2.imgbox.com/4b/56/btKEEHBX_o.png" width="1200"></p> 
<h2>准备工作</h2> 
<p>1. 需要搭建一个8.8以上版本的ES集群。默认会开启安全访问认证，不要关它。</p> 
<p>2. 使用源码构建eland工具</p> 
<p>3. 从huggingface上，离线下载NLP模型</p> 
<p>4. 将模型上传到构建eland的服务器上</p> 
<p></p> 
<h2>安装Elasticsearch 和kibana</h2> 
<p> 这里参看以下文章，跟着搭建集群就可以了（其实我整个导入的过程，也是参考的这篇文章，只是在国内安装，遇到了上述的坑）。</p> 
<p style="margin-left:0;text-align:left;"><a href="https://blog.csdn.net/UbuntuTouch/article/details/129312757" title="Elasticsearch：如何在 Elastic 中实现图片相似度搜索_es 相似度查询_Elastic 中国社区官方博客的博客-CSDN博客">Elasticsearch：如何在 Elastic 中实现图片相似度搜索_es 相似度查询_Elastic 中国社区官方博客的博客-CSDN博客</a></p> 
<p></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;"> 搭建的es版本&gt;=8.8.0 ，一定要开安全认证，不然无法开启机器学习的试用，无法导入模型</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">需要kibana</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">开启试用</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="894" src="https://images2.imgbox.com/19/cc/QUZUVXwd_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="768" src="https://images2.imgbox.com/ca/8a/R6YF9Kzt_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="895" src="https://images2.imgbox.com/b9/5a/LRldGmNl_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">可以看到模型</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="744" src="https://images2.imgbox.com/ae/e7/iKoAoA2n_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<h2>安装准备Eland</h2> 
<h3>eland是如何工作的</h3> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;"> Eland 可以从huggingFace上，把模型下载下来，并上传导es中。</span>如下图所示</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="901" src="https://images2.imgbox.com/59/0c/sgnxCeLF_o.png" width="1200"></p> 
<h3>应该如何安装eland</h3> 
<p>这里提供在线的方式，和离线的方式。</p> 
<h4 style="margin-left:0px;text-align:left;"><span style="color:#333333;">Eland 可以通过 pip 从 PyPI 安装</span></h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">在安装之前，我们需要安装好自己的 Python。</span></p> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">$ python --version</span>
<span style="color:#000000;">Python 3.10.2</span>
</code></span>
</pre> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">可以使用 Pip 从 PyPI 安装 Eland：</span></p> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">python -m pip install eland</span></code></span></pre> 
<h4 style="margin-left:0px;text-align:left;"><span style="color:#333333;">可以使用 Conda 从 Conda Forge 安装 Eland</span></h4> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">conda install -c conda-forge eland</span></code></span></pre> 
<h4 style="margin-left:0px;text-align:left;">Docker容器的方式来使用它</h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">希望在不安装 Eland 的情况下使用它，为了只运行可用的脚本，可以构建 Docker 容器。个人认为这种方式是最符合生产环境的部署方式。易交付。可以移植，不依赖网络环境，可以提前构件好，然后将eland镜像导入。</span></p> 
<p style="margin-left:0;text-align:left;"> 第一步需要需要在有网的环境下，下载源码。可以将源码上传到有docker环境的服务器上。（如果没有docker环境，可以以最简单的方式来安装docker，这里就不提供方法了，可以网上搜搜文章，是在不行麻烦麻烦运维同事）</p> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#dd4a68;"># 下载源码
git</span><span style="color:#000000;"> clone https://github.com/elastic/eland

# 这里可以把源码上传到有docker环境的，且能够访问到es集群的服务器上。</span>
<span style="color:#669900;">cd</span><span style="color:#000000;"> eland

这里注意，因为是在国内，我们先pass掉挂代理的事情（并不一定每个人都能挂代理）
这里需要先编辑一下dockerFile，添加指定国内的源。添加如下一行
RUN python3 -m pip install --no-cache-dir --disable-pip-version-check .[all] -i https://mirror.baidu.com/pypi/simple
</span>
#然后构建镜像
<span style="color:#000000;">docker build -t elastic/eland </span><span style="color:#669900;">.</span>
</code></span>
</pre> 
<h2>在huggingface上下载所需的NLP模型</h2> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;"> 在huggingface上找到该模型。（这里可以根据自己的需求，找到合适的模型）这里我以CLIP的模型为例（这个是clip中做文本embedding的模型），来下载。</span></p> 
<p style="margin-left:0;text-align:left;"><a href="https://huggingface.co/sentence-transformers/clip-ViT-B-32-multilingual-v1/tree/main" rel="nofollow" title="https://huggingface.co/sentence-transformers/clip-ViT-B-32-multilingual-v1/tree/main">https://huggingface.co/sentence-transformers/clip-ViT-B-32-multilingual-v1/tree/main</a></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">全部下载下来</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="848" src="https://images2.imgbox.com/a2/2c/1vwyPEK9_o.png" width="1200"></p> 
<p></p> 
<p>然后上传到有eland的服务器上</p> 
<h2>使用eland 将离线模型导入到es集群中</h2> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">我是以docker的方式来运行eland的。 </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">这次主要是加里一个数据卷，我把下载后的模型，放在了 </span><span style="color:#333333;">/u01/isi/.cache/huggingface/hub/sentence-transformers/clip-ViT-B-32-multilingual-v1 下，然后加了一个数据拒卷。把模型映射到了容器中。这里因为服务器无法访问huggingface去拉取模型。所以用离线的方式。eland，会在运行过程中，检查本地有没有模型，如果有模型，就不用去huggingface上拉取了。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">注意eland的挂载目录，docker中映射的是/eland/目录，这样才能读到本地下载好的模型！</span></p> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">docker run -it   -v /u01/isi/.cache/huggingface/hub/:/eland/   --rm elastic/eland \</span>
<span style="color:#000000;">eland_import_hub_model \</span>
<span style="color:#000000;">--url http://elastic:123123@10.99.100.49:9200 \</span>
<span style="color:#000000;">--hub-model-id sentence-transformers/clip-ViT-B-32-multilingual-v1 \</span>
<span style="color:#000000;">--task-type text_embedding \</span>
<span style="color:#000000;">--start</span>
</code></span>
</pre> 
<p>可以看到，这里已经成功的导入模型了。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="317" src="https://images2.imgbox.com/6e/56/ghNDut9j_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">然后在kiabna上，找到模型管理，刷新一下。</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="784" src="https://images2.imgbox.com/dd/a5/vutFiPxu_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">已经成功刷新了出来</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="781" src="https://images2.imgbox.com/8d/2e/ERQRWh0y_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<h2>测试使用模型</h2> 
<p style="margin-left:0;text-align:left;"><span style="color:#333333;">对内容进行文本嵌入，在kiban上执行以下内容。点击D旁边的菜单栏，找到 Dev tools</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="781" src="https://images2.imgbox.com/39/86/8vclyof8_o.png" width="951"></p> 
<pre><span style="background-color:#fafafa;"><code><span style="color:#000000;">POST _ml/trained_models/sentence-transformers__clip-vit-b-32-multilingual-v1/_infer</span>
<span style="color:#999999;">{<!-- --></span>
  <span style="color:#669900;">"docs"</span> <span style="color:#669900;">:</span> <span style="color:#999999;">[</span>
    <span style="color:#999999;">{<!-- --></span><span style="color:#669900;">"text_field"</span><span style="color:#669900;">:</span> <span style="color:#669900;">"Yellow mountain is the most beautiful mountain in China"</span><span style="color:#999999;">}</span>
    <span style="color:#999999;">]</span>
<span style="color:#999999;">}</span></code></span></pre> 
<p>可以看到成功，应用模型，将文本内容，转成了向量。 </p> 
<p><img alt="" height="880" src="https://images2.imgbox.com/c1/de/mGnS6Lmr_o.png" width="1052"></p> 
<div> 
 <p style="margin-left:0;text-align:left;"></p> 
 <h2 style="margin-left:0px;text-align:left;"></h2> 
 <p style="margin-left:0;text-align:left;"></p> 
 <p style="margin-left:0;text-align:left;"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f797e036b66ef216b95051e9480b5cca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">.net 6.0定时任务Quzrtz.net的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56376d371ca9d1d1a8ff69d073a597a0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">半导体封装之倒装封装 （Flip Chip）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>