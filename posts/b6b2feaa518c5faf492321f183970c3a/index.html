<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>1. Elastalert-设计规则 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="1. Elastalert-设计规则" />
<meta property="og:description" content="1.告警规则配置文件
# (Optional)
# Elasticsearch host
# es_host: elasticsearch.example.com
es_host: 1.65.17.102
# (Optional)
# Elasticsearch port
# es_port: 14900
es_port: 9200
# (OptionaL) Connect with SSL to Elasticsearch
#use_ssl: True
# (Optional) basic-auth username and password for Elasticsearch
#es_username: someusername
#es_password: somepassword
# (Required)
# Rule name, must be unique
name: OSPF_LAST_NBR_DOWN(最近一次邻居down)
# (Required)
# Type of alert.
# the frequency rule type alerts when num_events events occur with timeframe time" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b6b2feaa518c5faf492321f183970c3a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-24T15:25:35+08:00" />
<meta property="article:modified_time" content="2020-04-24T15:25:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">1. Elastalert-设计规则</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" src="https://images2.imgbox.com/82/30/ruHkWzKl_o.png"></p> 
<p>1.告警规则配置文件</p> 
<p># (Optional)</p> 
<p># Elasticsearch host</p> 
<p># es_host: <a href="http://elasticsearch.example.com/" rel="nofollow">elasticsearch.example.com</a></p> 
<p>es_host: 1.65.17.102</p> 
<p># (Optional)</p> 
<p># Elasticsearch port</p> 
<p># es_port: 14900</p> 
<p>es_port: 9200</p> 
<p># (OptionaL) Connect with SSL to Elasticsearch</p> 
<p>#use_ssl: True</p> 
<p># (Optional) basic-auth username and password for Elasticsearch</p> 
<p>#es_username: someusername</p> 
<p>#es_password: somepassword</p> 
<p># (Required)</p> 
<p># Rule name, must be unique</p> 
<p>name: OSPF_LAST_NBR_DOWN(最近一次邻居down)</p> 
<p># (Required)</p> 
<p># Type of alert.</p> 
<p># the frequency rule type alerts when num_events events occur with timeframe time</p> 
<p>#type: frequency</p> 
<p>type: any</p> 
<p># (Required)</p> 
<p># Index to search, wildcard supported</p> 
<p>index: logstash-switchlog*</p> 
<p># (Required, frequency specific)</p> 
<p># Alert when this many documents matching the query occur within a timeframe</p> 
<p>num_events: 1</p> 
<p># (Required, frequency specific)</p> 
<p># num_events must occur within this amount of time to trigger an alert</p> 
<p>timeframe:</p> 
<p>minutes: 1</p> 
<p># (Required)</p> 
<p># A list of Elasticsearch filters used for find events</p> 
<p># These filters are joined with AND and nested in a filtered query</p> 
<p># For more info: <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl.html" rel="nofollow">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl.html</a></p> 
<p>filter:</p> 
<p>- query:</p> 
<p>query_string:</p> 
<p>query: "OSPF_LAST_NBR_DOWN"</p> 
<p>#SMTP configration</p> 
<p>smtp_host: <a href="http://smtp.163.com/" rel="nofollow">smtp.163.com</a></p> 
<p>smtp_port: 25</p> 
<p>#</p> 
<p>#SMTP auth</p> 
<p>smtp_auth_file: /etc/elastalert/rules/smtp_auth_file.yaml</p> 
<p>email_reply_to: <a href="mailto:rrx_hostmonitor@163.com" rel="nofollow">rrx_hostmonitor@163.com</a></p> 
<p>from_addr: <a href="mailto:rrx_hostmonitor@163.com" rel="nofollow">rrx_hostmonitor@163.com</a></p> 
<p>#</p> 
<p># (Required)</p> 
<p># The alert is use when a match is found</p> 
<p>alert:</p> 
<p>- "email"</p> 
<p>- "post"</p> 
<p> </p> 
<p>http_post_url: "<a href="http://100.76.37.22/recevice_api/" rel="nofollow">http://100.76.37.22/recevice_api/</a>"</p> 
<p>http_post_static_payload:</p> 
<p>rule_name: OSPF_LAST_NBR_DOWN(最近一次邻居down)</p> 
<p># (required, email specific)</p> 
<p># a list of email addresses to send alerts to</p> 
<p>email:</p> 
<p>- "magj@<a href="http://jiedaibao.com/" rel="nofollow">jiedaibao.com</a>"</p> 
<p>- "suohw@<a href="http://jiedaibao.com/" rel="nofollow">jiedaibao.com</a>"</p> 
<p>- "hanyu@<a href="http://jiedaibao.com/" rel="nofollow">jiedaibao.com</a>"</p> 
<p>2.单条告警介绍</p> 
<p>单条告警给予Query DSL 字段查询通过字段匹配 "OSPF_LAST_NBR_DOWN"</p> 
<p>filter:</p> 
<p>- query:</p> 
<p>query_string:</p> 
<p>query: "OSPF_LAST_NBR_DOWN"</p> 
<p> </p> 
<p>3.组合告警介绍</p> 
<p>组合告警给予Query DSL 符合查询语句，查询ES数据库 字符串包含 “100.66.11.201 100.66.11.202 LINK_UPDOWN PHY_UPDOWN LLDP_DELETE_NEIGHBOR OSPF_NBR_CHG ” 告警，至少匹配任意两项字符串"minimum_should_match": "2"，以此类推 如果数字为3 ，任意匹配其中三条将发出告警。 "query": "100.66.11.201 100.66.11.202 LINK_UPDOWN PHY_UPDOWN LLDP_DELETE_NEIGHBOR OSPF_NBR_CHG",</p> 
<p> </p> 
<p>filter:</p> 
<p>- query:</p> 
<p>match:</p> 
<p>"message": {<!-- --></p> 
<p>"query": "100.66.11.201 100.66.11.202 LINK_UPDOWN PHY_UPDOWN LLDP_DELETE_NEIGHBOR OSPF_NBR_CHG",</p> 
<p>"minimum_should_match": "2"</p> 
<p>}</p> 
<p>测试结果如下；</p> 
<p><span class="img-upload-box" id="3HNBKyH0"><span class="info-box"><img class="img-loading" src="https://images2.imgbox.com/a7/2f/ltVjyPWe_o.gif" alt="uploading.4e448015.gif"><span class="operate-box"><span class="upload-msg">转存失败</span><a class="btn btn-redo">重新上传</a><a class="btn btn-cancle">取消</a></span></span></span></p> 
<p>4.规则配置文件介绍说明</p> 
<p>Elastalert的rule规则</p> 
<p>name：配置，每个rule需要有自己独立的name，一旦重复，进程将无法启动。</p> 
<p>type：配置，选择某一种数据验证方式。</p> 
<p>index：配置，从某类索引里读取数据，配置形如：index: logstash-switchlog*，表示匹配logstash-switchlog*名称开头。</p> 
<p>filter：配置，设置向ES请求的过滤条件。</p> 
<p>timeframe：配置，累积触发报警的时长。</p> 
<p>alert：配置，设置触发报警时执行哪些报警手段。不同的type还有自己独特的配置选项。目前ElastAlert 有以下几种自带ruletype： </p> 
<p>any：只要有匹配就报警；</p> 
<p>blacklist：compare_key字段的内容匹配上 blacklist数组里任意内容；</p> 
<p>whitelist：compare_key字段的内容一个都没能匹配上whitelist数组里内容；</p> 
<p>change：在相同query_key条件下，compare_key字段的内容，在 timeframe范围内 发送变化；</p> 
<p>frequency：在相同 query_key条件下，timeframe 范围内有num_events个被过滤出 来的异常；</p> 
<p>spike：在相同query_key条件下，前后两个timeframe范围内数据量相差比例超过spike_height。其中可以通过spike_type设置具体涨跌方向是up,down,both 。还可以通过threshold_ref设置要求上一个周期数据量的下限，threshold_cur设置要求当前周期数据量的下限，如果数据量不到下限，也不触发；</p> 
<p>flatline：timeframe 范围内，数据量小于threshold 阈值；</p> 
<p>new_term：fields字段新出现之前terms_window_size(默认30天)范围内最多的terms_size (默认50)个结果以外的数据；</p> 
<p></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/effcf6ccfa6463d1d40a03b11bc8a115/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Games101课程笔记_lecture22_欧拉视角、拉格朗日视角与物质点法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/098b9f714ef9cdab87e6e9af00fb8b6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GIS技术在水资源领域的应用与发展</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>