<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用第三方拖拽库快速撸一个可视化搭建平台 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用第三方拖拽库快速撸一个可视化搭建平台" />
<meta property="og:description" content="之前一直在研究可视化和零代码搭建相关产品和技术, 最近逛 github 的时候发现一个比较有意思的拖拽开源组件, 就用 vue3 简单撸了一个拖拽搭建的小demo, 供大家参考学习.
可视化拖拽demo项目介绍 空闲时间简单设计了几个功能, 如下:
支持设置拖拽单位(阈值)
支持撤销重做
支持导入和导出 json
支持组件全选 / 组合
技提供了常用的四个基础组件(文本, 图片, 音频, 视频)
因为之前我的技术栈主要是react, 为了让更多小伙伴低成本的上手, 这里项目采用大家比较熟悉的vue3 &#43; vite.
项目采用的拖拽开源库 es-drager, 当然为了更好的显示代码, 也使用了 monaco-editor, 如下是它的代码展示效果:
image.png 整体来说展示效果还是不错的, 为开源作者们点赞.
完整项目仓库地址: https://github.com/MrXujiang/vue3-drag-demo
线上演示地址: drag_demo 可视化拖拽
一些技术实现的介绍 我之前在社区和公众号也写了很多低代码的技术上实现原理, 如
前端图形学实战: 从零实现编辑器的图层管理面板和实时缩略图(vue3 &#43; vite版)
Dooring无代码搭建平台技术演进之路
上面的demo主要实现思路拆解如下:
实现组件从左侧面板拖拽到画布
组件在画布中的移动, 操作(全选, 拉伸, 旋转, 参考线等)
组件属性的配置
可视化的相关操作(导入, 导出, 撤销, 重做等)
1.实现组件从左侧面板拖拽到画布 这里实现也很简单, 我们采用H5的原生api: drag &amp; drop 来实现. 也就是说从左侧面板拖拽到画布, 本质上是数据的移动." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/50aa7f85503e28b314faf5423f12ab4d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-06T08:05:46+08:00" />
<meta property="article:modified_time" content="2023-12-06T08:05:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用第三方拖拽库快速撸一个可视化搭建平台</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p>之前一直在研究可视化和零代码搭建相关产品和技术, 最近逛 <code>github</code> 的时候发现一个比较有意思的拖拽开源组件, 就用 <code>vue3</code> 简单撸了一个拖拽搭建的小demo, 供大家参考学习.</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/6d/5d/KiY3s33E_o.png" alt="6013a31772dfe99f6154ba515032ab3d.png"></p> 
 <figcaption> 
  <br> 
 </figcaption> 
 <h3>可视化拖拽demo项目介绍</h3> 
 <p>空闲时间简单设计了几个功能, 如下:</p> 
 <ul><li><p>支持设置拖拽单位(阈值)</p></li><li><p>支持撤销重做</p></li><li><p>支持导入和导出 json</p></li><li><p>支持组件全选 / 组合</p></li><li><p>技提供了常用的四个基础组件(文本, 图片, 音频, 视频)</p></li></ul> 
 <p>因为之前我的技术栈主要是<code>react</code>, 为了让更多小伙伴低成本的上手, 这里项目采用大家比较熟悉的<code>vue3 + vite</code>.</p> 
 <p>项目采用的拖拽开源库 <code>es-drager</code>, 当然为了更好的显示代码, 也使用了 <code>monaco-editor</code>,  如下是它的代码展示效果:</p> 
 <img src="https://images2.imgbox.com/b3/7c/8oQYSmrK_o.png" alt="5b2990424727cd9b3e7b38b9be8a99c6.png"> 
 <figcaption>
   image.png 
 </figcaption> 
 <p>整体来说展示效果还是不错的, 为开源作者们点赞.</p> 
 <p>完整项目仓库地址: <strong>https://github.com/MrXujiang/vue3-drag-demo</strong></p> 
 <p>线上演示地址: drag_demo 可视化拖拽</p> 
 <h3>一些技术实现的介绍</h3> 
 <p>我之前在社区和公众号也写了很多低代码的技术上实现原理, 如</p> 
 <ul><li><p><a href="" rel="nofollow"><strong>前端图形学实战: 从零实现编辑器的图层管理面板和实时缩略图(vue3 + vite版)</strong></a></p></li><li><p><a href="" rel="nofollow"><strong>Dooring无代码搭建平台技术演进之路</strong></a></p></li></ul> 
 <p>上面的demo主要实现思路拆解如下:</p> 
 <ul><li><p>实现组件从左侧面板拖拽到画布</p></li><li><p>组件在画布中的移动, 操作(全选, 拉伸, 旋转, 参考线等)</p></li><li><p>组件属性的配置</p></li><li><p>可视化的相关操作(导入, 导出, 撤销, 重做等)</p></li></ul> 
 <h4>1.实现组件从左侧面板拖拽到画布</h4> 
 <p>这里实现也很简单, 我们采用H5的原生api: drag &amp; drop 来实现. 也就是说<strong>从左侧面板拖拽到画布, 本质上是数据的移动</strong>.</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/22/df/TVjlv5aM_o.png" alt="5d2a9fda35d079c3a5ec0a817da15a26.png"></p> 
 <p>我们先定义好左侧面板的组件类型:</p> 
 <pre class="has"><code class="language-go">const typeList = reactive(['文本', '图片', '音频', '视频'])</code></pre> 
 <p>然后再设置拖拽到画布的事件行为:</p> 
 <pre class="has"><code class="language-go">&lt;div class="menu"&gt;
  &lt;div
    v-for="item in typeList"
    @click="push(item)"
    :draggable="true"
    @dragstart="addType = item"
  &gt;
    {<!-- -->{ item }}
  &lt;/div&gt;
&lt;/div&gt;</code></pre> 
 <p>相关事件:</p> 
 <pre class="has"><code class="language-go">// 添加
function push(type: string) {
  isupd.value = true;
  switch (type) {
    case '文本':
      data.value.push({
        id: uuid(),
        type: 'text',
        value: '输入文本',
        width: 200,
        height: 50,
        angle: 0,
        ...addDistance.value
      })
      reset()
      break;
    case '图片':
      data.value.push({
        id: uuid(),
        type: 'image',
        value: 'https://turntip.cn/uploads/sucai/11_189dd429f23.webp',
        width: 100,
        height: 100,
        angle: 0,
        ...addDistance.value
      })
      reset()
      break;
    case '音频':
      data.value.push({
        id: uuid(),
        type: 'audio',
        value: 'https://turntip.cn/uploads/sucai/Just Relax_189bfc7d990.mp3',
        width: 300,
        height: 50,
        angle: 0,
        ...addDistance.value
      })
      reset()
      break;
      // ...
  }
}</code></pre> 
 <p>最后在画布上监听拖放事件, 获取“传递的数据”.</p> 
 <pre class="has"><code class="language-go">// 拖进画布的回调
function drop(e: any) {
  addDistance.value = {
    top: e.layerY,
    left: e.layerX
  }
  push(addType.value);
}</code></pre> 
 <p>通过这样的操作, 我们就可以将组件从左侧轻松拖拽到画布的指定位置了.</p> 
 <p>当然实际的低代码设计往往比现在设计的复杂很多, 这里主要是为了方便大家快速理解.</p> 
 <h4>2. 支持组件全选 / 组合</h4> 
 <p>全选和组合实现的思路其实本质上是对数组的操作. 全选的过程中, 我们需要先捕获全选的区域坐标, 然后过滤出这个区域内的组件, 然后批量更新数组中每个选中元素的选中状态:</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/61/9f/KJOWmHNL_o.png" alt="2730c1e482c5adbcb23fcbd74418cecc.png"></p> 
 <figcaption> 
  <br> 
 </figcaption> 
 <p>这里分享一下实现元素组合的逻辑:</p> 
 <pre class="has"><code class="language-go">// 组合
function handleMakeGroup() {
  const selected = data.value.filter(item =&gt; item.selected &amp;&amp; item.type != 'combination');
  if (selected.length &gt; 1) {
    let value: any[] = JSON.parse(JSON.stringify(selected));
    const Unchecked = data.value.filter(item =&gt; !item.selected);
    const top = selected.sort((x, y) =&gt; x.top - y.top)[0].top;
    const left = selected.sort((x, y) =&gt; x.left - y.left)[0].left;
    const widthArr:number[]=[];
    const heightArr:number[]=[]
    selected.forEach(v=&gt;{
      widthArr.push(v.left+v.width-left);
      heightArr.push(v.top+v.height-top)
    })
    const width=widthArr.sort((x,y)=&gt;y-x)[0];
    const height=heightArr.sort((x,y)=&gt;y-x)[0];
    value = value.map(v =&gt; ({
      ...v,
      top: v.top - top,
      left: v.left - left
    }))
    const obj = {
      id: uuid(),
      top,
      left,
      width,
      height,
      selected: true,
      value,
      type: 'combination',
      angle: 0
    }
    data.value = [...Unchecked, obj]
  }
}</code></pre> 
 <p>具体实现代码大家可以参考我创建的 <code>github</code> 仓库.</p> 
 <p>至于其他几个功能比如撤销重做, 导入导出, 都是很基本的操作, 网上也有很多分享, 这里直接上代码:</p> 
 <pre class="has"><code class="language-go">// 纯前端导入并读取文件
function insert({ file, index }: any) {
  // 创建 FileReader 对象
  const reader = new FileReader();
  reader.onloadend = function () {
    data.value[index].value = reader.result;
  };
  // 读取文件并触发 onloadend 事件
  reader.readAsDataURL(file);
}

// 导出文件
function download() {
  const content = editorRef.value.save();
  const jsonData = JSON.stringify(content);
  const downloadLink = document.createElement('a');
  downloadLink.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(jsonData));
  downloadLink.setAttribute('download', 'data.json');
  downloadLink.click();
  visible.value = !visible.value;
}</code></pre> 
 <p>当然项目还有很多不足和需要完善的地方, 欢迎大家一起共建.</p> 
 <img src="https://images2.imgbox.com/1f/9f/7yMmbu09_o.png" alt="000e99068ffb385256a5570bee895b3a.png"> 
 <figcaption>
   image.png 
 </figcaption> 
 <p>完整项目仓库地址: <strong>https://github.com/MrXujiang/vue3-drag-demo</strong></p> 
 <p>线上演示地址: drag_demo 可视化拖拽</p> 
 <p>后续我也会持续迭代和分享Dooring可视化和低代码的最佳实践, 大家感兴趣的欢迎随时和我交流.</p> 
 <p>同时如果你有好的项目, 也可以在《趣谈前端》公众号回复“自荐”, 获取项目自荐流程, 让自己的开源项目让 <strong>5</strong><strong>w+ </strong>程序员看到~</p> 
 <h4>更多推荐</h4> 
 <ul><li><p><a href="" rel="nofollow"><strong>2023年, 前端路上的开源总结(最新更新)</strong></a></p></li><li><p><a href="" rel="nofollow"><strong>低代码平台组件间通信方案复盘</strong></a></p></li><li><p><a href="" rel="nofollow"><strong>前端图形学实战: 从零开发一款轻量级滑动验证码组件(vue3 + vite版)</strong></a></p></li></ul> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a33c9836bac1642b30d5cf89a851676c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[PTA]验证“哥德巴赫猜想”</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2f4443d33cb2a7d7d2c3cbb45f163c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7安装minio</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>