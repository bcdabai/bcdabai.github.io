<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mesh网格撞击变形 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mesh网格撞击变形" />
<meta property="og:description" content="物理碰撞 两个游戏物体发生碰撞的必要条件： 发生碰撞的两个游戏物体有Collider（碰撞器）组件；其中一个物体有Rigidbody（刚体）组件。 MonoBehaviour中的相关回调函数： 回调函数详解OnCollisionEnter (Collision)当前碰撞器开始接触另一个碰撞器时被调用。OnCollisionStay (Collision)当前碰撞器持续接触另一个碰撞器时被调用。OnCollisionExit (Collision)当前碰撞器停止接触另一个碰撞器时被调用。 碰撞数据 物体发生碰撞时的碰撞数据存储于Collision对象中，相关属性：
articulationBody：与当前碰撞器发生碰撞的物体上的Articulation Body组件；body：与当前碰撞器发生碰撞的物体上的Rigidbody或Articulation Body组件；collider：与当前碰撞器发生碰撞的碰撞器；contactCount：碰撞接触点的数量；contacts：碰撞接触点数组，碰撞接触点包含位置和法线数据；gameObject：与当前碰撞器发生碰撞的物体；impulse：碰撞冲量；relativeVelocity：两个碰撞对象的相对线性速度；rigidbody：与当前碰撞器发生碰撞的物体上的Rigidbody组件；transform：与当前碰撞器发生碰撞的物体的Transform组件。 撞击变形 撞击判定：当relativeVelocity的长度大于一定阈值时，可以判定为撞击；网格变形：通过调整撞击物体上的网格顶点，使网格发生形变： 顶点位移量：计算网格顶点到碰撞接触点的距离，距离越近的变形程度应该越大，顶点位移量也就相应越大。顶点位移方向：通过将relativeVelocity从世界空间转换到被撞击物体的局部空间获得顶点位移方向。 //变形发生的阈值 [SerializeField] private float deformationThreshold = 5f; //变形影响的半径 [SerializeField] private float deformationRadius = .5f; private void OnCollisionEnter(Collision collision) { //两个碰撞对象的相对线性速度足够大时网格变形 if (collision.relativeVelocity.magnitude &gt; deformationThreshold) { //撞击的物体 GameObject collideGameObject = collision.gameObject; //物体上的网格 Mesh mesh = collideGameObject.GetComponent&lt;MeshFilter&gt;().sharedMesh; //网格上的顶点数组 Vector3[] vertices = mesh.vertices; //遍历撞击接触点 for (int i = 0; i &lt; collision.contactCount; i&#43;&#43;) { ContactPoint contactPoint = collision." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0b3737368319d79dd948226d857ea096/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-26T14:28:03+08:00" />
<meta property="article:modified_time" content="2023-12-26T14:28:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mesh网格撞击变形</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/e8/e8/M5igX8xk_o.gif" alt=""></p> 
<h2><a id="_3"></a>物理碰撞</h2> 
<ul><li>两个游戏物体发生碰撞的必要条件：</li></ul> 
<ol><li>发生碰撞的两个游戏物体有Collider（碰撞器）组件；</li><li>其中一个物体有Rigidbody（刚体）组件。</li></ol> 
<ul><li>MonoBehaviour中的相关回调函数：</li></ul> 
<table><thead><tr><th>回调函数</th><th>详解</th></tr></thead><tbody><tr><td>OnCollisionEnter (Collision)</td><td>当前碰撞器开始接触另一个碰撞器时被调用。</td></tr><tr><td>OnCollisionStay (Collision)</td><td>当前碰撞器持续接触另一个碰撞器时被调用。</td></tr><tr><td>OnCollisionExit (Collision)</td><td>当前碰撞器停止接触另一个碰撞器时被调用。</td></tr></tbody></table> 
<h2><a id="_16"></a>碰撞数据</h2> 
<p>物体发生碰撞时的碰撞数据存储于Collision对象中，相关属性：</p> 
<ul><li>articulationBody：与当前碰撞器发生碰撞的物体上的Articulation Body组件；</li><li>body：与当前碰撞器发生碰撞的物体上的Rigidbody或Articulation Body组件；</li><li>collider：与当前碰撞器发生碰撞的碰撞器；</li><li>contactCount：碰撞接触点的数量；</li><li>contacts：碰撞接触点数组，碰撞接触点包含位置和法线数据；</li><li>gameObject：与当前碰撞器发生碰撞的物体；</li><li>impulse：碰撞冲量；</li><li>relativeVelocity：两个碰撞对象的相对线性速度；</li><li>rigidbody：与当前碰撞器发生碰撞的物体上的Rigidbody组件；</li><li>transform：与当前碰撞器发生碰撞的物体的Transform组件。</li></ul> 
<h2><a id="_28"></a>撞击变形</h2> 
<ul><li>撞击判定：当relativeVelocity的长度大于一定阈值时，可以判定为撞击；</li><li>网格变形：通过调整撞击物体上的网格顶点，使网格发生形变：</li></ul> 
<ol><li>顶点位移量：计算网格顶点到碰撞接触点的距离，距离越近的变形程度应该越大，顶点位移量也就相应越大。</li><li>顶点位移方向：通过将relativeVelocity从世界空间转换到被撞击物体的局部空间获得顶点位移方向。</li></ol> 
<pre><code class="prism language-csharp"><span class="token comment">//变形发生的阈值</span>
<span class="token punctuation">[</span>SerializeField<span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">float</span></span> deformationThreshold <span class="token operator">=</span> <span class="token number">5f</span><span class="token punctuation">;</span>
<span class="token comment">//变形影响的半径</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">float</span></span> deformationRadius <span class="token operator">=</span> <span class="token number">.5f</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionEnter</span><span class="token punctuation">(</span><span class="token class-name">Collision</span> collision<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//两个碰撞对象的相对线性速度足够大时网格变形</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>collision<span class="token punctuation">.</span>relativeVelocity<span class="token punctuation">.</span>magnitude <span class="token operator">&gt;</span> deformationThreshold<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//撞击的物体</span>
        <span class="token class-name">GameObject</span> collideGameObject <span class="token operator">=</span> collision<span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>
        <span class="token comment">//物体上的网格</span>
        <span class="token class-name">Mesh</span> mesh <span class="token operator">=</span> collideGameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MeshFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sharedMesh<span class="token punctuation">;</span>
        <span class="token comment">//网格上的顶点数组</span>
        <span class="token class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span> vertices <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertices<span class="token punctuation">;</span>
        <span class="token comment">//遍历撞击接触点</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> collision<span class="token punctuation">.</span>contactCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ContactPoint</span> contactPoint <span class="token operator">=</span> collision<span class="token punctuation">.</span><span class="token function">GetContact</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//全局坐标转撞击物体的局部坐标</span>
            <span class="token class-name">Vector3</span> world2LocalPoint <span class="token operator">=</span> collideGameObject<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">InverseTransformPoint</span><span class="token punctuation">(</span>contactPoint<span class="token punctuation">.</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历网格顶点 顶点移位形成变形</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//网格顶点到撞击接触点的距离</span>
                <span class="token class-name"><span class="token keyword">float</span></span> magnitude <span class="token operator">=</span> <span class="token punctuation">(</span>world2LocalPoint <span class="token operator">-</span> vertices<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>magnitude<span class="token punctuation">;</span>
                <span class="token comment">//在影响范围内</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>magnitude <span class="token operator">&lt;</span> deformationRadius<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//位移量</span>
                    <span class="token class-name"><span class="token keyword">float</span></span> delta <span class="token operator">=</span> <span class="token punctuation">(</span>deformationRadius <span class="token operator">-</span> magnitude<span class="token punctuation">)</span> <span class="token operator">/</span> deformationRadius <span class="token operator">*</span> <span class="token number">.1f</span><span class="token punctuation">;</span>
                    <span class="token comment">//位移</span>
                    vertices<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-=</span> collideGameObject<span class="token punctuation">.</span>transform
                        <span class="token punctuation">.</span><span class="token function">InverseTransformDirection</span><span class="token punctuation">(</span>collision<span class="token punctuation">.</span>relativeVelocity<span class="token punctuation">)</span> <span class="token operator">*</span> delta<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//更新网格顶点</span>
        mesh<span class="token punctuation">.</span>vertices <span class="token operator">=</span> vertices<span class="token punctuation">;</span>
        mesh<span class="token punctuation">.</span><span class="token function">RecalculateNormals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mesh<span class="token punctuation">.</span><span class="token function">RecalculateBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//重启碰撞</span>
        collision<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        collision<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa4ff41ca807f7dc3bf47eee03081a43/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32G0-内部flash读写驱动[寄存器版]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6e8b2d6b29fcc8ffc65b724700f9a498/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript 中的双等号（==）和三等号（===）有何不同？何时使用它们？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>