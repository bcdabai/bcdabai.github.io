<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>自定义 magento 后台订单显示内容(grid、view视图修改) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="自定义 magento 后台订单显示内容(grid、view视图修改)" />
<meta property="og:description" content="一、 后台订单列表grid页
1） 在订单grid列表中显示订单商品等，或联合查询其他表输出
奈何google又TM被封死了，百度能找到的方法，用起来不行。
因为我参照了 http://www.atwix.com/magento/adding-sku-column-to-orders-grid/（注：此文档已有两年多了，可以参考，硬搬会有几处错误）， 几经修改将此功能写成了插件(Ludao_Adminrender)， 试过简单暴力的方法，都不能翻页。
增加如支付方式、地址等， 由于join的数据表都是单列， 会简单一些。 而这里增加订单物品列(与显示物品缩略图类似), 用到 group_concat 。
网上的暴力方法，join了另外的数据表翻不了页，所以要重写block、 collection。
此方法需要新建一个插件模块，以下是我插件用的重要部分：
&lt;!-- app/code/local/Ludao/Adminrenderer/etc/config.xml 重写后台的 sales_order_grid(block)、 Order_Grid_Collection(resource) --&gt; &lt;global&gt; ... &lt;blocks&gt; &lt;adminhtml&gt; &lt;rewrite&gt; &lt;sales_order_grid&gt;Ludao_Adminrenderer_Block_Adminhtml_Sales_Order_Grid&lt;/sales_order_grid&gt; &lt;/rewrite&gt; &lt;/adminhtml&gt; &lt;/blocks&gt; &lt;models&gt; ... &lt;sales_resource&gt; &lt;rewrite&gt; &lt;order_grid_collection&gt;Ludao_Adminrenderer_Model_Resource_Sales_Order_Grid_Collection&lt;/order_grid_collection&gt; &lt;/rewrite&gt; &lt;/sales_resource&gt; ... &lt;/models&gt; ... &lt;/global&gt; 俺插件的block: app/code/local/Ludao/Adminrenderer/Block/Adminhtml/Sales/Order/Grid.php &lt;?php
class Ludao_Adminrenderer_Block_Adminhtml_Sales_Order_Grid extends Mage_Adminhtml_Block_Widget_Grid { public function __construct() { parent::__construct(); $this-&gt;setId(&#39;sales_order_grid&#39;); $this-&gt;setUseAjax(true); $this-&gt;setDefaultSort(&#39;created_at&#39;); $this-&gt;setDefaultDir(&#39;DESC&#39;); $this-&gt;setSaveParametersInSession(true); } /** * Retrieve collection class * * @return string */ protected function _getCollectionClass() { return &#39;sales/order_grid_collection&#39;; } // 修改了这个方法 protected function _prepareCollection() { $collection = Mage::getResourceModel($this-&gt;_getCollectionClass()); // 增加 $itemTable = $collection-&gt;getTable(&#39;sales/order_item&#39;); $collection-&gt;getSelect()-&gt;joinLeft( $itemTable, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ee65ee9e8410aeb498ebc41eb3065320/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-03T15:25:39+08:00" />
<meta property="article:modified_time" content="2019-07-03T15:25:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">自定义 magento 后台订单显示内容(grid、view视图修改)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p><strong>一、 后台订单列表grid页</strong></p> 
 <p>　　1） 在订单grid列表中显示订单商品等，或联合查询其他表输出</p> 
 <p>　　奈何google又TM被封死了，百度能找到的方法，用起来不行。</p> 
 <p>　　因为我参照了 <a href="http://www.atwix.com/magento/adding-sku-column-to-orders-grid/" rel="nofollow">http://www.atwix.com/magento/adding-sku-column-to-orders-grid/</a>（注：此文档已有两年多了，可以参考，硬搬会有几处错误）， 几经修改将此功能写成了插件(Ludao_Adminrender)， 试过简单暴力的方法，都不能翻页。</p> 
 <p> </p> 
 <p>　　增加如支付方式、地址等， 由于join的数据表都是单列， 会简单一些。 而这里增加订单物品列(与显示物品缩略图类似), 用到 group_concat 。</p> 
 <p>　　　网上的暴力方法，join了另外的数据表翻不了页，所以要重写block、 collection。</p> 
 <p>　　此方法需要新建一个插件模块，以下是我插件用的重要部分：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008000;">&lt;!--</span><span style="color:#008000;"> app/code/local/Ludao/Adminrenderer/etc/config.xml 重写后台的 sales_order_grid(block)、 Order_Grid_Collection(resource) </span><span style="color:#008000;">--&gt;</span>
<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">global</span><span style="color:#0000ff;">&gt;</span><span style="color:#000000;">
...
　　</span><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">blocks</span><span style="color:#0000ff;">&gt;</span>
　　　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">adminhtml</span><span style="color:#0000ff;">&gt;</span>
　　　　　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">rewrite</span><span style="color:#0000ff;">&gt;</span>
　　　　　　　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">sales_order_grid</span><span style="color:#0000ff;">&gt;</span>Ludao_Adminrenderer_Block_Adminhtml_Sales_Order_Grid<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">sales_order_grid</span><span style="color:#0000ff;">&gt;</span>
　　　　　　<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">rewrite</span><span style="color:#0000ff;">&gt;</span>
　　　　<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">adminhtml</span><span style="color:#0000ff;">&gt;</span>
　　<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">blocks</span><span style="color:#0000ff;">&gt;</span>

　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">models</span><span style="color:#0000ff;">&gt;</span><span style="color:#000000;">
　　...
　　　　</span><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">sales_resource</span><span style="color:#0000ff;">&gt;</span>
　　　　　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">rewrite</span><span style="color:#0000ff;">&gt;</span>
　　　　　　　　<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">order_grid_collection</span><span style="color:#0000ff;">&gt;</span>Ludao_Adminrenderer_Model_Resource_Sales_Order_Grid_Collection<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">order_grid_collection</span><span style="color:#0000ff;">&gt;</span>
　　　　　　<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">rewrite</span><span style="color:#0000ff;">&gt;</span>
　　　　<span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">sales_resource</span><span style="color:#0000ff;">&gt;</span><span style="color:#000000;">
　　...
　　</span><span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">models</span><span style="color:#0000ff;">&gt;</span><span style="color:#000000;">

...
</span><span style="color:#0000ff;">&lt;/</span><span style="color:#800000;">global</span><span style="color:#0000ff;">&gt;</span></pre> 
 </div> 
 <p>　　　俺插件的block:  app/code/local/Ludao/Adminrenderer/Block/Adminhtml/Sales/Order/Grid.php </p> 
 <div class="cnblogs_code"> 
  <pre>&lt;?<span style="color:#000000;">php<br><br></span>
<span style="color:#0000ff;">class</span> Ludao_Adminrenderer_Block_Adminhtml_Sales_Order_Grid <span style="color:#0000ff;">extends</span><span style="color:#000000;"> Mage_Adminhtml_Block_Widget_Grid
{

    </span><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> __construct()
    {
        parent</span>::<span style="color:#000000;">__construct();
        </span><span style="color:#800080;">$this</span>-&gt;setId('sales_order_grid'<span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;setUseAjax(<span style="color:#0000ff;">true</span><span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;setDefaultSort('created_at'<span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;setDefaultDir('DESC'<span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;setSaveParametersInSession(<span style="color:#0000ff;">true</span><span style="color:#000000;">);
    }

    </span><span style="color:#008000;">/*</span><span style="color:#008000;">*
     * Retrieve collection class
     *
     * @return string
     </span><span style="color:#008000;">*/</span>
    <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> _getCollectionClass()
    {
        </span><span style="color:#0000ff;">return</span> 'sales/order_grid_collection'<span style="color:#000000;">;
    }

    </span><span style="color:#008000;">//</span><span style="color:#008000;"> 修改了这个方法</span>
    <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> _prepareCollection()
    {
        </span><span style="color:#800080;">$collection</span> = Mage::getResourceModel(<span style="color:#800080;">$this</span>-&gt;<span style="color:#000000;">_getCollectionClass());
        </span><span style="color:#008000;">//</span><span style="color:#008000;"> 增加</span>
        <span style="color:#800080;">$itemTable</span> = <span style="color:#800080;">$collection</span>-&gt;getTable('sales/order_item'<span style="color:#000000;">);
        </span><span style="color:#800080;">$collection</span>-&gt;getSelect()-&gt;<span style="color:#000000;">joinLeft(
                                    </span><span style="color:#800080;">$itemTable</span>, 
                                    "{<!-- --><span style="color:#800080;">$itemTable</span>}.order_id=`main_table`.entity_id",
                                    <span style="color:#0000ff;">array</span>('order_products' =&gt; <span style="color:#0000ff;">new</span> Zend_Db_Expr('group_concat('. <span style="color:#800080;">$itemTable</span> .'.name SEPARATOR "&lt;br&gt;")'<span style="color:#000000;">))
                                )
                                </span>-&gt;group('main_table.entity_id'<span style="color:#000000;">);
                                    
        </span><span style="color:#800080;">$this</span>-&gt;setCollection(<span style="color:#800080;">$collection</span><span style="color:#000000;">);
        </span><span style="color:#0000ff;">return</span> parent::<span style="color:#000000;">_prepareCollection();
    } 

    </span><span style="color:#008000;">//</span><span style="color:#008000;"> 修改此方法</span>
    <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> _prepareColumns()
    {

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('real_order_id', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header'=&gt; Mage::helper('sales')-&gt;__('Order #'),
            'width' =&gt; '80px',
            'type'  =&gt; 'text',
            'index' =&gt; 'increment_id',<span style="color:#000000;">
        ));

        </span><span style="color:#0000ff;">if</span> (!Mage::app()-&gt;<span style="color:#000000;">isSingleStoreMode()) {
            </span><span style="color:#800080;">$this</span>-&gt;addColumn('store_id', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                </span>'header'    =&gt; Mage::helper('sales')-&gt;__('Purchased From (Store)'),
                'index'     =&gt; 'store_id',
                'type'      =&gt; 'store',
                'store_view'=&gt; <span style="color:#0000ff;">true</span>,
                'display_deleted' =&gt; <span style="color:#0000ff;">true</span>,<span style="color:#000000;">
            ));
        }

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('created_at', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('Purchased On'),
            'index' =&gt; 'created_at',
            'filter_index' =&gt; 'main_table.created_at',            <span style="color:#008000;">//</span><span style="color:#008000;"> 增加 main_table ，避免filter时出错</span>
            'type' =&gt; 'datetime',
            'width' =&gt; '100px',<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('billing_name', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('Bill to Name'),
            'index' =&gt; 'billing_name',<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('shipping_name', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('Ship to Name'),
            'index' =&gt; 'shipping_name',<span style="color:#000000;">
        ));
        
        </span><span style="color:#008000;">//</span><span style="color:#008000;"> 增加列</span>
        <span style="color:#800080;">$this</span>-&gt;addColumn('order_products', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                </span>'header'                        =&gt; Mage::helper('sales')-&gt;__('Order Products'),
                'index'                            =&gt; 'order_products',
                'filter_index'                    =&gt; 'name',
        <span style="color:#008000;">//</span><span style="color:#008000;">        'filter_condition_callback'        =&gt; array('Ludao_Adminrenderer_Model_Observer', 'filterItems'),</span>
                'type'                            =&gt; 'text',
                'filter'                        =&gt; <span style="color:#0000ff;">false</span>,
                'sortable'                        =&gt; <span style="color:#0000ff;">false</span><span style="color:#000000;">
        ));
        
        </span><span style="color:#800080;">$this</span>-&gt;addColumn('base_grand_total', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('G.T. (Base)'),
            'index' =&gt; 'base_grand_total',
            'type'  =&gt; 'currency',
            'currency' =&gt; 'base_currency_code',<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('grand_total', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('G.T. (Purchased)'),
            'index' =&gt; 'grand_total',
            'type'  =&gt; 'currency',
            'currency' =&gt; 'order_currency_code',<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;addColumn('status', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
            </span>'header' =&gt; Mage::helper('sales')-&gt;__('Status'),
            'index' =&gt; 'status',
            'type'  =&gt; 'options',
            'width' =&gt; '70px',
            'options' =&gt; Mage::getSingleton('sales/order_config')-&gt;getStatuses(),<span style="color:#000000;">
        ));

        </span><span style="color:#0000ff;">if</span> (Mage::getSingleton('admin/session')-&gt;isAllowed('sales/order/actions/view'<span style="color:#000000;">)) {
            </span><span style="color:#800080;">$this</span>-&gt;addColumn('action',
                <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                    </span>'header'    =&gt; Mage::helper('sales')-&gt;__('Action'),
                    'width'     =&gt; '50px',
                    'type'      =&gt; 'action',
                    'getter'     =&gt; 'getId',
                    'actions'   =&gt; <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                        </span><span style="color:#0000ff;">array</span><span style="color:#000000;">(
                            </span>'caption' =&gt; Mage::helper('sales')-&gt;__('View'),
                            'url'     =&gt; <span style="color:#0000ff;">array</span>('base'=&gt;'*/sales_order/view'),
                            'field'   =&gt; 'order_id'<span style="color:#000000;">
                        )
                    )</span>,
                    'filter'    =&gt; <span style="color:#0000ff;">false</span>,
                    'sortable'  =&gt; <span style="color:#0000ff;">false</span>,
                    'index'     =&gt; 'stores',
                    'is_system' =&gt; <span style="color:#0000ff;">true</span>,<span style="color:#000000;">
            ));
        }
        </span><span style="color:#800080;">$this</span>-&gt;addRssList('rss/order/new', Mage::helper('sales')-&gt;__('New Order RSS'<span style="color:#000000;">));

        </span><span style="color:#800080;">$this</span>-&gt;addExportType('*/*/exportCsv', Mage::helper('sales')-&gt;__('CSV'<span style="color:#000000;">));
        </span><span style="color:#800080;">$this</span>-&gt;addExportType('*/*/exportExcel', Mage::helper('sales')-&gt;__('Excel XML'<span style="color:#000000;">));

        </span><span style="color:#0000ff;">return</span> parent::<span style="color:#000000;">_prepareColumns();
    }

    </span><span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> _prepareMassaction()
    {
        </span><span style="color:#800080;">$this</span>-&gt;setMassactionIdField('entity_id'<span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;setFormFieldName('order_ids'<span style="color:#000000;">);
        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;setUseSelectAll(<span style="color:#0000ff;">false</span><span style="color:#000000;">);

        </span><span style="color:#0000ff;">if</span> (Mage::getSingleton('admin/session')-&gt;isAllowed('sales/order/actions/cancel'<span style="color:#000000;">)) {
            </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('cancel_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                 </span>'label'=&gt; Mage::helper('sales')-&gt;__('Cancel'),
                 'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/massCancel'),<span style="color:#000000;">
            ));
        }

        </span><span style="color:#0000ff;">if</span> (Mage::getSingleton('admin/session')-&gt;isAllowed('sales/order/actions/hold'<span style="color:#000000;">)) {
            </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('hold_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                 </span>'label'=&gt; Mage::helper('sales')-&gt;__('Hold'),
                 'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/massHold'),<span style="color:#000000;">
            ));
        }

        </span><span style="color:#0000ff;">if</span> (Mage::getSingleton('admin/session')-&gt;isAllowed('sales/order/actions/unhold'<span style="color:#000000;">)) {
            </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('unhold_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
                 </span>'label'=&gt; Mage::helper('sales')-&gt;__('Unhold'),
                 'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/massUnhold'),<span style="color:#000000;">
            ));
        }

        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('pdfinvoices_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
             </span>'label'=&gt; Mage::helper('sales')-&gt;__('Print Invoices'),
             'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/pdfinvoices'),<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('pdfshipments_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
             </span>'label'=&gt; Mage::helper('sales')-&gt;__('Print Packingslips'),
             'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/pdfshipments'),<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('pdfcreditmemos_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
             </span>'label'=&gt; Mage::helper('sales')-&gt;__('Print Credit Memos'),
             'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/pdfcreditmemos'),<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('pdfdocs_order', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
             </span>'label'=&gt; Mage::helper('sales')-&gt;__('Print All'),
             'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/pdfdocs'),<span style="color:#000000;">
        ));

        </span><span style="color:#800080;">$this</span>-&gt;getMassactionBlock()-&gt;addItem('print_shipping_label', <span style="color:#0000ff;">array</span><span style="color:#000000;">(
             </span>'label'=&gt; Mage::helper('sales')-&gt;__('Print Shipping Labels'),
             'url'  =&gt; <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order_shipment/massPrintShippingLabel'),<span style="color:#000000;">
        ));

        </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">$this</span><span style="color:#000000;">;
    }

    </span><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">function</span> getRowUrl(<span style="color:#800080;">$row</span><span style="color:#000000;">)
    {
        </span><span style="color:#0000ff;">if</span> (Mage::getSingleton('admin/session')-&gt;isAllowed('sales/order/actions/view'<span style="color:#000000;">)) {
            </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">$this</span>-&gt;getUrl('*/sales_order/view', <span style="color:#0000ff;">array</span>('order_id' =&gt; <span style="color:#800080;">$row</span>-&gt;<span style="color:#000000;">getId()));
        }
        </span><span style="color:#0000ff;">return</span> <span style="color:#0000ff;">false</span><span style="color:#000000;">;
    }

    </span><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> getGridUrl()
    {
        </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">$this</span>-&gt;getUrl('*/*/grid', <span style="color:#0000ff;">array</span>('_current'=&gt;<span style="color:#0000ff;">true</span><span style="color:#000000;">));
    }

}</span></pre> 
 </div> 
 <p> </p> 
 <p>　　　俺插件的collection ： app/code/local/Ludao/Adminrenderer/Model/Resource/Sales/Order/Grid/Collection.php , 重写 getSelectCountSql()</p> 
 <div class="cnblogs_code"> 
  <pre>&lt;?<span style="color:#000000;">php
</span><span style="color:#0000ff;">class</span> Ludao_Adminrenderer_Model_Resource_Sales_Order_Grid_Collection <span style="color:#0000ff;">extends</span><span style="color:#000000;"> Mage_Sales_Model_Resource_Order_Grid_Collection{
 </span>
    <span style="color:#008000;">/*</span><span style="color:#008000;">*
     * Get SQL for get record count
     * @return Varien_Db_Select
     </span><span style="color:#008000;">*/</span>
    <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">function</span><span style="color:#000000;"> getSelectCountSql()
    {
        </span><span style="color:#800080;">$countSelect</span> = parent::<span style="color:#000000;">getSelectCountSql();
        </span><span style="color:#0000ff;">if</span> (Mage::app()-&gt;getRequest()-&gt;getControllerName() == 'sales_order'<span style="color:#000000;">) {
            </span><span style="color:#800080;">$countSelect</span>-&gt;<span style="color:#008080;">reset</span>(Zend_Db_Select::<span style="color:#000000;">GROUP);
            </span><span style="color:#800080;">$countSelect</span>-&gt;<span style="color:#008080;">reset</span>(Zend_Db_Select::<span style="color:#000000;">COLUMNS);
            </span><span style="color:#800080;">$countSelect</span>-&gt;columns("COUNT(DISTINCT main_table.entity_id)"<span style="color:#000000;">);
            
        }

        </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">$countSelect</span><span style="color:#000000;">;
    }<br>
}</span></pre> 
 </div> 
 <p>　　　简单来讲，就是重置掉 查询计数的Sql 的 group_concat 字段。 详情还是参见前面的链接。</p> 
 <p> </p> 
 <p> </p> 
 <p><strong>二、 后台订单View页</strong></p> 
 <p>　　1） 加入图片预览。</p> 
 <p>　　　修改  app/design/adminhtml/default/default/template/sales/order/view/items/renderer/default.phtml， <span style="font-size:12px;">在 </span><span style="font-size:12px;">&lt;?php if ($this-&gt;canDisplayContainer()): ?&gt; </span><span style="font-size:12px;"> 之前插入：</span></p> 
 <div class="cnblogs_code"> 
  <pre>        &lt;div style="width:60px;height:60px;float:left;display:inline-block;"&gt;
            &lt;?php <span style="color:#800080;">$_product</span> =  Mage::getModel('catalog/product')-&gt;load(<span style="color:#800080;">$_item</span>-&gt;getProductId());?&gt;
            &lt;a target="_blank" href="&lt;?php echo <span style="color:#800080;">$_product</span>-&gt;getImageUrl(); ?&gt;"&gt;
                &lt;img height="60" width="60" src="&lt;?php echo <span style="color:#800080;">$_product</span>-&gt;getThumbnailUrl(); ?&gt;"&gt;
            &lt;/a&gt;
        &lt;/div&gt;</pre> 
 </div> 
 <p> </p> 
 <p>(测试 magento版本 1.8.0 )</p> 
</div> 
<p>转载于:https://www.cnblogs.com/antarctican/p/3794341.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87bef07b9bb7051ac61e417793df144b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">请求（RequestInfo）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50ff2090c23fe79a59bcf148fb418971/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为 magento 配置varnish cache</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>