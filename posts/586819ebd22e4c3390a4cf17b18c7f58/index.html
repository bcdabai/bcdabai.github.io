<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>esxi6.7的直通 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="esxi6.7的直通" />
<meta property="og:description" content="一、什么是直通(Passthrough)
VT-d 、DirectPath I/O，通过 DirectPath I/O，虚拟机可以使用 I/O 内存管理单元访问平台上的物理 PCI 功能，就是俗称的虚拟化直通，简单理解就是允许宿主机将某些硬件资源的管辖权直接移交给虚拟机，虚拟机会以直通独占的方式使用硬件，宿主机将不能再使用此硬件，利用效率几乎等同于将硬件插到了虚拟机的主板扩展槽里一样，最实用的目的是避免了虚拟化平台自身软件层转换带来的效能下降。
典型应用场景，例如在服务器上将某个物理网卡直接划给某台虚拟机使用，以达到几乎和物理机搭配物理网卡类似的网络性能。更可观的场景是，将磁盘控制器直通给虚拟机独占使用，那么虚拟机往往最瓶颈的磁盘性能，将得到非常可观的提升。
二、开启直通的必要条件
AMD/Intel CPU支持VT-D，同时主板要开启VT-D支持。
三、查看ESXI支持直通的PCI设备
安装ESXI６.７操作系统（略）
安装win10虚拟机，在虚拟机里面安装好系统，先安装VMtools
登入ESXi的网页后台，点击左侧的 “管理” – “硬件” – 左下角将筛选条件修改为“支持直通”，即可看到可以直通的 PCI 设备。
四、添加ESXI支持直通的PCI设备
将需要直通的设备左侧打勾后点击上方的 “切换直通” 按钮后，重启ESXI即可将 PCI 设备直通给虚拟机
列表中，“直通” 一列为 “活动” 的则为已经直通的设备。
注意：如果这个时候你的pci选项是灰色的，那么可能是你的主板没有设置好，如果主板参数已经设置了，需要检查一下pci设备的状态，如果不是活动的，需要将显卡勾选上在进行切换直通，最后重新引导主机。
**&gt; 如是灰色情况参照如下 ：
将独立输出禁用，只允许板载输出（不同的主板参考主板配置手册） 编辑虚拟机，在虚拟机里面添加PCI直通设备
右击虚拟机-编辑设置-添加其他设备-PCI设备-记录设备ID（0000:xx:xx:x）（根据通道进行添加，如果是4
通道则添加4个PCI设备） 开启SSH服务，编辑配置文件 管理-服务-启动SSH-使用命令进行编辑 vi
/etc/vmware/esx.conf 在末尾添加一行 /device/0000:xx:xx:x/owner = “passthru”
右击虚拟机-虚拟机选项-高级-配置参数-编辑配置-添加参数-hypervisor.cpuid.v0 值FALSE-保存
解释一下：hypervisor.cpuid.vo=FALSE的作用是启用独显，不加这一行设备管理器中独显会报出 代码43的错误。也有可能会发生这种情况，需要安装驱动 这个时候不建议驱动精灵 要么win10自动检测下载 要么官网找对版本型号下载
重启ESXI主机~~~~**
给虚拟机添加直通的设备
选择待添加PCI设备的虚拟机，右键编辑虚拟机，点击“添加其他设备” – “PCI”设备，选中已直通的设备，保存编辑即可。
键盘鼠标直通
鼠标键盘直通 和显卡直通的操作一样，就是将硬件中USB相关的都直通，因为主机多个USB端口，你把鼠标和键盘插上也不知道对应哪一个端口。然后再添加PCI设备，这个慢慢尝试吧可以走通。
USB直通
USB不用设置直通 将USB设备插入主机后，直接添加USB设备就可以了" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/586819ebd22e4c3390a4cf17b18c7f58/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-02T12:44:12+08:00" />
<meta property="article:modified_time" content="2021-03-02T12:44:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">esxi6.7的直通</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>一、什么是直通(Passthrough)</strong></p> 
<p>VT-d 、DirectPath I/O，通过 DirectPath I/O，虚拟机可以使用 I/O 内存管理单元访问平台上的物理 PCI 功能，就是俗称的虚拟化直通，简单理解就是允许宿主机将某些硬件资源的管辖权直接移交给虚拟机，虚拟机会以直通独占的方式使用硬件，宿主机将不能再使用此硬件，利用效率几乎等同于将硬件插到了虚拟机的主板扩展槽里一样，最实用的目的是避免了虚拟化平台自身软件层转换带来的效能下降。</p> 
<p>典型应用场景，例如在服务器上将某个物理网卡直接划给某台虚拟机使用，以达到几乎和物理机搭配物理网卡类似的网络性能。更可观的场景是，将磁盘控制器直通给虚拟机独占使用，那么虚拟机往往最瓶颈的磁盘性能，将得到非常可观的提升。</p> 
<p><strong>二、开启直通的必要条件</strong></p> 
<p>AMD/Intel CPU支持VT-D，同时主板要开启VT-D支持。</p> 
<p><strong>三、查看ESXI支持直通的PCI设备</strong><br> 安装ESXI６.７操作系统（略）<br> 安装win10虚拟机，在虚拟机里面安装好系统，先安装VMtools<br> 登入ESXi的网页后台，点击左侧的 “管理” – “硬件” – 左下角将筛选条件修改为“支持直通”，即可看到可以直通的 PCI 设备。<br> <img src="https://images2.imgbox.com/be/0d/6amMfP0e_o.png" alt="在这里插入图片描述"></p> 
<p><strong>四、添加ESXI支持直通的PCI设备</strong><br> 将需要直通的设备左侧打勾后点击上方的 “切换直通” 按钮后，重启ESXI即可将 PCI 设备直通给虚拟机<br> 列表中，“直通” 一列为 “活动” 的则为已经直通的设备。</p> 
<p>注意：如果这个时候你的pci选项是灰色的，那么可能是你的主板没有设置好，如果主板参数已经设置了，需要检查一下pci设备的状态，如果不是活动的，需要将显卡勾选上在进行切换直通，最后重新引导主机。</p> 
<p>**&gt; 如是灰色情况参照如下 ：</p> 
<blockquote> 
 <p>将独立输出禁用，只允许板载输出（不同的主板参考主板配置手册） 编辑虚拟机，在虚拟机里面添加PCI直通设备<br> 右击虚拟机-编辑设置-添加其他设备-PCI设备-记录设备ID（0000:xx:xx:x）（根据通道进行添加，如果是4<br> 通道则添加4个PCI设备） 开启SSH服务，编辑配置文件 管理-服务-启动SSH-使用命令进行编辑 vi<br> /etc/vmware/esx.conf 在末尾添加一行 /device/0000:xx:xx:x/owner = “passthru”<br> 右击虚拟机-虚拟机选项-高级-配置参数-编辑配置-添加参数-hypervisor.cpuid.v0 值FALSE-保存<br> <s><strong>解释一下：hypervisor.cpuid.vo=FALSE的作用是启用独显，不加这一行设备管理器中独显会报出 代码43的错误。也有可能会发生这种情况，需要安装驱动 这个时候不建议驱动精灵 要么win10自动检测下载 要么官网找对版本型号下载</strong></s><br> 重启ESXI主机~~~~**</p> 
</blockquote> 
<p><strong>给虚拟机添加直通的设备</strong><br> 选择待添加PCI设备的虚拟机，右键编辑虚拟机，点击“添加其他设备” – “PCI”设备，选中已直通的设备，保存编辑即可。</p> 
<p>键盘鼠标直通<br> 鼠标键盘直通 和显卡直通的操作一样，就是将硬件中USB相关的都直通，因为主机多个USB端口，你把鼠标和键盘插上也不知道对应哪一个端口。然后再添加PCI设备，这个慢慢尝试吧可以走通。<br> USB直通<br> USB不用设置直通 将USB设备插入主机后，直接添加USB设备就可以了<br> 在虚拟机设置中增加U盘设备。设备选择super top Mass Storage Device。<br> <s>esxi添加usb设备时，有时需要重新引导才能生效，也就是需要重新启动，建议将所有需要的usb设备一次性添加上去,使用U盘等传输文件情况，可以使作本地安装workstation版本，远程联接esxi服务器，这样可以使用本地设备来传输数据文件！！！</s><br> <img src="https://images2.imgbox.com/11/93/wurVvzAE_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c0/0f/7h7fdrDe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e6/29/snZQuSgs_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/28/19/lGXAbPYW_o.png" alt="在这里插入图片描述"></p> 
<p>因为N卡直通是分两个设备的，一个显卡模块，一个声模块，记录硬件ＩＤ，修改passthru.map，就能直通出来。这里顺便说一下，不用双独立显卡，只要有显卡就能行，不用刻意关ＢＩＯＳ中的集显和声卡。<br> <img src="https://images2.imgbox.com/17/62/4AkTiFtg_o.png" alt="在这里插入图片描述"></p> 
<p>本文相关步骤<br> https://blog.csdn.net/weixin_43711537/article/details/101210675 小小小__菜鸟 EXSI安装部分<br> https://blog.csdn.net/weixin_44493841/article/details/105841990 夏华东的博客 EXSI显卡直通部分<br> https://blog.csdn.net/a1044909923/article/details/94642900 小小傻瓜牙 WIN10虚拟机安装部分</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1fbb1c7f0a7a3e8ab2cb0245118cd07d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java threadpoolexecutor 实例_Java线程池（ThreadPoolExecutor）示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7705d2dab64ab0850c9b24b328e0929b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">整合Knife4j生成文档后端接口文档出现404无法找到doc.html</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>