<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GStreamer基础介绍 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GStreamer基础介绍" />
<meta property="og:description" content="GStreamer 是一个开源的多媒体框架，用于构建和处理各种多媒体应用。它提供了一组用于创建、配置和处理音频、视频、图像和其他多媒体数据流的库和工具。GStreamer 设计为灵活且可扩展的，使开发者可以构建各种多媒体应用，包括音频/视频播放器、流媒体服务器、音视频编辑器等。
GStreamer和ffmpeg一样，可以在多个操作系统上运行，包括 Linux、Windows、macOS 等。
GStreamer 使用插件体系结构，这就允许用户通过添加插件来扩展其功能。GStreamer 使用管道模型来组织和处理多媒体数据。典型的 GStreamer 管道包括源元素、过滤器元素和目标元素，通过连接这些元素来实现数据流。GStreamer 提供了丰富的解码器、编码器、滤镜、混音器等元素。
#include &lt;gst/gst.h&gt; int main(int argc, char *argv[]) { // 初始化 GStreamer gst_init(&amp;argc, &amp;argv); // 创建主循环上下文 GMainLoop *loop = g_main_loop_new(NULL, FALSE); // 创建一个新的管道 GstElement *pipeline = gst_pipeline_new(&#34;my-pipeline&#34;); // 创建音频采集元素 GstElement *audioSrc = gst_element_factory_make(&#34;autoaudiosrc&#34;, &#34;audio-source&#34;); // 创建音频编码元素 GstElement *audioEncoder = gst_element_factory_make(&#34;lamemp3enc&#34;, &#34;audio-encoder&#34;); // 创建音频解码元素 GstElement *audioDecoder = gst_element_factory_make(&#34;mpg123audiodec&#34;, &#34;audio-decoder&#34;); // 创建音频播放元素 GstElement *audioSink = gst_element_factory_make(&#34;autoaudiosink&#34;, &#34;audio-sink&#34;); // 创建视频采集元素 GstElement *videoSrc = gst_element_factory_make(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/348ef7078bc2e780c907b35d8ab8dfff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T21:15:08+08:00" />
<meta property="article:modified_time" content="2024-01-17T21:15:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GStreamer基础介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>GStreamer 是一个开源的多媒体框架，用于构建和处理各种多媒体应用。它提供了一组用于创建、配置和处理音频、视频、图像和其他多媒体数据流的库和工具。GStreamer 设计为灵活且可扩展的，使开发者可以构建各种多媒体应用，包括音频/视频播放器、流媒体服务器、音视频编辑器等。</p> 
<p>GStreamer和ffmpeg一样，可以在多个操作系统上运行，包括 Linux、Windows、macOS 等。</p> 
<p>GStreamer 使用插件体系结构，这就允许用户通过添加插件来扩展其功能。GStreamer 使用管道模型来组织和处理多媒体数据。典型的 GStreamer 管道包括源元素、过滤器元素和目标元素，通过连接这些元素来实现数据流。GStreamer 提供了丰富的解码器、编码器、滤镜、混音器等元素。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;gst/gst.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化 GStreamer</span>
    <span class="token function">gst_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建主循环上下文</span>
    GMainLoop <span class="token operator">*</span>loop <span class="token operator">=</span> <span class="token function">g_main_loop_new</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一个新的管道</span>
    GstElement <span class="token operator">*</span>pipeline <span class="token operator">=</span> <span class="token function">gst_pipeline_new</span><span class="token punctuation">(</span><span class="token string">"my-pipeline"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建音频采集元素</span>
    GstElement <span class="token operator">*</span>audioSrc <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autoaudiosrc"</span><span class="token punctuation">,</span> <span class="token string">"audio-source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建音频编码元素</span>
    GstElement <span class="token operator">*</span>audioEncoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"lamemp3enc"</span><span class="token punctuation">,</span> <span class="token string">"audio-encoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建音频解码元素</span>
    GstElement <span class="token operator">*</span>audioDecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"mpg123audiodec"</span><span class="token punctuation">,</span> <span class="token string">"audio-decoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建音频播放元素</span>
    GstElement <span class="token operator">*</span>audioSink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autoaudiosink"</span><span class="token punctuation">,</span> <span class="token string">"audio-sink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建视频采集元素</span>
    GstElement <span class="token operator">*</span>videoSrc <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autovideosrc"</span><span class="token punctuation">,</span> <span class="token string">"video-source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建视频编码元素</span>
    GstElement <span class="token operator">*</span>videoEncoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"x264enc"</span><span class="token punctuation">,</span> <span class="token string">"video-encoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建视频解码元素</span>
    GstElement <span class="token operator">*</span>videoDecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"avdec_h264"</span><span class="token punctuation">,</span> <span class="token string">"video-decoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建视频显示元素</span>
    GstElement <span class="token operator">*</span>videoSink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autovideosink"</span><span class="token punctuation">,</span> <span class="token string">"video-sink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 检查元素创建是否成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pipeline <span class="token operator">||</span> <span class="token operator">!</span>audioSrc <span class="token operator">||</span> <span class="token operator">!</span>audioEncoder <span class="token operator">||</span> <span class="token operator">!</span>audioDecoder <span class="token operator">||</span> <span class="token operator">!</span>audioSink <span class="token operator">||</span>
        <span class="token operator">!</span>videoSrc <span class="token operator">||</span> <span class="token operator">!</span>videoEncoder <span class="token operator">||</span> <span class="token operator">!</span>videoDecoder <span class="token operator">||</span> <span class="token operator">!</span>videoSink<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">g_printerr</span><span class="token punctuation">(</span><span class="token string">"One or more elements could not be created. Exiting.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将元素添加到管道中</span>
    <span class="token function">gst_bin_add_many</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audioSrc<span class="token punctuation">,</span> audioEncoder<span class="token punctuation">,</span> audioDecoder<span class="token punctuation">,</span> audioSink<span class="token punctuation">,</span>
                     videoSrc<span class="token punctuation">,</span> videoEncoder<span class="token punctuation">,</span> videoDecoder<span class="token punctuation">,</span> videoSink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 连接音频元素</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_element_link_many</span><span class="token punctuation">(</span>audioSrc<span class="token punctuation">,</span> audioEncoder<span class="token punctuation">,</span> audioDecoder<span class="token punctuation">,</span> audioSink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">g_printerr</span><span class="token punctuation">(</span><span class="token string">"Failed to link audio elements. Exiting.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 连接视频元素</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_element_link_many</span><span class="token punctuation">(</span>videoSrc<span class="token punctuation">,</span> videoEncoder<span class="token punctuation">,</span> videoDecoder<span class="token punctuation">,</span> videoSink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">g_printerr</span><span class="token punctuation">(</span><span class="token string">"Failed to link video elements. Exiting.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 设置音频编码器属性</span>
    <span class="token function">g_object_set</span><span class="token punctuation">(</span>audioEncoder<span class="token punctuation">,</span> <span class="token string">"bitrate"</span><span class="token punctuation">,</span> <span class="token number">128000</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置视频编码器属性</span>
    <span class="token function">g_object_set</span><span class="token punctuation">(</span>videoEncoder<span class="token punctuation">,</span> <span class="token string">"bitrate"</span><span class="token punctuation">,</span> <span class="token number">500000</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置播放速度</span>
    <span class="token function">g_object_set</span><span class="token punctuation">(</span>videoSink<span class="token punctuation">,</span> <span class="token string">"sync"</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置管道状态为播放</span>
    <span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 进入主循环</span>
    <span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"Running...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">g_main_loop_run</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 清理资源</span>
    <span class="token function">g_main_loop_unref</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gst_object_unref</span><span class="token punctuation">(</span><span class="token function">GST_OBJECT</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>上述代码实现了音频采集、编码、解码、播放，以及视频采集、编码、解码、显示的功能。可以根据实际情况选择和配置具体的元素。</p> 
<p>要编译上述代码，需要使用以下命令：</p> 
<pre><code class="prism language-bash">gcc <span class="token parameter variable">-o</span> my_gst_app my_gst_app.c <span class="token variable"><span class="token variable">$(</span>pkg-config <span class="token parameter variable">--cflags</span> <span class="token parameter variable">--libs</span> gstreamer-1.0<span class="token variable">)</span></span>

</code></pre> 
<h3><a id="_100"></a>步骤总结：</h3> 
<ol><li>初始化： 初始化 GStreamer 库。</li><li>创建主循环： 为异步操作创建主循环。</li><li>选择和创建元素： 选择适当的元素并创建它们。</li><li>添加元素到管道： 将创建的元素添加到管道中。</li><li>连接元素： 将元素连接起来形成处理管道。</li><li>设置元素属性： 根据需求设置元素的属性。</li><li>设置管道状态： 将管道的状态设置为播放。</li><li>进入主循环： 对于异步操作，进入主循环。</li><li>清理资源： 在程序结束前释放资源</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3663a4f6ffced1776ebcad779ab467db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">复现PointNet（分割网络）：Windows &#43; PyTorch &#43; 部件分割 &#43; 代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b7c640d9633c6db2e8c17c36572d3662/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">算法 - 二叉树 / 图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>