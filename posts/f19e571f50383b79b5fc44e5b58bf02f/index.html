<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3使用vis绘制甘特图制作timeline可拖动时间轴，时间轴中文化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3使用vis绘制甘特图制作timeline可拖动时间轴，时间轴中文化" />
<meta property="og:description" content="本文写作顺序：效果展示——子组件封装——父组件传值
仅js的原始图（回归初始化）、撤销（上一步）功能实现，样式需要自己调整
目录 前言：参考文档文章一、实现效果：二、安装插件及依赖：三、封装组件：1.html部分：2.引入依赖：3.父组件传入数据：4.js部分全部配置 四、父组件调用1.引入子组件2.初始数据3.父组件按钮及事件 前言：参考文档文章 vis官方配置文档：文档地址
参考使用文章：文章地址
一、实现效果： 二、安装插件及依赖： cnpm install -S vis-linetime cnpm install -S vis-data cnpm install -S moment 三、封装组件： 下端时间轴单独封装成组件
1.html部分： &lt;template&gt; &lt;div class=&#34;visGantt&#34; ref=&#34;visGanttDom&#34;&gt;&lt;/div&gt; &lt;/template&gt; 2.引入依赖： import { DataSet } from &#39;vis-data/peer&#39; import { dateFormat } from &#39;@/util&#39; //封装的时间格式化函数，如下所示 import { Timeline } from &#39;vis-timeline/peer&#39; import &#39;vis-timeline/styles/vis-timeline-graph2d.css&#39; const moment = require(&#39;moment&#39;) 时间格式化函数：
export function dateFormat(date, fmt) { //date是日期，fmt是格式 let o = { &#39;M&#43;&#39;: date.getMonth() &#43; 1, // 月份 &#39;d&#43;&#39;: date." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f19e571f50383b79b5fc44e5b58bf02f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T15:16:39+08:00" />
<meta property="article:modified_time" content="2023-02-13T15:16:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3使用vis绘制甘特图制作timeline可拖动时间轴，时间轴中文化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>本文写作顺序：效果展示——子组件封装——父组件传值</strong><br> <strong>仅js的原始图（回归初始化）、撤销（上一步）功能实现，样式需要自己调整</strong><br> </p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言：参考文档文章</a></li><li><a href="#_10" rel="nofollow">一、实现效果：</a></li><li><a href="#_14" rel="nofollow">二、安装插件及依赖：</a></li><li><a href="#_22" rel="nofollow">三、封装组件：</a></li><li><ul><li><a href="#1html_27" rel="nofollow">1.html部分：</a></li><li><a href="#2_34" rel="nofollow">2.引入依赖：</a></li><li><a href="#3_68" rel="nofollow">3.父组件传入数据：</a></li><li><a href="#4js_83" rel="nofollow">4.js部分全部配置</a></li></ul> 
  </li><li><a href="#_278" rel="nofollow">四、父组件调用</a></li><li><ul><li><a href="#1_280" rel="nofollow">1.引入子组件</a></li><li><a href="#2_298" rel="nofollow">2.初始数据</a></li><li><a href="#3_373" rel="nofollow">3.父组件按钮及事件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_5"></a>前言：参考文档文章</h2> 
<p><strong>vis官方配置文档：<a href="https://visjs.github.io/vis-timeline/docs/timeline/" rel="nofollow">文档地址</a></strong><br> <strong>参考使用文章：<a href="https://blog.csdn.net/weixin_39893889/article/details/124422255?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-124422255-blog-78049966.pc_relevant_multi_platform_whitelistv3&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-124422255-blog-78049966.pc_relevant_multi_platform_whitelistv3&amp;utm_relevant_index=1">文章地址</a></strong></p> 
<h2><a id="_10"></a>一、实现效果：</h2> 
<p><img src="https://images2.imgbox.com/db/9f/ljZsfEyn_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_14"></a>二、安装插件及依赖：</h2> 
<pre><code class="prism language-javascript">cnpm install <span class="token operator">-</span><span class="token constant">S</span> vis<span class="token operator">-</span>linetime
cnpm install <span class="token operator">-</span><span class="token constant">S</span> vis<span class="token operator">-</span>data
cnpm install <span class="token operator">-</span><span class="token constant">S</span> moment
</code></pre> 
<h2><a id="_22"></a>三、封装组件：</h2> 
<p>下端时间轴单独封装成组件<br> <img src="https://images2.imgbox.com/df/9b/FZUUfMOJ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/54/NttQ6KtV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1html_27"></a>1.html部分：</h3> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"visGantt"</span> ref<span class="token operator">=</span><span class="token string">"visGanttDom"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="2_34"></a>2.引入依赖：</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> DataSet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vis-data/peer'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> dateFormat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/util'</span> <span class="token comment">//封装的时间格式化函数，如下所示</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Timeline <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vis-timeline/peer'</span>
<span class="token keyword">import</span> <span class="token string">'vis-timeline/styles/vis-timeline-graph2d.css'</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>
</code></pre> 
<p>时间格式化函数：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">dateFormat</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> fmt</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//date是日期，fmt是格式</span>
    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">'M+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 月份</span>
        <span class="token string-property property">'d+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 日</span>
        <span class="token string-property property">'H+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 小时</span>
        <span class="token string-property property">'h+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 小时</span>
        <span class="token string-property property">'m+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 分</span>
        <span class="token string-property property">'s+'</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 秒</span>
        <span class="token string-property property">'q+'</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 季度</span>
        <span class="token constant">S</span><span class="token operator">:</span> date<span class="token punctuation">.</span><span class="token function">getMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 毫秒</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(y+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>fmt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        fmt <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">,</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token keyword">in</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'('</span> <span class="token operator">+</span> k <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>fmt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            fmt <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">,</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>o<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'00'</span> <span class="token operator">+</span> o<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> o<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fmt
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_68"></a>3.父组件传入数据：</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">ganntData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 初始传入数据</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ganntHistoryData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 全部的历史数据，为了实现撤销上一步</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4js_83"></a>4.js部分全部配置</h3> 
<p>配置项参考<a href="https://visjs.github.io/vis-timeline/docs/timeline/" rel="nofollow">官方文档</a>，仅注释解释个别方法。</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> defineProps<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> nextTick<span class="token punctuation">,</span> defineEmits <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> DataSet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vis-data/peer'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> dateFormat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/util'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Timeline <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vis-timeline/peer'</span>
<span class="token keyword">import</span> <span class="token string">'vis-timeline/styles/vis-timeline-graph2d.css'</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">ganntData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ganntHistoryData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> timeline <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  props<span class="token punctuation">.</span>ganntData<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">&amp;&amp;</span> newVal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows <span class="token operator">&amp;&amp;</span> newVal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">initChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">checkTimeConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">computedData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> trackTimeWindows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> timeWindows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  props<span class="token punctuation">.</span>ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">trackTimeWindow<span class="token punctuation">,</span> trackTimeWindowIndex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 项目类别数组</span>
      trackTimeWindows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> trackTimeWindow<span class="token punctuation">.</span>deviceId<span class="token punctuation">,</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindow<span class="token punctuation">.</span>deviceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindowIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-trackTimeWindows</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> trackTimeWindowIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">visGantt-item</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindowIndex <span class="token operator">%</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 项目时间数组</span>
      trackTimeWindow<span class="token punctuation">.</span>timeWindows<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">timeWindow<span class="token punctuation">,</span> timeWindowIndex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        timeWindows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeWindow<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">startTime</span><span class="token operator">:</span> timeWindow<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span>
          <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeWindow<span class="token punctuation">.</span>stopTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">stopTime</span><span class="token operator">:</span> timeWindow<span class="token punctuation">.</span>stopTime<span class="token punctuation">,</span>
          <span class="token literal-property property">topTime</span><span class="token operator">:</span> timeWindow<span class="token punctuation">.</span>topTime<span class="token punctuation">,</span>
          <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindow<span class="token punctuation">.</span>deviceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindowIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-trackTimeWindows</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">visGantt-item</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindowIndex <span class="token operator">%</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trackTimeWindow<span class="token punctuation">.</span>deviceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">deviceId</span><span class="token operator">:</span> trackTimeWindow<span class="token punctuation">.</span>deviceId
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    trackTimeWindows<span class="token punctuation">,</span>
    timeWindows
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> visGanttDom <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> historyDataArray <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 选择某个item</span>
<span class="token keyword">let</span> <span class="token function-variable function">onSelect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">properties</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'selectItem'</span><span class="token punctuation">,</span> properties<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">initChart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> timeWindows<span class="token punctuation">,</span> trackTimeWindows <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">computedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> groups <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSet</span><span class="token punctuation">(</span>trackTimeWindows<span class="token punctuation">)</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSet</span><span class="token punctuation">(</span>timeWindows<span class="token punctuation">)</span>
  <span class="token keyword">let</span> container <span class="token operator">=</span> visGanttDom<span class="token punctuation">.</span>value
  <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    container<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 甘特图配置</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function-variable function">groupOrder</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> a<span class="token punctuation">.</span>value <span class="token operator">-</span> b<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">groupOrderSwap</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> groups</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> v <span class="token operator">=</span> a<span class="token punctuation">.</span>value
      a<span class="token punctuation">.</span>value <span class="token operator">=</span> b<span class="token punctuation">.</span>value
      b<span class="token punctuation">.</span>value <span class="token operator">=</span> v
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'23.8vh'</span><span class="token punctuation">,</span> <span class="token comment">// 高度</span>
    <span class="token literal-property property">verticalScroll</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 竖向滚动</span>
    <span class="token literal-property property">orientation</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span> <span class="token comment">// 时间轴位置</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">axis</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">item</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">horizontal</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">vertical</span><span class="token operator">:</span> <span class="token number">20</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">editable</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">updateTime</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">updateGroup</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">multiselect</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">moment</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">date</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">utc</span><span class="token punctuation">(</span><span class="token string">'+08:00'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">groupHeightMode</span><span class="token operator">:</span> <span class="token string">'fixed'</span><span class="token punctuation">,</span>
    <span class="token comment">// min: new Date(startTime.value), // 最小可见范围</span>
    <span class="token literal-property property">tooltip</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">followMouse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">overflowMethod</span><span class="token operator">:</span> <span class="token string">'cap'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">template</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">originalItemData<span class="token punctuation">,</span> parsedItemData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 鼠标hover时显示样式</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;
          &lt;p&gt;
            &lt;span&gt;项目名称：&lt;/span&gt;
            &lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>originalItemData<span class="token punctuation">.</span>deviceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
          &lt;/p&gt;&lt;br/&gt;
          &lt;p&gt;
            &lt;span&gt;开始时间：&lt;/span&gt;
            &lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">dateFormat</span><span class="token punctuation">(</span>parsedItemData<span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
          &lt;/p&gt;&lt;br/&gt;
            &lt;span&gt;结束时间：&lt;/span&gt;
            &lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">dateFormat</span><span class="token punctuation">(</span>parsedItemData<span class="token punctuation">.</span>end<span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
          &lt;/p&gt;
        &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tooltipOnItemUpdateTime</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function-variable function">template</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 鼠标拖动时显示样式</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;
            &lt;span&gt;开始时间：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">dateFormat</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
            &lt;span&gt;\n&lt;/span&gt;
            &lt;span&gt;结束时间：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">dateFormat</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>end<span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
        &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">locale</span><span class="token operator">:</span> moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 时间轴国际化</span>
    <span class="token literal-property property">showCurrentTime</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">selectable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">zoomMin</span><span class="token operator">:</span> <span class="token number">1728000000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">zoomMax</span><span class="token operator">:</span> <span class="token number">315360000000</span><span class="token punctuation">,</span>
    <span class="token comment">// showTooltips: false,</span>
    <span class="token comment">// autoResize: false,</span>
    <span class="token function-variable function">snap</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> step</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> day <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">24</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>date <span class="token operator">/</span> day<span class="token punctuation">)</span> <span class="token operator">*</span> day
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 移动时返回函数</span>
    <span class="token function-variable function">onMove</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 深拷贝一下，不能直接修改父组件数据</span>
      historyDataArray<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>ganntHistoryData<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> historyData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment">// props.ganntHistoryData是全部的历史数据，historyData 是取上一步的数据</span>
      historyData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>ganntHistoryData<span class="token punctuation">[</span>props<span class="token punctuation">.</span>ganntHistoryData<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 更改一下格式</span>
      historyData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">eachItem</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eachItem<span class="token punctuation">.</span>deviceId <span class="token operator">===</span> item<span class="token punctuation">.</span>deviceId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span>start <span class="token operator">||</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
          eachItem<span class="token punctuation">.</span>timeWindows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> item<span class="token punctuation">.</span>start
          eachItem<span class="token punctuation">.</span>timeWindows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>stopTime <span class="token operator">=</span> item<span class="token punctuation">.</span>end
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      historyDataArray<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>historyData<span class="token punctuation">)</span>
      <span class="token comment">// 更新一下ganntHistoryData历史数据</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:ganntHistoryData'</span><span class="token punctuation">,</span> historyDataArray<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onMoving</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 移动时间轴时不显示tooltip提示框</span>
      <span class="token keyword">let</span> tooltipDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'vis-tooltip'</span><span class="token punctuation">)</span>
      tooltipDom<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'hidden'</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  timeline<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeline</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>
  timeline<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">redraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  timeline<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  timeline<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">setGroups</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span>
  timeline<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
  timeline<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> onSelect<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="_278"></a>四、父组件调用</h2> 
<h3><a id="1_280"></a>1.引入子组件</h3> 
<pre><code class="prism language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> // loading是为了有个加载效果，为了美观
	&lt;time-line 
	:ganntData="ganntData"  // 原始数据
	v-model:ganntHistoryData="ganntHistoryData"  // 历史数据
	@selectItem="timelineSelected" //选择事件
	&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>time-line</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> TimeLine <span class="token keyword">from</span> <span class="token string">'@/components/modules/planControl/TimeLine'</span>
</code></pre> 
<h3><a id="2_298"></a>2.初始数据</h3> 
<pre><code class="prism language-javascript">
<span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
 <span class="token comment">// 因为这个父组件是通过点击进来的，所以有传入的数据，也可以直接赋值ganntData 数据，可以省略watch里面的转格式</span>
  <span class="token literal-property property">conflictList</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ganntData <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'confilct'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">trackTimeWindows</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ganntHistoryData <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 传入数据变化时为ganntData和ganntHistoryData赋值。</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>conflictList<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
    newValue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">deviceId</span><span class="token operator">:</span> element<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
        <span class="token literal-property property">timeWindows</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">startTime</span><span class="token operator">:</span> element<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span>
            <span class="token literal-property property">stopTime</span><span class="token operator">:</span> element<span class="token punctuation">.</span>stopTime
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 记录操作历史</span>
    ganntHistoryData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
    ganntHistoryData<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ganntData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>原数据（省略部分未使用参数）：</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxx计划1"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"time"</span><span class="token operator">:</span> <span class="token string">"2023.08~10"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"startTime"</span><span class="token operator">:</span> <span class="token string">"2023-08-09"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"stopTime"</span><span class="token operator">:</span> <span class="token string">"2023-10-20"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxx计划2"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"time"</span><span class="token operator">:</span> <span class="token string">"2023.09~11"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"startTime"</span><span class="token operator">:</span> <span class="token string">"2023-09-09"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"stopTime"</span><span class="token operator">:</span> <span class="token string">"2023-11-1"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxx计划3"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"time"</span><span class="token operator">:</span> <span class="token string">"2023.08~10"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"startTime"</span><span class="token operator">:</span> <span class="token string">"2023-08-20"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"stopTime"</span><span class="token operator">:</span> <span class="token string">"2023-10-1"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="3_373"></a>3.父组件按钮及事件</h3> 
<p>仅展示<strong>原始图</strong>、<strong>撤销</strong>事件。</p> 
<pre><code class="prism language-html">
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reset()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>原始图<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preNode()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>撤销<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span><span class="token punctuation">&gt;</span></span>一键调整<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span><span class="token punctuation">&gt;</span></span>保存并退出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>回归原始图事件：</strong><br> 大致思路：先把ganntData清空，将拿到的props.conflictList里的数据赋值给ganntData，再把ganntData的数据push进ganntHistoryData中</p> 
<pre><code class="prism language-javascript"> <span class="token comment">// showResetTip 是显示一个“已回到初始状态”的提示框，可以自己封装或者使用组件，此处不展示</span>
<span class="token keyword">const</span> showResetTip <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// loading是加载效果</span>
  loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
  ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  props<span class="token punctuation">.</span>conflictList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trackTimeWindows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">deviceId</span><span class="token operator">:</span> element<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
      <span class="token literal-property property">timeWindows</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">startTime</span><span class="token operator">:</span> element<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span>
          <span class="token literal-property property">stopTime</span><span class="token operator">:</span> element<span class="token punctuation">.</span>stopTime
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  showResetTip<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
  ganntHistoryData<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  ganntHistoryData<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ganntData<span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    showResetTip<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
    loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>撤销事件：</strong><br> 大致思路：拿到子组件返回的ganntHistoryData历史数据数组，删掉最后一组数据后：<br> 如果历史数据数组的长度&lt;= 1，代表再撤销就回到原始状态了，那就直接调用reset()回到原始图；<br> 否则，将ganntHistoryData删掉最后一组数据后的ganntHistoryDataClone最后一组值赋给ganntData，</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">preNode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// loading是加载效果</span>
  loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> ganntHistoryDataClone <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  ganntHistoryDataClone <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>ganntHistoryData<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  ganntHistoryDataClone<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>ganntHistoryDataClone<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ganntHistoryDataClone<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    ganntData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> ganntHistoryDataClone<span class="token punctuation">[</span>ganntHistoryDataClone<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    ganntHistoryData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>ganntHistoryDataClone<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a72b2a04d207bc9d2862b8c7ff7db5d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">KubeSphere中集成ApiSix</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5322798aee8c11098b585168e82a980c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">a-select下拉选择框的两种用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>