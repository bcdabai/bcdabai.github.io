<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Docker的Nginx的安装与配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Docker的Nginx的安装与配置" />
<meta property="og:description" content="基于Docker的Nginx的安装与配置 1 为Nginx创建一个容器1.1 学习docker run1.2 通过docker run为Nginx创建并启动一个容器 2 配置Nginx2.1 学习docker的bind mount技术2.2 在Nginx容器中找到想修改的文件所在的目录2.2.1 认识nginx.conf文件2.2.2 访问Nginx服务，默认返回index.html 2.3 找到后，在主机创建对应的目录，为后续挂载做准备 [在主机的终端进行操作]2.3.1 创建目录2.3.2 拷贝文件2.3.3 在主机中修改Nginx的index.html 2.4 删除就Ngingx容器，重启新Nginx容器2.5 新Nginx容器，新的index.html 1 为Nginx创建一个容器 实际中，后端代码部署在远端容器中以向外提供后端服务。类似的，我们可以在本地为Nginx创建一个容器，并提供Nginx服务。 1.1 学习docker run 一般情况，启动一个服务，需要先拉取该服务的镜像，然后为该镜像启动一个容器。这个可以用一条命令来实现：docker run通过docker --help查看如何使用docker命令：
进一步查看：docker run --help
Options很多，一般掌握最基本的的，也就够用了。如果遇到不够用的情况，把诉求描述给gpt，让它帮忙写就好了，或者google一下。
1.2 通过docker run为Nginx创建并启动一个容器 macOS的shell中执行： docker run \ --restart always \ --name Nginx \ -d \ -p 80:80 \ nginx 常用参数的详细解释：
（1）--restart always：是设定重启策略，意味着无论容器的退出状态码是什么，Docker都会自动重启这个容器。这样可以保证在Docker进程或主机重启后，容器将自动启动。
（2）--name Nginx：是设定这个新建的Docker容器的名字为&#34;Nginx&#34;。如果不设定，Docker将自动给它分配一个随机的名字。
（3）-d是让这个容器在后台运行，而不是在当前的shell里。
（4）-p 80:80是设定端口映射，将主机的80端口映射到容器的80端口。这样，我们可以通过主机的80端口访问到容器内运行的服务。
（5）nginx是这个新建的Docker容器所使用的镜像的名字。
通过本地的Docker客户端（Portainer也可以）查看Nginx容器
已经可以使用Nginx容器提供的Nginx服务了：
2 配置Nginx 不支持定制的软件，不是好软件:）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/29f7b58c7603781dd25121d06cc0cbc4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-14T15:24:17+08:00" />
<meta property="article:modified_time" content="2024-01-14T15:24:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Docker的Nginx的安装与配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>基于Docker的Nginx的安装与配置</h4> 
 <ul><li><a href="#1_Nginx_1" rel="nofollow">1 为Nginx创建一个容器</a></li><li><ul><li><a href="#11_docker_run_4" rel="nofollow">1.1 学习docker run</a></li><li><a href="#12_docker_runNginx_12" rel="nofollow">1.2 通过docker run为Nginx创建并启动一个容器</a></li></ul> 
  </li><li><a href="#2_Nginx_33" rel="nofollow">2 配置Nginx</a></li><li><ul><li><a href="#21_dockerbind_mount_37" rel="nofollow">2.1 学习docker的bind mount技术</a></li><li><a href="#22_Nginx_42" rel="nofollow">2.2 在Nginx容器中找到想修改的文件所在的目录</a></li><li><ul><li><a href="#221_nginxconf_51" rel="nofollow">2.2.1 认识nginx.conf文件</a></li><li><a href="#222_Nginxindexhtml_60" rel="nofollow">2.2.2 访问Nginx服务，默认返回index.html</a></li></ul> 
   </li><li><a href="#23___63" rel="nofollow">2.3 找到后，在主机创建对应的目录，为后续挂载做准备 [在主机的终端进行操作]</a></li><li><ul><li><a href="#231__64" rel="nofollow">2.3.1 创建目录</a></li><li><a href="#232__67" rel="nofollow">2.3.2 拷贝文件</a></li><li><a href="#233_Nginxindexhtml_74" rel="nofollow">2.3.3 在主机中修改Nginx的index.html</a></li></ul> 
   </li><li><a href="#24_NgingxNginx_79" rel="nofollow">2.4 删除就Ngingx容器，重启新Nginx容器</a></li><li><a href="#25_Nginxindexhtml_95" rel="nofollow">2.5 新Nginx容器，新的index.html</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_Nginx_1"></a>1 为Nginx创建一个容器</h2> 
<ul><li>实际中，后端代码部署在远端容器中以向外提供后端服务。</li><li>类似的，我们可以在本地为Nginx创建一个容器，并提供Nginx服务。</li></ul> 
<h3><a id="11_docker_run_4"></a>1.1 学习docker run</h3> 
<ul><li>一般情况，启动一个服务，需要先拉取该服务的镜像，然后为该镜像启动一个容器。这个可以用一条命令来实现：<code>docker run</code></li><li>通过<code>docker --help</code>查看如何使用docker命令：<br> <img src="https://images2.imgbox.com/81/e8/SXdqNfw5_o.png" alt="在这里插入图片描述"></li><li>进一步查看：<code>docker run --help</code><br> <img src="https://images2.imgbox.com/29/99/Q7qGkhnS_o.png" alt="在这里插入图片描述"></li></ul> 
<blockquote> 
 <p>Options很多，一般掌握最基本的的，也就够用了。如果遇到不够用的情况，把诉求描述给gpt，让它帮忙写就好了，或者google一下。</p> 
</blockquote> 
<h3><a id="12_docker_runNginx_12"></a>1.2 通过docker run为Nginx创建并启动一个容器</h3> 
<ul><li>macOS的shell中执行：</li></ul> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> Nginx <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token punctuation">\</span>
nginx
</code></pre> 
<blockquote> 
 <p>常用参数的详细解释：<br> （1）<code>--restart always</code>：是设定重启策略，意味着无论容器的退出状态码是什么，Docker都会自动重启这个容器。这样可以保证在Docker进程或主机重启后，容器将自动启动。<br> （2）<code>--name Nginx</code>：是设定这个新建的Docker容器的名字为"Nginx"。如果不设定，Docker将自动给它分配一个随机的名字。<br> （3）<code>-d</code>是让这个容器在后台运行，而不是在当前的shell里。<br> （4）<code>-p</code> 80:80是设定端口映射，将主机的80端口映射到容器的80端口。这样，我们可以通过主机的80端口访问到容器内运行的服务。<br> （5）<code>nginx</code>是这个新建的Docker容器所使用的镜像的名字。<br> <img src="https://images2.imgbox.com/3a/38/yNOHIKdy_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ul><li>通过本地的Docker客户端（Portainer也可以）查看Nginx容器<br> <img src="https://images2.imgbox.com/36/4d/ZsZDUhQ3_o.png" alt="在这里插入图片描述"></li><li>已经可以使用Nginx容器提供的Nginx服务了：<br> <img src="https://images2.imgbox.com/3f/2e/GT2zmHJ2_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="2_Nginx_33"></a>2 配置Nginx</h2> 
<blockquote> 
 <p>不支持定制的软件，不是好软件:）</p> 
</blockquote> 
<ul><li>思路：将Nginx容器中的<strong>配置文件</strong>拷贝到主机，修改后，再删除之前的Nginx容器，并以“绑定挂载卷”的方式重新启动新Nginx容器，就可以让容器读到更新后的配置文件。</li><li>这里直接采用<code>docker的bind mount技术</code>来更新配置文件。</li></ul> 
<h3><a id="21_dockerbind_mount_37"></a>2.1 学习docker的bind mount技术</h3> 
<blockquote> 
 <p>Docker有两个选项让容器在主机上存储文件，即使在容器停止后文件也能持久保存：volume和 bind mount。</p> 
</blockquote> 
<ul><li>bind mount的效果：<code>docker run [省略其他option] -v /path/to/nginx/conf:/etc/nginx/conf.d nginx</code></li></ul> 
<blockquote> 
 <p>将主机上的 /path/to/nginx/conf 目录挂载到 Nginx 容器的 /etc/nginx/conf.d 目录后，在主机的 /path/to/nginx/conf 目录中编辑 Nginx 的配置文件，容器内的 /etc/nginx/conf.d 目录会实时看到这些更改。</p> 
</blockquote> 
<ul><li>因此，要先找到想修改的文件所在的目录。</li></ul> 
<h3><a id="22_Nginx_42"></a>2.2 在Nginx容器中找到想修改的文件所在的目录</h3> 
<blockquote> 
 <p>那我们就是要在Nginx容器中通过命令行来交互。</p> 
</blockquote> 
<ul><li>执行命令：docker exec -it Nginx /bin/bash</li></ul> 
<blockquote> 
 <p>（1）<code>docker exec</code>：这是Docker的一个命令，用来在运行的容器中执行命令。<br> （2）<code>-it</code>：这是两个参数，i代表交互模式，t为该命令分配一个伪TTY（终端）<br> （3）命令含义：在名为Nginx的容器中以交互模式启动一个bash shell<br> <img src="https://images2.imgbox.com/95/74/aLjynGj6_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ul><li>通过查找Nginx配置相关的资料，可以知道我们要关注：/etc/nginx目录<br> <img src="https://images2.imgbox.com/e1/8d/WjlodCq4_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="221_nginxconf_51"></a>2.2.1 认识nginx.conf文件</h4> 
<p><img src="https://images2.imgbox.com/76/ad/bI9jJtHN_o.png" alt="在这里插入图片描述"></p> 
<ul><li>/etc/nginx/nginx.conf文件是Nginx的主配置文件。它用于存储和管理nginx服务器的配置信息。在这个文件中，咱可以配置如何处理进入服务器的请求，如何转发这些请求，还可以配置日志、缓存和其他的服务器参数等。</li><li>这个文件的配置语法是基于指令和参数的，每行都是一个指令和它的参数。指令之间由分号分隔，而参数之间则由空格分隔。</li></ul> 
<blockquote> 
 <p>（1）在Nginx容器中，这个配置文件通常会被映射到宿主机的某个文件，以便于在容器外部进行编辑和管理。【这正是我们要做的】<br> （2）需要注意的是，任何对这个文件的修改都需要重启Nginx服务才能生效。</p> 
</blockquote> 
<ul><li>在Nginx配置中，<code>include指令</code>用于包含其他配置文件，可以使主配置文件保持清晰和简洁，同时也方便管理和维护。当Nginx启动或重启时，它会读取include指令指定的所有文件，并把这些文件的配置内容合并到主配置文件中。[include <code>/etc/nginx/conf.d/*.conf</code>]</li></ul> 
<blockquote> 
 <p>因此，我们不仅要关注nginx.conf，还要关注conf.d目录</p> 
</blockquote> 
<h4><a id="222_Nginxindexhtml_60"></a>2.2.2 访问Nginx服务，默认返回index.html</h4> 
<ul><li>这个index.html在哪？<code>/usr/share/nginx/html/index.html</code><br> <img src="https://images2.imgbox.com/dc/0a/B31pLgGn_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="23___63"></a>2.3 找到后，在主机创建对应的目录，为后续挂载做准备 [在主机的终端进行操作]</h3> 
<h4><a id="231__64"></a>2.3.1 创建目录</h4> 
<ul><li>mkdir -p ~/docker_mount/nginx/conf/conf.d</li><li>mkdir -p ~/docker_mount/nginx/html</li></ul> 
<h4><a id="232__67"></a>2.3.2 拷贝文件</h4> 
<ul><li>docker container cp Nginx:/etc/nginx/nginx.conf ~/docker_mount/nginx/conf</li><li>docker container cp Nginx:/etc/nginx/conf.d/default.conf ~/docker_mount/nginx/conf/conf.d/</li></ul> 
<blockquote> 
 <p>（1）/etc/nginx/conf.d/目录下只有default.conf<br> （2）docker container cp 不支持*，即<code>Nginx:/etc/nginx/conf.d/*</code>是不对的</p> 
</blockquote> 
<ul><li>docker container cp Nginx:/usr/share/nginx/html/index.html ~/docker_mount/nginx/html</li></ul> 
<h4><a id="233_Nginxindexhtml_74"></a>2.3.3 在主机中修改Nginx的index.html</h4> 
<ul><li>修改<br> <img src="https://images2.imgbox.com/0f/a9/W12JwZED_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/82/66/ZZQXijXH_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="24_NgingxNginx_79"></a>2.4 删除就Ngingx容器，重启新Nginx容器</h3> 
<ul><li>删除：docker stop Nginx &amp;&amp; docker rm Nginx<br> <img src="https://images2.imgbox.com/dc/10/NcBqciHx_o.png" alt="在这里插入图片描述"></li><li>以“bind mount”方式重启Nginx容器</li></ul> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> Nginx <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /Users/forrest<span class="token punctuation">..</span>./docker_mount/nginx/html:/usr/share/nginx/html <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /Users/forrest<span class="token punctuation">..</span>./docker_mount/nginx/conf/nginx.conf:/etc/nginx/nginx.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /Users/forrest<span class="token punctuation">..</span>./docker_mount/nginx/conf/conf.d:/etc/nginx/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token punctuation">\</span>
nginx
</code></pre> 
<p><img src="https://images2.imgbox.com/49/8a/OErVfRcc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="25_Nginxindexhtml_95"></a>2.5 新Nginx容器，新的index.html</h3> 
<p><img src="https://images2.imgbox.com/49/b7/e0sywntP_o.png" alt="在这里插入图片描述"></p> 
<ul><li>之后直接在主机上修改配置，然后执行：<code>docker stop Nginx &amp;&amp; docker start Nginx</code></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/936bb48596608d982335535ae1f28bd8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql 面试必备</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3b9623990af32ea46fc5aebfe9f58149/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu22.04 virt-manager bridge虚拟机ip 一样</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>