<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android使用高德和风天气Sdk获取定位实况天气数据（二） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android使用高德和风天气Sdk获取定位实况天气数据（二）" />
<meta property="og:description" content="Android使用高德和风天气Sdk获取定位实况天气数据（二） 先看一下效果关于实现第一步，引用高德api与和风天气第二步，修改AndroidManifest.xml第三步，修改activity_main.xml第四步，修改MainActivity.java 先看一下效果 关于 首先我们需要需要申请高德开发者，获取key，这个我在Android使用高德地图api实现基础定位（来实现获取到定位位置的经纬度）有具体的介绍使用，我们还需要一个和风天气的天气Androidsdk用于获取天气以及和风天气webapi来根据经纬度获取城市的详细信息来获取到城市码，毕竟和风天气根据城市码来获取相应的天气。
这里我晒一下和风天气的应用：
这两个是必须的哦。
关于和风天气图片的加载用的是glide加载框架。
实现 第一步，引用高德api与和风天气 关于和风天气sdk的下载可以到和风天气开发者里下载，应该是v3.1版本的，或者参考我的Android和风天气sdk
关于ButterKnife如果想使用的话引用参考Android使用ButterKnife与和风天气sdk或者是在oncreate中获取实例。
在项目的build.gradle中添加如下：
//使用okhttp请求网络 implementation &#39;com.squareup.okhttp3:okhttp:3.9.0&#39; implementation &#39;com.google.code.gson:gson:2.6.2&#39; //使用glide加载天气图片 implementation &#39;com.github.bumptech.glide:glide:4.2.0&#39; //高德定位及3D地图 implementation &#39;com.amap.api:3dmap:latest.integration&#39; implementation &#39;com.amap.api:location:latest.integration&#39; 第二步，修改AndroidManifest.xml &lt;uses-permission android:name=&#34;android.permission.ACCESS_COARSE_LOCATION&#34; /&gt; &lt;!-- 用于进行网络定位 --&gt; &lt;uses-permission android:name=&#34;android.permission.ACCESS_COARSE_LOCATION&#34; /&gt; &lt;!-- 用于访问GPS定位 --&gt; &lt;uses-permission android:name=&#34;android.permission.ACCESS_FINE_LOCATION&#34; /&gt; &lt;!-- 用于获取运营商信息，用于支持提供运营商信息相关的接口 --&gt; &lt;uses-permission android:name=&#34;android.permission.ACCESS_NETWORK_STATE&#34; /&gt; &lt;!-- 用于访问wifi网络信息，wifi信息会用于进行网络定位 --&gt; &lt;uses-permission android:name=&#34;android.permission.ACCESS_WIFI_STATE&#34; /&gt; &lt;!-- 用于获取wifi的获取权限，wifi信息会用来进行网络定位 --&gt; &lt;uses-permission android:name=&#34;android.permission.CHANGE_WIFI_STATE&#34; /&gt; &lt;!-- 用于访问网络，网络定位需要上网 --&gt; &lt;uses-permission android:name=&#34;android.permission.INTERNET&#34; /&gt; &lt;!-- 用于读取手机当前的状态 --&gt; &lt;uses-permission android:name=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a5ab25f41673618aa21243a12628f64c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-26T10:31:38+08:00" />
<meta property="article:modified_time" content="2019-09-26T10:31:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android使用高德和风天气Sdk获取定位实况天气数据（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Android使用高德和风天气Sdk获取定位实况天气数据（二）</h4> 
 <ul><li><a href="#_1" rel="nofollow">先看一下效果</a></li><li><a href="#_3" rel="nofollow">关于</a></li><li><a href="#_9" rel="nofollow">实现</a></li><li><ul><li><a href="#api_10" rel="nofollow">第一步，引用高德api与和风天气</a></li><li><a href="#AndroidManifestxml_25" rel="nofollow">第二步，修改AndroidManifest.xml</a></li><li><a href="#activity_mainxml_49" rel="nofollow">第三步，修改activity_main.xml</a></li><li><a href="#MainActivityjava_90" rel="nofollow">第四步，修改MainActivity.java</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>先看一下效果</h2> 
<p><img src="https://images2.imgbox.com/95/ce/VYucoh7N_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_3"></a>关于</h2> 
<p>首先我们需要需要申请高德开发者，获取key，这个我在<a href="https://blog.csdn.net/Tobey_r1/article/details/100985156">Android使用高德地图api实现基础定位</a>（<strong>来实现获取到定位位置的经纬度</strong>）有具体的介绍使用，我们还需要一个和风天气的<font color="red">天气Androidsdk</font>用于获取天气以及<font color="red">和风天气webapi来根据经纬度获取城市的详细信息</font>来获取到城市码，毕竟和风天气根据城市码来获取相应的天气。<br> 这里我晒一下和风天气的应用：<br> <img src="https://images2.imgbox.com/8f/1d/eSCF4UDK_o.png" alt="在这里插入图片描述"><br> 这两个是必须的哦。<br> <strong>关于和风天气图片的加载用的是glide加载框架。</strong></p> 
<h2><a id="_9"></a>实现</h2> 
<h3><a id="api_10"></a>第一步，引用高德api与和风天气</h3> 
<p>关于和风天气sdk的下载可以到和风天气开发者里下载，应该是v3.1版本的，或者参考我的<a href="https://blog.csdn.net/Tobey_r1/article/details/100765786">Android和风天气sdk</a><br> 关于ButterKnife如果想使用的话引用参考<a href="https://blog.csdn.net/Tobey_r1/article/details/100849075">Android使用ButterKnife与和风天气sdk</a>或者是在oncreate中获取实例。<br> 在<strong>项目</strong>的build.gradle中添加如下：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//使用okhttp请求网络</span>
 implementation <span class="token string">'com.squareup.okhttp3:okhttp:3.9.0'</span>
 implementation <span class="token string">'com.google.code.gson:gson:2.6.2'</span>
 <span class="token comment">//使用glide加载天气图片</span>
 implementation <span class="token string">'com.github.bumptech.glide:glide:4.2.0'</span>
 <span class="token comment">//高德定位及3D地图</span>
 implementation <span class="token string">'com.amap.api:3dmap:latest.integration'</span>
 implementation <span class="token string">'com.amap.api:location:latest.integration'</span>
</code></pre> 
<h3><a id="AndroidManifestxml_25"></a>第二步，修改AndroidManifest.xml</h3> 
<pre><code>&lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt; &lt;!-- 用于进行网络定位 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt; &lt;!-- 用于访问GPS定位 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt; &lt;!-- 用于获取运营商信息，用于支持提供运营商信息相关的接口 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt; &lt;!-- 用于访问wifi网络信息，wifi信息会用于进行网络定位 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_WIFI_STATE" /&gt; &lt;!-- 用于获取wifi的获取权限，wifi信息会用来进行网络定位 --&gt;
    &lt;uses-permission android:name="android.permission.CHANGE_WIFI_STATE" /&gt; &lt;!-- 用于访问网络，网络定位需要上网 --&gt;
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt; &lt;!-- 用于读取手机当前的状态 --&gt;
    &lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt; &lt;!-- 用于写入缓存数据到扩展存储卡 --&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt; &lt;!-- 用于申请调用A-GPS模块 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_LOCATION_EXTRA_COMMANDS" /&gt; &lt;!-- 用于申请获取蓝牙信息进行室内定位 --&gt;
    &lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;
    &lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;
</code></pre> 
<p>在application内部添加如下：<br> </p> 
<pre><code>    &lt;meta-data
        android:name="com.amap.api.v2.apikey"
        android:value="keyxxxxxxxxx"&gt;
        //开发者申请的key
    &lt;/meta-data&gt;
</code></pre> 
<h3><a id="activity_mainxml_49"></a>第三步，修改activity_main.xml</h3> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#FFF"
    android:orientation="vertical"
    tools:context=".MainActivity"&gt;

    &lt;TextView
        android:id="@+id/tv_tianqi"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textColor="#000"
        android:textSize="15sp"
        /&gt;
   &lt;ImageView
        android:id="@+id/img_weather"
        android:layout_width="17dp"
        android:layout_height="17dp"
        /&gt;
    &lt;TextView
        android:id="@+id/tv_kongqi"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textColor="#000"
        android:textSize="15sp"
        /&gt;
    &lt;TextView
        android:id="@+id/tv_airqlty"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textColor="#000"
        android:textSize="15sp"
       /&gt;
&lt;/LinearLayout&gt;
</code></pre> 
<h3><a id="MainActivityjava_90"></a>第四步，修改MainActivity.java</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>weathertest<span class="token punctuation">;</span>

<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>NonNull<span class="token punctuation">;</span>
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequiresApi<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>Uri<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Build<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>PowerManager<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>Settings<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Log<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ImageView<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Toast<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span>AMapLocation<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span>AMapLocationClient<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span>AMapLocationClientOption<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span>AMapLocationListener<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>bumptech<span class="token punctuation">.</span>glide<span class="token punctuation">.</span>Glide<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>Gson<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONArray<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONException<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> butterknife<span class="token punctuation">.</span>BindView<span class="token punctuation">;</span>
<span class="token keyword">import</span> butterknife<span class="token punctuation">.</span>BindViews<span class="token punctuation">;</span>
<span class="token keyword">import</span> butterknife<span class="token punctuation">.</span>ButterKnife<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>Lang<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>Unit<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>air<span class="token punctuation">.</span>now<span class="token punctuation">.</span>AirNow<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>weather<span class="token punctuation">.</span>now<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>view<span class="token punctuation">.</span>HeConfig<span class="token punctuation">;</span>
<span class="token keyword">import</span> interfaces<span class="token punctuation">.</span>heweather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>interfacesmodule<span class="token punctuation">.</span>view<span class="token punctuation">.</span>HeWeather<span class="token punctuation">;</span>
<span class="token keyword">import</span> okhttp3<span class="token punctuation">.</span>OkHttpClient<span class="token punctuation">;</span>
<span class="token keyword">import</span> okhttp3<span class="token punctuation">.</span>Request<span class="token punctuation">;</span>
<span class="token keyword">import</span> okhttp3<span class="token punctuation">.</span>Response<span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">BaseActivity</span> <span class="token punctuation">{<!-- --></span>
    String <span class="token constant">TAG</span><span class="token operator">=</span><span class="token string">"MainActivity"</span><span class="token punctuation">;</span>
    @<span class="token function">BindViews</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token constant">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_tianqi<span class="token punctuation">,</span><span class="token constant">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_kongqi<span class="token punctuation">,</span><span class="token constant">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_airqlty<span class="token punctuation">}</span><span class="token punctuation">)</span>
    List<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span>textViewList<span class="token punctuation">;</span>
    @<span class="token function">BindView</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>img_weather<span class="token punctuation">)</span>
    ImageView imageView<span class="token punctuation">;</span>
    <span class="token keyword">public</span> AMapLocationClient mLocationClient<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明定位回调监听器</span>
    <span class="token keyword">public</span> AMapLocationClientOption mLocationOption<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    Location_Bean location_bean<span class="token punctuation">;</span>
    <span class="token keyword">private</span>   String CityId<span class="token punctuation">;</span>
    @Override
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        HeConfig<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">"HE1909121339201612"</span><span class="token punctuation">,</span><span class="token string">"083fbdf0edca4082813382b9551043e9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        HeConfig<span class="token punctuation">.</span><span class="token function">switchToFreeServerNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ButterKnife<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//初始化定位</span>
                mLocationClient<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMapLocationClient</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置定位回调监听</span>
mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationListener</span><span class="token punctuation">(</span>mLocationListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
mLocationOption <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMapLocationClientOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置定位模式为高精度模式，AMapLocationMode.Battery_Saving为低功耗模式，AMapLocationMode.Device_Sensors是仅设备模式</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setLocationMode</span><span class="token punctuation">(</span>AMapLocationClientOption<span class="token punctuation">.</span>AMapLocationMode<span class="token punctuation">.</span>Hight_Accuracy<span class="token punctuation">)</span><span class="token punctuation">;</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setNeedAddress</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置是否返回地址信息（默认返回地址信息）</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setOnceLocation</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置是否只定位一次,默认为false</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setWifiActiveScan</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置是否强制刷新WIFI，默认为强制刷新</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setMockEnable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置是否允许模拟位置,默认为false，不允许模拟位置</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置定位间隔,单位毫秒,默认为2000ms</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setOnceLocation</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可选，是否设置单次定位默认为false即持续定位</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setOnceLocationLatest</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可选，设置是否等待wifi刷新，默认为false.如果设置为true,会自动变为单次定位，持续定位时不要使用</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setWifiScan</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可选，设置是否开启wifi扫描。默认为true，如果设置为false会同时停止主动刷新，停止以后完全依赖于系统刷新，定位位置可能存在误差</span>
mLocationOption<span class="token punctuation">.</span><span class="token function">setLocationCacheEnable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可选，设置是否使用缓存定位，默认为true</span>
<span class="token comment">//给定位客户端对象设置定位参数</span>
mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationOption</span><span class="token punctuation">(</span>mLocationOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//启动定位</span>
mLocationClient<span class="token punctuation">.</span><span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> AMapLocationListener mLocationListener<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMapLocationListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        @Override
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLocationChanged</span><span class="token punctuation">(</span>AMapLocation aMapLocation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                   <span class="token comment">//定位成功回调信息，设置相关消息</span>
                    aMapLocation<span class="token punctuation">.</span><span class="token function">getLocationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取当前定位结果来源，如网络定位结果，详见定位类型表</span>
                   <span class="token comment">// aMapLocation.getLatitude();//获取纬度</span>
                   <span class="token comment">// aMapLocation.getLongitude();//获取经度</span>
                    aMapLocation<span class="token punctuation">.</span><span class="token function">getAccuracy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取精度信息</span>
                    java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>SimpleDateFormat df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span>SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token comment">//  aMapLocation.getAddress();//地址，如果option中设置isNeedAddress为false，则没有此结果，网络定位结果中会有地址信息，GPS定位不返回地址信息。</span>
                  <span class="token comment">//  aMapLocation.getCountry();//国家信息</span>
                  <span class="token comment">//  aMapLocation.getProvince();//省信息</span>
                  <span class="token comment">//  aMapLocation.getCity();//城市信息</span>
                 <span class="token comment">//   aMapLocation.getDistrict();//城区信息</span>
                <span class="token comment">//    aMapLocation.getStreet();//街道信息</span>
               <span class="token comment">//     aMapLocation.getStreetNum();//街道门牌号信息</span>
                <span class="token comment">//    aMapLocation.getCityCode();//城市编码</span>
               <span class="token comment">//     aMapLocation.getAdCode();//地区编码</span>
                    <span class="token comment">//获取经纬度</span>
                  double  LongitudeId <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  double LatitudeId <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token comment">//获取定位城市定位的ID</span>
                    <span class="token function">requestCityInfo</span><span class="token punctuation">(</span>LongitudeId<span class="token punctuation">,</span>LatitudeId<span class="token punctuation">)</span><span class="token punctuation">;</span>      
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"所在城市："</span><span class="token operator">+</span>aMapLocation<span class="token punctuation">.</span><span class="token function">getProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>aMapLocation<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Toast<span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mLocationClient<span class="token punctuation">.</span><span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//停止定位</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//显示错误信息ErrCode是错误码，errInfo是错误信息，详见错误码表。</span>
                    Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token string">"location Error, ErrCode:"</span>
                            <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", errInfo:"</span>
                            <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">requestCityInfo</span><span class="token punctuation">(</span>double longitude<span class="token punctuation">,</span>double latitude<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//这里的key是webapi key</span>
           String cityUrl <span class="token operator">=</span> <span class="token string">"https://search.heweather.net/find?location="</span><span class="token operator">+</span>longitude<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>latitude<span class="token operator">+</span><span class="token string">"&amp;key=4fe5a769d1cd45509d0e8146bd032e65"</span><span class="token punctuation">;</span>
           <span class="token function">sendRequestWithOkHttp</span><span class="token punctuation">(</span>cityUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//解析根据经纬度获取到的含有城市id的json数据，这里我使用原始的jsonObject与jsonArray来解析，网上也有使用jsonformat插件来，你们也可以那样做</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendRequestWithOkHttp</span><span class="token punctuation">(</span>String cityUrl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            @Override
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                OkHttpClient okHttpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Request request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>cityUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    Response response <span class="token operator">=</span> okHttpClient<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//返回城市列表json数据</span>
                    String responseData <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"变成json数据的格式："</span><span class="token operator">+</span>responseData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    JSONObject jsonWeather <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        jsonWeather <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        JSONArray jsonArray <span class="token operator">=</span> jsonWeather<span class="token punctuation">.</span><span class="token function">getJSONArray</span><span class="token punctuation">(</span><span class="token string">"HeWeather6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        JSONObject jsonObject <span class="token operator">=</span> jsonArray<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        String jsonStatus <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解析以后的内容："</span><span class="token operator">+</span>jsonStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>jsonStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            JSONArray jsonBasic <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getJSONArray</span><span class="token punctuation">(</span><span class="token string">"basic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            JSONObject jsonCityId <span class="token operator">=</span> jsonBasic<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            CityId <span class="token operator">=</span> jsonCityId<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">getWether</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getWether</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 实况天气
         * 实况天气即为当前时间点的天气状况以及温湿风压等气象指数，具体包含的数据：体感温度、
         * 实测温度、天气状况、风力、风速、风向、相对湿度、大气压强、降水量、能见度等。
         *
         * @param context  上下文
         * @param location 地址详解
         * @param lang       多语言，默认为简体中文
         * @param unit        单位选择，公制（m）或英制（i），默认为公制单位
         * @param listener  网络访问回调接口
         */</span>
        HeWeather<span class="token punctuation">.</span><span class="token function">getWeatherNow</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> CityId<span class="token punctuation">,</span> Lang<span class="token punctuation">.</span><span class="token constant">CHINESE_SIMPLIFIED</span> <span class="token punctuation">,</span> Unit<span class="token punctuation">.</span><span class="token constant">METRIC</span> <span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HeWeather<span class="token punctuation">.</span>OnResultWeatherNowBeanListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">TAG</span><span class="token operator">=</span><span class="token string">"he_feng_now"</span><span class="token punctuation">;</span>
            @Override
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span>Throwable e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"onError: "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Weather Now Error:"</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            @Override
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span>Now dataObject<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">" Weather Now onSuccess: "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dataObject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String jsonData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dataObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回的数据内容："</span><span class="token operator">+</span>dataObject<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String tianqi <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>wendu <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tianqicode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dataObject<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    String JsonNow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dataObject<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>JsonNow<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        tianqi <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"cond_txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        wendu <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        tianqicode <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"cond_code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"有错误"</span><span class="token punctuation">,</span>Toast<span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                String wendu2 <span class="token operator">=</span> wendu <span class="token operator">+</span><span class="token string">"℃"</span><span class="token punctuation">;</span>
                textViewList<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前天气:"</span><span class="token operator">+</span>tianqi<span class="token punctuation">)</span><span class="token punctuation">;</span>
                textViewList<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前温度:"</span><span class="token operator">+</span>wendu2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                String tagurl <span class="token operator">=</span> <span class="token string">"https://cdn.heweather.com/cond_icon/"</span> <span class="token operator">+</span>tianqicode<span class="token operator">+</span><span class="token string">".png"</span><span class="token punctuation">;</span>
               Glide<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>tagurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        HeWeather<span class="token punctuation">.</span><span class="token function">getAirNow</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>CityId<span class="token punctuation">,</span> Lang<span class="token punctuation">.</span><span class="token constant">CHINESE_SIMPLIFIED</span><span class="token punctuation">,</span> Unit<span class="token punctuation">.</span><span class="token constant">METRIC</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HeWeather<span class="token punctuation">.</span>OnResultAirNowBeansListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">TAG2</span><span class="token operator">=</span><span class="token string">"he_feng_air"</span><span class="token punctuation">;</span>
            @Override
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span>Throwable throwable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG2</span><span class="token punctuation">,</span><span class="token string">"ERROR IS:"</span><span class="token punctuation">,</span>throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            @Override
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span>AirNow airNow<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG2</span><span class="token punctuation">,</span><span class="token string">"Air Now onSuccess:"</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>airNow<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String airStatus <span class="token operator">=</span> airNow<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>airStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    String jsonData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>airNow<span class="token punctuation">.</span><span class="token function">getAir_now_city</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    String aqi <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>qlty <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    JSONObject objectAir <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        objectAir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        aqi <span class="token operator">=</span> objectAir<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"aqi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        qlty <span class="token operator">=</span> objectAir<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"qlty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        textViewList<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"天气状况:"</span><span class="token operator">+</span>qlty<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span><span class="token string">"空气质量:"</span><span class="token operator">+</span><span class="token string">"("</span><span class="token operator">+</span>aqi<span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>MainActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"有错误"</span><span class="token punctuation">,</span>Toast<span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>好啦，之前说好的总算是做到了，写了这篇。有问题欢迎批评指正，一起讨论！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/60fc879dc831e022fc82c10c0ed98833/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring阶段性学习总结（十 二）切面的优先级的优先级</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5798efc29b49456cc55aa6813a3d8dc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IGMP基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>