<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sklearn实现支持向量机(异常检测) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sklearn实现支持向量机(异常检测)" />
<meta property="og:description" content="💥 项目专栏：sklearn实现经典机器学习算法(附代码&#43;原理介绍)
文章目录 前言一、算法背景1. 算法背景：基本原理：核函数： 2. 异常检测：决策函数：超参数： 3. 算法优势与局限性：优势：局限性： 4. 应用场景：5. 实践中的考虑： 二、算法原理1. 基本概念：2. 数据映射：3. 目标函数和优化：4. 核函数：5. 参数选择：6. 异常检测：7. 应用和局限性：8. 算法原理的数学表达：9. 实际应用注意事项： 三、算法实现3.1 导包3.2 加载数据集3.3 定义模型1. 鲁棒协方差 (EllipticEnvelope)2. 单类SVM (OneClassSVM)3. 单类SVM (SGD)4. 隔离森林 (IsolationForest)5. 局部异常因子 (LocalOutlierFactor) 3.4 可视化异常检测算法 完整源码 前言 🌟 哈喽，亲爱的小伙伴们，你们知道吗？最近我们的粉丝群里有好多小可爱私信问我一些关于决策树、逻辑回归等机器学习的超级有趣的问题呢！🌈 为了让大家更轻松地理解，我决定开一个超可爱的专栏，叫做 用sklearn玩转机器学习，特别适合机器学习的小新手哦！
🍬 在这个专栏里，我们会用sklearn这个超级强大的魔法工具来实现各种闪闪发光的机器学习算法！不用担心难度哦，我会用最简单、最可爱的方式，带领大家一起探索算法的神秘世界！✨
🎈 适合哪些小伙伴加入呢？当然是对机器学习感兴趣的小新手们，还有那些刚开始接触sklearn的可爱宝宝们！我们会一起学习如何用sklearn轻松实现那些看起来好厉害的机器学习算法，让新手小白也能快快乐乐地理解它们哦！
🌸 在这个专栏里，大家可以看到用sklearn实现的机器学习算法，我们不仅仅是理论学习哦，每一篇文章都会附带 完整的代码&#43;超级可爱的原理讲解，让大家在轻松愉快的氛围中一起学习成长呢！🌼 快来加入我们的学习大冒险吧！
🚨 我的项目环境：
平台：Windows11语言环境：Python 3.10编译器：Jupyter Lab、PyCharmscikit-learn：1.2.1Pandas：1.3.5Numpy：1.19.3Scipy：1.7.3Matplotlib：3.1.3 💥 项目专栏：sklearn实现经典机器学习算法(附代码&#43;原理介绍)
一、算法背景 支持向量机（SVM）在异常检测领域的应用主要是通过一种特殊形式的SVM实现的，即单类支持向量机（One-Class SVM）。这种方法的核心思想是基于数据集找出一个决策边界，这个边界尽可能地包含所有正常数据点（inliers），同时排除异常数据点（outliers）。下面是One-Class SVM在异常检测中应用的一些关键点：
1. 算法背景： 基本原理： 单类分类：与传统的SVM不同，One-Class SVM专注于单一类别的数据。它的目标是找到一个最佳边界，这个边界围绕着数据空间中的正常点，而将异常点排除在外。特征空间映射：One-Class SVM利用核技巧将数据映射到高维特征空间，在这个空间中寻找最优的边界来分隔正常点和异常点。 核函数： 核函数用于处理非线性可分的数据。常见的核函数包括线性核、多项式核、径向基函数（RBF）核等。核函数的选择对算法的性能有显著影响。 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/70adc37a446820b7f9e936eee136382a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-15T12:09:14+08:00" />
<meta property="article:modified_time" content="2024-01-15T12:09:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sklearn实现支持向量机(异常检测)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/5d/dc/slEj48kA_o.jpg" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>💥 项目专栏：<a href="https://weibaohang.blog.csdn.net/article/details/135440007" rel="nofollow">sklearn实现经典机器学习算法(附代码+原理介绍)</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_8" rel="nofollow">前言</a></li><li><a href="#_41" rel="nofollow">一、算法背景</a></li><li><ul><li><ul><li><a href="#1__45" rel="nofollow">1. 算法背景：</a></li><li><ul><li><a href="#_47" rel="nofollow">基本原理：</a></li><li><a href="#_51" rel="nofollow">核函数：</a></li></ul> 
    </li><li><a href="#2__54" rel="nofollow">2. 异常检测：</a></li><li><ul><li><a href="#_56" rel="nofollow">决策函数：</a></li><li><a href="#_59" rel="nofollow">超参数：</a></li></ul> 
    </li><li><a href="#3__65" rel="nofollow">3. 算法优势与局限性：</a></li><li><ul><li><a href="#_67" rel="nofollow">优势：</a></li><li><a href="#_72" rel="nofollow">局限性：</a></li></ul> 
    </li><li><a href="#4__77" rel="nofollow">4. 应用场景：</a></li><li><a href="#5__83" rel="nofollow">5. 实践中的考虑：</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_88" rel="nofollow">二、算法原理</a></li><li><ul><li><ul><li><a href="#1__92" rel="nofollow">1. 基本概念：</a></li><li><a href="#2__96" rel="nofollow">2. 数据映射：</a></li><li><a href="#3__100" rel="nofollow">3. 目标函数和优化：</a></li><li><a href="#4__107" rel="nofollow">4. 核函数：</a></li><li><a href="#5__115" rel="nofollow">5. 参数选择：</a></li><li><a href="#6__122" rel="nofollow">6. 异常检测：</a></li><li><a href="#7__126" rel="nofollow">7. 应用和局限性：</a></li><li><a href="#8__134" rel="nofollow">8. 算法原理的数学表达：</a></li><li><a href="#9__144" rel="nofollow">9. 实际应用注意事项：</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_150" rel="nofollow">三、算法实现</a></li><li><ul><li><a href="#31__152" rel="nofollow">3.1 导包</a></li><li><a href="#32__170" rel="nofollow">3.2 加载数据集</a></li><li><a href="#33__208" rel="nofollow">3.3 定义模型</a></li><li><ul><li><a href="#1__EllipticEnvelope_255" rel="nofollow">1. 鲁棒协方差 (EllipticEnvelope)</a></li><li><a href="#2_SVM_OneClassSVM_264" rel="nofollow">2. 单类SVM (OneClassSVM)</a></li><li><a href="#3_SVM_SGD_277" rel="nofollow">3. 单类SVM (SGD)</a></li><li><a href="#4__IsolationForest_289" rel="nofollow">4. 隔离森林 (IsolationForest)</a></li><li><a href="#5__LocalOutlierFactor_300" rel="nofollow">5. 局部异常因子 (LocalOutlierFactor)</a></li></ul> 
   </li><li><a href="#34__316" rel="nofollow">3.4 可视化异常检测算法</a></li></ul> 
  </li><li><a href="#_396" rel="nofollow">完整源码</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_8"></a>前言</h2> 
<p>🌟 哈喽，亲爱的小伙伴们，你们知道吗？最近我们的粉丝群里有好多小可爱私信问我一些关于决策树、逻辑回归等机器学习的超级有趣的问题呢！🌈 为了让大家更轻松地理解，我决定开一个超可爱的专栏，叫做 <code>用sklearn玩转机器学习</code>，特别适合机器学习的小新手哦！</p> 
<p>🍬 在这个专栏里，我们会用sklearn这个超级强大的魔法工具来实现各种闪闪发光的机器学习算法！不用担心难度哦，我会用最简单、最可爱的方式，带领大家一起探索算法的神秘世界！✨</p> 
<p>🎈 适合哪些小伙伴加入呢？当然是对机器学习感兴趣的小新手们，还有那些刚开始接触sklearn的可爱宝宝们！我们会一起学习如何用sklearn轻松实现那些看起来好厉害的机器学习算法，让新手小白也能快快乐乐地理解它们哦！</p> 
<p>🌸 在这个专栏里，大家可以看到用sklearn实现的机器学习算法，我们不仅仅是理论学习哦，每一篇文章都会附带 <code>完整的代码+超级可爱的原理讲解</code>，让大家在轻松愉快的氛围中一起学习成长呢！🌼 快来加入我们的学习大冒险吧！</p> 
<hr> 
<p><img src="https://images2.imgbox.com/8e/32/UoDydEf4_o.jpg" alt="在这里插入图片描述"></p> 
<p>🚨 我的项目环境：</p> 
<ul><li>平台：Windows11</li><li>语言环境：Python 3.10</li><li>编译器：Jupyter Lab、PyCharm</li><li>scikit-learn：1.2.1</li><li>Pandas：1.3.5</li><li>Numpy：1.19.3</li><li>Scipy：1.7.3</li><li>Matplotlib：3.1.3</li></ul> 
<p>💥 项目专栏：<a href="https://weibaohang.blog.csdn.net/article/details/135440007" rel="nofollow">sklearn实现经典机器学习算法(附代码+原理介绍)</a></p> 
<hr> 
<h2><a id="_41"></a>一、算法背景</h2> 
<p>支持向量机（SVM）在异常检测领域的应用主要是通过一种特殊形式的SVM实现的，即单类支持向量机（One-Class SVM）。这种方法的核心思想是基于数据集找出一个决策边界，这个边界尽可能地包含所有正常数据点（inliers），同时排除异常数据点（outliers）。下面是One-Class SVM在异常检测中应用的一些关键点：</p> 
<h4><a id="1__45"></a>1. 算法背景：</h4> 
<h5><a id="_47"></a>基本原理：</h5> 
<ul><li><strong>单类分类</strong>：与传统的SVM不同，One-Class SVM专注于单一类别的数据。它的目标是找到一个最佳边界，这个边界围绕着数据空间中的正常点，而将异常点排除在外。</li><li><strong>特征空间映射</strong>：One-Class SVM利用核技巧将数据映射到高维特征空间，在这个空间中寻找最优的边界来分隔正常点和异常点。</li></ul> 
<h5><a id="_51"></a>核函数：</h5> 
<ul><li>核函数用于处理非线性可分的数据。常见的核函数包括线性核、多项式核、径向基函数（RBF）核等。核函数的选择对算法的性能有显著影响。</li></ul> 
<h4><a id="2__54"></a>2. 异常检测：</h4> 
<h5><a id="_56"></a>决策函数：</h5> 
<ul><li>One-Class SVM的决策函数基于数据点与决策边界的距离。这个距离用于判断一个新的观测点是正常点还是异常点。</li></ul> 
<h5><a id="_59"></a>超参数：</h5> 
<ul><li><strong>ν（nu）</strong>：这个参数是One-Class SVM中的关键参数，它控制着模型的敏感度。ν是一个介于0到1之间的值，代表异常点所占的比例上限和支持向量所占的比例下限。</li><li><strong>γ（gamma）</strong>：当使用RBF核时，γ参数定义了单个训练样本影响的</li></ul> 
<p>范围。较大的γ值意味着更近的点有更大的影响，这可能导致过拟合；而较小的γ值意味着更远的点也会影响决策边界，这可能导致欠拟合。</p> 
<h4><a id="3__65"></a>3. 算法优势与局限性：</h4> 
<h5><a id="_67"></a>优势：</h5> 
<ul><li><strong>适用于非线性数据</strong>：通过使用核函数，One-Class SVM可以有效处理非线性可分的数据集。</li><li><strong>适用于高维数据</strong>：SVM在高维空间中表现良好，尤其适合于特征维数高于样本数的情况。</li><li><strong>灵活性</strong>：通过调整核函数和超参数，可以适应不同的数据分布和异常检测需求。</li></ul> 
<h5><a id="_72"></a>局限性：</h5> 
<ul><li><strong>参数选择敏感</strong>：ν和γ等超参数的选择对模型性能有很大影响，但在没有标签数据的情况下很难选择最优参数。</li><li><strong>计算成本</strong>：尤其是在大数据集上，One-Class SVM的训练可能非常耗时。</li><li><strong>对异常点敏感</strong>：One-Class SVM可能对训练数据中的异常点敏感，这可能导致模型过度适应这些点。</li></ul> 
<h4><a id="4__77"></a>4. 应用场景：</h4> 
<p>One-Class SVM通常用于如下场景：</p> 
<ul><li><strong>新颖性检测</strong>：在训练时只有正常数据可用，目的是检测新的异常样本。</li><li><strong>异常检测</strong>：在复杂数据集中识别异常或离群值，尤其是在无法明确界定正常和异常数据分布的情况下。</li></ul> 
<h4><a id="5__83"></a>5. 实践中的考虑：</h4> 
<p>在实际应用中，需要综合考虑数据的特性、可用资源以及特定需求来决定是否使用One-Class SVM以及如何调整其参数。通常，需要通过交叉验证、网格搜索等方法来优化参数选择。同时，对于大型数据集，可能需要考虑使用更高效的算法或使用技术如随机梯度下降来降低计算成本。</p> 
<h2><a id="_88"></a>二、算法原理</h2> 
<p>支持向量机（SVM）在异常检测中通常采用其特殊形式——单类支持向量机（One-Class SVM）。这种方法基于寻找数据中的正常模式，并尽可能排除异常点。下面是单类支持向量机在异常检测中的算法原理：</p> 
<h4><a id="1__92"></a>1. 基本概念：</h4> 
<p>单类支持向量机的核心思想是找到一个最小的超球体，它可以包含数据集中的大部分（或者一个指定比例的）正常点，同时将异常点排除在外。</p> 
<h4><a id="2__96"></a>2. 数据映射：</h4> 
<p>由于原始数据空间中的点可能不是线性可分的，单类SVM使用核技巧将数据映射到一个更高维的空间。在这个空间中，数据点更有可能是线性可分的，从而使算法能够找到一个能够包围大部分数据点的超球体。</p> 
<h4><a id="3__100"></a>3. 目标函数和优化：</h4> 
<p>单类SVM的目标是最大化超球体的体积，同时确保大部分数据点都在超球体内。这可以通过以下优化问题实现：</p> 
<ul><li><strong>最小化</strong>：超球体的半径的平方，以及一个松弛变量（用于处理异常点）的总和。</li><li><strong>约束条件</strong>：确保数据点要么在超球体内部，要么在松弛范围内。</li></ul> 
<h4><a id="4__107"></a>4. 核函数：</h4> 
<p>单类SVM通常使用核函数来处理非线性数据。常见的核函数包括：</p> 
<ul><li><strong>线性核</strong>：用于线性可分的数据。</li><li><strong>径向基函数（RBF）核</strong>：能够处理非线性关系。</li><li><strong>多项式核</strong>：另一种处理非线性关系的方法。</li></ul> 
<h4><a id="5__115"></a>5. 参数选择：</h4> 
<p>单类SVM的性能高度依赖于参数的选择，主要包括：</p> 
<ul><li><strong>ν（nu）</strong>：这是一个介于0和1之间的参数，代表异常点（或支持向量）所占的最大比例。较小的ν值使模型更严格，只允许少数异常点。</li><li><strong>γ（gamma）</strong>：仅在使用RBF核时相关，它决定了单个数据点影响的范围。较高的γ值会导致更紧密的边界。</li></ul> 
<h4><a id="6__122"></a>6. 异常检测：</h4> 
<p>一旦模型被训练，它可以被用来评估新的数据点是否为异常。如果一个点位于超球体之外，则被视为异常。</p> 
<h4><a id="7__126"></a>7. 应用和局限性：</h4> 
<ul><li> <p><strong>应用</strong>：单类SVM非常适用于“新颖性检测”场景，其中在训练阶段只有正常数据可用，目标是识别在操作环境中出现的任何异常或新奇模式。它也用于检测工业系统中的故障、金融领域中的欺诈行为以及在网络安全中识别入侵等场景。</p> </li><li> <p><strong>局限性</strong>：单类SVM的主要限制之一是它的计算复杂性，特别是在处理大型数据集时。此外，它对参数选择非常敏感，错误的参数设置可能导致模型性能不佳。此外，如果训练数据中包含异常点，这可能会影响模型的准确性。</p> </li></ul> 
<h4><a id="8__134"></a>8. 算法原理的数学表达：</h4> 
<p>设 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
         = 
        
       
         { 
        
        
        
          x 
         
        
          1 
         
        
       
         , 
        
        
        
          x 
         
        
          2 
         
        
       
         , 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         , 
        
        
        
          x 
         
        
          n 
         
        
       
         } 
        
       
      
        X = \{x_1, x_2, ..., x_n\} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span> 是训练数据集，单类SVM的目标是找到一个函数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         ( 
        
       
         x 
        
       
         ) 
        
       
      
        f(x) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>，使得对于大多数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          i 
         
        
       
      
        x_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，有 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         ( 
        
        
        
          x 
         
        
          i 
         
        
       
         ) 
        
       
         ≥ 
        
       
         0 
        
       
      
        f(x_i) \geq 0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>。这个函数的形式通常是：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          = 
         
        
          sign 
         
        
          ( 
         
        
          w 
         
        
          ⋅ 
         
        
          ϕ 
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          − 
         
        
          ρ 
         
        
          ) 
         
        
       
         f(x) = \text{sign}(w \cdot \phi(x) - \rho) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">sign</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ρ</span><span class="mclose">)</span></span></span></span></span></span></p> 
<p>其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
      
        w 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span></span></span></span></span> 是正常数据的特征向量，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ϕ 
        
       
         ( 
        
       
         x 
        
       
         ) 
        
       
      
        \phi(x) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> 是将数据映射到高维空间的函数，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ρ 
        
       
      
        \rho 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">ρ</span></span></span></span></span> 是决策边界的偏移量。</p> 
<p>优化目标是最小化 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∥ 
        
       
         w 
        
        
        
          ∥ 
         
        
          2 
         
        
       
      
        \|w\|^2 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord">∥</span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> 和松弛变量的总和，同时确保大部分的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          i 
         
        
       
      
        x_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 满足 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         ⋅ 
        
       
         ϕ 
        
       
         ( 
        
        
        
          x 
         
        
          i 
         
        
       
         ) 
        
       
         ≥ 
        
       
         ρ 
        
       
      
        w \cdot \phi(x_i) \geq \rho 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4445em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">ρ</span></span></span></span></span>。</p> 
<h4><a id="9__144"></a>9. 实际应用注意事项：</h4> 
<p>在实际应用中，很重要的一点是通过交叉验证或其他方法合理选择核函数和参数（如 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ν 
        
       
      
        \nu 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0637em;">ν</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         γ 
        
       
      
        \gamma 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0556em;">γ</span></span></span></span></span>）。此外，对于大型数据集，可能需要采用更高效的实现或使用基于近似方法的变体，如使用随机梯度下降的SGDOneClassSVM。</p> 
<h2><a id="_150"></a>三、算法实现</h2> 
<h3><a id="31__152"></a>3.1 导包</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>covariance <span class="token keyword">import</span> EllipticEnvelope
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_blobs<span class="token punctuation">,</span> make_moons
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> IsolationForest
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>kernel_approximation <span class="token keyword">import</span> Nystroem
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDOneClassSVM
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> LocalOutlierFactor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> make_pipeline
</code></pre> 
<h3><a id="32__170"></a>3.2 加载数据集</h3> 
<p>这段代码的作用是创建用于异常检测算法测试的多个合成数据集。具体来说：</p> 
<ol><li> <p><strong>示例设置</strong>：</p> 
  <ul><li>定义了总共300个样本。</li><li>设定了异常值的比例为15%，据此计算出异常值和正常值的数量。</li></ul> </li><li> <p><strong>数据集定义</strong>：</p> 
  <ul><li>使用<code>make_blobs</code>和<code>make_moons</code>函数生成不同特性的合成数据集。</li><li>第一个数据集：中心位于(0, 0)，标准差为0.5，创建了一个标准的、紧密的点群。</li><li>第二个和第三个数据集：分别创建了两个中心点在(2, 2)和(-2, -2)的点群，但标准差不同（分别为0.5和[1.5, 0.3]），生成了形状和密度不同的数据群。</li><li>第四个数据集：利用<code>make_moons</code>函数生成了两个交叠的月牙形数据群，这对于测试算法在处理有特定形状的数据集时的能力很有用。</li><li>第五个数据集：随机生成了均匀分布的点，范围在一个大的区域内，用于测试算法在处理均匀分布数据时的性能。</li></ul> </li></ol> 
<p>这些数据集被设计用来评估和比较不同的异常检测算法在处理不同类型的数据时的性能，如密集点群、具有特定几何形状的数据，以及均匀分布的数据。</p> 
<pre><code class="prism language-python"><span class="token comment"># 示例设置</span>
n_samples <span class="token operator">=</span> <span class="token number">300</span>  <span class="token comment"># 样本总数</span>
outliers_fraction <span class="token operator">=</span> <span class="token number">0.15</span>  <span class="token comment"># 异常值比例</span>
n_outliers <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>outliers_fraction <span class="token operator">*</span> n_samples<span class="token punctuation">)</span>  <span class="token comment"># 异常值数量</span>
n_inliers <span class="token operator">=</span> n_samples <span class="token operator">-</span> n_outliers  <span class="token comment"># 正常值数量</span>

<span class="token comment"># 定义数据集</span>
blobs_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> n_samples<span class="token operator">=</span>n_inliers<span class="token punctuation">,</span> n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
datasets <span class="token operator">=</span> <span class="token punctuation">[</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>make_moons<span class="token punctuation">(</span>n_samples<span class="token operator">=</span>n_samples<span class="token punctuation">,</span> noise<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">14</span> <span class="token operator">*</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>RandomState<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rand<span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="33__208"></a>3.3 定义模型</h3> 
<p>这段代码定义了一组用于比较的异常检测方法。每种方法都是为了识别和分离数据集中的异常值（即离群值）。具体来说：</p> 
<ol><li> <p><strong>鲁棒协方差 (EllipticEnvelope)</strong>：</p> 
  <ul><li>这种方法基于假设正常数据遵循高斯分布（椭圆分布）。</li><li>使用<code>contamination</code>参数来估计数据集中异常值的比例。</li><li>在二维数据上特别有效，适用于检测远离正常数据群体中心的异常点。</li></ul> </li><li> <p><strong>单类SVM (OneClassSVM)</strong>：</p> 
  <ul><li>这种方法使用单类支持向量机来识别异常值。</li><li><code>nu</code>参数指定了训练集中异常点的预期比例。</li><li>使用径向基函数（RBF）核和<code>gamma</code>参数来控制决策边界的形状。</li></ul> </li><li> <p><strong>单类SVM (SGD)</strong>：</p> 
  <ul><li>这是单类SVM的一种变体，使用随机梯度下降（SGD）进行优化。</li><li>结合了核近似（Nystroem方法）来处理大规模数据集。</li><li>适用于需要处理大量数据或需要更快计算速度的场景。</li></ul> </li><li> <p><strong>隔离森林 (IsolationForest)</strong>：</p> 
  <ul><li>该方法基于随机森林，通过隔离异常点而非构造正常点的表示。</li><li><code>contamination</code>参数用于估计数据集中的异常比例。</li><li>适合处理高维数据和大规模数据集。</li></ul> </li><li> <p><strong>局部异常因子 (LocalOutlierFactor)</strong>：</p> 
  <ul><li>这种方法考虑了数据点相对于其邻居的局部密度偏差。</li><li>通过比较给定点和其邻居的局部密度，识别密度显著低于其邻居的点作为异常。</li><li><code>n_neighbors</code>用于指定用于估计局部密度的邻居数量。</li></ul> </li></ol> 
<p>这些方法各有特点，适用于不同的数据类型和场景。在实际应用中，选择哪种方法取决于数据的特性、问题的特定需求以及性能要求。</p> 
<pre><code class="prism language-python"><span class="token comment"># 定义用于比较的异常检测方法</span>
anomaly_algorithms <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">"鲁棒协方差"</span><span class="token punctuation">,</span> EllipticEnvelope<span class="token punctuation">(</span>contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"单类SVM"</span><span class="token punctuation">,</span> svm<span class="token punctuation">.</span>OneClassSVM<span class="token punctuation">(</span>nu<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"rbf"</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"单类SVM (SGD)"</span><span class="token punctuation">,</span> make_pipeline<span class="token punctuation">(</span>
        Nystroem<span class="token punctuation">(</span>gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> n_components<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        SGDOneClassSVM<span class="token punctuation">(</span>nu<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fit_intercept<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-6</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"隔离森林"</span><span class="token punctuation">,</span> IsolationForest<span class="token punctuation">(</span>contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"局部异常因子"</span><span class="token punctuation">,</span> LocalOutlierFactor<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>这些异常检测模型的主要参数。</p> 
<h4><a id="1__EllipticEnvelope_255"></a>1. 鲁棒协方差 (EllipticEnvelope)</h4> 
<table><thead><tr><th>参数</th><th>描述</th><th>可选的值/类型</th></tr></thead><tbody><tr><td><code>contamination</code></td><td>数据集中异常值的比例估计。</td><td>浮点数（0到1之间）</td></tr><tr><td><code>random_state</code></td><td>随机数生成器的种子。</td><td>整数或None</td></tr><tr><td><code>support_fraction</code></td><td>用于估计协方差矩阵的数据点比例。</td><td>浮点数（0到1之间）</td></tr><tr><td><code>store_precision</code></td><td>是否存储精确的逆协方差矩阵。</td><td>布尔值</td></tr><tr><td><code>assume_centered</code></td><td>是否假设数据已居中。如果为True，将不会计算数据中心。</td><td>布尔值</td></tr></tbody></table> 
<h4><a id="2_SVM_OneClassSVM_264"></a>2. 单类SVM (OneClassSVM)</h4> 
<table><thead><tr><th>参数</th><th>描述</th><th>可选的值/类型</th></tr></thead><tbody><tr><td><code>nu</code></td><td>异常样本比例的上界和支持向量的下界。</td><td>浮点数（0到1之间）</td></tr><tr><td><code>kernel</code></td><td>核函数类型。</td><td>‘linear’, ‘poly’, ‘rbf’, ‘sigmoid’, ‘precomputed’</td></tr><tr><td><code>gamma</code></td><td>核函数的系数（仅对‘rbf’, ‘poly’和‘simgoid’有效）。</td><td>正浮点数、‘scale’、‘auto’</td></tr><tr><td><code>degree</code></td><td>多项式核的次数（仅对‘poly’核有效）。</td><td>正整数</td></tr><tr><td><code>coef0</code></td><td>核函数的独立项（仅对‘poly’和‘simgoid’核有效）。</td><td>浮点数</td></tr><tr><td><code>tol</code></td><td>收敛容忍度。</td><td>正浮点数</td></tr><tr><td><code>shrinking</code></td><td>是否使用收缩启发式。</td><td>布尔值</td></tr><tr><td><code>cache_size</code></td><td>内核缓存大小（MB）。</td><td>正浮点数</td></tr><tr><td><code>max_iter</code></td><td>最大迭代次数。</td><td>正整数或-1（无限制）</td></tr></tbody></table> 
<h4><a id="3_SVM_SGD_277"></a>3. 单类SVM (SGD)</h4> 
<table><thead><tr><th>参数</th><th>描述</th><th>可选的值/类型</th></tr></thead><tbody><tr><td><code>nu</code></td><td>异常样本比例的上界。</td><td>浮点数（0到1之间）</td></tr><tr><td><code>shuffle</code></td><td>在每次迭代时是否打乱数据顺序。</td><td>布尔值</td></tr><tr><td><code>fit_intercept</code></td><td>是否计算截距。</td><td>布尔值</td></tr><tr><td><code>random_state</code></td><td>随机数生成器的种子。</td><td>整数或None</td></tr><tr><td><code>tol</code></td><td>停止迭代的容忍度。</td><td>正浮点数</td></tr><tr><td><code>max_iter</code></td><td>最大迭代次数。</td><td>正整数</td></tr><tr><td><code>n_components</code></td><td>Nystroem核近似的组件数。</td><td>正整数</td></tr><tr><td><code>gamma</code></td><td>Nystroem核函数的系数（仅对‘rbf’, ‘poly’和‘simgoid’有效）。</td><td>正浮点数、‘scale’、‘auto’</td></tr></tbody></table> 
<h4><a id="4__IsolationForest_289"></a>4. 隔离森林 (IsolationForest)</h4> 
<table><thead><tr><th>参数</th><th>描述</th><th>可选的值/类型</th></tr></thead><tbody><tr><td><code>contamination</code></td><td>数据集中异常值的比例估计。</td><td>浮点数（0到0.5之间）、‘auto’</td></tr><tr><td><code>random_state</code></td><td>随机数生成器的种子。</td><td>整数或None</td></tr><tr><td><code>n_estimators</code></td><td>构建的树的数量。</td><td>正整数</td></tr><tr><td><code>max_samples</code></td><td>用于训练每棵树的样本数量。</td><td>正整数或浮点数（0到1之间）</td></tr><tr><td><code>max_features</code></td><td>每棵树的最大特征数量。</td><td>正整数</td></tr><tr><td><code>bootstrap</code></td><td>是否对样本进行自助采样。</td><td>布尔值</td></tr><tr><td><code>n_jobs</code></td><td>并行运行的任务数。</td><td>正整数或None</td></tr></tbody></table> 
<h4><a id="5__LocalOutlierFactor_300"></a>5. 局部异常因子 (LocalOutlierFactor)</h4> 
<table><thead><tr><th>参数</th><th>描述</th><th>可选的值/类型</th></tr></thead><tbody><tr><td><code>n_neighbors</code></td><td>用于估计局部密度的邻居数量。</td><td>正整数</td></tr><tr><td><code>contamination</code></td><td>数据集中异常值的比例估计。</td><td>浮点数（0到0.5之间）、‘auto’</td></tr><tr><td><code>metric</code></td><td>计算邻居间距离的方式。</td><td>字符串（例如 ‘euclidean’, ‘manhattan’, ‘minkowski’, 等）</td></tr><tr><td><code>algorithm</code></td><td>用于计算最近邻居的算法。</td><td>‘auto’, ‘ball_tree’, ‘kd_tree’, ‘brute’</td></tr><tr><td><code>leaf_size</code></td><td>传递给‘ball_tree’或‘kd_tree’的叶大小。</td><td>正整数</td></tr><tr><td><code>p</code></td><td>Minkowski距离的幂参数（仅在metric='minkowski’时使用）。</td><td>正整数</td></tr><tr><td><code>novelty</code></td><td>是否用于新颖性检测（在未见过的新数据上进行预测）。</td><td>布尔值</td></tr><tr><td><code>n_jobs</code></td><td>并行运行的任务数。</td><td>正整数或None</td></tr></tbody></table> 
<p>这些参数为每种异常检测方法提供了不同的配置选项，使它们可以根据特定的数据特征和应用场景进行调整。理解和合理设置这些参数对于优化模型性能和提高异常检测的准确性至关重要。</p> 
<h3><a id="34__316"></a>3.4 可视化异常检测算法</h3> 
<p>这段代码的目的是为了可视化不同异常检测算法在多个合成数据集上的性能。具体步骤如下：</p> 
<ol><li> <p><strong>绘图网格设置</strong>：首先，它创建了一个网格（<code>xx</code>, <code>yy</code>），这个网格用于绘制异常检测的决策边界。</p> </li><li> <p><strong>创建绘图窗口</strong>：接着，代码设置了一个绘图窗口，并根据异常检测算法的数量调整窗口大小。</p> </li><li> <p><strong>数据集处理</strong>：对于每个预先定义的数据集，代码会添加一些随机生成的异常值。</p> </li><li> <p><strong>算法应用与计时</strong>：每种异常检测算法都应用于扩展后的数据集，并记录算法拟合数据所需的时间。</p> </li><li> <p><strong>绘制结果</strong>：对于每种算法和数据集的组合，代码绘制了数据点和决策边界。对于支持<code>predict</code>方法的算法，使用等高线来表示决策边界。每个点根据其被算法判定为正常或异常的预测结果着色。</p> </li><li> <p><strong>布局调整和显示</strong>：最后，代码调整了每个子图的布局，并在图的右下角显示了算法拟合所用的时间。完成所有绘图后，通过<code>plt.show()</code>展示最终的可视化结果。</p> </li></ol> 
<p>这段代码是一种直观展示不同异常检测算法如何在不同类型的数据集上工作的有效方法，可以清楚地看到每种算法对于正常和异常数据点的分类情况，以及其决策边界的形状。</p> 
<p><img src="https://images2.imgbox.com/32/d3/TlsyKqJ2_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 设置用于绘图的网格</span>
xx<span class="token punctuation">,</span> yy <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 创建绘图窗口</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>anomaly_algorithms<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>left<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token number">0.98</span><span class="token punctuation">,</span> bottom<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span> top<span class="token operator">=</span><span class="token number">0.96</span><span class="token punctuation">,</span> wspace<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> hspace<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>

plot_num <span class="token operator">=</span> <span class="token number">1</span>
rng <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>RandomState<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 对每个数据集进行处理</span>
<span class="token keyword">for</span> i_dataset<span class="token punctuation">,</span> X <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>datasets<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 添加异常值</span>
    X <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> rng<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> high<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>n_outliers<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> name<span class="token punctuation">,</span> algorithm <span class="token keyword">in</span> anomaly_algorithms<span class="token punctuation">:</span>
        t0 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        t1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>datasets<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>anomaly_algorithms<span class="token punctuation">)</span><span class="token punctuation">,</span> plot_num<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i_dataset <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>name<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>

        <span class="token comment"># 对数据拟合并标记异常值</span>
        <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"局部异常因子"</span><span class="token punctuation">:</span>
            y_pred <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            y_pred <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>

        <span class="token comment"># 绘制等高线和点</span>
        <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">"局部异常因子"</span><span class="token punctuation">:</span>  <span class="token comment"># LOF没有实现predict方法</span>
            Z <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>xx<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> yy<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            Z <span class="token operator">=</span> Z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>xx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>xx<span class="token punctuation">,</span> yy<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> levels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidths<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> colors<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

        colors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"#377eb8"</span><span class="token punctuation">,</span> <span class="token string">"#ff7f00"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span><span class="token punctuation">(</span>y_pred <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span>
            <span class="token number">0.99</span><span class="token punctuation">,</span>
            <span class="token number">0.01</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"用时 %.2fs"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            transform<span class="token operator">=</span>plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transAxes<span class="token punctuation">,</span>
            size<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span>
            horizontalalignment<span class="token operator">=</span><span class="token string">"right"</span>
        <span class="token punctuation">)</span>
        plot_num <span class="token operator">+=</span> <span class="token number">1</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_396"></a>完整源码</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>covariance <span class="token keyword">import</span> EllipticEnvelope
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_blobs<span class="token punctuation">,</span> make_moons
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> IsolationForest
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>kernel_approximation <span class="token keyword">import</span> Nystroem
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDOneClassSVM
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> LocalOutlierFactor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> make_pipeline

<span class="token comment"># 设置matplotlib参数以支持中文显示</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>  <span class="token comment"># 指定默认字体</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token comment"># 解决保存图像是负号'-'显示为方块的问题</span>

<span class="token comment"># 示例设置</span>
n_samples <span class="token operator">=</span> <span class="token number">300</span>  <span class="token comment"># 样本总数</span>
outliers_fraction <span class="token operator">=</span> <span class="token number">0.15</span>  <span class="token comment"># 异常值比例</span>
n_outliers <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>outliers_fraction <span class="token operator">*</span> n_samples<span class="token punctuation">)</span>  <span class="token comment"># 异常值数量</span>
n_inliers <span class="token operator">=</span> n_samples <span class="token operator">-</span> n_outliers  <span class="token comment"># 正常值数量</span>

<span class="token comment"># 定义用于比较的异常检测方法</span>
anomaly_algorithms <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">"鲁棒协方差"</span><span class="token punctuation">,</span> EllipticEnvelope<span class="token punctuation">(</span>contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"单类SVM"</span><span class="token punctuation">,</span> svm<span class="token punctuation">.</span>OneClassSVM<span class="token punctuation">(</span>nu<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">"rbf"</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"单类SVM (SGD)"</span><span class="token punctuation">,</span> make_pipeline<span class="token punctuation">(</span>
        Nystroem<span class="token punctuation">(</span>gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> n_components<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        SGDOneClassSVM<span class="token punctuation">(</span>nu<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fit_intercept<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">1e-6</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"隔离森林"</span><span class="token punctuation">,</span> IsolationForest<span class="token punctuation">(</span>contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"局部异常因子"</span><span class="token punctuation">,</span> LocalOutlierFactor<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> contamination<span class="token operator">=</span>outliers_fraction<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 定义数据集</span>
blobs_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> n_samples<span class="token operator">=</span>n_inliers<span class="token punctuation">,</span> n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
datasets <span class="token operator">=</span> <span class="token punctuation">[</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    make_blobs<span class="token punctuation">(</span>centers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>blobs_params<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>make_moons<span class="token punctuation">(</span>n_samples<span class="token operator">=</span>n_samples<span class="token punctuation">,</span> noise<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">14</span> <span class="token operator">*</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>RandomState<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rand<span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 设置用于绘图的网格</span>
xx<span class="token punctuation">,</span> yy <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 创建绘图窗口</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>anomaly_algorithms<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>left<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token number">0.98</span><span class="token punctuation">,</span> bottom<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span> top<span class="token operator">=</span><span class="token number">0.96</span><span class="token punctuation">,</span> wspace<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> hspace<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>

plot_num <span class="token operator">=</span> <span class="token number">1</span>
rng <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>RandomState<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 对每个数据集进行处理</span>
<span class="token keyword">for</span> i_dataset<span class="token punctuation">,</span> X <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>datasets<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 添加异常值</span>
    X <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> rng<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> high<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>n_outliers<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> name<span class="token punctuation">,</span> algorithm <span class="token keyword">in</span> anomaly_algorithms<span class="token punctuation">:</span>
        t0 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        t1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>datasets<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>anomaly_algorithms<span class="token punctuation">)</span><span class="token punctuation">,</span> plot_num<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i_dataset <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>name<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>

        <span class="token comment"># 对数据拟合并标记异常值</span>
        <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"局部异常因子"</span><span class="token punctuation">:</span>
            y_pred <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            y_pred <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>

        <span class="token comment"># 绘制等高线和点</span>
        <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">"局部异常因子"</span><span class="token punctuation">:</span>  <span class="token comment"># LOF没有实现predict方法</span>
            Z <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>xx<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> yy<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            Z <span class="token operator">=</span> Z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>xx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>xx<span class="token punctuation">,</span> yy<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> levels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidths<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> colors<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

        colors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"#377eb8"</span><span class="token punctuation">,</span> <span class="token string">"#ff7f00"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span><span class="token punctuation">(</span>y_pred <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span>
            <span class="token number">0.99</span><span class="token punctuation">,</span>
            <span class="token number">0.01</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"用时 %.2fs"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            transform<span class="token operator">=</span>plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transAxes<span class="token punctuation">,</span>
            size<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span>
            horizontalalignment<span class="token operator">=</span><span class="token string">"right"</span>
        <span class="token punctuation">)</span>
        plot_num <span class="token operator">+=</span> <span class="token number">1</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e3b868ae60aa33bc4d9ed01617e31397/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">北京程序员年薪中位数超 60 万元，2023 全球程序员收入报告出炉</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b5356bbd89804f8f7b575f2dc09e2b7c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">arcgis javascript api4.x加载天地图wgs84（wkid：4326）坐标系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>