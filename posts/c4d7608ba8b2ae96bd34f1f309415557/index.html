<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>速腾16线激光雷达&#43;瑞芬TL720D陀螺仪&#43;LIO-SAM算法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="速腾16线激光雷达&#43;瑞芬TL720D陀螺仪&#43;LIO-SAM算法" />
<meta property="og:description" content="【开发背景】 最近正在做室内转室外的无人车项目，首当其冲的就是解决室外建图问题。之前室内一直用的Cartographer 2D建图，效果蛮好的，但是就是面临大场景的时候，闭环检测太吃平台算力了，所以现在只能换一个激光SLAM算法。网上搜索了一下目前流行的室外激光SLAM，发现LIO-SAM使用的人比较多，相关踩坑记录也比较丰富，索性就拿它试水了。
【硬件信息】 Robosense速腾16线激光雷达
Rion瑞芬TL720D陀螺转角仪
Intel NUC工控机
【安装流程】 1、创建一个干净的工作空间目录：
mkdir -p ~/liosam_ws/src cd ~/liosam_ws/src 2、下载lio-sam源码及其依赖
sudo apt-get install -y ros-melodic-robot-localization sudo apt-get install -y ros-melodic-robot-state-publisher sudo add-apt-repository ppa:borglab/gtsam-release-4.0 sudo apt install libgtsam-dev libgtsam-unstable-dev git clone https://ghproxy.com/https://github.com/TixiaoShan/LIO-SAM.git 3、下载robosense激光雷达ros驱动包
git clone https://ghproxy.com/https://github.com/RoboSense-LiDAR/rslidar_sdk.git cd rslidar_sdk git submodule init git submodule update 4、下载robosense雷达点云转velodyne雷达的功能包
git clone https://github.com/HViktorTsoi/rs_to_velodyne.git 5、自己写一个瑞芬imu的ros驱动包
6、下载imu内参标定工具及其依赖
sudo apt-get install libdw-dev git clone https://gitcode.net/mirrors/gaowenliang/code_utils.git git clone https://gitcode.net/mirrors/gaowenliang/imu_utils.git 7、回到工程目录编译
cd ~/liosam_ws catkin_make 【编译问题】 不出所料，你的catkin_make一定会失败，接下来我们一一进行修改：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c4d7608ba8b2ae96bd34f1f309415557/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-21T17:51:54+08:00" />
<meta property="article:modified_time" content="2023-07-21T17:51:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">速腾16线激光雷达&#43;瑞芬TL720D陀螺仪&#43;LIO-SAM算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>【开发背景】</h4> 
<p>最近正在做室内转室外的无人车项目，首当其冲的就是解决室外建图问题。之前室内一直用的Cartographer 2D建图，效果蛮好的，但是就是面临大场景的时候，闭环检测太吃平台算力了，所以现在只能换一个激光SLAM算法。网上搜索了一下目前流行的室外激光SLAM，发现LIO-SAM使用的人比较多，相关踩坑记录也比较丰富，索性就拿它试水了。</p> 
<h4>【硬件信息】</h4> 
<p>Robosense速腾16线激光雷达</p> 
<p>Rion瑞芬TL720D陀螺转角仪</p> 
<p>Intel NUC工控机</p> 
<h4>【安装流程】</h4> 
<p>1、创建一个干净的工作空间目录：</p> 
<pre><code class="language-bash">mkdir -p ~/liosam_ws/src
cd ~/liosam_ws/src</code></pre> 
<p>2、下载lio-sam源码及其依赖</p> 
<pre><code class="language-bash">sudo apt-get install -y ros-melodic-robot-localization
sudo apt-get install -y ros-melodic-robot-state-publisher
sudo add-apt-repository ppa:borglab/gtsam-release-4.0
sudo apt install libgtsam-dev libgtsam-unstable-dev
git clone https://ghproxy.com/https://github.com/TixiaoShan/LIO-SAM.git
</code></pre> 
<p>3、下载robosense激光雷达ros驱动包</p> 
<pre><code class="language-bash">git clone https://ghproxy.com/https://github.com/RoboSense-LiDAR/rslidar_sdk.git
cd rslidar_sdk
git submodule init
git submodule update</code></pre> 
<p>4、下载robosense雷达点云转velodyne雷达的功能包</p> 
<pre><code class="language-bash">git clone https://github.com/HViktorTsoi/rs_to_velodyne.git</code></pre> 
<p>5、自己写一个瑞芬imu的ros驱动包</p> 
<p>6、下载imu内参标定工具及其依赖</p> 
<pre><code class="language-bash">sudo apt-get install libdw-dev
git clone https://gitcode.net/mirrors/gaowenliang/code_utils.git
git clone https://gitcode.net/mirrors/gaowenliang/imu_utils.git</code></pre> 
<p>7、回到工程目录编译</p> 
<pre><code class="language-bash">cd ~/liosam_ws
catkin_make</code></pre> 
<h4>【编译问题】</h4> 
<p>不出所料，你的catkin_make一定会失败，接下来我们一一进行修改：</p> 
<p>1、修改 imu_utils 包的CMakeLists.txt的32行</p> 
<pre><code class="language-bash">catkin_package(CATKIN_DEPENDS code_utils)</code></pre> 
<p>2、修改 imu_utils 包的package.xml的53行</p> 
<pre><code class="language-XML">&lt;build_depend&gt;code_utils&lt;/build_depend&gt;
&lt;exec_depend&gt;code_utils&lt;/exec_depend&gt;</code></pre> 
<p>3、修改 ~/liosam_ws/src/code_utils-master/src/sumpixel_test.cpp 文件的第2行</p> 
<pre><code class="language-cpp">#include "code_utils/backward.hpp"</code></pre> 
<p> 4、修改 ~/liosam_ws/src/rs_to_velodyne/src/rs_to_velodyne.cpp 第28到38行</p> 
<pre><code class="language-cpp">struct RsPointXYZIRT {
    PCL_ADD_POINT4D;
    float intensity;
    uint16_t ring = 0;
    double timestamp = 0;

    EIGEN_MAKE_ALIGNED_OPERATOR_NEW
} EIGEN_ALIGN16;
POINT_CLOUD_REGISTER_POINT_STRUCT(RsPointXYZIRT,
                                  (float, x, x)(float, y, y)(float, z, z)(float, intensity, intensity)
                                          (uint16_t, ring, ring)(double, timestamp, timestamp))</code></pre> 
<p> 5、修改 ~/liosam_ws/src/rslidar_sdk/CMakeLists.txt 第8行</p> 
<pre><code class="language-bash">set(POINT_TYPE XYZIRT)</code></pre> 
<p>6、现在再编译，应该就没问题了，如果还有问题，请留言</p> 
<h4>【必要工作】</h4> 
<p>1、IMU内参校准</p> 
<p>将IMU静置不动，开启以下程序进行内参计算</p> 
<pre><code class="language-bash">roslaunch rion_imu imu.launch        #开启瑞芬imu驱动
roslaunch imu_utils tl720d.launch    #开启校准
</code></pre> 
<p>2、LIO-SAM参数设置（ ~/liosam_ws/src/LIO-SAM/config/params.yaml）</p> 
<pre><code class="language-bash">  # IMU Settings 用标定工具得到的数据替换这些参数
  imuAccNoise: 3.9939570888238808e-03
  imuGyrNoise: 1.5636343949698187e-03
  imuAccBiasN: 6.4356659353532566e-05
  imuGyrBiasN: 3.5640318696367613e-05
  imuGravity: 9.80511
  imuRPYWeight: 0.01

  # Extrinsics: T_lb (lidar -&gt; imu) 建议imu直接放在雷达正上方，给一个单位矩阵即可
  extrinsicTrans: [0.0, 0.0, 0.0]
  extrinsicRot: [1, 0, 0,
                  0, 1, 0,
                  0, 0, 1]
  extrinsicRPY: [1, 0, 0,
                 0, 1, 0,
                 0, 0, 1]
</code></pre> 
<h4>【运行指令】</h4> 
<p>只要你各部分的Topic话题都对上了，用以下命令就可以开始跑了</p> 
<pre><code class="language-bash">#开启rs雷达
roslaunch rslidar_sdk start.launch

#开启话题转换
rosrun rs_to_velodyne rs_to_velodyne XYZIRT XYZIRT

#开启imu
roslaunch rion imu.launch

#开启lio-sam建图
roslaunch lio_sam run.launch</code></pre> 
<h4>【额外记录】</h4> 
<p>1、点云PCD文件转栅格地图PGM</p> 
<pre><code class="language-bash">git clone https://ghproxy.com/https://github.com/Hinson-A/pcd2pgm_package.git
</code></pre> 
<p>2、安装3D点云实时转2D栅格地图软件包Octomap</p> 
<pre><code class="language-bash">sudo apt-get install ros-melodic-octomap-ros 
sudo apt-get install ros-melodic-octomap-server
sudo apt-get install ros-melodic-octomap-rviz-plugins</code></pre> 
<p>一个可参考的launch文件</p> 
<pre><code class="language-XML">&lt;launch&gt;
  &lt;!--启动的节点--&gt;
  &lt;node pkg="octomap_server" type="octomap_server_node" name="octomap_server"&gt; 

     &lt;!--栅格分辨率--&gt;
    &lt;param name="resolution" value="0.05" /&gt;
    
    &lt;!--世界坐标系话题，一般为map--&gt;
    &lt;param name="frame_id" type="string" value="/map" /&gt;
 
    &lt;param name="sensor_model/max_range" value="1000.0" /&gt;
    &lt;param name="latch" value="true" /&gt;
 
     &lt;!--截取的三维点云范围--&gt; 
    &lt;param name="pointcloud_max_z" value="1.2" /&gt;
    &lt;param name="pointcloud_min_z" value="-0.5" /&gt;
 
    &lt;param name="graound_filter_angle" value="3.14" /&gt;
    
     &lt;!--订阅的点云消息名称 PointClout2，即上一步发布出来的点云topic--&gt; 
     &lt;!-- cloud_in是octomap默认的输入话题，做一下映射--&gt;
    &lt;remap from="/cloud_in" to="/lio_sam/mapping/cloud_registered" /&gt;
  &lt;/node&gt;
 
&lt;/launch&gt;
</code></pre> 
<p>3、Ouster雷达驱动安装</p> 
<pre><code class="language-bash">##配置电脑ip 
192.168.2.1
子网掩码 255.255.255.0

##配置雷达ip，这里的 eno1 要换成你自己的网卡名称，ping一下测试
sudo dnsmasq -C /dev/null -kd -F 192.168.2.2,192.168.2.100 -i enp3s0 --bind-dynamic

git clone https://ghproxy.com/https://github.com/ouster-lidar/ouster_example
catkin_make

## 时间戳如果没有改成正确模式，会出现没有map坐标系的现象，雷达和imu外参标定不准会有抖动现象
## os-122130000698需要根据自己雷达型号更改
roslaunch ouster_ros sensor.launch sensor_hostname:=os-122130000698.local lidar_mode:=2048x10 timestamp_mode:=TIME_FROM_ROS_TIME 


#查找雷达当前地址
avahi-browse -lr _roger._tcp 

## 设置雷达静态ip，可以设置下，这样雷达每次启动ip就不会变了
https://ouster.atlassian.net/wiki/spaces/SUPPORT/pages/831062017/IP
</code></pre> 
<p>4、一个问题（move_base下面的代价子图只更新了一半（180度））</p> 
<p>解决办法：手动调用costmap更新服务</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dec417587b1b6efb1ebff277bb56a462/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一个脚本实现实时小窗口功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef53c6305f6026ffa4eff76ebc8e61a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IIS部署WebGL调用iLab平台接口跨域问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>