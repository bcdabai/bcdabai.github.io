<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在linux下调试oled12864显示屏 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在linux下调试oled12864显示屏" />
<meta property="og:description" content="通过i2c方式在linux3.10下调试oled12864显示屏
调试步骤：
1、确认硬件
1.1、确认硬件连接是spi还是i2c（本文采用的是通过i2c方式）。
1.2、检查硬件是否有肉眼可见的问题（虚焊或脱落）。
2、修改驱动代码
2.1、在drivers/video下选择合适的驱动代码（仅仅是找个驱动框架，也可以自己写），并在dts的对应i2c中添加对应的内容。
2.2、参考中景园中51单片机的代码，借用里面初始化代码和read、write函数，并在linux3.10下驱动代码中实现这些功能。
2.3、调通关键是i2c是否能读到设备地址的内容，如果能读到即代表完成了80%。
2.4、实现应用层需要调用驱动的接口。
2.5、写应用测试程序来验证屏幕能否正常显示。
本人调试遇到问题：
1、主控通过i2c不能读到oled屏设备内容，而且不断发送无法响应
分析：
1.1、检查是否有设备节点生成。
1.2、在i2c发送数据前将发送内容打印出来，确认发送内容是否存在问题。
1.3、通过示波器测量时钟信号和数据信号查看是否能测出来，并查看高低电平的值是多少。
1.4、前面3种办法无法查出问题，可以通过代码实现发送指定内容，然后在屏设备这边用逻积分析仪查看内容是否一致。
通过分析得知主控发送到oled的电压高低电平是0V和1.8V，但oled屏需要0V和3.3V才能驱动，所以硬件修改了下，然后就可以读到内容了。
参考博客：
https://blog.csdn.net/qq_33553024/article/details/84783587
附代码：（代码测试可用）
dts：
ssd1307: oled@3c {
compatible = “solomon,ssd1307fb-i2c”; reg = &lt;0x3c&gt;; reset-gpios = &lt;&amp;gpio2 GPIO_A10 5&gt;;
};
drivers：
#include &lt;linux/module.h&gt;
#include &lt;linux/kernel.h&gt;
#include &lt;linux/i2c.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;linux/uaccess.h&gt;
#include &lt;linux/of_device.h&gt;
#include &lt;linux/of_gpio.h&gt;
#include &lt;linux/pwm.h&gt;
#include &lt;linux/delay.h&gt;
#define SSD1307FB_WIDTH 128
#define SSD1307FB_HEIGHT 64
#define SSD1307FB_DATA 0x40
#define SSD1307FB_COMMAND 0x00" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/741a1bc8b9f940d76c6d4217afe5b69a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-01T16:18:00+08:00" />
<meta property="article:modified_time" content="2020-11-01T16:18:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在linux下调试oled12864显示屏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>通过i2c方式在linux3.10下调试oled12864显示屏<br> <img src="https://images2.imgbox.com/e6/b8/v4o7r3PW_o.png" alt="在这里插入图片描述"><br> 调试步骤：<br> 1、确认硬件<br> 1.1、确认硬件连接是spi还是i2c（本文采用的是通过i2c方式）。<br> 1.2、检查硬件是否有肉眼可见的问题（虚焊或脱落）。<br> 2、修改驱动代码<br> 2.1、在drivers/video下选择合适的驱动代码（仅仅是找个驱动框架，也可以自己写），并在dts的对应i2c中添加对应的内容。<br> 2.2、参考中景园中51单片机的代码，借用里面初始化代码和read、write函数，并在linux3.10下驱动代码中实现这些功能。<br> 2.3、调通关键是i2c是否能读到设备地址的内容，如果能读到即代表完成了80%。<br> 2.4、实现应用层需要调用驱动的接口。<br> 2.5、写应用测试程序来验证屏幕能否正常显示。</p> 
<p>本人调试遇到问题：<br> 1、主控通过i2c不能读到oled屏设备内容，而且不断发送无法响应<br> 分析：<br> 1.1、检查是否有设备节点生成。<br> 1.2、在i2c发送数据前将发送内容打印出来，确认发送内容是否存在问题。<br> 1.3、通过示波器测量时钟信号和数据信号查看是否能测出来，并查看高低电平的值是多少。<br> 1.4、前面3种办法无法查出问题，可以通过代码实现发送指定内容，然后在屏设备这边用逻积分析仪查看内容是否一致。<br> 通过分析得知主控发送到oled的电压高低电平是0V和1.8V，但oled屏需要0V和3.3V才能驱动，所以硬件修改了下，然后就可以读到内容了。</p> 
<p>参考博客：<br> https://blog.csdn.net/qq_33553024/article/details/84783587</p> 
<p>附代码：（代码测试可用）<br> dts：<br> ssd1307: oled@3c {<!-- --><br> compatible = “solomon,ssd1307fb-i2c”; <br> reg = &lt;0x3c&gt;; <br> reset-gpios = &lt;&amp;gpio2 GPIO_A10 5&gt;;<br> };</p> 
<p>drivers：<br> #include &lt;linux/module.h&gt;<br> #include &lt;linux/kernel.h&gt;<br> #include &lt;linux/i2c.h&gt;<br> #include &lt;linux/fb.h&gt;<br> #include &lt;linux/uaccess.h&gt;<br> #include &lt;linux/of_device.h&gt;<br> #include &lt;linux/of_gpio.h&gt;<br> #include &lt;linux/pwm.h&gt;<br> #include &lt;linux/delay.h&gt;</p> 
<p>#define SSD1307FB_WIDTH 128<br> #define SSD1307FB_HEIGHT 64</p> 
<p>#define SSD1307FB_DATA 0x40<br> #define SSD1307FB_COMMAND 0x00</p> 
<p>int mark = 0;</p> 
<p>#define Max_Column 128<br> #define Max_Row 64</p> 
<p>#define SSD1307FB_CONTRAST 0x81<br> #define SSD1307FB_SEG_REMAP_ON 0xa1<br> #define SSD1307FB_DISPLAY_OFF 0xae<br> #define SSD1307FB_DISPLAY_ON 0xaf<br> #define SSD1307FB_START_PAGE_ADDRESS 0xb0</p> 
<p>#if 1<br> unsigned char F6x8[][6] =<br> {<!-- --><br> {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},// sp<br> {0x00, 0x00, 0x00, 0x2f, 0x00, 0x00},// !<br> {0x00, 0x00, 0x07, 0x00, 0x07, 0x00},// "<br> {0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14},// #<br> {0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12},// $<br> {0x00, 0x62, 0x64, 0x08, 0x13, 0x23},// %<br> {0x00, 0x36, 0x49, 0x55, 0x22, 0x50},// &amp;<br> {0x00, 0x00, 0x05, 0x03, 0x00, 0x00},// ’<br> {0x00, 0x00, 0x1c, 0x22, 0x41, 0x00},// (<br> {0x00, 0x00, 0x41, 0x22, 0x1c, 0x00},// )<br> {0x00, 0x14, 0x08, 0x3E, 0x08, 0x14},// *<br> {0x00, 0x08, 0x08, 0x3E, 0x08, 0x08},// +<br> {0x00, 0x00, 0x00, 0xA0, 0x60, 0x00},// ,<br> {0x00, 0x08, 0x08, 0x08, 0x08, 0x08},// -<br> {0x00, 0x00, 0x60, 0x60, 0x00, 0x00},// .<br> {0x00, 0x20, 0x10, 0x08, 0x04, 0x02},// /<br> {0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E},// 0<br> {0x00, 0x00, 0x42, 0x7F, 0x40, 0x00},// 1<br> {0x00, 0x42, 0x61, 0x51, 0x49, 0x46},// 2<br> {0x00, 0x21, 0x41, 0x45, 0x4B, 0x31},// 3<br> {0x00, 0x18, 0x14, 0x12, 0x7F, 0x10},// 4<br> {0x00, 0x27, 0x45, 0x45, 0x45, 0x39},// 5<br> {0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30},// 6<br> {0x00, 0x01, 0x71, 0x09, 0x05, 0x03},// 7<br> {0x00, 0x36, 0x49, 0x49, 0x49, 0x36},// 8<br> {0x00, 0x06, 0x49, 0x49, 0x29, 0x1E},// 9<br> {0x00, 0x00, 0x36, 0x36, 0x00, 0x00},// :<br> {0x00, 0x00, 0x56, 0x36, 0x00, 0x00},// ;<br> {0x00, 0x08, 0x14, 0x22, 0x41, 0x00},// &lt;<br> {0x00, 0x14, 0x14, 0x14, 0x14, 0x14},// =<br> {0x00, 0x00, 0x41, 0x22, 0x14, 0x08},// &gt;<br> {0x00, 0x02, 0x01, 0x51, 0x09, 0x06},// ?<br> {0x00, 0x32, 0x49, 0x59, 0x51, 0x3E},// @<br> {0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C},// A<br> {0x00, 0x7F, 0x49, 0x49, 0x49, 0x36},// B<br> {0x00, 0x3E, 0x41, 0x41, 0x41, 0x22},// C<br> {0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C},// D<br> {0x00, 0x7F, 0x49, 0x49, 0x49, 0x41},// E<br> {0x00, 0x7F, 0x09, 0x09, 0x09, 0x01},// F<br> {0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A},// G<br> {0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F},// H<br> {0x00, 0x00, 0x41, 0x7F, 0x41, 0x00},// I<br> {0x00, 0x20, 0x40, 0x41, 0x3F, 0x01},// J<br> {0x00, 0x7F, 0x08, 0x14, 0x22, 0x41},// K<br> {0x00, 0x7F, 0x40, 0x40, 0x40, 0x40},// L<br> {0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F},// M<br> {0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F},// N<br> {0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E},// O<br> {0x00, 0x7F, 0x09, 0x09, 0x09, 0x06},// P<br> {0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E},// Q<br> {0x00, 0x7F, 0x09, 0x19, 0x29, 0x46},// R<br> {0x00, 0x46, 0x49, 0x49, 0x49, 0x31},// S<br> {0x00, 0x01, 0x01, 0x7F, 0x01, 0x01},// T<br> {0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F},// U<br> {0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F},// V<br> {0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F},// W<br> {0x00, 0x63, 0x14, 0x08, 0x14, 0x63},// X<br> {0x00, 0x07, 0x08, 0x70, 0x08, 0x07},// Y<br> {0x00, 0x61, 0x51, 0x49, 0x45, 0x43},// Z<br> {0x00, 0x00, 0x7F, 0x41, 0x41, 0x00},// [<br> {0x00, 0x55, 0x2A, 0x55, 0x2A, 0x55},// 55<br> {0x00, 0x00, 0x41, 0x41, 0x7F, 0x00},// ]<br> {0x00, 0x04, 0x02, 0x01, 0x02, 0x04},// ^<br> {0x00, 0x40, 0x40, 0x40, 0x40, 0x40},// _<br> {0x00, 0x00, 0x01, 0x02, 0x04, 0x00},// ’<br> {0x00, 0x20, 0x54, 0x54, 0x54, 0x78},// a<br> {0x00, 0x7F, 0x48, 0x44, 0x44, 0x38},// b<br> {0x00, 0x38, 0x44, 0x44, 0x44, 0x20},// c<br> {0x00, 0x38, 0x44, 0x44, 0x48, 0x7F},// d<br> {0x00, 0x38, 0x54, 0x54, 0x54, 0x18},// e<br> {0x00, 0x08, 0x7E, 0x09, 0x01, 0x02},// f<br> {0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C},// g<br> {0x00, 0x7F, 0x08, 0x04, 0x04, 0x78},// h<br> {0x00, 0x00, 0x44, 0x7D, 0x40, 0x00},// i<br> {0x00, 0x40, 0x80, 0x84, 0x7D, 0x00},// j<br> {0x00, 0x7F, 0x10, 0x28, 0x44, 0x00},// k<br> {0x00, 0x00, 0x41, 0x7F, 0x40, 0x00},// l<br> {0x00, 0x7C, 0x04, 0x18, 0x04, 0x78},// m<br> {0x00, 0x7C, 0x08, 0x04, 0x04, 0x78},// n<br> {0x00, 0x38, 0x44, 0x44, 0x44, 0x38},// o<br> {0x00, 0xFC, 0x24, 0x24, 0x24, 0x18},// p<br> {0x00, 0x18, 0x24, 0x24, 0x18, 0xFC},// q<br> {0x00, 0x7C, 0x08, 0x04, 0x04, 0x08},// r<br> {0x00, 0x48, 0x54, 0x54, 0x54, 0x20},// s<br> {0x00, 0x04, 0x3F, 0x44, 0x40, 0x20},// t<br> {0x00, 0x3C, 0x40, 0x40, 0x20, 0x7C},// u<br> {0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C},// v<br> {0x00, 0x3C, 0x40, 0x30, 0x40, 0x3C},// w<br> {0x00, 0x44, 0x28, 0x10, 0x28, 0x44},// x<br> {0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C},// y<br> {0x00, 0x44, 0x64, 0x54, 0x4C, 0x44},// z<br> {0x14, 0x14, 0x14, 0x14, 0x14, 0x14},// horiz lines</p> 
<p>};</p> 
<p>/***<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>8</em>16的点阵</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>/</p> 
<p>unsigned char F8X16[]=<br> {<!-- --><br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// 0<br> 0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x30,0x00,0x00,0x00,//! 1<br> 0x00,0x10,0x0C,0x06,0x10,0x0C,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//" 2<br> 0x40,0xC0,0x78,0x40,0xC0,0x78,0x40,0x00,0x04,0x3F,0x04,0x04,0x3F,0x04,0x04,0x00,//# 3<br> 0x00,0x70,0x88,0xFC,0x08,0x30,0x00,0x00,0x00,0x18,0x20,0xFF,0x21,0x1E,0x00,0x00,//$ 4<br> 0xF0,0x08,0xF0,0x00,0xE0,0x18,0x00,0x00,0x00,0x21,0x1C,0x03,0x1E,0x21,0x1E,0x00,//% 5<br> 0x00,0xF0,0x08,0x88,0x70,0x00,0x00,0x00,0x1E,0x21,0x23,0x24,0x19,0x27,0x21,0x10,//&amp; 6<br> 0x10,0x16,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//’ 7<br> 0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00,//( 8<br> 0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00,0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00,//) 9<br> 0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00,//* 10<br> 0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x1F,0x01,0x01,0x01,0x00,//+ 11<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xB0,0x70,0x00,0x00,0x00,0x00,0x00,//, 12<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,//- 13<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,//. 14<br> 0x00,0x00,0x00,0x00,0x80,0x60,0x18,0x04,0x00,0x60,0x18,0x06,0x01,0x00,0x00,0x00,/// 15</p> 
<p>0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//0 16<br> 0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//1 17<br> 0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,//2 18<br> 0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,//3 19<br> 0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,//4 20<br> 0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,//5 21<br> 0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,//6 22<br> 0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,//7 23<br> 0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,//8 24<br> 0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00,//9 25</p> 
<p>0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,//: 26<br> 0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x60,0x00,0x00,0x00,0x00,//; 27<br> 0x00,0x00,0x80,0x40,0x20,0x10,0x08,0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00,//&lt; 28<br> 0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00,//= 29<br> 0x00,0x08,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0x20,0x10,0x08,0x04,0x02,0x01,0x00,//&gt; 30<br> 0x00,0x70,0x48,0x08,0x08,0x08,0xF0,0x00,0x00,0x00,0x00,0x30,0x36,0x01,0x00,0x00,//? 31<br> 0xC0,0x30,0xC8,0x28,0xE8,0x10,0xE0,0x00,0x07,0x18,0x27,0x24,0x23,0x14,0x0B,0x00,//@ 32<br> 0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20,//A 33<br> 0x08,0xF8,0x88,0x88,0x88,0x70,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x11,0x0E,0x00,//B 34<br> 0xC0,0x30,0x08,0x08,0x08,0x08,0x38,0x00,0x07,0x18,0x20,0x20,0x20,0x10,0x08,0x00,//C 35<br> 0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00,//D 36<br> 0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x20,0x23,0x20,0x18,0x00,//E 37<br> 0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00,//F 38<br> 0xC0,0x30,0x08,0x08,0x08,0x38,0x00,0x00,0x07,0x18,0x20,0x20,0x22,0x1E,0x02,0x00,//G 39<br> 0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x20,0x3F,0x21,0x01,0x01,0x21,0x3F,0x20,//H 40<br> 0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//I 41<br> 0x00,0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,0x00,//J 42<br> 0x08,0xF8,0x88,0xC0,0x28,0x18,0x08,0x00,0x20,0x3F,0x20,0x01,0x26,0x38,0x20,0x00,//K 43<br> 0x08,0xF8,0x08,0x00,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x20,0x30,0x00,//L 44<br> 0x08,0xF8,0xF8,0x00,0xF8,0xF8,0x08,0x00,0x20,0x3F,0x00,0x3F,0x00,0x3F,0x20,0x00,//M 45<br> 0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00,//N 46<br> 0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00,//O 47<br> 0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00,0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00,//P 48<br> 0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x18,0x24,0x24,0x38,0x50,0x4F,0x00,//Q 49<br> 0x08,0xF8,0x88,0x88,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x00,0x03,0x0C,0x30,0x20,//R 50<br> 0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00,//S 51<br> 0x18,0x08,0x08,0xF8,0x08,0x08,0x18,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//T 52<br> 0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//U 53<br> 0x08,0x78,0x88,0x00,0x00,0xC8,0x38,0x08,0x00,0x00,0x07,0x38,0x0E,0x01,0x00,0x00,//V 54<br> 0xF8,0x08,0x00,0xF8,0x00,0x08,0xF8,0x00,0x03,0x3C,0x07,0x00,0x07,0x3C,0x03,0x00,//W 55<br> 0x08,0x18,0x68,0x80,0x80,0x68,0x18,0x08,0x20,0x30,0x2C,0x03,0x03,0x2C,0x30,0x20,//X 56<br> 0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//Y 57<br> 0x10,0x08,0x08,0x08,0xC8,0x38,0x08,0x00,0x20,0x38,0x26,0x21,0x20,0x20,0x18,0x00,//Z 58<br> 0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00,//[ 59<br> 0x00,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x06,0x38,0xC0,0x00,//\ 60<br> 0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,//] 61<br> 0x00,0x00,0x04,0x02,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//^ 62<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,//_ 63<br> 0x00,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//` 64<br> 0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x19,0x24,0x22,0x22,0x22,0x3F,0x20,//a 65<br> 0x08,0xF8,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x3F,0x11,0x20,0x20,0x11,0x0E,0x00,//b 66<br> 0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x0E,0x11,0x20,0x20,0x20,0x11,0x00,//c 67<br> 0x00,0x00,0x00,0x80,0x80,0x88,0xF8,0x00,0x00,0x0E,0x11,0x20,0x20,0x10,0x3F,0x20,//d 68<br> 0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x22,0x13,0x00,//e 69<br> 0x00,0x80,0x80,0xF0,0x88,0x88,0x88,0x18,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//f 70<br> 0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x6B,0x94,0x94,0x94,0x93,0x60,0x00,//g 71<br> 0x08,0xF8,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//h 72<br> 0x00,0x80,0x98,0x98,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//i 73<br> 0x00,0x00,0x00,0x80,0x98,0x98,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,//j 74<br> 0x08,0xF8,0x00,0x00,0x80,0x80,0x80,0x00,0x20,0x3F,0x24,0x02,0x2D,0x30,0x20,0x00,//k 75<br> 0x00,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//l 76<br> 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x20,0x3F,0x20,0x00,0x3F,0x20,0x00,0x3F,//m 77<br> 0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//n 78<br> 0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//o 79<br> 0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,0x80,0xFF,0xA1,0x20,0x20,0x11,0x0E,0x00,//p 80<br> 0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x0E,0x11,0x20,0x20,0xA0,0xFF,0x80,//q 81<br> 0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x20,0x20,0x3F,0x21,0x20,0x00,0x01,0x00,//r 82<br> 0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x33,0x24,0x24,0x24,0x24,0x19,0x00,//s 83<br> 0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x1F,0x20,0x20,0x00,0x00,//t 84<br> 0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x1F,0x20,0x20,0x20,0x10,0x3F,0x20,//u 85<br> 0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x0E,0x30,0x08,0x06,0x01,0x00,//v 86<br> 0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x80,0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,0x00,//w 87<br> 0x00,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x31,0x2E,0x0E,0x31,0x20,0x00,//x 88<br> 0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x81,0x8E,0x70,0x18,0x06,0x01,0x00,//y 89<br> 0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x21,0x30,0x2C,0x22,0x21,0x30,0x00,//z 90<br> 0x00,0x00,0x00,0x00,0x80,0x7C,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x3F,0x40,0x40,//{ 91<br> 0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,//| 92<br> 0x00,0x02,0x02,0x7C,0x80,0x00,0x00,0x00,0x00,0x40,0x40,0x3F,0x00,0x00,0x00,0x00,//} 93<br> 0x00,0x06,0x01,0x01,0x02,0x02,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//~ 94</p> 
<p>};</p> 
<p>unsigned char F16X32[]=<br> {<!-- --><br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// 0 !"#$%&amp;’()*+,-./</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xFF,0xFF,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x0F,0x0F,0x06,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"!",0</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x80,0xE0,0x78,0x3C,0x1C,0x80,0xE0,0x78,0x3C,0x1C,0x00,0x00,0x00,<br> 0x00,0x00,0x03,0x01,0x00,0x00,0x00,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>""",1</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,<br> 0x00,0x38,0x38,0x38,0xF8,0x3F,0x38,0x38,0x38,0x38,0x38,0xF8,0x3F,0x38,0x38,0x00,<br> 0x00,0x70,0x70,0xF0,0xFF,0x70,0x70,0x70,0x70,0x70,0xF0,0xFF,0x70,0x70,0x70,0x00,<br> 0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,/<em>"#",2</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x80,0x80,0x40,0xF0,0x40,0x40,0x80,0x80,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x1E,0x7F,0xF0,0xC0,0xFF,0x00,0x00,0x0C,0x0F,0x0F,0x00,0x00,0x00,<br> 0x00,0x00,0xC0,0xC0,0xC0,0x00,0x01,0xFF,0x07,0x07,0x1E,0xFC,0xF0,0x00,0x00,0x00,<br> 0x00,0x00,0x03,0x07,0x04,0x08,0x08,0x7F,0x08,0x0C,0x06,0x03,0x01,0x00,0x00,0x00,/<em>"$",3</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x80,0xC0,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,<br> 0x7E,0xFF,0x00,0x00,0x00,0xFF,0x7E,0x00,0xE0,0x1C,0x03,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x01,0x03,0x02,0x83,0x61,0x1C,0x03,0xF8,0xFE,0x03,0x01,0x03,0xFE,0xF8,0x00,<br> 0x00,0x00,0x00,0x0C,0x03,0x00,0x00,0x00,0x01,0x07,0x0C,0x08,0x0C,0x07,0x01,0x00,/<em>"%",4</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x80,0xC0,0x40,0x40,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x7F,0xFF,0xC0,0x80,0x60,0x3F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0xF8,0xFC,0x03,0x03,0x0F,0x3E,0x78,0xE0,0x80,0x81,0x71,0x0F,0x01,0x01,0x00,0x00,<br> 0x01,0x03,0x06,0x0C,0x08,0x08,0x08,0x05,0x03,0x07,0x0E,0x0C,0x0C,0x06,0x03,0x00,/<em>"&amp;",5</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x1C,0x1C,0xFC,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x02,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"’",6</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x60,0x30,0x08,0x04,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xFC,0x0F,0x01,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x7F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x07,0x0C,0x18,0x20,0x40,0x00,/<em>"(",7</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x04,0x08,0x30,0x60,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x01,0x0F,0xFC,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFF,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x40,0x20,0x18,0x0C,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>")",8</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x18,0x38,0x30,0x60,0x40,0x86,0xFF,0x8F,0x40,0x60,0x30,0x38,0x18,0x00,<br> 0x00,0x00,0x18,0x1C,0x0C,0x06,0x02,0xF1,0xFF,0xE1,0x02,0x06,0x0C,0x1C,0x18,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"</em>",9*/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"+",10</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x80,0xC7,0x47,0x3F,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>",",11</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"-",12</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x06,0x0F,0x0F,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>".",13</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x70,0x18,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x70,0x1C,0x07,0x01,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0xC0,0x70,0x1C,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x30,0x1C,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>"/",14</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x40,0x40,0x40,0x80,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0xF0,0xFE,0x0F,0x01,0x00,0x00,0x00,0x00,0x01,0x07,0xFE,0xF0,0x00,0x00,<br> 0x00,0x00,0x3F,0xFF,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0x3F,0x00,0x00,<br> 0x00,0x00,0x00,0x01,0x03,0x06,0x0C,0x08,0x08,0x08,0x06,0x03,0x01,0x00,0x00,0x00,/<em>“0”,0</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x01,0x01,0x01,0x01,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x08,0x08,0x08,0x0C,0x0F,0x0F,0x0C,0x08,0x08,0x08,0x00,0x00,0x00,/<em>“1”,1</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x80,0x40,0x40,0x40,0x40,0x40,0xC0,0x80,0x80,0x00,0x00,0x00,<br> 0x00,0x00,0x1E,0x19,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC1,0xFF,0x3E,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x80,0x40,0x30,0x18,0x0C,0x06,0x03,0x01,0x00,0xC0,0x00,0x00,<br> 0x00,0x00,0x0E,0x0D,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0E,0x03,0x00,0x00,/<em>“2”,2</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x80,0x80,0x40,0x40,0x40,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x80,0xC1,0x7F,0x3E,0x00,0x00,0x00,<br> 0x00,0x00,0xC0,0xC0,0x00,0x00,0x01,0x01,0x01,0x03,0x02,0x06,0xFC,0xF0,0x00,0x00,<br> 0x00,0x00,0x03,0x07,0x04,0x08,0x08,0x08,0x08,0x08,0x04,0x06,0x03,0x00,0x00,0x00,/<em>“3”,3</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x80,0x60,0x10,0x0C,0x03,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x30,0x2C,0x26,0x21,0x20,0x20,0x20,0x20,0xFF,0xFF,0x20,0x20,0x20,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x08,0x0F,0x0F,0x08,0x08,0x08,0x00,0x00,/<em>“4”,4</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,<br> 0x00,0x00,0x00,0xFF,0x00,0x80,0x40,0x40,0x40,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0xC0,0xC3,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xFC,0x00,0x00,<br> 0x00,0x00,0x03,0x04,0x04,0x08,0x08,0x08,0x08,0x08,0x04,0x07,0x03,0x00,0x00,0x00,/<em>“5”,5</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x40,0x40,0x40,0x40,0x80,0x80,0x00,0x00,0x00,<br> 0x00,0x00,0xE0,0xFC,0x07,0x81,0xC0,0x40,0x40,0x40,0xC0,0x83,0x03,0x00,0x00,0x00,<br> 0x00,0x00,0x7F,0xFF,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xFC,0x00,0x00,<br> 0x00,0x00,0x00,0x01,0x07,0x06,0x0C,0x08,0x08,0x08,0x0C,0x06,0x03,0x00,0x00,0x00,/<em>“6”,6</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,<br> 0x00,0x00,0x0E,0x03,0x00,0x00,0x00,0x00,0x00,0xE0,0x18,0x06,0x01,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xFC,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/<em>“7”,7</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x00,0x80,0xC0,0x40,0x40,0x40,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,<br> 0x00,0x00,0x3E,0x7F,0xF1,0xC0,0xC0,0x80,0x00,0x00,0x80,0x41,0x7F,0x1E,0x00,0x00,<br> 0x00,0xF0,0xFC,0x0E,0x02,0x01,0x01,0x01,0x03,0x07,0x0E,0x1E,0xFC,0xF0,0x00,0x00,<br> 0x00,0x01,0x03,0x06,0x04,0x08,0x08,0x08,0x08,0x08,0x04,0x06,0x03,0x01,0x00,0x00,/<em>“8”,8</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>0x00,0x00,0x00,0x80,0x80,0x40,0x40,0x40,0x40,0x40,0x80,0x00,0x00,0x00,0x00,0x00,<br> 0x00,0xFC,0xFF,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFE,0xF8,0x00,0x00,<br> 0x00,0x01,0x03,0x07,0x0C,0x08,0x08,0x08,0x08,0x04,0x06,0xE1,0x7F,0x1F,0x00,0x00,<br> 0x00,0x00,0x07,0x07,0x08,0x08,0x08,0x08,0x0C,0x06,0x03,0x01,0x00,0x00,0x00,0x00,/<em>“9”,9</em>/<br> /* (16 X 32 , 宋体 )*/</p> 
<p>};<br> unsigned char Hzk[][32]={<!-- --><br> // 灯(0) 光(1) 调(2) 节(3)</p> 
<p>{0x80,0x70,0x00,0xFF,0x20,0x10,0x04,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0x04,0x00},<br> {0x80,0x60,0x18,0x07,0x08,0x30,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00},/<em>“灯”,0</em>/<br> /* (16 X 16 , 宋体 )*/</p> 
<p>{0x40,0x40,0x42,0x44,0x58,0xC0,0x40,0x7F,0x40,0xC0,0x50,0x48,0x46,0x40,0x40,0x00},<br> {0x80,0x80,0x40,0x20,0x18,0x07,0x00,0x00,0x00,0x3F,0x40,0x40,0x40,0x40,0x78,0x00},/<em>“光”,1</em>/<br> /* (16 X 16 , 宋体 )*/</p> 
<p>{0x40,0x42,0xCC,0x00,0x00,0xFE,0x82,0x92,0x92,0xFE,0x92,0x92,0x82,0xFE,0x00,0x00},<br> {0x00,0x00,0x3F,0x10,0x88,0x7F,0x00,0x1E,0x12,0x12,0x12,0x5E,0x80,0x7F,0x00,0x00},/<em>“调”,2</em>/<br> /* (16 X 16 , 宋体 )*/</p> 
<p>{0x04,0x44,0x44,0x44,0x5F,0x44,0xC4,0x44,0x44,0x44,0x5F,0x44,0xC4,0x04,0x04,0x00},<br> {0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x08,0x10,0x08,0x07,0x00,0x00,0x00},/<em>“节”,3</em>/<br> /* (16 X 16 , 宋体 )*/<br> };<br> #endif</p> 
<p>struct ssd1307fb_par {<!-- --><br> struct i2c_client *client;<br> struct fb_info *info;<br> struct pwm_device *pwm;<br> u32 pwm_period;<br> int reset;<br> };</p> 
<p>static struct fb_fix_screeninfo ssd1307fb_fix = {<!-- --><br> .id = “Solomon SSD1307”,<br> .type = FB_TYPE_PACKED_PIXELS,<br> .visual = FB_VISUAL_MONO10,<br> .xpanstep = 0,<br> .ypanstep = 0,<br> .ywrapstep = 0,<br> .line_length = SSD1307FB_WIDTH / 8,<br> .accel = FB_ACCEL_NONE,<br> };</p> 
<p>static struct fb_var_screeninfo ssd1307fb_var = {<!-- --><br> .xres = SSD1307FB_WIDTH,<br> .yres = SSD1307FB_HEIGHT,<br> .xres_virtual = SSD1307FB_WIDTH,<br> .yres_virtual = SSD1307FB_HEIGHT,<br> .bits_per_pixel = 1,<br> };</p> 
<p>static int ssd1307fb_write_array(struct i2c_client *client, u8 type, u8 *cmd, u32 len)<br> {<!-- --><br> u8 *buf;<br> int ret = 0;</p> 
<pre><code>buf = kzalloc(len + 1, GFP_KERNEL);
if (!buf) {
	dev_err(&amp;client-&gt;dev, "Couldn't allocate sending buffer.\n");
	return -ENOMEM;
}

buf[0] = type;
memcpy(buf + 1, cmd, len);

ret = i2c_master_send(client, buf, len + 1);

if (ret != len + 1) {
	dev_err(&amp;client-&gt;dev, "Couldn't send I2C command.\n");
	goto error;
}
</code></pre> 
<p>error:<br> kfree(buf);<br> return ret;<br> }</p> 
<p>static inline int ssd1307fb_write_cmd_array(struct i2c_client *client, u8 *cmd, u32 len)<br> {<!-- --><br> return ssd1307fb_write_array(client, SSD1307FB_COMMAND, cmd, len);<br> }</p> 
<p>static inline int ssd1307fb_write_cmd(struct i2c_client *client, u8 cmd)<br> {<!-- --><br> return ssd1307fb_write_cmd_array(client, &amp;cmd, 1);<br> }</p> 
<p>static inline int ssd1307fb_write_data_array(struct i2c_client *client, u8 *cmd, u32 len)<br> {<!-- --><br> return ssd1307fb_write_array(client, SSD1307FB_DATA, cmd, len);<br> }</p> 
<p>static inline int ssd1307fb_write_data(struct i2c_client *client, u8 data)<br> {<!-- --><br> return ssd1307fb_write_data_array(client, &amp;data, 1);<br> }</p> 
<p>#if 1<br> void OLED_Set_Pos(struct i2c_client *client,unsigned char x, unsigned char y)<br> {<!-- --><br> ssd1307fb_write_cmd(client,0xb0 + y);<br> ssd1307fb_write_cmd(client,((x &amp; 0xf0) &gt;&gt; 4) | 0x10);<br> ssd1307fb_write_cmd(client,(x&amp;0x0f)|0x01);<br> }</p> 
<p>void OLED_Clear(struct i2c_client *client)<br> {<!-- --><br> u8 i, n;<br> for (i = 0; i&lt;8; i++)<br> {<!-- --><br> //OLED_WR_Byte(0xb0 + i, OLED_CMD); //设置页地址（0~7）<br> //OLED_WR_Byte(0x00, OLED_CMD); //设置显示位置—列低地址<br> //OLED_WR_Byte(0x10, OLED_CMD); //设置显示位置—列高地址 <br> //for (n = 0; n&lt;128; n++)OLED_WR_Byte(0, OLED_DATA);<br> ssd1307fb_write_cmd(client,0xb0 + i);<br> ssd1307fb_write_cmd(client,0x00);<br> ssd1307fb_write_cmd(client,0x10);<br> for (n = 0; n&lt;128; n++)<br> {<!-- --><br> ssd1307fb_write_data(client,0);<br> } <br> } //更新显示<br> }</p> 
<p>void OLED_Clear_direct_area(struct i2c_client *client,int x,int y)<br> {<!-- --><br> u8 i, n;<br> for (i = 0; i&lt;x; i++)<br> {<!-- --><br> ssd1307fb_write_cmd(client,0xb0 + i);<br> ssd1307fb_write_cmd(client,0x00);<br> ssd1307fb_write_cmd(client,0x10);<br> for (n = 0; n&lt;y; n++)<br> {<!-- --><br> ssd1307fb_write_data(client,0);<br> } <br> } //更新显示<br> }</p> 
<p>//清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!<br> void ssd1306_init(struct i2c_client *client)<br> {<!-- --><br> ssd1307fb_write_cmd(client,0xAE);//–turn off oled panel<br> ssd1307fb_write_cmd(client,0x02);//—set low column address<br> ssd1307fb_write_cmd(client,0x10);//—set high column address<br> ssd1307fb_write_cmd(client,0x40);//–set start line address Set Mapping RAM Display Start Line (0x00~0x3F)<br> ssd1307fb_write_cmd(client,0x81);//–set contrast control register<br> ssd1307fb_write_cmd(client,0xCF); // Set SEG Output Current Brightness<br> ssd1307fb_write_cmd(client,0xA1);//–Set SEG/Column Mapping 0xa0×óóò·′?? 0xa1?y3￡<br> ssd1307fb_write_cmd(client,0xC8);//Set COM/Row Scan Direction 0xc0é???·′?? 0xc8?y3￡<br> ssd1307fb_write_cmd(client,0xA6);//–set normal display<br> ssd1307fb_write_cmd(client,0xA8);//–set multiplex ratio(1 to 64)<br> ssd1307fb_write_cmd(client,0x3f);//–1/64 duty<br> ssd1307fb_write_cmd(client,0xD3);//-set display offset Shift Mapping RAM Counter (0x00~0x3F)<br> ssd1307fb_write_cmd(client,0x00);//-not offset<br> ssd1307fb_write_cmd(client,0xd5);//–set display clock divide ratio/oscillator frequency<br> ssd1307fb_write_cmd(client,0x80);//–set divide ratio, Set Clock as 100 Frames/Sec<br> ssd1307fb_write_cmd(client,0xD9);//–set pre-charge period<br> ssd1307fb_write_cmd(client,0xF1);//Set Pre-Charge as 15 Clocks &amp; Discharge as 1 Clock<br> ssd1307fb_write_cmd(client,0xDA);//–set com pins hardware configuration<br> ssd1307fb_write_cmd(client,0x12);<br> ssd1307fb_write_cmd(client,0xDB);//–set vcomh<br> ssd1307fb_write_cmd(client,0x40);//Set VCOM Deselect Level<br> ssd1307fb_write_cmd(client,0x20);//-Set Page Addressing Mode (0x00/0x01/0x02)<br> ssd1307fb_write_cmd(client,0x02);//<br> ssd1307fb_write_cmd(client,0x8D);//–set Charge Pump enable/disable<br> ssd1307fb_write_cmd(client,0x14);//–set(0x10) disable<br> ssd1307fb_write_cmd(client,0xA4);// Disable Entire Display On (0xa4/0xa5)<br> ssd1307fb_write_cmd(client,0xA6);// Disable Inverse Display On (0xa6/a7)<br> ssd1307fb_write_cmd(client,0xAF);//–turn on oled panel<br> ssd1307fb_write_cmd(client,0xAF); /<em>display ON</em>/<br> }</p> 
<p>//m^n函数<br> u32 oled_pow(u8 m, u8 n)<br> {<!-- --><br> u32 result = 1;<br> while (n–)result *= m;<br> return result;<br> }</p> 
<p>void OLED_ShowChar(struct i2c_client <em>client,u8 x, u8 y, u8 chr, u8 Char_Size)<br> {<!-- --><br> unsigned char c = 0, i = 0;<br> c = chr - ’ ';//得到偏移后的值 <br> if (x&gt;Max_Column - 1) { x = 0; y = y + 2; } <br> if(Char_Size&gt;16)<br> {<!-- --><br> OLED_Set_Pos(client,x, y);<br> for (i = 0; i&lt;16; i++)<br> //OLED_WR_Byte(F16X32[c</em>64 + i], OLED_DATA);<br> ssd1307fb_write_data(client,F16X32[c<em>64 + i]);<br> OLED_Set_Pos(client,x, y + 1);<br> for (i = 0; i&lt;16; i++)<br> //OLED_WR_Byte(F16X32[c</em>64 + i + 16], OLED_DATA);<br> ssd1307fb_write_data(client,F16X32[c<em>64 + i + 16]);<br> OLED_Set_Pos(client,x, y + 2); <br> for (i = 0; i&lt;16; i++)<br> //OLED_WR_Byte(F16X32[c</em>64+ i +32], OLED_DATA);<br> ssd1307fb_write_data(client,F16X32[c<em>64+ i +32]);<br> OLED_Set_Pos(client,x, y + 3);<br> for (i = 0; i&lt;16; i++)<br> //OLED_WR_Byte(F16X32[c</em>64 + i + 48], OLED_DATA);<br> ssd1307fb_write_data(client,F16X32[c*64 + i + 48]);<br> }<br> else if (Char_Size == 16)<br> {<!-- --><br> OLED_Set_Pos(client,x, y);<br> for (i = 0; i&lt;8; i++)<br> //OLED_WR_Byte(F8X16[c * 16 + i], OLED_DATA);<br> ssd1307fb_write_data(client,F8X16[c * 16 + i]);<br> OLED_Set_Pos(client,x, y + 1);<br> for (i = 0; i&lt;8; i++)<br> //OLED_WR_Byte(F8X16[c * 16 + i + 8], OLED_DATA);<br> ssd1307fb_write_data(client,F8X16[c * 16 + i + 8]);<br> }<br> else<br> {<!-- --><br> OLED_Set_Pos(client,x, y);<br> for (i = 0; i&lt;6; i++)<br> //OLED_WR_Byte(F6x8[c][i], OLED_DATA);<br> ssd1307fb_write_data(client,F6x8[c][i]);<br> }<br> }</p> 
<p>//显示2个数字<br> //x,y :起点坐标 <br> //len :数字的位数<br> //size:字体大小<br> //mode:模式 0,填充模式;1,叠加模式<br> //num:数值(0~4294967295); <br> void OLED_ShowNum(struct i2c_client *client,u8 x, u8 y, u32 num, u8 len, u8 size2)<br> {<!-- --><br> u8 t, temp;<br> u8 enshow = 0;<br> for (t = 0; t&lt;len; t++)<br> {<!-- --><br> temp = (num / oled_pow(10, len - t - 1)) % 10;<br> if (enshow == 0 &amp;&amp; t&lt;(len - 1))<br> {<!-- --><br> if (temp == 0)<br> {<!-- --><br> OLED_ShowChar(client,x + (size2 / 2)*t, y, ’ ', size2);<br> continue;<br> }<br> else enshow = 1;</p> 
<pre><code>	}
	OLED_ShowChar(client,x + (size2 / 2)*t, y, temp + '0', size2);
}
</code></pre> 
<p>}</p> 
<p>//显示一个字符号串<br> void OLED_ShowString(struct i2c_client *client,u8 x, u8 y, u8 *chr, u8 Char_Size)<br> {<!-- --><br> unsigned char j = 0;</p> 
<pre><code>while (chr[j] != '\0')
{
	OLED_ShowChar(client,x, y, chr[j], Char_Size);
	x += 8;
	if (x&gt;120) { x = 0; y += 2; }
	j++;
}
</code></pre> 
<p>}</p> 
<p>//显示汉字<br> void OLED_ShowCHinese(struct i2c_client *client,u8 x, u8 y, u8 no)<br> {<!-- --><br> u8 t, adder = 0;<br> OLED_Set_Pos(client,x, y);<br> for (t = 0; t&lt;16; t++)<br> {<!-- --><br> //OLED_WR_Byte(Hzk[2 * no][t], OLED_DATA);<br> ssd1307fb_write_data(client,Hzk[2 * no][t]);<br> adder += 1;<br> }<br> OLED_Set_Pos(client,x, y + 1);<br> for (t = 0; t&lt;16; t++)<br> {<!-- --><br> //OLED_WR_Byte(Hzk[2 * no + 1][t], OLED_DATA);<br> ssd1307fb_write_data(client,Hzk[2 * no + 1][t]);<br> adder += 1;<br> }<br> }<br> #endif</p> 
<p>static void ssd1307fb_update_display(struct ssd1307fb_par *par)<br> {<!-- --><br> u8 *vmem = par-&gt;info-&gt;screen_base;<br> int i, j, k;</p> 
<pre><code>/*
 * The screen is divided in pages, each having a height of 8
 * pixels, and the width of the screen. When sending a byte of
 * data to the controller, it gives the 8 bits for the current
 * column. I.e, the first byte are the 8 bits of the first
 * column, then the 8 bits for the second column, etc.
 *
 *
 * Representation of the screen, assuming it is 5 bits
 * wide. Each letter-number combination is a bit that controls
 * one pixel.
 *
 * A0 A1 A2 A3 A4
 * B0 B1 B2 B3 B4
 * C0 C1 C2 C3 C4
 * D0 D1 D2 D3 D4
 * E0 E1 E2 E3 E4
 * F0 F1 F2 F3 F4
 * G0 G1 G2 G3 G4
 * H0 H1 H2 H3 H4
 *
 * If you want to update this screen, you need to send 5 bytes:
 *  (1) A0 B0 C0 D0 E0 F0 G0 H0
 *  (2) A1 B1 C1 D1 E1 F1 G1 H1
 *  (3) A2 B2 C2 D2 E2 F2 G2 H2
 *  (4) A3 B3 C3 D3 E3 F3 G3 H3
 *  (5) A4 B4 C4 D4 E4 F4 G4 H4
 */

for (i = 0; i &lt; (SSD1307FB_HEIGHT / 8); i++) {
	ssd1307fb_write_cmd(par-&gt;client, SSD1307FB_START_PAGE_ADDRESS + (i + 1));
	ssd1307fb_write_cmd(par-&gt;client, 0x00);
	ssd1307fb_write_cmd(par-&gt;client, 0x10);

	for (j = 0; j &lt; SSD1307FB_WIDTH; j++) {
		u8 buf = 0;
		for (k = 0; k &lt; 8; k++) {
			u32 page_length = SSD1307FB_WIDTH * i;
			u32 index = page_length + (SSD1307FB_WIDTH * k + j) / 8;
			u8 byte = *(vmem + index);
			u8 bit = byte &amp; (1 &lt;&lt; (j % 8));
			bit = bit &gt;&gt; (j % 8);
			buf |= bit &lt;&lt; k;
		}
		ssd1307fb_write_data(par-&gt;client, buf);
	}
}
</code></pre> 
<p>}</p> 
<p>static int ssd1307fb_open(struct fb_info *info, int user)<br> {<!-- --><br> return 0;<br> }</p> 
<p>static ssize_t ssd1307fb_write(struct fb_info *info, const char __user *buf,<br> size_t count, loff_t *ppos)<br> {<!-- --><br> struct ssd1307fb_par *par = info-&gt;par;<br> unsigned long total_size;<br> unsigned long p = *ppos;<br> u8 __iomem *dst;</p> 
<pre><code>total_size = info-&gt;fix.smem_len;

if (p &gt; total_size)
	return -EINVAL;

if (count + p &gt; total_size)
	count = total_size - p;

if (!count)
	return -EINVAL;

dst = (void __force *) (info-&gt;screen_base + p);

if (copy_from_user(dst, buf, count))
	return -EFAULT;

ssd1307fb_update_display(par);

*ppos += count;

return count;
</code></pre> 
<p>}</p> 
<p>static void ssd1307fb_fillrect(struct fb_info *info, const struct fb_fillrect *rect)<br> {<!-- --><br> struct ssd1307fb_par *par = info-&gt;par;<br> sys_fillrect(info, rect);<br> ssd1307fb_update_display(par);<br> }</p> 
<p>static void ssd1307fb_copyarea(struct fb_info *info, const struct fb_copyarea *area)<br> {<!-- --><br> struct ssd1307fb_par *par = info-&gt;par;<br> sys_copyarea(info, area);<br> ssd1307fb_update_display(par);<br> }</p> 
<p>static void ssd1307fb_imageblit(struct fb_info *info, const struct fb_image *image)<br> {<!-- --><br> struct ssd1307fb_par *par = info-&gt;par;<br> sys_imageblit(info, image);<br> ssd1307fb_update_display(par);<br> }</p> 
<p>struct ioctl_data{<!-- --><br> int x;<br> int y;<br> int size;<br> char buf[40];<br> };</p> 
<p>static int ssd1307fb_ioctl(struct fb_info *info, unsigned int cmd,unsigned long arg)<br> {<!-- --><br> struct ssd1307fb_par *par = info-&gt;par;<br> struct ioctl_data val;</p> 
<pre><code>//printk("cmd =====ssd1307fb_ioctl===== %d \r\n",cmd);
memset(&amp;val,0,sizeof(struct ioctl_data));

if (copy_from_user(&amp;val,(struct ioctl_data*)arg,sizeof(struct ioctl_data))) 
{
	printk("======copy_from_user====failed== \r\n");
}

switch(cmd)
{
	case 1:   //show char
	{
		//printk("===========show char=========\r\n");
	}
	break;
	case 3:   //show string
	{
		OLED_ShowString(par-&gt;client,val.x,val.y,val.buf,val.size);
	}
	break;    //show chinese
	case 4:
	{
		//printk("===========show chinese=========\r\n");
		OLED_ShowCHinese(par-&gt;client,0,0,0);//中
		OLED_ShowCHinese(par-&gt;client,18,0,1);//景
		OLED_ShowCHinese(par-&gt;client,36,0,2);//园
		OLED_ShowCHinese(par-&gt;client,54,0,3);//电
		OLED_ShowCHinese(par-&gt;client,72,0,4);//子
		OLED_ShowCHinese(par-&gt;client,90,0,5);//科
		OLED_ShowCHinese(par-&gt;client,108,0,6);//技	
	}
	break;
	case 5:  //clear screen 
	{
		OLED_Clear(par-&gt;client); 
	}
	break;
	case 6:  //clear designated area 
	{
		OLED_Clear_direct_area(par-&gt;client,val.x,val.y); 
	}
	break;
	default:
	{
	
	}
	break;

}
return 0;
</code></pre> 
<p>}</p> 
<p>static struct fb_ops ssd1307fb_ops = {<!-- --><br> .owner = THIS_MODULE,<br> .fb_read = fb_sys_read,<br> .fb_write = ssd1307fb_write,<br> .fb_fillrect = ssd1307fb_fillrect,<br> .fb_copyarea = ssd1307fb_copyarea,<br> .fb_imageblit = ssd1307fb_imageblit,<br> .fb_ioctl = ssd1307fb_ioctl,<br> .fb_open = ssd1307fb_open,<br> };</p> 
<p>static void ssd1307fb_deferred_io(struct fb_info *info,<br> struct list_head *pagelist)<br> {<!-- --><br> ssd1307fb_update_display(info-&gt;par);<br> }</p> 
<p>static struct fb_deferred_io ssd1307fb_defio = {<!-- --><br> .delay = HZ,<br> .deferred_io = ssd1307fb_deferred_io,<br> };</p> 
<p>static int ssd1307fb_probe(struct i2c_client *client,<br> const struct i2c_device_id *id)<br> {<!-- --><br> struct fb_info *info;<br> u32 vmem_size = SSD1307FB_WIDTH * SSD1307FB_HEIGHT / 8;<br> struct ssd1307fb_par *par;<br> u8 *vmem;<br> int ret;</p> 
<pre><code>if (!client-&gt;dev.of_node) {
	dev_err(&amp;client-&gt;dev, "No device tree data found!\n");
	return -EINVAL;
}

info = framebuffer_alloc(sizeof(struct ssd1307fb_par), &amp;client-&gt;dev);
if (!info) {
	dev_err(&amp;client-&gt;dev, "Couldn't allocate framebuffer.\n");
	return -ENOMEM;
}

vmem = devm_kzalloc(&amp;client-&gt;dev, vmem_size, GFP_KERNEL);
if (!vmem) {
	dev_err(&amp;client-&gt;dev, "Couldn't allocate graphical memory.\n");
	ret = -ENOMEM;
	goto fb_alloc_error;
}

info-&gt;fbops = &amp;ssd1307fb_ops;
info-&gt;fix = ssd1307fb_fix;
info-&gt;fbdefio = &amp;ssd1307fb_defio;

info-&gt;var = ssd1307fb_var;
info-&gt;var.red.length = 1;
info-&gt;var.red.offset = 0;
info-&gt;var.green.length = 1;
info-&gt;var.green.offset = 0;
info-&gt;var.blue.length = 1;
info-&gt;var.blue.offset = 0;

info-&gt;screen_base = (u8 __force __iomem *)vmem;
info-&gt;fix.smem_start = (unsigned long)vmem;
info-&gt;fix.smem_len = vmem_size;

fb_deferred_io_init(info);

par = info-&gt;par;
par-&gt;info = info;
par-&gt;client = client;

par-&gt;reset = of_get_named_gpio(client-&gt;dev.of_node,
				 "reset-gpios", 0);
if (!gpio_is_valid(par-&gt;reset)) {
	ret = -EINVAL;
	goto reset_oled_error;
}
ret = devm_gpio_request_one(&amp;client-&gt;dev, par-&gt;reset,
			    GPIOF_OUT_INIT_HIGH,
			    "oled-reset");
if (ret) {
	dev_err(&amp;client-&gt;dev,
		"failed to request gpio %d: %d\n",
		par-&gt;reset, ret);
	goto reset_oled_error;
}

/* Reset the screen */
gpio_set_value(par-&gt;reset, 1);
mdelay(100);	
gpio_set_value(par-&gt;reset, 0);
mdelay(100);
gpio_set_value(par-&gt;reset, 1);

#if 1   
ssd1306_init(client);			//初始化OLED  
OLED_Clear(client); 
#endif

ret = register_framebuffer(info);
if (ret) {
	dev_err(&amp;client-&gt;dev, "Couldn't register the framebuffer\n");
	goto fbreg_error;
}

i2c_set_clientdata(client, info);

return 0;
</code></pre> 
<p>//remap_error:<br> //unregister_framebuffer(info);<br> //pwm_disable(par-&gt;pwm);<br> fbreg_error:<br> //pwm_put(par-&gt;pwm);<br> //pwm_error:<br> reset_oled_error:<br> fb_deferred_io_cleanup(info);<br> fb_alloc_error:<br> framebuffer_release(info);<br> return ret;<br> }</p> 
<p>static int ssd1307fb_remove(struct i2c_client *client)<br> {<!-- --><br> struct fb_info *info = i2c_get_clientdata(client);<br> struct ssd1307fb_par *par = info-&gt;par;</p> 
<pre><code>unregister_framebuffer(info);
pwm_disable(par-&gt;pwm);
pwm_put(par-&gt;pwm);
fb_deferred_io_cleanup(info);
framebuffer_release(info);

return 0;
</code></pre> 
<p>}</p> 
<p>static const struct i2c_device_id ssd1307fb_i2c_id[] = {<!-- --><br> { “ssd1307fb”, 0 },<br> { }<br> };<br> MODULE_DEVICE_TABLE(i2c, ssd1307fb_i2c_id);</p> 
<p>static const struct of_device_id ssd1307fb_of_match[] = {<!-- --><br> { .compatible = “solomon,ssd1307fb-i2c” },<br> {},<br> };<br> MODULE_DEVICE_TABLE(of, ssd1307fb_of_match);</p> 
<p>static struct i2c_driver ssd1307fb_driver = {<!-- --><br> .probe = ssd1307fb_probe,<br> .remove = ssd1307fb_remove,<br> .id_table = ssd1307fb_i2c_id,<br> .driver = {<!-- --><br> .name = “ssd1307fb”,<br> .of_match_table = of_match_ptr(ssd1307fb_of_match),<br> .owner = THIS_MODULE,<br> },<br> };</p> 
<p>module_i2c_driver(ssd1307fb_driver);<br> MODULE_DESCRIPTION(“FB driver for the Solomon SSD1307 OLED controller”);<br> MODULE_AUTHOR(“Maxime Ripard <a href="mailto:maxime.ripard@free-electrons.com" rel="nofollow">maxime.ripard@free-electrons.com</a>”);<br> MODULE_LICENSE(“GPL”);</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51e2648cd473636a59da7df294b5cde2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数理统计基础 统计量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5dedef0a5245885121c80f987c0f7f79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构_C语言_串_串的置换操作Replace (&amp;S, T, V)的算法、字符串反序的递推或递归算法，例如字符串为“abcsxw”，反序为“wxscba”、串的模式匹配算法及改进KMP算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>