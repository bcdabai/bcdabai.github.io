<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【.NET】Mapster指南 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【.NET】Mapster指南" />
<meta property="og:description" content="文章目录 概述具体安装 Mapster定义实体简单使用Mapster 配置 (TypeAdapterConfig)方式一方式二 忽略字段分支(Fork)NewConfig 方法运行时传参其他小技巧Adapt 扩展方法的使用拦截映射前后 来源 概述 Mapster是一个高性能的用于对象映射的类库，同类型的产品还有AutoMapper。它提供了一系列的API和工具，以下为几个重要的类和接口：
@Adapt注解：用于将实体类映射到数据库表中的指定列上。@Mapper注解：用于将实体类映射到数据库表中的指定列上。Entity接口：定义了实体类的属性和映射规则。Mapper接口：定义了映射规则的具体实现。Query接口：定义了查询语句的规则。DataStore接口：定义了数据存储的接口。 Mapster与AutoMapper的性能对比：
方法平均值标准偏差错误第0代第1代第2代分配“Mapster 6.0.0”108.59毫秒1.198毫秒1.811毫秒31000--124.36 MB“Mapster 6.0.0（罗斯林）”38.45毫秒0.494毫秒0.830毫秒31142.8571--124.36 MB&#39;Mapster 6.0.0（FEC）&#39;37.03毫秒0.281毫秒0.472毫秒29642.8571--118.26 MB&#39;Mapster 6.0.0（Codegen）&#39;34.16毫秒0.209毫秒0.316毫秒31133.3333--124.36 MB“ExpressMapper 1.9.1”205.78毫秒5.357毫秒8.098毫秒59000--236.51 MB“AutoMapper 10.0.0”420.97毫秒23.266毫秒35.174毫秒87000--350.95 MB 具体 安装 Mapster PM&gt; Install-Package Mapster 或者 dotnet add package Mapster 定义实体 目的：使用 Mapster 实现 User 到 UserDto 的映射
public class User { public string Name { get; set; } public int Age { get; set; } public string Sex { get; set; } public string like { get; set; } } public class UserDto { public string name { get; set; } public int UserAge { get; set; } public string UserSex { get; set; } public string like { get; set; } } 简单使用 /* * 默认情况下，无需任何配置，Mapster会根据两个实体字段名称相同进行匹配 * 第一次调用时，配置会被缓存，第二次将会从缓存中取，以此提升性能 */ var user = new User(); var dto = user." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/59a54708b2d875a77945bdc4eac59eb8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-25T16:16:24+08:00" />
<meta property="article:modified_time" content="2023-12-25T16:16:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【.NET】Mapster指南</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">概述</a></li><li><a href="#_20" rel="nofollow">具体</a></li><li><ul><li><a href="#_Mapster_22" rel="nofollow">安装 Mapster</a></li><li><a href="#_29" rel="nofollow">定义实体</a></li><li><a href="#_50" rel="nofollow">简单使用</a></li><li><a href="#Mapster__TypeAdapterConfig_64" rel="nofollow">Mapster 配置 (TypeAdapterConfig)</a></li><li><ul><li><a href="#_70" rel="nofollow">方式一</a></li><li><a href="#_95" rel="nofollow">方式二</a></li></ul> 
   </li><li><a href="#_118" rel="nofollow">忽略字段</a></li><li><a href="#Fork_157" rel="nofollow">分支(Fork)</a></li><li><a href="#NewConfig__181" rel="nofollow">NewConfig 方法</a></li><li><a href="#_196" rel="nofollow">运行时传参</a></li><li><a href="#_210" rel="nofollow">其他</a></li><li><a href="#_215" rel="nofollow">小技巧</a></li><li><ul><li><a href="#Adapt__217" rel="nofollow">Adapt 扩展方法的使用</a></li><li><a href="#_226" rel="nofollow">拦截映射前后</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_241" rel="nofollow">来源</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>概述</h2> 
<p>Mapster是一个高性能的用于对象映射的类库，同类型的产品还有AutoMapper。它提供了一系列的API和工具，以下为几个重要的类和接口：</p> 
<ul><li><strong>@Adapt注解</strong>：用于将实体类映射到数据库表中的指定列上。</li><li><strong>@Mapper注解</strong>：用于将实体类映射到数据库表中的指定列上。</li><li><strong>Entity接口</strong>：定义了实体类的属性和映射规则。</li><li><strong>Mapper接口</strong>：定义了映射规则的具体实现。</li><li><strong>Query接口</strong>：定义了查询语句的规则。</li><li><strong>DataStore接口</strong>：定义了数据存储的接口。</li></ul> 
<p>Mapster与AutoMapper的性能对比：</p> 
<table><thead><tr><th>方法</th><th>平均值</th><th>标准偏差</th><th>错误</th><th>第0代</th><th>第1代</th><th>第2代</th><th>分配</th></tr></thead><tbody><tr><td>“Mapster 6.0.0”</td><td>108.59毫秒</td><td>1.198毫秒</td><td>1.811毫秒</td><td>31000</td><td>-</td><td>-</td><td>124.36 MB</td></tr><tr><td>“Mapster 6.0.0（罗斯林）”</td><td>38.45毫秒</td><td>0.494毫秒</td><td>0.830毫秒</td><td>31142.8571</td><td>-</td><td>-</td><td>124.36 MB</td></tr><tr><td>'Mapster 6.0.0（FEC）'</td><td>37.03毫秒</td><td>0.281毫秒</td><td>0.472毫秒</td><td>29642.8571</td><td>-</td><td>-</td><td>118.26 MB</td></tr><tr><td>'Mapster 6.0.0（Codegen）'</td><td>34.16毫秒</td><td>0.209毫秒</td><td>0.316毫秒</td><td>31133.3333</td><td>-</td><td>-</td><td>124.36 MB</td></tr><tr><td>“ExpressMapper 1.9.1”</td><td>205.78毫秒</td><td>5.357毫秒</td><td>8.098毫秒</td><td>59000</td><td>-</td><td>-</td><td>236.51 MB</td></tr><tr><td>“AutoMapper 10.0.0”</td><td>420.97毫秒</td><td>23.266毫秒</td><td>35.174毫秒</td><td>87000</td><td>-</td><td>-</td><td>350.95 MB</td></tr></tbody></table> 
<h2><a id="_20"></a>具体</h2> 
<h3><a id="_Mapster_22"></a>安装 Mapster</h3> 
<pre><code class="prism language-bash">PM<span class="token operator">&gt;</span> Install-Package Mapster
 或者 dotnet <span class="token function">add</span> package Mapster
</code></pre> 
<h3><a id="_29"></a>定义实体</h3> 
<p>目的：使用 Mapster 实现 User 到 UserDto 的映射</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Sex <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> like <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> UserAge <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserSex <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> like <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_50"></a>简单使用</h3> 
<pre><code class="prism language-csharp"><span class="token comment">/*
* 默认情况下，无需任何配置，Mapster会根据两个实体字段名称相同进行匹配
* 第一次调用时，配置会被缓存，第二次将会从缓存中取，以此提升性能
*/</span>
<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Adapt</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//映射为新对象</span>
user<span class="token punctuation">.</span><span class="token function">Adapt</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在目标对象的基础上进行映射</span>
 
<span class="token comment">//注意：Adapt扩展方法使用的配置为 `TypeAdapterConfig.GlobalSettings`</span>
</code></pre> 
<h3><a id="Mapster__TypeAdapterConfig_64"></a>Mapster 配置 (TypeAdapterConfig)</h3> 
<p>可以直接使用 Mapster 内置的全局静态配置 TypeAdapterConfig.GlobalSettings，也可以实例化一个配置 new TypeAdapterConfig()推荐使用实例化的方式，对 TypeAdapterConfig 进行映射配置。</p> 
<blockquote> 
 <p>注：Mapster 默认匹配规则是相同字段名之间进行映射。</p> 
</blockquote> 
<h4><a id="_70"></a>方式一</h4> 
<p>直接在 TypeAdapterConfig 配置对象的映射关系</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//映射规则</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserSex<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name"><span class="token keyword">var</span></span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mapper</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//务必将mapper设为单实例</span>
 
<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">{<!-- --></span>Name <span class="token operator">=</span> <span class="token string">"xiaowang"</span><span class="token punctuation">,</span>Age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">,</span>Sex <span class="token operator">=</span> <span class="token string">"boy"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>字段带有前后缀，可以使用 NameMatchingStrategy.ConvertDestinationMemberName对目标字段名称进行替换，使得它和源字段名称相同。还有替换源字段的方法NameMatchingStrategy.ConvertSourceMemberName</p> 
<p>注意：如果一个ForType定义多个NameMatchingStrategy，后定义的会覆盖先定义的规则，所以只有最后定义的规则会生效</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使用</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">NameMatchingStrategy</span><span class="token punctuation">(</span>NameMatchingStrategy<span class="token punctuation">.</span><span class="token function">ConvertDestinationMemberName</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"User"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_95"></a>方式二</h4> 
<p>使用接口的方式，需要实现 IRegister</p> 
<pre><code class="prism language-csharp"><span class="token comment">//实现接口 IRegister</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDtoRegister</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRegister</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">TypeAdapterConfig</span> config<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//实例化Mapper</span>
<span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//var config = TypeAdapterConfig.GlobalSettings;</span>
<span class="token comment">//只有要给定 IRegister 所在的程序集名称，Mapster 会自动识别 IRegister，进行配置注入。</span>
config<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token string">"程序集名称1"</span><span class="token punctuation">,</span><span class="token string">"程序集名称2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mapper</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//务必设置为单实例</span>
</code></pre> 
<h3><a id="_118"></a>忽略字段</h3> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//映射规则</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserSex<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreNullValues</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//忽略空值映射</span>
    <span class="token punctuation">.</span><span class="token function">Ignore</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">)</span><span class="token comment">//忽略指定字段</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreAttribute</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">DataMemberAttribute</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//忽略指定特性的字段</span>
    <span class="token punctuation">.</span><span class="token function">NameMatchingStrategy</span><span class="token punctuation">(</span>NameMatchingStrategy<span class="token punctuation">.</span>IgnoreCase<span class="token punctuation">)</span><span class="token comment">//忽略字段名称的大小写</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreNonMapped</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//忽略除以上配置的所有字段</span>
 
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreMember</span><span class="token punctuation">(</span><span class="token punctuation">(</span>member<span class="token punctuation">,</span> side<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>member<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>Namespace<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">"System"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实现更细致的忽略规则</span>
</code></pre> 
<p>member和side分别对应IMemberModel和MemberSide，这里我贴出相应的源码。</p> 
<pre><code class="prism language-csharp"><span class="token comment">//包含了映射类型的信息</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMemberModel</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token return-type class-name">Type</span> Type <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> Info <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name">AccessModifier</span> SetterModifier <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name">AccessModifier</span> AccessModifier <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
    <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCustomAttributes</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> inherit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//标识当前是源类型还是目标类型</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">MemberSide</span>
<span class="token punctuation">{<!-- --></span>
    Source <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Destination <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Fork_157"></a>分支(Fork)</h3> 
<p>Mapster 的 Fork 功能允许我们定义局部的映射规则，并且分支不会重复编译，不需要考虑性能问题。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mapper</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">{<!-- --></span>Name <span class="token operator">=</span> <span class="token string">"xiaowang"</span><span class="token punctuation">,</span>Age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">,</span>Sex <span class="token operator">=</span> <span class="token string">"boy"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForkConfig</span><span class="token punctuation">(</span>forked <span class="token operator">=&gt;</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//该分支规则，不会重复编译，仅限该语句中有效，不会影响config的配置</span>
        forked<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>name<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AdaptToType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//映射为新对象</span>
 
dto <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForkConfig</span><span class="token punctuation">(</span>forked <span class="token operator">=&gt;</span>
    <span class="token punctuation">{<!-- --></span>
        forked<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>name<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AdaptTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在目标对象基础上进行映射</span>
</code></pre> 
<h3><a id="NewConfig__181"></a>NewConfig 方法</h3> 
<p>NewConfig 方法允许我们对两个类型之间新建配置，如果两个类型之前配置了映射关系，则 NewConfig 方法会覆盖之前的配置</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> src<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
 
<span class="token comment">//覆盖 User 和 UserDto 之前的配置</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">NewConfig</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest<span class="token operator">=&gt;</span>dest<span class="token punctuation">.</span>UserAge<span class="token punctuation">,</span>src<span class="token operator">=&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//扩展知识：覆盖Mapster默认静态配置</span>
TypeAdapterConfig<span class="token operator">&lt;</span>User<span class="token punctuation">,</span>UserDto<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">NewConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">NameMatchingStrategy</span><span class="token punctuation">(</span>NameMatchingStrategy<span class="token punctuation">.</span>IgnoreCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_196"></a>运行时传参</h3> 
<p>允许运行时传入数据，干预映射过程</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeAdapterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>dest <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span>name<span class="token punctuation">,</span> src <span class="token operator">=&gt;</span> MapContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">"userName"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置运行时参数</span>
<span class="token class-name"><span class="token keyword">var</span></span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mapper</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//使用时传入数据</span>
<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BuildAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddParameters</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">,</span><span class="token string">"xiaowang"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AdaptToType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_210"></a>其他</h3> 
<p>我们尽量不要把实体间的映射规则配置到 TypeAdapterConfig.GlobalSettings (默认配置)。随着业务的发展，一个配置很难兼顾所有业务，可能会出行冲突的情况，相对复杂的业务，可以新建一个TypeAdapterConfig，或者使用 config.Clone()能轻松复制一份配置。全局配置可以放一些简单的配置项，例如：映射时忽略大小写。</p> 
<blockquote> 
 <p>注意：Adapt 扩展方法使用的是 TypeAdapterConfig.GlobalSettings</p> 
</blockquote> 
<h3><a id="_215"></a>小技巧</h3> 
<h4><a id="Adapt__217"></a>Adapt 扩展方法的使用</h4> 
<pre><code class="prism language-csharp"><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> dict <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Adapt</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//object 到 Dictionary 的转换</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Adapt</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//equal to 123.ToString();</span>
 
<span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Adapt</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//equal to int.Parse("123");</span>
</code></pre> 
<h4><a id="_226"></a>拦截映射前后</h4> 
<p>BeforeMapping方法和 AfterMapping</p> 
<pre><code class="prism language-csharp"><span class="token comment">//BeforeMapping 映射执行前</span>
config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BeforeMapping</span><span class="token punctuation">(</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{<!-- --></span>
            src<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            dest<span class="token punctuation">.</span>UserAge <span class="token operator">=</span> src<span class="token punctuation">.</span>Age <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//AfterMapping 映射执行后</span>
<span class="token comment">//...</span>
</code></pre> 
<h2><a id="_241"></a>来源</h2> 
<p><a href="https://blog.csdn.net/sunwork888/article/details/125330714">C# Mapster 对象映射器学习</a><br> <a href="https://www.cnblogs.com/qq2806933146xiaobai/p/17511422.html" rel="nofollow">C#-对象映射器（二）-Mapster帮助类 </a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/deb3acae01d45e35e3f1a2d79f4baf70/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">怎么搭建实时渲染云传输服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6dd74182ad2d4e167526ae849a223600/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决SpringBoot配置文件项目重启出现乱码的情况</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>