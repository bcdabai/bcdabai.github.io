<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElasticSearch配置及Kibana可视化配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ElasticSearch配置及Kibana可视化配置" />
<meta property="og:description" content="什么是ElasticSearch es是一个开源的分布式搜索引擎，可以用来实现搜索、日志统计、分析、系统监控，es易于扩展，可以轻松扩展到上百台服务器，处理PB（1PB=1024TB 1TB= 1024GB）级别的数据，es自身携带分布式协调管理功能，但仅支持JSON文件格式
Es理论： 1.索引： 在Es中一个索引对应一组相关文档的存储单元，可以被看作是一种类似于数据库中的表结构，用于存储相类似的文档，每个文档都属于一个索引，索引中的文档用于被搜索和分析。
2.索引分片： 索引分片是将一个完整的索引分成多个的过程，每个分片本身是一个独立的索引，拥有自己的设置、映射、文档。Es通过将索引划分为多个分片来允许大规模数据存储，并且能够水平扩张，每个分片可以分布在集群的不同节点上，默认情况下每个索引包含五个主分片。
3.索引副本： 索引副本是每个分片的一个复制品用于提供冗余和故障的回复副本分布在不同的节点上从而增加了系统的可靠性和容错能力。
ElasticSearch核心概念 1.节点 节点是集群中的单个服务器，用于存储数据并参与集群的索引和搜索功能。每个节点都有自己的名称和唯一标识符。
2.集群 集群是由一个或多个节点组成的一组服务器，它们共同存储项目的整个数据，集群提供可高可用性和横向扩展性。
3.分片和复制 分片是将索引中的数据分割成多个部分，用于提高性能和扩展性每个分片可以被存储在集群中的一个或多个节点上。
复制是为了数据的高可用性和容错性，每个分片都会有一个或多个副本分片，这些分片会被存储在不同的节点上。
4.索引 索引是用于存储数据的地方类似于关系型数据库中的数据可以，它是一种用于存储相似性质的文档的数据结构。
5.类型 类型在ES6.0之前用于组织索引内部文档的一种方式。在ES7.0之后已经被废弃，推荐使用单一索引引用字段代替。
6.文档 文档是ES中的基本数据单元，类似于关系型数据库中的行，每个文档都是一个JSON对象，它们被存储在索引中并可以被搜索。
7.字段 字段是ES中文档的组成部分，类似于关系型数据库中的列，每个字段都有自己的数据类型（文本型、数值型等），并且包含特定的数据。
8.映射 映射定义了索引中的，每个字段的数据类型和属性，它相当于关系型数据库中的模式，告诉ES如何处理索引的每个字段。
创建索引 PUT /baidu { &#34;settings&#34;: { &#34;number_of_shards&#34;: 2,//主分片 &#34;number_of_replicas&#34;: 2//副分片 }, &#34;mappings&#34;: { &#34;properties&#34;: { &#34;title&#34;:{ &#34;type&#34;: &#34;text&#34; } } } } 添加文档 POST /my_es/_doc { &#34;title&#34;:&#34;震惊，某男子竟于小猪干这件事。。。。&#34;, &#34;content&#34;:&#34;男子天天给小猪吃昂贵的水果，小猪更可爱了&#34;, &#34;author&#34;:&#34;王五&#34;, &#34;time&#34;:&#34;2023-12-18T11:44:20&#34; } 查询所有 GET /my_es/_search 语法规则 _doc：用于早期的ES版本中同一个索引中单独集合映射类型。从8.x版本开始已全面废弃。
_index：创建新索引、是创建一个命名空间将相关文档聚合在一起
_create：创建新索引、是创建一个新的文档并将其添加到指定索引中
_update：用于更新文档中的一部分类容
_delete：删除文档" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/79edf58963fe5eb12d9099b55d738783/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-22T10:39:21+08:00" />
<meta property="article:modified_time" content="2023-12-22T10:39:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ElasticSearch配置及Kibana可视化配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<h2><strong>什么是ElasticSearch</strong></h2> 
<p><strong>        es是一个开源的<span style="color:#fe2c24;">分布式搜索引擎</span>，可以用来实现搜索、日志统计、分析、系统监控，es易于扩展，可以轻松扩展到上百台服务器，处理<span style="color:#38d8f0;">PB</span>（1PB=1024TB 1TB= 1024GB）级别的数据，es自身携带分布式协调管理功能，但仅支持<span style="color:#38d8f0;">JSON</span>文件格式</strong></p> 
<h3><strong>        Es理论：</strong></h3> 
<h4><strong>                1.索引：</strong></h4> 
<p>                        <strong>在Es中一个索引对应一组相关文档的存储单元，可以被看作是一种类似于数据库中的表结构，用于存储相类似的文档，每个文档都属于一个索引，索引中的文档用于被搜索和分析。</strong></p> 
<h4><strong>                2.索引分片：</strong></h4> 
<p><strong>                       索引分片是将一个完整的索引分成多个的过程，每个分片本身是一个独立的索引，拥有自己的设置、映射、文档。Es通过将索引划分为多个分片来允许大规模数据存储，并且能够水平扩张，每个分片可以分布在集群的不同节点上，默认情况下每个索引包含五个主分片。</strong></p> 
<h4><strong>                3.索引副本：</strong></h4> 
<p><strong>                        索引副本是每个分片的一个复制品用于提供冗余和故障的回复副本分布在不同的节点上从而增加了系统的可靠性和容错能力。</strong></p> 
<h3><strong>ElasticSearch核心概念</strong></h3> 
<h4><strong>        1.节点</strong></h4> 
<p><strong>                节点是集群中的单个服务器，用于存储数据并参与集群的索引和搜索功能。每个节点都有自己的名称和唯一标识符。</strong></p> 
<h4><strong>        2.集群</strong></h4> 
<p><strong>                集群是由一个或多个节点组成的一组服务器，它们共同存储项目的整个数据，集群提供可高可用性和横向扩展性。</strong></p> 
<h4><strong>        3.分片和复制</strong></h4> 
<p><strong>                分片是将索引中的数据分割成多个部分，用于提高性能和扩展性每个分片可以被存储在集群中的一个或多个节点上。</strong></p> 
<p><strong>                复制是为了数据的高可用性和容错性，每个分片都会有一个或多个副本分片，这些分片会被存储在不同的节点上。</strong></p> 
<h4>        <span style="color:#fe2c24;"><strong>4.索引</strong></span></h4> 
<p><span style="color:#fe2c24;"><strong>                </strong></span><strong>索引是用于存储数据的地方类似于关系型数据库中的数据可以，它是一种用于存储相似性质的文档的数据结构。</strong></p> 
<h4><strong>        5.<s>类型</s></strong></h4> 
<p><strong>                类型在ES6.0之前用于组织索引内部文档的一种方式。在ES7.0之后已经被废弃，推荐使用单一索引引用字段代替。</strong></p> 
<h4><strong>        6.文档</strong></h4> 
<p><strong>                文档是ES中的基本数据单元，类似于关系型数据库中的行，每个文档都是一个JSON对象，它们被存储在索引中并可以被搜索。</strong></p> 
<h4><strong>        7.字段</strong></h4> 
<p><strong>                字段是ES中文档的组成部分，类似于关系型数据库中的列，每个字段都有自己的数据类型（文本型、数值型等），并且包含特定的数据。</strong></p> 
<h4>        8.映射</h4> 
<p>                <strong>映射定义了索引中的，每个字段的数据类型和属性，它相当于关系型数据库中的模式，告诉ES如何处理索引的每个字段。</strong></p> 
<h3><strong>创建索引</strong></h3> 
<pre><code class="language-java">PUT /baidu
{
  "settings": {
    "number_of_shards": 2,//主分片
    "number_of_replicas": 2//副分片
  },
  "mappings": {
    "properties": {
      "title":{
        "type": "text"
      }
    }
  }
}</code></pre> 
<h3><strong>添加文档</strong></h3> 
<pre><code class="language-cpp">POST /my_es/_doc
{
  "title":"震惊，某男子竟于小猪干这件事。。。。",
  "content":"男子天天给小猪吃昂贵的水果，小猪更可爱了",
  "author":"王五",
  "time":"2023-12-18T11:44:20"
}</code></pre> 
<h3><strong>查询所有</strong></h3> 
<pre><code class="language-cpp">GET /my_es/_search</code></pre> 
<h3>语法规则</h3> 
<p>       <strong> _doc：用于早期的ES版本中同一个索引中单独集合映射类型。从8.x版本开始已全面废弃。</strong></p> 
<p><strong>        _index：创建新索引、是创建一个命名空间将相关文档聚合在一起</strong></p> 
<p><strong>        _create：创建新索引、是创建一个新的文档并将其添加到指定索引中</strong></p> 
<p><strong>        _update：用于更新文档中的一部分类容</strong></p> 
<p><strong>        _delete：删除文档</strong></p> 
<h3>条件查询</h3> 
<pre><code class="language-cpp">GET /my_es/_search
{
  "query": {
    "match": {
      "title": "猪" //title带有猪字的都查出来
    }
  }
}</code></pre> 
<h4>        返回结果</h4> 
<pre><code class="language-cpp">{
  "took" : 1,//请求耗时
  "timed_out" : false,//是否超时
  "_shards" : {//分片信息（包含了成功的分片数量和失败的分片数量）
    "total" : 2,//总分片数（总命中数）
    "successful" : 2,//搜索成功的分片数
    "skipped" : 0,//没有搜索或跳过的分片数
    "failed" : 0//搜索失败的分片数
  },
  "hits" : {//搜索结果集
    "total" : {//返回多少数据
      "value" : 1,//一共一条数据
      "relation" : "eq"//过滤语法
    },
    "max_score" : 0.8630463,//最高匹配得分
    "hits" : [
      {
        "_index" : "taobao_goods",//索引名
        "_type" : "_doc",//文档类型（8.X已弃用）
        "_id" : "98PrgIwBM5jPvpt7_k_k",//唯一标识符
        "_score" : 0.8630463,//匹配度得分
        "_source" : {//实际内容
          "id" : "1",
          "name" : "康师傅酸菜牛肉",
          "description" : "酸酸甜甜",
          "price" : "5",
          "stock" : "100"
        }
      }
    ]
  }
}
</code></pre> 
<h4>多条件查询</h4> 
<pre><code class="language-java">GET /taobao_goods/_search
{
  "query": {
    "bool": {//多条件查询度一种方式
      "must": [//必须满足一下条件相当于sql中的and//查询语气
        {
          "match": {
            "name": "康师傅"
          }
        },
        {
          "match": {
            "description": "酸酸"
          }
        }
      ]
    }
  }
}
</code></pre> 
<h4>     <strong>   1.must镜像：必须都匹配相当于逻辑的and</strong></h4> 
<h4><strong>        2.must_not：必须都不匹配相当于逻辑中的not</strong></h4> 
<h4><strong>        3.should：表示条件可以匹配，但不是必须，相当于逻辑上的or</strong></h4> 
<h4><strong>        4.filter：表示条件必须匹配常用语过滤操作</strong></h4> 
<h3></h3> 
<h4>更新索引</h4> 
<p><strong>        _doc：覆盖方式完成更新（8.X版本之后移除）</strong></p> 
<pre><code class="language-java">POST /taobao_goods/_doc/-MPsgIwBM5jPvpt7k0-P //文档的_id
{
  "id": "2",
  "name": "统一红烧牛肉面",
  "description": "好吃不上火",
  "price": "5",
  "stock": "70"
}//这种写法会重写原有数据结构（慎用）</code></pre> 
<p><strong>         _update：非覆盖方式完成更新，只有修改功能</strong></p> 
<pre><code class="language-java">POST /taobao_goods/_update/-MPsgIwBM5jPvpt7k0-P
{
  "doc": {
    "price": "5.5"
  }
}//只会修改对应字段

//如果没有这个字段会直接添加这个字段</code></pre> 
<h4>删除文档</h4> 
<pre><code class="language-java">DELETE /taobao_goods/_doc/98PrgIwBM5jPvpt7_k_k//跟文档_id
通过ES id删除</code></pre> 
<h5>条件删除</h5> 
<pre><code class="language-java">POST /taobao_goods/_delete_by_query
{
  "query":{
    "match":{
      "id":"2"
    }
  }
}//通过mysql id删除


//删除所有match_all
POST /taobao_goods/_delete_by_query
{
  "query":{
    "match_all":{
    }
  }
}</code></pre> 
<h3>工作原理</h3> 
<p><img alt="" height="954" src="https://images2.imgbox.com/fd/b7/J81Oci3Q_o.png" width="1200"></p> 
<h2><strong>es容器创建</strong></h2> 
<h4><strong>        1.拉取镜像 </strong></h4> 
<blockquote> 
 <p><strong>        docker pull elasticsearch:xx  #版本尽量大于7.12.1</strong></p> 
</blockquote> 
<h4><strong>        2.创建es网络</strong></h4> 
<blockquote> 
 <p><strong>        docker network create es-network</strong></p> 
</blockquote> 
<h4><strong>        3.找到usr创建elasticsearch文件夹 在里面创建data和plugins文件夹</strong></h4> 
<blockquote> 
 <p><strong>        cd usr</strong></p> 
 <p><strong>        mkdir elasticsearch </strong></p> 
 <p><strong>        cd elasticsearch</strong></p> 
 <p><strong>        mkdir data</strong></p> 
 <p><strong>        mkdir plugins</strong></p> 
 <p><strong>#效果</strong></p> 
 <p></p> 
 <p><img alt="" height="107" src="https://images2.imgbox.com/68/4c/VjapLG8I_o.png" width="545"></p> 
</blockquote> 
<h4><strong>        4.修改挂载文件权限</strong></h4> 
<blockquote> 
 <p><strong>        chmod -R 777 elasticsearch</strong></p> 
</blockquote> 
<h4><strong>        5.创建容器</strong></h4> 
<p></p> 
<pre><code>docker run -d \
--name elasticsearch \
--net=es-network \
-p 9200:9200 \
-p 9300:9300 \
-e "discovery.type=single-node" \
-e xpack.security.authc.api_key.enabled=true \
-e "ES_JAVA_OPTS=-Xms50m -Xmx512m" \
-v es-data:/usr/elasticsearch/data \
-v es-plugins:/usr/elasticsearch/plugins \
docker.elastic.co/elasticsearch/elasticsearch:7.12.1</code></pre> 
<p><strong>docker run -d \        后台运行<br> --name elasticsearch \        给容器起一个别名<br> --net=es-network \        指定容器连接到名为es-network的网络上面<br> -p 9200:9200 \        主机容器之间端口映射，9200用于程序调用使用<br> -p 9300:9300 \        主机容器之间端口映射，9300用于es集群之间的通信<br> -e "discovery.type=single-node" \        配置单节点启动发现的环境变量<br> -e xpack.security.authc.api_key.enabled=true  \        启动api秘钥认证功能<br> -e "ES_JAVA_OPTS=-Xms50m -Xmx512m" \        指定java虚拟机堆内存最小为50mb最大为512mb<br> -v es-data:/usr/elasticsearch/data \        挂载数据目录卷<br> -v es-plugins:/usr/elasticsearch/plugins \        挂载插件目录卷<br> docker.elastic.co/elasticsearch/elasticsearch:7.12.1        指定运行的镜像：版本</strong></p> 
<p><strong>ps：如果运行不了查看是否有多余空格</strong></p> 
<h4>        6.查看安装成功</h4> 
<blockquote> 
 <p><strong>curl http://localhost:9200</strong></p> 
 <p><strong>#返回</strong></p> 
 <p><img alt="" height="339" src="https://images2.imgbox.com/64/96/717Grbpe_o.png" width="708"></p> 
</blockquote> 
<h4>        7.给es设置访问密码</h4> 
<p>                <strong>1.进入es容器</strong></p> 
<p>                <strong>2.进入/usr/share/elasticsearch/config路径</strong></p> 
<p><strong>                3.编辑elasticsearch.yml配置文件</strong></p> 
<blockquote> 
 <p><strong>                 vi elasticsearch.yml</strong></p> 
 <p><strong>加入</strong></p> 
 <p><strong>                http.cors.enabled: true<br>                 http.cors.allow-origin: "*"<br>                 http.cors.allow-headers: Authorization<br>                 xpack.security.enabled: true<br>                 xpack.security.transport.ssl.enabled: true</strong></p> 
</blockquote> 
<p>          <strong>      4.ctrl＋qp</strong></p> 
<p><strong>                5.重启es容器</strong></p> 
<p><strong>                6.再次进入容器</strong></p> 
<p><strong>                7.</strong><strong>设置密码</strong></p> 
<blockquote> 
 <p><strong>        ./bin/elasticsearch-setup-passwords interactive</strong></p> 
</blockquote> 
<p><img alt="" height="611" src="https://images2.imgbox.com/71/77/GlowyC9m_o.png" width="1200"></p> 
<p>                </p> 
<p><strong>                8.退出，进入宿主机再次重启容器，完成</strong></p> 
<p><strong>                9.验证：使用浏览器访问    ip:9200</strong></p> 
<p><strong>                        弹出登录框 用户名默认 ：elastic</strong></p> 
<p><strong>最后返回值</strong></p> 
<p><img alt="" height="317" src="https://images2.imgbox.com/02/2a/Enbin39h_o.png" width="828"></p> 
<h2>           </h2> 
<h2>安装可视化工具kibana</h2> 
<h4>        1.拉取镜像kibana 版本与es对应</h4> 
<blockquote> 
 <p><strong>docker pull kibana:7.12.1</strong></p> 
</blockquote> 
<h4><strong>        2.创建kibana网络</strong></h4> 
<blockquote> 
 <p><strong>docker network create kibana-network</strong></p> 
</blockquote> 
<h4><strong>        3.kibana容器创建</strong></h4> 
<pre><code>docker run -d \
--name kibana \
--net=kibana-network \
-e ELASTICSEARCH_HOSTS=http://es的服务器ip地址:9200 \
-p 5601:5601 \
docker.elastic.co/kibana/kibana:7.12.1

</code></pre> 
<p><strong>docker run -d \        后台运行<br> --name kibana \        设置容器名<br> --net=kibana-network \        设置kibana网络<br> -e ELASTICSEARCH_HOSTS=http://es的服务器ip地址:9200 \        <br> -p 5601:5601 \        主机容器之间端口映射<br> docker.elastic.co/kibana/kibana:7.12.1        运行的镜像名：版本号</strong></p> 
<h4>        4.进入容器kibana 进入config</h4> 
<blockquote> 
 <p> bash-4.4$ pwd<br> /usr/share/kibana/config</p> 
</blockquote> 
<h4>        5.更改kibana配置文件</h4> 
<blockquote> 
 <p>vi kibana.yml </p> 
</blockquote> 
<p>加入</p> 
<blockquote> 
 <p>i18n.locale: "zh-CN"<br> elasticsearch.username: "elastic" #用户名<br> elasticsearch.password: "xxxxx" #为es配置的密码要相同</p> 
</blockquote> 
<h4>        6.退出容器 重启容器</h4> 
<h4>        7.浏览器访问  ip：5601        </h4> 
<p>                <strong>输入用户名和密码进入elastic</strong></p> 
<p><img alt="" height="781" src="https://images2.imgbox.com/47/f6/2Ylx9YOa_o.png" width="1200"></p> 
<h3></h3> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/db2381421a95a8129710ef7000aa908d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【2023年】F题和E题——基于声传播的智能定位系统/运动目标控制与自动追踪系统——舵机云台方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95df9d1fb2e9438bc7aaf6e1c8cbcbe5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql统计函数round失效问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>