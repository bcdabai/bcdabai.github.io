<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker实现Mariadb分库分表、读写分离 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker实现Mariadb分库分表、读写分离" />
<meta property="og:description" content="[TOC]
一、简介 本文使用docker实现mysql主从配置，读写分离、分库分表等功能。
二、环境准备 1.基础环境 java java version &#34;1.8.0_111&#34; Java(TM) SE Runtime Environment (build 1.8.0_111-b14) Java HotSpot(TM) 64-Bit Server VM (build 25.111-b14, mixed mode) 复制代码 docker Client: Version:	18.03.0-ce API version:	1.37 Go version:	go1.9.4 Git commit:	0520e24 Built:	Wed Mar 21 23:09:15 2018 OS/Arch:	linux/amd64 Experimental:	false Orchestrator:	swarm Server: Engine: Version:	18.03.0-ce API version:	1.37 (minimum version 1.12) Go version:	go1.9.4 Git commit:	0520e24 Built:	Wed Mar 21 23:13:03 2018 OS/Arch:	linux/amd64 Experimental:	false 复制代码 三、安装Mysql主从配置 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bc86277c806e72c0ad144248b2515af4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-21T13:11:26+08:00" />
<meta property="article:modified_time" content="2019-04-21T13:11:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker实现Mariadb分库分表、读写分离</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article-content"> 
 <p>[TOC]</p> 
 <h3 class="heading">一、简介</h3> 
 <p>本文使用docker实现mysql主从配置，读写分离、分库分表等功能。</p> 
 <h3 class="heading">二、环境准备</h3> 
 <h5 class="heading">1.基础环境</h5> 
 <ul><li>java</li></ul> 
 <pre><code class="hljs bash copyable">java version <span class="hljs-string">"1.8.0_111"</span>
Java(TM) SE Runtime Environment (build 1.8.0_111-b14)
Java HotSpot(TM) 64-Bit Server VM (build 25.111-b14, mixed mode)

<span class="copy-code-btn">复制代码</span></code></pre> 
 <ul><li>docker</li></ul> 
 <pre><code class="hljs bash copyable">Client:
 Version:	18.03.0-ce
 API version:	1.37
 Go version:	go1.9.4
 Git commit:	0520e24
 Built:	Wed Mar 21 23:09:15 2018
 OS/Arch:	linux/amd64
 Experimental:	<span class="hljs-literal">false</span>
 Orchestrator:	swarm

Server:
 Engine:
  Version:	18.03.0-ce
  API version:	1.37 (minimum version 1.12)
  Go version:	go1.9.4
  Git commit:	0520e24
  Built:	Wed Mar 21 23:13:03 2018
  OS/Arch:	linux/amd64
  Experimental:	<span class="hljs-literal">false</span>

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">三、安装Mysql主从配置</h3> 
 <h5 class="heading">1.部署信息</h5> 
 <table><thead><tr><th>节点名称</th><th>数据名称</th><th>节点IP</th><th>端口</th></tr></thead><tbody><tr><td>master</td><td>marster</td><td>192.168.92.50</td><td>3306</td></tr><tr><td>slave</td><td>slave</td><td>192.168.92.51</td><td>3307</td></tr><tr><td>mycat</td><td>mycat</td><td>192.168.92.50</td><td>8066/9066</td></tr></tbody></table> 
 <h5 class="heading">2.主节点配置文件</h5> 
 <p>创建mysql主节点配置文件</p> 
 <pre><code class="hljs bash copyable">mkdir /usr/<span class="hljs-built_in">local</span>/mysql/master
mkdir conf data

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>创建主节点配置文件docker.cnf</p> 
 <pre><code class="hljs bash copyable">[mysqld]
server-id=1
<span class="hljs-built_in">log</span>-bin=master-bin  <span class="hljs-comment">#只是读写,就只要主库配置即可.如果要做主从切换，那么主库和从库都需要开启.</span>
skip-host-cache
skip-name-resolve
collation-server = utf8_unicode_ci
init-connect=<span class="hljs-string">'SET NAMES utf8'</span>
character-set-server = utf8
[mysql]  
default-character-set=utf8
[client]  
default-character-set=utf8

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>创建从节点配置文件 docker.conf</p> 
 <pre><code class="hljs bash copyable">mkdir /usr/<span class="hljs-built_in">local</span>/mysql/slave
mkdir conf data

<span class="copy-code-btn">复制代码</span></code></pre> 
 <pre><code class="hljs bash copyable">[mysqld]
server-id=2
<span class="hljs-built_in">log</span>-bin=master-bin 
skip-host-cache
skip-name-resolve
collation-server = utf8_unicode_ci
init-connect=<span class="hljs-string">'SET NAMES utf8'</span>
character-set-server = utf8
[mysql]  
default-character-set=utf8
[client]  
default-character-set=utf8

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h5 class="heading">3.创建mysql容器</h5> 
 <p>此处使用mariadb最新稳定镜像创建容器</p> 
 <ul><li>创建主节点myslq</li></ul> 
 <pre><code class="hljs bash copyable">docker run --name master -p 3306:3306 -v /usr/<span class="hljs-built_in">local</span>/mysql/master/conf:/etc/mysql/conf.d -v /usr/<span class="hljs-built_in">local</span>/mysql/master/data:/var/lib/mysql <span class="hljs-_">-e</span> MYSQL_ROOT_PASSWORD=123456 -idt mariadb:latest --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

<span class="copy-code-btn">复制代码</span></code></pre> 
 <ul><li>创建从节点mysql</li></ul> 
 <pre><code class="hljs bash copyable">docker run --name slave -p 3307:3306 -v /usr/<span class="hljs-built_in">local</span>/mysql/slave/conf:/etc/mysql/conf.d -v /usr/<span class="hljs-built_in">local</span>/mysql/slave/data:/var/lib/mysql <span class="hljs-_">-e</span> MYSQL_ROOT_PASSWORD=123456 -idt mariadb:latest --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h5 class="heading">4.开启主从复制</h5> 
 <ul><li>step 1 进入主节点</li></ul> 
 <pre><code class="hljs bash copyable">docker <span class="hljs-built_in">exec</span> -it master /bin/bash
mysql -uroot -p
<span class="copy-code-btn">复制代码</span></code></pre> 
 <ul><li>step 2 创建用户</li></ul> 
 <pre><code class="hljs bash copyable">create user  <span class="hljs-string">'backUser'</span>@<span class="hljs-string">'%'</span>  identified by <span class="hljs-string">'root'</span>;

grant replication slave on *.* to <span class="hljs-string">'backUser'</span>@<span class="hljs-string">'%'</span>;

flush privileges;

show master status;
MariaDB [(none)]&gt; show master status;
+-------------------+----------+--------------+------------------+
| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+-------------------+----------+--------------+------------------+
| master-bin.000003 |      787 |              |                  |
+-------------------+----------+--------------+------------------+
1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.000 sec)

<span class="copy-code-btn">复制代码</span></code></pre> 
 <ul><li>step 3 进入从节点创建用户开启同步</li></ul> 
 <pre><code class="hljs bash copyable">docker <span class="hljs-built_in">exec</span> -it slave /bin/bash

mysql -uroot -proot

change master to master_host=<span class="hljs-string">'192.168.92.51'</span>,master_port=3306,master_user=<span class="hljs-string">'backUser'</span>,master_password=<span class="hljs-string">'root'</span>,master_log_file=<span class="hljs-string">'master-bin.000003'</span>,master_log_pos=787;

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>开启主从复制：</p> 
 <pre><code class="hljs bash copyable">start slave;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <blockquote> 
  <p>从节点设置日志和文件名要跟主节点信息对应，包括日志记录起始位置position</p> 
 </blockquote> 
 <p>检查主从复制是否OK</p> 
 <pre><code class="hljs bash copyable">show slave status \G;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <pre><code class="hljs bash copyable">
*************************** 1. row ***************************
                Slave_IO_State: Waiting <span class="hljs-keyword">for</span> master to send event
                   Master_Host: 192.168.92.50
                   Master_User: backUser
                   Master_Port: 3306
                 Connect_Retry: 60
               Master_Log_File: master-bin.000005
           Read_Master_Log_Pos: 343
                Relay_Log_File: mysqld-relay-bin.000002
                 Relay_Log_Pos: 556
         Relay_Master_Log_File: master-bin.000005
              Slave_IO_Running: Yes
             Slave_SQL_Running: Yes

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>Slave出现2个YES,代表主从复制设置成功。</p> 
 <h5 class="heading">5、安装Mycat</h5> 
 <p>下载mycat在50节点实现安装</p> 
 <pre><code class="hljs bash copyable">tar -zxvf Mycat-server-1.6.7.1-release-20190213150257-linux.tar.gz

mv mycat/ /usr/<span class="hljs-built_in">local</span>/
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>修改mycat目录下 conf的server.xml 文件，指定用户名和密码</p> 
 <pre><code class="hljs bash copyable">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;!-- - - Licensed under the Apache License, Version 2.0 (the <span class="hljs-string">"License"</span>); 
	- you may not use this file except <span class="hljs-keyword">in</span> compliance with the License. - You 
	may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
	- - Unless required by applicable law or agreed to <span class="hljs-keyword">in</span> writing, software - 
	distributed under the License is distributed on an <span class="hljs-string">"AS IS"</span> BASIS, - WITHOUT 
	WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
	License <span class="hljs-keyword">for</span> the specific language governing permissions and - limitations 
	under the License. --&gt;
&lt;!DOCTYPE mycat:server SYSTEM <span class="hljs-string">"server.dtd"</span>&gt;
&lt;mycat:server xmlns:mycat=<span class="hljs-string">"http://io.mycat/"</span>&gt;
	&lt;system&gt;
	&lt;property name=<span class="hljs-string">"nonePasswordLogin"</span>&gt;0&lt;/property&gt; &lt;!-- 0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户--&gt;
	&lt;property name=<span class="hljs-string">"useHandshakeV10"</span>&gt;1&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"useSqlStat"</span>&gt;0&lt;/property&gt;  &lt;!-- 1为开启实时统计、0为关闭 --&gt;
	&lt;property name=<span class="hljs-string">"useGlobleTableCheck"</span>&gt;0&lt;/property&gt;  &lt;!-- 1为开启全加班一致性检测、0为关闭 --&gt;
	&lt;property name=<span class="hljs-string">"sequnceHandlerType"</span>&gt;0&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"subqueryRelationshipCheck"</span>&gt;<span class="hljs-literal">false</span>&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"processorBufferPoolType"</span>&gt;0&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"handleDistributedTransactions"</span>&gt;0&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"useOffHeapForMerge"</span>&gt;1&lt;/property&gt;
		&lt;!--单位为m--&gt;
        &lt;property name=<span class="hljs-string">"memoryPageSize"</span>&gt;64k&lt;/property&gt;
		&lt;!--单位为k--&gt;
		&lt;property name=<span class="hljs-string">"spillsFileBufferSize"</span>&gt;1k&lt;/property&gt;
		&lt;property name=<span class="hljs-string">"useStreamOutput"</span>&gt;0&lt;/property&gt;
		&lt;!--单位为m--&gt;
		&lt;property name=<span class="hljs-string">"systemReserveMemorySize"</span>&gt;384m&lt;/property&gt;
		&lt;!--是否采用zookeeper协调切换  --&gt;
		&lt;property name=<span class="hljs-string">"useZKSwitch"</span>&gt;<span class="hljs-literal">false</span>&lt;/property&gt;
		&lt;!-- XA Recovery Log日志名称 --&gt;
		&lt;!--&lt;property name=<span class="hljs-string">"XARecoveryLogBaseName"</span>&gt;tmlog&lt;/property&gt;--&gt;
		&lt;!--如果为 <span class="hljs-literal">true</span>的话 严格遵守隔离级别,不会在仅仅只有select语句的时候在事务中切换连接--&gt;
		&lt;property name=<span class="hljs-string">"strictTxIsolation"</span>&gt;<span class="hljs-literal">false</span>&lt;/property&gt;
		&lt;property name=<span class="hljs-string">"useZKSwitch"</span>&gt;<span class="hljs-literal">true</span>&lt;/property&gt;
	&lt;/system&gt;
	&lt;user name=<span class="hljs-string">"root"</span>&gt;
		&lt;property name=<span class="hljs-string">"password"</span>&gt;123456&lt;/property&gt;
		&lt;property name=<span class="hljs-string">"schemas"</span>&gt;<span class="hljs-built_in">test</span>&lt;/property&gt;
	&lt;/user&gt;
&lt;/mycat:server&gt;

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上述配置，指定以root为用户名，密码为123456，访问虚拟逻辑数据库test。</p> 
 <ul><li>配置rule规则 修改mycat conf 文件夹下的schema.xml 配置数据库对应规则</li></ul> 
 <pre><code class="hljs bash copyable">&lt;?xml version=<span class="hljs-string">"1.0"</span>?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM <span class="hljs-string">"schema.dtd"</span>&gt;
&lt;mycat:schema xmlns:mycat=<span class="hljs-string">"http://io.mycat/"</span>&gt;

	&lt;schema name=<span class="hljs-string">"test"</span> checkSQLschema=<span class="hljs-string">"false"</span> sqlMaxLimit=<span class="hljs-string">"100"</span>&gt;
         &lt;table name=<span class="hljs-string">"tb_user"</span>   primaryKey=<span class="hljs-string">"id"</span>  autoIncrement=<span class="hljs-string">"true"</span>  dataNode=<span class="hljs-string">"dn1,dn2,dn3,dn4"</span> rule=<span class="hljs-string">"userrule"</span> /&gt;
		&lt;table name=<span class="hljs-string">"tb_category"</span> primaryKey=<span class="hljs-string">"id"</span> dataNode=<span class="hljs-string">"dn1,dn2,dn3,dn4"</span> rule=<span class="hljs-string">"categoryrule"</span> /&gt;
	&lt;/schema&gt;
	&lt;dataNode name=<span class="hljs-string">"dn1"</span> dataHost=<span class="hljs-string">"localhost1"</span> database=<span class="hljs-string">"db1"</span> /&gt;
	&lt;dataNode name=<span class="hljs-string">"dn2"</span> dataHost=<span class="hljs-string">"localhost1"</span> database=<span class="hljs-string">"db2"</span> /&gt;
	&lt;dataNode name=<span class="hljs-string">"dn3"</span> dataHost=<span class="hljs-string">"localhost1"</span> database=<span class="hljs-string">"db3"</span> /&gt;
	&lt;dataNode name=<span class="hljs-string">"dn4"</span> dataHost=<span class="hljs-string">"localhost1"</span> database=<span class="hljs-string">"db4"</span> /&gt;

	&lt;dataHost name=<span class="hljs-string">"localhost1"</span> maxCon=<span class="hljs-string">"1000"</span> minCon=<span class="hljs-string">"10"</span> balance=<span class="hljs-string">"1"</span>
			  writeType=<span class="hljs-string">"0"</span> dbType=<span class="hljs-string">"mysql"</span> dbDriver=<span class="hljs-string">"native"</span> switchType=<span class="hljs-string">"1"</span>  slaveThreshold=<span class="hljs-string">"100"</span>&gt;
		&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;
		&lt;!-- 读写分离配置 --&gt;
		&lt;writeHost host=<span class="hljs-string">"hostM1"</span> url=<span class="hljs-string">"192.168.92.50:3306"</span> user=<span class="hljs-string">"root"</span>
				   password=<span class="hljs-string">"123456"</span>&gt;
			&lt;<span class="hljs-built_in">read</span>Host host=<span class="hljs-string">"hostS2"</span> url=<span class="hljs-string">"192.168.92.51:3307"</span> user=<span class="hljs-string">"root"</span> password=<span class="hljs-string">"123456"</span> /&gt;
		&lt;/writeHost&gt;
	&lt;/dataHost&gt;
&lt;/mycat:schema&gt;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上述配置scheam name 对应server配置文件的虚拟数据库，指定了2个表信息，tb_user 表主键实现自增长，有4个数据库节点，使用userrule表规则。</p> 
 <p>dataNode 指定了真实对应的物理数据库节点，对应dataHost说明了读写指定的用户和节点信息。</p> 
 <ul><li>配置表分片规则文件rule.xml</li></ul> 
 <pre><code class="hljs bash copyable">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;!-- - - Licensed under the Apache License, Version 2.0 (the <span class="hljs-string">"License"</span>); 
	- you may not use this file except <span class="hljs-keyword">in</span> compliance with the License. - You 
	may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
	- - Unless required by applicable law or agreed to <span class="hljs-keyword">in</span> writing, software - 
	distributed under the License is distributed on an <span class="hljs-string">"AS IS"</span> BASIS, - WITHOUT 
	WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
	License <span class="hljs-keyword">for</span> the specific language governing permissions and - limitations 
	under the License. --&gt;
&lt;!DOCTYPE mycat:rule SYSTEM <span class="hljs-string">"rule.dtd"</span>&gt;
&lt;mycat:rule xmlns:mycat=<span class="hljs-string">"http://io.mycat/"</span>&gt;
    &lt;!-- 配置数据库规则 --&gt;
   	&lt;tableRule name=<span class="hljs-string">"userrule"</span>&gt;
		&lt;rule&gt;
			&lt;columns&gt;id&lt;/columns&gt;
			&lt;algorithm&gt;func1&lt;/algorithm&gt;
		&lt;/rule&gt;
	&lt;/tableRule&gt;
	&lt;!-- 配置数据库<span class="hljs-built_in">test</span> tb_category规则 --&gt;
	&lt;tableRule name=<span class="hljs-string">"categoryrule"</span>&gt;
		&lt;rule&gt;
			&lt;columns&gt;id&lt;/columns&gt;
			&lt;algorithm&gt;jump-consistent-hash&lt;/algorithm&gt;
		&lt;/rule&gt;
	&lt;/tableRule&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"murmur"</span>
		class=<span class="hljs-string">"io.mycat.route.function.PartitionByMurmurHash"</span>&gt;
		&lt;property name=<span class="hljs-string">"seed"</span>&gt;0&lt;/property&gt;&lt;!-- 默认是0 --&gt;
		&lt;property name=<span class="hljs-string">"count"</span>&gt;2&lt;/property&gt;&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片 --&gt;
		&lt;property name=<span class="hljs-string">"virtualBucketTimes"</span>&gt;160&lt;/property&gt;&lt;!-- 一个实际的数据库节点被映射为这么多虚拟节点，默认是160倍，也就是虚拟节点数是物理节点数的160倍 --&gt;
		&lt;!-- &lt;property name=<span class="hljs-string">"weightMapFile"</span>&gt;weightMapFile&lt;/property&gt; 节点的权重，没有指定权重的节点默认是1。以properties文件的格式填写，以从0开始到count-1的整数值也就是节点索引为key，以节点权重值为值。所有权重值必须是正整数，否则以1代替 --&gt;
		&lt;!-- &lt;property name=<span class="hljs-string">"bucketMapPath"</span>&gt;/etc/mycat/bucketMapPath&lt;/property&gt; 
			用于测试时观察各物理节点与虚拟节点的分布情况，如果指定了这个属性，会把虚拟节点的murmur <span class="hljs-built_in">hash</span>值与物理节点的映射按行输出到这个文件，没有默认值，如果不指定，就不会输出任何东西 --&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;

	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"crc32slot"</span>
			  class=<span class="hljs-string">"io.mycat.route.function.PartitionByCRC32PreSlot"</span>&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"hash-int"</span>
		class=<span class="hljs-string">"io.mycat.route.function.PartitionByFileMap"</span>&gt;
		&lt;property name=<span class="hljs-string">"mapFile"</span>&gt;partition-hash-int.txt&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"rang-long"</span>
		class=<span class="hljs-string">"io.mycat.route.function.AutoPartitionByLong"</span>&gt;
		&lt;property name=<span class="hljs-string">"mapFile"</span>&gt;autopartition-long.txt&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"mod-long"</span> class=<span class="hljs-string">"io.mycat.route.function.PartitionByMod"</span>&gt;
		&lt;!-- how many data nodes --&gt;
		&lt;property name=<span class="hljs-string">"count"</span>&gt;3&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;

	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"func1"</span> class=<span class="hljs-string">"io.mycat.route.function.PartitionByLong"</span>&gt;
		&lt;property name=<span class="hljs-string">"partitionCount"</span>&gt;8&lt;/property&gt;
		&lt;property name=<span class="hljs-string">"partitionLength"</span>&gt;128&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"latestMonth"</span>
		class=<span class="hljs-string">"io.mycat.route.function.LatestMonthPartion"</span>&gt;
		&lt;property name=<span class="hljs-string">"splitOneDay"</span>&gt;24&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"partbymonth"</span>
		class=<span class="hljs-string">"io.mycat.route.function.PartitionByMonth"</span>&gt;
		&lt;property name=<span class="hljs-string">"dateFormat"</span>&gt;yyyy-MM-dd&lt;/property&gt;
		&lt;property name=<span class="hljs-string">"sBeginDate"</span>&gt;2015-01-01&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"rang-mod"</span> class=<span class="hljs-string">"io.mycat.route.function.PartitionByRangeMod"</span>&gt;
        	&lt;property name=<span class="hljs-string">"mapFile"</span>&gt;partition-range-mod.txt&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
	
	&lt;<span class="hljs-keyword">function</span> name=<span class="hljs-string">"jump-consistent-hash"</span> class=<span class="hljs-string">"io.mycat.route.function.PartitionByJumpConsistentHash"</span>&gt;
		&lt;property name=<span class="hljs-string">"totalBuckets"</span>&gt;3&lt;/property&gt;
	&lt;/<span class="hljs-keyword">function</span>&gt;
&lt;/mycat:rule&gt;

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上述文件重点关注第一个tableRule、rule指定了分片规则在哪个表字段，algorithm指定了分片的算法，其中 func1 与文件后面function名称为func1对应，此处使用了PartitionByLong分片算法。</p> 
 <ul><li>conf下增加sequence_conf.properties文件，其内容如下：</li></ul> 
 <pre><code class="hljs bash copyable">TB_USER.HISIDS=
TB_USER.MINID=1
TB_USER.MAXID=20000
TB_USER.CURID=1

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>主要申明了主键增长的策略。</p> 
 <h3 class="heading">四、Mycat分库分表实践测试</h3> 
 <h5 class="heading">1.master节点手动创建数据库</h5> 
 <p>master节点手动创建4个数据库db1，db2,db3,db4 <strong>(不要操作从节点)</strong></p> 
 <p>此时打开slave节点，会观察到slave也会自动创建4个数据库。 </p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <h5 class="heading">2.开启mycat</h5> 
 <p>使用命令 ./mycat start 开启mycat</p> 
 <pre><code class="hljs bash copyable">./mycat start 启动
./mycat stop 停止	
./mycat console 前台运行	
./mycat restart 重启服务
./mycat pause 暂停	
./mycat status 查看启动状态
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>如果启动失败，请查看 /usr/local/mycat的wrapper.log 日志文件信息。</p> 
 <pre><code class="hljs bash copyable">FATAL  | wrapper  | 2019/04/21 14:36:09 | ERROR: Could not write pid file /usr/<span class="hljs-built_in">local</span>/mycat/logs/mycat.pid: No such file or directory
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>如果遇到上述错误，请在mycat 目录创建logs 文件夹，重新启动即可。</p> 
 <pre><code class="hljs bash copyable">[root@localhost mycat]<span class="hljs-comment"># bin/mycat status</span>
Mycat-server is running (5065).

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上述消息则表示mycat启动成功。</p> 
 <h5 class="heading">2.放行mycat通信端口</h5> 
 <pre><code class="hljs bash copyable">firewall-cmd --zone=public --add-port=8066/tcp --permanent
firewall-cmd --zone=public --add-port=9066/tcp --permanent
firewall-cmd --reload
<span class="copy-code-btn">复制代码</span></code></pre> 
 <blockquote> 
  <p>使用docker镜像开启mycat容器实例</p> 
 </blockquote> 
 <pre><code class="hljs bash copyable">docker run --name mycat -v /usr/<span class="hljs-built_in">local</span>/mycat/conf/schema.xml:/usr/<span class="hljs-built_in">local</span>/mycat/conf/schema.xml -v /usr/<span class="hljs-built_in">local</span>/mycat/conf/rule.xml:/usr/<span class="hljs-built_in">local</span>/mycat/conf/rule.xml -v /usr/<span class="hljs-built_in">local</span>/mycat/conf/server.xml:/usr/<span class="hljs-built_in">local</span>/mycat/conf/server.xml -v /usr/<span class="hljs-built_in">local</span>/mycat/conf/sequence_conf.properties:/usr/<span class="hljs-built_in">local</span>/mycat/conf/sequence_conf.properties --privileged=<span class="hljs-literal">true</span> -p 8066:8066 -p 9066:9066 <span class="hljs-_">-e</span> MYSQL_ROOT_PASSWORD=123456  <span class="hljs-_">-d</span> longhronshens/mycat-docker 
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>或者关闭防火墙。</p> 
 <h5 class="heading">3. mycat连接</h5> 
 <p>使用navicate连接mycat，端口8066(9066为管理端口)</p> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 使用命令连接mycat 
 <p></p> 
 <pre><code class="hljs bash copyable">[root@localhost ~]<span class="hljs-comment"># mysql -h127.0.0.1 -uroot -p123456 -P8066 </span>
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 12
Server version: 5.6.29-mycat-1.6.7.1-release-20190213150257 MyCat Server (OpenCloudDB)

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

Type <span class="hljs-string">'help;'</span> or <span class="hljs-string">'\h'</span> <span class="hljs-keyword">for</span> help. Type <span class="hljs-string">'\c'</span> to clear the current input statement.

MySQL [(none)]&gt; 


<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>管理端命令：</p> 
 <pre><code class="hljs bash copyable">mysql -h127.0.0.1 -uroot -proot -P9066 
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>查看虚拟逻辑库：</p> 
 <pre><code class="hljs bash copyable">MySQL [(none)]&gt; show databases;
+----------+
| DATABASE |
+----------+
| <span class="hljs-built_in">test</span>     |
+----------+
1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)

MySQL [(none)]&gt; 

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>使用逻辑库创建表：</p> 
 <pre><code class="hljs bash copyable">MySQL [(none)]&gt; use <span class="hljs-built_in">test</span>;

CREATE TABLE `tb_user`  (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT <span class="hljs-string">'用户名'</span>,
  `password` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT <span class="hljs-string">'密码，加密存储'</span>,
  `phone` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT <span class="hljs-string">'注册手机号'</span>,
  `email` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT <span class="hljs-string">'注册邮箱'</span>,
  `created` datetime(0) NOT NULL,
  `updated` datetime(0) NOT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `username`(`username`) USING BTREE,
  UNIQUE INDEX `phone`(`phone`) USING BTREE,
  UNIQUE INDEX `email`(`email`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 54 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = <span class="hljs-string">'用户表'</span> ROW_FORMAT = Compact;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>可以看到mycat,mysql主从都创建了该表</p> 
 <p><a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFD4J0" rel="nofollow"></a></p> 
 <figure> 
  <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFD4J0" rel="nofollow"></a> 
  <figcaption> 
   <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFD4J0" rel="nofollow"></a> 
  </figcaption> 
  <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFD4J0" rel="nofollow"></a> 
 </figure> 
 <p></p> 
 <p>在创建一张表：</p> 
 <pre><code class="hljs bash copyable">CREATE TABLE `tb_category`  (
  `id` varchar(5) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  `name` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT <span class="hljs-string">'名字'</span>,
  `sort_order` int(4) NOT NULL DEFAULT 1 COMMENT <span class="hljs-string">'排列序号，表示同级类目的展现次序，如数值相等则按名称次序排列。取值范围:大于零的整数'</span>,
  `created` datetime(0) NULL DEFAULT NULL,
  `updated` datetime(0) NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `updated`(`updated`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>插入一条数据：</p> 
 <pre><code class="hljs bash copyable">INSERT INTO `tb_user`(id,username,password,phone,email,created,updated) VALUES (7, <span class="hljs-string">'zhangsan'</span>, <span class="hljs-string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="hljs-string">'13488888888'</span>, <span class="hljs-string">'aa@a'</span>, <span class="hljs-string">'2015-04-06 17:03:55'</span>, <span class="hljs-string">'2015-04-06 17:03:55'</span>);
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>为测试分库效果，我们插入不同ID的数据来观察一下：</p> 
 <pre><code class="hljs bash copyable">INSERT INTO `tb_user`(id,username,password,phone,email,created,updated) VALUES (128, <span class="hljs-string">'zhang02'</span>, <span class="hljs-string">'e10adc3949ba59abbe56e057f20f88ss'</span>, <span class="hljs-string">'13488888882'</span>, <span class="hljs-string">'aa@01.com'</span>, <span class="hljs-string">'2015-04-06 17:03:57'</span>, <span class="hljs-string">'2015-04-06 17:04:55'</span>);

INSERT INTO `tb_user`(id,username,password,phone,email,created,updated) VALUES (256, <span class="hljs-string">'zhang03'</span>, <span class="hljs-string">'e10adc3949ba59abbe56e057f20f88ss'</span>, <span class="hljs-string">'13488888883'</span>, <span class="hljs-string">'aa@02.com'</span>, <span class="hljs-string">'2015-04-06 17:03:57'</span>, <span class="hljs-string">'2015-04-06 17:04:55'</span>);

INSERT INTO `tb_user`(id,username,password,phone,email,created,updated) VALUES (384, <span class="hljs-string">'zhang05'</span>, <span class="hljs-string">'e10adc3949ba59abbe56e057f20f88ss'</span>, <span class="hljs-string">'13488888885'</span>, <span class="hljs-string">'aa@05.com'</span>, <span class="hljs-string">'2015-04-06 17:03:57'</span>, <span class="hljs-string">'2015-04-06 17:04:55'</span>);

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>可以看到数据分别分布在db1/db2/db3/db4,分布的规则取决于插入数据的主键在rule.xml 设置的分片规则约束。</p> 
 <p>查看mycat节点健康状态，在主节点输入如下命令：</p> 
 <pre><code class="hljs bash copyable">[root@localhost ~]<span class="hljs-comment"># mysql -h127.0.0.1 -uroot -p123456 -P9066 </span>
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 16
Server version: 5.6.29-mycat-1.6.7.1-release-20190213150257 MyCat Server (monitor)

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

Type <span class="hljs-string">'help;'</span> or <span class="hljs-string">'\h'</span> <span class="hljs-keyword">for</span> help. Type <span class="hljs-string">'\c'</span> to clear the current input statement.

MySQL [(none)]&gt;  show @@heartbeat;
+--------+-------+---------------+------+---------+-------+--------+---------+--------------+---------------------+-------+
| NAME   | TYPE  | HOST          | PORT | RS_CODE | RETRY | STATUS | TIMEOUT | EXECUTE_TIME | LAST_ACTIVE_TIME    | STOP  |
+--------+-------+---------------+------+---------+-------+--------+---------+--------------+---------------------+-------+
| hostM1 | mysql | 192.168.92.50 | 3306 |       1 |     0 | idle   |   30000 | 1,9,6        | 2019-04-21 20:44:40 | <span class="hljs-literal">false</span> |
| hostS2 | mysql | 192.168.92.51 | 3307 |       1 |     0 | idle   |   30000 | 1,9,67381    | 2019-04-21 20:44:40 | <span class="hljs-literal">false</span> |
+--------+-------+---------------+------+---------+-------+--------+---------+--------------+---------------------+-------+
2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.36 sec)

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上述 RS_CODE 1代表节点正常，-1代表节点异常。</p> 
 <p>查询mycat所有命令：</p> 
 <pre><code class="hljs bash copyable">MySQL [(none)]&gt; show @@<span class="hljs-built_in">help</span>;
+--------------------------------------------------------------+--------------------------------------------+
| STATEMENT                                                    | DESCRIPTION                                |
+--------------------------------------------------------------+--------------------------------------------+
| show @@time.current                                          | Report current timestamp                   |
| show @@time.startup                                          | Report startup timestamp                   |
| show @@version                                               | Report Mycat Server version                |
| show @@server                                                | Report server status                       |
| show @@threadpool                                            | Report threadPool status                   |
| show @@database                                              | Report databases                           |
| show @@datanode                                              | Report dataNodes                           |
| show @@datanode <span class="hljs-built_in">where</span> schema = ?                             | Report dataNodes                           |
| show @@datasource                                            | Report dataSources                         |
| show @@datasource <span class="hljs-built_in">where</span> dataNode = ?                         | Report dataSources                         |
| show @@datasource.synstatus                                  | Report datasource data synchronous         |
| show @@datasource.syndetail <span class="hljs-built_in">where</span> name=?                     | Report datasource data synchronous detail  |
| show @@datasource.cluster                                    | Report datasource galary cluster variables |
| show @@processor                                             | Report processor status                    |
| show @@<span class="hljs-built_in">command</span>                                               | Report commands status                     |
| show @@connection                                            | Report connection status                   |
| show @@cache                                                 | Report system cache usage                  |
| show @@backend                                               | Report backend connection status           |
| show @@session                                               | Report front session details               |
| show @@connection.sql                                        | Report connection sql                      |
| show @@sql.execute                                           | Report execute status                      |
| show @@sql.detail <span class="hljs-built_in">where</span> id = ?                               | Report execute detail status               |
| show @@sql                                                   | Report SQL list                            |
| show @@sql.high                                              | Report Hight Frequency SQL                 |
| show @@sql.slow                                              | Report slow SQL                            |
| show @@sql.resultset                                         | Report BIG RESULTSET SQL                   |
| show @@sql.sum                                               | Report  User RW Stat                       |
| show @@sql.sum.user                                          | Report  User RW Stat                       |
| show @@sql.sum.table                                         | Report  Table RW Stat                      |
| show @@parser                                                | Report parser status                       |
| show @@router                                                | Report router status                       |
| show @@heartbeat                                             | Report heartbeat status                    |
| show @@heartbeat.detail <span class="hljs-built_in">where</span> name=?                         | Report heartbeat current detail            |
| show @@slow <span class="hljs-built_in">where</span> schema = ?                                 | Report schema slow sql                     |
| show @@slow <span class="hljs-built_in">where</span> datanode = ?                               | Report datanode slow sql                   |
| show @@sysparam                                              | Report system param                        |
| show @@syslog <span class="hljs-built_in">limit</span>=?                                        | Report system mycat.log                    |
| show @@white                                                 | show mycat white host                      |
| show @@white.set=?,?                                         | <span class="hljs-built_in">set</span> mycat white host,[ip,user]             |
| show @@directmemory=1 or 2                                   | show mycat direct memory usage             |
| show @@check_global -SCHEMA= ? -TABLE=? -retry=? -interval=? | check mycat global table consistency       |
| switch @@datasource name:index                               | Switch dataSource                          |
| <span class="hljs-built_in">kill</span> @@connection id1,id2,...                                | Kill the specified connections             |
| stop @@heartbeat name:time                                   | Pause dataNode heartbeat                   |
| reload @@config                                              | Reload basic config from file              |
| reload @@config_all                                          | Reload all config from file                |
| reload @@route                                               | Reload route config from file              |
| reload @@user                                                | Reload user config from file               |
| reload @@sqlslow=                                            | Set Slow SQL Time(ms)                      |
| reload @@user_stat                                           | Reset show @@sql  @@sql.sum @@sql.slow     |
| rollback @@config                                            | Rollback all config from memory            |
| rollback @@route                                             | Rollback route config from memory          |
| rollback @@user                                              | Rollback user config from memory           |
| reload @@sqlstat=open                                        | Open real-time sql <span class="hljs-built_in">stat</span> analyzer           |
| reload @@sqlstat=close                                       | Close real-time sql <span class="hljs-built_in">stat</span> analyzer          |
| offline                                                      | Change MyCat status to OFF                 |
| online                                                       | Change MyCat status to ON                  |
| clear @@slow <span class="hljs-built_in">where</span> schema = ?                                | Clear slow sql by schema                   |
| clear @@slow <span class="hljs-built_in">where</span> datanode = ?                              | Clear slow sql by datanode                 |
+--------------------------------------------------------------+--------------------------------------------+
59 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.16 sec)

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>遇到如下错误： <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFsSNn" rel="nofollow"></a></p> 
 <figure> 
  <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFsSNn" rel="nofollow"></a> 
  <figcaption> 
   <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFsSNn" rel="nofollow"></a> 
  </figcaption> 
  <a href="https://link.juejin.im?target=https%3A%2F%2Fimgchr.com%2Fi%2FEFsSNn" rel="nofollow"></a> 
 </figure> 
 <p></p> 
 <p>修改schema.xml 文件属性<code>checkSQLschema</code>:</p> 
 <pre><code class="hljs bash copyable">&lt;schema name=<span class="hljs-string">"test"</span> checkSQLschema=<span class="hljs-string">"true"</span> sqlMaxLimit=<span class="hljs-string">"100"</span>&gt;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>遇到如下错误：</p> 
 <pre><code class="hljs bash copyable">jvm 1    | Caused by: io.mycat.config.util.ConfigException: org.xml.sax.SAXParseException; lineNumber: 97; columnNumber: 42; Attribute <span class="hljs-string">"defaultAccount"</span> must be declared <span class="hljs-keyword">for</span> element <span class="hljs-built_in">type</span> <span class="hljs-string">"user"</span>.
jvm 1    | 	at io.mycat.config.loader.xml.XMLServerLoader.load(XMLServerLoader.java:111)
jvm 1    | 	at io.mycat.config.loader.xml.XMLServerLoader.&lt;init&gt;(XMLServerLoader.java:69)
jvm 1    | 	at io.mycat.config.loader.xml.XMLConfigLoader.&lt;init&gt;(XMLConfigLoader.java:56)
jvm 1    | 	at io.mycat.config.ConfigInitializer.&lt;init&gt;(ConfigInitializer.java:77)
jvm 1    | 	at io.mycat.config.MycatConfig.&lt;init&gt;(MycatConfig.java:72)
jvm 1    | 	at io.mycat.MycatServer.&lt;init&gt;(MycatServer.java:144)
jvm 1    | 	at io.mycat.MycatServer.&lt;clinit&gt;(MycatServer.java:96)
jvm 1    | 	... 7 more
jvm 1    | Caused by: org.xml.sax.SAXParseException; lineNumber: 97; columnNumber: 42; Attribute <span class="hljs-string">"defaultAccount"</span> must be declared <span class="hljs-keyword">for</span> element <span class="hljs-built_in">type</span> <span class="hljs-string">"user"</span>.

<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>请修改server.xml 文件，将user模块的defaultAccount取消：</p> 
 <pre><code class="hljs bash copyable">&lt;user name=<span class="hljs-string">"root"</span> &gt;
	&lt;property name=<span class="hljs-string">"password"</span>&gt;123456&lt;/property&gt;
	&lt;property name=<span class="hljs-string">"schemas"</span>&gt;<span class="hljs-built_in">test</span>&lt;/property&gt;
&lt;/user&gt;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>最后放一张mycat查询结果截图：</p> 
 <p>[</p> 
 <figure> 
  <figcaption></figcaption> 
 </figure>] 
 <p></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9a8bf2c4fed77a8664d12d7a1d64ef7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">查看windows服务器远程登录日志</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f5a4d47af26f75e8c37485988702d0b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java的throws Exception</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>