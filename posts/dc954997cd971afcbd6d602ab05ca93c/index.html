<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败" />
<meta property="og:description" content="导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败 报错信息报错原因解决办法 报错信息 导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败
报错的图找不到了…
总之就是运行 sql 文件（非常大 300 多MB吧，几百万条）的时候，因为 sql 文件里的部分 sql 语句顺序不对，导致部分 sql 语句执行失败…
而执行失败后，又不能准确的定位没有成功执行的语句，就很烦
报错原因 之所以会报错是因为数据库需要以一种拓扑排序的顺序导入
就不如你建立了一个视图，但这个视图里面需要表 a 的存在，但是 sql 文件里面 sql 的顺序是创建视图的语句在前，创建表 a 的语句在后，而顺序执行的时候，就会导致有的语句执行不成功…
问了一下 gpt 为什么导出的 sql 文件的 sql 语句顺序会出问题：
SQL文件中的语句无序可能有多种原因，其中一些常见的包括：
导出工具的行为： 使用数据库导出工具时，它可能按照某种特定的规则生成SQL语句。有些导出工具可能按照表的创建顺序导出语句，而不考虑表之间的依赖关系。这可能导致生成的SQL文件是无序的。
数据库内部元数据： SQL文件的顺序可能与数据库内部元数据存储的方式有关。数据库管理系统可能以一种特定的方式保存表和其他对象的信息，导致导出的SQL语句无序。
版本控制系统： 如果SQL文件是通过版本控制系统（如Git）进行维护的，合并和提交操作可能导致语句的无序性。不同开发人员对于SQL文件的修改可能在合并时产生无序的结果。
手动编辑： 如果SQL文件是通过手动编辑而成，可能由于人为的操作而导致语句的无序。例如，开发人员可能在不同位置添加或删除语句，而没有进行整理。
无论是哪种原因，都建议在版本控制系统中保存数据库脚本，并且尽量使用数据库迁移工具来管理数据库的变更。这样可以更好地保持脚本的有序性，并简化团队协作和数据库迁移的管理。
解决办法 没有找到好的解决办法，留个坑，后续有好的解决办法会继续更新，如果各位有好的解决办法可以评论留言一下，万分感谢！！！
下面是 gpt 给出的解决办法：
这个问题的解决方案通常涉及到手动调整SQL语句的顺序，以便按照拓扑排序的方式导入数据库。拓扑排序确保在导入时不会出现引用尚未创建的表或其他依赖关系问题。
以下是一些步骤，您可以尝试手动进行拓扑排序：
分析依赖关系： 查看数据库中表之间的依赖关系。通常，外键关系是最常见的依赖关系。了解每个表的依赖关系将帮助您确定导入的顺序。
创建导入顺序： 根据依赖关系创建一个导入顺序。开始时，选择没有依赖关系的表，然后依次选择那些依赖关系已经满足的表。
手动调整SQL文件： 根据拓扑排序的顺序调整原始的database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/dc954997cd971afcbd6d602ab05ca93c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T11:04:25+08:00" />
<meta property="article:modified_time" content="2024-01-11T11:04:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">报错信息</a></li><li><a href="#_11" rel="nofollow">报错原因</a></li><li><a href="#_31" rel="nofollow">解决办法</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>报错信息</h3> 
<p>导入 sql 文件，因 sql 文件里的 sql 语句无序导致失败</p> 
<p>报错的图找不到了…</p> 
<p>总之就是运行 sql 文件（非常大 300 多MB吧，几百万条）的时候，因为 sql 文件里的部分 sql 语句顺序不对，导致部分 sql 语句执行失败…</p> 
<p>而执行失败后，又不能准确的定位没有成功执行的语句，就很烦</p> 
<h3><a id="_11"></a>报错原因</h3> 
<p>之所以会报错是因为数据库需要以一种拓扑排序的顺序导入<br> 就不如你建立了一个视图，但这个视图里面需要表 a 的存在，但是 sql 文件里面 sql 的顺序是创建视图的语句在前，创建表 a 的语句在后，而顺序执行的时候，就会导致有的语句执行不成功…</p> 
<p>问了一下 gpt 为什么导出的 sql 文件的 sql 语句顺序会出问题：</p> 
<p>SQL文件中的语句无序可能有多种原因，其中一些常见的包括：</p> 
<ol><li> <p><strong>导出工具的行为：</strong> 使用数据库导出工具时，它可能按照某种特定的规则生成SQL语句。有些导出工具可能按照表的创建顺序导出语句，而不考虑表之间的依赖关系。这可能导致生成的SQL文件是无序的。</p> </li><li> <p><strong>数据库内部元数据：</strong> SQL文件的顺序可能与数据库内部元数据存储的方式有关。数据库管理系统可能以一种特定的方式保存表和其他对象的信息，导致导出的SQL语句无序。</p> </li><li> <p><strong>版本控制系统：</strong> 如果SQL文件是通过版本控制系统（如Git）进行维护的，合并和提交操作可能导致语句的无序性。不同开发人员对于SQL文件的修改可能在合并时产生无序的结果。</p> </li><li> <p><strong>手动编辑：</strong> 如果SQL文件是通过手动编辑而成，可能由于人为的操作而导致语句的无序。例如，开发人员可能在不同位置添加或删除语句，而没有进行整理。</p> </li></ol> 
<p>无论是哪种原因，都建议在版本控制系统中保存数据库脚本，并且尽量使用数据库迁移工具来管理数据库的变更。这样可以更好地保持脚本的有序性，并简化团队协作和数据库迁移的管理。</p> 
<h3><a id="_31"></a>解决办法</h3> 
<p>没有找到好的解决办法，留个坑，后续有好的解决办法会继续更新，如果各位有好的解决办法可以评论留言一下，万分感谢！！！</p> 
<p>下面是 gpt 给出的解决办法：</p> 
<p>这个问题的解决方案通常涉及到手动调整SQL语句的顺序，以便按照拓扑排序的方式导入数据库。拓扑排序确保在导入时不会出现引用尚未创建的表或其他依赖关系问题。</p> 
<p>以下是一些步骤，您可以尝试手动进行拓扑排序：</p> 
<ol><li> <p><strong>分析依赖关系：</strong> 查看数据库中表之间的依赖关系。通常，外键关系是最常见的依赖关系。了解每个表的依赖关系将帮助您确定导入的顺序。</p> </li><li> <p><strong>创建导入顺序：</strong> 根据依赖关系创建一个导入顺序。开始时，选择没有依赖关系的表，然后依次选择那些依赖关系已经满足的表。</p> </li><li> <p><strong>手动调整SQL文件：</strong> 根据拓扑排序的顺序调整原始的database.sql文件。将表的创建语句和数据插入语句按照导入顺序重新排列。确保依赖关系链正确。</p> </li><li> <p><strong>测试导入：</strong> 在调整后的SQL文件上进行测试导入。这可以通过在一个新的数据库中运行SQL脚本来完成。确保所有表和数据都被正确导入，并且没有任何错误。</p> </li><li> <p><strong>处理特殊情况：</strong> 有时候，可能会有一些特殊情况，例如触发器、存储过程等，它们可能也具有依赖关系。确保将这些特殊情况考虑在内，以便在导入时正确处理。</p> </li></ol> 
<p>请注意，手动拓扑排序可能会变得复杂，尤其是对于大型数据库。如果手动处理不够方便，您还可以考虑使用专门的数据库迁移工具，如Flyway、Liquibase等，它们可以自动处理数据库迁移和依赖关系。这些工具通常允许您以声明性的方式定义数据库变更，并自动处理正确的导入顺序。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f997ec7b18b7f7dd21f395f4088feb1a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Every derived table must have its own alias</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b269264356c941bf941453b2d897b30b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot Starter介绍和实战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>