<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>arduino项目中应用到的 esp32 cam 网络图传&#43;继电器&#43;mqtt远程控制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="arduino项目中应用到的 esp32 cam 网络图传&#43;继电器&#43;mqtt远程控制" />
<meta property="og:description" content="Arduino ESP32-CAM是一款功能强大的开发板，它集成了ESP32和摄像头模块，非常适合用于物联网应用中。在本文中，我们将介绍如何使用ESP32-CAM实现网络图传、继电器控制和MQTT远程控制。
硬件准备
首先，我们需要准备以下硬件：
Arduino ESP32-CAM开发板 USB串口线 路由器 继电器模块 LED灯 杜邦线若干 软件准备
接下来，我们需要安装以下软件：
Arduino IDE ESP32-CAM插件 MQTT库 项目中应用
网络图传
ESP32-CAM默认使用WiFi连接网络，我们可以使用WiFi图传库将摄像头拍摄的图像传输到网络上。首先，在Arduino IDE中打开一个新的空白项目，然后依次点击“工具”-&gt;“开发板”-&gt;“ESP32 Wrover Module”，选择正确的端口和上传速度。接下来，下载并安装WiFi图传库。
在代码中，我们需要定义WiFi热点的名称和密码，然后调用WiFi图传库中的函数来连接网络。为了实现图传功能，我们还需要调用摄像头库拍摄照片，然后使用HTTP协议将图像传输到指定的URL上。
代码示例：
#include &#34;WiFi.h&#34; #include &#34;WiFiClient.h&#34; #include &#34;WiFiServer.h&#34; #include &#34;WiFiUdp.h&#34; #include &#34;esp_camera.h&#34; #include &#34;esp_http_server.h&#34; #include &#34;img_converters.h&#34; #include &#34;fb_gfx.h&#34; #include &#34;fd_forward.h&#34; #include &#34;fr_forward.h&#34; #include &#34;app_httpd.h&#34; const char *ssid = &#34;your_wifi_ssid&#34;; const char *password = &#34;your_wifi_password&#34;; WiFiServer server(80); void setup() { Serial.begin(115200); WiFi.begin(ssid, password); while (WiFi.status() != WL_CONNECTED) { delay(1000); Serial." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f9bfd2a2d46070998248745d15435953/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T19:23:11+08:00" />
<meta property="article:modified_time" content="2023-06-14T19:23:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">arduino项目中应用到的 esp32 cam 网络图传&#43;继电器&#43;mqtt远程控制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Arduino ESP32-CAM是一款功能强大的开发板，它集成了ESP32和摄像头模块，非常适合用于物联网应用中。在本文中，我们将介绍如何使用ESP32-CAM实现网络图传、继电器控制和MQTT远程控制。</p> 
<p><strong>硬件准备</strong><br> 首先，我们需要准备以下硬件：</p> 
<pre><code>Arduino ESP32-CAM开发板
USB串口线
路由器
继电器模块
LED灯
杜邦线若干
</code></pre> 
<p><strong>软件准备</strong><br> 接下来，我们需要安装以下软件：</p> 
<pre><code>Arduino IDE
ESP32-CAM插件
MQTT库
</code></pre> 
<p>项目中应用</p> 
<p><img src="https://images2.imgbox.com/03/bd/07imTBmd_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/a5/ZwVNJ9Cj_o.jpg" alt="在这里插入图片描述"></p> 
<p><strong>网络图传</strong></p> 
<p>ESP32-CAM默认使用WiFi连接网络，我们可以使用WiFi图传库将摄像头拍摄的图像传输到网络上。首先，在Arduino IDE中打开一个新的空白项目，然后依次点击“工具”-&gt;“开发板”-&gt;“ESP32 Wrover Module”，选择正确的端口和上传速度。接下来，下载并安装WiFi图传库。</p> 
<p>在代码中，我们需要定义WiFi热点的名称和密码，然后调用WiFi图传库中的函数来连接网络。为了实现图传功能，我们还需要调用摄像头库拍摄照片，然后使用HTTP协议将图像传输到指定的URL上。</p> 
<p>代码示例：</p> 
<pre><code class="prism language-bash"><span class="token comment">#include "WiFi.h"</span>
<span class="token comment">#include "WiFiClient.h"</span>
<span class="token comment">#include "WiFiServer.h"</span>
<span class="token comment">#include "WiFiUdp.h"</span>
<span class="token comment">#include "esp_camera.h"</span>
<span class="token comment">#include "esp_http_server.h"</span>
<span class="token comment">#include "img_converters.h"</span>
<span class="token comment">#include "fb_gfx.h"</span>
<span class="token comment">#include "fd_forward.h"</span>
<span class="token comment">#include "fr_forward.h"</span>
<span class="token comment">#include "app_httpd.h"</span>

const char *ssid <span class="token operator">=</span> <span class="token string">"your_wifi_ssid"</span><span class="token punctuation">;</span>
const char *password <span class="token operator">=</span> <span class="token string">"your_wifi_password"</span><span class="token punctuation">;</span>

WiFiServer server<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

void <span class="token function-name function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
Serial.begin<span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WiFi.begin<span class="token punctuation">(</span>ssid, password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>WiFi.status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
delay<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connecting to WiFi..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connected to WiFi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span>WiFi.localIP<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
server.begin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void <span class="token function-name function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
WiFiClient client <span class="token operator">=</span> server.available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Client connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String response <span class="token operator">=</span> <span class="token string">"HTTP/1.1 200 OK<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span>
response <span class="token operator">+=</span> <span class="token string">"Content-Type: image/jpeg<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span>
response <span class="token operator">+=</span> <span class="token string">"Connection: close<span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span>
client.print<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera_fb_t *fb <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
fb <span class="token operator">=</span> esp_camera_fb_get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fb<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Camera capture failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
client.write<span class="token punctuation">(</span>fb-<span class="token operator">&gt;</span>buf, fb-<span class="token operator">&gt;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
esp_camera_fb_return<span class="token punctuation">(</span>fb<span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Image sent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>继电器控制</strong><br> ESP32-CAM还可以控制继电器模块，从而实现对家电等设备的远程控制。我们可以使用Arduino IDE中的GPIO控制库来实现这个功能。首先，将继电器模块的VCC连接到ESP32-CAM的5V引脚，GND连接到GND引脚，IN连接到GPIO 4引脚。然后，我们需要在代码中定义继电器的GPIO引脚，并使用digitalWrite函数将其设置为高电平或低电平，以控制继电器的开关状态。<br> 代码示例：</p> 
<pre><code class="prism language-bash"><span class="token comment">#define RELAY_PIN 4</span>

void <span class="token function-name function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
pinMode<span class="token punctuation">(</span>RELAY_PIN, OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void <span class="token function-name function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
digitalWrite<span class="token punctuation">(</span>RELAY_PIN, HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
delay<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
digitalWrite<span class="token punctuation">(</span>RELAY_PIN, LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
delay<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>MQTT远程控制</strong><br> 最后，我们可以使用MQTT协议实现远程控制功能。MQTT是一种轻量级的消息传输协议，非常适合用于物联网设备之间的通信。我们可以使用PubSubClient库来实现ESP32-CAM与MQTT服务器之间的通信。</p> 
<p>在代码中，我们需要定义MQTT服务器的IP地址和端口号，然后连接到MQTT服务器。接下来，我们需要订阅指定的主题，并在回调函数中处理接收到的消息。最后，我们可以使用publish函数将消息发送到指定的主题上。</p> 
<pre><code class="prism language-bash"><span class="token comment">#include &lt;WiFi.h&gt;</span>
<span class="token comment">#include &lt;PubSubClient.h&gt;</span>

const char* ssid <span class="token operator">=</span> <span class="token string">"your_wifi_ssid"</span><span class="token punctuation">;</span>
const char* password <span class="token operator">=</span> <span class="token string">"your_wifi_password"</span><span class="token punctuation">;</span>
const char* mqtt_server <span class="token operator">=</span> <span class="token string">"your_mqtt_server_ip_address"</span><span class="token punctuation">;</span>
const char* mqtt_topic <span class="token operator">=</span> <span class="token string">"your_mqtt_topic"</span><span class="token punctuation">;</span>

WiFiClient espClient<span class="token punctuation">;</span>
PubSubClient client<span class="token punctuation">(</span>espClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

void <span class="token function-name function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
pinMode<span class="token punctuation">(</span>LED_BUILTIN, OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.begin<span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WiFi.begin<span class="token punctuation">(</span>ssid, password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>WiFi.status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
delay<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connecting to WiFi..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connected to WiFi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span>WiFi.localIP<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
client.setServer<span class="token punctuation">(</span>mqtt_server, <span class="token number">1883</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client.setCallback<span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void <span class="token function-name function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>client.connected<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
reconnect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
client.loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void callback<span class="token punctuation">(</span>char* topic, byte* payload, unsigned int length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Message received"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String message <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
message <span class="token operator">+=</span> <span class="token punctuation">(</span>char<span class="token punctuation">)</span>payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token string">"on"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
digitalWrite<span class="token punctuation">(</span>LED_BUILTIN, HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token string">"off"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
digitalWrite<span class="token punctuation">(</span>LED_BUILTIN, LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

void <span class="token function-name function">reconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>client.connected<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connecting to MQTT server..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>client.connect<span class="token punctuation">(</span><span class="token string">"ESP32-CAM"</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
Serial.println<span class="token punctuation">(</span><span class="token string">"Connected to MQTT server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client.subscribe<span class="token punctuation">(</span>mqtt_topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
Serial.print<span class="token punctuation">(</span><span class="token string">"Failed to connect to MQTT server, rc="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial.print<span class="token punctuation">(</span>client.state<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
Serial.println<span class="token punctuation">(</span><span class="token string">" retrying in 5 seconds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
delay<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>总结</strong><br> 本文介绍了如何使用Arduino ESP32-CAM实现网络图传、继电器控制和MQTT远程控制。这三个功能可以相互配合，实现更加复杂的物联网应用。希望本文能够帮助到大家，谢谢阅读！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a10169672a74a025a10493415bfcf8da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ChineseBERT使用指北</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1514d716c608e4bf722947cdff328894/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">原生小程序 微信小程序 使用ucharts</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>