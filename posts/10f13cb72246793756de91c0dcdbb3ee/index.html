<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>elasticsearch-aggs-top_hits，分组查询，并返回每组数据中特定排序的源数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="elasticsearch-aggs-top_hits，分组查询，并返回每组数据中特定排序的源数据" />
<meta property="og:description" content="对数据分组并返回分组中特定排序的多少个
Top Hits Aggregation top_hits指标聚合器跟踪正在聚合的最相关文档。 此聚合器旨在用作子聚合器，以便可以按桶聚合最匹配的文档。top_hits聚合器可以有效地用于通过桶聚合器按特定字段对结果集进行分组。 一个或多个存储桶聚合器确定结果集被切入的属性。 选项 from - 要获取的第一个结果的偏移量。size - 每个桶返回的最大匹配匹配数的最大数量。默认情况下，返回前三个匹配的匹配。sort - 如何对最匹配的匹配进行排序。默认情况下，命中按主查询的分数排序。 例子 请求： GET ztjy-growth-info-alpha_*/_search {&#34;query&#34;: { &#34;match&#34;: { &#34;schoolId&#34;: &#34;uOdq9KBA7xYpbmvC4Bf&#34; } }, &#34;size&#34;: 0, &#34;aggs&#34;: { &#34;userId111&#34;: { &#34;terms&#34;: { &#34;field&#34;: &#34;userId&#34;, &#34;size&#34;: 10 }, &#34;aggs&#34;: { &#34;publishTime111&#34;: { &#34;top_hits&#34;: { &#34;sort&#34;: [ { &#34;publishTime&#34;: { &#34;order&#34;: &#34;desc&#34; } } ], &#34;size&#34;: 1, &#34;_source&#34;: { &#34;includes&#34;: [&#34;publishTime&#34;,&#34;feedId&#34;] } } } } } } } 结果 { &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/10f13cb72246793756de91c0dcdbb3ee/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-30T17:25:34+08:00" />
<meta property="article:modified_time" content="2020-07-30T17:25:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">elasticsearch-aggs-top_hits，分组查询，并返回每组数据中特定排序的源数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>对数据分组并返回分组中特定排序的多少个</p> 
</blockquote> 
<h4><a id="Top_Hits_Aggregation_2"></a>Top Hits Aggregation</h4> 
<ul><li>top_hits指标聚合器跟踪正在聚合的最相关文档。 此聚合器旨在用作子聚合器，以便可以按桶聚合最匹配的文档。</li><li>top_hits聚合器可以有效地用于通过桶聚合器按特定字段对结果集进行分组。 一个或多个存储桶聚合器确定结果集被切入的属性。</li></ul> 
<h4><a id="_5"></a>选项</h4> 
<ul><li>from - 要获取的第一个结果的偏移量。</li><li>size - 每个桶返回的最大匹配匹配数的最大数量。默认情况下，返回前三个匹配的匹配。</li><li>sort - 如何对最匹配的匹配进行排序。默认情况下，命中按主查询的分数排序。</li></ul> 
<h4><a id="_9"></a>例子</h4> 
<h5><a id="_10"></a>请求：</h5> 
<pre><code class="prism language-bash">GET ztjy-growth-info-alpha_*/_search
<span class="token punctuation">{<!-- --></span><span class="token string">"query"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"match"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"schoolId"</span><span class="token keyword">:</span> <span class="token string">"uOdq9KBA7xYpbmvC4Bf"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>, 
  <span class="token string">"size"</span><span class="token keyword">:</span> 0,
  <span class="token string">"aggs"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"userId111"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token keyword">:</span> <span class="token string">"userId"</span>,
        <span class="token string">"size"</span><span class="token keyword">:</span> 10 
      <span class="token punctuation">}</span>, 
      <span class="token string">"aggs"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"publishTime111"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"top_hits"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"sort"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"publishTime"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"order"</span><span class="token keyword">:</span> <span class="token string">"desc"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"size"</span><span class="token keyword">:</span> 1,
             <span class="token string">"_source"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"includes"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">"publishTime"</span>,<span class="token string">"feedId"</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_46"></a>结果</h5> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"took"</span><span class="token keyword">:</span> 17,
  <span class="token string">"timed_out"</span><span class="token keyword">:</span> false,
  <span class="token string">"_shards"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"total"</span><span class="token keyword">:</span> 20,
    <span class="token string">"successful"</span><span class="token keyword">:</span> 20,
    <span class="token string">"skipped"</span><span class="token keyword">:</span> 0,
    <span class="token string">"failed"</span><span class="token keyword">:</span> 0
  <span class="token punctuation">}</span>,
  <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"total"</span><span class="token keyword">:</span> 555,
    <span class="token string">"max_score"</span><span class="token keyword">:</span> 0,
    <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"aggregations"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"userId111"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"doc_count_error_upper_bound"</span><span class="token keyword">:</span> 6,
      <span class="token string">"sum_other_doc_count"</span><span class="token keyword">:</span> 187,
      <span class="token string">"buckets"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"key"</span><span class="token keyword">:</span> <span class="token string">"9d43450b8d9d4ce06a10"</span>,
          <span class="token string">"doc_count"</span><span class="token keyword">:</span> 307,
          <span class="token string">"publishTime111"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"total"</span><span class="token keyword">:</span> 307,
              <span class="token string">"max_score"</span><span class="token keyword">:</span> null,
              <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"_index"</span><span class="token keyword">:</span> <span class="token string">"ztjy-growth-info-alpha_2"</span>,
                  <span class="token string">"_type"</span><span class="token keyword">:</span> <span class="token string">"growth_feed_info"</span>,
                  <span class="token string">"_id"</span><span class="token keyword">:</span> <span class="token string">"10-1494489"</span>,
                  <span class="token string">"_score"</span><span class="token keyword">:</span> null,
                  <span class="token string">"_source"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"publishTime"</span><span class="token keyword">:</span> 1575862793007,
                    <span class="token string">"feedId"</span><span class="token keyword">:</span> 1174312823360864300
                  <span class="token punctuation">}</span>,
                  <span class="token string">"sort"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                    1575862793007
                  <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"key"</span><span class="token keyword">:</span> <span class="token string">"49f5874d546638f306c9"</span>,
          <span class="token string">"doc_count"</span><span class="token keyword">:</span> 61,
          <span class="token string">"publishTime111"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"total"</span><span class="token keyword">:</span> 61,
              <span class="token string">"max_score"</span><span class="token keyword">:</span> null,
              <span class="token string">"hits"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"_index"</span><span class="token keyword">:</span> <span class="token string">"ztjy-growth-info-alpha_2"</span>,
                  <span class="token string">"_type"</span><span class="token keyword">:</span> <span class="token string">"growth_feed_info"</span>,
                  <span class="token string">"_id"</span><span class="token keyword">:</span> <span class="token string">"24-1440124"</span>,
                  <span class="token string">"_score"</span><span class="token keyword">:</span> null,
                  <span class="token string">"_source"</span><span class="token keyword">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"publishTime"</span><span class="token keyword">:</span> 1572959152208,
                    <span class="token string">"feedId"</span><span class="token keyword">:</span> 1162134068869742600
                  <span class="token punctuation">}</span>,
                  <span class="token string">"sort"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                    1572959152208
                  <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa7e6812bed5b5a552bbc4f959810a6c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">详解深度神经网络中常见的梯度消失和梯度爆炸及其具体的解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7667261e24731eb214826ce0b2fd22f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">3.1 SQL是什么？它能做什么</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>