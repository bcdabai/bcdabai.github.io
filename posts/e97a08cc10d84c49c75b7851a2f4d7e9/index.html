<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mycat分库分表中间件介绍，有案例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mycat分库分表中间件介绍，有案例" />
<meta property="og:description" content="目录 MyCat分库分表概述水平拆分和垂直拆分安装JDK安装MyCat安装 MyCat案例1、创建数据库2、分片配置（schema.xml）3、分片配置（server.xml）4、启动服务5、查看日志，看是否启动成功6、登录MyCat7、查看数据库和表8、创建表结构并且插入数据9、查看数据分布 MyCat配置schema.xmlschema标签table标签dataNode标签dataHost标签 rule.xmlserver.xmlsystem标签user标签 MyCat原理MyCat管理 MyCat分库分表 概述 Mycat是一个开源的分布式数据库中间件，它可以将多个MySQL服务器组合成一个逻辑数据库集群，提供高可用、高并发、分片等功能。Mycat在MySQL协议层上实现了Sharding和读写分离等功能，可以将数据水平拆分到多个MySQL服务器上，从而提高数据库的性能和可用性，结构图如下。
水平拆分和垂直拆分 垂直拆分是指将一个大的数据库按照业务功能进行拆分，将不同的表放在不同的数据库中，从而实现数据库的分离。垂直拆分可以提高数据库的可维护性和可扩展性，但是需要重新设计数据库结构，增加了开发和维护的难度。
水平拆分是指将一个大的数据库按照数据行进行拆分，将不同的数据行存储在不同的数据库中，从而实现数据库的分布式存储和访问。水平拆分可以提高数据库的并发能力和可扩展性，但是需要考虑数据一致性和分片规则等问题。
安装 下载
http://www.mycat.org.cn/mycat1.html MyCat采用java语言开发的开源的数据库中间件，支持windows和linux运行环境，因此安装需要的软件有MySQL、JDK、MyCat。
规划如下
服务器安装软件说明192.168.40.137JDK、MyCat、MySQLMyCat中间服务器192.168.40.138MySQL分片服务器192.168.40.150MySQL分片服务器 JDK安装 JDK具体安装步骤如下：
上传安装包 [root@mysql-master ~]# ls anaconda-ks.cfg Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz mysql jdk-8u171-linux-x64.tar.gz onekey-install-nginx.sh 解压安装包 执行如下指令，将上传上来的压缩包进行解压，并通过-C参数指定解压文件存放目录为 /usr/local。
[root@mysql-master ~]# tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local 配置环境变量 使用vim命令修改/etc/profile文件，在文件末尾加入如下配置
JAVA_HOME=/usr/local/jdk1.8.0_171 PATH=$JAVA_HOME/bin:$PATH 具体操作指令如下:
1). 编辑/etc/profile文件，进入命令模式 vim /etc/profile 2). 在命令模式中，输入指令 G ， 切换到文件最后 G 3). 在命令模式中输入 i/a/o 进入插入模式，然后切换到文件最后一行 i 4). 将上述的配置拷贝到文件中 export JAVA_HOME=/usr/local/jdk1.8.0_171 export PATH=$JAVA_HOME/bin:$PATH 5). 从插入模式，切换到指令模式 ESC 6). 按:进入底行模式，然后输入wq，回车保存 :wq 重新加载profile文件 为了使更改的配置立即生效，需要重新加载profile文件，执行命令:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e97a08cc10d84c49c75b7851a2f4d7e9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-08T13:38:19+08:00" />
<meta property="article:modified_time" content="2023-06-08T13:38:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mycat分库分表中间件介绍，有案例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#MyCat_2" rel="nofollow">MyCat分库分表</a></li><li><ul><li><a href="#_4" rel="nofollow">概述</a></li><li><a href="#_11" rel="nofollow">水平拆分和垂直拆分</a></li><li><a href="#_22" rel="nofollow">安装</a></li><li><ul><li><a href="#JDK_43" rel="nofollow">JDK安装</a></li><li><a href="#MyCat_113" rel="nofollow">MyCat安装</a></li></ul> 
   </li><li><a href="#MyCat_141" rel="nofollow">MyCat案例</a></li><li><ul><li><a href="#1_151" rel="nofollow">1、创建数据库</a></li><li><a href="#2schemaxml_174" rel="nofollow">2、分片配置（schema.xml）</a></li><li><a href="#3serverxml_219" rel="nofollow">3、分片配置（server.xml）</a></li><li><a href="#4_226" rel="nofollow">4、启动服务</a></li><li><a href="#5_238" rel="nofollow">5、查看日志，看是否启动成功</a></li><li><a href="#6MyCat_247" rel="nofollow">6、登录MyCat</a></li><li><a href="#7_267" rel="nofollow">7、查看数据库和表</a></li><li><a href="#8_294" rel="nofollow">8、创建表结构并且插入数据</a></li><li><a href="#9_335" rel="nofollow">9、查看数据分布</a></li></ul> 
   </li><li><a href="#MyCat_343" rel="nofollow">MyCat配置</a></li><li><ul><li><a href="#schemaxml_345" rel="nofollow">schema.xml</a></li><li><ul><li><a href="#schema_347" rel="nofollow">schema标签</a></li><li><a href="#table_361" rel="nofollow">table标签</a></li><li><a href="#dataNode_371" rel="nofollow">dataNode标签</a></li><li><a href="#dataHost_385" rel="nofollow">dataHost标签</a></li></ul> 
    </li><li><a href="#rulexml_407" rel="nofollow">rule.xml</a></li><li><a href="#serverxml_421" rel="nofollow">server.xml</a></li><li><ul><li><a href="#system_425" rel="nofollow">system标签</a></li><li><a href="#user_483" rel="nofollow">user标签</a></li></ul> 
   </li></ul> 
   </li><li><a href="#MyCat_490" rel="nofollow">MyCat原理</a></li><li><ul><li><a href="#MyCat_496" rel="nofollow">MyCat管理</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="MyCat_2"></a>MyCat分库分表</h2> 
<h3><a id="_4"></a>概述</h3> 
<p>        Mycat是一个开源的分布式数据库中间件，它可以将多个MySQL服务器组合成一个逻辑数据库集群，提供高可用、高并发、分片等功能。Mycat在MySQL协议层上实现了Sharding和读写分离等功能，可以将数据水平拆分到多个MySQL服务器上，从而提高数据库的性能和可用性，结构图如下。</p> 
<p><img src="https://images2.imgbox.com/25/71/0JyBrCGY_o.png" alt=""></p> 
<h3><a id="_11"></a>水平拆分和垂直拆分</h3> 
<p>        <strong>垂直拆分</strong>是指将一个大的数据库按照业务功能进行拆分，将不同的表放在不同的数据库中，从而实现数据库的分离。垂直拆分可以提高数据库的可维护性和可扩展性，但是需要重新设计数据库结构，增加了开发和维护的难度。</p> 
<p><img src="https://images2.imgbox.com/92/92/EesMEPBY_o.png" alt="在这里插入图片描述"></p> 
<p>        <strong>水平拆分</strong>是指将一个大的数据库按照数据行进行拆分，将不同的数据行存储在不同的数据库中，从而实现数据库的分布式存储和访问。水平拆分可以提高数据库的并发能力和可扩展性，但是需要考虑数据一致性和分片规则等问题。<br> <img src="https://images2.imgbox.com/8e/7a/Te57zpDM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_22"></a>安装</h3> 
<p>下载</p> 
<pre><code>http://www.mycat.org.cn/mycat1.html
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/40/vvvDpI8Q_o.png" alt="在这里插入图片描述"></p> 
<p>        MyCat采用java语言开发的开源的数据库中间件，支持windows和linux运行环境，因此安装需要的软件有MySQL、JDK、MyCat。</p> 
<p>规划如下</p> 
<table><thead><tr><th>服务器</th><th>安装软件</th><th>说明</th></tr></thead><tbody><tr><td>192.168.40.137</td><td>JDK、MyCat、MySQL</td><td>MyCat中间服务器</td></tr><tr><td>192.168.40.138</td><td>MySQL</td><td>分片服务器</td></tr><tr><td>192.168.40.150</td><td>MySQL</td><td>分片服务器</td></tr></tbody></table> 
<h4><a id="JDK_43"></a>JDK安装</h4> 
<p>JDK具体安装步骤如下：</p> 
<ol><li>上传安装包</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda-ks.cfg             Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz     mysql
jdk-8u171-linux-x64.tar.gz  onekey-install-nginx.sh
</code></pre> 
<ol start="2"><li>解压安装包</li></ol> 
<p>执行如下指令，将上传上来的压缩包进行解压，并通过-C参数指定解压文件存放目录为 /usr/local。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master ~<span class="token punctuation">]</span><span class="token comment"># tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local</span>
</code></pre> 
<ol start="3"><li>配置环境变量</li></ol> 
<p>使用vim命令修改/etc/profile文件，在文件末尾加入如下配置</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk1.8.0_171
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre> 
<p>具体操作指令如下:</p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token punctuation">)</span>. 编辑/etc/profile文件，进入命令模式
	<span class="token function">vim</span> /etc/profile

<span class="token number">2</span><span class="token punctuation">)</span>. 在命令模式中，输入指令 G ， 切换到文件最后
	G

<span class="token number">3</span><span class="token punctuation">)</span>. 在命令模式中输入 i/a/o 进入插入模式，然后切换到文件最后一行
	i

<span class="token number">4</span><span class="token punctuation">)</span>. 将上述的配置拷贝到文件中
	<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk1.8.0_171
	<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
	
<span class="token number">5</span><span class="token punctuation">)</span>. 从插入模式，切换到指令模式
	ESC
	
<span class="token number">6</span><span class="token punctuation">)</span>. 按:进入底行模式，然后输入wq，回车保存
	:wq
</code></pre> 
<ol start="4"><li>重新加载profile文件</li></ol> 
<p>为了使更改的配置立即生效，需要重新加载profile文件，执行命令:</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master local<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
</code></pre> 
<ol start="5"><li>检查安装是否成功</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master local<span class="token punctuation">]</span><span class="token comment"># java -version</span>
<span class="token punctuation">[</span>root@mysql-master local<span class="token punctuation">]</span><span class="token comment"># java</span>
<span class="token punctuation">[</span>root@mysql-master local<span class="token punctuation">]</span><span class="token comment"># javac</span>
</code></pre> 
<p>都能显示信息则成功</p> 
<h4><a id="MyCat_113"></a>MyCat安装</h4> 
<ol><li> <p>上传Mycat压缩包到服务器</p> </li><li> <p>解压MyCat的压缩包</p> </li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master ~<span class="token punctuation">]</span><span class="token comment"># tar -zxvf Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz -C /usr/local/</span>
</code></pre> 
<p>3.进入jar包目录，发现mysql驱动包的版本为5.1，进行替换</p> 
<p><img src="https://images2.imgbox.com/22/84/TvayCM91_o.png" alt="在这里插入图片描述"></p> 
<p>4.替换后发现权限不对，修改权限<br> <img src="https://images2.imgbox.com/14/e7/AANzeBNC_o.png" alt=""><br> 5.修改权限</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master lib<span class="token punctuation">]</span><span class="token comment"># chmod 777 mysql-connector-java-8.0.22.jar</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/82/38/aU1xSW1x_o.png" alt="在这里插入图片描述"></p> 
<p>安装完成</p> 
<h3><a id="MyCat_141"></a>MyCat案例</h3> 
<p>根据之间的规划如下</p> 
<table><thead><tr><th>服务器</th><th>安装软件</th><th>说明</th></tr></thead><tbody><tr><td>192.168.40.137</td><td>JDK、MyCat、MySQL</td><td>MyCat中间服务器</td></tr><tr><td>192.168.40.138</td><td>MySQL</td><td>分片服务器</td></tr><tr><td>192.168.40.150</td><td>MySQL</td><td>分片服务器</td></tr></tbody></table> 
<h4><a id="1_151"></a>1、创建数据库</h4> 
<p>三台服务器都创建一个db1的数据库，在此之前先关闭防火墙，创建完之后先不需要对该库进行任何操作，所有的操作都在MyCat所在的服务器上进行。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">database</span> db1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Database</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> db1                <span class="token operator">|</span>
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2schemaxml_174"></a>2、分片配置（schema.xml）</h4> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span>root<span class="token variable">@mysql</span><span class="token operator">-</span>master conf<span class="token punctuation">]</span><span class="token comment"># pwd</span>
<span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>mycat<span class="token operator">/</span>conf
<span class="token punctuation">[</span>root<span class="token variable">@mysql</span><span class="token operator">-</span>master conf<span class="token punctuation">]</span><span class="token comment"># cat schema.xml</span>
<span class="token operator">&lt;</span>?xml version<span class="token operator">=</span><span class="token string">"1.0"</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mycat:<span class="token keyword">schema</span> SYSTEM <span class="token string">"schema.dtd"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mycat:<span class="token keyword">schema</span> xmlns:mycat<span class="token operator">=</span><span class="token string">"http://io.mycat/"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">schema</span> name<span class="token operator">=</span><span class="token string">"DB01"</span> checkSQLschema<span class="token operator">=</span><span class="token string">"true"</span> sqlMaxLimit<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token keyword">table</span> name<span class="token operator">=</span><span class="token string">"orders"</span> dataNode<span class="token operator">=</span><span class="token string">"dn1,dn2,dn3"</span> <span class="token keyword">rule</span><span class="token operator">=</span><span class="token string">"auto-sharding-long"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">schema</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn1"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost1"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn2"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost2"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn3"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost3"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataHost name<span class="token operator">=</span><span class="token string">"dhost1"</span> maxCon<span class="token operator">=</span><span class="token string">"1000"</span> minCon<span class="token operator">=</span><span class="token string">"10"</span> balance<span class="token operator">=</span><span class="token string">"0"</span>
                          writeType<span class="token operator">=</span><span class="token string">"0"</span> dbType<span class="token operator">=</span><span class="token string">"mysql"</span> dbDriver<span class="token operator">=</span><span class="token string">"jdbc"</span> switchType<span class="token operator">=</span><span class="token string">"1"</span>  slaveThreshold<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>heartbeat<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>heartbeat<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>writeHost host<span class="token operator">=</span><span class="token string">"hostM1"</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://192.168.40.137:3306?useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;amp;characterEncoding=utf8"</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">"root"</span>
                                   password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>writeHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dataHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataHost name<span class="token operator">=</span><span class="token string">"dhost2"</span> maxCon<span class="token operator">=</span><span class="token string">"1000"</span> minCon<span class="token operator">=</span><span class="token string">"10"</span> balance<span class="token operator">=</span><span class="token string">"0"</span>
                          writeType<span class="token operator">=</span><span class="token string">"0"</span> dbType<span class="token operator">=</span><span class="token string">"mysql"</span> dbDriver<span class="token operator">=</span><span class="token string">"jdbc"</span> switchType<span class="token operator">=</span><span class="token string">"1"</span>  slaveThreshold<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>heartbeat<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>heartbeat<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>writeHost host<span class="token operator">=</span><span class="token string">"hostM1"</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://192.168.40.138:3306?useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;amp;characterEncoding=utf8"</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">"root"</span>
                                   password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>writeHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dataHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataHost name<span class="token operator">=</span><span class="token string">"dhost3"</span> maxCon<span class="token operator">=</span><span class="token string">"1000"</span> minCon<span class="token operator">=</span><span class="token string">"10"</span> balance<span class="token operator">=</span><span class="token string">"0"</span>
                          writeType<span class="token operator">=</span><span class="token string">"0"</span> dbType<span class="token operator">=</span><span class="token string">"mysql"</span> dbDriver<span class="token operator">=</span><span class="token string">"jdbc"</span> switchType<span class="token operator">=</span><span class="token string">"1"</span>  slaveThreshold<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>heartbeat<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>heartbeat<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>writeHost host<span class="token operator">=</span><span class="token string">"hostM1"</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://192.168.40.139:3306?useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;amp;characterEncoding=utf8"</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">"root"</span>
                                   password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>writeHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dataHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>mycat:<span class="token keyword">schema</span><span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/47/9f/oCsumeFS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3serverxml_219"></a>3、分片配置（server.xml）</h4> 
<p>配置mycat的用户和用户的权限信息<br> <img src="https://images2.imgbox.com/47/4e/chbLY4IB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_226"></a>4、启动服务</h4> 
<p>切换到MyCat的安装目录，执行如下指令，启动MyCat</p> 
<pre><code class="prism language-sql"><span class="token comment"># 启动 占用端口8066</span>
<span class="token punctuation">[</span>root<span class="token variable">@mysql</span><span class="token operator">-</span>master mycat<span class="token punctuation">]</span><span class="token comment"># bin/mycat start</span>
<span class="token keyword">Starting</span> Mycat<span class="token operator">-</span>server<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># 停止</span>
bin<span class="token operator">/</span>mycat stop
</code></pre> 
<h4><a id="5_238"></a>5、查看日志，看是否启动成功</h4> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master logs<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/usr/local/mycat/logs
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/21/x4cNf4pR_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6MyCat_247"></a>6、登录MyCat</h4> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master mycat<span class="token punctuation">]</span><span class="token comment"># mysql -h 192.168.40.137 -P 8066 -u root -p</span>
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">2</span>
Server version: <span class="token number">5.6</span>.29-mycat-1.6.7.3-release-20210913163959 MyCat Server <span class="token punctuation">(</span>OpenCloudDB<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2023</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> 
</code></pre> 
<h4><a id="7_267"></a>7、查看数据库和表</h4> 
<p>发现只有一个逻辑数据库和一个逻辑表，并没有真实存在</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token keyword">DATABASE</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> DB01     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> DB01<span class="token punctuation">;</span>
Reading <span class="token keyword">table</span> information <span class="token keyword">for</span> completion <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token operator">and</span> <span class="token keyword">column</span> names
You can turn <span class="token keyword">off</span> this feature <span class="token keyword">to</span> get a quicker startup <span class="token keyword">with</span> <span class="token operator">-</span>A

<span class="token keyword">Database</span> changed
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> <span class="token keyword">Tables</span> <span class="token operator">in</span> DB01 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> orders         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="8_294"></a>8、创建表结构并且插入数据</h4> 
<p><mark>在这之前，要为每一个mysql服务器（不是MyCat服务器）设置远程连接的功能，不然会提示错误，无法创建表结构，执行如下命令</mark></p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'root'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>创建表结构</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   product_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   quantity <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   order_date <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>   <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.07</span> sec<span class="token punctuation">)</span>
 OK<span class="token operator">!</span>
</code></pre> 
<p>插入数据，因为用分片规则是auto-sharding-long，所以可以设置不同大小的id数据插入。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders <span class="token punctuation">(</span>id<span class="token punctuation">,</span> product_name<span class="token punctuation">,</span> price<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> order_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Product 1'</span><span class="token punctuation">,</span> <span class="token number">10.50</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'2023-06-06'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Product 2'</span><span class="token punctuation">,</span> <span class="token number">25.00</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2023-06-05'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Product 3'</span><span class="token punctuation">,</span> <span class="token number">15.75</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'2023-06-04'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">5000001</span><span class="token punctuation">,</span> <span class="token string">'Product 4'</span><span class="token punctuation">,</span> <span class="token number">5.99</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'2023-06-03'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">5000002</span><span class="token punctuation">,</span> <span class="token string">'Product 5'</span><span class="token punctuation">,</span> <span class="token number">5.99</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'2023-06-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">10000003</span><span class="token punctuation">,</span> <span class="token string">'Product 6'</span><span class="token punctuation">,</span> <span class="token number">5.99</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'2023-05-03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
 OK<span class="token operator">!</span>
</code></pre> 
<h4><a id="9_335"></a>9、查看数据分布</h4> 
<p><img src="https://images2.imgbox.com/78/e2/dZEDDR4h_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/51/15/kQ5XgSM2_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/cc/7c/N9QQrYe4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="MyCat_343"></a>MyCat配置</h3> 
<h4><a id="schemaxml_345"></a>schema.xml</h4> 
<h5><a id="schema_347"></a>schema标签</h5> 
<pre><code class="prism language-sql">  <span class="token operator">&lt;</span><span class="token keyword">schema</span> name<span class="token operator">=</span><span class="token string">"DB01"</span> checkSQLschema<span class="token operator">=</span><span class="token string">"true"</span> sqlMaxLimit<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token keyword">table</span> name<span class="token operator">=</span><span class="token string">"orders"</span> dataNode<span class="token operator">=</span><span class="token string">"dn1,dn2,dn3"</span> <span class="token keyword">rule</span><span class="token operator">=</span><span class="token string">"auto-sharding-long"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">schema</span><span class="token operator">&gt;</span>
</code></pre> 
<p>        schema标签用于定义MyCat实例中的数据库，一个MyCat实例中可以有多个逻辑库，可以通过schmea标签来划分不同的逻辑库。MyCat中的逻辑库的概念，等同于MySQL中的database概念，需要操作某个逻辑库下的表时，也需要切换逻辑库。</p> 
<ul><li>name：指定自定义逻辑库名</li><li>checkSQLschema：在sql语句操作时指定了数据库名称，执行时是否自动去除；true，自动去除；false，不自动去除。</li><li>sqlMaxLimit：查询数据的最大条数</li></ul> 
<h5><a id="table_361"></a>table标签</h5> 
<p>        table标签定义了MyCat中逻辑库下的逻辑表，所有需要拆分的表都在table标签中定义。</p> 
<ul><li>name：定义逻辑表名</li><li>dataNode：定义逻辑表所属的dataNode，该属性需要与dataNode标签中的name对应，多个dataNode需要逗号分隔。</li><li>rule：分片规则的名字，是在rule.xml文件中定义的</li><li>primaryKey：逻辑表对应真实的主键</li><li>type：逻辑表的类型，如果未配置就是普通表；全局表配置为global</li></ul> 
<h5><a id="dataNode_371"></a>dataNode标签</h5> 
<pre><code class="prism language-sql"> <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn1"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost1"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn2"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost2"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>dataNode name<span class="token operator">=</span><span class="token string">"dn3"</span> dataHost<span class="token operator">=</span><span class="token string">"dhost3"</span> <span class="token keyword">database</span><span class="token operator">=</span><span class="token string">"db1"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<p>        dataNode标签定义了MyCat中的数据节点，也就是数据分片，一个dataNode标签就是一个数据分片。</p> 
<ul><li>name：定义数据节点的名称</li><li>dataHost：数据库实例主机名称，引用dataHost标签中的name属性</li><li>database：定义分片所属数据库</li></ul> 
<h5><a id="dataHost_385"></a>dataHost标签</h5> 
<pre><code class="prism language-sql"><span class="token operator">&lt;</span>dataHost name<span class="token operator">=</span><span class="token string">"dhost1"</span> maxCon<span class="token operator">=</span><span class="token string">"1000"</span> minCon<span class="token operator">=</span><span class="token string">"10"</span> balance<span class="token operator">=</span><span class="token string">"0"</span>
                          writeType<span class="token operator">=</span><span class="token string">"0"</span> dbType<span class="token operator">=</span><span class="token string">"mysql"</span> dbDriver<span class="token operator">=</span><span class="token string">"jdbc"</span> switchType<span class="token operator">=</span><span class="token string">"1"</span>  slaveThreshold<span class="token operator">=</span><span class="token string">"100"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>heartbeat<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>heartbeat<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>writeHost host<span class="token operator">=</span><span class="token string">"hostM1"</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://192.168.40.137:3306?useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;amp;characterEncoding=utf8"</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">"root"</span>
                                   password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>writeHost<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dataHost<span class="token operator">&gt;</span>
</code></pre> 
<p>该标签定义了具体的数据库实例、读写分离、心跳语句</p> 
<ul><li>name：唯一标识，供上层连接使用</li><li>maxCon/minCon：最大、最小连接数</li><li>balance：负载均衡策略，取值0，1，2，3</li><li>writeType：写操作分发方式（0：写操作转发到第一个writeHost上，第一个挂了，切换到第二个；1：写操作随机分发到配置的writeHost）</li><li>dbDriver：数据库驱动</li><li>switchType：表示主从切换的方式，取值可以为 <code>1</code> 或 <code>2</code>。其中，<code>1</code> 表示基于读写分离的主从切换方式，<code>2</code> 则表示基于半同步复制的主从切换方式。</li><li>slaveThreshold： 表示从节点的最大延迟时间，单位是毫秒。当从节点的延迟时间超过该阈值时，MyCat 会自动将主节点切换到延迟时间更小的从节点上，以保证集群的高可用性和稳定性。</li></ul> 
<h4><a id="rulexml_407"></a>rule.xml</h4> 
<p>        rule.xml文件中定义所有拆分表的规则，在使用过程中可以灵活使用分片算法，或者对同一个分片算法使用不通的参数。主要有tableRule和Function标签。</p> 
<pre><code class="prism language-sql"><span class="token operator">&lt;</span>tableRule name<span class="token operator">=</span><span class="token string">"auto-sharding-long"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token keyword">rule</span><span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span><span class="token keyword">columns</span><span class="token operator">&gt;</span>id<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">columns</span><span class="token operator">&gt;</span> <span class="token comment"># 根据哪个字段进行分片</span>
           <span class="token operator">&lt;</span><span class="token keyword">algorithm</span><span class="token operator">&gt;</span>rang<span class="token operator">-</span>long<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">algorithm</span><span class="token operator">&gt;</span> <span class="token comment"># 分片的规则</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">rule</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>tableRule<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/23/48/GWUNEXrC_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="serverxml_421"></a>server.xml</h4> 
<p>        server.xml配置文件包含了MyCat的系统配置信息，主要有两个重要的标签：system、user</p> 
<h5><a id="system_425"></a>system标签</h5> 
<p>system标签主要配置系统运行时的一些环境信息</p> 
<pre><code class="prism language-sql">         <span class="token operator">&lt;</span>system<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"nonePasswordLogin"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户--&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useHandshakeV10"</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useSqlStat"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 1为开启实时统计、0为关闭 --&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useGlobleTableCheck"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 1为开启全加班一致性检测、0为关闭 --&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"sqlExecuteTimeout"</span><span class="token operator">&gt;</span><span class="token number">300</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- SQL 执行超时 单位:秒--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"sequnceHandlerType"</span><span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--必须带有MYCATSEQ_或者 mycatseq_进入序列匹配流程 注意MYCATSEQ_有空格的情况--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"sequnceHandlerPattern"</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>?:<span class="token punctuation">(</span>\s<span class="token operator">*</span><span class="token keyword">next</span>\s<span class="token operator">+</span><span class="token keyword">value</span>\s<span class="token operator">+</span><span class="token keyword">for</span>\s<span class="token operator">*</span>MYCATSEQ_<span class="token punctuation">(</span>\w<span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token operator">|</span>\<span class="token punctuation">)</span><span class="token operator">|</span>\s<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"subqueryRelationshipCheck"</span><span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 子查询中存在关联查询的情况下,检查关联字段中是否有分片字段 .默认 false --&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--分布式事务开关，0为不过滤分布式事务，1为过滤分布式事务（如果分布式事务内只涉及全局表，则不过滤），2为不过滤分布式事务,但是记录分布式事务日志--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"handleDistributedTransactions"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

               <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--</span>
                        <span class="token keyword">off</span> heap <span class="token keyword">for</span> <span class="token keyword">merge</span><span class="token operator">/</span><span class="token keyword">order</span><span class="token operator">/</span><span class="token keyword">group</span><span class="token operator">/</span><span class="token keyword">limit</span>      <span class="token number">1</span>开启   <span class="token number">0</span>关闭
                <span class="token comment">--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useOffHeapForMerge"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--</span>
                        单位为m
                <span class="token comment">--&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"memoryPageSize"</span><span class="token operator">&gt;</span><span class="token number">64</span>k<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--</span>
                        单位为k
                <span class="token comment">--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"spillsFileBufferSize"</span><span class="token operator">&gt;</span><span class="token number">1</span>k<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useStreamOutput"</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--</span>
                        单位为m
                <span class="token comment">--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"systemReserveMemorySize"</span><span class="token operator">&gt;</span><span class="token number">384</span>m<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>


                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--是否采用zookeeper协调切换  --&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useZKSwitch"</span><span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- XA Recovery Log日志路径 --&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--&lt;property name="XARecoveryLogBaseDir"&gt;./&lt;/property&gt;--&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- XA Recovery Log日志名称 --&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--&lt;property name="XARecoveryLogBaseName"&gt;tmlog&lt;/property&gt;--&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--如果为 true的话 严格遵守隔离级别,不会在仅仅只有select语句的时候在事务中切换连接--&gt;</span>
                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"strictTxIsolation"</span><span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"useZKSwitch"</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">/</span>system<span class="token operator">&gt;</span>

</code></pre> 
<h5><a id="user_483"></a>user标签</h5> 
<p>        user标签主要配置MyCat中间件能够被哪些用户访问，访问哪些数据库，访问的权限是什么等。</p> 
<p><img src="https://images2.imgbox.com/5f/13/js0WmLoH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="MyCat_490"></a>MyCat原理</h3> 
<p>        MyCat原理中最重要的一个动词是“拦截”，它拦截了用户发送过来的SQL语句，首先对SQL语句做了一些特定的分析：如解析SQL、分片分析、路由分析、读写分离分析，然后将此SQL发往后端的真实数据库，并将返回的结果做适当的处理，如结果合并、聚合处理、排序处理、分页处理，最终再返回给用户</p> 
<p><img src="https://images2.imgbox.com/da/51/kT0h4Oqc_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="MyCat_496"></a>MyCat管理</h4> 
<p>MyCat默认开通2个端口，可以在server.xml文件中进行修改</p> 
<p>8066数据访问端口，9066数据库管理端口，管理mycat的整个集群的状态。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@mysql-master conf<span class="token punctuation">]</span><span class="token comment"># mysql -h 192.168.40.137 -u root -P 9066 -p</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b2/e2/PvpL4Gt8_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> @<span class="token variable">@version</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------+</span>
<span class="token operator">|</span> VERSION                                     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">5.6</span><span class="token number">.29</span><span class="token operator">-</span>mycat<span class="token operator">-</span><span class="token number">1.6</span><span class="token number">.7</span><span class="token number">.3</span><span class="token operator">-</span><span class="token keyword">release</span><span class="token operator">-</span><span class="token number">20210913163959</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> @<span class="token variable">@datasource</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+</span>
<span class="token operator">|</span> DATANODE <span class="token operator">|</span> NAME   <span class="token operator">|</span> <span class="token keyword">TYPE</span>  <span class="token operator">|</span> HOST           <span class="token operator">|</span> PORT <span class="token operator">|</span> W<span class="token operator">/</span>R  <span class="token operator">|</span> ACTIVE <span class="token operator">|</span> IDLE <span class="token operator">|</span> SIZE <span class="token operator">|</span> <span class="token keyword">EXECUTE</span> <span class="token operator">|</span> READ_LOAD <span class="token operator">|</span> WRITE_LOAD <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+</span>
<span class="token operator">|</span> dn1      <span class="token operator">|</span> hostM1 <span class="token operator">|</span> mysql <span class="token operator">|</span> <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.137</span> <span class="token operator">|</span> <span class="token number">3306</span> <span class="token operator">|</span> W    <span class="token operator">|</span>      <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span>      <span class="token number">26</span> <span class="token operator">|</span>         <span class="token number">0</span> <span class="token operator">|</span>          <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span> dn3      <span class="token operator">|</span> hostM1 <span class="token operator">|</span> mysql <span class="token operator">|</span> <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.139</span> <span class="token operator">|</span> <span class="token number">3306</span> <span class="token operator">|</span> W    <span class="token operator">|</span>      <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span>      <span class="token number">32</span> <span class="token operator">|</span>         <span class="token number">0</span> <span class="token operator">|</span>          <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">|</span> dn2      <span class="token operator">|</span> hostM1 <span class="token operator">|</span> mysql <span class="token operator">|</span> <span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.138</span> <span class="token operator">|</span> <span class="token number">3306</span> <span class="token operator">|</span> W    <span class="token operator">|</span>      <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span>      <span class="token number">32</span> <span class="token operator">|</span>         <span class="token number">0</span> <span class="token operator">|</span>          <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+-------+----------------+------+------+--------+------+------+---------+-----------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/73204909acab39f894dea28782ad11f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue中v-model的原理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8517d286772a5a7538a2a82801a6127f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">WEB网络渗透的基础知识</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>