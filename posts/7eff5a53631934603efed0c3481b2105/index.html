<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>智能变电站协议系列-3、MMS协议示例（IEC61850） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="智能变电站协议系列-3、MMS协议示例（IEC61850）" />
<meta property="og:description" content="文章目录 一、前言二、资料收集三、libiec61850的MMS协议的操作文件的示例运行及抓包分析1、协议理解2、代码查看及示例运行3、wireshark抓包及分析 四、最后 一、前言 接下来我们来分析一下MMS协议，该协议比较抽象，从定义上和理解上都比较抽象，只能在实际使用中去熟悉了，这里我们以操作文件的demo示例来理解和分析整个协议。
二、资料收集 对MMS会有一个整体的认识：https://blog.csdn.net/sinat_41915699/article/details/119905968
对MMS抓包分析有个整体的认识：https://www.anquanke.com/post/id/186560
https://www.jianshu.com/p/736505163b73
IEC61850建模，认识MMS的建模：https://blog.csdn.net/kof98765/article/details/112903104
https://www.cnblogs.com/shanwenbin/archive/2013/01/18/2865684.html
https://webstore.iec.ch/preview/info_iec61850-90-5%7Bed1.0%7Den.pdf
三、libiec61850的MMS协议的操作文件的示例运行及抓包分析 1、协议理解 关于建模的过程我们暂时不做深入研究，针对IEC61850的MMS协议做一定了解后，使用demo中已有的mms示例server_example_files服务端和mms_utility这个客户端示例来做下测试，并简要分析其代码，然后以此来抓包分析整个mms协议。
如果对MMS协议不了解，面对example下面的示例程序会一脸懵，完全不知道怎么运行测试，这里可以简单理解为MMS协议或者说标准通过将一些设备、操作、数据类型等做了面向对象的抽象，将其抽象为类，比如如下这些类：
Environment and General Management Services 处理网络连接VMD Support VMD全称为Virtual Machine Device, 是对现实物理设备的一种映射Domain 表示 VMD 中的可加载资源（例如程序）。 个人理解就是一块存储空间，可以存储变量、程序、文件等内容，处理上传下载等任务Program Invocation 程序调用，由一个或多个域组成的可运行程序Variable 变量，类型化数据的元素（例如整数、浮点数、数组等）Named Variable List 已命名的变量列表Event 表示事件和动作状态的对象Semaphore 信号量，用于控制共享资源访问的对象Operator Stations 供操作员使用的“显示器”和“键盘”Journals 日志，对事件和变量的记录Files 文件 然后以服务端-客户端的方式将对象的属性和方法提供出来使用，对象本身可能既具备客户端功能也具备服务端功能，将对外提供的能力以服务端形式展示，并通过客户端能力获取其他对象的服务。
有类就需要实例化对象，而对象则提供服务方法，比如文件的服务就提供读文件夹、打开文件、获取、删除和重命名方法，这样就好理解一些了吧，实际上就是将一些人为的操作内容抽象为类，然后类对象提供服务供客户端调用，实际上就像是提供web服务一样，只是将客户可能产生的接口也都通过协议方式进行了抽象，以模型方式提供xml文件，便于后续自行扩展新接口，这些接口都是包含在其协议定义的各个大类中的（就像积木一样，把常见的积木类型都定义好了为几大类，圆的，方的，三角的等等，然后根据已有的图纸或者自行想象去拼很多的积木人或者积木动物之类的，这些人和动物就像是具体业务的堆叠了，目前常见的就是电力场景业务，电力场景需要的设备、网络连接、程序、数据变量、开关电等事件、日志、文件操作等各种需要的操作都定义进去了，实际上是一套可扩展的标准，并不限于电力场景，只是电力场景用的成熟了，用这个积木已经搭出来一套完善的图纸了，各个电力业务场景可以根据这套图纸来复制搭建了，如果不满足场景可能就会扩展积木类型，也就是协议或者标准的更新）。
关于模型的作用也就是这个文章中提到的信息模型与通信协议独立（https://www.jianshu.com/p/736505163b73）：IEC61850标准定义了抽象通信服务接口ACSI(Abstract Communication Service Interface)。
ACSI独立于具体的网络底层通信协议(如MMS）和具体的网络类型（如以太网），需要具体网络接口时，只需采用特定通信服务映射SCSM（Specific Communication Service Mapping），由SCSM映射到具体的通信协议栈。SCSM的内容就是根据需求将ACSI信息模型和服务映射到具体的通信协议。IEC61850需要对信息模型进行扩充，升级时，无需改变已采用的底层通信协议，只要改变具体的SCSM即可。
ACSI主要设定了各类服务模型包括连接服务模型、变量访问服务模型、数据传输服务模型、设备控制服务模型、文件传输服务模型、时钟同步服务模型等。这些服务模型定义了通信对象以及如何对这些对象进行访问，实现客户应用端和服务器应用端的通信，完成实时数据的访问和检索、对设备的控制、时间报告和记录、设备的自我描述等。
2、代码查看及示例运行 （1）服务端部分： 其中simoleIO_direct_control.cid就是对应的XML协议，这个在建模部分的文章中有提到（https://www.yuque.com/xiaoyao-nhu75/mlgg0k/kfke8akc2gcbq116#VWKxa），这里我们没有具体的标准的文献，只需要先了解相关概念即可，static_model.c就是对应的模型转换后的代码，server_example_files.c就是对应服务的代码，通过分析我们发现其设置的文件存储路径就是vmd-filestore，demo程序在其下创建了test文件，内容也是test，我们后续可以通过mms客户端的代码取打开获取相关文件的一些信息：
如下是对应代码，整体调用还是比较简单，我做了一些简单的注释：
/* * server_example_files.c * * - How to use some special MMS file service features * - How to control how files file services can be used */ #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7eff5a53631934603efed0c3481b2105/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-25T19:26:11+08:00" />
<meta property="article:modified_time" content="2023-12-25T19:26:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">智能变电站协议系列-3、MMS协议示例（IEC61850）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、前言</a></li><li><a href="#_3" rel="nofollow">二、资料收集</a></li><li><a href="#libiec61850MMS_5" rel="nofollow">三、libiec61850的MMS协议的操作文件的示例运行及抓包分析</a></li><li><ul><li><a href="#1_6" rel="nofollow">1、协议理解</a></li><li><a href="#2_22" rel="nofollow">2、代码查看及示例运行</a></li><li><a href="#3wireshark_210" rel="nofollow">3、wireshark抓包及分析</a></li></ul> 
   </li><li><a href="#_239" rel="nofollow">四、最后</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、前言</h3> 
<p>接下来我们来分析一下MMS协议，该协议比较抽象，从定义上和理解上都比较抽象，只能在实际使用中去熟悉了，这里我们以操作文件的demo示例来理解和分析整个协议。</p> 
<h3><a id="_3"></a>二、资料收集</h3> 
<p>对MMS会有一个整体的认识：<a href="https://blog.csdn.net/sinat_41915699/article/details/119905968">https://blog.csdn.net/sinat_41915699/article/details/119905968</a><br>对MMS抓包分析有个整体的认识：<a href="https://www.anquanke.com/post/id/186560" rel="nofollow">https://www.anquanke.com/post/id/186560</a><br><a href="https://www.jianshu.com/p/736505163b73" rel="nofollow">https://www.jianshu.com/p/736505163b73</a><br>IEC61850建模，认识MMS的建模：<a href="https://blog.csdn.net/kof98765/article/details/112903104">https://blog.csdn.net/kof98765/article/details/112903104</a><br><a href="https://www.cnblogs.com/shanwenbin/archive/2013/01/18/2865684.html" rel="nofollow">https://www.cnblogs.com/shanwenbin/archive/2013/01/18/2865684.html</a><br><a href="https://webstore.iec.ch/preview/info_iec61850-90-5%7Bed1.0%7Den.pdf" rel="nofollow">https://webstore.iec.ch/preview/info_iec61850-90-5%7Bed1.0%7Den.pdf</a></p> 
<h3><a id="libiec61850MMS_5"></a>三、libiec61850的MMS协议的操作文件的示例运行及抓包分析</h3> 
<h4><a id="1_6"></a>1、协议理解</h4> 
<p>关于建模的过程我们暂时不做深入研究，针对IEC61850的MMS协议做一定了解后，使用demo中已有的mms示例server_example_files服务端和mms_utility这个客户端示例来做下测试，并简要分析其代码，然后以此来抓包分析整个mms协议。<br>如果对MMS协议不了解，面对example下面的示例程序会一脸懵，完全不知道怎么运行测试，这里可以简单理解为MMS协议或者说标准通过将一些设备、操作、数据类型等做了面向对象的抽象，将其抽象为类，比如如下这些类：</p> 
<ul><li><strong>Environment and General Management Services</strong> 处理网络连接</li><li><strong>VMD Support</strong> VMD全称为Virtual Machine Device, 是对现实物理设备的一种映射</li><li><strong>Domain</strong> 表示 VMD 中的可加载资源（例如程序）。 个人理解就是一块存储空间，可以存储变量、程序、文件等内容，处理上传下载等任务</li><li><strong>Program Invocation</strong> 程序调用，由一个或多个域组成的可运行程序</li><li><strong>Variable</strong> 变量，类型化数据的元素（例如整数、浮点数、数组等）</li><li><strong>Named Variable List</strong> 已命名的变量列表</li><li><strong>Event</strong> 表示事件和动作状态的对象</li><li><strong>Semaphore</strong> 信号量，用于控制共享资源访问的对象</li><li><strong>Operator Stations</strong> 供操作员使用的“显示器”和“键盘”</li><li><strong>Journals</strong> 日志，对事件和变量的记录</li><li><strong>Files</strong> 文件</li></ul> 
<p>然后以服务端-客户端的方式将对象的属性和方法提供出来使用，对象本身可能既具备客户端功能也具备服务端功能，将对外提供的能力以服务端形式展示，并通过客户端能力获取其他对象的服务。<br>有类就需要实例化对象，而对象则提供服务方法，比如文件的服务就提供读文件夹、打开文件、获取、删除和重命名方法，这样就好理解一些了吧，实际上就是将一些人为的操作内容抽象为类，然后类对象提供服务供客户端调用，实际上就像是提供web服务一样，只是将客户可能产生的接口也都通过协议方式进行了抽象，以模型方式提供xml文件，便于后续自行扩展新接口，这些接口都是包含在其协议定义的各个大类中的（就像积木一样，把常见的积木类型都定义好了为几大类，圆的，方的，三角的等等，然后根据已有的图纸或者自行想象去拼很多的积木人或者积木动物之类的，这些人和动物就像是具体业务的堆叠了，目前常见的就是电力场景业务，电力场景需要的设备、网络连接、程序、数据变量、开关电等事件、日志、文件操作等各种需要的操作都定义进去了，实际上是一套可扩展的标准，并不限于电力场景，只是电力场景用的成熟了，用这个积木已经搭出来一套完善的图纸了，各个电力业务场景可以根据这套图纸来复制搭建了，如果不满足场景可能就会扩展积木类型，也就是协议或者标准的更新）。<br>关于模型的作用也就是这个文章中提到的信息模型与通信协议独立（<a href="https://www.jianshu.com/p/736505163b73" rel="nofollow">https://www.jianshu.com/p/736505163b73</a>）：IEC61850标准定义了抽象通信服务接口ACSI(Abstract Communication Service Interface)。<br>ACSI独立于具体的网络底层通信协议(如MMS）和具体的网络类型（如以太网），需要具体网络接口时，只需采用特定通信服务映射SCSM（Specific Communication Service Mapping），由SCSM映射到具体的通信协议栈。SCSM的内容就是根据需求将ACSI信息模型和服务映射到具体的通信协议。IEC61850需要对信息模型进行扩充，升级时，无需改变已采用的底层通信协议，只要改变具体的SCSM即可。<br>ACSI主要设定了各类服务模型包括连接服务模型、变量访问服务模型、数据传输服务模型、设备控制服务模型、文件传输服务模型、时钟同步服务模型等。这些服务模型定义了通信对象以及如何对这些对象进行访问，实现客户应用端和服务器应用端的通信，完成实时数据的访问和检索、对设备的控制、时间报告和记录、设备的自我描述等。<br><img src="https://images2.imgbox.com/bc/33/XEMEnOgY_o.png" alt=""></p> 
<h4><a id="2_22"></a>2、代码查看及示例运行</h4> 
<ul><li>（1）服务端部分：</li></ul> 
<p>其中simoleIO_direct_control.cid就是对应的XML协议，这个在建模部分的文章中有提到（<a href="#VWKxa" rel="nofollow">https://www.yuque.com/xiaoyao-nhu75/mlgg0k/kfke8akc2gcbq116#VWKxa</a>），这里我们没有具体的标准的文献，只需要先了解相关概念即可，static_model.c就是对应的模型转换后的代码，server_example_files.c就是对应服务的代码，通过分析我们发现其设置的文件存储路径就是vmd-filestore，demo程序在其下创建了test文件，内容也是test，我们后续可以通过mms客户端的代码取打开获取相关文件的一些信息：<br><img src="https://images2.imgbox.com/02/64/IdTeTQ5J_o.png" alt="image.png"><br>如下是对应代码，整体调用还是比较简单，我做了一些简单的注释：</p> 
<pre><code class="prism language-c"><span class="token comment">/*
 *  server_example_files.c
 *
 *  - How to use some special MMS file service features
 *  - How to control how files file services can be used
 */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"iec61850_server.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hal_thread.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"static_model.h"</span></span>

<span class="token keyword">static</span> <span class="token keyword">int</span> running <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> IedServer iedServer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token comment">//退出信号处理</span>
<span class="token keyword">void</span>
<span class="token function">sigint_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signalId<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    running <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//客户端连接回调</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">connectionHandler</span> <span class="token punctuation">(</span>IedServer self<span class="token punctuation">,</span> ClientConnection connection<span class="token punctuation">,</span> bool connected<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> parameter<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>connected<span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connection opened\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connection closed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//文件操作回调，对应不同的服务</span>
<span class="token keyword">static</span> MmsError
<span class="token function">fileAccessHandler</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> parameter<span class="token punctuation">,</span> MmsServerConnection connection<span class="token punctuation">,</span> MmsFileServiceType service<span class="token punctuation">,</span>
                                          <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> localFilename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> otherFilename<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fileAccessHandler: service = %i, local-file: %s other-file: %s\n"</span><span class="token punctuation">,</span> service<span class="token punctuation">,</span> localFilename<span class="token punctuation">,</span> otherFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Don't allow client to rename files */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>service <span class="token operator">==</span> MMS_FILE_ACCESS_TYPE_RENAME<span class="token punctuation">)</span>
        <span class="token keyword">return</span> MMS_ERROR_FILE_FILE_ACCESS_DENIED<span class="token punctuation">;</span>

    <span class="token comment">/* Don't allow client to delete file "IEDSERVER.BIN" */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>service <span class="token operator">==</span> MMS_FILE_ACCESS_TYPE_DELETE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>localFilename<span class="token punctuation">,</span> <span class="token string">"IEDSERVER.BIN"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> MMS_ERROR_FILE_FILE_ACCESS_DENIED<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* allow all other accesses */</span>
    <span class="token keyword">return</span> MMS_ERROR_NONE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//mms常用端口102</span>
    <span class="token keyword">int</span> tcpPort <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tcpPort <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Using libIEC61850 version %s\n"</span><span class="token punctuation">,</span> <span class="token function">LibIEC61850_getVersionString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建服务并加载模型</span>
    iedServer <span class="token operator">=</span> <span class="token function">IedServer_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>iedModel<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Set the base path for the MMS file services */</span>
    <span class="token comment">//设置文件服务基础路径</span>
    MmsServer mmsServer <span class="token operator">=</span> <span class="token function">IedServer_getMmsServer</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">IedServer_setFilestoreBasepath</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">,</span> <span class="token string">"./vmd-filestore/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Set a callback handler to control file accesses */</span>
    <span class="token comment">//设置文件处理回调</span>
    <span class="token function">MmsServer_installFileAccessHandler</span><span class="token punctuation">(</span>mmsServer<span class="token punctuation">,</span> fileAccessHandler<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//设置连接处理回调</span>
    <span class="token function">IedServer_setConnectionIndicationHandler</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">,</span> <span class="token punctuation">(</span>IedConnectionIndicationHandler<span class="token punctuation">)</span> connectionHandler<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* MMS server will be instructed to start listening to client connections. */</span>
    <span class="token comment">//开始tcp服务监听</span>
    <span class="token function">IedServer_start</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">,</span> tcpPort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IedServer_isRunning</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Starting server failed! Exit.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">IedServer_destroy</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    running <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span>
        <span class="token function">Thread_sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/* stop MMS server - close TCP server socket and all client sockets */</span>
    <span class="token comment">//停止mms服务</span>
    <span class="token function">IedServer_stop</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Cleanup - free all resources */</span>
    <span class="token comment">//释放资源</span>
    <span class="token function">IedServer_destroy</span><span class="token punctuation">(</span>iedServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token comment">/* main() */</span>

</code></pre> 
<ul><li>（2）客户端部分：</li></ul> 
<p><img src="https://images2.imgbox.com/7a/18/f5j71ZPE_o.png" alt="image.png"><br>mms的一些通用的操作方法接口都做了介绍，根据协议我们也能看懂一部分的使用，除了-h -p这些指定host和端口的操作外，文件部分-f、-g、-x我们接下来就会展示运行并对其抓包分析：<br><img src="https://images2.imgbox.com/d0/52/byDCbW78_o.png" alt="image.png"></p> 
<ul><li>（3）运行并抓包</li></ul> 
<p>服务端进行如下操作：</p> 
<pre><code class="prism language-shell"><span class="token comment">#在libiec61850/build/examples/server_example_files目录下</span>
<span class="token comment">#创建文件夹并进入该目录</span>
<span class="token function">mkdir</span> vmd-filestore
<span class="token comment">#创建test文件并写入内容test或者其它内容</span>
<span class="token function">touch</span> <span class="token builtin class-name">test</span>

<span class="token comment">#之后回到libiec61850/build/examples/server_example_files执行服务程序</span>
./server_example_files
</code></pre> 
<p>客户端进行测试：</p> 
<pre><code class="prism language-shell"><span class="token comment">#查看文件列表</span>
$ ./mms_utility <span class="token parameter variable">-d</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-f</span>
MMS connected.

Server identity:
----------------
  vendor:	libiec61850.com
  model:	LIBIEC61850
  revision:	<span class="token number">1.5</span>.2

Domains present on server:
--------------------------
simpleIOGenericIO
<span class="token builtin class-name">test</span>
<span class="token comment">#读文件属性</span>
$ ./mms_utility <span class="token parameter variable">-d</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-g</span> <span class="token builtin class-name">test</span>
MMS connected.

Server identity:
----------------
  vendor:	libiec61850.com
  model:	LIBIEC61850
  revision:	<span class="token number">1.5</span>.2

Domains present on server:
--------------------------
simpleIOGenericIO
FILENAME: <span class="token builtin class-name">test</span>
SIZE: <span class="token number">5</span>
DATE: <span class="token number">20231221052248</span>.000Z
<span class="token comment">#删除文件</span>
$ ./mms_utility <span class="token parameter variable">-d</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-x</span> <span class="token builtin class-name">test</span>
MMS connected.

Server identity:
----------------
  vendor:	libiec61850.com
  model:	LIBIEC61850
  revision:	<span class="token number">1.5</span>.2

Domains present on server:
--------------------------
simpleIOGenericIO
File deleted
</code></pre> 
<p><img src="https://images2.imgbox.com/a0/23/j9W6ZZxZ_o.png" alt="image.png"></p> 
<h4><a id="3wireshark_210"></a>3、wireshark抓包及分析</h4> 
<p>三组命令各自对应的过程，分析流程参考这里：（<a href="https://www.anquanke.com/post/id/186560" rel="nofollow">https://www.anquanke.com/post/id/186560</a>）。</p> 
<ul><li>（1）、OSI七层网络模型：</li></ul> 
<p><img src="https://images2.imgbox.com/45/2f/vtBD8LUa_o.png" alt="image.png"><br>在其中我们发现了TPTK、COTP以及ISO 8650-1 OIS Association Control Service，其中TPTK属于会话层，COTP属于表示层，ISO 8650-1 OIS Association Control Service也就是ACSE属于应用层，其通常用来确定、维持或终止在两个应用之间的连接。<br>（2）、四种MMS包，分别是</p> 
<ul><li>initiate-RequestPDU（启动-请求PDU）</li><li>initiate-ResponsePDU（启动-应答PDU）</li><li>confirmed-RequestPDU（确认-请求PDU）</li><li>confirmed-ResponsePDU（确认-应答PDU）</li></ul> 
<p><img src="https://images2.imgbox.com/26/7f/CpXLcARJ_o.png" alt="image.png"><br>具体分析下帧信息：</p> 
<ul><li>获取文件列表：</li></ul> 
<p><img src="https://images2.imgbox.com/fe/b4/dweQlywI_o.png" alt="image.png"></p> 
<ul><li>获取文件属性（一个文件的时候和获取文件列表看不出来区别，如果创建两个就发现获取列表是将所有文件属性都带上了，单独获取文件属性只有这一个）：</li></ul> 
<p><img src="https://images2.imgbox.com/89/5c/D0gZr9o6_o.png" alt="image.png"><br><img src="https://images2.imgbox.com/2f/15/kgCY69Jb_o.png" alt="image.png"></p> 
<ul><li>删除文件：</li></ul> 
<p><img src="https://images2.imgbox.com/60/e8/Nz30YV6u_o.png" alt="image.png"></p> 
<ul><li>读写文件</li></ul> 
<p>这里示例查看iec61850_client_example_files即可，这里就不再说代码了，直接抓包看一下<br><img src="https://images2.imgbox.com/8a/c5/uXLQor7s_o.png" alt="image.png"><br>似乎没有远程写文件fileWrite的直接接口，只能get文件后修改本地文件然后再set到远程替换原本的文件。</p> 
<h3><a id="_239"></a>四、最后</h3> 
<p>MMS协议的分析暂时就到这里了，接下来我们再去分析下IEC 101和IEC 104协议。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3b412d87ca988e7b35585f5170a962f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">云数据库性能深度测评与对比</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62f0be98d94ed7fc204fd1a8f268e0e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux filesystem 分区扩容</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>