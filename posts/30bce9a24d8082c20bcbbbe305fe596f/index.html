<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[转]关于 the char &#39;ox1e&#39; after &#39;&#39; is not a valid xml character - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[转]关于 the char &#39;ox1e&#39; after &#39;&#39; is not a valid xml character" />
<meta property="og:description" content="说明：项目里webservice借口上传数据出异常 日志打印报错类似于标题那种。开始的解决方法是JS正则去掉非汉字、数字、英文、标点符号。后来上网查了下找到下述解决方法。
--------------------分割线---------------------------------
以下内容转自：http://hi.baidu.com/godtrip/item/90c1a4eec422eb0d560f1d8a
java做WebService接口上传数据，传输格式利用XML来传输。
XML不支持Unicode编码的字符串。会导致如下问题：
the char &#39;ox1e&#39; after &#39;&#39; is not a valid xml character
解决方法是过滤字符串里的 &#39;ox1e&#39; .
/*去掉XML 不认可的字符0x0-0x20*/ //0x1e
public static String DECODE(String in) { StringBuffer out = new StringBuffer(); // Used to hold the output. char current; // Used to reference the current character. if (in == null || (&#34;&#34;.equals(in))) return &#34;&#34;; // vacancy test. for (int i = 0; i &lt; in.length(); i&#43;&#43;) { current = in." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/30bce9a24d8082c20bcbbbe305fe596f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-11-16T15:11:00+08:00" />
<meta property="article:modified_time" content="2012-11-16T15:11:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[转]关于 the char &#39;ox1e&#39; after &#39;&#39; is not a valid xml character</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>说明：项目里webservice借口上传数据出异常 日志打印报错类似于标题那种。开始的解决方法是JS正则去掉非汉字、数字、英文、标点符号。后来上网查了下找到下述解决方法。</p> 
 <p>--------------------分割线---------------------------------</p> 
 <p>以下内容转自：<a href="http://hi.baidu.com/godtrip/item/90c1a4eec422eb0d560f1d8a" rel="nofollow">http://hi.baidu.com/godtrip/item/90c1a4eec422eb0d560f1d8a</a></p> 
 <p>java做WebService接口上传数据，传输格式利用XML来传输。</p> 
 <p>XML不支持Unicode编码的字符串。会导致如下问题：<br>the char 'ox1e' after '' is not a valid xml character<br><br>解决方法是过滤字符串里的 'ox1e' .<br><br>/*去掉XML 不认可的字符0x0-0x20*/ //0x1e</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span><span style="color:#000000;"> String DECODE(String in) { 
    StringBuffer out </span>= <span style="color:#0000ff;">new</span> StringBuffer(); <span style="color:#008000;">//</span><span style="color:#008000;"> Used to hold the output.</span>
　　<span style="color:#0000ff;">char</span> current; <span style="color:#008000;">//</span><span style="color:#008000;"> Used to reference the current character.</span>
　　<span style="color:#0000ff;">if</span> (in == <span style="color:#0000ff;">null</span> || ("".equals(in))) <span style="color:#0000ff;">return</span> ""; <span style="color:#008000;">//</span><span style="color:#008000;"> vacancy test.</span>
　　<span style="color:#0000ff;">for</span> (<span style="color:#0000ff;">int</span> i = 0; i &lt; in.length(); i++<span style="color:#000000;">) {  
　　　　current </span>=<span style="color:#000000;"> in.charAt(i);
　　　　</span><span style="color:#0000ff;">if</span>(current == 0x1e<span style="color:#000000;">){
　　　　　　System.out.println(</span>"出现错误编码...捕获...过滤....--&gt;current:" +<span style="color:#000000;"> current);
　　　　}</span><span style="color:#0000ff;">else</span> <span style="color:#0000ff;">if</span>((current == 0x9) || (current == 0xA) || (current == 0xD<span style="color:#000000;">)  
　　　　　　　　</span>|| ((current &gt; 0x20) &amp;&amp; (current &lt;= 0xD7FF<span style="color:#000000;">))  
　　　　　　　　</span>|| ((current &gt;= 0xE000) &amp;&amp; (current &lt;= 0xFFFD<span style="color:#000000;">))  
　　　　　　　　</span>|| ((current &gt;= 0x10000) &amp;&amp; (current &lt;= 0x10FFFF))||(current &lt; 0x0<span style="color:#000000;">))  
　　　　　　out.append(current);  
　　　　}
　　</span><span style="color:#0000ff;">return</span><span style="color:#000000;"> out.toString().trim();
}</span></pre> 
 </div> 
 <p>2011.07.05</p> 
 <p>　　事隔一年，以上问题在几个省份的WebService接口中相继出现,这次一同事查找到了也较全面的资料，记载如下：</p> 
 <p>　　XML 容许的字符 请看 http://www.w3.org/TR/REC-xml#dt-character 。</p> 
 <p>　　0x9, 0xA, 0xD，其中0x9代表Tab键的16进制代码,0xA, 0xD代表16进制的回车符与换行符.可以用UE在正常模式下敲回车，然后点击16进制查看模式查看出来。</p> 
 <p> </p> 
 <p>***，你好    与你确认一件事情，0x9, 0xA, 0xD等代码中IF条件里的字符都是不去掉的，之外的字符是要去掉的吧？   2011-07-04 ----------------------------------<br><br><span style="text-decoration:underline;"><strong>原邮件附件清单如下：</strong></span>  (1). 湖南数据问题.doc  (2). Util.java  (3). 对XML_进行_parse_时的Invalid_Unicode_character_(0x0)_分析.docx</p> 
 <p>***，你好！</p> 
 <p>    江苏上传集团BDC接口中处理特殊字符的代码如下：</p> 
 <p>         /* 去掉XML不认可的字符0x0-0x20 */</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#0000ff;">public</span><span style="color:#000000;"> String decode(String in) {
       StringBuffer out </span>= <span style="color:#0000ff;">new</span> StringBuffer(); <span style="color:#008000;">//</span><span style="color:#008000;"> Used to hold the output.</span>
       <span style="color:#0000ff;">char</span> current; <span style="color:#008000;">//</span><span style="color:#008000;"> Used to reference the current character.</span>
       <span style="color:#0000ff;">if</span> (in == <span style="color:#0000ff;">null</span> || (""<span style="color:#000000;">.equals(in)))
           </span><span style="color:#0000ff;">return</span> ""; <span style="color:#008000;">//</span><span style="color:#008000;"> vacancy test.</span>
       <span style="color:#0000ff;">for</span> (<span style="color:#0000ff;">int</span> i = 0; i &lt; in.length(); i++<span style="color:#000000;">) {
           current </span>=<span style="color:#000000;"> in.charAt(i);
           </span><span style="color:#0000ff;">if</span> ((current == 0x9) || (current == 0xA) || (current == 0xD<span style="color:#000000;">)
                  </span>|| ((current &gt; 0x20) &amp;&amp; (current &lt;= 0xD7FF<span style="color:#000000;">))
                  </span>|| ((current &gt;= 0xE000) &amp;&amp; (current &lt;= 0xFFFD<span style="color:#000000;">))
                  </span>|| ((current &gt;= 0x10000) &amp;&amp; (current &lt;= 0x10FFFF<span style="color:#000000;">))
                  </span>|| (current &lt; 0x0<span style="color:#000000;">))
              out.append(current);
       }
       </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> out.toString().trim();
    }</span></pre> 
 </div> 
 <p> 处理的规则就是将字符中含有的0x9, 0xA, 0xD, 0x20, 0xD7FF, 0xE000, 0xFFFD, 0x10000, 0x10FFFF, 0x0这些XML解析时无效的编码字符去除掉。</p> 
 <p>    接口程序中只有个别字段的内容调用了该方法进行处理，是否只需要处理这些字段？还是全部手动输入的字段都要调用该方法处理一下？请本地确认。</p> 
 <p>    这个问题最早在2009年12月30日集团处理湖南数据上传的时候就出现过，下面邮件及附件《湖南数据问题.doc》是当时排查的情况，供参考。</p> 
 <p> </p> 
 <p>    <strong>经过网络搜索对该问题的原因做如下总结：</strong></p> 
 <p>    因为字节数组中存在 Unicode: 0x0,而这个字节在Xml中被认为是非法字符。对于一些经过编码或加、解密的字符串中，很容易会出现这个 0x0，特别是在加、解密中，经常会涉及到字符填充，而填充物通常是 0x0，对于0x00-0x20 都会引起一定的问题，又因为这些字符不可见，因此用通常的编辑器进行编辑的时候找不到问题所在。</p> 
 <p>xml中需要过滤的字符分为两类：</p> 
 <p>一类是不允许出现在xml中的字符，这些字符不在xml的定义范围之内；</p> 
 <p>另一类是xml自身要使用的字符，如果内容中有这些字符则需被替换成别的字符。</p> 
 <p> </p> 
 <p>第一类字符：</p> 
 <p>　　对于第一类字符，我们可以通过W3C的XML文档来查看都有哪些字符不被允许出现在xml文档中。</p> 
 <p>　　XML允许的字符范围是“#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]”。因此我们可以把这个范围之外的字符过滤掉。</p> 
 <p>第二类字符：</p> 
 <p>　　对于第二类字符一共有5个，如下：</p> 
 <p>　　字符            HTML字符         字符编码</p> 
 <p>　　和(and) &amp;        &amp;amp;               &amp;#38;</p> 
 <p>　　单引号  ’       &amp;apos;              &amp;#39;</p> 
 <p>　　双引号  ”       &amp;quot;              &amp;#34;</p> 
 <p>　　大于号  &gt;        &amp;gt;                &amp;#62;</p> 
 <p>　　小于号  &lt;        &amp;lt;                &amp;#60; </p> 
 <p>    附件中《对XML_进行_parse_时的Invalid_Unicode_character_(0x0)_分析.docx》是在百度文库中搜索到的供参考。</p> 
 <p>-------------------------分割线------------------------------------------------------------------------------------</p> 
 <p>PS:仅供参考</p> 
</div> 
<p>转载于:https://www.cnblogs.com/GYoungBean/archive/2012/11/16/2773307.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/35643526eaea39d516103c8887e6f047/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Win7 、XP下MyEclipse svn用户名和密码修改问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5e0d6bdfa5273e08baf8be1e10b8c4bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">定义CPU阀值(转)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>