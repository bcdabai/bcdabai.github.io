<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据截取处理、富文本去除所有标签 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据截取处理、富文本去除所有标签" />
<meta property="og:description" content="前提：在做项目中有个需求是填写表单后生成一份文档，文档可以编辑、保存。
这部分用富文本处理了，涉及到的逻辑就是对象--&gt;富文本标签形式
在给后端传的数据格式再把富文本标签形式--&gt;对象形式。
涉及到文字，图片、表格，以及图片表格的标题。
数据截取处理 // 数据截取处理 extractString(str, startChar, endChar) { const pattern = `${startChar}(.*?)${endChar}`; const regex = new RegExp(pattern); const matches = str.match(regex); return matches ? matches[1] : &#39;&#39;; }, 用法： let a = this.extractString(item, &#39;&lt;img&#39;, &#39;&lt;/p&gt;&#39;) item就是要处理的字串，后面一个开始元素，一个结束元素。
富文本去除所有标签 str=&#39;&lt;div class=&#34;proposal-content&#34; style=&#34;text-indent:2em; font-size:16px; line-height:1.5&#34;&gt;光伏组件在运行过程中，光电转换效率会受到影响，输出功率有所降低。本报告年衰减率根据《光伏制造行业规范条件（2021年本）》计算，晶硅组件衰减率首年不高于2.5%，后续每年不高于0.6%。&lt;/div&gt;&#39; let a = str.replace(/&lt;[^&gt;]&#43;&gt;/g, &#39;&#39;) .replace替换其他数据：
proposalString = proposalString.replace(new RegExp(&#39;&lt;p data-we-empty-p=&#34;&#34; style=&#34;padding-left:2em;&#34;&gt;&#39;, &#39;g&#39;), paragraph); ‘g’是全局替换，不然只会替换第一个。
富文本转对象大致实现思路： 因为要数据对应，以下是后端传过来的数据：
let obj = [ { content: &#39;合浦位于广西壮族自治区北海市合浦县合浦闸口镇。项目所在地的经纬度坐标为21.69°N, 109." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fb345961d10a62ab88352ca920fb7abc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T18:05:21+08:00" />
<meta property="article:modified_time" content="2024-01-12T18:05:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据截取处理、富文本去除所有标签</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前提：在做项目中有个需求是填写表单后生成一份文档，文档可以编辑、保存。</p> 
<p>这部分用富文本处理了，涉及到的逻辑就是对象--&gt;富文本标签形式</p> 
<p>在给后端传的数据格式再把富文本标签形式--&gt;对象形式。</p> 
<p>涉及到文字，图片、表格，以及图片表格的标题。</p> 
<h2>数据截取处理</h2> 
<pre><code class="language-javascript">        // 数据截取处理
        extractString(str, startChar, endChar) {
            const pattern = `${startChar}(.*?)${endChar}`;
            const regex = new RegExp(pattern);
            const matches = str.match(regex);
            return matches ? matches[1] : '';
        },</code></pre> 
<h3>用法：</h3> 
<pre><code class="language-javascript">let a = this.extractString(item, '&lt;img', '&lt;/p&gt;')</code></pre> 
<p> item就是要处理的字串，后面一个开始元素，一个结束元素。</p> 
<h2>富文本去除所有标签</h2> 
<pre><code class="language-javascript">str='&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5"&gt;光伏组件在运行过程中，光电转换效率会受到影响，输出功率有所降低。本报告年衰减率根据《光伏制造行业规范条件（2021年本）》计算，晶硅组件衰减率首年不高于2.5%，后续每年不高于0.6%。&lt;/div&gt;'
let a = str.replace(/&lt;[^&gt;]+&gt;/g, '')</code></pre> 
<p>.replace替换其他数据：</p> 
<pre><code class="language-javascript">proposalString = proposalString.replace(new RegExp('&lt;p data-we-empty-p="" style="padding-left:2em;"&gt;', 'g'), paragraph);</code></pre> 
<p>‘g’是全局替换，不然只会替换第一个。</p> 
<h2>富文本转对象大致实现思路：</h2> 
<p>因为要数据对应，以下是后端传过来的数据：</p> 
<pre><code class="language-javascript">          let obj = [
                {
                    content:
                        '合浦位于广西壮族自治区北海市合浦县合浦闸口镇。项目所在地的经纬度坐标为21.69°N, 109.52°E。\n合浦县，属亚热带季风型海洋性气候区，日照较强，热量充足，雨量充沛，夏热冬暖，无霜期长。气候受季风环流控制，雨热同季。冬干夏湿，夏无酷暑，冬无严寒，盛行风向有明显的季节性转换，在沿海乡镇还有昼夜交替的海陆风出现。由于各季节雨热不均以及濒临北部湾，主要气象灾害有台风、暴雨、干旱、低温阴雨及霜冻、冰雹、雷电和龙卷风等。主要气候特征是年平均气温偏高，年总降雨量偏多，年总日照时数偏多。\n',
                    image: {
                        title: '项目所在位置图',
                        path: 'https://xidianai.oss-cn-hangzhou.aliyuncs.com/xdai_78abb1eb_loc_map.png',
                        index: 1,
                    },
                    table: {
                        title: '',
                        rowNum: '',
                        colNum: '',
                        head: [],
                        content: [],
                    },
                },
            ];</code></pre> 
<p>对应回显在富文本，</p> 
<p>思路：遍历数据结构，加上标签，富文本本身是会回显标签的</p> 
<pre><code class="language-javascript">                         this.$nextTick(() =&gt; {
                            let content = '';
                            this.chapterList.chapterContent.forEach(item =&gt; {
                                if (item.content) {
                                    content += item.content
                                        .replace(/\n\n\n/g, '&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;')
                                        .replace(/\n\n/g, '&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;');
                                    content = content.replace(/\n/g, `&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`);
                                }
                                // 图片回显
                                if (item.image.path) {
                                    content += `&lt;div class="img" style="width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;"&gt;&lt;img src=${item.image.path} /&gt;&lt;div style="font-size: 14px;"&gt;图${this.chapterList.chapterIndex}-${item.image.index}  &lt;span class="img-title"&gt;${item.image.title}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`;
                                }
                                // 表格回显
                                if (item.table.title) {
                                    content += `&lt;div class="table" style="width:100%;display: flex;flex-direction: column;justify-content: center;align-items: center;"&gt;&lt;span&gt;表${this.chapterList.chapterIndex}-${item.table.index}  ${item.table.title}&lt;/span&gt;&lt;table border="1" cellspacing="0" cellpadding="0" style="width: 100%;"&gt;&lt;tbody&gt;&lt;tr&gt;`;
                                    item.table.head.forEach(item =&gt; {
                                        content += `&lt;th&gt;${item}&lt;/th&gt;`;
                                    });
                                    content += `&lt;tr&gt;`;
                                    item.table.content.forEach(item =&gt; {
                                        content += `&lt;tr&gt;`;
                                        item.forEach(item =&gt; {
                                            content += `&lt;td&gt;${item}&lt;/td&gt;`;
                                        });
                                        content += `&lt;/tr&gt;`;
                                    });
                                    content += `&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5"&gt;&lt;/div&gt;`;
                                }
                            });
                            content = `&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5"&gt;${content
                                .replace(`&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`, ``)
                                .replace(new RegExp('°E。'), `°E。&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`)}&lt;/div&gt;`;
                            this.editor.txt.html(content);
                        });</code></pre> 
<p>用户编辑完成后保存，富文本转对象操作思路：特定标签用replace()替换后，split()成数组，这样obj就拿到了，然后遍历，分开处理content文字，图片，以及图片标题，表格以及表格标题。</p> 
<pre><code class="language-javascript">        // 保存
        saveProposal() {
            console.log(this.editor.txt.html());
            let obj = [
                {
                    content:
                        '合浦位于广西壮族自治区北海市合浦县合浦闸口镇。项目所在地的经纬度坐标为21.69°N, 109.52°E。\n合浦县，属亚热带季风型海洋性气候区，日照较强，热量充足，雨量充沛，夏热冬暖，无霜期长。气候受季风环流控制，雨热同季。冬干夏湿，夏无酷暑，冬无严寒，盛行风向有明显的季节性转换，在沿海乡镇还有昼夜交替的海陆风出现。由于各季节雨热不均以及濒临北部湾，主要气象灾害有台风、暴雨、干旱、低温阴雨及霜冻、冰雹、雷电和龙卷风等。主要气候特征是年平均气温偏高，年总降雨量偏多，年总日照时数偏多。\n',
                    image: {
                        title: '项目所在位置图',
                        path: 'https://xidianai.oss-cn-hangzhou.aliyuncs.com/xdai_78abb1eb_loc_map.png',
                        index: 1,
                    },
                    table: {
                        title: '',
                        rowNum: '',
                        colNum: '',
                        head: [],
                        content: [],
                    },
                },
            ];
            // 段落
            let paragraph = '&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5"&gt;';
            let proposalArr = [];
            // let proposalString =
            //     '&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5"&gt;光伏组件在运行过程中，光电转换效率会受到影响，输出功率有所降低。本报告年衰减率根据《光伏制造行业规范条件（2021年本）》计算，晶硅组件衰减率首年不高于2.5%，后续每年不高于0.6%，25年内不。本项目运营期内逐年上网电量见下表。&lt;div class="table" style="width:100%;display: flex;flex-direction: column;justify-content: center;align-items: center;"&gt;&lt;span&gt;表6-1  本项目运营期逐年上网电量统计表&lt;/span&gt;&lt;/div&gt;&lt;table border="0" width="100%" cellpadding="0" cellspacing="0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&gt;年份&lt;/th&gt;&lt;th&gt;年发电量万kWh&lt;/th&gt;&lt;th&gt;累计发电量万kWh&lt;/th&gt;&lt;th&gt;年利用小时数h&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;59525.59&lt;/td&gt;&lt;td&gt;59525.59&lt;/td&gt;&lt;td&gt;1026.3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;19&lt;/td&gt;&lt;td&gt;55196.46&lt;/td&gt;&lt;td&gt;1089859.46&lt;/td&gt;&lt;td&gt;951.66&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;';
            let proposalString = this.editor.txt.html();
            // text-align:left; text-align:center;替换（图后文本）
            proposalString = proposalString.replace(
                new RegExp(
                    '&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5; text-align:center;"&gt;',
                    'g'
                ),
                paragraph
            );
            proposalString = proposalString.replace(
                new RegExp(
                    '&lt;div class="proposal-content" style="text-indent:2em; font-size:16px; line-height:1.5; text-align:left;"&gt;',
                    'g'
                ),
                paragraph
            );
            // 新增文本
            proposalString = proposalString.replace(new RegExp('&lt;p data-we-empty-p="" style="padding-left:2em;"&gt;', 'g'), paragraph);
            proposalString = proposalString.replace(new RegExp(paragraph), ``).replace(new RegExp(paragraph, 'g'), `aabb`).split('aabb');
            proposalString.forEach(item =&gt; {
                let content = '';
                let image = {};
                let table = {};
                // 处理图片数据
                if (this.extractString(item, 'src="', '"').length &gt; 0) {
                    image.path = this.extractString(item, 'src="', '"');
                    if (item.includes('&lt;span class="img-title"&gt;')) {
                        // 图片标题
                        image.title = this.extractString(item, '&lt;span class="img-title"&gt;', '&lt;/span&gt;');
                        item = item.replace(this.extractString(item, '&lt;img', '&lt;/span&gt;'), '');
                    } else {
                        // 编辑图片标题（居中）
                        image.title = this.extractString(item, '&lt;p data-we-empty-p="" style="text-align:center;"&gt;', ' ');
                        image.title = this.extractString(item, image.title, '&lt;/p&gt;');
                        // 去除img文字
                        item = item.replace(this.extractString(item, '&lt;img', '&lt;/p&gt;'), '');
                    }
                } else {
                    image.path = '';
                    image.title = '';
                }
                // 处理表格数据
                if (item.indexOf('tbody&gt;&lt;tr&gt;&lt;th&gt;') &gt; -1) {
                    let tableData = this.extractString(item, '&lt;table', '&lt;/table&gt;');
                    let tableHeadArr = []; // 截取的要处理的数据
                    let head = []; // 表头
                    let contentList = []; // 表格内容
                    // 获取表头
                    if (item.indexOf('&lt;th&gt;') &gt; -1) {
                        tableHeadArr = tableData.replace(new RegExp('&lt;th&gt;', 'g'), 'tableHead').split('tableHead');
                    }
                    tableHeadArr.forEach(m =&gt; {
                        if (m.indexOf('&lt;/th&gt;') &gt; -1) {
                            head.push(this.extractString(m, '', '&lt;/th&gt;'));
                        }
                    });
                    // 获取表格内容
                    let tableContentOld = tableData.split('&lt;/th&gt;&lt;/tr&gt;')[1]
                    if (tableContentOld.indexOf('&lt;tr&gt;&lt;td&gt;') &gt; -1) {
                        tableContentOld = tableContentOld.replace(new RegExp('&lt;tr&gt;&lt;td&gt;', 'g'), 'tableContent').split('tableContent');
                        tableContentOld.forEach(m =&gt; {
                          let contentArr = []
                          if(m.replace(/&lt;[^&gt;]+&gt;/g, '')){
                            m.replace(new RegExp('&lt;/td&gt;', 'g'),'cloumn').replace(new RegExp('&lt;td&gt;', 'g'),'').split('cloumn').forEach((n)=&gt;{
                              if(n.replace(/&lt;[^&gt;]+&gt;/g, '')){
                                contentArr.push(n);
                              }
                            })
                            contentList.push(contentArr);
                          }
                        })
                        // 去除table文字
                        item = item.replace(this.extractString(item, '&lt;img', '&lt;/p&gt;'), '');
                    }
                    // table.title = title;
                    table.head = head
                    table.content = contentList
                    table.colNum = head.length
                    table.rowNum = contentList.length
                }
                // 段落文字处理（去除图片、表格数据、标签、占位符等）
                content = item.replace(new RegExp('&lt;br/&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;', 'g'), '\n').replace(/&lt;[^&gt;]+&gt;/g, '');
                proposalArr.push({ content: content, image: image, table: table });
            });
            console.log(proposalArr);
        },</code></pre> 
<p> 代码贴在这里，存在冗余，大致提供一个思路，因为需求还没评审，暂时把这部分功能做出来了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/67391d6364c1b7dd745de2aa99b1464f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于Docker Compose单机实现多级缓存架构2024</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7271deea35969407dc7eecac3281170e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">探索SQL性能优化之道：实用技巧与最佳实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>