<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker高级篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker高级篇" />
<meta property="og:description" content="docker高级篇 一.dockerfile解析 1.dockerfile是什么 dockerfile是用来构建docker镜像的文本文件，是有一条条构建镜像所需的指令和参数构成的脚本 2.dockerfile常用保留字指令 FROM #基础镜像，当前镜像是基于哪个镜像的，指定一个已经存在的镜像模板，第一条必须是from MAINTAINER #镜像维护者的姓名和邮箱地址 RUN #容器构建是需要运行的命令 EXPOSE #当前容器对外暴露的端口号 WORKDIR #指定在创建容器后终端默认登录进来的目录 USER #指定镜像以什么样的的用户去执行 ENV #用来在构建镜像过程中设置环境变量 ADD #将宿主机的文件拷贝进镜像且会自动处理URL和解压tar压缩包 COPY #拷贝文件和目录到镜像中 VOLUME #容器数据卷，用于数据保存和持久化工作 CMD #指定容器启动后要干的事 ENTRYPONIT #指定一个容器启动是要运行的命令 3.实例 #创建dockerfile文件 vim Dockerfile FROM centos MAINTAINER heber&lt;heber@123.com&gt; ENV MYPATH /usr/local WORKDIR $MYPATH #安装vim RUN yum -y install vim #安装ifconfig RUN yum -y install net-tools #安装Java8及lib库 RUN yum -y install glibc.i686 RUN mkdir /usr/local/java #添加Java包 ADD Jdk-8u171-linux-x64.tar.gz /usr/local/java #配置Java环境变量 ENV JAVA_HOME /usr/local/java/jdk1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/66c78a703fdfee8bf576608a238e4e89/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-14T21:58:53+08:00" />
<meta property="article:modified_time" content="2022-06-14T21:58:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker高级篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="docker_0"></a>docker高级篇</h2> 
<h4><a id="dockerfile_2"></a>一.dockerfile解析</h4> 
<h6><a id="1dockerfile_4"></a>1.dockerfile是什么</h6> 
<pre><code class="prism language-bash">dockerfile是用来构建docker镜像的文本文件，是有一条条构建镜像所需的指令和参数构成的脚本
</code></pre> 
<h6><a id="2dockerfile_10"></a>2.dockerfile常用保留字指令</h6> 
<pre><code class="prism language-bash">FROM <span class="token comment">#基础镜像，当前镜像是基于哪个镜像的，指定一个已经存在的镜像模板，第一条必须是from</span>
MAINTAINER <span class="token comment">#镜像维护者的姓名和邮箱地址</span>
RUN <span class="token comment">#容器构建是需要运行的命令</span>
EXPOSE <span class="token comment">#当前容器对外暴露的端口号</span>
WORKDIR <span class="token comment">#指定在创建容器后终端默认登录进来的目录</span>
<span class="token environment constant">USER</span> <span class="token comment">#指定镜像以什么样的的用户去执行</span>
ENV <span class="token comment">#用来在构建镜像过程中设置环境变量</span>
ADD <span class="token comment">#将宿主机的文件拷贝进镜像且会自动处理URL和解压tar压缩包</span>
COPY <span class="token comment">#拷贝文件和目录到镜像中</span>
VOLUME <span class="token comment">#容器数据卷，用于数据保存和持久化工作</span>
CMD <span class="token comment">#指定容器启动后要干的事</span>
ENTRYPONIT <span class="token comment">#指定一个容器启动是要运行的命令</span>
</code></pre> 
<h6><a id="3_27"></a>3.实例</h6> 
<pre><code class="prism language-bash"><span class="token comment">#创建dockerfile文件</span>
<span class="token function">vim</span> Dockerfile
FROM centos
MAINTAINER heber<span class="token operator">&lt;</span>heber@123.com<span class="token operator">&gt;</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
<span class="token comment">#安装vim</span>
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
<span class="token comment">#安装ifconfig</span>
RUN yum -y <span class="token function">install</span> net-tools
<span class="token comment">#安装Java8及lib库</span>
RUN yum -y <span class="token function">install</span> glibc.i686
RUN <span class="token function">mkdir</span> /usr/local/java
<span class="token comment">#添加Java包</span>
ADD Jdk-8u171-linux-x64.tar.gz /usr/local/java
<span class="token comment">#配置Java环境变量</span>
ENV JAVA_HOME /usr/local/java/jdk1.8.0_171
ENV JRE_HOME <span class="token variable">$JAVA_HOME</span>/jre
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JAVA_HOME</span>/lib:<span class="token variable">$CLASSPATH</span>
ENV <span class="token environment constant">PATH</span> <span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">PATH</span>
EXPOSE <span class="token number">8080</span>
CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">'success......ok'</span>
CMD /bin/bash
</code></pre> 
<h6><a id="4_56"></a>4.构建</h6> 
<pre><code class="prism language-bash"><span class="token function">docker</span> build  -t 镜像名字:tag <span class="token builtin class-name">.</span>
</code></pre> 
<h4><a id="docker_62"></a>二.docker网络</h4> 
<h6><a id="1docker_64"></a>1.查看docker网络模式</h6> 
<pre><code class="prism language-bash"><span class="token function">docker</span> network <span class="token function">ls</span> 
</code></pre> 
<h6><a id="2docker_70"></a>2.docker网络能干什么</h6> 
<pre><code class="prism language-bash">容器间的互联和通信以及端口映射
</code></pre> 
<h6><a id="3_76"></a>3.网络模式</h6> 
<pre><code class="prism language-bash">NETWORK ID     NAME      DRIVER    SCOPE
1677316bdb64   bridge    bridge    <span class="token builtin class-name">local</span>
00245e67ea1c   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
0f92e90b63c4   none      null      <span class="token builtin class-name">local</span>
bridge	<span class="token comment">#为每一个容器分配，设置ip，并将容器连接到docker0</span>
<span class="token function">host</span>	<span class="token comment">#容器不会虚拟出自己的网卡，配置自己的ip，而是用宿主机的ip和端口</span>
none	<span class="token comment">#容器有独立的network namespace ，但是并没有对其进行网络分配</span>
container <span class="token comment">#共享一个ip</span>
</code></pre> 
<h4><a id="docker_compose_89"></a>三.docker_compose容器编排</h4> 
<h6><a id="1_91"></a>1.是什么</h6> 
<pre><code class="prism language-bash">docker_compose是docker官方开源项目，负责实现对docker容器集群的快速编排，多服务管理工具
</code></pre> 
<h6><a id="2_97"></a>2.能干嘛</h6> 
<pre><code class="prism language-bash">用来管理容器实例
compose允许用户通过一个单独的docker_compose.yml模板文件（YAML格式）来定义一组相关联的应用容器为一个项目
</code></pre> 
<h6><a id="3_104"></a>3.去哪里下</h6> 
<pre><code class="prism language-bash"><span class="token comment">#官网下载</span>
https://docs.docker.com/compose/install
<span class="token comment">#安装</span>
<span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64 -o usr/local/bin/docker-compose
<span class="token comment">#授权</span>
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
<span class="token comment">#测试安装</span>
<span class="token function">docker-compose</span> version
<span class="token comment">#卸载</span>
<span class="token function">rm</span> -f /usr/local/bin/docker-compose
</code></pre> 
<h6><a id="4conpose_119"></a>4.conpose核心概念</h6> 
<pre><code class="prism language-bash"><span class="token comment">#一个文件</span>
docker-compose.yml
<span class="token comment">#两大要素</span>
服务	<span class="token comment">#一个个应用容器实例</span>
工程	<span class="token comment">#由一组关联的应用容器组成的完整业务单元，在docker-compose.yml文件中定义</span>
</code></pre> 
<h6><a id="5compose_129"></a>5.compose常用命令</h6> 
<pre><code class="prism language-bash">docker-conpose -h <span class="token comment">#查看帮助</span>
docker-conpose up <span class="token comment">#启动所有docker-compose服务</span>
docker-conpose up -d <span class="token comment">#启动所有docker-compose服务并后台启动</span>
docker-conpose down <span class="token comment">#停止并删除容器，网络，卷，镜像</span>
docker-conpose <span class="token builtin class-name">exec</span> yml里面的服务id <span class="token comment">#进入容器内部实例</span>
docker-conpose <span class="token function">ps</span> <span class="token comment">#展示当前编排过的运行的所有容器</span>
docker-conpose <span class="token function">top</span> <span class="token comment">#展示当前编排过的容器进程</span>
docker-conpose logs yml容器id <span class="token comment">#查看容器输出日志</span>
docker-conpose config <span class="token comment">#检查配置</span>
docker-conpose config -q <span class="token comment">#检查配置，有问题的才输出</span>
docker-conpose start <span class="token comment">#启动服务</span>
docker-conpose restart <span class="token comment">#重启服务</span>
docker-conpose stop <span class="token comment">#停止服务</span>
</code></pre> 
<h6><a id="6conpose_147"></a>6.conpose编排微服务</h6> 
<pre><code class="prism language-bash"><span class="token comment">#编写docker-compose.yml</span>
<span class="token function">vim</span> docker-conpose.yml
version:<span class="token string">"3"</span> <span class="token comment">#版本</span>
servers:
 microSerice:
 image:heber_docker:1.8 <span class="token comment">#选择镜像</span>
 container_name:ms01 <span class="token comment">#名字</span>
 ports: <span class="token comment">#端口</span>
  -<span class="token string">"6001:6001"</span>
 volumes: <span class="token comment">#容器数据卷</span>
  - /app/microSerice:/data
 networks: <span class="token comment">#网卡</span>
  - atguigu_net
 depends_no: <span class="token comment">#备注需要的依赖</span>
  - redis
  - mysql
  
redis:
 image:redis:6.0.8 <span class="token comment">#选择镜像</span>
 ports: <span class="token comment">#端口</span>
  -<span class="token string">"6379:6379"</span>
 volumes: <span class="token comment">#容器数据卷</span>
  - /app/redis/redis.conf:/etc/redis/redis.conf
  - /app/redis/data:/data
 networks: <span class="token comment">#网卡</span>
  - atguigu_net
 command:redis-server /etc/redis/redis.conf
 
mysql:
 image:mysql:5.7 <span class="token comment">#选择镜像</span>
 environment:
  MYSQL_ROOT_PASSWORD:<span class="token string">"123456"</span>
  MYSQL_ALLOW_EMPTY_PASSWORD:<span class="token string">"no"</span>
  MYSQL_DATABASE:<span class="token string">"db2022"</span>
  MYSQL_USER:<span class="token string">"heber"</span>
  MYSQL_PASSWORD:<span class="token string">"heber123"</span>
 ports: <span class="token comment">#端口</span>
  -<span class="token string">"3306:3306"</span>
 volumes: <span class="token comment">#容器数据卷</span>
  - /app/mysql/db:/var/lib/mysql
  - /app/mysql/conf/my.cnf:/etc/my.cnf
  - /app/mysql/init:/docker-entrypoint-initdb.d
 networks: <span class="token comment">#网卡</span>
  - atguigu_net
 command:--default-authentication-plugin<span class="token operator">=</span>mysql_native_password <span class="token comment">#解决外部无法访问</span>
 
networks: <span class="token comment">#创建网卡</span>
 atguigu_net
</code></pre> 
<h6><a id="7_200"></a>7.启动</h6> 
<pre><code class="prism language-bash"><span class="token comment">#验证一下</span>
docker-conpose config -q
<span class="token comment">#启动</span>
docker-conpose up / docker-conpose up -d
</code></pre> 
<h6><a id="8_209"></a>8.停止</h6> 
<pre><code class="prism language-bash">docker-conpose stop
</code></pre> 
<h4><a id="docker_portainer_215"></a>四.docker_portainer</h4> 
<h6><a id="1portainer_217"></a>1.portainer是什么</h6> 
<pre><code class="prism language-bash">是一款轻量级的应用,它提供了图形化界面，用于方便管理docker环境，包括单机环境和集群环境
</code></pre> 
<h6><a id="2_223"></a>2.安装</h6> 
<pre><code class="prism language-bash"><span class="token comment">#官网</span>
https://www.portainer.io/
<span class="token comment">#安装</span>
<span class="token function">docker</span> run -d -p <span class="token number">8000</span>:8000 -p <span class="token number">9000</span>:9000 --name portainer --restart<span class="token operator">=</span>always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
</code></pre> 
<h6><a id="3_232"></a>3.访问</h6> 
<pre><code class="prism language-bash">http://192.168.0.119:9000/
admin/admin123.
</code></pre> 
<p>run -d -p 8000:8000 -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</p> 
<pre><code>
##### 3.访问

```bash
http://192.168.0.119:9000/
admin/admin123.
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00ab57bebd792ec52d027376cf2781c6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">挂载u盘之mount</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f808f9963db7ef6c6b40ceeb5c8f0402/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Flink入门（7）】Flink的ProcessFunction API(底层API)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>