<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(asp.net)PayPal案例的关键源码代码__PayPal集成_API接口 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="(asp.net)PayPal案例的关键源码代码__PayPal集成_API接口" />
<meta property="og:description" content="轻轻松松集成PayPal
标准版
Paypal国际版网站集成简易教程（一）：序言
前段时间接到一个外贸网站的项目，集成paypal支付接口的，对象是海外用户，全部用US的信用卡结算。国内有个paypal的中文版，叫贝宝，不过只支持人民币之间的结算，而且提供的功能不多。所以只能使用paypal国际版，也就是paypal.com，习惯性的google了一下相关资料，发现关于paypal.com接口的中文文档并不多，也不详细，只好自己上paypal.com研究，还好paypal上的资料非常齐全，而且还提供了开发者沙盒（sandbox），相比之下，国内流行的支付宝还有很长的路要走啊。
项目结束的时候就有想法写一篇网站集成paypal的简易教程，方便以后的各位开发者，毕竟看长篇英文资料是很头痛的事情^_^。一直到昨天期末考才结束，所以今天开始写这个教程，其实内容也不多，可能还算不上教程，只能算经验吧。
主要分为序言、支付按钮、返回信息方式（IPN&amp;PDT）、实例四部分组成，预计在三天内完成，如果有新内容我临时再加吧。
接下来一篇将会介绍如何在网站上快速加入paypal支付按钮。
Paypal国际版网站集成简易教程（二）：快速加入支付按钮
本篇主要介绍如何在你的网站上快速加入paypal支付按钮，通过这个按钮，人们可以方便快速的付款到你的paypal帐户。
首先，你需要注册一个paypal帐户，帐户类型分为Personal（个人）、Premier（高级）和Business（商业），他们的差别对于开发者来说主要是返回的信息，Personal的不能使用IPN和PDT等商家工具，即不能获取交易信息，但是Personal帐户收款无需手续费；Premier和Business当然就提供了IPN和PDT功能，能够在客户支付成功后，将交易信息传给指定的网站，用来二次使用。Premier和Business使用上的差异我不是很清楚，应该是月收款额和手续费上的区别吧。
这里插进来介绍一下paypal sandbox，也就是沙盒，是paypal提供给开发者的一个工具，非常好用，你可以在https://developer.paypal.com/注册和使用它。登录以后可以新建帐户，设置余额和帐户类型，有一点要注意，每次使用时必须先登录sandbox才能使用新建的那些帐户。Sndbox里面有个测试工具，可以发送IPN的，以后会用到。
接着上面的内容，注册完帐户以后，当然，一开始开发最好使用sandbox，不然资金转来转去手续费都扣光了，paypal的费率如下：
比起国内的支付工具，paypal贵了好多，当然，和国情也有关系。
接下来是按钮的代码，很简单，就是一个普通的网页表单代码：
程序代码
&lt;form action=&#34;https://www.paypal.com/cgi-bin/webscr&#34; method=&#34;post&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;cmd&#34; value=&#34;_xclick&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;business&#34; value=&#34;sample@sample.com&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;item_name&#34; value=&#34;Item Name Goes Here&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;item_number&#34; value=&#34;Item Number Goes Here&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;amount&#34; value=&#34;100.00&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;no_shipping&#34; value=&#34;2&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;no_note&#34; value=&#34;1&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;currency_code&#34; value=&#34;USD&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;bn&#34; value=&#34;IC_Sample&#34;&gt; &lt;input type=&#34;image&#34; src=&#34;https://www.paypal.com/ en_US/i/btn/x-click-but23.gif&#34; name=&#34;submit&#34; alt=&#34;Make payments with payPal - it&#39;s fast, free and secure!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0b45314d7fb11dea826ef9036570f8ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-04-11T10:02:00+08:00" />
<meta property="article:modified_time" content="2012-04-11T10:02:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">(asp.net)PayPal案例的关键源码代码__PayPal集成_API接口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p> </p> 
 <p class="a">轻轻松松集成PayPal</p> 
 <p class="a">标准版</p> 
 <p> </p> 
 <p>Paypal国际版网站集成简易教程（一）：序言</p> 
 <p> </p> 
 <p>      前段时间接到一个外贸网站的项目，集成paypal支付接口的，对象是海外用户，全部用US的信用卡结算。国内有个paypal的中文版，叫贝宝，不过只支持人民币之间的结算，而且提供的功能不多。所以只能使用paypal国际版，也就是paypal.com，习惯性的google了一下相关资料，发现关于paypal.com接口的中文文档并不多，也不详细，只好自己上paypal.com研究，还好paypal上的资料非常齐全，而且还提供了开发者沙盒（sandbox），相比之下，国内流行的支付宝还有很长的路要走啊。</p> 
 <p>   </p> 
 <p>      项目结束的时候就有想法写一篇网站集成paypal的简易教程，方便以后的各位开发者，毕竟看长篇英文资料是很头痛的事情^_^。一直到昨天期末考才结束，所以今天开始写这个教程，其实内容也不多，可能还算不上教程，只能算经验吧。</p> 
 <p> </p> 
 <p>      主要分为序言、支付按钮、返回信息方式（IPN&amp;PDT）、实例四部分组成，预计在三天内完成，如果有新内容我临时再加吧。</p> 
 <p>   </p> 
 <p>      接下来一篇将会介绍如何在网站上快速加入paypal支付按钮。</p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p>Paypal国际版网站集成简易教程（二）：快速加入支付按钮</p> 
 <p> </p> 
 <p>      本篇主要介绍如何在你的网站上快速加入paypal支付按钮，通过这个按钮，人们可以方便快速的付款到你的paypal帐户。</p> 
 <p>      首先，你需要注册一个paypal帐户，帐户类型分为Personal（个人）、Premier（高级）和Business（商业），他们的差别对于开发者来说主要是返回的信息，Personal的不能使用IPN和PDT等商家工具，即不能获取交易信息，但是Personal帐户收款无需手续费；Premier和Business当然就提供了IPN和PDT功能，能够在客户支付成功后，将交易信息传给指定的网站，用来二次使用。Premier和Business使用上的差异我不是很清楚，应该是月收款额和手续费上的区别吧。</p> 
 <p> </p> 
 <p>      这里插进来介绍一下paypal sandbox，也就是沙盒，是paypal提供给开发者的一个工具，非常好用，你可以在https://developer.paypal.com/注册和使用它。登录以后可以新建帐户，设置余额和帐户类型，有一点要注意，每次使用时必须先登录sandbox才能使用新建的那些帐户。Sndbox里面有个测试工具，可以发送IPN的，以后会用到。</p> 
 <p> </p> 
 <p>      接着上面的内容，注册完帐户以后，当然，一开始开发最好使用sandbox，不然资金转来转去手续费都扣光了，paypal的费率如下：</p> 
 <p> </p> 
 <p>     </p> 
 <p>      比起国内的支付工具，paypal贵了好多，当然，和国情也有关系。</p> 
 <p>    </p> 
 <p>      接下来是按钮的代码，很简单，就是一个普通的网页表单代码：</p> 
 <p>      </p> 
 <p> </p> 
 <p> 程序代码</p> 
 <div class="cnblogs_code"> 
  <pre>&lt;form action=<span style="color:#800000;">"</span><span style="color:#800000;">https://www.paypal.com/cgi-bin/webscr</span><span style="color:#800000;">"</span> method=<span style="color:#800000;">"</span><span style="color:#800000;">post</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">cmd</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">_xclick</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">business</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">sample@sample.com</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">item_name</span><span style="color:#800000;">"</span><span style="color:#000000;">

   value</span>=<span style="color:#800000;">"</span><span style="color:#800000;">Item Name Goes Here</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">item_number</span><span style="color:#800000;">"</span><span style="color:#000000;">

   value</span>=<span style="color:#800000;">"</span><span style="color:#800000;">Item Number Goes Here</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">amount</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">100.00</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">no_shipping</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">2</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">no_note</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">1</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">currency_code</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">USD</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">hidden</span><span style="color:#800000;">"</span> name=<span style="color:#800000;">"</span><span style="color:#800000;">bn</span><span style="color:#800000;">"</span> value=<span style="color:#800000;">"</span><span style="color:#800000;">IC_Sample</span><span style="color:#800000;">"</span>&gt;

   &lt;input type=<span style="color:#800000;">"</span><span style="color:#800000;">image</span><span style="color:#800000;">"</span> src=<span style="color:#800000;">"</span><span style="color:#800000;">https://www.paypal.com/</span>
<span style="color:#000000;">
   en_US</span>/i/btn/x-click-but23.gif<span style="color:#800000;">"
</span><span style="color:#000000;">
   name</span>=<span style="color:#800000;">"</span><span style="color:#800000;">submit</span><span style="color:#800000;">"</span> alt=<span style="color:#800000;">"</span><span style="color:#800000;">Make payments with payPal - it's fast,</span>
<span style="color:#000000;">
   free and secure</span>!<span style="color:#800000;">"</span><span style="color:#800000;">&gt;</span>

   &lt;img alt=<span style="color:#800000;">""</span><span style="color:#000000;">

   src</span>=<span style="color:#800000;">"</span><span style="color:#800000;">https://www.paypal.com/en_US/i/scr/pixel.gif</span><span style="color:#800000;">"</span><span style="color:#000000;">

   width</span>=<span style="color:#800000;">"</span><span style="color:#800000;">1</span><span style="color:#800000;">"</span> height=<span style="color:#800000;">"</span><span style="color:#800000;">1</span><span style="color:#800000;">"</span>&gt;

&lt;/form&gt;

 </pre> 
 </div> 
 <p> </p> 
 <p> </p> 
 <p>      如果使用sandbox，action地址改成https://www.sandbox.paypal.com/cgi-bin/webscr即可，上面这段还是很容易理解的，看下name和value基本上就能知道每个值的含义了。</p> 
 <p> </p> 
 <p>     </p> 
 <p>      保存用浏览器打开，就会看到一个paypal的按钮，点击过去按照提示操作，就能付款到business指定值的帐户了。</p> 
 <p> </p> 
 <p>      这就是一个最简单的paypal支付按钮。</p> 
 <p>      再下一篇中会讲一下如何在付款成功之后，将信息返回到你的网站，大部分需求都是客户完成付款后返回信息到网站的数据库，记录网站客服的交易信息。</p> 
 <p> </p> 
 <p>      最后稍微了解下为什么海外用户喜欢用自己的网站做生意，而不是像国内一样用淘宝之类的C2C平台。一开始我也很不理解，有免费的平台为什么要自己建设网站还要支付paypal的手续费，后来和客户了解了一下，他们做的事网游虚拟交易，国外最大的C2C平台就是eBay，但只有德国可以售卖虚拟物品，并且eBay上的交易并不是免费的，收取的手续费远远高于paypal的费率，因此，更多的海外用户选择自己建设网站进行电子商务。</p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p>Paypal国际版网站集成简易教程（三）：IPN的使用</p> 
 <p> </p> 
 <p>      本文内容采用知识共享署名-非商业性使用-禁止演绎 2.5 中国大陆许可协议进行许可。</p> 
 <p> </p> 
 <p>      </p> 
 <p> </p> 
 <p> 引用内容</p> 
 <p>什么是即时付款通知IPN</p> 
 <p>当您收到新的付款交易或者已发生的付款交易的状态发生变化时，PayPal都将异步（即不作为网站付款流程的一部分） 发送付款详细数据到您所指定的URL，以便您了解买家付款的具体情况并做出相应的响应。这个过程我们称作即时付款通知（简称 IPN）。</p> 
 <p> </p> 
 <p> </p> 
 <p>      最近事情比较多，一直没有继续更新，不好意思了，今天难得有空，就把最重要的一段先发上来了。</p> 
 <p> </p> 
 <p>      相信大部分网站集成Paypal都希望能够实现客户支付完成后返回信息到自己的网站，然后处理这些信息。比如客户在你的网站上购买了一个产品，通过Paypal完成了支付，接着Paypal告诉你的网站客户完成了支付以及支付信息，最后你的网站将这些信息记录到你自己的数据库中，并且将你的客户订单状态设为已支付，接着你就可以进行一系列的相关订单的后续操作。</p> 
 <p>      IPN就能帮助我们实现这个功能，IPN示意图如下（来自Paypal.com）：</p> 
 <p> </p> 
 <p>     </p> 
 <p> </p> 
 <p>      当客户完成支付，Paypal会在后台通过post方式向你的服务器传送交易数据，来实现网站集成的功能。</p> 
 <p>接下来我们就来看IPN的实现方法。</p> 
 <p>      第一步，你需要一个sandbox的帐号，这很重要，因为它能让你随心所欲的进行测试，而不用担心资金在天上飞。注册地址：https://developer.paypal.com/</p> 
 <p>      第二步，登陆sandbox，新建一个商家帐号（卖方）和一个客户账号（买方），其中卖方帐号必须是Premier或者Business，不然无法使用IPN功能。</p> 
 <p>     </p> 
 <p> </p> 
 <p>      新建买家帐号的时候记得在Account Balance中加上金额，不然你就没钱买东西了，如果paypal.com的帐号也能这样加钱多好。</p> 
 <p>      新建完两个帐号：</p> 
 <p>     </p> 
 <p> </p> 
 <p>      卖家帐号的test mode要设为enabled。</p> 
 <p>      选中business帐号，点击下面的Enter Sandbox Test Site进入sandbox Test Site，登录，就像普通Paypal帐号的管理页面一样。</p> 
 <p>     </p> 
 <p> </p> 
 <p>      点击Profile，在Selling Preferences中选择Instant Payment Notification Preferences，点击edit加入IPN信息返回的地址，记得勾上前面那个选项，我是用.net写的接受文件，所以我的IPN地址是http://www.chenchen.org/ipn.aspx,地址只要能在互联网上访问到就可以了。</p> 
 <p>     </p> 
 <p> </p> 
 <p>      在Profile -&gt; Selling Preferences -&gt;Website Payment Preferences选项中，有一个Auto Return的选项，将它设为on，并且在下面的return地址中填入你希望的客户支付完成后返回的地址：</p> 
 <p>      </p> 
 <p> </p> 
 <p>       以上就完成了商家端的设置。</p> 
 <p> </p> 
 <p>      接下来是你网站上ipn.aspx文件的编写，这个是用来接收支付数据的，是非常关键的一个文件。</p> 
 <p>      文件环境，.net 2.0，语言C#。</p> 
 <p>      Ipn.aspx文件：此文件不用修改任何东西，代码都在cs文件中。</p> 
 <p>      Ipn.aspx.cs文件：关键代码</p> 
 <p> </p> 
 <p>      定义一个VerifyIPN()函数：</p> 
 <p> </p> 
 <p> </p> 
 <p> 程序代码</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#0000ff;">bool</span><span style="color:#000000;"> VerifyIPN()

{

        </span><span style="color:#0000ff;">string</span> strFormValues =<span style="color:#000000;"> Request.Form.ToString();

        </span><span style="color:#0000ff;">string</span><span style="color:#000000;"> strNewValue;

        </span><span style="color:#0000ff;">string</span><span style="color:#000000;"> strResponse;

        </span><span style="color:#0000ff;">string</span> serverURL = <span style="color:#800000;">"</span><span style="color:#800000;">https://www.sandbox.paypal.com/cgi-bin/webscr</span><span style="color:#800000;">"</span><span style="color:#000000;">;

 

        HttpWebRequest req </span>=<span style="color:#000000;"> (HttpWebRequest)WebRequest.Create(serverURL);

        req.Method </span>= <span style="color:#800000;">"</span><span style="color:#800000;">POST</span><span style="color:#800000;">"</span><span style="color:#000000;">;

        req.ContentType </span>= <span style="color:#800000;">"</span><span style="color:#800000;">application/x-www-form-urlencoded</span><span style="color:#800000;">"</span><span style="color:#000000;">;

        strNewValue </span>= strFormValues + <span style="color:#800000;">"</span><span style="color:#800000;">&amp;cmd=_notify-validate</span><span style="color:#800000;">"</span><span style="color:#000000;">;

        req.ContentLength </span>=<span style="color:#000000;"> strNewValue.Length;

 

        StreamWriter stOut </span>= <span style="color:#0000ff;">new</span><span style="color:#000000;"> StreamWriter(req.GetRequestStream(), System.Text.Encoding.ASCII);

        stOut.Write(strNewValue);

        stOut.Close();

 

        StreamReader stIn </span>= <span style="color:#0000ff;">new</span><span style="color:#000000;"> StreamReader(req.GetResponse().GetResponseStream());

        strResponse </span>=<span style="color:#000000;"> stIn.ReadToEnd();

        stIn.Close();

 

        </span><span style="color:#0000ff;">return</span> strResponse == <span style="color:#800000;">"</span><span style="color:#800000;">VERIFIED</span><span style="color:#800000;">"</span><span style="color:#000000;">;

}

 </span></pre> 
 </div> 
 <p> </p> 
 <p>       这段代码的作用是判断IPN信息是否来自Pyapal，如果不进行判断，那么恶意用户完全可以模拟一个信息post到你的网站上，让你认为订单已经完成支付，所以，必须首先对接受到的信息进行验证。</p> 
 <p> </p> 
 <p>      代码的基本原理，serverURL定义了验证地址，sandbox为：https://www.sandbox.paypal.com/cgi-bin/webscr，Paypal.com就是https://www.paypal.com/cgi-bin/webscr。</p> 
 <p>      将paypal发送过来的所有信息加上一个&amp;cmd=_notify-validate参数，表示对这个信息进行验证，全部发送回paypal验证，如果信息确实存在，则返回VERIFIED字符串。</p> 
 <p>验证成功后，就可以用如下形式获得交易信息：</p> 
 <p> </p> 
 <p> </p> 
 <p> 程序代码</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#0000ff;">string</span> ppTx = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">txn_id</span><span style="color:#800000;">"</span><span style="color:#000000;">].ToString();

</span><span style="color:#0000ff;">string</span> ppStatus = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">payment_status</span><span style="color:#800000;">"</span><span style="color:#000000;">].ToString();

</span><span style="color:#0000ff;">string</span> ppDate = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">payment_date</span><span style="color:#800000;">"</span><span style="color:#000000;">].ToString();

</span><span style="color:#0000ff;">string</span> ppItem = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">item_name</span><span style="color:#800000;">"</span><span style="color:#000000;">].ToString();

</span><span style="color:#0000ff;">string</span> ppPrice = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">mc_gross</span><span style="color:#800000;">"</span>].ToString();</pre> 
 </div> 
 <p> </p> 
 <p> </p> 
 <p>      每个变量的解释可以参考Paypal网站上的说明，我这里就不再重复。</p> 
 <p> </p> 
 <p>     .cs代码结构如下：</p> 
 <p> </p> 
 <p> </p> 
 <p> 程序代码</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">partial</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> paypal_ipn : System.Web.UI.Page

{

    </span><span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> Page_Load(<span style="color:#0000ff;">object</span><span style="color:#000000;"> sender, EventArgs e)

    {

        </span><span style="color:#0000ff;">if</span> (VerifyIPN())<span style="color:#008000;">//</span><span style="color:#008000;">验证成功</span>
<span style="color:#000000;">
        {

            </span><span style="color:#0000ff;">string</span> ppTx = Request.Form[<span style="color:#800000;">"</span><span style="color:#800000;">txn_id</span><span style="color:#800000;">"</span>].ToString();<span style="color:#008000;">//</span><span style="color:#008000;">获取post中的各项变量值</span>
<span style="color:#000000;">
                …

            执行将数据写入数据库等操作

        }  

    }</span></pre> 
 </div> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p>      这样，就实现了将支付信息传回网站的功能。注：当交易状态发生改变时，paypal也会返回一个ipn，比如完成支付，退款等等。</p> 
 <p> </p> 
 <p>      介绍一下sandbox中IPN测试工具，登陆sandbox主帐号，就是你在sandbox上注册的那个，不是那些卖家/买家帐号。</p> 
 <p>      选择Test Tools -&gt; Instant Payment Notification (IPN) Simulator：</p> 
 <p> </p> 
 <p>      输入你的ipn接受文件地址，选择ipn信息的方式，然后会让你填具体信息内容，再点击Send IPN，就能模拟一个ipn到你网站的页面，可以用来测试IPN是否正常工作。</p> 
 <p>     </p> 
 <p>     </p> 
 <p>      不过这个工具有个小BUG，就是发送的IPN里不包括contact_phone这个变量，但是实际的IPN里是有的，这里要注意一下。</p> 
 <p>      注：可以在商家帐号的Profile -&gt; Selling Preferences -&gt;Website Payment Preferences中，选择Contact Telephone Number这一栏，来确定是否需要发送买家联系电话。</p> 
 <p>     </p> 
 <p> </p> 
 <p>      通过IPN，你的网站就开始从真正意义上的集成了Paypal。</p> 
 <p>      这篇文章写得有些仓促，如有疑问可以发送邮件到：chenchen[at]ndwork.com  用@替换[at]。</p> 
 <p>      下一次我会讲PDT方式，这个比IPN简单很多。</p> 
 <p> </p> 
 <p> </p> 
 <p>Paypal国际版网站集成简易教程（四）：PDT的使用</p> 
 <p> </p> 
 <p> </p> 
 <p> 引用内容</p> 
 <p> </p> 
 <p>什么是PDT</p> 
 <p>PDT是一个安全获取付款明细的方式。在买家付完款后，卖家可以通过此方式即时获取付款明细并显示给买家看。</p> 
 <p>      暑假时候写了前面三篇文章，后来去电视台打工了，帮他们上了一个人居博览会，再接着就开学了，又在杭州、温州、宁波跑来跑去。一直不能静下来继续写，现在工作又没啥着落哈。</p> 
 <p>      今天难得有感觉想写了，不知道是不是中午牛排的威力，趁机会就快点写吧。</p> 
 <p> </p> 
 <p>     </p> 
 <p> </p> 
 <p>      上图是PDT的流程示意。</p> 
 <p>      1.首先买家付款后通过事先设定好的返回url（return）回到您的网站。</p> 
 <p>      2.接着paypal在返回url后面加上tx变量，即交易号。</p> 
 <p>      3.然后网站将收到的tx和您的令牌（paypal账户里申请）发回paypal。</p> 
 <p>      4.paypal验证令牌通过后，将交易明细发回网站。</p> 
 <p>      5.最后网站将交易明细显示给客户。</p> 
 <p> </p> 
 <p> </p> 
 <p class="a0"><strong>目   </strong><strong>录</strong></p> 
 <p> </p> 
 <p>1 注册您的PayPal帐号.... 2</p> 
 <p>2 创建“Buy Now”按钮.... 2</p> 
 <p>3 创建“Shopping Cart”按钮.... 4</p> 
 <p>3.1 创建“Add to Cart”按钮... 4</p> 
 <p>3.2 创建“Upload Cart”按钮... 6</p> 
 <p>4 加密网站付款EWP.. 9</p> 
 <p>4.1 使用加密网站付款的先决条件... 9</p> 
 <p>4.2 创建加密按钮... 12</p> 
 <p>5 附录1: 参考文档及网站.... 19</p> 
 <p>6 附录2：PayPal目前支持的货币列表.... 20</p> 
 <p>7 附录3：常见问题.... 21</p> 
 <p>8 附录4：标准变量列表.... 22</p> 
 <p>9 附录6：国家或地区ISO3166代码.... 29</p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <h2>1 注册您的PayPal帐号</h2> 
 <p class="a0">如果您已经有PayPal账户了，那恭喜您，您可以直接跳过这部分。</p> 
 <p class="a0">如果还没有PayPal账户，那您可以通过https://www.paypal.com访问主页，如图1-1所示，点击 “Sign Up”或“Sign Up Now”按钮立即注册一个PayPal账户。如需帮助，您可以点击主页上方的“帮助”按钮或在您的浏览器中输入</p> 
 <p class="a0">https://www.paypal.com/cgi-bin/webscr?cmd=_help-ext&amp;source_page=_home<br> 获取帮助。</p> 
 <p class="a0"> </p> 
 <p class="a1">图1-1 PayPal主页</p> 
 <p class="a0">注册完以后，您就可以开始您的PayPal之旅了！</p> 
 <h2>2 创建“Buy Now”按钮</h2> 
 <p class="a0">PayPal可以让您轻松地通过您的网站接受单件物品的付款。“Buy Now”(立即购买)按钮可以在几分钟内实施，让来自PayPal数百万用户的商家和捐赠人以及网络上的任何其他买家轻松访问您的网站。</p> 
 <p class="a0">那如何在您自己的网站上创建一个“Buy Now”按钮呢？很简单，如图2-1，这里我们集成了PayPal 的“Buy Now”按钮；</p> 
 <p align="center"> </p> 
 <p class="a1">图2-1 立即购买Buy Now示例</p> 
 <p class="a0"> </p> 
 <p class="a0">创建这个“Buy Now”按钮有两种方法：</p> 
 <p class="a0"><strong>方法1</strong><strong>－登陆PayPal</strong><strong>网站自动创建</strong></p> 
 <p class="a0">您可以通过登陆PayPal网站自动为您创建“Buy Now”按钮。创建方法请参考 “PayPal网站付款标准版交易方式确认集成指南”（以下简称“集成指南”，下载方法见附录1）文档。</p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>方法2</strong><strong>－用网页编辑器直接编写代码</strong></p> 
 <p class="a0">利用您喜欢的网页编辑器（如DreamWeaver）直接编辑HTML代码，在您想要出现“Buy Now”按钮的位置上插入以下示例代码：</p> 
 <table style="width:572px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="23"> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p> </p> <p>10</p> </td><td width="549"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_xclick"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p>&lt;input type="hidden" name="item_name" value="<strong>SIGMA SD1000</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount" value="<strong>399.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="hidden" name="lc" value="<strong>US</strong>"&gt;</p> <p>&lt;input type="hidden" name="return" value="<strong>http://www.yoursite.com/thanks.html</strong>"&gt;</p> <p>&lt;input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but23.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">其中：</p> 
 <p class="a0">n            第1、2、10行是必须且不可更改得；</p> 
 <p class="a0">n            第3行用于设置您得PayPal账户，即修改粗体部分（下同）；</p> 
 <p class="a0">n            第4，5行设置商品得属性，包括商品描述，价格；</p> 
 <p class="a0">n            第6行用于设置货币种类，关于货币描述请参考附录2；</p> 
 <p class="a0">n            第7行用于设置目标客户国家所在地，其值可参考附录6；</p> 
 <p class="a0">n            第8行用于设置客户付完款后返回您网站的地址，具体请参考PDT/IPN参考文档；</p> 
 <p class="a0">n            第9行在一般情况下无需改动。</p> 
 <p class="a0">除此之外，您可以根据实际需要增加、修改或删除一些变量。</p> 
 <p class="a0">所有“Buy Now”按钮可用变量您可以参考“集成指南”文档中“HTML示例与立即购买,捐赠和购物车变量”部分；也可以访问英文网站：</p> 
 <p class="a0">https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html</p> 
 <h2>3 创建“Shopping Cart”按钮</h2> 
 <p class="a0">如果您的网站还没有集成购物车功能，您可以通过创建“Add to Cart”按钮直接使用PayPal的购物车。</p> 
 <p class="a0">如果您的网站已经有自己的购物车或者已经集成了第三方购物车的功能，那您可以通过创建“Upload Cart”按钮将您的购物车明细上传给PayPal并通过PayPal进行付款；您也可以为已有购物车生成一个订单，并通过创建PayPal的“Buy Now”按钮进行付款（其中：商品名称可以为您的订单号，商品价格可以为订单总价）。</p> 
 <h3>3.1 创建“Add to Cart”按钮</h3> 
 <p class="a0">如图3-1所示，这里我们集成了PayPal“Add to Cart”按钮：</p> 
 <p align="center"> </p> 
 <p class="a1">图3-1 “Add to Cart”按钮</p> 
 <p class="a0">当点击“Add to Cart”按钮时，该商品即被加入到您的PayPal购物车里，如图3-2所示：</p> 
 <p align="center"> </p> 
 <p class="a1">图3-2 PayPal购物车详情</p> 
 <p class="a0">创建“添加到购物车”按钮有两种方法：</p> 
 <p class="a0"><strong>方法1</strong><strong>－登陆PayPal</strong><strong>网站自动创建</strong></p> 
 <p class="a0">您可以通过登陆PayPal网站自动为您创建“添加到购物车”按钮。创建方法请参考“集成指南”文档中“创建购物车按钮（第37页）”部分。</p> 
 <p class="a0"><strong>方法2</strong><strong>－用网页编辑器直接编写代码</strong></p> 
 <p class="a0">利用您喜欢的网页编辑器（如DreamWeaver）直接编辑HTML代码，在您想要出现“添加到购物车”按钮的位置上插入以下代码：</p> 
 <table style="width:583px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="31"> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p> </p> <p>11</p> </td><td width="552"> <p>&lt;form target="paypal" action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_cart"&gt;</p> <p>&lt;input type="hidden" name="add" value="1"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p>&lt;input type="hidden" name="item_name" value="<strong>PPShopping Cart Example</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount" value="<strong>99.99</strong>"&gt;</p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="hidden" name="lc" value="<strong>US</strong>"&gt;</p> <p>&lt;input type="hidden" name="return" value="<strong>http://www.yoursite.com/thanks.html</strong>"&gt;</p> <p>&lt;input type="image" src=<a href="https://www.paypal.com/en_US/i/btn/sc-but-01.gif" rel="nofollow">https://www.paypal.com//en_US/i/btn/sc-but-01.gif</a><br>  border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">其中：</p> 
 <p class="a0">n            第1、2、3、11行是必须且不可更改得；</p> 
 <p class="a0">n            第4行用于设置您得PayPal账户；</p> 
 <p class="a0">n            第5，6行设置商品得属性，包括商品描述及价格；</p> 
 <p class="a0">n            第7行用于设置货币种类，关于货币描述请参考附录2；</p> 
 <p class="a0">n            第8行用于设置目标客户国家所在地，其值可参考附录6；</p> 
 <p class="a0">n            第9行用于设置客户付完款后返回您网站的地址，具体请参考PDT/IPN文档；</p> 
 <p class="a0">n            第10行在一般情况下无需改动。</p> 
 <p class="a0">除此之外，您可以根据实际需要增加、修改或删除一些变量。</p> 
 <p class="a0">所有“添加购物车”按钮可用变量您可以参考“集成文档”中“HTML示例与立即购买,捐赠和购物车变量”部分；也可以访问网址：</p> 
 <p class="a0"><a href="https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html" rel="nofollow">https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html</a></p> 
 <p> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            若要显示当前购物车信息，您只需将<br> &lt;input type="hidden" name="add" value="1"&gt;<br> 改为<br> &lt;input type="hidden" name="display" value="1"&gt;<br> 若上面两句同时存在，则只显示当前购物车信息；</p> 
 <p class="a0">n            在FORM里需设置target="paypal"以使购物页面和购物车页面分开；</p> 
 <h3>3.2 创建“Upload Cart”按钮</h3> 
 <p class="a0">若您的网站已经有自己的购物车或已经集成了第三方购物车，如图3-3所示，那您可以通过创建“上传购物车”按钮将购物车详细信息上传给PayPal，然后通过PayPal来进行付款。</p> 
 <p align="center"> </p> 
 <p class="a1">图3-3 第三方购物车</p> 
 <p class="a0">在您的购物车页面适合的位置上插入以下代码：</p> 
 <table style="width:572px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="23"> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p> </p> <p>18</p> </td><td width="549"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_cart"&gt;</p> <p>&lt;input type="hidden" name="upload" value="1"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="item_name_1" value="<strong>San Francisco</strong><strong> Bay</strong><strong>(32'X32')</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount_1" value="<strong>250.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="quantity_1" value="<strong>1</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="item_name_2" value="<strong>Mount Hamilton</strong><strong>(24'x15')</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount_2" value="<strong>50.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="quantity_2" value="<strong>1</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="hidden" name="lc" value="<strong>US</strong>"&gt;</p> <p>&lt;input type="hidden" name="return" value="<strong>http://www.yoursite.com/thanks.html</strong>"&gt;</p> <p>&lt;input type="submit" value="Upload Cart" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">其中：</p> 
 <p class="a0">n            第1、2、3、18行是必须且不可更改得；</p> 
 <p class="a0">n            第4行用于设置您得PayPal账户；</p> 
 <p class="a0">n            第6～8、10～12行分别设置了商品1，2得属性，包括商品描述，商品价格及数量；如需添加更多商品，可照此类推；</p> 
 <p class="a0">n            第14行用于设置货币种类，关于货币描述请参考附录2；</p> 
 <p class="a0">n            第15行用于设置目标客户国家所在地，其值可参考附录6；</p> 
 <p class="a0">n            第16行用于设置客户付完款后返回您网站的地址，具体请参考PDT/IPN文档部分；</p> 
 <p class="a0">n            第17行在一般情况下无需改动。</p> 
 <p class="a0">除此之外，您可以根据实际需要增加、修改或删除一些变量。</p> 
 <p class="a0">点击“Upload Cart”后，将显示PayPal支付页面，如图3-4所示：</p> 
 <p align="center"> </p> 
 <p class="a1">图3-4 用PayPal支付您的购物车</p> 
 <p class="a0">点击图3-4蓝色倒三角则可以显示此次购物车的详情，如图3-5所示：</p> 
 <p align="center"> </p> 
 <p class="a1">图3-5 PayPal购物车详情</p> 
 <p class="a0">所有“上传购物车”按钮可用变量您可以参考“集成指南”文档中“HTML示例与立即购买,捐赠和购物车变量”部分；也可以访问网址</p> 
 <p class="a0">https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html</p> 
 <p> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            若变量“quantity_<strong>X</strong>”没有设置，则默认为1；</p> 
 <h2>4 加密网站付款EWP</h2> 
 <p class="a0">在第二章和第三章，我们列举了很多PayPal 付款按钮的实例代码。很明显，这些代码中的一些关键信息，如PayPal账户、金额等都是未经过加密的，根据实际需要，您可以对这些信息进行加密；目前，PayPal提供了基于.NET和JAVA的加密示例，使用方法如下：</p> 
 <h3>4.1 使用加密网站付款的先决条件</h3> 
 <p class="a0">在使用加密的网站付款之前，您必须：</p> 
 <p class="a0">n            生成一个私钥；</p> 
 <p class="a0">n            生成一个公共证书；</p> 
 <p class="a0">n            将您的公共证书上传到PayPal网站；</p> 
 <p class="a0">n            下载PayPal的公共证书。</p> 
 <p class="a0">关于私钥和公共证书的定义您可以参考“集成指南”文档中“加密的网站付款/密钥和证书”部分；</p> 
 <p class="a0"><strong>第1</strong><strong>步－创建您的公共证书</strong></p> 
 <p class="a0"><strong>下载OpenSSL</strong><strong>并安装</strong></p> 
 <p class="a0">对于windows用户，您可以从http://www.openssl.org/related/binaries.html或http://www.slproweb.com/products/Win32OpenSSL.html直接下载OpenSSL for Windows，下载完后直接安装，安装时建议您安装在某个盘的根目录下，如c:\OpenSSL。</p> 
 <p class="a0">对于非windows用户，您可以从http://www.openssl.org/source下载您需要的版本，然后根据您实际的操作系统进行编译安装，示例如下：</p> 
 <table style="width:272px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="272"> <p>Login as root.</p> <p>Shell&gt; tar –gz **.tar.gz</p> <p>Shell&gt; config</p> <p>Shell&gt; make</p> <p>Shell&gt; make install</p> </td></tr></tbody></table> 
 <p class="a0">创建私钥和公共证书；</p> 
 <p class="a0">使用OpenSSL程序，输入以下命令创建您的私钥。该命令生成一个1024位的RSA私钥。该私钥存储在文件&lt;basename&gt;-prvkey.pem中：</p> 
 <p class="a0"><strong>OpenSSL genrsa -out &lt;basename&gt;-prvkey.pem 1024</strong></p> 
 <p class="a0">使用OpenSSL程序，输入以下命令创建您的公共证书。该命令在文件&lt;basename&gt;-pubcert.pem中生成公共证书：</p> 
 <p class="a0"><strong>OpenSSL req –new –key &lt;basename&gt;-prvkey.pem –x509 –days 365 –out <br> &lt;basename&gt;–pubcert.pem</strong></p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            OpenSSL 在OpenSSL得安装目录得bin下，若是在非windows操作系统中，请注意大小写和路径；</p> 
 <p class="a0">n            您可以将&lt;basename&gt;改写成您想要的名字；</p> 
 <p class="a0">n            对于windows用户来说，您也可以从<br><a href="https://www.paypal.com/en_US/dwnloads/windows.zip" rel="nofollow">https://www.paypal.com/en_US/dwnloads/windows.zip</a><br> 或https://www.paypal.com/en_US/dwnloads/java.zip下载PayPal为常用的开发环境提供的示例代码，其中均包含了文件“key.bat”，下载并解压后编辑该文件，设置好正确的OpenSSL路径，然后在命令行执行命令“key &lt;basename&gt;”即可生成您的私钥和公共证书，示例如下：<br><strong>C:\paypal\coding\windows\key &lt;basename&gt;<br><br></strong></p> 
 <p class="a0"><strong>创建PKCS12</strong><strong>文件（适用于后面用JAVA</strong><strong>生成加密代码）</strong></p> 
 <p class="a0">要创建PKCS12文件，输入下面OpenSSL命令，该命令在文件&lt;basename&gt;-prvkey.p12 中生成PKCS12文件：</p> 
 <p class="a0"><strong>OpenSSl pkcs12 -export -inkey &lt;basename&gt;-prvkey.pem –in <br> &lt;basename&gt;-pubcert.pem -out &lt;basename&gt;-prvkey.p12</strong></p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            执行此命令时，将会提示您输入密码，请记住此密码，下面用JAVA生成加密代码时将会提示您输入此密码。</p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>第2</strong><strong>步－上传您的公共证书</strong></p> 
 <p class="a0">1)    登录到您的PayPal企业或高级账户；</p> 
 <p class="a0">2)    点击“<strong>Profile</strong>”子选项卡；</p> 
 <p class="a0">3)    从右侧菜单中点击“<strong>Encrypted payment Settings</strong>”链接；</p> 
 <p class="a0">4)    点击“<strong>Add</strong>”；</p> 
 <p class="a0">5)    在窗口“<strong>Add Certificate</strong>”点击“<strong>浏览</strong><strong>…</strong>”并选择您上面创建的公共证书。</p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            公共证书必须为PEM格式,如上面的&lt;basename&gt;-pubcert.pem。</p> 
 <p class="a0"> </p> 
 <p class="a0">如果您的公共证书上传成功，它将出现在您的公共证书下的下一个屏幕上，如图4-1所示，您可以得到一个唯一的公共证书号(Cert ID)：</p> 
 <p align="center"> </p> 
 <p class="a1">图4-1 公共证书示例</p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            请记住这个证书号，此证书号将在后面生成加密代码时使用；</p> 
 <p class="a0">n            一个PayPal账户最多可以获取6个不同的证书号。</p> 
 <p class="a0"> </p> 
 <p class="a0"><strong>第3</strong><strong>步－下载PayPal</strong><strong>的公共证书</strong></p> 
 <p class="a0">1)    登录到您的PayPal企业或高级账户；</p> 
 <p class="a0">2)    点击“<strong>Profile</strong>”子选项卡；</p> 
 <p class="a0">3)    点击右侧菜单中 “<strong>Encrypted payment Settings</strong>”链接；</p> 
 <p class="a0">4)    点击“<strong>PayPal Public Certificate</strong>”下的“Download”按钮；</p> 
 <p class="a0"> </p> 
 <h3>4.2 创建加密按钮</h3> 
 <p class="a0">在进行创建加密按钮之前，我们必须将原来HTML代码中付款数据部分转换成一个字符串形式，字符串按格式&lt;variable_name&gt;=&lt;value&gt;组成，变量与变量之间用“,”隔开，具体情况举例如下：</p> 
 <p class="a0">1)    立即购买 / Buy Now</p> 
 <p class="a0">假设原来“Buy Now”按钮的数据部分如下：</p> 
 <table style="width:552px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="552"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_xclick"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p>&lt;input type="hidden" name="item_name" value="<strong>SIGMA SD1000</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount" value="<strong>399.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but23.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">则我们可以把它转换成：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="560"> <p>cmd=_xclick,business=paypal@yoursite.com,item_name=SIGMASD1000,currency_code=USD,amount=399.00,cert_id=<strong>&lt;</strong><strong>证书号</strong><strong>&gt;</strong></p> </td></tr></tbody></table> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            请将&lt;证书号&gt;替换成您自己的证书号，如上面一个证书号是“4UXSJFDZ8A2PL”则在这“cert_id=&lt;证书号&gt;”就写成“cert_id=4UXSJFDZ8A2PL”；</p> 
 <p class="a0">n            其中cmd=_xclick, business, item_name, amount及cert_id是必须的。</p> 
 <p class="a0"> </p> 
 <p class="a0">2)    添加到购物车 / Add to Cart</p> 
 <p class="a0">假设原来“Add to Cart”按钮的数据部分如下：</p> 
 <table style="width:552px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="552"> <p>&lt;form target="paypal" action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_cart"&gt;</p> <p>&lt;input type="hidden" name="add" value="1"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p>&lt;input type="hidden" name="item_name" value="<strong>PPShopping Cart Example</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount" value="<strong>99.99</strong>"&gt;</p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="image" src="https://www.paypal.com//en_US/i/btn/sc-but-01.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">则我们可以把它转换成：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="560"> <p>cmd=_cart,add=1,business=paypal@yoursite.com,item_name=PPShoppingCartExample,currency_code=USD,amount=99.99,cert_id=<strong>&lt;</strong><strong>证书号</strong><strong>&gt;</strong></p> </td></tr></tbody></table> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            请将&lt;证书号&gt;替换成您自己的证书号，如上面一个证书号是“4UXSJFDZ8A2PL”则在这“cert_id=&lt;证书号&gt;”就写成“cert_id=4UXSJFDZ8A2PL”；</p> 
 <p class="a0">n            其中cmd=_xclick, add, business, item_name, amount及cert_id是必须的。</p> 
 <p class="a0"> </p> 
 <p class="a0">3)    上传购物车 / Upload Cart</p> 
 <p class="a0">假设原来“Upload Cart”按钮的数据部分如下：</p> 
 <table style="width:552px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="552"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_cart"&gt;</p> <p>&lt;input type="hidden" name="upload" value="1"&gt;</p> <p>&lt;input type="hidden" name="business" value="<strong>paypal@yoursite.com</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="item_name_1" value="<strong>San Francisco</strong><strong> Bay</strong><strong>(32'X32')</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount_1" value="<strong>250.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="quantity_1" value="<strong>1</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="item_name_2" value="<strong>Mount Hamilton</strong><strong>(24'x15')</strong>"&gt;</p> <p>&lt;input type="hidden" name="amount_2" value="<strong>50.00</strong>"&gt;</p> <p>&lt;input type="hidden" name="quantity_2" value="<strong>1</strong>"&gt;</p> <p> </p> <p>&lt;input type="hidden" name="currency_code" value="USD"&gt;</p> <p>&lt;input type="submit" value="Upload Cart" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">则我们可以把它转换成：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="560"> <p>cmd=_cart,upload=1,business=paypal@yoursite.com,item_name_1=SanFranciscoBay(32’x32’),amount_1=250.00,quantity_1=1,item_name_2=MountHamilton(24’x15’),amount_2=1,quantity_2=1,,currency_code=USD,cert_id=<strong>&lt;</strong><strong>证书号</strong><strong>&gt;</strong></p> </td></tr></tbody></table> 
 <p class="a0"> </p> 
 <p class="a0"><strong>【注】</strong></p> 
 <p class="a0">n            请将&lt;证书号&gt;替换成您自己的证书号，如上面一个证书号是“4UXSJFDZ8A2PL”则在这“cert_id=&lt;证书号&gt;”就写成“cert_id=4UXSJFDZ8A2PL”；</p> 
 <p class="a0">n            其中cmd=_xclick, upload, business及cert_id是必须的。</p> 
 <p class="a0"> </p> 
 <p class="a0">在生成加密数据字符串后，下面我们介绍如何在C#和JAVA中通过程序生成加密按钮。</p> 
 <p class="a0">4.2.1 用C＃生成加密按钮</p> 
 <p class="a0">1)    用PayPal提供的示例代码生成单个按钮</p> 
 <p class="a0">从https://www.paypal.com/en_US/dwnloads/windows.zip下载windows.zip，解压后在Visual .NET环境中编译，里面包含了ButtonEncryptionLib和ButtonEncryptionLibTest两个工程。其中ButtonEncryptionLib用于生成加密按钮的DLL，这个要求系统已经安装了OpenSSL for Windows；ButtonEncryptionLibTest则会引用前者生成的DLL编译一个可执行文件PPEncrypt，此文件即可用于加密单个按钮，您可以在目录ButtonEncryptionLibTest\bin\Debug下找到。</p> 
 <p class="a0"><strong>生成加密按钮步骤</strong></p> 
 <p class="a0">将您的私钥、公共证书和PayPal的公共证书拷贝到与PPEncrypt同一个目录下；运行下面的命令即可生成加密内容；</p> 
 <p class="a0"><strong>PPEncrypt &lt;CertFile&gt; &lt;PrivKeyFile&gt; &lt;PPCertFile&gt; &lt;CmdTxt&gt; &lt;OutputFile&gt; [Sandbox]</strong></p> 
 <p class="a0">其中:</p> 
 <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td width="168"> <p class="a0"><strong>&lt;CertFile&gt;</strong></p> </td><td width="185"> <p class="a0">您的公共证书文件名</p> </td></tr><tr><td width="168"> <p class="a0"><strong>&lt;PrivKeyFile&gt;</strong></p> </td><td width="185"> <p class="a0">您的私钥文件名</p> </td></tr><tr><td width="168"> <p class="a0"><strong>&lt;PPCertFile&gt;</strong></p> </td><td width="185"> <p class="a0">PayPal的公共证书文件名</p> </td></tr><tr><td width="168"> <p class="a0"><strong>&lt;CmdTxt&gt;</strong></p> </td><td width="185"> <p class="a0">加密的字符串命令行</p> </td></tr><tr><td width="168"> <p class="a0"><strong>&lt;OutputFile&gt;</strong></p> </td><td width="185"> <p class="a0">输出HTML代码的文件名</p> </td></tr><tr><td width="168"> <p class="a0"><strong>[Sandbox]</strong></p> </td><td width="185"> <p class="a0">在PayPal测试环境中生成</p> </td></tr></tbody></table> 
 <p class="a0">比如：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>PPEncrypt my-pubcert.pem my-prvkey.pem paypal_pubcert.pem<br> “cmd=_xclick,business=paypal@yoursite.com,return=http://www.yoursite.com/thankyou.htm,item_name=itemname,currency_code=USD,amount=99.99,invoice=I20050101004,cancel_return=http://www.yoursite.com/cancel.htm,cert_id=4UXSJFDZ8A2PL" button.html</p> </td></tr></tbody></table> 
 <p class="a0">打开生成文件&lt;OutputFile&gt;（这里为button.html），将里面加密的FORM内容复制到您需要付款的页面中即可。</p> 
 <p class="a0">&lt;OutputFile&gt;的样本如下：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_s-xclick"&gt;</p> <p>&lt;input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but23.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----</p> <p>MIIHTwYJKoZIhvcNAQcEoIIHQDCCBzwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQw</p> <p>… …</p> <p>1C7YhvLqslFdnUfeI8RR5vqQpvr4pHUwjEsAz3m/ZAO6/Riqo7/JimpWHjMDbZzR</p> <p>F91ttNhph8Ts22CfoAckT5tEPCG9G/iM0oPLfMFl8L2mCQhzHN02nEYU6080z9N0Zfd9</p> <p>-----END PKCS7-----</p> <p>"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p class="a0">2)    集成PayPal加密按钮到您的.Net/C#环境中</p> 
 <p class="a0">a.    在OpenSSL目录下您可以找到文件libeay32.dll和ssleay32.dll，将这两个文件复制到&lt;windir&gt;\system32下；</p> 
 <p class="a0">b.    将上面由ButtonEncryptionLib工程编译成的ButtonEncryptionLib.dll复制到您的.Net/C#工程中，并通过“添加引用”将此DLL添加到您当前的工程里；</p> 
 <p class="a0">c.    将您的私钥、公共证书和PayPal的公共证书拷贝到该工程下一个目录中，如&lt;YOUR_CSHARP_PROJECT_PATH&gt;\cert ；</p> 
 <p class="a0">d.    在需要添加“生成加密按钮”的地方引用该组件，示例代码如下：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="500"> <p>//申明一个ButtonEncryption用于加密字符串</p> <p>ButtonEncryption buttonenc = new ButtonEncryption(true);</p> <p>string sResult = "";</p> <p>//获取所有证书存放的路径</p> <p>string VPath = Page.Server.MapPath(HttpContext.Current.Request.ApplicationPath + "/cert/");</p> <p>string sCmdTxt = "cmd=_xclick,cert_id=XXXX,buiness=paypal@yoursite.com...";</p> <p>string sCertFile = VPath + "your-pubcert.pem";</p> <p>string sPrivKeyFile = VPath + "your-prvkey.pem";</p> <p>string sPPCertFile = VPath + "paypal_cert_pem.txt";</p> <p>//生成加密字符串到sEncryption</p> <p>string sEncryption = buttonenc.SignAndEncrypt(sCmdTxt, sCertFile, sPrivKeyFile, sPPCertFile, ref sResult);</p> <p>string outString="";</p> <p>outString = outString +"&lt;form action=""https://www.paypal.com/cgi-bin/webscr"" method=""post""&gt;");</p> <p>outString = outString +"&lt;input type=""hidden"" name=""cmd"" value=""_s-xclick""&gt;" ;</p> <p>outString = outString +"&lt;input type=""image""<br> src=""https://www.paypal.com/en_US/i/btn/x-click-but23.gif"" border=""0""<br> name=""submit"" &gt;";</p> <p>outString = outString +"&lt;input type=""hidden"" name=""encrypted"" value=""" ;</p> <p>outString = outString + sEncryption;</p> <p>outString = outString +" ""&gt;&lt;/form&gt;" ;</p> <p>//outString输出的就是加密付款按钮的HTML代码</p> </td></tr></tbody></table> 
 <p class="a0"> </p> 
 <p class="a0">4.2.2 用JAVA生成加密按钮</p> 
 <p class="a0">在开始使用JAVA生成加密按钮之前，您必须做以下几个准备工作：</p> 
 <p class="a0">1)        下载并安装JDK，请参考<a href="http://java.sun.com/j2se/1.4.2/download.html" rel="nofollow">http://java.sun.com/j2se/1.4.2/download.html</a>；</p> 
 <p class="a0">2)        根据JDK的版本下载相对应的crypto，下载地址为<br> http://www.bouncycastle.org/latest_releases.html，下载后解压到某一个目录备用，记住此目录名（如 c:\crypto-124），用于后面的CRYPTO_HOME；</p> 
 <p class="a0">3)        从http://java.sun.com/products/jce/index.jsp或<br> http://java.sun.com/j2se/1.4.2/download.html下载Java(TM) Cryptography Extension(JCE)；解压JCE*.rar/.zip，并将其中local_policy.jar及<br> US_export_policy.jar覆盖至$JAVA_HOME\jre\lib\security目录中。</p> 
 <p class="a0"><strong>1&gt;  </strong><strong>用PayPal</strong><strong>提供的示例代码生成单个按钮</strong></p> 
 <p class="a0">从https://www.paypal.com/en_US/dwnloads/java.zip下载 java.zip，解压。</p> 
 <p class="a0">       生成单个加密按钮步骤如下：</p> 
 <ol><li>编辑其中的文件build-window.bat，设置CRYPTO_HOME为上面中CRYPTO解压的目录，如图4-2所示，修改好后保存并运行。运行后将自动编译该目录下的类ButtonEncryption以及com\paypal\crypto\sample\目录下所有java类；</li><li>将您的私钥、公共证书、PKCS12文件和PayPal的公共证书拷贝到一个指定的目录中，（这里我们将这些文件拷贝到与ButtonEncryption.class同一目录）；</li><li>运行下面的命令即可生成加密内容:<br> Java ButtonEncryption &lt;CertFile&gt; &lt;PrivKeyFile&gt; &lt;PPCertFile&gt; &lt;Password&gt; &lt;CmdTxt&gt; &lt;OutputFile&gt; [Sandbox]<br> 其中:</li></ol> 
 <table style="width:377px;" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td width="156"> <p class="a0"><strong>&lt;CertFile&gt;</strong></p> </td><td width="221"> <p class="a0">您的公共证书文件名</p> </td></tr><tr><td width="156"> <p class="a0"><strong>&lt;PrivKeyFile&gt;</strong></p> </td><td width="221"> <p class="a0">您的私钥文件名</p> </td></tr><tr><td width="156"> <p class="a0"><strong>&lt;PPCertFile&gt;</strong></p> </td><td width="221"> <p class="a0">PayPal的公共证书文件名</p> </td></tr><tr><td width="156"> <p class="a0"><strong>&lt;Password&gt;</strong></p> </td><td width="221"> <p class="a0">生成PKCS12文件时输入的密码</p> </td></tr><tr><td width="156"> <p class="a0"><strong>&lt;CmdTxt&gt;</strong></p> </td><td width="221"> <p class="a0">加密的字符串命令行</p> </td></tr><tr><td width="156"> <p class="a0"><strong>&lt;OutputFile&gt;</strong></p> </td><td width="221"> <p class="a0">输出HTML代码的文件名</p> </td></tr><tr><td width="156"> <p class="a0"><strong>[Sandbox]</strong></p> </td><td width="221"> <p class="a0">在PayPal测试环境中生成</p> </td></tr></tbody></table> 
 <p class="a0">比如：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>Java ButtonEncryption my-pubcert.pem my-prvkey.p12 paypal_pubcert.pem pwd<br> “cmd=_xclick,business=paypal@yoursite.com,return=http://www.yoursite.com/thankyou.htm,item_name=itemname,currency_code=CNY,amount=1.00,invoice=I20050101004,cancel_return=http://www.yoursite.com/cancel.htm,cert_id=4UXSJFDZ8A2PL" java_bn.html</p> </td></tr></tbody></table> 
 <ol><li>打开生成文件&lt;OutputFile&gt;（这里为java_bn.html），将里面加密的FORM内容复制到您需要付款的页面中即可。</li></ol> 
 <p class="a0">&lt;OutputFile&gt;的样本如下：</p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>&lt;form action="https://www.paypal.com/cgi-bin/webscr" method="post"&gt;</p> <p>&lt;input type="hidden" name="cmd" value="_s-xclick"&gt;</p> <p>&lt;input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but23.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!"&gt;</p> <p>&lt;input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----</p> <p>MIIHTwYJKoZIhvcNAQcEoIIHQDCCBzwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQw</p> <p>… …</p> <p>1C7YhvLqslFdnUfeI8RR5vqQpvr4pHUwjEsAz3m/ZAO6/Riqo7/JimpWHjMDbZzR</p> <p>F91ttNhph8Ts22CfoAckT5tEPCG9G/iM0oPLfMFl8L2mCQhzHN02nEYU6080z9N0Zfd9</p> <p>-----END PKCS7-----</p> <p>"&gt;</p> <p>&lt;/form&gt;</p> </td></tr></tbody></table> 
 <p> </p> 
 <p class="a0"><strong>2&gt;  </strong><strong>集成PayPal</strong><strong>加密按钮到您的JAVA</strong><strong>工程环境中</strong></p> 
 <ol><li>复制java.zip包中的整个com目录到您的工程中；</li><li>在您需要生成加密按钮的类里添加引用：</li></ol> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>import com.paypal.crypto.sample.*;</p> <p> </p> <p>import java.io.*;</p> <p>import java.security.InvalidAlgorithmParameterException;</p> <p>import java.security.KeyStoreException;</p> <p>import java.security.NoSuchAlgorithmException;</p> <p>import java.security.NoSuchProviderException;</p> <p>import java.security.Security;</p> <p>import java.security.UnrecoverableKeyException;</p> <p>import java.security.cert.CertStoreException;</p> <p>import java.security.cert.CertificateException;</p> <p>import org.bouncycastle.cms.CMSException;</p> </td></tr></tbody></table> 
 <ol><li>然后通过下面的示例代码即可生成加密数据：</li></ol> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="536"> <p>Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider());</p> <p>try{<!-- --></p> <p>//先申明变量PrivkeyFile CertFile PPCertPath Password CmdText</p> <p>//这些变量的定义可以参考上面</p> <p>private static String PrivkeyFile = null;</p> <p>private static String CertFile = null;</p> <p>private static String PPCertPath = null;</p> <p>private static String Password = "password";</p> <p>private static String CmdText = null;</p> <p>//cmd=_xclick,business=paypal@yoursite.com,amount=1.00</p> <p>//TODO:初始化变量PrivkeyFile CertFile PPCertPath Password CmdText</p> <p>//……</p> <p> </p> <p>//申明一个ClientSide，其中PrivkeyFile CertFile PPCertPath Password CmdText</p> <p>ClientSide client_side = new ClientSide(PrivkeyFile,CertFile,PPCertPath,Password);</p> <p>//生成加密数据</p> <p>String result = client_side.getButtonEncryptionValue( CmdText, PrivkeyFile, CertFile, PPCertPath, Password );</p> <p>//生成加密付款按钮的HTML代码</p> <p>StringBuffer sbResult = new StringBuffer(“”);</p> <p>sbResult.append("&lt;form action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\"&gt;" ); </p> <p>sbResult.append("&lt;input type=\"hidden\" name=\"cmd\" value=\"_s-xclick\"&gt;" );</p> <p>sbResult.append("&lt;input type=\"image\" <br> src=\"https://www.paypal.com/en_US/i/btn/x-click-but23.gif\" border=\"0\"<br>  name=\"submit\" " );</p> <p>sbResult.append ("alt=\"Make payments with PayPal - it's fast, free and secure!\"&gt;" );</p> <p>sbResult.append("&lt;input type=\"hidden\" name=\"encrypted\" value=\"" );</p> <p>sbResult.append( result );</p> <p>sbResult.append( "\"&gt;&lt;/form&gt;");</p> <p>//通过调用sbResult.toString()即可输出加密付款按钮的HTML代码</p> <p>//以下为捕获意外事件</p> <p>}catch(NoSuchAlgorithmException e){<!-- --></p> <p>e.printStackTrace();</p> <p>}catch(NoSuchProviderException e){<!-- --></p> <p>e.printStackTrace();</p> <p>}catch(IOException e){<!-- --></p> <p>e.printStackTrace();</p> <p>}catch(CMSException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}catch(CertificateException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}catch(KeyStoreException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}catch(UnrecoverableKeyException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}catch(InvalidAlgorithmParameterException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}catch (CertStoreException e){<!-- --></p> <p>       e.printStackTrace();</p> <p>}</p> </td></tr></tbody></table> 
 <p class="a0"> </p> 
 <h2>5 附录1: 参考文档及网站</h2> 
 <p class="a0">n            PayPal网站付款标准版交易方式确认集成指南</p> 
 <p class="a0">【中文版】<br> https://www.paypal.com/zh_CN/pdf/PP_WebsitePaymentsStandard_IntegrationGuide.pdf</p> 
 <p class="a0">【英文版】<br> https://www.paypal.com/en_US/pdf/PP_WebsitePaymentsStandard_IntegrationGuide.pdf</p> 
 <p class="a0">n            订单管理集成指南</p> 
 <p class="a0">【中文版】<br> https://www.paypal.com/zh_CN/pdf/PP_OrderManagement_IntegrationGuide.pdf</p> 
 <p class="a0">【英文版】<br> https://www.paypal.com/en_US/pdf/PP_OrderManagement_IntegrationGuide.pdf</p> 
 <p class="a0">n            PayPal集成中心<a href="https://www.paypal.com/IntegrationCenter/ic_home.html" rel="nofollow">https://www.paypal.com/IntegrationCenter/ic_home.html</a></p> 
 <p class="a0">n            标准标量列表 <br><a href="https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html" rel="nofollow">https://www.paypal.com/IntegrationCenter/ic_std-variable-reference.html</a></p> 
 <p class="a0">n            IPN和PDT变量列表 <br> https://www.paypal.com/IntegrationCenter/ic_ipn-pdt-variable-reference.html</p> 
 <p class="a0">n            加密按钮 https://www.paypal.com/IntegrationCenter/ic_button-encryption.htm</p> 
 <p class="a0">n            英文论坛搜索 http://paypal.forums.liveworld.com/search.jspa?objID=c1</p> 
 <p class="a0">n            按钮示例网站 http://paypaltech.com/demo_site/</p> 
 <p class="a0">n            IPN代码生成器<br> http://paypaltech.com/content/index.php?option=com_content&amp;task=view&amp;id=25&amp;Itemid=49</p> 
 <p class="a0">n            EWP for PHP http://paypaltech.com/Stephen/encode/index.php</p> 
 <p class="a0">n            PEM和P12的转换器<br> http://paypaltech.com/content/index.php?option=com_content&amp;task=view&amp;id=21&amp;Itemid=42</p> 
 <h2>6 附录2：PayPal目前支持的货币列表</h2> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="82"> <p align="center">货币代号</p> </td><td width="290"> <p align="center">货币名称</p> </td></tr><tr><td width="82"> <p align="center"><strong>USD</strong></p> </td><td width="290"> <p>U.S. Dollars</p> </td></tr><tr><td width="82"> <p align="center"><strong>AUD</strong></p> </td><td width="290"> <p>Australian Dallars</p> </td></tr><tr><td width="82"> <p align="center"><strong>CAD</strong></p> </td><td width="290"> <p>Canaidan Dollars</p> </td></tr><tr><td width="82"> <p align="center"><strong>CZK</strong></p> </td><td width="290"> <p>Czech Korunna</p> </td></tr><tr><td width="82"> <p align="center"><strong>DKK</strong></p> </td><td width="290"> <p>Danish Kroner</p> </td></tr><tr><td width="82"> <p align="center"><strong>EUR</strong></p> </td><td width="290"> <p>Euros</p> </td></tr><tr><td width="82"> <p align="center"><strong>HKD</strong></p> </td><td width="290"> <p>Hong Kong Dollars</p> </td></tr><tr><td width="82"> <p align="center"><strong>HUF</strong></p> </td><td width="290"> <p>Hungarian Forint</p> </td></tr><tr><td width="82"> <p align="center"><strong>NZD</strong></p> </td><td width="290"> <p>New Zealand Dollars</p> </td></tr><tr><td width="82"> <p align="center"><strong>NOK</strong></p> </td><td width="290"> <p>Norwegian Kroner</p> </td></tr><tr><td width="82"> <p align="center"><strong>PLN</strong></p> </td><td width="290"> <p>Polish Zlotych</p> </td></tr><tr><td width="82"> <p align="center"><strong>GBP</strong></p> </td><td width="290"> <p>Pounds Sterling</p> </td></tr><tr><td width="82"> <p align="center"><strong>SGD</strong></p> </td><td width="290"> <p>Singapore Dollars</p> </td></tr><tr><td width="82"> <p align="center"><strong>SEK</strong></p> </td><td width="290"> <p>Swedish Kronor</p> </td></tr><tr><td width="82"> <p align="center"><strong>CHF</strong></p> </td><td width="290"> <p>Swiss Frances</p> </td></tr><tr><td width="82"> <p align="center"><strong>JPY</strong></p> </td><td width="290"> <p>Japan Yen</p> </td></tr></tbody></table> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <h2>7 附录3：常见问题</h2> 
 <p class="a0">n            若在您的“Buy Now”按钮中添加了变量“invoice”（订单标识号），则应保证每次付款中的“invoice”号码唯一；若重复付款，PayPal 将提示您，如下图所示：</p> 
 <p class="a0">n            在所有涉及到价格的变量中，其数值都只精确到小数点后面两位；若其中一个数值精确到两位以上或者格式不对时，PayPal将提示您发生错误，如下图所示：</p> 
 <p class="a0">n            如果您为您的网站付款流程页面定义了LOGO，则该LOGO图片必须存放在一个HTTPS服务器上，以避免出现一些安全警告，如下图所示：</p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <p class="a0"> </p> 
 <h2>8 附录4：标准变量列表</h2> 
 <p><strong>变量</strong><strong> cmd </strong><strong>的值</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="18%"> <p align="center"><strong>cmd </strong><strong>的值</strong></p> </td><td width="81%"> <p align="center"><strong>说明</strong></p> </td></tr><tr><td width="18%"> <p>_xclick</p> </td><td width="81%"> <p>“立即购买”和“捐赠”按钮。</p> </td></tr><tr><td width="18%"> <p>_cart</p> </td><td width="81%"> <p>“购物车” 按钮。</p> </td></tr><tr><td width="18%"> <p>_ext-enter</p> </td><td width="81%"> <p>预填充您的客户的PayPal注册表单。需要一个redirect_cmd 变量，其值应为 _xclick 。</p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>用于</strong><strong>IPN</strong><strong>的变量：</strong><strong> notify_url</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="60"> <p><strong>变量名</strong></p> </td><td width="374"> <p><strong>说明</strong></p> </td><td width="42"> <p><strong>必填/选填</strong></p> </td><td width="42"> <p><strong>字段长度</strong></p> </td></tr><tr><td width="60"> <p>notify_url</p> </td><td width="374"> <p>用于接受PayPal发送的关于即时付款通知的交易信息的URL。必须是有效的URL。</p> </td><td width="42"> <p>选填</p> </td><td width="42"> <p>255</p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>表单变量</strong><strong>: </strong><strong>物品信息</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>变量名</strong></p> </td><td width="404"> <p align="center"><strong>说明</strong></p> </td><td width="45"> <p align="center"><strong>必填</strong><strong>/</strong><strong>选填</strong></p> </td><td width="42"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="76"> <p>amount</p> </td><td width="404"> <p align="left">购物价格或金额，不包括运费、手续费或税费。如果在“立即购买”或者“捐赠”交易情况下省略，则由客户在购买时填写此值。</p> <p> •  立即“购买”或者“捐赠”交易情况下是选填</p> <p> •  “购物车”交易情况下是必填</p> </td><td width="45"> <p>请参考本行说明</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>item_name</p> </td><td width="404"> <p align="left">物品描述。如果在“立即购买”或者“捐赠”交易情况下省略，则客户将看到一个可以选择输入物品名称的栏目。</p> <p> •  立即“购买”或者“捐赠”交易情况下是选填</p> <p> •  “购物车”交易情况下是必填</p> </td><td width="45"> <p>请参考本行说明.</p> </td><td width="42"> <p>127</p> </td></tr><tr><td width="76"> <p>item_number</p> </td><td width="404"> <p align="left">可用于跟踪购买或捐赠的传递变量，在付款完成时传回给您。如果在“立即购买”或者“捐赠”交易情况下省略，则将没有变量传回给您。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>127</p> </td></tr><tr><td width="76"> <p>quantity</p> </td><td width="404"> <p align="left">物品数量。将金额、运费和税费乘以数量将得出付款总额。如果这是购物车交易，PayPal将附加物品数量（例如， quantity1、quantity2）。</p> <p><strong>提示：</strong>数量的值必须是正整数。不允许为空、零或负数。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>undefined_quantity</p> </td><td width="404"> <p>如果设置为 1，则允许买家修改数量。<br><strong>提示：</strong>这个变量只允许在“立即购买”或者“捐赠”交易情况下使用。 购物车交易不允许使用。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>on0</p> </td><td width="404"> <p>第一选项栏名称。如果省略，则将没有变量传回给您.</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>64</p> </td></tr><tr><td width="76"> <p>on1</p> </td><td width="404"> <p align="left">第二选项栏名称。如果省略，则将没有变量传回给您。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>64</p> </td></tr><tr><td width="76"> <p>os0</p> </td><td width="404"> <p align="left">第一组选项值。如果此选项通过文本框或单选按钮选中，则每个值均应不超过 64 个字符。如果该值由客户通过文本框输入，则上限为 200 个字符。如果省略，则不会传回给您任何变量。</p> <p><strong>提示：</strong>必须对 on0 进行定义，才能识别 os0。</p> </td><td width="45"> <p>选填<br> 请参考本行说明.</p> </td><td width="42"> <p>64 or 200</p> </td></tr><tr><td width="76"> <p>os1</p> </td><td width="404"> <p align="left">第二组选项值。如果此选项通过文本框或单选按钮选中，则每个值均应不超过 64 个字符。如果该值由客户通过文本框输入，则上限为 200 个字符。如果省略，则不会传回给您任何变量。</p> <p><strong>提示：</strong>必须对 on1 进行定义，才能识别 os1。</p> </td><td width="45"> <p>选填</p> <p>请参考本行说明.</p> </td><td width="42"> <p>64 or 200</p> </td></tr></tbody></table> 
 <p align="left"> </p> 
 <p><strong>表单变量</strong><strong>:</strong><strong>显示信息</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>名字</strong></p> </td><td width="404"> <p align="center"><strong>说明</strong></p> </td><td width="45"> <p align="center"><strong>必填/选填</strong></p> </td><td width="42"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="76"> <p>add</p> </td><td width="404"> <p>添加一个物品到PayPal购物车</p> <p>若“add”和“display”两个变量同时设置，则只显示当前购物车信息。</p> </td><td width="45"> <p>必填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>cancel_return</p> </td><td width="404"> <p align="left">指在付款取消的情况下，客户浏览器返回到的 URL 。例如，您的网站上显示“付款已取消”页面的 URL。如果省略，则用户将被带到PayPal网站。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>cbt</p> </td><td width="404"> <p align="left">设置“PayPal付款完成”页面上的“继续”按钮的文本。</p> <p><strong>提示：</strong>return 变量也需要被设置。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>60</p> </td></tr><tr><td width="76"> <p>cn</p> </td><td width="404"> <p>提示栏上的标签。该值不保存，而且不会出现在任何给您的通告中。如果省略，则将没有变量传回给您。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>40</p> </td></tr><tr><td width="76"> <p>cpp_header_image</p> </td><td width="404"> <p>将您选择的图片设置为显示在付款页面的左上角。该图片的最大尺寸为 750像素宽、90 像素高。有效的字符集为 URL 安全字符。由于图片不存储在我们的数据库上，所以 cpp_header_image 变量没有字符限制。建议您只提供存储在安全 (https) 服务器上的图片。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>无限制</p> </td></tr><tr><td width="76"> <p>cpp_headerback_color</p> </td><td width="404"> <p align="left">为付款页面标题设置背景色。有效的字符集为 6 字符 HTML 十六进制 ASCII代码。此变量不区分大小写。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>cpp_headerborder_color</p> </td><td width="404"> <p align="left">设置付款页面标题四周的边框颜色。边框是位于标题空间四周，粗细为 2 像素的方框，方框最大尺寸为 750 像素宽、90 像素高。有效的字符集为 6 字符HTML 十六进制 ASCII 代码。此变量不区分大小写。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>cpp_payflow_color</p> </td><td width="404"> <p align="left">为付款页面的标题以下区域设置背景色。有效的字符集为 6 字符 HTML 十六进制 ASCII 代码。此变量不区分大小写。</p> <p><strong>提示：</strong>不允许使用与贝宝错误信息相冲突的背景色。默认颜色为白色。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>cs</p> </td><td width="404"> <p align="left">设置您的付款页面的背景色。如果设为“1”，背景色将为黑色。如果省略</p> <p align="left">或设为“0”，背景色则为白色。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>display</p> </td><td width="404"> <p>显示当前PayPal购物车的物品信息。<br> 若“add”和“display”两个变量同时设置，则只显示当前购物车信息。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>image_url</p> </td><td width="404"> <p align="left">您希望在PayPal付款页面左上角的用作标识的 150x50 像素图片的 URL。必须是有效的URL。</p> <p>如果省略，则客户看到的是您的商家名称（如果您有企业账户）或您的电子邮件地址（如果您有高级账户）。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>no_note</p> </td><td width="404"> <p>为付款加入说明。如果省略或设为“0”，则会提示您的客户输入说明。如果设为“1”，则不会提示您的客户输入说明。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>no_shipping</p> </td><td width="404"> <p align="left">买家的送货地址。</p> <p align="left">省略或设为 0 = 提示客户输入收货地址。</p> <p align="left">1 = 不要求客户提供收货地址。</p> <p align="left">2 = 客户必须提供收货地址。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>page_style</p> </td><td width="404"> <p align="left">为与此按钮/ 链接相关的付款页面设置“自定义付款页面的样式”。</p> <p align="left">page_style 的值与添加或编辑页面样式时您选择的页面样式名称相同。</p> <p align="left">page_style 变量的最大长度为 30 个字符。</p> <p align="left">有效的字符集只能为小写 7 位字母数字 ASCII 字符，加下划线。不能包含空格。</p> <p align="left">如果您希望按钮/ 链接始终引用您设置为首选的样式，请将该变量设置为 "primary"。</p> <p align="left">如果您希望该按钮/ 链接始终引用默认的贝宝页面样式，请将该变量设置为 "paypal"。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>30</p> </td></tr><tr><td width="76"> <p>return</p> </td><td width="404"> <p align="left">指完成付款后客户的浏览器返回到的 URL 。 例如，在您的站点上显示“感谢您的付款” 的页面的 URL。</p> <p align="left">如果省略，则您的买家将被带到PayPal网站。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>rm</p> </td><td width="404"> <p align="left">付款完成后的返回 URL 的行为（“返回方法”）。</p> <p align="left"><strong>提示：</strong>rm变量只有在return变量被设置后才能生效。</p> <p align="left">如果省略或为 0，则 GET 方法用于没有启用即时付款通知的所有购物车交易，而 POST 方法用于所有其他交易。</p> <p align="left">如果为 1 并设置了 return，则客户的浏览器由 GET 方法返回至返回 URL，并且不提交任何交易变量。</p> <p>如果为 2 并设置了 return，则客户的浏览器由 POST 方法返回至返回URL，同时将所有可用交易变量发送至该 URL。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>表单变量</strong><strong>: </strong><strong>交易信息</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>名字</strong></p> </td><td width="404"> <p align="center"><strong>说明</strong></p> </td><td width="45"> <p align="center"><strong>必填/选填</strong></p> </td><td width="42"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="76"> <p>address_override</p> </td><td width="404"> <p align="left">如果设置为 1，通过预填充栏传送的地址将会覆盖用户的已存储地址。用户可以看到传送的地址，但是无法进行编辑。如果地址无效（例如，缺少必需的栏，包括国家或地区）或者没有包括地址，则不会显示地址。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>1</p> </td></tr><tr><td width="76"> <p>currency_code</p> </td><td width="404"> <p>付款货币。定义币种以标示货币变量（amount、shipping、shipping2、handling、tax）。如果省略，则所有货币字段将解释为美元。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>custom</p> </td><td width="404"> <p>永远不会向您的客户显示的传递变量。如果省略，则不会传回给您任何变量。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>256</p> </td></tr><tr><td width="76"> <p>handling</p> </td><td width="404"> <p align="left">手续费。并非根据数量而定。无论所购物品数量多少，均收取相同手续费。</p> <p>如果省略，则不收取手续费。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>invoice</p> </td><td width="404"> <p>您可以用于识别此次购物的帐单号码的传递变量。如果省略，则不会传回给您任何变量。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>127</p> </td></tr><tr><td width="76"> <p>redirect_cmd</p> </td><td width="404"> <p align="left">只有在cmd的值为“_ext-enter”，即账户注册的预填充时才有效。</p> <p>redirect_cmd 的唯一有效值是 _xclick.</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p>40</p> </td></tr><tr><td width="76"> <p>shipping</p> </td><td width="404"> <p align="left">在您启用了特定于物品的运费时，运送此物品的成本。如果使用了shipping 而未定义 shipping2 ，则无论所购物品数量多少，都将收取该固定金额。</p> <p align="left"><strong>提示：</strong>如果您使用的是基于物品的运费，请确保选中您的用户信息中的覆盖复选框。</p> <p align="left">如果省略，并启用了基于用户信息的运费，则将向您的客户收取您的用户信息中定义的金额或百分比。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>shipping2</p> </td><td width="404"> <p>每增加一件物品所需的运送成本。如果省略，并启用了基于用户信息的运费，则将向您的客户收取您的用户信息中定义的金额或百分比。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>tax</p> </td><td width="404"> <p>基于交易的税费覆盖变量。将该变量设置为您希望应用于交易的固定税额，而不论买家所处的位置。如果存在，该值将覆盖可能已在您的用户信息中设定的任何税费设置。如果省略，则适用用户信息税费设置（如有）。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr><tr><td width="76"> <p>tax_cart</p> </td><td width="404"> <p>整个购物车的税费。而不是单个物品的税额。</p> </td><td width="45"> <p>选填</p> </td><td width="42"> <p> </p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>表单变量</strong><strong>: </strong><strong>购物车特有</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>名字</strong></p> </td><td width="45"> <p align="center"><strong>必填/选填</strong></p> </td><td width="280"> <p align="center"><strong>说明</strong></p> </td><td width="125"> <p align="center"><strong>允许的值</strong></p> </td></tr><tr><td width="76"> <p>amount</p> </td><td width="45"> <p>必填</p> </td><td width="280"> <p>物品的价格（购物车中所有物品的总价格）。</p> </td><td width="125"> <p>任何有效货币金额</p> </td></tr><tr><td width="76"> <p>business</p> </td><td width="45"> <p>必填</p> </td><td width="280"> <p align="left">您PayPal账户上的电子邮件地址。</p> </td><td width="125"> <p>您PayPal账户上的电子邮件地址</p> </td></tr><tr><td width="76"> <p>handling_cart</p> </td><td width="45"> <p>选填</p> </td><td width="280"> <p align="left">对整个购物车收取的单笔手续费。如果在多个“添加到购物车”按钮中使用handling_cart，将使用第一件物品的handling_cart 值。</p> </td><td width="125"> <p align="left">任何有效货币金额</p> </td></tr><tr><td width="76"> <p>item_name</p> </td><td width="45"> <p>必填</p> </td><td width="280"> <p align="left">物品名称（或购物车名称）。</p> </td><td width="125"> <p> </p> </td></tr><tr><td width="76"> <p>paymentaction</p> </td><td width="45"> <p>选填</p> </td><td width="280"> <p align="left">指明交易是否是稍后在<a href="https://www.paypal.com/" rel="nofollow">https://www.paypal.com/</a> 上通过PayPal授权与捕获进行捕获的授权。</p> </td><td width="125"> <p> </p> </td></tr><tr><td width="76"> <p>upload</p> </td><td width="45"> <p>必填</p> </td><td width="280"> <p>上传第三方购物车</p> </td><td width="125"> <p>1</p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>表单变量</strong><strong>:</strong><strong>第三方购物车中单个物品的变量</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>名字</strong></p> </td><td width="367"> <p align="center"><strong>说明</strong></p> </td><td width="45"> <p align="center"><strong>必填</strong><strong>/</strong><strong>选填</strong></p> </td><td width="43"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="76"> <p>amount_x</p> </td><td width="367"> <p>物品 #x 的价格。</p> </td><td width="45"> <p>必填</p> </td><td width="43"> <p> </p> </td></tr><tr><td width="76"> <p>handling_x</p> </td><td width="367"> <p>物品 #x 的手续费。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p> </p> </td></tr><tr><td width="76"> <p>item_name_x</p> </td><td width="367"> <p align="left">购物车中的物品 #x 的名称。必须为字母数字字符。</p> </td><td width="45"> <p>必填</p> </td><td width="43"> <p>127</p> </td></tr><tr><td width="76"> <p>item_number_x</p> </td><td width="367"> <p align="left">可用于跟踪购买 或捐赠的传递变量，在付款完成时传回给您。</p> <p>如果省略，则将没有变量传回给您。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p>127</p> </td></tr><tr><td width="76"> <p>on0_x</p> </td><td width="367"> <p>物品 #x 的第一选项栏名称。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p>64</p> </td></tr><tr><td width="76"> <p>on1_x</p> </td><td width="367"> <p>物品 #x 的第二选项栏名称。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p>64</p> </td></tr><tr><td width="76"> <p>os0_x</p> </td><td width="367"> <p>物品 #x 的第一组选项值。</p> <p>必须对 on0_x 进行定义，才能识别 os0_x 。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p>200</p> </td></tr><tr><td width="76"> <p>os1_x</p> </td><td width="367"> <p align="left">物品 #x 的第二组选项值。</p> <p>必须对 on1_x 进行定义，才能识别 os1_x 。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p>200</p> </td></tr><tr><td width="76"> <p>quantity_x</p> </td><td width="367"> <p>物品 #x 的数量。quantity_x 的值必须是正整数。不允许为空、零或负数。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p> </p> </td></tr><tr><td width="76"> <p>shipping_x</p> </td><td width="367"> <p>运送物品 #x 的第一件（数量 1）的成本。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p> </p> </td></tr><tr><td width="76"> <p>shipping2_x</p> </td><td width="367"> <p>每增加一件运送物品 #x （数量 2 或更多）所需的运送成本。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p> </p> </td></tr><tr><td width="76"> <p>tax_x</p> </td><td width="367"> <p>物品 #x 的税额。</p> </td><td width="45"> <p>选填</p> </td><td width="43"> <p> </p> </td></tr></tbody></table> 
 <p><strong> </strong></p> 
 <p><strong>表单变量</strong><strong>:</strong><strong>网站付款的预填充变量</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="76"> <p align="center"><strong>变量名</strong></p> </td><td width="325"> <p align="center"><strong>说明</strong></p> </td><td width="87"> <p align="center"><strong>要求</strong></p> </td><td width="42"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="76"> <p>address1</p> </td><td width="325"> <p>街道（第 1 栏，共 2 栏）</p> </td><td width="87"> <p>字母数字字符</p> </td><td width="42"> <p>100</p> </td></tr><tr><td width="76"> <p>address2</p> </td><td width="325"> <p align="left">街道（第 2 栏，共 2 栏）</p> </td><td width="87"> <p>字母数字字符</p> </td><td width="42"> <p>100</p> </td></tr><tr><td width="76"> <p>city</p> </td><td width="325"> <p>市/ 县</p> </td><td width="87"> <p>字母数字字符</p> </td><td width="42"> <p>40</p> </td></tr><tr><td width="76"> <p>country</p> </td><td width="325"> <p>设置运送和开单国家或地区。请查看附录6，以了解允许的国家或地区代码。</p> </td><td width="87"> <p>字母</p> </td><td width="42"> <p>2</p> </td></tr><tr><td width="76"> <p>email</p> </td><td width="325"> <p align="left">客户的电子邮件地址</p> </td><td width="87"> <p>字母数字字符</p> </td><td width="42"> <p>127</p> </td></tr><tr><td width="76"> <p>first_name</p> </td><td width="325"> <p>名</p> </td><td width="87"> <p>字母</p> </td><td width="42"> <p>32</p> </td></tr><tr><td width="76"> <p>last_name</p> </td><td width="325"> <p>姓</p> </td><td width="87"> <p>字母</p> </td><td width="42"> <p>32</p> </td></tr><tr><td width="76"> <p>lc</p> </td><td width="325"> <p>定义买家的交易方式确认流程的语言</p> </td><td width="87"> <p>字母</p> </td><td width="42"> <p>2</p> </td></tr><tr><td width="76"> <p>night_phone_a</p> </td><td width="325"> <p>美国电话号码的区号，或非美国电话号码的国家或地区代码。它会预填充买家的家庭电话。</p> </td><td width="87"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="76"> <p>night_phone_b</p> </td><td width="325"> <p>美国电话号码的 3 位数前缀，或非美国电话号码的完整电话号码（不包括国家或地区代码）。它会预填充买家的家庭电话。</p> </td><td width="87"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="76"> <p>night_phone_c</p> </td><td width="325"> <p align="left">美国电话号码的 4 位数电话号码。它会预填充买家的家庭电话。</p> </td><td width="87"> <p>数字</p> </td><td width="42"> <p>4</p> </td></tr><tr><td width="76"> <p>state</p> </td><td width="325"> <p>省/ 直辖市/ 自治区</p> </td><td width="87"> <p>必须为两个字符的正式缩写</p> </td><td width="42"> <p>2</p> </td></tr><tr><td width="76"> <p>zip</p> </td><td width="325"> <p align="left">邮编</p> </td><td width="87"> <p>数字</p> </td><td width="42"> <p>32</p> </td></tr></tbody></table> 
 <p> </p> 
 <p><strong>表单变量</strong><strong>: </strong><strong>账户注册的预填充变量</strong></p> 
 <table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="98"> <p align="center"><strong>变量名</strong></p> </td><td width="302"> <p align="center"><strong>说明</strong></p> </td><td width="91"> <p align="center"><strong>要求</strong></p> </td><td width="42"> <p align="center"><strong>字段长度</strong></p> </td></tr><tr><td width="98"> <p>business_address1</p> </td><td width="302"> <p>客户所在的街道</p> </td><td width="91"> <p>字母数字字符</p> </td><td width="42"> <p>128</p> </td></tr><tr><td width="98"> <p>business_address2</p> </td><td width="302"> <p>客户所在的街道</p> </td><td width="91"> <p>字母数字字符</p> </td><td width="42"> <p>128</p> </td></tr><tr><td width="98"> <p>business_city</p> </td><td width="302"> <p>客户所在的市/ 县</p> </td><td width="91"> <p>字母数字字符</p> </td><td width="42"> <p>128</p> </td></tr><tr><td width="98"> <p>business_state</p> </td><td width="302"> <p>客户所在的省/ 直辖市/ 自治区</p> </td><td width="91"> <p>必须为两个字符的正式缩写</p> </td><td width="42"> <p>2</p> </td></tr><tr><td width="98"> <p>business_country</p> </td><td width="302"> <p>客户所在的国家</p> </td><td width="91"> <p>字母</p> </td><td width="42"> <p>2</p> </td></tr><tr><td width="98"> <p>business_cs_email</p> </td><td width="302"> <p>客户的email地址</p> </td><td width="91"> <p>字母数字字符</p> </td><td width="42"> <p>128</p> </td></tr><tr><td width="98"> <p>business_cs_phone_a</p> </td><td width="302"> <p>客户的客服电话所在的美国电话号码的区号，或非美国电话号码的国家或地区代码。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="98"> <p>business_cs_phone_b</p> </td><td width="302"> <p>客户的客服电话所在的美国电话号码的 3 位数前缀，或非美国电话号码的完整电话号码（不包括国家或地区代码）。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="98"> <p>business_cs_phone_c</p> </td><td width="302"> <p>客户的客服电话所在的美国电话号码的 4 位数电话号码。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>4</p> </td></tr><tr><td width="98"> <p>business_url</p> </td><td width="302"> <p>客户网站的URL</p> </td><td width="91"> <p>字母数字字符. 必须是有效的.</p> </td><td width="42"> <p>128</p> </td></tr><tr><td width="98"> <p>night_phone_b</p> </td><td width="302"> <p>美国电话号码的 3 位数前缀，或非美国电话号码的完整电话号码（不包括国家或地区代码）。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="98"> <p>business_night_phone_a</p> </td><td width="302"> <p>客户所在的美国电话号码的区号，或非美国电话号码的国家或地区代码。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="98"> <p>business_night_phone_b</p> </td><td width="302"> <p>客户所在的美国电话号码的 3 位数前缀，或非美国电话号码的完整电话号码（不包括国家或地区代码）。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>3</p> </td></tr><tr><td width="98"> <p>business_night_phone_c</p> </td><td width="302"> <p>客户所在的美国电话号码的 4 位数电话号码。它会预填充买家的家庭电话。</p> </td><td width="91"> <p>数字</p> </td><td width="42"> <p>4</p> </td></tr></tbody></table> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <h2>9 附录6：国家或地区ISO3166代码</h2> 
 <table style="width:547px;" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="120"> <p align="center"><strong>国家或地区名</strong></p> </td><td width="55"> <p align="center"><strong>代码</strong></p> </td><td width="152"> <p align="center"><strong>国家或地区名</strong></p> </td><td width="55"> <p align="center"><strong>代码</strong></p> </td><td width="111"> <p align="center"><strong>国家或地区名</strong></p> </td><td width="55"> <p align="center"><strong>代码</strong></p> </td></tr><tr><td width="120"> <p align="left">安圭拉</p> </td><td width="55"> <p align="left">AI</p> </td><td width="152"> <p align="left">希腊Greece</p> </td><td width="55"> <p align="left">GR</p> </td><td width="111"> <p align="left">波兰Poland</p> </td><td width="55"> <p align="left">PL</p> </td></tr><tr><td width="120"> <p align="left">阿根廷Argentina</p> </td><td width="55"> <p align="left">AR</p> </td><td width="152"> <p align="left">中国香港特别行政区</p> </td><td width="55"> <p align="left">HK</p> </td><td width="111"> <p align="left">葡萄牙Portugal</p> </td><td width="55"> <p align="left">PT</p> </td></tr><tr><td width="120"> <p align="left">澳大利亚</p> </td><td width="55"> <p align="left">AU</p> </td><td width="152"> <p align="left">匈牙利Hungary</p> </td><td width="55"> <p align="left">HU</p> </td><td width="111"> <p align="left">新加坡Singapore</p> </td><td width="55"> <p align="left">SG</p> </td></tr><tr><td width="120"> <p align="left">奥地利Austria</p> </td><td width="55"> <p align="left">AT</p> </td><td width="152"> <p align="left">冰岛Iceland</p> </td><td width="55"> <p align="left">IS</p> </td><td width="111"> <p align="left">斯洛伐克Slovakia</p> </td><td width="55"> <p align="left">SK</p> </td></tr><tr><td width="120"> <p align="left">比利时Belgium</p> </td><td width="55"> <p align="left">BE</p> </td><td width="152"> <p align="left">印度India</p> </td><td width="55"> <p align="left">IN</p> </td><td width="111"> <p align="left">斯洛文尼亚</p> </td><td width="55"> <p align="left">SI</p> </td></tr><tr><td width="120"> <p align="left">巴西Brazil</p> </td><td width="55"> <p align="left">BR</p> </td><td width="152"> <p align="left">爱尔兰Ireland</p> </td><td width="55"> <p align="left">IE</p> </td><td width="111"> <p align="left">南非South Africa</p> </td><td width="55"> <p align="left">ZA</p> </td></tr><tr><td width="120"> <p align="left">加拿大</p> </td><td width="55"> <p align="left">CA</p> </td><td width="152"> <p align="left">以色列Israel</p> </td><td width="55"> <p align="left">IL</p> </td><td width="111"> <p align="left">韩国Korea</p> </td><td width="55"> <p align="left">KR</p> </td></tr><tr><td width="120"> <p align="left">智利Chile</p> </td><td width="55"> <p align="left">CL</p> </td><td width="152"> <p align="left">意大利Italy</p> </td><td width="55"> <p align="left">IT</p> </td><td width="111"> <p align="left">西班牙Spain</p> </td><td width="55"> <p align="left">ES</p> </td></tr><tr><td width="120"> <p align="left">中国</p> </td><td width="55"> <p align="left">CN</p> </td><td width="152"> <p align="left">牙买加Jamaica</p> </td><td width="55"> <p align="left">JM</p> </td><td width="111"> <p align="left">瑞典Sweden</p> </td><td width="55"> <p align="left">SE</p> </td></tr><tr><td width="120"> <p align="left">哥斯达黎加Costa Rica</p> </td><td width="55"> <p align="left">CR</p> </td><td width="152"> <p align="left">日本</p> </td><td width="55"> <p align="left">JP</p> </td><td width="111"> <p align="left">瑞士Switzerland</p> </td><td width="55"> <p align="left">CH</p> </td></tr><tr><td width="120"> <p align="left">塞浦路斯</p> </td><td width="55"> <p align="left">CY</p> </td><td width="152"> <p align="left">拉脱维亚</p> </td><td width="55"> <p align="left">LV</p> </td><td width="111"> <p align="left">中国台湾地区</p> </td><td width="55"> <p align="left">TW</p> </td></tr><tr><td width="120"> <p align="left">捷克共和国Czech Republic</p> </td><td width="55"> <p align="left">CZ</p> </td><td width="152"> <p align="left">立陶宛</p> </td><td width="55"> <p align="left">LT</p> </td><td width="111"> <p align="left">泰国Thailand</p> </td><td width="55"> <p align="left">TH</p> </td></tr><tr><td width="120"> <p align="left">丹麦Denmark</p> </td><td width="55"> <p align="left">DK</p> </td><td width="152"> <p align="left">卢森堡Luxembourg</p> </td><td width="55"> <p align="left">LU</p> </td><td width="111"> <p align="left">土耳其Turkey</p> </td><td width="55"> <p align="left">TR</p> </td></tr><tr><td width="120"> <p align="left">多米尼加共和国</p> </td><td width="55"> <p align="left">DO</p> </td><td width="152"> <p align="left">马来西亚Malaysia</p> </td><td width="55"> <p align="left">MY</p> </td><td width="111"> <p align="left">英国Great Britain</p> </td><td width="55"> <p align="left">GB</p> </td></tr><tr><td width="120"> <p align="left">厄瓜多尔Ecuador</p> </td><td width="55"> <p align="left">EC</p> </td><td width="152"> <p align="left">马耳他</p> </td><td width="55"> <p align="left">MT</p> </td><td width="111"> <p align="left">美国U.S.A</p> </td><td width="55"> <p align="left">US</p> </td></tr><tr><td width="120"> <p align="left">爱沙尼亚</p> </td><td width="55"> <p align="left">EE</p> </td><td width="152"> <p align="left">墨西哥Mexico</p> </td><td width="55"> <p align="left">MX</p> </td><td width="111"> <p align="left">乌拉圭Uruguay</p> </td><td width="55"> <p align="left">UY</p> </td></tr><tr><td width="120"> <p align="left">芬兰Finland</p> </td><td width="55"> <p align="left">FI</p> </td><td width="152"> <p align="left">荷兰Holland</p> </td><td width="55"> <p align="left">NL</p> </td><td width="111"> <p align="left">委内瑞拉Venezuela</p> </td><td width="55"> <p align="left">VE</p> </td></tr><tr><td width="120"> <p align="left">法国</p> </td><td width="55"> <p align="left">FR</p> </td><td width="152"> <p align="left">新西兰New Zealand</p> </td><td width="55"> <p align="left">NZ</p> </td><td width="111"> <p align="left"> </p> </td><td width="55"> <p align="left"> </p> </td></tr><tr><td width="120"> <p align="left">德国Germany</p> </td><td width="55"> <p align="left">DE</p> </td><td width="152"> <p align="left">挪威Norway</p> </td><td width="55"> <p align="left">NO</p> </td><td width="111"> <p align="left"> </p> </td><td width="55"> <p align="left"> </p> </td></tr></tbody></table> 
 <p align="left"> </p> 
 <p align="left"> </p> 
 <p align="left">关于.NET技术 等其他计算机技术，欢迎加群一起讨论 3群 70536418 2群 5851499 1群 12672376</p> 
 <p class="a0"> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/guolilong/archive/2012/04/11/2441830.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/74936a0d57fcbeabdb8620336703661c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何插入说明信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d680cc972f3a181a566ec69c265fe0e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx模块参考手册：FastCGI模块(FastCGI)(3)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>