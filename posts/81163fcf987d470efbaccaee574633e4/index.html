<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>可拖拽、缩放、旋转组件之 - 生成辅助线和撤销回退功能 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="可拖拽、缩放、旋转组件之 - 生成辅助线和撤销回退功能" />
<meta property="og:description" content="🌈介绍 基于 vue3.x &#43; CompositionAPI &#43; typescript &#43; vite 的可拖拽、缩放、旋转的组件
拖拽&amp;区域拖拽支持缩放旋转网格拖拽缩放 在线示例
源码地址
这节主要来分享如何使用es-drager，根据现有功能实现拖拽时生成辅助线、撤销重做等画布常用功能
话不多说，咱们开始吧！
画布准备工作 这里只是一个简单的画布模板
画布数据源 import { ref, CSSProperties } from &#39;vue&#39; // 组件类型 type ComponentType = { component: string // 内部组件名称，自定义组件需要提前全局注册 text?: string // 文本 width?: number height?: number top?: number left?: number angle?: number style?: CSSProperties // 样式 } interface EditorState { componentList: ComponentType[] } const data = ref&lt;EditorState&gt;({ componentList: [ { component: &#39;div&#39;, text: &#39;div1&#39;, width: 100, height: 100, left: 0, top: 0 }, { component: &#39;div&#39;, text: &#39;div2&#39;, width: 100, height: 100, top: 100, left: 100 } ] }) 循环渲染组件到画布上" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/81163fcf987d470efbaccaee574633e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-07T10:07:43+08:00" />
<meta property="article:modified_time" content="2023-08-07T10:07:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">可拖拽、缩放、旋转组件之 - 生成辅助线和撤销回退功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>🌈介绍</h3> 
<p>基于 vue3.x + CompositionAPI + typescript + vite 的可拖拽、缩放、旋转的组件</p> 
<ul><li>拖拽&amp;区域拖拽</li><li>支持缩放</li><li>旋转</li><li>网格拖拽缩放</li></ul> 
<p><a href="https://vangleer.github.io/es-drager" rel="nofollow">在线示例</a></p> 
<p><a href="https://github.com/vangleer/es-drager">源码地址</a></p> 
<p>这节主要来分享如何使用es-drager，根据现有功能实现拖拽时生成辅助线、撤销重做等画布常用功能</p> 
<p>话不多说，咱们开始吧！</p> 
<h3><a id="_18"></a>画布准备工作</h3> 
<p>这里只是一个简单的画布模板</p> 
<h4><a id="_22"></a>画布数据源</h4> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> CSSProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">// 组件类型</span>
<span class="token keyword">type</span> <span class="token class-name">ComponentType</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  component<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 内部组件名称，自定义组件需要提前全局注册</span>
  text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 文本</span>
  width<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  height<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  top<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  left<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  angle<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  style<span class="token operator">?</span><span class="token operator">:</span> CSSProperties <span class="token comment">// 样式</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">EditorState</span> <span class="token punctuation">{<!-- --></span>
  componentList<span class="token operator">:</span> ComponentType<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  componentList<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      component<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'div1'</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      component<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'div2'</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>循环渲染组件到画布上</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in data.componentList<span class="token punctuation">"</span></span>
  <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.component<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_75"></a>生成辅助线</h3> 
<p>当拖拽元素时，通过比较拖拽元素与画布上其他元素的位置，当某个元素与拖拽元素的距离接近时，显示辅助线</p> 
<h4><a id="_79"></a>拖拽元素在垂直方向上不同对齐方式</h4> 
<ol><li>底对顶：拖拽元素的底部与对比元素的顶部对齐</li><li>底对底：拖拽元素的底部与对比元素的底部对齐</li><li>中对中：拖拽元素的中部与对比元素的中部对齐</li><li>顶对顶：拖拽元素的顶部与对比元素的顶部对齐</li><li>顶对底：拖拽元素的顶部与对比元素的底部对齐</li></ol> 
<p>看下图可以清晰的理解这几种对齐方式</p> 
<p><img src="https://images2.imgbox.com/07/84/AH8NvhAu_o.png" alt="09.png"></p> 
<h4><a id="_92"></a>拖拽元素在水平方向上不同对齐方式</h4> 
<ol><li>右对左：拖拽元素的右侧与对比元素的左侧对齐</li><li>右对右：拖拽元素的右侧与对比元素的右侧对齐</li><li>中对中：拖拽元素的水平中心与对比元素的水平中心对齐</li><li>左对左：拖拽元素的左侧与对比元素的左侧对齐</li><li>左对右：拖拽元素的左侧与对比元素的右侧对齐</li></ol> 
<p><img src="https://images2.imgbox.com/fe/4a/MkUyZdr2_o.png" alt="10.png"></p> 
<p>理解了这几种对齐方式，接下来就用代码来实现吧！</p> 
<h4><a id="_105"></a>代码实现</h4> 
<p>监听拖拽开始事件 <code>drag-start</code>，当前拖拽元素除外，保存其他所有元素的位置信息和判断条件用于生成辅助线。</p> 
<p>在拖拽过程中，监听 <code>drag</code> 事件，并将拖拽元素的位置与之前保存的数据进行比较。如果满足生成辅助线的条件，则显示相应的辅助线。</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-container<span class="token punctuation">"</span></span>
    <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridStyle<span class="token punctuation">"</span></span>
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item, index in data.componentList<span class="token punctuation">"</span></span>
      <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>
      <span class="token attr-name">:snapToGrid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>snapToGrid<span class="token punctuation">"</span></span>
      <span class="token attr-name">:gridX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridX<span class="token punctuation">"</span></span>
      <span class="token attr-name">:gridY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridY<span class="token punctuation">"</span></span>
      <span class="token attr-name">@drag-start</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDragstart(index)<span class="token punctuation">"</span></span>
      <span class="token attr-name">@drag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDrag($event)<span class="token punctuation">"</span></span>
      <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onChange($event, item)<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.component<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>markLine.left<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-markline-left<span class="token punctuation">"</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ left: markLine.left + 'px' }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>markLine.top<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-markline-top<span class="token punctuation">"</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ top: markLine.top + 'px' }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> computed<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> CSSProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Drager<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> DragData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'es-drager'</span>
<span class="token keyword">const</span> snapToGrid <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridX <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridY <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridStyle <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> snapToGrid<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'--es-grid-width'</span><span class="token operator">:</span> gridX<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'--es-grid-height'</span><span class="token operator">:</span> gridY<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">'px'</span>
  <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> currentIndex <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> ref<span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">componentList</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'div1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'div2'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> markLine <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> lines <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 监听拖拽开始
 * @param index 
 */</span>
<span class="token keyword">function</span> <span class="token function">onDragstart</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">index</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  currentIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index
  lines<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">calcLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 监听拖拽事件
 * @param dragData 
 */</span>
<span class="token keyword">function</span> <span class="token function">onDrag</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dragData</span><span class="token operator">:</span> DragData</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  markLine<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token keyword">null</span>
  markLine<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>y<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> top<span class="token punctuation">,</span> showTop <span class="token punctuation">}</span> <span class="token operator">=</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>top <span class="token operator">-</span> dragData<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      markLine<span class="token punctuation">.</span>top <span class="token operator">=</span> showTop
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>x<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> left<span class="token punctuation">,</span> showLeft <span class="token punctuation">}</span> <span class="token operator">=</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>left <span class="token operator">-</span> dragData<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      markLine<span class="token punctuation">.</span>left <span class="token operator">=</span> showLeft
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 计算辅助线的位置
 */</span>
<span class="token keyword">function</span> <span class="token function">calcLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token literal-property property">lines</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token comment">// 当前拖拽元素大小</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">[</span>currentIndex<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any

  <span class="token comment">// 循环遍历画布所有元素，将除当前拖拽元素外所有其它元素生成辅助线的位置保存，每个元素x和y都会有5种</span>
  data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">block<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentIndex<span class="token punctuation">.</span>value<span class="token operator">!</span> <span class="token operator">===</span> i<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> AHeight <span class="token punctuation">}</span> <span class="token operator">=</span> block <span class="token keyword">as</span> any

    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> width <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">-</span> width <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">-</span> width <span class="token punctuation">}</span><span class="token punctuation">)</span>

    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">-</span> height <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> height <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">-</span> height <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> lines
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dragData</span><span class="token operator">:</span> DragData<span class="token punctuation">,</span> <span class="token literal-property property">item</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dragData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span>item <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> dragData<span class="token punctuation">[</span>key <span class="token keyword">as</span> keyof DragData<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>scss<span class="token punctuation">'</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.es-container</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span>
        <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span> - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span> - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token selector">[class^=es-markline]</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #3a7afe<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.es-markline-left</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.es-markline-top</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>主要关注es-drager的几个事件</p> 
<p><code>onDragstart</code> 开始拖拽调用 <code>calcLines</code> 计算辅助线出现的位置</p> 
<p><code>onDrag</code> 拖拽时分别遍历提前计算好lines中x和y的位置是否满足显示辅助线，有一个满足就显示相应的辅助线</p> 
<p><code>onChange</code> 大小位置改变时更新最新数据</p> 
<p><code>calcLines</code> 解析：</p> 
<p>函数中使用了一个 lines 对象来保存辅助线的位置信息。遍历画布上的所有元素（除了当前拖拽元素），并为每个元素计算并保存辅助线的位置。</p> 
<p>对于垂直方向（y 轴），生成了五种辅助线的位置信息：</p> 
<ul><li>顶对顶：拖拽元素的顶部与对比元素的顶部对齐</li><li>顶对底：拖拽元素的顶部与对比元素的底部对齐</li><li>中：拖拽元素的中部与对比元素的中部对齐</li><li>底对顶：拖拽元素的底部与对比元素的顶部对齐</li><li>底对底：拖拽元素的底部与对比元素的底部对齐</li></ul> 
<p>对于每种对齐方式，lines 对象保存了两个位置信息：</p> 
<p>showTop：用于显示辅助线的位置</p> 
<p>top：用于计算对齐位置的参考位置</p> 
<h3><a id="_307"></a>撤销与重做</h3> 
<p>最终效果展示</p> 
<p><img src="https://images2.imgbox.com/9c/ed/WK87nKCX_o.gif" alt="11.gif"></p> 
<p>这里我们使用一个钩子来实现</p> 
<pre><code class="prism language-typescript"><span class="token keyword">function</span> <span class="token function">useCommand</span><span class="token punctuation">(</span>data<span class="token operator">:</span> Ref<span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> queue<span class="token operator">:</span> ComponentType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 画布变化记录</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// 前进后退指针</span>
  <span class="token comment">// 重做</span>
  <span class="token keyword">const</span> <span class="token function-variable function">redo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      current<span class="token operator">++</span>
      data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 撤销</span>
  <span class="token keyword">const</span> <span class="token function-variable function">undo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      current<span class="token operator">--</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 记录画布的变化</span>
  <span class="token keyword">const</span> <span class="token function-variable function">record</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    queue<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 记录初始数据</span>
  <span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 键盘事件</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onKeydown</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> KeyboardEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> ctrlKey<span class="token punctuation">,</span> key <span class="token punctuation">}</span> <span class="token operator">=</span> e
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctrlKey<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> onKeydown<span class="token punctuation">)</span>

  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> onKeydown<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    redo<span class="token punctuation">,</span>
    undo<span class="token punctuation">,</span>
    record
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>用一个数组 <code>queue</code> 来记录画布的变化，<code>current</code> 代表前进后退指针</p> 
<p><code>useCommand</code> 提供了 <code>redo</code>、<code>undo</code> 和 <code>record</code> 方法，用于重做、撤销和记录画布的变化。</p> 
<ul><li> <p><code>redo</code> 重做方法就是拿到当前指针 <code>current</code> 的下一个数据</p> </li><li> <p><code>undo</code> 撤销方法得到当前指针 <code>current</code> 的上一个数据</p> </li><li> <p><code>record</code> 方法用于记录画布的变化。在每次画布发生变化的时候，调用该方法，将当前的画布数据存储到 <code>queue</code> 数组中，并将指针 <code>current</code> 向后移动一位，实现记录操作。例如添加/删除元素、拖拽结束、缩放结束等调用该方法</p> </li><li> <p>具体使用</p> </li></ul> 
<p>为 <code>es-drager</code> 添加拖拽结束事件监听</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
  <span class="token attr-name">@drag-end</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDragend<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token function">useCommand</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">onDragend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 每次拖拽结束记录变化</span>
  command<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_392"></a>最后</h3> 
<p>本文介绍了如何实现拖拽编辑器中的辅助线功能，以及如何使用撤销与重做来增强编辑器的交互性和用户体验。</p> 
<p>查看完整代码请滑到顶部有 <code>github</code> 链接地址和在线示例</p> 
<ul><li>相关文章</li></ul> 
<p><a href="https://juejin.cn/post/7225152932675993655" rel="nofollow">可拖拽、缩放、旋转组件实现细节</a></p> 
<p><a href="https://juejin.cn/post/7239895206081806373" rel="nofollow">可拖拽、缩放、旋转组件网格效果及使用方法</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd2b2be68f27bbe7e3c76f4b0399add6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">可拖拽、缩放、旋转组件网格效果及使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1dbc1677cdc20c72b6019b284d9a10e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue视频插件vue-video-player的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>