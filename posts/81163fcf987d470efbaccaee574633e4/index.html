<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶ä¹‹ - ç”Ÿæˆè¾…åŠ©çº¿å’Œæ’¤é”€å›é€€åŠŸèƒ½ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶ä¹‹ - ç”Ÿæˆè¾…åŠ©çº¿å’Œæ’¤é”€å›é€€åŠŸèƒ½" />
<meta property="og:description" content="ğŸŒˆä»‹ç» åŸºäº vue3.x &#43; CompositionAPI &#43; typescript &#43; vite çš„å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬çš„ç»„ä»¶
æ‹–æ‹½&amp;åŒºåŸŸæ‹–æ‹½æ”¯æŒç¼©æ”¾æ—‹è½¬ç½‘æ ¼æ‹–æ‹½ç¼©æ”¾ åœ¨çº¿ç¤ºä¾‹
æºç åœ°å€
è¿™èŠ‚ä¸»è¦æ¥åˆ†äº«å¦‚ä½•ä½¿ç”¨es-dragerï¼Œæ ¹æ®ç°æœ‰åŠŸèƒ½å®ç°æ‹–æ‹½æ—¶ç”Ÿæˆè¾…åŠ©çº¿ã€æ’¤é”€é‡åšç­‰ç”»å¸ƒå¸¸ç”¨åŠŸèƒ½
è¯ä¸å¤šè¯´ï¼Œå’±ä»¬å¼€å§‹å§ï¼
ç”»å¸ƒå‡†å¤‡å·¥ä½œ è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ç”»å¸ƒæ¨¡æ¿
ç”»å¸ƒæ•°æ®æº import { ref, CSSProperties } from &#39;vue&#39; // ç»„ä»¶ç±»å‹ type ComponentType = { component: string // å†…éƒ¨ç»„ä»¶åç§°ï¼Œè‡ªå®šä¹‰ç»„ä»¶éœ€è¦æå‰å…¨å±€æ³¨å†Œ text?: string // æ–‡æœ¬ width?: number height?: number top?: number left?: number angle?: number style?: CSSProperties // æ ·å¼ } interface EditorState { componentList: ComponentType[] } const data = ref&lt;EditorState&gt;({ componentList: [ { component: &#39;div&#39;, text: &#39;div1&#39;, width: 100, height: 100, left: 0, top: 0 }, { component: &#39;div&#39;, text: &#39;div2&#39;, width: 100, height: 100, top: 100, left: 100 } ] }) å¾ªç¯æ¸²æŸ“ç»„ä»¶åˆ°ç”»å¸ƒä¸Š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/81163fcf987d470efbaccaee574633e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-07T10:07:43+08:00" />
<meta property="article:modified_time" content="2023-08-07T10:07:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶ä¹‹ - ç”Ÿæˆè¾…åŠ©çº¿å’Œæ’¤é”€å›é€€åŠŸèƒ½</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>ğŸŒˆä»‹ç»</h3> 
<p>åŸºäº vue3.x + CompositionAPI + typescript + vite çš„å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬çš„ç»„ä»¶</p> 
<ul><li>æ‹–æ‹½&amp;åŒºåŸŸæ‹–æ‹½</li><li>æ”¯æŒç¼©æ”¾</li><li>æ—‹è½¬</li><li>ç½‘æ ¼æ‹–æ‹½ç¼©æ”¾</li></ul> 
<p><a href="https://vangleer.github.io/es-drager" rel="nofollow">åœ¨çº¿ç¤ºä¾‹</a></p> 
<p><a href="https://github.com/vangleer/es-drager">æºç åœ°å€</a></p> 
<p>è¿™èŠ‚ä¸»è¦æ¥åˆ†äº«å¦‚ä½•ä½¿ç”¨es-dragerï¼Œæ ¹æ®ç°æœ‰åŠŸèƒ½å®ç°æ‹–æ‹½æ—¶ç”Ÿæˆè¾…åŠ©çº¿ã€æ’¤é”€é‡åšç­‰ç”»å¸ƒå¸¸ç”¨åŠŸèƒ½</p> 
<p>è¯ä¸å¤šè¯´ï¼Œå’±ä»¬å¼€å§‹å§ï¼</p> 
<h3><a id="_18"></a>ç”»å¸ƒå‡†å¤‡å·¥ä½œ</h3> 
<p>è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ç”»å¸ƒæ¨¡æ¿</p> 
<h4><a id="_22"></a>ç”»å¸ƒæ•°æ®æº</h4> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> CSSProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">// ç»„ä»¶ç±»å‹</span>
<span class="token keyword">type</span> <span class="token class-name">ComponentType</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  component<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// å†…éƒ¨ç»„ä»¶åç§°ï¼Œè‡ªå®šä¹‰ç»„ä»¶éœ€è¦æå‰å…¨å±€æ³¨å†Œ</span>
  text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// æ–‡æœ¬</span>
  width<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  height<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  top<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  left<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  angle<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  style<span class="token operator">?</span><span class="token operator">:</span> CSSProperties <span class="token comment">// æ ·å¼</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">EditorState</span> <span class="token punctuation">{<!-- --></span>
  componentList<span class="token operator">:</span> ComponentType<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  componentList<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      component<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'div1'</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      component<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'div2'</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¾ªç¯æ¸²æŸ“ç»„ä»¶åˆ°ç”»å¸ƒä¸Š</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in data.componentList<span class="token punctuation">"</span></span>
  <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.component<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_75"></a>ç”Ÿæˆè¾…åŠ©çº¿</h3> 
<p>å½“æ‹–æ‹½å…ƒç´ æ—¶ï¼Œé€šè¿‡æ¯”è¾ƒæ‹–æ‹½å…ƒç´ ä¸ç”»å¸ƒä¸Šå…¶ä»–å…ƒç´ çš„ä½ç½®ï¼Œå½“æŸä¸ªå…ƒç´ ä¸æ‹–æ‹½å…ƒç´ çš„è·ç¦»æ¥è¿‘æ—¶ï¼Œæ˜¾ç¤ºè¾…åŠ©çº¿</p> 
<h4><a id="_79"></a>æ‹–æ‹½å…ƒç´ åœ¨å‚ç›´æ–¹å‘ä¸Šä¸åŒå¯¹é½æ–¹å¼</h4> 
<ol><li>åº•å¯¹é¡¶ï¼šæ‹–æ‹½å…ƒç´ çš„åº•éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„é¡¶éƒ¨å¯¹é½</li><li>åº•å¯¹åº•ï¼šæ‹–æ‹½å…ƒç´ çš„åº•éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„åº•éƒ¨å¯¹é½</li><li>ä¸­å¯¹ä¸­ï¼šæ‹–æ‹½å…ƒç´ çš„ä¸­éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„ä¸­éƒ¨å¯¹é½</li><li>é¡¶å¯¹é¡¶ï¼šæ‹–æ‹½å…ƒç´ çš„é¡¶éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„é¡¶éƒ¨å¯¹é½</li><li>é¡¶å¯¹åº•ï¼šæ‹–æ‹½å…ƒç´ çš„é¡¶éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„åº•éƒ¨å¯¹é½</li></ol> 
<p>çœ‹ä¸‹å›¾å¯ä»¥æ¸…æ™°çš„ç†è§£è¿™å‡ ç§å¯¹é½æ–¹å¼</p> 
<p><img src="https://images2.imgbox.com/07/84/AH8NvhAu_o.png" alt="09.png"></p> 
<h4><a id="_92"></a>æ‹–æ‹½å…ƒç´ åœ¨æ°´å¹³æ–¹å‘ä¸Šä¸åŒå¯¹é½æ–¹å¼</h4> 
<ol><li>å³å¯¹å·¦ï¼šæ‹–æ‹½å…ƒç´ çš„å³ä¾§ä¸å¯¹æ¯”å…ƒç´ çš„å·¦ä¾§å¯¹é½</li><li>å³å¯¹å³ï¼šæ‹–æ‹½å…ƒç´ çš„å³ä¾§ä¸å¯¹æ¯”å…ƒç´ çš„å³ä¾§å¯¹é½</li><li>ä¸­å¯¹ä¸­ï¼šæ‹–æ‹½å…ƒç´ çš„æ°´å¹³ä¸­å¿ƒä¸å¯¹æ¯”å…ƒç´ çš„æ°´å¹³ä¸­å¿ƒå¯¹é½</li><li>å·¦å¯¹å·¦ï¼šæ‹–æ‹½å…ƒç´ çš„å·¦ä¾§ä¸å¯¹æ¯”å…ƒç´ çš„å·¦ä¾§å¯¹é½</li><li>å·¦å¯¹å³ï¼šæ‹–æ‹½å…ƒç´ çš„å·¦ä¾§ä¸å¯¹æ¯”å…ƒç´ çš„å³ä¾§å¯¹é½</li></ol> 
<p><img src="https://images2.imgbox.com/fe/4a/MkUyZdr2_o.png" alt="10.png"></p> 
<p>ç†è§£äº†è¿™å‡ ç§å¯¹é½æ–¹å¼ï¼Œæ¥ä¸‹æ¥å°±ç”¨ä»£ç æ¥å®ç°å§ï¼</p> 
<h4><a id="_105"></a>ä»£ç å®ç°</h4> 
<p>ç›‘å¬æ‹–æ‹½å¼€å§‹äº‹ä»¶ <code>drag-start</code>ï¼Œå½“å‰æ‹–æ‹½å…ƒç´ é™¤å¤–ï¼Œä¿å­˜å…¶ä»–æ‰€æœ‰å…ƒç´ çš„ä½ç½®ä¿¡æ¯å’Œåˆ¤æ–­æ¡ä»¶ç”¨äºç”Ÿæˆè¾…åŠ©çº¿ã€‚</p> 
<p>åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼Œç›‘å¬ <code>drag</code> äº‹ä»¶ï¼Œå¹¶å°†æ‹–æ‹½å…ƒç´ çš„ä½ç½®ä¸ä¹‹å‰ä¿å­˜çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ»¡è¶³ç”Ÿæˆè¾…åŠ©çº¿çš„æ¡ä»¶ï¼Œåˆ™æ˜¾ç¤ºç›¸åº”çš„è¾…åŠ©çº¿ã€‚</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-container<span class="token punctuation">"</span></span>
    <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridStyle<span class="token punctuation">"</span></span>
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item, index in data.componentList<span class="token punctuation">"</span></span>
      <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>
      <span class="token attr-name">:snapToGrid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>snapToGrid<span class="token punctuation">"</span></span>
      <span class="token attr-name">:gridX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridX<span class="token punctuation">"</span></span>
      <span class="token attr-name">:gridY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gridY<span class="token punctuation">"</span></span>
      <span class="token attr-name">@drag-start</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDragstart(index)<span class="token punctuation">"</span></span>
      <span class="token attr-name">@drag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDrag($event)<span class="token punctuation">"</span></span>
      <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onChange($event, item)<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.component<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>markLine.left<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-markline-left<span class="token punctuation">"</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ left: markLine.left + 'px' }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>markLine.top<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es-markline-top<span class="token punctuation">"</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ top: markLine.top + 'px' }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> computed<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> CSSProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Drager<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> DragData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'es-drager'</span>
<span class="token keyword">const</span> snapToGrid <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridX <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridY <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gridStyle <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> snapToGrid<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'--es-grid-width'</span><span class="token operator">:</span> gridX<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'--es-grid-height'</span><span class="token operator">:</span> gridY<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">'px'</span>
  <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> currentIndex <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> ref<span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">componentList</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'div1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'div2'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> markLine <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> lines <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * ç›‘å¬æ‹–æ‹½å¼€å§‹
 * @param index 
 */</span>
<span class="token keyword">function</span> <span class="token function">onDragstart</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">index</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  currentIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> index
  lines<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">calcLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * ç›‘å¬æ‹–æ‹½äº‹ä»¶
 * @param dragData 
 */</span>
<span class="token keyword">function</span> <span class="token function">onDrag</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dragData</span><span class="token operator">:</span> DragData</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  markLine<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token keyword">null</span>
  markLine<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>y<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> top<span class="token punctuation">,</span> showTop <span class="token punctuation">}</span> <span class="token operator">=</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>top <span class="token operator">-</span> dragData<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      markLine<span class="token punctuation">.</span>top <span class="token operator">=</span> showTop
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>x<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> left<span class="token punctuation">,</span> showLeft <span class="token punctuation">}</span> <span class="token operator">=</span> lines<span class="token punctuation">.</span>value<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>left <span class="token operator">-</span> dragData<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      markLine<span class="token punctuation">.</span>left <span class="token operator">=</span> showLeft
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * è®¡ç®—è¾…åŠ©çº¿çš„ä½ç½®
 */</span>
<span class="token keyword">function</span> <span class="token function">calcLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token literal-property property">lines</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token comment">// å½“å‰æ‹–æ‹½å…ƒç´ å¤§å°</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">[</span>currentIndex<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any

  <span class="token comment">// å¾ªç¯éå†ç”»å¸ƒæ‰€æœ‰å…ƒç´ ï¼Œå°†é™¤å½“å‰æ‹–æ‹½å…ƒç´ å¤–æ‰€æœ‰å…¶å®ƒå…ƒç´ ç”Ÿæˆè¾…åŠ©çº¿çš„ä½ç½®ä¿å­˜ï¼Œæ¯ä¸ªå…ƒç´ xå’Œyéƒ½ä¼šæœ‰5ç§</span>
  data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">block<span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentIndex<span class="token punctuation">.</span>value<span class="token operator">!</span> <span class="token operator">===</span> i<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> AHeight <span class="token punctuation">}</span> <span class="token operator">=</span> block <span class="token keyword">as</span> any

    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> width <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">+</span> AWidth <span class="token operator">-</span> width <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showLeft</span><span class="token operator">:</span> ALeft<span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> ALeft <span class="token operator">-</span> width <span class="token punctuation">}</span><span class="token punctuation">)</span>

    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">-</span> height <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> height <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lines<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">showTop</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight<span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> ATop <span class="token operator">+</span> AHeight <span class="token operator">-</span> height <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> lines
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dragData</span><span class="token operator">:</span> DragData<span class="token punctuation">,</span> <span class="token literal-property property">item</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dragData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span>item <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> dragData<span class="token punctuation">[</span>key <span class="token keyword">as</span> keyof DragData<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>scss<span class="token punctuation">'</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.es-container</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span>
        <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span> - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span> - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-width<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--es-grid-height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token selector">[class^=es-markline]</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #3a7afe<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.es-markline-left</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.es-markline-top</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>ä¸»è¦å…³æ³¨es-dragerçš„å‡ ä¸ªäº‹ä»¶</p> 
<p><code>onDragstart</code> å¼€å§‹æ‹–æ‹½è°ƒç”¨ <code>calcLines</code> è®¡ç®—è¾…åŠ©çº¿å‡ºç°çš„ä½ç½®</p> 
<p><code>onDrag</code> æ‹–æ‹½æ—¶åˆ†åˆ«éå†æå‰è®¡ç®—å¥½linesä¸­xå’Œyçš„ä½ç½®æ˜¯å¦æ»¡è¶³æ˜¾ç¤ºè¾…åŠ©çº¿ï¼Œæœ‰ä¸€ä¸ªæ»¡è¶³å°±æ˜¾ç¤ºç›¸åº”çš„è¾…åŠ©çº¿</p> 
<p><code>onChange</code> å¤§å°ä½ç½®æ”¹å˜æ—¶æ›´æ–°æœ€æ–°æ•°æ®</p> 
<p><code>calcLines</code> è§£æï¼š</p> 
<p>å‡½æ•°ä¸­ä½¿ç”¨äº†ä¸€ä¸ª lines å¯¹è±¡æ¥ä¿å­˜è¾…åŠ©çº¿çš„ä½ç½®ä¿¡æ¯ã€‚éå†ç”»å¸ƒä¸Šçš„æ‰€æœ‰å…ƒç´ ï¼ˆé™¤äº†å½“å‰æ‹–æ‹½å…ƒç´ ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå…ƒç´ è®¡ç®—å¹¶ä¿å­˜è¾…åŠ©çº¿çš„ä½ç½®ã€‚</p> 
<p>å¯¹äºå‚ç›´æ–¹å‘ï¼ˆy è½´ï¼‰ï¼Œç”Ÿæˆäº†äº”ç§è¾…åŠ©çº¿çš„ä½ç½®ä¿¡æ¯ï¼š</p> 
<ul><li>é¡¶å¯¹é¡¶ï¼šæ‹–æ‹½å…ƒç´ çš„é¡¶éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„é¡¶éƒ¨å¯¹é½</li><li>é¡¶å¯¹åº•ï¼šæ‹–æ‹½å…ƒç´ çš„é¡¶éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„åº•éƒ¨å¯¹é½</li><li>ä¸­ï¼šæ‹–æ‹½å…ƒç´ çš„ä¸­éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„ä¸­éƒ¨å¯¹é½</li><li>åº•å¯¹é¡¶ï¼šæ‹–æ‹½å…ƒç´ çš„åº•éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„é¡¶éƒ¨å¯¹é½</li><li>åº•å¯¹åº•ï¼šæ‹–æ‹½å…ƒç´ çš„åº•éƒ¨ä¸å¯¹æ¯”å…ƒç´ çš„åº•éƒ¨å¯¹é½</li></ul> 
<p>å¯¹äºæ¯ç§å¯¹é½æ–¹å¼ï¼Œlines å¯¹è±¡ä¿å­˜äº†ä¸¤ä¸ªä½ç½®ä¿¡æ¯ï¼š</p> 
<p>showTopï¼šç”¨äºæ˜¾ç¤ºè¾…åŠ©çº¿çš„ä½ç½®</p> 
<p>topï¼šç”¨äºè®¡ç®—å¯¹é½ä½ç½®çš„å‚è€ƒä½ç½®</p> 
<h3><a id="_307"></a>æ’¤é”€ä¸é‡åš</h3> 
<p>æœ€ç»ˆæ•ˆæœå±•ç¤º</p> 
<p><img src="https://images2.imgbox.com/9c/ed/WK87nKCX_o.gif" alt="11.gif"></p> 
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé’©å­æ¥å®ç°</p> 
<pre><code class="prism language-typescript"><span class="token keyword">function</span> <span class="token function">useCommand</span><span class="token punctuation">(</span>data<span class="token operator">:</span> Ref<span class="token operator">&lt;</span>EditorState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> queue<span class="token operator">:</span> ComponentType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// ç”»å¸ƒå˜åŒ–è®°å½•</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// å‰è¿›åé€€æŒ‡é’ˆ</span>
  <span class="token comment">// é‡åš</span>
  <span class="token keyword">const</span> <span class="token function-variable function">redo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      current<span class="token operator">++</span>
      data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ’¤é”€</span>
  <span class="token keyword">const</span> <span class="token function-variable function">undo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      current<span class="token operator">--</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è®°å½•ç”»å¸ƒçš„å˜åŒ–</span>
  <span class="token keyword">const</span> <span class="token function-variable function">record</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    queue<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>value<span class="token punctuation">.</span>componentList<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è®°å½•åˆå§‹æ•°æ®</span>
  <span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// é”®ç›˜äº‹ä»¶</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onKeydown</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> KeyboardEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> ctrlKey<span class="token punctuation">,</span> key <span class="token punctuation">}</span> <span class="token operator">=</span> e
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctrlKey<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> onKeydown<span class="token punctuation">)</span>

  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> onKeydown<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    redo<span class="token punctuation">,</span>
    undo<span class="token punctuation">,</span>
    record
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ç”¨ä¸€ä¸ªæ•°ç»„ <code>queue</code> æ¥è®°å½•ç”»å¸ƒçš„å˜åŒ–ï¼Œ<code>current</code> ä»£è¡¨å‰è¿›åé€€æŒ‡é’ˆ</p> 
<p><code>useCommand</code> æä¾›äº† <code>redo</code>ã€<code>undo</code> å’Œ <code>record</code> æ–¹æ³•ï¼Œç”¨äºé‡åšã€æ’¤é”€å’Œè®°å½•ç”»å¸ƒçš„å˜åŒ–ã€‚</p> 
<ul><li> <p><code>redo</code> é‡åšæ–¹æ³•å°±æ˜¯æ‹¿åˆ°å½“å‰æŒ‡é’ˆ <code>current</code> çš„ä¸‹ä¸€ä¸ªæ•°æ®</p> </li><li> <p><code>undo</code> æ’¤é”€æ–¹æ³•å¾—åˆ°å½“å‰æŒ‡é’ˆ <code>current</code> çš„ä¸Šä¸€ä¸ªæ•°æ®</p> </li><li> <p><code>record</code> æ–¹æ³•ç”¨äºè®°å½•ç”»å¸ƒçš„å˜åŒ–ã€‚åœ¨æ¯æ¬¡ç”»å¸ƒå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†å½“å‰çš„ç”»å¸ƒæ•°æ®å­˜å‚¨åˆ° <code>queue</code> æ•°ç»„ä¸­ï¼Œå¹¶å°†æŒ‡é’ˆ <code>current</code> å‘åç§»åŠ¨ä¸€ä½ï¼Œå®ç°è®°å½•æ“ä½œã€‚ä¾‹å¦‚æ·»åŠ /åˆ é™¤å…ƒç´ ã€æ‹–æ‹½ç»“æŸã€ç¼©æ”¾ç»“æŸç­‰è°ƒç”¨è¯¥æ–¹æ³•</p> </li><li> <p>å…·ä½“ä½¿ç”¨</p> </li></ul> 
<p>ä¸º <code>es-drager</code> æ·»åŠ æ‹–æ‹½ç»“æŸäº‹ä»¶ç›‘å¬</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Drager</span>
  <span class="token attr-name">@drag-end</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onDragend<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Drager</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token function">useCommand</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">onDragend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// æ¯æ¬¡æ‹–æ‹½ç»“æŸè®°å½•å˜åŒ–</span>
  command<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_392"></a>æœ€å</h3> 
<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•å®ç°æ‹–æ‹½ç¼–è¾‘å™¨ä¸­çš„è¾…åŠ©çº¿åŠŸèƒ½ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æ’¤é”€ä¸é‡åšæ¥å¢å¼ºç¼–è¾‘å™¨çš„äº¤äº’æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p> 
<p>æŸ¥çœ‹å®Œæ•´ä»£ç è¯·æ»‘åˆ°é¡¶éƒ¨æœ‰ <code>github</code> é“¾æ¥åœ°å€å’Œåœ¨çº¿ç¤ºä¾‹</p> 
<ul><li>ç›¸å…³æ–‡ç« </li></ul> 
<p><a href="https://juejin.cn/post/7225152932675993655" rel="nofollow">å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶å®ç°ç»†èŠ‚</a></p> 
<p><a href="https://juejin.cn/post/7239895206081806373" rel="nofollow">å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶ç½‘æ ¼æ•ˆæœåŠä½¿ç”¨æ–¹æ³•</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd2b2be68f27bbe7e3c76f4b0399add6/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å¯æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç»„ä»¶ç½‘æ ¼æ•ˆæœåŠä½¿ç”¨æ–¹æ³•</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1dbc1677cdc20c72b6019b284d9a10e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Vueè§†é¢‘æ’ä»¶vue-video-playerçš„ä½¿ç”¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>