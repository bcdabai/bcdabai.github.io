<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unity中Websocket的简单使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Unity中Websocket的简单使用" />
<meta property="og:description" content="Tomcat架设简单Websocket服务器
用的时候打开就行了，先不管它
Unity中新建场景
建UI（UGUI）
有一个连接按钮Button
一个信息输入框InputField
一个发送按钮Button
一个断开按钮Button
一个消息显示框Text
场景中建一个GameObject，在上面加个脚本，就叫WSMgr好了
用到了BestHTTP这个插件
using System.Collections; using System.Collections.Generic; using UnityEngine; using BestHTTP; using BestHTTP.WebSocket; using System; using BestHTTP.Examples; using UnityEngine.UI; using System.Text; public class WSMgr : MonoBehaviour { //public string url = &#34;ws://localhost:8080/web1/websocket&#34;; public string url = &#34;ws://localhost:8080/web1/ws&#34;; public InputField msg; public Text console; private WebSocket webSocket; private void Start() { init(); } private void init() { webSocket = new WebSocket(new Uri(url)); webSocket." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e8dc4be6dc8909f0cd80e464b6abe79b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-28T10:27:11+08:00" />
<meta property="article:modified_time" content="2022-02-28T10:27:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unity中Websocket的简单使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Tomcat架设简单Websocket服务器<br> 用的时候打开就行了，先不管它</p> 
<p>Unity中新建场景<br> 建UI（UGUI）<br> 有一个连接按钮Button<br> 一个信息输入框InputField<br> 一个发送按钮Button<br> 一个断开按钮Button<br> 一个消息显示框Text</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8d/ff/7Ax0imsO_o.png"></p> 
<p>场景中建一个GameObject，在上面加个脚本，就叫WSMgr好了<br> 用到了BestHTTP这个插件</p> 
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using BestHTTP;
using BestHTTP.WebSocket;
using System;
using BestHTTP.Examples;
using UnityEngine.UI;
using System.Text;

public class WSMgr : MonoBehaviour {

    //public string url = "ws://localhost:8080/web1/websocket";
    public string url = "ws://localhost:8080/web1/ws";
    public InputField msg;
    public Text console;

    private WebSocket webSocket;

    private void Start()
    {
        init();
    }

    private void init()
    {
        webSocket = new WebSocket(new Uri(url));
        webSocket.OnOpen += OnOpen;
        webSocket.OnMessage += OnMessageReceived;
        webSocket.OnError += OnError;
        webSocket.OnClosed += OnClosed;
    }

    private void antiInit()
    {
        webSocket.OnOpen = null;
        webSocket.OnMessage = null;
        webSocket.OnError = null;
        webSocket.OnClosed = null;
        webSocket = null;
    }

    private void setConsoleMsg(string msg)
    {
        console.text = "Message: " + msg;
    }

    public void Connect()
    {
        webSocket.Open();
    }

    private byte[] getBytes(string message)
    {

        byte[] buffer = Encoding.Default.GetBytes(message);
        return buffer;
    }

    public void Send()
    {
        webSocket.Send(msg.text);
    }

    public void Send(string str)
    {
        webSocket.Send(str);
    }

    public void Close()
    {
        webSocket.Close();
    }

    #region WebSocket Event Handlers

    /// &lt;summary&gt;
    /// Called when the web socket is open, and we are ready to send and receive data
    /// &lt;/summary&gt;
    void OnOpen(WebSocket ws)
    {
        Debug.Log("connected");
        setConsoleMsg("Connected");
    }

    /// &lt;summary&gt;
    /// Called when we received a text message from the server
    /// &lt;/summary&gt;
    void OnMessageReceived(WebSocket ws, string message)
    {
        Debug.Log(message);
        setConsoleMsg(message);
    }

    /// &lt;summary&gt;
    /// Called when the web socket closed
    /// &lt;/summary&gt;
    void OnClosed(WebSocket ws, UInt16 code, string message)
    {
        Debug.Log(message);
        setConsoleMsg(message);
        antiInit();
        init();
    }

    private void OnDestroy()
    {
        if(webSocket!=null &amp;&amp; webSocket.IsOpen)
        {
            webSocket.Close();
            antiInit();
        }
    }

    /// &lt;summary&gt;
    /// Called when an error occured on client side
    /// &lt;/summary&gt;
    void OnError(WebSocket ws, Exception ex)
    {
        string errorMsg = string.Empty;
#if !UNITY_WEBGL || UNITY_EDITOR
        if (ws.InternalRequest.Response != null)
            errorMsg = string.Format("Status Code from Server: {0} and Message: {1}", ws.InternalRequest.Response.StatusCode, ws.InternalRequest.Response.Message);
#endif
        Debug.Log(errorMsg);
        setConsoleMsg(errorMsg);
        antiInit();
        init();
    }

    #endregion
}
</code></pre> 
<p>Connect Send Close 三个方法对应的就是三个按钮的功能<br> OnOpen OnMessage OnError OnClose这四个一看就是Websocket的四个事件对应的方法</p> 
<p>首先在Start方法中init()<br> 点击Connect，连接</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f4/12/V6V16N17_o.png"></p> 
<p><br> 在输入框中输入，点击Send就发送</p> 
<p>点击Close断开连接</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8f/d1/zq5WAgGH_o.png"></p> 
<p><br> 底部的Text中会显示消息</p> 
<p>同样，Tomcat服务端也有显示</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/86/dc/Jkrn69FV_o.png"></p> 
<p>发布WebGL测试可用</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cdc4df05f7b97d161a9e896d97a0f455/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">golang接口值类型接收者和指针类型接收者</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/658daaa68813e423a2edc8bef1bf51a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nodejs使用exceljs批量导出图片到excel并将excel下载到本地</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>