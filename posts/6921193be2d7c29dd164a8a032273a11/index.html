<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>django 如何再admin界面增加功能 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="django 如何再admin界面增加功能" />
<meta property="og:description" content=" 需求：再admin界面的基础 上增加一个授予用户权限的表单，使用Useradmin中一样的授权表单。
from django.contrib import admin from django import forms class PermissionForm(forms.ModelForm): user_list = forms.MultipleChoiceField( choices=(), widget=admin.widgets.FilteredSelectMultiple(&#34;user_list&#34;, False), label=&#34;grant user permission&#34;, required=False, ) class Meta: fields = (&#34;user_list&#34;,)//再页面上增加一个字段 def __init__(self, *args, **kwargs): super().__init__(*args, **kwargs) self.fields[&#34;user_list&#34;].choices = self.get_user_list(kwargs[&#34;instance&#34;].data_owner) self.fields[&#34;user_list&#34;].initial = self.get_exit_user_list(kwargs[&#34;instance&#34;]) def get_user_list(self, data_owner): //获取所有用户 return [(i.username, i.username) for i in _User.objects.filter(~Q(username=data_owner)).all()] def get_exit_user_list(self, obj): //获取已经授予权限的用户 return [i.username for i in _User.objects.filter(user_permissions__name=str(obj)).all()] class SampleBatchAdmin(admin.ModelAdmin): model = SampleBatch form = PermissionForm " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6921193be2d7c29dd164a8a032273a11/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T13:46:40+08:00" />
<meta property="article:modified_time" content="2023-02-23T13:46:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">django 如何再admin界面增加功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>需求：再admin界面的基础 上增加一个授予用户权限的表单，使用Useradmin中一样的授权表单。</p> 
<pre><code>from django.contrib import admin
from django import forms
class PermissionForm(forms.ModelForm):
    user_list = forms.MultipleChoiceField(
        choices=(),
        widget=admin.widgets.FilteredSelectMultiple("user_list", False),
        label="grant user permission",
        required=False,
    )

    class Meta:
        fields = ("user_list",)//再页面上增加一个字段

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields["user_list"].choices = self.get_user_list(kwargs["instance"].data_owner)
        self.fields["user_list"].initial = self.get_exit_user_list(kwargs["instance"])

    def get_user_list(self, data_owner):
    //获取所有用户
        return [(i.username, i.username) for i in _User.objects.filter(~Q(username=data_owner)).all()]

    def get_exit_user_list(self, obj):
    //获取已经授予权限的用户
        return [i.username for i in _User.objects.filter(user_permissions__name=str(obj)).all()]

class SampleBatchAdmin(admin.ModelAdmin):
    model = SampleBatch
    form = PermissionForm

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c755e3e7a61c4d5f319f343a22f3797/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android常用的第三方库--.jar、.aar</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7bd0199aeba7122dc3d2f659379da35a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安全测试的最佳实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>