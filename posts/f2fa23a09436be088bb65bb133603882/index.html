<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2023年电赛---运动目标控制与自动追踪系统（E题）OpenART mini的代码移植到OpenMV - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2023年电赛---运动目标控制与自动追踪系统（E题）OpenART mini的代码移植到OpenMV" />
<meta property="og:description" content="如果有嵌入式企业需要招聘校园大使，湖南区域的日常实习，任何区域的暑假Linux驱动实习岗位，可C站直接私聊，或者邮件：zhangyixu02@gmail.com，此消息至2025年1月1日前均有效
前言 （1）已经有不少同学根据我上一篇博客完成了前三问，恭喜恭喜。有很多同学卡在了第四问。
（2）我说了OpenART mini的代码是可行的。但是他们不会移植到OpenMV上，再次我讲移植之后的代码贴出来。
（3）吐槽一下，我就看不懂了。为啥这么多人移植不了。这不是几分钟的事情吗？（苦笑）
识别矩形框以及对应角点 （1）这个地方的40行会出现一个奇怪的报错，说corner没有被定义。但是前面明明调用corner = r.corners()进行了一波定义。
（2）然后我在在前面写上了一句corner = 0，报错就消失了。这个bug很奇怪。希望各位注意
from machine import Pin import sensor, image, time import pyb #import seekfree, pyb # 初始化TFT180屏幕 #lcd = seekfree.LCD180(3) # 初始化摄像头 sensor.reset() sensor.set_pixformat(sensor.RGB565) # 设置图像色彩格式为RGB565格式 sensor.set_framesize(sensor.QQVGA) # 设置图像大小为160*120 sensor.set_auto_whitebal(True) # 设置自动白平衡 sensor.set_brightness(3000) # 设置亮度为3000 sensor.skip_frames(time = 20) # 跳过帧 clock = time.clock() corner = 0 while(True): clock.tick() img = sensor.snapshot() # -----矩形框部分----- # 在图像中寻找矩形 for r in img." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f2fa23a09436be088bb65bb133603882/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-02T12:23:13+08:00" />
<meta property="article:modified_time" content="2023-09-02T12:23:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2023年电赛---运动目标控制与自动追踪系统（E题）OpenART mini的代码移植到OpenMV</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><mark>如果有嵌入式企业需要招聘校园大使，湖南区域的日常实习，任何区域的暑假Linux驱动实习岗位，可C站直接私聊，或者邮件：zhangyixu02@gmail.com，此消息至2025年1月1日前均有效</mark></p> 
<h2><a id="_1"></a>前言</h2> 
<blockquote> 
 <p>（1）已经有不少同学根据我上一篇博客完成了前三问，恭喜恭喜。有很多同学卡在了第四问。<br> （2）我说了OpenART mini的代码是可行的。但是他们不会移植到OpenMV上，再次我讲移植之后的代码贴出来。<br> （3）<mark>吐槽一下，我就看不懂了。为啥这么多人移植不了。这不是几分钟的事情吗？（苦笑）</mark></p> 
</blockquote> 
<h2><a id="_8"></a>识别矩形框以及对应角点</h2> 
<blockquote> 
 <p>（1）这个地方的40行会出现一个奇怪的报错，说corner没有被定义。但是前面明明调用corner = r.corners()进行了一波定义。<br> （2）然后我在在前面写上了一句corner = 0，报错就消失了。这个bug很奇怪。希望各位注意</p> 
</blockquote> 
<pre><code class="prism language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin
<span class="token keyword">import</span> sensor<span class="token punctuation">,</span> image<span class="token punctuation">,</span> time
<span class="token keyword">import</span> pyb
<span class="token comment">#import seekfree, pyb</span>

<span class="token comment"># 初始化TFT180屏幕</span>
<span class="token comment">#lcd = seekfree.LCD180(3)</span>

<span class="token comment"># 初始化摄像头</span>
sensor<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_pixformat<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>RGB565<span class="token punctuation">)</span> <span class="token comment"># 设置图像色彩格式为RGB565格式</span>
sensor<span class="token punctuation">.</span>set_framesize<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>QQVGA<span class="token punctuation">)</span>  <span class="token comment"># 设置图像大小为160*120</span>
sensor<span class="token punctuation">.</span>set_auto_whitebal<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>      <span class="token comment"># 设置自动白平衡</span>
sensor<span class="token punctuation">.</span>set_brightness<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>         <span class="token comment"># 设置亮度为3000</span>
sensor<span class="token punctuation">.</span>skip_frames<span class="token punctuation">(</span>time <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>       <span class="token comment"># 跳过帧</span>

clock <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
corner <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># -----矩形框部分-----</span>
    <span class="token comment"># 在图像中寻找矩形</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> img<span class="token punctuation">.</span>find_rects<span class="token punctuation">(</span>threshold <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 判断矩形边长是否符合要求</span>
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>w<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">and</span> r<span class="token punctuation">.</span>h<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
            <span class="token comment"># 在屏幕上框出矩形</span>
            img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>r<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取矩形角点位置</span>
            corner <span class="token operator">=</span> r<span class="token punctuation">.</span>corners<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 在屏幕上圈出矩形角点</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>

        <span class="token comment"># 打印四个角点坐标, 角点1的数组是corner[0], 坐标就是(corner[0][0],corner[0][1])</span>
        <span class="token comment"># 角点检测输出的角点排序每次不一定一致，矩形左上的角点有可能是corner0,1,2,3其中一个</span>
        corner1_str <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"corner1 = (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span>
        corner2_str <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"corner2 = (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span>
        corner3_str <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"corner3 = (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span>
        corner4_str <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"corner4 = (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>corner1_str <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> corner2_str <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> corner3_str <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> corner4_str<span class="token punctuation">)</span>
    <span class="token comment"># 显示到屏幕上，此部分会降低帧率</span>
    <span class="token comment">#lcd.show_image(img, 160, 120, 0, 0, zoom=0)  #屏幕显示</span>

    <span class="token comment"># 打印帧率</span>
    <span class="token comment">#print(clock.fps())</span>

</code></pre> 
<h2><a id="_64"></a>跟踪激光灯</h2> 
<pre><code class="prism language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin
<span class="token keyword">import</span> sensor<span class="token punctuation">,</span> image<span class="token punctuation">,</span> time
<span class="token keyword">import</span> pyb
<span class="token comment">#import seekfree, pyb</span>

<span class="token comment"># 初始化激光灯控制引脚P0，并置为高电平</span>
laser_light<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token string">"P0"</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
laser_light<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 初始化TFT180屏幕</span>
<span class="token comment">#lcd = seekfree.LCD180(3)</span>

<span class="token comment"># 初始化摄像头</span>
sensor<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_pixformat<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>RGB565<span class="token punctuation">)</span> <span class="token comment"># 设置图像色彩格式为RGB565格式</span>
sensor<span class="token punctuation">.</span>set_framesize<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>QQVGA<span class="token punctuation">)</span>  <span class="token comment"># 设置图像大小为160*120</span>
sensor<span class="token punctuation">.</span>set_auto_whitebal<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>      <span class="token comment"># 设置自动白平衡</span>
sensor<span class="token punctuation">.</span>set_brightness<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>         <span class="token comment"># 设置亮度为3000</span>
sensor<span class="token punctuation">.</span>skip_frames<span class="token punctuation">(</span>time <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>       <span class="token comment"># 跳过帧</span>

clock <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># -----跟踪激光部分-----</span>
    <span class="token comment"># 设置激光颜色阈值</span>
    red_td <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 这里要改</span>
    <span class="token comment"># 根据阈值找到色块</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>red_td<span class="token punctuation">,</span>pixels_threshold<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> area_threshold<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> merge<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>invert <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 在屏幕上画出色块</span>
        img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>b<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># 打印激光色块的中心位置</span>
        <span class="token comment"># 使用b.x()获取色块矩形左上角X坐标</span>
        <span class="token comment"># 使用b.y()获取色块矩形左上角Y坐标</span>
        <span class="token comment"># 使用b.w()获取色块矩形宽度</span>
        <span class="token comment"># 使用b.h()获取色块矩形高度</span>
        <span class="token comment"># 矩形中心坐标为（x + w/2，y + h/2)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"rect = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>b<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>w<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>b<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>h<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    <span class="token comment"># 显示到屏幕上，此部分会降低帧率</span>
    <span class="token comment">#lcd.show_image(img, 160, 120, 0, 0, zoom=0)  #屏幕显示</span>

    <span class="token comment"># 打印帧率</span>
    <span class="token comment">#print(clock.fps())</span>

</code></pre> 
<h2><a id="_118"></a>识别矩形框以及对应角点并跟踪激光灯</h2> 
<pre><code class="prism language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin
<span class="token keyword">import</span> sensor<span class="token punctuation">,</span> image<span class="token punctuation">,</span> time
<span class="token comment">#import seekfree, pyb</span>
<span class="token keyword">import</span>  pyb
<span class="token comment"># 初始化激光灯控制引脚，并置为高电平</span>
laser_light<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token string">"P9"</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
laser_light<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 初始化TFT180屏幕</span>
<span class="token comment">#lcd = seekfree.LCD180(3)</span>

<span class="token comment"># 初始化摄像头</span>
sensor<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_pixformat<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>RGB565<span class="token punctuation">)</span> <span class="token comment"># 设置图像色彩格式为RGB565格式</span>
sensor<span class="token punctuation">.</span>set_framesize<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>QQVGA<span class="token punctuation">)</span>  <span class="token comment"># 设置图像大小为160*120</span>
sensor<span class="token punctuation">.</span>set_auto_whitebal<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>      <span class="token comment"># 设置自动白平衡</span>
sensor<span class="token punctuation">.</span>set_brightness<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>         <span class="token comment"># 设置亮度为3000</span>
sensor<span class="token punctuation">.</span>skip_frames<span class="token punctuation">(</span>time <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>       <span class="token comment"># 跳过帧</span>

clock <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># -----矩形框部分-----</span>
    <span class="token comment"># 在图像中寻找矩形</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> img<span class="token punctuation">.</span>find_rects<span class="token punctuation">(</span>threshold <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 判断矩形边长是否符合要求</span>
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>w<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">and</span> r<span class="token punctuation">.</span>h<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
            <span class="token comment"># 在屏幕上框出矩形</span>
            img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>r<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取矩形角点位置</span>
            corner <span class="token operator">=</span> r<span class="token punctuation">.</span>corners<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 在屏幕上圈出矩形角点</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            img<span class="token punctuation">.</span>draw_circle<span class="token punctuation">(</span>corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corner<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>

            <span class="token comment"># 角点坐标打印详见OpenART mini识别矩形框以及对应角点文件</span>

<span class="token comment"># -----跟踪激光部分-----</span>
    <span class="token comment"># 设置激光颜色阈值</span>
    red_td <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 根据阈值找到色块</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> img<span class="token punctuation">.</span>find_blobs<span class="token punctuation">(</span>red_td<span class="token punctuation">,</span>pixels_threshold<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> area_threshold<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> merge<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>invert <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 在屏幕上画出色块</span>
        img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>b<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> thickness <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

        <span class="token comment"># 坐标打印详见OpenART mini跟踪激光灯文件</span>
    <span class="token comment"># 显示到屏幕上，此部分会降低帧率</span>
    <span class="token comment">#lcd.show_image(img, 160, 120, 0, 0, zoom=0)  #屏幕显示</span>

    <span class="token comment"># 打印帧率</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>fps<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d2bed58ff3363e8ac68893e3beb0f0a5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年电赛---运动目标控制与自动追踪系统（E题）OpenMV方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a2991d5afcad00302866d1fefc9ff59b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023年电赛---运动目标控制与自动追踪系统（E题）发挥题思路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>