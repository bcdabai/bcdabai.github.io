<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot集成XXL-JOB分布式任务调度 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot集成XXL-JOB分布式任务调度" />
<meta property="og:description" content="一、部署XXL-JOB任务调度中心 下载地址：XXXL开源社区
1、初始化数据库
2、修改配置文件
修改数据库密码，注意spring.mail.password设置是邮箱授权码，不是邮箱密码
3、启动项目
http://localhost:8080/xxl-job-admin/ 账号和密码，admin/123456
二、使用任务调度中心 1、新建执行器
2、新增任务管理器
报警邮件：当调度任务发生异常时，会往当前邮箱发送报警邮件
JobHandler：这个名称可以随便写，但要记住这个名称，因为springboot集成时会用到这个名称
其他的默认就行
三、SpringBoot集成XXL-JOB 1、依赖
&lt;dependency&gt; &lt;groupId&gt;com.xuxueli&lt;/groupId&gt; &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt; &lt;version&gt;2.3.1&lt;/version&gt; &lt;/dependency&gt; 2、properties文件配置
server.port=8081 #------------xxl-job配置-------------- # log config logging.config=classpath:logback.xml ### 调度中心部署地址,多个配置逗号分隔 such as &#34;http://address&#34; or &#34;http://address01,http://address02&#34; xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin ### 执行器token，非空时启动 token?xxl-job, access token，这个和任务调度中心配置的accessToken保持一致 xxl.job.accessToken=default_token ### 执行器app名称，和控制台那边配置一样的名称，不然注册不上去 xxl-job executor appname xxl.job.executor.appname=itcloud-executor ### 【选填】 执行器注册：优先使用该配置作为注册地址，为空时使用内嵌服务 “IP:PORT” 作为注册地址 #从而更灵活的支持容器类型执行器动态IP和动态映射端口问题 xxl.job.executor.address= ### 【选填】执行器IP：默认为空表示自动获取IP（即springboot容器的ip和端口，可以自动获取，也可以指定），多网卡是可手动设置指定IP，该IP不会绑定Host仅作为通讯使用； xxl.job.executor.ip= #【选填】执行器端口号：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同的执行器端口； xxl.job.executor.port=9999 ### 执行器日志文件存储路径，需要对该路径拥有读写权限；为空则使用默认路径 xxl.job.executor.logpath=/data/logs/xxl-job/executor ### 执行器日志保存天数 xxl.job.executor.logretentiondays=30 3、新增logback.xml日志文件
&lt;?xml version=&#34;1.0&#34; encoding=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e5db3d1174ab63f32a4b1024d5e11ce1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-05T10:48:03+08:00" />
<meta property="article:modified_time" content="2022-07-05T10:48:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot集成XXL-JOB分布式任务调度</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、部署XXL-JOB任务调度中心</h2> 
<p>下载地址：<a class="link-info" href="https://www.xuxueli.com/xxl-job/" rel="nofollow" title="XXXL开源社区">XXXL开源社区</a></p> 
<p>1、初始化数据库</p> 
<p><img alt="" height="567" src="https://images2.imgbox.com/a1/f7/KqZSKEsy_o.png" width="1200"></p> 
<p> </p> 
<p>2、修改配置文件</p> 
<p><img alt="" height="791" src="https://images2.imgbox.com/64/5f/ZYtT3SPo_o.png" width="1121"></p> 
<p> 修改数据库密码，注意spring.mail.password设置是邮箱授权码，不是邮箱密码</p> 
<p>3、启动项目</p> 
<p><a href="http://localhost:8080/xxl-job-admin/" rel="nofollow" title="http://localhost:8080/xxl-job-admin/">http://localhost:8080/xxl-job-admin/</a>  账号和密码，admin/123456</p> 
<h2>二、使用任务调度中心</h2> 
<p>1、新建执行器</p> 
<p><img alt="" height="507" src="https://images2.imgbox.com/17/b0/xFKImDx0_o.png" width="1200"></p> 
<p> 2、新增任务管理器</p> 
<p><img alt="" height="857" src="https://images2.imgbox.com/de/81/ovqJtjyx_o.png" width="1200"></p> 
<p>报警邮件：当调度任务发生异常时，会往当前邮箱发送报警邮件</p> 
<p>JobHandler：这个名称可以随便写，但要记住这个名称，因为springboot集成时会用到这个名称</p> 
<p>其他的默认就行</p> 
<p><img alt="" height="497" src="https://images2.imgbox.com/bc/89/n7YAzM3S_o.png" width="1200"></p> 
<h2> 三、SpringBoot集成XXL-JOB</h2> 
<p>1、依赖</p> 
<pre><code class="language-XML">&lt;dependency&gt;
	&lt;groupId&gt;com.xuxueli&lt;/groupId&gt;
	&lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;
	&lt;version&gt;2.3.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p>2、properties文件配置</p> 
<pre><code class="language-XML">server.port=8081
#------------xxl-job配置--------------
# log config
logging.config=classpath:logback.xml
### 调度中心部署地址,多个配置逗号分隔 such as "http://address" or "http://address01,http://address02"
xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin

###  执行器token，非空时启动 token?xxl-job, access token，这个和任务调度中心配置的accessToken保持一致
xxl.job.accessToken=default_token

### 执行器app名称，和控制台那边配置一样的名称，不然注册不上去  xxl-job executor appname
xxl.job.executor.appname=itcloud-executor

### 【选填】 执行器注册：优先使用该配置作为注册地址，为空时使用内嵌服务 “IP:PORT” 作为注册地址
#从而更灵活的支持容器类型执行器动态IP和动态映射端口问题
xxl.job.executor.address=

### 【选填】执行器IP：默认为空表示自动获取IP（即springboot容器的ip和端口，可以自动获取，也可以指定），多网卡是可手动设置指定IP，该IP不会绑定Host仅作为通讯使用；
xxl.job.executor.ip=

#【选填】执行器端口号：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同的执行器端口；
xxl.job.executor.port=9999

### 执行器日志文件存储路径，需要对该路径拥有读写权限；为空则使用默认路径
xxl.job.executor.logpath=/data/logs/xxl-job/executor

### 执行器日志保存天数
xxl.job.executor.logretentiondays=30</code></pre> 
<p>3、新增logback.xml日志文件</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration debug="false" scan="true" scanPeriod="1 seconds"&gt;

    &lt;contextName&gt;logback&lt;/contextName&gt;
    &lt;property name="log.path" value="/data/logs/=itcloud-xxl-job.log"/&gt;

    &lt;appender name="console" class="ch.qos.logback.core.ConsoleAppender"&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
        &lt;file&gt;${log.path}&lt;/file&gt;
        &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
            &lt;fileNamePattern&gt;${log.path}.%d{yyyy-MM-dd}.zip&lt;/fileNamePattern&gt;
        &lt;/rollingPolicy&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%date %level [%thread] %logger{36} [%file : %line] %msg%n
            &lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;root level="info"&gt;
        &lt;appender-ref ref="console"/&gt;
        &lt;appender-ref ref="file"/&gt;
    &lt;/root&gt;

&lt;/configuration&gt;</code></pre> 
<p>4、新建配置类 XxlJobConfig，这个是固定配置，照抄就行</p> 
<pre><code class="language-java">package cn.itcloud.itcloudxxjob.config;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import com.xxl.job.core.executor.impl.XxlJobSpringExecutor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @author zqing
 * @description: TODO
 * @date: 2022/6/29 15:27
 */
@Configuration
public class XxlJobConfig {
    private Logger logger = LoggerFactory.getLogger(XxlJobConfig.class);

    @Value("${xxl.job.admin.addresses}")
    private String adminAddresses;

    @Value("${xxl.job.accessToken}")
    private String accessToken;

    @Value("${xxl.job.executor.appname}")
    private String appname;

    @Value("${xxl.job.executor.address}")
    private String address;

    @Value("${xxl.job.executor.ip}")
    private String ip;

    @Value("${xxl.job.executor.port}")
    private int port;

    @Value("${xxl.job.executor.logpath}")
    private String logPath;

    @Value("${xxl.job.executor.logretentiondays}")
    private int logRetentionDays;


    @Bean
    public XxlJobSpringExecutor xxlJobExecutor() {
        logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.");
        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();
        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);
        xxlJobSpringExecutor.setAppname(appname);
        xxlJobSpringExecutor.setAddress(address);
        xxlJobSpringExecutor.setIp(ip);
        xxlJobSpringExecutor.setPort(port);
        xxlJobSpringExecutor.setAccessToken(accessToken);
        xxlJobSpringExecutor.setLogPath(logPath);
        xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays);

        return xxlJobSpringExecutor;
    }

    /**
     * 针对多网卡、容器内部署等情况，可借助 "spring-cloud-commons" 提供的 "InetUtils" 组件灵活定制注册IP；
     *
     *      1、引入依赖：
     *          &lt;dependency&gt;
     *             &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
     *             &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;
     *             &lt;version&gt;${version}&lt;/version&gt;
     *         &lt;/dependency&gt;
     *
     *      2、配置文件，或者容器启动变量
     *          spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.'
     *
     *      3、获取IP
     *          String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress();
     */


}</code></pre> 
<p>5、新建定时任务配置类 MyJobHandler</p> 
<pre><code class="language-java">package cn.itcloud.itcloudxxjob.job;

import com.xxl.job.core.biz.model.ReturnT;
import com.xxl.job.core.context.XxlJobHelper;
import com.xxl.job.core.handler.annotation.XxlJob;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;

/**
 * @author zqing
 * @description: TODO
 * @date: 2022/6/29 15:42
 */
@Component
@Slf4j
public class MyJobHandler {
    @Value("${server.port}")
    private String port;

    @XxlJob(value="demoJobHandler", init = "init", destroy = "destroy")
    public ReturnT&lt;String&gt; execute(){
        log.info("定时任务触发成功："+ LocalDateTime.now());
        log.info("端口号：{}",port);
        String jobParam = XxlJobHelper.getJobParam();
        log.info("参数：{}",jobParam);
        return ReturnT.SUCCESS;
    }

    private void init(){
        log.info("init 调用成功");
    }

    private void destroy(){
        log.info("destroy 调用成功");
    }

}
</code></pre> 
<p>其中 value="demoJobHandler" 的值是前面配置的JobHandler名称</p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/59/7f/N2Dnqd1I_o.png" width="904"></p> 
<p>6、 启动项目</p> 
<p><img alt="" height="302" src="https://images2.imgbox.com/42/60/KZjHZsxQ_o.png" width="1200"> 7、查询执行器的机器地址，看是否注册成功，如果没有地址要等15秒-30秒左右才会出来</p> 
<p><img alt="" height="559" src="https://images2.imgbox.com/38/fc/2SR07S0b_o.png" width="1200"></p> 
<p> </p> 
<h2>四、执行调度任务</h2> 
<p>1、执行一次</p> 
<p><img alt="" height="528" src="https://images2.imgbox.com/92/f5/fAImCTfw_o.png" width="1200"></p> 
<p> <img alt="" height="317" src="https://images2.imgbox.com/b0/6d/CV0K91mw_o.png" width="1200"></p> 
<p> 说明执行成功了，可以看调度日志</p> 
<p><img alt="" height="419" src="https://images2.imgbox.com/58/53/pgkK2x2H_o.png" width="1200"></p> 
<p> 2、附带参数执行调度</p> 
<p><img alt="" height="442" src="https://images2.imgbox.com/1e/c1/bUqymoXv_o.png" width="1200"></p> 
<p><img alt="" height="180" src="https://images2.imgbox.com/fc/70/87s4U8Cx_o.png" width="1198"></p> 
<p> 3、启动任务</p> 
<p><img alt="" height="458" src="https://images2.imgbox.com/38/dd/WlZo34Gz_o.png" width="1200"></p> 
<p> 任务是每5秒执行一次<img alt="" height="319" src="https://images2.imgbox.com/aa/f5/a8JBSfQw_o.png" width="1200"></p> 
<p> 以上就是集成效果，具体请看官方文档  <a class="link-info" href="https://www.xuxueli.com/xxl-job/" rel="nofollow" title="XXL开源社区">XXL开源社区</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29fbfebf58500b09d631ae0c9c7ea2df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">FileOutputStream文件写入类</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d432085ce086991714d68c0bd397b907/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于slmgr命令的那些事</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>