<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FFmpeg之PostProc - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FFmpeg之PostProc" />
<meta property="og:description" content="文章目录 一、概述二、宏定义三、类型定义四、重要函数4.1、postproc_version4.2、postproc_configuration4.3、postproc_license4.4、pp_postprocess4.5、pp_get_mode_by_name_and_quality 团队博客: 汽车电子社区
一、概述 FFmpeg中的postproc库是一个视频后处理库，用于应用各种图像处理滤镜和算法来改善和优化视频质量。
postproc库提供了一些常见的视频后处理滤镜，例如去隔行滤波、去噪滤波、锐化滤波等，可以用于增强视频的清晰度、减少噪点和伪影等。
在早期版本的 FFmpeg 中，postproc 库是默认启用的，可以通过命令行选项 -postproc 来应用后处理滤镜。但是自FFmpeg 3.2版本开始，postproc 库被标记为过时（deprecated），不再是默认启用的，而且在最新的 FFmpeg 版本中已经被移除。
现在，建议使用更现代和更强大的滤镜系统，如 libavfilter，来实现视频的后处理和滤波操作。libavfilter 提供了广泛的滤镜和处理器，可以进行更复杂和高级的视频处理。
所以，如果你使用最新版本的 FFmpeg，推荐使用 libavfilter 来进行视频后处理。
二、宏定义 #define PP_CPU_CAPS_MMX 0x80000000 #define PP_CPU_CAPS_MMX2 0x20000000 #define PP_CPU_CAPS_3DNOW 0x40000000 #define PP_CPU_CAPS_ALTIVEC 0x10000000 #define PP_CPU_CAPS_AUTO 0x00080000 #define PP_FORMAT 0x00000008 #define PP_FORMAT_420 (0x00000011|PP_FORMAT) #define PP_FORMAT_422 (0x00000001|PP_FORMAT) #define PP_FORMAT_411 (0x00000002|PP_FORMAT) #define PP_FORMAT_444 (0x00000000|PP_FORMAT) #define PP_FORMAT_440 (0x00000010|PP_FORMAT) #define PP_PICT_TYPE_QP2 0x00000010 ///&lt; MPEG2 style QScale #define LIBPOSTPROC_VERSION_MINOR 4 #define LIBPOSTPROC_VERSION_MICRO 100 #define LIBPOSTPROC_VERSION_INT AV_VERSION_INT(LIBPOSTPROC_VERSION_MAJOR, \ LIBPOSTPROC_VERSION_MINOR, \ LIBPOSTPROC_VERSION_MICRO) #define LIBPOSTPROC_VERSION AV_VERSION(LIBPOSTPROC_VERSION_MAJOR, \ LIBPOSTPROC_VERSION_MINOR, \ LIBPOSTPROC_VERSION_MICRO) #define LIBPOSTPROC_BUILD LIBPOSTPROC_VERSION_INT #define LIBPOSTPROC_IDENT &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/59accc6d081f6da8df81bce0d513a71b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T17:15:08+08:00" />
<meta property="article:modified_time" content="2024-01-17T17:15:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FFmpeg之PostProc</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">一、概述</a></li><li><a href="#_13" rel="nofollow">二、宏定义</a></li><li><a href="#_44" rel="nofollow">三、类型定义</a></li><li><a href="#_50" rel="nofollow">四、重要函数</a></li><li><ul><li><a href="#41postproc_version_51" rel="nofollow">4.1、postproc_version</a></li><li><a href="#42postproc_configuration_61" rel="nofollow">4.2、postproc_configuration</a></li><li><a href="#43postproc_license_71" rel="nofollow">4.3、postproc_license</a></li><li><a href="#44pp_postprocess_81" rel="nofollow">4.4、pp_postprocess</a></li><li><a href="#45pp_get_mode_by_name_and_quality_187" rel="nofollow">4.5、pp_get_mode_by_name_and_quality</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<p>  <strong>团队博客:</strong> <a href="https://bbs.csdn.net/forums/automotive-electronics"><strong>汽车电子社区</strong></a></p> 
<hr> 
<h2><a id="_6"></a>一、概述</h2> 
<p>  FFmpeg中的postproc库是一个视频后处理库，用于应用各种图像处理滤镜和算法来改善和优化视频质量。<br>   postproc库提供了一些常见的视频后处理滤镜，例如去隔行滤波、去噪滤波、锐化滤波等，可以用于增强视频的清晰度、减少噪点和伪影等。<br>   在早期版本的 FFmpeg 中，postproc 库是默认启用的，可以通过命令行选项 -postproc 来应用后处理滤镜。但是自FFmpeg 3.2版本开始，postproc 库被标记为过时（deprecated），不再是默认启用的，而且在最新的 FFmpeg 版本中已经被移除。<br>   现在，建议使用更现代和更强大的滤镜系统，如 libavfilter，来实现视频的后处理和滤波操作。libavfilter 提供了广泛的滤镜和处理器，可以进行更复杂和高级的视频处理。<br>   所以，如果你使用最新版本的 FFmpeg，推荐使用 libavfilter 来进行视频后处理。</p> 
<h2><a id="_13"></a>二、宏定义</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_CPU_CAPS_MMX</span>   <span class="token expression"><span class="token number">0x80000000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_CPU_CAPS_MMX2</span>  <span class="token expression"><span class="token number">0x20000000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_CPU_CAPS_3DNOW</span> <span class="token expression"><span class="token number">0x40000000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_CPU_CAPS_ALTIVEC</span> <span class="token expression"><span class="token number">0x10000000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_CPU_CAPS_AUTO</span>  <span class="token expression"><span class="token number">0x00080000</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT</span>         <span class="token expression"><span class="token number">0x00000008</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT_420</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x00000011</span><span class="token operator">|</span>PP_FORMAT<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT_422</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x00000001</span><span class="token operator">|</span>PP_FORMAT<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT_411</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x00000002</span><span class="token operator">|</span>PP_FORMAT<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT_444</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x00000000</span><span class="token operator">|</span>PP_FORMAT<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_FORMAT_440</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x00000010</span><span class="token operator">|</span>PP_FORMAT<span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PP_PICT_TYPE_QP2</span>  <span class="token expression"><span class="token number">0x00000010</span> </span><span class="token comment">///&lt; MPEG2 style QScale</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_VERSION_MINOR</span>   <span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_VERSION_MICRO</span> <span class="token expression"><span class="token number">100</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_VERSION_INT</span> <span class="token expression"><span class="token function">AV_VERSION_INT</span><span class="token punctuation">(</span>LIBPOSTPROC_VERSION_MAJOR<span class="token punctuation">,</span> </span><span class="token punctuation">\</span>
                                               <span class="token expression">LIBPOSTPROC_VERSION_MINOR<span class="token punctuation">,</span> </span><span class="token punctuation">\</span>
                                               <span class="token expression">LIBPOSTPROC_VERSION_MICRO<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_VERSION</span>     <span class="token expression"><span class="token function">AV_VERSION</span><span class="token punctuation">(</span>LIBPOSTPROC_VERSION_MAJOR<span class="token punctuation">,</span> </span><span class="token punctuation">\</span>
                                           <span class="token expression">LIBPOSTPROC_VERSION_MINOR<span class="token punctuation">,</span> </span><span class="token punctuation">\</span>
                                           <span class="token expression">LIBPOSTPROC_VERSION_MICRO<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_BUILD</span>       <span class="token expression">LIBPOSTPROC_VERSION_INT</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIBPOSTPROC_IDENT</span>       <span class="token string">"postproc"</span> <span class="token expression"><span class="token function">AV_STRINGIFY</span><span class="token punctuation">(</span>LIBPOSTPROC_VERSION<span class="token punctuation">)</span></span></span>
</code></pre> 
<h2><a id="_44"></a>三、类型定义</h2> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">void</span> pp_context<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">void</span> pp_mode<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_50"></a>四、重要函数</h2> 
<h3><a id="41postproc_version_51"></a>4.1、postproc_version</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">unsigned</span> <span class="token function">postproc_version</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">av_assert0</span><span class="token punctuation">(</span>LIBPOSTPROC_VERSION_MICRO <span class="token operator">&gt;=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> LIBPOSTPROC_VERSION_INT<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  返回LIBPOSTPROC_VERSION_INT的常量值。</p> 
<h3><a id="42postproc_configuration_61"></a>4.2、postproc_configuration</h3> 
<p>  返回libpostproc构建时配置。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">postproc_configuration</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> FFMPEG_CONFIGURATION<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="43postproc_license_71"></a>4.3、postproc_license</h3> 
<p>  返回libpostproc许可证。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">postproc_license</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LICENSE_PREFIX</span> <span class="token string">"libpostproc license: "</span></span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>LICENSE_PREFIX FFMPEG_LICENSE<span class="token punctuation">[</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>LICENSE_PREFIX<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="44pp_postprocess_81"></a>4.4、pp_postprocess</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span>  <span class="token function">pp_postprocess</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span> src<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> srcStride<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token keyword">uint8_t</span> <span class="token operator">*</span> dst<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> dstStride<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span>
                     <span class="token keyword">const</span> <span class="token keyword">int8_t</span> <span class="token operator">*</span>QP_store<span class="token punctuation">,</span>  <span class="token keyword">int</span> QPStride<span class="token punctuation">,</span>
                     pp_mode <span class="token operator">*</span>vm<span class="token punctuation">,</span>  <span class="token keyword">void</span> <span class="token operator">*</span>vc<span class="token punctuation">,</span> <span class="token keyword">int</span> pict_type<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> mbWidth <span class="token operator">=</span> <span class="token punctuation">(</span>width<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> mbHeight<span class="token operator">=</span> <span class="token punctuation">(</span>height<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">;</span>
    PPMode <span class="token operator">*</span>mode <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    PPContext <span class="token operator">*</span>c <span class="token operator">=</span> vc<span class="token punctuation">;</span>
    <span class="token keyword">int</span> minStride<span class="token operator">=</span> <span class="token function">FFMAX</span><span class="token punctuation">(</span><span class="token function">FFABS</span><span class="token punctuation">(</span>srcStride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FFABS</span><span class="token punctuation">(</span>dstStride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> absQPStride <span class="token operator">=</span> <span class="token function">FFABS</span><span class="token punctuation">(</span>QPStride<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// c-&gt;stride and c-&gt;QPStride are always positive</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">-&gt;</span>stride <span class="token operator">&lt;</span> minStride <span class="token operator">||</span> c<span class="token operator">-&gt;</span>qpStride <span class="token operator">&lt;</span> absQPStride<span class="token punctuation">)</span>
        <span class="token function">reallocBuffers</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span>
                       <span class="token function">FFMAX</span><span class="token punctuation">(</span>minStride<span class="token punctuation">,</span> c<span class="token operator">-&gt;</span>stride<span class="token punctuation">)</span><span class="token punctuation">,</span>
                       <span class="token function">FFMAX</span><span class="token punctuation">(</span>c<span class="token operator">-&gt;</span>qpStride<span class="token punctuation">,</span> absQPStride<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>QP_store <span class="token operator">||</span> <span class="token punctuation">(</span>mode<span class="token operator">-&gt;</span>lumMode <span class="token operator">&amp;</span> FORCE_QUANT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        QP_store<span class="token operator">=</span> c<span class="token operator">-&gt;</span>forcedQPTable<span class="token punctuation">;</span>
        absQPStride <span class="token operator">=</span> QPStride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token operator">-&gt;</span>lumMode <span class="token operator">&amp;</span> FORCE_QUANT<span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>mbWidth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token operator">-&gt;</span>forcedQPTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span> mode<span class="token operator">-&gt;</span>forcedQuant<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>mbWidth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token operator">-&gt;</span>forcedQPTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pict_type <span class="token operator">&amp;</span> PP_PICT_TYPE_QP2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token operator">=</span> <span class="token function">FFMAX</span><span class="token punctuation">(</span>mbHeight <span class="token operator">*</span> absQPStride<span class="token punctuation">,</span> mbWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token punctuation">(</span>count<span class="token operator">&gt;&gt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">AV_WN32</span><span class="token punctuation">(</span>c<span class="token operator">-&gt;</span>stdQPTable <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AV_RN32</span><span class="token punctuation">(</span>QP_store <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;</span> <span class="token number">0x7F7F7F7F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            c<span class="token operator">-&gt;</span>stdQPTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> QP_store<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        QP_store<span class="token operator">=</span> c<span class="token operator">-&gt;</span>stdQPTable<span class="token punctuation">;</span>
        QPStride<span class="token operator">=</span> absQPStride<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> x<span class="token punctuation">,</span>y<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> y<span class="token operator">&lt;</span>mbHeight<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> x<span class="token operator">&lt;</span>mbWidth<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token function">av_log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> AV_LOG_INFO<span class="token punctuation">,</span> <span class="token string">"%2d "</span><span class="token punctuation">,</span> QP_store<span class="token punctuation">[</span>x <span class="token operator">+</span> y<span class="token operator">*</span>QPStride<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">av_log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> AV_LOG_INFO<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">av_log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> AV_LOG_INFO<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pict_type<span class="token operator">&amp;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>QPStride <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> i<span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token operator">=</span> <span class="token function">FFMAX</span><span class="token punctuation">(</span>mbHeight <span class="token operator">*</span> QPStride<span class="token punctuation">,</span> mbWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token punctuation">(</span>count<span class="token operator">&gt;&gt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token function">AV_WN32</span><span class="token punctuation">(</span>c<span class="token operator">-&gt;</span>nonBQPTable <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AV_RN32</span><span class="token punctuation">(</span>QP_store <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3F3F3F3F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                c<span class="token operator">-&gt;</span>nonBQPTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> QP_store<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3F</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>mbHeight<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>absQPStride<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    c<span class="token operator">-&gt;</span>nonBQPTable<span class="token punctuation">[</span>i<span class="token operator">*</span>absQPStride<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> QP_store<span class="token punctuation">[</span>i<span class="token operator">*</span>QPStride<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3F</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">av_log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> AV_LOG_DEBUG<span class="token punctuation">,</span> <span class="token string">"using npp filters 0x%X/0x%X\n"</span><span class="token punctuation">,</span>
           mode<span class="token operator">-&gt;</span>lumMode<span class="token punctuation">,</span> mode<span class="token operator">-&gt;</span>chromMode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">postProcess</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> srcStride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dstStride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> QP_store<span class="token punctuation">,</span> QPStride<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mode<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> src<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> dst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> dst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    width  <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span>c<span class="token operator">-&gt;</span>hChromaSubSample<span class="token punctuation">;</span>
    height <span class="token operator">=</span> <span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span>c<span class="token operator">-&gt;</span>vChromaSubSample<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token operator">-&gt;</span>chromMode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">postProcess</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> srcStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dstStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> QP_store<span class="token punctuation">,</span> QPStride<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> mode<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">postProcess</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> srcStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dstStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> QP_store<span class="token punctuation">,</span> QPStride<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> mode<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>srcStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> dstStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> srcStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> dstStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">linecpy</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> src<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> srcStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">linecpy</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> src<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> srcStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> y<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> y<span class="token operator">&lt;</span>height<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">*</span>dstStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">*</span>srcStride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">*</span>dstStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">*</span>srcStride<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="45pp_get_mode_by_name_and_quality_187"></a>4.5、pp_get_mode_by_name_and_quality</h3> 
<p>  如果发生错误，返回一个pp_mode或NULL。</p> 
<pre><code class="prism language-cpp">pp_mode <span class="token operator">*</span><span class="token function">pp_get_mode_by_name_and_quality</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> quality<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> temp<span class="token punctuation">[</span>GET_MODE_BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> filterDelimiters<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">",/"</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> optionDelimiters<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">":|"</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">PPMode</span> <span class="token operator">*</span>ppMode<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>filterToken<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
        <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_ERROR<span class="token punctuation">,</span> <span class="token string">"pp: Missing argument\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"help"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> pp_help<span class="token punctuation">;</span> <span class="token function">strchr</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> p <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">av_strlcpy</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token function">FFMIN</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">strchr</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token operator">-</span> p <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_INFO<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    ppMode<span class="token operator">=</span> <span class="token function">av_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PPMode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ppMode<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    ppMode<span class="token operator">-&gt;</span>lumMode<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>chromMode<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>maxTmpNoise<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">700</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>maxTmpNoise<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1500</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>maxTmpNoise<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>maxAllowedY<span class="token operator">=</span> <span class="token number">234</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>minAllowedY<span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>baseDcDiff<span class="token operator">=</span> <span class="token number">256</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>flatnessThreshold<span class="token operator">=</span> <span class="token number">56</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>maxClippedThreshold<span class="token operator">=</span> <span class="token punctuation">(</span>AVRational<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    ppMode<span class="token operator">-&gt;</span>error<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token function">memset</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GET_MODE_BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">av_strlcpy</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> name<span class="token punctuation">,</span> GET_MODE_BUFFER_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_DEBUG<span class="token punctuation">,</span> <span class="token string">"pp: %s\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filterName<span class="token punctuation">;</span>
        <span class="token keyword">int</span> q<span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span> <span class="token comment">//PP_QUALITY_MAX;</span>
        <span class="token keyword">int</span> chrom<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> luma<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>option<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>options<span class="token punctuation">[</span>OPTIONS_ARRAY_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> filterNameOk<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numOfUnknownOptions<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> enable<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//does the user want us to enabled or disabled the filter</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>tokstate<span class="token punctuation">;</span>

        filterToken<span class="token operator">=</span> <span class="token function">av_strtok</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> filterDelimiters<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tokstate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>filterToken<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        p<span class="token operator">+=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>filterToken<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// p points to next filterToken</span>
        filterName<span class="token operator">=</span> <span class="token function">av_strtok</span><span class="token punctuation">(</span>filterToken<span class="token punctuation">,</span> optionDelimiters<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tokstate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filterName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ppMode<span class="token operator">-&gt;</span>error<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_DEBUG<span class="token punctuation">,</span> <span class="token string">"pp: %s::%s\n"</span><span class="token punctuation">,</span> filterToken<span class="token punctuation">,</span> filterName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>filterName <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            enable<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            filterName<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//for all options</span>
            option<span class="token operator">=</span> <span class="token function">av_strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> optionDelimiters<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tokstate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>option<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_DEBUG<span class="token punctuation">,</span> <span class="token string">"pp: option: %s\n"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"autoq"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">)</span> q<span class="token operator">=</span> quality<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"nochrom"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"y"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">)</span> chrom<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"chrom"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">)</span> chrom<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"noluma"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">)</span> luma<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                options<span class="token punctuation">[</span>numOfUnknownOptions<span class="token punctuation">]</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>
                numOfUnknownOptions<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>numOfUnknownOptions <span class="token operator">&gt;=</span> OPTIONS_ARRAY_SIZE<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        options<span class="token punctuation">[</span>numOfUnknownOptions<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        <span class="token comment">/* replace stuff from the replace Table */</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> replaceTable<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>replaceTable<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> filterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                size_t newlen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>replaceTable<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> plen<span class="token punctuation">;</span>
                <span class="token keyword">int</span> spaceLeft<span class="token punctuation">;</span>

                p<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token operator">=</span><span class="token char">','</span><span class="token punctuation">;</span>

                plen<span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                spaceLeft<span class="token operator">=</span> p <span class="token operator">-</span> temp <span class="token operator">+</span> plen<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>spaceLeft <span class="token operator">+</span> newlen  <span class="token operator">&gt;=</span> GET_MODE_BUFFER_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    ppMode<span class="token operator">-&gt;</span>error<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">memmove</span><span class="token punctuation">(</span>p <span class="token operator">+</span> newlen<span class="token punctuation">,</span> p<span class="token punctuation">,</span> plen<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">memcpy</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> replaceTable<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
                filterNameOk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>shortName<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>   <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longName<span class="token punctuation">,</span> filterName<span class="token punctuation">)</span>
               <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>shortName<span class="token punctuation">,</span> filterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                ppMode<span class="token operator">-&gt;</span>lumMode <span class="token operator">&amp;=</span> <span class="token operator">~</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask<span class="token punctuation">;</span>
                ppMode<span class="token operator">-&gt;</span>chromMode <span class="token operator">&amp;=</span> <span class="token operator">~</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask<span class="token punctuation">;</span>

                filterNameOk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>enable<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// user wants to disable it</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>q <span class="token operator">&gt;=</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>minLumQuality <span class="token operator">&amp;&amp;</span> luma<span class="token punctuation">)</span>
                    ppMode<span class="token operator">-&gt;</span>lumMode<span class="token operator">|=</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>chrom<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span>chrom<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>chromDefault<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>q <span class="token operator">&gt;=</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>minChromQuality<span class="token punctuation">)</span>
                            ppMode<span class="token operator">-&gt;</span>chromMode<span class="token operator">|=</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask<span class="token punctuation">;</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> LEVEL_FIX<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">int</span> o<span class="token punctuation">;</span>
                    ppMode<span class="token operator">-&gt;</span>minAllowedY<span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
                    ppMode<span class="token operator">-&gt;</span>maxAllowedY<span class="token operator">=</span> <span class="token number">234</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span>o<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>  <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"fullyrange"</span><span class="token punctuation">)</span>
                           <span class="token operator">||</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            ppMode<span class="token operator">-&gt;</span>minAllowedY<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                            ppMode<span class="token operator">-&gt;</span>maxAllowedY<span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
                            numOfUnknownOptions<span class="token operator">--</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> TEMP_NOISE_FILTER<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">int</span> o<span class="token punctuation">;</span>
                    <span class="token keyword">int</span> numOfNoises<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

                    <span class="token keyword">for</span><span class="token punctuation">(</span>o<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">char</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
                        ppMode<span class="token operator">-&gt;</span>maxTmpNoise<span class="token punctuation">[</span>numOfNoises<span class="token punctuation">]</span><span class="token operator">=</span>
                            <span class="token function">strtol</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tail<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>tail<span class="token operator">!=</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            numOfNoises<span class="token operator">++</span><span class="token punctuation">;</span>
                            numOfUnknownOptions<span class="token operator">--</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>numOfNoises <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> V_DEBLOCK   <span class="token operator">||</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> H_DEBLOCK
                     <span class="token operator">||</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> V_A_DEBLOCK <span class="token operator">||</span> filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> H_A_DEBLOCK<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">int</span> o<span class="token punctuation">;</span>

                    <span class="token keyword">for</span><span class="token punctuation">(</span>o<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> options<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> o<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">char</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
                        <span class="token keyword">int</span> val<span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tail<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>tail<span class="token operator">==</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

                        numOfUnknownOptions<span class="token operator">--</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> ppMode<span class="token operator">-&gt;</span>baseDcDiff<span class="token operator">=</span> val<span class="token punctuation">;</span>
                        <span class="token keyword">else</span> ppMode<span class="token operator">-&gt;</span>flatnessThreshold<span class="token operator">=</span> val<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>filters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mask <span class="token operator">==</span> FORCE_QUANT<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">int</span> o<span class="token punctuation">;</span>
                    ppMode<span class="token operator">-&gt;</span>forcedQuant<span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>

                    <span class="token keyword">for</span><span class="token punctuation">(</span>o<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> options<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> o<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">char</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
                        <span class="token keyword">int</span> val<span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tail<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>tail<span class="token operator">==</span>options<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

                        numOfUnknownOptions<span class="token operator">--</span><span class="token punctuation">;</span>
                        ppMode<span class="token operator">-&gt;</span>forcedQuant<span class="token operator">=</span> val<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>filterNameOk<span class="token punctuation">)</span> ppMode<span class="token operator">-&gt;</span>error<span class="token operator">++</span><span class="token punctuation">;</span>
        ppMode<span class="token operator">-&gt;</span>error <span class="token operator">+=</span> numOfUnknownOptions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_DEBUG<span class="token punctuation">,</span> <span class="token string">"pp: lumMode=%X, chromMode=%X\n"</span><span class="token punctuation">,</span> ppMode<span class="token operator">-&gt;</span>lumMode<span class="token punctuation">,</span> ppMode<span class="token operator">-&gt;</span>chromMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ppMode<span class="token operator">-&gt;</span>error<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">av_log</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> AV_LOG_ERROR<span class="token punctuation">,</span> <span class="token string">"%d errors in postprocess string \"%s\"\n"</span><span class="token punctuation">,</span> ppMode<span class="token operator">-&gt;</span>error<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">av_free</span><span class="token punctuation">(</span>ppMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ppMode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eebc407e1ce7c68357870c98373a2326/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Chrome 浏览器插件 cookies API 解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d709f17041bb1f3c1d04cf1181b4e339/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">低代码与智能化办公：解锁工作效率的新纪元</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>