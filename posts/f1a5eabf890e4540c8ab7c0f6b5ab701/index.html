<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Js中foreach()用法及使用的坑 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Js中foreach()用法及使用的坑" />
<meta property="og:description" content="js中foreach是用于遍历数组的方法，将遍历到的元素传递给回调函数，遍历的数组不能是空的要有值。
foreach 语法： [ ].forEach(function(value,index,array){ //code something }); forEach()方法对数组的每个元素执行一次提供的函数。
var array = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]; array.forEach(function(element) { console.log(element); }); 输出为：
a; b; c; forEach()方法对数组的每个元素执行一次提供的函数。总是返回undefined；
var arr = [1,2,3,4]; arr.forEach(alert); //等价于： var arr = [1, 2, 3, 4]; for (var k = 0, length = arr.length; k &lt; length; k&#43;&#43;) { alert(array[k]); } forEach方法中的function回调有三个参数：
第一个参数是遍历的数组内容，
第二个参数是对应的数组索引，
第三个参数是数组本身
forEach使用的坑 1.forEach不支持break
大家都知道，在使用for循环时可以使用break跳出循环，比如我希望找到数组中符合条件的第一个元素就跳出循环，这对于优化数组遍历是非常棒的。很遗憾，forEach并不支持break操作，使用break会导致报错。
let arr = [1, 2, 3, 4], i = 0, length = arr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f1a5eabf890e4540c8ab7c0f6b5ab701/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-07T10:29:43+08:00" />
<meta property="article:modified_time" content="2021-06-07T10:29:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Js中foreach()用法及使用的坑</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="http://www.fly63.com/tag/js" rel="nofollow">js</a>中foreach是用于遍历数组的方法，将遍历到的元素传递给回调<a href="http://www.fly63.com/tag/%E5%87%BD%E6%95%B0" rel="nofollow">函数</a>，遍历的数组不能是空的要有值。</p> 
<h4 id="heading-0"><strong>foreach <a href="http://www.fly63.com/tag/%E8%AF%AD%E6%B3%95" rel="nofollow">语法</a>：</strong></h4> 
<pre><code class="language-javascript">[ ].forEach(function(value,index,array){
　　//code something
});</code></pre> 
<p><strong>forEach()</strong>方法对数组的每个元素执行一次提供的函数。</p> 
<pre><code class="language-javascript">var array = ['a', 'b', 'c'];
array.forEach(function(element) {
  console.log(element);
});</code></pre> 
<p>输出为：</p> 
<pre><code class="language-javascript">a;
b;
c;</code></pre> 
<p>forEach()方法对数组的每个元素执行一次提供的函数。总是返回undefined；</p> 
<pre><code class="language-javascript">var arr = [1,2,3,4];   
arr.forEach(alert); 
 
//等价于： 
var arr = [1, 2, 3, 4];
for (var k = 0, length = arr.length; k &lt; length; k++) {
  alert(array[k]);
}</code></pre> 
<p>forEach方法中的function回调有三个参数：<br> 第一个参数是遍历的数组内容，<br> 第二个参数是对应的数组索引，<br> 第三个参数是数组本身</p> 
<p> </p> 
<h4 id="heading-1"><strong>forEach使用的坑</strong></h4> 
<p><strong>1.forEach不支持break</strong></p> 
<p>大家都知道，在使用for循环时可以使用break跳出循环，比如我希望找到数组中符合条件的第一个元素就跳出循环，这对于优化数组遍历是非常棒的。很遗憾，forEach并不支持break操作，使用break会导致报错。</p> 
<pre><code class="language-javascript">let arr = [1, 2, 3, 4],
    i = 0,
    length = arr.length;
for (; i &lt; length; i++) {
    console.log(arr[i]); //1,2
    if (arr[i] === 2) {
        break;
    };
};

arr.forEach((self,index) =&gt; {
    console.log(self);
    if (self === 2) {
        break; //报错
    };
});</code></pre> 
<p>那forEach能不能跳出循环呢？可以，不过不是使用break，而是结合try catch操作</p> 
<p><strong>2.forEach中使用return无效</strong></p> 
<p>首先需要确定的，直接再for循环中使用return会报错（函数中使用for可以return），forEach中使用return不会报错，但rerutn并不会生效，我们来看个例子：</p> 
<pre><code class="language-javascript">let arr = [1, 2, 3, 4];

function find(array, num) {
    array.forEach((self, index) =&gt; {
        if (self === num) {
            return index;
        };
    });
};
let index = find(arr, 2);// undefined</code></pre> 
<p>上述<a href="http://www.fly63.com/tag/%E4%BB%A3%E7%A0%81" rel="nofollow">代码</a>想要找到数字2在数组中的索引，但return并不会起到终止代码运行并返回值的作用。</p> 
<p>当然如果我们真的要用return返回某个值，那就只能将return操作放在函数中，而不是forEach循环中，像这样：</p> 
<pre><code class="language-javascript">function find(array, num) {
    let _index;
    array.forEach((self, index) =&gt; {
        if (self === num) {
            _index = index;
        };
    });
    return _index;
};</code></pre> 
<p><strong>3.forEach删除自身元素index不会被重置</strong></p> 
<p>还记得文章开头的问题吗，那段代码其实只会执行一次，数组也不会被删除干净，这是因为forEach在遍历跑完回调函数后，会隐性让index自增，像这样：</p> 
<pre><code class="language-javascript">arr.forEach((item, index) =&gt; {
    arr.splice(index, 1);
    console.log(1);
    //这里隐性让index自增加1
    index++;
});</code></pre> 
<p>当第一次遍历结束，此时数组为[2]而index变成了1，此时数组最大索引只是0，不满足条件，所以跳出了循环。</p> 
<p>灵机一动，有没有什么办法让此时的forEach不跳出循环呢，当然有，使用ES6的拓展运算符。</p> 
<pre><code class="language-javascript">[...arr].forEach((item, index) =&gt; {
    arr.splice(index, 1);
    console.log(1);
});</code></pre> 
<p>通过拓展运算符重置数组arr，达到不跳出循环的目的，你会发现内部确实执行了两次，很遗憾的是index依旧没被重置，所以数组arr还是无法在遍历的同时删空自己。</p> 
<p>因为在实际开发中，遍历数组同时删除某项的操作十分常见，所以对于习惯了forEach的同学，这一点一定要注意。</p> 
<p> </p> 
<h4 id="heading-2"><strong>for与forEach的区别</strong></h4> 
<p>那么说到这里，for循环与forEach有什么区别呢？我想大家应该都能说上几点了吧，比如：</p> 
<p>1.for循环可以使用break跳出循环，但forEach不能。</p> 
<p>2.for循环可以控制循环起点（i初始化的数字决定循环的起点），forEach只能默认从索引0开始。</p> 
<p>3.for循环过程中支持修改索引（修改 i），但forEach做不到（底层控制index自增，我们无法左右它）。</p> 
<p> </p> 
<h4 id="heading-3"><strong>数组遍历并删除自身</strong></h4> 
<p>好了，我们回归问题的本质，怎么在遍历一个数组的同时，并删除符合条件的所有项呢？</p> 
<p>其实很简单，我们可以使用for循环，像这样：</p> 
<pre><code class="language-javascript">let arr = [1, 2, 1],
    i = 0,
    length = arr.length;

for (; i &lt; length; i++) {
    // 删除数组中所有的1
    if (arr[i] === 1) {
        arr.splice(i, 1);
        //重置i，否则i会跳一位
        i--;
    };
};
console.log(arr);//[2]</code></pre> 
<p>删除符合条件的所有项，不就是过滤吗？过滤，本能想到filter方法，也很简单：</p> 
<pre><code class="language-javascript">var arr1 = arr.filter((index) =&gt; {
    return index !== 1;
});
console.log(arr1); //[2]</code></pre> 
<p>更少的代码量，只是得新建一个变量来接受filter方法的返回值。</p> 
<p>你说，我这个人就比较倔强，forEach因为index索引无法重置，对于删除数组项真的很困难，那我非要用forEach去做这个功能行不行，当然行，只是我们得让数组反过来遍历：</p> 
<pre><code class="language-javascript">arr.slice().reverse().forEach(function (item, index, arr1) {
    if (item === 1) {
        arr.splice(arr1.length - 1 - index, 1);
    }
});
console.log(arr);//[2]</code></pre> 
<p>当然我们并不推荐这么做，因为数组方法繁多，并没有绝对的好与不好，什么情况下使用对的方法才是更棒的做法，这里使用forEach虽然达到了目的，但代码阅读体验并不太好。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26a8a8175b2629a957bfe2284326c36b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">太原理工大学2021数据结构课程设计(构造可以使n个城市连接的最小生成树)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6caf90b9cb5b7b7a6badad48a2b4a40d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">帆软报表工程师FCRA试题及答案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>