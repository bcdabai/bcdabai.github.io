<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>开源无国界？vue-cli、node-ipc被投毒事件分析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="开源无国界？vue-cli、node-ipc被投毒事件分析" />
<meta property="og:description" content="简述 近日我们监测到 Vue.js 生态中的 vue-cli 包遭遇供应链投毒，而被投毒的 node-ipc 包在 npm 上每周下载量超百万，影响非常广泛。
被投毒的情况如下：
vue-cli是Vue.js 开发的标准工具，该工具被广泛应用于vue的快速开发其依赖的node-ipc是用于本地和远程进程间通信的一个js模块，也用于支持linux，windows，mac等系统中的socket通信。node-ipc包的作者近期在node-ipc的10.1.1-10.1.2版本添加了恶意JS，该JS会修改俄罗斯和白俄罗斯用户的所有文件为❤️，但不到24小时后又删除该恶意JS，添加会在用户桌面创建反战宣传标语的peacenotwar模块。vuejs的团队在发现node-ipc添加了peacenotwar模块后锁定了vue-cli依赖的node-ipc版本为9.2.1，研究人员随后又发现node-ipc的作者此前添加的恶意JS存在于node-ipc旧版本中。 （问题组件每周下载量截图）
事件时间线 3月7号 开发者RIAEvangelist在node-ipc包中添加名为ssl-geospec.js的恶意JS文件，将node-ipc的版本号更新为10.1.1
3月8号 删除ssl-geospec.js该文件，版本号更新为10.1.3
3月9号 开发者RIAEvangelist在node-ipc包中添加peacenotwar模块，该模块会在桌面静默添加反战宣传文件
3月15号 有开发者在论坛中反馈构建过程中发现被创建反战标语文件
3月15号 Vue-cli发布5.0.3版本，在新版本中锁定vue-cli依赖的node-ipc版本为9.2.1
研究人员分析发现node-ipc的作者不只添加了反战标语，还在旧版本10.1.1-10.1.2中添加了恶意JS文件删除俄罗斯和白俄罗斯用户文件
3月16号 vue的开发者sodatea针对此事件的回应如下：
node-ipc 9.2.2 增加peacenotwar模块，该模块会在未经用户同意的情况下写入WITH-LOVE-FROM-AMERICA.txt用户的Desktop和OneDrive文件夹。vue-cli已经发布了 4.5.16 和 5.0.3 来锁定依赖版本。受影响的用户：在2022-03-15T05:40:26.758Z和2022-03-15T13:17:57.076Z；期间创建的新项目或者更新了项目依赖的人。从俄罗斯和白俄罗斯 IP 删除文件的恶意代码不包含在 9.2.2 版本中 恶意代码分析 我们针对node-ipc包中使用的恶意js文件（node-ipc/ssl-geospec.js at 847047cf7f81ab08352038b2204f0e7633449580 · RIAEvangelist/node-ipc · GitHub）进行分析。
可以看到多处使用base64编码对行为意图进行隐藏
远程API地址解码为
https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154
使用https加载远程API
解密后的字符串，可以看出c为国家，e为俄罗斯，i为白俄罗斯，其他为文件路径
判断是否为俄罗斯或白俄罗斯，将结果注册为a
如果是则执行h函数
h函数递归爬取指定目录，将所传入的路径中的文件替换为base64编码的4p2k77iP，而其解码后为❤️
针对企业的一点建议 开源不等于可信，企业需要针对软件供应链建立动态管理机制，及时发现并响应其中可能的风险。 漏洞检测及修复 关于该漏洞的检测策略已在墨菲安全的所有工具产品中上线，您可以免费安装使用墨菲安全的JetBrains IDE插件、CLI客户端等对你的项目进行检测，并一键修复。
产品邀请注册: https://www.murphysec.com/register?invite_code=onkXXo开源仓库: https://github.com/murphysecurity 如果你觉得这个工具对你有用，可以star、提issues或者参与贡献，我们会挑选一个参与贡献的用户送出机械键盘一份。
参考链接 https://github.com/vuejs/vue-cli/issues/7054
https://github.com/RIAEvangelist/node-ipc/issues/233
百万周下载量node-ipc包以反战为名进行供应链投毒
作者：wochicheng 日期：2022年3月16日" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7ddb0bd1e6181b7e88ada22fc0b21daa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-16T19:19:06+08:00" />
<meta property="article:modified_time" content="2022-03-16T19:19:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">开源无国界？vue-cli、node-ipc被投毒事件分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E7%AE%80%E8%BF%B0">简述</h2> 
<p>近日我们监测到 Vue.js 生态中的 vue-cli 包遭遇供应链投毒，而被投毒的 node-ipc 包在 npm 上每周下载量超百万，影响非常广泛。</p> 
<p>被投毒的情况如下：</p> 
<ul><li>vue-cli是Vue.js 开发的标准工具，该工具被广泛应用于vue的快速开发</li><li>其依赖的node-ipc是用于本地和远程进程间通信的一个js模块，也用于支持linux，windows，mac等系统中的socket通信。</li><li>node-ipc包的作者近期在node-ipc的<strong>10.1.1-10.1.2</strong>版本添加了恶意JS，该JS会修改俄罗斯和白俄罗斯用户的所有文件为❤️，但不到24小时后又删除该恶意JS，添加会在用户桌面创建反战宣传标语的peacenotwar模块。vuejs的团队在发现node-ipc添加了peacenotwar模块后锁定了vue-cli依赖的node-ipc版本为9.2.1，研究人员随后又发现node-ipc的作者此前添加的恶意JS存在于node-ipc旧版本中。 <p class="img-center"><img alt="" height="274" src="https://images2.imgbox.com/f3/45/KojRw1e2_o.png" width="346"></p> </li></ul> 
<p style="text-align:center;"> （问题组件每周下载量截图）</p> 
<p></p> 
<h2 id="%E4%BA%8B%E4%BB%B6%E6%97%B6%E9%97%B4%E7%BA%BF">事件时间线</h2> 
<h3 id="3%E6%9C%887%E5%8F%B7">3月7号</h3> 
<p>开发者RIAEvangelist在node-ipc包中添加名为<a href="https://github.com/RIAEvangelist/node-ipc/blob/847047cf7f81ab08352038b2204f0e7633449580/dao/ssl-geospec.js" title="ssl-geospec.js">ssl-geospec.js</a>的恶意JS文件，将node-ipc的版本号更新为10.1.1<img alt="" src="https://images2.imgbox.com/51/8a/lHayQY7d_o.png"></p> 
<h3 id="3%E6%9C%888%E5%8F%B7">3月8号</h3> 
<p>删除<a href="https://github.com/RIAEvangelist/node-ipc/blob/847047cf7f81ab08352038b2204f0e7633449580/dao/ssl-geospec.js" title="ssl-geospec.js">ssl-geospec.js</a>该文件，版本号更新为10.1.3</p> 
<p class="img-center"><img alt="" height="250" src="https://images2.imgbox.com/6d/30/ukkkJfuf_o.png" width="461"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c9/81/cPiLSB74_o.png"></p> 
<h3>3月9号</h3> 
<p>开发者RIAEvangelist在node-ipc包中添加<strong>peacenotwar</strong>模块，该模块会在桌面静默添加反战宣传文件</p> 
<p style="text-align:center;"><img alt="" height="231" src="https://images2.imgbox.com/19/89/98vAum0O_o.png" width="430"></p> 
<h3>3月15号</h3> 
<p>有开发者在论坛中反馈构建过程中发现被创建反战标语文件</p> 
<p style="text-align:center;"><img alt="" height="205" src="https://images2.imgbox.com/06/9a/S22vgkHd_o.png" width="433"></p> 
<h3>3月15号</h3> 
<p>Vue-cli发布<strong>5.0.3</strong>版本，在新版本中锁定vue-cli依赖的node-ipc版本为9.2.1</p> 
<p style="text-align:center;"><img alt="" height="140" src="https://images2.imgbox.com/24/52/GhEPP4q0_o.png" width="293"></p> 
<p></p> 
<p>研究人员分析发现node-ipc的作者不只添加了反战标语，还在旧版本10.1.1-10.1.2中添加了恶意JS文件删除俄罗斯和白俄罗斯用户文件</p> 
<p style="text-align:center;"><img alt="" height="365" src="https://images2.imgbox.com/56/fa/NlYkay9E_o.png" width="620"></p> 
<h3>3月16号</h3> 
<p><img alt="" height="65" src="https://images2.imgbox.com/37/d2/OeOIXiFK_o.png" width="501"></p> 
<p> vue的开发者sodatea针对此事件的回应如下：</p> 
<ol><li><code>node-ipc</code> 9.2.2 增加<code>peacenotwar</code>模块，该模块会在未经用户同意的情况下写入<code>WITH-LOVE-FROM-AMERICA.txt</code>用户的Desktop和OneDrive文件夹。</li><li>vue-cli已经发布了 4.5.16 和 5.0.3 来锁定依赖版本。</li><li>受影响的用户：在<code>2022-03-15T05:40:26.758Z</code>和<code>2022-03-15T13:17:57.076Z</code>；期间创建的新项目或者更新了项目依赖的人。</li><li>从俄罗斯和白俄罗斯 IP 删除文件的恶意代码<strong>不包含</strong>在 9.2.2 版本中</li></ol> 
<h2></h2> 
<h2 id="%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90">恶意代码分析</h2> 
<p>我们针对node-ipc包中使用的恶意js文件（<a href="https://github.com/RIAEvangelist/node-ipc/blob/847047cf7f81ab08352038b2204f0e7633449580/dao/ssl-geospec.js" title="node-ipc/ssl-geospec.js at 847047cf7f81ab08352038b2204f0e7633449580 · RIAEvangelist/node-ipc · GitHub">node-ipc/ssl-geospec.js at 847047cf7f81ab08352038b2204f0e7633449580 · RIAEvangelist/node-ipc · GitHub</a>）进行分析。</p> 
<p>可以看到多处使用base64编码对行为意图进行隐藏</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4e/57/lcwahViD_o.png"></p> 
<p>远程API地址解码为</p> 
<p><a class="link-info" href="https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154" rel="nofollow" title="https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154">https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/27/1f/p7ZIShGt_o.png"></p> 
<p> 使用https加载远程API</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/97/ae/bInfUzMu_o.png"></p> 
<p></p> 
<p>解密后的字符串，可以看出c为国家，e为俄罗斯，i为白俄罗斯，其他为文件路径</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/67/cb/EJ9bKTY7_o.png"></p> 
<p>判断是否为俄罗斯或白俄罗斯，将结果注册为a</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3c/11/xDoPHGdt_o.png"></p> 
<p>如果是则执行h函数</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/10/07/x52Bmy2y_o.png"></p> 
<p> h函数递归爬取指定目录，将所传入的路径中的文件替换为base64编码的4p2k77iP，而其解码后为❤️</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/15/1f/YBHBTc7d_o.png"></p> 
<p></p> 
<h2 id="%E9%92%88%E5%AF%B9%E4%BC%81%E4%B8%9A%E7%9A%84%E4%B8%80%E7%82%B9%E5%BB%BA%E8%AE%AE">针对企业的一点建议</h2> 
<ul><li>开源不等于可信，企业需要针对软件供应链建立动态管理机制，及时发现并响应其中可能的风险。</li></ul> 
<h2></h2> 
<h2 id="%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E5%8F%8A%E4%BF%AE%E5%A4%8D">漏洞检测及修复</h2> 
<p>关于该漏洞的检测策略已在墨菲安全的所有工具产品中上线，您可以免费安装使用墨菲安全的JetBrains IDE插件、CLI客户端等对你的项目进行检测，并一键修复。</p> 
<ul><li>产品邀请注册:  <a class="link-info" href="https://www.murphysec.com/register?invite_code=onkXXo" rel="nofollow" title="https://www.murphysec.com/register?invite_code=onkXXo">https://www.murphysec.com/register?invite_code=onkXXo</a></li><li>开源仓库:  <a class="link-info" href="https://github.com/murphysecurity" title="https://github.com/murphysecurity">https://github.com/murphysecurity</a></li></ul> 
<p>如果你觉得这个工具对你有用，可以star、提issues或者参与贡献，我们会挑选一个参与贡献的用户送出机械键盘一份。</p> 
<p class="img-center"><img alt="" height="157" src="https://images2.imgbox.com/54/4a/0X0DeF6Z_o.png" width="310"></p> 
<h2></h2> 
<h2 id="%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</h2> 
<p><a class="link-info" href="https://github.com/vuejs/vue-cli/issues/7054" title="https://github.com/vuejs/vue-cli/issues/7054">https://github.com/vuejs/vue-cli/issues/7054</a></p> 
<p><a class="link-info" href="https://github.com/RIAEvangelist/node-ipc/issues/233" title="https://github.com/RIAEvangelist/node-ipc/issues/233">https://github.com/RIAEvangelist/node-ipc/issues/233</a></p> 
<p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&amp;mid=2650141280&amp;idx=2&amp;sn=d2f45026921cbfb2afdceefe8ac2c6cc&amp;chksm=beda290e89ada018b9ba66ed8ffd181baad4430abb2195cbf04e2973bc2e348baee838bf723e&amp;mpshare=1&amp;scene=1&amp;srcid=0316kKYcxj6kz9ZevgyVMaCl&amp;sharer_sharetime=1647410657422&amp;sharer_shareid=2873f5be9c459866ddd18cc68c95748b&amp;key=c41bd5e423be7bfca7472215ef0b06b4c0ce103a86e9737e5e8cd7896a0d9e65c8aee00f5f52db50429d5b31cb4a7bea7e7c248765359ff4be28e06c4a74dc72fb876498e9297d256f2cb9338ad9a3f8673e41c0abb6726bc67642f0d4fa7244ad25dc5d74fb21030972ac4bc9e18f37bf984444585e79084520f286d595b8e0&amp;ascene=1&amp;uin=MjUwOTA0MTYxNA%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090529&amp;lang=zh_CN&amp;exportkey=AZ%2F%2B%2Few8WbYmCSU1TfDv52Q%3D&amp;acctmode=0&amp;pass_ticket=PVvtwWxxFPupgyHas73zTA%2F7vmLQy4Mo8gjzfEHdE4gwvr43s7MnFg4pW61Fr6VO&amp;wx_header=0" rel="nofollow" title="百万周下载量node-ipc包以反战为名进行供应链投毒">百万周下载量node-ipc包以反战为名进行供应链投毒</a></p> 
<hr> 
<p style="text-align:right;">作者：wochicheng    日期：2022年3月16日</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f080d4ed8e26f10e389ccd2050734e8b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java创建Object数组时遇到的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f005aac41789c6fc203adb4207f5d995/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">This failure was cached in the local repository and resolution is not reattempted until the update</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>