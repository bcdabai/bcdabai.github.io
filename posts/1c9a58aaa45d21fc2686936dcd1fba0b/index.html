<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pytorch&#43;faster-rcnn 训练PASCAL VOC2007数据集 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pytorch&#43;faster-rcnn 训练PASCAL VOC2007数据集" />
<meta property="og:description" content="作为初学者，这里不谈原理，只谈步骤
一、 下载faster-rcnn代码 代码路径： https://github.com/dongdonghy/Detection-PyTorch-Notebook.git
下载后，faster-rcnn代码路径在： Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch
二、 安装pytorch和依赖包 1、 建议安装pytorch 0.4.0或0.4.1 版本(安装高版本的pytorch，训练时会报一堆错误)
2、 安装其它依赖包，见：Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/requirements.txt
三、 准备工作 1、下载PASCAL VOC2007数据集，2007数据集有三个tar包
http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtrainval_06-Nov-2007.tar
http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtest_06-Nov-2007.tar
http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCdevkit_08-Jun-2007.tar
将三个tar包放到任意一个目录下解压，如/home目录，解压后的目录结构如下：
----VOCdevkit
------VOC2007
------VOCcode
------其他一些文件和目录
说明： 我在使用VOC2012数据集的时候，训练报错，所以我这里直接使用的是VOC2007数据集
3、创建软链接,假设voc2007数据集在/home目录下
cd Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch &amp;&amp; mkdir data
cd data
ln -sf /home/VOCdevkit VOCdevkit2007
4、下载预训练的网络模型，我使用的是vgg16
地址：https://filebox.ece.vt.edu/~jw2yang/faster-rcnn/pretrained-base-models/vgg16_caffe.pth
将下载的vgg16_caffe.pth拷贝到data/pretrained_model目录下
5、 根据自己的GPU型号，修改lib/make.sh文件中的CUDA_ARCH
6、 由于在NMS与RoI Pooling中使用了CUDA进行加速，因此还需要对此进行编译。
cd lib &amp;&amp; sh make.sh
需要注意的是：因为代码是windows格式的，编译有可能会报错，建议使用dos2unix将所有的文件格式转换一下
四、 开始训练 1、 修改faster-rcnn-pytorch/lib/datasets/pascal_voc.py 文件里的__init__方法，将下面两行注释掉，这里不需要指定路径，因为程序会自动解析路径的
self._devkit_path=&#34;/root/Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/data/VOC2012&#34;
self._data_path = “/root/Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/data/VOC2012”
2、 训练模型
python trainval_net.py --dataset pascal_voc --net vgg16 --bs 24 --nw 4 --cuda --mGPUs" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1c9a58aaa45d21fc2686936dcd1fba0b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-27T18:53:22+08:00" />
<meta property="article:modified_time" content="2020-05-27T18:53:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pytorch&#43;faster-rcnn 训练PASCAL VOC2007数据集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>作为初学者，这里不谈原理，只谈步骤</p> 
<h3><a id="_fasterrcnn_1"></a>一、 下载faster-rcnn代码</h3> 
<p>代码路径： <a href="https://github.com/dongdonghy/Detection-PyTorch-Notebook.git">https://github.com/dongdonghy/Detection-PyTorch-Notebook.git</a><br> 下载后，faster-rcnn代码路径在： Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch</p> 
<h3><a id="_pytorch_5"></a>二、 安装pytorch和依赖包</h3> 
<p>1、 建议安装pytorch 0.4.0或0.4.1 版本(安装高版本的pytorch，训练时会报一堆错误)<br> 2、 安装其它依赖包，见：Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/requirements.txt</p> 
<h3><a id="__9"></a>三、 准备工作</h3> 
<p>1、下载PASCAL VOC2007数据集，2007数据集有三个tar包<br>    <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtrainval_06-Nov-2007.tar" rel="nofollow">http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtrainval_06-Nov-2007.tar</a><br>    <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtest_06-Nov-2007.tar" rel="nofollow">http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCtest_06-Nov-2007.tar</a><br>    <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCdevkit_08-Jun-2007.tar" rel="nofollow">http://host.robots.ox.ac.uk/pascal/VOC/voc2007/VOCdevkit_08-Jun-2007.tar</a><br>    将三个tar包放到任意一个目录下解压，如/home目录，解压后的目录结构如下：<br>    ----VOCdevkit<br>       ------VOC2007<br>       ------VOCcode<br>       ------其他一些文件和目录<br> 说明： 我在使用VOC2012数据集的时候，训练报错，所以我这里直接使用的是VOC2007数据集<br> 3、创建软链接,假设voc2007数据集在/home目录下<br>    cd Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch &amp;&amp; mkdir data<br>    cd data<br>    ln -sf /home/VOCdevkit VOCdevkit2007<br> 4、下载预训练的网络模型，我使用的是vgg16<br>    地址：<a href="https://filebox.ece.vt.edu/~jw2yang/faster-rcnn/pretrained-base-models/vgg16_caffe.pth" rel="nofollow">https://filebox.ece.vt.edu/~jw2yang/faster-rcnn/pretrained-base-models/vgg16_caffe.pth</a><br>    将下载的vgg16_caffe.pth拷贝到data/pretrained_model目录下<br> 5、 根据自己的GPU型号，修改lib/make.sh文件中的CUDA_ARCH<br> 6、 由于在NMS与RoI Pooling中使用了CUDA进行加速，因此还需要对此进行编译。<br>    cd lib &amp;&amp; sh make.sh<br>    需要注意的是：因为代码是windows格式的，编译有可能会报错，建议使用dos2unix将所有的文件格式转换一下</p> 
<h3><a id="__32"></a>四、 开始训练</h3> 
<p>   1、 修改faster-rcnn-pytorch/lib/datasets/pascal_voc.py 文件里的__init__方法，将下面两行注释掉，这里不需要指定路径，因为程序会自动解析路径的<br>    self._devkit_path="/root/Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/data/VOC2012"<br>    self._data_path = “/root/Detection-PyTorch-Notebook/chapter4/faster-rcnn-pytorch/data/VOC2012”<br>    2、 训练模型<br>    python trainval_net.py --dataset pascal_voc --net vgg16 --bs 24 --nw 4 --cuda --mGPUs<br>    我这里使用的是多GPU，如果你是单卡，可以根据情况调整参数，具体参数可以看这篇文章：<a href="https://github.com/jwyang/faster-rcnn.pytorch">https://github.com/jwyang/faster-rcnn.pytorch</a><br>    训练结束后，会在models/vgg16/pascal_voc目录下生成很多个模型文件，模型文件命名格式：faster_rcnn_${checksession}_${checkepoch}_${checkpoint}.pth<br>     注意： 由于py文件里有一些中文注释，在运行trainval_net.py时会提示编码错误，当报错时，在报错的py文件第一行里添加如下代码即可：# -<em>- coding: UTF-8 -</em>-<br>    3、 验证模型<br>    python test_net.py --dataset pascal_voc --net vgg16 --cuda --mGPUs --checkepoch 20 --checkpoint 416 --checksession 1<br>    验证时会根据指定的checkepoch、checkpoint 和checksession找到对应的模型文件，所以这里指定的这三个参数值必须在models/vgg16/pascal_voc/ 目录下存在该模型<br> 4、 测试自己的图片<br>    python demo.py --checkepoch 20 --checkpoint 416 --checksession 1 --net vgg16 --image_dir ./images<br>    同样的道理，会根据指定的checkepoch、checkpoint 和checksession找到对应的模型文件。 其中–image_dir 指定需要测试的图片路径，测试后，会在该目录下生成检测的结果图片</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8e0c9c72d34970eeb9aaec335f49ae8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python不改变图片尺寸压缩到指定大小</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc7cd5163c7492bdcf372b65e4188473/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">windows抓屏排除指定窗口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>