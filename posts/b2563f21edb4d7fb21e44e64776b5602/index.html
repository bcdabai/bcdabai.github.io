<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue中使用Sortable bug:排序混乱、与数据不一致、拖拽结束后回跳 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue中使用Sortable bug:排序混乱、与数据不一致、拖拽结束后回跳" />
<meta property="og:description" content="更新 20/11/7
因为研究了patch算法，所以又质疑自己之前答案，目前有两种可能，待验证
正确绑定key（patch算法） 在封装组件中，绑定数组下标，不出现问题，在有其他列表渲染情况下，绑定下标出现了错误（偶然）
在list中的对象（响应式数据）中添加一个唯一id绑定似乎就解决了这个问题;
一个列表中index是唯一，即按照patch源码来说是有差异，可比较出来的。所以，要么是patch方法有问题，要么是vdom和真实dom(更新)绑定有问题
vdom和真实dom(更新)绑定问题 draggable操作了真实dom（需要看源码确认），drag后回调函数中操作了vue的响应式数据 =》 vdom diff =》 真实dom改变。
解决方式可以参考https://www.jianshu.com/p/d92b9efe3e6a
不全认同上文，但是为我说清了大多问题
原文 2019-09-24 14:15:18
先答案 推荐方案：正确绑定key
https://www.jianshu.com/p/d92b9efe3e6a
此文很详细了，各位应该看这个就够了，方案也在里面，我尽量不重复造轮子，做补充。
原因： VUE中的virtualDom与真实dom不匹配
思路 现象 1.打印数据是正常的
2.观察到拖拽dom对象后，dom对象又被调换回去
3.当不对data数据进行操作是正常的
4.我写了一个单文件组件，正常，出bug页面引用也正常。同事直接复制代码就bug了
5.绑定了key值的，绑定方式为绑定数组下标
v-for=&#34;(item,index) in navList&#34; :key=&#34;index&#34; 猜测与尝试 1.根据现象123，有可能是dom 与数据层出了差错，所以要正确绑定
但是key已经绑定，我再考虑是否是变量污染，是其他地方的index，于是把index的名字改了，无用
2.怀疑数据层有问题，用不同变量绑定，然后用watch，compute等关联，并且尝试深浅拷贝对象，无用
3.因为数据层显示一直正确，假设无问题，所以在每次拖拽后重新初始化一边，Sortable.create（），无用
4.怀疑是Sortable源码问题，或者使用配置某个字段有问题，也尝试阅读Sortable文档，查找相关bug，逐个配置字段修改尝试，未果。
5.现象3验证现象2
6.最后还是查看了数据格式，有个key值，重新绑定了下key
结论 根据上面链接文章完善：
操作了真实dom，但是因为绑定问题，虚拟dom并未检测到dom变化。
操作后dom对象已经替换，然后触发方法中修改了数据层，数据更新自然开始更新视图层，被打乱。
引用上面链接：
拖拽移动真实DOM -&gt; 操作数据数组 -&gt; Patch算法再更新真实DOM 其他链接 virtual-dom(Vue实现)简析" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b2563f21edb4d7fb21e44e64776b5602/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-24T14:15:18+08:00" />
<meta property="article:modified_time" content="2019-09-24T14:15:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue中使用Sortable bug:排序混乱、与数据不一致、拖拽结束后回跳</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>更新</h2> 
<p>20/11/7<br> 因为研究了patch算法，所以又质疑自己之前答案，目前有两种可能，<strong>待验证</strong></p> 
<h3><a id="keypatch_3"></a>正确绑定key（patch算法）</h3> 
<p>在封装组件中，绑定数组下标，不出现问题，在有其他列表渲染情况下，绑定下标出现了错误（偶然）<br> 在list中的对象（响应式数据）中添加一个唯一id绑定似乎就解决了这个问题;<br> 一个列表中index是唯一，即按照patch源码来说是有差异，可比较出来的。所以，要么是patch方法有问题，要么是<strong>vdom和真实dom(更新)绑定</strong>有问题</p> 
<h3><a id="vdomdom_7"></a>vdom和真实dom(更新)绑定问题</h3> 
<p>draggable操作了真实dom（需要看源码确认），drag后回调函数中操作了vue的响应式数据 =》 vdom diff =》 真实dom改变。<br> 解决方式可以参考<a href="https://www.jianshu.com/p/d92b9efe3e6a" rel="nofollow">https://www.jianshu.com/p/d92b9efe3e6a</a><br> 不全认同上文，但是为我说清了大多问题</p> 
<h2><a id="_11"></a>原文</h2> 
<p>2019-09-24 14:15:18</p> 
<h3><a id="_13"></a>先答案</h3> 
<p>推荐方案：<strong>正确绑定</strong>key<br> <a href="https://www.jianshu.com/p/d92b9efe3e6a" rel="nofollow">https://www.jianshu.com/p/d92b9efe3e6a</a><br> 此文很详细了，各位应该看这个就够了，方案也在里面，我尽量不重复造轮子，做补充。</p> 
<h3><a id="_17"></a>原因：</h3> 
<p><strong>VUE中的virtualDom与真实dom不匹配</strong></p> 
<h3><a id="_19"></a>思路</h3> 
<h5><a id="_20"></a>现象</h5> 
<p>1.打印数据是正常的<br> 2.观察到拖拽dom对象后，dom对象又被调换回去<br> 3.当不对data数据进行操作是正常的<br> 4.我写了一个单文件组件，正常，出bug页面引用也正常。同事直接复制代码就bug了<br> 5.绑定了key值的，绑定方式为绑定数组下标</p> 
<pre><code>v-for="(item,index) in navList" :key="index" 
</code></pre> 
<h5><a id="_29"></a>猜测与尝试</h5> 
<p>1.根据现象123，有可能是dom 与数据层出了差错，所以要正确绑定<br> 但是key已经绑定，我再考虑是否是变量污染，是其他地方的index，于是把index的名字改了，无用<br> 2.怀疑数据层有问题，用不同变量绑定，然后用watch，compute等关联，并且尝试深浅拷贝对象，无用<br> 3.因为数据层显示一直正确，假设无问题，所以在每次拖拽后重新初始化一边，Sortable.create（），无用<br> 4.怀疑是Sortable源码问题，或者使用配置某个字段有问题，也尝试阅读Sortable文档，查找相关bug，逐个配置字段修改尝试，未果。<br> 5.现象3验证现象2<br> 6.最后还是查看了数据格式，有个key值，重新绑定了下key</p> 
<h3><a id="_37"></a>结论</h3> 
<p>根据上面链接文章完善：<br> 操作了真实dom，但是因为绑定问题，虚拟dom并未检测到dom变化。<br> 操作后dom对象已经替换，然后触发方法中修改了数据层，数据更新自然开始更新视图层，被打乱。<br> 引用上面链接：</p> 
<pre><code>拖拽移动真实DOM -&gt; 操作数据数组 -&gt; Patch算法再更新真实DOM
</code></pre> 
<h3><a id="_45"></a>其他链接</h3> 
<p><a href="https://segmentfault.com/a/1190000010090659" rel="nofollow">virtual-dom(Vue实现)简析</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9d78d14e6f43e10c978f5e017ae9ec7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">coding&#43;&#43;：Java 中Model 与 实体的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f286222ce4216810f26d5d414b801a0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java调用第三方http接口  单点登录   HttpClient</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>