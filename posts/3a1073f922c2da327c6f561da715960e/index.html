<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信公众号二次开发 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信公众号二次开发" />
<meta property="og:description" content="&lt;?php /*echo $_GET[&#39;echostr&#39;]; exit;*/ //接收xml数据 $postStr = $GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;]; //把xml数据转化成对象 $postObj = simplexml_load_string($postStr); $fromuserName = $postObj-&gt;FromUserName; $touserName = $postObj-&gt;ToUserName; $time = time(); $msgType = $postObj-&gt;MsgType; $keywords = $postObj-&gt;Content; $textTpl = &#34;&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;%s&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt; &lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt; &lt;/xml&gt;&#34;; $musicTpl = &#34;&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;%s&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt; &lt;Music&gt; &lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt; &lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt; &lt;MusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/MusicUrl&gt; &lt;HQMusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/HQMusicUrl&gt; &lt;/Music&gt; &lt;/xml&gt;&#34;; $newsTpl = &#34;&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;%s&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt; &lt;ArticleCount&gt;1&lt;/ArticleCount&gt; &lt;Articles&gt; &lt;item&gt; &lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt; &lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt; &lt;PicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/PicUrl&gt; &lt;Url&gt;&lt;![CDATA[%s]]&gt;&lt;/Url&gt; &lt;/item&gt; &lt;/Articles&gt; &lt;/xml&gt;&#34;; //关注事件回复 if($postObj-&gt;MsgType == &#39;event&#39;){ if($postObj-&gt;Event == &#39;subscribe&#39;){ $msgType = &#39;news&#39;; $title = &#39;三月三!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3a1073f922c2da327c6f561da715960e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-30T10:49:05+08:00" />
<meta property="article:modified_time" content="2017-03-30T10:49:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信公众号二次开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-php">&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";

$musicTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Music&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;MusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/MusicUrl&gt;
			&lt;HQMusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/HQMusicUrl&gt;
			&lt;/Music&gt;
			&lt;/xml&gt;";
$newsTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;ArticleCount&gt;1&lt;/ArticleCount&gt;
			&lt;Articles&gt;
			&lt;item&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;PicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/PicUrl&gt;
			&lt;Url&gt;&lt;![CDATA[%s]]&gt;&lt;/Url&gt;
			&lt;/item&gt;
			&lt;/Articles&gt;
			&lt;/xml&gt;";

//关注事件回复
if($postObj-&gt;MsgType == 'event'){
	if($postObj-&gt;Event == 'subscribe'){
		$msgType = 'news';
		$title = '三月三!!!!';
		$des = '好日子,欢迎你的到来!!!!';
		$picurl = 'http://boolceshi.ittun.com/xie.jpg';
		$url = 'http://www.zixue.it';
		$resultful = sprintf($newsTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$picurl,$url);
		echo $resultful;
	}elseif($postObj-&gt;Event == 'CLICK'){
		if($postObj-&gt;EventKey == '音乐'){
		$msgType = 'music';
		$title = '许嵩';
		$des = '好听,唯美';
		$url = 'http://boolceshi.ittun.com/22.mp3';
		$resultful = sprintf($musicTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$url,$url);
		echo $resultful;
		}
	}
}			

//关键词自动回复
if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '1'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '你好'){
		$content = '欢迎你来到布尔教育!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($keywords == '音乐'){
		$msgType = 'music';
		$title = '许嵩';
		$des = '好听,唯美';
		$url = 'http://boolceshi.ittun.com/22.mp3';
		$resultful = sprintf($musicTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$url,$url);
		echo $resultful;
	}elseif($keywords == '图文'){
		$msgType = 'news';
		$title = '微信公开课!!!';
		$des = '好听,好学,好玩!!!';
		$picurl = 'http://boolceshi.ittun.com/bool.jpg';
		$url = 'http://www.baidu.com';
		$resultful = sprintf($newsTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$picurl,$url);
		echo $resultful;
	}else{
		$content = '你好你好你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$url = 'https://api-cn.faceplusplus.com/facepp/v3/detect';
		$data = [
			'api_key'=&gt;'AWHXLEMVlhTju6raJrlAJS5R4gPe8jX_',
			'api_secret'=&gt;'j3etjvp-DZsz_SJpXdZNN0IOovVgO1KK',
			'image_url'=&gt;$postObj-&gt;PicUrl,
			'return_landmark'=&gt;'1',
			'return_attributes'=&gt;'age,gender',
		];

		$curl = curl_init();
		//设置参数
		curl_setopt($curl,CURLOPT_URL,$url);
		curl_setopt($curl, CURLOPT_HEADER,0);
		curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0);
		curl_setopt($curl, CURLOPT_POSTFIELDS, $data);
		//发送请求信息
		$da = curl_exec($curl);
		//关闭请求资源
		curl_close($curl);
		$arr = json_decode($da,true);
		$num = count($arr['faces']);
		if($num == '0'){

			$content = '你的图片真好看!!!';
		}else{
			$content = '你的图片中有'.$num.'个人';
		}
		$msgType = 'text';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '你的声音真好听!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'location'){
		$msgType = 'text';
		$location_x = $postObj-&gt;Location_X;
		$location_y = $postObj-&gt;Location_Y;
		$url = 'http://api.map.baidu.com/place/v2/search?query=%E5%8E%95%E6%89%80&amp;location=' . $location_x .','. $location_y .'&amp;scope=2&amp;radius=2000&amp;output=json&amp;ak=88H9M1sNCCGGWVz7A3VZjq6xCSLx6Va5';
		$json = file_get_contents($url);
		$arr = json_decode($json,true);
		$content = '';
		foreach($arr['results'] as $k =&gt; $v){
			$content .= $v['name'] . '在' . $v['address'] . ',' . '距离你有' . $v['detail_info']['distance'] ."米,\n";
		}
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}	


?&gt;
</code></pre> 
<br> 
<pre><code class="language-php">&lt;?php 

echo $_GET['echostr'];
	exit;
/*//微信服务器发送get请求到我们的服务器
//token、timestamp、nonce,signature
$token = 'kaituozhe';
$timestamp = $_GET['timestamp'];
$nonce = $_GET['nonce'];
$signature = $_GET['signature'];

//将token、timestamp、nonce三个参数进行字典序排序
$arr = array($token,$timestamp,$nonce);
sort($array, SORT_STRING);

//将三个参数字符串拼接成一个字符串进行sha1加密
$arr = implode($arr);
$arr = sha1($arr);

//开发者获得加密后的字符串可与signature对比，标识该请求来源于微信
if($arr == $signature){
	$echostr =  $_GET['echostr'];
	echo $echostr;
	exit;
}*/
//--------------------------写文件（接收xml数据）---------------------------------
&lt;?php 
	
/*echo $_GET['echostr'];
exit;*/


//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$a = $postObj-&gt;Content;
file_put_contents('./a.txt', $a)
//--------------------------回复消息---------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[$fromuserName]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[qq87080912]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;12345678&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[欢迎你好]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";
echo $textTpl;
//--------------------------关键词回复---------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";
if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '大帅是傻逼吗'){
		$content = '大帅确实是傻逼！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}else{
		$content = '不用问了大帅是傻逼';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}
//--------------------------接收不同类型的消息---------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";
if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '大帅是傻逼吗'){
		$content = '大帅确实是傻逼！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}else{
		$content = '不用问了大帅是傻逼';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$msgType = 'text';
		$content = '你的图片真好看!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '你的声音真美妙!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}
//--------------------------布尔教育--11--LBS厕即送---------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";
if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '大帅是傻逼吗'){
		$content = '大帅确实是傻逼！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}else{
		$content = '不用问了大帅是傻逼';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$msgType = 'text';
		$content = '你的图片真好看!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '你的声音真美妙!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'location'){
		$msgType = 'text';
		$location_x = $postObj-&gt;Location_X;
		$location_y = $postObj-&gt;Location_Y;
		$url = 'http://api.map.baidu.com/place/v2/search?query=%E5%8E%95%E6%89%80&amp;location=' . $location_x .','. $location_y .'&amp;scope=2&amp;radius=2000&amp;output=json&amp;ak=ke9uqA3l6BgVgj7bCmiexVBt1FylWTL4';
		$json = file_get_contents($url);
		$arr = json_decode($json,true);
		$content = '';
		foreach($arr['results'] as $k =&gt; $v){
			$content .= $v['name'] . '在' . $v['address'] . ',' . '距离你有' . $v['detail_info']['distance'] ."米,\n";
		}
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}
//--------------------------布尔教育--11--音乐恢复---------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";

$musicTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Music&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;MusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/MusicUrl&gt;
			&lt;HQMusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/HQMusicUrl&gt;
			&lt;/Music&gt;
			&lt;/xml&gt;";

if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '大帅是傻逼吗'){
		$content = '大帅确实是傻逼！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($keywords == '音乐'){
		$msgType = 'music';
		$title = '告别气球-周杰伦';
		$des = '好听,唯美';
		$url = 'http://v.150643.com/22.mp3';
		$resultful = sprintf($musicTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$url,$url);
		echo $resultful;
	}else{
		$content = '不用问了大帅是傻逼';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$msgType = 'text';
		$content = '你的图片真好看!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '你的声音真美妙!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'location'){
		$msgType = 'text';
		$location_x = $postObj-&gt;Location_X;
		$location_y = $postObj-&gt;Location_Y;
		$url = 'http://api.map.baidu.com/place/v2/search?query=%E5%8E%95%E6%89%80&amp;location=' . $location_x .','. $location_y .'&amp;scope=2&amp;radius=2000&amp;output=json&amp;ak=ke9uqA3l6BgVgj7bCmiexVBt1FylWTL4';
		$json = file_get_contents($url);
		$arr = json_decode($json,true);
		$content = '';
		foreach($arr['results'] as $k =&gt; $v){
			$content .= $v['name'] . '在' . $v['address'] . ',' . '距离你有' . $v['detail_info']['distance'] ."米,\n";
		}
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}
//--------------------------布尔教育--11--人脸识别Face++--------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";

$musicTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Music&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;MusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/MusicUrl&gt;
			&lt;HQMusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/HQMusicUrl&gt;
			&lt;/Music&gt;
			&lt;/xml&gt;";

if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '你好!!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '大帅是傻逼吗'){
		$content = '大帅确实是傻逼！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($keywords == '音乐'){
		$msgType = 'music';
		$title = '告别气球-周杰伦';
		$des = '好听,唯美';
		$url = 'http://v.150643.com/22.mp3';
		$resultful = sprintf($musicTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$url,$url);
		echo $resultful;
	}else{
		$content = '不用问了大帅是傻逼';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$url = 'https://api-cn.faceplusplus.com/facepp/v3/detect';
		$data = [
			'api_key'=&gt;'WrYx9bJJY5jjtPO2doK9mgLk1Rp2Aqi3',
			'api_secret'=&gt;'G4qM--7D_agRXSUnNly46roH_bb-SFX6',
			'image_url'=&gt;$postObj-&gt;PicUrl,
			'return_landmark'=&gt;'1',
			'return_attributes'=&gt;'age,gender',
		];

		$curl = curl_init();
		//设置参数
		curl_setopt($curl,CURLOPT_URL,$url);
		curl_setopt($curl, CURLOPT_HEADER,0);
		curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0);
		curl_setopt($curl, CURLOPT_POSTFIELDS, $data);
		//发送请求信息
		$da = curl_exec($curl);
		//关闭请求资源
		curl_close($curl);
		$arr = json_decode($da,true);
		$num = count($arr['faces']);
		if($num == '0'){

			$content = '你的图片真好看!!!';
		}else{
			$content = '你的图片中有'.$num.'个人';
		}
		$msgType = 'text';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '你的声音真美妙!!!';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'location'){
		$msgType = 'text';
		$location_x = $postObj-&gt;Location_X;
		$location_y = $postObj-&gt;Location_Y;
		$url = 'http://api.map.baidu.com/place/v2/search?query=%E5%8E%95%E6%89%80&amp;location=' . $location_x .','. $location_y .'&amp;scope=2&amp;radius=2000&amp;output=json&amp;ak=ke9uqA3l6BgVgj7bCmiexVBt1FylWTL4';
		$json = file_get_contents($url);
		$arr = json_decode($json,true);
		$content = '';
		foreach($arr['results'] as $k =&gt; $v){
			$content .= $v['name'] . '在' . $v['address'] . ',' . '距离你有' . $v['detail_info']['distance'] ."米,\n";
		}
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}
//--------------------------布尔教育--图文++--------------------------------
&lt;?php
	
/*echo $_GET['echostr'];
exit;*/
//接收xml数据
$postStr = $GLOBALS['HTTP_RAW_POST_DATA'];
//把xml数据转化成对象
$postObj = simplexml_load_string($postStr);
$fromuserName = $postObj-&gt;FromUserName;
$touserName = $postObj-&gt;ToUserName;
$time = time();
$msgType = $postObj-&gt;MsgType;
$keywords = $postObj-&gt;Content;
$textTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
			&lt;/xml&gt;";

$musicTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;Music&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;MusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/MusicUrl&gt;
			&lt;HQMusicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/HQMusicUrl&gt;
			&lt;/Music&gt;
			&lt;/xml&gt;";

$newsTpl = "&lt;xml&gt;
			&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
			&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
			&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
			&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
			&lt;ArticleCount&gt;1&lt;/ArticleCount&gt;
			&lt;Articles&gt;
			&lt;item&gt;
			&lt;Title&gt;&lt;![CDATA[%s]]&gt;&lt;/Title&gt;
			&lt;Description&gt;&lt;![CDATA[%s]]&gt;&lt;/Description&gt;
			&lt;PicUrl&gt;&lt;![CDATA[%s]]&gt;&lt;/PicUrl&gt;
			&lt;Url&gt;&lt;![CDATA[%s]]&gt;&lt;/Url&gt;
			&lt;/item&gt;
			&lt;/Articles&gt;
			&lt;/xml&gt;";

if($postObj-&gt;MsgType == "text" ){
	if($postObj-&gt;Content == '你好'){
		$content = '谢谢，你也好！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($postObj-&gt;Content == '你叫什么'){
		$content = '我的名字叫：小帅！';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}elseif($keywords == '音乐'){
		$msgType = 'music';
		$title = '告别气球-周杰伦';
		$des = '好听,唯美';
		$url = 'http://v.150643.com/22.mp3';
		$resultful = sprintf($musicTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$url,$url);
		echo $resultful;
	}elseif($keywords == '图文'){
		$msgType = 'news';
		$title = '微信公开课!!!';
		$des = '好听,好学,好玩!!!';
		$picurl = 'http://v.150643.com/22.jpg';
		$url = 'http://www.baidu.com';
		$resultful = sprintf($newsTpl,$fromuserName,$touserName,$time,$msgType,$title,$des,$picurl,$url);
		echo $resultful;
	}else{
		$content = '你可以跟我说：你好，你叫什么，音乐。也可以跟我送图片、语音。';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
	}
}elseif($postObj-&gt;MsgType == 'image'){
		$url = 'https://api-cn.faceplusplus.com/facepp/v3/detect';
		$data = [
			'api_key'=&gt;'WrYx9bJJY5jjtPO2doK9mgLk1Rp2Aqi3',
			'api_secret'=&gt;'G4qM--7D_agRXSUnNly46roH_bb-SFX6',
			'image_url'=&gt;$postObj-&gt;PicUrl,
			'return_landmark'=&gt;'1',
			'return_attributes'=&gt;'age,gender',
		];

		$curl = curl_init();
		//设置参数
		curl_setopt($curl,CURLOPT_URL,$url);
		curl_setopt($curl, CURLOPT_HEADER,0);
		curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0);
		curl_setopt($curl, CURLOPT_POSTFIELDS, $data);
		//发送请求信息
		$da = curl_exec($curl);
		//关闭请求资源
		curl_close($curl);
		$arr = json_decode($da,true);
		$num = count($arr['faces']);
		if($num == '0'){

			$content = '你的图片真好看,怎么没有人？!';
		}else{
			$content = '你的图片中有'.$num.'个人';
		}
		$msgType = 'text';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'voice'){
		$msgType = 'text';
		$content = '听到你的声音真是太好了。';
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}elseif($postObj-&gt;MsgType == 'location'){
		$msgType = 'text';
		$location_x = $postObj-&gt;Location_X;
		$location_y = $postObj-&gt;Location_Y;
		$url = 'http://api.map.baidu.com/place/v2/search?query=%E5%8E%95%E6%89%80&amp;location=' . $location_x .','. $location_y .'&amp;scope=2&amp;radius=2000&amp;output=json&amp;ak=ke9uqA3l6BgVgj7bCmiexVBt1FylWTL4';
		$json = file_get_contents($url);
		$arr = json_decode($json,true);
		$content = '';
		foreach($arr['results'] as $k =&gt; $v){
			$content .= $v['name'] . '在' . $v['address'] . ',' . '距离你有' . $v['detail_info']['distance'] ."米,\n";
		}
		$resultful = sprintf($textTpl,$fromuserName,$touserName,$time,$msgType,$content);
		echo $resultful;
}
//--------------------------布尔教育--用户关注消息++--------------------------------</code></pre> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4d4a5a747461bb06ba5380a0b886c9df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OBS桌面视频直播软件/推流工具使用指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6cf923f3eaa7e98ad96aa694744a0143/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于错误 openssl/ssl.h：没有那个文件或目录的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>