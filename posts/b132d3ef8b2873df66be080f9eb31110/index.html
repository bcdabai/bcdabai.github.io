<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在win7同样支持Webview2 在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何在win7同样支持Webview2 在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime" />
<meta property="og:description" content="项目运行环境：
.Net Framework 4.5.2
Windows 7 x64 Service Pack 1
WebView2 Microsoft.WebView2.FixedVersionRuntime.120.0.2210.91.x64
考虑到很多老项目，本项目使用的是.Net Framework 4.5.2，.Net 更高版本的其实也是可以支持的。
1、下载 WebView2 固定版本 Runtime WebView2 Runtime: https://developer.microsoft.com/zh-CN/microsoft-edge/webview2/#download
首先下载自己想要的固定版本的 WebView2 Runtime[1]
下载下来的文件为 Cab 格式的文件，此文件为压缩文件 将其解压，可得到如下的目录
2、创建项目，将Webview2 复制到项目中 创建.Net Framework 4.5.2 WPF 项目，将解压的Webview2 复制到项目中，如下图所示：
文件夹 WebView2 中就是cap文件解压后的二进制文件以及文件夹
将 WebView2 文件夹中所有文件
属性 - 高级 - 复制到输入目录 设置为 如果较新则复制
属性 - 高级 - 生成操作 设置为 无
如下图所示：
3、在项目的 MainWindow 后台代码中写逻辑 在MainWindow.cs 文件中添加代码
Public partial class MainWindow : Window { public string Url { get; set; } = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b132d3ef8b2873df66be080f9eb31110/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T21:14:51+08:00" />
<meta property="article:modified_time" content="2024-01-03T21:14:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在win7同样支持Webview2 在 WPF 中使用本地 Webview2 ,如何不依赖系统 Runtime</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>项目运行环境：</p> 
<ul><li> <p>.Net Framework 4.5.2</p> </li><li> <p>Windows 7 x64 Service Pack 1</p> </li><li> <p>WebView2 Microsoft.WebView2.FixedVersionRuntime.120.0.2210.91.x64</p> </li></ul> 
<p>考虑到很多老项目，本项目使用的是<code>.Net Framework 4.5.2</code>，<code>.Net</code> 更高版本的其实也是可以支持的。</p> 
<h4>1、下载 WebView2 固定版本 Runtime</h4> 
<p>WebView2 Runtime: https://developer.microsoft.com/zh-CN/microsoft-edge/webview2/#download</p> 
<p>首先下载自己想要的固定版本的 WebView2 Runtime[1]</p> 
<p><img alt="" height="646" src="https://images2.imgbox.com/78/70/c1viYDTX_o.png" width="1200"></p> 
<p>下载下来的文件为 <code>Cab</code> 格式的文件，此文件为压缩文件 </p> 
<p>将其解压，可得到如下的目录</p> 
<p><img alt="" height="352" src="https://images2.imgbox.com/ca/9a/bJT4UxrJ_o.png" width="654"></p> 
<h4>2、创建项目，将<code>Webview2</code> 复制到项目中</h4> 
<p>创建<code>.Net Framework 4.5.2 WPF</code> 项目，将解压的<code>Webview2</code> 复制到项目中，如下图所示：<img alt="" height="394" src="https://images2.imgbox.com/90/f8/JOyZu2au_o.png" width="587"></p> 
<p>文件夹 <code>WebView2</code> 中就是<code>cap</code>文件解压后的二进制文件以及文件夹</p> 
<p>将 <code>WebView2</code> 文件夹中所有文件</p> 
<p><code>属性</code> - <code>高级</code> - <code>复制到输入目录</code> 设置为 <code>如果较新则复制</code></p> 
<p><code>属性</code> - <code>高级</code> - <code>生成操作</code> 设置为 <code>无</code></p> 
<p>如下图所示：</p> 
<p><img alt="" height="125" src="https://images2.imgbox.com/19/19/An5UJqUL_o.png" width="586"></p> 
<p></p> 
<h4>3、在项目的 MainWindow 后台代码中写逻辑</h4> 
<p>在<code>MainWindow.cs</code> 文件中添加代码</p> 
<p></p> 
<pre><code class="language-cs"> Public partial class MainWindow : Window
    {
      public string Url { get; set; } = "https://www.bing.com";
      public MainWindow()
      {
          InitializeComponent();
      }

      protected override async void OnContentRendered(EventArgs e)
      {
          base.OnContentRendered(e);

          await webView.EnsureCoreWebView2Async(
              await CoreWebView2Environment.CreateAsync(Path.Combine(AppDomain.CurrentDomain.BaseDirectory;, "WebView2")));
          webView.Source = new Uri(Url);
      }
   }</code></pre> 
<p>添加后，即可在无 <code>WebView2 Runtime</code> 的系统中运行</p> 
<p>‍</p> 
<h4>4、一些问题</h4> 
<p>项目运行时，有些问题可能会出现，</p> 
<ul><li> <p>报错 <code>Microsoft.Web.WebView2.Core.WebView2RuntimeNotFoundException:“Couldn't find a compatible Webview2 Runtime installation to host WebViews.”</code> 这个可能是因为wenview2的文件没有设置为 <code>较新则复制</code> 导致的</p> </li><li> <p>报错 <code>System.ArgumentException:“WebView2 was already initialized with a different CoreWebView2Environment. Check to see if the Source property was already set or EnsureCoreWebView2Async was previously called with different values.</code> 这个可能是因为在执行 <code>OnContentRendered</code> 方法前，，对CoreWebview2设置了<code>source</code>属性，此时<code>webview2</code>会自动初始化环境，后面不能重复初始化<br> 去掉<code>source</code>属性（设置属性或者在构造时去掉都可以）</p> <p>上面代码可以看到，<code>Source</code> 属性是在 最后才指定的</p> </li></ul> 
<pre><code class="language-cs">protected override async void OnContentRendered(EventArgs e)
  {
      base.OnContentRendered(e);

      await webView.EnsureCoreWebView2Async(
          await CoreWebView2Environment.CreateAsync(Path.Combine(AppDomain.CurrentDomain.BaseDirectory;, "WebView2")));
      webView.Source = new Uri(Url);//最后才指定的Source
  }</code></pre> 
<p></p> 
<h4>5、运行</h4> 
<p>将生成的 <code>Debug</code> 直接拷贝到不存在 <code>Webview2</code> 的系统中，是可以运行的，如果报错，请参考第四点进行检查项目</p> 
<p><img alt="" height="313" src="https://images2.imgbox.com/aa/9d/JXHo8SBi_o.png" width="591"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5387eabb3c85a356a6316ca6875b19be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决printf无法打印输出的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/590563d5bdb16fd4e9a7a630522cf633/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Yolov5 多边形标签转换，所有json文件自动转成txt格式[详细过程]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>