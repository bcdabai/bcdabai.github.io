<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gated Context Aggregation Network for Image Dehazing and Deraining（GCANet） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Gated Context Aggregation Network for Image Dehazing and Deraining（GCANet）" />
<meta property="og:description" content="1 总体概述 GCANet是端到端去雾的一篇代表性的文章，它摒弃以往使用手工设计的先验以及大气散射模型的使用，直接通过原始有雾图像估计出无雾图像J与有雾图像I之间的残差，图像恢复阶段直接使用网络输出的残差与输入有雾图像I之间的加和完成去雾过程。
文章本身最大的贡献：
1、借鉴并使用了平滑空洞卷积消除以往空洞卷积存在的网格伪影以及特征相关性不强的问题，提出了一个门限子网络，用于依据不同level的特征的权重进行特征加权融合
2、GCANet达到当前的SOTA,并且使用消融试验对不同模块重要性进行了分析
3、GCANet应用到去雨任务中依然获得了SOTA
2 灵感来源 之前的研究者利用扩张卷积来聚合上下文信息，可以获得更加细腻和准确的结果，主要原因是扩张卷积不损失分辨率，但是他也存在一些问题，比如网格伪影，远距离信息没有相关性。因此也有很多人去尝试改进上述问题，比如使用平滑空洞卷积来消除网格伪影；也有人使用不同level的特征图进行融合获得更好的去雾效果；也有使用使用gated fusion module ,但是它是直接使用原始图的拷贝而非中间所获取的特征图；GCANet借鉴了上述思想，使用了扩张卷积，借鉴了smooth 扩张卷积消除伪影，借鉴了融合特征图的思路，提出了一个门限子网络用于辨析不同level特征图的重要性
3 现有工作分析 去雾分为两种，其一是基于传统先验知识的去雾，其二是基于学习的方式， 区别就是第一种方案通过手工获取的先验知识在第二钟方案是通过学习获取
传统方案去雾
1、基于暗通道先验以及其对应的优化方案
2、最大对比度
3、颜色衰减先验等
深度学习去雾
1、使用端到端的深度学习方式，利用多尺度网络预测透射率图，但是透射率图估计的不准确导致去雾结果较差
2、将全局大气光值A以及透射率参数融合为一个参数，使用轻量级的网络进行预测
3、也有使用两个子网络分别预测全局大气光值A以及透射率参数，并依据大气散射模型进行图像去雾的
4 本文GCANet方法 整体架构是：首先使用编码模块将输入的有雾图像编码为特征；接着通过聚合上下文信息以及融合不同level的特征强化编码特征（主要使用平滑空洞卷积以及特殊设计的门限子网络）；最后使用一个解码网络将特征映射回原图空间，并加上原始图就可以获取最终的去雾图像
4.1 Smoothed Dilated Convolution 什么是网格伪影？
由上图可知，最右边的这一幅特征图中的红蓝绿黄色四种小点来自于之前特征层对应颜色的独立特征，特征之间没有交互，没有融合，导致最终获取的当前层的特征的之间没有相关性可言，造成局部信息丢失，这对于pixel_level的预测来说是极其致命的。
消除网格伪影有两种方式，第一种是在使用空洞卷积之前，使用共享可分离卷积先进行特征之间的融合；另一种方式是在卷积后特征整合之前，使用类似于shuffleNet一样的方式进行特征交互，具体可以参考如下链接：总结-空洞卷积(Dilated/Atrous Convolution)
本文采用第一种方式完成空洞卷积的网格效应消除
class ResidualBlock(nn.Module): def __init__(self, channel_num, dilation=1, group=1): super(ResidualBlock, self).__init__() self.conv1 = nn.Conv2d(channel_num, channel_num, 3, 1, padding=dilation, dilation=dilation, groups=group, bias=False) self.norm1 = nn.InstanceNorm2d(channel_num, affine=True) self.conv2 = nn.Conv2d(channel_num, channel_num, 3, 1, padding=dilation, dilation=dilation, groups=group, bias=False) self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/20452c28c1617fe47c692eb36d706411/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-10T15:17:57+08:00" />
<meta property="article:modified_time" content="2023-11-10T15:17:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Gated Context Aggregation Network for Image Dehazing and Deraining（GCANet）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1__0"></a>1 总体概述</h3> 
<p>GCANet是端到端去雾的一篇代表性的文章，它摒弃以往使用手工设计的先验以及大气散射模型的使用，直接通过原始有雾图像估计出无雾图像J与有雾图像I之间的残差，图像恢复阶段直接使用网络输出的残差与输入有雾图像I之间的加和完成去雾过程。</p> 
<p>文章本身最大的贡献：<br> 1、借鉴并使用了平滑空洞卷积消除以往空洞卷积存在的网格伪影以及特征相关性不强的问题，提出了一个门限子网络，用于依据不同level的特征的权重进行特征加权融合<br> 2、GCANet达到当前的SOTA,并且使用消融试验对不同模块重要性进行了分析<br> 3、GCANet应用到去雨任务中依然获得了SOTA</p> 
<h3><a id="2__8"></a>2 灵感来源</h3> 
<p>之前的研究者利用扩张卷积来聚合上下文信息，可以获得更加细腻和准确的结果，主要原因是扩张卷积不损失分辨率，但是他也存在一些问题，比如网格伪影，远距离信息没有相关性。因此也有很多人去尝试改进上述问题，比如使用平滑空洞卷积来消除网格伪影；也有人使用不同level的特征图进行融合获得更好的去雾效果；也有使用使用gated fusion module ,但是它是直接使用原始图的拷贝而非中间所获取的特征图；GCANet借鉴了上述思想，使用了扩张卷积，借鉴了smooth 扩张卷积消除伪影，借鉴了融合特征图的思路，提出了一个门限子网络用于辨析不同level特征图的重要性</p> 
<h3><a id="3__11"></a>3 现有工作分析</h3> 
<p>去雾分为两种，其一是基于传统先验知识的去雾，其二是基于学习的方式， 区别就是第一种方案通过手工获取的先验知识在第二钟方案是通过学习获取</p> 
<p><strong>传统方案去雾</strong><br> 1、基于暗通道先验以及其对应的优化方案<br> 2、最大对比度<br> 3、颜色衰减先验等</p> 
<p><strong>深度学习去雾</strong><br> 1、使用端到端的深度学习方式，利用多尺度网络预测透射率图，但是透射率图估计的不准确导致去雾结果较差<br> 2、将全局大气光值A以及透射率参数融合为一个参数，使用轻量级的网络进行预测<br> 3、也有使用两个子网络分别预测全局大气光值A以及透射率参数，并依据大气散射模型进行图像去雾的</p> 
<h3><a id="4_GCANet_24"></a>4 本文GCANet方法</h3> 
<p><img src="https://images2.imgbox.com/97/07/Bs4w4edg_o.png" alt="在这里插入图片描述">整体架构是：首先使用编码模块将输入的有雾图像编码为特征；接着通过聚合上下文信息以及融合不同level的特征强化编码特征（主要使用平滑空洞卷积以及特殊设计的门限子网络）；最后使用一个解码网络将特征映射回原图空间，并加上原始图就可以获取最终的去雾图像</p> 
<h4><a id="41_Smoothed_Dilated_Convolution_26"></a>4.1 Smoothed Dilated Convolution</h4> 
<p><strong>什么是网格伪影？</strong><br> <img src="https://images2.imgbox.com/a3/03/RILgn4bj_o.png" alt="在这里插入图片描述"><br> 由上图可知，最右边的这一幅特征图中的红蓝绿黄色四种小点来自于之前特征层对应颜色的独立特征，特征之间没有交互，没有融合，导致最终获取的当前层的特征的之间没有相关性可言，造成局部信息丢失，这对于pixel_level的预测来说是极其致命的。</p> 
<p>消除网格伪影有两种方式，第一种是在使用空洞卷积之前，使用共享可分离卷积先进行特征之间的融合；另一种方式是在卷积后特征整合之前，使用类似于shuffleNet一样的方式进行特征交互，具体可以参考如下链接：<a href="https://zhuanlan.zhihu.com/p/50369448" rel="nofollow">总结-空洞卷积(Dilated/Atrous Convolution)</a></p> 
<p>本文采用第一种方式完成空洞卷积的网格效应消除</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">ResidualBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> channel_num<span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> group<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>ResidualBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>channel_num<span class="token punctuation">,</span> channel_num<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span>dilation<span class="token punctuation">,</span> dilation<span class="token operator">=</span>dilation<span class="token punctuation">,</span> groups<span class="token operator">=</span>group<span class="token punctuation">,</span>
                               bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span>channel_num<span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>channel_num<span class="token punctuation">,</span> channel_num<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span>dilation<span class="token punctuation">,</span> dilation<span class="token operator">=</span>dilation<span class="token punctuation">,</span> groups<span class="token operator">=</span>group<span class="token punctuation">,</span>
                               bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span>channel_num<span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>norm2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="42_Gated_Fusion_Subnetwork_51"></a>4.2 Gated Fusion Sub-network</h4> 
<p>其实现过程如下：首先提取低中高三个不同level的特征图，并设计一个gated fusion sub_network ，输出是三个层级的特征的权重，最后将三个不同层级特征图与对应权重线性连接即可。<br> 具体公式如下：<br> <img src="https://images2.imgbox.com/77/b8/GvSeAJCe_o.png" alt="在这里插入图片描述"><br> 文中提及Gated Fusion Sub-network 包含一个卷积核大小为3*3的卷积网络，输入是低中高三个level的特征通过通道维度进行连接，输出特征是3个通道<br> <img src="https://images2.imgbox.com/ff/57/DvpMekuY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="43__57"></a>4.3 网络结构</h4> 
<p>首先使用三个卷积当作编码模块，对输入图像进行编码，最后一个卷积块特征分辨率减半；其次使用7个残差block对编码的特征进行特征增强；最后使用一个反卷积将特征图上采样两倍，接着使用两个反卷积将特征图映射回图像空间，这样就可以得到原图与无雾图的残差值；其中除了最后一个卷积层以及所设计的共享分离卷积层外，每个卷积后面都跟随一个instance normalization 以及一个ReLU激活函数。</p> 
<p>PS：输入的参数除了原始的雾图外，还需要将图像的边缘提取后作为一个辅助信息加到输入信息中；实际操作的时候，可以提前将图片的边缘信息提取出来与原始图在通道上叠加进而送入网络，这样有利于网络学习<br> 具体代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">GCANet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_c<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> out_c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> only_residual<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>GCANet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_c<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>res1 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res2 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res3 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res4 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res5 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res6 <span class="token operator">=</span> SmoothDilatedResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>res7 <span class="token operator">=</span> ResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>gate <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>deconv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>deconv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>InstanceNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>deconv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> out_c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>only_residual <span class="token operator">=</span> only_residual

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y1 <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm3<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        y <span class="token operator">=</span> self<span class="token punctuation">.</span>res1<span class="token punctuation">(</span>y1<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>res2<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>res3<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y2 <span class="token operator">=</span> self<span class="token punctuation">.</span>res4<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>res5<span class="token punctuation">(</span>y2<span class="token punctuation">)</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>res6<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        y3 <span class="token operator">=</span> self<span class="token punctuation">.</span>res7<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

        gates <span class="token operator">=</span> self<span class="token punctuation">.</span>gate<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> y3<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        gated_y <span class="token operator">=</span> y1 <span class="token operator">*</span> gates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> y2 <span class="token operator">*</span> gates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> y3 <span class="token operator">*</span> gates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm4<span class="token punctuation">(</span>self<span class="token punctuation">.</span>deconv3<span class="token punctuation">(</span>gated_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm5<span class="token punctuation">(</span>self<span class="token punctuation">.</span>deconv2<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>only_residual<span class="token punctuation">:</span>
            y <span class="token operator">=</span> self<span class="token punctuation">.</span>deconv1<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>deconv1<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> y

</code></pre> 
<h4><a id="44__117"></a>4.4 损失函数</h4> 
<p>损失函数用的MSE Loss，作者提及可以使用其它的损失函数，例如perceptual loss或者GAN loss都可以提升最终的去雾效果，但是即使使用最简单的MSE也能得到SOTA的结果<br> <img src="https://images2.imgbox.com/cc/98/bkiK3vsX_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>后记</strong><br> <strong>作者的改进重点</strong>：<br> 发力在损失函数改进以及视频去雾方面</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/77d0a3e0cc26b9f5e78ce0210c0de400/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浅谈kotlin</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a002830cf2f51e81a997b7da2b0effea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">conda添加清华镜像源</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>