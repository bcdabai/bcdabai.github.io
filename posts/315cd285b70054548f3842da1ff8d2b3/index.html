<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>部署Gitlab服务-推送、拉取代码 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="部署Gitlab服务-推送、拉取代码" />
<meta property="og:description" content="准备环境: 关闭防火墙和selinux
192.168.126.139 git-server #Gitlab服务器
192.168.126.140 git-client #gitlab客户端，用于拉取代码
我们是用ssh连接的，所以client创建秘钥，把公钥发给server
[root@client ~]# ssh-keygen #生成秘钥 [root@client ~]# ssh-copy-id -i git@192.168.246.214 #将秘钥传输到git服务器中的git用户 然后两个机器都要下载安装git 1.配置yum源 [root@git-server ~]# cd /etc/yum.repos.d/ [root@git-server yum.repos.d]# vim gitlab-ce.repo [gitlab-ce] name=Gitlab CE Repository baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever gpgcheck=0 enabled=1 安装相关依赖 [root@git-server yum.repos.d]# yum install -y postfix curl policycoreutils-python openssh-server [root@git-server yum.repos.d]# systemctl enable sshd [root@git-server yum.repos.d]# systemctl start sshd 安装postfix [root@git-server yum.repos.d]# yum install postfix -y #安装邮箱 [root@git-server yum.repos.d]# systemctl start postfix [root@git-server yum." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/315cd285b70054548f3842da1ff8d2b3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-06T20:19:51+08:00" />
<meta property="article:modified_time" content="2023-09-06T20:19:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">部署Gitlab服务-推送、拉取代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>准备环境:  关闭防火墙和selinux</p> 
<p>192.168.126.139        git-server   #Gitlab服务器</p> 
<p>192.168.126.140        git-client     #gitlab客户端，用于拉取代码</p> 
<p>我们是用ssh连接的，所以client创建秘钥，把公钥发给server</p> 
<pre><code class="hljs">[root@client ~]# ssh-keygen    #生成秘钥
[root@client ~]# ssh-copy-id -i git@192.168.246.214   #将秘钥传输到git服务器中的git用户</code></pre> 
<p>然后两个机器都要下载安装git </p> 
<h2 style="background-color:transparent;">1.配置yum源</h2> 
<pre><code class="hljs">[root@git-server ~]# cd /etc/yum.repos.d/
[root@git-server yum.repos.d]# vim gitlab-ce.repo
[gitlab-ce]
name=Gitlab CE Repository
baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever
gpgcheck=0
enabled=1
安装相关依赖
[root@git-server yum.repos.d]# yum install -y postfix curl policycoreutils-python openssh-server
[root@git-server yum.repos.d]# systemctl enable sshd
[root@git-server yum.repos.d]# systemctl start sshd
安装postfix
[root@git-server yum.repos.d]# yum install postfix  -y   #安装邮箱
[root@git-server yum.repos.d]# systemctl start postfix
[root@git-server yum.repos.d]# yum install -y gitlab-ce  #将会安装gitlab最新版本</code></pre> 
<h2>2.配置Gitlab登录链接</h2> 
<blockquote> 
 <p>[root@git-server ~]# vim /etc/gitlab/gitlab.rb</p> 
 <p>1.# 添加对外的域名（gitlab.papamk.com请添加A记录指向本服务器的公网IP）：将原来的修改为</p> 
 <p>external_url 'http://192.168.246.214'</p> 
 <p>2.设置地区</p> 
 <p>gitlab_rails['time_zone'] = 'Asia/Shanghai'</p> 
</blockquote> 
<p><img alt="" height="170" src="https://images2.imgbox.com/4e/5c/ujK0d6pR_o.png" width="971"></p> 
<p><img alt="" height="106" src="https://images2.imgbox.com/f6/b9/6P8qgVps_o.png" width="980"></p> 
<p>将数据路径的注释去掉，可以更改</p> 
<p><img alt="" height="193" src="https://images2.imgbox.com/2f/bf/suTi2cGv_o.png" width="1105"></p> 
<p>开启ssh服务</p> 
<p><img alt="" height="121" src="https://images2.imgbox.com/31/8f/HiRmFW7p_o.png" width="1200"></p> 
<p>然后保存退出</p> 
<p>初始化Gitlab</p> 
<pre><code class="hljs">[root@git-server ~]# gitlab-ctl reconfigure   #重新加载，需要等很长时间</code></pre> 
<p>echo  $?         查看执行成功没有</p> 
<p>然后启动Gitlab服务</p> 
<pre><code class="hljs">[root@git-server ~]# gitlab-ctl start  #启动</code></pre> 
<p>在gitlab14版本以上，会有默认的root用户，密码存在/etc/gitlab/initial_root_password</p> 
<p>cat     etc/gitlab/initial_root_password</p> 
<h2>3.访问登录</h2> 
<p>访问ip        192.168.126.139</p> 
<p><img alt="" height="900" src="https://images2.imgbox.com/3c/13/PU8ieu22_o.png" width="1200"></p> 
<p>用户是root   密码是上面查看过的</p> 
<p>可以设置为中文</p> 
<p><img alt="" height="230" src="https://images2.imgbox.com/27/b4/Ttg4Xn06_o.png" width="848"></p> 
<p><img alt="" height="215" src="https://images2.imgbox.com/b6/8b/TxYV1sng_o.png" width="517"></p> 
<p></p> 
<p><img alt="" height="454" src="https://images2.imgbox.com/ab/d8/oIvy5GWg_o.png" width="925"></p> 
<p><img alt="" height="449" src="https://images2.imgbox.com/35/17/ljffMvJc_o.png" width="913"></p> 
<p>然后刷新一下就行</p> 
<p>创建项目</p> 
<p><img alt="" height="940" src="https://images2.imgbox.com/0a/23/St2al4qs_o.png" width="1200"></p> 
<p><img alt="" height="938" src="https://images2.imgbox.com/29/47/TTorJyZ1_o.png" width="1200"></p> 
<p><img alt="" height="943" src="https://images2.imgbox.com/f4/f3/bouE7YQ4_o.png" width="1200"></p> 
<p>我们要添加密钥，添加公钥即可</p> 
<p><img alt="" height="180" src="https://images2.imgbox.com/65/b4/CYVTNRDJ_o.png" width="974"></p> 
<p>复制公钥拷贝到</p> 
<p><img alt="" height="943" src="https://images2.imgbox.com/75/bf/AcO4qSCh_o.png" width="1200"></p> 
<p><img alt="" height="943" src="https://images2.imgbox.com/01/c2/pcvikLw1_o.png" width="1200"></p> 
<p>先创建一个文件</p> 
<p><img alt="" height="285" src="https://images2.imgbox.com/12/c1/Qe3mbFsv_o.png" width="915"></p> 
<p><img alt="" height="324" src="https://images2.imgbox.com/80/bd/srvYi4yM_o.png" width="1103"></p> 
<p><img alt="" height="250" src="https://images2.imgbox.com/dd/79/L7h4mEsz_o.png" width="901"></p> 
<p><img alt="" height="606" src="https://images2.imgbox.com/b7/b0/aLqWP3Jr_o.png" width="1200"></p> 
<h2 style="background-color:transparent;">4.客户端拉取代码</h2> 
<h3>用ssh方式拉取代码</h3> 
<p><img alt="" height="850" src="https://images2.imgbox.com/0f/4b/auGBEEHa_o.png" width="1200"></p> 
<p> </p> 
<p>我们要先创建git用户，然后添加邮箱等，详情看：<a class="link-info" href="http://t.csdn.cn/kFE7H" rel="nofollow" title="http://t.csdn.cn/kFE7H">http://t.csdn.cn/kFE7H</a></p> 
<pre><code class="hljs">[root@git-client ~]# git clone git@192.168.126.139:root/test1.git
正克隆到 'test1'...
git@192.168.126.139's password: 
fatal: 'root/test1.git' does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
[root@git-client ~]# git clone git@192.168.126.139:root/test1.git
正克隆到 'test1'...
remote: Enumerating objects: 6, done.
remote: Counting objects: 100% (6/6), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
接收对象中: 100% (6/6), done.
[root@git-client ~]# ls
anaconda-ks.cfg                    play-book     test1
percona-release-latest.noarch.rpm  shell_set.sh
[root@git-client ~]# cd test1/
[root@git-client test1]# ls
moban  README.md</code></pre> 
<p>已经拉取成功了</p> 
<h3>用http方式拉取代码</h3> 
<p><img alt="" height="943" src="https://images2.imgbox.com/27/f8/trN2jdRt_o.png" width="1200"></p> 
<pre><code class="hljs">[root@git-client ~]# git clone http://192.168.126.139/root/test1.git
正克隆到 'test1'...
Username for 'http://192.168.126.139': root    #这里是root用户
Password for 'http://root@192.168.126.139':     #你自己设置的登录密码
remote: Enumerating objects: 6, done.
remote: Counting objects: 100% (6/6), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (6/6), done.
[root@git-client ~]# ls
anaconda-ks.cfg                    play-book     test1
percona-release-latest.noarch.rpm  shell_set.sh
[root@git-client ~]# cd test1/
[root@git-client test1]# ls
moban  README.md</code></pre> 
<h2>5.提交代码到gitlab仓库</h2> 
<pre><code class="hljs">[root@git-client ~]# cd test1/
[root@git-client test1]# ls
moban  README.md
[root@git-client test1]# vim update.txt
[root@git-client test1]# cat update.txt 
你好
[root@git-client test1]# git add *
[root@git-client test1]# git commit -m "update你好"
[main 3017a2f] update你好
 1 file changed, 1 insertion(+)
 create mode 100644 update.txt
[root@git-client test1]# git push origin main
Username for 'http://192.168.126.139': root
Password for 'http://root@192.168.126.139': 
Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (3/3), 308 bytes | 0 bytes/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To http://192.168.126.139/root/test1.git
   eececc5..3017a2f  main -&gt; main
</code></pre> 
<p>我们用哪种方式拉取的代码就是用哪种方式上传的</p> 
<p>在gitlab上查看</p> 
<p> <img alt="" height="371" src="https://images2.imgbox.com/4e/47/VphNks8n_o.png" width="1200"></p> 
<h2>6.tag版本推送</h2> 
<pre><code class="hljs">[root@git-client test1]# vim 1.txt
[root@git-client test1]# cat 1.txt 
1111111
[root@git-client test1]# git add *
[root@git-client test1]# git commit -m "tag 1.txt"
[main 883df40] tag 1.txt
 1 file changed, 1 insertion(+)
 create mode 100644 1.txt
[root@git-client test1]# git tag -a "v1.0" -m "tag 1.txt"
[root@git-client test1]# git tag
v1.0
[root@git-client test1]# git push origin v1.0 
Counting objects: 5, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (4/4), 438 bytes | 0 bytes/s, done.
Total 4 (delta 0), reused 0 (delta 0)
To git@192.168.126.139:root/test1.git
 * [new tag]         v1.0 -&gt; v1.0
</code></pre> 
<p><img alt="" height="314" src="https://images2.imgbox.com/e7/c1/6rzfgMpK_o.png" width="1200"></p> 
<p><img alt="" height="361" src="https://images2.imgbox.com/2a/c0/tsjAxyFf_o.png" width="1175"></p> 
<h2>7.分支版本推送</h2> 
<pre><code class="hljs">[root@git-client test1]# git branch dev
[root@git-client test1]# git branch 
  dev
* main
[root@git-client test1]# git checkout dev 
切换到分支 'dev'
[root@git-client test1]# git branch 
* dev
  main
[root@git-client test1]# vim dev.txt
[root@git-client test1]# cat dev.txt 
dev ceshi
[root@git-client test1]# git add *
[root@git-client test1]# git commit -m "dev branch"
[dev e3e0ac2] dev branch
 1 file changed, 1 insertion(+)
 create mode 100644 dev.txt
[root@git-client test1]# git push origin dev
Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (3/3), 260 bytes | 0 bytes/s, done.
Total 3 (delta 1), reused 0 (delta 0)
remote: 
remote: To create a merge request for dev, visit:
remote:   http://192.168.126.139/root/test1/-/merge_requests/new?merge_request%5Bsource_branch%5D=dev
remote: 
To git@192.168.126.139:root/test1.git
 * [new branch]      dev -&gt; dev</code></pre> 
<p><img alt="" height="438" src="https://images2.imgbox.com/58/f1/qh9JVivw_o.png" width="988"></p> 
<p><img alt="" height="423" src="https://images2.imgbox.com/87/81/StD24IDN_o.png" width="1156"></p> 
<h2>8.Gitlab备份与恢复</h2> 
<h3>1.修改配置文件</h3> 
<p>打开/etc/gitlab/gitlab.rb配置文件，查看一个和备份相关的配置项：</p> 
<pre><code class="hljs">[root@git-server backups]# vim /etc/gitlab/gitlab.rb
gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"	#备份的路径
gitlab_rails['backup_archive_permissions'] = 0644		#备份文件的默认权限
gitlab_rails['backup_keep_time'] = 604800				#保留时长，秒为单位</code></pre> 
<p><img alt="" height="279" src="https://images2.imgbox.com/a8/b3/MC5c5NlT_o.png" width="1200"></p> 
<p>重启服务</p> 
<p>gitlab-ctl reconfigure</p> 
<p>备份</p> 
<pre><code class="hljs">[root@git-server ~]# cd /var/opt/gitlab/backups/
[root@git-server backups]# /opt/gitlab/bin/gitlab-rake gitlab:backup:create
[root@git-server backups]# ls
1694002200_2023_09_06_16.3.1_gitlab_backup.tar</code></pre> 
<p>数据恢复，我们现在gitlab上把代码删掉，在进行恢复</p> 
<p><img alt="" height="343" src="https://images2.imgbox.com/09/f5/sygmcVBS_o.png" width="1200"></p> 
<pre><code class="hljs">[root@git-server backups]# /opt/gitlab/bin/gitlab-rake gitlab:backup:restore BACKUP=/var/opt/gitlab/backups/1694002200_2023_09_06_16.3.1_gitlab_backup.tar</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f430e971dc13691eeeb6dd440df9aa2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jsvmp逆向(补环境篇)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f51619a5f6ca503b58b829a7616cf0f3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;】不用任何函数的简单 wstring to LPWSTR</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>