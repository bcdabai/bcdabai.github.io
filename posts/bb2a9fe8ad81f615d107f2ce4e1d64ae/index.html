<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SaltStack之salt-ssh - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SaltStack之salt-ssh" />
<meta property="og:description" content="文章目录 1. salt-ssh介绍1.1 salt-ssh的特点1.2 salt-ssh远程管理的方式 2. salt-ssh管理2.1 通过使用用户名密码的SSH实现远程管理 1. salt-ssh介绍 salt-ssh可以让我们不需要在受控机上安装salt-minion客户端也能够实现管理操作。
1.1 salt-ssh的特点 远程系统需要Python支持，除非使用-r选项发送原始ssh命令salt-ssh是一个软件包，需安装之后才能使用，命令本身也是salt-sshsalt-ssh不会取代标准的Salt通信系统，它只是提供了一个基于SSH的替代方案，不需要ZeroMQ和agent
注意，由于所有与Salt SSH的通信都是通过SSH执行的，因此它比使用ZeroMQ的标准Salt慢得多 1.2 salt-ssh远程管理的方式 salt-ssh有两种方式实现远程管理，一种是在配置文件中记录所有客户端的信息，诸如 IP 地址、端口号、用户名、密码以及是否支持sudo等；另一种是使用密钥实现远程管理，不需要输入密码。
2. salt-ssh管理 在 master 上安装 salt-ssh
[root@master ~]# yum -y install salt-ssh 2.1 通过使用用户名密码的SSH实现远程管理 修改配置文件，添加受控机信息
[root@node01-linux ~]# vim /etc/salt/roster [root@node01-linux ~]# cat /etc/salt/roster # Sample salt-ssh config file #web1: # host: 192.168.42.1 # The IP addr or DNS hostname # user: fred # Remote executions will be executed as user fred # passwd: foobarbaz # The password to use for login, if omitted, keys are used # sudo: True # Whether to sudo to root, not enabled by default #web2: # host: 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bb2a9fe8ad81f615d107f2ce4e1d64ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-03T13:42:27+08:00" />
<meta property="article:modified_time" content="2020-03-03T13:42:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SaltStack之salt-ssh</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_saltssh_1" rel="nofollow">1. salt-ssh介绍</a></li><li><ul><li><a href="#11_saltssh_4" rel="nofollow">1.1 salt-ssh的特点</a></li><li><a href="#12_saltssh_9" rel="nofollow">1.2 salt-ssh远程管理的方式</a></li></ul> 
  </li><li><a href="#2_saltssh_11" rel="nofollow">2. salt-ssh管理</a></li><li><ul><li><a href="#21_SSH_16" rel="nofollow">2.1 通过使用用户名密码的SSH实现远程管理</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_saltssh_1"></a>1. salt-ssh介绍</h2> 
<p>salt-ssh可以让我们不需要在受控机上安装salt-minion客户端也能够实现管理操作。</p> 
<h3><a id="11_saltssh_4"></a>1.1 salt-ssh的特点</h3> 
<ul><li>远程系统需要Python支持，除非使用-r选项发送原始ssh命令</li><li>salt-ssh是一个软件包，需安装之后才能使用，命令本身也是salt-ssh</li><li>salt-ssh不会取代标准的Salt通信系统，它只是提供了一个基于SSH的替代方案，不需要ZeroMQ和agent<br> <strong>注意，由于所有与Salt SSH的通信都是通过SSH执行的，因此它比使用ZeroMQ的标准Salt慢得多</strong></li></ul> 
<h3><a id="12_saltssh_9"></a>1.2 salt-ssh远程管理的方式</h3> 
<p>salt-ssh有两种方式实现远程管理，一种是在配置文件中记录所有客户端的信息，诸如 IP 地址、端口号、用户名、密码以及是否支持sudo等；另一种是使用密钥实现远程管理，不需要输入密码。</p> 
<h2><a id="2_saltssh_11"></a>2. salt-ssh管理</h2> 
<p><strong>在 master 上安装 salt-ssh</strong></p> 
<pre><code>[root@master ~]# yum -y install salt-ssh
</code></pre> 
<h3><a id="21_SSH_16"></a>2.1 通过使用用户名密码的SSH实现远程管理</h3> 
<p><strong>修改配置文件，添加受控机信息</strong></p> 
<pre><code>[root@node01-linux ~]# vim /etc/salt/roster 
[root@node01-linux ~]# cat /etc/salt/roster 
# Sample salt-ssh config file
#web1:
#  host: 192.168.42.1 # The IP addr or DNS hostname
#  user: fred         # Remote executions will be executed as user fred
#  passwd: foobarbaz  # The password to use for login, if omitted, keys are used
#  sudo: True         # Whether to sudo to root, not enabled by default
#web2:
#  host: 192.168.42.2

node01:
  host: 192.168.18.168
  user: root
  passwd: 123456
node02:
  host: 192.168.18.169
  user: root
  passwd: 123456
</code></pre> 
<p><strong>测试连通性</strong></p> 
<pre><code>[root@node01-linux ~]# salt-ssh '*' test.ping
node01:
    ----------
    retcode:
        254
    stderr:
    stdout:
        The host key needs to be accepted, to auto accept run salt-ssh with the -i flag:
        The authenticity of host '192.168.18.168 (192.168.18.168)' can't be established.
        ECDSA key fingerprint is SHA256:wQ+uLAZfFgzf9T/M0BoDYOs3wwxdrl5yVzsy4lKsN/Y.
        ECDSA key fingerprint is MD5:6d:21:e4:db:e8:11:f4:a4:37:43:cb:c0:2d:04:48:a6.
        Are you sure you want to continue connecting (yes/no)? 
node02:
    ----------
    retcode:
        254
    stderr:
    stdout:
        The host key needs to be accepted, to auto accept run salt-ssh with the -i flag:
        The authenticity of host '192.168.18.169 (192.168.18.169)' can't be established.
        ECDSA key fingerprint is SHA256:/JHrt9jZfWvaDRMcqlDuoWF4grTzDLKShN7oyNOtHZ4.
        ECDSA key fingerprint is MD5:fb:ef:16:af:f4:a7:88:16:3a:a6:ae:ed:7a:34:34:10.
        Are you sure you want to continue connecting (yes/no)? 
</code></pre> 
<p>从上面的信息可以看出，第一次访问时需要输入 yes/no ，但是 saltstack 是不支持交互式操作的，所以为了解决这个问题，我们需要对其进行设置，让系统不进行主机验证。</p> 
<pre><code>[root@master ~]# vim ~/.ssh/config
StrictHostKeyChecking no
[root@node01-linux ~]# salt-ssh '*' test.ping
node02:
    True
node01:
    True
//测试执行命令
[root@node01-linux ~]# salt-ssh '*' cmd.run 'mkdir /tmp/haha'
node02:
node01:
[root@node01-linux ~]# salt-ssh '*' cmd.run 'ls /tmp'
node01:
    haha
    systemd-private-b22e73192fe241dd8270c8b89ee335cc-chronyd.service-tCN0Mb
    systemd-private-b22e73192fe241dd8270c8b89ee335cc-vgauthd.service-SE60Tg
    systemd-private-b22e73192fe241dd8270c8b89ee335cc-vmtoolsd.service-CFUv1l
    systemd-private-c36743b890804defbc7d23c5efb9ace2-chronyd.service-StXH2j
    systemd-private-c36743b890804defbc7d23c5efb9ace2-httpd.service-1FrNPV
    systemd-private-c36743b890804defbc7d23c5efb9ace2-vgauthd.service-D5LYNs
    systemd-private-c36743b890804defbc7d23c5efb9ace2-vmtoolsd.service-DFnwGB
    systemd-private-e968fb26152c4086870b333ad9d0e688-chronyd.service-Bj4q4y
    systemd-private-e968fb26152c4086870b333ad9d0e688-vgauthd.service-ssBMsj
    systemd-private-e968fb26152c4086870b333ad9d0e688-vmtoolsd.service-4Kxfgr
    systemd-private-edec3c7005314dbbbefb7832deeecde2-chronyd.service-fvDUaR
    systemd-private-edec3c7005314dbbbefb7832deeecde2-httpd.service-9NvW2o
    systemd-private-edec3c7005314dbbbefb7832deeecde2-vgauthd.service-6TWdXG
    systemd-private-edec3c7005314dbbbefb7832deeecde2-vmtoolsd.service-dGblp1
node02:
    haha
    systemd-private-4e808d1931004d438a5caa7713d5664c-chronyd.service-0VSH9v
    systemd-private-4e808d1931004d438a5caa7713d5664c-vgauthd.service-8ln77C
    systemd-private-4e808d1931004d438a5caa7713d5664c-vmtoolsd.service-Tk3P6J
    systemd-private-4ff1ca2ae6b944d093a777588ded560b-chronyd.service-NQw4fl
    systemd-private-4ff1ca2ae6b944d093a777588ded560b-httpd.service-b9v925
    systemd-private-4ff1ca2ae6b944d093a777588ded560b-vgauthd.service-Pm5sYq
    systemd-private-4ff1ca2ae6b944d093a777588ded560b-vmtoolsd.service-XF7oHw
    systemd-private-78526dfebd4b4d4fa2733da7dd884860-chronyd.service-x9jGNy
    systemd-private-78526dfebd4b4d4fa2733da7dd884860-httpd.service-hsjhg9
    systemd-private-78526dfebd4b4d4fa2733da7dd884860-mariadb.service-hZOQBX
    systemd-private-78526dfebd4b4d4fa2733da7dd884860-vgauthd.service-TpvDXl
    systemd-private-78526dfebd4b4d4fa2733da7dd884860-vmtoolsd.service-HyWgns
    systemd-private-a8e34a50c55c4d1b996fd14aa57660c1-chronyd.service-fhVCL6
    systemd-private-a8e34a50c55c4d1b996fd14aa57660c1-vgauthd.service-djugjb
    systemd-private-a8e34a50c55c4d1b996fd14aa57660c1-vmtoolsd.service-OVWGRf
</code></pre> 
<p>注意：salt-ssh ‘*’ test.ping的 * 号是指在/etc/salt/roster文件中写入的主机。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd04616757eb13fc6628d61a7a8966bb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CountDownLatch详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4f215f88c9e2c8646e5d591c167811c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">hive调优之map task数量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>