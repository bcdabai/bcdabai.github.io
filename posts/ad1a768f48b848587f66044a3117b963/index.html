<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apollo开放平台 API - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apollo开放平台 API" />
<meta property="og:description" content="一、 什么是开放平台？ Apollo提供了一套的Http REST接口，使第三方应用能够自己管理配置。虽然Apollo系统本身提供了Portal来管理配置，但是在有些情景下，应用需要通过程序去管理配置。
二、 第三方应用接入Apollo开放平台 2.1 注册第三方应用 第三方应用负责人需要向Apollo管理员提供一些第三方应用基本信息。
基本信息如下：
第三方应用的AppId、应用名、部门第三方应用负责人 Apollo管理员在 http://{portal_address}/open/manage.html 创建第三方应用，创建之前最好先查询此AppId是否已经创建。创建成功之后会生成一个token，如下图所示：
[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-n7gMFONd-1585386458792)(https://github.com/ctripcorp/apollo/raw/master/doc/images/apollo-open-manage.png)]
2.2 给已注册的第三方应用授权 第三方应用不应该能操作任何Namespace的配置，所以需要给token绑定可以操作的Namespace。Apollo管理员在 http://{portal_address}/open/manage.html 页面给token赋权。赋权之后，第三方应用就可以通过Apollo提供的Http REST接口来管理已授权的Namespace的配置了。
2.3 第三方应用调用Apollo Open API 2.3.1 调用Http REST接口 任何语言的第三方应用都可以调用Apollo的Open API，在调用接口时，需要设置注意以下两点：
Http Header中增加一个Authorization字段，字段值为申请的tokenHttp Header的Content-Type字段需要设置成application/json;charset=UTF-8 2.3.2 Java应用通过apollo-openapi调用Apollo Open API 从1.1.0版本开始，Apollo提供了apollo-openapi客户端，所以Java语言的第三方应用可以更方便地调用Apollo Open API。
首先引入apollo-openapi依赖：
&lt;dependency&gt; &lt;groupId&gt;com.ctrip.framework.apollo&lt;/groupId&gt; &lt;artifactId&gt;apollo-openapi&lt;/artifactId&gt; &lt;version&gt;1.1.0&lt;/version&gt; &lt;/dependency&gt; 在程序中构造ApolloOpenApiClient：
String portalUrl = &#34;http://localhost:8070&#34;; // portal url String token = &#34;e16e5cd903fd0c97a116c873b448544b9d086de9&#34;; // 申请的token ApolloOpenApiClient client = ApolloOpenApiClient.newBuilder() .withPortalUrl(portalUrl) .withToken(token) .build(); 后续就可以通过ApolloOpenApiClient的接口直接操作Apollo Open API了，接口说明参见下面的Rest接口文档。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ad1a768f48b848587f66044a3117b963/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-28T17:11:54+08:00" />
<meta property="article:modified_time" content="2020-03-28T17:11:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apollo开放平台 API</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="__0"></a>一、 什么是开放平台？</h4> 
<p>Apollo提供了一套的Http REST接口，使第三方应用能够自己管理配置。虽然Apollo系统本身提供了Portal来管理配置，但是在有些情景下，应用需要通过程序去管理配置。</p> 
<h4><a id="_Apollo_4"></a>二、 第三方应用接入Apollo开放平台</h4> 
<h5><a id="21__6"></a>2.1 注册第三方应用</h5> 
<p>第三方应用负责人需要向Apollo管理员提供一些第三方应用基本信息。</p> 
<p>基本信息如下：</p> 
<ul><li>第三方应用的AppId、应用名、部门</li><li>第三方应用负责人</li></ul> 
<p>Apollo管理员在 http://{portal_address}/open/manage.html 创建第三方应用，创建之前最好先查询此AppId是否已经创建。创建成功之后会生成一个token，如下图所示：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-n7gMFONd-1585386458792)(https://github.com/ctripcorp/apollo/raw/master/doc/images/apollo-open-manage.png)]</p> 
<h5><a id="22__19"></a>2.2 给已注册的第三方应用授权</h5> 
<p>第三方应用不应该能操作任何Namespace的配置，所以需要给token绑定可以操作的Namespace。Apollo管理员在 http://{portal_address}/open/manage.html 页面给token赋权。赋权之后，第三方应用就可以通过Apollo提供的Http REST接口来管理已授权的Namespace的配置了。</p> 
<h5><a id="23_Apollo_Open_API_23"></a>2.3 第三方应用调用Apollo Open API</h5> 
<h6><a id="231_Http_REST_25"></a>2.3.1 调用Http REST接口</h6> 
<p>任何语言的第三方应用都可以调用Apollo的Open API，在调用接口时，需要设置注意以下两点：</p> 
<ul><li>Http Header中增加一个Authorization字段，字段值为申请的token</li><li>Http Header的Content-Type字段需要设置成application/json;charset=UTF-8</li></ul> 
<h6><a id="232_JavaapolloopenapiApollo_Open_API_32"></a>2.3.2 Java应用通过apollo-openapi调用Apollo Open API</h6> 
<p>从1.1.0版本开始，Apollo提供了<a href="https://github.com/ctripcorp/apollo/tree/master/apollo-openapi">apollo-openapi</a>客户端，所以Java语言的第三方应用可以更方便地调用Apollo Open API。</p> 
<p>首先引入<code>apollo-openapi</code>依赖：</p> 
<pre><code class="prism language-json"><span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>apollo<span class="token operator">-</span>openapi<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.1</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>在程序中构造<code>ApolloOpenApiClient</code>：</p> 
<pre><code class="prism language-json">String portalUrl <span class="token operator">=</span> <span class="token string">"http://localhost:8070"</span><span class="token punctuation">;</span> <span class="token comment">// portal url</span>
String token <span class="token operator">=</span> <span class="token string">"e16e5cd903fd0c97a116c873b448544b9d086de9"</span><span class="token punctuation">;</span> <span class="token comment">// 申请的token</span>
ApolloOpenApiClient client <span class="token operator">=</span> ApolloOpenApiClient<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                <span class="token punctuation">.</span><span class="token function">withPortalUrl</span><span class="token punctuation">(</span>portalUrl<span class="token punctuation">)</span>
                                                <span class="token punctuation">.</span><span class="token function">withToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                                                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>后续就可以通过<code>ApolloOpenApiClient</code>的接口直接操作Apollo Open API了，接口说明参见下面的Rest接口文档。</p> 
<h6><a id="233_Net_coreApollo_Open_API_59"></a>2.3.3 .Net core应用调用Apollo Open API</h6> 
<p>.Net core也提供了open api的客户端，详见https://github.com/ctripcorp/apollo.net/pull/77</p> 
<h4><a id="__63"></a>三、 接口文档</h4> 
<h5><a id="31_URL_65"></a>3.1 URL路径参数说明</h5> 
<table><thead><tr><th>参数名</th><th>参数说明</th></tr></thead><tbody><tr><td>env</td><td>所管理的配置环境</td></tr><tr><td>appId</td><td>所管理的配置AppId</td></tr><tr><td>clusterName</td><td>所管理的配置集群名， 一般情况下传入 default 即可。如果是特殊集群，传入相应集群的名称即可</td></tr><tr><td>namespaceName</td><td>所管理的Namespace的名称，如果是非properties格式，需要加上后缀名，如<code>sample.yml</code></td></tr></tbody></table> 
<h5><a id="32_API_74"></a>3.2 API接口列表</h5> 
<h6><a id="321_App_76"></a>3.2.1 获取App的环境，集群信息</h6> 
<ul><li><strong>URL</strong> : http://{portal_address}/openapi/v1/apps/{appId}/envclusters</li><li><strong>Method</strong> : GET</li><li><strong>Request Params</strong> : 无</li><li><strong>返回值Sample</strong>：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"env"</span><span class="token punctuation">:</span><span class="token string">"FAT"</span><span class="token punctuation">,</span>
        <span class="token string">"clusters"</span><span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token comment">//集群列表</span>
            <span class="token string">"default"</span><span class="token punctuation">,</span>
            <span class="token string">"FAT381"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"env"</span><span class="token punctuation">:</span><span class="token string">"UAT"</span><span class="token punctuation">,</span>
        <span class="token string">"clusters"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
            <span class="token string">"default"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"env"</span><span class="token punctuation">:</span><span class="token string">"PRO"</span><span class="token punctuation">,</span>
        <span class="token string">"clusters"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
            <span class="token string">"default"</span><span class="token punctuation">,</span>
            <span class="token string">"SHAOY"</span><span class="token punctuation">,</span>
            <span class="token string">"SHAJQ"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<h6><a id="322_Namespace_109"></a>3.2.2 获取集群下所有Namespace信息接口</h6> 
<ul><li><strong>URL</strong> : http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces</li><li><strong>Method</strong>: GET</li><li><strong>Request Params</strong>: 无</li><li><strong>返回值Sample</strong>:</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"100003171"</span><span class="token punctuation">,</span>
    <span class="token string">"clusterName"</span><span class="token punctuation">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"default app namespace"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"properties"</span><span class="token punctuation">,</span> <span class="token comment">//Namespace格式可能取值为：properties、xml、json、yml、yaml</span>
    <span class="token string">"isPublic"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否为公共的Namespace</span>
    <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token comment">// Namespace下所有的配置集合</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"batch"</span><span class="token punctuation">,</span>
        <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-21T16:03:43.000+0800"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-21T16:03:43.000+0800"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:05:58.000+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:05:58.000+0800"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"100003171"</span><span class="token punctuation">,</span>
    <span class="token string">"clusterName"</span><span class="token punctuation">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"FX.apollo"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"apollo public namespace"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"properties"</span><span class="token punctuation">,</span>
    <span class="token string">"isPublic"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"request.timeout"</span><span class="token punctuation">,</span>
        <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>
        <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:08:30.000+0800"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-01T13:56:25.000+0800"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1116</span><span class="token punctuation">,</span>
        <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"batch"</span><span class="token punctuation">,</span>
        <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>
        <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-28T15:13:42.000+0800"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-01T13:51:00.000+0800"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:08:13.000+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:08:13.000+0800"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<h6><a id="323_Namespace_176"></a>3.2.3 获取某个Namespace信息接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}</li><li><strong>Method</strong> ： GET</li><li><strong>Request Params</strong> ：无</li><li><strong>返回值Sample</strong> ：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"100003171"</span><span class="token punctuation">,</span>
    <span class="token string">"clusterName"</span><span class="token punctuation">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"default app namespace"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"properties"</span><span class="token punctuation">,</span> <span class="token comment">//Namespace格式可能取值为：properties、xml、json、yml、yaml</span>
    <span class="token string">"isPublic"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否为公共的Namespace</span>
    <span class="token string">"items"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token comment">// Namespace下所有的配置集合</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"batch"</span><span class="token punctuation">,</span>
        <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-21T16:03:43.000+0800"</span><span class="token punctuation">,</span>
        <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-21T16:03:43.000+0800"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:05:58.000+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-07-20T14:05:58.000+0800"</span>
  <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="324_Namespace_208"></a>3.2.4 创建Namespace</h5> 
<p>可以通过此接口创建Namespace，调用此接口需要授予第三方APP，APP级别的权限。</p> 
<ul><li><strong>URL</strong> ： http://{portal_address} /openapi/v1/apps/{appId}/appnamespaces</li><li><strong>Method</strong> ： POST</li><li><strong>Request Params</strong> ：无</li><li><strong>请求内容(Request Body, JSON格式)</strong> ：</li></ul> 
<table><thead><tr><th>参数名</th><th>必选</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>true</td><td>String</td><td>Namespace的名字</td></tr><tr><td>appId</td><td>true</td><td>String</td><td>Namespace所属的AppId</td></tr><tr><td>format</td><td>true</td><td>String</td><td>Namespace的格式，<strong>只能是以下类型： properties、xml、json、yml、yaml</strong></td></tr><tr><td>isPublic</td><td>true</td><td>boolean</td><td>是否是公共文件</td></tr><tr><td>comment</td><td>false</td><td>String</td><td>Namespace说明</td></tr><tr><td>dataChangeCreatedBy</td><td>true</td><td>String</td><td>namespace的创建人，格式为域账号，也就是sso系统的User ID</td></tr></tbody></table> 
<ul><li><strong>返回值 Sample</strong> ：</li></ul> 
<pre><code class="prism language-json"> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"FX.public-0420-11"</span><span class="token punctuation">,</span>
  <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"100003173"</span><span class="token punctuation">,</span>
  <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"properties"</span><span class="token punctuation">,</span>
  <span class="token string">"isPublic"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
  <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
  <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
  <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2017-04-20T18:25:49.033+0800"</span><span class="token punctuation">,</span>
  <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2017-04-20T18:25:49.033+0800"</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>返回值说明</strong> ：</li></ul> 
<blockquote> 
 <p>如果是properties文件，name = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           a 
          
         
           p 
          
         
           p 
          
         
           I 
          
         
           d 
          
         
           所 
          
         
           属 
          
         
           的 
          
         
           部 
          
         
           门 
          
         
        
          . 
         
        
       
         {appId所属的部门}. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault">d</span><span class="mord cjk_fallback">所</span><span class="mord cjk_fallback">属</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">部</span><span class="mord cjk_fallback">门</span></span><span class="mord">.</span></span></span></span></span>{传入的name值} ，例如调用接口传入的name=xy-z, format=properties，应用的部门为框架（FX）,那么name=FX.xy-z</p> 
</blockquote> 
<blockquote> 
 <p>如果不是properties文件 name = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           a 
          
         
           p 
          
         
           p 
          
         
           I 
          
         
           d 
          
         
           所 
          
         
           属 
          
         
           的 
          
         
           部 
          
         
           门 
          
         
        
          . 
         
        
       
         {appId所属的部门}. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault">d</span><span class="mord cjk_fallback">所</span><span class="mord cjk_fallback">属</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">部</span><span class="mord cjk_fallback">门</span></span><span class="mord">.</span></span></span></span></span>{传入的name值}.${format}，例如调用接口传入的name=xy-z, format=json，应用的部门为框架（FX）,那么name=FX.xy-z.json</p> 
</blockquote> 
<h6><a id="325_Namespace_248"></a>3.2.5 获取某个Namespace当前编辑人接口</h6> 
<p>Apollo在生产环境（PRO）有限制规则：每次发布只能有一个人编辑配置，且该次发布的人不能是该次发布的编辑人。 也就是说如果一个用户A修改了某个namespace的配置，那么在这个namespace发布前，只能由A修改，其它用户无法修改。同时，该用户A无法发布自己修改的配置，必须找另一个有发布权限的人操作。 这个接口就是用来获取当前namespace是否有人锁定的接口。在非生产环境（FAT、UAT），该接口始终返回没有人锁定。</p> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/lock</li><li><strong>Method</strong> ： GET</li><li><strong>Request Params</strong> ：无</li><li><strong>返回值 Sample（未锁定）</strong> ：</li></ul> 
<pre><code class="prism language-json">  <span class="token punctuation">{<!-- --></span>
  <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
  <span class="token string">"isLocked"</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>返回值Sample(被锁定)</strong> ：</li></ul> 
<pre><code class="prism language-json">  <span class="token punctuation">{<!-- --></span>
  <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
  <span class="token string">"isLocked"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"lockedBy"</span><span class="token punctuation">:</span> <span class="token string">"song_s"</span> <span class="token comment">//锁owner</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="326__274"></a>3.2.6 新增配置接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items</li><li><strong>Method</strong> ： POST</li><li><strong>Request Params</strong> ：无</li><li><strong>请求内容(Request Body, JSON格式)</strong> ：</li></ul> 
<table><thead><tr><th>参数名</th><th>必选</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>true</td><td>String</td><td>配置的key，长度不能超过128个字符。非properties格式，key固定为<code>content</code></td></tr><tr><td>value</td><td>true</td><td>String</td><td>配置的value，长度不能超过20000个字符，非properties格式，value为文件全部内容</td></tr><tr><td>comment</td><td>false</td><td>String</td><td>配置的备注,长度不能超过1024个字符</td></tr><tr><td>dataChangeCreatedBy</td><td>true</td><td>String</td><td>item的创建人，格式为域账号，也就是sso系统的User ID</td></tr></tbody></table> 
<ul><li><strong>Request body sample</strong> :</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"key"</span><span class="token punctuation">:</span><span class="token string">"timeout"</span><span class="token punctuation">,</span>
    <span class="token string">"value"</span><span class="token punctuation">:</span><span class="token string">"3000"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span><span class="token string">"超时时间"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span><span class="token string">"zhanglea"</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>返回值Sample</strong> ：</li></ul> 
<pre><code class="prism language-json">  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"timeout"</span><span class="token punctuation">,</span>
    <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"超时时间"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T12:06:41.818+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T12:06:41.818+0800"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="327__313"></a>3.2.7 修改配置接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key}</li><li><strong>Method</strong> ： PUT</li><li><strong>Request Params</strong> ：无</li><li><strong>请求内容(Request Body, JSON格式)</strong> ：</li></ul> 
<table><thead><tr><th>参数名</th><th>必选</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>true</td><td>String</td><td>配置的key，需和url中的key值一致。非properties格式，key固定为<code>content</code></td></tr><tr><td>value</td><td>true</td><td>String</td><td>配置的value，长度不能超过20000个字符，非properties格式，value为文件全部内容</td></tr><tr><td>comment</td><td>false</td><td>String</td><td>配置的备注,长度不能超过1024个字符</td></tr><tr><td>dataChangeLastModifiedBy</td><td>true</td><td>String</td><td>item的修改人，格式为域账号，也就是sso系统的User ID</td></tr></tbody></table> 
<ul><li><strong>Request body sample</strong> :</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"key"</span><span class="token punctuation">:</span><span class="token string">"timeout"</span><span class="token punctuation">,</span>
    <span class="token string">"value"</span><span class="token punctuation">:</span><span class="token string">"3000"</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span><span class="token string">"超时时间"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span><span class="token string">"zhanglea"</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>返回值</strong> ：无</li></ul> 
<h6><a id="328__340"></a>3.2.8 删除配置接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key}?operator={operator}</li><li><strong>Method</strong> ： DELETE</li><li><strong>Request Params</strong> ：</li></ul> 
<table><thead><tr><th>参数名</th><th>必选</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>true</td><td>String</td><td>配置的key。非properties格式，key固定为<code>content</code></td></tr><tr><td>operator</td><td>true</td><td>String</td><td>删除配置的操作者，域账号</td></tr></tbody></table> 
<ul><li><strong>返回值</strong> ： 无</li></ul> 
<h6><a id="329__353"></a>3.2.9 发布配置接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases</li><li><strong>Method</strong> ： POST</li><li><strong>Request Params</strong> ：无</li><li><strong>Request Body</strong> ：</li></ul> 
<table><thead><tr><th>参数名</th><th>必选</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>releaseTitle</td><td>true</td><td>String</td><td>此次发布的标题，长度不能超过64个字符</td></tr><tr><td>releaseComment</td><td>false</td><td>String</td><td>发布的备注，长度不能超过256个字符</td></tr><tr><td>releasedBy</td><td>true</td><td>String</td><td>发布人，域账号，注意：如果<code>ApolloConfigDB.ServerConfig</code>中的<code>namespace.lock.switch</code>设置为true的话（默认是false），那么该环境不允许发布人和编辑人为同一人。所以如果编辑人是zhanglea，发布人就不能再是zhanglea。</td></tr></tbody></table> 
<ul><li><strong>Request Body example</strong> ：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"releaseTitle"</span><span class="token punctuation">:</span><span class="token string">"2016-08-11"</span><span class="token punctuation">,</span>
    <span class="token string">"releaseComment"</span><span class="token punctuation">:</span><span class="token string">"修改timeout值"</span><span class="token punctuation">,</span>
    <span class="token string">"releasedBy"</span><span class="token punctuation">:</span><span class="token string">"zhanglea"</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>返回值Sample</strong> ：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"test-0620-01"</span><span class="token punctuation">,</span>
    <span class="token string">"clusterName"</span><span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
    <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11"</span><span class="token punctuation">,</span>
    <span class="token string">"configurations"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"timeout"</span><span class="token punctuation">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"修改timeout值"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T14:03:46.232+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T14:03:46.235+0800"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3210_Namespace_395"></a>3.2.10 获取某个Namespace当前生效的已发布配置接口</h6> 
<ul><li><strong>URL</strong> ： http://{portal_address}/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/latest</li><li><strong>Method</strong> ： GET</li><li><strong>Request Params</strong> ：无</li><li><strong>返回值Sample</strong> ：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"appId"</span><span class="token punctuation">:</span> <span class="token string">"test-0620-01"</span><span class="token punctuation">,</span>
    <span class="token string">"clusterName"</span><span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
    <span class="token string">"namespaceName"</span><span class="token punctuation">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11"</span><span class="token punctuation">,</span>
    <span class="token string">"configurations"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"timeout"</span><span class="token punctuation">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">"修改timeout值"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedBy"</span><span class="token punctuation">:</span> <span class="token string">"zhanglea"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeCreatedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T14:03:46.232+0800"</span><span class="token punctuation">,</span>
    <span class="token string">"dataChangeLastModifiedTime"</span><span class="token punctuation">:</span> <span class="token string">"2016-08-11T14:03:46.235+0800"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_419"></a>四、错误码说明</h4> 
<p>正常情况下，接口返回的Http状态码是200，下面列举了Apollo会返回的非200错误码说明。</p> 
<h5><a id="41_400__Bad_Request_423"></a>4.1 400 - Bad Request</h5> 
<p>客户端传入参数的错误，如操作人不存在，namespace不存在等等，客户端需要根据提示信息检查对应的参数是否正确。</p> 
<h5><a id="42_401__Unauthorized_427"></a>4.2 401 - Unauthorized</h5> 
<p>接口传入的token非法或者已过期，客户端需要检查token是否传入正确。</p> 
<h5><a id="43_403__Forbidden_431"></a>4.3 403 - Forbidden</h5> 
<p>接口要访问的资源未得到授权，比如只授权了对A应用下Namespace的管理权限，但是却尝试管理B应用下的配置。</p> 
<h5><a id="43_404__Not_Found_435"></a>4.3 404 - Not Found</h5> 
<p>接口要访问的资源不存在，一般是URL或URL的参数错误。</p> 
<h5><a id="44_405__Method_Not_Allowed_439"></a>4.4 405 - Method Not Allowed</h5> 
<p>接口访问的Method不正确，比如应该使用POST的接口使用了GET访问等，客户端需要检查接口访问方式是否正确。</p> 
<h5><a id="44_500__Internal_Server_Error_443"></a>4.4 500 - Internal Server Error</h5> 
<p>其它类型的错误默认都会返回500，对这类错误如果应用无法根据提示信息找到原因的话，可以找Apollo研发团队一起排查问题。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5556ed995746228e6f0402ded32e8581/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VS2019出现&#34;LPWSTR&#34; 类型的值不能用于初始化 &#34;char *&#34; 类型的实体</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6cf453388fc6e182198bc9f5620264ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript进阶之浏览器Event-Loop</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>