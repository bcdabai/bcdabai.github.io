<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>技术分析之基于Python实现MA、MACD - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="技术分析之基于Python实现MA、MACD" />
<meta property="og:description" content="使用Tushare获得一只股票，这里只供参考，不做投资建议。
stock_name = &#39;600519.SH&#39; ts.set_token(&#39;**********&#39;) pro = ts.pro_api() df_whole = pro.daily(ts_code=stock_name, start_data=&#39;20200501&#39;, end_data=&#39;20200507&#39;) df_whole[&#39;trade_date&#39;] = pd.to_datetime(df_whole[&#39;trade_date&#39;], format=&#39;%Y%m%d&#39;) df_whole.set_index(&#39;trade_date&#39;, inplace=True) df_whole = df_whole[1:300] df_whole = df_whole.sort_index(ascending=True) 首先MA(Moving Average)是一个移动平均线，类似于一个低通滤波器。在MACD计算过程中，MA取值取值区间为12，26。也就是说将一只股票的收盘价作为时间序列，去取12天作为一个区间，计算这12天内股票收盘价的一个加权平均数，同理26天类似。我认为，12天的MA可以等价于快线，而26天MA可以等价于慢线。下面展示12天、26天MA的计算方式。
df = df_whole[&#39;close&#39;] df_whole[&#39;EMA_12_unadj&#39;] = pd.Series.ewm(df, span=12, adjust=False).mean() df_whole[&#39;EMA_26_unadj&#39;] = pd.Series.ewm(df, span=26, adjust=False).mean() 这两条MA的差值我定义为MACD，将所得结果取3日指数平均得到信号线，代码如下所示：
MACD = df_whole[&#39;EMA_12_unadj&#39;] - df_whole[&#39;EMA_26_unadj&#39;] df_whole[&#39;MACD&#39;] = MACD df_whole[&#39;Signal_line&#39;] = pd.Series.ewm(MACD, span=3, adjust=False).mean() 取MACD与Signal-line的插值作为histogram，代码如下：
histogram = df_whole[&#39;MACD&#39;] - df_whole[&#39;Signal_line&#39;] df_whole[&#39;Histogram&#39;] = histogram 接下来对所获得的数据绘图，如下所示：
ax1 = plt.subplot2grid((9,10), (0, 0), rowspan=7, colspan=10) ax2 = plt." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3fc38bacf2c6131fce6a86ea7e9b9222/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-24T16:07:39+08:00" />
<meta property="article:modified_time" content="2021-05-24T16:07:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">技术分析之基于Python实现MA、MACD</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>使用Tushare获得一只股票，这里只供参考，不做投资建议。</p> 
<pre><code class="prism language-python">stock_name <span class="token operator">=</span> <span class="token string">'600519.SH'</span>

ts<span class="token punctuation">.</span>set_token<span class="token punctuation">(</span><span class="token string">'**********'</span><span class="token punctuation">)</span>
pro <span class="token operator">=</span> ts<span class="token punctuation">.</span>pro_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_whole <span class="token operator">=</span> pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>stock_name<span class="token punctuation">,</span> start_data<span class="token operator">=</span><span class="token string">'20200501'</span><span class="token punctuation">,</span> end_data<span class="token operator">=</span><span class="token string">'20200507'</span><span class="token punctuation">)</span>
df_whole<span class="token punctuation">[</span><span class="token string">'trade_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df_whole<span class="token punctuation">[</span><span class="token string">'trade_date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span>

df_whole<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'trade_date'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df_whole <span class="token operator">=</span> df_whole<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">]</span>
df_whole <span class="token operator">=</span> df_whole<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>首先MA(Moving Average)是一个移动平均线，类似于一个低通滤波器。在MACD计算过程中，MA取值取值区间为12，26。也就是说将一只股票的收盘价作为时间序列，去取12天作为一个区间，计算这12天内股票收盘价的一个加权平均数，同理26天类似。我认为，12天的MA可以等价于快线，而26天MA可以等价于慢线。下面展示12天、26天MA的计算方式。</p> 
<pre><code>df = df_whole['close']
df_whole['EMA_12_unadj'] = pd.Series.ewm(df, span=12, adjust=False).mean()
df_whole['EMA_26_unadj'] = pd.Series.ewm(df, span=26, adjust=False).mean()
</code></pre> 
<p>这两条MA的差值我定义为MACD，将所得结果取3日指数平均得到信号线，代码如下所示：</p> 
<pre><code class="prism language-python">MACD <span class="token operator">=</span> df_whole<span class="token punctuation">[</span><span class="token string">'EMA_12_unadj'</span><span class="token punctuation">]</span> <span class="token operator">-</span> df_whole<span class="token punctuation">[</span><span class="token string">'EMA_26_unadj'</span><span class="token punctuation">]</span>
df_whole<span class="token punctuation">[</span><span class="token string">'MACD'</span><span class="token punctuation">]</span> <span class="token operator">=</span> MACD

df_whole<span class="token punctuation">[</span><span class="token string">'Signal_line'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">.</span>ewm<span class="token punctuation">(</span>MACD<span class="token punctuation">,</span> span<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> adjust<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>取MACD与Signal-line的插值作为histogram，代码如下：</p> 
<pre><code class="prism language-python">histogram <span class="token operator">=</span> df_whole<span class="token punctuation">[</span><span class="token string">'MACD'</span><span class="token punctuation">]</span> <span class="token operator">-</span> df_whole<span class="token punctuation">[</span><span class="token string">'Signal_line'</span><span class="token punctuation">]</span>
df_whole<span class="token punctuation">[</span><span class="token string">'Histogram'</span><span class="token punctuation">]</span> <span class="token operator">=</span> histogram
</code></pre> 
<p>接下来对所获得的数据绘图，如下所示：</p> 
<pre><code class="prism language-python">ax1 <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot2grid<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rowspan<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> colspan<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
ax2 <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot2grid<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rowspan<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> colspan<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> sharex<span class="token operator">=</span>ax1<span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df_whole<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df_whole<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Close Price'</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df_whole<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df_whole<span class="token punctuation">[</span><span class="token string">'EMA_12_unadj'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'EMA-12'</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df_whole<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df_whole<span class="token punctuation">[</span><span class="token string">'EMA_26_unadj'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'EMA-26'</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>

ax2<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>df_whole<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df_whole<span class="token punctuation">[</span><span class="token string">'Histogram'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Histogram'</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df_whole<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df_whole<span class="token punctuation">[</span><span class="token string">'Signal_line'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Signal Line'</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9d/c9/z9BAINyN_o.png" alt="自定义MACD"><br> 我认为当12日MA下穿26日MA时，说明近期收盘价下跌较多，可以做空；反之当12日MA上穿26日MA时，说明近期收盘价上涨较快，可以做多。</p> 
<p>关于Histogram，我认为可以说明近期股票收盘价上涨的动能。首先我们通过两条MA的差值得到MACD，最后取MACD当日值与MACD的3日平均值做差得到histogr。假设一只股票最近上涨动能不足，趋近于最高点，那么12日MA和26日MA之间的差值将会减小，也就是说当日MACD的值会减小，这时需要注意到MACD的3日均值应该大于当日MACD值，所以histogram的值应该由正转为负，此时说明做空势力大与做多势力。<br> <img src="https://images2.imgbox.com/16/ab/f3OYKIVY_o.png" alt="histogram"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/346dc60ae1cf917031420a17563b994c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QCustomplot之安装篇（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7fc6f51e7b5c64f2909ebe99baa87fda/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构与算法--二叉树之线索二叉树（前序、中序、后序）思路以及代码实现。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>