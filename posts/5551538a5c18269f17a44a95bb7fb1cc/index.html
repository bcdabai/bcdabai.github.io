<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Swagger @ApiModelProperty 绑定枚举类 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Swagger @ApiModelProperty 绑定枚举类" />
<meta property="og:description" content="先看效果 1.自定义注解 import java.lang.annotation.ElementType; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; import java.lang.annotation.Target; /** * @description: swagger 属性绑定 枚举对象注解 * @author guyi * @date 2023/11/24 9:53 **/ @Target({ElementType.FIELD}) @Retention(RetentionPolicy.RUNTIME) public @interface ApiModelPropertyEnum { Class value(); } 2.实现Swagger 的 ModelPropertyBuilderPlugin 接口 import com.fasterxml.classmate.ResolvedType; import com.fasterxml.classmate.TypeResolver; import com.fasterxml.jackson.databind.introspect.BeanPropertyDefinition; import io.swagger.annotations.ApiModelProperty; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.core.annotation.Order; import org.springframework.stereotype.Component; import springfox.documentation.schema.Annotations; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spi.schema.ModelPropertyBuilderPlugin; import springfox.documentation.spi.schema.contexts.ModelPropertyContext; import springfox.documentation.spring.web.DescriptionResolver; import springfox.documentation.swagger.common.SwaggerPluginSupport; import springfox.documentation.swagger.schema.ApiModelProperties; import java.lang.reflect.*; import java.util.Map; import java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5551538a5c18269f17a44a95bb7fb1cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-24T15:38:29+08:00" />
<meta property="article:modified_time" content="2023-11-24T15:38:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Swagger @ApiModelProperty 绑定枚举类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h6>先看效果</h6> 
<p><img alt="" height="801" src="https://images2.imgbox.com/53/43/Bn3Q5nqu_o.png" width="1200"></p> 
<h3>1.自定义注解</h3> 
<pre><code class="language-java">import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * @description:  swagger 属性绑定 枚举对象注解
 * @author guyi
 * @date 2023/11/24 9:53
 **/
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
public @interface ApiModelPropertyEnum {
    Class value();
}</code></pre> 
<p></p> 
<h3>2.实现Swagger 的 ModelPropertyBuilderPlugin 接口</h3> 
<pre><code class="language-java">
import com.fasterxml.classmate.ResolvedType;
import com.fasterxml.classmate.TypeResolver;
import com.fasterxml.jackson.databind.introspect.BeanPropertyDefinition;
import io.swagger.annotations.ApiModelProperty;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;
import springfox.documentation.schema.Annotations;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.schema.ModelPropertyBuilderPlugin;
import springfox.documentation.spi.schema.contexts.ModelPropertyContext;
import springfox.documentation.spring.web.DescriptionResolver;
import springfox.documentation.swagger.common.SwaggerPluginSupport;
import springfox.documentation.swagger.schema.ApiModelProperties;

import java.lang.reflect.*;
import java.util.Map;
import java.util.Optional;

/**
 * @Description: 自定义 Swagger 属性绑定
 * @Author: guyi
 * @Date: 2023-11-24 09:58
 **/
@Component
@Order(-2147482648)
public class MyModelPropertyBuilderPlugin implements ModelPropertyBuilderPlugin {

    private final DescriptionResolver descriptions;

    @Autowired
    public MyModelPropertyBuilderPlugin(DescriptionResolver descriptions) {
        this.descriptions = descriptions;
    }

    @Override
    public void apply(ModelPropertyContext context) {
        Optional&lt;ApiModelProperty&gt; annotation = Optional.empty();
        if (context.getAnnotatedElement().isPresent()) {
            annotation = (Optional) annotation.map(Optional::of).orElse(ApiModelProperties.findApiModePropertyAnnotation((AnnotatedElement) context.getAnnotatedElement().get()));
        }

        if (context.getBeanPropertyDefinition().isPresent()) {
            annotation = (Optional) annotation.map(Optional::of).orElse(Annotations.findPropertyAnnotation((BeanPropertyDefinition) context.getBeanPropertyDefinition().get(), ApiModelProperty.class));
        }

        if (annotation.isPresent()) {
            ApiModelProperty apiModelProperty = annotation.get();
            ApiModelPropertyEnum apiModelPropertyEnum = context.getBeanPropertyDefinition().get().getField().getAnnotation(ApiModelPropertyEnum.class);
            try {
                StringBuilder stringBuilder = null;
                if (apiModelPropertyEnum != null &amp;&amp; !apiModelProperty.value().contains("(")) {
                    InvocationHandler invocationHandler = Proxy.getInvocationHandler(apiModelProperty);
                    Field memberValues = invocationHandler.getClass().getDeclaredField("memberValues");
                    memberValues.setAccessible(true);
                    Map o = (Map) memberValues.get(invocationHandler);
                    Class&lt;?&gt; aClass = apiModelPropertyEnum.value();
                    Object[] enumConstants = aClass.getEnumConstants();
                    stringBuilder = new StringBuilder();
                    stringBuilder.append(apiModelProperty.value());
                    stringBuilder.append("(");
                    for (Object enumConstant : enumConstants) {
                        Method[] declaredMethods = aClass.getDeclaredMethods();
                        for (Method declaredMethod : declaredMethods) {
                            String name = declaredMethod.getName();
                            if (name.equals("values") || name.equals("valueOf")) {
                                continue;
                            }
                            stringBuilder.append(declaredMethod.invoke(enumConstant));
                            stringBuilder.append(":");
                        }
                        stringBuilder.delete(stringBuilder.length() - 1, stringBuilder.length());
                        stringBuilder.append(",");
                    }
                    stringBuilder.delete(stringBuilder.length() - 1, stringBuilder.length());
                    stringBuilder.append(")");
                    o.put("value", stringBuilder.toString());
                }
                context.getBuilder()
                        .allowableValues(apiModelProperty.allowableValues() == null ? null : ApiModelProperties.allowableValueFromString(apiModelProperty.allowableValues()))
                        .required(apiModelProperty.required())
                        .readOnly(apiModelProperty.readOnly())
                        .description(stringBuilder == null ? null : stringBuilder.toString())
                        .isHidden(apiModelProperty.hidden())
                        .type(resolve(context.getResolver(), apiModelProperty))
                        .position(apiModelProperty.position());
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

    public ResolvedType resolve(TypeResolver resolver, ApiModelProperty apiModelProperty) {
        try {
            return resolver.resolve(Class.forName(apiModelProperty.dataType()), new Type[0]);
        } catch (ClassNotFoundException e) {
            return resolver.resolve(Object.class, new Type[0]);
        }

    }

    @Override
    public boolean supports(DocumentationType delimiter) {
        return SwaggerPluginSupport.pluginDoesApply(delimiter);
    }
}
</code></pre> 
<p></p> 
<h3>3.定义枚举对象</h3> 
<pre><code class="language-java">import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * @Description: 通用枚举类，把所有枚举类都写到一起
 * @Author: guyi
 * @Date: 2023-11-24 14:00
 **/
public final class ComEnum {



    /**
     *  通用字典表-是否(0-否，1-是)
     */
    @Getter
    @AllArgsConstructor
    public enum YESORNO {
        NO("0","否"),
        YES("1","是");

        private final String value;
        private final String label;
    }



    /**
     *  荣誉获奖表--获奖级别(1-国家级、2-省级、3-市级、4-区级、5-校级)
     */
    @Getter
    @AllArgsConstructor
    public enum AwardsHistoryLevel {
        NATION("1","国家级"),
//        PROVINCE("2","省级"),
        CITY("3","市级"),
        AREA("4","区级"),
        SCHOOL("5","校级");

        private final String value;
        private final String label;
    }
    

}</code></pre> 
<h3>4.注解使用</h3> 
<pre><code class="language-java">	/**获奖级别*/
    @ApiModelProperty(value = "获奖级别")
    @ApiModelPropertyEnum(value = ComEnum.AwardsHistoryLevel.class)
    private String level;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd09d7b19d7078d9ef58c13b68b3e58f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NFS3 升级为nfs4</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1cd5136b6024cc1616d292f58531c5b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端学习（应对面试）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>