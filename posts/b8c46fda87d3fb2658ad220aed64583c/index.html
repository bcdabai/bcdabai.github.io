<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3 &#43; vite 在线预览docx, pdf, pptx（内外网）并实现移动端适配 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3 &#43; vite 在线预览docx, pdf, pptx（内外网）并实现移动端适配" />
<meta property="og:description" content="一、内网 1.docx 使用docx-preview
安装插件
npm i docx-preview -S 引入依赖
// docx import { renderAsync } from &#34;docx-preview&#34;; let docx = import.meta.glob(&#34;docx-preview&#34;); // vite不支持require &lt;div ref=&#34;docxDiv&#34; class=&#34;docxDiv&#34; v-if=&#34;[&#39;docx&#39;].includes(detailItem.fileType)&#34; v-loading=&#34;loading&#34; &gt;&lt;/div&gt; //js部分 detailItem.value为当前文件的数据对象 const previewfile = () =&gt; { loading.value = true; fetch(detailItem.value.filePath) .then((response) =&gt; { let docData = response.blob(); let docxDiv= document.getElementsByClassName(&#34;docxDiv&#34;); renderAsync(docData, docxDiv[0], null, { inWrapper: true, // 启用围绕文档内容渲染包装器 ignoreWidth: false, // 禁止页面渲染宽度 ignoreHeight: false, // 禁止页面渲染高度 ignoreFonts: false, // 禁止字体渲染 breakPages: true, // 在分页符上启用分页 ignoreLastRenderedPageBreak: true, //禁用lastRenderedPageBreak元素的分页 experimental: false, //启用实验性功能（制表符停止计算） trimXmlDeclaration: true, //如果为真，xml声明将在解析之前从xml文档中删除 debug: false, })." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b8c46fda87d3fb2658ad220aed64583c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-15T16:52:52+08:00" />
<meta property="article:modified_time" content="2023-06-15T16:52:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3 &#43; vite 在线预览docx, pdf, pptx（内外网）并实现移动端适配</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、内网</h2> 
<h3>1.docx</h3> 
<p>使用docx-preview</p> 
<p>  安装插件</p> 
<pre><code>npm i docx-preview -S</code></pre> 
<p> 引入依赖</p> 
<pre><code>// docx
import { renderAsync } from "docx-preview";
let docx = import.meta.glob("docx-preview"); // vite不支持require </code></pre> 
<p>  </p> 
<pre><code>&lt;div
 ref="docxDiv"
 class="docxDiv"
 v-if="['docx'].includes(detailItem.fileType)"
 v-loading="loading"
&gt;&lt;/div&gt;

//js部分 detailItem.value为当前文件的数据对象
const previewfile = () =&gt; {
  loading.value = true;
  fetch(detailItem.value.filePath)
    .then((response) =&gt; {
      let docData = response.blob();
      let docxDiv= document.getElementsByClassName("docxDiv");
      renderAsync(docData, docxDiv[0], null, {
        inWrapper: true, // 启用围绕文档内容渲染包装器
        ignoreWidth: false, // 禁止页面渲染宽度
        ignoreHeight: false, // 禁止页面渲染高度
        ignoreFonts: false, // 禁止字体渲染
        breakPages: true, // 在分页符上启用分页
        ignoreLastRenderedPageBreak: true, //禁用lastRenderedPageBreak元素的分页
        experimental: false, //启用实验性功能（制表符停止计算）
        trimXmlDeclaration: true, //如果为真，xml声明将在解析之前从xml文档中删除
        debug: false,
      }).then((res) =&gt; {
        loading.value = false;
      });
    })
    .catch((error) =&gt; {
      console.log(error);
    });
};</code></pre> 
<h3>2.pdf</h3> 
<p>使用vue3-pdf-app</p> 
<p>  安装插件</p> 
<pre><code>npm install vue3-pdf-app</code></pre> 
<p>  引入依赖</p> 
<pre><code>// pdf
import VuePdfApp from "vue3-pdf-app";
import "vue3-pdf-app/dist/icons/main.css";</code></pre> 
<p>  使用方法非常简单</p> 
<pre><code>// detailItem.filePath为文件路径
&lt;vue-pdf-app style="height: 100vh; width: 100vw" :pdf="detailItem.filePath"&gt;&lt;/vue-pdf-app&gt;</code></pre> 
<h3>3.pptx</h3> 
<p>使用pptx.js</p> 
<p>首先需要下载pptx的文件</p> 
<p>github: </p> 
<p><a class="link-info has-card" href="https://github.com/meshesha/PPTXjs" title="pptx"><span class="link-card-box"><span class="link-title">pptx</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/f8/c8/duQ2fcSp_o.png">https://github.com/meshesha/PPTXjs</span></span></a></p> 
<p>官网地址：<a class="has-card" href="https://pptx.js.org/" rel="nofollow" title="PPTXjs"><span class="link-card-box"><span class="link-title">PPTXjs</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/76/0a/CBbTUHbs_o.png">https://pptx.js.org/</span></span></a></p> 
<p>下载完成后放到public下的lib文件夹中, 然后在index.html中引入</p> 
<pre><code>    &lt;link rel="stylesheet" href="/lib/css/pptxjs.css"&gt;
    &lt;link rel="stylesheet" href="/lib/css/nv.d3.min.css"&gt; &lt;!-- for charts graphs --&gt;
    &lt;script type="text/javascript" src="/lib/js/jquery-1.11.3.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="/lib/js/jszip.min.js"&gt;&lt;/script&gt; &lt;!-- v2.. , NOT v.3.. --&gt;
    &lt;script type="text/javascript" src="/lib/js/filereader.js"&gt;&lt;/script&gt; &lt;!--https://github.com/meshesha/filereader.js --&gt;
    &lt;script type="text/javascript" src="/lib/js/d3.min.js"&gt;&lt;/script&gt; &lt;!-- for charts graphs --&gt;
    &lt;script type="text/javascript" src="/lib/js/nv.d3.min.js"&gt;&lt;/script&gt; &lt;!-- for charts graphs --&gt;
    &lt;script type="text/javascript" src="/lib/js/dingbat.js"&gt;&lt;/script&gt; &lt;!--for bullets --&gt;
    &lt;script type="text/javascript" src="/lib/js/pptxjs.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="/lib/js/divs2slides.js"&gt;&lt;/script&gt; &lt;!-- for slide show --&gt;</code></pre> 
<p>使用：</p> 
<pre><code>&lt;div id="pptx" v-if="detailItem.fileType === 'pptx'"&gt;&lt;/div&gt;

// js部分 jquery已在index.html中引入 无需另外安装
const handlePPtx = () =&gt; {
  $("#pptx").pptxToHtml({ 
      pptxFileUrl: detailItem.value.filePath, //pptx文件地址
      slidesScale: "100%", 
  });
}</code></pre> 
<h2>二、外网（文件地址须在公网环境下）</h2> 
<h3>调用<a class="link-info" href="https://view.xdocin.com/" rel="nofollow" title="XDOC">XDOC</a>的服务</h3> 
<pre><code>&lt;iframe :src="'https://view.xdocin.com/view?src=https://test-jpfile1.oss-cn-shenzhen.aliyuncs.com//Bom/bom/2022/1/19/2022011911370824626513.pdf'"&gt;&lt;/iframe&gt;</code></pre> 
<h2>三、移动端适配</h2> 
<p>vue3-pdf-app会自动适配 ， 主要是docx和pptx的适配问题</p> 
<p>docx : 在文档加载完成后 进行页面的缩放</p> 
<pre><code class="hljs">renderAsync(docData, childRef[0], null, {
        inWrapper: true, // 启用围绕文档内容渲染包装器
        ignoreWidth: false, // 禁止页面渲染宽度
        ignoreHeight: false, // 禁止页面渲染高度
        ignoreFonts: false, // 禁止字体渲染
        breakPages: true, // 在分页符上启用分页
        ignoreLastRenderedPageBreak: true, //禁用lastRenderedPageBreak元素的分页
        experimental: false, //启用实验性功能（制表符停止计算）
        trimXmlDeclaration: true, //如果为真，xml声明将在解析之前从xml文档中删除
        debug: false,
      }).then((res) =&gt; {
        loading.value = false;
        console.log("res----&gt;", res);
        let timer = setInterval(() =&gt; {
          const $slides = $(".docx-wrapper");
          if ($slides.children().length) {
            const slidesWidth = Math.max(
              ...Array.from($slides.children()).map((s) =&gt; s.offsetWidth)
            );
            const $wrapper = $("#docRef");
            const wrapperWidth = window.innerWidth;
            const wrapperHeight = window.innerHeight;
            $wrapper.css({
              transform: `scale(${wrapperWidth / slidesWidth})`,
              "transform-origin": "top left",
              height: wrapperHeight * (1 / (wrapperWidth / slidesWidth)) + "px",
            });
            clearInterval(timer);
          }
        }, 100);</code></pre> 
<p>pptx: 跟doc同样的问题</p> 
<pre><code class="hljs">await $("#pptx").pptxToHtml({
    pptxFileUrl: "/api" + detailItem.value.filePath, //pptx文件地址
    slidesScale: "100%",
    slideMode: false,
    keyBoardShortCut: false,
  });
  let timer = setInterval(() =&gt; {
    const $slides = $(".slides");
    if ($slides.children().length) {
      const slidesWidth = Math.max(
        ...Array.from($slides.children()).map((s) =&gt; s.offsetWidth)
      );
      const $wrapper = $("#pptx");
      const wrapperWidth = window.innerWidth;
      const wrapperHeight = window.innerHeight;
      $wrapper.css({
        transform: `scale(${wrapperWidth / slidesWidth})`,
        "transform-origin": "top left",
        height: wrapperHeight * (1 / (wrapperWidth / slidesWidth)) + "px",
      });
      clearInterval(timer);
    }
  }, 100);</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b143380b1f99afe6a91d2c72e63334b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">渗透测试之信息收集篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ce5559d5a1b6b8b61bf3d0a5998a023/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Java】类和对象详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>