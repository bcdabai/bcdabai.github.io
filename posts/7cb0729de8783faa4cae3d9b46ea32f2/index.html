<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot&#43;shiro&#43;mybatis实现角色权限控制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot&#43;shiro&#43;mybatis实现角色权限控制" />
<meta property="og:description" content="背景 spring&#43;spirngmvc&#43;shiro的整合已经有很多了，之前的项目中也用过，但是最近想在springboot中使用shiro这样，其他项目需要的时候只需要把它依赖进来就可以直接使用，至于shiro的原理其他的blog都有很多介绍。这里只讲几个重点在项目中注意的地方。 shiro官网 http://shiro.apache.org/
shiro配置中重要的几个文件 其实最重要的就是shiro配置文件 ShiroConfiguration.java：shiro启动时候的初始化工作，比如哪些是需要认证，哪些不需要认证；缓存配置设置；shiro权限数据在页面展示时整合需要的模板套件配置，等等。
ShiroRealm.java：shiro权限认证的具体实现代码，因为shiro本身只提供拦截路由，而具体如何数据源则由用户自己提供，不同的项目不同的要求，要不要加缓存登陆验证次数，要不要密码加密设置其他具体方式，这些都由用户自己决定，而shiro只提供给用户权限验证的格式接口，通过用户提供的数据源shrio判断要不要给具体用户授权请求路径的判断。 ShiroRealm 涉及到以下点： principal:主体，就是登陆的当前用户类型的数据实体 credentials：凭证，用户的密码，具体加密方式用户自己实现，什么都不做就是原文
Roles：用户拥有的角色标识（角色名称，admin,account,customer_service），字符串格式列表:用户拥有多个角色的可能Permissions：用户拥有的权限标识（每个权限唯一标识，比如主键或者权限唯一标识编码），字符串格式列表：用户拥有多个权限的可能 pom 在springboot&#43;mybatis基础上加入shiro依赖
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.xm.shiro&lt;/groupId&gt; &lt;artifactId&gt;springboot-shiro&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;springboot-shiro&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;repositories&gt;&lt;!--ali 代码库 --&gt; &lt;repository&gt; &lt;id&gt;maven-ali&lt;/id&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;updatePolicy&gt;always&lt;/updatePolicy&gt; &lt;checksumPolicy&gt;fail&lt;/checksumPolicy&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;!-- Spring Boot 启动父依赖 --&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.1.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;mybatis-spring-boot&gt;1.2.0&lt;/mybatis-spring-boot&gt; &lt;mysql-connector&gt;5.1.39&lt;/mysql-connector&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- Spring Boot Web 依赖 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Spring Boot Test 依赖 --&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7cb0729de8783faa4cae3d9b46ea32f2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-11T11:41:51+08:00" />
<meta property="article:modified_time" content="2017-05-11T11:41:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot&#43;shiro&#43;mybatis实现角色权限控制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="背景">背景</h2> 
<p>spring+spirngmvc+shiro的整合已经有很多了，之前的项目中也用过，但是最近想在springboot中使用shiro这样，其他项目需要的时候只需要把它依赖进来就可以直接使用，至于shiro的原理其他的blog都有很多介绍。这里只讲几个重点在项目中注意的地方。 <br> shiro官网 <br> <a href="http://shiro.apache.org/" rel="nofollow">http://shiro.apache.org/</a></p> 
<h2 id="shiro配置中重要的几个文件">shiro配置中重要的几个文件</h2> 
<p><img src="https://images2.imgbox.com/2a/10/4qzu5RsR_o.png" alt="这里写图片描述" title=""></p> 
<p>其实最重要的就是shiro配置文件 <br> ShiroConfiguration.java：shiro启动时候的初始化工作，比如哪些是需要认证，哪些不需要认证；缓存配置设置；shiro权限数据在页面展示时整合需要的模板套件配置，等等。</p> 
<p>ShiroRealm.java：shiro权限认证的具体实现代码，因为shiro本身只提供拦截路由，而具体如何数据源则由用户自己提供，不同的项目不同的要求，要不要加缓存登陆验证次数，要不要密码加密设置其他具体方式，这些都由用户自己决定，而shiro只提供给用户权限验证的格式接口，通过用户提供的数据源shrio判断要不要给具体用户授权请求路径的判断。 <br> ShiroRealm 涉及到以下点： <br> principal:主体，就是登陆的当前用户类型的数据实体 <br> credentials：凭证，用户的密码，具体加密方式用户自己实现，什么都不做就是原文</p> 
<ul><li>Roles：用户拥有的角色标识（角色名称，admin,account,customer_service），字符串格式列表:用户拥有多个角色的可能</li><li>Permissions：用户拥有的权限标识（每个权限唯一标识，比如主键或者权限唯一标识编码），字符串格式列表：用户拥有多个权限的可能</li></ul> 
<h2 id="pom">pom</h2> 
<p>在springboot+mybatis基础上加入shiro依赖</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">project</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">modelVersion</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.xm.shiro<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>springboot-shiro<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-title">packaging</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>springboot-shiro<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">url</span>&gt;</span>http://maven.apache.org<span class="hljs-tag">&lt;/<span class="hljs-title">url</span>&gt;</span>


    <span class="hljs-tag">&lt;<span class="hljs-title">repositories</span>&gt;</span><span class="hljs-comment">&lt;!--ali 代码库 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">repository</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>maven-ali<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-title">url</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">releases</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">enabled</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">releases</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">snapshots</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">enabled</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-title">updatePolicy</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">checksumPolicy</span>&gt;</span>fail<span class="hljs-tag">&lt;/<span class="hljs-title">checksumPolicy</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">snapshots</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">repository</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">repositories</span>&gt;</span>



    <span class="hljs-comment">&lt;!-- Spring Boot 启动父依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.5.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">mybatis-spring-boot</span>&gt;</span>1.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">mybatis-spring-boot</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">mysql-connector</span>&gt;</span>5.1.39<span class="hljs-tag">&lt;/<span class="hljs-title">mysql-connector</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Spring Boot Web 依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Spring Boot Test 依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Spring Boot Mybatis 依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${mybatis-spring-boot}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- MySQL 连接驱动依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${mysql-connector}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

         <span class="hljs-comment">&lt;!-- shiro相关 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.2.5<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>shiro-ehcache<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.2.5<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>


    <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-title">project</span>&gt;</span>
</code></pre> 
<h2 id="表结构">表结构</h2> 
<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-comment">/*
Navicat MySQL Data Transfer

Source Server         : local
Source Server Version : 50553
Source Host           : localhost:3306
Source Database       : springboot_shiro

Target Server Type    : MYSQL
Target Server Version : 50553
File Encoding         : 65001

Date: 2017-05-10 20:40:01
*/</span>

<span class="hljs-operator"><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="hljs-number">0</span>;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Table structure for `u_permission`</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`u_permission`</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`u_permission`</span> (
  <span class="hljs-string">`id`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  <span class="hljs-string">`url`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'url地址'</span>,
  <span class="hljs-string">`name`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'url描述'</span>,
  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">21</span> <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Records of u_permission</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`u_permission`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'/user'</span>, <span class="hljs-string">'usermanager'</span>);</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Table structure for `u_role`</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`u_role`</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`u_role`</span> (
  <span class="hljs-string">`id`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  <span class="hljs-string">`name`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'角色名称'</span>,
  <span class="hljs-string">`type`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'角色类型'</span>,
  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">5</span> <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Records of u_role</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`u_role`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'admin'</span>, <span class="hljs-string">'1'</span>);</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Table structure for `u_role_permission`</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`u_role_permission`</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`u_role_permission`</span> (
  <span class="hljs-string">`rid`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'角色ID'</span>,
  <span class="hljs-string">`pid`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'权限ID'</span>
) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Records of u_role_permission</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`u_role_permission`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'1'</span>);</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Table structure for `u_user`</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`u_user`</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`u_user`</span> (
  <span class="hljs-string">`id`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  <span class="hljs-string">`nickname`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户昵称'</span>,
  <span class="hljs-string">`email`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'邮箱|登录帐号'</span>,
  <span class="hljs-string">`pswd`</span> <span class="hljs-keyword">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'密码'</span>,
  <span class="hljs-string">`create_time`</span> datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-string">`last_login_time`</span> datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'最后登录时间'</span>,
  <span class="hljs-string">`status`</span> bigint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'1'</span> COMMENT <span class="hljs-string">'1:有效，0:禁止登录'</span>,
  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)
) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">15</span> <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Records of u_user</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`u_user`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'admin'</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">'123456'</span>, <span class="hljs-string">'2017-05-10 20:22:59'</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">'1'</span>);</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Table structure for `u_user_role`</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`u_user_role`</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`u_user_role`</span> (
  <span class="hljs-string">`uid`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  <span class="hljs-string">`rid`</span> bigint(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'角色ID'</span>
) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8;</span>

<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-comment">-- Records of u_user_role</span>
<span class="hljs-comment">-- ----------------------------</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`u_user_role`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'1'</span>);</span>
</code></pre> 
<h2 id="配置shiro相关文件">配置shiro相关文件</h2> 
<h3 id="shiroconfigurationjava">ShiroConfiguration.java</h3> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.xm.shiro.config;

<span class="hljs-keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;
<span class="hljs-keyword">import</span> org.apache.shiro.cache.ehcache.EhCacheManager;
<span class="hljs-keyword">import</span> org.apache.shiro.spring.LifecycleBeanPostProcessor;
<span class="hljs-keyword">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;
<span class="hljs-keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;
<span class="hljs-keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;
<span class="hljs-keyword">import</span> org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.DependsOn;

<span class="hljs-keyword">import</span> java.util.LinkedHashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-javadoc">/**
 * shiro配置项
 * Created by Lucare.Feng on 2017/3/6.
 */</span>
<span class="hljs-annotation">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfiguration</span> {<!-- --></span>

    <span class="hljs-annotation">@Bean</span>(name = <span class="hljs-string">"lifecycleBeanPostProcessor"</span>)
    <span class="hljs-keyword">public</span> LifecycleBeanPostProcessor <span class="hljs-title">lifecycleBeanPostProcessor</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LifecycleBeanPostProcessor();
    }

    <span class="hljs-comment">//处理认证匹配处理器：如果自定义需要实现继承HashedCredentialsMatcher</span>
    <span class="hljs-comment">//指定加密方式方式，也可以在这里加入缓存，当用户超过五次登陆错误就锁定该用户禁止不断尝试登陆</span>
<span class="hljs-comment">//    @Bean(name = "hashedCredentialsMatcher")</span>
<span class="hljs-comment">//    public HashedCredentialsMatcher hashedCredentialsMatcher() {<!-- --></span>
<span class="hljs-comment">//        HashedCredentialsMatcher credentialsMatcher = new HashedCredentialsMatcher();</span>
<span class="hljs-comment">//        credentialsMatcher.setHashAlgorithmName("MD5");</span>
<span class="hljs-comment">//        credentialsMatcher.setHashIterations(2);</span>
<span class="hljs-comment">//        credentialsMatcher.setStoredCredentialsHexEncoded(true);</span>
<span class="hljs-comment">//        return credentialsMatcher;</span>
<span class="hljs-comment">//    }</span>

    <span class="hljs-annotation">@Bean</span>(name = <span class="hljs-string">"shiroRealm"</span>)
    <span class="hljs-annotation">@DependsOn</span>(<span class="hljs-string">"lifecycleBeanPostProcessor"</span>)
    <span class="hljs-keyword">public</span> ShiroRealm <span class="hljs-title">shiroRealm</span>() {
        ShiroRealm realm = <span class="hljs-keyword">new</span> ShiroRealm();
<span class="hljs-comment">//        realm.setCredentialsMatcher(hashedCredentialsMatcher());</span>
        <span class="hljs-keyword">return</span> realm;
    }

    <span class="hljs-annotation">@Bean</span>(name = <span class="hljs-string">"ehCacheManager"</span>)
    <span class="hljs-annotation">@DependsOn</span>(<span class="hljs-string">"lifecycleBeanPostProcessor"</span>)
    <span class="hljs-keyword">public</span> EhCacheManager <span class="hljs-title">ehCacheManager</span>(){
        EhCacheManager ehCacheManager = <span class="hljs-keyword">new</span> EhCacheManager();
        <span class="hljs-keyword">return</span> ehCacheManager;
    }

    <span class="hljs-annotation">@Bean</span>(name = <span class="hljs-string">"securityManager"</span>)
    <span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title">securityManager</span>(){
        DefaultWebSecurityManager securityManager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();
        securityManager.setRealm(shiroRealm());
        securityManager.setCacheManager(ehCacheManager());<span class="hljs-comment">//用户授权/认证信息Cache, 采用EhCache 缓存</span>
        <span class="hljs-keyword">return</span> securityManager;
    }

    <span class="hljs-annotation">@Bean</span>(name = <span class="hljs-string">"shiroFilter"</span>)
    <span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title">shiroFilterFactoryBean</span>(DefaultWebSecurityManager  securityManager){
        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();
        shiroFilterFactoryBean.setSecurityManager(securityManager);

<span class="hljs-comment">//        Map&lt;String, Filter&gt; filters = new LinkedHashMap&lt;String, Filter&gt;();</span>
<span class="hljs-comment">//        LogoutFilter logoutFilter = new LogoutFilter();</span>
<span class="hljs-comment">//        logoutFilter.setRedirectUrl("/login");</span>
<span class="hljs-comment">//        filters.put("logout", logoutFilter);</span>
<span class="hljs-comment">//        shiroFilterFactoryBean.setFilters(filters);</span>
        System.out.println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>);
        Map&lt;String, String&gt; filterChainDefinitionManager = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();
        filterChainDefinitionManager.put(<span class="hljs-string">"/logout"</span>, <span class="hljs-string">"logout"</span>);
        filterChainDefinitionManager.put(<span class="hljs-string">"/user/**"</span>, <span class="hljs-string">"authc,roles[user]"</span>);
        filterChainDefinitionManager.put(<span class="hljs-string">"/shop/**"</span>, <span class="hljs-string">"authc,roles[shop]"</span>);
        filterChainDefinitionManager.put(<span class="hljs-string">"/admin/**"</span>, <span class="hljs-string">"authc,roles[admin]"</span>);
        filterChainDefinitionManager.put(<span class="hljs-string">"/login"</span>, <span class="hljs-string">"anon"</span>);<span class="hljs-comment">//anon 可以理解为不拦截</span>
        filterChainDefinitionManager.put(<span class="hljs-string">"/ajaxLogin"</span>, <span class="hljs-string">"anon"</span>);<span class="hljs-comment">//anon 可以理解为不拦截</span>
        filterChainDefinitionManager.put(<span class="hljs-string">"/statistic/**"</span>,  <span class="hljs-string">"anon"</span>);<span class="hljs-comment">//静态资源不拦截</span>
        filterChainDefinitionManager.put(<span class="hljs-string">"/**"</span>,  <span class="hljs-string">"authc,roles[user]"</span>);<span class="hljs-comment">//其他资源全部拦截</span>
        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionManager);

        shiroFilterFactoryBean.setLoginUrl(<span class="hljs-string">"/login"</span>);
        shiroFilterFactoryBean.setSuccessUrl(<span class="hljs-string">"/"</span>);
        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="hljs-string">"/403"</span>);

        <span class="hljs-keyword">return</span> shiroFilterFactoryBean;
    }

    <span class="hljs-annotation">@Bean</span>
    <span class="hljs-annotation">@ConditionalOnMissingBean</span>
    <span class="hljs-keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="hljs-title">defaultAdvisorAutoProxyCreator</span>() {
        DefaultAdvisorAutoProxyCreator daap = <span class="hljs-keyword">new</span> DefaultAdvisorAutoProxyCreator();
        daap.setProxyTargetClass(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">return</span> daap;
    }

    <span class="hljs-annotation">@Bean</span>
    <span class="hljs-keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="hljs-title">authorizationAttributeSourceAdvisor</span>(DefaultWebSecurityManager securityManager) {
        AuthorizationAttributeSourceAdvisor aasa = <span class="hljs-keyword">new</span> AuthorizationAttributeSourceAdvisor();
        aasa.setSecurityManager(securityManager);
        <span class="hljs-keyword">return</span> aasa;
    }

    <span class="hljs-comment">//thymeleaf模板引擎和shiro整合时使用</span>
    <span class="hljs-comment">/*@Bean(name = "shiroDialect")
    public ShiroDialect shiroDialect(){
        return new ShiroDialect();
    }*/</span>

}
</code></pre> 
<h3 id="shirorealmjava">ShiroRealm.java</h3> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.xm.shiro.config;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationException;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationToken;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;
<span class="hljs-keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;
<span class="hljs-keyword">import</span> org.apache.shiro.subject.PrincipalCollection;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;

<span class="hljs-keyword">import</span> com.xm.shiro.admin.dao.UPermissionDao;
<span class="hljs-keyword">import</span> com.xm.shiro.admin.dao.URoleDao;
<span class="hljs-keyword">import</span> com.xm.shiro.admin.dao.UUserDao;
<span class="hljs-keyword">import</span> com.xm.shiro.admin.entity.UPermission;
<span class="hljs-keyword">import</span> com.xm.shiro.admin.entity.URole;
<span class="hljs-keyword">import</span> com.xm.shiro.admin.entity.UUser;


<span class="hljs-javadoc">/**
 * 获取用户的角色和权限信息
 * Created by bamboo on 2017/5/10.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(ShiroRealm.class);

    <span class="hljs-comment">//一般这里都写的是servic，我省略了service的接口和实现方法直接调用的dao</span>
    <span class="hljs-annotation">@Autowired</span>
    <span class="hljs-keyword">private</span> UUserDao uUserDao;
    <span class="hljs-annotation">@Autowired</span>
    <span class="hljs-keyword">private</span> URoleDao uRoleDao;
    <span class="hljs-annotation">@Autowired</span>
    <span class="hljs-keyword">private</span> UPermissionDao uPermissionDao;

    <span class="hljs-javadoc">/**
     * 登录认证
     *
     *<span class="hljs-javadoctag"> @param</span> authenticationToken
     *<span class="hljs-javadoctag"> @return</span>
     *<span class="hljs-javadoctag"> @throws</span> AuthenticationException
     */</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span>(AuthenticationToken authenticationToken) <span class="hljs-keyword">throws</span> AuthenticationException {
        UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;
        logger.info(<span class="hljs-string">"验证当前Subject时获取到token为："</span> + token.toString());
        <span class="hljs-comment">//查出是否有此用户</span>
        UUser hasUser = uUserDao.findByName(token.getUsername());
<span class="hljs-comment">//        String md5Pwd = new Md5Hash("123", "lucare",2).toString();</span>
        <span class="hljs-keyword">if</span> (hasUser != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// 若存在，将此用户存放到登录认证info中，无需自己做密码对比，Shiro会为我们进行密码对比校验</span>
            List&lt;URole&gt; rlist = uRoleDao.findRoleByUid(hasUser.getId());<span class="hljs-comment">//获取用户角色</span>
            List&lt;UPermission&gt; plist = uPermissionDao.findPermissionByUid(hasUser.getId());<span class="hljs-comment">//获取用户权限</span>
            List&lt;String&gt; roleStrlist=<span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<span class="hljs-comment">用户的角色集合</span>
            List&lt;String&gt; perminsStrlist=<span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<span class="hljs-comment">//用户的权限集合</span>
            <span class="hljs-keyword">for</span> (URole role : rlist) {
                roleStrlist.add(role.getName());
            }
            <span class="hljs-keyword">for</span> (UPermission uPermission : plist) {
                perminsStrlist.add(uPermission.getName());
            }
            hasUser.setRoleStrlist(roleStrlist);
            hasUser.setPerminsStrlist(perminsStrlist);
<span class="hljs-comment">//            Session session = SecurityUtils.getSubject().getSession();</span>
<span class="hljs-comment">//            session.setAttribute("user", hasUser);//成功则放入session</span>
         <span class="hljs-comment">// 若存在，将此用户存放到登录认证info中，无需自己做密码对比，Shiro会为我们进行密码对比校验</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(hasUser, hasUser.getPswd(), getName());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-javadoc">/**
     * 权限认证
     *
     *<span class="hljs-javadoctag"> @param</span> principalCollection
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span>(PrincipalCollection principalCollection) {
        logger.info(<span class="hljs-string">"##################执行Shiro权限认证##################"</span>);
        <span class="hljs-comment">//获取当前登录输入的用户名，等价于(String) principalCollection.fromRealm(getName()).iterator().next();</span>
<span class="hljs-comment">//        String loginName = (String) super.getAvailablePrincipal(principalCollection);</span>
        UUser user = (UUser) principalCollection.getPrimaryPrincipal();
<span class="hljs-comment">//        //到数据库查是否有此对象</span>
<span class="hljs-comment">//        User user = null;// 实际项目中，这里可以根据实际情况做缓存，如果不做，Shiro自己也是有时间间隔机制，2分钟内不会重复执行该方法</span>
<span class="hljs-comment">//        user = userMapper.findByName(loginName);</span>
        <span class="hljs-keyword">if</span> (user != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//权限信息对象info,用来存放查出的用户的所有的角色（role）及权限（permission）</span>
            SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();
            <span class="hljs-comment">//用户的角色集合</span>
            info.addRoles(user.getRoleStrlist()); 
            <span class="hljs-comment">//用户的权限集合</span>
            info.addStringPermissions(user.getPerminsStrlist()); 

            <span class="hljs-keyword">return</span> info;
        }
        <span class="hljs-comment">// 返回null的话，就会导致任何用户访问被拦截的请求时，都会自动跳转到unauthorizedUrl指定的地址</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }


}
</code></pre> 
<h4 id="涉及到的两个方法-1">涉及到的两个方法</h4> 
<ul><li><p>doGetAuthenticationInfo <br> 获取用户的权限信息，这是为下一步的授权做判断，获取当前用户的角色和这些角色所拥有的权限信息。</p></li><li><p>doGetAuthorizationInfo <br> 根据用户的权限信息做授权判断，这一步是以doGetAuthenticationInfo为基础的，只有在有用户信息后才能根据用户的角色和授权信息做判断是否给用户授权，因此这里的Roles和Permissions是用户的两个重点判断依据</p></li></ul> 
<p><a href="https://github.com/BambooZhang/springboot-study">本样例源码</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cec48303f4ad4cf16b7336f629335b6b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java用队列优化递归</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6bf3dda70c76cf85aa0519317613c7c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">去除c代码里面的宏定义代码块的程序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>