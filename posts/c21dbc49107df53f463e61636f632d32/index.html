<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docsify 文章加密 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docsify 文章加密" />
<meta property="og:description" content="docsify 文章加密 什么是docsify？ 简单来说是一款便捷的文档网站
官网文档
docsify支持很多中部署方式，包括单独部署，Github部署，Gitee部署....对于没有前端能力固定样式非常友好
加密需求 对于部署上的文档在部分时候需要进行加密，加密方式有两种
文档整体加密
部分内容加密
探索加密 文档整体加密 搜索各大网站只有别人写的问题整体加密， 参考文章：docsify文档加密解密插件
需要文章整体加密的使用上面文档即可，写的很详细。
文档部分加密 针对文档部分加密并没有找到方案...实在忍不住只能自己写了。
思路开端：docsify会在加载md文件时会先转化为html，然后再加载到页面,思路来自于看到全文加密的源码中。
翻官方文档，在自定义插件中找到方法：
hook.afterEach(function(html, next) { // 解析成 html 后调用。 // beforeEach 和 afterEach 支持处理异步逻辑 // ... // 异步处理完成后调用 next(html) 返回结果 next(html); }); 思路 转换md文件到html后解析自定义标签，我这里使用的是标签，如果url上的pwd密码参数等于标签中的value属性则展示标签包含的加密内容，否则展示另一端提示的html。
代码 定义解析html方法
function parsePwd(content) { // Get the URL parameters let currentURL = window.location.href; const hashParams = currentURL.split(&#39;?&#39;)[1]; // 获取问号后面的部分 var urlParams = new URLSearchParams(hashParams); var pwdParam = urlParams." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c21dbc49107df53f463e61636f632d32/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T10:02:30+08:00" />
<meta property="article:modified_time" content="2024-01-09T10:02:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docsify 文章加密</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>docsify 文章加密</h2> 
<h3>什么是docsify？</h3> 
<p><a href="https://juejin.cn/post/6897123103583764488" rel="nofollow" title="简单来说是一款便捷的文档网站">简单来说是一款便捷的文档网站</a></p> 
<p><a href="https://docsify.js.org/#/" rel="nofollow" title="官网文档">官网文档</a></p> 
<p>docsify支持很多中部署方式，包括单独部署，Github部署，Gitee部署....对于没有前端能力固定样式非常友好</p> 
<h3>加密需求</h3> 
<p>对于部署上的文档在部分时候需要进行加密，加密方式有两种</p> 
<ol><li> <p>文档整体加密</p> </li><li> <p>部分内容加密</p> </li></ol> 
<h3>探索加密</h3> 
<h5>文档整体加密</h5> 
<p>搜索各大网站只有别人写的问题整体加密， <a href="https://www.clboy.cn/archives/docsify%E6%96%87%E6%A1%A3%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E6%8F%92%E4%BB%B6" rel="nofollow" title="参考文章：docsify文档加密解密插件">参考文章：docsify文档加密解密插件</a></p> 
<p>需要文章整体加密的使用上面文档即可，写的很详细。</p> 
<h5>文档部分加密</h5> 
<p>针对文档部分加密并没有找到方案...实在忍不住只能自己写了。</p> 
<p>思路开端：docsify会在加载md文件时会先转化为html，然后再加载到页面,思路来自于看到全文加密的源码中。</p> 
<p>翻官方文档，在自定义插件中找到方法：</p> 
<pre><code> hook.afterEach(function(html, next) {
        // 解析成 html 后调用。
        // beforeEach 和 afterEach 支持处理异步逻辑
        // ...
        // 异步处理完成后调用 next(html) 返回结果
        next(html);
      });

</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="911" src="https://images2.imgbox.com/d2/34/8jyBJVFO_o.png" width="1200"></p> 
<h5>思路</h5> 
<p>转换md文件到html后解析自定义标签，我这里使用的是标签，如果url上的pwd密码参数等于标签中的value属性则展示标签包含的加密内容，否则展示另一端提示的html。</p> 
<h3>代码</h3> 
<p><strong>定义解析html方法</strong></p> 
<pre><code>function parsePwd(content) {
      // Get the URL parameters
      let currentURL = window.location.href;
      const hashParams = currentURL.split('?')[1]; // 获取问号后面的部分
      var urlParams = new URLSearchParams(hashParams);
      var pwdParam = urlParams.get('pwd');

      // Replace &lt;pwd&gt; and &lt;tip&gt; tags based on password validation
      return content.replace(/&lt;pwd\s+(.*?)&gt;([\s\S]*?)&lt;\/pwd&gt;/g, function (match, attributes, pwdContent) {
          // 匹配 pwd 标签中的各个属性
          const regex = /(\w+)=['"](.*?)['"]/g;
          let attrMatch;
          let password = '';
          let pwd = '';
          let urlContent = '';

          // 提取属性值
          while ((attrMatch = regex.exec(attributes)) !== null) {
              const attrName = attrMatch[1];
              const attrValue = attrMatch[2];
              if (attrName === 'value') password = attrValue;
              if (attrName === 'pwd') pwd = attrValue;
              if (attrName === 'url') urlContent = attrValue;
          }

          if (pwdParam === password) {
              return pwdContent; // 如果 URL 参数匹配，则显示 &lt;pwd&gt; 标签内容
          } else {
              if (pwdParam){
                  alert("密码错误,请重新输入")
              }
              let tipContent = '&lt;p style="text-align: center;"&gt;&lt;img src="' + urlContent + '" data-origin="http://niubility.cloud/image/rui.jpg" alt=""&gt;&lt;/p&gt;&lt;p style="text-align: center;"&gt;&lt;strong&gt;人机验证，扫码回复：' + pwd + '&lt;/strong&gt;&lt;/p&gt;&lt;p style="text-align: center;"&gt;&lt;input id ="pwd" /&gt; &lt;button onclick="addParamAndRefresh()"&gt;验证&lt;/button&gt;&lt;/p&gt;';
              return tipContent; // 否则显示提示内容
          }
      });
  }
</code></pre> 
<p><strong>定义按钮点击提交密码方法</strong></p> 
<pre><code>// 点击按钮时执行的函数
function addParamAndRefresh() {
    // 获取输入框元素
    let inputElement = document.getElementById('pwd');
    // 获取输入框的值
    let inputValue = inputElement.value;
    if (!inputValue) {
        return
    }
    let currentURL = window.location.href;
    const hashParams = currentURL.split('?')[1]; // 获取问号后面的部分
    var urlParams = new URLSearchParams(hashParams);
    // 检查是否存在名为 'pwd' 的参数
    if (urlParams.has('pwd')) {
        // 修改 'pwd' 参数的值为 '1'
        urlParams.set('pwd', inputValue);
    } else {
        // 如果 'pwd' 参数不存在，则添加它
        urlParams.append('pwd', inputValue);
    }
    // 获取更新后的参数字符串
    var newParams = urlParams.toString();

    // 更新当前页面URL中的参数部分
    if (newParams) {
        currentURL = currentURL.split('?')[0] + '?' + newParams;
    } else {
        currentURL = currentURL.split('?')[0];
    }

    // 刷新页面并跳转到新的URL
    // 改变 hash 路由
    // 使用 Docsify 提供的 router.go() 方法进行路由导航
    //window.$docsify.router.go(currentURL);
    window.location.href = currentURL;
}
</code></pre> 
<p><strong>注册到插件回调调用</strong></p> 
<pre><code>   // Parse &lt;pwd&gt; tags in the page content
    function parseContent(content) {
        return parsePwd(content);
    }

    const afterEachHook = function (hook, vm) {
        hook.beforeEach(function (html, next) {
            next(parseContent(html))
        });
    }
    window.$docsify.plugins = [afterEachHook].concat(window.$docsify.plugins || []);
</code></pre> 
<h3>效果展示</h3> 
<p></p> 
<p class="img-center"><img alt="" height="479" src="https://images2.imgbox.com/47/df/VYuxvwOe_o.png" width="1200"></p> 
<h3>问题</h3> 
<ol><li> <p>在parsePwd方法中我添加图片标签和输入框和按钮，可以根据自己具体实际需求调整展示</p> </li><li> <p>提交按钮这里使用的路由模式是history,如果是使用的hash模式，获取参数代码我贴在下下面</p> </li></ol> 
<pre><code>window.$docsify = {
      //通用设置
      // -----------------------------------------------------
      // 加载自定义导航栏,需要目录下有_navbar.md文件
      loadNavbar: false,
      // 路由模式
      routerMode: 'history',
}

//不是路由模式获取参数代码
// 获取 URL 哈希部分
const hash = window.location.hash;

// 如果哈希部分存在并且包含参数
if (hash.includes('?')) {
  const hashParams = hash.split('?')[1]; // 获取问号后面的部分
  const urlParams = new URLSearchParams(hashParams);

  // 获取名为 pwd 的参数值
  const pwdValue = urlParams.get('pwd');
  // 获取名为 a 的参数值
  const aValue = urlParams.get('a');

  console.log(pwdValue); // 输出: 123
  console.log(aValue); // 输出: 1
}

</code></pre> 
<h3>完整代码获取</h3> 
<p><a class="has-card" href="http://niubility.cloud/record/docsify%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86" rel="nofollow" title="docsify文章加密"><span class="link-card-box"><span class="link-title">docsify文章加密</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/e0/fd/ubyzIgv7_o.png" alt="icon-default.png?t=N7T8">http://niubility.cloud/record/docsify%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb578d52181a67cfcea13f158deefc56/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker实战08｜Docker管道及环境变量识别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cff59e848feef62643fb731a54fe7c12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTB | Codify vm2@3.9.16 中的沙箱逃逸</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>