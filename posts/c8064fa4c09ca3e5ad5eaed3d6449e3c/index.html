<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何改造现有文件为 CMD 模块 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何改造现有文件为 CMD 模块" />
<meta property="og:description" content="如何改造现有文件为 CMD 模块 经过一段考察，我们终于要在项目中引入模块机制和 Sea.js 了，那么如何将现有的文件改造成 CMD 模块就成了重要的问题。下面针对一些典型场景来说明包装的方式。
首先还是请大家详细了解下 CMD 模块定义规范，只要洞悉事物的定义和本质，一切问题可迎刃而解。
改造主流模块 这里指的是 jQuery、Moment、Backbone、underscore 等业界主流模块，这些模块一般都有对 AMD 和 CommonJS 的支持代码，例如 jQuery 源文件的最后几行：
if ( typeof module === &#34;object&#34; &amp;&amp; module &amp;&amp; typeof module.exports === &#34;object&#34; ) { module.exports = jQuery; } else { window.jQuery = window.$ = jQuery; if ( typeof define === &#34;function&#34; &amp;&amp; define.amd ) { define( &#34;jquery&#34;, [], function () { return jQuery; } ); } } 还有 Backbone 里：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c8064fa4c09ca3e5ad5eaed3d6449e3c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T19:28:05+08:00" />
<meta property="article:modified_time" content="2024-01-12T19:28:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何改造现有文件为 CMD 模块</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>如何改造现有文件为 CMD 模块</h3> 
<p>经过一段考察，我们终于要在项目中引入模块机制和 Sea.js 了，那么如何将现有的文件改造成 CMD 模块就成了重要的问题。下面针对一些典型场景来说明包装的方式。</p> 
<p>首先还是请大家详细了解下 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/seajs/seajs/issues/242" title="CMD 模块定义规范">CMD 模块定义规范</a>，只要洞悉事物的定义和本质，一切问题可迎刃而解。</p> 
<h3>改造主流模块</h3> 
<p>这里指的是 jQuery、Moment、Backbone、underscore 等业界主流模块，这些模块一般都有对 AMD 和 CommonJS 的支持代码，例如 jQuery 源文件的最后几行：</p> 
<pre>if ( typeof module === "object" &amp;&amp; module &amp;&amp; typeof module.exports === "object" ) {    module.exports = jQuery;
} else {    window.jQuery = window.$ = jQuery;    if ( typeof define === "function" &amp;&amp; define.amd ) {
        define( "jquery", [], function () { return jQuery; } );
    }
}</pre> 
<p>还有 Backbone 里：</p> 
<pre>var Backbone;if (typeof exports !== 'undefined') {
  Backbone = exports;
} else {
  Backbone = root.Backbone = {};
}</pre> 
<p>对于有这些兼容代码的，只需要去掉 define.amd 的支持，或是直接包装上 <code>define</code> 就可以了。</p> 
<pre>define(function(require, exports, module) {  // code here ...});</pre> 
<p>如果没有模块化的兼容代码，有时候需要手动引入依赖，以及暴露对应的接口。</p> 
<pre>define(function(require, exports, module) {  var $ = require('$');  // code here ...
  module.exports = Placeholders;
});</pre> 
<p>可以参考 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/gallery" title="cmdjs/gallery">cmdjs/gallery</a> 里的 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/gallery/blob/master/moment/Gruntfile.js" title="Gruntfile">Gruntfile</a> 对这些主流模块的代码替换方式。</p> 
<h3>现有的 JS 文件</h3> 
<p>对于一些现有的普通 JS 文件，相对简单的多，参考 CMD 的<a href="https://www.w3cschool.cn/targetlink?url=https://github.com/seajs/seajs/issues/242" title="书写规范">书写规范</a>，把那些暴露到全局命名空间的接口用 CMD 的方式进行改造就可以了。</p> 
<p>比如现有文件 <code>util.js</code> 。</p> 
<pre>window.util = window.util || {};util.addClass = function() {  window.css();
};util.queryString = function() {};</pre> 
<p>改为：</p> 
<pre>define(function(require, exports, module) {  // 引入依赖
  var css = require('css');  util.addClass = function() {
    css();
  };  util.queryString = function() {};  // 暴露对应接口
  module.exports = util;
});</pre> 
<p>这里不啰嗦，就是基本的 CMD 书写规范。实际的改造过程中，情况可以比上面的例子要复杂一些，具体情况具体解决就行。</p> 
<h3>改造 jQuery 插件</h3> 
<p>这也是一个经常遇到的问题，我们推荐以下的包装方式：</p> 
<pre>// jquery-plugin-abcdefine(function(require, exports, module) {  var $ = require('$');  // 插件的代码
  $.fn.abc = function() {};
});</pre> 
<p>这样的改造方式实际上是强化了原有的 $ 对象（而不是重新包装出一个新的 $），在实际调用时，可以用下面的方式：</p> 
<pre>seajs.use(['$', 'jquery-plugin-abc'], function($) {  // $ 有了 jquery-plugin-abc 所提供的插件功能
  $.abc();
});</pre> 
<p>更多 jQuery 插件的包装，可以参考 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/jquery" title="cmdjs/jquery">cmdjs/jquery</a> 里的做法。</p> 
<h3>工具</h3> 
<p>除了手动的方式修改代码外，我们推荐使用 <a href="http://gruntjs.com/" rel="nofollow" title="Grunt">Grunt</a> 来进行统一的改造，官方也通过 Grunt 改造了很多主流模块和 jQuery 插件，具体的操作手册见 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/gallery/blob/master/README.md" title="引入 CMD 模块指南">引入 CMD 模块指南</a> 。你可以在 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/gallery" title="cmdjs/gallery">cmdjs/gallery</a> 和 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/cmdjs/jquery" title="cmdjs/jquery">cmdjs/jquery</a> 中找到具体的 Gruntfile ，从而借鉴到您的项目中去。所有打包好的模块可以在 <a href="https://spmjs.org/" rel="nofollow" title="spmjs.org">spmjs.org</a> 中找到。</p> 
<h3>小结</h3> 
<p>上面提供的是原有代码包装为 <code>CMD 书写规范</code> 的方法，在具体上线前，可能还需要打包为具名模块（包含 ID 的模块）。关于构建方面的进一步知识可以参考 <a href="https://www.w3cschool.cn/targetlink?url=https://github.com/seajs/seajs/issues/538" title="构建工具">构建工具</a> 。</p> 
<p>这里提到的包装方式都比较典型和简单，具体的实践可能千差万别。您在项目中有什么探索、实践和问题，欢迎来这里分享和提问。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c81d5244f0b9ca6cdbd55de480904a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python装逼代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/435fc8c7fcf12539e5ec779774ee0b2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">响应式编程初探-自定义实现Reactive Streams规范</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>