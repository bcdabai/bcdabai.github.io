<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python-gitlab拉取git项目（python3） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python-gitlab拉取git项目（python3）" />
<meta property="og:description" content="安装就不多说了，python-gitlab这个模块貌似只适用于gitlab9版本以上，我用8版本一直报404，升级到9版本就好了
脚本内容如下：
如果不出现什么意外的话，只要地址和token正确，应该没有问题
project.repository_tree(all=True,recursive=True,as_list=True)脚本中这条语句是递归列出项目目录和文件，
recursive这个参数默认是false不进行递归
由于百度上没找到此办法，所以找了一下python-gitlab模块文件，里面有明确标明
/usr/local/python/lib/python3.7/site-packages/gitlab/v4/objects.py这个文件
#!/usr/sbin/python3 import gitlab import time import os git_url = &#39;http://192.168.12.84/&#39; git_token = &#39;XbEURKtB1m2AkgTyyH6K&#39; project_root = &#39;/root/flow-web&#39; class get_gitlab: def __init__(self): self.url = git_url self.token = git_token self.root_path = project_root #登陆 def login_gitlab(self): gl = gitlab.Gitlab(self.url,self.token) return gl #用项目id获取项目 def get_project_id(self,id): gl = self.login_gitlab() project = gl.projects.get(id) return project #由于是递归方式下载的所以要先创建项目相应目录 def create_dir(self,dir_name): if not os.path.isdir(dir_name): print(&#34;\033[0;32;40m开始创建目录: \033[0m{0}&#34;.format(dir_name)) os.makedirs(dir_name) time.sleep(0.1) def start_get(self): project = self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2b0a1178cc46d3fd72af0f62875aab2b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-22T15:59:26+08:00" />
<meta property="article:modified_time" content="2019-10-22T15:59:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python-gitlab拉取git项目（python3）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>安装就不多说了，python-gitlab这个模块貌似只适用于gitlab9版本以上，我用8版本一直报404，升级到9版本就好了</p> 
<p>脚本内容如下：</p> 
<p>如果不出现什么意外的话，只要地址和token正确，应该没有问题</p> 
<p>project.repository_tree(all=True,recursive=True,as_list=True)脚本中这条语句是递归列出项目目录和文件，</p> 
<p>recursive这个参数默认是false不进行递归</p> 
<p>由于百度上没找到此办法，所以找了一下python-gitlab模块文件，里面有明确标明</p> 
<p>/usr/local/python/lib/python3.7/site-packages/gitlab/v4/objects.py这个文件</p> 
<pre class="has"><code class="language-python">#!/usr/sbin/python3
import gitlab
import time
import os

git_url = 'http://192.168.12.84/'
git_token = 'XbEURKtB1m2AkgTyyH6K'
project_root = '/root/flow-web'

class get_gitlab:
   
   def __init__(self):
       self.url = git_url
       self.token = git_token
       self.root_path = project_root

   #登陆
   def login_gitlab(self):
       gl = gitlab.Gitlab(self.url,self.token)
       return gl

   #用项目id获取项目
   def get_project_id(self,id):
       gl = self.login_gitlab()
       project = gl.projects.get(id)
       return project

   #由于是递归方式下载的所以要先创建项目相应目录
   def create_dir(self,dir_name):
       if not os.path.isdir(dir_name):
          print("\033[0;32;40m开始创建目录: \033[0m{0}".format(dir_name))
          os.makedirs(dir_name)
          time.sleep(0.1)

   
   def start_get(self):
      project = self.get_project_id(6)
      info = project.repository_tree(all=True,recursive=True,as_list=True)
      file_list = []
      if not os.path.isdir(self.root_path):
          os.makedirs(self.root_path)
      os.chdir(self.root_path)
      #调用创建目录的函数并生成文件名列表
      for info_dir in range(len(info)):
         if info[info_dir]['type'] == 'tree':
            dir_name = info[info_dir]['path']
            self.create_dir(dir_name)
         else:
            file_name = info[info_dir]['path']
            file_list.append(file_name)
      for info_file in range(len(file_list)):
         #开始下载
         getf = project.files.get(file_path=file_list[info_file],ref='master')
         content = getf.decode()
         with open(file_list[info_file] , 'wb') as code:
            print("\033[0;32;40m开始下载文件: \033[0m{0}".format(file_list[info_file]))
            code.write(content)

st_init = get_gitlab()
st_init.start_get()</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d063fde2c0f6fad3554d15f03c593073/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络——数据链路层——思维导图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/efde30006f6e48aa0a1ef98d6c0dffb2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">node.js 使用rabbitmq</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>