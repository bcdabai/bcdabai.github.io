<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux脚本重启进程,linux下通过脚本实现自动重启程序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux脚本重启进程,linux下通过脚本实现自动重启程序" />
<meta property="og:description" content="假定需要实现重启的程序名为 test ，我们这里通过判断进程数目来判断程序是否正常。
ps -ef | grep &#34;$1&#34; | grep -v &#34;grep&#34; | wc –l 是获取 $1 (本例中为 test )的进程数，脚本根据进程数来决定下一步的操作。通过一个死循环，每隔 1 秒检查一次系统中的指定程序的进程数。
grep -v &#34;grep&#34;:作用：在结果中搜索除 grep之外的部分
-v, --invert-match
Invert the sense of matching, to select non-matching lines. (-v is specified by POSIX.)
代码如下：
脚本check
#!/bin/sh
#------------------------------------------------------------------------------
# 函数: CheckProcess
# 功能: 检查一个进程是否存在
# 参数: $1 --- 要检查的进程名称
# 返回: 如果存在返回0, 否则返回1.
#------------------------------------------------------------------------------
CheckProcess(){
# 检查输入的参数是否有效
if [ &#34;$1&#34; = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0fc508a6e28a650e792f2fea97616b7e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-28T21:07:10+08:00" />
<meta property="article:modified_time" content="2021-04-28T21:07:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux脚本重启进程,linux下通过脚本实现自动重启程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>假定需要实现重启的程序名为 test ，我们这里通过判断进程数目来判断程序是否正常。</p> 
 <p>ps -ef | grep "$1" | grep -v "grep" | wc –l 是获取 $1 (本例中为 test )的进程数，脚本根据进程数来决定下一步的操作。通过一个死循环，每隔 1 秒检查一次系统中的指定程序的进程数。</p> 
 <p>grep -v "grep":作用：在结果中搜索除 grep之外的部分</p> 
 <p>-v, --invert-match</p> 
 <p>Invert the sense of matching, to select non-matching lines.  (-v is specified by POSIX.)</p> 
 <p>代码如下：</p> 
 <p>脚本check</p> 
 <p>#!/bin/sh</p> 
 <p>#------------------------------------------------------------------------------</p> 
 <p># 函数: CheckProcess</p> 
 <p># 功能: 检查一个进程是否存在</p> 
 <p># 参数: $1 --- 要检查的进程名称</p> 
 <p># 返回: 如果存在返回0, 否则返回1.</p> 
 <p>#------------------------------------------------------------------------------</p> 
 <p>CheckProcess(){<!-- --></p> 
 <p># 检查输入的参数是否有效</p> 
 <p>if [ "$1" = "" ];</p> 
 <p>then</p> 
 <p>return 1</p> 
 <p>fi</p> 
 <p>#$PROCESS_NUM获取指定进程名的数目，为1返回0，表示正常，不为1返回1，表示有错误，需要重新启动</p> 
 <p>PROCESS_NUM=`ps -ef | grep "$1" | grep -v "grep" | wc -l`</p> 
 <p>if [ $PROCESS_NUM -eq 1 ];</p> 
 <p>then</p> 
 <p>return 0</p> 
 <p>else</p> 
 <p>return 1</p> 
 <p>fi</p> 
 <p>}</p> 
 <p># 检查test实例是否已经存在</p> 
 <p>while [ 1 ] ; do</p> 
 <p>CheckProcess $1</p> 
 <p>CheckQQ_RET=$?</p> 
 <p>if [ $CheckQQ_RET -eq 1 ];</p> 
 <p>then</p> 
 <p># 杀死所有test进程，可换任意你需要执行的操作</p> 
 <p>killall -9 $1</p> 
 <p>exec ./$1 &amp;</p> 
 <p>fi</p> 
 <p>sleep 1</p> 
 <p>done</p> 
 <p>脚本start：</p> 
 <p>脚本start：</p> 
 <p>加入limit coredumpsize 102400，设置core file的大小，一旦程序Core Dump，有迹可寻。在该脚本中后台执行check脚本，可以省去很多麻烦，</p> 
 <p>PS：对这个脚本的功能 表示怀疑 可能达不到实际需要的效果</p> 
 <p>经过实际验证后的可行的脚本如下：</p> 
 <p>#!/bin/sh</p> 
 <p>#declare -i g_processID=0</p> 
 <p>help(){<!-- --></p> 
 <p>echo "Usage: $0 "</p> 
 <p>exit 0</p> 
 <p>}</p> 
 <p># 参数范围检查</p> 
 <p>if [ "$#" != 1 ];</p> 
 <p>then</p> 
 <p>help</p> 
 <p>fi</p> 
 <p>#检查进程实例是否已经存在</p> 
 <p>while [ 1 ]; do</p> 
 <p>DTTERM=`pgrep ${1}`</p> 
 <p>if [ -n "$DTTERM" ]</p> 
 <p>then</p> 
 <p>echo "process exit and date is: `date`"</p> 
 <p>#正确输入信息到日志文件</p> 
 <p>else</p> 
 <p>echo "restart process: $1 and date is: `date`"</p> 
 <p>exec ./${1} &amp;</p> 
 <p>fi</p> 
 <p>#监控时间间隔</p> 
 <p>sleep 1</p> 
 <p>done</p> 
 <p>附grep使用方法：</p> 
 <p>中的grep命令可以在文本中搜索指定的字符串,</p> 
 <p>摘要</p> 
 <p>举例介绍GREP的各种搜索方式,文件名,段落,正则匹配等多种方式的搜索.</p> 
 <p>假设您正在‘/usr/src/linux/Documentation’目录下搜索带字符串‘magic’的文件：</p> 
 <p>$ grep magic /usr/src//Documentation/*</p> 
 <p>sysrq.txt:* How do I enable the magic SysRQ key?</p> 
 <p>sysrq.txt:* How do I use the magic SysRQ key?</p> 
 <p>其中文件‘sysrp.txt’包含该字符串，讨论的是 SysRQ 的功能。</p> 
 <p>默认情况下，‘grep’只搜索当前目录。如果此目录下有许多子目录，‘grep’会以如下形式列出：</p> 
 <p>grep: sound: Is a directory</p> 
 <p>这可能会使‘’的输出难于阅读。这里有两种解决的办法：</p> 
 <p>明确要求搜索子目录：grep -r</p> 
 <p>或忽略子目录：grep -d skip</p> 
 <p>当然，如果预料到有许多输出，您可以通过 管道 将其转到‘less’上阅读：</p> 
 <p>$ grep magic /usr/src/linux/Documentation/* | less</p> 
 <p>这样，您就可以更方便地阅读。</p> 
 <p>有一点要注意，您必需提供一个文件过滤方式(搜索全部文件的话用 *)。如果您忘了，‘grep’会一直等着，直到该程序被中断。如果您遇到了这样的情况，按 ，然后再试。</p> 
 <p>下面是一些有意思的命令行参数：</p> 
 <p>grep -i pattern files ：不区分大小写地搜索。默认情况区分大小写，</p> 
 <p>grep -l pattern files ：只列出匹配的文件名，</p> 
 <p>grep -L pattern files ：列出不匹配的文件名，</p> 
 <p>grep -w pattern files ：只匹配整个单词，而不是字符串的一部分(如匹配‘magic’，而不是‘magical’)，</p> 
 <p>grep -C number pattern files ：匹配的上下文分别显示[number]行，</p> 
 <p>grep pattern1 | pattern2 files ：显示匹配 pattern1 或 pattern2 的行，</p> 
 <p>grep pattern1 files | grep pattern2 ：显示既匹配 pattern1 又匹配 pattern2 的行。</p> 
 <p>这里还有些用于搜索的特殊符号：</p> 
 <p>\&lt; 和 \&gt; 分别标注单词的开始与结尾。</p> 
 <p>例如：</p> 
 <p>grep man * 会匹配 ‘Batman’、‘manic’、‘man’等，</p> 
 <p>grep ‘\grep ‘\’ 只匹配‘man’，而不是‘Batman’或‘manic’等其他的字符串。</p> 
 <p>‘^’：指匹配的字符串在行首，</p> 
 <p>‘$’：指匹配的字符串在行尾，</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2aa0ba5f428728fd7703363d80f59c7c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux web目录写入权限命令,linux下web目录权限设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/68f588046ba03f1660900d1144cef988/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">联合索引</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>