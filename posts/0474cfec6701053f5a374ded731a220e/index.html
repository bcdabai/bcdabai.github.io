<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>禅道二次开发（三）：二次开发实例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="禅道二次开发（三）：二次开发实例" />
<meta property="og:description" content="对禅道框架有初步的了解后就可以开始进行二次开发了，不需要完全搞懂zentaoPHP框架，可以在开发过程中学习。本文记录一下我进行禅道二次开发的其中一个小功能的实现过程。
注：本文基于禅道开源版16.4进行二次开发，禅道16.5&#43;版本升级了扩展机制，具体请参考官方文档：https://devel.easycorp.cn/book/extension-new/intro-52.html 。
目录 新建用例页面扩展1. 定位扩展模块2. view 扩展覆盖扩展 3. lang扩展4. control方法扩展5. model方法扩展覆盖扩展钩子扩展 用例浏览页面扩展用例编辑页面扩展view方法钩子扩展js/css/lang/config 扩展 对禅道进行扩展主要在module目录下进行，在需要扩展的模块下对model、control、view方法以及css、js、lang等进行扩展。下面介绍如何在用例模块中新增一个字段，了解禅道是如何进行扩展的。
需求是对测试用例新增字段【测试方式】，选项为手工或者自动化，新建用例页面的效果如下：
下面介绍具体扩展步骤。
新建用例页面扩展 对禅道的二次开发一般在对应模块下的 ext 目录中进行扩展，不需要对禅道源码进行修改。先来介绍新建用例页面新增【测试方式】字段的步骤。
1. 定位扩展模块 第一步需要定位到要扩展页面的模块名和方法名。
点击进入新建用例页面，可以看到URL地址为：http://192.168.30.9:8080/zentao/testcase-create-1-all-0.html 。
通过URL地址可以得到如下信息：
模块名为testcase方法名为create，可以在\module\testcase\control.php 中找到create方法。\module\testcase\model.php 文件中存放control可以调用的Model方法。对应的view模板文件为 \module\testcase\view\create.html.php。后面的1-all-0是create方法的参数，这里的1表示产品ID，具体含义需要查看代码。 通过这个URL我们知道要扩展testcase模块下的create方法。
2. view 扩展 对 view 方法的扩展有两种方式：覆盖扩展和钩子扩展。
覆盖扩展 覆盖扩展就是对原来的方法进行重写，直接在 \module\testcase\ext\view 目录下创建与要扩展方法同名的文件 create.html.php，复制 \module\testcase\view 目录下 create.html.php 代码，新增【测试方式】相关前端代码。下面直接给出代码（部分关键代码）：
&lt;td&gt; &lt;div class=&#39;table-row&#39;&gt; &lt;div class=&#39;table-col&#39; id=&#39;stageBox&#39;&gt; &lt;div class=&#39;input-group&#39;&gt; &lt;span class=&#39;input-group-addon w-80px&#39;&gt;&lt;?php echo $lang-&gt;testcase-&gt;stage;?&gt;&lt;/span&gt; &lt;?php echo html::select(&#39;stage[]&#39;, $lang-&gt;testcase-&gt;stageList, $stage, &#34;class=&#39;form-control chosen&#39; multiple=&#39;multiple&#39;&#34;);?&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&#39;table-col&#39; id=&#39;exectypeBox&#39;&gt; &lt;div class=&#39;input-group&#39;&gt; &lt;span class=&#39;input-group-addon fix-border&#39;&gt;&lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0474cfec6701053f5a374ded731a220e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-17T14:26:46+08:00" />
<meta property="article:modified_time" content="2023-01-17T14:26:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">禅道二次开发（三）：二次开发实例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>对禅道框架有初步的了解后就可以开始进行二次开发了，不需要完全搞懂zentaoPHP框架，可以在开发过程中学习。本文记录一下我进行禅道二次开发的其中一个小功能的实现过程。</p> 
<p>注：本文基于禅道开源版16.4进行二次开发，禅道16.5+版本升级了扩展机制，具体请参考官方文档：<a href="https://devel.easycorp.cn/book/extension-new/intro-52.html" rel="nofollow">https://devel.easycorp.cn/book/extension-new/intro-52.html</a> 。</p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_14" rel="nofollow">新建用例页面扩展</a></li><li><ul><li><a href="#1__18" rel="nofollow">1. 定位扩展模块</a></li><li><a href="#2_view__34" rel="nofollow">2. view 扩展</a></li><li><ul><li><a href="#_38" rel="nofollow">覆盖扩展</a></li></ul> 
   </li><li><a href="#3_lang_67" rel="nofollow">3. lang扩展</a></li><li><a href="#4_control_82" rel="nofollow">4. control方法扩展</a></li><li><a href="#5_model_130" rel="nofollow">5. model方法扩展</a></li><li><ul><li><a href="#_138" rel="nofollow">覆盖扩展</a></li><li><a href="#_158" rel="nofollow">钩子扩展</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_175" rel="nofollow">用例浏览页面扩展</a></li><li><a href="#_185" rel="nofollow">用例编辑页面扩展</a></li><li><ul><li><a href="#view_189" rel="nofollow">view方法钩子扩展</a></li><li><a href="#jscsslangconfig__220" rel="nofollow">js/css/lang/config 扩展</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>对禅道进行扩展主要在module目录下进行，在需要扩展的模块下对model、control、view方法以及css、js、lang等进行扩展。下面介绍如何在用例模块中新增一个字段，了解禅道是如何进行扩展的。</p> 
<p>需求是对测试用例新增字段【测试方式】，选项为手工或者自动化，新建用例页面的效果如下：</p> 
<p><img src="https://images2.imgbox.com/a8/da/FCBfCHT3_o.png" alt="" width="700"></p> 
<p>下面介绍具体扩展步骤。</p> 
<h2><a id="_14"></a>新建用例页面扩展</h2> 
<p>对禅道的二次开发一般在对应模块下的 <code>ext</code> 目录中进行扩展，不需要对禅道源码进行修改。先来介绍新建用例页面新增【测试方式】字段的步骤。</p> 
<h3><a id="1__18"></a>1. 定位扩展模块</h3> 
<p>第一步需要定位到要扩展页面的模块名和方法名。</p> 
<p>点击进入新建用例页面，可以看到URL地址为：<code>http://192.168.30.9:8080/zentao/testcase-create-1-all-0.html</code> 。</p> 
<p>通过URL地址可以得到如下信息：</p> 
<ul><li>模块名为testcase</li><li>方法名为create，可以在<code>\module\testcase\control.php</code> 中找到create方法。</li><li><code>\module\testcase\model.php</code> 文件中存放control可以调用的Model方法。</li><li>对应的view模板文件为 <code>\module\testcase\view\create.html.php</code>。</li><li>后面的<code>1-all-0</code>是create方法的参数，这里的1表示产品ID，具体含义需要查看代码。</li></ul> 
<p>通过这个URL我们知道要扩展testcase模块下的create方法。</p> 
<h3><a id="2_view__34"></a>2. view 扩展</h3> 
<p>对 view 方法的扩展有两种方式：覆盖扩展和钩子扩展。</p> 
<h4><a id="_38"></a>覆盖扩展</h4> 
<p>覆盖扩展就是对原来的方法进行重写，直接在 <code>\module\testcase\ext\view</code> 目录下创建与要扩展方法<strong>同名</strong>的文件 <code>create.html.php</code>，复制 <code>\module\testcase\view</code> 目录下 <code>create.html.php</code> 代码，新增【测试方式】相关前端代码。下面直接给出代码（部分关键代码）：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>table-row<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>table-col<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>stageBox<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>input-group<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>input-group-addon w-80px<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token prolog">&lt;?php echo $lang-&gt;testcase-&gt;stage;?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
			<span class="token prolog">&lt;?php echo html::select('stage[]', $lang-&gt;testcase-&gt;stageList, $stage, "class='form-control chosen' multiple='multiple'");?&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>table-col<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>exectypeBox<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>input-group<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>input-group-addon fix-border<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token prolog">&lt;?php echo $lang-&gt;testcase-&gt;execType;?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
			<span class="token prolog">&lt;?php echo html::select('execType', $lang-&gt;testcase-&gt;execTypeList, $execType, "class='form-control chosen' ");?&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>由于我要将它放在【适用阶段】字段后面，因此对【适用阶段】相关代码也进行了修改。</p> 
<p>我们知道，view模板是由于向用户展现数据的，相关数据是通过control方法获取的。通过参考其它字段，【测试方式】字段需要 <code>$lang-&gt;testcase-&gt;execType</code> 、<code>$lang-&gt;testcase-&gt;execTypeList</code> 和 <code>$execType</code> 这三个数据。前两个变量需要扩展lang文件，最后一个变量需要扩展control层中的create方法。</p> 
<p><strong>view模板的钩子扩展方法稍后介绍。</strong></p> 
<h3><a id="3_lang_67"></a>3. lang扩展</h3> 
<p>在 <code>ext/lang</code> 目录下创建zh-cn文件夹（其它语言类似），然后在zh-cn目录下创建zh-cn.php文件（任意文件名）：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execType</span>             <span class="token operator">=</span> <span class="token string single-quoted-string">'测试方式'</span><span class="token punctuation">;</span>

<span class="token comment">/* Define the execution types. */</span>
<span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execTypeList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">''</span><span class="token punctuation">]</span>            <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execTypeList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'manual'</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'手工'</span><span class="token punctuation">;</span>
<span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execTypeList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'auto'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'自动化'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="4_control_82"></a>4. control方法扩展</h3> 
<p>接下来扩展 testcase 的control方法里面的 create 方法，在<code>\module\testcase\ext</code> 目录下创建一个control目录，然后在<code>control</code> 目录下创建create.php文件（注意：<strong>创建的文件名要小写。</strong>），参数和control.php中的create方法一样：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'../../control.php'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">myTestcase</span> <span class="token keyword">extends</span> <span class="token class-name">testcase</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
    * Create a test case.
    * @param        $productID
    * @param string $branch
    * @param int    $moduleID
    * @param string $from
    * @param int    $param
    * @param int    $storyID
    * @param string $extras
    * @access public
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">create</span><span class="token punctuation">(</span><span class="token variable">$productID</span><span class="token punctuation">,</span> <span class="token variable">$branch</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$moduleID</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$from</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$storyID</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$extras</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* Init vars. */</span>
        <span class="token variable">$execType</span>    <span class="token operator">=</span> <span class="token string single-quoted-string">'manual'</span><span class="token punctuation">;</span> <span class="token comment">// 测试方式，manual:手工, auto: 自动的</span>
       
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">view</span><span class="token operator">-&gt;</span><span class="token property">execType</span>        <span class="token operator">=</span> <span class="token variable">$execType</span><span class="token punctuation">;</span>        

        <span class="token keyword static-context">parent</span><span class="token operator">::</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$productID</span><span class="token punctuation">,</span> <span class="token variable">$branch</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$moduleID</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$from</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$storyID</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$extras</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>新增的两行代码会自动扩展到control.php中的create方法中。也可以复制源码，在源码中修改，如果全部复制过来就不要用parent方法了。</p> 
<p>由于新增了一个字段，需要对case表新增一个字段execType：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>zentao<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>zt_case<span class="token punctuation">`</span></span> 
<span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> <span class="token identifier"><span class="token punctuation">`</span>execType<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'manual'</span> <span class="token keyword">AFTER</span> <span class="token identifier"><span class="token punctuation">`</span>lastRunResult<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>目前不需要对model方法进行扩展，到这里已经完成了对新建用例页面的扩展。</p> 
<p>这里介绍一下model方法扩展方式。</p> 
<h3><a id="5_model_130"></a>5. model方法扩展</h3> 
<p>在 <code>\testcase\ext</code> 目录下创建model目录。然后在<code>\testcase\ext\model</code> 目录下进行model方法扩展，主要有3种扩展方式：</p> 
<ul><li>覆盖扩展：创建*.php文件</li><li>钩子扩展：创建hook目录，在hook目录下创建 <code>扩展方法名.扩展名.php</code> 文件</li><li>class目录：加密使用的方式</li></ul> 
<h4><a id="_138"></a>覆盖扩展</h4> 
<p>model方法扩展直接写要扩展的方法名即可，不用像control方法扩展那样新声明类，在<code>\testcase\ext\model</code> 目录下创建test.php:</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment">/**
 * Create a case.
 *
 * @param int $bugID
 * @access public
 * @return void
 */</span>
<span class="token keyword">function</span> <span class="token function-definition function">create</span><span class="token punctuation">(</span><span class="token variable">$bugID</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$bugID</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_158"></a>钩子扩展</h4> 
<p>在<code>\testcase\ext\model\hook</code> 目录下创建 <code>扩展方法名.扩展名.php</code> ，框架会把扩展方法的所有钩子代码合并到最终的代码中。</p> 
<p>在 <code>\testcase\ext\model\hook\</code>目录下创建create.test.php文件</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// 直接编写代码逻辑</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"6666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>查看效果：创建用例，点击保存</p> 
<p><img src="https://images2.imgbox.com/e2/8a/WiBXPSFl_o.png" alt="" width="700"></p> 
<h2><a id="_175"></a>用例浏览页面扩展</h2> 
<p>在创建用例页面新增了【测试方式】字段之后，如果想在用例浏览页面查看每条用例的测试方式，需要对browse页面进行扩展。</p> 
<p><img src="https://images2.imgbox.com/40/6a/fWoOw3WQ_o.png" alt="" width="700"></p> 
<p>具体步骤不介绍了，思路和新建用例页面扩展一样。效果如下图：</p> 
<p><img src="https://images2.imgbox.com/94/96/KyhZ6wcn_o.png" alt="" width="700"></p> 
<h2><a id="_185"></a>用例编辑页面扩展</h2> 
<p>用例编辑页面也要添加【测试方式】字段，这里介绍一下view方法的钩子扩展方式。</p> 
<h3><a id="view_189"></a>view方法钩子扩展</h3> 
<p>将【测试方式】字段放到【适用阶段】后面：</p> 
<p><img src="https://images2.imgbox.com/0f/46/Kl8czk1F_o.png" alt="" width="700"></p> 
<p>文件命名方式：<code>方法名.扩展名.html.hook.php</code>，钩子的内容会追加到主干对应view文件末尾。在<code>\module\testcase\ext\view</code> 目录下创建 <code>create.test.html.hook.php</code> 文件：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> 
<span class="token comment">// 测试方式</span>
<span class="token variable">$html</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;tr&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execType</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/th&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token class-name static-context">html</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'execType'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">array</span><span class="token punctuation">)</span><span class="token variable">$lang</span><span class="token operator">-&gt;</span><span class="token property">testcase</span><span class="token operator">-&gt;</span><span class="token property">execTypeList</span><span class="token punctuation">,</span> <span class="token variable">$case</span><span class="token operator">-&gt;</span><span class="token property">execType</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"class='form-control chosen' "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/td&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span>  <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/tr&gt;'</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">var</span> item1 <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string single-quoted-string">'div.side-col table tbody tr'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
    $<span class="token punctuation">(</span><span class="token string single-quoted-string">'#dataform'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">find</span><span class="token punctuation">(</span> item1 <span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>效果：</p> 
<p><img src="https://images2.imgbox.com/f1/81/RW0HKhiK_o.png" alt="" width="700"></p> 
<h3><a id="jscsslangconfig__220"></a>js/css/lang/config 扩展</h3> 
<p>有时候需要对js、css、lang和config文件进行扩展，前面介绍了对lang的扩展。js 和 css 扩展方法和lang一样。</p> 
<ul><li> <p>在 <code>ext/js</code> 目录下创建和方法名同名的目录create，进入create目录，创建test.js文件</p> </li><li> <p>在 <code>ext/css</code> 目录下创建和方法名同名的目录create，进入create目录，创建test.css文件</p> </li></ul> 
<p>config扩展是在<code>ext/config</code> 目录下创建php文件即可。</p> 
<p>关于禅道二次开发相关笔记就写到这里了，文章仅介绍了禅道扩展的一个简单示例，更多用法可以阅读源码，欢迎交流讨论。</p> 
<p>参考资料：</p> 
<ol><li>https://www.zentao.net/publicclass/80237.html</li><li>https://www.zentao.net/book/zentaopmshelp/225.html</li></ol> 
<center> 
 <b>--THE END--<b></b></b> 
</center> 
<blockquote> 
 <p>弱小和无知不是生存的障碍，傲慢才是。——刘慈欣《三体3：死神永生》</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e7e2ff3fbe5336f0ff61f0290692558/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux服务管理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/71a29cacfc17bea4bf280d3c51bc7eae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot&#43;mybatisplus实现分页</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>