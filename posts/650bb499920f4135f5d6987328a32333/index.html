<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BZOJ 3132(上帝造题的七分钟-树状数组求和&#43;2D逆求和数组) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BZOJ 3132(上帝造题的七分钟-树状数组求和&#43;2D逆求和数组)" />
<meta property="og:description" content="3132: 上帝造题的七分钟 Time Limit: 20 Sec Memory Limit: 128 MB Submit: 46 Solved: 18 [ Submit][ Status][ Discuss] Description “第一分钟，X说，要有矩阵，于是便有了一个里面写满了0的n×m矩阵。
第二分钟，L说，要能修改，于是便有了将左上角为(a,b)，右下角为(c,d)的一个矩形区域内的全部数字加上一个值的操作。
第三分钟，k说，要能查询，于是便有了求给定矩形区域内的全部数字和的操作。
第四分钟，彩虹喵说，要基于二叉树的数据结构，于是便有了数据范围。
第五分钟，和雪说，要有耐心，于是便有了时间限制。
第六分钟，吃钢琴男说，要省点事，于是便有了保证运算过程中及最终结果均不超过32位有符号整数类型的表示范围的限制。
第七分钟，这道题终于造完了，然而，造题的神牛们再也不想写这道题的程序了。”
——《上帝造裸题的七分钟》
所以这个神圣的任务就交给你了。
Input 输入数据的第一行为X n m，代表矩阵大小为n×m。
从输入数据的第二行开始到文件尾的每一行会出现以下两种操作：
L a b c d delta —— 代表将(a,b),(c,d)为顶点的矩形区域内的所有数字加上delta。
k a b c d　—— 代表求(a,b),(c,d)为顶点的矩形区域内所有数字的和。
请注意，k为小写。
Output 针对每个k操作，在单独的一行输出答案。
Sample Input X 4 4 L 1 1 3 3 2 L 2 2 4 4 1 k 2 2 3 3 Sample Output 12 HINT 对于100%的数据，1 ≤ n ≤ 2048, 1 ≤ m ≤ 2048, 1 ≤ delta ≤ 500,操作不超过200000个,保证运算过程中及最终结果均不超过32位带符号整数类型的表示范围。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/650bb499920f4135f5d6987328a32333/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-04-20T11:01:02+08:00" />
<meta property="article:modified_time" content="2013-04-20T11:01:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BZOJ 3132(上帝造题的七分钟-树状数组求和&#43;2D逆求和数组)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <center style="font-family:arial,verdana,helvetica,sans-serif; font-size:14px"> 
 <h3 style="color:blue">3132: 上帝造题的七分钟</h3> 
 <span class="green">Time Limit: </span>20 Sec   
 <span class="green">Memory Limit: </span>128 MB 
 <br> 
 <span class="green">Submit: </span>46   
 <span class="green">Solved: </span>18 
 <br> [ 
 <a href="http://www.lydsy.com/JudgeOnline/submitpage.php?id=3132" rel="nofollow" style="color:blue; text-decoration:initial">Submit</a>][ 
 <a href="http://www.lydsy.com/JudgeOnline/problemstatus.php?id=3132" rel="nofollow" style="color:blue; text-decoration:initial">Status</a>][ 
 <a href="http://www.lydsy.com/JudgeOnline/bbs.php?id=3132" rel="nofollow" style="color:blue; text-decoration:initial">Discuss</a>] 
</center> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Description</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <p><span style="font-size:14px">“第一分钟，X说，要有矩阵，于是便有了一个里面写满了0的n×m矩阵。</span></p> 
 <p><span style="font-size:14px">第二分钟，L说，要能修改，于是便有了将左上角为(a,b)，右下角为(c,d)的一个矩形区域内的全部数字加上一个值的操作。</span></p> 
 <p><span style="font-size:14px">第三分钟，k说，要能查询，于是便有了求给定矩形区域内的全部数字和的操作。</span></p> 
 <p><span style="font-size:14px">第四分钟，彩虹喵说，要基于二叉树的数据结构，于是便有了数据范围。</span></p> 
 <p><span style="font-size:14px">第五分钟，和雪说，要有耐心，于是便有了时间限制。</span></p> 
 <p><span style="font-size:14px">第六分钟，吃钢琴男说，要省点事，于是便有了保证运算过程中及最终结果均不超过32位有符号整数类型的表示范围的限制。</span></p> 
 <p><span style="font-size:14px">第七分钟，这道题终于造完了，然而，造题的神牛们再也不想写这道题的程序了。”</span></p> 
 <p><span style="font-size:14px">       ——《上帝造裸题的七分钟》</span></p> 
 <p><span style="font-size:14px">所以这个神圣的任务就交给你了。</span></p> 
 <p></p> 
 <p></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Input</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <p><span style="font-size:14px"> 输入数据的第一行为X n m，代表矩阵大小为n×m。</span></p> 
 <p><span style="font-size:14px">从输入数据的第二行开始到文件尾的每一行会出现以下两种操作：</span></p> 
 <p><span style="font-size:14px">　　L a b c d delta —— 代表将(a,b),(c,d)为顶点的矩形区域内的所有数字加上delta。</span></p> 
 <p><span style="font-size:14px">　　k a b c d　　 —— 代表求(a,b),(c,d)为顶点的矩形区域内所有数字的和。</span></p> 
 <p> </p> 
 <p><span style="font-size:14px">请注意，k为小写。</span></p> 
 <p><span style="font-size:14px"><br>         </span></p> 
 <p></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Output</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <p><span style="font-size:14px">针对每个k操作，在单独的一行输出答案。</span></p> 
 <p></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Sample Input</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <span class="sampledata" style="font-family:monospace; white-space:pre; background-color:rgb(141,184,255); font-size:18px">X 4 4<br style="font-family:arial,verdana,helvetica,sans-serif!important"> L 1 1 3 3 2<br style="font-family:arial,verdana,helvetica,sans-serif!important"> L 2 2 4 4 1<br style="font-family:arial,verdana,helvetica,sans-serif!important"> k 2 2 3 3<br style="font-family:arial,verdana,helvetica,sans-serif!important"> <br style="font-family:arial,verdana,helvetica,sans-serif!important"> </span> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Sample Output</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <span class="sampledata" style="font-family:monospace; white-space:pre; background-color:rgb(141,184,255); font-size:18px">12<br style="font-family:arial,verdana,helvetica,sans-serif!important"> </span> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">HINT</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <p></p> 
 <p><span style="font-size:14px">对于100%的数据，1 ≤ n ≤ 2048, 1 ≤ m ≤ 2048, 1 ≤ delta ≤ 500,操作不超过200000个,保证运算过程中及最终结果均不超过32位带符号整数类型的表示范围。</span></p> 
 <p></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Source</h3> 
<div class="content" style="font-family:arial,verdana,helvetica,sans-serif; height:auto; background-color:rgb(228,240,248); margin:0px; padding:0px 20px; font-size:14px"> 
 <p><a href="http://www.lydsy.com/JudgeOnline/problemset.php?search=tyvj" rel="nofollow" style="color:blue; text-decoration:initial">tyvj</a></p> 
 <div> 
  <br> 
 </div> 
</div> 
<p><br> </p> 
<p><span style="font-size:14px">2D树状数组支持单点修改+求和(1,1)-(x,y)矩形</span></p> 
<p><span style="font-size:14px">因此按照zkw的思路用逆求和数组做(就是把区间修改结构-用2个单点修改的逆求和数组d',{i*d'}代替,神思路)</span></p> 
<p><span style="font-size:14px"></span></p> 
<pre><code class="language-cpp">#include&lt;cstdio&gt;
#include&lt;cstdlib&gt;
#include&lt;cstring&gt;
#include&lt;iostream&gt;
#include&lt;algorithm&gt;
#include&lt;functional&gt;
using namespace std;
#define MAXN (2050)
int lowbit(int x){return x&amp;(-x);}
int n,m,x1,x2,y1,y2,delta;
struct arr_tree
{
	int b[MAXN][MAXN];
	arr_tree(){memset(b,0,sizeof(b));	}
	void add(int x,int y,int c,bool b1,bool b2)
	{
		if (!x||!y||x&gt;n||y&gt;m) return;
		if (b1) c*=(x-1);if (b2) c*=(y-1);if (!c) return;
		for (int i=x;i&lt;=n;i+=lowbit(i))
			for (int j=y;j&lt;=m;j+=lowbit(j)) b[i][j]+=c;		
	}
	int qur(int x,int y)
	{
		if (!x||!y) return 0;
		int ans=0;
		for (int i=x;i;i-=lowbit(i))
			for (int j=y;j;j-=lowbit(j)) ans+=b[i][j];
		return ans;
	}
	void add(int x1,int y1,int x2,int y2,int c,bool b1,bool b2)
	{
		add(x2+1,y2+1,delta,b1,b2),add(x1,y1,delta,b1,b2);
		add(x1,y2+1,-delta,b1,b2),add(x2+1,y1,-delta,b1,b2);		
	}
}d,di,dj,dij;
int Dsum(int x,int y)
{
	return d.qur(x,y)*x*y+dij.qur(x,y)-di.qur(x,y)*y-dj.qur(x,y)*x;
}
int main()
{
	scanf("X %d %d",&amp;n,&amp;m);
	char c;
	while (scanf("%c",&amp;c)==1)
	{
		while (c^'L'&amp;&amp;c^'k') if (scanf("%c",&amp;c)!=1) return 0;
		switch(c)
		{
			case 'L':
				scanf("%d%d%d%d%d",&amp;x1,&amp;y1,&amp;x2,&amp;y2,&amp;delta);
				if (x1&gt;x2) swap(x1,x2),swap(y1,y2);
				d.add(x1,y1,x2,y2,delta,0,0),di.add(x1,y1,x2,y2,-delta,1,0);
				dj.add(x1,y1,x2,y2,-delta,0,1),dij.add(x1,y1,x2,y2,delta,1,1);
				break;
			default:
				scanf("%d%d%d%d",&amp;x1,&amp;y1,&amp;x2,&amp;y2);
				if (x1&gt;x2) swap(x1,x2),swap(y1,y2);
				printf("%d\n",Dsum(x2,y2)+Dsum(x1-1,y1-1)-Dsum(x1-1,y2)-Dsum(x2,y1-1));
		}
	}
}</code></pre> 
<br> 
<br> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b7cc087351d86c59db341f9ce8536df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SecureCRT自动记录日志</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3ea7caf66c86b3bb3ecdfb17c66eff2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL2008 SQL Server 代理服务提供的凭据无效。若要继续操作，请为 SQL Server 代理服务提供有效的帐户</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>