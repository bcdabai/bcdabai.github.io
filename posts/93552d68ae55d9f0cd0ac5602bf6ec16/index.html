<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Idea中使用Antlr4 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Idea中使用Antlr4" />
<meta property="og:description" content="Idea中使用Antlr4 一、新建一个MAVEN项目二、antlr在idea中的使用三、抽象语法树的访问（Vistor方式）抽象语法树的例子例子分析（建议看完 三 和四 再回头看例子的分析）生成的节点类节点的访问方法 四、Antlr4基础类的介绍五、Visitor遍历类 一、新建一个MAVEN项目 （1）new -&gt; project -&gt;maven
（2）在pom文件中引入antlr相关的依赖
pom.xml文件如下
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.wyf&lt;/groupId&gt; &lt;artifactId&gt;Antlr&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.antlr&lt;/groupId&gt; &lt;artifactId&gt;antlr4-runtime&lt;/artifactId&gt; &lt;version&gt;4.9.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.20&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.antlr&lt;/groupId&gt; &lt;artifactId&gt;antlr4&lt;/artifactId&gt; &lt;version&gt;4.9&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;antlr&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;antlr4&lt;/goal&gt; &lt;/goals&gt; &lt;phase&gt;none&lt;/phase&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;outputDirectory&gt;src/test/java&lt;/outputDirectory&gt; &lt;listener&gt;true&lt;/listener&gt; &lt;treatWarningsAsErrors&gt;true&lt;/treatWarningsAsErrors&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;8&lt;/source&gt; &lt;target&gt;8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; （3）安装Antlr插件" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/93552d68ae55d9f0cd0ac5602bf6ec16/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-21T14:30:59+08:00" />
<meta property="article:modified_time" content="2022-04-21T14:30:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Idea中使用Antlr4</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Idea中使用Antlr4</h4> 
 <ul><li><ul><li><a href="#MAVEN_1" rel="nofollow">一、新建一个MAVEN项目</a></li><li><a href="#antlridea_69" rel="nofollow">二、antlr在idea中的使用</a></li><li><a href="#Vistor_113" rel="nofollow">三、抽象语法树的访问（Vistor方式）</a></li><li><ul><li><a href="#_114" rel="nofollow">抽象语法树的例子</a></li><li><a href="#____235" rel="nofollow">例子分析（建议看完 三 和四 再回头看例子的分析）</a></li><li><ul><li><a href="#_236" rel="nofollow">生成的节点类</a></li><li><a href="#_342" rel="nofollow">节点的访问方法</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Antlr4_415" rel="nofollow">四、Antlr4基础类的介绍</a></li><li><a href="#Visitor_438" rel="nofollow">五、Visitor遍历类</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="MAVEN_1"></a>一、新建一个MAVEN项目</h3> 
<p>（1）new -&gt; project -&gt;maven<br> （2）在pom文件中引入antlr相关的依赖<br> pom.xml文件如下</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>wyf<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span><span class="token class-name">Antlr</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>antlr<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>antlr4<span class="token operator">-</span>runtime<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.9</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.18</span><span class="token number">.20</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>antlr<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>antlr4<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>executions<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>execution<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>id<span class="token punctuation">&gt;</span></span>antlr<span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>goals<span class="token punctuation">&gt;</span></span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>antlr4<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>goals<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>phase<span class="token punctuation">&gt;</span></span>none<span class="token operator">&lt;</span><span class="token operator">/</span>phase<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>execution<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>executions<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>outputDirectory<span class="token punctuation">&gt;</span></span>src<span class="token operator">/</span>test<span class="token operator">/</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>outputDirectory<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>listener<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>listener<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>treatWarningsAsErrors<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>treatWarningsAsErrors<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<p>（3）安装Antlr插件<br> <img src="https://images2.imgbox.com/f7/07/8j3kXipy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="antlridea_69"></a>二、antlr在idea中的使用</h3> 
<p>（1）新建一个.g4文件，我在这里新建了一个Calculator.g4文件，来定义一个计算器的文法</p> 
<pre><code class="prism language-java">grammar <span class="token class-name">Calculator</span><span class="token punctuation">;</span>

prog <span class="token operator">:</span> stat<span class="token operator">+</span><span class="token punctuation">;</span>

stat<span class="token operator">:</span>
  expr NEWLINE          # print
  <span class="token operator">|</span> ID <span class="token char">'='</span> expr NEWLINE   # assign
  <span class="token operator">|</span> NEWLINE               # blank
  <span class="token punctuation">;</span>

expr<span class="token operator">:</span>
  expr op<span class="token operator">=</span><span class="token punctuation">(</span><span class="token char">'*'</span><span class="token operator">|</span><span class="token char">'/'</span><span class="token punctuation">)</span> expr    # <span class="token class-name">MulDiv</span>
  <span class="token operator">|</span> expr op<span class="token operator">=</span><span class="token punctuation">(</span><span class="token char">'+'</span><span class="token operator">|</span><span class="token char">'-'</span><span class="token punctuation">)</span> expr        # <span class="token class-name">AddSub</span>
  <span class="token operator">|</span> INT                           # <span class="token keyword">int</span>
  <span class="token operator">|</span> ID                            # id
  <span class="token operator">|</span> <span class="token char">'('</span> expr <span class="token char">')'</span>                  # parenthese
  <span class="token punctuation">;</span>

MUL <span class="token operator">:</span> <span class="token char">'*'</span> <span class="token punctuation">;</span>
DIV <span class="token operator">:</span> <span class="token char">'/'</span> <span class="token punctuation">;</span>
ADD <span class="token operator">:</span> <span class="token char">'+'</span> <span class="token punctuation">;</span>
SUB <span class="token operator">:</span> <span class="token char">'-'</span> <span class="token punctuation">;</span>
ID <span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token operator">-</span>zA<span class="token operator">-</span><span class="token class-name">Z</span><span class="token punctuation">]</span><span class="token operator">+</span> <span class="token punctuation">;</span>
INT <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">+</span> <span class="token punctuation">;</span>
NEWLINE <span class="token operator">:</span><span class="token char">'\r'</span><span class="token operator">?</span> <span class="token char">'\n'</span> <span class="token punctuation">;</span>
DELIMITER <span class="token operator">:</span> <span class="token char">';'</span><span class="token punctuation">;</span>
WS <span class="token operator">:</span> <span class="token punctuation">[</span> \t<span class="token punctuation">]</span><span class="token operator">+</span> <span class="token operator">-&gt;</span> skip<span class="token punctuation">;</span>
</code></pre> 
<p>（2）设置ANTLR的config<br> 如果Output directory where all output is generated 不填写，会在项目的根目录下生成一个gen的文件夹<br> <img src="https://images2.imgbox.com/1c/00/RTYumHNv_o.png" alt="在这里插入图片描述"><br> （3）生成相关文件<br> <img src="https://images2.imgbox.com/95/04/CqYtNfdr_o.png" alt="在这里插入图片描述"><br> （4）生成之后的文件<br> <img src="https://images2.imgbox.com/4e/45/7FQVFSOZ_o.png" alt="在这里插入图片描述"><br> （5）为了看着舒服，我还是把文件移动了<br> <img src="https://images2.imgbox.com/bb/07/2xyyuLLP_o.png" alt="在这里插入图片描述"><br> （6）检验文法（一定要在.g4文件的开始那行右击）<br> <img src="https://images2.imgbox.com/29/38/PEv8MhWj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/31/56/yFz7JNtZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Vistor_113"></a>三、抽象语法树的访问（Vistor方式）</h3> 
<h4><a id="_114"></a>抽象语法树的例子</h4> 
<p>（1）新建一个类继承CalculatorBaseVisitor，实现对抽象语法树节点的遍历，实现计算的功能<br> <img src="https://images2.imgbox.com/ad/24/8zikbibI_o.png" alt="在这里插入图片描述"><br> （2）CalculatorBaseVisitorImp文件的内容</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>astImp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">CalculatorBaseVisitor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">CalculatorParser</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: wyf
 * @date:2022/4/20 21:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculatorVistorImp</span> <span class="token keyword">extends</span> <span class="token class-name">CalculatorBaseVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//存储变量的值</span>
    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> variable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CalculatorVistorImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>variable <span class="token operator">=</span> variable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//遇到print节点，计算结果，打印出来</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitPrint</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>PrintContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> result <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//分别获取expr节点的值，并计算乘除结果</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitMulDiv</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>MulDivContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> param1 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> param2 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>op<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>MUL<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> param1 <span class="token operator">*</span> param2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>op<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>DIV<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> param1 <span class="token operator">/</span> param2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//分别获取expr节点的值，并计算结果</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitAddSub</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>AddSubContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> param1 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> param2 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>op<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>ADD<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> param1 <span class="token operator">+</span> param2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>op<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>SUB<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> param1 <span class="token operator">-</span> param2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//当遇到Id时从变量表获取数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitId</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>IdContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> variable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//当遇到Int节点时直接返回数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitInt</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>IntContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//当遇到赋值语句时，获取右边expr的值存储到变量表中</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">visitAssign</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>AssignContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">ID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> value <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variable<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitAssign</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>（3）测试类<br> <img src="https://images2.imgbox.com/e7/25/zXSIdlcX_o.png" alt="在这里插入图片描述"><br> test.java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>astImp<span class="token punctuation">.</span></span><span class="token class-name">CalculatorVistorImp</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>lexer<span class="token punctuation">.</span></span><span class="token class-name">CalculatorLexer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">CalculatorBaseVisitor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">CalculatorParser</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>ast<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">CalculatorVisitor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>antlr<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">CharStreams</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>antlr<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">CommonTokenStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>antlr<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>tree<span class="token punctuation">.</span></span><span class="token class-name">ParseTree</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: wyf
 * @date:2022/4/20 22:19
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> expression <span class="token operator">=</span> <span class="token string">"a = 12\n"</span> <span class="token operator">+</span>
                <span class="token string">"b = a * 3\n"</span> <span class="token operator">+</span>
                <span class="token string">"a + b\n"</span> <span class="token operator">+</span>
                <span class="token string">"a - b\n"</span><span class="token punctuation">;</span>
        <span class="token class-name">CalculatorLexer</span> lexer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CalculatorLexer</span><span class="token punctuation">(</span><span class="token class-name">CharStreams</span><span class="token punctuation">.</span><span class="token function">fromString</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CommonTokenStream</span> tokens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonTokenStream</span><span class="token punctuation">(</span>lexer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CalculatorParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CalculatorParser</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
        parser<span class="token punctuation">.</span><span class="token function">setBuildParseTree</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParseTree</span> root <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">prog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CalculatorBaseVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> visitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CalculatorVistorImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="____235"></a>例子分析（建议看完 三 和四 再回头看例子的分析）</h4> 
<h5><a id="_236"></a>生成的节点类</h5> 
<p>（1）计算器语法中定义了三条语法规则：prog， stat， expr。antlr4会为每条规则生成一个ParserRuleContext的子类。如果这个语法规则添加了标签，那么为每个标签也生成一个ParserRuleContext的子类，这些类之间的关系，如下图所示<br> <img src="https://images2.imgbox.com/85/63/Ypv1COhQ_o.png" alt="在这里插入图片描述"><br> 各个类之间的继承关系如下图所示：<br> <img src="https://images2.imgbox.com/dd/eb/5M76ZShZ_o.png" alt="在这里插入图片描述"><br> （2）这些类是如何联系起来的呢？<br> 以 prog 规则为例，它对应 ProgContext 类。因为 prog 规则 可以包含多个 stat 规则，所以它必须提供访问子节点 StatContext 的方法。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculatorParser</span> <span class="token keyword">extends</span> <span class="token class-name">Parser</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProgContext</span> <span class="token keyword">extends</span> <span class="token class-name">ParserRuleContext</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">//返回子节点stat列表</span>
		<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatContext</span><span class="token punctuation">&gt;</span></span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">getRuleContexts</span><span class="token punctuation">(</span><span class="token class-name">StatContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//返回第几个stat规则</span>
		<span class="token keyword">public</span> <span class="token class-name">StatContext</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">getRuleContext</span><span class="token punctuation">(</span><span class="token class-name">StatContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token class-name">ProgContext</span><span class="token punctuation">(</span><span class="token class-name">ParserRuleContext</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> invokingState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> invokingState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//返回该规则的id号， RULE＿prog是一个常量</span>
		<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRuleIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token class-name">RULE_prog</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enterProg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exitRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exitProg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> visitor <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorVisitor</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>visitor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visitProg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">return</span> visitor<span class="token punctuation">.</span><span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>继续看stat规则，它对应着StateContext类。因为它为每种情况添加了标签，所以也为每个标签生成了对应的类，这些类都是StateContext的子类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculatorParser</span> <span class="token keyword">extends</span> <span class="token class-name">Parser</span> <span class="token punctuation">{<!-- --></span>
   	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StatContext</span> <span class="token keyword">extends</span> <span class="token class-name">ParserRuleContext</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">public</span> <span class="token class-name">StatContext</span><span class="token punctuation">(</span><span class="token class-name">ParserRuleContext</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> invokingState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> invokingState<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

       <span class="token comment">//返回规则的id</span>
		<span class="token annotation punctuation">@Override</span> 
		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRuleIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token class-name">RULE_stat</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	 
		<span class="token keyword">public</span> <span class="token class-name">StatContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">copyFrom</span><span class="token punctuation">(</span><span class="token class-name">StatContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">copyFrom</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PrintContext</span> <span class="token keyword">extends</span> <span class="token class-name">StatContext</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//返回expr节点</span>
		<span class="token keyword">public</span> <span class="token class-name">ExprContext</span> <span class="token function">expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">getRuleContext</span><span class="token punctuation">(</span><span class="token class-name">ExprContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//返回NEWLINE叶子节点</span>
		<span class="token keyword">public</span> <span class="token class-name">TerminalNode</span> <span class="token function">NEWLINE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>NEWLINE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token class-name">PrintContext</span><span class="token punctuation">(</span><span class="token class-name">StatContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">copyFrom</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enterPrint</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exitRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exitPrint</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//accept方法调用了visitor的visitPrint方法</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> visitor <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorVisitor</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>visitor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visitPrint</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">return</span> visitor<span class="token punctuation">.</span><span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//BlankContext AssignContext 原理类似</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BlankContext</span> <span class="token keyword">extends</span> <span class="token class-name">StatContext</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">public</span> <span class="token class-name">TerminalNode</span> <span class="token function">NEWLINE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser</span><span class="token punctuation">.</span>NEWLINE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token class-name">BlankContext</span><span class="token punctuation">(</span><span class="token class-name">StatContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">copyFrom</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enterBlank</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exitRule</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> listener <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorListener</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorListener</span><span class="token punctuation">)</span>listener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exitBlank</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	   <span class="token comment">//accpet方法调用了visitor的visitBlank方法。</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> visitor <span class="token keyword">instanceof</span> <span class="token class-name">CalculatorVisitor</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CalculatorVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>visitor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visitBlank</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">return</span> visitor<span class="token punctuation">.</span><span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> 
<p>这里只分析了prog 和stat规则， 其余的规则的原理是一样的</p> 
<h5><a id="_342"></a>节点的访问方法</h5> 
<p>上面生成的节点类，都是ParserRuleContest的子类，都实现accept方法。每个类实现方法都不一样，比如ProgContex类，它的accept方法调用了访问者的visitProg方法。而PrintContext类的accept方法对应于访问者的visitPrint方法。<br> 详细情况见上面的代码<br> CaculatorBaseVisitor提供了访问不同节点的方法，默认实现都是调用visit Children方法。它的泛型T表示返回的结果类型。使用者一般继承CaculatorBaseVisitor类，复写一些方法，来实现自定义的功能（比如上面的四则运算的例子）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculatorBaseVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitProg</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>ProgContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitPrint</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>PrintContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitAssign</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>AssignContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitBlank</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>BlankContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitMulDiv</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>MulDivContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitAddSub</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>AddSubContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitParenthese</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>ParentheseContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitId</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>IdContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">/**
	 * {@inheritDoc}
	 *
	 * &lt;p&gt;The default implementation returns the result of calling
	 * {@link #visitChildren} on {@code ctx}.&lt;/p&gt;
	 */</span>
	<span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitInt</span><span class="token punctuation">(</span><span class="token class-name">CalculatorParser<span class="token punctuation">.</span>IntContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Antlr4_415"></a>四、Antlr4基础类的介绍</h3> 
<p>（1）antlr4会将语句解析成一棵树，但是这棵树的数据结构是什么呢？<br> 先来了解一下树的节点，树的节点可以主要分为叶子节点和非叶子节点两类<br> 下面时Antlr4 tree文件夹中的类和接口<br> <img src="https://images2.imgbox.com/f8/6d/oIOJkMSD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1a/5b/bhW1UX4x_o.png" alt="在这里插入图片描述"></p> 
<p>（2）来看一下类的继承关系<br> <img src="https://images2.imgbox.com/48/52/zvRjKkk1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/57/87/oQHEzjLQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/30/Sa9EzGTR_o.png" alt="在这里插入图片描述"><br> （3）各个类的解释如下<br> Tree 接口，是所有节点的接口。它定义了获取父节点，子节点，节点数据的接口<br> SyntaxTree 接口，增加了获取当前节点涉及到的分词范围（antlr4会先将语句分词，然后才将分词解析成树）<br> ParserTree 接口，增加了支持Visitor遍历树的接口<br> TerminalNode 接口，表示叶子节点，增加了获取当前节点的分词（叶子节点表示字符常量，或者在antlr4为文件中的lexer）<br> <strong>TerminalNodeImpl</strong> 类， 实现了TerminalNode接口，表示正常的叶子节点<br> ErrorNodeImpl类，继承TerminalNodeImpl类，表示错误的叶子节点<br> RuleNode 接口，非叶子节点，表示一个句子的语法， 对应antlr4文件中的parser rule<br> RuleContext 类，实现了RuleNode 接口<br> <strong>ParserRuleContext</strong> 类，在RuleContext 的基础上实现了查询子节点的方法，并且支持Listener遍历<br> InterpreterRuleContext 和RuleContextWithAltNum 时用于特殊用途的<br> 在使用的过程中，我们主要使用 TerminalNodeImpl（叶子节点）和 ParserRuleContext（非叶子节点）两个类</p> 
<h3><a id="Visitor_438"></a>五、Visitor遍历类</h3> 
<p>antlr4提供了visitor遍历方式，这个是典型的访问者设计模式。访问者为每个不同类型的节点，实现不同的访问方法。而每个节点实现统一的访问入口<br> ParserTree接口代表着节点，它的同意访问入口是accept方法。<br> T accept(ParseTreeVisitor&lt;? extends T&gt; var1);</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ParseTree</span> <span class="token keyword">extends</span> <span class="token class-name">SyntaxTree</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ParseTree</span> <span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ParseTree</span> <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setParent</span><span class="token punctuation">(</span><span class="token class-name">RuleContext</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">toStringTree</span><span class="token punctuation">(</span><span class="token class-name">Parser</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ParserTree的子类会实现accept方法，比如叶子节点TerminnalNodeImpl，它是调用了访问者的visitTerminal方法，非叶子节点，调用了访问者的visitChildren方法。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TerminalNodeImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TerminalNode</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> visitor<span class="token punctuation">.</span><span class="token function">visitTerminal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuleContext</span> <span class="token keyword">implements</span> <span class="token class-name">RuleNode</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> visitor<span class="token punctuation">.</span><span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>ParserTreeVisitor 接口，定义了对于不同类型节点的访问接口。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//访问数据节点，不区分类型</span>
    <span class="token class-name">T</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">ParseTree</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//访问非叶子节点</span>
    <span class="token class-name">T</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token class-name">RuleNode</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//访问叶子节点</span>
    <span class="token class-name">T</span> <span class="token function">visitTerminal</span><span class="token punctuation">(</span><span class="token class-name">TerminalNode</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//访问出错节点</span>
    <span class="token class-name">T</span> <span class="token function">visitErrorNode</span><span class="token punctuation">(</span><span class="token class-name">ErrorNode</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>AbstractParserTreeVistor 类实现了上述接口，它的visit方法，只是简单的调用了节点的accept方法</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">AbstractParseTreeVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token comment">//节点的accpet方法会根据节点的类型，调用visitor的不同方法</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">ParseTree</span> tree<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> tree<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//对于非叶子节点，会遍历各个节点，然后将结果聚合整理。访问非叶子节点涉及到递归，它是依照深度优先遍历</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span><span class="token class-name">RuleNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//生成默认值</span>
        <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//检测是否继续遍历子节点  this.shouldVisitNextChild(node, result)</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldVisitNextChild</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取子节点</span>
            <span class="token class-name">ParseTree</span> c <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getChild</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//遍历子节点，返回子节点的结果</span>
            <span class="token class-name">T</span> childResult <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//合并子节点的结果</span>
            result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">aggregateResult</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> childResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token comment">//对于叶子节点和出错节点，仅仅是返回一个默认值</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitTerminal</span><span class="token punctuation">(</span><span class="token class-name">TerminalNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitErrorNode</span><span class="token punctuation">(</span><span class="token class-name">ErrorNode</span> node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">T</span> <span class="token function">defaultResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//合并结果，这里只是返回子节点的结果</span>
    <span class="token keyword">protected</span> <span class="token class-name">T</span> <span class="token function">aggregateResult</span><span class="token punctuation">(</span><span class="token class-name">T</span> aggregate<span class="token punctuation">,</span> <span class="token class-name">T</span> nextResult<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> nextResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//默认继续访问</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">shouldVisitNextChild</span><span class="token punctuation">(</span><span class="token class-name">RuleNode</span> node<span class="token punctuation">,</span> <span class="token class-name">T</span> currentResult<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7cbacf492fafd7c71e0bc215b3b49f30/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LeetCode 662. 二叉树的最大宽度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98e0691086f3c7d351e8ba8ee9f4dced/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">国产“芯” · 瑞芯微 RK3568 性能解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>