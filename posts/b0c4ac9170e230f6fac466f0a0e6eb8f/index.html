<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用docker-compose快速搭建Nacos集群详细教程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用docker-compose快速搭建Nacos集群详细教程" />
<meta property="og:description" content="目录
0x00 用处不大的开场白
1、docker-compose简介
2、Nacos简介
0x01 资源及环境准备
1、系统升级到最新
2、Docker安装
3、docker-compose安装
4、数据库准备
0x02 详细安装步骤
0x03 扩展
0x00 用处不大的开场白 1、docker-compose简介 Docker Compose 是一个用于定义和运行多个 Docker 容器的工具。它使用简单的 YAML 文件来定义应用程序的服务、网络和卷等配置，然后可以使用单个命令来启动、停止和管理整个应用程序的容器。 Docker Compose 的一些主要特点和优势：简化多容器应用的管理、声明式配置、快速启动和停止容器、跨平台和可移植性支持扩展和服务发现。
2、Nacos简介 Nacos（全称为 &#34;Dynamic Naming and Configuration Service&#34;，中文名为 &#34;服务发现和配置管理系统&#34;）是阿里巴巴开源的一个用于服务发现、动态配置和服务管理的平台。 Nacos 的一些主要特点和功能：服务发现与注册、动态配置管理、服务路由和负载均衡、服务健康监测、配置共享和推送、命名空间和权限管理。
Nacos 是一个功能强大、可靠且易于使用的服务发现和配置管理系统。它提供了丰富的功能和灵活的配置选项，可以帮助开发人员构建和管理可伸缩、高可用的微服务应用程序。
0x01 资源及环境准备 本教程用到的资源以及对于的版本：
OS：Centos 7.6 64bit
服务器1ip：192.168.1.1
服务器2ip：192.168.1.2
服务器3ip：192.168.1.3
docker：17.06.2-ce
docker-compose：1.12.0
Nacos：2.2.0
DB：MySQL5.7
1、系统升级到最新 把服务器系统升级到最新。（非必选，需自行判断是否需要升级。）
yum update -y 2、Docker安装 运行以下命令进行安装docker 17.06版本，安装可能需要等待一些时间。
curl https://releases.rancher.com/install-docker/17.06.sh | sh 设置开机启动docker
systemctl enable docker 检查是否安装成功" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b0c4ac9170e230f6fac466f0a0e6eb8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-31T20:23:18+08:00" />
<meta property="article:modified_time" content="2023-10-31T20:23:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用docker-compose快速搭建Nacos集群详细教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="0x00%20%E5%BC%80%E5%9C%BA%E7%99%BD-toc" style="margin-left:40px;"><a href="#0x00%20%E5%BC%80%E5%9C%BA%E7%99%BD" rel="nofollow">0x00 用处不大的开场白</a></p> 
<p id="1%E3%80%81docker-compose%E7%AE%80%E4%BB%8B-toc" style="margin-left:80px;"><a href="#1%E3%80%81docker-compose%E7%AE%80%E4%BB%8B" rel="nofollow">1、docker-compose简介</a></p> 
<p id="2%E3%80%81Nacos%E7%AE%80%E4%BB%8B-toc" style="margin-left:80px;"><a href="#2%E3%80%81Nacos%E7%AE%80%E4%BB%8B" rel="nofollow">2、Nacos简介</a></p> 
<p id="0x01%20%E8%B5%84%E6%BA%90%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#0x01%20%E8%B5%84%E6%BA%90%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" rel="nofollow">0x01 资源及环境准备</a></p> 
<p id="1%E3%80%81%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0" rel="nofollow">1、系统升级到最新</a></p> 
<p id="2%E3%80%81docker%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#2%E3%80%81docker%E5%AE%89%E8%A3%85" rel="nofollow">2、Docker安装</a></p> 
<p id="3%E3%80%81docker-compose%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#3%E3%80%81docker-compose%E5%AE%89%E8%A3%85" rel="nofollow">3、docker-compose安装</a></p> 
<p id="4%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87" rel="nofollow">4、数据库准备</a></p> 
<p id="0x02%20%E8%AF%A6%E7%BB%86%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#0x02%20%E8%AF%A6%E7%BB%86%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4" rel="nofollow">0x02 详细安装步骤</a></p> 
<p id="0x03%20%E6%89%A9%E5%B1%95-toc" style="margin-left:40px;"><a href="#0x03%20%E6%89%A9%E5%B1%95" rel="nofollow">0x03 扩展</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="0x00%20%E5%BC%80%E5%9C%BA%E7%99%BD">0x00 用处不大的开场白</h3> 
<h4 id="1%E3%80%81docker-compose%E7%AE%80%E4%BB%8B">1、docker-compose简介</h4> 
<p>Docker Compose 是一个用于定义和运行多个 Docker 容器的工具。它使用简单的 YAML 文件来定义应用程序的服务、网络和卷等配置，然后可以使用单个命令来启动、停止和管理整个应用程序的容器。 </p> 
<p>Docker Compose 的一些主要特点和优势：简化多容器应用的管理、声明式配置、快速启动和停止容器、跨平台和可移植性支持扩展和服务发现。</p> 
<h4 id="2%E3%80%81Nacos%E7%AE%80%E4%BB%8B">2、Nacos简介</h4> 
<p>Nacos（全称为 "Dynamic Naming and Configuration Service"，中文名为 "服务发现和配置管理系统"）是阿里巴巴开源的一个用于服务发现、动态配置和服务管理的平台。 Nacos 的一些主要特点和功能：服务发现与注册、动态配置管理、服务路由和负载均衡、服务健康监测、配置共享和推送、命名空间和权限管理。</p> 
<p>Nacos 是一个功能强大、可靠且易于使用的服务发现和配置管理系统。它提供了丰富的功能和灵活的配置选项，可以帮助开发人员构建和管理可伸缩、高可用的微服务应用程序。</p> 
<h3 id="0x01%20%E8%B5%84%E6%BA%90%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">0x01 资源及环境准备</h3> 
<p>本教程用到的资源以及对于的版本：</p> 
<p>OS：Centos 7.6 64bit</p> 
<p>服务器1ip：192.168.1.1</p> 
<p>服务器2ip：192.168.1.2</p> 
<p>服务器3ip：192.168.1.3</p> 
<p>docker：17.06.2-ce</p> 
<p>docker-compose：1.12.0</p> 
<p>Nacos：2.2.0</p> 
<p>DB：MySQL5.7</p> 
<h4 id="1%E3%80%81%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0">1、系统升级到最新</h4> 
<p>把服务器系统升级到最新。（非必选，需自行判断是否需要升级。）</p> 
<pre><code class="language-bash">yum update -y</code></pre> 
<h4 id="2%E3%80%81docker%E5%AE%89%E8%A3%85">2、Docker安装</h4> 
<p>运行以下命令进行安装docker 17.06版本，安装可能需要等待一些时间。</p> 
<pre><code class="language-bash">curl https://releases.rancher.com/install-docker/17.06.sh | sh</code></pre> 
<p>设置开机启动docker</p> 
<pre><code class="language-bash">systemctl enable docker</code></pre> 
<p>检查是否安装成功</p> 
<pre><code class="language-bash">docker -v</code></pre> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/13/35/AHB2TNFf_o.png"></p> 
<h4 id="3%E3%80%81docker-compose%E5%AE%89%E8%A3%85">3、docker-compose安装</h4> 
<p>在Github上下载需要的版本，mv到/usr/local/bin/目录下，把名字改为 docker-compose ，可以一步完成。已下载的版本是 docker-compose-linux-armv6 为例：</p> 
<pre><code class="language-bash">mv docker-compose-linux-armv6 /usr/local/bin/docker-compose</code></pre> 
<p>下载地址：<a class="link-info" href="https://github.com/docker/compose/releases" title="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a></p> 
<p>添加执行权限</p> 
<pre><code class="language-bash">chmod +x /usr/local/bin/docker-compose</code></pre> 
<p>检查是否安装成功</p> 
<pre><code class="language-bash">docker-compose -v</code></pre> 
<p><img alt="" src="https://images2.imgbox.com/1d/a5/NJneHdzK_o.png"></p> 
<h4 id="4%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87">4、数据库准备</h4> 
<p>自行安装数据库，创建db，且初始化好表结构。</p> 
<p>下面是表机构创建SQL语句：</p> 
<pre><code class="language-sql">/*
 * Copyright 1999-2018 Alibaba Group Holding Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info   */
/******************************************/
CREATE TABLE `config_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) DEFAULT NULL,
  `content` longtext NOT NULL COMMENT 'content',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `c_desc` varchar(256) DEFAULT NULL,
  `c_use` varchar(64) DEFAULT NULL,
  `effect` varchar(64) DEFAULT NULL,
  `type` varchar(64) DEFAULT NULL,
  `c_schema` text,
  `encrypted_data_key` text NOT NULL COMMENT '密钥',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_aggr   */
/******************************************/
CREATE TABLE `config_info_aggr` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `datum_id` varchar(255) NOT NULL COMMENT 'datum_id',
  `content` longtext NOT NULL COMMENT '内容',
  `gmt_modified` datetime NOT NULL COMMENT '修改时间',
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='增加租户字段';


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_beta   */
/******************************************/
CREATE TABLE `config_info_beta` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL COMMENT 'content',
  `beta_ips` varchar(1024) DEFAULT NULL COMMENT 'betaIps',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `encrypted_data_key` text NOT NULL COMMENT '密钥',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_tag   */
/******************************************/
CREATE TABLE `config_info_tag` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',
  `tag_id` varchar(128) NOT NULL COMMENT 'tag_id',
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL COMMENT 'content',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_tags_relation   */
/******************************************/
CREATE TABLE `config_tags_relation` (
  `id` bigint(20) NOT NULL COMMENT 'id',
  `tag_name` varchar(128) NOT NULL COMMENT 'tag_name',
  `tag_type` varchar(64) DEFAULT NULL COMMENT 'tag_type',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',
  `nid` bigint(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`nid`),
  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = group_capacity   */
/******************************************/
CREATE TABLE `group_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `group_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Group ID，空字符表示整个集群',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数，，0表示使用默认值',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_group_id` (`group_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='集群、各Group容量信息表';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = his_config_info   */
/******************************************/
CREATE TABLE `his_config_info` (
  `id` bigint(64) unsigned NOT NULL,
  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `data_id` varchar(255) NOT NULL,
  `group_id` varchar(128) NOT NULL,
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL,
  `md5` varchar(32) DEFAULT NULL,
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',
  `src_user` text,
  `src_ip` varchar(20) DEFAULT NULL,
  `op_type` char(10) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `encrypted_data_key` text NOT NULL COMMENT '密钥',
  PRIMARY KEY (`nid`),
  KEY `idx_gmt_create` (`gmt_create`),
  KEY `idx_gmt_modified` (`gmt_modified`),
  KEY `idx_did` (`data_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='多租户改造';


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = tenant_capacity   */
/******************************************/
CREATE TABLE `tenant_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `tenant_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='租户容量信息表';


CREATE TABLE `tenant_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `kp` varchar(128) NOT NULL COMMENT 'kp',
  `tenant_id` varchar(128) default '' COMMENT 'tenant_id',
  `tenant_name` varchar(128) default '' COMMENT 'tenant_name',
  `tenant_desc` varchar(256) DEFAULT NULL COMMENT 'tenant_desc',
  `create_source` varchar(32) DEFAULT NULL COMMENT 'create_source',
  `gmt_create` bigint(20) NOT NULL COMMENT '创建时间',
  `gmt_modified` bigint(20) NOT NULL COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';

CREATE TABLE users (
	username varchar(50) NOT NULL PRIMARY KEY,
	password varchar(500) NOT NULL,
	enabled boolean NOT NULL
);

CREATE TABLE roles (
	username varchar(50) NOT NULL,
	role varchar(50) NOT NULL,
	constraint uk_username_role UNIQUE (username,role)
);

CREATE TABLE permissions (
    role varchar(50) NOT NULL,
    resource varchar(512) NOT NULL,
    action varchar(8) NOT NULL,
    constraint uk_role_permission UNIQUE (role,resource,action)
);

INSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);

INSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN');
</code></pre> 
<h3 id="0x02%20%E8%AF%A6%E7%BB%86%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4">0x02 详细安装步骤</h3> 
<p>当环境准备妥当后，可以，按照以下步骤进行操作：</p> 
<p>1. 在每台服务器上创建一个用于存储 Nacos 配置和数据、日志目录。</p> 
<pre><code class="language-bash">mkdir -p /data/nacos/{data,logs}</code></pre> 
<p>2. 在每台服务器 `/data/nacos/` 目录下创建一个名为 `docker-compose.yml` 的文件，并在其中添加以下内容：</p> 
<p>服务器1 docker-compose.yml 文件信息如下：</p> 
<pre><code class="language-bash">version: '3'
services:
   nacos-01:
    image: nacos/nacos-server:v2.2.0
    hostname: nacos1
    environment:
      MODE: cluster
      NACOS_SERVERS: 192.168.1.1:8848,192.168.1.2:8848,192.168.1.3:8848
      PREFER_HOST_MODE: hostname
      NACOS_SERVER_IP: 192.168.1.1
      NACOS_SERVER_PORT: '8848'
      SPRING_DATASOURCE_PLATFORM: mysql
      MYSQL_SERVICE_HOST: 192.168.0.108
      MYSQL_SERVICE_PORT: '3306'
      MYSQL_SERVICE_DB_NAME: nacos
      MYSQL_SERVICE_USER: nacos
      MYSQL_SERVICE_PASSWORD: nacos
      nacos.core.auth.enable.userAgentAuthWhite: 'false'
      NACOS_AUTH_TOKEN: qR0o3pYdjRVUjcTVpY1NPW1nRRRH1k=2mWGVRbzWMUUs
      NACOS_AUTH_ENABLE: 'true'
      NACOS_AUTH_CACHE_ENABLE: 'true'
    stdin_open: true
    volumes:
    - /data/nacos/logs:/home/nacos/logs
    - /data/nacos/data:/home/nacos/data
    tty: true
    ports:
    - 8848:8848/tcp
    - 8849:8849/tcp
    - 8850:8850/tcp

networks:
  nacos-network:
    driver: bridge</code></pre> 
<p>服务器2 docker-compose.yml 文件信息如下：</p> 
<pre><code class="language-bash">version: '3'
services:
   nacos-02:
    image: nacos/nacos-server:v2.2.0
    hostname: nacos2
    environment:
      MODE: cluster
      NACOS_SERVERS: 192.168.1.1:8848,192.168.1.2:8848,192.168.1.3:8848
      PREFER_HOST_MODE: hostname
      NACOS_SERVER_IP: 192.168.1.2
      NACOS_SERVER_PORT: '8848'
      SPRING_DATASOURCE_PLATFORM: mysql
      MYSQL_SERVICE_HOST: 192.168.0.108
      MYSQL_SERVICE_PORT: '3306'
      MYSQL_SERVICE_DB_NAME: nacos
      MYSQL_SERVICE_USER: nacos
      MYSQL_SERVICE_PASSWORD: nacos
      nacos.core.auth.enable.userAgentAuthWhite: 'false'
      NACOS_AUTH_TOKEN: qR0o3pYdjRVUjcTVpY1NPW1nRRRH1k=2mWGVRbzWMUUs
      NACOS_AUTH_ENABLE: 'true'
      NACOS_AUTH_CACHE_ENABLE: 'true'
    stdin_open: true
    volumes:
    - /data/nacos/logs:/home/nacos/logs
    - /data/nacos/data:/home/nacos/data
    tty: true
    ports:
    - 8848:8848/tcp
    - 8849:8849/tcp
    - 8850:8850/tcp

networks:
  nacos-network:
    driver: bridge</code></pre> 
<p>服务器3 docker-compose.yml 文件信息如下：</p> 
<pre><code class="language-bash">version: '3'
services:
   nacos-03:
    image: nacos/nacos-server:v2.2.0
    hostname: nacos3
    environment:
      MODE: cluster
      NACOS_SERVERS: 192.168.1.1:8848,192.168.1.2:8848,192.168.1.3:8848
      PREFER_HOST_MODE: hostname
      NACOS_SERVER_IP: 192.168.1.3
      NACOS_SERVER_PORT: '8848'
      SPRING_DATASOURCE_PLATFORM: mysql
      MYSQL_SERVICE_HOST: 192.168.0.108
      MYSQL_SERVICE_PORT: '3306'
      MYSQL_SERVICE_DB_NAME: nacos
      MYSQL_SERVICE_USER: nacos
      MYSQL_SERVICE_PASSWORD: nacos
      nacos.core.auth.enable.userAgentAuthWhite: 'false'
      NACOS_AUTH_TOKEN: qR0o3pYdjRVUjcTVpY1NPW1nRRRH1k=2mWGVRbzWMUUs
      NACOS_AUTH_ENABLE: 'true'
      NACOS_AUTH_CACHE_ENABLE: 'true'
    stdin_open: true
    volumes:
    - /data/nacos/logs:/home/nacos/logs
    - /data/nacos/data:/home/nacos/data
    tty: true
    ports:
    - 8848:8848/tcp
    - 8849:8849/tcp
    - 8850:8850/tcp

networks:
  nacos-network:
    driver: bridge</code></pre> 
<p>在上述配置中，我们使用了 Nacos 官方提供的 Docker 镜像 `nacos/nacos-server:v2.2.0`，并在每台服务器创建了1个服务 nacos服务，它们分别映射到主机的端口 `8848`、`8849` 和 `8850`。服务挂载的数据目录，并设置了环境变量 `MODE=cluster`。</p> 
<p>下面这些是数据库的信息，修改为自己的数据库：</p> 
<p><br>       MYSQL_SERVICE_HOST: 192.168.0.108  //数据库ip<br>       MYSQL_SERVICE_PORT: '3306' //数据库端口<br>       MYSQL_SERVICE_DB_NAME: nacos //数据库DB名<br>       MYSQL_SERVICE_USER: nacos  //数据库账号<br>       MYSQL_SERVICE_PASSWORD: nacos  //数据库密码</p> 
<p></p> 
<p>3. 分别在3台服务器上，打开终端，cd到‘/data/nacos/’目录，即包含 `docker-compose.yml` 文件的目录下，然后运行以下命令启动 Nacos 集群：</p> 
<pre><code class="language-bash">cd /data/nacos/
docker-compose up -d</code></pre> 
<p>这将会在每台服务器的后台，分别启动一个 Nacos集群节点。</p> 
<p>4. 等待一段时间，直到所有容器都启动和初始化完成。到每台服务器上使用以下命令查看容器的状态：</p> 
<pre><code class="language-bash">docker-compose ps</code></pre> 
<p>如果所有容器的状态都显示为 "Up"，则说明 Nacos 集群已经成功运行起来了。</p> 
<p>现在可以通过浏览器访问 `http://{替换为对应的服务器ip}:8848/nacos/#/login` 来访问 Nacos 控制台，并开始使用 Nacos 集群进行服务注册与发现。</p> 
<p>如：http://192.168.1.1:8848/nacos/#/login</p> 
<p>默认账号/密码 nacos/nacos</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c7/c3/zr7sJpuU_o.png"></p> 
<h3 id="0x03%20%E6%89%A9%E5%B1%95">0x03 扩展</h3> 
<p>可以在前端添加一个nginx之类的做负载，来搭建高可用.</p> 
<p></p> 
<p>教程到此结束，如有疑问、问题欢迎在评论留言。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/830321f192dbafad72dffcf17dafaf81/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python 算法高级篇：最短路径算法的优化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75fc4b8c5807be68c8af8def4ef32ae6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IOI车机系统刷机和改包笔记2 - 改包脚本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>