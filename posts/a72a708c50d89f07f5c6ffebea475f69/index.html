<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis java常用封装 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis java常用封装" />
<meta property="og:description" content="@Service public class RedisService { @Autowired private RedissonClient redissonClient; @Resource private RedisTemplate&lt;String, Object&gt; redisTemplate; /** * 建议使用redisson的加锁 释放锁 */ /** * 释放锁成功返回值 */ private static final Long RELEASE_LOCK_SUCCESS_RESULT = 1L; private static final String RELEASE_LOCK_SCRIPT = &#34;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return 0 end&#34;; /** * 模糊查询 获取key集合 * * @param key * @return */ public Iterator&lt;String&gt; getKeys(String key) { Iterable&lt;String&gt; keysByPattern = redissonClient.getKeys().getKeysByPattern(key); Iterator&lt;String&gt; iterator = keysByPattern." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a72a708c50d89f07f5c6ffebea475f69/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-07T13:59:16+08:00" />
<meta property="article:modified_time" content="2023-04-07T13:59:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis java常用封装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-java">@Service
public class RedisService {

    @Autowired
    private RedissonClient redissonClient;

    @Resource
    private RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    /**
     * 建议使用redisson的加锁 释放锁
     */
    /**
     * 释放锁成功返回值
     */
    private static final Long RELEASE_LOCK_SUCCESS_RESULT = 1L;
    private static final String RELEASE_LOCK_SCRIPT = "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end";

    /**
     * 模糊查询 获取key集合
     *
     * @param key
     * @return
     */
    public Iterator&lt;String&gt; getKeys(String key) {
        Iterable&lt;String&gt; keysByPattern = redissonClient.getKeys().getKeysByPattern(key);
        Iterator&lt;String&gt; iterator = keysByPattern.iterator();
        return iterator;
    }

    /**
     * 获取list信息
     *
     * @param key
     * @param clazz
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; List&lt;T&gt; getList(String key, Class&lt;T&gt; clazz) {
        RList&lt;T&gt; list = redissonClient.getList(key);
        List&lt;T&gt; ts = list.readAll();
        return ts;
    }

    /**
     * 添加所有 list信息
     *
     * @param key
     * @param data
     * @param clazz      泛型 （需要实现Serializable接口）
     * @param timeToLive 过期时间 单位（秒）
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; boolean setList(String key, List&lt;T&gt; data, Class&lt;T&gt; clazz, Long timeToLive) {
        RList&lt;T&gt; list = redissonClient.getList(key);
        list.clear();
        boolean b = list.addAll(data);
        list.expire(timeToLive, TimeUnit.SECONDS);
        return b;
    }

    /**
     * 添加所有 list信息
     *
     * @param key
     * @param data
     * @param clazz 泛型 （需要实现Serializable接口）
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; boolean setList(String key, List&lt;T&gt; data, Class&lt;T&gt; clazz) {
        RList&lt;T&gt; list = redissonClient.getList(key);
        list.clear();
        boolean b = list.addAll(data);
        return b;
    }

    /**
     * 追加list
     *
     * @param key
     * @param data
     * @param clazz 泛型 （需要实现Serializable接口）
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; boolean addList(String key, T data, Class&lt;T&gt; clazz) {
        RList&lt;T&gt; list = redissonClient.getList(key);
        boolean b = list.add(data);
        return b;
    }

    /**
     * 追加所有list
     *
     * @param key
     * @param data
     * @param clazz
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; boolean addAllList(String key, List&lt;T&gt; data, Class&lt;T&gt; clazz) {
        RList&lt;T&gt; list = redissonClient.getList(key);
        boolean b = list.addAll(data);
        return b;
    }

    /**
     * 添加String
     *
     * @param key
     * @param data
     */
    public void setString(String key, String data) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(key, new StringCodec());
        bucket.set(data);
    }

    /**
     * 添加String  失效时间
     *
     * @param key
     * @param data
     * @param timeToLive
     */
    public void setString(String key, String data, Long timeToLive) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(key, new StringCodec());
        bucket.set(data);
        bucket.expire(timeToLive, TimeUnit.SECONDS);
    }

    /**
     * 删除redis
     *
     * @param key
     */
    public void delete(String key) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(key, new StringCodec());
        bucket.delete();
    }

    /**
     * 获取String
     *
     * @param key
     */
    public String getString(String key) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(key, new StringCodec());
        String s = bucket.get();
        return s;
    }

    /**
     * 插入对象
     *
     * @param &lt;T&gt;
     * @param key
     * @param t
     * @param timeToLive
     */
    public &lt;T&gt; void setBucket(String key, T t, Long timeToLive) {
        RBucket&lt;Object&gt; bucket = redissonClient.getBucket(key);
        bucket.set(t);
        bucket.expire(timeToLive, TimeUnit.SECONDS);
    }

    /**
     * 插入对象
     *
     * @param key
     * @param t
     * @param clazz
     * @param &lt;T&gt;
     */
    public &lt;T&gt; void setBucket(String key, T t, Class&lt;T&gt; clazz) {
        RBucket&lt;Object&gt; bucket = redissonClient.getBucket(key);
        bucket.set(t);
    }

    /**
     * 获取对象
     *
     * @param key
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; T getBucket(String key, Class&lt;T&gt; clazz) {
        RBucket&lt;T&gt; bucket = redissonClient.getBucket(key);
        T t = bucket.get();
        return t;
    }

    /**
     * 判断key值或内容是否存在
     *
     * @param key
     * @return
     */
    public boolean hasKey(String key) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(key, new StringCodec());
        if (bucket.isExists()) {
            return true;
        } else {
            return false;
        }
    }

    /**
     * 添加map
     *
     * @param name
     * @param key
     * @param value
     * @param &lt;T&gt;
     */
    public &lt;T&gt; void putMap(String name, String key, T value) {
        RMap&lt;String, T&gt; map = redissonClient.getMap(name);
        map.put(key, value);
    }

    /**
     * 添加map
     *
     * @param name
     * @param key
     * @param value
     * @param timeToLive
     * @param &lt;T&gt;
     */
    public &lt;T&gt; void putMap(String name, String key, T value, Long timeToLive) {
        RMap&lt;String, T&gt; map = redissonClient.getMap(name);
        map.put(key, value);
        map.expire(timeToLive, TimeUnit.SECONDS);
    }

    /**
     * 获取map
     *
     * @param name
     * @param key
     * @param &lt;T&gt;
     * @return
     */
    public &lt;T&gt; T getMap(String name, String key) {
        RMap&lt;String, T&gt; map = redissonClient.getMap(name);
        T t = map.get(key);
        return t;
    }

    /**
     * 获取增量
     *
     * @return
     */
    public Long incrementAndGet(String key) {
        return redissonClient.getAtomicLong(key).incrementAndGet();
    }
/*
    *//**
     * 与 tryLock 相对应，用作释放锁
     *
     * @param lockKey
     * @param clientId
     * @return
     *//*
    public Boolean releaseLock(String lockKey, String clientId) {
        DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;Long&gt;(RELEASE_LOCK_SCRIPT, Long.class);
        Long result = redisTemplate.execute(redisScript, Collections.singletonList(lockKey), clientId);
        return Objects.equals(result, RELEASE_LOCK_SUCCESS_RESULT);
    }

    *//**
     * 该加锁方法仅针对单实例 Redis 可实现分布式加锁
     * 对于 Redis 集群则无法使用
     * &lt;p&gt;
     * 支持重复，线程安全
     * 建议使用Redisson加锁
     * @param lockKey  加锁键
     * @param clientId 加锁客户端唯一标识(采用UUID)
     * @param seconds  锁过期时间
     * @return
     *//*
    public Boolean tryLock(String lockKey, String clientId, long seconds) {
        Boolean ret = redisTemplate.opsForValue().setIfAbsent(lockKey, clientId, seconds, TimeUnit.SECONDS);
        return ret;
    }*/

    /***
     * 尝试直接加锁
     * @param key
     * @return
     */
    public boolean tryLock(String key) {
        RLock lock = redissonClient.getLock(key);
        return lock.tryLock();
    }

    /**
     * 尝试加锁
     *
     * @param key
     * @param leaseTime 加锁时间
     * @return
     */
    public boolean tryLock(String key, Long leaseTime) {
        Boolean result = false;
        try {
            RLock lock = redissonClient.getLock(key);
            result = lock.tryLock(0, leaseTime, TimeUnit.SECONDS);
        } catch (InterruptedException e) {
            return false;
        }
        return result;
    }


    /**
     * 尝试加锁
     *
     * @param key
     * @param waitTime  等待时间
     * @param leaseTime 加锁时间
     * @return
     */
    public boolean tryLock(String key, Long waitTime, Long leaseTime) {
        Boolean result = false;
        try {
            RLock lock = redissonClient.getLock(key);
            result = lock.tryLock(waitTime, leaseTime, TimeUnit.SECONDS);
        } catch (InterruptedException e) {
            return false;
        }
        return result;
    }

    /**
     * 释放锁
     *
     * @param key
     */
    public void unLock(String key) {
        try {
            RLock lock = redissonClient.getLock(key);
            lock.unlock();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/574bc3c925bceb0b0859c03760db2984/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在HTML5中使用CSS3实现按钮效果？底层原理是什么？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a924940f3668c508f4d637a3e8508c96/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTML5中的IndexedDB是什么？它有什么用途？底层原理是什么？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>