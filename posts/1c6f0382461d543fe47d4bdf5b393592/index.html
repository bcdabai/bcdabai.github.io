<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>.git文件过大，github仓库瘦身 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content=".git文件过大，github仓库瘦身" />
<meta property="og:description" content="前几天发现github的仓库非常庞大，down下来有近一个G。虽然把大文件删除了，但是.git文件夹还是占用很大空间，查询资料发现是因为有些文件虽然被删除了，但是github还会保留它的历史日志。所以采用下面的方式将大文件彻底删除。
PS:如果不想费事又想clone的时候快一点，只需要在命令行后面加--depth=1，就会只clone最后一次commit的内容。例如
git clone https://github.com/Wuchenwcf/MyCode.git --depth==1 1.识别出最大的三个文件 git verify-pack -v .git/objects/pack/pack-8eaeb...9e.idx | sort -k 3 -n | tail -3
红色部分对应你github仓库目录下的相应位置，笔者的是
执行结果如下:
$git verify-pack -v .git/objects/pack/pack-44647d872a2ee43463eda7c6f620b9cd88a79a9a.idx | sort -k 3 -n | tail -3
296169a146c50dbc100a5d0ee5be87a45cd7cbb3 blob 50296832 49474116 291684796
aae2c1bf6109f2729502349722b4c3402626d755 blob 77762481 77330392 78759794
35047899fd3b0dd637b0da2086e7a70fe27b1ccb blob 100534272 100014418 191670176
2、查询大文件的文件名 git rev-list --objects --all | grep 35047899fd3b0dd637b0da2086e7a70fe27b1ccb
红色部分对应上一步的绿色部分
执行结果如下:
git rev-list --objects --all | grep 35047899fd3b0dd637b0da2086e7a70fe27b1ccb
35047899fd3b0dd637b0da2086e7a70fe27b1ccb C#/道路车流量统计1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web.exe
3、将该文件从历史记录的所有 tree 中移除 git log --pretty=oneline --branches -- C#/道路车流量统计1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1c6f0382461d543fe47d4bdf5b393592/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-09-08T17:03:03+08:00" />
<meta property="article:modified_time" content="2018-09-08T17:03:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">.git文件过大，github仓库瘦身</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;">前几天发现github的仓库非常庞大，down下来有近一个G。虽然把大文件删除了，但是.git文件夹还是占用很大空间，查询资料发现是因为有些文件虽然被删除了，但是github还会保留它的历史日志。所以采用下面的方式将大文件彻底删除。</p> 
<p style="margin-left:0cm;">PS:如果不想费事又想clone的时候快一点，只需要在命令行后面加--depth=1，就会只clone最后一次commit的内容。例如</p> 
<pre class="has"><code class="language-cpp">git clone https://github.com/Wuchenwcf/MyCode.git --depth==1</code></pre> 
<h3 style="margin-left:0cm;">1.识别出最大的三个文件</h3> 
<p style="margin-left:0cm;">git verify-pack -v .git/objects/pack/<span style="color:#ff0000;">pack-8eaeb...9e.idx</span> | sort -k 3 -n | tail -3</p> 
<p style="margin-left:0cm;"><span style="color:#ff0000;">红色部分对应你</span><span style="color:#ff0000;">github</span><span style="color:#ff0000;">仓库目录下的相应位置，笔者的是</span></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="108" src="https://images2.imgbox.com/64/1e/C9QJdDqN_o.png" width="554"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">执行结果如下:</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">$git verify-pack -v .git/objects/pack/pack-44647d872a2ee43463eda7c6f620b9cd88a79a9a.idx | sort -k 3 -n | tail -3</p> 
<p style="margin-left:0cm;">296169a146c50dbc100a5d0ee5be87a45cd7cbb3 blob   50296832 49474116 291684796</p> 
<p style="margin-left:0cm;">aae2c1bf6109f2729502349722b4c3402626d755 blob   77762481 77330392 78759794</p> 
<p style="margin-left:0cm;"><span style="color:#86ca5e;">35047899fd3b0dd637b0da2086e7a70fe27b1ccb</span> blob   100534272 100014418 191670176</p> 
<h3 style="margin-left:0cm;">2、查询大文件的文件名</h3> 
<p style="margin-left:0cm;">git rev-list --objects --all | grep <span style="color:#ff0000;">35047899fd3b0dd637b0da2086e7a70fe27b1ccb</span></p> 
<p style="margin-left:0cm;"><span style="color:#ff0000;">红色部分对应上一步的绿色部分</span></p> 
<p style="margin-left:0cm;">执行结果如下:</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">git rev-list --objects --all | grep 35047899fd3b0dd637b0da2086e7a70fe27b1ccb</p> 
<p style="margin-left:0cm;">35047899fd3b0dd637b0da2086e7a70fe27b1ccb <span style="color:#86ca5e;">C#/道路车流量统计1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web.exe</span></p> 
<h3 style="margin-left:0cm;">3、将该文件从历史记录的所有 tree 中移除</h3> 
<p style="margin-left:0cm;">git log --pretty=oneline --branches --  <span style="color:#ff0000;">C#/</span><span style="color:#ff0000;">道路车流量统计</span><span style="color:#ff0000;">1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web.exe</span></p> 
<p style="margin-left:0cm;"><span style="color:#ff0000;">红色部分对应上一步的绿色部分</span></p> 
<p style="margin-left:0cm;">执行结果如下</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">git log --pretty=oneline --branches --  C#/道路车流量统计1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web.exe</p> 
<p style="margin-left:0cm;">504a94cc041285f5d9c3d9e40f0ffa3c02e1a07d 删除没用的代码</p> 
<p style="margin-left:0cm;">a821b64402c37f7efa01b6dca904ce6d8bdefa77 车辆检测</p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;">4、用 filter-branch 命令重写所有 commit 才能将文件从 Git 历史中完全移除。</h3> 
<p style="margin-left:0cm;">git filter-branch --index-filter 'git rm --cached --ignore-unmatch   <span style="color:#ff0000;">C#/</span><span style="color:#ff0000;">道路车流量统计</span><span style="color:#ff0000;">1/Matlab/HeadlightTracking/for_redistribution/MyAppInstaller_web.exe</span>'</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#ff0000;">红色部分对应第二步的绿色部分，注意不要忘记</span><span style="color:#ff0000;">’</span><span style="color:#ff0000;">符号</span></p> 
<h3 style="margin-left:0cm;">5、依次执行以下命令，便可删除</h3> 
<pre class="has"><code class="language-cpp">rm -rf .git/refs/original/

git reflog expire --expire=now --all

git fsck --full --unreachable

git repack -A -d

git gc --aggressive --prune=now

git push --force</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb004c80b66d79565da1b325b2720585/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringMVC  实现简单的文件上传和下载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/495ceb348d6ab4df4c81d51d694f2e07/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用gdb查看挂掉程序堆栈信息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>