<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java.io.EOFException: Unexpected end of ZLIB input stream解决 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java.io.EOFException: Unexpected end of ZLIB input stream解决" />
<meta property="og:description" content="EOFException 表示异常文件结尾，说明读取的数据是不完整的。我在线上就遇到过类似的问题，在请求高峰时期就抛出了这个异常。下面是我的代码：
FileOutputStream fileOutputStream = null; try { //得到文件 File file = new File(fileName); fileOutputStream = new FileOutputStream(file); IOUtils.write(dataByte, fileOutputStream); // 在这里及时的close掉fileOutputStream //读取图片 BufferedImage bi = ImageIO.read(file); pictureProcessVo.setWidth(bi.getWidth()); //获得 宽度 pictureProcessVo.setHeight(bi.getHeight()); //获得 高度 // other operation // delete file FileUtils.deleteQuietly(file); } catch (Exception e) { LOGGER.error(&#34;get pic width and height error&#34;, e); } finally { IOUtils.closeQuietly(fileOutputStream); } 出现的异常： javax.imageio.IIOException: Error reading PNG image data at com.sun.imageio.plugins.png.PNGImageReader.readImage(PNGImageReader.java:1345) at com.sun.imageio.plugins.png.PNGImageReader.read(PNGImageReader.java:1614) at javax." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/66a2054274de464cf36c0590f290285b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-05T17:57:02+08:00" />
<meta property="article:modified_time" content="2017-08-05T17:57:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java.io.EOFException: Unexpected end of ZLIB input stream解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><code>EOFException</code> 表示异常文件结尾，说明读取的数据是不完整的。我在线上就遇到过类似的问题，在请求高峰时期就抛出了这个异常。下面是我的代码：</p> 
<pre class="prettyprint"><code class=" hljs php">   FileOutputStream fileOutputStream = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//得到文件</span>
            File file = <span class="hljs-keyword">new</span> File(fileName);
            fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(file);
            IOUtils.write(dataByte, fileOutputStream);
            <span class="hljs-comment">// 在这里及时的close掉fileOutputStream</span>
            <span class="hljs-comment">//读取图片</span>
            BufferedImage bi = ImageIO.read(file);

            pictureProcessVo.setWidth(bi.getWidth()); <span class="hljs-comment">//获得 宽度</span>
            pictureProcessVo.setHeight(bi.getHeight()); <span class="hljs-comment">//获得 高度</span>
            <span class="hljs-comment">// other operation</span>
            <span class="hljs-comment">// delete file</span>
            FileUtils.deleteQuietly(file);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> e) {
            LOGGER.error(<span class="hljs-string">"get pic width and height error"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            IOUtils.closeQuietly(fileOutputStream);
        }</code></pre> 
<p>出现的异常： </p> 
<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-label">javax.imageio.IIOException:</span> Error reading PNG image data
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.plugins</span><span class="hljs-preprocessor">.png</span><span class="hljs-preprocessor">.PNGImageReader</span><span class="hljs-preprocessor">.readImage</span>(PNGImageReader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1345</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.plugins</span><span class="hljs-preprocessor">.png</span><span class="hljs-preprocessor">.PNGImageReader</span><span class="hljs-preprocessor">.read</span>(PNGImageReader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1614</span>)
    at javax<span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.ImageIO</span><span class="hljs-preprocessor">.read</span>(ImageIO<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1448</span>)
    at javax<span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.ImageIO</span><span class="hljs-preprocessor">.read</span>(ImageIO<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1308</span>)
    at me<span class="hljs-preprocessor">.ele</span><span class="hljs-preprocessor">.commodity</span><span class="hljs-preprocessor">.spu</span><span class="hljs-preprocessor">.service</span><span class="hljs-preprocessor">.impl</span><span class="hljs-preprocessor">.CommodityDataProcessServiceImpl</span><span class="hljs-preprocessor">.downloadPicture</span>(CommodityDataProcessServiceImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">164</span>)
    at me<span class="hljs-preprocessor">.ele</span><span class="hljs-preprocessor">.commodity</span><span class="hljs-preprocessor">.spu</span><span class="hljs-preprocessor">.service</span><span class="hljs-preprocessor">.impl</span><span class="hljs-preprocessor">.CommodityDataProcessServiceImpl</span><span class="hljs-preprocessor">.getCheckedPicList</span>(CommodityDataProcessServiceImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">207</span>)
    at me<span class="hljs-preprocessor">.ele</span><span class="hljs-preprocessor">.commodity</span><span class="hljs-preprocessor">.spu</span><span class="hljs-preprocessor">.service</span><span class="hljs-preprocessor">.impl</span><span class="hljs-preprocessor">.CommodityDataProcessServiceImpl</span><span class="hljs-preprocessor">.asyncPictureListAndDataLog</span>(CommodityDataProcessServiceImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">88</span>)
    at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.GeneratedMethodAccessor</span>327<span class="hljs-preprocessor">.invoke</span>(Unknown Source)
    at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">498</span>)
    at org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.aop</span><span class="hljs-preprocessor">.support</span><span class="hljs-preprocessor">.AopUtils</span><span class="hljs-preprocessor">.invokeJoinpointUsingReflection</span>(AopUtils<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">333</span>)
    at org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.aop</span><span class="hljs-preprocessor">.framework</span><span class="hljs-preprocessor">.ReflectiveMethodInvocation</span><span class="hljs-preprocessor">.invokeJoinpoint</span>(ReflectiveMethodInvocation<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">190</span>)
    at org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.aop</span><span class="hljs-preprocessor">.framework</span><span class="hljs-preprocessor">.ReflectiveMethodInvocation</span><span class="hljs-preprocessor">.proceed</span>(ReflectiveMethodInvocation<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">157</span>)
    at org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.aop</span><span class="hljs-preprocessor">.interceptor</span><span class="hljs-preprocessor">.AsyncExecutionInterceptor</span>$1<span class="hljs-preprocessor">.call</span>(AsyncExecutionInterceptor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">115</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">748</span>)
Caused by: java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.EOFException</span>: Unexpected end of ZLIB input stream
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.zip</span><span class="hljs-preprocessor">.InflaterInputStream</span><span class="hljs-preprocessor">.fill</span>(InflaterInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.zip</span><span class="hljs-preprocessor">.InflaterInputStream</span><span class="hljs-preprocessor">.read</span>(InflaterInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">158</span>)
    at java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.BufferedInputStream</span><span class="hljs-preprocessor">.fill</span>(BufferedInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">246</span>)
    at java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.BufferedInputStream</span><span class="hljs-preprocessor">.read</span>1(BufferedInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">286</span>)
    at java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.BufferedInputStream</span><span class="hljs-preprocessor">.read</span>(BufferedInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">345</span>)
    at java<span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.DataInputStream</span><span class="hljs-preprocessor">.readFully</span>(DataInputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">195</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.plugins</span><span class="hljs-preprocessor">.png</span><span class="hljs-preprocessor">.PNGImageReader</span><span class="hljs-preprocessor">.decodePass</span>(PNGImageReader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1119</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.plugins</span><span class="hljs-preprocessor">.png</span><span class="hljs-preprocessor">.PNGImageReader</span><span class="hljs-preprocessor">.decodeImage</span>(PNGImageReader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1223</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.imageio</span><span class="hljs-preprocessor">.plugins</span><span class="hljs-preprocessor">.png</span><span class="hljs-preprocessor">.PNGImageReader</span><span class="hljs-preprocessor">.readImage</span>(PNGImageReader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1338</span>)
    ... <span class="hljs-number">17</span> more</code></pre> 
<p>当往输出流fileOutputStream里写数据的时候，如果fileOutputStream没有及时的close掉，导致数据不完整。在一个流里，close操作可以将缓冲的数据给冲出来，或会在生成的文件里填充一些信息。所以往输出流里写数据然后到一个具体的文件，及时的close掉输出流是很有必要的。</p> 
<p>另外这个代码也是有问题的，并发访问的时候，如果图片文件名相同也会导致生成的图片出现问题，<code>线程1</code>读取data byte array生成了<code>图片1</code>，准备去读取<code>图片1</code>，然后<code>线程2</code>开始生成相同文件名的图片去覆盖<code>图片1</code>，然后<code>线程1</code>读取到了数据不完整的<code>图片1</code> 而出现异常。</p> 
<p>可以参考另外一个例子： <br> <a href="http://blog.csdn.net/Revivedsun/article/details/52073554" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/Revivedsun/article/details/52073554</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/957ac6c80295a11051576890cf607dc4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows 搭建Git服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a0934a2bdc9e1894ca5a215da3e256a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">html中a标签点击状态失效（覆盖）——link,visited,hover,active的顺序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>