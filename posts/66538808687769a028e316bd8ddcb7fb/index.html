<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QT 网络编程之主机信息查询（QHostInfo 和 QNetworkInterface类）简介 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QT 网络编程之主机信息查询（QHostInfo 和 QNetworkInterface类）简介" />
<meta property="og:description" content="Qt 网络模块提供了用于编写 TCP/IP 客户端和服务器端程序的各种类，如用于 TCP 通信的QTcpSocket 和 QTcpServer，用于 UDP 通信的 QUdpSocket，还有用于实现 HTTP、FTP 等普通网络协议的高级类如 QNetworkRequest，QNetworkReply 和QNetworkAccessManager。Qt 网络模块还提供用于网络代理、网络承载管理的类，提供基于安全套接字层(Secure Sockets Layer，SSL)协议的安全网络通信的类。
要在程序中使用 Qt 网络模块，需要在项目配置文件中增加一条配置语句:
Qt &#43;= network
1、QHostInfo 和 QNetworkInterface 类
查询一个主机的MAC地址或IP 地址是网络应用程序中经常用到的功能,Qt提供了QHostInfo和QNetworkInterface 类可以用于此类信息的查询。
QHostInfo 的静态函数 localHostName()可获取本机的主机名，静态函数 fromName()可以通过主机名获取IP 地址，静态函数 lookupHost()可以通过一个主机名，以异步方式查找这个主机的IP地址。下表是QHostInfo 类主要的功能函数(省略了函数中的const 关键字)。
类别
函数原型
作用
公共函数
QList&lt;QHostAddress&gt; addresses()
HostInfoError error()
QString errorString()
QString hostName()
int lookupld()
返回与 hostname()主机关联的IP 地址列表
如果主机查找失败，返回失败类型
如果主机查找失败，返回错误描述字符串
返回通过 IP查找的主机的名称
返回本次查找的ID
静态函数
void abortHostLookup(int id)
QHostInfo fromName(QString &amp;name)
QString localDomainName()" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/66538808687769a028e316bd8ddcb7fb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-28T11:19:07+08:00" />
<meta property="article:modified_time" content="2023-04-28T11:19:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QT 网络编程之主机信息查询（QHostInfo 和 QNetworkInterface类）简介</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Qt 网络模块提供了用于编写 TCP/IP 客户端和服务器端程序的各种类，如用于 TCP 通信的QTcpSocket 和 QTcpServer，用于 UDP 通信的 QUdpSocket，还有用于实现 HTTP、FTP 等普通网络协议的高级类如 QNetworkRequest，QNetworkReply 和QNetworkAccessManager。Qt 网络模块还提供用于网络代理、网络承载管理的类，提供基于安全套接字层(Secure Sockets Layer，SSL)协议的安全网络通信的类。</p> 
<p>要在程序中使用 Qt 网络模块，需要在项目配置文件中增加一条配置语句:<br> Qt += network</p> 
<p>1、QHostInfo 和 QNetworkInterface 类</p> 
<p>查询一个主机的MAC地址或IP 地址是网络应用程序中经常用到的功能,Qt提供了QHostInfo和QNetworkInterface 类可以用于此类信息的查询。</p> 
<p>QHostInfo 的静态函数 localHostName()可获取本机的主机名，静态函数 fromName()可以通过主机名获取IP 地址，静态函数 lookupHost()可以通过一个主机名，以异步方式查找这个主机的IP地址。下表是QHostInfo 类主要的功能函数(省略了函数中的const 关键字)。</p> 
<table border="1" cellspacing="0" style="width:482pt;"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:35.45pt;"> <p style="margin-left:0;">类别</p> </td><td style="border-color:#000000;vertical-align:top;width:198.1pt;"> <p style="margin-left:0;">函数原型</p> </td><td style="border-color:#000000;vertical-align:top;width:248.45pt;"> <p style="margin-left:0;">作用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:35.45pt;"> <p style="margin-left:0;">公共函数</p> </td><td style="vertical-align:top;width:198.1pt;"> <p style="margin-left:0;">QList&lt;QHostAddress&gt; addresses()</p> <p style="margin-left:0;">HostInfoError error()</p> <p style="margin-left:0;">QString errorString()</p> <p style="margin-left:0;">QString hostName()</p> <p style="margin-left:0;">int lookupld()</p> </td><td style="vertical-align:top;width:248.45pt;"> <p style="margin-left:0;">返回与 hostname()主机关联的IP 地址列表</p> <p style="margin-left:0;">如果主机查找失败，返回失败类型</p> <p style="margin-left:0;">如果主机查找失败，返回错误描述字符串</p> <p style="margin-left:0;">返回通过 IP查找的主机的名称</p> <p style="margin-left:0;">返回本次查找的ID</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:35.45pt;"> <p style="margin-left:0;">静态函数</p> </td><td style="vertical-align:top;width:198.1pt;"> <p style="margin-left:0;">void abortHostLookup(int id)</p> <p style="margin-left:0;">QHostInfo fromName(QString &amp;name)</p> <p style="margin-left:0;">QString localDomainName()</p> <p style="margin-left:0;">QString localHostName()</p> <p style="margin-left:0;">int lookupHost(QString&amp;name,</p> <p style="margin-left:0;">QObiect*receiver,char *member)</p> </td><td style="vertical-align:top;width:248.45pt;"> <p style="margin-left:0;">中断主机查找</p> <p style="margin-left:0;">返回指定的主机名的IP 地址</p> <p style="margin-left:0;">返回本机DNS域名</p> <p style="margin-left:0;">返回本机主机名</p> <p style="margin-left:0;">以异步方式根据主机名查找主机的 IP 地址，并返回一个表示本次查找的ID，可用于 abortHostLookup()</p> </td></tr></tbody></table> 
<p>QNetworkInterface 可以获得运行应用程序的主机的所有 IP 地址和网络接口列表。静态函数allInterfaces()返回主机上所有的网络接口的列表，一个网络接口可能包括多个的IP 地址，每个IP地址与掩码或广播地址关联。如果无需知道子网掩码和广播的IP 地址,使用静态函数 allAddresses()可以获得主机上的所有IP 地址列表。下表是QNetworkInterface 类的主要功能函数。</p> 
<table border="1" cellspacing="0" style="margin-left:-1.7pt;width:460.7pt;"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:42.55pt;"> <p style="margin-left:0;">类别</p> </td><td style="border-color:#000000;vertical-align:top;width:184.3pt;"> <p style="margin-left:0;">函数原型</p> </td><td style="border-color:#000000;vertical-align:top;width:233.85pt;"> <p style="margin-left:0;">作用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:42.55pt;"> <p style="margin-left:0;">公共函数</p> </td><td style="vertical-align:top;width:184.3pt;"> <p style="margin-left:0;">QList&lt;QNetworkAddressEntry&gt; addressEntries()</p> <p style="margin-left:0;"></p> <p style="margin-left:0;">OString hardwareAddress()</p> <p style="margin-left:0;"></p> <p style="margin-left:0;">QString humanReadableName()</p> <p style="margin-left:0;"></p> <p style="margin-left:0;">bool isValid()</p> <p style="margin-left:0;">QString name()</p> </td><td style="vertical-align:top;width:233.85pt;"> <p style="margin-left:0;">返回该网络接口(包括子网掩码和广播地址)的IP 地址列表</p> <p style="margin-left:0;"></p> <p style="margin-left:0;">返回该接口的低级硬件地址，以太网里就是 MAC 地址</p> <p style="margin-left:0;">返回可以读懂的接口名称，如果名称不确定，得到的就是name()函数的返回值</p> <p style="margin-left:0;">如果接口信息有效就返回 true</p> <p style="margin-left:0;">返回网络接口名称</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:42.55pt;"> <p style="margin-left:0;">静态函数</p> </td><td style="vertical-align:top;width:184.3pt;"> <p style="margin-left:0;">QList&lt;QHostAddress&gt; allAddresses()</p> <p style="margin-left:0;">QList&lt;QNetworkInterface&gt; allInterfaces()</p> </td><td style="vertical-align:top;width:233.85pt;"> <p style="margin-left:0;">返回主机上所有 IP 地址的列表</p> <p style="margin-left:0;"></p> <p style="margin-left:0;">返回主机上所有接口的网络列表</p> </td></tr></tbody></table> 
<p>为演示这两个类的主要功能，创建一个窗口基于 QDialog 的应用程序实例运行时界面如下图所示。对话框界面由 UI设计器设计,主要代码都是各按钮的 clicked()信号的槽函数。</p> 
<p><img alt="" height="496" src="https://images2.imgbox.com/21/6f/AbDhJpVC_o.png" width="467"></p> 
<p>窗口上的“QHostInf 取本机主机名和I地址”按的响应代码如下:</p> 
<pre><code class="hljs">void HostDialog::on_btnGetHostInfo_clicked()
{
    QString hostName = QHostInfo::localHostName();
    ui-&gt;textInfo-&gt;appendPlainText(("本机主机名称:") + hostName + "\n" );
    QHostInfo hostInfo = QHostInfo::fromName(hostName);
    QList&lt;QHostAddress&gt; addList = hostInfo.addresses();
    if(addList.isEmpty())
    {
        return;
    }
    for(int i = 0; i &lt; addList.count(); i++)
    {
        QHostAddress host = addList.at(i);
        bool show = ui-&gt;chkOnlyIPv4-&gt;isChecked();
        if(show)
        {
            show = (QAbstractSocket::IPv4Protocol == host.protocol());
        }
        else{
            show = true;
        }
        if(show)
        {
            ui-&gt;textInfo-&gt;appendPlainText("协议:" + protocolName(host.protocol()));
            ui-&gt;textInfo-&gt;appendPlainText("本机IP地址:" + host.toString());
            ui-&gt;textInfo-&gt;appendPlainText("");
        }

    }
}</code></pre> 
<p> 查找主机地址信息</p> 
<p>QHostInfo 的静态函数 lokupHost()可以根据主机名、域名或 IP 地址查找主机的地址信息lookupHost()函数原型如下:<br> int QHostInfo::lookupHost(const QString &amp;name, QObject *receiver, const char *member)</p> 
<p>输入参数 name 是表示主机名的字符串，可以是一个主机名、一个域名，或者是一个IP 地址lookupHost()以异步方式查找主机地址，参数 receiver 和 member 指定一个响应槽函数的接收者和槽函数名称。执行 lookupHost()后，程序可能需要花一定时间来查找主机地址，但不会阻塞程序的运行。当查找到主机地址后，通过信号通知设定的槽函数，在槽函数里读取查找的结果。函数返回一个表示查找的ID。<br> 窗口“OHostInfo 查找域名的IP 地址”按的槽函数及 lokupHost()函数关联槽函数代码如下:</p> 
<pre><code class="hljs">void HostDialog::on_btnLookup_clicked()
{
    QString hostname = ui-&gt;lineEdit-&gt;text();
    ui-&gt;textInfo-&gt;appendPlainText("正在查找主机信息:" + hostname);
    QHostInfo::lookupHost(hostname, this, SLOT(lookedUpHostInfo(QHostInfo)));
}

void HostDialog::lookedUpHostInfo(const QHostInfo &amp;host)
{
    QList&lt;QHostAddress&gt; addList = host.addresses();
    if(addList.isEmpty())
    {
        return;
    }
    for(int i = 0; i &lt; addList.count(); i++)
    {
        QHostAddress aHost = addList.at(i);
        bool show = ui-&gt;chkOnlyIPv4-&gt;isChecked();
        if(show)
        {
            show = QAbstractSocket::IPv4Protocol == aHost.protocol();
        }
        else{
            show = true;
        }
        if(show)
        {
            ui-&gt;textInfo-&gt;appendPlainText("协议:" + protocolName(aHost.protocol()));
            ui-&gt;textInfo-&gt;appendPlainText(aHost.toString());
        }
    }
}</code></pre> 
<p>QNetworkInterface 可以获得应用程序所在主机的所有网络接口，包括其子网码和广播地址等静态函数QNetworkInterface::allInterfaces()获取所有网络接口的列表，函数原型为:</p> 
<p>QList&lt;QNetworkInterface&gt; QNetworkInterface::allInterfaces()</p> 
<p>其返回结果是一个QNetworkInterface 类的列表。界面上“QNetworkInterface::allInterfaces()”按钮的响应代码如下:</p> 
<pre><code class="hljs">void HostDialog::on_btnAllInterfaces_clicked()
{
    QList&lt;QNetworkInterface&gt; list = QNetworkInterface::allInterfaces();
    for(int i = 0; i &lt; list.count(); i++)
    {
        QNetworkInterface interface = list.at(i);
        if(!interface.isValid())
        {
            continue;
        }
        ui-&gt;textInfo-&gt;appendPlainText("设备名称:" + interface.humanReadableName());
        ui-&gt;textInfo-&gt;appendPlainText("硬件地址:" + interface.hardwareAddress());
        QList&lt;QNetworkAddressEntry&gt; entryList = interface.addressEntries();
        for(int j = 0; j &lt; entryList.count(); j++)
        {
            QNetworkAddressEntry entry = entryList.at(j);
            ui-&gt;textInfo-&gt;appendPlainText("IP 地址:" + entry.ip().toString());
            ui-&gt;textInfo-&gt;appendPlainText("子网掩码:" + entry.netmask().toString());
            ui-&gt;textInfo-&gt;appendPlainText("广播地址:" + entry.broadcast().toString() + "\n");
            ui-&gt;textInfo-&gt;appendPlainText("\n");
        }
    }
}</code></pre> 
<p>通过QNetworkInterface::allInterfaces()获取网络接口列表 list之后,显示每个接口的humanReadableName()和 hardwareAddress()。每个接口又有一个 QNetworkAddressEntry 类型的地址列表，通过addressEntries()获得这个列表。</p> 
<p>QNetworkAddressEntry 包含了一个网络接口的IP 地址、子网掩码和广播地址，分别用ip(),netmask()和 broadcast()函数返回。</p> 
<p>QNetworkInterface::allInterfaces()返回的网络接口的信息很多，如果无需知道子网掩码和广播地址等信息，可以使用QNetworkInterface::allAddresses()只获取IP 地址界面上“QNetworkInterface ::allAddresses()”按钮的响应代码如下:</p> 
<pre><code class="hljs">void HostDialog::on_btnAllAddressed_clicked()
{
    QList&lt;QHostAddress&gt; addList = QNetworkInterface::allAddresses();
    if(addList.isEmpty())
    {
        return;
    }
    for(int i = 0; i &lt; addList.count(); i++)
    {
        QHostAddress info = addList.at(i);
        bool show = ui-&gt;chkOnlyIPv4-&gt;isChecked();
        if(show)
        {
            show = QAbstractSocket::IPv4Protocol == info.protocol();
        }
        else
        {
            show = true;
        }
        if(show)
        {
            ui-&gt;textInfo-&gt;appendPlainText("协议:" + protocolName(info.protocol()));
            ui-&gt;textInfo-&gt;appendPlainText("IP地址:" + info.toString());
            ui-&gt;textInfo-&gt;appendPlainText("");
        }
    }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d84365256503e53338833cd81654a8cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TCP协议详解 (史上最全)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/85b25a16b3a336eadea65f695b5ab7f1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">flutter版本升级时遇到的问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>