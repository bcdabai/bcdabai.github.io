<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AJAX的原理（重点） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AJAX的原理（重点）" />
<meta property="og:description" content="◆ XMLHttpRequest 什么是XMLHttpRequest？ 定义：
关系：axios 内部采用 XMLHttpRequest 与服务器交互
注意：直白点说就是axios内部就是封装了XMLHttpRequest这个对象来实现发送异步请求的
使用 XMLHttpRequest 步骤：
1. 创建 XMLHttpRequest 对象
2. 配置请求方法和请求 url 地址
3. 监听 loadend 事件，接收响应结果
4. 发起请求
1.无参数的情况 获取并展示所有省份名字 //1. 创建 XMLHttpRequest 对象 const xhr = new XMLHttpRequest() //2. 配置请求方法和请求 url 地址 xhr.open(&#39;GET&#39;,&#39;http://hmajax.itheima.net/api/province&#39;) //3. 监听 loadend 事件，接收响应结果 xhr.addEventListener(&#39;loadend&#39;,function(){ console.log(xhr.response); const rs = JSON.parse(xhr.response) console.log(rs.list.join(&#39;&lt;br&gt;&#39;)); document.querySelector(&#39;p&#39;).innerHTML = rs.list.join(&#39;&lt;br&gt;&#39;) }) //4. 发起请求 xhr.send() 2.有URL查询参数的情况 使用字符串拼接 使用浏览器提供的内置对对象 URLSearchParams // 1. 组织查询参数字符串 const qObj = { pname: &#39;辽宁省&#39;, cname: &#39;大连市&#39; } // 2查询参数对象 -&gt; 查询参数字符串 const paramsObj = new URLSearchParams(qObj) const queryString = paramsObj." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/803130ab187cd28a7da87335b17f7faa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-29T22:02:56+08:00" />
<meta property="article:modified_time" content="2024-01-29T22:02:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AJAX的原理（重点）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>◆ XMLHttpRequest</h3> 
<ul><li> <h4 style="background-color:transparent;">什么是XMLHttpRequest？</h4> </li></ul> 
<p>定义：</p> 
<p><img alt="" height="173" src="https://images2.imgbox.com/4f/04/qFJBMD0W_o.png" width="1200"></p> 
<p>关系：axios 内部采用 XMLHttpRequest 与服务器交互</p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/1c/11/mgF5pqM4_o.png" width="884"></p> 
<p><span style="color:#fe2c24;"><strong> 注意：直白点说就是axios内部就是封装了XMLHttpRequest这个对象来实现发送异步请求的</strong></span></p> 
<ul><li> <h4 style="background-color:transparent;">使用 XMLHttpRequest</h4> </li></ul> 
<p><strong>步骤：</strong></p> 
<p>1. 创建 XMLHttpRequest 对象</p> 
<p>2. 配置请求方法和请求 url 地址</p> 
<p>3. 监听 loadend 事件，接收响应结果</p> 
<p>4. 发起请求</p> 
<p><img alt="" height="343" src="https://images2.imgbox.com/c7/6d/58DRSqtq_o.png" width="1107"></p> 
<h5 style="background-color:transparent;"> 1.无参数的情况</h5> 
<p>获取并展示所有省份名字 </p> 
<pre><code class="language-javascript">  //1. 创建 XMLHttpRequest 对象
    const xhr = new XMLHttpRequest()
    //2. 配置请求方法和请求 url 地址
    xhr.open('GET','http://hmajax.itheima.net/api/province')
    //3. 监听 loadend 事件，接收响应结果
    xhr.addEventListener('loadend',function(){
      console.log(xhr.response);
      const rs = JSON.parse(xhr.response)
      console.log(rs.list.join('&lt;br&gt;'));
      document.querySelector('p').innerHTML = rs.list.join('&lt;br&gt;')
    })
    //4. 发起请求
    xhr.send()</code></pre> 
<p><img alt="" height="524" src="https://images2.imgbox.com/2c/40/1oNHghhx_o.png" width="1200"></p> 
<h5 style="background-color:transparent;"> 2.有URL查询参数的情况</h5> 
<p><img alt="" height="580" src="https://images2.imgbox.com/d6/ca/taL4fhFI_o.png" width="1200"></p> 
<ul><li> 使用字符串拼接</li></ul> 
<p><img alt="" height="425" src="https://images2.imgbox.com/19/5e/MGbIQaFY_o.png" width="937"></p> 
<ul><li>使用浏览器提供的内置对对象 <span style="color:#fe2c24;"><strong>URLSearchParams</strong></span></li></ul> 
<pre><code class="language-javascript"> // 1. 组织查询参数字符串
      const qObj = {
        pname: '辽宁省',
        cname: '大连市'
      }
      // 2查询参数对象 -&gt; 查询参数字符串
      const paramsObj = new URLSearchParams(qObj)
      const queryString = paramsObj.toString()
      console.log(queryString)

      // 3. 使用XHR对象，查询地区列表
      const xhr = new XMLHttpRequest()
      xhr.open('GET', `http://hmajax.itheima.net/api/area?${queryString}`)
      xhr.addEventListener('loadend', () =&gt; {
        console.log(xhr.response)
        const data = JSON.parse(xhr.response)
        console.log(data)
        const htmlStr = data.list.map(areaName =&gt; {
          return `&lt;li class="list-group-item"&gt;${areaName}&lt;/li&gt;`
        }).join('')
        console.log(htmlStr)
      })
      xhr.send()</code></pre> 
<p><img alt="" height="980" src="https://images2.imgbox.com/f9/6c/SclnOPvZ_o.png" width="1200"></p> 
<h5> 3.以请求体（JSON）的方式发送数据的情况</h5> 
<p> 需求：通过 XHR 提交用户名和密码，完成注册功能</p> 
<p>核心：</p> 
<p><span style="color:#fe2c24;"><strong>请求头</strong></span>设置 Content-Type：application/json</p> 
<p><span style="color:#fe2c24;"><strong>请求体</strong></span>携带 JSON 字符串</p> 
<pre><code class="language-javascript">
       /**
     * 目标：使用xhr进行数据提交-完成注册功能
    */
    document.querySelector('.reg-btn').addEventListener('click', () =&gt; {
      const xhr = new XMLHttpRequest()
      xhr.open('POST', 'http://hmajax.itheima.net/api/register')
      xhr.addEventListener('loadend', () =&gt; {
        console.log(xhr.response)
      })

      // 设置请求头-告诉服务器内容类型（JSON字符串）
      xhr.setRequestHeader('Content-Type', 'application/json')
      // 准备提交的数据
      const userObj = {
        username: 'itheima007',
        password: '7654321'
      }
      //将对象转化成JSON字符串
      const userStr = JSON.stringify(userObj)
      // 设置请求体，发起请求
      xhr.send(userStr)
    })
</code></pre> 
<p><img alt="" height="415" src="https://images2.imgbox.com/fc/d4/q4NKCHhd_o.png" width="1200"></p> 
<p> </p> 
<p>总结： </p> 
<blockquote> 
 <p>. AJAX 原理是什么？</p> 
 <ul><li>➢ XMLHttpRequest 对象</li></ul> 
 <p>2. 为什么学习 XHR？</p> 
 <ul><li>➢ 有更多与服务器数据通信方式</li><li>➢ 了解 axios 内部原理</li></ul> 
 <p>3. XHR 使用步骤？</p> 
 <ul><li>➢ 创建 XHR 对象</li><li>➢ 调用 open 方法，设置 url 和请求方法</li><li>➢ 监听 loadend 事件，接收结果</li><li>➢ 调用 send 方法，发起请求 </li></ul> 
</blockquote> 
<h5><strong>4.上传图片等二进制的情况</strong></h5> 
<pre><code class="language-javascript"> //4  上传图片等二进制的情况
     //1. 获取图片文件
     document.querySelector('.upload').addEventListener('change',(e)=&gt;{
        //  console.log(e.target.files); 
        //2. 使用 FormData 携带图片文件
        const fd = new FormData()
        // append()  追加元素
        fd.append('img',e.target.files[0])

        //3 使用XmlHttpRequest提交数据
        const xhr = new XMLHttpRequest()
        //设置方法和url
        xhr.open('POST','http://hmajax.itheima.net/api/uploadimg')
        //设置回调函数
        xhr.addEventListener('loadend',function(){
            console.log(xhr.response);  //这里不是一个对象，是字符串 
            console.log(JSON.parse(xhr.response));
            document.querySelector('img').src = JSON.parse(xhr.response).data.url

        })
        xhr.send(fd)
    })</code></pre> 
<p> </p> 
<p> </p> 
<p> </p> 
<h3>◆ Promise</h3> 
<h4 style="background-color:transparent;"><strong>什么是 Promise？</strong></h4> 
<ul><li><strong>表示（管理）一个<span style="color:#fe2c24;">异步操作最终状态和结果值的对象</span></strong></li></ul> 
<p><strong>定义：</strong></p> 
<p><img alt="" height="201" src="https://images2.imgbox.com/68/ef/oK34iAHk_o.png" width="1136"></p> 
<p><strong>Promise 使用步骤</strong></p> 
<h4><img alt="" height="417" src="https://images2.imgbox.com/60/ce/GEhNgS5z_o.png" width="1200"> </h4> 
<h4> Promise - 三种状态</h4> 
<p>概念：一个Promise对象，必然处于以下几种状态之一</p> 
<ul><li>待定（pending） ：初始状态，既没有被兑现，也没有被拒绝</li><li>已兑现（fulfilled） ：意味着，操作成功完成</li><li>已拒绝（rejected） ：意味着，操作失败</li></ul> 
<p><img alt="" height="424" src="https://images2.imgbox.com/93/1a/SKEWQZk9_o.png" width="779"></p> 
<p>注意：Promise对象一旦被<span style="color:#fe2c24;"><strong>兑现/拒绝 </strong></span>就是<span style="color:#fe2c24;">已敲定</span>了，状态无法再被改变 </p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;案例_使用Promise+XHR_获取省份列表&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;p class="my-p"&gt;&lt;/p&gt;
  &lt;script&gt;
    /**
     * 目标：使用Promise管理XHR请求省份列表
     *  1. 创建Promise对象
     *  2. 执行XHR异步代码，获取省份列表
     *  3. 关联成功或失败函数，做后续处理
    */
    // 1. 创建Promise对象
    const p = new Promise((resolve, reject) =&gt; {
      // 2. 执行XHR异步代码，获取省份列表
      const xhr = new XMLHttpRequest()
      xhr.open('GET', 'http://hmajax.itheima.net/api/province')
      xhr.addEventListener('loadend', () =&gt; {
        // xhr如何判断响应成功还是失败的？
        // 2xx开头的都是成功响应状态码
        if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
          resolve(JSON.parse(xhr.response))
        } else {
          reject(new Error(xhr.response))
        }
      })
      xhr.send()
    })

    // 3. 关联成功或失败函数，做后续处理
    p.then(result =&gt; {
      console.log(result)
      document.querySelector('.my-p').innerHTML = result.list.join('&lt;br&gt;')
    }).catch(error =&gt; {
      // 错误对象要用console.dir详细打印
      console.dir(error)
      // 服务器返回错误提示消息，插入到p标签显示
      document.querySelector('.my-p').innerHTML = error.message
    })
    
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre> 
<p>总结 </p> 
<h3>◆ 封装简易版 axios</h3> 
<pre><code class="language-javascript">function myAxios(config) {
  return new Promise((resolve, reject) =&gt; {
    const xhr = new XMLHttpRequest()
    if (config.params) {
      const paramsObj = new URLSearchParams(config.params)
      const queryString = paramsObj.toString()
      config.url += `?${queryString}`
    }
    xhr.open(config.method || 'GET', config.url)
    xhr.addEventListener('loadend', () =&gt; {
      if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
        resolve(JSON.parse(xhr.response))
      } else {
        reject(new Error(xhr.response))
      }
    })
    if (config.data) {
      const jsonStr = JSON.stringify(config.data)
      xhr.setRequestHeader('Content-Type', 'application/json')
      xhr.send(jsonStr)
    } else {
      xhr.send()
    }
  })
}</code></pre> 
<h3>◆ 案例 - 天气预报</h3> 
<p>步骤：</p> 
<p>1. 获取北京市天气数据，展示</p> 
<p>2. 搜索城市列表，展示</p> 
<p>3. 点击城市，显示对应天气数据</p> 
<p><img alt="" height="906" src="https://images2.imgbox.com/42/aa/V8BeXmRF_o.png" width="1200"></p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;link rel="stylesheet" href="./css/reset.css"&gt;
  &lt;link rel="stylesheet" href="./css/index.css"&gt;
  &lt;title&gt;案例_天气预报&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;!-- 顶部 --&gt;
    &lt;div class="top-box"&gt;
      &lt;div class="title"&gt;
        &lt;span class="dateShort"&gt;10月28日&lt;/span&gt;
        &lt;span class="calendar"&gt;农历&amp;nbsp;
          &lt;span class="dateLunar"&gt;十月初四&lt;/span&gt;
        &lt;/span&gt;
      &lt;/div&gt;
      &lt;div class="search-box"&gt;
        &lt;div class="location"&gt;
          &lt;img src="./imgs/定位.png" alt=""&gt;
          &lt;span class="area"&gt;城市名&lt;/span&gt;
        &lt;/div&gt;
        &lt;!-- 搜索框+搜索列表 --&gt;
        &lt;div class="search"&gt;
          &lt;input type="text" class="search-city" placeholder="搜索城市"&gt;
          &lt;ul class="search-list"&gt;
            &lt;li class="city-item"&gt;北京市&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- 当前天气 --&gt;
    &lt;div class="weather-box"&gt;
      &lt;div class="tem-box"&gt;
        &lt;span class="temp"&gt;
          &lt;span class="temperature"&gt;12&lt;/span&gt;
          &lt;span&gt;°&lt;/span&gt;
        &lt;/span&gt;
      &lt;/div&gt;
      &lt;div class="climate-box"&gt;
        &lt;div class="air"&gt;
          &lt;span class="psPm25"&gt;55&lt;/span&gt;
          &lt;span class="psPm25Level"&gt;良&lt;/span&gt;
        &lt;/div&gt;
        &lt;ul class="weather-list"&gt;
          &lt;li&gt;
            &lt;img src="./imgs/小雨-line.png" class="weatherImg" alt=""&gt;
            &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;/li&gt;
          &lt;li class="windDirection"&gt;东南风&lt;/li&gt;
          &lt;li class="windPower"&gt;2级&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="today-weather"&gt;
      &lt;div class="range-box"&gt;
        &lt;span&gt;今天：&lt;/span&gt;
        &lt;span class="range"&gt;
          &lt;span class="weather"&gt;晴&lt;/span&gt;
          &lt;span class="temNight"&gt;9&lt;/span&gt;
          &lt;span&gt;-&lt;/span&gt;
          &lt;span class="temDay"&gt;14&lt;/span&gt;
          &lt;span&gt;℃&lt;/span&gt;
        &lt;/span&gt;
      &lt;/div&gt;
      &lt;ul class="sun-list"&gt;
        &lt;li&gt;
          &lt;span&gt;紫外线&lt;/span&gt;
          &lt;span class="ultraviolet"&gt;强&lt;/span&gt;
        &lt;/li&gt;
        &lt;li&gt;
          &lt;span&gt;湿度&lt;/span&gt;
          &lt;span class="humidity"&gt;53&lt;/span&gt;%
        &lt;/li&gt;
        &lt;li&gt;
          &lt;span&gt;日出&lt;/span&gt;
          &lt;span class="sunriseTime"&gt;06:38&lt;/span&gt;
        &lt;/li&gt;
        &lt;li&gt;
          &lt;span&gt;日落&lt;/span&gt;
          &lt;span class="sunsetTime"&gt;17:18&lt;/span&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
    &lt;!-- 周天气预报 --&gt;
    &lt;div class="week-weather-box"&gt;
      &lt;div class="title"&gt;7日内天气预报&lt;/div&gt;
      &lt;ul class="week-wrap"&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temNight"&gt;12&lt;/span&gt;-
            &lt;span class="temDay"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;今天&lt;/span&gt;
            &lt;span class="date"&gt;10月28日&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src="./imgs/多云.png" alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temDay"&gt;12&lt;/span&gt;-
            &lt;span class="temNight"&gt;12&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;东南风&lt;/span&gt;
            &lt;span class="windPower"&gt;&amp;lt;3级&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- 自己封装myAxios函数 --&gt;
  &lt;script src="./js/my-axios.js"&gt;&lt;/script&gt;
  &lt;!-- 搜索框+下拉菜单出现逻辑 --&gt;
  &lt;script src="./js/search.js"&gt;&lt;/script&gt;
  &lt;!-- 核心js --&gt;
  &lt;script src="./js/index.js"&gt;&lt;/script&gt;

  &lt;script&gt;

    //1 获取默认城市的天气预报
    function getWeather(cityCode){
        myAxios({
        url: 'http://hmajax.itheima.net/api/weather',
        params: {
          city: cityCode
        }
      }).then(result=&gt;{
        //渲染数据
        console.log(result);

        const wObj = result.data

        //更新城市名
        document.querySelector('.area').innerHTML = result.data.area

        //当前日期
        document.querySelector('.title').innerHTML = `
        &lt;span class="dateShort"&gt;${wObj.dateShort}&lt;/span&gt;
        &lt;span class="calendar"&gt;农历&amp;nbsp;
          &lt;span class="dateLunar"&gt;${wObj.dateLunar}&lt;/span&gt;
        &lt;/span&gt;
        `

        //当前气候
      document.querySelector('.climate-box').innerHTML = `
        &lt;div class="air"&gt;
          &lt;span class="psPm25"&gt;${wObj.psPm25}&lt;/span&gt;
          &lt;span class="psPm25Level"&gt;${wObj.psPm25Level}&lt;/span&gt;
        &lt;/div&gt;
        &lt;ul class="weather-list"&gt;
          &lt;li&gt;
            &lt;img src=${wObj.weatherImg} class="weatherImg" alt=""&gt;
            &lt;span class="weather"&gt;${wObj.weather}&lt;/span&gt;
          &lt;/li&gt;
          &lt;li class="windDirection"&gt;${wObj.windDirection}&lt;/li&gt;
          &lt;li class="windPower"&gt;${wObj.windPower}&lt;/li&gt;
        &lt;/ul&gt; 
      `

      //当前温度
      document.querySelector('.tem-box').innerHTML = `
        &lt;span class="temp"&gt;
          &lt;span class="temperature"&gt;${wObj.temperature}&lt;/span&gt;
          &lt;span&gt;°&lt;/span&gt;
        &lt;/span&gt;
        `
      const todayWeather = wObj.todayWeather
      document.querySelector('.today-weather').innerHTML = `
        &lt;div class="range-box"&gt;
          &lt;span&gt;今天：&lt;/span&gt;
          &lt;span class="range"&gt;
            &lt;span class="weather"&gt;${todayWeather.weather}&lt;/span&gt;
            &lt;span class="temNight"&gt;${todayWeather.temNight}&lt;/span&gt;
            &lt;span&gt;-&lt;/span&gt;
            &lt;span class="temDay"&gt;${todayWeather.temDay}&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/span&gt;
        &lt;/div&gt;
        &lt;ul class="sun-list"&gt;
          &lt;li&gt;
            &lt;span&gt;紫外线&lt;/span&gt;
            &lt;span class="ultraviolet"&gt;${todayWeather.ultraviolet}&lt;/span&gt;
          &lt;/li&gt;
          &lt;li&gt;
            &lt;span&gt;湿度&lt;/span&gt;
            &lt;span class="humidity"&gt;${todayWeather.humidity}&lt;/span&gt;%
          &lt;/li&gt;
          &lt;li&gt;
            &lt;span&gt;日出&lt;/span&gt;
            &lt;span class="sunriseTime"&gt;${todayWeather.sunriseTime}&lt;/span&gt;
          &lt;/li&gt;
          &lt;li&gt;
            &lt;span&gt;日落&lt;/span&gt;
            &lt;span class="sunsetTime"&gt;${todayWeather.sunsetTime}&lt;/span&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      `

      // &lt;!-- 周天气预报 --&gt;
     document.querySelector('.week-wrap').innerHTML =  wObj.dayForecast.map((item)=&gt;`
      &lt;li class="item"&gt;
          &lt;div class="date-box"&gt;
            &lt;span class="dateFormat"&gt;${item.dateFormat}&lt;/span&gt;
            &lt;span class="date"&gt;${item.date}&lt;/span&gt;
          &lt;/div&gt;
          &lt;img src=${item.weatherImg} alt="" class="weatherImg"&gt;
          &lt;span class="weather"&gt;多云&lt;/span&gt;
          &lt;div class="temp"&gt;
            &lt;span class="temNight"&gt;${item.temNight}&lt;/span&gt;-
            &lt;span class="temDay"&gt;${item.temDay}&lt;/span&gt;
            &lt;span&gt;℃&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class="wind"&gt;
            &lt;span class="windDirection"&gt;${item.windDirection}&lt;/span&gt;
            &lt;span class="windPower"&gt;${item.windPower}&lt;/span&gt;
          &lt;/div&gt;
        &lt;/li&gt;
      `).join('')
      })
    }
    getWeather('450700')


    //2 搜索城市列表
    document.querySelector('.search-city').addEventListener('input',function(e){

      //得到输入的内容
      const value = e.target.value
      // console.log(value);
      // 使用ajax调用接口
      myAxios({
        url: 'http://hmajax.itheima.net/api/weather/city',
        params: {
          city: value
        }
      }).then(result=&gt;{
        //  console.log(result);
        document.querySelector('.search-list').innerHTML = result.data.map(item=&gt;`
          &lt;li class="city-item" data-code="${item.code}"&gt;${item.name}&lt;/li&gt;
        `)
      })
    })


    //使用事件委托，给每个搜索出来的li加点击事件
    document.querySelector('.search-list').addEventListener('click',function(e){
      if(e.target.classList.contains('city-item')){
        // console.log(222);
        //获取自定义属性
        let code = e.target.dataset.code
        //调用天气函数
         console.log(code);
         getWeather(code)
      }
    })


  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5fae8be92e89e1f78fc1a5a978cecc05/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Go-Zero】Windows启动rpc服务报错panic:context deadline exceeded解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd35210658673e88abc2090eeec865d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【如何轻松拿捏LIO-SAM？】今天终于来啦！！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>