<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>router4j--SpringCloud动态路由利器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="router4j--SpringCloud动态路由利器" />
<meta property="og:description" content="前言 本文介绍Java的动态路由中间件：router4j。router4j用于SpringCloud项目，它可以将某个url请求路由到指定的机器上，也可以将所有请求强制转到指定机器。
问题描述
Java后端在开发SpringCloud项目时如果同一个应用起了多个实例，会遇到以下问题：
无法将指定url请求强制转到个人电脑。这样会导致难以打断点调试；如果是设置了应用的所有请求都到我的电脑，那么我在调试时其他接口无法使用。无法将指定的feign的url请求强制转到个人电脑。如果有人打了断点调试，很可能影响测试环境，因为网关的请求和feign请求还是会经常请求到打了断点的那个电脑。 本文介绍的router4j可以解决这个问题，是我个人写的中间件。它可以设置将指定的url的请求路由到指定的机器。
官网网址
官网文档：router4j官网（首先在官网更新，不定时同步到CSDN博客）
github：https://github.com/knife-blade/router4j
gitee：https://gitee.com/knifeedge/router4j
一、简介 1.1 概述 router4j是一个动态路由的中间件，用于提高Java后端开发和调试效率。
使用router4j，可以将某个url请求路由到指定的机器上，只需在可视化页面上将path绑定到应用实例的ip和端口上即可。
router4j也支持将所有请求强制转到指定机器，所以也可以用于线上不停机更新应用。
1.2 特性 简单：支持通过Web页面操作，操作简单，一分钟上手；无侵入：引入依赖即可，无需修改代码性能损耗小：路径的规则存放在Redis，速度很快，几乎没有性能损耗支持路径的路由：可以指定某个url路由到指定机器支持默认路由：如果url没有设置规则，则转发到设置的默认路由的实例支持强制路由：所有url强制路由到指定实例（无论是否设置了规则）支持网关：支持网关的请求转发支持feign：支持feign的请求转发支持实例运行状态查看：支持查看实例的运行状态 1.3 支持的框架 网关 gateway（已支持）zuul（待支持）SpringCloud的负载均衡 loadbalancer（已支持）（SpringCloud2020及之后的版本）ribbon（待支持） 1.4 框架结构 1.在可视化页面进行配置，将url与实例（ip加端口）关联起来
2.前端请求进来时：gateway会使用本框架的全局过滤器，会根据这个url到Redis中的配置中查询，将url路由到指定的实例（ip加端口）
3.调用feign时：feign会使用本框架的负载均衡器，会根据这个url到Redis中的配置中查询，将url路由到指定的实例（ip加端口）
1.5 下载/依赖 github：https://github.com/knife-blade/router4j
gitee：https://gitee.com/knifeedge/router4j
maven：（待上传）
二、快速入门 router4j-server：router4j的控制台（后端）router4j-vue：router4j的控制台（前端）router4j-example：示例程序 2.1 启动控制台 1.启动后端
启动router4j-server
2.启动前端
启动router4j-vue
2.2 添加依赖 1.网关添加依赖
router4j-example/gateway
&lt;dependency&gt; &lt;groupId&gt;com.knife.router4j&lt;/groupId&gt; &lt;artifactId&gt;router4j-client-gateway-boot-starter&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; 2.应用添加依赖（用于feign）
router4j-example/business/order/order-core
&lt;dependency&gt; &lt;groupId&gt;com.knife.router4j&lt;/groupId&gt; &lt;artifactId&gt;router4j-client-feign-boot-starter&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; 2.3 配置 网关和应用都要添加如下配置：
router4j: redis: host: localhost password: 222333 port: 6379 # database: 0 # ssl: false # timeout: 3s rule: enable: true # pathPatternPrefix: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/de9db2468bfb629c791991b0325d76b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-23T20:56:31+08:00" />
<meta property="article:modified_time" content="2024-01-23T20:56:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">router4j--SpringCloud动态路由利器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="XDzHJ">前言</h2> 
<p>本文介绍Java的动态路由中间件：router4j。router4j用于SpringCloud项目，它可以将某个url请求路由到指定的机器上，也可以将所有请求强制转到指定机器。</p> 
<p><strong>问题描述</strong></p> 
<p id="u46b7fff2">Java后端在开发SpringCloud项目时如果同一个应用起了多个实例，会遇到以下问题：</p> 
<ol><li id="u1a6a8eaf">无法将指定url请求强制转到个人电脑。这样会导致难以打断点调试；如果是设置了应用的所有请求都到我的电脑，那么我在调试时其他接口无法使用。</li><li id="ua3933c8c">无法将指定的feign的url请求强制转到个人电脑。</li><li id="u15b6f047">如果有人打了断点调试，很可能影响测试环境，因为网关的请求和feign请求还是会经常请求到打了断点的那个电脑。</li></ol> 
<p id="ua37cd022">本文介绍的router4j可以解决这个问题，是我个人写的中间件。它可以设置将指定的url的请求路由到指定的机器。</p> 
<p id="u1a955d38"><strong>官网网址</strong></p> 
<p id="u166a6179">官网文档：<a href="https://www.yuque.com/knifeblade/opensource/router4j" rel="nofollow" title="router4j官网">router4j官网</a>（首先在官网更新，不定时同步到<a href="https://knife.blog.csdn.net/article/details/126930621" rel="nofollow" title="CSDN博客">CSDN博客</a>）</p> 
<p id="ub72c709b">github：<a href="https://github.com/knife-blade/router4j" title="https://github.com/knife-blade/router4j">https://github.com/knife-blade/router4j</a></p> 
<p id="u6303d74e">gitee：<a href="https://gitee.com/knifeedge/router4j" rel="nofollow" title="https://gitee.com/knifeedge/router4j">https://gitee.com/knifeedge/router4j</a></p> 
<h2 id="iS4dt">一、简介</h2> 
<h3 id="iYb7P">1.1 概述</h3> 
<p id="uece1879f">router4j是一个动态路由的中间件，用于提高Java后端开发和调试效率。</p> 
<p id="u4cb90527">使用router4j，可以将某个url请求路由到指定的机器上，只需在可视化页面上将path绑定到应用实例的ip和端口上即可。</p> 
<p id="u69727b09">router4j也支持将所有请求强制转到指定机器，所以也可以用于线上不停机更新应用。</p> 
<h3 id="ZgKOu">1.2 特性</h3> 
<ul><li id="u728fa5e3"><strong>简单</strong>：支持通过Web页面操作，操作简单，一分钟上手；</li><li id="ub13ca7a5"><strong>无侵入</strong>：引入依赖即可，无需修改代码</li><li id="ud14fcb58"><strong>性能损耗小</strong>：路径的规则存放在Redis，速度很快，几乎没有性能损耗</li><li id="ue0e7f374"><strong>支持路径的路由</strong>：可以指定某个url路由到指定机器</li><li id="u6999d153"><strong>支持默认路由</strong>：如果url没有设置规则，则转发到设置的默认路由的实例</li><li id="ub88013c5"><strong>支持强制路由</strong>：所有url强制路由到指定实例（无论是否设置了规则）</li><li id="ua8e87695"><strong>支持网关</strong>：支持网关的请求转发</li><li id="u1f3d5075"><strong>支持feign</strong>：支持feign的请求转发</li><li id="ub007a040"><strong>支持实例运行状态查看</strong>：支持查看实例的运行状态</li></ul> 
<h3 id="xH4Ac">1.3 支持的框架</h3> 
<ol><li>网关 
  <ol><li>gateway（已支持）</li><li>zuul（待支持）</li></ol></li><li>SpringCloud的负载均衡 
  <ol><li>loadbalancer（已支持）（SpringCloud2020及之后的版本）</li><li>ribbon（待支持）</li></ol></li></ol> 
<h3>1.4 框架结构</h3> 
<p id="u1ba46e0d">1.在可视化页面进行配置，将url与实例（ip加端口）关联起来</p> 
<p id="u4eb0d963">2.前端请求进来时：gateway会使用本框架的全局过滤器，会根据这个url到Redis中的配置中查询，将url路由到指定的实例（ip加端口）</p> 
<p id="u9e0e9241">3.调用feign时：feign会使用本框架的负载均衡器，会根据这个url到Redis中的配置中查询，将url路由到指定的实例（ip加端口）</p> 
<h3 id="mZGbW">1.5 下载/依赖</h3> 
<p id="uce56f796">github：<a href="https://github.com/knife-blade/router4j" title="https://github.com/knife-blade/router4j">https://github.com/knife-blade/router4j</a></p> 
<p id="ue41d8d0f">gitee：<a href="https://gitee.com/knifeedge/router4j" rel="nofollow" title="https://gitee.com/knifeedge/router4j">https://gitee.com/knifeedge/router4j</a></p> 
<p id="u3dddc286">maven：（待上传）</p> 
<h2 id="ATlw2">二、快速入门</h2> 
<ul><li id="u7efb5c52">router4j-server：router4j的控制台（后端）</li><li id="uac464b1d">router4j-vue：router4j的控制台（前端）</li><li id="u4e1f3516">router4j-example：示例程序</li></ul> 
<h3 id="YF6p4">2.1 启动控制台</h3> 
<p id="u1b684322"><strong>1.启动后端</strong></p> 
<p id="u78174715">启动router4j-server</p> 
<p id="u0e823c66"><strong>2.启动前端</strong></p> 
<p id="u2b476ab0">启动router4j-vue</p> 
<h3 id="GIHgc">2.2 添加依赖</h3> 
<p id="ue4baa1b8"><strong>1.网关添加依赖</strong></p> 
<p id="ua48b061b">router4j-example/gateway</p> 
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;com.knife.router4j&lt;/groupId&gt;
    &lt;artifactId&gt;router4j-client-gateway-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p id="u50e7172c"><strong>2.应用添加依赖（用于feign）</strong></p> 
<p id="uc1af5ab2">router4j-example/business/order/order-core</p> 
<pre><code class="language-XML">&lt;dependency&gt;
  &lt;groupId&gt;com.knife.router4j&lt;/groupId&gt;
  &lt;artifactId&gt;router4j-client-feign-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<h3 id="AC2XU">2.3 配置</h3> 
<p id="u4cc7e51d">网关和应用都要添加如下配置：</p> 
<pre><code class="language-bash">router4j:
  redis:
    host: localhost
    password: 222333
    port: 6379
    # database: 0
    # ssl: false
    # timeout: 3s
  rule:
    enable: true
    # pathPatternPrefix: "router4j:rule:pathPattern"
    # defaultInstancePrefix: "router4j:rule:defaultInstance"
  # instruction:
  #   cacheKey: "router4j:instruction"</code></pre> 
<h3 id="nxnGs">2.4 开始使用</h3> 
<p id="u361c585f">启动router4j服务：Redis、router4j-server、router4j-vue</p> 
<p id="u9b3a3c34">启动示例服务（router4j-example路径）：Nacos、geteway、业务应用（business路径）（2个order，2个storage，1个account）。</p> 
<p id="uc1f876f6">业务场景：创建订单，减库存、减账户余额。请求order的controller，order分别用feign调用storage和account。</p> 
<p id="u610f3be8">需求：将网关请求order的/order/create转到192.168.150.1:9011这个实例，将storage的feign转到192.168.150.1:9021这个实例。</p> 
<p id="u334f3fc4"><strong>1.配置网关路径的路由</strong></p> 
<p id="ufab52772">访问：<a href="http://localhost:10001/" rel="nofollow" title="http://localhost:10001/">http://localhost:10001/</a></p> 
<p id="u066f5557">在“规则管理”中配置路径与实例的绑定：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/40/96/smJIGryV_o.png"></p> 
<p id="uf8f43657"><strong>2.配置feign路径的路由</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/57/34/1Quld9Bv_o.png"></p> 
<p id="u60ae5917"><strong>3.请求接口测试</strong></p> 
<p id="uc11e075e">postman访问（请求10次）：<a href="http://localhost:6001/order/order/create/?userId=1&amp;productId=1&amp;count=10&amp;money=100" rel="nofollow" title="http://localhost:6001/order/order/create/?userId=1&amp;productId=1&amp;count=10&amp;money=100">http://localhost:6001/order/order/create/?userId=1&amp;productId=1&amp;count=10&amp;money=100</a></p> 
<p id="ue25789bd">结果：</p> 
<p id="u8de1b854">order：（全部都请求到了指定的实例192.168.150.1:9012）</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8b/3f/JWZrgp3c_o.png"></p> 
<p id="uddea1744">storage：（全部都请求到了指定的实例192.168.150.1:9021）</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/46/f8/2JJtqfsC_o.png"></p> 
<h2 id="e30SJ">三、使用详解</h2> 
<h3 id="WTNsg">3.1 规则管理</h3> 
<p id="u7435f77c">底层是基于Spring自身的AntPathMatcher来实现的，其规则见：<a href="https://knife.blog.csdn.net/article/details/120678900" rel="nofollow" title="此文">此文</a></p> 
<h4 id="ph3eE">3.1.1 新建规则</h4> 
<p id="u7cdcc816">支持下拉框选择和手动输入</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c2/8e/Dn95DrPl_o.png"></p> 
<h4 id="HaZCI">3.1.2 查找规则</h4> 
<p id="u7ae2a5e9">支持下拉框选择和手动输入</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c6/39/ZKjVz8H8_o.png"></p> 
<h4 id="UHXB3">3.1.3 删除规则</h4> 
<p id="u606b5889">支持单个删除（绿色箭头所指）和批量删除（红色箭头所指）。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3d/7b/w2qa4bvt_o.png"></p> 
<h3 id="dwN6o">3.2 实例管理</h3> 
<h4 id="RBNb1">3.2.1 默认路由</h4> 
<p id="u2af9d57c"><strong>所有实例列表</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ad/a0/2Z1X6xfA_o.png"></p> 
<p id="u88262ffd"></p> 
<p id="ubff06f0f"><strong>设置为默认路由</strong></p> 
<p id="ude62b9db">如果url没有设置规则，则转发到设置的默认路由的实例。</p> 
<p id="u80bb4a8b">支持单个设置（绿色箭头）与批量设置（红色箭头）。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/43/de/YJqUiHJG_o.png"></p> 
<h4 id="fCAfV">3.2.2 强制路由</h4> 
<p id="ub661a1b8">所有url强制路由到指定实例（无论是否设置了规则）。</p> 
<p id="u95ddcd17">支持单个设置（绿色箭头）与批量设置（红色箭头）。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/de/1b/Q7fVhPYB_o.png"></p> 
<h2 id="RA6uP">四、未来计划</h2> 
<ol><li id="u17df16a9">发布0.0.1版本</li><li id="ua389b70f">支持某个路径配置的开启关闭</li><li id="ua7a018c7">支持通过eureka获取实例信息</li><li id="ufe0e7c14">支持zuul网关</li><li id="u7cbde987">支持Ribbon（SpringCloud2020之前）</li><li id="u3c6427d0">支持在配置中设置不启用router4j</li><li id="u657ed8f1">写一个正式的router4j官网网站</li><li id="uf56b0647">加入权限管理，可以用于线上不停机更新应用。</li></ol> 
<p id="u56aa6910"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dde5d92828ceaff13672aa036b234dd4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第五部分：TensorFlowLite介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be83c09ce9fd8a9fc61052569a0169e3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">神经网络的学习(Neural Networks: Learning)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>