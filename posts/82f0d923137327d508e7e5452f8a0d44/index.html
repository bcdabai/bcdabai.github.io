<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>netty 源码解析一：ServerBootstrap 服务端 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="netty 源码解析一：ServerBootstrap 服务端" />
<meta property="og:description" content="ServerBootstrap 服务启动类 结构: 继承 AbstractBootstrap 抽象类
使用案例：
ServerBootstrap server = new ServerBootstrap(); server.group(new NioEventLoopGroup(), new NioEventLoopGroup()); // EventLoopGroup接口 server.channel(NioServerSocketChannel.class); // Channel.class类类型 server.childHandler(new ChannelInitializer&lt;Channel&gt;(){ // ChannelHandler接口 initChannel(Channel c){ c.pipeline().addLast(new SimpleChannelInboundHandler&lt;Object&gt;(){ // ChannelHandler接口 channelRead0(ChannelHandlerContext ctx, Object msg) // 发送消息 }); } }); ChannelFutrue future = server.bind(8899).sync(); 方法：group(EventLoopGroup) 配置线程池 group(EventLoopGroup, EventLoopGroup) 创建 NioEventLoopGroup 线程组(池). 为 ServerBootstrap 配置 childGroup 线程池, AbstractBootstrap 父类配置 group 线程池.
(这里暂时未讲解，一个线程池与二个线程池的区别)
方法：channel(Channel.class) 配置传输管道 注意, NioServerSocketChannel 是 NIO 的传输管道. 内部是封装 java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/82f0d923137327d508e7e5452f8a0d44/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-20T11:46:48+08:00" />
<meta property="article:modified_time" content="2020-01-20T11:46:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">netty 源码解析一：ServerBootstrap 服务端</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="ServerBootstrap__1"></a>ServerBootstrap 服务启动类</h3> 
<p>结构: 继承 <code>AbstractBootstrap</code> 抽象类</p> 
<p>使用案例：</p> 
<pre><code class="prism language-java">	ServerBootstrap server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	server<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// EventLoopGroup接口</span>
	server<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>NioServerSocketChannel<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Channel.class类类型</span>
	server<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics function"><span class="token punctuation">&lt;</span>Channel<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// ChannelHandler接口</span>
		<span class="token function">initChannel</span><span class="token punctuation">(</span>Channel c<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			c<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// ChannelHandler接口</span>
				<span class="token function">channelRead0</span><span class="token punctuation">(</span>ChannelHandlerContext ctx<span class="token punctuation">,</span> Object msg<span class="token punctuation">)</span> <span class="token comment">// 发送消息</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ChannelFutrue future <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8899</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="groupEventLoopGroup__18"></a>方法：group(EventLoopGroup) 配置线程池</h5> 
<p><code>group(EventLoopGroup, EventLoopGroup)</code> 创建 NioEventLoopGroup 线程组(池). 为 <code>ServerBootstrap</code> 配置 childGroup 线程池, <code>AbstractBootstrap</code> 父类配置 group 线程池.<br> (这里暂时未讲解，一个线程池与二个线程池的区别)</p> 
<h5><a id="channelChannelclass__22"></a>方法：channel(Channel.class) 配置传输管道</h5> 
<p>注意, <code>NioServerSocketChannel</code> 是 NIO 的传输管道. 内部是封装 <code>java.nio.channels.ServerSocketChannel</code> 管道. 通过nio管道实现消息传输。</p> 
<p>这里源码追踪: AbstractBootstrap 类中 channel 方法</p> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> B <span class="token function">channel</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">C</span><span class="token operator">&gt;</span> channelClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">channelFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReflectiveChannelFactory</span><span class="token generics function"><span class="token punctuation">&lt;</span>C<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                ObjectUtil<span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>channelClass<span class="token punctuation">,</span> <span class="token string">"channelClass"</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> B <span class="token function">channelFactory</span><span class="token punctuation">(</span>ChannelFactory<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">C</span><span class="token operator">&gt;</span> channelFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        ObjectUtil<span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>channelFactory<span class="token punctuation">,</span> <span class="token string">"channelFactory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channelFactory <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"channelFactory set already"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token comment">// **** 赋值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>channelFactory <span class="token operator">=</span> channelFactory<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>通过 <code>NioServerSocketChannel</code> 创建 <code>ReflectiveChannelFactory</code> 管道工厂, 这里简单介绍 <code>ReflectiveChannelFactory</code> 实现, 通过 <code>NioServerSocketChannel</code> 根据class类型获取构造器并创建对象.</p> 
<h5><a id="childHandlerChannelHandler__45"></a>方法：childHandler(ChannelHandler) 配置管道处理器</h5> 
<p>自定义实现 <code>ChannelHandler</code> 实现, 这里配置的是 <code>ChannelInitializer</code> 并实现 <code>initChannel</code> 抽象方法. 可通过管道获取 <code>ChannelPipeline</code> 对象获取到上下文实现消息传输<br> <strong>这个暂时不解析, 先按主流程思路走…</strong></p> 
<h5><a id="bind__49"></a>方法：bind(端口) 绑定端口</h5> 
<p>根据端口创建 <code>InetSocketAddress</code> 对象. 其中 <code>doBind(SocketAddress)</code> 方法为核心.<br> <strong>doBind</strong> 源码解析:</p> 
<pre><code class="prism language-java">	<span class="token keyword">private</span> ChannelFuture <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token keyword">final</span> SocketAddress localAddress<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 初始化管道 和 线程池注册管道</span>
        <span class="token keyword">final</span> ChannelFuture regFuture <span class="token operator">=</span> <span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// #see NioEventLoopGroup.register()</span>
        <span class="token keyword">final</span> Channel channel <span class="token operator">=</span> regFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   <span class="token comment">// 如果此任务完成，则返回{@code true}</span>
            ChannelPromise promise <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">newPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">final</span> PendingRegistrationPromise promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingRegistrationPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
            regFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span>ChannelFuture future<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
                    Throwable cause <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cause <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// EventLoop上的注册失败了，所以当我们试图访问通道的EventLoop时，不能让ChannelPromise直接导致IllegalStateException</span>
                        promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 注册成功，因此请设置要使用的正确执行程序</span>
                        promise<span class="token punctuation">.</span><span class="token function">registered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// do</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>该doBind()方法第一步，是通过 <code>initAndegister()</code> 方法管道初始化和注册管道获取 <code>ChannelFuture</code> 管道响应.<br> 第二步， 通过注册管道得到 <code>ChannelFuture</code> 对象为该注册监听器</p> 
</blockquote> 
<blockquote> 
 <p>初始化管道, 使用管道工厂也就是上面所说的 <code>ReflectiveChannelFactory</code> 对象通过它创建 <code>NioServerSocketChannel</code> 管道。</p> 
</blockquote> 
<p>在 <code>AbstractBootstrap</code> 中提供了一个抽象方法 <code>init(Channel)</code> 给子类去初始化管道. <code>ServerBootstrap</code> 对象为 NIO 服务端，也就是 <code>AbstractBootstrap</code> 抽象类的实现类.</p> 
<p>接下来看服务端如何初始化管道的…</p> 
<pre><code class="prism language-java">	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>Channel channel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 设置管道选项</span>
        <span class="token function">setChannelOptions</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token function">options0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>EMPTY_OPTION_ARRAY<span class="token punctuation">)</span><span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置管道的一些属性</span>
        <span class="token function">setAttributes</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token function">attrs0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>EMPTY_ATTRIBUTE_ARRAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ChannelPipeline p <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// DefaultChannelPipeline</span>

        <span class="token keyword">final</span> EventLoopGroup currentChildGroup <span class="token operator">=</span> childGroup<span class="token punctuation">;</span>
        <span class="token keyword">final</span> ChannelHandler currentChildHandler <span class="token operator">=</span> childHandler<span class="token punctuation">;</span>
        <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>ChannelOption<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> Object<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildOptions <span class="token operator">=</span> childOptions<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>EMPTY_OPTION_ARRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>AttributeKey<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> Object<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildAttrs <span class="token operator">=</span> childAttrs<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>EMPTY_ATTRIBUTE_ARRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics function"><span class="token punctuation">&lt;</span>Channel<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token keyword">final</span> Channel ch<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">final</span> ChannelPipeline pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ChannelHandler handler <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                ch<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrapAcceptor</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> currentChildGroup<span class="token punctuation">,</span> currentChildHandler<span class="token punctuation">,</span> currentChildOptions<span class="token punctuation">,</span> currentChildAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>服务端在初始化管道先设置了管道选项 <code>setChannelOptions</code> 方法, 设置了管道属性 <code>setAttributes</code> 方法. 在这里二个方法不作深一步解析，有兴趣可以去理解.</p> 
<p><strong>channel.pipeline()</strong> 方法是获取, 创建的默认的 <code>ChannelPipeline</code> 接口的实现类 <code>DefaultChannelPipeline</code> 。</p> 
<h6><a id="ChannelPipeline__132"></a><code>ChannelPipeline</code> 理解</h6> 
<blockquote> 
 <p>ChannelPipeline 类是 ChannelHandler 实例对象的链表，用于处理或截获通道的接收和发送数据。它提供了一种高级的截取过滤模式（类似serverlet中的filter功能），让用户可以在 ChannelPipeline 中完全控制一个事件以及如何处理ChannelHandler与ChannelPipeline的交互。</p> 
</blockquote> 
<p>先跳过 <code>ChannelPipeline</code> 处理 <code>ChannelHandler</code> 逻辑。 我们通过管道获取到 <code>DefaultChannelPipeline</code> 对象. 在这里内部帮我们添加一个 <code>ChannelHandler</code> 管道处理器. <code>ServerBootstrapAcceptor</code> 对象. 并是由单独的线程的运行。</p> 
<blockquote> 
 <p>ChannelHanlder 管道处理器, 是由单独的线程来处理的</p> 
</blockquote> 
<p>通过上述理解得知。在 netty 中我们先通过 Channel 获取 <code>管道处理器的管理者</code>。 也是就 <code>ChannelPipeline</code> 对象。通过它添加 <code>ChannelHandlelr</code> 管道处理器. 用它实现我们的消息传输.</p> 
<p>看完 ServerBootstrap 重写 init() 方法，咋们回过头再来看 AbstractBootstap 中的 initAndRegister() 方法逻辑. 把管道注册到 <code>NioEventLoopGroup</code> 对象上。下面先看看 NioEventLoopGroup 的初始化流程…</p> 
<p>最后看 <code>ChannelPipeline</code> 处理 <code>ChannelHandler</code> 的呢…</p> 
<h4><a id="NioEventLoopGroup__144"></a>NioEventLoopGroup 初始化流程</h4> 
<p>在看 <code>NioEventLoopGroup</code> 注册管道前， 我们先来看下它的类结构.</p> 
<blockquote> 
 <p>一级 NioEventLoopGroup =&gt;<br> 二级 MultithreadEventLoopGroup =&gt; 实现 EventLoopGroup 接口<br> 三级 MultithreadEventExecutorGroup =&gt;<br> 四级 AbstractEventExecutorGroup =&gt; 实现 EventExecutorGroup 接口</p> 
</blockquote> 
<p>除了 <code>NioEventLoopGroup</code> 其它都是抽象类. 我们来看下 一级 NioEventLoopGroup 的初始化流程吧</p> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//默认线程数为0</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> <span class="token punctuation">(</span>Executor<span class="token punctuation">)</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//默认执行器为null</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> SelectorProvider<span class="token punctuation">.</span><span class="token function">provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">,</span> <span class="token keyword">final</span> SelectorProvider selectorProvider<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> selectorProvider<span class="token punctuation">,</span> DefaultSelectStrategyFactory<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">,</span> <span class="token keyword">final</span> SelectorProvider selectorProvider<span class="token punctuation">,</span>
                             <span class="token keyword">final</span> SelectStrategyFactory selectStrategyFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> selectorProvider<span class="token punctuation">,</span> selectStrategyFactory<span class="token punctuation">,</span> RejectedExecutionHandlers<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">// newChild 方法为三级类中的抽象方法</span>
	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> EventLoop <span class="token function">newChild</span><span class="token punctuation">(</span>Executor executor<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        EventLoopTaskQueueFactory queueFactory <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">(</span>EventLoopTaskQueueFactory<span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">:</span> null<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoop</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> executor<span class="token punctuation">,</span> <span class="token punctuation">(</span>SelectorProvider<span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>SelectStrategyFactory<span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newSelectStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>RejectedExecutionHandler<span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>在一级类构造器中使用到以下三个对象： NioEventLoopGroup 类中的 <code>newChild()</code> 方法中创建 <code>NioEventLoop</code> 时需要<br> SelectorProvider.provider() :: 选择器提供者<br> DefaultSelectStrategyFactory.INSTANCE :: 选择器策略模式工厂<br> RejectedExecutionHandlers.reject() :: 可以理解为异常处理器</p> 
</blockquote> 
<p>二级 MultithreadEventLoopGroup 初始化</p> 
<pre><code class="prism language-java">	<span class="token keyword">protected</span> <span class="token function">MultithreadEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>nThreads <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> DEFAULT_EVENT_LOOP_THREADS <span class="token operator">:</span> nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>在二级构造器里面发现如果不设置线程数，就会有个默认的线程数变量 <code>DEFAULT_EVENT_LOOP_THREADS</code><br> 默认线程数是取的虚拟机可用的处理器数量的二倍 * 2 。 这里可以通过设置 netty 的属性设置 <code>io.netty.eventLoopThreads</code> 线程数。<br> <img src="https://images2.imgbox.com/1b/76/kb2PuxPz_o.png" alt="DEFAULT_EVENT_LOOP_THREADS "><br> 三级 MultithreadEventExecutorGroup 初始化</p> 
<pre><code class="prism language-java">	<span class="token keyword">protected</span> <span class="token function">MultithreadEventExecutorGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> DefaultEventExecutorChooserFactory<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token function">MultithreadEventExecutorGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> Executor executor<span class="token punctuation">,</span> EventExecutorChooserFactory chooserFactory<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nThreads <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"nThreads: %d (expected: &gt; 0)"</span><span class="token punctuation">,</span> nThreads<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token function">newDefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventExecutor</span><span class="token punctuation">[</span>nThreads<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nThreads<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newChild</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>
                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// TODO: Think about if this is a good exception type</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"failed to create a child event loop"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        children<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        EventExecutor e <span class="token operator">=</span> children<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">isTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                e<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> interrupted<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// Let the caller handle the interruption.</span>
                            Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// PowerOfTwoEventExecutorChooser</span>
        chooser <span class="token operator">=</span> chooserFactory<span class="token punctuation">.</span><span class="token function">newChooser</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> FutureListener<span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span> terminationListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureListener</span><span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span>Future<span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>terminatedChildren<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    terminationFuture<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>EventExecutor e <span class="token operator">:</span> children<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">terminationFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>terminationListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        Set<span class="token generics function"><span class="token punctuation">&lt;</span>EventExecutor<span class="token punctuation">&gt;</span></span> childrenSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics function"><span class="token punctuation">&lt;</span>EventExecutor<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Collections<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>childrenSet<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
        readonlyChildren <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">unmodifiableSet</span><span class="token punctuation">(</span>childrenSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>注意： 三级类中的构造器初始化。其中有个 <code>EventExecutor []</code> 事件执行器数组, 与 <code>EventExecutorChooserFactory</code> 事件执行器选择器工厂对象<br> 步骤：</p> 
<ol><li>如果 <code>Executor</code> 参数为空则创建 <code>ThreadPerTaskExecutor</code> 对象。(这里executor 默认为空)</li><li>创建长度为 <code>虚拟机可用的处理器数量 * 2</code> 的执行器数组。</li><li>为创建的执行器数组中的每个 <code>EventExecutor</code> 创建赋值, 这里看一级类 NioEventLoopGroup 的 newChild() 重写方法。</li><li>创建 <code>EventExecutorChooserFactory</code> 工厂, 根据执行器数组长度来判断创建对象。这里创建为 <code>PowerOfTwoEventExecutorChooser</code> 该对象主要用来选取数组中的 EventExecutor 。</li><li>创建 <code>FutureListener</code> 监听器, 为每个 EventExecutor 添加这个监听器。</li><li>复制 <code>事件执行器</code> 到新的集合， <code>readonlyChildren</code> 属性为已经读取的事件执行器。<br> <img src="https://images2.imgbox.com/35/22/8XEIaNs2_o.png" alt="在这里插入图片描述"><br> DefaultEventExecutorChooserFactory 工厂 创建 <code>事件执行选择器</code> 逻辑。 如果为长度是为2的n次幂的则创建<code>PowerOfTwoEventExecutorChooser</code> 对象, 否则创建 <code>GenericEventExecutorChooser</code> 对象。<br> Power 取 EventExecutor 的逻辑为 <code>下图</code></li></ol> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> EventExecutorChooser <span class="token function">newChooser</span><span class="token punctuation">(</span>EventExecutor<span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPowerOfTwo</span><span class="token punctuation">(</span>executors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PowerOfTwoEventExecutorChooser</span><span class="token punctuation">(</span>executors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GenericEventExecutorChooser</span><span class="token punctuation">(</span>executors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isPowerOfTwo</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;</span> <span class="token operator">-</span>val<span class="token punctuation">)</span> <span class="token operator">==</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>选取 EventExecutor数组中的逻辑…<br> <img src="https://images2.imgbox.com/bf/57/9k8haI0W_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="NioEventLoopGroup__291"></a>NioEventLoopGroup 注册管道流程</h4> 
<p>在 <code>AbstractBootstrap</code> 中的 <code>initAndRegister()</code> 方法中通过拿到一级类 <code>NioEventLoopGroup</code> 对象然后把 <code>Channel</code> 注册到当中。<br> 具体注册实现步骤：</p> 
<ol><li>在二级类 <code>MultithreadEventLoopGroup</code> 中 <code>register()</code> 方法处理逻辑。 
  <ol><li>在三级类 <code>MultithreadEventExecutorGroup</code> 通过 <code>EventExecutorChooser</code> 事件执行选择器，获取选择的 <code>EventExecutor</code> (选取规则上图标记部份)</li><li>通过 <code>EventExecutor</code> 的实现类 <code>NioEventLoop</code> 对象注册管道 Channel 。</li></ol> </li></ol> 
<p>上述中发现， NioEventLoopGroup 注册管道，交给了 NioEventLoop. 而 NioEventLoopGroup 就是只做了一个 创建 NioEventLoop 和 选择器选取 NioEventLoop 操作。</p> 
<h4><a id="NioEventLoop__300"></a>NioEventLoop 初始化流程</h4> 
<p>先来看 NioEventLoop 初始化流程. 在创建 NioEventLoop 时有几个重要的参数。我们来回顾一下。</p> 
<blockquote> 
 <p>参数一： <code>NioEventLoopGroup</code> 也就是创建的对象， 该包含所有的 <code>EventExecutor</code><br> 参数二： <code>Executor</code> 执行器 ， 在NioEventLoopGroup的三级类 MultithreadEventExecutorGroup 中初始化<br> 默认创建的是， <code>ThreadPerTaskExecutor</code> 对象。<br> 参数三： <code>SelectorProvider</code> 选择器提供者， 这个jdk 用来创建 <code>Selector</code> 的。<br> 参数四： <code>SelectStrategy</code> 选择器策略<br> 参数五： <code>RejectedExecutionHandler</code> 拒绝执行处理器，可以理解为异常处理器</p> 
</blockquote> 
<p>里面几个重要属性：<br> java.nio.channels.Selector<br> java.nio.channels.spi.SelectorProvider<br> io.netty.util.concurrent.EventExecutorGroup<br> java.util.concurrent.Executor<br> java.util.Queue</p> 
<p>回到 <code>NioEventLoop</code> 注册逻辑上， 下面代码发现.</p> 
<pre><code class="prism language-java">	<span class="token comment">// 二级类 SingleThreadEventLoop 中的 register() 方法逻辑</span>
	<span class="token keyword">public</span> ChannelFuture <span class="token function">register</span><span class="token punctuation">(</span>Channel channel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultChannelPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> ChannelFuture <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">final</span> ChannelPromise promise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        ObjectUtil<span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token string">"promise"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        promise<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<hr> 
<ol><li>创建了 <code>DefaultChannelPromise</code> 对象。</li><li>拿到 <code>Channel</code> 中的 <code>Unsafe</code> 对象. 为二级类 <code>AbstractNioMessageChannel</code> 中的内部类 <code>一级NioMessageUnsafe</code> 对象。</li><li>注册逻辑在内部类 <code>三级类 NioMessageUnsafe</code> 中， 注册管道逻辑看下源码。 
  <ol><li>先判断是否注册，如已注册直接返回错误信息</li><li>判断 <code>eventLoop</code> 是否为 <code>NioEventLoop</code></li><li><code>NioEventLoop</code> 赋值到当前 <code>Channel</code> 上。 也就是说 EventLoop 对应一个 Channel。</li><li><code>isEventLoop()</code> 判断当前线程与 NioEventLoop 中的 thread 线程是否相等. 这里创建 NioEventLoop 中的线程属性是null, 所以不相等。 false</li><li>这里为 <code>EventLoop</code> 创建一个新的线程并执行调用 <code>register0(ChannelPromise)</code> 方法。</li></ol> </li><li>注册 <code>register0(ChannelPromise)</code> 方法逻辑。 
  <ol><li>检查通道是否仍然打开，因为当寄存器调用在 eventLoopFuture 之外时，通道可能会关闭，从而无法取消。</li><li><code>doRegister()</code> 逻辑， 在 Channel 的三级类中 <code>AbstractNioChannel</code> 重写, 
    <ol><li>拿到 <code>ServerSocketChannel</code> 服务端, 注册 <code>Selector</code>， 和 ops 为 0， 和属性 当前 <code>NioServerSocketChannel</code> 对象。</li><li>返回拿到 <code>SelectionKey</code> 值。</li></ol> </li><li>通过第二步注册之后， 设置属性标识 《已注册》</li><li>通过 <code>DefaultChannelPipeline</code> 调用 <code>invokeHandlerAddedIfNeeded()</code> … 这个处理消息逻辑下面单独分析…</li><li>指定的 <code>DefaultChannelPromise</code> 标记为成功。如果已经完成，那么记录一条消息</li><li>通过 <code>DefaultChannelPipeline</code> 调用 <code>fireChannelRegistered()</code> 。</li><li>判断 管道是否打开， 以及管道是否 <code>isBound()</code>. 这里是未绑定的. false。 所以先不分析里面的逻辑。</li></ol> </li></ol> 
<pre><code class="prism language-java">		<span class="token comment"> AbstractChannel$AbstractUnsafe 内部类的对象中. 注册逻辑 </span>
		<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span>EventLoop eventLoop<span class="token punctuation">,</span> <span class="token keyword">final</span> ChannelPromise promise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ObjectUtil<span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">,</span> <span class="token string">"eventLoop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"registered to an event loop already"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isCompatible</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"incompatible event loop type: "</span> <span class="token operator">+</span> eventLoop<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            AbstractChannel<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventLoop <span class="token operator">=</span> eventLoop<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    eventLoop<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Force-closing a channel whose registration task was not accepted by an event loop: {}"</span><span class="token punctuation">,</span>
                            AbstractChannel<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

		<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">register0</span><span class="token punctuation">(</span>ChannelPromise promise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 请检查通道是否仍然打开，因为当寄存器调用在 eventLoopFuture 之外时，通道可能会关闭，从而无法取消</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">.</span><span class="token function">setUncancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ensureOpen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">boolean</span> firstRegistration <span class="token operator">=</span> neverRegistered<span class="token punctuation">;</span>
                <span class="token comment">// 设置ServerSocketChannel 注册选择器</span>
                <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// AbstractNioChannel#doRegister(): 使用ServerSocketChannel 注册到 Selector 得到 SelectionKey</span>
                <span class="token comment">// 设置标识为已注册</span>
                neverRegistered <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">// 绝不</span>
                registered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token comment">// Ensure we call handlerAdded(...) before we actually notify the promise. This is needed as the</span>
                <span class="token comment">// user may already fire events through the pipeline in the ChannelFutureListener.</span>
                pipeline<span class="token punctuation">.</span><span class="token function">invokeHandlerAddedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">safeSetSuccess</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
                pipeline<span class="token punctuation">.</span><span class="token function">fireChannelRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Only fire a channelActive if the channel has never been registered. This prevents firing</span>
                <span class="token comment">// multiple channel actives if the channel is deregistered and re-registered.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRegistration<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        pipeline<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// This channel was registered before and autoRead() is set. This means we need to begin read</span>
                        <span class="token comment">// again so that we process inbound data.</span>
                        <span class="token comment">//</span>
                        <span class="token comment">// See https://github.com/netty/netty/issues/4805</span>
                        <span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// Close the channel directly to avoid FD leak.</span>
                <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

	<span class="token comment">/ AbstractNioChannel 类中方法 doRegister 注册逻辑</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">boolean</span> selected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                selectionKey <span class="token operator">=</span> <span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrappedSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// Force the Selector to select now as the "canceled" SelectionKey may still be</span>
                    <span class="token comment">// cached and not removed because no Select.select(..) operation was called yet.</span>
                    <span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    selected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// We forced a select operation on the selector before but the SelectionKey is still cached</span>
                    <span class="token comment">// for whatever reason. JDK bug ?</span>
                    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3e/b3/kl2RToJ7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ChannelPipeline__ChannelHandler_449"></a>ChannelPipeline 处理 ChannelHandler</h4> 
<h6><a id="DefaultChannelPipeline__450"></a>DefaultChannelPipeline 分析</h6> 
<p>先从这个 <code>invokeHandlerAddedIfNeeded()</code> 方法分析…</p> 
<pre><code class="prism language-java">	<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">invokeHandlerAddedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">assert</span> channel<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRegistration<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            firstRegistration <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">// We are now registered to the EventLoop. It's time to call the callbacks for the ChannelHandlers,</span>
            <span class="token comment">// that were added before the registration was done.</span>
            <span class="token function">callHandlerAddedForAllHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">callHandlerAddedForAllHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> PendingHandlerCallback pendingHandlerCallbackHead<span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">assert</span> <span class="token operator">!</span>registered<span class="token punctuation">;</span>
            registered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            pendingHandlerCallbackHead <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pendingHandlerCallbackHead<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pendingHandlerCallbackHead <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        PendingHandlerCallback task <span class="token operator">=</span> pendingHandlerCallbackHead<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            task<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            task <span class="token operator">=</span> task<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>DefaultChannelPipeline 中属性分析, 类中含 <code>AbstractChannelHandlerContext</code> 对象 <code>head头部</code> 和 <code>tail尾部</code></p> 
<h6><a id="AbstractChannelHandlerContext__481"></a>AbstractChannelHandlerContext 双向链表分析:</h6> 
<p>默认实现为, <strong>DefaultChannelHandlerContext</strong><br> 内部类实现, <strong>HeadChannelHandlerContext</strong><br> 内部类实现, <strong>TailChannelHandlerContext</strong></p> 
<p>可以理解为<mark>双向链表</mark>. <code>AbstractChannelHandlerContext</code> 内部包含自身 next, prev 。 最主要的属性为 <code>EventExecutor</code> 对象, 事件执行器. 也可以说是一个线程。还有一些标记状态.</p> 
<p><img src="https://images2.imgbox.com/9d/e6/cUupnzOL_o.png" alt="在这里插入图片描述"></p> 
<p>实现了 <strong>ChannelHandlerContext</strong> 接口， 该接口又继承了 <code>ChannelInboundInvoker</code> 和 <code>ChannelOutboundInvoker</code> 接口。<br> 接口介绍<br> <img src="https://images2.imgbox.com/b1/81/LEWacOvz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/99/8a/T1EnG58L_o.png" alt="在这里插入图片描述"></p> 
<p>发现就是通过其ChannelHandlerContext 处理器上下文 处理信息传输。<br> 通过单独的线程处理 传输任务。</p> 
<p>分析完结… 后续整理</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d7c6c29cc236afbba504239669fcc47d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">elasticsearch，lucene ，solr 的简单介绍区别与联系（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d18440e03e32861e80dd6d646307c699/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring-IOC之依赖注入——注解篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>