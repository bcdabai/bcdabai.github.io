<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>realsense d435i&#43;apriltags二维码实现定位&#43;ros - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="realsense d435i&#43;apriltags二维码实现定位&#43;ros" />
<meta property="og:description" content="目的 想检测apriltag相较于棋盘格的位姿识别效果，便于手眼标定
安装环境
系统：ubuntu 18.04 内核
ROS： melodic
相机：intel realsense d435i
已安装相机驱动 librealsense 以及相机ROS Wrapper，相机能够正常工作
#1. 安装时需要将realsense相机拔掉 #2. 打开终端,依次输入以下命令行（见到Y/n,输入y即可） sudo apt-get update &amp;&amp; sudo apt-get upgrade &amp;&amp; sudo apt-get dist-upgrade sudo apt-get install git libssl-dev libusb-1.0-0-dev pkg-config libgtk-3-dev sudo apt-get install libglfw3-dev libgl1-mesa-dev libglu1-mesa-dev git clone https://github.com/IntelRealSense/librealsense.git cd librealsense/ sudo cp config/99-realsense-libusb.rules /etc/udev/rules.d/ sudo udevadm control --reload-rules &amp;&amp; udevadm trigger ./scripts/patch-realsense-ubuntu-lts.sh echo &#39;hid_sensor_custom&#39; | sudo tee -a /etc/modules mkdir build &amp;&amp; cd build cmake ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3bec5a5d7efe20b132068af301b421db/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-27T14:37:56+08:00" />
<meta property="article:modified_time" content="2021-12-27T14:37:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">realsense d435i&#43;apriltags二维码实现定位&#43;ros</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>目的</h3> 
<p>想检测apriltag相较于棋盘格的位姿识别效果，便于手眼标定<br> 安装环境<br> 系统：ubuntu 18.04 内核<br> ROS： melodic<br> 相机：intel realsense d435i</p> 
<h3><a id="_7"></a>已安装相机驱动</h3> 
<p>librealsense 以及相机ROS Wrapper，相机能够正常工作</p> 
<pre><code class="prism language-bash"><span class="token comment">#1. 安装时需要将realsense相机拔掉</span>
<span class="token comment">#2. 打开终端,依次输入以下命令行（见到Y/n,输入y即可）</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> dist-upgrade
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">git</span> libssl-dev libusb-1.0-0-dev pkg-config libgtk-3-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libglfw3-dev libgl1-mesa-dev libglu1-mesa-dev
<span class="token function">git</span> clone https://github.com/IntelRealSense/librealsense.git
<span class="token builtin class-name">cd</span> librealsense/
<span class="token function">sudo</span> <span class="token function">cp</span> config/99-realsense-libusb.rules /etc/udev/rules.d/ 
<span class="token function">sudo</span> udevadm control --reload-rules <span class="token operator">&amp;&amp;</span> udevadm trigger
./scripts/patch-realsense-ubuntu-lts.sh
<span class="token builtin class-name">echo</span> <span class="token string">'hid_sensor_custom'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/modules
<span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>/ -DBUILD_EXAMPLES<span class="token operator">=</span>true
<span class="token function">sudo</span> <span class="token function">make</span> uninstall <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -j4 <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token comment">#3. realsense相机通过3.0或以上USB接口连接主机</span>
<span class="token comment">#打开终端，输入</span>
<span class="token comment">#realsense-viewer</span>
</code></pre> 
<h3><a id="apriltags2_ros_31"></a>apriltags2_ros的编译</h3> 
<p><a href="https://zhuanlan.zhihu.com/p/289582482" rel="nofollow">安装教程</a><br> 出现报错：Could not find a package configuration file provided by apriltag<br> <a href="https://blog.csdn.net/weixin_45363995/article/details/122160091?spm=1001.2014.3001.5501">解决方案</a></p> 
<h3><a id="_36"></a>准备实验</h3> 
<p>apriltag二维码生成<br> <a href="https://link.zhihu.com/?target=https://openmv.io/pages/download" rel="nofollow">下载地址</a></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x openmv-ide-linux-x86_64-2.6.5.run 
./openmv-ide-linux-x86_64-2.6.5.run 
</code></pre> 
<p>工具-机器视觉-ApirlTag生成器-TAG36H11</p> 
<h3><a id="apriltag_ros_46"></a>运行apriltag_ros</h3> 
<p>修改launch文件，主要是camera_name和image_topic要改成对应相机的topic</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>launch<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"launch_prefix"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">""</span> /<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span>-- <span class="token builtin class-name">set</span> to <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"gdbserver localhost:10000"</span> <span class="token keyword">for</span> remote debugging --<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"node_namespace"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"apriltag_ros_continuous_node"</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"camera_name"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"/cv_camera"</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"camera_frame"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"cv_camera"</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"image_topic"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"image_raw"</span> /<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span><span class="token operator">!</span>-- Set parameters --<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>rosparam <span class="token assign-left variable">command</span><span class="token operator">=</span><span class="token string">"load"</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> apriltag_ros<span class="token variable">)</span></span>/config/settings.yaml"</span> <span class="token assign-left variable">ns</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg node_namespace<span class="token variable">)</span></span>"</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>rosparam <span class="token assign-left variable">command</span><span class="token operator">=</span><span class="token string">"load"</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> apriltag_ros<span class="token variable">)</span></span>/config/tags.yaml"</span> <span class="token assign-left variable">ns</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg node_namespace<span class="token variable">)</span></span>"</span> /<span class="token operator">&gt;</span>
  
  <span class="token operator">&lt;</span>node <span class="token assign-left variable">pkg</span><span class="token operator">=</span><span class="token string">"apriltag_ros"</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"apriltag_ros_continuous_node"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg node_namespace<span class="token variable">)</span></span>"</span> <span class="token assign-left variable">clear_params</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">"screen"</span> launch-prefix<span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg launch_prefix<span class="token variable">)</span></span>"</span> <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span>-- Remap topics from those used <span class="token keyword">in</span> code to those on the ROS network --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>remap <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token string">"image_rect"</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg camera_name<span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span>arg image_topic<span class="token variable">)</span></span>"</span> /<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>remap <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token string">"camera_info"</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg camera_name<span class="token variable">)</span></span>/camera_info"</span> /<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>param <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"camera_frame"</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"str"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>arg camera_frame<span class="token variable">)</span></span>"</span> /<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>param <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"publish_tag_detections_image"</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"bool"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"true"</span> /<span class="token operator">&gt;</span>      <span class="token operator">&lt;</span><span class="token operator">!</span>-- default: <span class="token boolean">false</span> --<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/node<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/launch<span class="token operator">&gt;</span>
</code></pre> 
<p>修改settings.yaml文件，采用何种apriltags二维码</p> 
<p>修改tags.yaml文件，主要是自己的AprilTag</p> 
<pre><code class="prism language-bash">tag_bundles:
  <span class="token punctuation">[</span>
 <span class="token punctuation">{<!-- --></span>
       name: <span class="token string">'CUSTOM_BUNDLE_NAME'</span>,
       layout:
         <span class="token punctuation">[</span>
           <span class="token punctuation">{<!-- --></span>id: <span class="token number">0</span>, size: <span class="token number">0.146</span>, x: <span class="token number">0</span>, y: <span class="token number">0</span>, z: <span class="token number">0</span>, qw: <span class="token number">1.0</span>, qx: <span class="token number">0.0</span>, qy: <span class="token number">0.0</span>, qz: <span class="token number">0.0</span><span class="token punctuation">}</span>,
         <span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre> 
<p>运行<code>roslaunch apriltags2_ros continuous_detection.launch</code><br> 可以通过topic list看到新的topic，其中/tag_detection就是我们的检测结果了。<br> rostopic echo /tag_detection</p> 
<pre><code class="prism language-bash">header: 
  seq: <span class="token number">3211</span>
  stamp: 
    secs: <span class="token number">1640585817</span>
    nsecs: <span class="token number">812052488</span>
  frame_id: <span class="token string">"camera_color_optical_frame"</span>
detections: 
  - 
    id: <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    size: <span class="token punctuation">[</span><span class="token number">0.095</span><span class="token punctuation">]</span>
    pose: 
      header: 
        seq: <span class="token number">5240</span>
        stamp: 
          secs: <span class="token number">1640585817</span>
          nsecs: <span class="token number">812052488</span>
        frame_id: <span class="token string">"camera_color_optical_frame"</span>
      pose: 
        pose: 
          position: 
            x: <span class="token number">0.150823692867</span>
            y: <span class="token number">0.0563776419582</span>
            z: <span class="token number">0.630823164063</span>
          orientation: 
            x: <span class="token number">0.998524587587</span>
            y: <span class="token number">0.032129927311</span>
            z: -0.014006748795
            w: <span class="token number">0.0414744106955</span>
        covariance: <span class="token punctuation">[</span><span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span><span class="token punctuation">]</span>

</code></pre> 
<h3><a id="launch_125"></a>运行launch文件报错：</h3> 
<pre><code class="prism language-bash"><span class="token operator">&gt;&gt;</span>rostopic <span class="token builtin class-name">echo</span> /tag_detections
ERROR: Cannot load message class <span class="token keyword">for</span> <span class="token punctuation">[</span>apriltag_ros/AprilTagDetectionArray<span class="token punctuation">]</span>. Are your messages built?

</code></pre> 
<p>原因在与没有在bash中source<br> source devel_isolated/setup.zsh<br> 正常运行<br> 若想要在rviz里也看到/tag_detection的数据也要在启动前source</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4b4633b563b0a78754581c3541fab18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">torch | 提取参数及自定义初始化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6044b61d0f5ed8089637650fb032030/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">node执行js代码时同步获取用户通过键盘输入的值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>