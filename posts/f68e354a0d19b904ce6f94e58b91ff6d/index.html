<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在 NOVALIDATE 方式下创建外键约束 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在 NOVALIDATE 方式下创建外键约束" />
<meta property="og:description" content="ALTER TABLE ADD CONSTRAINT 语句可以创建或过滤 NOVALIDATE 方式的外键约束。
NOVALIDATE 约束方式防止数据库服务器在创建引用约束时，验证每一行的外键值是否符合被引
用表中的主键值。
使用此语法创建启用或过滤 NOVALIDATE 方式的外键约束：
ALTER TABLE ADD CONSTRAINT
用法
该语法忽略 DISABLED 关键字。因为禁用的约束不会进行违例检查，在这种情况下，
NOVALIDATE 关键字不重要。
如果没有列或列表立即跟随在 REFERENCES 关键字之后，则缺省列（或列组）是 pk_tab 表的主
键。如果 pk_tab 和 table 或 synonym 指定同一表，则约束自我引用，并没有缺省的主键列。
如果您没有声明约束的名称，则数据库服务器为此新约束生成一个标识符，它注册在
sysconstraints 和 sysobjstate 系统目录表中。
ALTER TABLE ADD CONSTRAINT 语句支持引用约束的 NOVALIDATE 方式作为创建或过滤引
用约束时绕过数据完整性检查的机制。
NOVALIDATE 方式可以提高性能的情况
尽管引用约束保护数据完整性，在某些情况下您正要移动到新数据库服务器实例的数据库表是已知
的自由参照完整性违规。对于大表上的外键约束，验证约束所需的时间要十分充分。如果有数百万
行的表正从 OLTP 环境移动至数据仓库环境，则验证目标环境中的外键可能增加数量级迁移所需
的时间。
例如，您可以删除大表上的外键约束，然后在该表迁移到目标表环境之前，立即重新创建
ENABLED NOVALIDATE 方式或 FILTERING NOVALIDATE 方式的约束。重建外键约束的
ALTER TABLE ADD CONSTRAINT 操作的花销几乎很小，因为它绕过了对每一行引用约束的验
证。因为 NOVALIDATE 方式不会持续超过创建该约束的 ALTER TABLE 操作，抵达数据仓库环" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f68e354a0d19b904ce6f94e58b91ff6d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-17T16:52:00+08:00" />
<meta property="article:modified_time" content="2022-10-17T16:52:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在 NOVALIDATE 方式下创建外键约束</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>ALTER TABLE ADD CONSTRAINT 语句可以创建或过滤 NOVALIDATE 方式的外键约束。<br> NOVALIDATE 约束方式防止数据库服务器在创建引用约束时，验证每一行的外键值是否符合被引<br> 用表中的主键值。<br> 使用此语法创建启用或过滤 NOVALIDATE 方式的外键约束：<br> ALTER TABLE ADD CONSTRAINT<br> 用法<br> 该语法忽略 DISABLED 关键字。因为禁用的约束不会进行违例检查，在这种情况下，<br> NOVALIDATE 关键字不重要。<br> 如果没有列或列表立即跟随在 REFERENCES 关键字之后，则缺省列（或列组）是 pk_tab 表的主<br> 键。如果 pk_tab 和 table 或 synonym 指定同一表，则约束自我引用，并没有缺省的主键列。<br> 如果您没有声明约束的名称，则数据库服务器为此新约束生成一个标识符，它注册在<br> sysconstraints 和 sysobjstate 系统目录表中。<br> ALTER TABLE ADD CONSTRAINT 语句支持引用约束的 NOVALIDATE 方式作为创建或过滤引<br> 用约束时绕过数据完整性检查的机制。<br> <strong>NOVALIDATE 方式可以提高性能的情况</strong><br> 尽管引用约束保护数据完整性，在某些情况下您正要移动到新数据库服务器实例的数据库表是已知<br> 的自由参照完整性违规。对于大表上的外键约束，验证约束所需的时间要十分充分。如果有数百万<br> 行的表正从 OLTP 环境移动至数据仓库环境，则验证目标环境中的外键可能增加数量级迁移所需<br> 的时间。<br> 例如，您可以删除大表上的外键约束，然后在该表迁移到目标表环境之前，立即重新创建<br> ENABLED NOVALIDATE 方式或 FILTERING NOVALIDATE 方式的约束。重建外键约束的<br> ALTER TABLE ADD CONSTRAINT 操作的花销几乎很小，因为它绕过了对每一行引用约束的验<br> 证。因为 NOVALIDATE 方式不会持续超过创建该约束的 ALTER TABLE 操作，抵达数据仓库环<br> 境中的表带有 ENABLED 或 FILTERING 方式的约束，保护了随后 DML 操作中数据的参照完整<br> 性。<br> <strong>使用 NOVALIDATE 关键字的限制</strong><br> 创建外键约束时， NOVALIDATE 关键字仅在 ALTER TABLE ADD CONSTRAINT 语句的 DDL 上下文中<br> 有效。 例如，您不能在以下任何 SQL 语句中创建处于 NOVALIDATE 方式的外键约束：<br> ⚫ CREATE TABLE 语句<br> ⚫ CREATE TEMP TABLE 语句<br> ⚫ SELECT INTO TABLE 语句<br> 如果满足下列条件，则您可以使用 ALTER TABLE ADD CONSTRAINT 语句在现有表上创建处于<br> NOVALIDATE 方式的启用约束：<br> ⚫ 您正在添加的约束是外键约束。如果您在同一 ALTER TABLE 语句中创建多个约束，那<br> 么所有的约束必须都是外键约束。<br> ⚫ 在 ALTER TABLE 语句中，NOVALIDATE 关键字只在 ADD CONSTRAINT FOREIGN<br> KEY 选项中有效。<br> • ALTER TABLE 在 DISABLED 方式下创建的约束是无效的。<br> 如果在以下约束定义的语法上下文中包含 NOVALIDATE 关键字，则 ALTER TABLE 语句发生错误而<br> 失败：<br> ⚫ ALTER TABLE ADD COLUMN 语句<br> ⚫ ALTER TABLE INIT 语句<br> ⚫ ALTER TABLE MODIFY 语句<br> 使 NOVALIDATE 关键字有效的其它 DDL 语句只有 SET Database Object Mode 语句的 SET<br> CONSTRAINTS 选项。当运行 SET CONSTRAINTS 语句时，它可以将现有外键约束的方式更改为<br> 这些 NOVALIDATE 约束方式：<br> ⚫ ENABLED NOVALIDATE 方式<br> ⚫ FILTERING WITH ERROR NOVALIDATE 方式<br> ⚫ FILTERING WITHOUT ERROR NOVALIDATE 方式.<br> 有关更多信息，请参阅 SET CONSTRAINTS 语句。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8cb02e1e47915b5ae45816aea96bae49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DROP CONSTRAINT 子句</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2c8c936d53be8cd5b1acfdea98e4c5b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">stm32f4xx-ADC</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>