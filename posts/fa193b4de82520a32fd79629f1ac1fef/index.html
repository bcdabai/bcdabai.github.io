<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php 操作 amqp demo - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php 操作 amqp demo" />
<meta property="og:description" content="$mqConf = Config::getInstance()-&gt;getConf(&#39;rabbitmq&#39;); //创建连接 $conn = new \AMQPConnection($mqConf);//连接 mq和channel if(!$conn-&gt;connect()){//连接成功返回true Helper::writeLog(null, &#39;rabbitmq&#39;, &#39;error&#39;, &#39;rabbitmq 连接失败&#39;, &#39;rabbitmq&#39;); return false; } //创建channel $channel = new \AMQPChannel($conn); //创建交换机 $ex = new \AMQPExchange($channel); //设置名字 $ex-&gt;setName(&#39;CREDITS_EXCHANGE&#39;); //设置DIRECT类型 $ex-&gt;setType(AMQP_EX_TYPE_DIRECT); //持久化 $ex-&gt;setFlags(AMQP_DURABLE); //声明创建一个ex $ex-&gt;declareExchange(); // 打印状态 //echo &#34;exchange status:&#34;.$status . PHP_EOL; //发送消息 $flag = $ex-&gt;publish($message, &#39;worker&#39;); if(!$flag){ Helper::writeLog(null, &#39;rabbitmq&#39;, &#39;error&#39;, &#39;rabbitmq 消息发送失败失败&#39;, $uid); } //关闭连接 $conn-&gt;disconnect();
如果希望绑定到队列 可执行以下代码
// 创建队列
$q = new AMQPQueue($channel);
$q-&gt;setName($q_name);
$q-&gt;setFlags(AMQP_DURABLE); //持久化 // $q-&gt;declareQueue(); // 同上" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fa193b4de82520a32fd79629f1ac1fef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-13T09:28:58+08:00" />
<meta property="article:modified_time" content="2018-06-13T09:28:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php 操作 amqp demo</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    $mqConf = Config::getInstance()-&gt;getConf('rabbitmq'); 
<br>        //创建连接 
<br>        $conn = new \AMQPConnection($mqConf);//连接 mq和channel 
<br>        if(!$conn-&gt;connect()){//连接成功返回true 
<br>            Helper::writeLog(null, 'rabbitmq', 'error', 'rabbitmq 连接失败', 'rabbitmq');  
<br>            return false; 
<br>        } 
<br>         
<br>        //创建channel 
<br>        $channel = new \AMQPChannel($conn); 
<br>        //创建交换机 
<br>        $ex = new \AMQPExchange($channel); 
<br>        //设置名字 
<br>        $ex-&gt;setName('CREDITS_EXCHANGE'); 
<br>        //设置DIRECT类型 
<br>        $ex-&gt;setType(AMQP_EX_TYPE_DIRECT); 
<br>        //持久化 
<br>        $ex-&gt;setFlags(AMQP_DURABLE); 
<br>        //声明创建一个ex 
<br>        $ex-&gt;declareExchange(); 
<br>        // 打印状态 
<br>        //echo "exchange status:".$status . PHP_EOL; 
<br>        //发送消息 
<br>        $flag = $ex-&gt;publish($message, 'worker'); 
<br>        if(!$flag){ 
<br>            Helper::writeLog(null, 'rabbitmq', 'error', 'rabbitmq 消息发送失败失败', $uid);  
<br>        } 
<br>        //关闭连接 
<br> 
<p>        $conn-&gt;disconnect();</p> 
<p><br></p> 
<p>如果希望绑定到队列 可执行以下代码</p> 
<p>// 创建队列<br>$q = new AMQPQueue($channel);<br>$q-&gt;setName($q_name);<br>$q-&gt;setFlags(AMQP_DURABLE); //持久化 <br>// $q-&gt;declareQueue(); // 同上<br>echo "queue status: ".$q-&gt;declareQueue();<br>echo "&lt;br/&gt;";<br><br><br>// $q-&gt;bind($e_name,$k_route);//将你的队列绑定到routin<br></p> 
<br> 
<br> 
<br> 
<br> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e171b578e1a3065eacb583c2cab1fd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ehcache学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/041eac0115f908978100c2110bea4eca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信公众号开发[该公众号提供的服务出现故障，请稍后再试]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>