<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring框架解析(全) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="spring框架解析(全)" />
<meta property="og:description" content="spring概述
spring容器启动
springIoc控制反转
spring依赖注入
spring事务
spring事件监听
springaop面向切面编程
–AOP用例搭建
–注解配置 Spring AOP详解
–@Transactional注解
spring工具类大全
spring注解大全
spring概述
spring是一个轻量级的容器,用于管理业务相关对象的。其两大内核：Ioc(控制反转)、aop(面向切面编程)。容器功能包括依赖注入(Dependency，简称DI)和依赖查找(Dependency Lookup)。
耦合与解耦
耦合是程序间的依赖关系包括：类间的依赖、方法间的依赖
解耦是降低程序间的依赖关系,实际开发中应该做到，编译器不依赖，运行时才依赖。
解耦的思路有两种：
1.使用反射来创建对象，而避免使用new关键字
2.通过读取配置文件来获取要创建的对象全限定类名
spring容器启动
在web项目中，启动spring容器的方式有三种,ContextLoaderListener、ContextLoadServlet、ContextLoaderPlugin
监听方式(web.xml)
&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;/WEB-INF/classes/applicationContext-*.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;listener-class&gt; org.springframework.web.context.ContextLoaderListener &lt;/listener-class&gt; &lt;/listener&gt;	[注]还可以通过&lt;import resource=&#34;classpath:/spring/spring-xxx.xml&#34;/&gt;的方式把其他的配置引进来
servlet方式(web.xml)
&lt;servlet&gt; &lt;servlet-name&gt;context&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.context.ContextLoaderServlet&lt;/servlet-class&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; [注]这种方式在spring3.0以后不再支持,建议使用监听方式
通过plugin配置方式(web.xml)
&lt;plug-in className=&#34;org.springframework.web.struts.ContextLoaderPlugIn&#34;&gt; &lt;set-property property=&#34;contextConfigLocation&#34; value=&#34;/WEB-INF/applicationContext.xml,/WEB-INF/action-servlet.xml&#34; /&gt; &lt;/plug-in&gt; [注]该方式适用于spring与strust等整合，在struts-config.xml里面配置一个ContextLoaderPlugIn，用于spring的初始化工作
springIoc控制反转
Ioc(控制反转)将对象的创建过程交给容器,让容器管理对象的生命周期,如创建,初始化,销毁等。目的是削减计算机程序的耦合(接触我们代码中的依赖关系)。
SpringIoc核心容器接口：ApplicationContext
常用实现类
a.ClassPathXmlApplicationContext 它可以加载类路径下的配置文件
b.FileSystemXmlApplicationContext 它可以加载磁盘任意路径下的配置文件(必须有访问权限)
c.AnnotationConfigApplicationContext 它是用于读取注解创建容器的
使用Ioc只需要实现即可：
ApplicationContext ac = new ClassPathXmlApplicationContext(&#34;Spring/bean.xml&#34;); 现在把对象的创建交给Spring来管理就要知道Spring对bean的管理细节（创建bean的方式、bean的作用域）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a638695d48cd320eb1141adba8e1ecc6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T16:22:24+08:00" />
<meta property="article:modified_time" content="2024-01-17T16:22:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring框架解析(全)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="#twoone" rel="nofollow"><font size="2" color="grey" face="宋体">spring概述</font></a></p> 
<p><a href="#rqqd" rel="nofollow"><font size="2" color="grey" face="宋体">spring容器启动</font></a></p> 
<p><a href="#kzfz" rel="nofollow"><font size="2" color="grey" face="宋体">springIoc控制反转</font></a></p> 
<p><a href="#ylzr" rel="nofollow"><font size="2" color="grey" face="宋体">spring依赖注入</font></a></p> 
<p><a href="#springsw" rel="nofollow"><font size="2" color="grey" face="宋体">spring事务</font></a></p> 
<p><a href="#sjjt" rel="nofollow"><font size="2" color="grey" face="宋体">spring事件监听</font></a></p> 
<p><a href="#twotwo" rel="nofollow"><font size="2" color="grey" face="宋体">springaop面向切面编程</font></a></p> 
<p><a href="#twotree" rel="nofollow"><font size="2" color="grey" face="宋体">–AOP用例搭建</font></a></p> 
<p><a href="#twofour" rel="nofollow"><font size="2" color="grey" face="宋体">–注解配置 Spring AOP详解</font></a></p> 
<p><a href="#threethree" rel="nofollow"><font size="2" color="grey" face="宋体">–@Transactional注解</font></a></p> 
<p><a href="#gongjulei" rel="nofollow"><font size="2" color="grey" face="宋体">spring工具类大全</font></a></p> 
<p><a href="#zjdq" rel="nofollow"><font size="2" color="grey" face="宋体">spring注解大全</font></a></p> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="twoone">spring概述</span></font></p> 
</blockquote> 
<p><font face="宋体" size="2">spring是一个轻量级的容器,用于管理业务相关对象的。其两大内核：Ioc(控制反转)、aop(面向切面编程)。<font size="2" face="宋体">容器功能包括依赖注入(Dependency，简称DI)和依赖查找(Dependency Lookup)。</font></font></p> 
<p><font face="楷体" size="2" color="orange">耦合与解耦</font></p> 
<p><font size="2" face="宋体">耦合是程序间的依赖关系包括：类间的依赖、方法间的依赖</font></p> 
<p><font size="2" face="宋体">解耦是降低程序间的依赖关系,实际开发中应该做到，编译器不依赖，运行时才依赖。<br> 解耦的思路有两种：<br> 1.使用反射来创建对象，而避免使用new关键字<br> 2.通过读取配置文件来获取要创建的对象全限定类名</font></p> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="rqqd">spring容器启动</span></font></p> 
</blockquote> 
<p><font face="宋体" size="2">在web项目中，启动spring容器的方式有三种,<strong>ContextLoaderListener、ContextLoadServlet、ContextLoaderPlugin</strong></font></p> 
<ol><li> <p><font face="宋体" size="3" color="黑体">监听方式(web.xml)</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>/WEB-INF/classes/applicationContext-*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">&gt;</span></span>
		org.springframework.web.context.ContextLoaderListener
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>	
</code></pre> <p><font face="宋体" size="2" color="grey">[注]还可以通过<code>&lt;import resource="classpath:/spring/spring-xxx.xml"/&gt;</code>的方式把其他的配置引进来</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">servlet方式(web.xml)</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.context.ContextLoaderServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <p><font face="宋体" size="2" color="grey">[注]这种方式在spring3.0以后不再支持,建议使用监听方式</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">通过plugin配置方式(web.xml)</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plug-in</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.struts.ContextLoaderPlugIn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-property</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contextConfigLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/WEB-INF/applicationContext.xml,/WEB-INF/action-servlet.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plug-in</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <p><font face="宋体" size="2" color="grey">[注]该方式适用于spring与strust等整合，在struts-config.xml里面配置一个ContextLoaderPlugIn，用于spring的初始化工作</font></p> </li></ol> 
<blockquote> 
 <p><font color="black" size="3"><span id="kzfz">springIoc控制反转</span></font></p> 
</blockquote> 
<p><font face="宋体" size="3">Ioc(控制反转)将对象的创建过程交给容器,让容器管理对象的生命周期,如创建,初始化,销毁等。目的是削减计算机程序的耦合(接触我们代码中的依赖关系)。</font></p> 
<p><img src="https://images2.imgbox.com/d4/27/ssJzbKhD_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">SpringIoc核心容器接口：ApplicationContext</font></p> 
<p><font face="宋体" size="3">常用实现类<br> a.ClassPathXmlApplicationContext 它可以加载类路径下的配置文件</font></p> 
<p><font face="宋体" size="3">b.FileSystemXmlApplicationContext 它可以加载磁盘任意路径下的配置文件(必须有访问权限)</font></p> 
<p><font face="宋体" size="3">c.AnnotationConfigApplicationContext 它是用于读取注解创建容器的</font></p> 
<p><font face="宋体" size="3">使用Ioc只需要实现即可：</font></p> 
<pre><code class="prism language-java"><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"Spring/bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font face="宋体" size="3">现在把对象的创建交给Spring来管理就要知道Spring对bean的管理细节（<strong>创建bean的方式、bean的作用域</strong>）</font></p> 
<ol><li> <p><font face="宋体" size="3" color="黑体">Ioc容器创建bean的方式</font></p> <p><font face="宋体" size="3" color="yesacghbvcxxgdsswd">1）默认构造器创建</font></p> <p><font face="宋体" size="3">在spring的配置文件中使用bean标签，配置以id 和class 属性后，且没有其他属性和标签时，采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，则对象无法创建</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.ferao.Service.UserService<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font face="宋体" size="3" color="yesacghbvcxxgdsswd">2）普通工厂中的方法</font></p> <p><font face="宋体" size="3">使用普通工厂中的方法创建对象(使用某个类中的方法创建对象，并存入spring 容器)</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>instanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.ferao.InstanceFactory<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span>  <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>instanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserService<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font face="宋体" size="3" color="yesacghbvcxxgdsswd">3）工厂中的静态方法</font></p> <p><font face="宋体" size="3">创建对象(使用某个类中的静态方法创建对象，并存入Spring容器)</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.ferao.Factory.InstanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserService<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font face="宋体" size="3" color="黑体">Ioc容器内bean的作用域</font></p> <p><font face="宋体" size="3">当通过Spring容器创建一个Bean实例时，不仅可以完成Bean实例的实例化，还可以为Bean指定特定的作用域(scope)。Spring支持如下5种作用域</font></p> <p><font face="宋体" size="3" color="gesvgxmlaqwiezaiziocjz">1)singleton 单例模式</font></p> <p><font face="宋体" size="3">单例模式，在整个Spring IoC容器中，使用singleton定义的Bean将只有一个实例</font></p> <p><font face="宋体" size="3" color="gesvgxmlaqwiezaiziocjz">2)protorype 原型模式</font></p> <p><font face="宋体" size="3">原型模式，每次通过容器的getBean方法获取prototype定义的Bean时，都将产生一个新的Bean实例</font></p> <p><font face="宋体" size="3" color="gesvgxmlaqwiezaiziocjz">3)request 模式</font></p> <p><font face="宋体" size="3">对于每次HTTP请求，使用request定义的Bean都将产生一个新实例，即每次HTTP请求将会产生不同的Bean实例。只有在Web应用中使用Spring时，该作用域才有效</font></p> <p><font face="宋体" size="3" color="gesvgxmlaqwiezaiziocjz">4)session 模式</font></p> <p><font face="宋体" size="3">对于每次HTTP Session，使用session定义的Bean豆浆产生一个新实例。同样只有在Web应用中使用Spring时，该作用域才有效</font></p> <p><font face="宋体" size="3" color="gesvgxmlaqwiezaiziocjz">5)global-session 模式</font></p> <p><font face="宋体" size="3">每个全局的HTTP Session，使用session定义的Bean都将产生一个新实例。典型情况下，仅在使用portlet context的时候有效。同样只有在Web应用中使用Spring时，该作用域才有效</font></p> <p><font face="宋体" size="3">其中比较常用的是singleton和prototype两种作用域。对于singleton作用域的Bean，每次请求该Bean都将获得相同的实例。容器负责跟踪Bean实例的状态，负责维护Bean实例的生命周期行为；如果一个Bean被设置成prototype作用域，程序每次请求该id的Bean，Spring都会新建一个Bean实例，然后返回给程序。在这种情况下，Spring容器仅仅使用new 关键字创建Bean实例，一旦创建成功，容器不在跟踪实例，也不会维护Bean实例的状态。</font></p> <p><font face="宋体" size="3">如果不指定Bean的作用域，Spring默认使用singleton作用域。<br> Java在创建Java实例时，需要进行内存申请；销毁实例时，需要完成垃圾回收，这些工作都会导致系统开销的增加。因此，prototype作用域Bean的创建、销毁代价比较大。而singleton作用域的Bean实例一旦创建成功，可以重复使用。因此，除非必要，否则尽量避免将Bean被设置成prototype作用域。</font></p> <p><font face="宋体" size="3">设置Bean的基本行为，通过scope属性指定，该属性可以接受singleton、prototype、request、session、globlesession5个值，分别代表以上5种作用域。</font></p> <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 默认的作用域：singleton --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.abc.Person<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token comment">&lt;!-- 指定的作用域：prototype --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.abc.Person<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prototype<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <pre><code class="prism language-java"><span class="token comment">//加载类路径下的beans.xml文件以初始化Spring容器</span>
<span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//分两次分别取同一个Bean，比较二者是否是同一个对象</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"p1"</span><span class="token punctuation">)</span> <span class="token operator">==</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"p1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"p2"</span><span class="token punctuation">)</span> <span class="token operator">==</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"p2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p><font face="宋体" size="2" color="黑体">控制台结果：<br> true<br> false</font></p> <p><img src="https://images2.imgbox.com/65/94/dmlkVyAT_o.png" alt="在这里插入图片描述"></p> </li><li> <p><font face="宋体" size="3" color="黑体">Ioc容器内bean的属性</font></p> <p><font face="宋体" size="2">id属性: id是bean的唯一标识符，在spring容器中不可能同时存在两个相同的id；</font></p> <p><font face="宋体" size="2">class属性: 类的全限定名（包名+类名），用“.”号连接；</font></p> <p><font face="宋体" size="2">name属性: 别名（alias），用法：getBean(“name”)，支持设置多个别名，之间用英文逗号分割；</font></p> <p><font face="宋体" size="2">abstract属性: 设置bean是否为抽象类，默认abstract=“false”,如果设为true，将不能被实例化；</font></p> <p><font face="宋体" size="2">autowire-candidate属性: 默认为true，如果为false，那么该bean不能作为其他bean自动装配的候选者。</font></p> <p><font face="宋体" size="2">init-method属性: 它的作用是在创建一个bean之后调用该方法，初始化方法必须是一个无参方法。</font></p> <p><font face="宋体" size="2">destroy-method属性: 它的作用是在销毁bean之前可以执行指定的方法。注意：必须满足scope=“singleton”，并且destroy方法参数个数不能超过1，并且参数类型只能为boolean。</font></p> <p><font face="宋体" size="2">factory-bean属性: 设置了factory-bean属性后，将指定创建bean的工厂类对象，class属性将失效；</font></p> <p><font face="宋体" size="2">factory-method属性: 设置了factory-method属性后，将指定创建bean的工厂方法；</font></p> <p><font face="宋体" size="2">scope属性: bean的作用范围，它包括singleton、prototype、request、session</font></p> <p><font face="宋体" size="2">depends-on属性: 它的作用是一个bean实例化的过程需要依赖于另一个bean的初始化，也就是说被依赖的bean将会在需要依赖的bean初始化之前加载。多个依赖bean之间用","号分割；</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">Ioc容器内bean的生命周期</font></p> 
  <ol><li> <p><font face="宋体" size="3">单例对象：</font></p> <p><font face="宋体" size="3">出生：当容器创建时对象出生</font></p> <p><font face="宋体" size="3">活着：只要容器还在，对象一直活着</font></p> <p><font face="宋体" size="3">死亡：容器销毁，对象消亡</font></p> <p><font face="宋体" size="2" color="grey">总结：单例对象的生命周期和容器相同</font></p> </li><li> <p><font face="宋体" size="3">多例对象：</font></p> <p><font face="宋体" size="3">出生：当我们使用对象时spring框架为我们创建</font></p> <p><font face="宋体" size="3">活着：对象只要是在使用过程中就一直活着</font></p> <p><font face="宋体" size="3">死亡：当对象长时间不用，且没有别的对象引用时，由java的垃圾回收机制回收</font></p> </li></ol> </li></ol> 
<blockquote> 
 <p><font color="black" size="3"><span id="ylzr">spring依赖注入</span></font></p> 
</blockquote> 
<p><font face="宋体" size="3">在当前类需要用到其他类的对象时，现在变成了由spring为我们提供，我们只需要在配置文件中说明需要引入类的相关信息即可，依赖关系的维护称之为依赖注入。</font></p> 
<p><font face="宋体" size="3">可注入的数据有如下三类：</font></p> 
<p><font face="宋体" size="3">1）基本类型和String</font></p> 
<p><font face="宋体" size="3">2）其他bean类型(在配置文件中或者注解配置过的bean)</font></p> 
<p><font face="宋体" size="3">3）复杂类型/集合类型</font></p> 
<p><font face="宋体" size="3">注入的方式有如下三类：</font></p> 
<p><font face="宋体" size="3">1）构造函数方法</font></p> 
<p><font face="宋体" size="3">2）set方法</font></p> 
<p><font face="宋体" size="3">3）注解方法</font></p> 
<p><font face="宋体" size="3">现在对注入方式进行详细解释：</font></p> 
<ol><li> <p><font face="宋体" size="3" color="黑体">构造函数方法</font></p> <p><font face="宋体" size="3">构造函方法注入使用constructor-arg标签并放置在bean标签的内部</font></p> <p><font face="宋体" size="3">constructor-arg标签的属性有：</font></p> <p><font face="宋体" size="2">a. type:用于指定要注入的数据的类型，该类型也是构造函数中某个或某些参数的类型</font></p> <p><font face="宋体" size="2">b. index：用于指定要注入的数据给构造函数中指定索引位置的参数赋值</font></p> <p><font face="宋体" size="2">c. name:用于指定给构造函数中指定名称的参数赋值</font></p> <p><font face="宋体" size="2" color="grey">[注]以上三个用于指定给构造函数中哪个参数赋值</font></p> <p><font face="宋体" size="2">d. value:用于指定其他的bean类型的数据，它指的就是spring的ioc核心容器中出现过的bean对象</font></p> <p><img src="https://images2.imgbox.com/b4/5b/64glHZJ3_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">bean对象中，注入数据是必须的操作，否则对象无法创建成功.即通过构造强制依赖关系，不能实例化不完全的或无法使用的bean。但改变了bean对象的实例化方式，使我们在创建对象时，如果用不到这些数据，也必须提供</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">set方法</font></p> <p><font face="宋体" size="3">set方法注入使用property标签并放置在bean标签的内部</font></p> <p><font face="宋体" size="3">property标签的属性有：</font></p> <p><font face="宋体" size="2">a. name: 用于指定注入时所调用的set方法名称</font></p> <p><font face="宋体" size="2">b. value: 用于提供基本类型和String类型的数据</font></p> <p><font face="宋体" size="2">c. ref: 用于指定其他的bean 类型的值，它指的就是spring的ioc核心容器中出现过的bean对象</font></p> <p><img src="https://images2.imgbox.com/69/31/6D2dCGBR_o.png" alt="在这里插入图片描述"></p> <p><font face="宋体" size="3">创建对象时没有明确的限制，可以直接使用默认构造函数,但如果有某个成员必须有值，则获取对象时有可能set方法没有执行,即缺点是无法清晰表达哪些属性是必须的，哪些是可选</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">注解方法</font></p> <p><font face="宋体" size="3">注解方法注入，注解配置和xml配置要实现的功能都是一样的，都是降低程序间的耦合，只是配置的形式不一样。</font></p> <p><font face="宋体" size="3">配置文件的内容可以总结为创建容器对象、 注入数据、改变作用范围、和生命周期相关 四个方面，注解方式则也一一对应配置文件的四个方面</font></p> 
  <ol><li> <p><font face="宋体" size="3" color="#1243">创建容器对象</font></p> <p><font face="宋体" size="3">它们的作用就和在xml配置文件中编写一个<code>&lt;bean&gt;</code>标签实现的功能是一样的</font></p> <p><font face="宋体" size="3">@Component：放置于类之上，用于把当前类对象存入spring容器中，内有value属性用于指定bean的id,当我们不写时，它的默认值是当前类名，且首字母小写</font></p> <p><font face="宋体" size="2" color="grey">[注]Controller、Service、Repository以上三个注解它们的作用和属性和Component是一模一样的，它们三个是Spring框架为我们提供明确的三层使用的注解，使我们的三层对象更加清晰</font></p> <p><img src="https://images2.imgbox.com/3d/d5/zCBeOnh7_o.png" alt="在这里插入图片描述"></p> </li><li> <p><font face="宋体" size="3" color="#1243">注入数据</font></p> <p><font face="宋体" size="3">它们的作用就和在xml配置文件中的<code>&lt;bean&gt;</code>标签中写一个<code>&lt;property&gt;</code>标签是一样的</font></p> <p><font face="宋体" size="3">@Autowired：放置于变量、方法，可自动按照类型注入，只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功</font></p> <p><font face="宋体" size="3">@Autowired放在属性上，是通过set方法注入，<br> @Autowired放在构造器上是通过构造方法注入，<br> 类加载顺序规定先加载构造方法，再加载普通方法，<br> 当构造器中使用到属性时，会发现属性还没有被实例化，则会报错，<br> 因此，当构造方法中用到了属性时，应该将注解加在构造器上</font></p> <p><img src="https://images2.imgbox.com/ee/b2/5WyhwYRP_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">@Qualifier：在按照类中注入的基础上再按照名称注入。它是给类成员注入时使用，不能单独使用，但是在给方法参数注入时可以.用于指定注入的，该注解有value属性，用于指定注入的bean的id</font></p> <p><font face="宋体" size="3">@Resource：直接按照bean的id注入，它可以单独使用，该注解有name属性，用于指定bean的id</font></p> <p><font face="宋体" size="3">@Value：用于注入基本类型和String类型的数据，该注解有value属性，用于指定数据的值，它可以使用spring中spEL(也就是spring的el表达式)</font></p> </li><li> <p><font face="宋体" size="3" color="#1243">改变作用范围</font></p> <p><font face="宋体" size="3">它们的作用集合在<code>&lt;bean&gt;</code>标签中使用scope属性实现的功能是一样的</font></p> </li><li> <p><font face="宋体" size="3" color="#1243">和生命周期相关</font></p> <p><font face="宋体" size="3">它们的作用就和在<code>&lt;bean&gt;</code>标签中使用init-method和destroy-method的作用是一样的</font></p> 
    <ol><li> <p><font color="bluie" size="3">注解注入</font></p> <pre><code class="prism language-java">		重要细节

		<span class="token operator">-</span><span class="token class-name">Autowired</span>注解与<span class="token class-name">Resource</span>注解的区别

		相同点

			<span class="token class-name">Resource</span>的作用相当于<span class="token class-name">Autowired</span>，均可在字段或属性的setter方法上

		不同点

			<span class="token number">1.</span> 提供方：<span class="token class-name">Autowired</span>是由<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Autowired</span>提供，换句话说就是由spring提供
			  <span class="token class-name">Resource</span>是由<span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Resource</span>提供，即j2ee提供，且jdk1<span class="token punctuation">.</span><span class="token number">6</span>及以上
			
			<span class="token number">2.</span> 注入方式：<span class="token class-name">Autowired</span>只按照byType注入；
			   <span class="token class-name">Resource</span>默认按byName自动注入，也提供按照byType注入

			<span class="token number">3.</span> 属性：<span class="token class-name">Autowired</span>：按照类型装配依赖对象，默认情况下它要求依赖
			   对象必须存在，如果允许<span class="token class-name">Null</span>值，可以设置它requested属性为
			   <span class="token boolean">false</span>。如果开发者想要使用按名称装配，可以结合<span class="token class-name">Qualifier</span>注
			   解一起使用。
			   <span class="token class-name">Resource</span>：有两个重要的属性：name和type<span class="token punctuation">.</span>name属性指定
			   byName，如果没有指定<span class="token class-name">Name</span>属性，当注解标注在字段上，即默
			   认取字段的名称作为bean名称寻找依赖对象。当注解标注在属性
			   的setter方法上，即默认取属性名作为bean名称寻找依赖对象，
			   需要注意的是，<span class="token class-name">Resource</span>如果没有指定name属性，并且按照默
			   认的名称找不到依赖对象时，<span class="token class-name">Resource</span>注解会回退到按类型装
			   配。但一旦指定了<span class="token class-name">Name</span>属性，就只能按照名称装配了

		<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>以上三个注入都只能注入其他bean类型的数据，而基本类型
		和<span class="token class-name">String</span>类型无法使用上述注解实现，以外，集合类型的注入只能通过
		xml来实现

改变作用范围示例

			scope
		
				作用：用于指定bean的作用范围

				属性：value<span class="token operator">:</span>指定范围的取值，常用取值：singletion prototype
</code></pre> <p><font color="bluie" size="3">注入后的使用</font></p> <pre><code class="prism language-java">问题点

	项目中遇到一个问题：项目启动完成前，在<span class="token class-name">A</span>类中注入<span class="token class-name">B</span>类，并调用<span class="token class-name">B</span>类的某个方法。

	那么调用<span class="token class-name">B</span>类的这个方法写在哪里呢，我选择写到构造器里，

	但是构造器先于<span class="token class-name">Spring</span>注入执行，那么执行构造器时，注入<span class="token class-name">B</span>类肯定为<span class="token keyword">null</span>，

	于是选择了构造器注入，解决问题

执行顺序

	静态变量或静态语句块–<span class="token operator">&gt;</span>实例变量或初始化语句块–<span class="token operator">&gt;</span>构造方法–<span class="token operator">&gt;</span><span class="token class-name">Spring</span>注入

常见的三种使用注入方式	
</code></pre> <pre><code class="prism language-java">	注解注入
			
		<span class="token annotation punctuation">@Controller</span>
		<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooController</span> <span class="token punctuation">{<!-- --></span>
		  <span class="token annotation punctuation">@Autowired</span>
		  <span class="token keyword">private</span> <span class="token class-name">FooService</span> fooService<span class="token punctuation">;</span>
		   
		  <span class="token comment">//简单的使用例子，下同</span>
		  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">&gt;</span></span> <span class="token function">listFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		      <span class="token keyword">return</span> fooService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
</code></pre> <p><font size="2" color="red">这种注入方式应该是笔者目前为止开发中见到的最常见的注入方式.原因很简单：<br> 1.注入方式非常简单：加入要注入的字段，附上@Autowired，即可完成。<br> 2.使得整体代码简洁明了，看起来美观大方。</font></p> <pre><code class="prism language-java">	构造器注入

		<span class="token annotation punctuation">@Controller</span>
		<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooController</span> <span class="token punctuation">{<!-- --></span>
		   
		  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FooService</span> fooService<span class="token punctuation">;</span>
		   
		  <span class="token annotation punctuation">@Autowired</span>
		  <span class="token keyword">public</span> <span class="token class-name">FooController</span><span class="token punctuation">(</span><span class="token class-name">FooService</span> fooService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		      <span class="token keyword">this</span><span class="token punctuation">.</span>fooService <span class="token operator">=</span> fooService<span class="token punctuation">;</span>
		  <span class="token punctuation">}</span>
		   
		  <span class="token comment">//使用方式上同，略</span>
		<span class="token punctuation">}</span>
</code></pre> <p><font size="2" color="red">在Spring4.x版本中推荐的注入方式就是这种，相较于上面的注解注入方式而言，就显<br> 得有点难看，特别是当注入的依赖很多（5个以上）的时候，就会明显的发现代码显得很臃肿。对于从注解<br> 注入转过来+有强迫症的开发人员来说，简直可以说是无法忍受。</font></p> <p><font color="bluie" size="3">循序渐进示例</font></p> <pre><code class="prism language-java">	写了一个类，分别有两个构造器，一个是注入一个<span class="token class-name">Bean</span>的构造器，一个是注入两个<span class="token class-name">Bean</span>的构造器			

		<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstructorAutowiredTest</span> <span class="token punctuation">{<!-- --></span>
		
		    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
		    <span class="token keyword">private</span> <span class="token class-name">Role</span> role<span class="token punctuation">;</span>
		
		    <span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token punctuation">}</span>
		
		    <span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		
		    <span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		        <span class="token keyword">this</span><span class="token punctuation">.</span>role <span class="token operator">=</span> role<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		
		    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user: "</span><span class="token operator">+</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"role: "</span><span class="token operator">+</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>	
</code></pre> <pre><code class="prism language-java">	<span class="token class-name">Spring</span>的配置文件context<span class="token punctuation">.</span>xml：

		<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>
		       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
		       xmlns<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/context"</span>
		       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>"http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
		       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">.</span>xsd
		       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context
		        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context<span class="token operator">/</span>spring<span class="token operator">-</span>context<span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">.</span>xsd "<span class="token operator">&gt;</span>
		
		    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使<span class="token class-name">Spring</span>关注<span class="token class-name">Annotation</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
		    <span class="token operator">&lt;</span>context<span class="token operator">:</span>annotation<span class="token operator">-</span>config<span class="token operator">/</span><span class="token operator">&gt;</span>
		
		    <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.mytest.demo.model.Role"</span> id<span class="token operator">=</span><span class="token string">"role"</span><span class="token operator">&gt;</span>
		        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"name"</span> value<span class="token operator">=</span><span class="token string">"testRole"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
		
		    <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.mytest.demo.model.User"</span> id<span class="token operator">=</span><span class="token string">"user"</span><span class="token operator">&gt;</span>
		        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"name"</span> value<span class="token operator">=</span><span class="token string">"testUser"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
		
		    <span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.mytest.demo.autowired.ConstructorAutowiredTest"</span> id<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		
		<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>	
</code></pre> <pre><code class="prism language-java">	那么，该类三个构造器，<span class="token class-name">Spring</span>会使用哪个构造器初始化
	<span class="token class-name">ConstructorAutowiredTest</span>这个<span class="token class-name">Bean</span>呢？写个测试便知：

		<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBeanAutowiredConstructor</span> <span class="token punctuation">{<!-- --></span>
		
		    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		        <span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        context<span class="token punctuation">.</span><span class="token function">setConfigLocation</span><span class="token punctuation">(</span><span class="token string">"context.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		        <span class="token class-name">ConstructorAutowiredTest</span> test <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        test<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>	
</code></pre> <p><img src="https://images2.imgbox.com/1d/98/zpsgW8I0_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">	从这里我们可以看出来，此时三个构造器中<span class="token class-name">Spring</span>使用了无参构造器。
	我们换一个方式，将无参构造器注释掉，看看<span class="token class-name">Spring</span>到底会使用哪个构造器呢？
	同样执行test方法测试，控制台打印：
</code></pre> <p><img src="https://images2.imgbox.com/07/6d/NnFxMDaW_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">	此时控制台报错，大致意思是<span class="token class-name">Bean</span>的实例化失败了，没有无参的构造器方法调用。
	此时有个疑问，明明构造器中的参数都是<span class="token class-name">Bean</span>，为什么不能初始化，
	一定要使用无参的构造器呢？是否是因为有两个构造器的原因？
	此时我们再注释掉任意一个构造函数，
	使测试类只有一个带参构造函数：
</code></pre> <pre><code class="prism language-java">	<span class="token comment">//    public ConstructorAutowiredTest() {<!-- --></span>
	<span class="token comment">//    }</span>
	
	    <span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	
	<span class="token comment">//    public ConstructorAutowiredTest(User user, Role role) {<!-- --></span>
	<span class="token comment">//        this.user = user;</span>
	<span class="token comment">//        this.role = role;</span>
	<span class="token comment">//    }</span>

	再次运行测试类，控制台打印：	
</code></pre> <p><img src="https://images2.imgbox.com/68/18/cPPrNNLF_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">	如果是注释掉第二个构造函数，则结果是两个对象都有。
	从这里我们可以看出，如果只有一个构造器，且参数为<span class="token constant">IOC</span>容器中的<span class="token class-name">Bean</span>，
	将会执行自动注入。这里又有一个疑问，这也太不科学了吧，
	强制用户一定只能写一个构造器？
	这时我们猜想<span class="token annotation punctuation">@Autowired</span>注解是否能解决这种问题？
	来试试吧。我们将构造器全部解除注释，将第三个构造器打上<span class="token annotation punctuation">@Autowired</span>注解：
</code></pre> <pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token annotation punctuation">@Autowired</span>
		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>role <span class="token operator">=</span> role<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/8c/5c/qOjc4cdb_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">	不出所料，<span class="token annotation punctuation">@Autowired</span>注解可以解决这种问题，
	此时<span class="token class-name">Spring</span>将使用有注解的构造函数进行<span class="token class-name">Bean</span>的初始化。
	那么，如果有两个<span class="token annotation punctuation">@Autowired</span>注解呢？结果肯定是报错，
	因为<span class="token annotation punctuation">@Autowired</span>的默认属性required是为<span class="token boolean">true</span>的，
	也就是说两个required<span class="token operator">=</span><span class="token boolean">true</span>的构造器，<span class="token class-name">Spring</span>不知道使用哪一个。但如果是这样写的话：
</code></pre> <pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span>
		
		<span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
		<span class="token keyword">public</span> <span class="token class-name">ConstructorAutowiredTest</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">Role</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
		    <span class="token keyword">this</span><span class="token punctuation">.</span>role <span class="token operator">=</span> role<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/f0/c8/U8oCqNHg_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">	使用参数最多的那一个构造器来初始化<span class="token class-name">Bean</span>。
	又如果两个有参构造器顺序调换又是怎样的呢？一个required为<span class="token boolean">false</span>一个为<span class="token boolean">true</span>，
	结果又是怎样的呢？这里直接给出答案，顺序调换依然使用多参数构造器，
	并且required只要有一个<span class="token boolean">true</span>就会报错。有兴趣的读者可以自己试试，
	下面将深入源码分析构造器注入的过程，相信上述所有疑问都能得到解答。
</code></pre> <pre><code class="prism language-java">	setter注入

		<span class="token annotation punctuation">@Controller</span>
		<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooController</span> <span class="token punctuation">{<!-- --></span>
		   
		  <span class="token keyword">private</span> <span class="token class-name">FooService</span> fooService<span class="token punctuation">;</span>
		   
		  <span class="token comment">//使用方式上同，略</span>
		  <span class="token annotation punctuation">@Autowired</span>
		  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFooService</span><span class="token punctuation">(</span><span class="token class-name">FooService</span> fooService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		      <span class="token keyword">this</span><span class="token punctuation">.</span>fooService <span class="token operator">=</span> fooService<span class="token punctuation">;</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
</code></pre> <p><font size="2" color="red">在Spring3.x刚推出的时候，推荐使用注入的就是这种，笔者现在也基本没看到过这种<br> 注解方式，写起来麻烦，当初推荐Spring自然也有他的道理，这里我们引用一下Spring当时的原话:<br> 构造器注入参数太多了，显得很笨重，另外setter的方式能够让类在之后重新配置或者重新注入。</font></p> <pre><code class="prism language-java">构造器注入的好处

	spring文档

		构造器注入的方式，能够保证注入的组件不可变，并且确保需要的依赖不为空。此外，
		构造器注入的依赖总是能够在返回客户端（组件）代码的时候保证完全初始化的状态。

	解释
	
		依赖不可变：其实说的就是<span class="token keyword">final</span>关键字，这里不再多解释了。
	
		依赖不为空（省去了我们对其检查）：当要实例化<span class="token class-name">FooController</span>的时候，
		由于自己实现了有参数的构造函数，所以不会调用默认构造函数，
		那么就需要<span class="token class-name">Spring</span>容器传入所需要的参数，所以就两种情况：
		<span class="token number">1</span>、有该类型的参数<span class="token operator">-&gt;</span>传入，<span class="token constant">OK</span> 。
		<span class="token number">2</span>：无该类型的参数<span class="token operator">-&gt;</span>报错。所以保证不会为空

		完全初始化的状态：这个可以跟上面的依赖不为空结合起来，
		向构造器传参之前，要确保注入的内容不为空，
		那么肯定要调用依赖组件的构造方法完成实例化。
		而在<span class="token class-name">Java</span>类加载实例化的过程中，构造方法是最后一步
		（之前如果有父类先初始化父类，然后自己的成员变量，最后才是构造方法，这里不详细展开。）
		所以返回来的都是初始化之后的状态。


	总结

	    保证依赖不可变（<span class="token keyword">final</span>关键字）
	    保证依赖不为空（省去了我们对其检查）
	    保证返回客户端（调用）的代码的时候是完全初始化的状态
	    避免了循环依赖
	    提升了代码的可复用性

构造器注入的缺点	

		当注入的依赖很多（<span class="token number">5</span>个以上）的时候，就会明显的发现代码显得很臃肿。	

set注入的好处		

		setter的方式能够让类在之后重新配置或者重新注入

set注入的缺点	

		写起来麻烦

field注入的缺点	

	对于<span class="token constant">IOC</span>容器以外的环境，除了使用反射来提供它需要的依赖之外，无法复用该实现类。
	而且将一直是个潜在的隐患，因为你不调用将一直无法发现<span class="token constant">NPE</span>的存在。
	还值得一提另外一点是：使用field注入可能会导致循环依赖，即<span class="token class-name">A</span>里面注入<span class="token class-name">B</span>，<span class="token class-name">B</span>里面又注入<span class="token class-name">A</span>

	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token annotation punctuation">@Autowired</span>
	    <span class="token keyword">private</span> <span class="token class-name">B</span> b<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	 
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token annotation punctuation">@Autowired</span>
	    <span class="token keyword">private</span> <span class="token class-name">A</span> a<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	

	如果使用构造器注入，在spring项目启动的时候，就会抛出：
	<span class="token class-name">BeanCurrentlyInCreationException</span>：<span class="token class-name">Requested</span> bean is currently in creation<span class="token operator">:</span> <span class="token class-name">Is</span> there an unresolvable circular reference？
	从而提醒你避免循环依赖，如果是field注入的话，启动的时候不会报错，
	在使用那个bean的时候才会报错。

</code></pre> </li></ol> </li></ol> </li></ol> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="springsw">spring事务</span></font></p> 
</blockquote> 
<p><font face="宋体" size="2">事务在企业日常开发中几乎是一定会遇到的，例如一个审核的流程可能涉及到查询、修改、插入等操作，所以保证事务性是很有必要的。<font face="宋体" size="2">一般就是开启事务支持，然后@Transactional，但是事务不仅仅是这些，可以了解一下细节。</font></font></p> 
<p><font face="宋体" size="2">首先看一下spring事务的三个要素：</font></p> 
<p><font face="宋体" size="2">• DataSource：事务的真正处理者，如MySQL等。<br> <font face="宋体" size="2">• TransactionManager：管理事务的处理过程，如打开、提交、回滚。<br> <font face="宋体" size="2">• 事务应用和属性配置：作为一个标识符表明哪些方法要参与事务，一些配置：隔离级别、超时时间等。</font></font></font></p> 
<p><font face="宋体" size="2">其中TransactionManager指事务管理器，Spring并不直接管理事务，而是提供了多种事务管理器，他们将事务管理的职责委托给Hibernate或者JTA等持久化机制所提供的相关平台框架的事务来实现。Spring事务设计的接口如下：</font></p> 
<p><img src="https://images2.imgbox.com/98/30/HBFpqAgI_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="2">PlatformTransactionManager具体代码：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//由TransactionDefinition得到TransactionStatus对象</span>
    <span class="token class-name">TransactionStatus</span> <span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">TransactionDefinition</span> definition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
    <span class="token comment">//提交事务</span>
    <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
    <span class="token comment">//回滚事务</span>
    <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">PlatformTransactionManager是Spring事务管理器的接口，通过这个接口，JDBC、Hibernate等提供了对应的任务管理器，进行具体的实现，下面列出jdbc事务、Hibernate事务、Java持久化API事务（JPA）、Java原生API事务 四种的示例：</font></p> 
<p><font face="宋体" size="2">①jdbc事务</font></p> 
<p><font face="宋体" size="2">如果应用程序中直接使用JDBC来进行持久化，DataSourceTransactionManager会为你处理事务边界。为了使用DataSourceTransactionManager，你需要使用如下的XML将其装配到应用程序的上下文定义中：</font></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">实际上，DataSourceTransactionManager是通过调用java.sql.Connection来管理事务，而后者是通过DataSource获取到的。通过调用连接的commit()方法来提交事务，同样，事务失败则通过调用rollback()方法进行回滚。</font></p> 
<p><font face="宋体" size="2">②Hibernate事务</font></p> 
<p><font face="宋体" size="2">如果应用程序的持久化是通过Hibernate实现的，那么你需要使用HibernateTransactionManager。对于Hibernate3，需要在Spring上下文定义中添加如下的声明：</font></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">sessionFactory属性需要装配一个Hibernate的session工厂，HibernateTransactionManager的实现细节是它将事务管理的职责委托给org.hibernate.Transaction对象，而后者是从Hibernate Session中获取到的。当事务成功完成时，HibernateTransactionManager将会调用Transaction对象的commit()方法，反之，将会调用rollback()方法。</font></p> 
<p><font face="宋体" size="2">③Java持久化API事务（JPA）</font></p> 
<p><font face="宋体" size="2">Hibernate多年来一直是事实上的Java持久化标准，但是现在Java持久化API作为真正的Java持久化标准进入大家的视野。如果你计划使用JPA的话，那你需要使用Spring的JpaTransactionManager来处理事务。你需要在Spring中这样配置JpaTransactionManager：</font></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.jpa.JpaTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">JpaTransactionManager只需要装配一个JPA实体管理工厂（javax.persistence.EntityManagerFactory接口的任意实现）。JpaTransactionManager将与由工厂所产生的JPA EntityManager合作来构建事务。</font></p> 
<p><font face="宋体" size="2">④Java原生API事务</font></p> 
<p><font face="宋体" size="2">如果你没有使用以上所述的事务管理，或者是跨越了多个事务管理源（比如两个或者是多个不同的数据源），你就需要使用JtaTransactionManager：</font></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.transaction.jta.JtaTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManagerName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java:/TransactionManager<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">JtaTransactionManager将事务管理的责任委托给javax.transaction.UserTransaction和javax.transaction.TransactionManager对象，其中事务成功完成通过UserTransaction.commit()方法提交，事务失败通过UserTransaction.rollback()方法回滚。</font></p> 
<p><font face="宋体" size="2">上面讲到的事务管理器接口PlatformTransactionManager通过getTransaction(TransactionDefinition definition)方法来得到事务，这个方法里面的参数是TransactionDefinition类，这个类就定义了一些基本的事务属性。</font></p> 
<p><font face="宋体" size="2">事务属性可以理解成事务的一些基本配置，描述了事务策略如何应用到方法上。事务属性包含了5个方面，如图所示：</font></p> 
<p><img src="https://images2.imgbox.com/7b/2f/mYeKAe7o_o.png" alt="在这里插入图片描述"></p> 
<p><font face="宋体" size="2">TransactionDefinition代码如下：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransactionDefinition</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token function">getPropagationBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 　　<span class="token comment">// 返回事务的传播行为</span>
    <span class="token keyword">int</span> <span class="token function">getIsolationLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 　　 　　<span class="token comment">// 返回事务的隔离级别，事务管理器根据它来控制另外一个事务可以看到本事务内的哪些数据</span>
    <span class="token keyword">int</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  　　　　　　　　<span class="token comment">// 返回事务必须在多少秒内完成</span>
    <span class="token keyword">boolean</span> <span class="token function">isReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 　　　　　　<span class="token comment">// 事务是否只读，事务管理器能够根据这个返回值进行优化，确保事务是只读的</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">Spring定义了七种传播行为：</font></p> 
<p><font face="宋体" size="2" color="grey">在运用中难免遇到事务嵌套的场景，比如一个事务方法里面调用了另外一个事务方法，那么两个方法是各自作为独立的方法提交还是内层的事务合并到外层的事务一起提交，这时就需要<strong>spring事务的传播机制</strong>进行配置来确定怎么样执行</font></p> 
<p><img src="https://images2.imgbox.com/cd/3f/XLkKvxQC_o.png" alt="在这里插入图片描述"></p> 
<font face="宋体" size="2"> </font> 
<p><font face="宋体" size="2">在Spring中支持<strong>编程式事务</strong>以及<strong>声明式事务</strong>两种方式</font></p> 
<p><font face="宋体" size="2">编程式事务允许用户在代码中精确定义事务的边界，粒度是代码块级别；<br> 而声明式事务（基于AOP）有助于用户将操作与事务规则进行解耦，粒度是方法级别；<br> 编程式事务侵入到了业务代码里面，但是提供了更加详细的事务管理，；而声明式事务由于基于AOP，所以既能起到事务管理的作用，又可以不影响业务代码的具体实现。</font></p> 
<ol><li> <p><font face="宋体" size="2" color="黑体">编程式事务管理</font></p> <p><font face="宋体" size="2">Spring提供两种方式的编程式事务管理，分别是：使用TransactionTemplate和直接使用PlatformTransactionManager。对于编程式事务管理，Spring推荐使用TransactionTemplate。</font></p> <p><font face="宋体" size="2">①使用TransactionTemplate</font></p> <p><font face="宋体" size="2">采用TransactionTemplate和采用其他Spring模板，如JdbcTempalte和HibernateTemplate是一样的方法。它使用回调方法，把应用程序从处理取得和释放资源中解脱出来。如同其他模板，TransactionTemplate是线程安全的。代码片段：</font></p> <pre><code class="prism language-java"><span class="token class-name">TransactionTemplate</span> tt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新建一个TransactionTemplate</span>
    <span class="token class-name">Object</span> result <span class="token operator">=</span> tt<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">TransactionCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  
                <span class="token function">updateOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">return</span> <span class="token function">resultOfUpdateOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行execute方法进行事务管理</span>
</code></pre> <p><font face="宋体" size="2">使用TransactionCallback()可以返回一个值。如果使用TransactionCallbackWithoutResult则没有返回值。</font></p> <p><font face="宋体" size="2">②使用PlatformTransactionManager</font></p> <pre><code class="prism language-java"><span class="token class-name">DataSourceTransactionManager</span> dataSourceTransactionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//定义一个某个框架平台的TransactionManager，如JDBC、Hibernate</span>
dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置数据源</span>
<span class="token class-name">DefaultTransactionDefinition</span> transDef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultTransactionDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义事务属性</span>
transDef<span class="token punctuation">.</span><span class="token function">setPropagationBehavior</span><span class="token punctuation">(</span><span class="token class-name">DefaultTransactionDefinition</span><span class="token punctuation">.</span><span class="token constant">PROPAGATION_REQUIRED</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置传播行为属性</span>
<span class="token class-name">TransactionStatus</span> status <span class="token operator">=</span> dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>transDef<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得事务状态</span>
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 数据库操作</span>
    dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 提交</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 回滚</span>
<span class="token punctuation">}</span>
</code></pre> <font face="宋体" size="2"> </font></li><li> <p><font face="宋体" size="2" color="黑体">声明式事务管理</font></p> <p><font face="宋体" size="2">声明式事务管理建立在AOP之上，其本质是对方法前后进行拦截，然后在目标方法开始之前创建或者加入一个事务，执行完目标方法之后根据执行的情况提交或者回滚。</font></p> <p><font face="宋体" size="2">根据代理机制的不同，总结了五种Spring事务的配置方式，配置文件如下：</font></p> 
  <ol><li> <p><font face="宋体" size="2" color="黑体">每个Bean都有一个代理[配置文件]</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.LocalSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:hibernate.cfg.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configurationClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.hibernate.cfg.AnnotationConfiguration<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 

    <span class="token comment">&lt;!-- 定义事务管理器（声明式的事务） --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
   
    <span class="token comment">&lt;!-- 配置DAO --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDaoTarget<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky.spring.dao.UserDaoImpl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> 
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.transaction.interceptor.TransactionProxyFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
           <span class="token comment">&lt;!-- 配置事务管理器 --&gt;</span> 
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>target<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDaoTarget<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>proxyInterfaces<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky.spring.dao.GeneratorDao<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 配置事务属性 --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionAttributes<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>PROPAGATION_REQUIRED<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font face="宋体" size="2" color="黑体">所有Bean共享一个代理基类[配置文件]</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.LocalSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:hibernate.cfg.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configurationClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.hibernate.cfg.AnnotationConfiguration<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 

    <span class="token comment">&lt;!-- 定义事务管理器（声明式的事务） --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionBase<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.transaction.interceptor.TransactionProxyFactoryBean<span class="token punctuation">"</span></span> 
            <span class="token attr-name">lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">abstract</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- 配置事务管理器 --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token comment">&lt;!-- 配置事务属性 --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionAttributes<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>PROPAGATION_REQUIRED<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>   
  
    <span class="token comment">&lt;!-- 配置DAO --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDaoTarget<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky.spring.dao.UserDaoImpl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionBase<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>target<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDaoTarget<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font face="宋体" size="2" color="黑体">使用拦截器[配置文件]</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.LocalSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:hibernate.cfg.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configurationClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.hibernate.cfg.AnnotationConfiguration<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 

    <span class="token comment">&lt;!-- 定义事务管理器（声明式的事务） --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 
  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionInterceptor<span class="token punctuation">"</span></span> 
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.transaction.interceptor.TransactionInterceptor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token comment">&lt;!-- 配置事务属性 --&gt;</span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionAttributes<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>PROPAGATION_REQUIRED<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
     
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beanNames<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>*Dao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interceptorNames<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> 
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>transactionInterceptor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 
 
    <span class="token comment">&lt;!-- 配置DAO --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky.spring.dao.UserDaoImpl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font face="宋体" size="2" color="黑体">使用tx标签配置的拦截器[配置文件]</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.LocalSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:hibernate.cfg.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configurationClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.hibernate.cfg.AnnotationConfiguration<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 

    <span class="token comment">&lt;!-- 定义事务管理器（声明式的事务） --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token comment">&lt;!--配置事务传播性，隔离级别以及超时回滚等问题 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>REQUIRED<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    	<span class="token comment">&lt;!--配置事务切点 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interceptorPointCuts<span class="token punctuation">"</span></span>
            <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>execution(* com.bluesky.spring.dao.*.*(..))<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span>
            <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interceptorPointCuts<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>       
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>     
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font face="宋体" size="2" color="黑体">全注解[配置文件]</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.bluesky<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> 
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.LocalSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:hibernate.cfg.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configurationClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.hibernate.cfg.AnnotationConfiguration<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span> 

    <span class="token comment">&lt;!-- 定义事务管理器（声明式的事务） --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font face="宋体" size="2">此时在DAO上需加上@Transactional注解</font></p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bluesky<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span><span class="token class-name">SessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>hibernate3<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">HibernateDaoSupport</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>bluesky<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"userDao"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">HibernateDaoSupport</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">"from User"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><font face="宋体" size="3">使用@Transactional 注解时，该注解可以添加到类级别上、也可以添加到方法级别上。<br> 当把@Transactional 注解放在类级别时，表示所有该类的公共方法都配置相同的事务属性信息。<br> 当把@Transactional 注解放在方法级别时，表示仅该公共方法支持事务。<br> 当类级别配置了@Transactional，方法级别也配置了@Transactional，应用程序会以方法级别的事务属性信息来管理事务，换言之，方法级别的事务属性信息会覆盖类级别的相关配置信息。</font></p> <p><font face="宋体" size="3">在进行事务支持时，Spring只需要使用者在需要事务支持的bean上使用@Transactional注解即可，如果需要修改事务的隔离级别和传播特性的属性，则使用该注解中的属性进行指定。这里默认的隔离级别与各个数据库一致，比如MySQL是Repeatable Read，而传播特性默认则为Propagation.REQUIRED，即只需要当前操作具有事务即可。</font></p> <p><font face="宋体" size="3">@Transactional 注解管理事务的实现步骤很简单。但是如果对 Spring 中的 @transaction 注解的事务管理理解的不够透彻，就很容易出现错误，比如事务应该回滚（rollback）而没有回滚事务的问题。这时需要分析 Spring 的注解方式的事务实现机制，然后列出相关的注意事项，以最终达到帮助开发人员准确而熟练的使用 Spring 的事务的目的。</font></p> <p><font face="楷体" size="3" color="orange">@Transactional 注解管理事务的实现步骤</font></p> <p><font face="宋体" size="3">第一步，在 xml 配置文件中添加事务配置信息</font></p> <pre><code class="prism language-java"><span class="token operator">&lt;</span>tx<span class="token operator">:</span>annotation<span class="token operator">-</span>driven transaction<span class="token operator">-</span>manager<span class="token operator">=</span><span class="token string">"transactionManager"</span> order<span class="token operator">=</span><span class="token string">"200"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"transactionManager"</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"dataSource"</span> ref<span class="token operator">=</span><span class="token string">"dataSource"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre> <p><font face="宋体" size="2" color="grey">除了用配置文件的方式，@EnableTransactionManagement 注解也可以启用事务管理功能</font></p> <p><font face="宋体" size="3">第二步，将@Transactional 注解添加到合适的方法上，并设置合适的属性信息</font></p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"transactionManager"</span><span class="token punctuation">,</span> propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> 
<span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">insertEntry</span><span class="token punctuation">(</span><span class="token class-name">BaseRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <p><font face="楷体" size="3" color="orange">@Transactional 注解的属性信息</font></p> 
    <table><thead><tr><th>属性名</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>当在配置文件中有多个 TransactionManager , 可以用该属性指定选择哪个事务管理器</td></tr><tr><td>propagation</td><td>事务的传播行为，默认值为 REQUIRED， 如果有事务, 那么加入事务, 没有的话新建一个(默认情况下)，@Transactional(propagation=Propagation.REQUIRED)</td></tr><tr><td>isolation</td><td>事务的隔离度，默认值采用 DEFAULT，@Transactional(isolation = Isolation.READ_UNCOMMITTED) ， ，未提交读，就是一个事务可以读取另一个未提交事务的数据。读取未提交数据(会出现脏读, 不可重复读) 基本不使用；@Transactional(isolation = Isolation.READ_COMMITTED)，已提交读，就是一个事务要等另一个事务提交后才能读取数据。可以解决脏读，可能会出现不可重复读问题；@Transactional(isolation = Isolation.REPEATABLE_READ)，重复读，就是在开始读取数据（事务开启）时，不再允许修改操作，重复读可以解决不可重复读问题。不可重复读对应的是修改，即UPDATE操作。但是可能还会有幻读问题。因为幻读问题对应的是插入INSERT操作，而不是UPDATE操作。@Transactional(isolation = Isolation.SERIALIZABLE) ,是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。</td></tr><tr><td>timeout</td><td>事务的超时时间，默认值为-1。如果超过该时间限制但事务还没有完成，则自动回滚事务，@Transactional(timeout=30) //默认是30秒，注意这里说的是事务的超时性而不是Connection的超时性，这两个是有区别的</td></tr><tr><td>read-only</td><td>该属性用于设置当前事务是否为只读事务，设置为true表示只读，false则表示可读写，默认值为false，@Transactional(readOnly=true)</td></tr><tr><td>rollback-for</td><td>用于指定能够触发事务回滚的异常类型，如果有多个异常类型需要指定，各类型之间可以通过逗号分隔，指定单一异常类：@Transactional(rollbackFor=RuntimeException.class)，指定多个异常类：@Transactional(rollbackFor={RuntimeException.class, Exception.class})</td></tr><tr><td>no-rollback- for</td><td>抛出 no-rollback-for 指定的异常类型，不回滚事务</td></tr></tbody></table></li></ol> </li></ol> 
<p><font face="宋体" size="3">传播规则总结回答了这样一个问题：一个新的事务应该被启动还是被挂起，或者是一个方法是否应该在事务性上下文中运行。</font></p> 
<p><font face="宋体" size="3">在配置了事务的传播机制后一段时间，应用中的事务逐渐增多，此时会出现多个事务同时运行，经常会为了完成他们的工作而操作同一个数据。并发虽然是必需的，但是会导致以下问题：</font></p> 
<ol><li> <p><font face="宋体" size="3" color="黑体">脏读（Dirty read）</font></p> <p><font face="宋体" size="3">脏读发生在一个事务读取了被另一个事务改写但尚未提交的数据时。如果这些改变在稍后被回滚了，那么第一个事务读取的数据就会是无效的。</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">不可重复读（Nonrepeatable read）</font></p> <p><font face="宋体" size="3">不可重复读发生在一个事务执行相同的查询两次或两次以上，但每次查询结果都不相同时。这通常是由于另一个并发事务在两次查询之间更新了数据。(不可重复读重点在修改)</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">幻读（Phantom reads）</font></p> <p><font face="宋体" size="3">幻读和不可重复读相似。当一个事务（T1）读取几行记录后，另一个并发事务（T2）插入了一些记录时，幻读就发生了。在后来的查询中，第一个事务（T1）就会发现一些原来没有的额外记录。(幻读重点在新增或删除)</font></p> </li></ol> 
<p><font face="宋体" size="3">在理想状态下，事务之间将完全隔离，从而可以防止这些问题发生。然而，完全隔离会影响性能，因为隔离经常涉及到锁定在数据库中的记录（甚至有时是锁表）。完全隔离要求事务相互等待来完成工作，会阻碍并发。因此，可以根据业务场景选择不同的隔离级别。</font></p> 
<ol><li> <p><font face="宋体" size="3" color="黑体">ISOLATION_DEFAULT</font></p> <p><font face="宋体" size="3">使用后端数据库默认的隔离级别</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">ISOLATION_READ_UNCOMMITTED</font></p> <p><font face="宋体" size="3">允许读取尚未提交的更改。可能导致脏读、幻读或不可重复读</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">ISOLATION_READ_COMMITTED</font></p> <p><font face="宋体" size="3">（Oracle 默认级别）允许从已经提交的并发事务读取。可防止脏读，但幻读和不可重复读仍可能会发生。</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">ISOLATION_REPEATABLE_READ</font></p> <p><font face="宋体" size="3">(MYSQL默认级别）对相同字段的多次读取的结果是一致的，除非数据被当前事务本身改变。可防止脏读和不可重复读，但幻读仍可能发生</font></p> </li><li> <p><font face="宋体" size="3" color="黑体">ISOLATION_SERIALIZABLE</font></p> <p><font face="宋体" size="3">完全服从ACID的隔离级别，确保不发生脏读、不可重复读和幻影读。这在所有隔离级别中也是最慢的，因为它通常是通过完全锁定当前事务所涉及的数据表来完成的</font></p> </li></ol> 
<p><font face="宋体" size="2" color="grey">[注]可以把事务的隔离级别想象为这个事务对于事物处理数据的自私程度。</font></p> 
<p><font face="宋体" size="3">在了解了spring事务管理方式、spring事务的传播机制、事务隔离级别后，接下来进行具体的<strong>用例搭建</strong>部分，流程思路图如下：</font></p> 
<p><img src="https://images2.imgbox.com/6d/01/slkjOzIm_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">Spring配置文件中关于事务配置总是由三个组成部分，分别是DataSource、TransactionManager和代理机制这三部分，无论哪种配置方式，一般变化的只是代理机制这部分。</font></p> 
<p><font face="宋体" size="3">DataSource、TransactionManager这两部分只是会根据数据访问方式有所变化，比如使用Hibernate进行数据访问时，DataSource实际为SessionFactory，TransactionManager的实现为<code>org.springframework.orm.hibernate3.HibernateTransactionManager</code><br> 使用mybatis 进行数据访问时，DataSource实际为DataSource，TransactionManager的实现为<code>org.springframework.jdbc.datasource.DataSourceTransactionManager</code>【具体如上图】。</font></p> 
<p><font face="黑体" size="3" color="red"><span id="threesix">事务常规名词</span></font></p> 
<p><font face="楷体" size="3" color="orange">只读</font></p> 
<p><font face="宋体" size="3">如果一个事务只对数据库执行读操作，那么该数据库就可能利用那个事务的只读特性，采取某些优化措施。通过把一个事务声明为只读，可以给后端数据库一个机会来应用那些它认为合适的优化措施。由于只读的优化措施是在一个事务启动时由后端数据库实施的， 因此，只有对于那些具有可能启动一个新事务的传播行为（PROPAGATION_REQUIRES_NEW、PROPAGATION_REQUIRED、 ROPAGATION_NESTED）的方法来说，将事务声明为只读才有意义。</font></p> 
<p><font face="楷体" size="3" color="orange">事务超时</font></p> 
<p><font face="宋体" size="3">为了使一个应用程序很好地执行，它的事务不能运行太长时间。因此，声明式事务的下一个特性就是它的超时。</font></p> 
<p><font face="宋体" size="3">假设事务的运行时间变得格外的长，由于事务可能涉及对数据库的锁定，所以长时间运行的事务会不必要地占用数据库资源。这时就可以声明一个事务在特定秒数后自动回滚，不必等它自己结束。</font></p> 
<p><font face="宋体" size="3">由于超时时钟在一个事务启动的时候开始的，因此，只有对于那些具有可能启动一个新事务的传播行为（PROPAGATION_REQUIRES_NEW、PROPAGATION_REQUIRED、ROPAGATION_NESTED）的方法来说，声明事务超时才有意义。</font></p> 
<p><font face="楷体" size="3" color="orange">回滚规则</font></p> 
<p><font face="宋体" size="3">在默认设置下，事务只在出现运行时异常（runtime exception）时回滚，而在出现受检查异常（checked exception）时不回滚（这一行为和EJB中的回滚行为是一致的）。</font></p> 
<p><font face="宋体" size="3">不过，可以声明在出现特定受检查异常时像运行时异常一样回滚。同样，也可以声明一个事务在出现特定的异常时不回滚，即使特定的异常是运行时异常。</font></p> 
<p><font face="楷体" size="3" color="orange">spring事务回滚规则</font></p> 
<p><font face="宋体" size="3">默认配置下，spring只有在抛出的异常为运行时unchecked异常时才回滚该事务，也就是抛出的异常为RuntimeException的子类(Errors也会导致事务回滚)，而抛出checked异常则不会导致事务回滚。<br> 可以明确配置在抛出那些异常时回滚事务，包括checked异常。也可以明确定义那些异常抛出时不回滚事务。</font></p> 
<blockquote> 
 <p><font color="black" size="4"><span id="sjjt">spring事件监听</span></font></p> 
</blockquote> 
<p><font face="宋体" size="3">需求是用户在京西商城下单成功后，平台要发送短信通知用户下单成功。开发者最直观的想法是直接在order()方法中添加发送短信的业务代码：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 下单成功</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 发送短信</span>
  <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">乍一看没什么不妥，但是如果我们加上一根时间轴，那么代码就有问题了：一个月后，京西搞了自建物流体系，用户下单成功后，需要通知物流系统发货，于是开发者又要打开OrderService修改order()方法：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 下单成功</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 发送短信</span>
  <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通知车队发货 </span>
  <span class="token function">notifyCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">又过了一个月，东哥被抓了，股价暴跌，决定卖掉自己的车队，所以下单后就不用通知车队了，重新修改OrderService：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 下单成功</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 发送短信</span>
  <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 车队没了，注释掉这行代码 </span>
  <span class="token comment">// notifyCar();</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">又过了一个月，东哥明尼苏达州荣耀归来：回来做我的兄弟一起开车吧。</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 下单成功</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 发送短信</span>
  <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 车队买回来了</span>
  <span class="token function">notifyCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">车队回来了，开发者却受不了这大起大落异常刺激的生活，决定离职。就在这时候，组长拉住了你，语重心长地和你说：小伙子，知道什么叫“以增量的方式应对变化的需求”吗？听过Spring监听机制吗？说时迟那时快，组长拿来一支笔和一张纸，唰唰唰画了一张图。</font></p> 
<p><img src="https://images2.imgbox.com/8c/8d/eYGTpvLy_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">你顿时心领神会，扑通一声跪在了地上，开始敲起了代码。</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 订单服务（利用Spring事件机制完成需求示例）
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 下单成功</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发布通知</span>
        applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrderSuccessEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"main线程结束..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">继承ApplicationEvent，自定义事件：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderSuccessEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * Create a new ApplicationEvent.
     *
     * @param source the object on which the event initially occurred (never {@code null})
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">OrderSuccessEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">实现ApplicationListener，监听OrderSuccessEvent：</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 短信服务，监听OrderSuccessEvent
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsService</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderSuccessEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">OrderSuccessEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 发送短信
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送短信..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">测试：</font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSpringEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        orderService<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>	
</code></pre> 
<p><font face="宋体" size="2">输出：<br> <font face="宋体" size="2">下单成功…<br> <font face="宋体" size="2">发送短信…<br> <font face="宋体" size="2">main线程结束…</font></font></font></font></p> 
<p><font face="宋体" size="3">如果后期针对下单成功有新的操作，可以新写一个事件监听类：</font></p> 
<p><font face="宋体" size="3">如增加物流服务</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 物流服务
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarService</span>  <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderSuccessEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">OrderSuccessEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发车咯..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">这就是“以增量的方式应对变化的需求”，而不是去修改已有的代码。假设有B接口调用了C接口，你修改了C接口，那么B接口可能业务结果就错了，此时调用B接口的A接口也可能受到影响，是连锁反应。所以，一般我们都提倡“对扩展开放，对修改关闭”的原则。<br> 上面SmsService既是一个服务，还是一个Listener，因为它既有@Service又实现了ApplicationListener接口。但是仅仅是为了一个监听回调方法而实现一个接口，未免麻烦，所以Spring提供了注解的方式：</font></p> 
<p><font face="宋体" size="3">监听LendSuccessEvent，但不用实现ApplicationListener</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 短信服务
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 发送短信 @EventListener指定监听的事件
     */</span>
    <span class="token annotation punctuation">@EventListener</span><span class="token punctuation">(</span><span class="token class-name">LendSuccesssEvent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送短信..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">上述看似很完美了，但是开发者需要注意Spring默认的事件机制是同步的：如果针对OrderService下单成功的操作越来越多，比如下单后需要完成的对应操作有十几个，那么等十几个其他服务都调用完毕，东哥可能又去明尼苏达州了。所以，你必须想办法把Spring的事件机制改成异步的，尽可能快地返回下单的结果本身，而不是等其他附属服务全部完成（涉及到其他问题暂时按下不表）。</font></p> 
<p><font face="宋体" size="3">Spring发布异步事件，要想把Spring事件机制改造成异步通知，最粗暴的方法是：</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 订单服务
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 下单成功</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下单成功..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发布通知</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LendSuccesssEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"main线程结束..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 等SmsService结束</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">监听OrderSuccessEvent：</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 短信服务，
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsService</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderSuccessEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">OrderSuccessEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 发送短信
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送短信..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">当然，这种做法其实违背了Spring事件机制的设计初衷。人家会想不到你要搞异步通知？</font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncEventConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"applicationEventMulticaster"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ApplicationEventMulticaster</span> <span class="token function">simpleApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SimpleApplicationEventMulticaster</span> eventMulticaster
                <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        eventMulticaster<span class="token punctuation">.</span><span class="token function">setTaskExecutor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleAsyncTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> eventMulticaster<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/c5/GvebCMwa_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/35/81/1ZewNOPq_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/ea/ukQC5yxI_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/92/WtW5cVAo_o.png" alt="在这里插入图片描述"></p> 
<pre><code>```java
监听

	含义

		一个事物根据另一个事物的变化自发的作出响应，而且每次都作出同样的响应。

		就像点击按钮一样。每次点击登入按钮，都会访问登入接口url，这就是监听。

	三要素

		1.事件

		2.监听器

		3.触发动作

	举例

		点击按钮就是事件，点击之后要怎么处理，就是监听器的事了。

		监听器肯定有很多个，每个监听器职责不一样，

		它们要知道监听哪个事件的。需要事先就告诉它们了。

		总结一句话，在发布事件的时候，所有监听器就已经准备就绪，然后根据事件类型匹配对应监听器。
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200815134858416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIxNTYxNTAx,size_16,color_FFFFFF,t_70#pic_center)

在这里插入代码片


```java
spring监听

	原理

		在IOC的容器的启动过程，当所有的bean都已经处理完成之后，spring ioc容器会有一个发布事件的动作。

		从 AbstractApplicationContext 的源码中就可以看出。

		换句话说，当ioc容器加载处理完相应的bean之后，也给我们提供了一个机会

		先有InitializingBean，后有ApplicationListener&lt;ContextRefreshedEvent&gt;）

		，可以去做一些自己想做的事。其实这也就是spring ioc容器给提供的一个扩展的地方。

		我们可以这样使用这个扩展机制。
	
	简单实现原理

		让我们的bean实现ApplicationListener接口，

		这样当发布事件时，[spring]的ioc容器就会以容器的实例对象作为事件源类，

		并从中找到事件的监听者，此时ApplicationListener接口实例中的

		onApplicationEvent(E event)方法就会被调用，

		我们的逻辑代码就会写在此处。这样我们的目的就达到了
```
&lt;font size=2 color=red&gt;org.springframework.context.support.AbstractApplicationContext	![在这里插入图片描述](https://img-blog.csdnimg.cn/20200815195656994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIxNTYxNTAx,size_16,color_FFFFFF,t_70#pic_center)![在这里插入图片描述](https://img-blog.csdnimg.cn/20200815195904179.png#pic_center)
```java
	细节问题

		系统会存在两个容器，一个是root application context ,

		另一个就是我们自己的 projectName-servlet context（作为root application context的子容器）

		这种情况下，就会造成onApplicationEvent方法被执行两次。为了避免上面提到的问题，

		我们可以只在root application context初始化完成后调用逻辑代码，

		其他的容器的初始化完成，则不做任何处理
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200815200713326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIxNTYxNTAx,size_16,color_FFFFFF,t_70#pic_center)
```java
	 if (event.getApplicationContext().getParent() == null) {   //root application context 没有parent
	//其它逻辑
	            logger.info("register computer to zookeeper");
	            // Zookeeper注册本机
	            ZookeeperClient zkclient = ZookeeperClient.create();
	            zkclient.registerComputer();
	        }
```



```java
	最简单实现方式

		1.创建一个监听器,实现ApplicationListener接口，泛型中指定事件类型

		public class PrintListener implements ApplicationListener&lt;DemoEvent&gt; {
		    @Override
		    public void onApplicationEvent(DemoEvent event) {
		        System.out.println("调用DemoEvent的print方法输出其内容:");
		        event.print();
		    }
		}

		2.创建一个事件，继承ApplicationEvent抽象类

		public class DemoEvent extends ApplicationEvent {
		    private String text;
		
		    /**
		     * Create a new ApplicationEvent.
		     *
		     * @param source the object on which the event initially occurred (never {@code null})
		     */
		    public DemoEvent(Object source) {
		        super(source);
		    }
		
		    public DemoEvent(Object source, String text) {
		        super(source);
		        this.text = text;
		    }
		
		    public void print() {
		        System.out.println("print event content:" + this.text);
		    }
		}

		3.注册监听器到容器中，发布事件。

		@SpringBootApplication
		public class DemoApplication {
		
		    public static void main(String[] args) {
		        ConfigurableApplicationContext context = SpringApplication.run(DemoApplication.class, args);
		        //注册监听器
		        context.addApplicationListener(new PrintListener());
		        //发布事件
		        context.publishEvent(new DemoEvent(new Object(),"hello world."));
		    }
		
		}
```

```java
监听-事件

	ApplicationListener(监听)

		含义
		
			ApplicationListener可以监听某个事件event

			通过实现这个接口，传入一个泛型事件，在run方法中就可以监听这个事件，从而做出一定的逻辑

			比如在等所有bean加载完之后执行某些操作

		示例
		
			public class SystemListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
			
			    @Override
			    public void onApplicationEvent(ContextRefreshedEvent event) {
			        if (event.getApplicationContext().getParent() == null) {
			            System.out.println("do something");
			        }
			    }
			
			}

	Spring内置事件

		1、ContextRefreshedEvent

			ApplicationContext 被初始化或刷新时，该事件被发布。

			这也可以在 ConfigurableApplicationContext接口中使用 refresh() 方法来发生。

			此处的初始化是指：所有的Bean被成功装载，后处理Bean被检测并激活，

			所有Singleton Bean 被预实例化，ApplicationContext容器已就绪可用

		2、ContextStartedEvent

			当使用 ConfigurableApplicationContext （ApplicationContext子接口）接口中的 

			start() 方法启动  ApplicationContext 时，

			该事件被发布。你可以调查你的数据库，或者你可以在接受到这个事件后重启任何停止的应用程序

		3、ContextStoppedEvent

			当使用 ConfigurableApplicationContext 接口中的 stop() 停止 

			ApplicationContext 时，发布这个事件。你可以在接受到这个事件后做必要的清理的工作

		4、ContextClosedEvent
	
			当使用 ConfigurableApplicationContext 接口中的 close() 方法关闭 ApplicationContext 时，		
			该事件被发布。一个已关闭的上下文到达生命周期末端；它不能被刷新或重启

		5、RequestHandledEvent

			这是一个 web-specific 事件，告诉所有 bean HTTP 请求已经被服务。只能应用于使用

			DispatcherServlet的Web应用。

			在使用Spring作为前端的MVC控制器时，当Spring处理用户请求结束后，系统会自动触发该事件

	
```
</code></pre> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="twotwo">springaop面向切面编程</span></font></p> 
</blockquote> 
<p><font face="宋体" size="2">AOP(Aspect Oriented Programming),直译过来就是 面向切面编程，AOP 是一种编程思想，是面向对象编程（OOP）的一种补充。<font face="宋体" size="2">它可以理解为一个拦截器，拦截一些过程，例如，当一个方法执行时，aop可以劫持这个执行的方法，在方法执行之前或之后添加额外的功能。</font></font></p> 
<p><font face="宋体" size="2" color="黑体">AOP 实现分类</font></p> 
<p><font face="宋体" size="2">AOP 的本质是由 AOP 框架修改业务组件的多个方法的源代码，按照 AOP 框架修改源代码的时机，可以将其分为两类：</font></p> 
<p><font face="宋体" size="2">①静态 AOP 实现： AOP 框架在编译阶段对程序源代码进行修改，生成了静态的 AOP 代理类（生成的 *.class 文件已经被改掉了，需要使用特定的编译器），比如 AspectJ。<br> <font face="宋体" size="2">②动态 AOP 实现：AOP 框架在运行阶段对动态生成代理对象（在内存中以 JDK 动态代理，或 CGlib 动态地生成 AOP 代理类），如 SpringAOP。</font></font></p> 
<p><font face="宋体" size="2">[下面给出常用 AOP 实现比较]</font></p> 
<p><img src="https://images2.imgbox.com/7f/98/mrlrgRqm_o.png" alt="在这里插入图片描述"></p> 
<p><font face="宋体" size="2" color="黑体">通知类型</font></p> 
<table><thead><tr><th><font face="宋体" size="2">类型</font></th><th><font face="宋体" size="2">连接点</font></th><th><font face="宋体" size="2">实现接口</font></th></tr></thead><tbody><tr><td><font face="宋体" size="2">前置通知</font></td><td><font face="宋体" size="2">该方法执行前运行</font></td><td><font face="宋体" size="2">org.springframework.aop.MethodBeforeAdvice</font></td></tr><tr><td><font face="宋体" size="2">后置通知</font></td><td><font face="宋体" size="2">通知方法会在目标方法返回或异常后调用</font></td><td><font face="宋体" size="2">org.springframework.aop.AfterReturningAdvice</font></td></tr><tr><td><font face="宋体" size="2">引入通知</font></td><td><font face="宋体" size="2">在不改变原有方法的基础上却可以增加新的方法</font></td><td><font face="宋体" size="2">org.springframework.aop.IntroductionInterceptor</font></td></tr><tr><td><font face="宋体" size="2">异常通知</font></td><td><font face="宋体" size="2">运行方法抛出异常后</font></td><td><font face="宋体" size="2">org.springframework.aop.ThrowsAdvice</font></td></tr><tr><td><font face="宋体" size="2">环绕通知</font></td><td><font face="宋体" size="2">通知方法会将目标方法封装起来, 环绕方法执行运行，结合以上这三个通知</font></td><td><font face="宋体" size="2">org.aop.alliance.intercept.MethodInterceptor</font></td></tr></tbody></table> 
<p><font face="宋体" size="2" color="黑体">Spring AOP 的特点</font></p> 
<p><font face="宋体" size="2">AOP 框架有很多种，上面介绍了 AOP 框架的实现方式有可能不同， Spring 中的 AOP 是通过动态代理实现的。<br> 不同的 AOP 框架支持的连接点也有所区别，例如，AspectJ 和 JBoss,除了支持方法切点，它们还支持字段和构造器的连接点。而 Spring AOP 不能拦截对对象字段的修改，也不支持构造器连接点,我们无法在 Bean 创建时应用通知。<br> 在Spring AOP中，有 4 种类型通知(advices)的支持，前置通知、后置通知、异常通知、环绕通知。</font></p> 
<p><font face="宋体" size="2" color="grey">大部分的 Spring 开发者都只是实现了“环绕通知”，因为它可以对所有通知类型，但更好的做法应该是选择最合适的通知类型来满足要求。</font></p> 
<p><font face="宋体" size="2" color="黑体">操作术语</font></p> 
<table><thead><tr><th><font face="宋体" size="2">术语</font></th><th><font face="宋体" size="2">内容</font></th></tr></thead><tbody><tr><td><font face="宋体" size="2">连接点(jointPoint)</font></td><td><font face="宋体" size="2">类里面哪些方法可以被增强，这些方法称为连接点</font></td></tr><tr><td><font face="宋体" size="2">切入点(pointCut)</font></td><td><font face="宋体" size="2">实际被真正增强的方法，称为切入点</font></td></tr><tr><td><font face="宋体" size="2">通知(advice)</font></td><td><font face="宋体" size="2">实际增强的逻辑部分称为通知（增强）</font></td></tr><tr><td><font face="宋体" size="2">前置通知</font></td><td><font face="宋体" size="2">通知的种类：@Before()</font></td></tr><tr><td><font face="宋体" size="2">后置通知</font></td><td><font face="宋体" size="2">通知的种类：@AfterReturning() （也叫做返回通知）</font></td></tr><tr><td><font face="宋体" size="2">环绕通知</font></td><td><font face="宋体" size="2">通知的种类：@Around</font></td></tr><tr><td><font face="宋体" size="2">异常通知</font></td><td><font face="宋体" size="2">通知的种类：@AfterThrowing()</font></td></tr><tr><td><font face="宋体" size="2">最终通知</font></td><td><font face="宋体" size="2">通知的种类：@After()（相当于finally）</font></td></tr><tr><td><font face="宋体" size="2">切面(aspect)</font></td><td><font face="宋体" size="2">把通知应用到切入点的过程叫做切面</font></td></tr><tr><td><font face="宋体" size="2">横关注点</font></td><td><font face="宋体" size="2">对哪些方法进行拦截，拦截后怎么处理，这些关注点称之为横切关注点</font></td></tr><tr><td><font face="宋体" size="2">目标(target)</font></td><td><font face="宋体" size="2">被通知对象</font></td></tr><tr><td><font face="宋体" size="2">代理(proxy)</font></td><td><font face="宋体" size="2">向目标对象应用通知之后创建的对象</font></td></tr><tr><td><font face="宋体" size="2">织入(weave)</font></td><td><font face="宋体" size="2">将增强处理添加到目标对象中，并创建一个被增强的对象，这个过程就是织入</font></td></tr><tr><td><font face="宋体" size="2">AOP代理(AOP Proxy)</font></td><td><font face="宋体" size="2">AOP框架创建的对象，代理就是目标对象的加强。Spring中的AOP代理可以使JDK动态代理，也可以是CGLIB代理，前者基于接口，后者基于子类</font></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/3a/5a/2WL8YGvB_o.png" alt="在这里插入图片描述"></p> 
<p><font face="宋体" size="2" color="黑体">切入点表达式</font></p> 
<p><font face="宋体" size="2">语法：<code>execution( [权限修饰符] [返回类型] [方法名称] ([参数列表]))</code><br> <font face="宋体" size="2">细节：返回类型可以省略<br> <font face="宋体" size="2">示例：<br> <font face="宋体" size="2">对com.yy.test.BookService类里的add方法增强：<code>execution（* com.yy.test.BookService.add(..)）</code><br> <font face="宋体" size="2">对com.yy.test.BookService类里的所有方法增强：<code>execution（* com.yy.test.BookService.*(..)）</code><br> <font face="宋体" size="2">对com.yy.test包里的所有类的所有方法增强：<code>execution（* com.yy.test. * . * (..)）</code></font></font></font></font></font></font></p> 
<p><font face="宋体" size="2" color="黑体">@Aspect注解用法：</font></p> 
<p><font face="宋体" size="2">☼依赖环境：</font></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">☼开启包扫描和@Aspect注解</font></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/context
         http://www.springframework.org/schema/context/spring-context.xsd
         http://www.springframework.org/schema/aop
         http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--开启包扫描--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yy.aspect<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--开启aspectJ注解--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font face="宋体" size="2">☼设置增强类的优先级</font></p> 
<p><font face="宋体" size="2">如果多个增强类对同一个方法（或多个方法）增强，设置增强类的优先级，即在增强类上添加注解@Order(数字)，数字越小优先级越高。</font></p> 
<p><font face="宋体" size="2">☼创建需要增强的的类User</font></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>aspect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功添加一个用户"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">☼创建代理类CommonAspect</font></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>aspect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonAspect</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"前置通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//后置通知（返回结果之后执行）</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AfterReturning..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//最终通知（不管有没有发生异常）</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"最终通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//异常通知</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AfterThrowing..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//环绕通知</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"环绕通知前"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//被增强的方法执行</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"环绕通知后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">☼多个通知使用了相同的切点表达式使用 @Pointcut注解声明切点表达式，然后使用表达式。</font></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>aspect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonAspect</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//抽取相同切入点</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.yy.aspect.User.addUser(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">//前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"前置通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//后置通知（返回结果之后执行）</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AfterReturning..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//最终通知（不管有没有发生异常）</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"最终通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//异常通知</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AfterThrowing..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//环绕通知</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"环绕通知前"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//被增强的方法执行</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"环绕通知后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">测试效果（程序正常执行）：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>aspect<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestAspect</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">结果1：(结果可以发现没有异常通知)<br> <font face="宋体" size="2" color="green">环绕通知前<br> 前置通知<br> 成功添加一个用户<br> 环绕通知后<br> 最终通知<br> AfterReturning…</font></font></p> 
<p><font face="宋体" size="2">测试效果（程序执行异常）：</font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i<span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功添加一个用户"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2">结果2：<br> <font face="宋体" size="2" color="green">环绕通知前<br> 前置通知<br> 最终通知<br> AfterThrowing…<br> java.lang.ArithmeticException: / by zero<br> at com.yy.aspect.User.addUser(User.java:9)<br> …</font></font></p> 
<p><font face="楷体" size="3" color="orange">注解声明切点指示器</font></p> 
<p><font face="宋体" size="2">Spring AOP 所支持的 AspectJ 切点指示器(如下图)，当我们查看这些spring支持的指示器时，注意只有execution指示器是唯一的执行匹配，而其他的指示器都是用于限制匹配的。这说明execution指示器是我们在编写切点定义时最主要使用的指示器，在此基础上，我们使用其他指示器来限制所匹配的切点。<br> <img src="https://images2.imgbox.com/05/c6/RZWC3Gul_o.png" alt="在这里插入图片描述"></font></p> 
<p><font face="楷体" size="3" color="orange">注解处理通知中的参数</font></p> 
<p><font face="宋体" size="3">上面的例子进行增强处理的目标方法没有参数，下面来说说有参数的情况，并且在增强处理中使用该参数。下面我们给接口增加一个参数，表示购买所花的金钱。通过AOP 增强处理，如果女孩买衣服超过了 68 元，就可以赠送一双袜子。<br> 更改代码如下：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBuy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token keyword">implements</span> <span class="token class-name">IBuy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"女孩花了%s元买了一件漂亮的衣服"</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"衣服"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Boy</span> <span class="token keyword">implements</span> <span class="token class-name">IBuy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"男孩花了%s元买了一个游戏机"</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"游戏机"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuyAspectJ</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(String com.sharpcj.aopdemo.test1.IBuy.buy(double)) &amp;&amp; args(price) &amp;&amp; bean(girl)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">gif</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"gif(price)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hehe</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pj<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            pj<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>price <span class="token operator">&gt;</span> <span class="token number">68</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"女孩买衣服超过了68元，赠送一双袜子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token string">"衣服和袜子"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"衣服"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="2" color="grey">注意环绕通知的结构，见下方</font></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 环绕通知结构
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundPrintLog</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Object</span> rtValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"前置通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       rtValue<span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"后置通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> rtValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"异常通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"最终通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(String com.unfair.service.impl.*.*(com.unfair.api.dto.LoginInfoDTO,..)) &amp;&amp; args(dto,a)"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> jp <span class="token punctuation">,</span> <span class="token class-name">LoginInfoDTO</span> dto<span class="token punctuation">,</span><span class="token class-name">String</span> a<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ferao aop around1 anntation success .."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//unfair</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行被环绕通知封装的切入方法</span>
    <span class="token class-name">Object</span> proceed <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"proceed content :"</span> <span class="token operator">+</span>proceed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//proceed content :原方法返回</span>

    <span class="token comment">//获得访问该方法的参数内容，默认是数组，即入参是多个</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//args content :LoginInfoDTO{username='username', password='password'}</span>
        <span class="token comment">//args content :unfair</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"args content :"</span> <span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取签名，即：全路径.类名.方法(参数类型名)</span>
    <span class="token class-name">Signature</span> signature <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//signature content :String com.unfair.service.LoginService.checkUserInfo(LoginInfoDTO,String)</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"signature content :"</span> <span class="token operator">+</span>signature<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>dto <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"参数为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ferao aop around2 anntation success .."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"aop为空返回"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"参数不为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ferao aop around3 anntation success .."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"aop不为空返回"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font face="宋体" size="3">前面提到，当不关心方法返回值的时候，我们在编写切点指示器的时候使用了 * ，当不关心方法参数的时候，我们使用了<code> ..</code>。<br> 现在如果我们需要传入参数，并且有返回值的时候，则需要使用对应的类型。在编写通知的时候，我们也需要声明对应的返回值类型和参数类型。</font></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boy</span> boy <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"boy"</span><span class="token punctuation">,</span><span class="token class-name">Boy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Girl</span> girl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Girl</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"girl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> boyBought <span class="token operator">=</span> boy<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> girlBought <span class="token operator">=</span> girl<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token number">99.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"男孩买到了："</span> <span class="token operator">+</span> boyBought<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"女孩买到了："</span> <span class="token operator">+</span> girlBought<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//男孩花了35.0元买了一个游戏机</span>
<span class="token comment">//女孩花了99.8元买了一件漂亮的衣服</span>
<span class="token comment">//女孩买衣服超过了68元，赠送一双袜子</span>
<span class="token comment">//男孩买到了：游戏机</span>
<span class="token comment">//女孩买到了：衣服和袜子</span>
</code></pre> 
<p><font face="楷体" size="3" color="orange">注解配置织入的方式</font></p> 
<p><font face="宋体" size="3">前面还有一个遗留问题，在配置文件中，我们用注解 @EnableAspectJAutoProxy() 启用Spring AOP 的时候，我们给参数 proxyTargetClass 赋值为 true,如果我们不写参数，默认为 false。这个时候运行程序，程序抛出异常</font></p> 
<p><img src="https://images2.imgbox.com/08/90/UdiGEV8j_o.png" alt="在这里插入图片描述"><br> <font face="宋体" size="3">这是一个强制类型转换异常。为什么会抛出这个异常呢？或许已经能够想到，这跟Spring AOP 动态代理的机制有关，这个 proxyTargetClass 参数决定了代理的机制。当这个参数为 false 时，<br> 通过jdk的基于接口的方式进行织入，这时候代理生成的是一个接口对象，将这个接口对象强制转换为实现该接口的一个类，自然就抛出了上述类型转换异常。</font></p> 
<p><font face="宋体" size="3">反之，proxyTargetClass 为 true，则会使用 cglib 的动态代理方式。这种方式的缺点是拓展类的方法被final修饰时，无法进行织入。测试一下，将 proxyTargetClass 参数设为 true，同时将 Girl.java 的 Buy 方法用 final 修饰</font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sharpcj<span class="token punctuation">.</span>aopdemo<span class="token punctuation">.</span>test1<span class="token punctuation">.</span></span>IBuy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span><span class="token punctuation">(</span>proxyTargetClass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token keyword">implements</span> <span class="token class-name">IBuy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"女孩花了%s元买了一件漂亮的衣服"</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"衣服"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boy</span> boy <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"boy"</span><span class="token punctuation">,</span><span class="token class-name">Boy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Girl</span> girl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Girl</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"girl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> boyBought <span class="token operator">=</span> boy<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> girlBought <span class="token operator">=</span> girl<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token number">99.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"男孩买到了："</span> <span class="token operator">+</span> boyBought<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"女孩买到了："</span> <span class="token operator">+</span> girlBought<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//男孩花了35.0元买了一个游戏机</span>
<span class="token comment">//女孩花了99.8元买了一件漂亮的衣服</span>
<span class="token comment">//男孩买到了：游戏机</span>
<span class="token comment">//女孩买到了：衣服</span>
</code></pre> 
<p><font face="宋体" size="2" color="grey">切面并没有织入生效</font></p> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="gongjulei">spring工具类大全</span></font></p> 
</blockquote> 
<p><a href="#accssers" rel="nofollow"><font size="2" color="grey" face="宋体">Assert(定位问题)</font></a></p> 
<ol><li> <p><font size="2" color="黑体" face="宋体"><span id="accssers">Assert(定位问题)</span></font></p> <p><font size="2" face="宋体">用于对方法入参进行断言，确保参数满足预期条件。</font></p> <p><font size="2" face="宋体">常用方法：</font></p> 
  <table><thead><tr><th><font size="2" face="宋体"> 方法</font></th><th><font size="2" face="宋体">内容</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体">notNull(Object object)</font></td><td><font size="2" face="宋体">当对象不为null时抛出异常</font></td></tr><tr><td><font size="2" face="宋体">notNull(Object object, String message)</font></td><td><font size="2" face="宋体">允许通过message定制异常信息</font></td></tr><tr><td><font size="2" face="宋体"> isNull(Object object)</font></td><td><font size="2" face="宋体"> 要求对象必须为null</font></td></tr><tr><td><font size="2" face="宋体"> isTrue(boolean expression)</font></td><td><font size="2" face="宋体"> 当表达式不为true时抛出异常</font></td></tr><tr><td><font size="2" face="宋体">notEmpty(Collection collection)</font></td><td><font size="2" face="宋体">当集合未包含元素时抛出异常</font></td></tr></tbody></table><p><font size="2" face="宋体">示例：<br> <img src="https://images2.imgbox.com/2a/7e/aGQg8Pyx_o.png" alt="在这里插入图片描述"></font></p> </li></ol> 
<blockquote> 
 <p><font color="black" size="3" face="宋体"><span id="zjdq">spring注解大全</span></font></p> 
</blockquote> 
<p><a href="#CONFS" rel="nofollow"><font size="2" color="grey" face="宋体">PropertyPlaceholderConfigurer（获取变量）</font></a></p> 
<p><a href="#confdiasdfa" rel="nofollow"><font size="2" color="grey" face="宋体">@Configuration（用户定义配置类）</font></a></p> 
<p><a href="#banduix" rel="nofollow"><font size="2" color="grey" face="宋体">@Bean（bean对象）</font></a></p> 
<ol><li> <p><font size="2" color="黑体" face="宋体"><span id="CONFS">PropertyPlaceholderConfigurer（获取变量）</span></font></p> <p><font size="2" face="宋体">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer类</font></p> <p><font size="2" face="宋体">作用是将properties(key/value形式)文件中一些动态设定的值(value),在xml中替换为占位该键<code>($key$)</code>的值。而properties文件可以根据客户需求，自定义一些相关的参数，这样的设计可提供程序的灵活性。</font></p> <p><font size="2" face="宋体">在spring中，使用PropertyPlaceholderConfigurer可以在xml配置文件中加入外部属性，当然也可以指定外部文件的编码。</font></p> 
  <ol><li> <p><font size="3" face="宋体" color="gresdca">引入单一外部属性文件</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>propertyConfigurerForAnalysis<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>location<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>classpath:/spring/include/dbQuery.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileEncoding<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>	
</code></pre> </li><li> <p><font size="3" face="宋体" color="gresdca">引入多个外部属性文件</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>propertyConfigurer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>locations<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>  
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>classpath:/spring/include/jdbc-parms.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>classpath:/spring/include/base-config.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>classpath*:config/jdbc.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font size="2" face="宋体" color="grey">[注]根据示例案例可以看出，PropertyPlaceholderConfigurer起的作用是将占位符指向数据库配置信息放在bean中定义的工具</font></p> <p><font size="3" face="宋体" color="yeollwdsgbxzjtwdf">示例</font></p> <p><font size="2" face="宋体" color="黑体">properties文件:</font></p> <pre><code class="prism language-xml">url=jdbc:mysql://localhost:3306/db1?useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=UTF-8<span class="token entity named-entity" title="&amp;">&amp;amp;</span>zeroDateTimeBehavior=round; 
user=root
password=root 
</code></pre> <p><font size="2" face="宋体" color="黑体">beans.xml</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>propertyConfigurer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>order<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>systemPropertiesModeName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_PROPERTIES_MODE_OVERRIDE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ignoreResourceNotFound<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileEncoding<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>locations<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>classpath:runtime.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholderPrefix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@[<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholderSuffix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>]<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 数据库连接池 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置连接池属性 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@[url]<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@[user]<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@[password]<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>	
</code></pre> <p><font size="2" color="grey">[注]<br> 1.order属性代表其加载顺序<br> 2.ignoreResourceNotFound是否忽略找不到的resource,如果配置多个resource，则需要设置为true<br> 3.ignoreUnresolvablePlaceholders是否忽略不可解析的Placeholder，如果配置多个PropertyPlaceholderConfigurer，则需设置为true<br> 4.一定要在properties文件中&amp;写为<code>&amp;amp; </code>因为在xml文件中不识别&amp;，必须是<code>&amp;amp </code></font></p> </li></ol> </li><li> <p><font size="2" color="黑体" face="宋体"><span id="confdiasdfa">@Configuration（用户定义配置类）</span></font></p> <p><font size="2" face="宋体">作用：(spring3.0) 用于定义配置类，可替换xml配置文件。<font size="2" face="宋体">被注解的类内部存在一个或多个被@bean注解的方法，这些方法将会被扫描并用于构建bean定义，初始化Spring容器。</font></font></p> <p><font size="2" face="宋体">• 标注于类：将类作为spring的xml配置文件中的<code>&lt;beans&gt;</code>作为spring容器</font></p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>jdbc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/jdbc<span class="token punctuation">"</span></span>  
    <span class="token attr-name"><span class="token namespace">xmlns:</span>jee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/jee<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>util</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/util<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>task</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/task<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
        http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-4.0.xsd
        http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd
        http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.0.xsd<span class="token punctuation">"</span></span> <span class="token attr-name">default-lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font size="2" color="黑体" face="宋体"><span id="banduix">@Bean（bean对象）</span></font></p> <p><font size="2" face="宋体">作用：把方法的返回值作为bean对象存入spring的容器里。</font></p> <p><font size="2" face="宋体">方法参数：若方法有参数，Spring 框架会去容器中查找有没有可用的bean对象</font></p> <p><font size="2" face="宋体">属性：<br> • name：指定bean的id，当不写时默认值是当前方法的名称</font></p> </li><li> <p><font size="3" color="黑体" face="宋体">@ComponentScan（指定扫描位置）</font></p> <p><font size="3" face="宋体">用于通过注解指定spring在创建容器时要扫描的包。</font></p> <p><font size="3" face="宋体">@ComponentScan有value属性，它和beanPackages的作用是一样的，都是用于指定创建容器时要扫描的包我们使用此注解就等同于在xml中配置了</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.tt<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font size="2" color="黑" face="宋体">@RestControllerAdvice（清洗请求）</font></p> <p><font size="3" face="宋体">在spring3.2中新增的注解，放置于类前，用于定义@ExceptionHandler、@InitBinder、@ModelAttribute，使得在所有controller中接收到的请求都经过被此注解所标注的类中请求</font></p> <p><font size="3" face="宋体">这里要注意，@ExceptionHandler该注解处于被@RestControllerAdvice标注的类中时，该项目所有请求存在异常时都经过该注解来处理，属性value指定需要拦截的异常类型，value可省略不写如拦截exception,只需写@ExceptionHandler(value=MyException.class)</font></p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 应用到所有@RequestMapping注解方法，在其执行之前初始化数据绑定器
     * @param binder
     */</span>
    <span class="token annotation punctuation">@InitBinder</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initBinder</span><span class="token punctuation">(</span><span class="token class-name">WebDataBinder</span> binder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">/**
     * 把值绑定到Model中，使全局@RequestMapping可以获取到该值
     * @param model
     */</span>
    <span class="token annotation punctuation">@ModelAttribute</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addAttributes</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">,</span> <span class="token string">"ferao-system"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 全局异常捕捉处理
     * @param ex
     * @return
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>	
</code></pre> </li><li> <p><font color="blue" size="3">@Order注解(执行bean)</font></p> <pre><code class="prism language-java">含义

	<span class="token annotation punctuation">@Order</span>或者接口<span class="token class-name">Ordered</span>的作用是定义<span class="token class-name">Spring</span> <span class="token constant">IOC</span>容器中<span class="token class-name">Bean</span>的执行顺序的优先级，
	
	注意，<span class="token annotation punctuation">@Order</span>、<span class="token class-name">Ordered</span>不影响类的加载顺序
</code></pre> <pre><code class="prism language-java">源码

	<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Documented</span>
	<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Order</span> <span class="token punctuation">{<!-- --></span>
	
		<span class="token comment">/**
		 * 默认是最低优先级,值越小优先级越高
		 */</span>
		<span class="token keyword">int</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">LOWEST_PRECEDENCE</span><span class="token punctuation">;</span>
	
	<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-java">分析

	作用位置<span class="token operator">:</span>类<span class="token punctuation">(</span>接口、枚举<span class="token punctuation">)</span>、方法、字段声明（包括枚举常量）

	优先级<span class="token operator">:</span>value参数值越小优先级越高，存在默认值
</code></pre> <pre><code class="prism language-java">问题<span class="token operator">:</span>

	<span class="token constant">IOC</span>容器是如何根据优先级值来先后执行程序的

源码分析

	<span class="token annotation punctuation">@SpringBootApplication</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonBootStrap</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CommonBootStrap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">(</span>进入run方法<span class="token punctuation">)</span>

    <span class="token keyword">public</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">&gt;</span></span> exceptionReporters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">configureHeadlessProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SpringApplicationRunListeners</span> listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRunListeners</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listeners<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Collection</span> exceptionReporters<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ApplicationArguments</span> applicationArguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultApplicationArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareEnvironment</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">configureIgnoreBeanInfo</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Banner</span> printedBanner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exceptionReporters <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">afterRefresh</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StartupInfoLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logStarted</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getApplicationLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stopWatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            listeners<span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//这里是重点，调用具体的执行方法</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRunners</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var10<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> var10<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>var10<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            listeners<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> context<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var9<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> var9<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListeners</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">callRunners</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> runners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        runners<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">ApplicationRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        runners<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">CommandLineRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//重点来了，按照定义的优先级顺序排序</span>
        <span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>runners<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span> var4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span>runners<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//循环调用具体方法</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Object</span> runner <span class="token operator">=</span> var4<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>runner <span class="token keyword">instanceof</span> <span class="token class-name">ApplicationRunner</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRunner</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationRunner</span><span class="token punctuation">)</span>runner<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>runner <span class="token keyword">instanceof</span> <span class="token class-name">CommandLineRunner</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRunner</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CommandLineRunner</span><span class="token punctuation">)</span>runner<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">callRunner</span><span class="token punctuation">(</span><span class="token class-name">ApplicationRunner</span> runner<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//执行方法</span>
            runner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Failed to execute ApplicationRunner"</span><span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">callRunner</span><span class="token punctuation">(</span><span class="token class-name">CommandLineRunner</span> runner<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//执行方法</span>
            runner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">getSourceArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Failed to execute CommandLineRunner"</span><span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <pre><code class="prism language-java">示例

	实现<span class="token class-name">CommandLineRunner</span>接口的类会在<span class="token class-name">Spring</span> <span class="token constant">IOC</span>容器加载完毕后执行，适合预加载类及

	其它资源；也可以使用<span class="token class-name">ApplicationRunner</span><span class="token punctuation">,</span>使用方法及效果是一样的			
</code></pre> <pre><code class="prism language-java">	<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yaomy<span class="token punctuation">.</span>common<span class="token punctuation">.</span>order</span><span class="token punctuation">;</span>
	
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">CommandLineRunner</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * @Description: Description
	 * @ProjectName: spring-parent
	 * @Version: 1.0
	 */</span>
	<span class="token annotation punctuation">@Component</span>
	<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlackPersion</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token annotation punctuation">@Override</span>
	    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----BlackPersion----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
</code></pre> <pre><code class="prism language-java">	<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yaomy<span class="token punctuation">.</span>common<span class="token punctuation">.</span>order</span><span class="token punctuation">;</span>
	
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">CommandLineRunner</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * @Description: Description
	 * @ProjectName: spring-parent
	 * @Version: 1.0
	 */</span>
	<span class="token annotation punctuation">@Component</span>
	<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YellowPersion</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token annotation punctuation">@Override</span>
	    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----YellowPersion----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-java">	<span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">YellowPersion</span><span class="token operator">--</span><span class="token operator">--</span>
	<span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">BlackPersion</span><span class="token operator">--</span><span class="token operator">--</span>
</code></pre> <p><font color="grey" size="2">加载代码的底层要支持优先级执行程序，否则即使配置上Ordered、@Order也是不起任何作用的</font></p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f87daf08ad3b588a820a0b325c28f89/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python list.sort方法和内置函数sorted</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/748978e5e7f8f59a7db7d7fa6b9bc2e3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">selenium-java中切换iframe</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>