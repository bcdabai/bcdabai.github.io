<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BEVFusion简介、环境配置与安装以及遇到的各种报错处理 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BEVFusion简介、环境配置与安装以及遇到的各种报错处理" />
<meta property="og:description" content="BEVFusion简介、环境配置与安装以及遇到的各种报错处理 BEVFusion简介BEVFusion环境配置与安装报错解决 BEVFusion简介 针对点云投射到图像的多模态融合和图像投射到点云的多模态融合，前者会损失空间几何信息，后者会损失图像语义信息，这两种point-level的多模态融合方法均无法同时很好地处理目标检测和地图分割问题。
BEVFusion 是一种高效且通用的多任务多传感器融合框架。 它将多模态特征统一在共享鸟瞰图（BEV）表示空间中，在BEV空间下融合图像和点云特征，此网络是一个全卷积网络组成，并对2D-3D的视图转换作了效率优化与提升，将延迟减少了 40 倍以上，计算速度大大提高。
BEVFusion的网络结构如下图所示： BEVFusion环境配置与安装 博主自己的硬件配置如下：
Linux（Ubuntu 20.04）NVIDIA GeForce RTX 3090NVIDIA显卡驱动版本：12.0CUDA version：11.3 配置BEVFusion所需的python环境（若CUDA版本不一样，安装时需要做一些修改）：
# 创建名为bevfusion的conda环境 conda create -n bevfusion python=3.8 -y conda activate bevfusion # 安装pytorch conda install pytorch==1.10.0 torchvision==0.11.0 torchaudio==0.10.0 cudatoolkit=11.3 -c pytorch -c conda-forge # 安装mmcv pip install mmcv-full==1.4.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.10.0/index.html # 安装mmdetection pip install mmdet==2.20.0 # 安装nuscenes数据集工具、软件开发包 pip install nuscenes-dev-kit # 安装mpi4py pip install mpi4py==3.0.3 # 安装torchpack pip install torchpack # 安装numba pip install numba cd bevfusion # 编译、安装mmdetection3d python setup." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7854c4e89bd8836662c0c72d4ef6b940/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-01T17:45:44+08:00" />
<meta property="article:modified_time" content="2023-12-01T17:45:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BEVFusion简介、环境配置与安装以及遇到的各种报错处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>BEVFusion简介、环境配置与安装以及遇到的各种报错处理</h4> 
 <ul><li><a href="#BEVFusion_1" rel="nofollow">BEVFusion简介</a></li><li><a href="#BEVFusion_7" rel="nofollow">BEVFusion环境配置与安装</a></li><li><a href="#_38" rel="nofollow">报错解决</a></li></ul> 
</div> 
<p></p> 
<h2><a id="BEVFusion_1"></a>BEVFusion简介</h2> 
<p>针对点云投射到图像的多模态融合和图像投射到点云的多模态融合，前者会损失空间几何信息，后者会损失图像语义信息，这两种point-level的多模态融合方法均无法同时很好地处理目标检测和地图分割问题。</p> 
<p>BEVFusion 是一种高效且通用的多任务多传感器融合框架。 它将多模态特征统一在共享鸟瞰图（BEV）表示空间中，在BEV空间下融合图像和点云特征，此网络是一个全卷积网络组成，并对2D-3D的视图转换作了效率优化与提升，将延迟减少了 40 倍以上，计算速度大大提高。</p> 
<p>BEVFusion的网络结构如下图所示： <img src="https://images2.imgbox.com/ac/d6/w4BNapaS_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="BEVFusion_7"></a>BEVFusion环境配置与安装</h2> 
<p>博主自己的硬件配置如下：</p> 
<ul><li>Linux（Ubuntu 20.04）</li><li>NVIDIA GeForce RTX 3090</li><li>NVIDIA显卡驱动版本：12.0</li><li>CUDA version：11.3</li></ul> 
<p>配置BEVFusion所需的python环境（若CUDA版本不一样，安装时需要做一些修改）：</p> 
<pre><code># 创建名为bevfusion的conda环境
conda create -n bevfusion python=3.8 -y
conda activate bevfusion
# 安装pytorch
conda install pytorch==1.10.0 torchvision==0.11.0 torchaudio==0.10.0 cudatoolkit=11.3 -c pytorch -c conda-forge
# 安装mmcv
pip install mmcv-full==1.4.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.10.0/index.html
# 安装mmdetection
pip install mmdet==2.20.0
# 安装nuscenes数据集工具、软件开发包
pip install nuscenes-dev-kit
# 安装mpi4py
pip install mpi4py==3.0.3
# 安装torchpack
pip install torchpack
# 安装numba
pip install numba
cd bevfusion
# 编译、安装mmdetection3d
python setup.py develop
</code></pre> 
<h2><a id="_38"></a>报错解决</h2> 
<p>此节主要介绍博主在安装、训练或测试过程中遇到的一些报错和解决方法。</p> 
<p><strong>报错一</strong></p> 
<p>在训练或测试的时候，遇到spconv报错：</p> 
<pre><code>RuntimeError: /XXX/XXX/XXX/bevfusion/mmdet3d/ops/spconv/src/indice_cuda.cu 124
cuda execution failed with error 2
</code></pre> 
<p>解决方法为：<br> 1、在bevfusion文件夹下，运行<code>python setup.py develop</code>，安装适配的spconv版本。<br> 2、如果步骤（1）已经尝试但依然报错，那可能是显存不够导致，尝试换更大显存的显卡或将batch_size缩小。</p> 
<p><strong>报错二</strong><br> 在训练的时候遇到报错:</p> 
<pre><code>TypeError: FormatCode() got an unexpected keyword argument 'verify'
</code></pre> 
<p>解决方法是安装适配版本的yapf：<code>pip install yapf==0.40.1</code>.</p> 
<p><strong>报错三</strong></p> 
<pre><code>AttributeError: module 'distutils' has no attribute 'version'
Primary job terminated normally, but 1 process returned a non-zero exit code. Per user-direction, the job has been aborted.
</code></pre> 
<p>解决办法是安装适配版本的setuptools：<code>pip install setuptools==59.5.0</code>.</p> 
<p><strong>报错四</strong></p> 
<pre><code>Traceback (most recent call last):
  File "/home/XXX/bevfusion/tools/train.py", line 91, in &lt;module&gt;
    main()
  File "/home/XXX/bevfusion/tools/train.py", line 24, in main
    dist.init()
  File "/home/XXX/anaconda3/envs/BEVFusionEnv/lib/python3.8/site-packages/torchpack/distributed/context.py", line 23, in init
    master_host = 'tcp://' + os.environ['MASTER_HOST']
  File "/home/XXX/anaconda3/envs/BEVFusionEnv/lib/python3.8/os.py", line 673, in __getitem__
    raise KeyError(key) from None
KeyError: 'MASTER_HOST'
</code></pre> 
<p>解决办法是添加环境变量：<code>export MASTER_HOST=IP:port</code>.</p> 
<p><strong>报错五</strong></p> 
<pre><code>ModuleNotFoundError: No module named 'mmcv._ext'
</code></pre> 
<p>报错原因时错误地安装了mmcv=1.4.0。<br> 解决方法是安装mmcv-full==1.4.0，切记不要少了full。</p> 
<p><strong>报错六</strong><br> 执行download_pretrained.sh文件时无法下载pth文件，出现报错：<code>ERROR 404: Not Found</code>。</p> 
<p>解决方法是在Google网盘上下载，链接如下：<a href="https://drive.google.com/drive/folders/1Jru7VTfgvFF949DlP1oDfriP3wrmOd3c" rel="nofollow">https://drive.google.com/drive/folders/1Jru7VTfgvFF949DlP1oDfriP3wrmOd3c</a>.</p> 
<p><strong>报错七</strong></p> 
<pre><code class="prism language-bash">_configtest.c:2:10: fatal error: mpi.h: No such <span class="token function">file</span> or directory
       <span class="token comment">#include &lt;mpi.h&gt;</span>
                ^~~~~~~
      compilation terminated.
      failure.
      removing: _configtest.c _configtest.o
      error: Cannot compile MPI programs. Check your configuration<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
      <span class="token punctuation">[</span>end of output<span class="token punctuation">]</span>
  
  note: This error originates from a subprocess, and is likely not a problem with pip.
  ERROR: Failed building wheel <span class="token keyword">for</span> mpi4py
  Running setup.py clean <span class="token keyword">for</span> mpi4py
Failed to build mpi4py
ERROR: Could not build wheels <span class="token keyword">for</span> mpi4py, <span class="token function">which</span> is required to <span class="token function">install</span> pyproject.toml-based projects
</code></pre> 
<p>解决方法是先安装libopenmpi-dev，再安装mpi4py：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libopenmpi-dev
pip <span class="token function">install</span> <span class="token assign-left variable">mpi4py</span><span class="token operator">==</span><span class="token number">3.0</span>.3
</code></pre> 
<p><strong>报错八</strong></p> 
<pre><code class="prism language-bash">cannot <span class="token function">import</span> name <span class="token string">'ball_query_ext'</span> from <span class="token string">'mmdet3d.ops.ball_query'</span>
</code></pre> 
<p>解决方法是</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> bevfusion
python setup.py develop
</code></pre> 
<p><strong>报错九</strong></p> 
<pre><code class="prism language-bash">AttributeError: module <span class="token string">'numpy'</span> has no attribute <span class="token string">'int'</span><span class="token builtin class-name">.</span>
<span class="token variable"><span class="token variable">`</span>np.int<span class="token variable">`</span></span> was a deprecated <span class="token builtin class-name">alias</span> <span class="token keyword">for</span> the <span class="token builtin class-name">builtin</span> <span class="token variable"><span class="token variable">`</span>int<span class="token variable">`</span></span><span class="token builtin class-name">.</span> To avoid this error <span class="token keyword">in</span> existing code, use <span class="token variable"><span class="token variable">`</span>int<span class="token variable">`</span></span> by itself. Doing this will not modify any behavior and is safe. When replacing <span class="token variable"><span class="token variable">`</span>np.int<span class="token variable">`</span></span>, you may wish to use e.g. <span class="token variable"><span class="token variable">`</span>np.int64<span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span>np.int32<span class="token variable">`</span></span> to specify the precision. If you wish to review your current use, check the release note <span class="token function">link</span> <span class="token keyword">for</span> additional information.
The aliases was originally deprecated <span class="token keyword">in</span> NumPy <span class="token number">1.20</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token function">more</span> details and guidance see the original release note at:
    https://numpy.org/devdocs/release/1.20.0-notes.html<span class="token comment">#deprecations</span>
</code></pre> 
<p>解决办法是numpy安装的版本过高，安装较低版本的numpy，例如：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token assign-left variable">numpy</span><span class="token operator">==</span><span class="token number">1.23</span>.1
</code></pre> 
<p><strong>报错十</strong></p> 
<pre><code class="prism language-bash">N <span class="token operator">&gt;</span> <span class="token number">0</span> assert faild. CUDA kernel launch blocks must be positive, but got <span class="token assign-left variable">N</span><span class="token operator">=</span> <span class="token number">0</span>
</code></pre> 
<p>解决办法：</p> 
<pre><code class="prism language-bash"><span class="token comment"># cuda是10.2版本</span>
pip <span class="token function">install</span> spconv-cu102
<span class="token comment"># cuda是11.3版本</span>
pip <span class="token function">install</span> spconv-cu113
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51d3564ef454c02fd472dcecc01daf76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python PyQt5简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0226d2781d44d49256c7f8db4c960dcc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">angular使用 RxJS 中的switchMap和takeUntil实现接口防抖操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>