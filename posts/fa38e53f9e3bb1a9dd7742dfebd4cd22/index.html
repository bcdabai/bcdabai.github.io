<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>tf-idf &#43;逻辑回归来识别垃圾文本 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="tf-idf &#43;逻辑回归来识别垃圾文本" />
<meta property="og:description" content="引入相关包 from sklearn.feature_extraction.text import TfidfVectorizer from sklearn.linear_model import LogisticRegression from sklearn.metrics import accuracy_score, auc, roc_auc_score import joblib import os import pandas as pd from sklearn.model_selection import train_test_split import pickle path = &#39;/Users/xinghuatianying/data/DataSets/im_cheat/&#39; os.chdir(path) 加载数据 训练样本demo：
label	msg 1 全网最低价完善数据 手把手教你引流 详细＋V：vd12388 1 耍.微.店等.级评.价销.量回头.率➕15314268311 1 我收姐妹&#43;我QQ2877613260 1 违规啥啊 佳651815289➕我q 0 温和洁面膏&#43;红粉爽肤水 0 小卡盲盒改地址 0 20杯（每个口味各4杯） def load_data(): data = pd.read_csv(&#39;msg_train.csv&#39;, sep = &#34;\t&#34;, names=[&#39;label&#39;, &#39;msg&#39;]) #对数据进行随机打乱 data = data.sample(frac=1, random_state=42) # print(data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fa38e53f9e3bb1a9dd7742dfebd4cd22/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T16:03:18+08:00" />
<meta property="article:modified_time" content="2024-01-02T16:03:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">tf-idf &#43;逻辑回归来识别垃圾文本</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_3"></a>引入相关包</h3> 
<pre><code>from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, auc, roc_auc_score
import joblib
import os
import pandas as pd
from sklearn.model_selection import train_test_split
import pickle

path  = '/Users/xinghuatianying/data/DataSets/im_cheat/'
os.chdir(path)
</code></pre> 
<h3><a id="_19"></a>加载数据</h3> 
<p>训练样本demo：</p> 
<pre><code>label	msg
1       全网最低价完善数据 手把手教你引流 详细＋V：vd12388
1       耍.微.店等.级评.价销.量回头.率➕15314268311
1       我收姐妹+我QQ2877613260
1       违规啥啊 佳651815289➕我q
0       温和洁面膏+红粉爽肤水
0       小卡盲盒改地址
0       20杯（每个口味各4杯）
</code></pre> 
<pre><code>def load_data():

    data = pd.read_csv('msg_train.csv', sep = "\t", names=['label', 'msg'])
    #对数据进行随机打乱
    data = data.sample(frac=1, random_state=42)
    # print(data.shape)
    # print(data.head(10))
    #查看0-1的比例,可以看出来，数据集基本上平衡
    # print(data['label'].value_counts())
    # 对文本进行分字
    data['msg'] = data['msg'].apply(lambda x: ' '.join(x))
    # print(data.head())

    x_train, x_test, y_train, y_test = \
    train_test_split(data['msg'],
                     data['label'],
                     test_size=0.3,
                     random_state=42
                     )
    # print(x_train.shape, x_test.shape, y_train.shape, y_test.shape)
    return x_train, x_test, y_train, y_test
</code></pre> 
<h3><a id="_58"></a>模型训练</h3> 
<pre><code>def train_model(x_train, x_test, y_train, y_test):
    #tf-idf训练
    vectorizer_word = TfidfVectorizer(
    max_features=800000,
    token_pattern=r"(?u)\b\w+\b",
    min_df=1,
    #max_df=0.1,
    analyzer='word',
    ngram_range=(1, 5)
    )

    tfidf_model = vectorizer_word.fit(x_train)
    # 保存模型到文件
    with open('tfidf_model.pkl', 'wb') as f:
        pickle.dump(tfidf_model, f)

    tfidf_train = vectorizer_word.transform(x_train)
    tfidf_test  = vectorizer_word.transform(x_test)
    #查看词典的大小 vectorizer_word.vocabulary_
    print(len(vectorizer_word.vocabulary_))

    #逻辑回归模型的训练
    lr_word = LogisticRegression(
    solver='sag',
    verbose=2)
    lr_word.fit(tfidf_train, y_train)
    # 保存模型，下次可以直接使用
    joblib.dump(lr_word, 'lr_word_ngram.pkl')

    #模型读取
    model = joblib.load(filename="lr_word_ngram.pkl")
    # 模型预测
    y_pred_word_1 = lr_word.predict(tfidf_test)
    y_pred_word = lr_word.predict_proba(tfidf_test)[:, 1]
    # 模型评估
    print(accuracy_score(y_test, y_pred_word_1))
</code></pre> 
<h3><a id="_99"></a>模型预测</h3> 
<pre><code>def predcit_main():
    # 拉取数据
    data = pd.read_csv('test_msg.csv', names=['msg'])
    #对数据进行随机打乱
    data = data.sample(frac=1, random_state=42)
    print(data.shape)
    print(data.head(10))

    # 对文本进行分字
    data['msg'] = data['msg'].apply(lambda x: ' '.join(x))
    x_test = data['msg']

    # 从文件中加载模型
    with open('tfidf_model.pkl', 'rb') as f:
        tfidf_model = pickle.load(f)
    print(x_test[:10])
    tfidf_test  = tfidf_model.transform(x_test)

    # 模型读取
    lr_model = joblib.load(filename="lr_word_ngram.pkl")
    # 模型预测
    y_pred_word = lr_model.predict_proba(tfidf_test)[:, 1]
    predict_df = pd.DataFrame({ 'y_pred_word': y_pred_word, 'x_test': x_test})
    # 保存到 CSV 文件
    predict_df.to_csv('predict_test.csv', index=False, sep = "\t")

</code></pre> 
<h3><a id="_130"></a>标题主函数：</h3> 
<pre><code>if __name__ == '__main__':
    x_train, x_test, y_train, y_test = load_data() # 加载训练数据
    train_model(x_train, x_test, y_train, y_test) # 模型训练
    predcit_main() # 模型预测
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9f1fe04f704d9c1923a4af82a891452/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">事件、概率、分布</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/34bd06ab76303b9ec47414ec71c1c050/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>