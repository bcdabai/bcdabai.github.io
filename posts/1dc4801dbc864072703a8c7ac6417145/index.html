<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql学习笔记" />
<meta property="og:description" content="记录不经常使用容易忘记，和不知道的MYSQL知识
MYSQL基础相关 官方文档位置 https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html MYSQL原理图
查看表的创建和库的创建信息
show create [table or database ] name ;查看编码命令
show variables like &#39;character_%&#39;; show variables like &#39;collation_%&#39;;插入数据时乱码
原因是访问的客户端与mysql编码不一致，解决方案，设置当前连接的客户端字符集 “SET NAMES GBK;”修改表和数据库的编码
1.更改表的编码
alter table [tablename] charset utf8;
2.更改表中字段的编码
alter table [表名] modify [字段名] varchar(20) charset utf8;
3.修改数据库的编码
alter database [数据库名] charset utf8; 查询语句 SQL执行顺序 以下面这个SQL为例
From 子句执行顺序为从后往前、从右到左，从最后一张表到第一张，最后一张表最为驱动表，所以表应该从大到小的写。
比如：select * from students,user; 那么顺序就是从user开始到student的数据生成一张笛卡儿积的虚拟表1，user表是驱动表，如果是小表的话效率比较高。
SELECT 是先执行 FROM 这一步的。在这个阶段，如果是多张表联查，还会经历下面的几个步骤： 首先先通过 CROSS JOIN 求笛卡尔积，相当于得到虚拟表 vt（virtual table）1-1；通过 ON 进行筛选，在虚拟表 vt1-1 的基础上进行筛选，得到虚拟表 vt1-2；添加外部行。如果我们使用的是左连接、右链接或者全连接，就会涉及到外部行，也就是在虚拟表 vt1-2 的基础上增加外部行，得到虚拟表 vt1-3。 On 在生成虚拟表后，会用On对数据进行筛选，把筛选出来的保存成虚拟表2Join添加外部表,如果有外连接查询中保留表会追加到虚拟表2，形成虚拟表3，如果from包含多个表，第三张表会和前两张表的结果，重复From-On-Join的步骤，直到处理完所有的表。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1dc4801dbc864072703a8c7ac6417145/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-28T08:36:08+08:00" />
<meta property="article:modified_time" content="2022-04-28T08:36:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><code>记录不经常使用容易忘记，和不知道的MYSQL知识</code></p> 
<h3><a id="MYSQL_1"></a>MYSQL基础相关</h3> 
<h4><a id="_2"></a>官方文档位置</h4> 
<pre><code class="prism language-html">https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html
</code></pre> 
<p>MYSQL原理图<br> <img src="https://images2.imgbox.com/e9/36/8Q0ReuwG_o.png" alt="在这里插入图片描述"></p> 
<ul><li>查看表的创建和库的创建信息<br> <code>show create [table or database ] name ;</code></li><li>查看编码命令<br> <code>show variables like 'character_%'; show variables like 'collation_%';</code></li><li>插入数据时乱码<br> <img src="https://images2.imgbox.com/c0/62/fAloa1Zr_o.png" alt="在这里插入图片描述"><br> 原因是访问的客户端与mysql编码不一致，解决方案，设置当前连接的客户端字符集 “SET NAMES GBK;”</li><li>修改表和数据库的编码<br> 1.更改表的编码<br> <code> alter table [tablename] charset utf8;</code><br> 2.更改表中字段的编码<br> <code>alter table [表名] modify [字段名] varchar(20) charset utf8;</code><br> 3.修改数据库的编码<br> <code> alter database [数据库名] charset utf8;</code></li></ul> 
<h4><a id="_26"></a>查询语句</h4> 
<h5><a id="SQL_27"></a>SQL执行顺序</h5> 
<p><img src="https://images2.imgbox.com/a2/15/pIZmS1EQ_o.png" alt="SQL语句执行顺序"><br> 以下面这个SQL为例<br> <img src="https://images2.imgbox.com/56/5a/D5oS17BL_o.png" alt="在这里插入图片描述"></p> 
<ul><li>From 子句执行顺序为从后往前、从右到左，从最后一张表到第一张，最后一张表最为驱动表，所以表应该从大到小的写。<br> 比如：<code>select * from students,user;</code> 那么顺序就是从user开始到student的数据生成一张笛卡儿积的虚拟表1，user表是驱动表，如果是小表的话效率比较高。<br> SELECT 是先执行 FROM 这一步的。在这个阶段，如果是多张表联查，还会经历下面的几个步骤：</li></ul> 
<ol><li>首先先通过 CROSS JOIN 求笛卡尔积，相当于得到虚拟表 vt（virtual table）1-1；</li><li>通过 ON 进行筛选，在虚拟表 vt1-1 的基础上进行筛选，得到虚拟表 vt1-2；</li><li>添加外部行。如果我们使用的是左连接、右链接或者全连接，就会涉及到外部行，也就是在虚拟表 vt1-2 的基础上增加外部行，得到虚拟表 vt1-3。</li></ol> 
<ul><li>On 在生成虚拟表后，会用On对数据进行筛选，把筛选出来的保存成虚拟表2</li><li>Join添加外部表,如果有外连接查询中保留表会追加到虚拟表2，形成虚拟表3，如果from包含多个表，第三张表会和前两张表的结果，重复From-On-Join的步骤，直到处理完所有的表。<br> 左外连接保留左表，右外连接保留右表，全外连接保存左右表</li><li>Where 对于Join完后生成的虚拟表3，根据制定的条件进行筛选，把满足的数据保存成虚拟表4</li><li>Group By 对虚拟表4的某一列相同的组合成一组，生成虚拟表5，group by 完成之后，只能得到虚拟表5的行和列</li><li>聚合函数 （AVG，COUNT，FIRST，LAST，MAX，MIN，SUM等）</li><li>Cube,RollUp生成数据集的聚合，生成虚拟表6</li><li>Having 根据制定条件过滤聚合的数据，聚合结果进行筛选，生成虚拟表7</li><li>SELECT ，把要展示的列筛选出来，根据生成虚拟表8</li><li>DISTINCT 把重复和行删除，生成虚拟表9</li><li>ORDER BY 对结果进行排序，生成虚拟表10</li><li>LIMIT/OFFSET 指定返回行，生成虚拟表11</li></ul> 
<h4><a id="SQL_53"></a>SQL分类</h4> 
<p>按照功能可以分为三类：<br> 1.DDL(Data Definition Languages、数据定义语言):定义了不同的数据库、表、视图、索引等数据库对象，还可以用来创建、删除、修改数据库和数据表的结构。例如:alter ，create ，drop等。<br> 2.DML(Data Manipulation Language、数据操作语言)，用于添加、删除、更新和查询数据库记录，并检查数据完整性， INSERT 、 DELETE 、 UPDATE 、 SELECT。<br> 3.DCL（Data Control Language、数据控制语言），用于定义数据库、表、字段、用户的访问权限和安全级别。GRANT 、 REVOKE 、 COMMIT 、 ROLLBACK 、 SAVEPOINT 等。</p> 
<p>1.起别名的时候as可以省略，如果别名中没有空格，可以省略“”<br> 2.数据导入指令<br> <code>source XXX.sql</code> 可以导入某一个sql文件<br> 3.除非使用所有列，否则不要用select * ，虽然可以降低输入时间，但是会降低查询效率。<br> 4.关键字大写，表，列，库小写。<br> 5.DISTINCT 是对后面跟的所有列去重<br> 6.在Mysql里空值是占用空间的<br> 7.如果表名，字段名和保留字有冲突，需要用着重号``包裹。<br> 8.desc 全拼describe<br> 9.show table status like ‘employees’ 查看表或视图的信息，存储引擎，版本，行数，大小等<br> 10.SHOW CREATE VIEW 视图名称;查看视图的详细定义<br> <img src="https://images2.imgbox.com/e1/16/KoVOEl2p_o.png" alt="在这里插入图片描述"><br> 算术运算符：+ - * /<br> <img src="https://images2.imgbox.com/15/8f/o5P9BnUY_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_________________________________75"></a>比较运算符： = &lt;=&gt; (等于) &lt;&gt; != （不等于） &lt; &lt;= &gt; &gt;=（小于等于，大于等于）</h5> 
<p><img src="https://images2.imgbox.com/cc/54/7b4sGDWH_o.png" alt="在这里插入图片描述"><br> 使用&lt;=&gt;比较两个null值的时候，返回的是1，如果用=比较返回的还是null</p> 
<h5><a id="_78"></a>非符号比较符</h5> 
<p><img src="https://images2.imgbox.com/87/49/KNJT5vIa_o.png" alt="在这里插入图片描述"><br> LEAST(值1，值2，…，值n)当参数是整数或者浮点数时，LEAST将返回其中最小的值；当参数为字符串时，返回字<br> 母表中顺序最靠前的字符；当比较值列表中有NULL时，不能判断大小，返回值为NULL。<br> LIKE 运算符，用于模糊匹配，“%”匹配0或者多个字符，“_”只能匹配一个字符。</p> 
<p>REGEXP 正则匹配<br> <img src="https://images2.imgbox.com/c8/c8/Dfa4Wn44_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_86"></a>逻辑运算符</h5> 
<p><img src="https://images2.imgbox.com/db/0d/qP6ePu2k_o.png" alt="在这里插入图片描述"><br> 1.SELECT NOT NULL;返回结果是null<br> 2.<img src="https://images2.imgbox.com/29/13/OhQBP0TK_o.png" alt="在这里插入图片描述"><br> 3.Or和And 的优先级不一样，And的优先级高于Or，因此先执行And，然后再Or</p> 
<h5><a id="_91"></a>位运算符</h5> 
<p>在二进制的基础上进行运算，先把操作数变成二进制数，按位进行计算，结果再转为十进制<br> <img src="https://images2.imgbox.com/7f/f8/QmPB74yG_o.png" alt="在这里插入图片描述"><br> 一个数字如何快速的*2，使用&lt;&lt;位移</p> 
<h5><a id="_95"></a>运算符优先级</h5> 
<p><img src="https://images2.imgbox.com/8a/1c/gFzLhHxs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_97"></a>正则匹配实用</h5> 
<p><img src="https://images2.imgbox.com/ca/ef/algMa1nw_o.png" alt="在这里插入图片描述"></p> 
<ol><li>查询以特定字符或字符串开头的记录 字符‘^’匹配以特定字符或者字符串开头的文本<br> <code>select * from test where name regexp ‘^a’</code>查询以a开头的</li><li>查询以特定字符或字符串结尾的记录 字符‘<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ’ 
         
        
          匹 
         
        
          配 
         
        
          以 
         
        
          特 
         
        
          定 
         
        
          字 
         
        
          符 
         
        
          或 
         
        
          者 
         
        
          字 
         
        
          符 
         
        
          串 
         
        
          结 
         
        
          尾 
         
        
          的 
         
        
          文 
         
        
          本 
         
        
          。 
         
        
          ‘ 
         
        
          s 
         
        
          e 
         
        
          l 
         
        
          e 
         
        
          c 
         
        
          t 
         
        
          ∗ 
         
        
          f 
         
        
          r 
         
        
          o 
         
        
          m 
         
        
          t 
         
        
          e 
         
        
          s 
         
        
          t 
         
        
          w 
         
        
          h 
         
        
          e 
         
        
          r 
         
        
          e 
         
        
          n 
         
        
          a 
         
        
          m 
         
        
          e 
         
        
          r 
         
        
          e 
         
        
          g 
         
        
          e 
         
        
          x 
         
         
         
           p 
          
         
           ′ 
          
         
        
          a 
         
        
       
         ’匹配以特定字符或者字符串结尾的文本。 `select * from test where name regexp 'a 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord">’</span><span class="mord cjk_fallback">匹</span><span class="mord cjk_fallback">配</span><span class="mord cjk_fallback">以</span><span class="mord cjk_fallback">特</span><span class="mord cjk_fallback">定</span><span class="mord cjk_fallback">字</span><span class="mord cjk_fallback">符</span><span class="mord cjk_fallback">或</span><span class="mord cjk_fallback">者</span><span class="mord cjk_fallback">字</span><span class="mord cjk_fallback">符</span><span class="mord cjk_fallback">串</span><span class="mord cjk_fallback">结</span><span class="mord cjk_fallback">尾</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">文</span><span class="mord cjk_fallback">本</span><span class="mord cjk_fallback">。</span><span class="mord">‘</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.946332em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">a</span></span></span></span></span>’;`</li><li>知道两边字符，忘记中间查询<br> <code>select * from test where name regexp 'a.c'</code></li><li>*号匹配0-n次，+至少匹配1次<br> <code>select * from test where name regexp 'ab+'</code></li><li>匹配指定字符to<br> <code>select * from test where name regexp 'to'</code></li><li>匹配指定多个字符串<br> <code>select * from test where name regexp 'to|ti'</code></li><li>匹配指定的字符<br> <code>select * from test where name regexp '[oi]'</code></li><li>匹配指定字符之外的字符<br> <code>select * from test where name regexp "[^a-e1-2]" </code>匹配a-e和数字1-2以外的所有</li><li>指定字符串连续出现的次数<br> <code>select * from test where name regexp 'm{2,}'</code></li></ol> 
<h5><a id="_117"></a>排序和分页</h5> 
<p>ASC (ascend) 升序<br> DESC(descend)降序<br> 单列排序：<code>select * from test order by id</code><br> 多列排序：<code>select * from test order by id，name desc</code><br> LIMIE 【位置偏移，】行数<br> <code>set @myrnum = 0; select (@myrnum := @myrnum + 1) as ROWNUM,name from students;</code><br> 使用变量，使用：=赋值，生成行号</p> 
<h4><a id="_126"></a>多表联查</h4> 
<p>连接多个表至少需要n-1个连接条件</p> 
<p>内连接: 合并具有同一列的两个以上的表的行, 结果集中不包含一个表与另一个表不匹配的行（交集）<br> 外连接: 两个表在连接过程中除了返回满足连接条件的行以外还返回左（或右）表中不满足条件的行 ，这种连接称为左（或右） 外连接。没有匹配的行时, 结果表中相应的列为空(NULL)。<br> 如果是左外连接，则连接条件中左边的表也称为 主表 ，右边的表称为 从表 。（左集）<br> 如果是右外连接，则连接条件中右边的表也称为 主表 ，左边的表称为 从表 。（右集）<br> <code>关键字Join ,Inner Join,Cross join</code>都表示内连接。<br> Mysql不支持满外连接，但是可以使用LEFT JOIN UNION RIGHT JOIN 代替<br> Union用来合并多条select语句的结果，列数和数据类型必须一致<br> Union all对两个结果集的交集不去重，Union会对交集去重。<br> <img src="https://images2.imgbox.com/31/f3/h2KWx73g_o.png" alt="在这里插入图片描述"><br> 自然连接：自动查询表中相同名字的字段，等值连接</p> 
<p>Using的用法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">USING</span> <span class="token punctuation">(</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>等于</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">on</span> e<span class="token punctuation">.</span>department_id<span class="token operator">=</span>d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre> 
<p>using只能在join的时候使用，而且字段名要一致，where适用所有关联</p> 
<h3><a id="_154"></a>函数</h3> 
<p>Mysql中函数分为内置函数和自定义函数，操作对象的多少分为单行和多行<br> 单行函数：对一行进行转换返回一个结果，可以嵌套，参数是一列和一个值。</p> 
<h4><a id="_158"></a>单行函数</h4> 
<p>单行函数</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sign<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CEIL<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>LEAST<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>greatest<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RAND<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">4.12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">4.15144</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token number">3.14159166</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sqrt<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>角度弧度转换</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> RADIANS<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DEGREES<span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>三角函数<br> select sin(30);<br> 幂运算<br> SELECT POW(3,2);<br> 进制转换<br> SELECT BIN(12);</p> 
<h5><a id="_173"></a>字符串函数</h5> 
<p>字符串编码转换<br> CONVERT(value USING char_code)<br> 查看字符串编码<br> CHARSET(value)</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">CHARSET</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">CHARSET</span><span class="token punctuation">(</span><span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token string">'mysql'</span> <span class="token keyword">USING</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token string">'ABCDE'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>LENGTH<span class="token punctuation">(</span><span class="token string">'你'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'你'</span><span class="token punctuation">,</span><span class="token string">'好'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CONCAT_WS<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'你'</span><span class="token punctuation">,</span><span class="token string">'好'</span><span class="token punctuation">,</span><span class="token string">'啊'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/e4/cL90GiHg_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">insert</span><span class="token punctuation">(</span><span class="token string">'abcdefg'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token string">'defg'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>UPPER<span class="token punctuation">(</span><span class="token string">'pou'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span><span class="token string">'POU'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/63/15/gL1KKfwb_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span><span class="token string">'FEDCBA'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">RIGHT</span><span class="token punctuation">(</span><span class="token string">'abcdef'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lpad<span class="token punctuation">(</span><span class="token string">'iii'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rpad<span class="token punctuation">(</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>LTRIM<span class="token punctuation">(</span><span class="token string">'  1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RTRIM<span class="token punctuation">(</span><span class="token string">'1  '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/c1/IyoOVzau_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> TRIM<span class="token punctuation">(</span><span class="token string">' a  '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TRIM<span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token keyword">FROM</span> <span class="token string">'-ABCDE-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TRIM<span class="token punctuation">(</span>leading <span class="token string">'-'</span> <span class="token keyword">from</span> <span class="token string">'-1999-03-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>trim<span class="token punctuation">(</span>trailing <span class="token string">'-'</span> <span class="token keyword">from</span> <span class="token string">'-1999-03-'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/a5/EGxVTbSV_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> field<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'q'</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> field<span class="token punctuation">,</span>find_in_set<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> find_in_set<span class="token punctuation">,</span>reverse<span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/a4/UbQvShOG_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_204"></a>日期函数</h5> 
<h6><a id="_205"></a>获取日期</h6> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> curdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">current_date</span><span class="token punctuation">,</span><span class="token keyword">current_time</span><span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>UTC_TIME<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6a/a1/ZmBNxCwq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>unix_timestamp<span class="token punctuation">(</span><span class="token keyword">current_time</span><span class="token punctuation">)</span><span class="token punctuation">,</span>from_unixtime<span class="token punctuation">(</span>unix_timestamp<span class="token punctuation">(</span><span class="token keyword">current_time</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> from_unixtime<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/c2/mjlEBZ8l_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/a9/jcbhzkE8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d3/7f/viU3yeJk_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_217"></a>计算日期加减函数</h6> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">1</span> <span class="token keyword">DAY</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>ADDDATE<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">1</span> <span class="token keyword">day</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span><span class="token punctuation">`</span>![在这里插入图片描述](https://img-blog.csdnimg.cn/adc8afd5325340f1ae5014d2c6276a12.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA55m95aS05pCU5pu05YWJ,size_20,color_FFFFFF,t_70,g_se,x_16)
##### 日期格式化
![在这里插入图片描述](https://img-blog.csdnimg.cn/b00266d476b547d8a6d9b062a1947208.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA55m95aS05pCU5pu05YWJ,size_20,color_FFFFFF,t_70,g_se,x_16)
![在这里插入图片描述](https://img-blog.csdnimg.cn/d45e323356084133be624257a1285627.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA55m95aS05pCU5pu05YWJ,size_18,color_FFFFFF,t_70,g_se,x_16)
#### 流程处理函数
查询部门为10，20，30的，10部门工资1.1倍，20部门工资1.2倍，30部门工资1.3倍
``<span class="token punctuation">`</span></span><span class="token keyword">sql</span>
<span class="token keyword">select</span> last_name<span class="token punctuation">,</span><span class="token keyword">case</span> <span class="token keyword">when</span> department_id <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">then</span> salary<span class="token operator">*</span><span class="token number">1.1</span>
<span class="token keyword">when</span> department_id <span class="token operator">=</span> <span class="token number">20</span> <span class="token keyword">then</span> salary<span class="token operator">*</span><span class="token number">1.2</span>
<span class="token keyword">when</span> department_id <span class="token operator">=</span> <span class="token number">30</span> <span class="token keyword">then</span> salary<span class="token operator">*</span><span class="token number">1.3</span>
<span class="token keyword">else</span> salary <span class="token keyword">end</span> <span class="token keyword">as</span> salary_add
<span class="token keyword">from</span> employees <span class="token keyword">where</span> department_id <span class="token operator">in</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> ifnull<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'true'</span><span class="token punctuation">,</span><span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_239"></a>加密函数</h6> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'roo!Dt444564CD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>MD5<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SHA<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>decode<span class="token punctuation">(</span>encode<span class="token punctuation">(</span><span class="token string">'rootD4s'</span><span class="token punctuation">,</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/c3/7Vi4Vcu2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2b/d0/BJGlXVeD_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_245"></a>信息函数</h6> 
<p><img src="https://images2.imgbox.com/48/06/PzFt3wH1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_247"></a>聚合函数</h4> 
<p>聚合函数应用于一组数据，对一组数据返回一个值。<br> 主要有：AVG,SUM,MAX,MIN,COUNT</p> 
<ol><li> <p>count(<em>)和count(1),count(列)的区别？<br> MylSAM没有区别，因为内部有一个计数器维护行数，但是InnoDB中count(</em>)和count(1)直接读取行数，复杂度是O（n），innoDB会遍历一遍。count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</p> </li><li> <p>ROLLUP，在groupby分组之后对分组的内容进行统计，会在所有分组记录后增加一条记录，该记录查询出的所有记录总和。</p> </li><li> <p>HAVING 子句，不能单独使用，只能跟group by一起使用,不能在where子句中使用聚合函数</p> </li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> department_id <span class="token keyword">from</span> employees <span class="token keyword">where</span> department_id <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">group</span> <span class="token keyword">by</span> department_id <span class="token keyword">having</span> <span class="token function">max</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token operator">&gt;</span><span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> maxsalary<span class="token punctuation">,</span>department_id <span class="token keyword">from</span> employees <span class="token keyword">where</span> department_id <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">group</span> <span class="token keyword">by</span> department_id <span class="token keyword">having</span> maxsalary <span class="token operator">&gt;</span><span class="token number">10000</span><span class="token punctuation">;</span>
</code></pre> 
<p>WHERE 可以直接使用表中的字段作为筛选条件，但不能使用分组中的计算函数作为筛选条件；HAVING 必须要与 GROUP BY 配合使用，可以把分组计算的函数和分组字段作为筛选条件。这决定了，在需要对数据进行分组统计的时候，HAVING 可以完成 WHERE 不能完成的任务。这是因为在查询语法结构中，WHERE 在 GROUP BY 之前，所以无法对分组结果进行筛选。HAVING 在 GROUP BY 之后，可以使用分组字段和分组中的计算函数，对分组的结果集进行筛选，这个功能是 WHERE 无法完成的。另外，WHERE排除的记录不再包括在分组中。如果需要通过连接从关联表中获取需要的数据，<strong>WHERE 是先筛选后连接，而 HAVING 是先连接后筛选</strong>。 这一点，就决定了在关联查询中，<strong>WHERE 比 HAVING 更高效</strong>。因为 WHERE 可以先筛选，用一个筛选后的较小数据集和关联表进行连接，这样占用的资源比较少，执行效率也比较高。HAVING 则需要先把结果集准备好，也就是用未被筛选的数据集进行关联，然后对这个大的数据集进行筛选，这样占用<br> 的资源就比较多，执行效率也较低。</p> 
<h4><a id="_261"></a>子查询</h4> 
<h5><a id="_262"></a>单行子查询</h5> 
<p>查询最低工资大于50号部门最低工资的部门id和其最低工资</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> minsal<span class="token punctuation">,</span>department_id <span class="token keyword">from</span> employees <span class="token keyword">group</span> <span class="token keyword">by</span> department_id <span class="token keyword">having</span> minsal <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">from</span> employees <span class="token keyword">where</span> department_id<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_267"></a>多行子查询</h5> 
<p>集合比较子查询，内查询返回多行，需要使用多行比较操作符<br> IN 比较任意一值<br> ANY 和某一个值比较<br> ALL 所有值比较<br> SOME ANY的别名</p> 
<h5><a id="_274"></a>相关更新</h5> 
<pre><code class="prism language-sql"><span class="token comment">#增加列</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> employees <span class="token keyword">add</span><span class="token punctuation">(</span>department_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 根据查询更新列</span>
<span class="token keyword">update</span> employees e <span class="token keyword">SET</span> department_name <span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> department_name <span class="token keyword">from</span> departments <span class="token keyword">where</span> e<span class="token punctuation">.</span>department_id<span class="token operator">=</span>departments<span class="token punctuation">.</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 删除列</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> employees <span class="token keyword">drop</span> department_name<span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> employees <span class="token keyword">where</span> employee_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> employee_id <span class="token keyword">from</span> employees <span class="token keyword">where</span> salary <span class="token operator">&gt;=</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>自联接和子查询那个效率高？<br> 自连接查询是对自己的数据进行判断，但是子查询是对未知表的结果进行判断。</p> 
<h3><a id="_286"></a>加载数据</h3> 
<p>数据格式如下，列之间使用\t间隔（LOAD DATA默认的列间隔符），\N表示NULL</p> 
<pre><code class="prism language-sql">histler Gwen bird \N <span class="token number">1997</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">09</span> \N
</code></pre> 
<p>加载文件pet.txt中的数据到表pet中，使用以下命令</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> userinfo<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>height <span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> <span class="token keyword">INFILE</span> <span class="token string">'/path/pet.txt'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> pet <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">infile</span> <span class="token string">'/var/lib/mysql-files/test.text'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> userinfo<span class="token punctuation">;</span>
</code></pre> 
<p>要想使用load_file()函数加载，必须满足用户有操作目标文件的权限，并且是在制定的目录下</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%secure%'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> load_file<span class="token punctuation">(</span><span class="token string">'/var/lib/mysql-files/test.text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/ba/xUNN8pYh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_306"></a>数据类型</h3> 
<h3><a id="_307"></a>存储引擎</h3> 
<h3><a id="_309"></a>约束</h3> 
<h3><a id="_310"></a>视图</h3> 
<p>一个或者多个数据表里的数据的逻辑表示，视图不存储数据。<br> 为什么使用视图？<br> 可以使用表的一部分，而不是所有的表，可以针对不同的用户制定不同的视图。视图是一种 虚拟表 ，本身是 不具有数据 的，占用很少的内存空间，它是 SQL 中的一个重要概念。视图建立在已有表的基础上, 视图赖以建立的这些表称为基表。<br> 视图的创建和删除只影响视图本身，不影响对应的基表。但是<strong>当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之亦然</strong>。可以帮助我们把经常查询的结果集放到虚拟表中，提升使用效率。</p> 
<h5><a id="_316"></a>创建视图</h5> 
<ol><li>在创建视图时，没有在视图名后面指定字段列表，则视图中字段列表默认和SELECT语句中的字段列表一致。如果SELECT语句中给字段取了别名，那么视图中的字段名和别名相同。</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">view</span> emp_tmp_2<span class="token punctuation">(</span>emp_num<span class="token punctuation">,</span>sal_tmp<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> employee_id<span class="token punctuation">,</span>salary <span class="token keyword">from</span> employees<span class="token punctuation">;</span>
</code></pre> 
<p>2.可以在视图的基础上进一步创建视图<br> 3.支持通过insert ，delete，update等对视图进行更新，视图中数据变化，表中数据也会变化。<br> <strong>要使视图可更新，视图中的行和底层基本表中的行之间必须存在 一对一 的关系。</strong><br> 不可更新视图的情况：</p> 
<ol><li>在定义视图的时候指定了“ALGORITHM = TEMPTABLE”，视图将不支持INSERT和DELETE操作；</li><li>视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作；</li><li>在定义视图的SELECT语句中使用了 JOIN联合查询 ，视图将不支持INSERT和DELETE操作；</li><li>在定义视图的SELECT语句后的字段列表中使用了 数学表达式 或 子查询 ，视图将不支持INSERT，也不支持UPDATE使用了数学表达式、子查询的字段值；</li><li>在定义视图的SELECT语句后的字段列表中使用 DISTINCT 、 聚合函数 、 GROUP BY 、 HAVING 、UNION，函数 等，视图将不支持INSERT、UPDATE、DELETE；</li><li>在定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持INSERT、UPDATE、DELETE；<br> 视图定义基于一个 不可更新视图 ；<br> 7.常量视图。</li></ol> 
<h5><a id="_335"></a>修改删除视图</h5> 
<p>方式1：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">view</span> view_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> 。。。。
</code></pre> 
<p>方式2：</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">view</span> 视图名称 <span class="token keyword">as</span> 查询语句
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> 视图名称<span class="token punctuation">;</span>
</code></pre> 
<p>**注意：**基于视图a、b创建了新的视图c，如果将视图a或者视图b删除，会导致视图c的查询失败。这样的视图c需要手动删除或修改，否则影响使用。<br> <img src="https://images2.imgbox.com/fb/b9/4V6ZhlxJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cf/56/Btvnnvmr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f8/8d/qA8J1343_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_352"></a>存储过程与函数</h4> 
<h5><a id="_353"></a>存储过程</h5> 
<p>含义：存储过程的英文是 Stored Procedure 。它的思想很简单，就是一组经过 预先编译 的 SQL 语句的封装。<br> 调用过程：存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。<br> 优点:<br> 1、简化操作，提高了sql语句的重用性，减少了开发程序员的压力<br> 2、减少操作过程中的失误，提高效率<br> 3、<strong>减少网络传输量（客户端不需要把所有的 SQL 语句通过网络发给服务器）</strong><br> 4、减少了 SQL 语句暴露在网上的风险，也提高了数据查询的安全性<br> 5.一旦存储过程被创建出来，使用它就像使用函数一样简单，我们直接通过调用存储过程名即可。相较于函数，存储过程是 没有返回值的。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> CountPro<span class="token punctuation">(</span><span class="token operator">in</span> deparid <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">out</span> num <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>  <span class="token keyword">into</span> num <span class="token keyword">from</span> employees <span class="token keyword">where</span> department_id<span class="token operator">=</span>deparid<span class="token punctuation">;</span>
<span class="token keyword">end</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token variable">@num</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">call</span> CountPro<span class="token punctuation">(</span><span class="token string">'80'</span><span class="token punctuation">,</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@num</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> <span class="token identifier"><span class="token punctuation">`</span>add_num2<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token operator">IN</span> n <span class="token keyword">INT</span><span class="token punctuation">)</span>
	<span class="token keyword">BEGIN</span>
		<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span><span class="token punctuation">;</span>
		<span class="token keyword">DECLARE</span> sum <span class="token keyword">INT</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">WHILE</span> i <span class="token operator">&lt;=</span> n <span class="token keyword">DO</span>
			<span class="token keyword">SET</span> sum <span class="token operator">=</span> sum <span class="token operator">+</span> i<span class="token punctuation">;</span>
			<span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
		<span class="token keyword">SELECT</span> sum<span class="token punctuation">;</span>
	<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> 
<ol><li>DELIMITER 指定结束符</li><li>create procedure 名称</li><li>IN 类型参数只能作为输入，OUT 类型参数只能作为输出，INOUT是参数既当输入也当输出。</li><li>begin end 结束符为结构体</li><li>要将结果放入变量需要用into 设置一个OUT或INOUT类型的参数进行返回。</li><li>最后将结束符恢复成默认的；</li><li>调用的时候使用call 名称调用</li><li>需要返回的参数要进行初始化，用select @参数名展示</li><li>DECLARE用于在存储过程中定义变量</li></ol> 
<h5><a id="_399"></a>函数</h5> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">function</span> 函数名（参数名  参数类型）
<span class="token keyword">returns</span> 返回值类型
【约束】
<span class="token keyword">begin</span>
		
<span class="token keyword">end</span>
<span class="token comment"># 调用SELECT 函数名(实参列表)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/36/rvMIUwOF_o.png" alt="在这里插入图片描述"><br> 存储函数可以放在查询语句中使用，存储过程不行。</p> 
<h5><a id="_411"></a>查看修改删除存储过程和函数</h5> 
<p>1.SHOW CREATE [FUNCTION,PROCEDURE] 过程名或函数名；<br> 2.SHOW [FUNCTION,PROCEDURE] STATUS LIKE ‘SELECT%’;<br> 直接查看information_schema库中的ROUTINES,根据类型筛选<br> select * from ROUTINES WHERE ROUTINE_TYPE=[FUNCTION,PROCEDURE];</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> {<!-- --><span class="token keyword">PROCEDURE</span> <span class="token operator">|</span> <span class="token keyword">FUNCTION</span>} <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 存储过程或函数的名
</code></pre> 
<h4><a id="UDF_419"></a>自定义UDF</h4> 
<h3><a id="_422"></a>变量，流程控制和游标</h3> 
<p>变量由系统定义，不是用户定义，属于服务器层面。<br> 启动MySQL服务，生成MySQL服务实例期间，MySQL将为MySQL服务器内存中的<strong>系统变量赋值</strong>，这些系统变量定义了当前MySQL服务实例的属性、特征。这些系统变量的值要么是编译MySQL时参数的默认值，要么是配置文件（例如my.ini等）中的参数值。大家可以通过网址查看MySQL文档的系统变量。<br> 每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变量值的复制。</p> 
<p>变量有：全局系统变量，会话系统变量，默认是会话级别的。静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系统变量。<br> 全局变量对所有的连接有效，但是不能在mysql重启的时候共用。会话1对某个全局变量的修改会导致其他会话的这个变量的更新。</p> 
<h5><a id="_429"></a>系统变量查询</h5> 
<pre><code class="prism language-sql"><span class="token comment">#查看所有全局变量</span>
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token punctuation">[</span><span class="token operator">LIKE</span> <span class="token string">'%标识符%'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">#查看所有会话变量</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES<span class="token punctuation">;</span> 
<span class="token keyword">SHOW</span> VARIABLES<span class="token punctuation">;</span>

<span class="token comment"># 查看某个变量</span>
<span class="token comment">#查看指定的系统变量的值</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@global.</span>变量名<span class="token punctuation">;</span>
<span class="token comment">#查看指定的会话变量的值</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@session.</span>变量名<span class="token punctuation">;</span>
<span class="token comment">#或者</span>
<span class="token keyword">SELECT</span> @@变量名<span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_445"></a>系统变量修改</h5> 
<ol><li>直接修改mysql的启动文件</li><li>通过set设置</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> @<span class="token variable">@global</span><span class="token punctuation">[</span><span class="token keyword">session</span><span class="token punctuation">]</span><span class="token punctuation">.</span>变量名<span class="token operator">=</span>变量值<span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span><span class="token punctuation">[</span><span class="token keyword">session</span><span class="token punctuation">]</span> 变量名<span class="token operator">=</span>变量值<span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_452"></a>用户变量</h5> 
<p>用户变量和会话变量一样，只对当前连接的会话有效，局部变量只在当前的begin - end语句块中有效。局部变量只能在存储过程和函数中使用。</p> 
<h3><a id="_456"></a>触发器</h3> 
<p>主要针对有必然关联的两件事情之间进行绑定的需求，由某个事件来触发，所谓事件就是指<br> 用户的动作或者触发某项行为。如果定义了触发程序，当数据库执行这些语句时候，就相当于事件发生了，就会自动激发触发器执行相应的操作。当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来实现。<br> 实例：插入一张表的同时，根据判断去更新另一张表</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> insert_before_check<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> $
<span class="token keyword">create</span> <span class="token keyword">trigger</span> insert_before_check
    before <span class="token keyword">insert</span> <span class="token keyword">on</span> hello_log <span class="token keyword">for each row</span>
    <span class="token keyword">begin</span>
        <span class="token keyword">IF</span> LENGTH<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
            <span class="token keyword">insert</span> <span class="token keyword">into</span> length_log <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> LENGTH<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span> <span class="token punctuation">;</span>
    <span class="token keyword">end</span> $
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre> 
<p><em>查看触发器</em></p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> triggers<span class="token punctuation">;</span>

<span class="token keyword">show</span> <span class="token keyword">create</span> triggers 触发器名<span class="token punctuation">;</span>

<span class="token keyword">show</span> <span class="token operator">*</span> <span class="token keyword">from</span> infomation_schema<span class="token punctuation">.</span>TRIGGERS<span class="token punctuation">;</span>

<span class="token keyword">drop</span> <span class="token keyword">trigger</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> 触发器名称<span class="token punctuation">;</span>
</code></pre> 
<p>优点：<br> 1.触发器可以确保数据的完整性。每当一张表输入，修改更新操作的时候，自动触发对应的业务处理。<br> 2.触发器可以帮我们记录操作日志。什么时间发生了什么事情，方便定位问题。<br> 3.对数据进行合法性检查等逻辑。<br> 缺点：<br> 1.可读性差，如果触发器有异常会出现应用方面的错误，不了解触发器很难解决问题。<br> 2.数据表结构的变更会影响触发器的错误，比较隐蔽影响排查效率。<br> <strong>外键的修改不会引起字表的触发器</strong><br> <img src="https://images2.imgbox.com/18/4b/i8ds8ZxC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_497"></a>事件</h3> 
<p>MySQL 事件是<strong>根据计划运行的任务</strong>。因此，我们有时将它们称为 预定事件。当创建一个事件时，SQL 语句将在一个或多个固定时间间隔执行，在特定日期和时间开始和结束。从概念上讲，这类似于 Unix crontab （也称为“ cron 作业”）或 Windows 任务计划程序的想法。计划任务有时也被称为 “时间触发器”，意味着这些是随着时间的推移而触发的对象。<br> 触发器是响应特定类型的事件而执行，但是事件是通过预先指定的时间间隔来执行的。</p> 
<p>实例：创建一个时间每一分钟插入一条数据到log表中</p> 
<pre><code class="prism language-sql"><span class="token comment"># 1.创建存储过程，插入数据</span>
<span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> printhello<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> $
<span class="token keyword">create</span> <span class="token keyword">procedure</span> printhello<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> hello_log<span class="token punctuation">(</span>log <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> hello_log <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'hello world,schduler!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>$
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>

<span class="token comment"># 2.创建事件，定时调用</span>
<span class="token comment"># 创建定时任务，定时打印helloworld</span>
<span class="token keyword">DROP</span> EVENT <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> print_hello_sche<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> $$
<span class="token keyword">create</span> event print_hello_sche
    <span class="token keyword">on</span> schedule every <span class="token number">1</span> <span class="token keyword">minute</span> starts <span class="token keyword">timestamp</span> <span class="token string">'2022-04-24 15:30:30'</span>
    <span class="token keyword">on</span> completion preserve
     <span class="token comment"># 当事件运行完毕，不对事件删除，on completion not preserve则删除</span>
    <span class="token keyword">do</span>
    <span class="token keyword">begin</span> <span class="token keyword">call</span> printhello<span class="token punctuation">;</span>
    <span class="token keyword">end</span>$$
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_527"></a>定义条件</h4> 
<p>定义条件就是给MySQL中的错误码命名，这有助于存储的程序代码更清晰。它将一个 错误名字 和 指定的错误条件 关联起来。这个名字可以随后被用在定义处理程序的 DECLARE HANDLER 语句中。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span> 错误名称 CONDITION <span class="token keyword">FOR</span> 错误码（错误条件）
<span class="token comment">#错误码可以参考mysql官方错误码MYSQL——error——code,sqlstate_value是字符类型的错误代码</span>

</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">delimiter</span> $
<span class="token keyword">create</span> <span class="token keyword">procedure</span> InsertDataWithCondition<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">declare</span> duplicate_entry condition <span class="token keyword">for</span> sqlstate <span class="token string">'23000'</span><span class="token punctuation">;</span>
    <span class="token comment"># 定义错误条件duplicate_entry为23000</span>
    <span class="token keyword">declare</span> <span class="token keyword">exit</span> <span class="token keyword">handler</span> <span class="token keyword">for</span> duplicate_entry <span class="token keyword">set</span> <span class="token variable">@pro_value</span> <span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">#定义duplicate_entry 的exit处理程序，可以是复合语句</span>
    <span class="token keyword">set</span> <span class="token variable">@x</span> <span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> depat_tmp<span class="token punctuation">;</span>
<span class="token keyword">end</span> $
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_548"></a>流程控制</h4> 
<h5><a id="IF_549"></a>IF</h5> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> update_salary_5yarn<span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_5yarn<span class="token punctuation">(</span><span class="token operator">in</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">DECLARE</span> emp_salary <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> emp_year <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span>
    <span class="token comment"># 定义两个变量进行接收</span>
    <span class="token keyword">select</span> <span class="token operator">*</span><span class="token operator">*</span>employees<span class="token punctuation">.</span>salary<span class="token punctuation">,</span>DATEDIFF<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span>  <span class="token keyword">into</span> emp_salary<span class="token punctuation">,</span>emp_year<span class="token operator">*</span><span class="token operator">*</span>  <span class="token keyword">from</span> employees <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
    <span class="token comment">#查询出对应的变量值,多个变量复制方法</span>
    <span class="token keyword">IF</span> emp_salary <span class="token operator">&lt;</span> <span class="token number">8000</span> <span class="token operator">and</span> emp_year <span class="token operator">&gt;</span> <span class="token number">5</span>
        <span class="token keyword">then</span> <span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
    <span class="token keyword">elseif</span> emp_year <span class="token operator">&gt;</span> <span class="token number">5</span>
        <span class="token keyword">then</span> <span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">200</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">100</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> 
<h5><a id="case_when_570"></a>case when</h5> 
<pre><code class="prism language-sql"><span class="token comment"># 创建存储过程update_salary_by_eid5</span>
<span class="token comment">#声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的</span>
<span class="token comment">#入职年限，如果是0年，薪资涨50；如果是1年，薪资涨100；如果是2年，薪资涨200；如果是3年，</span>
<span class="token comment">#薪资涨300；如果是4年，薪资涨400；其他的涨薪</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> employees<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> $
<span class="token keyword">create</span> <span class="token keyword">procedure</span> update_salary_by_eid5<span class="token punctuation">(</span><span class="token operator">in</span> emp_id <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">out</span> upsalary <span class="token keyword">double</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">declare</span> year_num <span class="token keyword">double</span><span class="token punctuation">;</span>
    <span class="token keyword">declare</span> upsalary_bum <span class="token keyword">double</span><span class="token punctuation">;</span>
    <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span>datediff<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span><span class="token punctuation">)</span> <span class="token keyword">into</span> year_num <span class="token keyword">from</span> employees <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
    <span class="token keyword">case</span> year_num
        <span class="token keyword">when</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">50</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">100</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">when</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">200</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">when</span> <span class="token number">4</span> <span class="token keyword">then</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">300</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">when</span> <span class="token number">5</span> <span class="token keyword">then</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">400</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">set</span> <span class="token variable">@upsalary_bum</span>:<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span><span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> employee_id<span class="token operator">=</span>emp_id<span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">case</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre> 
<h5><a id="loop_while_true_597"></a>loop (while true)</h5> 
<p>LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子句），跳出循环过程</p> 
<pre><code class="prism language-sql"><span class="token comment"># loop，重复执行，直到循环推出，while true</span>
<span class="token comment"># 循环涨薪，直到公司平均工资为12000位置，并且统计循环次数</span>

<span class="token keyword">delimiter</span> $
<span class="token keyword">create</span> <span class="token keyword">procedure</span> loop_upsalary<span class="token punctuation">(</span><span class="token keyword">out</span> num <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
    <span class="token keyword">declare</span> up_num <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment"># 定义默认值</span>
    <span class="token keyword">declare</span> avg_sal <span class="token keyword">double</span><span class="token punctuation">;</span>
    add_loop:<span class="token keyword">LOOP</span>
    <span class="token comment"># 定义loop，命名</span>
    <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">into</span> avg_sal <span class="token keyword">from</span> employees<span class="token punctuation">;</span>
    <span class="token keyword">if</span> avg_sal <span class="token operator">&gt;</span><span class="token number">12000</span> <span class="token keyword">then</span> <span class="token keyword">leave</span> add_loop<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">update</span> employees <span class="token keyword">set</span> salary<span class="token operator">=</span>salary<span class="token operator">+</span><span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">set</span> up_num<span class="token operator">=</span>up_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span> <span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">loop</span> add_loop<span class="token punctuation">;</span>
    <span class="token comment"># 退出指定的loop</span>
    <span class="token keyword">set</span> num<span class="token operator">=</span>up_num<span class="token punctuation">;</span>
<span class="token keyword">end</span> $

<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>

<span class="token keyword">set</span> <span class="token variable">@num</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">call</span> loop_upsalary<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@num</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="while_629"></a>while</h5> 
<p>WHILE语句创建一个带条件判断的循环过程。WHILE在执行语句执行时，先对指定的表达式进行判断，如果为真，就执行循环内的语句，否则退出循环。WHILE语句的基本格式如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_while<span class="token punctuation">(</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">DOUBLE</span> <span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> while_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	<span class="token keyword">WHILE</span> avg_sal <span class="token operator">&gt;</span> <span class="token number">5000</span> <span class="token keyword">DO</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> while_count <span class="token operator">=</span> while_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> num <span class="token operator">=</span> while_count<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4dc0a96694d0deba7d26eeb8a9f2a905/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2022年氧化工艺考试模拟100题及在线模拟考试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c8cdd2f2efa36bf7a38ee1b302d27d4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是makefile</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>