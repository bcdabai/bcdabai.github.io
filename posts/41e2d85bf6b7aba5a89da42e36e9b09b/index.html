<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HTTP 请求格式与RestTemplate - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HTTP 请求格式与RestTemplate" />
<meta property="og:description" content="HTTP 格式 请求： GET /more HTTP/1.1 Host: www.baidu.com Connection: keep-alive Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36 Accept: text/html,application/xhtml&#43;xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 请求行请求标头空行请求体 响应： HTTP/1.1 200 OK Cache-Control: private Connection: keep-alive Content-Encoding: gzip Content-Type: text/html;charset=utf-8 Date: Sat, 02 Oct 2021 08:14:53 GMT Expires: Sat, 02 Oct 2021 08:14:53 GMT Server: BWS/1.1 X-Frame-Options: sameorigin X-Ua-Compatible: IE=Edge,chrome=1 Transfer-Encoding: chunked {&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/41e2d85bf6b7aba5a89da42e36e9b09b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-27T18:51:17+08:00" />
<meta property="article:modified_time" content="2022-05-27T18:51:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HTTP 请求格式与RestTemplate</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="HTTP__0"></a>HTTP 格式</h2> 
<h3><a id="_1"></a>请求：</h3> 
<pre><code>GET /more HTTP/1.1
Host: www.baidu.com
Connection: keep-alive
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
</code></pre> 
<ol><li>请求行</li><li>请求标头</li><li>空行</li><li>请求体</li></ol> 
<h3><a id="_19"></a>响应：</h3> 
<pre><code>HTTP/1.1 200 OK
Cache-Control: private
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html;charset=utf-8
Date: Sat, 02 Oct 2021 08:14:53 GMT
Expires: Sat, 02 Oct 2021 08:14:53 GMT
Server: BWS/1.1
X-Frame-Options: sameorigin
X-Ua-Compatible: IE=Edge,chrome=1
Transfer-Encoding: chunked

{"code":200,"notice":0,"follow":0,"forward":0,"msg":0,"comment":0,"pushMsg":null}
</code></pre> 
<ol><li>状态行</li><li>响应标头</li><li>空行</li><li>响应体</li></ol> 
<h2><a id="Http2_41"></a>Http/2</h2> 
<h3><a id="_42"></a>伪头部字段</h3> 
<p>伪头部字段是http2内置的几个特殊的以”:”开始的key，用于替代HTTP/1.x中请求行/响应行中的信息，比如请求方法，响应状态码等，内置的伪头部字段列表如下：</p> 
<pre><code>:method		# GET/POST....
:scheme		# http/https
:authority	# Host
:path		# Url
:status		# 200/404
</code></pre> 
<h2><a id="Https_53"></a>Https</h2> 
<h3><a id="_54"></a>非对称加密</h3> 
<p>https://blog.csdn.net/howeres/article/details/112387222</p> 
<p>非对称加密是单向的加解密。</p> 
<h3><a id="HttpSSL_59"></a>Http+SSL</h3> 
<p>Https在TCP连接建立后，还需SSL协议握手，成功后才发起请求，其余和http一致，http只需TCP建立连接后就可以发起请求。</p> 
<p>CA（Certification Authority 签发证书、认证证书、管理已颁发证书的机关）</p> 
<p>SSL校验：服务端单方面使用非对称加密，然后客户端产生一个随机数用服务端公钥加密返回给服务端。然后双方就使用该随机数对称加密进行通信。</p> 
<p>主要分三步：</p> 
<ol><li>客户端向服务器端索要证书并验证公钥;</li><li>双方协商生成"对话密钥";</li><li>双方采用"对话密钥"进行加密通信;</li></ol> 
<p>其中，<strong>证书</strong>保证了公钥的可信与安全；<strong>公钥</strong>保证了“对话秘钥”传输的安全，<strong>对话秘钥</strong>保证了通信报文的安全。</p> 
<p>一般打开网页显示：您的连接不是私密连接；一种可能就是网站返回的证书，浏览器去CA验证发现不一致。</p> 
<p>还有一种情况，能打开发现没有锁标志，这是因为https的网页里面含有非https的连接（既http连接）</p> 
<blockquote> 
 <p>RFC：请求意见稿（英语：Request for Comments，缩写：RFC），又翻译作意见征求，意见请求，请求意见稿是由互联网工程任务组（IETF）发布的一系列备忘录。文件收集了有关互联网相关信息，以及UNIX和互联网社群的软件文件，以编号排定。</p> 
</blockquote> 
<p>2xx 都代表成功（那没事了）<br> 3xx 都代表重定向（redirect, 请求两次）<br> 4xx 都代表资源未找到，启动失败（我方）<br> 5xx 都代表服务器内部错误，或错误代码（服务端）</p> 
<h2><a id="Spring__85"></a>Spring 框架下发送请求</h2> 
<h3><a id="URL__87"></a>URL 格式</h3> 
<pre><code>protocol://hostname[:port]/path/[?query]#fragment
</code></pre> 
<ol><li>query 查询参数, 请求时携带的参数, 用<code>&amp;</code>隔开, 名和值用<code>=</code>隔开.</li><li>fragment 喵点, 指定网络资源中的片段, 如定位到网页中的某一名词解释, 又或者网页滚动的位置.</li></ol> 
<h3><a id="_RestTemplate__96"></a>使用 RestTemplate 发送请求</h3> 
<pre><code class="prism language-java"><span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://www.baidu.com/s"</span><span class="token punctuation">;</span>

<span class="token comment">// 1. POST 表单要使用 MultiValueMap 而非普通的 HashMap</span>
<span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> paramMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
paramMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"para1"</span><span class="token punctuation">,</span> <span class="token string">"001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
paramMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"para2"</span><span class="token punctuation">,</span> <span class="token string">"002"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> responseBody <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> paramMap<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. path</span>
<span class="token class-name">URI</span> http <span class="token operator">=</span> <span class="token comment">// 占位符形似</span>
        <span class="token class-name">UriComponentsBuilder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">scheme</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">"example.com"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/hotels/{hotel}/bookings/{booking}"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token string">"42"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. getParam</span>
<span class="token comment">// UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url);</span>
<span class="token comment">// builder.queryParam("wd", "hello world");</span>
<span class="token comment">// URI uri = builder.build().encode().toUri();</span>
<span class="token class-name">URI</span> uri <span class="token operator">=</span> <span class="token comment">// get参数形式（仅）</span>
        <span class="token class-name">UriComponentsBuilder</span><span class="token punctuation">.</span><span class="token function">fromHttpUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">queryParam</span><span class="token punctuation">(</span><span class="token string">"wd"</span><span class="token punctuation">,</span> <span class="token string">"hello world"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// HttpEntity 包含 { headers: 实体标头 | body: 实体主体 } &lt;请求体类型&gt;</span>
<span class="token comment">// ResponseEntity 也是一种 HttpEntity</span>
<span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span>
        restTemplate<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> body <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. JDK 自带 URLEncoding 转换 (!!!需要注意别把 "http://../../" 也给encode了)</span>
<span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\+"</span><span class="token punctuation">,</span> <span class="token string">"%20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_140"></a>三次握手</h2> 
<p>双方需要维护一个序号;<br> 买东西要先下单, 再付款;</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4831816f7116f74c4ccd87be2192604a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">升级openssh后版本不一致问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/934f7b0ec346a7e100ddcffcab881809/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络带宽单位转换 — MB/s、Mb/s、Mbps、Mbit/s、Kbps</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>