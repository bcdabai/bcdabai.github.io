<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【IPTV详解三部曲】运营商PIM组网篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【IPTV详解三部曲】运营商PIM组网篇" />
<meta property="og:description" content="IPTV简介
IPTV主要是运营商于城域网等骨干网络中部署视频专用服务器作为视频源，并在该服务器中内置视频资源，以供接入该运营商线路的机顶盒播放视频节目。IPTV系统的特点是实时性强，能实现实时直播、直播回放、点播等业务。
系统组网
IPTV系统由前端设备、网络传输和终端设备三部分组成：
前端设备：主要是指视频专用服务器，作为视频源不仅需要加加密的视音频流媒体节目以IP单播/组播的方式推送，还需要支持对用户或用户终端设备进行认证。网络传输：视频源推送的IP组播/单播视频流会在城域网、骨干网络中传输，常见PIM协议部署的ASM（任意组播源模型）和SSM模型（指定组播源模型），通过组播路由和路由交换将视频流最终送达到所需用户侧的终端设备。终端设备：目前市面上最常见的设备为机顶盒，用来接收、存储和播放及转发IP视音频流媒体节目。 网络架构
常见的运营商家庭IPTV、园区IPTV、酒店IPTV、在线直播、网络电视等组网场景下对于IPTV功能的实现依赖于组播技术，它有效地解决了单点发送、多点接收的问题，能够大量地节约网络带宽、降低网络负载。
典型的组网常见使用PIM协议进行部署，如下：
通过运营商部署的PIM网络，实现家庭网络用户能接收到视频服务器的视频流，以正常观看电视节目。
典型配置案例：在路由器上配置PIM-SM协议，为网络中的用户主机提供ASM服务，使得加入同一组播组的所有用户主机（家用机顶盒）能够接收任意源发往该组的组播数据信息观看IPTV电视直播。
【PIM网络配置思路】
PIM协议依赖单播路由协议。配置PIM路由路各个接口的IP地址，并配置IGP协议（本例使用OSPF，且不考虑跨域方案）实现PIM路由器互通；；所有PIM路由器使能组播功能（multicast routing-enable），所有接口使能PIM-SM；与家庭网络中光猫相连的路由器接口上使能IGMP（入户光猫一般作为IGMP代理，可直接视为用户侧主机），Receiver机顶盒通过发送IGMP消息自由加入或离开；配置AR2为主RP，AR1为备RP以实现RP动态冗余。PIM-SM域中，RP是提供ASM服务的核心，是转发组播数据的中转站；配置AR1为主BSR，AR2为备BSR以实现BSR冗余。BSR负责收集网络内的RP信息，为每个组选举出RP，然后将RP集（即组-RP映射数据库）发布到整个PIM-SM网络。 本文就不附实验配置了，感兴趣的同学可以在华为官网参考相关实验配置实现。
【PIM网络数据流转发原理】
（1）完成配置后，Receiver1（192.168.1.254/24）和Receiver2（192.168.2.254/24）的机顶盒会发IGMP报告加入组播组，前者为224.1.1.1后者为239.1.1.1；
（2）（*，G）表项在用户侧路由到RP沿途生成并建立共享树，分别为：Receiver1-AR1-AR2和Receiver2-AR5-AR2：
（3）AR2 PIM路由表可以看到224.1.1.1的组播流需要向下联口G0/0/0转发，239.1.1.1需要向下联口G0/0/2转发：：
（4）视频服务器会向PIM网络中发流（如224.1.1.1的直播流和239.1.1.1的直播流），其所连接的DR路由器此时会通过单播的方式找到RP完成注册信息，（S，G）表项在组播源路由器到RP沿途生成并建立源树，即：视频服务器-AR4-AR2：
（5）源树沿途建立完成后，直播流通过源树到达RP，RP向第一跳路由器（AR4）发送注册停止（Register-Stop）消息，停止注册过程。此时AR2 PIM路由表可以看到（S，G）表项：
a. 来自源视频服务器172.1.1.1的224.1.1.1直播流上联口为G0/0/1下联口为G0/0/0：
​​​​​​​​​​​​​​ b. 来自源视频服务器172.1.1.2的239.1.1.1直播流上联口为G0/0/1下联口为G0/0/2
​​​​​​​（6）IPTV数据流沿着SPT（源树）流向RP，再从RP沿着RPT（共享树）流向Receiver机顶盒，最终完成电视节目的正常播放：
​​​​​​​（7）当IPTV数据流达到一定速率后会触发RPT向SPT的切换，用户侧路由器（AR1和AR5）知道视频流源IP就能通过IGP最短路径找到组播源DR（AR4），从而建立新源树（AR1-AR2-AR4和AR5-AR2-AR4）直接转发数据流，如果与源共享树路径不一致会“剪枝”阻断数据流（本例中新SPT路径和旧RPT&#43;SPT路径一致，在此不做过多详解）。
IPTV直播与换台
运营商PIM网络至用户侧机顶盒部署完成后，在家里将机顶盒接入光猫专用IPTV口，然后在接上电视就就能观看IPTV节目啦！
日常使用中，每个直播频道都会对应一个组播组，更换节目频道即“离开上一个组播组，加入新组播组取流的过程”：
更多组网方案可关注微信公众号：网络工程师解决方案与技术
作者：小云君" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f39d2e349cc550e594d66251ba7eeb99/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-14T16:09:26+08:00" />
<meta property="article:modified_time" content="2023-02-14T16:09:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【IPTV详解三部曲】运营商PIM组网篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#85be5f;"><span style="color:#ffffff;">IPTV</span></span></strong><strong><span style="background-color:#85be5f;"><span style="color:#ffffff;">简介</span></span></strong></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">IPTV</span></span><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">主要是运营商于城域网等骨干网络中部署视频专用服务器作为视频源，并在该服务器中内置视频资源，以供接入该运营商线路的机顶盒播放视频节目。IPTV系统的特点是实时性强，能实现实时直播、直播回放、点播等业务。</span></span></span></p> 
<p style="margin-left:.0001pt;"><strong><span style="background-color:#ffffff;"><span style="background-color:#85be5f;"><span style="color:#ffffff;">系统组网</span></span></span></strong></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">IPTV</span></span><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">系统由<strong>前端设备、网络传输</strong>和<strong>终端设备</strong>三部分组成：</span></span></span></p> 
<ol><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">前端设备：主要是指视频专用服务器，作为视频源不仅需要加加密的视音频流媒体节目以IP单播/组播的方式推送，还需要支持对用户或用户终端设备进行认证。</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">网络传输：视频源推送的IP组播/单播视频流会在城域网、骨干网络中传输，常见PIM协议部署的ASM（任意组播源模型）和SSM模型（指定组播源模型），通过组播路由和路由交换将视频流最终送达到所需用户侧的终端设备。</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">终端设备：目前市面上最常见的设备为机顶盒，用来接收、存储和播放及转发IP视音频流媒体节目。</span></span></span></li></ol> 
<p class="img-center"><img alt="" height="133" src="https://images2.imgbox.com/bc/fa/3CMeB5hQ_o.png" width="524"></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#85be5f;"><span style="color:#ffffff;">网络架构</span></span></strong></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">常见的运营商家庭IPTV、园区IPTV、酒店IPTV、在线直播、网络电视等组网场景下对于IPTV功能的实现依赖于<strong>组播技术，</strong>它有效地解决了单点发送、多点接收的问题，能够大量地节约网络带宽、降低网络负载。</span></span></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">典型的组网常见使用PIM协议进行部署，如下：</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="788" src="https://images2.imgbox.com/47/bd/7KlgBEqM_o.png" width="1142"></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">通过运营商部署的PIM网络，实现家庭网络用户能接收到视频服务器的视频流，以正常观看电视节目。</span></span></span></p> 
<p style="margin-left:.0001pt;"><span style="color:#3f3f3f;"><span style="background-color:#f9eda6;">典型配置案例：在路由器上配置PIM-SM协议，为网络中的用户主机提供ASM服务，使得加入同一组播组的所有用户主机（家用机顶盒）能够接收任意源发往该组的组播数据信息观看IPTV电视直播。</span></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">【PIM网络配置思路】</span></span></strong></span></p> 
<ol><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">PIM</span></span><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">协议依赖单播路由协议。配置PIM路由路各个接口的IP地址，并配置IGP协议（本例使用OSPF，且不考虑跨域方案）实现PIM路由器互通；；</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">所有PIM路由器使能组播功能（multicast routing-enable），所有接口使能PIM-SM；</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">与家庭网络中光猫相连的路由器接口上使能IGMP（入户光猫一般作为IGMP代理，可直接视为用户侧主机），Receiver机顶盒通过发送IGMP消息自由加入或离开；</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">配置AR2为主RP，AR1为备RP以实现RP动态冗余。PIM-SM域中，RP是提供ASM服务的核心，是转发组播数据的中转站；</span></span></span></li><li><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">配置AR1为主BSR，AR2为备BSR以实现BSR冗余。BSR负责收集网络内的RP信息，为每个组选举出RP，然后将RP集（即组-RP映射数据库）发布到整个PIM-SM网络。</span></span></span></li></ol> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#ff0000;">本文就不附实验配置了，感兴趣的同学可以在华为官网参考相关实验配置实现。</span></span></strong></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">【PIM网络数据流转发原理】</span></span></strong></span></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（1）完成配置后，Receiver1（192.168.1.254/24）和Receiver2（192.168.2.254/24）的机顶盒会发IGMP报告加入组播组，前者为224.1.1.1后者为239.1.1.1；</span></span></span></p> 
<p><img alt="" height="46" src="https://images2.imgbox.com/5b/7f/DqStzQKK_o.png" width="1078"></p> 
<p style="margin-left:.0001pt;"></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（2）（*，G）表项在用户侧路由到RP沿途生成并建立共享树，分别为：Receiver1-AR1-AR2和Receiver2-AR5-AR2：</span></span></span></p> 
<p><img alt="" height="786" src="https://images2.imgbox.com/73/ab/l8W3aEWx_o.png" width="1130"></p> 
<p style="margin-left:.0001pt;"></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（3）AR2 PIM</span></span><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">路由表可以看到224.1.1.1的组播流需要向下联口G0/0/0转发，239.1.1.1需要向下联口G0/0/2转发：：</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="556" src="https://images2.imgbox.com/92/a6/4ttndztj_o.png" width="734"></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（4）视频服务器会向PIM网络中发流（如224.1.1.1的直播流和239.1.1.1的直播流），其所连接的DR路由器此时会通过单播的方式找到RP完成注册信息，（S，G）表项在组播源路由器到RP沿途生成并建立源树，即：视频服务器-AR4-AR2：</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="787" src="https://images2.imgbox.com/c7/dd/TyhFyLiJ_o.png" width="1139"></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（5）源树沿途建立完成后，直播流通过源树到达RP，RP向第一跳路由器（AR4）发送注册停止（Register-Stop）消息，停止注册过程。此时AR2 PIM路由表可以看到（S，G）表项：</span></span></span></p> 
<p><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">        a. 来自源视频服务器172.1.1.1的224.1.1.1直播流上联口为G0/0/1下联口为G0/0/0：</span></span></span></p> 
<p class="img-center"><img alt="" height="249" src="https://images2.imgbox.com/bc/e2/r5vBpFuf_o.png" width="609"></p> 
<p>​​​​​​​​​​​​​​        <span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">b. 来自源视频服务器172.1.1.2的239.1.1.1直播流上联口为G0/0/1下联口为G0/0/2</span></span></span></p> 
<p class="img-center"><img alt="" height="227" src="https://images2.imgbox.com/9f/a3/2CsuGyJu_o.png" width="621"></p> 
<p>​​​​​​​<span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（6）IPTV</span></span><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">数据流沿着SPT（源树）流向RP，再从RP沿着RPT（共享树）流向Receiver机顶盒，最终完成电视节目的正常播放：</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="788" src="https://images2.imgbox.com/e2/90/Ct9BxZen_o.png" width="1129"></p> 
<p>​​​​​​​<span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">（7）当IPTV数据流达到一定速率后会触发RPT向SPT的切换，用户侧路由器（AR1和AR5）知道视频流源IP就能通过IGP最短路径找到组播源DR（AR4），从而建立新源树（AR1-AR2-AR4和AR5-AR2-AR4）直接转发数据流，如果与源共享树路径不一致会“剪枝”阻断数据流（本例中新SPT路径和旧RPT+SPT路径一致，在此不做过多详解）。</span></span></span></p> 
<p style="margin-left:.0001pt;"></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><strong><span style="background-color:#85be5f;"><span style="color:#ffffff;">IPTV</span></span></strong><strong><span style="background-color:#85be5f;"><span style="color:#ffffff;">直播与换台</span></span></strong></span></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">运营商PIM网络至用户侧机顶盒部署完成后，在家里将机顶盒接入光猫专用IPTV口，然后在接上电视就就能观看IPTV节目啦！</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="252" src="https://images2.imgbox.com/22/43/B1D8G3cO_o.png" width="839"></p> 
<p style="margin-left:.0001pt;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#3f3f3f;">日常使用中，每个直播频道都会对应一个组播组，更换节目频道即“离开上一个组播组，加入新组播组取流的过程”：</span></span></span></p> 
<p style="margin-left:.0001pt;"><img alt="" height="394" src="https://images2.imgbox.com/d7/8f/Eqqb0fA3_o.png" width="1200"></p> 
<p style="margin-left:.0001pt;"></p> 
<p style="margin-left:.0001pt;"></p> 
<p style="margin-left:.0001pt;"></p> 
<p style="margin-left:0cm;"><strong><span style="color:#38d8f0;">更多组网方案可关注微信公众号：网络工程师解决方案与技术</span></strong></p> 
<p style="margin-left:0cm;"><strong><span style="color:#38d8f0;">作者：小云君</span></strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc96a298fca51baba054d1c8e55dc998/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023软考纸质证书领取通知来了！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c27eb6b28d64541918461c861f0ece0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">部署 K8s 集群</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>