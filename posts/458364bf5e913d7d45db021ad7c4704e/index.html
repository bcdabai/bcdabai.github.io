<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Strapi 实现用户注册与登录 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Strapi 实现用户注册与登录" />
<meta property="og:description" content="在官方博客 Registration and Login (Authentication) with Vue.js and Strapi 中演示如何实现注册与登录。实际重点部分是 Strapi 的角色和权限插件，可以说这个插件让开发者不用再为项目考虑的用户登录注册与鉴权相关。
创建 Strapi 项目 这里省略创建 strapi 项目创建过程，具体可到 Quick Start Guide 中查看。创建完项目，并注册管理员账号后，打开管理面板，根据自己需求创建数据。下面会介绍下管理面板的一些操作（以下针对中文面板）
角色列表 打开 设置 =&gt; 用户及权限插件 =&gt; 角色列表
默认有两个角色 Authenticated 与 Pubilc，都不可删除，其中还有一个 Admin 是我自己创建的角色，用于分配管理员的权限。
Authenticated 对应的也就是登录后的角色，即携带 Authorization 协议头携带 jwt 的用户。
另一个 Pubilc 则是未授权用户，默认权限如下
权限分配 双击角色可以到权限分配页面，比方说我想给 Authenticated 角色分配 Restaurant 表中查询数据，就可以按照如下选项中勾选，并且勾选其中一个权限（增删改查）可以在右侧看到对应的请求 api 接口（路由）
默认角色 可以在 设置 =&gt; 用户及权限插件 =&gt; 高级设置 中分配默认角色，此外这里还可以配置注册，重置密码等操作。对于这些功能而言，传统开发就需要编写相当多的代码了，而 Strapi 的 角色和权限 插件能省去开发这一部分功能的时间。
管理员权限 在 设置 =&gt; 管理员权限 也可以看到角色列表与用户列表，不过这个只针对登录 strapi 仪表盘的用户，与实际业务的用户毫不相干。通俗点说就是数据库系统的用户与后台管理系统用户的区别。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/458364bf5e913d7d45db021ad7c4704e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-25T14:25:48+08:00" />
<meta property="article:modified_time" content="2022-08-25T14:25:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Strapi 实现用户注册与登录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在官方博客 <a href="https://strapi.io/blog/registration-and-login-authentication-with-vue-js-and-strapi-1" rel="nofollow">Registration and Login (Authentication) with Vue.js and Strapi</a> 中演示如何实现注册与登录。实际重点部分是 Strapi 的<a href="https://docs.strapi.io/developer-docs/latest/plugins/users-permissions.html" rel="nofollow">角色和权限插件</a>，可以说这个插件让开发者不用再为项目考虑的用户登录注册与鉴权相关。</p> 
 
<h3><a id="_Strapi__4"></a>创建 Strapi 项目</h3> 
<p>这里省略创建 strapi 项目创建过程，具体可到 <a href="https://docs.strapi.io/developer-docs/latest/getting-started/quick-start.html" rel="nofollow">Quick Start Guide</a> 中查看。创建完项目，并注册管理员账号后，打开管理面板，根据自己需求创建数据。下面会介绍下管理面板的一些操作（以下针对中文面板）</p> 
<h4><a id="_8"></a>角色列表</h4> 
<p>打开 <strong>设置 =&gt; 用户及权限插件 =&gt; 角色列表</strong></p> 
<p><img src="https://images2.imgbox.com/e6/04/K9er2fVd_o.png" alt="image-20220825131929320"></p> 
<p>默认有两个角色 Authenticated 与 Pubilc，都不可删除，其中还有一个 Admin 是我自己创建的角色，用于分配管理员的权限。</p> 
<p>Authenticated 对应的也就是登录后的角色，即携带 <strong>Authorization</strong> 协议头携带 jwt 的用户。</p> 
<p>另一个 Pubilc 则是未授权用户，默认权限如下</p> 
<p><img src="https://images2.imgbox.com/07/e8/Ho6NgQZf_o.png" alt="image-20220825132235027"></p> 
<h4><a id="_22"></a>权限分配</h4> 
<p>双击角色可以到权限分配页面，比方说我想给 Authenticated 角色分配 Restaurant 表中查询数据，就可以按照如下选项中勾选，并且勾选其中一个权限（增删改查）可以在右侧看到对应的请求 api 接口（路由）</p> 
<p><img src="https://images2.imgbox.com/17/e8/V3YPDw6U_o.png" alt="image-20220825132716257"></p> 
<h4><a id="_28"></a>默认角色</h4> 
<p>可以在 <strong>设置 =&gt; 用户及权限插件 =&gt; 高级设置</strong> 中分配默认角色，此外这里还可以配置注册，重置密码等操作。对于这些功能而言，传统开发就需要编写相当多的代码了，而 Strapi 的 <a href="https://docs.strapi.io/developer-docs/latest/plugins/users-permissions.html" rel="nofollow">角色和权限</a> 插件能省去开发这一部分功能的时间。</p> 
<p><img src="https://images2.imgbox.com/c5/9c/pXdT36dQ_o.png" alt="image-20220825132948740"></p> 
<h4><a id="_34"></a>管理员权限</h4> 
<p>在 <strong>设置 =&gt; 管理员权限</strong> 也可以看到角色列表与用户列表，不过这个只针对登录 strapi 仪表盘的用户，与实际业务的用户毫不相干。通俗点说就是数据库系统的用户与后台管理系统用户的区别。</p> 
<p>一开始登录面板创建的用户在 <strong>设置 =&gt; 管理员权限 =&gt; 用户列表</strong> 中可以看到，而通过api http://localhost:1337/api/auth/local/register 注册的用户则是在 <strong>内容管理 =&gt; User</strong> 中查看。</p> 
<h3><a id="_HTTP__40"></a>使用 HTTP 请求用户操作（通用）</h3> 
<p>这里先给出官方提供的注册和登录地址，分别是：</p> 
<p><a href="http://localhost:1337/api/auth/local/register" rel="nofollow">http://localhost:1337/api/auth/local/register</a></p> 
<p><a href="http://localhost:1337/api/auth/local" rel="nofollow">http://localhost:1337/api/auth/local</a></p> 
<p>分别可在 <a href="https://docs.strapi.io/developer-docs/latest/plugins/users-permissions.html#login" rel="nofollow">Login</a> 与 <a href="https://docs.strapi.io/developer-docs/latest/plugins/users-permissions.html#registration" rel="nofollow">Register</a> 中查看官方演示例子，例如</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token comment">// Request API.</span>
axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://localhost:1337/api/auth/local'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">identifier</span><span class="token operator">:</span> <span class="token string">'user@strapi.io'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'strapiPassword'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Handle success.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Well done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User profile'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User token'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jwt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Handle error.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An error occurred:'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token comment">// Request API.</span>
axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://localhost:1337/api/auth/local/register'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'Strapi user'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'user@strapi.io'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'strapiPassword'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Handle success.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Well done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User profile'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User token'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jwt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Handle error.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An error occurred:'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>除了登录外，还有几个api可能还会用到如获取个人信息，重置密码，修改密码，发送邮箱验证等等。更多可到 <a href="https://docs.strapi.io/developer-docs/latest/plugins/users-permissions.html#authentication" rel="nofollow">Roles &amp; Permissions</a> 中查看</p> 
<p>通过 HTTP 这种方案可以说是最通用的了，不过有些框架还提供相应的模块来调用 Strapi。</p> 
<h3><a id="Nuxt_95"></a>Nuxt</h3> 
<p>官方 Nuxt3 提供了 hooks 方案使用 Strapi。具体可看 <a href="https://strapi.nuxtjs.org/" rel="nofollow">Nuxt Strapi Module</a>。Nuxt2 可看<a href="https://strapi-v0.nuxtjs.org/hooks" rel="nofollow">这里</a></p> 
<p>通过相应的 hooks 就可以实现登录注册以及数据增删改查的功能，演示例子可看 <a href="https://strapi.nuxtjs.org/usage" rel="nofollow">Usage</a></p> 
<p>这里有一份我创建的预设模板 <a href="https://github.com/kuizuo/nuxt3-strapi">kuizuo/nuxt3-strapi</a>，不过目前 Strapi 对 TypeScript 支持不是那么友好，尤其在 window 下会出现无法运行的情况，详看这个 <a href="https://github.com/strapi/strapi/pull/14088">pr</a>。所以目前 backend 还是使用 js，后续根据情况再升级为 ts。顺带写一个 strapi 的一个在线用户登录注册演示。（留个坑）</p> 
<p>:::note</p> 
<p>原本我考虑的是使用 starter 方式来创建nuxt3 strapi项目，但是就在我创建完 starter 与 template 准备使用 <code>yarn create strapi-starter strapi-nuxt3 https://github.com/kuizuo/strapi-starter-nuxt3</code> 下载模板时，不出意外又出意外的报错了，由于这个报错也不好排查就暂时放弃了。</p> 
<p>总之又是一趟白折腾的经过。</p> 
<p>:::</p> 
<h3><a id="Next_112"></a>Next</h3> 
<p>Next 我暂未找到相关库可以像 Nuxt 提供 Strapi 的服务。不过 Strapi 官方有提供 <a href="https://github.com/strapi/strapi-sdk-javascript">sdk</a>的方案来调用 strapi 服务，而不用发送 http 请求的形式来调用，具体可以到官方提供的 <a href="https://github.com/strapi/strapi-sdk-javascript">sdk</a> 查看如何使用，这里不做演示。有如下两个SDK可供选择：</p> 
<p><a href="https://github.com/strapi/strapi-sdk-javascript">strapi/strapi-sdk-javascript</a> 官网</p> 
<p><a href="https://strapi-sdk-js.netlify.app/" rel="nofollow">Strapi SDK (strapi-sdk-js.netlify.app)</a> 社区</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34c9cc2bed26392e9edc851faee893c8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">tomcat 报收到的cookie头包含无效的cookie</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c4122d01beeeb3d2b672aca3269d373/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【K8S专栏】Kubernetes工作负载管理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>