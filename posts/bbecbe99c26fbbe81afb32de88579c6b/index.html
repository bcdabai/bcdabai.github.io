<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GPIO工作模式详解（含Arduino实例） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GPIO工作模式详解（含Arduino实例）" />
<meta property="og:description" content="1. GPIO介绍 从最基础的51单片机，Arduino，到STM32，树莓派等等，这些上面都会有GPIO口这么一个概念，如果你点开了我这个博客，说明你大概率开始学习单片机，那么你应该了解的就是这些口可以输出高低电平，或者是读取引脚上的输入电平。
GPIO的总述功能如下：
GPIO(general porpose intput output):通用输入输出端口的简称。可以通过软件控制其输出和输入。GPIO引脚与外部设备连接起来，从而实现与外部通信，控制以及数据采集的功能。
下面以STM32内部GPIO口为例的内部原理图，先有一个这个图的概念，下面就是开始讲怎么理解GPIO口。
2. 基础知识介绍 先来一点最基础的知识
上拉和下拉：
当我们闭合上拉电阻的开关，断开下拉电阻的开关的时候，也就是此时为上拉通路导通。根据我们最基础的电路知识，如果I/O口断开不接外设，或者接了外设但是电路也断开，此时整条回路是断路的时候，电阻相当于不存在，此时O点的电位，也就被钳制在了VDD(供电电压正极)，于是O点就处于高电平。
同理，闭合上拉电阻的开关，断开下拉电阻的开关，那么在电路断开的时候，根据电路知识，电阻相当于不存在，O点的电压就就被钳制在了VSS(GND)，也就是O点处于低电平。
数字信号和模拟信号
数字信号：就是根据一些规则，将一个范围内的电压规定为1，一个范围内的电压规定为0，也就是一连串的0,1信号
模拟信号：就是连续的读取到的电压值。
关于图上的TTL施密特触发器和P-MOS和N-MOS，后面讲到对应部分的时候会讲到。
电源符号含义
VDD：D=device 表示芯片内部工作电源（一般VDD&lt;VCC）。端口引脚电路中的VDD表示能够容忍3.3V电压（最大3.6V），如果是VDD_FT则表示能够忍5V。
VSS：S=series 表示公共连接，通常指电路公共接地端电压。
TTL肖特基触发器：即为用肖特基管构成的施密特触发器，施密特触发器利用门阀电压将引脚模拟信号变成矩形信号，进行转化为0/1数字信号存入输入数据寄存器。
什么是推挽结构和推挽电路
推挽结构一般是指两个参数相同的三极管或MOS管分别受两互补信号的控制，总是在一个三极管或MOS管导通的时候另一个截止。高低电平由输出电平决定。
推挽电路是两个参数相同的三极管或MOSFET，以推挽方式存在于电路中，各负责正负半周的波形放大任务。电路工作时，两只对称的功率开关管每次只有一个导通，所以导通损耗小、效率高。输出既可以向负载灌电流，也可以从负载抽取电流。推拉式输出级既提高电路的负载能力，又提高开关速度。
开漏输出和推挽输出的区别
开漏输出：只可以输出强低电平，高电平得靠外部电阻拉高。输出端相当于三极管的集电极。适合于做电流型的驱动，其吸收电流的能力相对强(一般20ma以内)；
推挽输出:可以输出强高、低电平，连接数字器件。
关于推挽输出和开漏输出，最后用一幅最简单的图形来概括：
该图中左边的便是推挽输出模式，其中比较器输出高电平时下面的PNP三极管截止，而上面NPN三极管导通，输出电平VS&#43;；当比较器输出低电平时则恰恰相反，PNP三极管导通，输出和地相连，为低电平。右边的则可以理解为开漏输出形式，需要接上拉。
3. GPIO八种工作模式 3.1 浮空输入模式 浮空输入模式：数据通道中仅接入TTL触发器（作用是将相对缓慢变化的模拟信号变成矩形信号）整形，随后输入输入数据寄存器，该种工作模式未接入任何上拉/下拉电阻。 模式特点：在该引脚悬空（无信号输入）的情况下，读取该端口的电平是不确定的。 适用场合：外部按键输入/USART RX引脚。
3.2 上拉输入模式 上拉输入模式：与浮空输入模式相比，仅仅是在数据通道前端接入了一个上拉电阻，其余无变化。 模式特点：在无信号输入时端口电位受上拉电阻钳制，I/O端口输入电平始终保持为高电平；而当端口输入电平为低电平时，I/O端口输入电平为低电平。 适用场合：需要IO内部上拉电阻输入时，器件的外部中断（IRQ）引脚触发中断条件为下降沿触发/低电平触发，这样在无信号输入时始终保持高电平，如果有事件触发中断IRQ可以输出一个低电平，进而可产生（下降沿/低电平）中断。例如单片无线收发器芯片NRF24L01的IRQ引脚的工作模式即为上拉输入模式。
3.3 下拉输入模式 下拉输入模式：与浮空输入模式相比，仅仅是在数据通道前端接入了一个下拉电阻，其余无变化。 模式特点：在无信号输入时端口电位受下拉电阻钳制，I/O端口输入电平始终保持为低电平；而当端口输入电平为高电平时，I/O端口输入电平为高电平。 适用场合：需要IO内部下拉电阻输入时，器件的外部中断（IRQ）引脚触发中断条件为上升沿触发/高电平触发时，该端口可以选择下拉输入模式。
对于为什么要加上拉或下拉电阻：
1.当作单片机作为输入时，假设我们直接在IO端口接一个按键到地（或电源）。因为按键按与不按管脚都是悬空的。单片机就很难检测按键是否按下。所以人为的接一个上拉（或下拉）。以确定未按下的时候IO输入电平的状态。
2.可以提高芯片的抗干扰能
3.当单片机的IO口作输出时，如果不接上拉电阻只能提供灌电流。无法输出电流驱动外接设备。这时也需要考虑上拉电阻。这样才可以使IO输出高电平
3.4 模拟输入模式 模拟输入模式：数据通道不接入任何处理单元（TTL触发器/钳制电阻），直接输入MCU内部的处理单元。模拟输入模式下，I/O端口的模拟信号（电压信号，而非电平信号）直接模拟输入到片上外设模块，比如ADC模块等。模拟信号一般：3.3v 5v 9v。
模式特点：相较于其他输入模式只能读取到逻辑高/低电平（数字量），该模式能读取到细微变化的值（模拟量）。 适用场合：ADC模拟输入/低功耗下省电。
3.5 开漏输出模式 开漏输出：适合做电流型的驱动，其吸收电流能力较强。当CPU输出逻辑’0’时，I/O端口输出低电平，而当CPU输出逻辑’1’时，该引脚处于开漏，也就是浮空状态（高阻态），如果想输出高电平则必须接入上拉电阻。同时IO口可以由外部电路改变为低电平或不变，即可读IO输入电平变化，实现了I/O端口的双向功能；此外，可以将多路开漏输出的引脚连接到一条线上，通过一个上拉电阻，在不增加任何器件的情况下，形成“与逻辑”关系，这也是I2C，SMBus，等总线判断总线占用状态的原理。
可以输出0和1，适用于电平不匹配场合，要得到高电平需要上拉电阻才行。
开漏输出模式下（上拉电阻&#43;N-MOS管），通过设置位设置/清除寄存器或者输出数据寄存器的值，途经N-MOS管，最终输出到I/O端口。这里要注意N-MOS管，当设置输出的值为高电平的时候，N-MOS管处于关闭状态，此时I/O端口的电平就不会由输出的高低电平决定，而是由I/O端口外部的上拉或者下拉决定；当设置输出的值为低电平的时候，N-MOS管处于开启状态，此时I/O端口的电平就是低电平。同时，I/O端口的电平也可以通过输入电路进行读取；注意，I/O端口的电平不一定是输出的电平。
3.6 开漏复用输出模式 复用开漏输出：与开漏输出特性一致，只不过引脚选择了复用功能，输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。适用场合：常见片内外设（I2C/SMBus等等）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bbecbe99c26fbbe81afb32de88579c6b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-19T17:33:41+08:00" />
<meta property="article:modified_time" content="2022-06-19T17:33:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GPIO工作模式详解（含Arduino实例）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_GPIO_0"></a>1. GPIO介绍</h2> 
<p>从最基础的51单片机，Arduino，到STM32，树莓派等等，这些上面都会有GPIO口这么一个概念，如果你点开了我这个博客，说明你大概率开始学习单片机，那么你应该了解的就是这些口可以输出高低电平，或者是读取引脚上的输入电平。<br> <strong>GPIO的总述功能如下：</strong><br> GPIO(general porpose intput output):通用输入输出端口的简称。可以通过软件控制其输出和输入。GPIO引脚与外部设备连接起来，从而实现与外部通信，控制以及数据采集的功能。<br> 下面以STM32内部GPIO口为例的内部原理图，先有一个这个图的概念，下面就是开始讲怎么理解GPIO口。<br> <img src="https://images2.imgbox.com/45/f5/bfnUCGts_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/04/e9/IW0TubyY_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__7"></a>2. 基础知识介绍</h2> 
<p>先来一点最基础的知识<br> <strong>上拉和下拉：</strong><br> 当我们闭合上拉电阻的开关，断开下拉电阻的开关的时候，也就是此时为上拉通路导通。根据我们最基础的电路知识，如果I/O口断开不接外设，或者接了外设但是电路也断开，此时整条回路是断路的时候，电阻相当于不存在，此时O点的电位，也就被钳制在了VDD(供电电压正极)，于是O点就处于高电平。<br> 同理，闭合上拉电阻的开关，断开下拉电阻的开关，那么在电路断开的时候，根据电路知识，电阻相当于不存在，O点的电压就就被钳制在了VSS(GND)，也就是O点处于低电平。<br> <strong>数字信号和模拟信号</strong><br> 数字信号：就是根据一些规则，将一个范围内的电压规定为1，一个范围内的电压规定为0，也就是一连串的0,1信号<br> 模拟信号：就是连续的读取到的电压值。<br> 关于图上的TTL施密特触发器和P-MOS和N-MOS，后面讲到对应部分的时候会讲到。<br> <strong>电源符号含义</strong><br> VDD：D=device 表示芯片内部工作电源（一般VDD&lt;VCC）。端口引脚电路中的VDD表示能够容忍3.3V电压（最大3.6V），如果是VDD_FT则表示能够忍5V。<br> VSS：S=series 表示公共连接，通常指电路公共接地端电压。<br> TTL肖特基触发器：即为用肖特基管构成的施密特触发器，施密特触发器利用门阀电压将引脚模拟信号变成矩形信号，进行转化为0/1数字信号存入输入数据寄存器。<br> <strong>什么是推挽结构和推挽电路</strong><br> 推挽结构一般是指<strong>两个参数相同的三极管或MOS管分别受两互补信号的控制，总是在一个三极管或MOS管导通的时候另一个截止。高低电平由输出电平决定。</strong><br> 推挽电路是两个参数相同的三极管或MOSFET，以推挽方式存在于电路中，各负责正负半周的波形放大任务。电路工作时，两只对称的功率开关管每次只有一个导通，所以导通损耗小、效率高。输出既可以向负载灌电流，也可以从负载抽取电流。推拉式输出级既提高电路的负载能力，又提高开关速度。<br> <strong>开漏输出和推挽输出的区别</strong><br> <img src="https://images2.imgbox.com/31/8a/JBQBnR5y_o.png" alt="在这里插入图片描述"><br> 开漏输出：只可以输出强低电平，高电平得靠外部电阻拉高。输出端相当于三极管的集电极。适合于做电流型的驱动，其吸收电流的能力相对强(一般20ma以内)；<br> 推挽输出:可以输出强高、低电平，连接数字器件。<br> 关于推挽输出和开漏输出，最后用一幅最简单的图形来概括：</p> 
<p><img src="https://images2.imgbox.com/84/2d/sf8DXExW_o.png" alt="在这里插入图片描述"><br> 该图中左边的便是推挽输出模式，其中比较器输出高电平时下面的PNP三极管截止，而上面NPN三极管导通，输出电平VS+；当比较器输出低电平时则恰恰相反，PNP三极管导通，输出和地相连，为低电平。右边的则可以理解为开漏输出形式，需要接上拉。</p> 
<h2><a id="3_GPIO_32"></a>3. GPIO八种工作模式</h2> 
<p><img src="https://images2.imgbox.com/73/b0/YrVr0pT3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31__34"></a>3.1 浮空输入模式</h3> 
<p>浮空输入模式：数据通道中仅接入TTL触发器（作用是将相对缓慢变化的模拟信号变成矩形信号）整形，随后输入输入数据寄存器，该种工作模式未接入任何上拉/下拉电阻。 模式特点：在该引脚悬空（无信号输入）的情况下，读取该端口的电平是不确定的。 适用场合：外部按键输入/USART RX引脚。<br> <img src="https://images2.imgbox.com/ce/33/0aWruf0k_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__37"></a>3.2 上拉输入模式</h3> 
<p>上拉输入模式：与浮空输入模式相比，仅仅是在数据通道前端接入了一个上拉电阻，其余无变化。 模式特点：在无信号输入时端口电位受上拉电阻钳制，I/O端口输入电平始终保持为高电平；而当端口输入电平为低电平时，I/O端口输入电平为低电平。 适用场合：需要IO内部上拉电阻输入时，器件的外部中断（IRQ）引脚触发中断条件为下降沿触发/低电平触发，这样在无信号输入时始终保持高电平，如果有事件触发中断IRQ可以输出一个低电平，进而可产生（下降沿/低电平）中断。例如单片无线收发器芯片NRF24L01的IRQ引脚的工作模式即为上拉输入模式。<br> <img src="https://images2.imgbox.com/1d/11/iZZtysW5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__40"></a>3.3 下拉输入模式</h3> 
<p>下拉输入模式：与浮空输入模式相比，仅仅是在数据通道前端接入了一个下拉电阻，其余无变化。 模式特点：在无信号输入时端口电位受下拉电阻钳制，I/O端口输入电平始终保持为低电平；而当端口输入电平为高电平时，I/O端口输入电平为高电平。 适用场合：需要IO内部下拉电阻输入时，器件的外部中断（IRQ）引脚触发中断条件为上升沿触发/高电平触发时，该端口可以选择下拉输入模式。<br> <img src="https://images2.imgbox.com/72/cb/b3x6pgNw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>对于为什么要加上拉或下拉电阻：</strong><br> 1.当作单片机作为输入时，假设我们直接在IO端口接一个按键到地（或电源）。因为按键按与不按管脚都是悬空的。单片机就很难检测按键是否按下。所以人为的接一个上拉（或下拉）。以确定未按下的时候IO输入电平的状态。<br> 2.可以提高芯片的抗干扰能<br> 3.当单片机的IO口作输出时，如果不接上拉电阻只能提供灌电流。无法输出电流驱动外接设备。这时也需要考虑上拉电阻。这样才可以使IO输出高电平</p> 
<h3><a id="34__49"></a>3.4 模拟输入模式</h3> 
<p>模拟输入模式：数据通道不接入任何处理单元（TTL触发器/钳制电阻），直接输入MCU内部的处理单元。模拟输入模式下，I/O端口的模拟信号（电压信号，而非电平信号）直接模拟输入到片上外设模块，比如ADC模块等。模拟信号一般：3.3v 5v 9v。<br> 模式特点：相较于其他输入模式只能读取到逻辑高/低电平（数字量），该模式能读取到细微变化的值（模拟量）。 适用场合：ADC模拟输入/低功耗下省电。<br> <img src="https://images2.imgbox.com/34/d4/nNdaaxtY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35__53"></a>3.5 开漏输出模式</h3> 
<p>开漏输出：适合做电流型的驱动，其吸收电流能力较强。当CPU输出逻辑’0’时，I/O端口输出低电平，而当CPU输出逻辑’1’时，该引脚处于开漏，也就是浮空状态（高阻态），如果想输出高电平则必须接入上拉电阻。同时IO口可以由外部电路改变为低电平或不变，即可读IO输入电平变化，实现了I/O端口的双向功能；此外，可以将多路开漏输出的引脚连接到一条线上，通过一个上拉电阻，在不增加任何器件的情况下，形成“与逻辑”关系，这也是I2C，SMBus，等总线判断总线占用状态的原理。<br> <img src="https://images2.imgbox.com/49/78/e5AOe6Rc_o.png" alt="在这里插入图片描述"><br> 可以输出0和1，适用于电平不匹配场合，要得到高电平需要上拉电阻才行。</p> 
<p>开漏输出模式下（上拉电阻+N-MOS管），通过设置位设置/清除寄存器或者输出数据寄存器的值，途经N-MOS管，最终输出到I/O端口。这里要注意N-MOS管，当设置输出的值为高电平的时候，N-MOS管处于关闭状态，此时I/O端口的电平就不会由输出的高低电平决定，而是由I/O端口外部的上拉或者下拉决定；当设置输出的值为低电平的时候，N-MOS管处于开启状态，此时I/O端口的电平就是低电平。同时，I/O端口的电平也可以通过输入电路进行读取；注意，I/O端口的电平不一定是输出的电平。</p> 
<h3><a id="36__60"></a>3.6 开漏复用输出模式</h3> 
<p>复用开漏输出：与开漏输出特性一致，只不过引脚选择了复用功能，输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。适用场合：常见片内外设（I2C/SMBus等等）<br> <img src="https://images2.imgbox.com/3a/40/RXiYcpkR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="37__63"></a>3.7 推挽输出模式</h3> 
<p>推挽输出：输出具有驱动能力，当CPU输出逻辑’0’时，I/O端口输出低电平，而当CPU输出逻辑’1’时，I/O端口输出高电平，通常作为普通的GPIO用于驱动LED、数码管等电子元器件或输出控制某个信号。<br> <img src="https://images2.imgbox.com/bf/9a/sOOtj8HE_o.png" alt="在这里插入图片描述"><br> 可以输出高低电平0和1，适用于双向IO使用。</p> 
<p>推挽输出模式下（P-MOS管+N-MOS管），通过设置位设置/清除寄存器或者输出数据寄存器的值，途经P-MOS管和N-MOS管，最终输出到I/O端口。这里要注意<strong>P-MOS管和N-MOS管</strong>，当设置输出的值为高电平的时候，P-MOS管处于开启状态，N-MOS管处于关闭状态，此时I/O端口的电平就由P-MOS管决定：高电平；当设置输出的值为低电平的时候，P-MOS管处于关闭状态，N-MOS管处于开启状态，此时I/O端口的电平就由N-MOS管决定：低电平。同时，I/O端口的电平也可以通过输入电路进行读取；注意，此时I/O端口的电平一定是输出的电平。</p> 
<h3><a id="38__70"></a>3.8 推挽复用输出模式</h3> 
<p>复用推挽输出：在STM32中，一个引脚通常可作为普通GPIO来使用，但通常有多个复用模块对应着同一个引脚，那么当这个GPIO作为内置外设引脚时，就叫做复用模式。 适用场合：常见片内外设（USART TX引脚/SPI/PWM输出等等）<br> <img src="https://images2.imgbox.com/18/3c/WhmlziA9_o.png" alt="在这里插入图片描述"><br> 推挽复用输出模式，与推挽输出模式很是类似。只是输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。</p> 
<h2><a id="4_Arduino_75"></a>4. Arduino演示内部上拉功能</h2> 
<p>演示内部上拉功能，不需要单独使用外部的上拉电阻，因为芯片内部集成了上拉电阻，大约20K，只需要通过设置寄存器，即可使用内部的上拉电阻。<br> <strong>普通输入：</strong><br> <img src="https://images2.imgbox.com/74/e1/vzF1YRJ8_o.png" alt="在这里插入图片描述"></p> 
<p><strong>上拉输入：</strong><br> 这两个程序差别仅一个单词，功能却不一样，这就是程序的魅力。<br> <img src="https://images2.imgbox.com/d7/a3/DosdoMn9_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a46d58cbfbb488b49316a96d6546ed9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQLite3介绍及SQL语句详解（SQLite一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fbb8d665eebe892e043cde028f8816f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端八股文(Vue部分) -不断更新</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>