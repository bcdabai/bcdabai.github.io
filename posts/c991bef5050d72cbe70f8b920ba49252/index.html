<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SonarQube最全使用教程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SonarQube最全使用教程" />
<meta property="og:description" content="Sonar简介 Sonar是一个用于代码质量管理的开源平台，用于管理源代码的质量，可以从七个维度检测代码质量
通过插件形式，可以支持包括java,C#,C/C&#43;&#43;,PL/SQL,Cobol,JavaScrip,Groovy等等二十几种编程语言的代码质量管理与检测
糟糕的复杂度分布 文件、类、方法等，如果复杂度过高将难以改变，这会使得开发人员难以理解它们， 且如果没有自动化的单元测试，对于程序中的任何组件的改变都将可能导致需要全面的回归测试
重复 显然程序中包含大量复制粘贴的代码是质量低下的 ， sonar可以展示源码中重复严重的地方
缺乏单元测试 sonar可以很方便地统计并展示单元测试覆盖率
没有代码标准 sonar可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具规范代码编写
没有足够的或者过多的注释 没有注释将使代码可读性变差，特别是当不可避免地出现人员变动时，程序的可读性将大幅下降，而过多的注释又会使得开发人员将精力过多地花费在阅读注释上，亦违背初衷
潜在的bug sonar可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具检测出潜在的bug
糟糕的设计（原文Spaghetti Design，意大利面式设计） 通过sonar可以找出循环，展示包与包、类与类之间的相互依赖关系，可以检测自定义的架构规则；
通过sonar可以管理第三方的jar包可以利用LCOM4检测单个任务规则的应用情况 ，检测耦合
Sonar 组成 Sonar 集成过程 开发人员在他们的ide中使用SonarLint运行分析本地代码。开发人员将他们的代码提交到代码管理平台中（SVN，GIT等）持续集成工具自动触发构建，调用SonarScanner对项目代码进行扫描分析分析报告发送到SonarQube Server中进行加工SonarQube Server 加工并且保存分析报告到SonarQube Database中，通过UI显示分析报告 centos安装sonarqube7.7 1、准备 SonarQube版本：sonarqube-7.7.0.zip，官网地址：https://www.sonarqube.org/downloads/
jdk版本：jdk-1.8.0_linux-x64_bin.tar.gz（注：sonarqube从7.9起，不再支持jdk11以下版本）
数据库：mysql5.6-5.7（sonarqube从7.8起，不再支持mysql）（功能验证也可以SonarQube内置的数据库，这样就不需要改数据库配置
2、安装jdk1.8 详见：linux安装jdk8
3、解压SonarQube yum install -y zip unzip // 安装解压工具 unzip /home/data/soft/sonarqube/sonarqube-7.7.zip 4、修改 /home/data/soft/sonarqube/sonarqube-7.7/conf/sonar.properties 文件，更改数据连接配置 sonar.jdbc.url=jdbc:mysql://192.168.1.165:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false sonar.jdbc.username=root sonar.jdbc.password=root 5、创建SonarQube启动用户（SonarQube内置了elasticsearch，elasticsearch不允许使用root用户启动） useradd sonar passwd sonar 7、设置系统参数（elasticsearch启动需要设置一些参数） 详细见：elasticsearch启动常见错误
未设置这些参数在$SONARQUBE_HOME/logs/es.log中出现以下错误：
8、赋予启动用户执行权限 chown -R sonar:sonar /home/data/soft/sonarqube/sonarqube-7.7 9、登陆启动用户，启动程序 su - sonar // 以sonarqube用户登陆 cd /usr/local/sonarqube-7." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c991bef5050d72cbe70f8b920ba49252/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-13T10:12:40+08:00" />
<meta property="article:modified_time" content="2022-07-13T10:12:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SonarQube最全使用教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Sonar_1"></a>Sonar简介</h3> 
<p>Sonar是一个用于代码质量管理的开源平台，用于管理源代码的质量，可以从七个维度检测代码质量<br> 通过插件形式，可以支持包括java,C#,C/C++,PL/SQL,Cobol,JavaScrip,Groovy等等二十几种编程语言的代码质量管理与检测</p> 
<ol><li> <h6><a id="_6"></a>糟糕的复杂度分布</h6> <p>文件、类、方法等，如果复杂度过高将难以改变，这会使得开发人员难以理解它们， 且如果没有自动化的单元测试，对于程序中的任何组件的改变都将可能导致需要全面的回归测试<br> <img src="https://images2.imgbox.com/64/6c/7pmdLHpG_o.png" alt="img"></p> </li><li> <h6><a id="_11"></a>重复</h6> <p>显然程序中包含大量复制粘贴的代码是质量低下的 ， sonar可以展示源码中重复严重的地方<br> <img src="https://images2.imgbox.com/da/5d/ptKllW92_o.png" alt="img"></p> </li><li> <h6><a id="_16"></a>缺乏单元测试</h6> <p>sonar可以很方便地统计并展示单元测试覆盖率<br> <img src="https://images2.imgbox.com/d6/63/ldz5dBFO_o.png" alt="img"></p> </li><li> <h6><a id="_21"></a>没有代码标准</h6> <p>sonar可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具规范代码编写</p> </li><li> <h6><a id="_25"></a>没有足够的或者过多的注释</h6> <p>没有注释将使代码可读性变差，特别是当不可避免地出现人员变动时，程序的可读性将大幅下降，而过多的注释又会使得开发人员将精力过多地花费在阅读注释上，亦违背初衷</p> </li><li> <h6><a id="bug_29"></a>潜在的bug</h6> <p>sonar可以通过PMD,CheckStyle,Findbugs等等代码规则检测工具检测出潜在的bug<br> <img src="https://images2.imgbox.com/45/8f/6TwJd8Dm_o.png" alt="img"></p> </li><li> <h6><a id="Spaghetti_Design_34"></a>糟糕的设计（原文Spaghetti Design，意大利面式设计）</h6> <p>通过sonar可以找出循环，展示包与包、类与类之间的相互依赖关系，可以检测自定义的架构规则；<br> 通过sonar可以管理第三方的jar包可以利用LCOM4检测单个任务规则的应用情况 ，检测耦合</p> </li></ol> 
<h4><a id="Sonar__39"></a>Sonar 组成</h4> 
<p><img src="https://images2.imgbox.com/90/4c/arVtnpkE_o.png" alt="img"></p> 
<h4><a id="Sonar__43"></a>Sonar 集成过程</h4> 
<p><img src="https://images2.imgbox.com/f4/59/40uCesGz_o.png" alt="img"></p> 
<ol><li>开发人员在他们的ide中使用SonarLint运行分析本地代码。</li><li>开发人员将他们的代码提交到代码管理平台中（SVN，GIT等）</li><li>持续集成工具自动触发构建，调用SonarScanner对项目代码进行扫描分析</li><li>分析报告发送到SonarQube Server中进行加工</li><li>SonarQube Server 加工并且保存分析报告到SonarQube Database中，通过UI显示分析报告</li></ol> 
<h3><a id="centossonarqube77_53"></a>centos安装sonarqube7.7</h3> 
<h6><a id="1_55"></a>1、准备</h6> 
<p>SonarQube版本：sonarqube-7.7.0.zip，官网地址：https://www.sonarqube.org/downloads/</p> 
<p>jdk版本：jdk-1.8.0_linux-x64_bin.tar.gz（注：sonarqube从7.9起，不再支持jdk11以下版本）</p> 
<p>数据库：mysql5.6-5.7（sonarqube从7.8起，不再支持mysql）（功能验证也可以SonarQube内置的数据库，这样就不需要改数据库配置</p> 
<h6><a id="2jdk18_63"></a>2、安装jdk1.8</h6> 
<p>详见：<a href="https://blog.csdn.net/pdsu161530247/article/details/81582980?spm=1001.2101.3001.6650.15&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-15-81582980-blog-104167985.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-15-81582980-blog-104167985.pc_relevant_default&amp;utm_relevant_index=22">linux安装jdk8</a></p> 
<h6><a id="3SonarQube_67"></a>3、解压SonarQube</h6> 
<pre><code>yum install -y zip unzip                    // 安装解压工具
unzip /home/data/soft/sonarqube/sonarqube-7.7.zip
</code></pre> 
<h6><a id="4_homedatasoftsonarqubesonarqube77confsonarproperties__74"></a>4、修改 /home/data/soft/sonarqube/sonarqube-7.7/conf/sonar.properties 文件，更改数据连接配置</h6> 
<pre><code>sonar.jdbc.url=jdbc:mysql://192.168.1.165:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false
sonar.jdbc.username=root
sonar.jdbc.password=root
</code></pre> 
<h6><a id="5SonarQubeSonarQubeelasticsearchelasticsearchroot_82"></a>5、创建SonarQube启动用户（SonarQube内置了elasticsearch，elasticsearch不允许使用root用户启动）</h6> 
<pre><code>useradd sonar
passwd sonar
</code></pre> 
<h6><a id="7elasticsearch_89"></a>7、设置系统参数（elasticsearch启动需要设置一些参数）</h6> 
<p>详细见：<a href="https://www.cnblogs.com/zhi-leaf/p/8484337.html" rel="nofollow">elasticsearch启动常见错误</a></p> 
<p>未设置这些参数在$SONARQUBE_HOME/logs/es.log中出现以下错误：</p> 
<h6><a id="8_95"></a>8、赋予启动用户执行权限</h6> 
<pre><code>chown -R sonar:sonar /home/data/soft/sonarqube/sonarqube-7.7
</code></pre> 
<h6><a id="9_101"></a>9、登陆启动用户，启动程序</h6> 
<pre><code>su - sonar                                            // 以sonarqube用户登陆
cd /usr/local/sonarqube-7.9.1/bin/linux-x86-64   // 进入启动命令目录
./sonar.sh start                                  // 启动程序
</code></pre> 
<h6><a id="10http19216812249000adminadmin_109"></a>10、登陆http://192.168.1.224:9000访问，默认用户名/密码为：admin/admin</h6> 
<h6><a id="11_111"></a>11、安装中文语言包</h6> 
<p>登录后, 打开 <code>Administration → Marketplace</code>, 搜索 <code>chinese pack</code>, 点击 <code>install</code></p> 
<p><img src="https://images2.imgbox.com/ac/ea/eHfk1uda_o.png" alt="img"></p> 
<p>会提示重启系统, 选择 <code>Restart</code></p> 
<p>注：如何 Intall 出错可以直接去官网下载jar包。上传到到服务器 /home/data/soft/sonarqube/sonarqube-7.7/extensions/downloads 目录下，并重启sonarqube服务即可。</p> 
<h6><a id="12_121"></a>12、常用命令：</h6> 
<pre><code>service sonar start     // 启动服务
service sonar stop      // 关闭服务
service sonar restart   // 重启服务

chkconfig sonar on      // 设置开机启动
chkconfig sonar off     // 关闭开机启动
</code></pre> 
<h3><a id="Jenkinssonarjava_132"></a>Jenkins中使用sonar扫描java项目</h3> 
<h4><a id="sonar_134"></a>安装sonar插件</h4> 
<p><img src="https://images2.imgbox.com/19/36/9vIDskNz_o.png" alt="img"><br> 由于安装插件需要翻墙，有可能无法安装成功，这里提供插件sonar.hpi，选择离线上传同样可以安装。<br> sonar.hpi：链接: https://pan.baidu.com/s/11L_uon8gakmZHoc_xTI1gQ 提取码: g9pw</p> 
<p><img src="https://images2.imgbox.com/c5/04/OtfJYu7J_o.png" alt="img"></p> 
<h4><a id="sonar_142"></a>sonar插件配置</h4> 
<h6><a id="_144"></a>系统设置</h6> 
<p><img src="https://images2.imgbox.com/92/31/ffEhirwP_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_148"></a>全局配置</h6> 
<p><img src="https://images2.imgbox.com/8b/43/l4dcmUVl_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="Excute_Sonarqube_Scanner_151"></a>在原项目上增加Excute Sonarqube Scanner</h6> 
<h6><a id="Scanner_Analysis_properties_155"></a>Scanner Analysis properties</h6> 
<pre><code>sonar.projectKey=$JOB_NAME
sonar.projectName=$JOB_NAME
sonar.projectVersion=1.0
sonar.sourceEncoding=UTF-8
sonar.language=java
sonar.login=admin
sonar.password=admin
sonar.java.binaries=$WORKSPACE/iot-network/iot-netty-route/target/classes/ 
</code></pre> 
<h6><a id="_168"></a>构建成功</h6> 
<p><img src="https://images2.imgbox.com/99/2d/T1Oo9UWL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="IDEAsonarlintSonarQube_171"></a>IDEA中使用插件sonarlint连接到SonarQube对代码质量进行管控</h3> 
<h6><a id="sonarLint_173"></a>sonarLint插件安装</h6> 
<p>File–Setting-Plugin 输入SonarLint搜索插件<br> <img src="https://images2.imgbox.com/71/0f/WHrm3zIu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_181"></a>配置插件</h3> 
<h6><a id="1Token_183"></a>1、配置Token</h6> 
<p>打开本地SonarQube管理后台，输入账户密码，默认admin/admin</p> 
<p><img src="https://images2.imgbox.com/73/f7/B9dM25V1_o.png" alt="img"></p> 
<p>创建项目</p> 
<p><img src="https://images2.imgbox.com/75/c0/CsO4bJAS_o.png" alt="img"></p> 
<p>在上面画圈的任意一处，点击新建项目</p> 
<p><img src="https://images2.imgbox.com/22/71/SDNNGlZn_o.png" alt="img"></p> 
<p>创建令牌</p> 
<p><img src="https://images2.imgbox.com/f7/f5/88kOWZmh_o.png" alt="img"></p> 
<p>获得令牌</p> 
<p><img src="https://images2.imgbox.com/37/62/oEi1KpJ0_o.png" alt="img"></p> 
<p>分析你的项目–选择Maven<br> <img src="https://images2.imgbox.com/67/e9/eh9DoRq0_o.png" alt="在这里插入图片描述"></p> 
<p>插件安装成功以后，打开插件配置界面，路径：File–Tools<br> <img src="https://images2.imgbox.com/26/ef/Zyc0bYXc_o.png" alt="在这里插入图片描述"></p> 
<p>打开SonarLint General Settings，按照下图输入</p> 
<p><img src="https://images2.imgbox.com/c5/0d/sTeJM57C_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-HK0kBZ3E-1657630295323)(/Users/tong/Library/Application Support/typora-user-images/image-20220712141119954.png)]"></p> 
<p>把上一步的token输入（写博客截图，忘记保存了token，下面是错误的）</p> 
<p><img src="https://images2.imgbox.com/1e/c2/Xt4g3Snh_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/65/b2/zZwhB9PQ_o.png" alt="img"></p> 
<h4><a id="2_252"></a>2、绑定到当前项目</h4> 
<p>打开SonarLint Project Settings</p> 
<p><img src="https://images2.imgbox.com/65/f0/2RHXxj55_o.png" alt="在这里插入图片描述"></p> 
<p>connection选择刚刚的配置“sonarqube”，选择我们刚刚创建的项目</p> 
<p><img src="https://images2.imgbox.com/a1/5f/9ojMMsNU_o.png" alt="img"></p> 
<p>项目全局分析</p> 
<p>Terminal中执行</p> 
<pre><code>mvn sonar:sonar \
  -Dsonar.projectKey=test-project \
  -Dsonar.host.url=http://192.168.1.224:9000 \
  -Dsonar.login=78e2f0ea396d9cd941d77a3f14429a566c951a34
</code></pre> 
<p><img src="https://images2.imgbox.com/c4/cf/jIcwCO2D_o.png" alt="在这里插入图片描述"></p> 
<p>登录SonarQube管理后台 http://192.168.1.224:9000后台效果，查看质检效果</p> 
<p><img src="https://images2.imgbox.com/9a/d7/Ro0yF6yQ_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-lVZ17ZL4-1657630295324)(/Users/tong/Library/Application Support/typora-user-images/image-20220712143032136.png)]"></p> 
<p>参考文献：<a href="http://static.kancloud.cn/guanfuchang/sonar/908140" rel="nofollow">SonarQube的使用入门</a></p> 
<p>​ <a href="https://developer.aliyun.com/article/925831" rel="nofollow">SonarQube使用介绍</a></p> 
<p>​ <a href="https://cloud.tencent.com/developer/article/1600167" rel="nofollow">CentOS安装SonarQube</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22b93fd580a00c700ed9cdf723cdd36c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Vue】基本结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5ce1c70643d5d6d385ead14cf8e33e3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">01-初识Vue</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>