<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ESP8266-WIFI模块使用AT指令连接外网服务器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ESP8266-WIFI模块使用AT指令连接外网服务器" />
<meta property="og:description" content="ESP8266-WIFI模块使用AT指令连接外网服务器 第一步用java代码写一个服务器,代码如下:
代码解释:我是用nio写了一个,异步通信,用到了线程池,比较简单.当wifi模块连接后,会自动创建一个文件,用来保存 wifi模块发来的数据,这里大家可以脑洞大开实现别的功能了…
public class NIOEchoServer { public static void main(String[] args) throws Exception { new EchoServerHandle() ; } } /** * 实现一个专门用于客户端请求处理的线程对象 */ class SocketClientChannelThread implements Runnable { private SocketChannel clientChannel ; // 客户端的信息 private boolean flag = true ; // 循环处理的标记 public SocketClientChannelThread(SocketChannel clientChannel) { this.clientChannel = clientChannel ; System.out.println(&#34;服务器端连接成功，可以与服务器端进行数据的交互操作...&#34;); } @Override public void run() { // 真正的通讯处理的核心需要通过run()方法来进行操作 createFile(null); //创建文件 // NIO是基于Buffer缓冲操作实现的功能，需要将输入的内容保存在缓存之中 ByteBuffer buffer = ByteBuffer.allocate(50) ; // 开辟一个50大小的缓存空间 try { while(this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f10d7dbb1804ded7080aeedfe3010d0a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-02T00:02:10+08:00" />
<meta property="article:modified_time" content="2019-05-02T00:02:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ESP8266-WIFI模块使用AT指令连接外网服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ESP8266WIFIAT_0"></a>ESP8266-WIFI模块使用AT指令连接外网服务器</h2> 
<p><strong>第一步用java代码写一个服务器,代码如下:</strong></p> 
<blockquote> 
 <p>代码解释:我是用nio写了一个,异步通信,用到了线程池,比较简单.当wifi模块连接后,会自动创建一个文件,用来保存 wifi模块发来的数据,这里大家可以脑洞大开实现别的功能了…</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOEchoServer</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">new</span> <span class="token class-name">EchoServerHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 实现一个专门用于客户端请求处理的线程对象
 */</span>
<span class="token keyword">class</span> <span class="token class-name">SocketClientChannelThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token class-name">SocketChannel</span> clientChannel <span class="token punctuation">;</span> <span class="token comment">// 客户端的信息</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">;</span> <span class="token comment">// 循环处理的标记</span>
	<span class="token keyword">public</span> <span class="token class-name">SocketClientChannelThread</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> clientChannel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel <span class="token operator">=</span> clientChannel <span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器端连接成功，可以与服务器端进行数据的交互操作..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 真正的通讯处理的核心需要通过run()方法来进行操作</span>
		<span class="token function">createFile</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建文件</span>
		<span class="token comment">// NIO是基于Buffer缓冲操作实现的功能，需要将输入的内容保存在缓存之中</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 开辟一个50大小的缓存空间</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 清空缓存操作，可以进行该缓存空间的重复使用</span>
				<span class="token keyword">int</span> readCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 服务器端读取客户端发送来的内容</span>
				<span class="token comment">// 将缓冲区之中保存的内容转位字节数组之后进行存储</span>
				<span class="token class-name">String</span> readMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>readCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
				<span class="token comment">//接收数据==========================</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"【服务器端接收消息】"</span> <span class="token operator">+</span> readMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出一下提示信息</span>
				<span class="token function">createFile</span><span class="token punctuation">(</span>readMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 在进行整个的通讯过程里面，分隔符是一个绝对重要的概念，如果不能够很好的处理分隔符，那么无法进行有效通讯</span>
				<span class="token class-name">String</span> writeMessage <span class="token operator">=</span> <span class="token string">"[ECHO]"</span> <span class="token operator">+</span> readMessage <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span> <span class="token comment">// 进行消息的回应处理</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"exit"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>readMessage<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					writeMessage <span class="token operator">=</span> <span class="token string">"[ECHO]"</span>  <span class="token punctuation">;</span> <span class="token comment">// 结束消息</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">;</span> <span class="token comment">// 要结束当前的循环操作</span>
				<span class="token punctuation">}</span>  
				<span class="token comment">// 现在的数据是在字符串之中，如果要回应内容，需要将内容保存在Buffer之中</span>
				buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 将已经保存的内容（内容已经处理完毕）清除</span>
				buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>writeMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 保存回应信息</span>
				buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 重置缓冲区</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> txt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> path<span class="token operator">=</span> <span class="token string">"/usr/Project/log/wifi.txt"</span><span class="token punctuation">;</span><span class="token comment">//这里是创建文件位置 自行修改</span>
		<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				file<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"创建文件成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>txt <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> txt <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token punctuation">;</span><span class="token punctuation">}</span>
		<span class="token class-name">FileWriter</span> fw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			fw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>txt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"写入文件成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>fw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					fw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					fw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">EchoServerHandle</span> <span class="token keyword">implements</span> <span class="token class-name">AutoCloseable</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">// 定义服务器端的服务处理类</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PORT <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span> <span class="token comment">//端口号</span>
	<span class="token keyword">private</span> <span class="token class-name">ExecutorService</span> executorService <span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token punctuation">;</span> <span class="token comment">// 服务器端的通讯通道</span>
	<span class="token keyword">private</span> <span class="token class-name">Selector</span> selector <span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">SocketChannel</span> clientChannel <span class="token punctuation">;</span> <span class="token comment">// 客户端的信息</span>
	<span class="token keyword">public</span> <span class="token class-name">EchoServerHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>  <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 当前的执行线程只允许有5个</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 打开服务器端连接通道</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 设置为非阻塞模式</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
		<span class="token comment">// NIO之中的Reactor模型重点在于所有的Channel需要向Selector之中进行注册</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 获取Selector实例</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">,</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 服务器端需要进行接收</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器端程序启动，该程序在"</span> <span class="token operator">+</span> PORT <span class="token operator">+</span> <span class="token string">"端口上进行监听..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clientHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clientHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> keySelect <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>     <span class="token comment">// 保存一个当前的状态</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>keySelect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 需要进行连接等待</span>
			<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 获取全部连接通道信息</span>
			<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionIter <span class="token operator">=</span> selectedKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span>selectionIter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> selectionIter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 获取每一个通道</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 该通道为接收状态</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 等待连接</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 当前有连接</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SocketClientChannelThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clientChannel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				selectionIter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移除掉此通道</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭线程池</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭服务器端</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p><a href="https://gitee.com/huanglongliufangyan/lot-service.git" rel="nofollow">服务器完整代码上传码云了,点击</a><br> 代码写完后打成jar包上传到服务器上-- 然后运行 命令 java-jar wifi.jar</p> 
<p><img src="https://images2.imgbox.com/f8/30/Rb41oaO2_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>第二步开始连接服务器</strong></p> 
</blockquote> 
<p><strong><strong><strong>连接命令如下:</strong></strong></strong><br> <strong>1，AT+GMR</strong> 　//启动查询版本信息<br> AT version:1.1.0.0(May 11 2016 18:09:56)<br> SDK version:1.5.4(baaeaebb)<br> compile time:May 20 2016 15:08:19<br> OK</p> 
<p><strong>2，AT+CWMODE_DEF=1</strong> 　　//配置WiFi模组工作模式为单STA模式，并把配置保存在flash<br> OK<br> <strong>3，AT+CWJAP_DEF=“huanglong123”,“anxsdfinsdke123” //连接网络</strong><br> WIFI CONNECTED<br> WIFI GOT IP<br> OK<br> <strong>4，AT+CWAUTOCONN=1 　　　//使能上电自动连接AP</strong><br> OK<br> <strong>5，AT+CIPSTART=“TCP”,“129.231.40.13”,80 //连接服务器</strong><br> <img src="https://images2.imgbox.com/72/1e/Yv7MxIAC_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>连接成功后会创建一个文件,用来保存接收到的数据<br> <strong>这里有个坑,之前外网服务器端口换成了其他端口8099什么的,一直连不上,坑了我两天,还以为wifi模块有问题,后来把端口换成80就能连上了,</strong><br> CONNECT<br> OK<br> <strong>6，AT+CIPMODE=1</strong> 　　　　　　　　　　　　　　　//设置透传<br> OK<br> <strong>7，AT+CIPSEND</strong> 　　　　　　　　　　　　　　　　//启动发送<br> OK<br> **8，&gt; hello //发送数据<br> <strong>10, +++</strong> 　　　　　　　　　　　　　　　　　　　　!!退出透传,不要勾选新行（\r\n）</p> 
</blockquote> 
<p><strong>3 . 51单片机代码</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;reg52.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrins.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;led.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;wd.h&gt;</span></span>
<span class="token comment">/*************
-------黄龙原创-------
**************/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> receive<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">//用于接收wifi模块反馈到MCU上的数据</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> datas<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> openStatu <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> flag <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
sbit kg <span class="token operator">=</span> P2 <span class="token operator">^</span> <span class="token number">7</span><span class="token punctuation">;</span>
sbit k2 <span class="token operator">=</span> P3 <span class="token operator">^</span> <span class="token number">7</span><span class="token punctuation">;</span>	 <span class="token comment">//按键</span>

 <span class="token comment">//如果收到心跳 重新计时</span>
<span class="token keyword">void</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	flag <span class="token operator">++</span><span class="token punctuation">;</span>
	flag <span class="token operator">++</span><span class="token punctuation">;</span>
	flag <span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">InitUART</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    TMOD <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
    SCON <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>
    TH1 <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token punctuation">;</span>
    TL1 <span class="token operator">=</span> TH1<span class="token punctuation">;</span>
    PCON <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">LED_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	kg <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SendOneBytes</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ES <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	  <span class="token comment">//关闭串口中断</span>
    TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	   <span class="token comment">//清发送完毕中断请求标志位</span>
    SBUF <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>TI<span class="token punctuation">)</span><span class="token punctuation">;</span>	 <span class="token comment">//等待发送完毕</span>
    TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//清发送完毕中断请求标志位</span>
    ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>	   <span class="token comment">//允许串口中断</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>puf<span class="token punctuation">)</span> <span class="token comment">// 数组指针*puf指向字符串数组</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>puf <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">SendOneBytes</span><span class="token punctuation">(</span><span class="token operator">*</span>puf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        puf<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**初始化**/</span>
<span class="token keyword">void</span> <span class="token function">ESP8266_Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//说明 0000是wifi客户端编号 1:是wifi唯一id</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> info<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"[:0000:w-10000:]\r\n"</span><span class="token punctuation">;</span>  <span class="token comment">//客户端编号</span>
    <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"AT+CIPSTART=\"TCP\",\"47.96.183.158\",2999\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//连接服务器</span>
    <span class="token function">LED_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token function">LED_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token function">LED_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"AT+CIPMODE=1\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 开启透传模式</span>
    <span class="token function">LED_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"AT+CIPSEND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//开启透传</span>
    <span class="token function">LED_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>	  <span class="token comment">//向服务器发送数据</span>
<span class="token punctuation">}</span>
<span class="token comment">//重试机制</span>
<span class="token keyword">void</span> <span class="token function">delay70ms</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">//误差 -0.000000000016us</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token comment">//LED_8();</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
   		<span class="token comment">//30秒flag 减一</span>
   		<span class="token function">delay_led</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay_led</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay_led</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		flag <span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token function">LED_7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 		<span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//	ESP8266_Sets("AT+CWJAP_DEF=\"ChinaNet-huanglong\",\"1528177109huanglong\"\r\n");	//连接路由器</span>
			<span class="token function">delay_led</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ESP8266_Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如果一分半还没有收到服务器心跳 重新连接服务器</span>
			<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//按钮</span>
<span class="token keyword">void</span> <span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	 <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>k2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>	
            <span class="token function">ESP8266_Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化wifi模块</span>
		<span class="token comment">//	delay70ms();</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">InitUART</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token function">delay_led</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token function">ESP8266_Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化wifi模块</span>
	  <span class="token function">delay70ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//监听心跳</span>
    <span class="token comment">//button();</span>
    <span class="token comment">// lcd_init();//初始化液晶屏</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">UARTInterrupt</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>RI<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">unsigned</span> <span class="token keyword">char</span> res<span class="token punctuation">;</span>
        res <span class="token operator">=</span> SBUF<span class="token punctuation">;</span> <span class="token comment">//取出接受到的数据</span>
        RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//清除接受中断标志位</span>
        receive<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token comment">//ESP8266_Sets(receive);</span>
		<span class="token comment">//打开 低电平触发</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'S'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'T'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'A'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'R'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'T'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>openStatu <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>	
	            kg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//打开开关			</span>
				<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				kg <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>	
				<span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"[:3333:w-10000:a-10001:open:]\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				openStatu <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//设置打开状态</span>
				<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"[:3333:w-10000:a-10001:isOpen:]\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>   
        <span class="token punctuation">}</span>
		<span class="token comment">//关闭</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'L'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'O'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'S'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'E'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
           	<span class="token keyword">if</span><span class="token punctuation">(</span>openStatu <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
	            kg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
				<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">LED_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				kg <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"[:3333:w-10000:a-10001:close:]\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				openStatu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"[:3333:w-10000:a-10001:isClose:]\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		
        <span class="token punctuation">}</span>
		<span class="token comment">//复位</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'R'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'E'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'S'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'E'</span> <span class="token operator">&amp;&amp;</span> receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'T'</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			 openStatu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			 <span class="token function">ESP8266_Sets</span><span class="token punctuation">(</span><span class="token string">"[:3333:w-10000:a-10001:reset_ok:]\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
       
		<span class="token keyword">if</span><span class="token punctuation">(</span>receive<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'P'</span><span class="token punctuation">)</span> <span class="token comment">//接收心跳</span>
        <span class="token punctuation">{<!-- --></span>
			<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//改变标识状态</span>
		<span class="token comment">//	LED_0();</span>
		<span class="token comment">//	delay70ms();</span>
        <span class="token punctuation">}</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>receive<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>	  <span class="token comment">//如果接收完数据 清空数组</span>
		<span class="token punctuation">{<!-- --></span>						
			<span class="token keyword">int</span> j<span class="token punctuation">;</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>receive<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				receive<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token comment">//	i = 0;	</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>测试视频<br> <img src="https://images2.imgbox.com/4a/e5/oqRUgKTl_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/d7/OMAXpVFx_o.jpg" alt="在这里插入图片描述"><br> <a href="https://mfk.hllfy.top" rel="nofollow">推荐自己的资料库: https://mfk.hllfy.top</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0dfe0b2488743a639050cce6f829c610/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java实现操作系统的进程调度-- 抢占式优先权调度算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3853aef44a6b0637415de7564eb7404c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spreadjs9怎样下拉帮助和悬浮提示一起显示？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>