<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SSM对接Excel文件批量导入数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SSM对接Excel文件批量导入数据" />
<meta property="og:description" content="这里使用ajaxfileupload.js 比较方便点 &lt;script src=&#34;/static/Jquery/ajaxfileupload.js&#34;&gt;&lt;/script&gt; ajaxfileupload.js 文件源码 jQuery.extend({ createUploadIframe: function(id, uri) { //create frame var frameId = &#39;jUploadFrame&#39; &#43; id; var iframeHtml = &#39;&lt;iframe id=&#34;&#39; &#43; frameId &#43; &#39;&#34; name=&#34;&#39; &#43; frameId &#43; &#39;&#34; style=&#34;position:absolute; top:-9999px; left:-9999px&#34;&#39;; if(window.ActiveXObject) { if(typeof uri== &#39;boolean&#39;){ iframeHtml &#43;= &#39; src=&#34;&#39; &#43; &#39;javascript:false&#39; &#43; &#39;&#34;&#39;; } else if(typeof uri== &#39;string&#39;){ iframeHtml &#43;= &#39; src=&#34;&#39; &#43; uri &#43; &#39;&#34;&#39;; }	} iframeHtml &#43;= &#39; /&gt;&#39;; jQuery(iframeHtml).appendTo(document.body); return jQuery(&#39;#&#39; &#43; frameId)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/36b888abdb48c164fc21da0c5b05fbee/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-15T21:45:21+08:00" />
<meta property="article:modified_time" content="2019-04-15T21:45:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SSM对接Excel文件批量导入数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3> 这里使用ajaxfileupload.js 比较方便点</h3> 
<pre class="has"><code>&lt;script src="/static/Jquery/ajaxfileupload.js"&gt;&lt;/script&gt;</code></pre> 
<h3> ajaxfileupload.js  文件源码</h3> 
<pre class="has"><code class="language-javascript">
jQuery.extend({
	

    createUploadIframe: function(id, uri)
	{
			//create frame
            var frameId = 'jUploadFrame' + id;
            var iframeHtml = '&lt;iframe id="' + frameId + '" name="' + frameId + '" style="position:absolute; top:-9999px; left:-9999px"';
			if(window.ActiveXObject)
			{
                if(typeof uri== 'boolean'){
					iframeHtml += ' src="' + 'javascript:false' + '"';

                }
                else if(typeof uri== 'string'){
					iframeHtml += ' src="' + uri + '"';

                }	
			}
			iframeHtml += ' /&gt;';
			jQuery(iframeHtml).appendTo(document.body);

            return jQuery('#' + frameId).get(0);			
    },
    createUploadForm: function(id, fileElementId, data)
	{
		//create form	
		var formId = 'jUploadForm' + id;
		var fileId = 'jUploadFile' + id;
		var form = jQuery('&lt;form  action="" method="POST" name="' + formId + '" id="' + formId + '" enctype="multipart/form-data"&gt;&lt;/form&gt;');	
		if(data)
		{
			for(var i in data)
			{
				jQuery('&lt;input type="hidden" name="' + i + '" value="' + data[i] + '" /&gt;').appendTo(form);
			}			
		}		
		var oldElement = jQuery('#' + fileElementId);
		var newElement = jQuery(oldElement).clone();
		jQuery(oldElement).attr('id', fileId);
		jQuery(oldElement).before(newElement);
		jQuery(oldElement).appendTo(form);


		
		//set attributes
		jQuery(form).css('position', 'absolute');
		jQuery(form).css('top', '-1200px');
		jQuery(form).css('left', '-1200px');
		jQuery(form).appendTo('body');		
		return form;
    },

    ajaxFileUpload: function(s) {
        // TODO introduce global settings, allowing the client to modify them for all requests, not only timeout		
        s = jQuery.extend({}, jQuery.ajaxSettings, s);
        var id = new Date().getTime()        
		var form = jQuery.createUploadForm(id, s.fileElementId, (typeof(s.data)=='undefined'?false:s.data));
		var io = jQuery.createUploadIframe(id, s.secureuri);
		var frameId = 'jUploadFrame' + id;
		var formId = 'jUploadForm' + id;		
        // Watch for a new set of requests
        if ( s.global &amp;&amp; ! jQuery.active++ )
		{
			jQuery.event.trigger( "ajaxStart" );
		}            
        var requestDone = false;
        // Create the request object
        var xml = {}   
        if ( s.global )
            jQuery.event.trigger("ajaxSend", [xml, s]);
        // Wait for a response to come back
        var uploadCallback = function(isTimeout)
		{			
			var io = document.getElementById(frameId);
            try 
			{				
				if(io.contentWindow)
				{
					 xml.responseText = io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;
                	 xml.responseXML = io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;
					 
				}else if(io.contentDocument)
				{
					 xml.responseText = io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;
                	xml.responseXML = io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;
				}						
            }catch(e)
			{
				jQuery.handleError(s, xml, null, e);
			}
            if ( xml || isTimeout == "timeout") 
			{				
                requestDone = true;
                var status;
                try {
                    status = isTimeout != "timeout" ? "success" : "error";
                    // Make sure that the request was successful or notmodified
                    if ( status != "error" )
					{
                        // process the data (runs the xml through httpData regardless of callback)
                        var data = jQuery.uploadHttpData( xml, s.dataType );    
                        // If a local callback was specified, fire it and pass it the data
                        if ( s.success )
                            s.success( data, status );
    
                        // Fire the global callback
                        if( s.global )
                            jQuery.event.trigger( "ajaxSuccess", [xml, s] );
                    } else
                        jQuery.handleError(s, xml, status);
                } catch(e) 
				{
                    status = "error";
                    jQuery.handleError(s, xml, status, e);
                }

                // The request was completed
                if( s.global )
                    jQuery.event.trigger( "ajaxComplete", [xml, s] );

                // Handle the global AJAX counter
                if ( s.global &amp;&amp; ! --jQuery.active )
                    jQuery.event.trigger( "ajaxStop" );

                // Process result
                if ( s.complete )
                    s.complete(xml, status);

                jQuery(io).unbind()

                setTimeout(function()
									{	try 
										{
											jQuery(io).remove();
											jQuery(form).remove();	
											
										} catch(e) 
										{
											jQuery.handleError(s, xml, null, e);
										}									

									}, 100)

                xml = null

            }
        }
        // Timeout checker
        if ( s.timeout &gt; 0 ) 
		{
            setTimeout(function(){
                // Check to see if the request is still happening
                if( !requestDone ) uploadCallback( "timeout" );
            }, s.timeout);
        }
        try 
		{

			var form = jQuery('#' + formId);
			jQuery(form).attr('action', s.url);
			jQuery(form).attr('method', 'POST');
			jQuery(form).attr('target', frameId);
            if(form.encoding)
			{
				jQuery(form).attr('encoding', 'multipart/form-data');      			
            }
            else
			{	
				jQuery(form).attr('enctype', 'multipart/form-data');			
            }			
            jQuery(form).submit();

        } catch(e) 
		{			
            jQuery.handleError(s, xml, null, e);
        }
		
		jQuery('#' + frameId).load(uploadCallback	);
        return {abort: function () {}};	

    },

    uploadHttpData: function( r, type ) {
        var data = !type;
        data = type == "xml" || data ? r.responseXML : r.responseText;
        // If the type is "script", eval it in global context
        if ( type == "script" )
            jQuery.globalEval( data );
        // Get the JavaScript object, if JSON is used.
        if ( type == "json" )
            eval( "data = " + data );
        // evaluate scripts within html
        if ( type == "html" )
            jQuery("&lt;div&gt;").html(data).evalScripts();

        return data;
    }
})

</code></pre> 
<h3> HTML：</h3> 
<pre class="has"><code class="language-html">            &lt;div&gt;
                &lt;input id="upfile" type="file" name="upfile" accept=".xls,.xlsx"/&gt;
                &lt;button id="btn_Muti_add" class="btn btn-default" type="button" aria-hidden="true"&gt;
                    &lt;span aria-hidden="true"&gt;&lt;/span&gt;批量提交
                &lt;/button&gt;
            &lt;/div&gt;</code></pre> 
<pre class="has"><code class="language-javascript">&lt;script type="text/javascript"&gt;
    window.onload = function (ev) {
        $("#upfile").css("display","initial");  //文件上传之后，清除文件名显示
    }
    $("#btn_Muti_add").click(function () {
        if (checkData()) {
            $.ajaxFileUpload({
                url: "/user/uploadExcelWrite",
                type: "POST",
                fileElementId: "upfile",
                dataType: "text",
                success: function (dataJson) {
                    alert(dataJson);
                    $("#upfile").val("");
                },
                error: function (dataJson) {
                    alert("导入异常！");
                    $("#upfile").val("");
                }
            });
        }
    });

    function checkData() {
        var fileDir = $("#upfile").val();
        var suffix = fileDir.substr(fileDir.lastIndexOf("."));
        if ("" == fileDir) {
            alert("选择需要导入的Excel文件！");
            return false;
        }
        if (".xls" != suffix &amp;&amp; ".xlsx" != suffix) {
            alert("选择Excel格式的文件导入！");
            return false;
        }
        return true;
    }
&lt;/script&gt;</code></pre> 
<h2> </h2> 
<h3>依赖文件:</h3> 
<pre class="has"><code>      &lt;dependency&gt;
          &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
          &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
          &lt;version&gt;3.9&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
          &lt;artifactId&gt;poi&lt;/artifactId&gt;
          &lt;version&gt;3.9&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
          &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;
          &lt;version&gt;3.9&lt;/version&gt;
      &lt;/dependency&gt;</code></pre> 
<h3>SpringMVC:</h3> 
<pre class="has"><code>    @RequestMapping(value = "uploadExcelWrite" , method = RequestMethod.POST)
    @ResponseBody
    public String uploadExcelWrite(@RequestParam("upfile") MultipartFile file,     
        HttpServletRequest request, HttpServletResponse response) {
        return userService.uploadExcelWrite(request, response);
    }</code></pre> 
<h3>Java处理文件：</h3> 
<pre class="has"><code class="language-java">    @Override
    public String uploadExcelWrite(HttpServletRequest request, HttpServletResponse response) {
        MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;

        MultipartFile file = multipartRequest.getFile("upfile");
        if (file.isEmpty()) {
            try {
                throw new Exception("文件不存在！");
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        InputStream in = null;
        try {
            in = file.getInputStream();
        } catch (IOException e) {
            e.printStackTrace();
        }

        List&lt;List&lt;Object&gt;&gt; listob = null;
        ExcelWrite excelWrite = new ExcelWrite();
        try {
            listob = excelWrite.getBankListByExcel(in, file.getOriginalFilename());
        } catch (Exception e) {
            e.printStackTrace();
        }

        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
        //获取每条数据并处理
        for (int i = 0; i &lt; listob.size(); i++) {
            List&lt;Object&gt; lo = listob.get(i);
            CurriculumWarn vo = new CurriculumWarn();
            vo.setUserId(Integer.valueOf(lo.get(0).toString()));
            vo.setCurriculumId(Integer.valueOf(lo.get(1).toString()));
            vo.setType(Integer.valueOf(lo.get(2).toString()));
            vo.setAchievement(Float.valueOf(lo.get(3).toString()));
            try {
                vo.setCreateTime(format.parse(lo.get(4).toString()));
            } catch (ParseException e) {
                e.printStackTrace();
            }
            //插入数据库
            int a = curriculumWarnMapper.insertSelective(vo);
        }
        return "导入成功！";
    }</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9c95c6c3ab77ce08ddc8bc4cd08c2f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql必知必会笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/630109471789b206de6314915e3bcb9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">windows 2008R2 配置iis 服务器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>