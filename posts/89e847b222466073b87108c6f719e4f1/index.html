<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>3.SpringCloud：Nacos配置中心 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="3.SpringCloud：Nacos配置中心" />
<meta property="og:description" content="Nacos既提供注册中心，也提供配置中心。下面分别以两个例子来说明配置中心的使用。
目录
案例一：配置中心使用
人工在Nacos配置内容
客户端使用
案例二：配置拆分与复用
背景
配置拆分复用说明
对pom.xml增加依赖
删除application.properties，增加bootstrap.properties
启动
调用验证
附1：Nacos config客户端临时暂存目录
附2：Nacos config隔离层次概念
附3：显示写入Nacos config配置中心及监听代码示例
案例一：配置中心使用 人工在Nacos配置内容 在Nacos中人工定义如下
Data ID: firstapp-dev.properties Group : DEFAULT_GROUP 配置格式: Properties 配置内容： weather=sun temperature=20.55 其中Data ID的命令规则为：应用名-环境profile名.文件后缀
应用名（Data ID前缀）：默认为 ${spring.appliction.name}， 也可以使用${spring.cloud.nacos.config.prefix}来配置环境profile名：既${spring.profiles.active}指定的环境。 若不区分环境，则本内容既前面的中划线都可以不用存在。文件后缀：既SpringBoot中配置文件扩展名，也是Nacos中的配置格式。 客户端使用 新建一个project或者module。 在生成的默认pom.xml增加nacos-config和bootstrap依赖。如下
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.7.10&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;firstapp&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;firstapp&lt;/name&gt; &lt;description&gt;firstapp&lt;/description&gt; &lt;properties&gt; &lt;java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/89e847b222466073b87108c6f719e4f1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-23T18:49:48+08:00" />
<meta property="article:modified_time" content="2023-06-23T18:49:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">3.SpringCloud：Nacos配置中心</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Nacos既提供注册中心，也提供配置中心。下面分别以两个例子来说明配置中心的使用。</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E4%BD%BF%E7%94%A8-toc" style="margin-left:0px;"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E4%BD%BF%E7%94%A8" rel="nofollow">案例一：配置中心使用</a></p> 
<p id="%E4%BA%BA%E5%B7%A5%E5%9C%A8Nacos%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9-toc" style="margin-left:80px;"><a href="#%E4%BA%BA%E5%B7%A5%E5%9C%A8Nacos%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9" rel="nofollow">人工在Nacos配置内容</a></p> 
<p id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8-toc" style="margin-left:80px;"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8" rel="nofollow">客户端使用</a></p> 
<p id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E4%B8%8E%E5%A4%8D%E7%94%A8-toc" style="margin-left:0px;"><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E4%B8%8E%E5%A4%8D%E7%94%A8" rel="nofollow">案例二：配置拆分与复用</a></p> 
<p id="%E8%83%8C%E6%99%AF-toc" style="margin-left:80px;"><a href="#%E8%83%8C%E6%99%AF" rel="nofollow">背景</a></p> 
<p id="%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E5%A4%8D%E7%94%A8%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E5%A4%8D%E7%94%A8%E8%AF%B4%E6%98%8E" rel="nofollow">配置拆分复用说明</a></p> 
<p id="%E5%AF%B9pom.xml%E5%A2%9E%E5%8A%A0%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#%E5%AF%B9pom.xml%E5%A2%9E%E5%8A%A0%E4%BE%9D%E8%B5%96" rel="nofollow">对pom.xml增加依赖</a></p> 
<p id="%E5%88%A0%E9%99%A4application.properties%EF%BC%8C%E5%A2%9E%E5%8A%A0bootstrap.properties-toc" style="margin-left:80px;"><a href="#%E5%88%A0%E9%99%A4application.properties%EF%BC%8C%E5%A2%9E%E5%8A%A0bootstrap.properties" rel="nofollow">删除application.properties，增加bootstrap.properties</a></p> 
<p id="%E5%90%AF%E5%8A%A8-toc" style="margin-left:80px;"><a href="#%E5%90%AF%E5%8A%A8" rel="nofollow">启动</a></p> 
<p id="%C2%A0%E8%B0%83%E7%94%A8%E9%AA%8C%E8%AF%81-toc" style="margin-left:80px;"><a href="#%C2%A0%E8%B0%83%E7%94%A8%E9%AA%8C%E8%AF%81" rel="nofollow">调用验证</a></p> 
<p id="%E9%99%841%EF%BC%9ANacos%20config%E9%9A%94%E7%A6%BB%E5%B1%82%E6%AC%A1%E6%A6%82%E5%BF%B5-toc" style="margin-left:0px;"><a href="#%E9%99%841%EF%BC%9ANacos%20config%E9%9A%94%E7%A6%BB%E5%B1%82%E6%AC%A1%E6%A6%82%E5%BF%B5" rel="nofollow">附1：Nacos config客户端临时暂存目录</a></p> 
<p id="%E9%99%841%EF%BC%9ANacos%20config%E9%9A%94%E7%A6%BB%E5%B1%82%E6%AC%A1%E6%A6%82%E5%BF%B5-toc" style="margin-left:0px;"><a href="#%E9%99%841%EF%BC%9ANacos%20config%E9%9A%94%E7%A6%BB%E5%B1%82%E6%AC%A1%E6%A6%82%E5%BF%B5" rel="nofollow">附2：Nacos config隔离层次概念</a></p> 
<p id="%E9%99%842%EF%BC%9A%E6%98%BE%E7%A4%BA%E7%9A%84%E5%86%99%E5%85%A5Nacos%20config%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%8F%8A%E7%9B%91%E5%90%AC-toc" style="margin-left:0px;"><a href="#%E9%99%842%EF%BC%9A%E6%98%BE%E7%A4%BA%E7%9A%84%E5%86%99%E5%85%A5Nacos%20config%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%8F%8A%E7%9B%91%E5%90%AC" rel="nofollow">附3：显示写入Nacos config配置中心及监听代码示例</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E4%BD%BF%E7%94%A8">案例一：配置中心使用</h2> 
<h4 id="%E4%BA%BA%E5%B7%A5%E5%9C%A8Nacos%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9">人工在Nacos配置内容</h4> 
<p>在Nacos中人工定义如下<img alt="" height="610" src="https://images2.imgbox.com/64/9b/eKRSYtkx_o.png" width="903"></p> 
<pre><code>Data ID:    firstapp-dev.properties

Group  :    DEFAULT_GROUP

配置格式:    Properties

配置内容：   weather=sun
           temperature=20.55</code></pre> 
<p> 其中Data ID的命令规则为：<span style="color:#fe2c24;"><strong>应用名-环境profile名.文件后缀</strong></span></p> 
<ul><li><span style="color:#be191c;"><strong>应用名（Data ID前缀）</strong>：默认为  ${spring.appliction.name}， 也可以使用${spring.cloud.nacos.config.prefix}来配置</span></li><li><span style="color:#be191c;"><strong>环境profile名</strong>：既${spring.profiles.active}指定的环境。  若不区分环境，则本内容既前面的中划线都可以不用存在。</span></li><li><span style="color:#be191c;"><strong>文件后缀</strong>：既SpringBoot中配置文件扩展名，也是Nacos中的配置格式。</span></li></ul> 
<h4 id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8">客户端使用</h4> 
<p>新建一个project或者module。 在生成的默认pom.xml增加<strong>nacos-config</strong>和<strong>bootstrap</strong>依赖。如下</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.7.10&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;firstapp&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;firstapp&lt;/name&gt;
    &lt;description&gt;firstapp&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;maven.compiler.source&gt;${java.version}&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;${java.version}&lt;/maven.compiler.target&gt;
        &lt;springcloud.version&gt;3.1.6&lt;/springcloud.version&gt;
        &lt;springcloudalibaba.version&gt;2021.0.4.0&lt;/springcloudalibaba.version&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
            &lt;version&gt;${springcloudalibaba.version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;!-- nacos-client2.0.4版本存在官方github上的#6999及#10385号Bug； nacos-client2.2.1版本存在当配置中心配置变化后客户端AsyncAppender进程数不断增加Bug --&gt;
                    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
            &lt;version&gt;${springcloudalibaba.version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;!-- nacos-client2.0.4版本存在官方github上的#6999及#10385号Bug； nacos-client2.2.1版本存在当配置中心配置变化后客户端AsyncAppender进程数不断增加Bug --&gt;
                    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
            &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
            &lt;version&gt;${springcloud.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre> 
<p> 创建bootstrap.properties文件（与application.properties文件同目录存放），bootstrap.properties加载顺序先于application.properties 。</p> 
<p><span style="color:#956fe7;">bootstrap.properties</span>文件内容如下：</p> 
<pre><code class="language-bash">spring.application.name=firstapp

#Data ID的前缀（如果不指定，则默认取 ${spring.appliction.name}）
spring.cloud.nacos.config.prefix=firstapp
#指定为开发环境
spring.profiles.active=dev
#Nacos配置中心服务端的地址和端口(形式ip:port,ip:port,...) 前个地址不可用时，才会自动重连下一个地址
spring.cloud.nacos.config.server-addr=39.100.80.168:8848
#命名空间（由于Nacos自身Bug：若这里显示指定为public会导致高频刷，不显示指定或者指定其他命名空间均正常。 Bug链接 https://github.com/alibaba/nacos/issues/3460）
#spring.cloud.nacos.config.namespace=public
#配置组（如果不指定，则默认为DEFAULT_GROUP）
spring.cloud.nacos.config.group=DEFAULT_GROUP
#指定文件后缀（如果不指定，则默认为properties）
spring.cloud.nacos.config.file-extension=properties
</code></pre> 
<p> 对SpringBoot启动类中，增加获取配置项并输出的代码。</p> 
<pre><code class="language-java">@SpringBootApplication
public class FirstappApplication {
    public static void main(String[] args) throws InterruptedException {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(FirstappApplication.class, args);
        while (true) {
            String weather = applicationContext.getEnvironment().getProperty("weather");
            String temperature = applicationContext.getEnvironment().getProperty("temperature");
            System.err.println("weather:" + weather + "; temperature: " + temperature);
            TimeUnit.SECONDS.sleep(3);
        }
    }
}</code></pre> 
<p>启动运行后，可以看到SpringBoot程序获得了Nacos配置中心的值。</p> 
<p>同时，如果在Nacos控制台界面中人工调整配置项的值，SpringBoot会立即自动取得最新值。因为Nacos客户端带自动刷新功能。</p> 
<blockquote> 
 <p>可以通过配置 <code>spring.cloud.nacos.config.refresh.enabled=false</code> 来关闭自动刷新</p> 
</blockquote> 
<h2 id="%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E4%B8%8E%E5%A4%8D%E7%94%A8">案例二：配置拆分与复用</h2> 
<h4 id="%E8%83%8C%E6%99%AF">背景</h4> 
<p>本案例在前一个案例（<a href="https://blog.csdn.net/zyplanke/article/details/120849248" title="https://blog.csdn.net/zyplanke/article/details/120849248">https://blog.csdn.net/zyplanke/article/details/120849248</a>）基础上进行注册中心修改。</p> 
<p></p> 
<h4 id="%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86%E5%A4%8D%E7%94%A8%E8%AF%B4%E6%98%8E"><strong>配置拆分复用说明</strong></h4> 
<p>在nacos中配置如下三个Data ID:</p> 
<ul><li>commonshare.properties  放各个服务的公共配置</li><li>paymentService.properties  放支付服务需要的配置</li><li>orderService.properties  放订单服务需要的配置</li></ul> 
<p>在Nacos中人工定义如上三个Data ID，内容分别如下：</p> 
<p>commonshare.properties：</p> 
<p><img alt="" height="1022" src="https://images2.imgbox.com/74/a6/sYltVxVi_o.png" width="1200"></p> 
<p> </p> 
<p></p> 
<p></p> 
<p>paymentService.properties：</p> 
<p><img alt="" height="1166" src="https://images2.imgbox.com/bf/d1/EbZkmFtH_o.png" width="1200"></p> 
<p> </p> 
<p> </p> 
<p></p> 
<p></p> 
<p>orderService.properties：</p> 
<p><img alt="" height="1198" src="https://images2.imgbox.com/d5/51/msr6jII6_o.png" width="1200"></p> 
<p> </p> 
<p></p> 
<p></p> 
<h4 id="%E5%AF%B9pom.xml%E5%A2%9E%E5%8A%A0%E4%BE%9D%E8%B5%96">对pom.xml增加依赖</h4> 
<pre><code class="language-XML">   ------ 前面省略 ------
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
            &lt;version&gt;${springcloudalibaba.version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;!-- nacos-client2.0.4版本存在官方github上的#6999及#10385号Bug； nacos-client2.2.1版本存在当配置中心配置变化后客户端AsyncAppender进程数不断增加Bug --&gt;
                    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
            &lt;version&gt;${springcloud.version}&lt;/version&gt;
        &lt;/dependency&gt;
   ------ 后面省略 ------</code></pre> 
<h4 id="%E5%88%A0%E9%99%A4application.properties%EF%BC%8C%E5%A2%9E%E5%8A%A0bootstrap.properties">删除application.properties增加bootstrap.properties</h4> 
<p><span style="color:#fe2c24;">分别将payment、order服务下的application.properties文件中内容清空或直接删除该文件。</span></p> 
<p>在payment服务下新增bootstrap.properties文件，改为从配置中心获取应用程序的配置，bootstrap.properties内容如下：</p> 
<pre><code class="language-bash">spring.application.name=payment

#Nacos配置中心服务端的地址和端口(形式ip:port,ip:port,...) 。注：nacos-client1.x会按顺序选其中地址进行连接(前个连接失败则自动选后一个)。nacos-client2.x会随机选其中地址进行连接(若连接失败则自动另选)
spring.cloud.nacos.config.server-addr=39.100.80.168:8848
#Data ID的前缀（如果不指定，则默认取 ${spring.appliction.name}）
spring.cloud.nacos.config.prefix=paymentService
spring.cloud.nacos.config.group=DEFAULT_GROUP
#指定文件后缀（如果不指定，则默认为properties）
spring.cloud.nacos.config.file-extension=properties
#通用共享配置的信息
spring.cloud.nacos.config.shared-configs[0].data-id=commonshare.properties
spring.cloud.nacos.config.shared-configs[0].group=DEFAULT_GROUP
spring.cloud.nacos.config.shared-configs[0].refresh=true</code></pre> 
<p>   在order服务下新增bootstrap.properties文件，内容如下：</p> 
<pre><code class="language-bash">spring.application.name=order

#Nacos配置中心服务端的地址和端口(形式ip:port,ip:port,...) 。注：nacos-client1.x会按顺序选其中地址进行连接(前个连接失败则自动选后一个)。nacos-client2.x会随机选其中地址进行连接(若连接失败则自动另选)
spring.cloud.nacos.config.server-addr=39.100.80.168:8848
#Data ID的前缀（如果不指定，则默认取 ${spring.appliction.name}）
spring.cloud.nacos.config.prefix=orderService
spring.cloud.nacos.config.group=DEFAULT_GROUP
#指定文件后缀（如果不指定，则默认为properties）
spring.cloud.nacos.config.file-extension=properties
#通用共享配置的信息
spring.cloud.nacos.config.shared-configs[0].data-id=commonshare.properties
spring.cloud.nacos.config.shared-configs[0].group=DEFAULT_GROUP
spring.cloud.nacos.config.shared-configs[0].refresh=true</code></pre> 
<h4 id="%E5%90%AF%E5%8A%A8">启动</h4> 
<p>重新repackage模块payment、order，然后分别启动payment、order服务。</p> 
<p>   可以看到payment服务启动端口为9999（从nacos配置中心获得的端口配置）； </p> 
<p>    可以看到order服务启动端口为4444（从nacos配置中心获得的端口配置）</p> 
<h4 id="%C2%A0%E8%B0%83%E7%94%A8%E9%AA%8C%E8%AF%81">调用验证</h4> 
<pre><code class="language-bash">curl http://localhost:4444/consumer/66</code></pre> 
<p>调用Order服务成功，返回信息符合预期。</p> 
<p></p> 
<h2 id="%E9%99%841%EF%BC%9ANacos%20config%E9%9A%94%E7%A6%BB%E5%B1%82%E6%AC%A1%E6%A6%82%E5%BF%B5">附1：Nacos config客户端临时暂存目录</h2> 
<ul><li>Nacos客户端会将从Nacos服务端的配置下载到客户端本地（若服务端配置有变更，会自动将变更后的下载到客户端本地），作为配置的临时暂存。</li><li>Nacos客户端在在本地临时暂存的目录为：<span style="color:#fe2c24;">$HOME</span>/nacos/config/fixed-<span style="color:#fe2c24;">NacosServerIP</span>_nacos\snapshot\            ($HOME为客户端应用启动用户所在的HOME路径)</li></ul> 
<h2>附2：Nacos config隔离层次概念</h2> 
<ul><li>namespace：可用于资源完全隔离，不同namespace下的config配置资源不共享，服务不互通（无法发现找到）。可通过namespace实现多租户隔离</li><li>group：可用于资源分组。在同一namespace下，不同group的config配置资源不共享。 服务不互通（无法无法发现找到）。可通过group实现不同环境隔离</li><li>cluster_name：在Nacos config配置中心，无此概念。 属于服务注册中心概念</li></ul> 
<p>注意1：注册中心和配置中心的Group两者是不同的，各自管各自。</p> 
<p>注意2：以上层的设置，对于同一服务实例可以在Nacos注册中心、配置中心分别配置不同group。既同一个服务在向Nacos向Nacos获取配置时申明的group=A，而向Nacos注册服务时申明的group=B，这是允许的。</p> 
<blockquote> 
 <p>更多的关于springcloud中nacos config配置项可参加nacos官网：</p> 
 <p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config" title="Nacos config · alibaba/spring-cloud-alibaba Wiki · GitHub">Nacos config · alibaba/spring-cloud-alibaba Wiki · GitHub</a></p> 
</blockquote> 
<p></p> 
<h2 id="%E9%99%842%EF%BC%9A%E6%98%BE%E7%A4%BA%E7%9A%84%E5%86%99%E5%85%A5Nacos%20config%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%8F%8A%E7%9B%91%E5%90%AC">附3：显示写入Nacos config配置中心及监听代码示例</h2> 
<p><strong>在Java代码中显示的将配置内容写入发布至配置中心</strong></p> 
<p>    a、 不使用Springboot Bean方式，通过以下方式直接访问Nacos服务端，向服务端写配置，或者读取配置：</p> 
<pre><code class="language-java">ConfigService configService = NacosFactory.createConfigService(ServerAddrList);
configService.publishConfig("test.properties", "GJS_GROUP" , "aaa.bbb=111\nccc.ddd=222\nxxx=333");
configService.getConfig(String dataId, String group, long timeoutMs);
configService.shutDown();</code></pre> 
<p>   b、 若在Springboot Bean中，通过自动注入获得configService对象：</p> 
<pre><code class="language-java">@Autowired
NacosConfigManager nacosConfigManager;


...... 省略 ......
     ConfigService configService = nacosConfigManager.getConfigService();
...... 然后使用该对象操作（省略）......

</code></pre> 
<p></p> 
<p><strong>在Java代码增加对Nacos配置中心的配置项监听</strong></p> 
<p>    向Nacos配置中心注册监听器，当Nacos配置中心的配置内容变化时，通过此监听器自动获取最新内容，并更新并保存本类变量中：</p> 
<pre><code class="language-java">/**
 * 向Nacos配置中心注册监听器
 * 当Nacos配置中心的配置内容变化时，通过此监听器自动获取最新内容，并更新并保存本类变量中
 *
 */
@Component
@Slf4j
public class NacosConfigListener {

    public static Map&lt;String, String&gt; exchCodeServiceNameMap = new HashMap&lt;&gt;(2000);

    @Autowired
    private void addNacosConfigListener(NacosConfigManager nacosConfigManager) {
        ConfigService configService = nacosConfigManager.getConfigService();
        try {
            configService.addListener(Global.NacosConfigDataID_ExchCode_ServiceName_Map, Global.NacosConfigGroup_ExchCode_ServiceName_Map,
                    new PropertiesListener() {
                        @Override
                        public void innerReceive(Properties properties) {
                            properties.forEach((key, value) -&gt; exchCodeServiceNameMap.put( (String) key, (String)value));
                            log.info("感知到Nacos配置中心dataID=[{}],group=[{}]发生变化，已将最新配置内容更新至本地对象", Global.NacosConfigDataID_ExchCode_ServiceName_Map,Global.NacosConfigGroup_ExchCode_ServiceName_Map );
                        }
                    });
            log.info("作向Nacos配置中心注册器(监听配置变化)完成");
        } catch (NacosException e) {
            log.error("监听Nacos配置中心遇到异常", e);
        }
    }
}
</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/06f116a051ef2090fbad067a4f5a8201/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SPDK 常见协议简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/952e97ee554be133fe016637fcb934b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">yolo格式visdrone转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>