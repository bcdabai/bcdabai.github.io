<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Xavier NX实现硬解码H264&amp;H265 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Xavier NX实现硬解码H264&amp;H265" />
<meta property="og:description" content="提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档
文章目录 前言一、NX的硬解码？二、测试代码三、软硬解对比四、总结 前言 最近在做一个项目，使用opencv的VideoCapture拉流并把帧送进模型推理，结果发现VideoCapture本身使用的是cpu的软解码，占用了大量的资源，后来就去研究使用设备本身的硬解码资源去分摊cpu的压力。
一、NX的硬解码？ Xavier NX 使用OpenCV&#43;GStreamer实现硬解码
NX的硬解码叫NVDEC，硬编码交NVENC，这两个都是专门的硬件去做的，效率比cpu高很多。这里要多说一句，NX是共享内存，就是gpu,vpu和cpu都是一个内存，不像台式机有专用显存，显存与内存数据格式不一样，需要转换（实测0-2ms），不能拿来直接用。NX就没有这个问题，但是这里我们不讨论这么深的问题，感兴趣的可以私下里去研究下。先上个图，这里需要使用jtop看
注意看红框里面的，如果解码器没有用这个就是OFF，旁边的就是编码器，不在这次讨论范围内。
二、测试代码 首先你要安装了opencv&#43;gstreamer，具体安装方法我会在另一篇文章里面介绍，这里不多说，直接上代码。这里我们使用官方提供的代码
# -------------------------------------------------------- # Camera sample code for Tegra X2/X1 # # This program could capture and display video from # IP CAM, USB webcam, or the Tegra onboard camera. # Refer to the following blog post for how to set up # and run the code: # https://jkjung-avt.github.io/tx2-camera-with-python/ # # Written by JK Jung &lt;jkjung13@gmail.com&gt; # -------------------------------------------------------- import sys import argparse import subprocess import cv2 WINDOW_NAME = &#39;CameraDemo&#39; def parse_args(): # Parse input arguments desc = &#39;Capture and display live camera video on Jetson TX2/TX1&#39; parser = argparse." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ce9ba67880b98dc8fb325d6f501b6454/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-19T11:47:43+08:00" />
<meta property="article:modified_time" content="2022-08-19T11:47:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Xavier NX实现硬解码H264&amp;H265</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#NX_13" rel="nofollow">一、NX的硬解码？</a></li><li><a href="#_21" rel="nofollow">二、测试代码</a></li><li><a href="#_272" rel="nofollow">三、软硬解对比</a></li><li><a href="#_279" rel="nofollow">四、总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_7"></a>前言</h2> 
<p>最近在做一个项目，使用opencv的VideoCapture拉流并把帧送进模型推理，结果发现VideoCapture本身使用的是cpu的软解码，占用了大量的资源，后来就去研究使用设备本身的硬解码资源去分摊cpu的压力。</p> 
<hr> 
<h2><a id="NX_13"></a>一、NX的硬解码？</h2> 
<p><a href="https://blog.csdn.net/jiexijihe945/article/details/125928135">Xavier NX 使用OpenCV+GStreamer实现硬解码</a></p> 
<p>NX的硬解码叫NVDEC，硬编码交NVENC，这两个都是专门的硬件去做的，效率比cpu高很多。这里要多说一句，NX是共享内存，就是gpu,vpu和cpu都是一个内存，不像台式机有专用显存，显存与内存数据格式不一样，需要转换（实测0-2ms），不能拿来直接用。NX就没有这个问题，但是这里我们不讨论这么深的问题，感兴趣的可以私下里去研究下。先上个图，这里需要使用jtop看</p> 
<p><img src="https://images2.imgbox.com/c2/40/sW6q0Sqs_o.png" alt="在这里插入图片描述"><br> 注意看红框里面的，如果解码器没有用这个就是OFF，旁边的就是编码器，不在这次讨论范围内。</p> 
<h2><a id="_21"></a>二、测试代码</h2> 
<p>首先你要安装了opencv+gstreamer，具体安装方法我会在另一篇文章里面介绍，这里不多说，直接上代码。这里我们使用官方提供的代码</p> 
<pre><code class="prism language-python"><span class="token comment"># --------------------------------------------------------</span>
<span class="token comment"># Camera sample code for Tegra X2/X1</span>
<span class="token comment">#</span>
<span class="token comment"># This program could capture and display video from</span>
<span class="token comment"># IP CAM, USB webcam, or the Tegra onboard camera.</span>
<span class="token comment"># Refer to the following blog post for how to set up</span>
<span class="token comment"># and run the code:</span>
<span class="token comment">#   https://jkjung-avt.github.io/tx2-camera-with-python/</span>
<span class="token comment">#</span>
<span class="token comment"># Written by JK Jung &lt;jkjung13@gmail.com&gt;</span>
<span class="token comment"># --------------------------------------------------------</span>


<span class="token keyword">import</span> sys
<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> subprocess

<span class="token keyword">import</span> cv2


WINDOW_NAME <span class="token operator">=</span> <span class="token string">'CameraDemo'</span>


<span class="token keyword">def</span> <span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Parse input arguments</span>
    desc <span class="token operator">=</span> <span class="token string">'Capture and display live camera video on Jetson TX2/TX1'</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span>desc<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--rtsp'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'use_rtsp'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'use IP CAM (remember to also set --uri)'</span><span class="token punctuation">,</span>
                        action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--uri'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'rtsp_uri'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'RTSP URI, e.g. rtsp://192.168.1.64:554'</span><span class="token punctuation">,</span>
                        default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--latency'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'rtsp_latency'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'latency in ms for RTSP [200]'</span><span class="token punctuation">,</span>
                        default<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--usb'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'use_usb'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'use USB webcam (remember to also set --vid)'</span><span class="token punctuation">,</span>
                        action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--vid'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'video_dev'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'device # of USB webcam (/dev/video?) [1]'</span><span class="token punctuation">,</span>
                        default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--width'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'image_width'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'image width [1920]'</span><span class="token punctuation">,</span>
                        default<span class="token operator">=</span><span class="token number">1920</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--height'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'image_height'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'image height [1080]'</span><span class="token punctuation">,</span>
                        default<span class="token operator">=</span><span class="token number">1080</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> args


<span class="token keyword">def</span> <span class="token function">open_cam_rtsp</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> latency<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment">#H264的写法</span>
    <span class="token comment">#gst_str = ('rtspsrc location={} latency={} ! '</span>
    <span class="token comment">#           'rtph264depay ! h264parse ! omxh264dec ! '</span>
    <span class="token comment">#           'nvvidconv ! '</span>
    <span class="token comment">#           'video/x-raw, width=(int){}, height=(int){}, '</span>
    <span class="token comment">#           'format=(string)BGRx ! '</span>
    <span class="token comment">#           'videoconvert ! appsink').format(uri, latency, width, height)</span>
	<span class="token comment">#H265的写法</span>
    gst_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'rtspsrc location={} latency={} ! '</span>
               <span class="token string">'rtph265depay ! h265parse ! omxh265dec ! '</span>
               <span class="token string">'nvvidconv ! '</span>
               <span class="token string">'video/x-raw, width=(int){}, height=(int){}, '</span>
               <span class="token string">'format=(string)BGRx ! '</span>
               <span class="token string">'videoconvert ! appsink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> latency<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>gst_str<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CAP_GSTREAMER<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">open_cam_usb</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># We want to set width and height here, otherwise we could just do:</span>
    <span class="token comment">#     return cv2.VideoCapture(dev)</span>
    gst_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'v4l2src device=/dev/video{} ! '</span>
               <span class="token string">'video/x-raw, width=(int){}, height=(int){} ! '</span>
               <span class="token string">'videoconvert ! appsink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>gst_str<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CAP_GSTREAMER<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">open_cam_onboard</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gst_elements <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">'gst-inspect-1.0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'nvcamerasrc'</span> <span class="token keyword">in</span> gst_elements<span class="token punctuation">:</span>
        <span class="token comment"># On versions of L4T prior to 28.1, add 'flip-method=2' into gst_str</span>
        gst_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'nvcamerasrc ! '</span>
                   <span class="token string">'video/x-raw(memory:NVMM), '</span>
                   <span class="token string">'width=(int)2592, height=(int)1458, '</span>
                   <span class="token string">'format=(string)I420, framerate=(fraction)30/1 ! '</span>
                   <span class="token string">'nvvidconv ! '</span>
                   <span class="token string">'video/x-raw, width=(int){}, height=(int){}, '</span>
                   <span class="token string">'format=(string)BGRx ! '</span>
                   <span class="token string">'videoconvert ! appsink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token string">'nvarguscamerasrc'</span> <span class="token keyword">in</span> gst_elements<span class="token punctuation">:</span>
        gst_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'nvarguscamerasrc ! '</span>
                   <span class="token string">'video/x-raw(memory:NVMM), '</span>
                   <span class="token string">'width=(int)1920, height=(int)1080, '</span>
                   <span class="token string">'format=(string)NV12, framerate=(fraction)30/1 ! '</span>
                   <span class="token string">'nvvidconv flip-method=2 ! '</span>
                   <span class="token string">'video/x-raw, width=(int){}, height=(int){}, '</span>
                   <span class="token string">'format=(string)BGRx ! '</span>
                   <span class="token string">'videoconvert ! appsink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'onboard camera source not found!'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>gst_str<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CAP_GSTREAMER<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">open_window</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>resizeWindow<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>moveWindow<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> <span class="token string">'Camera Demo for Jetson TX2/TX1'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">read_cam</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    show_help <span class="token operator">=</span> <span class="token boolean">True</span>
    full_scrn <span class="token operator">=</span> <span class="token boolean">False</span>
    help_text <span class="token operator">=</span> <span class="token string">'"Esc" to Quit, "H" for Help, "F" to Toggle Fullscreen'</span>
    font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_PLAIN
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment">#if cv2.getWindowProperty(WINDOW_NAME, 0) &lt; 0:</span>
            <span class="token comment"># Check to see if the user has closed the window</span>
            <span class="token comment"># If yes, terminate the program</span>
        <span class="token comment">#    break</span>
        _<span class="token punctuation">,</span> img <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># grab the next image frame from camera</span>
<span class="token comment">#        if show_help:</span>
<span class="token comment">#            cv2.putText(img, help_text, (11, 20), font,</span>
 <span class="token comment">#                       1.0, (32, 32, 32), 4, cv2.LINE_AA)</span>
  <span class="token comment">#          cv2.putText(img, help_text, (10, 20), font,</span>
   <span class="token comment">#                     1.0, (240, 240, 240), 1, cv2.LINE_AA)</span>
    <span class="token comment">#    cv2.imshow(WINDOW_NAME, img)</span>
        key <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span> <span class="token comment"># ESC key: quit program</span>
            <span class="token keyword">break</span>
        <span class="token keyword">elif</span> key <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'H'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> key <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># toggle help message</span>
            show_help <span class="token operator">=</span> <span class="token keyword">not</span> show_help
        <span class="token keyword">elif</span> key <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> key <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># toggle fullscreen</span>
            full_scrn <span class="token operator">=</span> <span class="token keyword">not</span> full_scrn
            <span class="token keyword">if</span> full_scrn<span class="token punctuation">:</span>
                cv2<span class="token punctuation">.</span>setWindowProperty<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>WND_PROP_FULLSCREEN<span class="token punctuation">,</span>
                                      cv2<span class="token punctuation">.</span>WINDOW_FULLSCREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                cv2<span class="token punctuation">.</span>setWindowProperty<span class="token punctuation">(</span>WINDOW_NAME<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>WND_PROP_FULLSCREEN<span class="token punctuation">,</span>
                                      cv2<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    args <span class="token operator">=</span> parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Called with args:'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'OpenCV version: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> args<span class="token punctuation">.</span>use_rtsp<span class="token punctuation">:</span>
        cap <span class="token operator">=</span> open_cam_rtsp<span class="token punctuation">(</span>args<span class="token punctuation">.</span>rtsp_uri<span class="token punctuation">,</span>
                            args<span class="token punctuation">.</span>image_width<span class="token punctuation">,</span>
                            args<span class="token punctuation">.</span>image_height<span class="token punctuation">,</span>
                            args<span class="token punctuation">.</span>rtsp_latency<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> args<span class="token punctuation">.</span>use_usb<span class="token punctuation">:</span>
        cap <span class="token operator">=</span> open_cam_usb<span class="token punctuation">(</span>args<span class="token punctuation">.</span>video_dev<span class="token punctuation">,</span>
                           args<span class="token punctuation">.</span>image_width<span class="token punctuation">,</span>
                           args<span class="token punctuation">.</span>image_height<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># by default, use the Jetson onboard camera</span>
        cap <span class="token operator">=</span> open_cam_onboard<span class="token punctuation">(</span>args<span class="token punctuation">.</span>image_width<span class="token punctuation">,</span>
                               args<span class="token punctuation">.</span>image_height<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">'Failed to open camera!'</span><span class="token punctuation">)</span>

    <span class="token comment">#open_window(args.image_width, args.image_height)</span>
    read_cam<span class="token punctuation">(</span>cap<span class="token punctuation">)</span>

    cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#cv2.destroyAllWindows()</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里我不需要显示，所以我把显示代码注释掉了，需要的可自行打开，前提是你需要一个显示页面。再看看jtop<br> <img src="https://images2.imgbox.com/31/d0/CYvRLf6s_o.png" alt="在这里插入图片描述"><br> 再看看红框里面的，如果有数值，说明硬解码成功了，如果没有那就是你本身的环境装的不对。</p> 
<p><code>补充：这里多说一句，关于怎么提前知道流的信息，我们需要借用ffprobe的指令</code></p> 
<pre><code class="prism language-bash"> ffprobe -show_streams -v quiet -show_format -print_format json -i <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"streams"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string-property property">"codec_name"</span><span class="token operator">:</span> <span class="token string">"hevc"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"codec_long_name"</span><span class="token operator">:</span> <span class="token string">"H.265 / HEVC (High Efficiency Video Coding)"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"profile"</span><span class="token operator">:</span> <span class="token string">"Main"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"codec_type"</span><span class="token operator">:</span> <span class="token string">"video"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"codec_tag_string"</span><span class="token operator">:</span> <span class="token string">"[0][0][0][0]"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"codec_tag"</span><span class="token operator">:</span> <span class="token string">"0x0000"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"width"</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span>
            <span class="token string-property property">"height"</span><span class="token operator">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
            <span class="token string-property property">"coded_width"</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span>
            <span class="token string-property property">"coded_height"</span><span class="token operator">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
            <span class="token string-property property">"closed_captions"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string-property property">"has_b_frames"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string-property property">"pix_fmt"</span><span class="token operator">:</span> <span class="token string">"yuv420p"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"level"</span><span class="token operator">:</span> <span class="token number">153</span><span class="token punctuation">,</span>
            <span class="token string-property property">"color_range"</span><span class="token operator">:</span> <span class="token string">"tv"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"chroma_location"</span><span class="token operator">:</span> <span class="token string">"left"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"refs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string-property property">"r_frame_rate"</span><span class="token operator">:</span> <span class="token string">"25/1"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"avg_frame_rate"</span><span class="token operator">:</span> <span class="token string">"0/0"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"time_base"</span><span class="token operator">:</span> <span class="token string">"1/90000"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"start_pts"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
            <span class="token string-property property">"start_time"</span><span class="token operator">:</span> <span class="token string">"0.040000"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"disposition"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"default"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"dub"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"original"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"comment"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"lyrics"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"karaoke"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"forced"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"hearing_impaired"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"visual_impaired"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"clean_effects"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"attached_pic"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string-property property">"timed_thumbnails"</span><span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"format"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"filename"</span><span class="token operator">:</span> <span class="token string">"rtsp://10.0.42.30/record_hevc_0"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"nb_streams"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">"nb_programs"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"format_name"</span><span class="token operator">:</span> <span class="token string">"rtsp"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"format_long_name"</span><span class="token operator">:</span> <span class="token string">"RTSP input"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"start_time"</span><span class="token operator">:</span> <span class="token string">"0.040000"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"probe_score"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token string-property property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"No Name"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>index 就是音视频的索引，我用的这个流是不带声音的，所以只有一个index，一般0是视频，1是音频。codec_name 就是编码格式，你可以先用这个方法获取编码格式再决定选用哪种编码方式，由于H264和H265是最普遍的两种格式，几乎所有的设备都是支持的。所以这里我不介绍其他的了，有兴趣的可自行研究。<br> 其他的参数如帧率，比特率都是可以通过这个命令获取的，rtsp是没有duration的，这个选项不可用，因为流是一直推的，视频文件这个参数是有效的。其它参数请大家自行研究。</p> 
<h2><a id="_272"></a>三、软硬解对比</h2> 
<p><img src="https://images2.imgbox.com/42/54/pdm5YHbd_o.png" alt="在这里插入图片描述"></p> 
<p>由于我需要看硬解码状态所以使用了jtop，jtop对cpu占用还是比较大的，大家可以使用top来看，top对资源占用很少。不过就算这样硬解码的优势还是很明显的。</p> 
<h2><a id="_279"></a>四、总结</h2> 
<p>总体来讲是比较简单的，H264和H265两兄弟也基本上能满足日常绝大多数场景的需求了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f2e0f802bc99e49e6e32b31e917d3c2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot - SWAGGER中配置.pathMapping(“XXXX“)引发的404错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/852bd87f48b304ece39e0a98e9e9211a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vscode 安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>