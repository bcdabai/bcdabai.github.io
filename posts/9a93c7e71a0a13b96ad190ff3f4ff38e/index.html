<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【python函数】torch.nn.Embedding函数用法图解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【python函数】torch.nn.Embedding函数用法图解" />
<meta property="og:description" content="学习SAM模型的时候，第一次看见了nn.Embedding函数，以前接触CV比较多，很少学习词嵌入方面的，找了一些资料一开始也不是很理解，多看了两遍后，突然顿悟，特此记录。
SAM中PromptEncoder中运用nn.Embedding：
point_embeddings = [nn.Embedding(1, embed_dim) for i in range(self.num_point_embeddings)] torch.nn.Embedding官方页面
1. torch.nn.Embedding介绍 （1）词嵌入简介 关于词嵌入，这篇文章讲的挺清楚的，相比于One-hot编码，Embedding方式更方便计算，例如在“就在江湖之上”整个词典中，要编码“江湖”两个字，One-hot编码需要 [ l e n g t h , w o r d _ c o u n t ] {[length, word\_count]} [length,word_count] 大小的张量，其中 w o r d _ c o u n t {word\_count} word_count 为词典中所有词的总数，而Embedding方式的嵌入维度 e m b e d d i n g _ d i m {embedding\_dim} embedding_dim 可远远小于 w o r d _ c o u n t {word\_count} word_count 。在运用Embedding方式编码的词典时，只需要词的索引，下图例子中： “江湖”——&gt;[2, 3]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9a93c7e71a0a13b96ad190ff3f4ff38e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-20T00:11:42+08:00" />
<meta property="article:modified_time" content="2023-09-20T00:11:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【python函数】torch.nn.Embedding函数用法图解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  学习SAM模型的时候，第一次看见了nn.Embedding函数，以前接触CV比较多，很少学习词嵌入方面的，找了一些资料一开始也不是很理解，多看了两遍后，突然顿悟，特此记录。</p> 
<p>  <strong>SAM中PromptEncoder中运用nn.Embedding：</strong></p> 
<pre><code class="prism language-python">point_embeddings <span class="token operator">=</span> <span class="token punctuation">[</span>nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_point_embeddings<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<p>  <a href="https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html#torch.nn.Embedding" rel="nofollow">torch.nn.Embedding官方页面</a></p> 
<h3><a id="1_torchnnEmbedding_11"></a>1. torch.nn.Embedding介绍</h3> 
<h4><a id="1_12"></a>（1）词嵌入简介</h4> 
<p>  关于词嵌入，<a href="https://blog.csdn.net/qq_41477675/article/details/114645012">这篇文章</a>讲的挺清楚的，相比于One-hot编码，Embedding方式更方便计算，例如在“就在江湖之上”整个词典中，要编码“江湖”两个字，One-hot编码需要 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
       
         l 
        
       
         e 
        
       
         n 
        
       
         g 
        
       
         t 
        
       
         h 
        
       
         , 
        
       
         w 
        
       
         o 
        
       
         r 
        
       
         d 
        
       
         _ 
        
       
         c 
        
       
         o 
        
       
         u 
        
       
         n 
        
       
         t 
        
       
         ] 
        
       
      
        {[length, word\_count]} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mclose">]</span></span></span></span></span></span> 大小的张量，其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         o 
        
       
         r 
        
       
         d 
        
       
         _ 
        
       
         c 
        
       
         o 
        
       
         u 
        
       
         n 
        
       
         t 
        
       
      
        {word\_count} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0044em; vertical-align: -0.31em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span></span> 为词典中所有词的总数，而Embedding方式的嵌入维度 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         e 
        
       
         m 
        
       
         b 
        
       
         e 
        
       
         d 
        
       
         d 
        
       
         i 
        
       
         n 
        
       
         g 
        
       
         _ 
        
       
         d 
        
       
         i 
        
       
         m 
        
       
      
        {embedding\_dim} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0044em; vertical-align: -0.31em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="mord mathnormal">mb</span><span class="mord mathnormal">e</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal">d</span><span class="mord mathnormal">im</span></span></span></span></span></span> 可远远小于 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         o 
        
       
         r 
        
       
         d 
        
       
         _ 
        
       
         c 
        
       
         o 
        
       
         u 
        
       
         n 
        
       
         t 
        
       
      
        {word\_count} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0044em; vertical-align: -0.31em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">d</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span></span> 。在运用Embedding方式编码的词典时，只需要词的索引，下图例子中： “江湖”——&gt;[2, 3]</p> 
<p><img src="https://images2.imgbox.com/93/a3/YSVHvmXz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_16"></a>（2）重要参数介绍</h4> 
<p>  nn.embedding就相当于一个词典嵌入表：</p> 
<pre><code class="prism language-python">torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>num_embeddings<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> padding_idx<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> max_norm<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> norm_type<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span> scale_grad_by_freq<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sparse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> _weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> _freeze<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p>常用参数：<br>   <strong>① num_embeddings (int)：</strong> 词典中词的总数</p> 
<p>  <strong>② embedding_dim (int)：</strong> 词典中每个词的嵌入维度</p> 
<p>  <strong>③ padding_idx (int, optional)：</strong> 填充索引，在padding_idx处的嵌入向量在训练过程中没有更新，即它是一个固定的“pad”。对于新构造的Embedding，在padding_idx处的嵌入向量将默认为全零，但可以更新为另一个值以用作填充向量。</p> 
<p>输入：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         I 
        
       
         n 
        
       
         p 
        
       
         u 
        
       
         t 
        
       
         ( 
        
       
         ∗ 
        
       
         ) 
        
       
      
        {Input(∗)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord">∗</span><span class="mclose">)</span></span></span></span></span></span>: IntTensor 或者 LongTensor，为任意size的张量，包含要提取的所有词索引。<br> 输出：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         u 
        
       
         t 
        
       
         p 
        
       
         u 
        
       
         t 
        
       
         ( 
        
       
         ∗ 
        
       
         , 
        
       
         H 
        
       
         ) 
        
       
      
        {Output(∗, H)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal">u</span><span class="mord mathnormal">tp</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord">∗</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="mclose">)</span></span></span></span></span></span>: <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∗ 
        
       
      
        {∗} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4653em;"></span><span class="mord"><span class="mord">∗</span></span></span></span></span></span> 为输入张量的size，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         H 
        
       
      
        {H} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span></span></span></span></span></span> = embedding_dim</p> 
<h3><a id="2_torchnnEmbedding_30"></a>2. torch.nn.Embedding用法</h3> 
<h4><a id="1_31"></a>（1）基本用法</h4> 
<p>官方例子如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

y <span class="token operator">=</span> embedding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'权重:\n'</span><span class="token punctuation">,</span> embedding<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'输出:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre> 
<p>查看权重与输出，打印如下：</p> 
<pre><code class="prism language-python">权重<span class="token punctuation">:</span>
 Parameter containing<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.4212</span><span class="token punctuation">,</span>  <span class="token number">0.6127</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1126</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.4294</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0121</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.8348</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0315</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2234</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4589</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.6131</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4381</span><span class="token punctuation">,</span>  <span class="token number">0.1253</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0621</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1466</span><span class="token punctuation">,</span>  <span class="token number">1.7412</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">1.0708</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7888</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0177</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5979</span><span class="token punctuation">,</span>  <span class="token number">0.6465</span><span class="token punctuation">,</span>  <span class="token number">0.6508</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5608</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3802</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4206</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">1.1516</span><span class="token punctuation">,</span>  <span class="token number">0.4091</span><span class="token punctuation">,</span>  <span class="token number">1.2477</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5753</span><span class="token punctuation">,</span>  <span class="token number">0.1394</span><span class="token punctuation">,</span>  <span class="token number">2.3447</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
输出<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.4294</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0121</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.8348</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0315</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2234</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4589</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0621</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1466</span><span class="token punctuation">,</span>  <span class="token number">1.7412</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span> <span class="token number">1.0708</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7888</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0177</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0621</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1466</span><span class="token punctuation">,</span>  <span class="token number">1.7412</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span> <span class="token number">0.6131</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4381</span><span class="token punctuation">,</span>  <span class="token number">0.1253</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0315</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2234</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4589</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5753</span><span class="token punctuation">,</span>  <span class="token number">0.1394</span><span class="token punctuation">,</span>  <span class="token number">2.3447</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>EmbeddingBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> 
<p>  家人们，发现了什么，输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        {x} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span></span></span></span> 的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
      
        {size} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span></span></span></span> 大小为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
       
         2 
        
       
         , 
        
       
         4 
        
       
         ] 
        
       
      
        {[2, 4]} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">4</span><span class="mclose">]</span></span></span></span></span></span> ，输出 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        {y} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span></span></span></span></span></span> 的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
      
        {size} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span></span></span></span> 大小为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
       
         2 
        
       
         , 
        
       
         4 
        
       
         , 
        
       
         3 
        
       
         ] 
        
       
      
        {[2, 4, 3]} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">3</span><span class="mclose">]</span></span></span></span></span></span> ，下图清晰的展示出nn.Embedding干了个什么事儿：<br> <img src="https://images2.imgbox.com/fd/c1/hYSsSuoC_o.png" alt="在这里插入图片描述"></p> 
<p>  nn.Embedding相当于是一本词典，本例中，词典中一共有10个词 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          X 
         
        
          0 
         
        
       
      
        {X_0} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span>~<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          X 
         
        
          9 
         
        
       
      
        {X_9} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span>，每个词的嵌入维度为3，输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        {x} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span></span></span></span> 中记录词在词典中的索引，输出 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        {y} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span></span></span></span></span></span> 为输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        {x} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span></span></span></span> 经词典编码后的映射。</p> 
<p>  <strong>注意：此时存在一个问题，词索引是不能超出词典的最大容量的，即本例中，输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          x 
         
        
       
         {x} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span></span></span></span> 中的数值取值范围为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          [ 
         
        
          0 
         
        
          , 
         
        
          9 
         
        
          ] 
         
        
       
         {[0, 9]} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">9</span><span class="mclose">]</span></span></span></span></span></span>。</strong></p> 
<h4><a id="2_80"></a>（2）自定义词典权重</h4> 
<p>  如上所示，在未定义时，nn.Embedding的自动初始化权重满足 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
         ( 
        
       
         0 
        
       
         , 
        
       
         1 
        
       
         ) 
        
       
      
        {N(0,1)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></span> 分布，此外，nn.Embedding的权重也可以通过from_pretrained来自定义：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5.1</span><span class="token punctuation">,</span> <span class="token number">6.3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>weight<span class="token punctuation">)</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> embedding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre> 
<p>输出为：</p> 
<pre><code class="prism language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4.0000</span><span class="token punctuation">,</span> <span class="token number">5.1000</span><span class="token punctuation">,</span> <span class="token number">6.3000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1.0000</span><span class="token punctuation">,</span> <span class="token number">2.3000</span><span class="token punctuation">,</span> <span class="token number">3.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1.0000</span><span class="token punctuation">,</span> <span class="token number">2.3000</span><span class="token punctuation">,</span> <span class="token number">3.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="3padding_idx_100"></a>（3）padding_idx用法</h4> 
<p>  padding_idx可用于指定词典中哪一个索引的词填充为0。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> padding_idx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> embedding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'权重:\n'</span><span class="token punctuation">,</span> embedding<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'输出:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre> 
<p>输出为：</p> 
<pre><code class="prism language-python">权重<span class="token punctuation">:</span>
 Parameter containing<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.1831</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0200</span><span class="token punctuation">,</span>  <span class="token number">0.7023</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.2751</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1189</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3325</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5242</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2230</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1677</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.4078</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2141</span><span class="token punctuation">,</span>  <span class="token number">1.3185</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.8973</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9650</span><span class="token punctuation">,</span>  <span class="token number">0.5420</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.0597</span><span class="token punctuation">,</span>  <span class="token number">0.6810</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2595</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.6543</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6242</span><span class="token punctuation">,</span>  <span class="token number">0.2337</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0780</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9607</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0618</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.2801</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6041</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.4143</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
输出<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5242</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2230</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1677</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span> <span class="token number">0.1831</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0200</span><span class="token punctuation">,</span>  <span class="token number">0.7023</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span> <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>EmbeddingBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> 
<p>  词典中，被padding_idx标定后的词嵌入向量可被重新定义：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

padding_idx<span class="token operator">=</span><span class="token number">2</span>
embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> padding_idx<span class="token operator">=</span>padding_idx<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'权重:\n'</span><span class="token punctuation">,</span> embedding<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>

<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    embedding<span class="token punctuation">.</span>weight<span class="token punctuation">[</span>padding_idx<span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">3.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'权重:\n'</span><span class="token punctuation">,</span> embedding<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
</code></pre> 
<p>输出为：</p> 
<pre><code class="prism language-python">权重<span class="token punctuation">:</span>
 Parameter containing<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.7247</span><span class="token punctuation">,</span>  <span class="token number">0.7553</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.8226</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.3304</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5025</span><span class="token punctuation">,</span>  <span class="token number">0.5237</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">,</span>  <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
权重<span class="token punctuation">:</span>
 Parameter containing<span class="token punctuation">:</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.7247</span><span class="token punctuation">,</span>  <span class="token number">0.7553</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.8226</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.3304</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5025</span><span class="token punctuation">,</span>  <span class="token number">0.5237</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token number">1.1000</span><span class="token punctuation">,</span>  <span class="token number">2.2000</span><span class="token punctuation">,</span>  <span class="token number">3.3000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7dbfe6b21c3732edfcd454b068a31567/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">多分类的 准确率 召回率代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62541d2716cae3e47b90af04bdd6a373/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">STM32芯片烧录的三种方式介绍，串口、STM32 ST-LINK Utility以及STM32CubeProgrammer</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>