<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>clickhouse php,php 链接 clickhouse - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="clickhouse php,php 链接 clickhouse" />
<meta property="og:description" content="1 &lt;?php 2 //var_dump(is_dir(&#34;./sjignen&#34;));
3 //var_dump(file_exists(__DIR__.&#34;/day4.php&#34;));
4 $basePath = &#34;E:/php_project/sangfor_ready/&#34;;
5
6 function echo_all_path($pathName)
7 {
8 if (is_dir($pathName))
9 {
10
11 $handle = opendir($pathName);
12 while ($line = readdir($handle))
13 {
14 // echo &#34;查找中&#34;;
15 // echo $line.&#34;\n&#34;;
16 if ($line!=&#34;.&#34; &amp;&amp; $line !=&#34;..&#34;)
17 {
18 echo &#34;当前是目录:&#34;.$pathName.$line.&#34;\n&#34;;
19 echo_all_path($pathName.$line.&#34;/&#34;);
20 }
21
22 }
23 closedir($handle);
24 }
25 else
26 {
27 echo &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6de33a1de7e8258ba49af9ee670abf9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-11T01:42:29+08:00" />
<meta property="article:modified_time" content="2021-03-11T01:42:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">clickhouse php,php 链接 clickhouse</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>1 &lt;?php </p> 
 <p>2 //var_dump(is_dir("./sjignen"));</p> 
 <p>3 //var_dump(file_exists(__DIR__."/day4.php"));</p> 
 <p>4 $basePath = "E:/php_project/sangfor_ready/";</p> 
 <p>5</p> 
 <p>6 function echo_all_path($pathName)</p> 
 <p>7 {<!-- --></p> 
 <p>8 if (is_dir($pathName))</p> 
 <p>9 {<!-- --></p> 
 <p>10</p> 
 <p>11 $handle = opendir($pathName);</p> 
 <p>12 while ($line = readdir($handle))</p> 
 <p>13 {<!-- --></p> 
 <p>14 // echo "查找中";</p> 
 <p>15 // echo $line."\n";</p> 
 <p>16 if ($line!="." &amp;&amp; $line !="..")</p> 
 <p>17 {<!-- --></p> 
 <p>18 echo "当前是目录:".$pathName.$line."\n";</p> 
 <p>19 echo_all_path($pathName.$line."/");</p> 
 <p>20 }</p> 
 <p>21</p> 
 <p>22 }</p> 
 <p>23 closedir($handle);</p> 
 <p>24 }</p> 
 <p>25 else</p> 
 <p>26 {<!-- --></p> 
 <p>27 echo "当前是文件:".$pathName."\n";</p> 
 <p>28 return;</p> 
 <p>29 }</p> 
 <p>30 }</p> 
 <p>31 //echo_all_path($basePath);</p> 
 <p>32</p> 
 <p>33 function display_all_path($path)</p> 
 <p>34 {<!-- --></p> 
 <p>35 $handle = opendir($path);</p> 
 <p>36 while($line = readdir($handle))</p> 
 <p>37 {<!-- --></p> 
 <p>38 echo $line."\n";</p> 
 <p>39 }</p> 
 <p>40 closedir($handle);</p> 
 <p>41 }</p> 
 <p>42 //$fd = fopen("./shiqi.txt","ab+");</p> 
 <p>43 //fwrite($fd,"shi qi shi wo !");</p> 
 <p>44 //fflush($fd);</p> 
 <p>45 //fclose($fd);</p> 
 <p>46 //$fd2 = fopen("./shiqi.txt","rb");</p> 
 <p>47 //$msg = fread($fd2,filesize("./shiqi.txt"));</p> 
 <p>48 //print_r(explode(" ", $msg));</p> 
 <p>49 //unlink("./shiqi.txt");</p> 
 <p>50 //display_all_path($basePath);</p> 
 <p>51 $db_host = "localhost";</p> 
 <p>52 $db_port = "3306";</p> 
 <p>53 $db_name= "test";</p> 
 <p>54 $charset = "utf8";//别带 - utf-8 不行</p> 
 <p>55 $user_name = "root";</p> 
 <p>56 $user_pwd = "1475651660";</p> 
 <p>57 $tb_name = 'netflow';</p> 
 <p>58</p> 
 <p>59 function zifll($param,$char='0')</p> 
 <p>60 {<!-- --></p> 
 <p>61 if(!is_string($param))</p> 
 <p>62 {<!-- --></p> 
 <p>63 $param = (string)$param;</p> 
 <p>64 }</p> 
 <p>65 if(strlen($param)&lt;2)</p> 
 <p>66 {<!-- --></p> 
 <p>67 $param = "0".$param;</p> 
 <p>68 }</p> 
 <p>69 else if(strlen($param)&gt;2)</p> 
 <p>70 {<!-- --></p> 
 <p>71 $param = substr($param,strlen($param)-2);</p> 
 <p>72 }</p> 
 <p>73 return $param;</p> 
 <p>74 }</p> 
 <p>75 $conn_obj = mysqli_connect($db_host,$user_name,$user_pwd,$db_name,$db_port);</p> 
 <p>76 $conn_obj-&gt;set_charset($charset);</p> 
 <p>77 $sql = "update {$tb_name} set record_time=";</p> 
 <p>78</p> 
 <p>79 //for ($i=2;$i&lt;=26;$i++)</p> 
 <p>80 //{<!-- --></p> 
 <p>81 // $month = zifll(mt_rand(1, 6));</p> 
 <p>82 // $day = zifll(mt_rand(1,28));</p> 
 <p>83 // $hour = zifll(mt_rand(1,24));</p> 
 <p>84 // $minutes = zifll(mt_rand(0,59));</p> 
 <p>85 // $sec = zifll(mt_rand(0,59));</p> 
 <p>86 // $excute_sql = $sql . "'2020-{$month}-{$day} {$hour}:{$minutes}:{$sec}' where id={$i};";</p> 
 <p>87 // echo $excute_sql,"\n";</p> 
 <p>88 //</p> 
 <p>89 //}</p> 
 <p>90</p> 
 <p>91 $param = array(</p> 
 <p>92 'time_range'=&gt;"2020-05-03 00:00:00|2020-07-07 00:00:00",</p> 
 <p>93 'src_ip'=&gt;"192.168.0.1",</p> 
 <p>94 'src_port'=&gt;8080,</p> 
 <p>95 'dst_ip'=&gt;'',</p> 
 <p>96 'dst_port'=&gt;null,</p> 
 <p>97 'page'=&gt;0</p> 
 <p>98 );</p> 
 <p>99</p> 
 <p>100 function get_query_sql($param)</p> 
 <p>101 {<!-- --></p> 
 <p>102 $query_sql = "select * from test.netflow ";</p> 
 <p>103 if(empty($param)||!is_array($param))</p> 
 <p>104 {<!-- --></p> 
 <p>105 echo "No paramter!";</p> 
 <p>106 exit();</p> 
 <p>107 }</p> 
 <p>108 $time_rage = explode("|",$param["time_range"]);</p> 
 <p>109 if($time_rage[0])</p> 
 <p>110 {<!-- --></p> 
 <p>111 $query_sql .= "where ";</p> 
 <p>112 $query_sql .= "record_time &gt; '{$time_rage[0]}' ";</p> 
 <p>113 }</p> 
 <p>114 if($time_rage[1])</p> 
 <p>115 {<!-- --></p> 
 <p>116 $query_sql .= "and ";</p> 
 <p>117 $query_sql .= "record_time &lt; '{$time_rage[1]}' ";</p> 
 <p>118 }</p> 
 <p>119 // array_splice($param,"time_range");</p> 
 <p>120 unset($param["time_range"]);</p> 
 <p>121 foreach($param as $key=&gt;$value)</p> 
 <p>122 {<!-- --></p> 
 <p>123 if(isset($param[$key]))</p> 
 <p>124 {<!-- --></p> 
 <p>125 if ($key=="page"){<!-- --></p> 
 <p>126 $offset = $value==0?"0":(string)$value*20;</p> 
 <p>127 $query_sql .= "limit 20 offset {$offset}";</p> 
 <p>128 }</p> 
 <p>129 else if($value)</p> 
 <p>130 {<!-- --></p> 
 <p>131 $query_sql .= "and ";</p> 
 <p>132 if(is_string($value))</p> 
 <p>133 {<!-- --></p> 
 <p>134 $query_sql .= "{$key} = '{$value}' ";</p> 
 <p>135 }</p> 
 <p>136 else</p> 
 <p>137 {<!-- --></p> 
 <p>138 $query_sql .= "{$key} = {$value} ";</p> 
 <p>139 }</p> 
 <p>140 }</p> 
 <p>141</p> 
 <p>142</p> 
 <p>143 }</p> 
 <p>144 }</p> 
 <p>145 // $query_sql = $query_sql.trim();</p> 
 <p>146 $query_sql = trim($query_sql);</p> 
 <p>147 $query_sql .= ";";</p> 
 <p>148 return $query_sql;</p> 
 <p>149 }</p> 
 <p>150</p> 
 <p>151 $result = $conn_obj-&gt;query(get_query_sql($param));</p> 
 <p>152 echo json_encode($result-&gt;fetch_all(MYSQLI_ASSOC));</p> 
 <p>153 //var_dump(is_array($param));</p> 
 <p>154 ?&gt;</p> 
 <p>标签：00,time,param,value,sql,query,php,链接,clickhouse</p> 
 <p>来源： https://www.cnblogs.com/shiqi17/p/12827926.html</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b0548c583c852c59f8412b1ab9ce0d6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">clickhouse php,OrzClick: 国庆写个 ClickHouse 客户端</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c351aa772b2c86bb37cfccdea19929b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">clickhouse php,写了一个 clickhouse php tcp客户端</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>