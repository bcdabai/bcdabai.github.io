<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>React Native Jenkins 自动化打包 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="React Native Jenkins 自动化打包" />
<meta property="og:description" content="这是最近做的RN项目 jenkins 自动化打包成功实现
构建
Execute shell (脚本如下）
env
#/usr/bin/security default-keychain -d user -s /Users/ett/Library/Keychains/login.keychain
#/usr/bin/security unlock-keychain -p * /Users/ett/Library/Keychains/login.keychain
export ETT_APP_NAME=kmOnline
export ETT_WORKSPACE_NAME=ETTMallWork
export ETT_PROJECT_NAME=ETTMallWork
export ETT_SCHEME=ETTMallWork
export ETT_PROVISIONING_PROFILE=kmOnlineTestAdhotProfile
export ETT_BUILD_TYPE=.SNAPSHOT
export ETT_CONFIGURATION=Release
###############################################################################################################
#rm -rf node_modules
#npm cache verify
#mkdir node_modules
cp -r /Users/ett/Desktop/kumeng/node_modules $WORKSPACE
npm install
react-native bundle --entry-file index.js --bundle-output ./ios/main.jsbundle --platform ios
cd $WORKSPACE/ios
export ETT_JENKINS_TIME=$(date &#43;%m%d)
export ETT_GIT_COMMIT=${GIT_COMMIT:0:7}
export ETT_GIT_REV=`git rev-list HEAD | wc -l | awk &#39;{print $1}&#39;`" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8a472c4c381a70081e8bb972903ae36a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-18T18:30:09+08:00" />
<meta property="article:modified_time" content="2018-07-18T18:30:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">React Native Jenkins 自动化打包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>这是最近做的RN项目 jenkins 自动化打包成功实现</p> 
<p><img alt="" class="has" height="1018" src="https://images2.imgbox.com/b2/0b/UhD2VmYf_o.png" width="1200"></p> 
<p> </p> 
<p><img alt="" class="has" height="996" src="https://images2.imgbox.com/45/b7/XTbwKVgg_o.png" width="1200"></p> 
<p> </p> 
<p><img alt="" class="has" height="479" src="https://images2.imgbox.com/8e/a9/so3pjK2V_o.png" width="1034"></p> 
<p> </p> 
<p>构建</p> 
<p>    Execute shell  (脚本如下）</p> 
<p> </p> 
<p>env</p> 
<p>#/usr/bin/security default-keychain -d user -s /Users/ett/Library/Keychains/login.keychain<br> #/usr/bin/security unlock-keychain -p * /Users/ett/Library/Keychains/login.keychain</p> 
<p><br> export ETT_APP_NAME=kmOnline<br> export ETT_WORKSPACE_NAME=ETTMallWork<br> export ETT_PROJECT_NAME=ETTMallWork<br> export ETT_SCHEME=ETTMallWork<br> export ETT_PROVISIONING_PROFILE=kmOnlineTestAdhotProfile</p> 
<p>export ETT_BUILD_TYPE=.SNAPSHOT<br> export ETT_CONFIGURATION=Release</p> 
<p>###############################################################################################################</p> 
<p>#rm -rf  node_modules</p> 
<p>#npm cache verify<br> #mkdir node_modules<br> cp -r /Users/ett/Desktop/kumeng/node_modules   $WORKSPACE<br> npm install</p> 
<p>react-native bundle --entry-file index.js --bundle-output ./ios/main.jsbundle --platform ios</p> 
<p>cd $WORKSPACE/ios</p> 
<p>export ETT_JENKINS_TIME=$(date +%m%d)<br> export ETT_GIT_COMMIT=${GIT_COMMIT:0:7}<br> export ETT_GIT_REV=`git rev-list HEAD | wc -l | awk '{print $1}'`<br> export ETT_VERSION_PRO=`/usr/bin/agvtool mvers -terse1`<br> export ETT_VERSION_NUMBER=$ETT_VERSION_PRO$ETT_BUILD_TYPE<br> export ETT_BUILD_VERSION=$ETT_GIT_REV.$BUILD_NUMBER<br> export ETT_BUILD_ID=$ETT_VERSION_NUMBER-$ETT_JENKINS_TIME-$ETT_GIT_REV-$BUILD_NUMBER-G$ETT_GIT_COMMIT</p> 
<p> </p> 
<p>export NEXUS_JENKINS_NAME=jenkins<br> export NEXUS_JENKINS_PASSWD=jenkins20100328</p> 
<p>#adhoc_export_plist<br> export ExportOptionsPlistPath=/Users/ett/Desktop/kmOnlineProfile/adhoc_export_plist/ExportOptions.plist<br> export XCODE=/usr/bin<br> export ETT_DIST_ROOT_PATH=/Users/ett/Documents/Developer/jenkins-dist/$JOB_NAME<br> export ETT_DIST_PATH=$ETT_DIST_ROOT_PATH/$BUILD_NUMBER<br> export ETT_ARCHIVE_PATH=$ETT_DIST_PATH/$ETT_APP_NAME.xcarchive<br> export ETT_WORK_SPACE=$WORKSPACE/$ETT_WORKSPACE_NAME.xcworkspace<br> export ETT_PROJECT_SPACE=$WORKSPACE/ios/$ETT_PROJECT_NAME.xcodeproj</p> 
<p>export ETT_FILE_NAME=$ETT_APP_NAME-$ETT_BUILD_ID<br> export ETT_IPA_NAME=$ETT_FILE_NAME.ipa<br> export ETT_EXPORT_PATH=$ETT_DIST_PATH/$ETT_IPA_NAME<br> export ETT_PACKAGE_NAME=$ETT_FILE_NAME.tar.gz<br> export ETT_PACKAGE_PATH=$ETT_DIST_PATH/$ETT_PACKAGE_NAME<br> export ETT_NEXUS_FILE_NAME=$ETT_APP_NAME-$ETT_JENKINS_TIME-$BUILD_NUMBER-$ETT_GIT_COMMIT.tar.gz</p> 
<p>export ETT_UPLOAD_DSYM_SRC=$ETT_WORKSPACE_NAME.app.dSYM<br> export ETT_UPLOAD_DSYM_FILE=$ETT_FILE_NAME-dSYM.zip<br> export ETT_UPLOAD_DSYM_PATH=$ETT_DIST_PATH/$ETT_UPLOAD_DSYM_FILE</p> 
<p>if [ ! -d "$ETT_DIST_ROOT_PATH" ]; then<br>   mkdir $ETT_DIST_ROOT_PATH<br> fi<br> if [ ! -d "$ETT_DIST_PATH" ]; then<br>   mkdir $ETT_DIST_PATH<br> fi</p> 
<p>#/usr/bin/agvtool vers -terse<br> #/usr/bin/agvtool mvers -terse1</p> 
<p>/usr/bin/agvtool new-marketing-version $ETT_VERSION_PRO<br> /usr/bin/agvtool new-version -all $ETT_VERSION_PRO.$ETT_BUILD_VERSION</p> 
<p>xcodebuild   \<br> clean -project $ETT_PROJECT_SPACE \<br> -scheme $ETT_SCHEME \<br> -configuration $ETT_CONFIGURATION</p> 
<p>xcodebuild  \<br> archive   \<br> -project $ETT_PROJECT_SPACE \<br> -scheme $ETT_SCHEME \<br> -configuration $ETT_CONFIGURATION \<br> -archivePath $ETT_ARCHIVE_PATH \<br> -sdk iphoneos11.2</p> 
<p>xcodebuild  \<br> -exportArchive -archivePath  $ETT_ARCHIVE_PATH  \<br> -exportPath $ETT_EXPORT_PATH      \<br> -exportOptionsPlist $ExportOptionsPlistPath</p> 
<p><br> #$XCODE/xcodebuild clean build BITCODE_GENERATION_MODE=bitcode OTHER_CFLAGS="-fembed-bitcode" archive -archivePath $ETT_ARCHIVE_PATH -project $ETT_PROJECT_SPACE -destination generic/platform=iOS -scheme $ETT_SCHEME -configuration $ETT_CONFIGURATION -sdk iphoneos11.2<br> #$XCODE/xcodebuild -exportArchive -archivePath $ETT_ARCHIVE_PATH -exportPath $ETT_EXPORT_PATH -exportOptionsPlist $ExportOptionsPlistPath -allowProvisioningUpdates</p> 
<p> </p> 
<p> </p> 
<p>备注：常见错误</p> 
<p>1.-sdk iphoneos11.2  因为打包服务器 版本落后于开发机器上的版本，所以要加入 此项参数</p> 
<p>查看命令：xcodebuild -showsdks</p> 
<p>2.因为项目里的第三方库 不支持 Bitcode 打包方式</p> 
<p>所以</p> 
<p><img alt="" class="has" height="170" src="https://images2.imgbox.com/fa/4c/iMcboZda_o.png" width="652"></p> 
<p>3.证书配置问题：</p> 
<p>   不知道证书和描述文件具体名称或者没有plist文件 可以在手动导出ipa 文件里找到</p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7351c4487fefcb55e532cda0b3cd11fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS 时间计算</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f780033f561a0a664f48f7490a4874eb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何将类数组转换为真正的数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>