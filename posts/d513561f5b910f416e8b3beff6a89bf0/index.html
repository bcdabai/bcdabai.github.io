<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Python人工智能] 二十三.基于机器学习和TFIDF的情感分类（含详细的NLP数据清洗） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[Python人工智能] 二十三.基于机器学习和TFIDF的情感分类（含详细的NLP数据清洗）" />
<meta property="og:description" content="从本专栏开始，作者正式研究Python深度学习、神经网络及人工智能相关知识。前一篇文章分享了自定义情感词典（大连理工词典）实现情感分析和情绪分类的过程。这篇文章将详细讲解自然语言处理过程，基于机器学习和TFIDF的情感分类算法，并进行了各种分类算法（SVM、RF、LR、Boosting）对比。这篇文章主要结合作者的书籍《Python网络数据爬取及分析从入门到精通（分析篇）》进行讲解，再次带领大家好好看看Python中文文本分析的基本步骤。个人感觉还不错，基础性文章，希望对您有所帮助~
本专栏主要结合作者之前的博客、AI经验和相关视频及论文介绍，后面随着深入会讲解更多的Python人工智能案例及应用。基础性文章，希望对您有所帮助，如果文章中存在错误或不足之处，还请海涵！作者作为人工智能的菜鸟，希望大家能与我在这一笔一划的博客中成长起来。写了这么多年博客，尝试第一个付费专栏，为小宝赚点奶粉钱，但更多博客尤其基础性文章，还是会继续免费分享，该专栏也会用心撰写，望对得起读者。如果有问题随时私聊我，只望您能从这个系列中学到知识，一起加油喔~
TF下载地址：https://github.com/eastmountyxz/AI-for-TensorFlow
Keras下载地址：https://github.com/eastmountyxz/AI-for-Keras
情感分析地址：https://github.com/eastmountyxz/Sentiment-Analysis
文章目录 一.中文分词二.数据清洗三.特征提取及TF-IDF计算1.基本概念2.代码实现3.MemoryError内存溢出错误 四.基于逻辑回归的情感分类五.算法性能评估六.算法对比实验1.RandomForest2.SVM3.朴素贝叶斯4.KNN5.决策树6.SGD7.MLP8.GradientBoosting9.AdaBoost 七.总结 同时推荐前面作者另外五个Python系列文章。从2014年开始，作者主要写了三个Python系列文章，分别是基础知识、网络爬虫和数据分析。2018年陆续增加了Python图像识别和Python人工智能专栏。
Python基础知识系列：Python基础知识学习与提升Python网络爬虫系列：Python爬虫之Selenium&#43;BeautifulSoup&#43;RequestsPython数据分析系列：知识图谱、web数据挖掘及NLPPython图像识别系列：Python图像处理及图像识别Python人工智能系列：Python人工智能及知识图谱实战 前文：
[Python人工智能] 一.TensorFlow2.0环境搭建及神经网络入门
[Python人工智能] 二.TensorFlow基础及一元直线预测案例
[Python人工智能] 三.TensorFlow基础之Session、变量、传入值和激励函数
[Python人工智能] 四.TensorFlow创建回归神经网络及Optimizer优化器
[Python人工智能] 五.Tensorboard可视化基本用法及绘制整个神经网络
[Python人工智能] 六.TensorFlow实现分类学习及MNIST手写体识别案例
[Python人工智能] 七.什么是过拟合及dropout解决神经网络中的过拟合问题
[Python人工智能] 八.卷积神经网络CNN原理详解及TensorFlow编写CNN
[Python人工智能] 九.gensim词向量Word2Vec安装及《庆余年》中文短文本相似度计算
[Python人工智能] 十.Tensorflow&#43;Opencv实现CNN自定义图像分类案例及与机器学习KNN图像分类算法对比
[Python人工智能] 十一.Tensorflow如何保存神经网络参数
[Python人工智能] 十二.循环神经网络RNN和LSTM原理详解及TensorFlow编写RNN分类案例
[Python人工智能] 十三.如何评价神经网络、loss曲线图绘制、图像分类案例的F值计算
[Python人工智能] 十四.循环神经网络LSTM RNN回归案例之sin曲线预测
[Python人工智能] 十五.无监督学习Autoencoder原理及聚类可视化案例详解
[Python人工智能] 十六.Keras环境搭建、入门基础及回归神经网络案例
[Python人工智能] 十七.Keras搭建分类神经网络及MNIST数字图像案例分析
[Python人工智能] 十八.Keras搭建卷积神经网络及CNN原理详解
[Python人工智能] 十九.Keras搭建循环神经网络分类案例及RNN原理详解
[Python人工智能] 二十.基于Keras&#43;RNN的文本分类vs基于传统机器学习的文本分类
[Python人工智能] 二十一.Word2Vec&#43;CNN中文文本分类详解及与机器学习（RF\DTC\SVM\KNN\NB\LR）分类对比
[Python人工智能] 二十二.基于大连理工情感词典的情感分析和情绪计算
《人工智能狂潮》读后感——什么是人工智能？(一)
在数据分析和数据挖掘中，通常需要经历前期准备、数据爬取、数据预处理、数据分析、数据可视化、评估分析等步骤，而数据分析之前的工作几乎要花费数据工程师近一半的工作时间，其中的数据预处理也将直接影响后续模型分析的好坏。图是数据预处理的基本步骤，包括中文分词、词性标注、数据清洗、特征提取（向量空间模型存储）、权重计算（TF-IDF）等。
一.中文分词 当读者使用Python爬取了中文数据集之后，首先需要对数据集进行中文分词处理。由于英文中的词与词之间是采用空格关联的，按照空格可以直接划分词组，所以不需要进行分词处理，而中文汉字之间是紧密相连的，并且存在语义，词与词之间没有明显的分隔点，所以需要借助中文分词技术将语料中的句子按空格分割，变成一段段词序列。下面开始详细介绍中文分词技术及Jiaba中文分词工具。
中文分词（Chinese Word Segmentation）指将汉字序列切分成一个个单独的词或词串序列，它能够在没有词边界的中文字符串中建立分隔标志，通常采用空格分隔。下面举个简单示例，对句子“我是程序员”进行分词操作。
输入：我是程序员 输出1：我\是\程\序\员 输出2：我是\是程\程序\序员 输出3：我\是\程序员 简单举个例子，代码中主要导入Jieba扩展包，然后调用其函数进行中文分词。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d513561f5b910f416e8b3beff6a89bf0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-17T14:38:30+08:00" />
<meta property="article:modified_time" content="2020-08-17T14:38:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Python人工智能] 二十三.基于机器学习和TFIDF的情感分类（含详细的NLP数据清洗）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>从本专栏开始，作者正式研究Python深度学习、神经网络及人工智能相关知识。前一篇文章分享了自定义情感词典（大连理工词典）实现情感分析和情绪分类的过程。这篇文章将详细讲解自然语言处理过程，基于机器学习和TFIDF的情感分类算法，并进行了各种分类算法（SVM、RF、LR、Boosting）对比。这篇文章主要结合作者的书籍《Python网络数据爬取及分析从入门到精通（分析篇）》进行讲解，再次带领大家好好看看Python中文文本分析的基本步骤。个人感觉还不错，基础性文章，希望对您有所帮助~</p> 
<p><img src="https://images2.imgbox.com/b1/0f/5A2g0JP5_o.png" alt="在这里插入图片描述" width="650" height="300"></p> 
<p>本专栏主要结合作者之前的博客、AI经验和相关视频及论文介绍，后面随着深入会讲解更多的Python人工智能案例及应用。基础性文章，希望对您有所帮助，如果文章中存在错误或不足之处，还请海涵！作者作为人工智能的菜鸟，希望大家能与我在这一笔一划的博客中成长起来。写了这么多年博客，尝试第一个付费专栏，为小宝赚点奶粉钱，但更多博客尤其基础性文章，还是会继续免费分享，该专栏也会用心撰写，望对得起读者。如果有问题随时私聊我，只望您能从这个系列中学到知识，一起加油喔~</p> 
<p>TF下载地址：<a href="https://github.com/eastmountyxz/AI-for-TensorFlow">https://github.com/eastmountyxz/AI-for-TensorFlow</a><br> Keras下载地址：<a href="https://github.com/eastmountyxz/AI-for-Keras">https://github.com/eastmountyxz/AI-for-Keras</a><br> 情感分析地址：<a href="https://github.com/eastmountyxz/Sentiment-Analysis">https://github.com/eastmountyxz/Sentiment-Analysis</a></p> 
<br> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_63" rel="nofollow">一.中文分词</a></li><li><a href="#_105" rel="nofollow">二.数据清洗</a></li><li><a href="#TFIDF_192" rel="nofollow">三.特征提取及TF-IDF计算</a></li><li><ul><li><a href="#1_194" rel="nofollow">1.基本概念</a></li><li><a href="#2_216" rel="nofollow">2.代码实现</a></li><li><a href="#3MemoryError_309" rel="nofollow">3.MemoryError内存溢出错误</a></li></ul> 
  </li><li><a href="#_325" rel="nofollow">四.基于逻辑回归的情感分类</a></li><li><a href="#_421" rel="nofollow">五.算法性能评估</a></li><li><a href="#_603" rel="nofollow">六.算法对比实验</a></li><li><ul><li><a href="#1RandomForest_605" rel="nofollow">1.RandomForest</a></li><li><a href="#2SVM_628" rel="nofollow">2.SVM</a></li><li><a href="#3_650" rel="nofollow">3.朴素贝叶斯</a></li><li><a href="#4KNN_673" rel="nofollow">4.KNN</a></li><li><a href="#5_694" rel="nofollow">5.决策树</a></li><li><a href="#6SGD_716" rel="nofollow">6.SGD</a></li><li><a href="#7MLP_739" rel="nofollow">7.MLP</a></li><li><a href="#8GradientBoosting_763" rel="nofollow">8.GradientBoosting</a></li><li><a href="#9AdaBoost_786" rel="nofollow">9.AdaBoost</a></li></ul> 
  </li><li><a href="#_815" rel="nofollow">七.总结</a></li></ul> 
</div> 
<p></p> 
<p>同时推荐前面作者另外五个Python系列文章。从2014年开始，作者主要写了三个Python系列文章，分别是基础知识、网络爬虫和数据分析。2018年陆续增加了Python图像识别和Python人工智能专栏。</p> 
<ul><li>Python基础知识系列：<a href="https://blog.csdn.net/eastmount/category_2547623.html">Python基础知识学习与提升</a></li><li>Python网络爬虫系列：<a href="https://blog.csdn.net/eastmount/category_9264385.html">Python爬虫之Selenium+BeautifulSoup+Requests</a></li><li>Python数据分析系列：<a href="https://blog.csdn.net/eastmount/category_9265165.html">知识图谱、web数据挖掘及NLP</a></li><li>Python图像识别系列：<a href="https://blog.csdn.net/eastmount/category_9278090.html">Python图像处理及图像识别</a></li><li>Python人工智能系列：<a href="https://blog.csdn.net/eastmount/category_9292178.html">Python人工智能及知识图谱实战</a></li></ul> 
<p><img src="https://images2.imgbox.com/91/20/IBGYOyOl_o.png" alt="在这里插入图片描述"></p> 
<p>前文：<br> <a href="https://blog.csdn.net/Eastmount/article/details/103282042">[Python人工智能] 一.TensorFlow2.0环境搭建及神经网络入门</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103322331">[Python人工智能] 二.TensorFlow基础及一元直线预测案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103336214">[Python人工智能] 三.TensorFlow基础之Session、变量、传入值和激励函数</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103410289">[Python人工智能] 四.TensorFlow创建回归神经网络及Optimizer优化器</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103569858">[Python人工智能] 五.Tensorboard可视化基本用法及绘制整个神经网络</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103586271">[Python人工智能] 六.TensorFlow实现分类学习及MNIST手写体识别案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103595096">[Python人工智能] 七.什么是过拟合及dropout解决神经网络中的过拟合问题</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103620235">[Python人工智能] 八.卷积神经网络CNN原理详解及TensorFlow编写CNN</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103647573">[Python人工智能] 九.gensim词向量Word2Vec安装及《庆余年》中文短文本相似度计算</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103757386">[Python人工智能] 十.Tensorflow+Opencv实现CNN自定义图像分类案例及与机器学习KNN图像分类算法对比</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103810291">[Python人工智能] 十一.Tensorflow如何保存神经网络参数</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103811752">[Python人工智能] 十二.循环神经网络RNN和LSTM原理详解及TensorFlow编写RNN分类案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103847406">[Python人工智能] 十三.如何评价神经网络、loss曲线图绘制、图像分类案例的F值计算</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103914851">[Python人工智能] 十四.循环神经网络LSTM RNN回归案例之sin曲线预测</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103990297">[Python人工智能] 十五.无监督学习Autoencoder原理及聚类可视化案例详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104313140">[Python人工智能] 十六.Keras环境搭建、入门基础及回归神经网络案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104366166">[Python人工智能] 十七.Keras搭建分类神经网络及MNIST数字图像案例分析</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104399015">[Python人工智能] 十八.Keras搭建卷积神经网络及CNN原理详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104458677">[Python人工智能] 十九.Keras搭建循环神经网络分类案例及RNN原理详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/105165164">[Python人工智能] 二十.基于Keras+RNN的文本分类vs基于传统机器学习的文本分类</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/107004660">[Python人工智能] 二十一.Word2Vec+CNN中文文本分类详解及与机器学习（RF\DTC\SVM\KNN\NB\LR）分类对比</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/107877713">[Python人工智能] 二十二.基于大连理工情感词典的情感分析和情绪计算</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104161047">《人工智能狂潮》读后感——什么是人工智能？(一)</a></p> 
<br> 
<hr> 
<p>在数据分析和数据挖掘中，通常需要经历前期准备、数据爬取、数据预处理、数据分析、数据可视化、评估分析等步骤，而数据分析之前的工作几乎要花费数据工程师近一半的工作时间，其中的数据预处理也将直接影响后续模型分析的好坏。图是数据预处理的基本步骤，包括中文分词、词性标注、数据清洗、特征提取（向量空间模型存储）、权重计算（TF-IDF）等。</p> 
<p><img src="https://images2.imgbox.com/1c/71/k5mMyVLu_o.png" alt="在这里插入图片描述" width="550" height="300"></p> 
<br> 
<h2><a id="_63"></a>一.中文分词</h2> 
<p>当读者使用Python爬取了中文数据集之后，首先需要对数据集进行中文分词处理。由于英文中的词与词之间是采用空格关联的，按照空格可以直接划分词组，所以不需要进行分词处理，而中文汉字之间是紧密相连的，并且存在语义，词与词之间没有明显的分隔点，所以需要借助中文分词技术将语料中的句子按空格分割，变成一段段词序列。下面开始详细介绍中文分词技术及Jiaba中文分词工具。</p> 
<p>中文分词（Chinese Word Segmentation）指将汉字序列切分成一个个单独的词或词串序列，它能够在没有词边界的中文字符串中建立分隔标志，通常采用空格分隔。下面举个简单示例，对句子“我是程序员”进行分词操作。</p> 
<pre><code class="prism language-python">输入：我是程序员
输出<span class="token number">1</span>：我\是\程\序\员
输出<span class="token number">2</span>：我是\是程\程序\序员
输出<span class="token number">3</span>：我\是\程序员
</code></pre> 
<p>简单举个例子，代码中主要导入Jieba扩展包，然后调用其函数进行中文分词。</p> 
<pre><code class="prism language-python"><span class="token comment">#encoding=utf-8  </span>
<span class="token keyword">import</span> jieba  
  
text <span class="token operator">=</span> <span class="token string">"北京理工大学生前来应聘"</span>  

data <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>text<span class="token punctuation">,</span>cut_all<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment">#全模式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[全模式]: "</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  
data <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>text<span class="token punctuation">,</span>cut_all<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment">#精确模式  </span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[精确模式]: "</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
   
data <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment">#默认是精确模式 </span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[默认模式]: "</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut_for_search<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment">#搜索引擎模式   </span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[搜索引擎模式]: "</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>上述代码输出如下，包括全模式、精确模式和搜索引擎模式输出的结果。</p> 
<p><img src="https://images2.imgbox.com/62/8b/lPei1BoB_o.png" alt="在这里插入图片描述" width="600" height="150"></p> 
<br> 
<hr> 
<h2><a id="_105"></a>二.数据清洗</h2> 
<p>在分析语料的过程中，通常会存在一些脏数据或噪声词组干扰我们的实验结果，这就需要对分词后的语料进行数据清洗（Data Cleaning）。比如前面使用Jieba工具进行中文分词，它可能存在一些脏数据或停用词，如“我们”、“的”、“吗”等。这些词降低了数据质量，为了得到更好的分析结果，需要对数据集进行数据清洗或停用词过滤等操作。</p> 
<ul><li>残缺数据</li><li>重复数据</li><li>错误数据</li><li>停用词</li></ul> 
<p>这里主要讲解停用词过滤，将这些出现频率高却不影响文本主题的停用词删除。在Jieb分词过程中引入stop_words.txt停用词词典，如果存在则过滤即可。</p> 
<p><img src="https://images2.imgbox.com/1a/eb/JkA1Tib1_o.png" alt="在这里插入图片描述" width="550" height="380"></p> 
<p>下面是从大众点评、美团之类的网站抓取“黄果树瀑布”的评论信息，我们通过Jieba工具对其进行中文分词。</p> 
<ul><li>好评：5000条</li><li>差评：1000条</li></ul> 
<p><img src="https://images2.imgbox.com/c1/8e/dXjkuryN_o.png" alt="在这里插入图片描述" width="550" height="350"></p> 
<p><strong>完整代码：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> jieba<span class="token punctuation">.</span>analyse

<span class="token comment">#添加自定义词典和停用词典</span>
jieba<span class="token punctuation">.</span>load_userdict<span class="token punctuation">(</span><span class="token string">"user_dict.txt"</span><span class="token punctuation">)</span>
stop_list <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'stop_words.txt'</span><span class="token punctuation">,</span>
                        engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span>
                        encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>
                        delimiter<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                        names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#中文分词函数</span>
<span class="token keyword">def</span> <span class="token function">txt_cut</span><span class="token punctuation">(</span>juzi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>juzi<span class="token punctuation">)</span> <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> stop_list<span class="token punctuation">]</span>

<span class="token comment">#写入分词结果</span>
fw <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fenci_data.csv'</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">,</span> newline <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'gb18030'</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fw<span class="token punctuation">)</span>  
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">,</span><span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 使用csv.DictReader读取文件中的信息</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
contents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">"data.csv"</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token comment"># 数据元素获取</span>
        <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'好评'</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> <span class="token number">1</span>
        labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        content <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>
        seglist <span class="token operator">=</span> txt_cut<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        output <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>seglist<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">#空格拼接</span>
        contents<span class="token punctuation">.</span>append<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
        
        <span class="token comment">#文件写入</span>
        tlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
        tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>contents<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fw<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果如下图所示，一方面它将特殊标点符号、停用词过滤，另一方面导入了user_dict.txt词典，将“黄果树瀑布”、“风景区”等专有名词分词，否则它可能会划分为“黄果树”和“瀑布”、“风景”和“区”。</p> 
<p><img src="https://images2.imgbox.com/b5/f8/0zxgANpF_o.png" alt="在这里插入图片描述" width="550" height="400"></p> 
<ul><li><mark>数据清洗前</mark></li></ul> 
<blockquote> 
 <p>还记得小时候，常常守在电视机前，等候《西游记》的播出。“你挑着担,我牵着马。翻山涉水两肩双滑……"熟悉的歌曲，又在耳边响起时。 这歌词中的水，就有贵州的水，准确的说，是贵州的黄果树瀑布；那一帘瀑布，流进了我们的童年，让我们流连忘返。 黄果树瀑布并不是只有一个瀑布，而是一个大景区，包括陡坡塘瀑布、天星桥景区、黄果树大瀑布，其中黄果树大瀑布是最有名的。</p> 
</blockquote> 
<ul><li><mark>数据清洗后</mark></li></ul> 
<blockquote> 
 <p>记得 小时候 守 电视机 前 等候 西游记 播出 挑 担 牵 马 翻山 涉水 两肩 双滑 熟悉 歌曲 耳边 响起 时 歌词 中 水 贵州 水 准确 说 贵州 黄果树瀑布 那一帘 瀑布 流进 童年 流连忘返 黄果树瀑布 瀑布 景区 包括 陡坡 塘 瀑布 天星桥 景区 黄果树 瀑布 黄果树 瀑布 有名</p> 
</blockquote> 
<br> 
<hr> 
<h2><a id="TFIDF_192"></a>三.特征提取及TF-IDF计算</h2> 
<h3><a id="1_194"></a>1.基本概念</h3> 
<p>权重计算是指通过特征权重来衡量特征项在文档表示中的重要程度，给特征词赋予一定的权重来衡量统计文本特征词。TF-IDF（Term Frequency-Invers Document Frequency）是近年来用于数据分析和信息处理经典的权重计算技术。该技术根据特征词在文本中出现的次数和在整个语料中出现的文档频率来计算该特征词在整个语料中的重要程度，其优点是能过滤掉一些常见却无关紧要的词语，尽可能多的保留影响程度高的特征词。</p> 
<p>TF-IDF的计算公式如下，式中TF-IDF表示词频TF和倒文本词频IDF的乘积，TF-IDF中权重与特征项在文档中出现的频率成正比，与在整个语料中出现该特征项的文档数成反比。TF-IDF值越大则该特征词对这个文本的重要程度越高。</p> 
<p><img src="https://images2.imgbox.com/0c/6e/qG1OjdDN_o.png" alt="在这里插入图片描述"></p> 
<p>其中，TF词频的计算公式如下，n<sub>i,j</sub> 为特征词 t<sub>i</sub> 在训练文本 D<sub>j</sub> 中出现的次数，分母是文本 D<sub>j</sub> 中所有特征词的个数，计算的结果即为某个特征词的词频。</p> 
<p><img src="https://images2.imgbox.com/da/45/xgxwDzE3_o.png" alt="在这里插入图片描述"></p> 
<p>倒文档频率（Inverse Document Frequency，简称IDF）是Spark Jones在1972年提出的，用于计算词与文献相关权重的经典方法。计算公式如下，参数|D|表示语料的文本总数，|D<sub>t</sub>| 表示文本所包含特征词 t<sub>j</sub> 的数量。</p> 
<p><img src="https://images2.imgbox.com/cd/3e/ZbNhKYXN_o.png" alt="在这里插入图片描述"></p> 
<p>在倒文档频率方法中，权重是随着特征词的文档数量的变化呈反向变化。如某些常用词“我们”、“但是”、“的”等，在所有文档中出现频率很高，但它的IDF值却非常低。甚至如果它每篇文档都出现，则log1的计算结果为0，从而降低了这些常用词的作用；相反，如果某篇介绍“人工智能”的词，仅仅在该篇文档中出现很多次，它的作用就非常高。</p> 
<p>TF-IDF技术的核心思想是如果某个特征词在一篇文章中出现的频率TF高，并且在其他文章中很少出现，则认为此词或者短语具有很好的类别区分能力，适合用来做权重计算。TF-IDF算法简单快速，结果也符合实际情况，是文本挖掘、情感分析、主题分布等领域的常用手段。</p> 
<br> 
<h3><a id="2_216"></a>2.代码实现</h3> 
<p>Scikit-Learn中主要使用Scikit-Learn中的两个类CountVectorizer和TfidfTransformer，用来计算词频和TF-IDF值。</p> 
<ul><li><strong>CountVectorizer</strong><br> 该类是将文本词转换为词频矩阵的形式。比如“I am a teacher”文本共包含四个单词，它们对应单词的词频均为1，“I”、“am”、“a”、“teacher”分别出现一次。CountVectorizer将生成一个矩阵 a[M][N]，共M个文本语料，N个单词，比如a[i][j]表示单词j在i类文本下的词频。再调用fit_transform()函数计算各个词语出现的次数，get_feature_names()函数获取词库中的所有文本关键词。</li></ul> 
<p><img src="https://images2.imgbox.com/e2/bf/jdBB8MSg_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<ul><li><strong>TfidTransformer</strong><br> 当使用CountVectorizer类计算得到词频矩阵后，接下来通过TfidfTransformer类实现统计vectorizer变量中每个词语的TF-IDF值。TF-IDF值采用矩阵数组的形式存储，每一行数据代表一个文本语料，每一行的每一列都代表其中一个特征对应的权重，得到TF-IDF后就可以运用各种数据分析算法进行分析，比如聚类分析、LDA主题分布、舆情分析等等。</li></ul> 
<p><img src="https://images2.imgbox.com/59/a5/ZxgESi8R_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<p><strong>完整代码：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> jieba<span class="token punctuation">.</span>analyse
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse <span class="token keyword">import</span> coo_matrix
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> feature_extraction  
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> CountVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfTransformer

<span class="token comment">#----------------------------------第一步 读取文件--------------------------------</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fenci_data.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    contents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#0-好评 1-差评</span>
        contents<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>contents<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第二步 数据预处理--------------------------------</span>
<span class="token comment">#将文本中的词语转换为词频矩阵 矩阵元素a[i][j] 表示j词在i类文本下的词频</span>
vectorizer <span class="token operator">=</span> CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#该类会统计每个词语的tf-idf权值</span>
transformer <span class="token operator">=</span> TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#第一个fit_transform是计算tf-idf 第二个fit_transform是将文本转为词频矩阵</span>
tfidf <span class="token operator">=</span> transformer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>vectorizer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> tfidf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfidf<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取词袋模型中的所有词语  </span>
word <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"单词数量:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#将tf-idf矩阵抽取出来，元素w[i][j]表示j词在i类文本中的tf-idf权重</span>
<span class="token comment">#X = tfidf.toarray()</span>
X <span class="token operator">=</span> coo_matrix<span class="token punctuation">(</span>tfidf<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#稀疏矩阵 注意float</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p>输出结果如下所示：</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'scipy.sparse.csr.csr_matrix'</span><span class="token operator">&gt;</span>
aaaaa
achievements
amazing
ananananan
ancient
anshun
aperture
app

单词数量<span class="token punctuation">:</span> <span class="token number">20254</span>
<span class="token punctuation">(</span><span class="token number">6074</span><span class="token punctuation">,</span> <span class="token number">20254</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<br> 
<h3><a id="3MemoryError_309"></a>3.MemoryError内存溢出错误</h3> 
<p>当我们数据量很大时，矩阵往往存储不了这么大的数据，会出现如下错误：</p> 
<ul><li>ValueError: array is too big; arr.size * arr.dtype.itemsize is larger than the maximum possible size.</li><li>MemoryError: Unable to allocate array with shape (26771, 69602) and data type float64</li></ul> 
<p>我提供的解决方法如下：</p> 
<ul><li><strong>停用词过滤降低不需要的特征词</strong></li><li><strong>scipy包的提供了稀疏矩阵的创建，使用coo_matrix(tfidf, dtype=np.float32)转换tfidf</strong></li><li><strong>CountVectorizer(min_df=5)增加min_df参数，过滤掉出现频率少的特征词，该参数可以不断调试</strong><br> max_df用于删除过于频繁出现的术语，称为语料库特定的停用词，默认的max_df是1.0即忽略出现在100％文档的术语；min_df用于删除不经常出现的术语min_df=5表示忽略少于5个文档中出现的术语。</li><li><strong>使用GPU或扩大内存解决</strong></li></ul> 
<br> 
<hr> 
<h2><a id="_325"></a>四.基于逻辑回归的情感分类</h2> 
<p>获取文本TF-IDF值之后，本小节简单讲解使用TF-IDF值进行情感分类的过程，主要包括如下步骤：</p> 
<ul><li>对中文分词和数据清洗后的语料进行词频矩阵生成操作。主要调用CountVectorizer类计算词频矩阵，生成的矩阵为X。</li><li>调用TfidfTransformer类计算词频矩阵X的TF-IDF值，得到Weight权重矩阵。</li><li>调用Sklearn机器学习包执行分类操作，调用fit()函数训练，并将预测的类标赋值给pre数组。</li><li>调用Sklearn库PCA()函数进行降维操作，将这些特征降低为二维，对应X和Y轴，接着进行可视化呈现。</li><li>算法优化及算法评估。</li></ul> 
<p><strong>逻辑回归完整代码：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> jieba<span class="token punctuation">.</span>analyse
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse <span class="token keyword">import</span> coo_matrix
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> feature_extraction  
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> CountVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfTransformer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> neighbors
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> MultinomialNB

<span class="token comment">#----------------------------------第一步 读取文件--------------------------------</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fenci_data.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    contents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#0-好评 1-差评</span>
        contents<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>contents<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第二步 数据预处理--------------------------------</span>
<span class="token comment">#将文本中的词语转换为词频矩阵 矩阵元素a[i][j] 表示j词在i类文本下的词频</span>
vectorizer <span class="token operator">=</span> CountVectorizer<span class="token punctuation">(</span>min_df<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">#该类会统计每个词语的tf-idf权值</span>
transformer <span class="token operator">=</span> TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#第一个fit_transform是计算tf-idf 第二个fit_transform是将文本转为词频矩阵</span>
tfidf <span class="token operator">=</span> transformer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>vectorizer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> tfidf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfidf<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取词袋模型中的所有词语  </span>
word <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"单词数量:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#将tf-idf矩阵抽取出来，元素w[i][j]表示j词在i类文本中的tf-idf权重</span>
<span class="token comment">#X = tfidf.toarray()</span>
X <span class="token operator">=</span> coo_matrix<span class="token punctuation">(</span>tfidf<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#稀疏矩阵 注意float</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第三步 数据划分--------------------------------</span>
<span class="token comment">#使用 train_test_split 分割 X y 列表</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> 
                                                    labels<span class="token punctuation">,</span> 
                                                    test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> 
                                                    random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">#--------------------------------第四步 机器学习分类--------------------------------</span>
<span class="token comment"># 逻辑回归分类方法模型</span>
LR <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>solver<span class="token operator">=</span><span class="token string">'liblinear'</span><span class="token punctuation">)</span>
LR<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>LR<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> LR<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"逻辑回归分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/39/9d/CMipoJKQ_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<hr> 
<h2><a id="_421"></a>五.算法性能评估</h2> 
<p>算法评价很多实时需要我们自己编写程序去实现，比如绘制ROC曲线、统计各种特征信息、显示4位数结果。这里作者尝试自定义准确率（Precision）、召回率（Recall）和F特征值（F-measure），其计算公式如下：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
          r 
         
        
          e 
         
        
          c 
         
        
          i 
         
        
          s 
         
        
          i 
         
        
          o 
         
        
          n 
         
        
          = 
         
         
          
          
            正 
           
          
            确 
           
          
            被 
           
          
            预 
           
          
            测 
           
          
            的 
           
          
            总 
           
          
            数 
           
          
          
          
            预 
           
          
            测 
           
          
            出 
           
          
            的 
           
          
            分 
           
          
            类 
           
          
            总 
           
          
            数 
           
          
         
        
       
         Precision = \frac{正确被预测的总数}{预测出的分类总数} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.363em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.677em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord cjk_fallback">预</span><span class="mord cjk_fallback">测</span><span class="mord cjk_fallback">出</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">分</span><span class="mord cjk_fallback">类</span><span class="mord cjk_fallback">总</span><span class="mord cjk_fallback">数</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord cjk_fallback">正</span><span class="mord cjk_fallback">确</span><span class="mord cjk_fallback">被</span><span class="mord cjk_fallback">预</span><span class="mord cjk_fallback">测</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">总</span><span class="mord cjk_fallback">数</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<br> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          R 
         
        
          e 
         
        
          c 
         
        
          a 
         
        
          l 
         
        
          l 
         
        
          = 
         
         
          
          
            正 
           
          
            确 
           
          
            被 
           
          
            预 
           
          
            测 
           
          
            的 
           
          
            总 
           
          
            数 
           
          
          
          
            测 
           
          
            试 
           
          
            集 
           
          
            中 
           
          
            存 
           
          
            在 
           
          
            的 
           
          
            分 
           
          
            类 
           
          
            总 
           
          
            数 
           
          
         
        
       
         Recall = \frac{正确被预测的总数}{测试集中存在的分类总数} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.363em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.677em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord cjk_fallback">测</span><span class="mord cjk_fallback">试</span><span class="mord cjk_fallback">集</span><span class="mord cjk_fallback">中</span><span class="mord cjk_fallback">存</span><span class="mord cjk_fallback">在</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">分</span><span class="mord cjk_fallback">类</span><span class="mord cjk_fallback">总</span><span class="mord cjk_fallback">数</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord cjk_fallback">正</span><span class="mord cjk_fallback">确</span><span class="mord cjk_fallback">被</span><span class="mord cjk_fallback">预</span><span class="mord cjk_fallback">测</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">总</span><span class="mord cjk_fallback">数</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<br> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          F 
         
        
          − 
         
        
          m 
         
        
          e 
         
        
          a 
         
        
          s 
         
        
          u 
         
        
          r 
         
        
          e 
         
        
          = 
         
         
          
          
            2 
           
          
            ∗ 
           
          
            P 
           
          
            r 
           
          
            e 
           
          
            c 
           
          
            i 
           
          
            s 
           
          
            i 
           
          
            o 
           
          
            n 
           
          
            ∗ 
           
          
            R 
           
          
            e 
           
          
            c 
           
          
            a 
           
          
            l 
           
          
            l 
           
          
          
          
            ( 
           
          
            P 
           
          
            r 
           
          
            e 
           
          
            c 
           
          
            i 
           
          
            s 
           
          
            i 
           
          
            o 
           
          
            n 
           
          
            + 
           
          
            R 
           
          
            e 
           
          
            c 
           
          
            a 
           
          
            l 
           
          
            l 
           
          
            ) 
           
          
         
        
       
         F-measure = \frac{2*Precision*Recall}{(Precision+Recall)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.30744em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>由于本文主要针对2分类问题，其实验评估主要分为0和1两类，完整代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> jieba<span class="token punctuation">.</span>analyse
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse <span class="token keyword">import</span> coo_matrix
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> feature_extraction  
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> CountVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfTransformer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> neighbors
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> MultinomialNB

<span class="token comment">#----------------------------------第一步 读取文件--------------------------------</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fenci_data.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    contents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#0-好评 1-差评</span>
        contents<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>contents<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第二步 数据预处理--------------------------------</span>
<span class="token comment">#将文本中的词语转换为词频矩阵 矩阵元素a[i][j] 表示j词在i类文本下的词频</span>
vectorizer <span class="token operator">=</span> CountVectorizer<span class="token punctuation">(</span>min_df<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">#该类会统计每个词语的tf-idf权值</span>
transformer <span class="token operator">=</span> TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#第一个fit_transform是计算tf-idf 第二个fit_transform是将文本转为词频矩阵</span>
tfidf <span class="token operator">=</span> transformer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>vectorizer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> tfidf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>tfidf<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取词袋模型中的所有词语  </span>
word <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"单词数量:"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#将tf-idf矩阵抽取出来，元素w[i][j]表示j词在i类文本中的tf-idf权重</span>
<span class="token comment">#X = tfidf.toarray()</span>
X <span class="token operator">=</span> coo_matrix<span class="token punctuation">(</span>tfidf<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#稀疏矩阵 注意float</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第三步 数据划分--------------------------------</span>
<span class="token comment">#使用 train_test_split 分割 X y 列表</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> 
                                                    labels<span class="token punctuation">,</span> 
                                                    test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> 
                                                    random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">#--------------------------------第四步 机器学习分类--------------------------------</span>
<span class="token comment"># 逻辑回归分类方法模型</span>
LR <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>solver<span class="token operator">=</span><span class="token string">'liblinear'</span><span class="token punctuation">)</span>
LR<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>LR<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> LR<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"逻辑回归分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#----------------------------------第五步 评价结果--------------------------------</span>
<span class="token keyword">def</span> <span class="token function">classification_pj</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法评价:"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    
    <span class="token comment"># 正确率 Precision = 正确识别的个体总数 /  识别出的个体总数</span>
    <span class="token comment"># 召回率 Recall = 正确识别的个体总数 /  测试集中存在的个体总数</span>
    <span class="token comment"># F值 F-measure = 正确率 * 召回率 * 2 / (正确率 + 召回率)</span>

    YC_B<span class="token punctuation">,</span> YC_G <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token comment">#预测 bad good</span>
    ZQ_B<span class="token punctuation">,</span> ZQ_G <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token comment">#正确</span>
    CZ_B<span class="token punctuation">,</span> CZ_G <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token comment">#存在</span>

    <span class="token comment">#0-good 1-bad 同时计算防止类标变化</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">:</span>
        z <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">#真实 </span>
        y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">#预测</span>

        <span class="token keyword">if</span> z<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            CZ_G <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            CZ_B <span class="token operator">+=</span> <span class="token number">1</span>
            
        <span class="token keyword">if</span> y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            YC_G <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            YC_B <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token keyword">if</span> z<span class="token operator">==</span>y <span class="token operator">and</span> z<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">and</span> y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            ZQ_G <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> z<span class="token operator">==</span>y <span class="token operator">and</span> z<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">and</span> y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
            ZQ_B <span class="token operator">+=</span> <span class="token number">1</span>
        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>ZQ_B<span class="token punctuation">,</span> ZQ_G<span class="token punctuation">,</span> YC_B<span class="token punctuation">,</span> YC_G<span class="token punctuation">,</span> CZ_B<span class="token punctuation">,</span> CZ_G<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

    <span class="token comment"># 结果输出</span>
    P_G <span class="token operator">=</span> ZQ_G <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> YC_G
    P_B <span class="token operator">=</span> ZQ_B <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> YC_B
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Precision Good 0:"</span><span class="token punctuation">,</span> P_G<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Precision Bad 1:"</span><span class="token punctuation">,</span> P_B<span class="token punctuation">)</span>

    R_G <span class="token operator">=</span> ZQ_G <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> CZ_G
    R_B <span class="token operator">=</span> ZQ_B <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> CZ_B
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Recall Good 0:"</span><span class="token punctuation">,</span> R_G<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Recall Bad 1:"</span><span class="token punctuation">,</span> R_B<span class="token punctuation">)</span>

    F_G <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> P_G <span class="token operator">*</span> R_G <span class="token operator">/</span> <span class="token punctuation">(</span>P_G <span class="token operator">+</span> R_G<span class="token punctuation">)</span>
    F_B <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> P_B <span class="token operator">*</span> R_B <span class="token operator">/</span> <span class="token punctuation">(</span>P_B <span class="token operator">+</span> R_B<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"F-measure Good 0:"</span><span class="token punctuation">,</span> F_G<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"F-measure Bad 1:"</span><span class="token punctuation">,</span> F_B<span class="token punctuation">)</span>

<span class="token comment">#函数调用</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"LogisticRegression"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下：</p> 
<pre><code class="prism language-python">逻辑回归分类
<span class="token number">1823</span> <span class="token number">1823</span>
              precision    recall  f1<span class="token operator">-</span>score   support

           <span class="token number">0</span>       <span class="token number">0.94</span>      <span class="token number">0.99</span>      <span class="token number">0.97</span>      <span class="token number">1520</span>
           <span class="token number">1</span>       <span class="token number">0.93</span>      <span class="token number">0.70</span>      <span class="token number">0.80</span>       <span class="token number">303</span>

    accuracy                           <span class="token number">0.94</span>      <span class="token number">1823</span>
   macro avg       <span class="token number">0.94</span>      <span class="token number">0.85</span>      <span class="token number">0.88</span>      <span class="token number">1823</span>
weighted avg       <span class="token number">0.94</span>      <span class="token number">0.94</span>      <span class="token number">0.94</span>      <span class="token number">1823</span>

算法评价<span class="token punctuation">:</span> LogisticRegression
<span class="token number">213</span> <span class="token number">1504</span> <span class="token number">229</span> <span class="token number">1594</span> <span class="token number">303</span> <span class="token number">1520</span>

Precision Good <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0.9435382685069009</span>
Precision Bad <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0.9301310043668122</span>
Recall Good <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0.9894736842105263</span>
Recall Bad <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0.7029702970297029</span>
F<span class="token operator">-</span>measure Good <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0.9659601798330122</span>
F<span class="token operator">-</span>measure Bad <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0.800751879699248</span>
</code></pre> 
<br> 
<hr> 
<h2><a id="_603"></a>六.算法对比实验</h2> 
<h3><a id="1RandomForest_605"></a>1.RandomForest</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 随机森林分类方法模型 n_estimators：森林中树的数量</span>
clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预测结果:'</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"RandomForest"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/4e/32/tZK7PgYp_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="2SVM_628"></a>2.SVM</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># SVM分类方法模型</span>
SVM <span class="token operator">=</span> svm<span class="token punctuation">.</span>LinearSVC<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#支持向量机分类器LinearSVC</span>
SVM<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>SVM<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> SVM<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"支持向量机分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"LinearSVC"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/e0/80/qymX4CCY_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="3_650"></a>3.朴素贝叶斯</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#朴素贝叶斯模型</span>
nb <span class="token operator">=</span> MultinomialNB<span class="token punctuation">(</span><span class="token punctuation">)</span>
nb<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>nb<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> nb<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"朴素贝叶斯分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"MultinomialNB"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/08/cd/5rOHPa7A_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="4KNN_673"></a>4.KNN</h3> 
<p>该算法准确率不高，并且执行时间较长，不建议大家用于文本分析。某些情况的算法对比倒是还行，核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#最近邻算法</span>
knn <span class="token operator">=</span> neighbors<span class="token punctuation">.</span>KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span> 
knn<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>knn<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> knn<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最近邻分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"KNeighbors"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/f6/b6/DEm7nyvM_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="5_694"></a>5.决策树</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#决策树算法</span>
dtc <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
dtc<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dtc<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> dtc<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"决策树分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"DecisionTreeClassifier"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/e3/60/gMSHnPzJ_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="6SGD_716"></a>6.SGD</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#SGD分类模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model<span class="token punctuation">.</span>stochastic_gradient <span class="token keyword">import</span> SGDClassifier
sgd <span class="token operator">=</span> SGDClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
sgd<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sgd<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> sgd<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SGD分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"SGDClassifier"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/65/7f/CuBxo01g_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="7MLP_739"></a>7.MLP</h3> 
<p>该算法时间比较慢，核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#MLP分类模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neural_network<span class="token punctuation">.</span>multilayer_perceptron <span class="token keyword">import</span> MLPClassifier
mlp <span class="token operator">=</span> MLPClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
mlp<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mlp<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> mlp<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MLP分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"MLPClassifier"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/79/b3/wCaqd23P_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="8GradientBoosting_763"></a>8.GradientBoosting</h3> 
<p>该算法时间比较慢，代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#GradientBoosting分类模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingClassifier
gb <span class="token operator">=</span> GradientBoostingClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
gb<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>gb<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> gb<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GradientBoosting分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"GradientBoostingClassifier"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/f2/e2/MGgojWVv_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<h3><a id="9AdaBoost_786"></a>9.AdaBoost</h3> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#AdaBoost分类模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> AdaBoostClassifier
AdaBoost <span class="token operator">=</span> AdaBoostClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
AdaBoost<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型的准确度:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>AdaBoost<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pre <span class="token operator">=</span> AdaBoost<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AdaBoost分类"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
classification_pj<span class="token punctuation">(</span><span class="token string">"AdaBoostClassifier"</span><span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> pre<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>

</code></pre> 
<p>输出结果：</p> 
<p><img src="https://images2.imgbox.com/1e/5b/b49Lb0Jl_o.png" alt="在这里插入图片描述" width="550" height="320"></p> 
<br> 
<hr> 
<h2><a id="_815"></a>七.总结</h2> 
<p>写到这里，这篇文章就结束了，下一篇我将带领大家看看深度学习（BiLSTM-CNN）的情感分类方法。希望对您有所帮助，同时文章中不足或错误的地方，欢迎读者提出。这些实验都是我在做论文研究或项目评价常见的一些问题，希望读者带着这些问题，结合自己的需求进行深入的思考，更希望大家能学以致用。最后如果文章对您有帮助，请点赞、评论、收藏，这将是我分享最大的动力。</p> 
<p>总之，本文通过Sklearn实现了各种机器学习的情感分类算法，并且我们可以进行实验对比，如下图所示，发现随机森林、SVM、SGD、MLP效果还不错，当然不同数据集效果是不同的，大家需要结合自己的数据集去完成。github下载代码，记得关注点赞喔。</p> 
<ul><li><a href="https://github.com/eastmountyxz/Sentiment-Analysis">https://github.com/eastmountyxz/Sentiment-Analysis</a></li></ul> 
<p><img src="https://images2.imgbox.com/7d/fd/SxdMc6KO_o.png" alt="在这里插入图片描述" width="650" height="380"></p> 
<p>最后，作为人工智能的菜鸟，我希望自己能不断进步并深入，后续将它应用于图像识别、网络安全、对抗样本等领域，指导大家撰写简单的学术论文，一起加油！感谢这些年遇到很多以前进步的博友，共勉~</p> 
<p><img src="https://images2.imgbox.com/6c/f1/pWSoYHD2_o.png" alt="在这里插入图片描述" width="550" height="380"></p> 
<br> 
<p>最近参加了奇安信和清华大学举办的大数据安全比赛，收获非常多，也意识到了鸿沟般的差距。我主要分析的是HC和恶意家族网站分类，大概能从200万条真实网站钟识别了十万多个HC网站，涉及数据抓取、恶意流量检测、跳转劫持判断、NLP和大数据等方法。最后五个方向获奖的主要是清华、中科院信工所、阿里巴巴团队，也有北大、浙大、上交等团队，好厉害，好想学习他们的writeup。真的非常珍惜这样的实战机会，希望未来继续加油，某年能冲进前三名拿个奖。虽然自己很菜，但接下来还是会分享我的大数据分析方法，与大家一起进步。未知攻，焉知防，安全路上还请给位朋友和大佬多多请教，也希望自己能在学术和实战两个方向都进步。有差距不可怕，重要的是我努力过，分享过，加油。最后感谢女神点指导和开导，哈哈~</p> 
<p>(By:Eastmount 2020-08-17 周一下午3点写于武汉 <a href="http://blog.csdn.net/eastmount/">http://blog.csdn.net/eastmount/</a> )</p> 
<br> 
<hr> 
<p><mark>2020年8月18新开的“娜璋AI安全之家”，主要围绕Python大数据分析、网络空间安全、人工智能、Web渗透及攻防技术进行讲解，同时分享CCF、SCI、南核北核论文的算法实现。娜璋之家会更加系统，并重构作者的所有文章，从零讲解Python和安全，写了近十年文章，真心想把自己所学所感所做分享出来，还请各位多多指教，真诚邀请您的关注！谢谢。</mark></p> 
<div align="center"> 
 <img src="https://images2.imgbox.com/f8/3b/3EIhOpNO_o.png" height="20%" width="20%"> 
</div> 
<p>参考文献：<br> [1] 杨秀璋《Python网络数据爬取及分析从入门到精通（分析篇）》<br> [2] <a href="https://blog.csdn.net/WANG_hl/article/details/105234432">https://blog.csdn.net/WANG_hl/article/details/105234432</a><br> [3] <a href="https://blog.csdn.net/WANG_hl/article/details/105234432">https://blog.csdn.net/qq_27590277/article/details/106894245</a><br> [4] <a href="https://blog.csdn.net/WANG_hl/article/details/105234432">https://www.cnblogs.com/alivinfer/p/12892147.html</a><br> [5] <a href="https://blog.csdn.net/WANG_hl/article/details/105234432">https://blog.csdn.net/qq_28626909/article/details/80382029</a><br> [6] <a href="https://blog.csdn.net/WANG_hl/article/details/105234432">https://www.jianshu.com/p/3da3f5608a7c</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a270d9bd92a2c4d2bec88d10d1ca2f53/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python数据可视化的例子——条形图（bar）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57b3bcf703e58fdaa140b6cfb7c659f0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PyCharm 编写 Numpy 程序时报 No module named ‘numpy‘ 错误的解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>