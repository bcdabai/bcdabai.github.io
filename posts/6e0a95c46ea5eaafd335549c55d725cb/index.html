<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【云原生】k8s管理工具--Kubectl（二） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【云原生】k8s管理工具--Kubectl（二）" />
<meta property="og:description" content="k8s管理工具--Kubectl（二） 一、项目生命周期1、项目生命周期2、创建kubectl run命令3、发布kubectl expose命令（1） Service的作用（2）Service的类型（3）查看Pod网络状态详细信息和Service暴露端口（4）查看关联后端的节点（5）查看service的描述信息（6）查看日志 二、更新kubectl set1、获取修改模板2、查看当前nginx版本3、将nginx版本更新为1.15 三、回滚kubectl rollout1、查看历史版本2、执行回滚到上一个版本3、执行回滚到指定版本4、检查回滚状态 四、实现负载均衡1、首先在node1 node2节点安装ipvsadm2、在master01节点分别在3个pod内写入网页文件 五、删除kubectl delete1、删除副本控制器2、删除service 六、金丝雀发布1、更新deployment的版本，并配置暂停deployment2、查看更新3、确保更新的pod没问题了，继续更新 一、项目生命周期 1、项目生命周期 创建–&gt;发布–&gt;更新–&gt;回滚–&gt;删除
2、创建kubectl run命令 创建并运行一个或多个容器镜像
创建一个deployment或job来管理容器
kubectl run --help查看使用帮助
启动nginx实例，暴露容器端口80，设置副本数3
[root@master01 ~]#kubectl create deployment nginx --image=nginx:1.14 --port=80 --replicas=3 3、发布kubectl expose命令 将资源暴露为新的Service
为Deployment的nginx创建Service，并通过Service的80端口转发至容器的80端口上，Service的名称为nginx-service，类型为NodePort。
[root@master01 ~]#kubectl expose deployment nginx --port=80 --target-port=80 --name=nginx-service --type=NodePort （1） Service的作用 Kubernetes之所以需要Service，一方面是因为Pod的IP不是固定的（Pod可能会重建），另一方面是因为一组Pod实例之间总会有负载均衡的需求。Service通过Label Selector实现的对一组的Pod的访问。对于容器应用而言，Kubernetes提供了基于VIP（虚拟IP）的网桥的方式访问Service，再由Service重定向到相应的Pod。 （2）Service的类型 ClusterIP:提供一个集群内部的虚拟IP以供Pod访问（Service默认类型）NodePort:在每个Node上打开一个端口以供外部访问，Kubernetes将会在每个Node上打开一个端口并且每个Node的端口都是一样的，通过NodeIP:NodePort的方式LoadBalancer:通过外部的负载均衡器来访问，通常在云平台部署LoadBalancer还需要额外的费用。 （3）查看Pod网络状态详细信息和Service暴露端口 （4）查看关联后端的节点 （5）查看service的描述信息 （6）查看日志 二、更新kubectl set 1、获取修改模板 2、查看当前nginx版本 3、将nginx版本更新为1.15 注：更新规则可通过“kubetl describe deployment nginx”的“RollingUpdateStrategy”查看，默认配置为“25% max unavailable, 25% max surge”，即按照25%的比例进行滚动更新。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6e0a95c46ea5eaafd335549c55d725cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-17T21:01:17+08:00" />
<meta property="article:modified_time" content="2023-05-17T21:01:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【云原生】k8s管理工具--Kubectl（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>k8s管理工具--Kubectl（二）</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、项目生命周期</a></li><li><ul><li><a href="#1_2" rel="nofollow">1、项目生命周期</a></li><li><a href="#2kubectl_run_5" rel="nofollow">2、创建kubectl run命令</a></li><li><a href="#3kubectl_expose_19" rel="nofollow">3、发布kubectl expose命令</a></li><li><ul><li><a href="#1_Service_28" rel="nofollow">（1） Service的作用</a></li><li><a href="#2Service_34" rel="nofollow">（2）Service的类型</a></li><li><a href="#3PodService_40" rel="nofollow">（3）查看Pod网络状态详细信息和Service暴露端口</a></li><li><a href="#4_42" rel="nofollow">（4）查看关联后端的节点</a></li><li><a href="#5service_44" rel="nofollow">（5）查看service的描述信息</a></li><li><a href="#6_46" rel="nofollow">（6）查看日志</a></li></ul> 
   </li></ul> 
   </li><li><a href="#kubectl_set_48" rel="nofollow">二、更新kubectl set</a></li><li><ul><li><a href="#1_49" rel="nofollow">1、获取修改模板</a></li><li><a href="#2nginx_51" rel="nofollow">2、查看当前nginx版本</a></li><li><a href="#3nginx115_53" rel="nofollow">3、将nginx版本更新为1.15</a></li></ul> 
   </li><li><a href="#kubectl_rollout_59" rel="nofollow">三、回滚kubectl rollout</a></li><li><ul><li><a href="#1_63" rel="nofollow">1、查看历史版本</a></li><li><a href="#2_65" rel="nofollow">2、执行回滚到上一个版本</a></li><li><a href="#3_67" rel="nofollow">3、执行回滚到指定版本</a></li><li><a href="#4_69" rel="nofollow">4、检查回滚状态</a></li></ul> 
   </li><li><a href="#_71" rel="nofollow">四、实现负载均衡</a></li><li><ul><li><a href="#1node1_node2ipvsadm_72" rel="nofollow">1、首先在node1 node2节点安装ipvsadm</a></li><li><a href="#2master013pod_77" rel="nofollow">2、在master01节点分别在3个pod内写入网页文件</a></li></ul> 
   </li><li><a href="#kubectl_delete_80" rel="nofollow">五、删除kubectl delete</a></li><li><ul><li><a href="#1_81" rel="nofollow">1、删除副本控制器</a></li><li><a href="#2service_83" rel="nofollow">2、删除service</a></li></ul> 
   </li><li><a href="#_85" rel="nofollow">六、金丝雀发布</a></li><li><ul><li><a href="#1deploymentdeployment_95" rel="nofollow">1、更新deployment的版本，并配置暂停deployment</a></li><li><a href="#2_97" rel="nofollow">2、查看更新</a></li><li><a href="#3pod_99" rel="nofollow">3、确保更新的pod没问题了，继续更新</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、项目生命周期</h3> 
<h4><a id="1_2"></a>1、项目生命周期</h4> 
<p>创建–&gt;发布–&gt;更新–&gt;回滚–&gt;删除</p> 
<h4><a id="2kubectl_run_5"></a>2、创建kubectl run命令</h4> 
<ul><li> <p>创建并运行一个或多个容器镜像</p> </li><li> <p>创建一个deployment或job来管理容器</p> </li><li> <p>kubectl run --help查看使用帮助</p> </li></ul> 
<p><strong>启动nginx实例，暴露容器端口80，设置副本数3</strong></p> 
<pre><code>[root@master01 ~]#kubectl create deployment nginx --image=nginx:1.14 --port=80 --replicas=3
</code></pre> 
<p><img src="https://images2.imgbox.com/88/8d/LwlZNuf5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/66/1d/lwsX2QNK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3kubectl_expose_19"></a>3、发布kubectl expose命令</h4> 
<p><strong>将资源暴露为新的Service</strong></p> 
<p>为Deployment的nginx创建Service，并通过Service的80端口转发至容器的80端口上，Service的名称为nginx-service，类型为NodePort。</p> 
<pre><code>[root@master01 ~]#kubectl expose deployment nginx --port=80 --target-port=80 --name=nginx-service --type=NodePort 
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/66/WwY1YXiN_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1_Service_28"></a>（1） Service的作用</h5> 
<ul><li>Kubernetes之所以需要Service，一方面是因为Pod的IP不是固定的（Pod可能会重建），另一方面是因为一组Pod实例之间总会有负载均衡的需求。</li><li>Service通过Label Selector实现的对一组的Pod的访问。</li><li>对于容器应用而言，Kubernetes提供了基于VIP（虚拟IP）的网桥的方式访问Service，再由Service重定向到相应的Pod。</li></ul> 
<h5><a id="2Service_34"></a>（2）Service的类型</h5> 
<ul><li><strong>ClusterIP</strong>:提供一个集群内部的虚拟IP以供Pod访问（Service默认类型）</li><li><strong>NodePort</strong>:在每个Node上打开一个端口以供外部访问，Kubernetes将会在每个Node上打开一个端口并且每个Node的端口都是一样的，通过NodeIP:NodePort的方式</li><li><strong>LoadBalancer</strong>:通过外部的负载均衡器来访问，通常在云平台部署LoadBalancer还需要额外的费用。</li></ul> 
<h5><a id="3PodService_40"></a>（3）查看Pod网络状态详细信息和Service暴露端口</h5> 
<p><img src="https://images2.imgbox.com/7c/8b/CvZb0emJ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_42"></a>（4）查看关联后端的节点</h5> 
<p><img src="https://images2.imgbox.com/1f/12/JUFjVdgo_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5service_44"></a>（5）查看service的描述信息</h5> 
<p><img src="https://images2.imgbox.com/c6/58/RudK1BQZ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="6_46"></a>（6）查看日志</h5> 
<p><img src="https://images2.imgbox.com/c4/cd/RG2iX3zx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="kubectl_set_48"></a>二、更新kubectl set</h3> 
<h4><a id="1_49"></a>1、获取修改模板</h4> 
<p><img src="https://images2.imgbox.com/46/79/ZldJzYQW_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2nginx_51"></a>2、查看当前nginx版本</h4> 
<p><img src="https://images2.imgbox.com/44/a5/1xLVY91R_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3nginx115_53"></a>3、将nginx版本更新为1.15</h4> 
<p><img src="https://images2.imgbox.com/98/af/GUEJI5da_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/69/16/mZAXnsmz_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注</strong>：<strong>更新规则可通过“kubetl describe deployment nginx”的“RollingUpdateStrategy”查看，默认配置为“25% max unavailable, 25% max surge”，即按照25%的比例进行滚动更新。</strong><br> <img src="https://images2.imgbox.com/8c/dd/GQFaI5ff_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="kubectl_rollout_59"></a>三、回滚kubectl rollout</h3> 
<p>对资源进行回滚</p> 
<p><strong>kubectl rollout --help查看使用帮助</strong></p> 
<h4><a id="1_63"></a>1、查看历史版本</h4> 
<p><img src="https://images2.imgbox.com/f5/f1/5k3ZRlry_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_65"></a>2、执行回滚到上一个版本</h4> 
<p><img src="https://images2.imgbox.com/7d/5b/Icqldgdh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_67"></a>3、执行回滚到指定版本</h4> 
<p><img src="https://images2.imgbox.com/b9/c6/1if7vfX6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_69"></a>4、检查回滚状态</h4> 
<p><img src="https://images2.imgbox.com/8e/a2/20uwuw8N_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_71"></a>四、实现负载均衡</h3> 
<h4><a id="1node1_node2ipvsadm_72"></a>1、首先在node1 node2节点安装ipvsadm</h4> 
<pre><code>[root@node01 ~]# yum install ipvsadm.x86_64 -y
[root@node02 ~]#yum install ipvsadm.x86_64  -y
</code></pre> 
<h4><a id="2master013pod_77"></a>2、在master01节点分别在3个pod内写入网页文件</h4> 
<p><img src="https://images2.imgbox.com/d7/ba/TWrOPHQG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0e/34/QKY7AhoR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="kubectl_delete_80"></a>五、删除kubectl delete</h3> 
<h4><a id="1_81"></a>1、删除副本控制器</h4> 
<p><img src="https://images2.imgbox.com/34/6d/zUUD8koB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2service_83"></a>2、删除service</h4> 
<p><img src="https://images2.imgbox.com/a3/6b/RP9VVytB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_85"></a>六、金丝雀发布</h3> 
<p>Deployment控制器支持自定义控制更新过程中的滚动节奏，如“暂停(pause)”或“继续(resume)”更新操作。比如等待第一批新的Pod资源创建完成后立即暂停更新过程，此时，仅存在一部分新版本的应用，主体部分还是旧的版本。然后，再筛选一小部分的用户请求路由到新版本的Pod应用，继续观察能否稳定地按期望的方式运行。确定没问题之后再继续完成余下的Pod资源滚动更新，否则立即回滚更新操作。这就是所谓的金丝雀发布。</p> 
<p><strong>蓝绿发布</strong>：是指在生产环境中同时部署两个版本的应用程序，一个是当前正在使用的稳定版本（蓝色），<br> 另一个是新版本（绿色）。新版本在生产环境中进行测试，直到它被确认为稳定可靠后，再将流量逐渐切换到新版本上。这种发布方式可以保证系统的高可用性和稳定性。就是两套设备进行新旧版本的切换，用户毫无感知业务稳定。 缺点：要消耗2倍的资源成本特别高。</p> 
<p><strong>滚动发布</strong>：是指在生产环境中逐步推出新版本，将新版本逐步扩展到整个系统。这种发布方式可以逐步发现和解决问题，降低风险，并且可以确保系统一直处于可用状态。安装比例一部分一部分滚动更新，k8s默认的更新机制，无法创建一定比例的新pod，再删除一定旧的pod。</p> 
<p><strong>灰度发布</strong>：是一种软件发布策略，它是在生产环境中逐步将新版本的应用程序发布给一小部分用户，以便测试新版本的功能和性能，以及发现和解决潜在的问题。这种发布方式可以减少风险，因为只有一小部分用户会受到影响，同时也可以获得反馈和数据来帮助改进应用程序。一旦新版本被确认为稳定可靠，就可以逐步将其推出到整个系统中。先更新一部分pod，然后暂停更新 ，安排一小部分用户的流量去访问这部分行的pod，当测试没问题再扩大测试比例。</p> 
<h4><a id="1deploymentdeployment_95"></a>1、更新deployment的版本，并配置暂停deployment</h4> 
<p><img src="https://images2.imgbox.com/18/93/L72qJjky_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_97"></a>2、查看更新</h4> 
<p><img src="https://images2.imgbox.com/4c/47/GjS6AtYw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3pod_99"></a>3、确保更新的pod没问题了，继续更新</h4> 
<p><img src="https://images2.imgbox.com/e3/ef/Zw7lJv4S_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e9/3d/tjl8t01a_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8a/85/i27htmtm_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/579f216c255f04500e7e7bffde70eff0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">嵌入式Linux开发工具5.16</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2c041fe599b0827f935746f5cdf78639/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【计算机毕设】基于SringBoot&#43;Vue的校园二手交易平台（含支付）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>