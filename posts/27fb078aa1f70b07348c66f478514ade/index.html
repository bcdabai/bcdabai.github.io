<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【GAMES201学习笔记】物质点法入门 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【GAMES201学习笔记】物质点法入门" />
<meta property="og:description" content="1. 流体力学中的两种描述 1.1 拉格朗日描述 1.1.1 什么是拉格朗日描述 拉格朗日描述 的观察对象是组成物体的 质点 ， 粒子（particle） ，或者说 流体微元 ：
随着物体变化，对应 “粒子” 的位置也会随之变化，跟踪的观察对象是单个 “粒子” 的属性变化；拉格朗日描述最显著的特征就是观察对象会发生位置或者形状的变换。 1.1.2 常见的使用拉格朗日描述的方法 弹簧质点模型（观察质点的变换）有限元法（观察有限微元的变换） 1.1.3 拉格朗日描述擅长的地方 拉格朗日描述擅长对独立粒子的操作；物体的变换操作：这时对粒子施加相应的变换即可；粒子的质量和动量守恒是简单的；定义物体的材质：定义单个粒子相关参数。 1.1.4 拉格朗日描述不擅长的地方 由于粒子经过变换之后，对应的位置和形变都是不确定的，因此虽然可以查询之前已经建立了 邻接信息 的粒子之间的关系（当然，在拉格朗日中找邻接粒子本身是一个困难的问题）；但查询未确立 邻接信息 的粒子之间的关系（例如任意两个粒子之间的距离），会异常困难。
这导致当有查询 未邻接的两个粒子 之间关系的需求时，会遇到一定的麻烦：例如在使用有限元进行仿真时，如果没有合理处理自相交问题，会发生模型穿透的情况。
弹性方块的 FEM 模拟 ：
弹性平面的 FEM 模拟 ：
由于仅做了邻接粒子之间、粒子与球之间的碰撞检测，所以在平面折叠时发生了穿透。 不过目前在有限元领域，对于碰撞问题，也已经有了对应的解决方案：
[SIGGRAPH 2020] Incremental Potential Contact (IPC) 1.2 欧拉描述 1.2.1 什么是欧拉描述 欧拉描述 的观察对象是物体所在 空间的场 ， 网格（Grid） ，或者说 流体元胞（Cell） ：
网格是在空间中的绝对参照系的微元，随着物体变化，网格的位置和形状不会随之变化，仅物体映射到网格上的信息发生改变；欧拉描述最显著的特征就是观察对象不会发生位置或者形状的变换。 1.2.2 欧拉描述擅长的地方 拉格朗日描述擅长处理粒子之间的相对关系；物体性质的变化：质量密度、速度、温度、熵、焓，甚至单位流体中的磁通量；物体内部的压力压强计算，可以很快的获得能量密度函数；边界碰撞检测：欧拉描述可以很快的获得任意粒子之间的相对关系信息，或者说在欧拉视角下物体自然而然地在进行着碰撞检测。 1.2.3 欧拉描述不擅长的地方 物体的变换：显然，拉格朗日描述擅长的地方就是欧拉描述不擅长的地方，在物体发生变换的过程中，需要更新网格和相邻网格的信息，这个过程是较为繁琐的。 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/27fb078aa1f70b07348c66f478514ade/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-25T21:19:16+08:00" />
<meta property="article:modified_time" content="2021-05-25T21:19:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【GAMES201学习笔记】物质点法入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__1"></a>1. 流体力学中的两种描述</h2> 
<h3><a id="11__3"></a>1.1 拉格朗日描述</h3> 
<h4><a id="111__5"></a>1.1.1 什么是拉格朗日描述</h4> 
<p><strong>拉格朗日描述</strong> 的观察对象是组成物体的 <strong>质点</strong> ， <strong>粒子（particle）</strong> ，或者说 <strong>流体微元</strong> ：</p> 
<ul><li>随着物体变化，对应 “粒子” 的位置也会随之变化，跟踪的观察对象是单个 “粒子” 的属性变化；</li><li>拉格朗日描述最显著的特征就是观察对象会发生位置或者形状的变换。</li></ul> 
<h4><a id="112__11"></a>1.1.2 常见的使用拉格朗日描述的方法</h4> 
<ul><li>弹簧质点模型（观察质点的变换）</li><li>有限元法（观察有限微元的变换）</li></ul> 
<h4><a id="113__17"></a>1.1.3 拉格朗日描述擅长的地方</h4> 
<ul><li>拉格朗日描述擅长对独立粒子的操作；</li><li>物体的变换操作：这时对粒子施加相应的变换即可；</li><li>粒子的质量和动量守恒是简单的；</li><li>定义物体的材质：定义单个粒子相关参数。</li></ul> 
<h4><a id="114__24"></a>1.1.4 拉格朗日描述不擅长的地方</h4> 
<p>由于粒子经过变换之后，对应的位置和形变都是不确定的，因此虽然可以查询之前已经建立了 <strong>邻接信息</strong> 的粒子之间的关系（当然，在拉格朗日中找邻接粒子本身是一个困难的问题）；但查询未确立 <strong>邻接信息</strong> 的粒子之间的关系（例如任意两个粒子之间的距离），会异常困难。</p> 
<p>这导致当有查询 <strong>未邻接的两个粒子</strong> 之间关系的需求时，会遇到一定的麻烦：例如在使用有限元进行仿真时，如果没有合理处理自相交问题，会发生模型穿透的情况。</p> 
<p><strong>弹性方块的 FEM 模拟</strong> ：</p> 
<p><img src="https://images2.imgbox.com/9e/d8/5Carw1Ke_o.gif" alt="FEM_Cube.gif"></p> 
<p><strong>弹性平面的 FEM 模拟</strong> ：</p> 
<ul><li>由于仅做了邻接粒子之间、粒子与球之间的碰撞检测，所以在平面折叠时发生了穿透。</li></ul> 
<p><img src="https://images2.imgbox.com/37/30/UCbsDDLb_o.gif" alt="FEM_Plane.gif"></p> 
<p>不过目前在有限元领域，对于碰撞问题，也已经有了对应的解决方案：</p> 
<ul><li><a href="https://zhuanlan.zhihu.com/p/154542103" rel="nofollow">[SIGGRAPH 2020] Incremental Potential Contact (IPC)</a></li></ul> 
<h3><a id="12__46"></a>1.2 欧拉描述</h3> 
<h4><a id="121__48"></a>1.2.1 什么是欧拉描述</h4> 
<p><strong>欧拉描述</strong> 的观察对象是物体所在 <strong>空间的场</strong> ， <strong>网格（Grid）</strong> ，或者说 <strong>流体元胞（Cell）</strong> ：</p> 
<ul><li>网格是在空间中的绝对参照系的微元，随着物体变化，网格的位置和形状不会随之变化，仅物体映射到网格上的信息发生改变；</li><li>欧拉描述最显著的特征就是观察对象不会发生位置或者形状的变换。</li></ul> 
<h4><a id="122__54"></a>1.2.2 欧拉描述擅长的地方</h4> 
<ul><li>拉格朗日描述擅长处理粒子之间的相对关系；</li><li>物体性质的变化：质量密度、速度、温度、熵、焓，甚至单位流体中的磁通量；</li><li>物体内部的压力压强计算，可以很快的获得能量密度函数；</li><li>边界碰撞检测：欧拉描述可以很快的获得任意粒子之间的相对关系信息，或者说在欧拉视角下物体自然而然地在进行着碰撞检测。</li></ul> 
<h4><a id="123__61"></a>1.2.3 欧拉描述不擅长的地方</h4> 
<ul><li>物体的变换：显然，拉格朗日描述擅长的地方就是欧拉描述不擅长的地方，在物体发生变换的过程中，需要更新网格和相邻网格的信息，这个过程是较为繁琐的。</li></ul> 
<h2><a id="2_ParticleInCell_methodsPIC_66"></a>2. Particle-In-Cell methods(PIC)</h2> 
<p><strong>Note</strong> ：</p> 
<ul><li>在混合拉格朗日 - 欧拉方法中，“粒子”是一等公民，“网格”是用来计算场信息的中间量。</li></ul> 
<h3><a id="21_P2G_70"></a>2.1 粒子信息映射到网格（P2G）</h3> 
<h4><a id="211__72"></a>2.1.1 思路</h4> 
<p>将粒子信息映射到网格上，或者说从一组粒子重建整个场的信息，这里采用了一个 SPH 中处理类似问题的方法：</p> 
<ul><li>使用一个径向对称的 <strong>核函数</strong> （有时称为 <strong>基函数</strong> ），来确定一个粒子对周边空间的 “影响（贡献）”，即一种加权计算 ；</li><li>其中粒子的影响是局部化的，核函数通常选择 <strong>有限支撑</strong> ，即存在一个最大支撑距离；</li><li>核函数是归一化的： <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           ∮ 
          
         
           R 
          
         
         
         
           N 
          
         
           ^ 
          
         
        
          ( 
         
        
          r 
         
        
          ) 
         
        
          d 
         
        
          r 
         
        
          = 
         
        
          1 
         
        
       
         \oint_{R} \hat{N}(\bold{r})d\bold{r} = 1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.30259em; vertical-align: -0.35582em;"></span><span class="mop"><span class="mop op-symbol small-op" style="margin-right: 0.19445em; position: relative; top: -0.00056em;">∮</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.122511em;"><span class="" style="top: -2.34418em; margin-left: -0.19445em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.00773em;">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35582em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.94677em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">r</span></span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathbf">r</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span> ，其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          R 
         
        
       
         R 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span> 是整个支撑集。</li></ul> 
<p><strong>B 样条核函数</strong> ：</p> 
<p><img src="https://images2.imgbox.com/27/e8/nQmesdwU_o.png" alt="screenShot.png"></p> 
<p>在二维空间下，仅考虑粒子周围的九个网格节点。</p> 
<p><img src="https://images2.imgbox.com/aa/23/YtuSHHy4_o.png" alt="screenShot.png"></p> 
<h4><a id="212__88"></a>2.1.2 代码实现</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 30,42 （除去了 APIC 的部分）：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        <span class="token comment"># Quadratic B-spline</span>
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y
            grid_v<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> <span class="token punctuation">(</span>p_mass <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span>
            grid_m<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> p_mass
</code></pre> 
<p><strong>Note</strong> ：</p> 
<ul><li>粒子在中间网格里；</li><li><code>base</code> ：粒子所在周边网格的网格点 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           p 
          
          
          
            [ 
           
          
            0 
           
          
            , 
           
          
            0 
           
          
            ] 
           
          
         
        
       
         \bold{p}_{[0,0]} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.79964em; vertical-align: -0.3552em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span></span> ，坐标 <code>(0.5 * dx, 0.5 * dx)</code> ；</li><li><code>fx</code> ：粒子距离网格点 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           p 
          
          
          
            [ 
           
          
            0 
           
          
            , 
           
          
            0 
           
          
            ] 
           
          
         
        
       
         \bold{p}_{[0,0]} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.79964em; vertical-align: -0.3552em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 的距离；<br>  </li><li>距离中间的网格点：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ω 
         
        
          = 
         
         
         
           3 
          
         
           4 
          
         
        
          − 
         
        
          ∣ 
         
        
          ( 
         
         
         
           x 
          
         
           p 
          
         
        
          − 
         
         
         
           x 
          
          
          
            b 
           
          
            a 
           
          
            s 
           
          
            e 
           
          
         
        
          ) 
         
        
          − 
         
        
          1 
         
         
         
           ∣ 
          
         
           2 
          
         
        
       
         \omega = \frac{3}{4} - \vert (\bold{x}_p - \bold{x}_{base}) - 1 \vert^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord">∣</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><br>  </li><li>距离靠左下的网格点：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ω 
         
        
          = 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
         
         
           3 
          
         
           2 
          
         
        
          − 
         
        
          ∣ 
         
         
         
           x 
          
         
           p 
          
         
        
          − 
         
         
         
           x 
          
          
          
            b 
           
          
            a 
           
          
            s 
           
          
            e 
           
          
         
        
          ∣ 
         
         
         
           ) 
          
         
           2 
          
         
        
       
         \omega = \frac{1}{2}(\frac{3}{2} - \vert \bold{x}_p - \bold{x}_{base} \vert)^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><br>  </li><li>距离靠右上的网格点：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ω 
         
        
          = 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
        
          2 
         
        
          − 
         
        
          ( 
         
         
         
           3 
          
         
           2 
          
         
        
          − 
         
        
          ∣ 
         
         
         
           x 
          
         
           p 
          
         
        
          − 
         
         
         
           x 
          
          
          
            b 
           
          
            a 
           
          
            s 
           
          
            e 
           
          
         
        
          ∣ 
         
        
          ) 
         
         
         
           ) 
          
         
           2 
          
         
        
          = 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
        
          ∣ 
         
         
         
           x 
          
         
           p 
          
         
        
          − 
         
         
         
           x 
          
          
          
            b 
           
          
            a 
           
          
            s 
           
          
            e 
           
          
         
        
          ∣ 
         
        
          − 
         
         
         
           1 
          
         
           2 
          
         
         
         
           ) 
          
         
           2 
          
         
        
       
         \omega = \frac{1}{2}(2 - (\frac{3}{2} - \vert \bold{x}_p - \bold{x}_{base} \vert))^2 = \frac{1}{2}(\vert \bold{x}_p - \bold{x}_{base} \vert - \frac{1}{2})^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></li></ul> 
<p><img src="https://images2.imgbox.com/00/19/0arFNeH2_o.png" alt="screenShot.png"></p> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 43,46：</p> 
<pre><code class="prism language-python"><span class="token comment"># 对速度做一个网格质量的加权平均</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> grid_m<span class="token punctuation">:</span>
        <span class="token keyword">if</span> grid_m<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/=</span> grid_m<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>
        grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-=</span> dt <span class="token operator">*</span> gravity
</code></pre> 
<h3><a id="22_G2P_130"></a>2.2 网格信息叠加到粒子（G2P）</h3> 
<h4><a id="211__132"></a>2.1.1 思路</h4> 
<p>在计算完网格上各种场的对应信息之后，将周围网格的信息叠加到原粒子上。</p> 
<h4><a id="222__136"></a>2.2.2 代码实现</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 55,68 （除去了 APIC 的部分）：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        <span class="token comment"># Quadratic B-spline </span>
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>

        new_v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y
            new_v <span class="token operator">+=</span> weight <span class="token operator">*</span> g_v

        v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> new_v
        x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> dt <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="23_PIC__160"></a>2.3 PIC 的局限性</h3> 
<p>主要是在 G2P 的过程中，粒子信息是由网格信息叠加而成的，存在大量的信息缺失，直观来说就是出现了能量损耗，主要在旋转和切变的过程（主要是角动量损耗及其严重）。</p> 
<ul><li>以速度场为例，粒子拥有 2 个自由度，而一个 3×3 的网格点有 18 个自由度：</li></ul> 
<p><img src="https://images2.imgbox.com/db/8e/6KD7gK4Y_o.png" alt="screenShot.png"></p> 
<h2><a id="3_Affine_ParticleInCellAPIC_169"></a>3. Affine Particle-In-Cell（APIC）</h2> 
<h3><a id="31_APIC__171"></a>3.1 APIC 简介</h3> 
<p><img src="https://images2.imgbox.com/35/fa/kHRQAfUj_o.png" alt="screenShot.png"></p> 
<p>通过 2.3 可知，PIC 在场信息到粒子信息的过程中存在信息缺失的情况，这时不妨在这个过程中存储更多的场的信息：</p> 
<table><thead><tr><th>符 号</th><th>含 义</th></tr></thead><tbody><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             v 
            
           
             0 
            
           
          
         
           \bold{v}_0 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 、 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             v 
            
           
             1 
            
           
          
         
           \bold{v}_1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></td><td>均匀常量速度场，描述粒子原本的 2 个自由度的速度信息，不会随着 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             x 
            
           
             p 
            
           
          
         
           \bold{x}_p 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.730548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 位置的变化而变化。</td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             C 
            
           
             00 
            
           
          
         
           \bold{C}_{00} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></td><td>随着粒子在 x 分量的变化，在 x 分量上线性变化的速度场，场的分量 <code>C[0]</code> 随着 <code>x[p][0]</code> 变化的情况。</td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             C 
            
           
             10 
            
           
          
         
           \bold{C}_{10} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></td><td>随着粒子在 x 分量的变化，在 y 方向上线性变化的速度场，场的分量 <code>C[1]</code> 随着 <code>x[p][0]</code> 变化的情况。</td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             C 
            
           
             01 
            
           
          
         
           \bold{C}_{01} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></td><td>随着粒子在 y 分量的变化，在 x 方向上线性变化的速度场，场的分量 <code>C[0]</code> 随着 <code>x[p][1]</code> 变化的情况。</td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             C 
            
           
             11 
            
           
          
         
           \bold{C}_{11} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></td><td>随着粒子在 y 分量的变化，在 y 方向上线性变化的速度场，场的分量 <code>C[1]</code> 随着 <code>x[p][1]</code> 变化的情况。</td></tr></tbody></table> 
<h3><a id="32_APIC__185"></a>3.2 APIC 的角动量是守恒的</h3> 
<p>数学证明见：</p> 
<ul><li><a href="https://www.seas.upenn.edu/~cffjiang/research/apic/tech-doc.pdf" rel="nofollow">Tech report: the affine Particle-in-Cell method &lt;5.3.1&gt; &lt;5.3.2&gt;</a></li></ul> 
<h3><a id="33__191"></a>3.3 代码实现</h3> 
<h4><a id="331_P2G_193"></a>3.3.1 P2G</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 30,42（除去压力计算部分）：</p> 
<pre><code class="prism language-python">x <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>
v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>
C <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>

<span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        <span class="token comment"># Quadratic B-spline</span>
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>

        affine <span class="token operator">=</span> C<span class="token punctuation">[</span>p<span class="token punctuation">]</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 网格点位置和粒子位置的偏差值</span>
            dpos <span class="token operator">=</span> <span class="token punctuation">(</span>offset <span class="token operator">-</span> fx<span class="token punctuation">)</span> <span class="token operator">*</span> dx
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y

            grid_v<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> <span class="token punctuation">(</span>p_mass <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> affine @ dpos<span class="token punctuation">)</span>
            grid_m<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> p_mass
</code></pre> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
            
              g 
             
            
              v 
             
            
           
          
          
           
            
             
            
              = 
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
               
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              = 
             
             
             
               [ 
              
              
               
                
                 
                  
                  
                    C 
                   
                  
                    00 
                   
                  
                 
                
                
                 
                  
                  
                    C 
                   
                  
                    01 
                   
                  
                 
                
               
               
                
                 
                  
                  
                    C 
                   
                  
                    10 
                   
                  
                 
                
                
                 
                  
                  
                    C 
                   
                  
                    11 
                   
                  
                 
                
               
              
             
               ] 
              
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
               
               
                
                 
                  
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              = 
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     C 
                    
                   
                     00 
                    
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                    + 
                   
                   
                   
                     C 
                    
                   
                     01 
                    
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
               
                
                 
                  
                   
                   
                     C 
                    
                   
                     10 
                    
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                    + 
                   
                   
                   
                     C 
                    
                   
                     11 
                    
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
        
       
         \begin{aligned} \bold{g}_v &amp;= \begin{bmatrix} \bold{g}_v.x \\ \bold{g}_v.y \end{bmatrix} \\[3ex] &amp;= \begin{bmatrix} \bold{C}_{00} &amp; \bold{C}_{01} \\ \bold{C}_{10} &amp; \bold{C}_{11} \end{bmatrix} \begin{bmatrix} \bold{d}_{pos}.x \\ \bold{d}_{pos}.y \end{bmatrix} \\[3ex] &amp;= \begin{bmatrix} \bold{C}_{00} \cdot \bold{d}_{pos}.x + \bold{C}_{01} \cdot \bold{d}_{pos}.y\\ \bold{C}_{10} \cdot \bold{d}_{pos}.x + \bold{C}_{11} \cdot \bold{d}_{pos}.y \end{bmatrix} \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 9.50603em; vertical-align: -4.50301em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 5.00302em;"><span class="" style="top: -7.00302em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.60002em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: -0.197015em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 4.50301em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 5.00302em;"><span class="" style="top: -7.00302em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span><span class="" style="top: -3.60002em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span><span class="" style="top: -0.197015em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 4.50301em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p><strong>Note</strong> ：</p> 
<ul><li>其中网格点速度 <code>g_v</code> 、粒子位移的差分值 <code>dpos</code> ，与速度场 <code>C</code> 之间的关系，见 3.1 中的表格。</li></ul> 
<h4><a id="332_G2P_248"></a>3.3.2 G2P</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 30,42（除去压力计算部分）：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>

        new_v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        new_C <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 网格点位置和粒子位置的偏差值</span>
            dpos <span class="token operator">=</span> <span class="token punctuation">(</span>offset <span class="token operator">-</span> fx<span class="token punctuation">)</span> <span class="token operator">*</span> dx
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y
            <span class="token comment"># 网格点的速度</span>
            g_v <span class="token operator">=</span> grid_v<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span>

            new_v <span class="token operator">+=</span> weight <span class="token operator">*</span> g_v
            new_C <span class="token operator">+=</span> <span class="token number">4</span> <span class="token operator">*</span> weight <span class="token operator">*</span> g_v<span class="token punctuation">.</span>outer_product<span class="token punctuation">(</span>dpos<span class="token punctuation">)</span> <span class="token operator">/</span> dx<span class="token operator">**</span><span class="token number">2</span>

        v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> new_v
        x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> dt <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
        C<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> new_C
</code></pre> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
            
              C 
             
             
             
               n 
              
             
               e 
              
             
               w 
              
             
            
           
          
          
           
            
             
            
              = 
             
             
             
               [ 
              
              
               
                
                 
                  
                  
                    C 
                   
                  
                    00 
                   
                  
                 
                
                
                 
                  
                  
                    C 
                   
                  
                    01 
                   
                  
                 
                
               
               
                
                 
                  
                  
                    C 
                   
                  
                    10 
                   
                  
                 
                
                
                 
                  
                  
                    C 
                   
                  
                    11 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              = 
             
             
              
              
                4 
               
              
                w 
               
              
              
               
               
                 Δ 
                
               
                 x 
                
               
              
                2 
               
              
             
            
                
             
             
             
               g 
              
             
               v 
              
             
            
              ⊗ 
             
             
             
               d 
              
              
              
                p 
               
              
                o 
               
              
                s 
               
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              = 
             
             
              
              
                4 
               
              
                w 
               
              
              
               
               
                 Δ 
                
               
                 x 
                
               
              
                2 
               
              
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
               
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
                
                 
                  
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              = 
             
             
              
              
                4 
               
              
                w 
               
              
              
               
               
                 Δ 
                
               
                 x 
                
               
              
                2 
               
              
             
             
             
               [ 
              
              
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
               
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    x 
                   
                  
                 
                
                
                 
                  
                   
                   
                     g 
                    
                   
                     v 
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                    ⋅ 
                   
                   
                   
                     d 
                    
                    
                    
                      p 
                     
                    
                      o 
                     
                    
                      s 
                     
                    
                   
                  
                    . 
                   
                  
                    y 
                   
                  
                 
                
               
              
             
               ] 
              
             
            
           
          
         
        
       
         \begin{aligned} \bold{C}_{new} &amp;= \begin{bmatrix} \bold{C}_{00} &amp; \bold{C}_{01} \\ \bold{C}_{10} &amp; \bold{C}_{11} \end{bmatrix} \\[3ex] &amp;= \cfrac{4w}{<!-- -->{\Delta x}^2} \space \bold{g}_v \otimes \bold{d}_{pos} \\[3ex] &amp;= \cfrac{4w}{<!-- -->{\Delta x}^2} \begin{bmatrix} \bold{g}_v.x \\ \bold{g}_v.y \end{bmatrix} \begin{bmatrix} \bold{d}_{pos}.x &amp; \bold{d}_{pos}.y \end{bmatrix} \\[3ex] &amp;= \cfrac{4w}{<!-- -->{\Delta x}^2} \begin{bmatrix} \bold{g}_v.x \cdot \bold{d}_{pos}.x &amp; \bold{g}_v.x \cdot \bold{d}_{pos}.y \\ \bold{g}_v.y \cdot \bold{d}_{pos}.x &amp; \bold{g}_v.y \cdot \bold{d}_{pos}.y \end{bmatrix} \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 13.329em; vertical-align: -6.41452em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.91451em;"><span class="" style="top: -9.05452em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -5.51152em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"></span></span><span class="" style="top: -1.96851em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"></span></span><span class="" style="top: 1.57449em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.41452em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.91451em;"><span class="" style="top: -9.05452em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span><span class="" style="top: -5.51152em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59em;"><span class="" style="top: -2.22266em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord">Δ</span><span class="mord mathdefault">x</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.887338em;"><span class="" style="top: -3.13623em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.74em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">4</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.777338em;"><span class=""></span></span></span></span></span><span class=""></span></span><span class="mspace"> </span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.96851em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59em;"><span class="" style="top: -2.22266em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord">Δ</span><span class="mord mathdefault">x</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.887338em;"><span class="" style="top: -3.13623em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.74em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">4</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.777338em;"><span class=""></span></span></span></span></span><span class=""></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.85em;"><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.85em;"><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span></span></span><span class="" style="top: 1.57449em;"><span class="pstrut" style="height: 3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59em;"><span class="" style="top: -2.22266em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord">Δ</span><span class="mord mathdefault">x</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.887338em;"><span class="" style="top: -3.13623em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.74em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">4</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.777338em;"><span class=""></span></span></span></span></span><span class=""></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right: 0.01597em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.41452em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p><strong>Note</strong> ：</p> 
<ul><li>其中网格点速度 <code>g_v</code> 、粒子位移的差分值 <code>dpos</code> ，与速度场 <code>C</code> 之间的关系，见 3.1 中的表格。</li></ul> 
<h3><a id="34__306"></a>3.4 如果需要更精确的解</h3> 
<p><strong>APIC</strong> 可以类比于泰勒一级展开，如果有追求更高精度的需要（二级展开等），则可以使用 <strong>ployPIC</strong> ：</p> 
<ul><li><a href="https://dl.acm.org/doi/abs/10.1145/3130800.3130878" rel="nofollow">[SIGGRAPH Asia 2017] A polynomial particle-in-cell method</a></li></ul> 
<h2><a id="4_Material_Point_MethodMPM_312"></a>4. Material Point Method（MPM）</h2> 
<h3><a id="41__314"></a>4.1 物质点法简介</h3> 
<p>在解决了欧拉-拉格朗日之间的信息传递问题之后（APIC），就需要真正开始进行模拟，这时需要额外增加一些信息（形变梯度 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         F 
        
       
      
        \bold{F} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68611em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbf">F</span></span></span></span></span></span> ，体积应变比 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         J 
        
       
      
        \bold{J} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68611em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbf">J</span></span></span></span></span></span> ，杨氏模量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         E 
        
       
      
        E 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span></span></span></span></span> 等）</p> 
<p>最早的一篇关于 MPM 论文：</p> 
<ul><li><a href="https://www.math.ucla.edu/~jteran/papers/SSCTS13.pdf" rel="nofollow">[SIGGRAPH 2013] A material point method for snow simulation</a></li></ul> 
<p>距 2018 年，MPM 的相关论文：</p> 
<p><img src="https://images2.imgbox.com/2b/c2/VQsrmOO6_o.png" alt="screenShot.png"></p> 
<h3><a id="42_MLSMPM_326"></a>4.2 MLS-MPM</h3> 
<p><img src="https://images2.imgbox.com/fd/a5/c5OR1q2w_o.png" alt="screenShot.png"></p> 
<p><strong>P2G</strong> ：</p> 
<ul><li>使用（仿射 Affine）速度更新粒子；</li><li>将质量和动量分散到附近的 3×3×3 个节点。</li></ul> 
<p><strong>对于每个网格点</strong> ：</p> 
<ul><li>用动量除以质量得到速度；</li><li>应用重力和边界条件</li></ul> 
<p><strong>G2P</strong> ：</p> 
<ul><li>从 3×3×3 个节点收集 速度/仿射速度（Affine）。</li></ul> 
<h3><a id="43__343"></a>4.3 代码实现</h3> 
<h4><a id="431__345"></a>4.3.1 相关参数</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 2, 23：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> taichi <span class="token keyword">as</span> ti
ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>arch<span class="token operator">=</span>ti<span class="token punctuation">.</span>gpu<span class="token punctuation">)</span>

n_particles <span class="token operator">=</span> <span class="token number">8192</span>
n_grid <span class="token operator">=</span> <span class="token number">128</span>
dx <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> n_grid
dt <span class="token operator">=</span> <span class="token number">2e</span><span class="token operator">-</span><span class="token number">4</span>

p_rho <span class="token operator">=</span> <span class="token number">1</span>
p_vol <span class="token operator">=</span> <span class="token punctuation">(</span>dx <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
p_mass <span class="token operator">=</span> p_vol <span class="token operator">*</span> p_rho
gravity <span class="token operator">=</span> <span class="token number">9.8</span>
bound <span class="token operator">=</span> <span class="token number">3</span>
E <span class="token operator">=</span> <span class="token number">400</span>

x <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>
v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>
C <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>
<span class="token comment"># 体积比（当前体积/初始体积）：</span>
<span class="token comment"># J &lt; 1 ：粒子压缩</span>
<span class="token comment"># J &gt; 1 ：粒子膨胀</span>
J <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> n_particles<span class="token punctuation">)</span>

grid_v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n_grid<span class="token punctuation">,</span> n_grid<span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_m <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n_grid<span class="token punctuation">,</span> n_grid<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="432_P2G_377"></a>4.3.2 P2G</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 30, 42：</p> 
<pre><code class="prism language-python">@ti<span class="token punctuation">.</span>kernel
<span class="token keyword">def</span> <span class="token function">substep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># init grid</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 

    <span class="token comment"># P2G</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>
        stress <span class="token operator">=</span> <span class="token operator">-</span>dt <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">*</span> E <span class="token operator">*</span> p_vol <span class="token operator">*</span> <span class="token punctuation">(</span>J<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> dx<span class="token operator">**</span><span class="token number">2</span>
        <span class="token comment"># 动量的仿射信息</span>
        affine <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>stress<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> stress<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> p_mass <span class="token operator">*</span> C<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            dpos <span class="token operator">=</span> <span class="token punctuation">(</span>offset <span class="token operator">-</span> fx<span class="token punctuation">)</span> <span class="token operator">*</span> dx
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y
            grid_v<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> <span class="token punctuation">(</span>p_mass <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> affine @ dpos<span class="token punctuation">)</span>
            grid_m<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">+=</span> weight <span class="token operator">*</span> p_mass
</code></pre> 
<p>在 <strong>MPM</strong> 中，添加了一项 <code>stress</code> ，表示粒子受到压缩之后推开周围粒子的力（实际上是在网格层面操作）：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
        
          m 
         
        
          v 
         
         
         
           ) 
          
          
          
            s 
           
          
            t 
           
          
            r 
           
          
            e 
           
          
            s 
           
          
            s 
           
          
         
        
          = 
         
        
          − 
         
         
         
           4 
          
          
          
            Δ 
           
           
           
             x 
            
           
             2 
            
           
          
         
        
          Δ 
         
        
          t 
         
        
          E 
         
         
         
           p 
          
          
          
            v 
           
          
            o 
           
          
            l 
           
          
         
        
          ( 
         
         
         
           J 
          
         
           p 
          
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
       
         (mv)_{stress} = - \cfrac{4}{\Delta x^2} \Delta t E \bold{p}_{vol}(J_\bold{p} - 1) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.276em; vertical-align: -0.686em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.74em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class=""></span></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">v</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.09618em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></span></p> 
<h4><a id="433__410"></a>4.3.3 边界条件</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 43, 54：</p> 
<pre><code class="prism language-python">    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> grid_m<span class="token punctuation">:</span>
        <span class="token keyword">if</span> grid_m<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/=</span> grid_m<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>
        grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-=</span> dt <span class="token operator">*</span> gravity
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> bound <span class="token operator">and</span> grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> i <span class="token operator">&gt;</span> n_grid <span class="token operator">-</span> bound <span class="token operator">and</span> grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> j <span class="token operator">&lt;</span> bound <span class="token operator">and</span> grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> j <span class="token operator">&gt;</span> n_grid <span class="token operator">-</span> bound <span class="token operator">and</span> grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            grid_v<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>
</code></pre> 
<h4><a id="434_G2P_429"></a>4.3.4 G2P</h4> 
<p><a href="https://github.com/taichi-dev/taichi/blob/master/examples/mpm88.py"><b>mpm88.py</b></a> Line 55, 72：</p> 
<pre><code class="prism language-python">    <span class="token keyword">for</span> p <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        Xp <span class="token operator">=</span> x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> dx
        base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Xp <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        fx <span class="token operator">=</span> Xp <span class="token operator">-</span> base
        w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.5</span> <span class="token operator">-</span> fx<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.75</span> <span class="token operator">-</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span>
        
        new_v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        new_C <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">.</span>zero<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>ndrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            dpos <span class="token operator">=</span> <span class="token punctuation">(</span>offset <span class="token operator">-</span> fx<span class="token punctuation">)</span> <span class="token operator">*</span> dx
            weight <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y
            g_v <span class="token operator">=</span> grid_v<span class="token punctuation">[</span>base <span class="token operator">+</span> offset<span class="token punctuation">]</span>
            new_v <span class="token operator">+=</span> weight <span class="token operator">*</span> g_v
            new_C <span class="token operator">+=</span> <span class="token number">4</span> <span class="token operator">*</span> weight <span class="token operator">*</span> g_v<span class="token punctuation">.</span>outer_product<span class="token punctuation">(</span>dpos<span class="token punctuation">)</span> <span class="token operator">/</span> dx<span class="token operator">**</span><span class="token number">2</span>

        v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> new_v
        x<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> dt <span class="token operator">*</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
        J<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token number">1</span> <span class="token operator">+</span> dt <span class="token operator">*</span> new_C<span class="token punctuation">.</span>trace<span class="token punctuation">(</span><span class="token punctuation">)</span>
        C<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> new_C
</code></pre> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           J 
          
          
          
            p 
           
          
            − 
           
          
            n 
           
          
            e 
           
          
            w 
           
          
         
        
          = 
         
         
         
           J 
          
         
           p 
          
         
        
          ( 
         
        
          1 
         
        
          + 
         
        
          ( 
         
         
         
           C 
          
         
           00 
          
         
        
          + 
         
         
         
           C 
          
         
           11 
          
         
        
          ) 
         
        
          Δ 
         
        
          t 
         
        
          ) 
         
        
       
         J_{\bold{p}-new} = J_{\bold{p}}(1 + (\bold{C}_{00} + \bold{C}_{11})\Delta t) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.258331em;"><span class="" style="top: -2.55em; margin-left: -0.09618em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span></span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.09618em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">p</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span></span></p> 
<p><strong>Note</strong> ：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           C 
          
         
           00 
          
         
        
       
         \bold{C}_{00} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           C 
          
         
           11 
          
         
        
       
         \bold{C}_{11} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 同样可以用来表示粒子的膨胀（正值）和收缩（负值）。</li></ul> 
<p><img src="https://images2.imgbox.com/cf/86/NNFw1KgV_o.png" alt="screenShot.png"></p> 
<h2><a id="_466"></a>参考课程</h2> 
<p>文中相关资源来自课程：</p> 
<ul><li><a href="https://www.bilibili.com/video/BV1Df4y1B72S" rel="nofollow">[Chinagraph 2020] 用太极编写物理引擎 (5) 物质点法</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1de6b0f9591a8d90f0a701c0b272ad0c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">gitlab 清理指定时间前的，merge的早期分支</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4137eb3e91c7a6548aeea03bc9c59af9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android&#43;圆角屏幕方法,android屏幕圆角实现方法的示例代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>