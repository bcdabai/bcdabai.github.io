<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>centos8搭建内网私有repo源 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="centos8搭建内网私有repo源" />
<meta property="og:description" content="文章目录 1、环境准备2、简单的系统优化2.1打开文件数优化2.2内核参数优化2.3关闭防火墙,selinux2.4优化history2.5更新阿里云repo源&amp;安装必要的软件2.5加快ssh登录速度 3、开始配置3.1创建基于centos8光盘的base源3.2、配置extras源和epel源 4.总结 1、环境准备 IP地址系统版本安装软件10.0.0.1CentOS Linux release 8.5.2111最小安装nginx,httpd10.0.0.2CentOS Linux release 8.5.2111最小安装httpd 2、简单的系统优化 2.1打开文件数优化 [root@centos8 ~]# cat /etc/security/limits.conf * soft nofile 65535 * hard nofile 65535 * soft noproc 65535 * hard noproc 65535 [root@centos8 ~]# 2.2内核参数优化 [root@centos8 ~]# cat /etc/sysctl.conf fs.file-max = 999999 net.ipv4.ip_forward = 0 net.ipv4.conf.default.rp_filter = 1 net.ipv4.conf.default.accept_source_route = 0 kernel.sysrq = 0 kernel.core_uses_pid = 1 net.ipv4.tcp_syncookies = 1 kernel.msgmnb = 65536 kernel.msgmax = 65536 kernel.shmmax = 68719476736 kernel." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/966d563906474859094b1e71f3b9b98a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-27T16:12:49+08:00" />
<meta property="article:modified_time" content="2023-10-27T16:12:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">centos8搭建内网私有repo源</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_3" rel="nofollow">1、环境准备</a></li><li><a href="#2_11" rel="nofollow">2、简单的系统优化</a></li><li><ul><li><a href="#21_12" rel="nofollow">2.1打开文件数优化</a></li><li><a href="#22_22" rel="nofollow">2.2内核参数优化</a></li><li><a href="#23selinux_62" rel="nofollow">2.3关闭防火墙,selinux</a></li><li><a href="#24history_69" rel="nofollow">2.4优化history</a></li><li><a href="#25repo_86" rel="nofollow">2.5更新阿里云repo源&amp;安装必要的软件</a></li><li><a href="#25ssh_94" rel="nofollow">2.5加快ssh登录速度</a></li></ul> 
  </li><li><a href="#3_99" rel="nofollow">3、开始配置</a></li><li><ul><li><a href="#31centos8base_100" rel="nofollow">3.1创建基于centos8光盘的base源</a></li><li><a href="#32extrasepel_134" rel="nofollow">3.2、配置extras源和epel源</a></li></ul> 
  </li><li><a href="#4_160" rel="nofollow">4.总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="1_3"></a>1、环境准备</h2> 
<table><thead><tr><th>IP地址</th><th>系统版本</th><th>安装软件</th></tr></thead><tbody><tr><td>10.0.0.1</td><td>CentOS Linux release 8.5.2111最小安装</td><td>nginx,httpd</td></tr><tr><td>10.0.0.2</td><td>CentOS Linux release 8.5.2111最小安装</td><td>httpd</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/8f/58/jopeWzUl_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_11"></a>2、简单的系统优化</h2> 
<h3><a id="21_12"></a>2.1打开文件数优化</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/security/limits.conf</span>
* soft nofile <span class="token number">65535</span>
* hard nofile <span class="token number">65535</span>
* soft noproc <span class="token number">65535</span>
* hard noproc <span class="token number">65535</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h3><a id="22_22"></a>2.2内核参数优化</h3> 
<pre><code class="prism language-shell"> <span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/sysctl.conf</span>
fs.file-max <span class="token operator">=</span> <span class="token number">999999</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
kernel.sysrq <span class="token operator">=</span> <span class="token number">0</span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
kernel.msgmnb <span class="token operator">=</span> <span class="token number">65536</span>
kernel.msgmax <span class="token operator">=</span> <span class="token number">65536</span>
kernel.shmmax <span class="token operator">=</span> <span class="token number">68719476736</span>
kernel.shmall <span class="token operator">=</span> <span class="token number">4294967296</span>
net.ipv4.tcp_max_tw_buckets <span class="token operator">=</span> <span class="token number">6000</span>
net.ipv4.tcp_sack <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_window_scaling <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">10240</span> <span class="token number">87380</span> <span class="token number">12582912</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">10240</span> <span class="token number">87380</span> <span class="token number">12582912</span>
net.core.wmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.core.wmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.core.somaxconn <span class="token operator">=</span> <span class="token number">40960</span>
net.ipv4.tcp_max_orphans <span class="token operator">=</span> <span class="token number">3276800</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.ipv4.tcp_timestamps <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.tcp_synack_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_mem <span class="token operator">=</span> <span class="token number">94500000</span> <span class="token number">915000000</span> <span class="token number">927000000</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_keepalive_time <span class="token operator">=</span> <span class="token number">30</span>
net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">1024</span> <span class="token number">65000</span>
<span class="token comment"># bbr config</span>
<span class="token assign-left variable">net.core.default_qdisc</span><span class="token operator">=</span>fq
<span class="token assign-left variable">net.ipv4.tcp_congestion_control</span><span class="token operator">=</span>bbr
</code></pre> 
<hr> 
<h3><a id="23selinux_62"></a>2.3关闭防火墙,selinux</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># sed -i "s#SELINUX=enforcing#SELINUX=disabled#g" /etc/sysconfig/selinux</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld &amp;&amp; systemctl stop firewalld</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable auditd.service</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># rm -f /usr/lib/systemd/system/ctrl-alt-del.target</span>
</code></pre> 
<h3><a id="24history_69"></a>2.4优化history</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># cat &gt;&gt; /etc/profile &lt;&lt;'EOF'</span>
<span class="token comment">#设置history格式</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HISTTIMEFORMAT</span><span class="token operator">=</span><span class="token string">"[%Y-%m-%d %H:%M:%S] [<span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>] [<span class="token variable"><span class="token variable">`</span><span class="token function">who</span> am i<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $NF}'</span><span class="token operator">|</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">'s#[()]##g'</span><span class="token variable">`</span></span>]: "</span>
<span class="token comment">#记录shell执行的每一条命令</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PROMPT_COMMAND</span><span class="token operator">=</span><span class="token string">'\
if [ -z "$OLD_PWD" ];then
    export OLD_PWD=$PWD;
fi;
if [ ! -z "$LAST_CMD" ] &amp;&amp; [ "$(history 1)" != "$LAST_CMD" ]; then
    logger -t `whoami`_shell_dir "[$OLD_PWD]$(history 1)";
fi;
export LAST_CMD="$(history 1)";
export OLD_PWD=$PWD;'</span>
EOF
</code></pre> 
<h3><a id="25repo_86"></a>2.5更新阿里云repo源&amp;安装必要的软件</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># yum clean all &amp;&amp; yum makecache</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install  net-tools telnet vim  tree wget curl autofs bash-completion zip unzip</span>
</code></pre> 
<h3><a id="25ssh_94"></a>2.5加快ssh登录速度</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's#^GSSAPIAuthentication yes$#GSSAPIAuthentication no#g' /etc/ssh/sshd_config</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config</span>
</code></pre> 
<h2><a id="3_99"></a>3、开始配置</h2> 
<h3><a id="31centos8base_100"></a>3.1创建基于centos8光盘的base源</h3> 
<ol><li>创建<code>/mnt/ISO/</code>目录并上传镜像<code>CentOS-8.5.2111-x86_64-dvd1.iso</code><br> <img src="https://images2.imgbox.com/c6/d6/EHGvmjjU_o.png" alt="在这里插入图片描述"></li><li>将iso镜像文件挂载到<code>/mnt/cdrom</code></li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># mount -o loop /mnt/ISO/CentOS-8.5.2111-x86_64-dvd1.iso /mnt/cdrom</span>
</code></pre> 
<ol start="3"><li>安装<code>httpd</code>软件,参看阿里云centos源创建目录并将<code>iso</code>文件复制<code>/var/www/html/centos</code>中<br> <img src="https://images2.imgbox.com/8f/88/TAHYy9xN_o.png" alt="在这里插入图片描述"></li><li>启动<code>httpd</code>,浏览器验证如图:<br> <img src="https://images2.imgbox.com/53/6c/C1y7pL9d_o.png" alt="在这里插入图片描述"></li><li>配置<code>base repo</code><br> <img src="https://images2.imgbox.com/b9/b4/RtAlILYT_o.png" alt="在这里插入图片描述"></li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat base.repo</span>
<span class="token punctuation">[</span>BaseOS<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>BaseOS
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://10.1.1.10/centos/8/BaseOS
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token punctuation">[</span>AppStream<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>AppStream
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://10.1.1.10/centos/8/AppStream
</code></pre> 
<ol start="6"><li>生成缓存并验证</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all &amp;&amp; yum makecache</span>
<span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist -v # 查看repo是否生效</span>
<span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum --disablerepo=\* --enablerepo=BaseOS install lrzsz # 安装一个软件试试</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/fc/7nJig3XK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32extrasepel_134"></a>3.2、配置extras源和epel源</h3> 
<ol><li>创建必要的目录<br> <img src="https://images2.imgbox.com/a0/8a/yCbLwYV7_o.png" alt="在这里插入图片描述"></li><li>同步网络源,下载文件比较多,耐心等待</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># dnf reposync --repoid=extras --download-metadata -p /var/www/html/centos/extras # 先同步extras再同步epel</span>
<span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># dnf reposync --repoid=extras --download-metadata -p /var/www/html/centos/epel</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/99/91/iPh5eWrV_o.png" alt="在这里插入图片描述"><br> 3. 同步完后, 在配置文件中添加配置并生成缓存验证即可</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>extras<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>extras
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://10.1.1.10/centos/extras

<span class="token punctuation">[</span>epel<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>epel
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://10.1.1.10/centos/epel
</code></pre> 
<ol start="4"><li>更新源</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum check-update  # 检查更新</span>
<span class="token punctuation">[</span>root@centos8 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum update        # 执行更新</span>
</code></pre> 
<h2><a id="4_160"></a>4.总结</h2> 
<p>centos7/8 在2024年就要<a href="https://blog.centos.org/2023/04/end-dates-are-coming-for-centos-stream-8-and-centos-linux-7/" rel="nofollow">停止维护</a>了,搭建私有仓库非常有必要,在此总结一下以前在公司搭建私服的步骤备忘。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb53d312d661249abf3acd8974f4fa66/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">缓存之缓存简介(一)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7c32857652c8630a573a1162e4c9b4d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">uni-app使用vue3，在元素或组件实例上添加ref，用this.$refs显示undefined</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>