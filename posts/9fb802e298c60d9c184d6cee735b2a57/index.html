<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小程序获取不到用户头像和昵称返回微信用户问题解决，即小程序授权获取用户头像规则调整的最新解决方案 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小程序获取不到用户头像和昵称返回微信用户问题解决，即小程序授权获取用户头像规则调整的最新解决方案" />
<meta property="og:description" content="最近好多同学在学习石头哥小程序课程的时候，遇到了下面这样的问题，在小程序授权获取用户头像和昵称时，获取到的是下面这样的。
到底是什么原因导致的呢，去小程序官方文档一看，又是官方改规则了。
点进去一看，原来小程序官方，在2022年11月8日以后，又把获取用户头像的接口回收了
再看看网友的评论，真是骂声一片啊。
真是我的地盘我做主啊，我说怎么样就怎么样啊。有点店大欺客的嫌疑了。。。 但是呢，作为我们苦命的小程序开发者，官方虐我千百遍，我待官方如初恋。没办法啊，我们还是得用小程序不是吗。。。。
所以石头哥这里给大家提供几种解决方案。
一，临时解决方案，降低基础库 其实官方又说一句话，对于低于2.27.1版本的小程序，还是可以使用授权接口的，也就是说，只要我们的基础库低于2.27.1，就可以接着获取用户头像的。
带着试一试的心态，石头哥就去把基础库调低为2.27.0
调低后，再试下获取头像功能，果然还是可以获取到的。
这里要注意一点，调低后，要记得清空下缓存
虽然这个方法可以解决，但是只是一时的，因为小程序官方一直有bug，所以官方会一直升级基础库的，如果我们使用这个方法太久，就会导致基础库版本落后太多，这样的话，后续就会因为基础库太低，导致一些官方新功能无法使用。所以这个方案只是临时解决方案。
二，(不推荐)官方方案，头像昵称填写能力 官方为了补偿我们呢，给我们提供了一个新的方案。
虽然这个方案可以获取到头像和昵称，但是呢。。。。。
我们这里是可以获取到用户头像，但是官方给我们返回的这个头像是一个临时的链接。
既然是临时链接，就意味着这个链接用不了太久就会失效了
如果我们想用这个头像作为商品评论里的头像，那么就不能用这个临时链接了。所以官方出的这个有点鸡肋，基本上没有什么大用。
有用的也就是这个获取昵称。
就是在填写昵称的时候，给input设置一个属性，就可以选用微信昵称或者自己输入新的昵称。
所以如果你只需要使用用户昵称不使用头像，可以用这个方法。
三，(推荐)自己存储头像和昵称 既然官方老是变来变去，还不给我们可以长久使用的头像链接，那么我们就来自己存储用户头像，让这个头像是长久可以用的链接。所以我们这里需要自己开发后台存储头像。有以下几种方式
1，用Java或者php开发后台，存储头像和昵称
2，用云开发的云存储存储头像生成永久链接
我这里推荐大家使用云开发，因为云开发比较简单，当然大家如果会Java或者php开发，可以自己开发后台用于头像的上传和存储。
获取昵称和头像 首先看下效果图
可以看到这里可以获取到昵称，并且可以自己自定义头像，这个自定义的头像存到云存储里，返回的是一个永久的可以使用的链接。
这样我们后面再使用这个头像和昵称，就是永久的了，并且也不用再管小程序官方是不是又改规则了。
我把对应的代码，完整的贴出来给到大家
wxml
&lt;view class=&#34;item&#34;&gt; &lt;view class=&#34;tip&#34;&gt;编辑用户昵称&lt;/view&gt; &lt;input type=&#34;nickname&#34; bindinput=&#34;getName&#34; /&gt; &lt;/view&gt; &lt;view class=&#34;line&#34;&gt;&lt;/view&gt; &lt;view class=&#34;item&#34; bindtap=&#34;chooseImage&#34;&gt; &lt;view class=&#34;tip&#34;&gt;点击修改头像&lt;/view&gt; &lt;image src=&#34;{{avatarUrl}}&#34; /&gt; &lt;/view&gt; wxss样式
.item { display: flex; align-items: center; justify-content: space-between; margin: 15rpx; border-bottom: 1rpx solid gray; padding-bottom: 20rpx; } ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9fb802e298c60d9c184d6cee735b2a57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-15T21:28:48+08:00" />
<meta property="article:modified_time" content="2022-11-15T21:28:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小程序获取不到用户头像和昵称返回微信用户问题解决，即小程序授权获取用户头像规则调整的最新解决方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近好多同学在学习石头哥小程序课程的时候，遇到了下面这样的问题，在小程序授权获取用户头像和昵称时，获取到的是下面这样的。<br> <img src="https://images2.imgbox.com/6e/b9/sb9DXFpr_o.png" alt=""></p> 
<p>到底是什么原因导致的呢，去小程序官方文档一看，又是官方改规则了。<br> <img src="https://images2.imgbox.com/fb/17/Rv4herZB_o.png" alt=""><br> 点进去一看，原来小程序官方，在2022年11月8日以后，又把获取用户头像的接口回收了<br> <img src="https://images2.imgbox.com/05/dc/aAGjbifA_o.png" alt=""><br> 再看看网友的评论，真是骂声一片啊。<br> <img src="https://images2.imgbox.com/e2/9f/jkRoqPSE_o.png" alt=""><br> 真是我的地盘我做主啊，我说怎么样就怎么样啊。有点店大欺客的嫌疑了。。。 但是呢，作为我们苦命的小程序开发者，官方虐我千百遍，我待官方如初恋。没办法啊，我们还是得用小程序不是吗。。。。<br> 所以石头哥这里给大家提供几种解决方案。</p> 
<h2><a id="_12"></a>一，临时解决方案，降低基础库</h2> 
<p>其实官方又说一句话，对于低于2.27.1版本的小程序，还是可以使用授权接口的，也就是说，只要我们的基础库低于2.27.1，就可以接着获取用户头像的。<br> <img src="https://images2.imgbox.com/00/d1/PGkaGXYi_o.png" alt=""><br> 带着试一试的心态，石头哥就去把基础库调低为2.27.0<br> <img src="https://images2.imgbox.com/43/01/69n8NqVs_o.png" alt=""><br> 调低后，再试下获取头像功能，果然还是可以获取到的。<br> <img src="https://images2.imgbox.com/89/bd/LLYsmBym_o.png" alt=""><br> 这里要注意一点，调低后，要记得清空下缓存<br> <img src="https://images2.imgbox.com/95/b2/wxrGA5IB_o.png" alt=""><br> 虽然这个方法可以解决，但是只是一时的，因为小程序官方一直有bug，所以官方会一直升级基础库的，如果我们使用这个方法太久，就会导致基础库版本落后太多，这样的话，后续就会因为基础库太低，导致一些官方新功能无法使用。所以这个方案只是临时解决方案。</p> 
<h2><a id="_23"></a>二，(不推荐)官方方案，头像昵称填写能力</h2> 
<p>官方为了补偿我们呢，给我们提供了一个新的方案。<br> <img src="https://images2.imgbox.com/7a/a3/zn7doafh_o.png" alt=""><br> 虽然这个方案可以获取到头像和昵称，但是呢。。。。。<br> <img src="https://images2.imgbox.com/f8/9b/C3XSBfW0_o.png" alt=""><br> 我们这里是可以获取到用户头像，但是官方给我们返回的这个头像是一个临时的链接。<br> <img src="https://images2.imgbox.com/af/21/a7yg3Ldt_o.png" alt=""><br> 既然是临时链接，就意味着这个链接用不了太久就会失效了<br> <img src="https://images2.imgbox.com/5f/93/LpOha8UG_o.png" alt=""><br> 如果我们想用这个头像作为商品评论里的头像，那么就不能用这个临时链接了。所以官方出的这个有点鸡肋，基本上没有什么大用。<br> 有用的也就是这个获取昵称。<br> <img src="https://images2.imgbox.com/f4/0a/WBLfBbt0_o.png" alt=""><br> 就是在填写昵称的时候，给input设置一个属性，就可以选用微信昵称或者自己输入新的昵称。<br> <img src="https://images2.imgbox.com/93/18/k3nVF0FT_o.png" alt=""><br> 所以如果你只需要使用用户昵称不使用头像，可以用这个方法。</p> 
<h2><a id="_39"></a>三，(推荐)自己存储头像和昵称</h2> 
<p>既然官方老是变来变去，还不给我们可以长久使用的头像链接，那么我们就来自己存储用户头像，让这个头像是长久可以用的链接。所以我们这里需要自己开发后台存储头像。有以下几种方式<br> 1，用Java或者php开发后台，存储头像和昵称<br> 2，用云开发的云存储存储头像生成永久链接</p> 
<p>我这里推荐大家使用云开发，因为云开发比较简单，当然大家如果会Java或者php开发，可以自己开发后台用于头像的上传和存储。</p> 
<h3><a id="_46"></a>获取昵称和头像</h3> 
<p>首先看下效果图<br> <img src="https://images2.imgbox.com/47/95/Dthi0RK0_o.png" alt=""><br> 可以看到这里可以获取到昵称，并且可以自己自定义头像，这个自定义的头像存到云存储里，返回的是一个永久的可以使用的链接。<br> <img src="https://images2.imgbox.com/b5/ba/2nnu8FlK_o.png" alt=""><br> 这样我们后面再使用这个头像和昵称，就是永久的了，并且也不用再管小程序官方是不是又改规则了。<br> 我把对应的代码，完整的贴出来给到大家<br> wxml</p> 
<pre><code>&lt;view class="item"&gt;
  &lt;view class="tip"&gt;编辑用户昵称&lt;/view&gt;
  &lt;input type="nickname" bindinput="getName" /&gt;
&lt;/view&gt;
&lt;view class="line"&gt;&lt;/view&gt;
&lt;view class="item" bindtap="chooseImage"&gt;
  &lt;view class="tip"&gt;点击修改头像&lt;/view&gt;
  &lt;image src="{<!-- -->{avatarUrl}}" /&gt;
&lt;/view&gt;
</code></pre> 
<p>wxss样式</p> 
<pre><code>.item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 15rpx;
    border-bottom: 1rpx solid gray;
    padding-bottom: 20rpx;
}

.tip {
    font-size: 44rpx;
    margin: 20rpx;
    color: red;
}

.item image {
    width: 200rpx;
    height: 200rpx;
    border-radius: 10rpx;
    margin: 10rpx 30rpx;

}

.item input {
    flex: 1;
    border: 1px solid gray;
    border-radius: 20rpx;
    padding: 5rpx 15rpx;
}
</code></pre> 
<p>js逻辑代码</p> 
<pre><code>const app = getApp()
//这里要注意，初始化云开发，下面env要换成你自己的
wx.cloud.init({
  env: 'cloud1-3g3xyg1a9ff9d8fe'
})
const db = wx.cloud.database()
Page({
  getName(e) {
    this.setData({
      name: e.detail.value
    })
  },
  //选择图片
  chooseImage() {
    wx.chooseMedia({
      count: 1,
      mediaType: ['image'],
      sizeType: ['compressed'], //可以指定是原图还是压缩图，这里用压缩
      sourceType: ['album', 'camera'], //从相册选择
      success: (res) =&gt; {
        console.log("选择图片成功", res)
        let avatarUrl = res.tempFiles[0].tempFilePath
        this.setData({
          avatarUrl: avatarUrl
        })
        wx.cloud.uploadFile({
          cloudPath: new Date().getTime() + '.png',
          filePath: avatarUrl, // 文件路径
        }).then(res =&gt; {
          let fileID = res.fileID
          console.log("上传返回的头像永久链接", fileID)
        }).catch(error =&gt; {
          console.log("上传失败", error)
        })
      }
    })
  },
})
</code></pre> 
<p>当然这里是基于云开发的，如果大家对云开发不了解，可以去看石头哥录得云开发视频：https://www.bilibili.com/video/BV1x54y1s7pk</p> 
<p>然后关于最新版的获取头像和昵称，我也在二手商城小程序的视频里有做详细讲解：https://www.bilibili.com/video/BV1WA411M7Dp<br> <img src="https://images2.imgbox.com/12/5a/9gEwE8Zw_o.png" alt=""><br> 后面会分享更多小程序相关的知识给到大家，欢迎点赞留言加关注。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a706e829863bcaa25ec3e1b5ad56a42/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《GB9706.1 医用电气设备 第1部分：安全通用要求》基本概念的思维导图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6894ec05e8176ed5ef5d1a5c21cec008/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构：查找——按姓名查找学生信息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>