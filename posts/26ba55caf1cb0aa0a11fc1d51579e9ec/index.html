<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KubeSphere的PaaS平台-管理K8S - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="KubeSphere的PaaS平台-管理K8S" />
<meta property="og:description" content="简介: KubeSphere是一个灵活的轻量级容器PaaS平台，通过了CNCF一致性认证，100%开源，由社区驱动与开发。KubeSphere可以部署并运行在任何基础架构以及所有版本兼容的Kubernetes集群之上，包括虚拟机、物理机、数据中心、公有云和混合云等。
官网地址: https://kubesphere.io/zh/
先安装Docker 1.在线安装Docker 第一步：安装一组工具
sudo yum install -y yum-utils 第二步：设置 yum 仓库地址
sudo yum-config-manager \ --add-repo \ https://download.docker.com/linux/centos/docker-ce.repo sudo yum-config-manager \ --add-repo \ http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 第三步：更新 yum 缓存 #yum 是包管理器
sudo yum makecache fast 第四步：安装新版 docker
sudo yum install -y docker-ce docker-ce-cli containerd.io 第四步：安装成功以后，检查安装状态 指令：
docker info 第五不:设置Docker开机自启 systemctl enable docker Docker镜像加速 由于国内网络问题，需要配置加速器来加速。修改配置文件 /etc/docker/daemon.json
下面命令直接生成文件 daemon.json，直接在命令行执行即可
cat &lt;&lt;EOF &gt; /etc/docker/daemon.json { &#34;registry-mirrors&#34;: [ &#34;https://docker.mirrors.ustc.edu.cn&#34;, &#34;http://hub-mirror.c.163.com&#34; ], &#34;max-concurrent-downloads&#34;: 10, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/26ba55caf1cb0aa0a11fc1d51579e9ec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-23T16:29:48+08:00" />
<meta property="article:modified_time" content="2023-03-23T16:29:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">KubeSphere的PaaS平台-管理K8S</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style="">简介:</h2> 
 <p style="">KubeSphere是一个灵活的轻量级容器PaaS平台，通过了CNCF一致性认证，100%开源，由社区驱动与开发。KubeSphere可以部署并运行在任何基础架构以及所有版本兼容的Kubernetes集群之上，包括虚拟机、物理机、数据中心、公有云和混合云等。</p> 
 <p style="">官网地址: <a class="kdocs-link" style="color:#0A6CFF;" href="https://kubesphere.io/zh/" rel="nofollow noopener noreferrer" target="_blank">https://kubesphere.io/zh/</a></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h2>先安装Docker</h2></li></ol> 
 <h3 style="text-indent:1.4em;text-align:left;">1.在线安装Docker</h3> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">第一步：安装一组工具</span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sudo yum install -y yum-utils </code></pre> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">第二步：设置 yum 仓库地址</span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
sudo yum-config-manager \
     --add-repo \
     http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">第三步：更新 yum 缓存 #yum 是包管理器</span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sudo yum makecache fast </code></pre> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">第四步：安装新版 docker</span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sudo yum install -y docker-ce docker-ce-cli containerd.io</code></pre> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">第四步：安装成功以后，检查安装状态 </span></p> 
 <p style="text-align:null;"> 指令：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">docker info</code></pre> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">第五不:设置Docker开机自启</span></h4> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">systemctl enable docker</code></pre> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Docker镜像加速</span></h4> 
 <p style="text-align:null;">由于国内网络问题，需要配置加速器来加速。修改配置文件 /etc/docker/daemon.json</p> 
 <p style="text-align:null;">下面命令直接生成文件 daemon.json，直接在命令行执行即可</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">cat &lt;&lt;EOF &gt; /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "http://hub-mirror.c.163.com"
  ],
  "max-concurrent-downloads": 10,
  "log-driver": "json-file",
  "log-level": "warn",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
    },
  "data-root": "/var/lib/docker"
}
EOF</code></pre> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h2>安装harbor私有镜像管理服务</h2></li></ol> 
 <p style=""><span class="kdocs-color" style="color:#A639D7;"><span class="kdocs-bold" style="font-weight:bold;">安装原因</span></span>:<span class="kdocs-color" style="color:#C21C13;"> harbor私有镜像管理服务(通过dockerFile打包后的镜像推送到harbor中,然后KubeSphere连接 到harbor的所有镜像实现镜像服务的部署和管理</span></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.1安装docker-compose</span></h3> 
 <p style="text-align:null;">在这里我把docker-compose安装到了<span class="kdocs-fontSize" style="font-size:9pt;">/usr/local/bin/</span>目录，命名为<span class="kdocs-fontSize" style="font-size:9pt;">docker-compose</span>，如果不想修改目录的话，也可以按照我定义的路径去安装，这样的话，下面的命令就不需要修改了，避免出错，好不好</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">curl -L https://get.daocloud.io/docker/compose/releases/download/1.29.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</code></pre> 
 <p style="">授权</p> 
 <pre class="kdocs-yaml"><code class="language-yaml"># 授权
# 给 docker-compose 目录授权
sudo chmod 777 /usr/local/bin/docker-compose

# 查看version
docker-compose version</code></pre> 
 <p style="">重新设置docker国内镜像地址-防止安装<span class="kdocs-bold" style="font-weight:bold;">KubeSphere</span>时候报错</p> 
 <p style="">地址: <a class="kdocs-link" style="color:#0A6CFF;" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" rel="nofollow noopener noreferrer" target="_blank">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1265px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:68.9328%;height:0;"> 
    <img src="https://images2.imgbox.com/2e/cb/Biujvhn1_o.png" style="margin-left:;display:block;width:1265px;margin-top:-68.9328%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""><span class="kdocs-color" style="color:#C21C13;">特意加上 "insecure-registries":["127.0.0.1:5000"] 是为了 Harbor中登录连接时候不使用HTTPS</span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "registry-mirrors": ["https://自己的.mirror.aliyuncs.com"],
  "insecure-registries":["自己的IP:5000"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker</code></pre> 
 <p style="text-align:null;">新增其他国内源（中国科技大学）</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">{"registry-mirrors":["https://docker.mirrors.ustc.edu.cn"]}</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>重启生效</p></li></ul> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">servicedocker restart</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>查看是否成功</p></li></ul> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">docker info</code></pre> 
 <h3 style="">2.2安装harbor</h3> 
 <p style="">下载百度网盘 harbor-offline-installer-v1.10.17<span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-italic" style="font-style:italic;"> </span></span></p> 
 <pre class="kdocs-yaml"><code class="language-yaml">链接：https://pan.baidu.com/s/1ZNyT2LHwrTaaDLMYc20gmA?pwd=1ze4 
提取码：1ze4 
--来自百度网盘超级会员V6的分享</code></pre> 
 <h4 style="">2.2.1然后解压安装</h4> 
 <pre class="kdocs-yaml"><code class="language-yaml">cd /usr/local/src/harbor
mkdir data
tar -zxvf harbor-offline-installer-v1.10.1.tgz</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:733px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.964529%;height:0;"> 
    <img src="https://images2.imgbox.com/2c/34/5JmrNc2W_o.png" style="margin-left:;display:block;width:733px;margin-top:-21.964529%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="">2.2.2 修改配置文件 harbor.yml</h4> 
 <pre class="kdocs-yaml"><code class="language-yaml">vim harbor.yml</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:813px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:94.710945%;height:0;"> 
    <img src="https://images2.imgbox.com/2e/6d/warjAZ9P_o.png" style="margin-left:;display:block;width:813px;margin-top:-94.710945%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <pre class="kdocs-yaml"><code class="language-yaml">配置文件的解释~~~~~~~~~~~~~~~~~~~~~~~~~~
# hostname设置访问地址，可以使用ip、域名，不可以设置为127.0.0.1或localhost
hostname = 192.168.126.162

# 访问协议，默认是http，也可以设置https，如果设置https，则nginx ssl需要设置on
ui_url_protocol = http

# mysql数据库root用户默认密码root123，实际使用时修改下
db_password = 123456

max_job_workers = 3 

customize_crt = on

ssl_cert = /data/cert/server.crt
ssl_cert_key = /data/cert/server.key

secretkey_path = /data

admiral_url = NA
# 邮件设置，发送重置密码邮件时使用
email_identity = 

email_server = smtp.mydomain.com
email_server_port = 25
email_username = sample_admin@mydomain.com
email_password = abc
email_from = admin &lt;sample_admin@mydomain.com&gt;
email_ssl = false

# 启动Harbor后，管理员UI登录的密码，默认是Harbor12345
harbor_admin_password = 123456

# 认证方式，这里支持多种认证方式，如LADP、本次存储、数据库认证。默认是db_auth，mysql数据库认证
auth_mode = db_auth

# LDAP认证时配置项
ldap_url = ldaps://ldap.mydomain.com
#ldap_searchdn = uid=searchuser,ou=people,dc=mydomain,dc=com
#ldap_search_pwd = password
ldap_basedn = ou=people,dc=mydomain,dc=com
#ldap_filter = (objectClass=person)
ldap_uid = uid
ldap_scope = 3
ldap_timeout = 5

# 是否开启自注册
self_registration = on

# token有效时间，默认30分钟
token_expiration = 30

# 用户创建项目权限控制，默认是everyone（所有人），也可以设置为adminonly（只能管理员）
project_creation_restriction = everyone

verify_remote_cert = on
</code></pre> 
 <h4 style="">2.2.3 执行安装</h4> 
 <pre class="kdocs-yaml"><code class="language-yaml">cd /usr/local/src/harbor/harbor
sh install.sh</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:571px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:122.767075%;height:0;"> 
    <img src="https://images2.imgbox.com/63/be/yXGTHNTZ_o.png" style="margin-left:;display:block;width:571px;margin-top:-122.767075%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;">6、配置开机自启：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">/usr/local/sbin/docker-compose -f /data/software/harbor/docker-compose.yml up -d
chmod +x /etc/rc.local /etc/rc.d/rc.local
vim /etc/rc.local</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:650px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.538464%;height:0;"> 
    <img src="https://images2.imgbox.com/0f/fa/YYQK2DUQ_o.png" style="margin-left:;display:block;width:650px;margin-top:-43.538464%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="">安装成功!</p> 
 <p style="">登录~~~~~~~~~~~~~~~~~~~~</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1028px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:67.41245%;height:0;"> 
    <img src="https://images2.imgbox.com/1c/bc/WeBJIofY_o.png" style="margin-left:;display:block;width:1028px;margin-top:-67.41245%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">命令行登陆</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">docker login 10.82.118.186:5000 或者 80 都可以</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:428px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.448599%;height:0;"> 
    <img src="https://images2.imgbox.com/d7/0e/gR4DNwbR_o.png" style="margin-left:;display:block;width:428px;margin-top:-11.448599%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-align:null;">2.2.3、测试上传和下载</h4> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:null;"><h5>新建一个项目目录：</h5></li></ol> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:816px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:74.26471%;height:0;"> 
    <img src="https://images2.imgbox.com/f5/b4/X4i20ndT_o.png" style="margin-left:;display:block;width:816px;margin-top:-74.26471%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:903px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.182724%;height:0;"> 
    <img src="https://images2.imgbox.com/19/71/wnxKeu8z_o.png" style="margin-left:;display:block;width:903px;margin-top:-45.182724%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1174px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:34.667805%;height:0;"> 
    <img src="https://images2.imgbox.com/0d/26/ueVGmTEX_o.png" style="margin-left:;display:block;width:1174px;margin-top:-34.667805%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1334px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.05847%;height:0;"> 
    <img src="https://images2.imgbox.com/84/fc/7bdEWjQ3_o.png" style="margin-left:;display:block;width:1334px;margin-top:-33.05847%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">测试推送一个到harbor服务器中:</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1094px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.424133%;height:0;"> 
    <img src="https://images2.imgbox.com/f9/f8/piuROhBH_o.png" style="margin-left:;display:block;width:1094px;margin-top:-44.424133%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:700px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:68.42857%;height:0;"> 
    <img src="https://images2.imgbox.com/ad/43/pVX3bGNr_o.png" style="margin-left:;display:block;width:700px;margin-top:-68.42857%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">如果出现 push时候 错误</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:681px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:7.929516%;height:0;"> 
    <img src="https://images2.imgbox.com/2d/8d/lE82EYQr_o.png" style="margin-left:;display:block;width:681px;margin-top:-7.929516%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">出现这问题的原因是：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Docker自从1.3.X之后docker registry交互默认使用的是HTTPS，但是搭建私有镜像默认使用的是HTTP服务，所以与私有镜像交时出现以上错误。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">这个报错是在本地上传私有镜像的时候遇到的报错：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">1.解决办法是：在docker server启动的时候，增加启动参数，默认使用HTTP访问：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> vim /usr/lib/systemd/system/docker.service</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">在12行后面增加 --insecure-registry ip：5000</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">修改好后重启docker 服务</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">systemctl daemon-reload </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">systemctl restart docker</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">2.如果上述方法还是不能解决，还可以通过以下办法解决：</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">1.vim /etc/docker/daemon.json 增加一个daemon.json文件</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">{ "insecure-registries":["192.168.1.100:5000"] }</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">保存退出</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">2.重启docker服务</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">systemctl daemon-reload</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">systemctl restart docker</span></span></p> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">推送成功!</span></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1300px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.153847%;height:0;"> 
    <img src="https://images2.imgbox.com/df/9c/6yHFXbif_o.png" style="margin-left:;display:block;width:1300px;margin-top:-27.153847%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="">至此，harbor部署完毕 </p> 
 <p style=""><span class="kdocs-color" style="color:#0E52D4;">知识补充：</span></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p><span class="kdocs-color" style="color:#078654;">如果以后修改了harbor.yml文件，那么先停止使用docker-compose down，再去修改harbor.yml文件，重新启动部署 ./install.sh</span></p></li></ol> 
 <pre class="kdocs-yaml"><code class="language-yaml">docker-compose down</code></pre> 
 <p style="">修改 barbor.yml 后 再重新初始化</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">sh install.sh</code></pre> 
 <p style="">2、正常启动harbor启动：</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">docker-compose up -d</code></pre> 
 <p style="">3、未修改配置文件，重启Harbor命令：</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">docker-compose start | stop | restart</code></pre> 
 <p style=""></p> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><h2>安装KubeSphere</h2></li></ol> 
 <p style="">一、关闭防火墙</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">systemctl disable firewalld
systemctl stop firewalld
systemctl status firewalld</code></pre> 
 <p style="">第二步：关闭swap分区</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">swapoff -a
echo "vm.swappiness=0" &gt;&gt; /etc/sysctl.conf
sysctl -p /etc/sysctl.conf</code></pre> 
 <p style="">第三步：配置epel源</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</code></pre> 
 <p style="">第四步：更新yum</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">yum -y update</code></pre> 
 <p style="">第五步：安装依赖组件</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">yum install -y ebtables socat ipset conntrack</code></pre> 
 <p style="">第六步：在安装前请先检查hostname，如果不符合规则会报以下错误</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">error: Pipeline[CreateClusterPipeline] execute failed: Module[InitKubernetesModule] exec failed: 
failed: [VM-20-8-centos] [AddWorkerLabel] exec failed after 5 retires: add worker label failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl label --overwrite node VM-20-8-centos node-role.kubernetes.io/worker=" 
Error from server (NotFound): nodes "VM-20-8-centos" not found: Process exited with status 1</code></pre> 
 <p style="">这时候就需要修改hostname，因为我们是单机安装就设置为master吧，执行以下命令</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">hostnamectl --static set-hostname master
hostnamectl status</code></pre> 
 <p style="text-align:null;">第7步：下载 KubeKey</p> 
 <p style="text-align:null;">先执行以下命令以确保您从正确的区域下载 KubeKey。</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">export KKZONE=cn</code></pre> 
 <p style="">执行以下命令下载 KubeKey。</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">curl -sfL https://get-kk.kubesphere.io | VERSION=v2.2.2 sh -</code></pre> 
 <p style="">为 kk 添加可执行权限：</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">chmod +x kk</code></pre> 
 <p style="">第8步：开始安装</p> 
 <p style="text-align:null;">若要同时安装 Kubernetes 和 <a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=KubeSphere&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">KubeSphere</a>，可参考以下示例命令：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">./kk create cluster --with-kubernetes v1.22.10--with-kubesphere v3.3.0</code></pre> 
 <p style="">第9步：验证安装结果</p> 
 <p style="">输入以下命令以检查安装结果。</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l 'app in (ks-install, ks-installer)' -o jsonpath='{.items[0].metadata.name}') -f</code></pre> 
 <p style="">成功输出</p> 
 <pre class="kdocs-yaml"><code class="language-yaml">#####################################################
###              Welcome to KubeSphere!           ###
#####################################################

Console: http://192.168.0.2:30880
Account: admin
Password: P@88w0rd

NOTES：
  1. After you log into the console, please check the
     monitoring status of service components in
     "Cluster Management". If any service is not
     ready, please wait patiently until all components 
     are up and running.
  2. Please change the default password after login.

#####################################################
https://kubesphere.io             20xx-xx-xx xx:xx:xx
#####################################################
</code></pre> 
 <p style="">然后访问 <a class="kdocs-link" style="color:#0A6CFF;" href="http://192.168.0.2:30880" rel="nofollow noopener noreferrer" target="_blank">http://192.168.0.2:30880</a> </p> 
 <p style="">Account: admin</p> 
 <p style="">Password: P@88w0rd </p> 
 <p style="">即可</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57e0d26d8a97d556add91270822bde06/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mybatis-plus之模糊查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1600dab997f9bcd83376c7b81e266fc1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Camera 驱动 读取摄像头ID失败问题、低温下Camera打开花屏或者读不到id、概率性读取不到id</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>