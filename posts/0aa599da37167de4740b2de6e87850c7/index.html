<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VuePress基本用法与踩坑记录 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VuePress基本用法与踩坑记录" />
<meta property="og:description" content="文章目录 一、前言二、VuePress是什么？三、环境搭建四、基础配置4.1 目录结构4.2 导航栏4.3 侧边栏4.4 自动生成侧边栏 五、自定义主题六、避坑指南6.1 侧边栏无法正常使用6.2 生成静态网页时出现解析错误6.3 部署站点无法使用相对路径6.4 预览或编译时内存溢出（OOM）6.5 页面刷新异常或点击前进/返回异常：6.6 生成静态网页时内存消耗过多 一、前言 近期由于工作需要，接触了一些静态网页生成器，选中了 VuePress，具体可以先看看：云文档托管方案分析。
二、VuePress是什么？ VuePress是尤雨溪尤大为了支持 Vue 及其子项目的文档需求而写的一个项目，VuePress界面十分简洁，并且非常容易上手，花少量时间就可以将项目架构搭好，具体效果可以看：VuePress的官方文档。
一个 VuePress 网站是一个由 Vue 、Vue Router 和 webpack 驱动的单页应用，其基于Vue实现，因此可以嵌入各种Vue组件来实现扩展功能。
三、环境搭建 环境要求：
Node.js &gt;= 8.6；
新建一个文件夹，如：mydocs；
新建 mydocs/package.json 文件，并安装 VuePress：
npm install -D vuepress 在 package.json 中加入以下脚本： { &#34;scripts&#34;: { &#34;docs:dev&#34;: &#34;vuepress dev docs&#34;, &#34;docs:build&#34;: &#34;vuepress build docs&#34;, } } 在 mydocs 下新建 docs 目录，并新建 docs/README.md 文件，并在其中添加文本 “Hello VuePress!!!”；
执行以下命令预览效果：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0aa599da37167de4740b2de6e87850c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-05T21:52:44+08:00" />
<meta property="article:modified_time" content="2021-12-05T21:52:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VuePress基本用法与踩坑记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、前言</a></li><li><a href="#VuePress_5" rel="nofollow">二、VuePress是什么？</a></li><li><a href="#_10" rel="nofollow">三、环境搭建</a></li><li><a href="#_60" rel="nofollow">四、基础配置</a></li><li><ul><li><a href="#41__79" rel="nofollow">4.1 目录结构</a></li><li><a href="#42__84" rel="nofollow">4.2 导航栏</a></li><li><a href="#43__123" rel="nofollow">4.3 侧边栏</a></li><li><a href="#44__146" rel="nofollow">4.4 自动生成侧边栏</a></li></ul> 
  </li><li><a href="#_266" rel="nofollow">五、自定义主题</a></li><li><a href="#_276" rel="nofollow">六、避坑指南</a></li><li><ul><li><a href="#61__277" rel="nofollow">6.1 侧边栏无法正常使用</a></li><li><a href="#62__280" rel="nofollow">6.2 生成静态网页时出现解析错误</a></li><li><a href="#63__283" rel="nofollow">6.3 部署站点无法使用相对路径</a></li><li><a href="#64_OOM_286" rel="nofollow">6.4 预览或编译时内存溢出（OOM）</a></li><li><a href="#65__309" rel="nofollow">6.5 页面刷新异常或点击前进/返回异常：</a></li><li><a href="#66__335" rel="nofollow">6.6 生成静态网页时内存消耗过多</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、前言</h2> 
<p>近期由于工作需要，接触了一些静态网页生成器，选中了 VuePress，具体可以先看看：<a href="https://blog.csdn.net/weixin_40026797/article/details/121316325">云文档托管方案分析</a>。</p> 
<h2><a id="VuePress_5"></a>二、VuePress是什么？</h2> 
<p>VuePress是尤雨溪尤大为了支持 Vue 及其子项目的文档需求而写的一个项目，VuePress界面十分简洁，并且非常容易上手，花少量时间就可以将项目架构搭好，具体效果可以看：<a href="https://vuepress.vuejs.org/zh/guide/" rel="nofollow">VuePress的官方文档</a>。</p> 
<p>一个 VuePress 网站是一个由 <a href="https://vuejs.org/" rel="nofollow">Vue</a> 、<a href="https://github.com/vuejs/vue-router">Vue Router</a> 和 <a href="https://webpack.js.org/" rel="nofollow">webpack</a> 驱动的单页应用，其基于Vue实现，因此可以嵌入各种Vue组件来实现扩展功能。</p> 
<h2><a id="_10"></a>三、环境搭建</h2> 
<ol><li> <p>环境要求：<br> Node.js &gt;= 8.6；</p> </li><li> <p>新建一个文件夹，如：mydocs；</p> </li><li> <p>新建 mydocs/package.json 文件，并安装 VuePress：</p> </li></ol> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> -D vuepress
</code></pre> 
<ol start="4"><li>在 package.json 中加入以下脚本：</li></ol> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"docs:dev"</span><span class="token operator">:</span> <span class="token string">"vuepress dev docs"</span><span class="token punctuation">,</span>
        <span class="token string">"docs:build"</span><span class="token operator">:</span> <span class="token string">"vuepress build docs"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="5"><li> <p>在 mydocs 下新建 docs 目录，并新建 docs/README.md 文件，并在其中添加文本 “Hello VuePress!!!”；</p> </li><li> <p>执行以下命令预览效果：</p> </li></ol> 
<pre><code class="prism language-bash"><span class="token function">npm</span> run docs:dev
</code></pre> 
<p>命令执行成功：<br> <img src="https://images2.imgbox.com/d6/1a/10Q3zvc0_o.png" alt="在这里插入图片描述"></p> 
<ol start="7"><li>访问 http://localhost:8080/ ，可以看到我们添加的 “Hello VuePress!!!”：</li></ol> 
<p><img src="https://images2.imgbox.com/5f/06/D91rYpkc_o.png" alt="在这里插入图片描述"></p> 
<ol start="8"><li>CTRL + C 结束预览，执行以下命令生成静态网页：</li></ol> 
<pre><code class="prism language-bash"><span class="token function">npm</span> run docs:build
</code></pre> 
<p>命令执行成功：</p> 
<p><img src="https://images2.imgbox.com/94/1c/FScDHj5l_o.png" alt="在这里插入图片描述"></p> 
<p>打包好的静态网页位于：mydocs/docs/.vuepress/dist。</p> 
<h2><a id="_60"></a>四、基础配置</h2> 
<ol><li> <p>在 docs/.vuepress 文件夹下创建config.js，它是VuePress必要的配置文件，导出一个JavaScript对象。</p> </li><li> <p>我们可以先加入以下配置：</p> </li></ol> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  title<span class="token operator">:</span> <span class="token string">'Hello VuePress'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'Just playing around'</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>再次预览可以看到网页标题已经改变了：</p> 
<p><img src="https://images2.imgbox.com/ed/88/fdgvuQmt_o.png" alt="在这里插入图片描述"><br> 导出对象的更多配置详见：<a href="https://vuepress.vuejs.org/zh/config/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE" rel="nofollow">VuePress的官方文档</a>。</p> 
<p>我们接下来侧重讲 VuePress 项目的目录结构以及导航栏与侧边栏的配置。</p> 
<h3><a id="41__79"></a>4.1 目录结构</h3> 
<p><img src="https://images2.imgbox.com/3a/14/jKlTUHl2_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>备注：其中 LaTex 相关的内容可以无视，这是用来生成 PDF 的配置文件。</p> 
</blockquote> 
<h3><a id="42__84"></a>4.2 导航栏</h3> 
<p><strong>导航栏</strong> 列表默认位于网页右上方，需要配置属性 themeConfig.nav，它是一个Array类型的变量，可以配置多个，其中每个元素包含显示文本 text 和指向链接 link，如果需要做成下拉列表，则使用名为 items 的数组替换 link 属性。</p> 
<p>link 是地址：</p> 
<ul><li>以 / 开头 和 / 结尾，默认读取文件夹下的 README.md。</li><li>仅以 / 开头，不写 .md 后缀，默认读取文件夹下对应的 markdown 文件。</li><li>如果是其它链接，直接写地址就行。</li><li>要配置多个，使用 items 嵌套。此时就是一个下拉列表。</li></ul> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    themeConfig<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        nav<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'主页'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token operator">...</span>
            <span class="token punctuation">{<!-- --></span>
                text<span class="token operator">:</span> <span class="token string">'知识库'</span><span class="token punctuation">,</span>
                items<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'FAQ'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'/KnowledgeBase/FAQ/1.AWTK'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'HowTo'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'/KnowledgeBase/HowTo/api_doc'</span> <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                text<span class="token operator">:</span> <span class="token string">'了解更多'</span><span class="token punctuation">,</span>
                items<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'AWTK 官网'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'https://www.zlg.cn/index/pub/awtk.html'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'AWTK 云平台'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'https://awtk.zlg.cn/'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'GitHub 仓库'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'https://github.com/zlgopen/awtk'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span> text<span class="token operator">:</span> <span class="token string">'Gitee 仓库'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'https://gitee.com/zlgopen/awtk'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/51/96/N1eEYW0a_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43__123"></a>4.3 侧边栏</h3> 
<p><strong>侧边栏</strong> 默认位于网页左侧，需要配置属性 themeConfig.sidebar，它是一个Object类型的变量，可以配置多个，其中每个元素包含文件路径 key 和该文件路径下的侧边栏详细配置 value，比如：文件路径为 /KnowledgeBase/FAQ/，其中有两个文档：AWTK、AWTK Designer。</p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    themeConfig<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        sidebar<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">'/KnowledgeBase/FAQ/'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
              title<span class="token operator">:</span> <span class="token string">'常见问题（FAQ）'</span><span class="token punctuation">,</span>
              children<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>title<span class="token operator">:</span><span class="token string">'AWTK'</span><span class="token punctuation">,</span>path<span class="token operator">:</span><span class="token string">'1.AWTK'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>title<span class="token operator">:</span><span class="token string">'AWTK Designer'</span><span class="token punctuation">,</span>path<span class="token operator">:</span>'<span class="token number">2.</span><span class="token constant">AWTK</span> Designer’<span class="token punctuation">}</span>
              <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/f4/OJ0dFTpO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="44__146"></a>4.4 自动生成侧边栏</h3> 
<p>通常文档多的时候手动配置侧边栏非常麻烦，因此这里采用了脚本自动生成，其原理如下：</p> 
<p>1、遍历指定路径中的Markdown文档，并过滤掉无关文档；<br> 2、通过符号“.”切割文件名获取序号，根据文档序号进行排序；<br> 3、抽取文档名称作为侧边栏标题（title），并拼接出文档路径（path）</p> 
<p>代码如下：</p> 
<pre><code class="prism language-js"><span class="token comment">// docs/.vuepress/utils/genSidebar.js</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rpath <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取根目录</span>
<span class="token keyword">var</span> <span class="token constant">DOCS_PATH</span> <span class="token operator">=</span> rpath<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 比较文档序列</span>
<span class="token keyword">function</span> <span class="token function">cmpMarkDown</span><span class="token punctuation">(</span><span class="token parameter">md1<span class="token punctuation">,</span> md2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> ls1 <span class="token operator">=</span> md1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ls2 <span class="token operator">=</span> md2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>ls1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>ls2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取md文档列表</span>
<span class="token keyword">function</span> <span class="token function">getMarkDownList</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> is_sort</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">==</span> <span class="token string">"string"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> is_sort <span class="token operator">==</span> <span class="token string">"boolean"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> file_list <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> file_list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> file <span class="token operator">=</span> file_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.md'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'README'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>is_sort<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>cmpMarkDown<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 裁剪到文本左侧的特殊字符</span>
<span class="token keyword">function</span> <span class="token function">trimRight</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> string <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        str <span class="token operator">=</span> string
        <span class="token keyword">var</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">' \t\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> i <span class="token operator">=</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> filter<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                i<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> genSidebar <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 生成侧边栏</span>
    <span class="token function-variable function">genDefaultSidebar</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> name<span class="token punctuation">,</span> version<span class="token punctuation">,</span> is_sort<span class="token punctuation">,</span> depth</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">==</span> <span class="token string">"string"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> name <span class="token operator">==</span> <span class="token string">"string"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> version <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> target_path <span class="token operator">=</span> rpath<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">DOCS_PATH</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> depth <span class="token operator">!=</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            object<span class="token punctuation">.</span>title <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">'_'</span> <span class="token operator">+</span> version<span class="token punctuation">;</span>
            object<span class="token punctuation">.</span>collapsable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            object<span class="token punctuation">.</span>sidebarDepth <span class="token operator">=</span> depth<span class="token punctuation">;</span>
            object<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> md_list <span class="token operator">=</span> <span class="token function">getMarkDownList</span><span class="token punctuation">(</span>target_path<span class="token punctuation">,</span> is_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> md_list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">let</span> md <span class="token operator">=</span> md_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> ls <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ls<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    iter<span class="token punctuation">.</span>title <span class="token operator">=</span> ls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    iter<span class="token punctuation">.</span>path <span class="token operator">=</span> ls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> ls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    iter<span class="token punctuation">.</span>title <span class="token operator">=</span> ls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    iter<span class="token punctuation">.</span>path <span class="token operator">=</span> ls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                object<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> genSidebar<span class="token punctuation">;</span>
</code></pre> 
<p>在 config.js 中的调用如下：</p> 
<pre><code class="prism language-js"><span class="token comment">// docs/.vuepress/config.js</span>
<span class="token keyword">const</span> genSidebar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/genSidebar.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token comment">/* 生成侧边栏配置 */</span>
<span class="token keyword">var</span> sidebar <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'/KnowledgeBase/FAQ/'</span><span class="token operator">:</span> genSidebar<span class="token punctuation">.</span><span class="token function">genDefaultSidebar</span><span class="token punctuation">(</span><span class="token string">'KnowledgeBase/FAQ'</span><span class="token punctuation">,</span> <span class="token string">'常见问题（FAQ）'</span><span class="token punctuation">,</span> <span class="token string">'知识库'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/* fallback 侧边栏必须最后定义，否则会导致侧边栏无法使用 */</span>
    <span class="token string">'/'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">/* vuepress 的配置对象 */</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    themeConfig<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        sidebar<span class="token operator">:</span> sidebar<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_266"></a>五、自定义主题</h2> 
<p>出于美观考虑，VuePress的默认主题并不能完全满足我们的需求，此时我们可以自定义主题。由于改动不大，我们可以弹出默认主题，在它的基础上进行修改：</p> 
<ul><li>将VuePress的默认主题但弹出到 docs/.vuepress 中：vuepress eject docs；</li><li>成功后会生成 docs/.vuepress/theme 目录，其中就是默认主题的源码文件；</li><li>目录结构：</li></ul> 
<p><img src="https://images2.imgbox.com/a7/7c/rTqtFqtP_o.png" alt="在这里插入图片描述"><br> 比如我们想修改网页首页，那么就可以直接修改 theme/components/Home.vue。</p> 
<h2><a id="_276"></a>六、避坑指南</h2> 
<h3><a id="61__277"></a>6.1 侧边栏无法正常使用</h3> 
<p>定义多个侧边栏时，确保 fallback 侧边栏（根目录‘/’ ）被最后定义，否则无法正常使用。</p> 
<h3><a id="62__280"></a>6.2 生成静态网页时出现解析错误</h3> 
<p>Markdown文档所在路径不能包含中文，否则生成静态网页时会出现解析错误。</p> 
<h3><a id="63__283"></a>6.3 部署站点无法使用相对路径</h3> 
<p>部署站点的基础路径默认为根目录‘/’，并且只能设置为绝对路径，比如我们项目的‘/docs/’。</p> 
<h3><a id="64_OOM_286"></a>6.4 预览或编译时内存溢出（OOM）</h3> 
<p>预览或编译时内存溢出（OOM），比如出现以下报错时：</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>--- Last few GCs ---<span class="token operator">&gt;</span>

<span class="token punctuation">[</span><span class="token number">10064</span>:00000000043D71B0<span class="token punctuation">]</span>   <span class="token number">273399</span> ms: Scavenge <span class="token number">1382.9</span> <span class="token punctuation">(</span><span class="token number">1421.7</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1382.3</span> <span class="token punctuation">(</span><span class="token number">1422.7</span><span class="token punctuation">)</span> MB, <span class="token number">3.1</span> / <span class="token number">0.0</span> ms  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">0.127</span>, current mu <span class="token operator">=</span> <span class="token number">0.068</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">10064</span>:00000000043D71B0<span class="token punctuation">]</span>   <span class="token number">273404</span> ms: Scavenge <span class="token number">1383.1</span> <span class="token punctuation">(</span><span class="token number">1422.7</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1382.5</span> <span class="token punctuation">(</span><span class="token number">1423.2</span><span class="token punctuation">)</span> MB, <span class="token number">3.2</span> / <span class="token number">0.0</span> ms  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">0.127</span>, current mu <span class="token operator">=</span> <span class="token number">0.068</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">10064</span>:00000000043D71B0<span class="token punctuation">]</span>   <span class="token number">273409</span> ms: Scavenge <span class="token number">1383.3</span> <span class="token punctuation">(</span><span class="token number">1423.2</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1382.7</span> <span class="token punctuation">(</span><span class="token number">1423.7</span><span class="token punctuation">)</span> MB, <span class="token number">3.0</span> / <span class="token number">0.0</span> ms  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">0.127</span>, current mu <span class="token operator">=</span> <span class="token number">0.068</span><span class="token punctuation">)</span> allocation failure


<span class="token operator">&lt;</span>--- JS stacktrace ---<span class="token operator">&gt;</span>

<span class="token operator">==</span><span class="token operator">==</span> JS stack trace <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<p>【原因分析】Node通过JavaScript使用内存时只能使用部分内存，64位系统下约1.4 GB/32位系统约0.7 GB。</p> 
<p>【解决方案】设置 node 内存使用上限(单位：M)： set NODE_OPTIONS=–max_old_space_size=8192</p> 
<h3><a id="65__309"></a>6.5 页面刷新异常或点击前进/返回异常：</h3> 
<p>两种前端路由模式：</p> 
<p><strong>Hash（#）</strong>：监听URL中hash的变化，渲染页面，它不向服务器发送请求，不需要服务端的支持</p> 
<ul><li>当页面中的hash发生变化时（在URL后面添加#xxxx），会触发hashchange事件；</li><li>事件中的event对象有oldURL和newURL两个属性，这样就能根据对应的hash值，做出相应操作；</li></ul> 
<p>比如，http://www.abc.com/#/hello，hash 的值为 #/hello。它的特点在于：hash 虽然出现在 URL 中，但不会被包括在 HTTP 请求中，对后端完全没有影响，因此改变 hash 不会重新加载页面。</p> 
<p><strong>History（/）</strong>：监听URL中的路径变化，需要客户端和服务端共同的支持</p> 
<p>利用了 HTML5 中新增的 pushState() 和 replaceState() 方法。它们应用于浏览器的历史记录栈，提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前的 URL，但浏览器不会立即向后端发送请求。</p> 
<p>了解更多：<a href="https://www.cnblogs.com/tugenhua0707/p/10859214.html" rel="nofollow">前端路由hash、history原理及简单的实践下 - 龙恩0707 - 博客园 (cnblogs.com)</a></p> 
<p>VuePress 对 hash 模式的处理有问题，当刷新页面或返回页面时， hashchange 事件的回调函数没有处理好，hash 路由表更新有误，导致网页访问出错。</p> 
<p>因此，建议使用 VuePress 默认 history 模式，路由模式修改方式如下：</p> 
<ul><li>打开 node_modules/@vuepress/core/lib/client/app.js 文件；</li><li>找到 createApp 函数，修改 router 对象中的 mode 属性为 history。</li></ul> 
<p><img src="https://images2.imgbox.com/7b/b7/lEvgZdfd_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="66__335"></a>6.6 生成静态网页时内存消耗过多</h3> 
<p>VuePress v1.x 的在生成静态网页时，随着页面个数增多，消耗的内存会异常高。</p> 
<p>比如：1300 个页面，消耗内存约 7G，耗时 100 分钟，根据官方资料以及类似的问题分析，原因如下：</p> 
<ul><li>VuePress v1.x 需要通过将所有页面的数据加载到内存来生成搜索框所需的索引文件；</li><li>VuePress v1.x 使用 webpack 作为内核打包静态网页，而该工具本身消耗内存就比较多；</li><li>VuePress v1.x 疑似存在内存泄露，但官方人员说将不会在 v1.x 版本上修复，建议用户升级到 v2.x；</li></ul> 
<p>因此，有条件的话可以迁移到 <a href="https://v2.vuepress.vuejs.org/zh/" rel="nofollow">VuePress v2.x</a> 上。</p> 
<p>参考资料：</p> 
<p>【官方issue】</p> 
<ul><li><a href="https://github.com/vuejs/vuepress/issues/2448">https://github.com/vuejs/vuepress/issues/2448</a></li><li><a href="https://github.com/vuejs/vuepress/issues/2689">https://github.com/vuejs/vuepress/issues/2689</a></li><li><a href="https://github.com/vuepress/vuepress-next/issues/8">https://github.com/vuepress/vuepress-next/issues/8</a></li></ul> 
<p>【类似的问题】</p> 
<ul><li><a href="https://github.com/openupm/openupm/issues/2427">https://github.com/openupm/openupm/issues/2427</a></li><li><a href="https://github.com/ipfs/ipfs-blog/issues/41">https://github.com/ipfs/ipfs-blog/issues/41</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8851f9980668e125247f7f16f0995a79/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java 与(&amp;)、或(|)、异或(^)、按位取反(~)、左移（＜＜）、右移（＞＞）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/844dd4110f62674f9c7748f63c9d5215/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小明都可以买什么(JAVA基础案例教程第二章-课后作业)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>