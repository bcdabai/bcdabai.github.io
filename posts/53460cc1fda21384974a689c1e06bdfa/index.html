<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C语言服务端端口监听 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C语言服务端端口监听" />
<meta property="og:description" content="C语言连接成功MySQL后需要监听端口发来的消息，最后使用NetAssist测试
服务端输出界面
注意，这里需要改成你虚拟机的ip和端口
完整代码，点赞收藏不迷路：
#include &lt;stdio.h&gt; #include &lt;netinet/in.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/socket.h&gt; #include &lt;stdlib.h&gt; #include &#34;/usr/include/linux/socket.h&#34; #include &lt;string.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;time.h&gt; #include &lt;netinet/tcp.h&gt; #include &lt;sys/types.h&gt; #include &lt;ctype.h&gt; #include &lt;signal.h&gt; #include &lt;stdbool.h&gt; #include &lt;fcntl.h&gt; #include &lt;stdarg.h&gt; #include &lt;/usr/local/mysql/include/mysql.h&gt; void monitor() { // 1. 创建监听的套接字 int lfd = socket(AF_INET, SOCK_STREAM, 0); printf(&#34;创建监听的套接字\n&#34;); if(lfd == -1) { perror(&#34;socket&#34;); exit(0); } // 2. 将socket()返回值和本地的IP端口绑定到一起 struct sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(5555); // 大端端口 // INADDR_ANY代表本机的所有IP, 假设有三个网卡就有三个IP地址 // 这个宏可以代表任意一个IP地址 // 这个宏一般用于本地的绑定操作 addr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/53460cc1fda21384974a689c1e06bdfa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-28T09:13:49+08:00" />
<meta property="article:modified_time" content="2023-02-28T09:13:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C语言服务端端口监听</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">C语言连接成功MySQL后需要监听端口发来的消息，最后使用NetAssist测试</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1162px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:85.54217%;height:0;"> 
    <img src="https://images2.imgbox.com/4f/58/pKjvj7cV_o.png" style="margin-left:;display:block;width:1162px;margin-top:-85.54217%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">服务端输出界面</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:661px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:98.33585%;height:0;"> 
    <img src="https://images2.imgbox.com/a4/19/p95DWpIc_o.png" style="margin-left:;display:block;width:661px;margin-top:-98.33585%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">注意，这里需要改成你虚拟机的ip和端口</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:913px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:48.19277%;height:0;"> 
    <img src="https://images2.imgbox.com/f3/08/V8V37ZzL_o.png" style="margin-left:;display:block;width:913px;margin-top:-48.19277%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">完整代码，点赞收藏不迷路：</p> 
 <pre class="kdocs-cpp"><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;stdlib.h&gt;
#include "/usr/include/linux/socket.h"
#include &lt;string.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;time.h&gt;
#include &lt;netinet/tcp.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;ctype.h&gt;
#include &lt;signal.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;stdarg.h&gt;
#include &lt;/usr/local/mysql/include/mysql.h&gt;

void monitor()
{
    // 1. 创建监听的套接字
    int lfd = socket(AF_INET, SOCK_STREAM, 0);
    printf("创建监听的套接字\n");
    if(lfd == -1)
    {
        perror("socket");
        exit(0);
    }

    // 2. 将socket()返回值和本地的IP端口绑定到一起
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(5555);   // 大端端口
    // INADDR_ANY代表本机的所有IP, 假设有三个网卡就有三个IP地址
    // 这个宏可以代表任意一个IP地址
    // 这个宏一般用于本地的绑定操作
    addr.sin_addr.s_addr = INADDR_ANY;  // 这个宏的值为0 == 0.0.0.0
    inet_pton(AF_INET, "192.168.154.141", &amp;addr.sin_addr.s_addr);
    int ret = bind(lfd, (struct sockaddr*)&amp;addr, sizeof(addr));
    printf("IP端口绑定\n");
    if(ret == -1)
    {
        perror("bind");
        exit(0);
    }

    // 3. 设置监听
    ret = listen(lfd, 128);
    printf("设置监听\n");
    if(ret == -1)
    {
        perror("listen");
        exit(0);
    }

    // 4. 阻塞等待并接受客户端连接
    struct sockaddr_in cliaddr;
    int clilen = sizeof(cliaddr);
    int cfd = accept(lfd, (struct sockaddr*)&amp;cliaddr, &amp;clilen);
    printf("阻塞等待并接受客户端连接\n");
    if(cfd == -1)
    {
        perror("accept");
        exit(0);
    }
    // 打印客户端的地址信息
    char ip[24] = {0};
    printf("客户端的IP地址: %s, 端口: %d\n",
           inet_ntop(AF_INET, &amp;cliaddr.sin_addr.s_addr, ip, sizeof(ip)),
           ntohs(cliaddr.sin_port));

    // 5. 和客户端通信
    while(1)
    {
        // 接收数据
        char buf[1024];
        memset(buf, 0, sizeof(buf));
        int len = read(cfd, buf, sizeof(buf));
        if(len &gt; 0)
        {
            printf("客户端say: %s\n", buf);
            printf("%d",sizeof(buf));
        write(cfd, buf, len);
        }
        else if(len  == 0)
        {
            printf("客户端断开了连接...\n");
            break;
        }
        else
        {
            perror("read\n");
            break;
        }
    }

    close(cfd);
    close(lfd);

    printf("监听结束\n");

    return 0;
}

int main(int argc, const char *argv[])
{
    char DeleteById[12], UpdateById[12], SelectById[12], InsertById[12], Name[7],Sex[7],Age[7],StudyDate[7],Major[7],Class[7],Address[7],Tel[7];
    MYSQL mysql_con;
    MYSQL *mysql = mysql_init(&amp;mysql_con);
    if (mysql == NULL)
    {
        printf("init err! 数据库初始化错误！\n");
    }
    if (mysql_real_connect(mysql, "192.168.154.141", "root", "123456", "school", 3306, NULL, 0) == NULL)
    {
        printf("  connect err!数据库连接失败！\n");
        return -1;
    }
    printf("%s", mysql_error(mysql));
    printf("数据库连接测试成功！\n");
    monitor();
}</code></pre> 
 <p style="">点赞收藏不迷路</p> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6d8a986e81378767829472c7ccb1bb4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux升级gcc版本详细教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ccf39776b92470d57dde63ab0a5c9f6d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue 表格 侧边(竖向)表头展示数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>