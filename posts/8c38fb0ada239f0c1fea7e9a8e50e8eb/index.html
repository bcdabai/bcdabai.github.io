<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>django获取数据库数据并设置select下拉框当前值。 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="django获取数据库数据并设置select下拉框当前值。" />
<meta property="og:description" content=" 问题场景： Django开发，有后台数据对象info，要select下拉框中设置从数据库中读出来的值info.credit为当前值。
解决分析 方法：要设置下拉框的当前值，要通过js实现，将select的某个值设为选中，可以通过改对应的selected属性为selected，也可以用jquery框架直接将值为某个值的选项设为选中。 取值：但是在js里面要的获取后台数据库的数据有三种途径： 在后台往模板中的js代码块部分填入后台数据。
js中的代码,{{后台填入的值}}或者写进val中不用赋值给变量，第二句是用jQuery框架直接获取元素的，设它的当前值 var credit={{info_credit | safe }} $(&#34;#id_selector&#34;).val(credit); #django中的代码 def get_info(request): obj_info=ModuleInfo.objects.get(xxx_id=xxx_id)#查询数据库得到一个结果集变量 return render(request,&#39;模板.html&#39;,{&#39;info&#39;:obj_info,‘info_credit’:json.dumps(obj_info.credit)}) 在js函数里通过ajax请求获得json数据给js变量赋值
var credit=0 $.ajax({ url: &#34;/ajax_query_credit/&#34;, type: &#34;POST&#34;, data: {&#34;info_id&#34;: &#39;0&#39;}, success: function (response) { credit=response[&#39;credit&#39;] }, dataType: &#39;json&#39;, }); #后台 def ajax_query_credit(request): id_info=request.POST.get(&#39;id_info&#39;) obj_info=ModuleInfo.objects.get(id_info=id_info)#查询数据库得到一个结果集变量 return HttpResponse(json.dumps({&#39;credit&#39;:id_info.credit})) 从html文件中获取对应元素的值
由于后台传入的是一个对象info，非json数据，在html中是{{info.credit}}直接取的，在js中不行，要为json数据。 （由于不想在后台传的参数中额外加入一个json化的info.credit）所以，这里在js里搞了个小操作。 在js中获取html模板中的已经填好的值，再将html的{{info.credit}}给隐藏掉。 html：&lt;p id=&#34;hide_credit&#34; hidden&gt;{{info.credit}}&lt;/p&gt; js: $(&#34;#id_credit_selector&#34;).val($(&#34;#hide_language&#34;).text()); 注意：写入js中的要是json数据，所以写入js的数据后台要转化字典值为json。还有在views中写好了功能函数记得在urls.py绑定url请求哦，格式path(&#39;/xxx/&#39;,views.xxx),。我用的是最后一种，用哪种根据具体情况而定。 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8c38fb0ada239f0c1fea7e9a8e50e8eb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-09T16:02:16+08:00" />
<meta property="article:modified_time" content="2019-10-09T16:02:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">django获取数据库数据并设置select下拉框当前值。</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>问题场景：</h4> 
<p>Django开发，有后台数据对象<code>info</code>，要select下拉框中设置从数据库中读出来的值<code>info.credit</code>为当前值。</p> 
<hr> 
<h4><a id="_4"></a>解决分析</h4> 
<ul><li><strong>方法</strong>：要设置下拉框的当前值，要通过js实现，将select的某个值设为选中，可以通过改对应的selected属性为selected，也可以用jquery框架直接将值为某个值的选项设为选中。</li></ul> 
<hr> 
<ul><li><strong>取值</strong>：但是在js里面要的获取后台数据库的数据有三种途径：</li></ul> 
<hr> 
<p>在后台往模板中的js代码块部分填入后台数据。</p> 
<pre><code class="prism language-javascript">js中的代码<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>后台填入的值<span class="token punctuation">}</span><span class="token punctuation">}</span>或者写进val中不用赋值给变量，第二句是用jQuery框架直接获取元素的，设它的当前值
<span class="token keyword">var</span> credit<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>info_credit <span class="token operator">|</span> safe <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#id_selector"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#django中的代码</span>
<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	obj_info<span class="token operator">=</span>ModuleInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>xxx_id<span class="token operator">=</span>xxx_id<span class="token punctuation">)</span><span class="token comment">#查询数据库得到一个结果集变量</span>
	<span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'模板.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'info'</span><span class="token punctuation">:</span>obj_info<span class="token punctuation">,</span>‘info_credit’<span class="token punctuation">:</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj_info<span class="token punctuation">.</span>credit<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p>在js函数里通过ajax请求获得json数据给js变量赋值</p> 
<pre><code class="prism language-javascript"><span class="token keyword">var</span> credit<span class="token operator">=</span><span class="token number">0</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token punctuation">:</span> <span class="token string">"/ajax_query_credit/"</span><span class="token punctuation">,</span>
            type<span class="token punctuation">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"info_id"</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                credit<span class="token operator">=</span>response<span class="token punctuation">[</span><span class="token string">'credit'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            dataType<span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#后台</span>
<span class="token keyword">def</span> <span class="token function">ajax_query_credit</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	id_info<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'id_info'</span><span class="token punctuation">)</span>
	obj_info<span class="token operator">=</span>ModuleInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>id_info<span class="token operator">=</span>id_info<span class="token punctuation">)</span><span class="token comment">#查询数据库得到一个结果集变量</span>
	<span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'credit'</span><span class="token punctuation">:</span>id_info<span class="token punctuation">.</span>credit<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p>从html文件中获取对应元素的值</p> 
<pre><code class="prism language-javascript">由于后台传入的是一个对象info，非json数据，在html中是<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>info<span class="token punctuation">.</span>credit<span class="token punctuation">}</span><span class="token punctuation">}</span>直接取的，在js中不行，要为json数据。
（由于不想在后台传的参数中额外加入一个json化的info<span class="token punctuation">.</span>credit）所以，这里在js里搞了个小操作。
在js中获取html模板中的已经填好的值，再将html的<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>info<span class="token punctuation">.</span>credit<span class="token punctuation">}</span><span class="token punctuation">}</span>给隐藏掉。
html：<span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">"hide_credit"</span>  hidden<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>info<span class="token punctuation">.</span>credit<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
js<span class="token punctuation">:</span>
 <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#id_credit_selector"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#hide_language"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<ul><li><strong>注意</strong>：写入js中的要是json数据，所以写入js的数据后台要转化字典值为json。还有在views中写好了功能函数记得在urls.py绑定url请求哦，格式<code>path('/xxx/',views.xxx),</code>。我用的是最后一种，用哪种根据具体情况而定。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44298c05fbe0692167ef1f986890a629/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一些常见的js校验</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/94323d22e8eb592dedb525f01bcc281a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python打包运行在Linux上</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>