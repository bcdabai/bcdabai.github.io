<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>菜单ListView联动内容RecyclerView（带吸顶效果） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="菜单ListView联动内容RecyclerView（带吸顶效果）" />
<meta property="og:description" content="这两天测试发的bug修得差不多了，有点属于自己的时间，写了个仿美团/京东的ListView联动Demo，现供大家参考参考，如有bug或更好的实现方式，望大家多多指出。 先来看看效果 一、首先我们来看看MainActivity.java 这里有data和view的处理。data为测试用的，view为左边一个ListView以及适配器AdapterLeft和右边RecyclerView和适配器AdapterRight，提醒下RecyclerView别忘了setLayoutManager（）。
package com.zyf.linkagelistview; import android.app.Activity; import android.os.Bundle; import android.support.v7.widget.LinearLayoutManager; import android.support.v7.widget.RecyclerView; import android.util.Log; import android.view.View; import android.widget.AdapterView; import android.widget.ListView; import com.zyf.linkagelistview.adapter.AdapterLeft; import com.zyf.linkagelistview.adapter.AdapterRight; import com.zyf.linkagelistview.bean.Bean; import java.util.ArrayList; public class MainActivity extends Activity { private static final String TAG = MainActivity.class.getSimpleName(); private ListView mListViewLeft; private AdapterLeft mAdapterLeft; private RecyclerView mListViewRight; private AdapterRight mAdapterRight; private ArrayList&lt;Bean&gt; dataList = new ArrayList&lt;&gt;(); private ArrayList&lt;String&gt; titleList = new ArrayList&lt;&gt;(); private ArrayList&lt;Integer&gt; titlePosList = new ArrayList&lt;&gt;(); private String mCurTitle = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1fc7ff098e62c79113fac02d9f56edb8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-09T14:34:33+08:00" />
<meta property="article:modified_time" content="2017-05-09T14:34:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">菜单ListView联动内容RecyclerView（带吸顶效果）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>　　这两天测试发的bug修得差不多了，有点属于自己的时间，写了个<strong>仿美团/京东的ListView联动Demo</strong>，现供大家参考参考，如有bug或更好的实现方式，望大家多多指出。 <br> 先来看看效果 <br> <img src="https://images2.imgbox.com/3c/6e/dCNJEFWU_o.gif" alt="这里写图片描述" title=""></p> 
<hr> 
<p>　　<strong>一、首先我们来看看MainActivity.java</strong> 这里有data和view的处理。data为测试用的，view为左边一个ListView以及适配器AdapterLeft和右边RecyclerView和适配器AdapterRight，提醒下RecyclerView别忘了setLayoutManager（）。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.zyf.linkagelistview;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.v7.widget.LinearLayoutManager;
<span class="hljs-keyword">import</span> android.support.v7.widget.RecyclerView;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.ListView;

<span class="hljs-keyword">import</span> com.zyf.linkagelistview.adapter.AdapterLeft;
<span class="hljs-keyword">import</span> com.zyf.linkagelistview.adapter.AdapterRight;
<span class="hljs-keyword">import</span> com.zyf.linkagelistview.bean.Bean;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = MainActivity.class.getSimpleName();
    <span class="hljs-keyword">private</span> ListView mListViewLeft;
    <span class="hljs-keyword">private</span> AdapterLeft mAdapterLeft;

    <span class="hljs-keyword">private</span> RecyclerView mListViewRight;
    <span class="hljs-keyword">private</span> AdapterRight mAdapterRight;

    <span class="hljs-keyword">private</span> ArrayList&lt;Bean&gt; dataList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> ArrayList&lt;String&gt; titleList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> ArrayList&lt;Integer&gt; titlePosList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-keyword">private</span> String mCurTitle = <span class="hljs-string">""</span>;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        initView();
        initData();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>(){
        mListViewLeft = (ListView) findViewById(R.id.listview_left);
        mAdapterLeft = <span class="hljs-keyword">new</span> AdapterLeft(<span class="hljs-keyword">this</span>, titleList);
        mListViewLeft.setAdapter(mAdapterLeft);
        mListViewLeft.setOnItemClickListener(<span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">long</span> l) {
                mAdapterLeft.setSelection(pos);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != titleList &amp;&amp; titleList.size()&gt;pos)
                    mAdapterRight.setSelection(pos);
            }
        });

        mListViewRight = (RecyclerView) findViewById(R.id.listview_right);
        LinearLayoutManager linearLayoutManager = <span class="hljs-keyword">new</span> LinearLayoutManager(<span class="hljs-keyword">this</span>, LinearLayoutManager.VERTICAL, <span class="hljs-keyword">false</span>);
        mListViewRight.setLayoutManager(linearLayoutManager);
        mAdapterRight = <span class="hljs-keyword">new</span> AdapterRight(<span class="hljs-keyword">this</span>, dataList, titlePosList, mListViewRight);
        mListViewRight.addItemDecoration(<span class="hljs-keyword">new</span> ItemDecoration(<span class="hljs-keyword">this</span>, dataList, <span class="hljs-keyword">new</span> ItemDecoration.OnDecorationCallback() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title">onGroupId</span>(<span class="hljs-keyword">int</span> pos) {
                <span class="hljs-keyword">if</span> (dataList.get(pos).getTitle() != <span class="hljs-keyword">null</span>)
                    <span class="hljs-keyword">return</span> dataList.get(pos).getTitle();
                <span class="hljs-keyword">return</span> <span class="hljs-string">"-1"</span>;
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title">onGroupFirstStr</span>(<span class="hljs-keyword">int</span> pos) {
                <span class="hljs-keyword">if</span> (dataList.get(pos).getTitle() != <span class="hljs-keyword">null</span>)
                    <span class="hljs-keyword">return</span> dataList.get(pos).getTitle();
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onGroupFirstStr</span>(String title) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;titleList.size(); i++){
                    <span class="hljs-keyword">if</span> (!mCurTitle.equals(title) &amp;&amp; title.equals(titleList.get(i))){
                        mCurTitle = title;
                        mAdapterLeft.setSelection(i);　<span class="hljs-comment">// 设置左边ListView选中item</span>
                        Log.i(TAG, <span class="hljs-string">"onGroupFirstStr: i = "</span>+i);
                    }
                }
            }
        }));
        mListViewRight.setAdapter(mAdapterRight);
    }

    <span class="hljs-javadoc">/**
     * 数据
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initData</span>(){
        titlePosList.add(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++){
            Bean bean = <span class="hljs-keyword">new</span> Bean();
            bean.setTitle(<span class="hljs-string">"0"</span>);
            bean.setText(<span class="hljs-string">"zzzz"</span>);
            dataList.add(bean);
        }
        titleList.add(dataList.get(dataList.size()-<span class="hljs-number">1</span>).getTitle());
        titlePosList.add(dataList.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">15</span>; i++){
            Bean bean = <span class="hljs-keyword">new</span> Bean();
            bean.setTitle(<span class="hljs-string">"1"</span>);
            bean.setText(<span class="hljs-string">"xxxx"</span>);
            dataList.add(bean);
        }
        titleList.add(dataList.get(dataList.size()-<span class="hljs-number">1</span>).getTitle());
        titlePosList.add(dataList.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">20</span>; i++){
            Bean bean = <span class="hljs-keyword">new</span> Bean();
            bean.setTitle(<span class="hljs-string">"2"</span>);
            bean.setText(<span class="hljs-string">"cccc"</span>);
            dataList.add(bean);
        }
        titleList.add(dataList.get(dataList.size()-<span class="hljs-number">1</span>).getTitle());
        titlePosList.add(dataList.size());
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">10</span>; i++){
            Bean bean = <span class="hljs-keyword">new</span> Bean();
            bean.setTitle(<span class="hljs-string">"3"</span>);
            bean.setText(<span class="hljs-string">"dddd"</span>);
            dataList.add(bean);
        }
        titleList.add(dataList.get(dataList.size()-<span class="hljs-number">1</span>).getTitle());
        mAdapterLeft.notifyDataSetChanged();
        mAdapterRight.notifyDataSetChanged();
    }
}
</code></pre> 
<p>其布局也就一个ListView和一个RecyclerView</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/activity_main"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ListView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/listview_left"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"100dp"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:scrollbars</span>=<span class="hljs-value">"none"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">android.support.v7.widget.RecyclerView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/listview_right"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:scrollbars</span>=<span class="hljs-value">"none"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<hr> 
<p>　　<strong>二、数据需要的Bean</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.zyf.linkagelistview.bean;

<span class="hljs-javadoc">/**
 * Created by zyf on 2017/5/8.
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bean</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String text;

    <span class="hljs-keyword">public</span> <span class="hljs-title">Bean</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">Bean</span>(String title, String text) {
        <span class="hljs-keyword">this</span>.title = title;
        <span class="hljs-keyword">this</span>.text = text;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getTitle</span>() {
        <span class="hljs-keyword">return</span> title;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTitle</span>(String title) {
        <span class="hljs-keyword">this</span>.title = title;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getText</span>() {
        <span class="hljs-keyword">return</span> text;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setText</span>(String text) {
        <span class="hljs-keyword">this</span>.text = text;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Bean{"</span> +
                <span class="hljs-string">"title='"</span> + title + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", text='"</span> + text + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'}'</span>;
    }
}</code></pre> 
<hr> 
<p><strong>三、两个适配器</strong></p> 
<p>　　1、左边ListView适配器AdapterLeft.java，方法setSelection(int selection)设置选中其中的item。此处布局就一个TextView就不贴布局代码了。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.zyf.linkagelistview.adapter;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.graphics.Color;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> com.zyf.linkagelistview.R;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-javadoc">/**
 * Created by zyf on 2017/5/8.
 * 左边ListView适配器
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdapterLeft</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseAdapter</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = AdapterLeft.class.getSimpleName();
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-keyword">private</span> ArrayList&lt;String&gt; mDataList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSelection = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title">AdapterLeft</span>(Context mContext, ArrayList&lt;String&gt; mDataList) {
        <span class="hljs-keyword">this</span>.mContext = mContext;
        <span class="hljs-keyword">this</span>.mDataList = mDataList;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span>() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDataList)
            <span class="hljs-keyword">return</span> mDataList.size();
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">getItem</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDataList)
            <span class="hljs-keyword">return</span> mDataList.get(i);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getItemId</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> View <span class="hljs-title">getView</span>(<span class="hljs-keyword">int</span> position, View view, ViewGroup viewGroup) {
        ViewHolder viewHolder = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == view){
            viewHolder = <span class="hljs-keyword">new</span> ViewHolder();
            view = LayoutInflater.from(mContext).inflate(R.layout.item_left, <span class="hljs-keyword">null</span>);
            viewHolder.textContent = (TextView) view.findViewById(R.id.text_content);
            view.setTag(viewHolder);
        }<span class="hljs-keyword">else</span> {
            viewHolder = (ViewHolder) view.getTag();
        }
        <span class="hljs-comment">// 设置被选中的item的字体颜色</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != viewHolder.textContent &amp;&amp; mSelection == position){
            viewHolder.textContent.setTextColor(Color.RED);
        }<span class="hljs-keyword">else</span> {
            viewHolder.textContent.setTextColor(Color.BLACK);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != viewHolder.textContent &amp;&amp; <span class="hljs-keyword">null</span> != mDataList &amp;&amp; mDataList.size()&gt;<span class="hljs-number">0</span>){
            viewHolder.textContent.setText(mDataList.get(position));
        }<span class="hljs-keyword">else</span> {
            Log.i(TAG, <span class="hljs-string">"getView: null == mDataList"</span>);
        }
        <span class="hljs-keyword">return</span> view;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSelection</span>() {
        <span class="hljs-keyword">return</span> mSelection;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSelection</span>(<span class="hljs-keyword">int</span> selection) {
        mSelection = selection;
        notifyDataSetChanged();
    }

    class ViewHolder{
        TextView textHead;
        TextView textContent;
    }
}</code></pre> 
<p>　　2、右边RecyclerView适配器AdapterRight.java，重点是RecyclerView移动到指定的位置moveToPosition（int n）方法。布局同菜单ListView中的item布局，只有一个TextView就不贴出来了。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.zyf.linkagelistview.adapter;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.os.SystemClock;
<span class="hljs-keyword">import</span> android.support.v7.widget.LinearLayoutManager;
<span class="hljs-keyword">import</span> android.support.v7.widget.RecyclerView;
<span class="hljs-keyword">import</span> android.text.TextUtils;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.MotionEvent;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> com.zyf.linkagelistview.MainActivity;
<span class="hljs-keyword">import</span> com.zyf.linkagelistview.R;
<span class="hljs-keyword">import</span> com.zyf.linkagelistview.bean.Bean;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-javadoc">/**
 * Created by zyf on 2017/5/8.
 * 右边RecyclerView适配器
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdapterRight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = AdapterRight.class.getSimpleName();
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-keyword">private</span> ArrayList&lt;Bean&gt; mDataList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> ArrayList&lt;Integer&gt; mTitleIntList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> RecyclerView mRecyclerView;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mShouldScroll = <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title">AdapterRight</span>(Context context, ArrayList&lt;Bean&gt; dataList, ArrayList&lt;Integer&gt; titleIntList, RecyclerView recyclerView) {
        mContext = context;
        mDataList = dataList;
        mTitleIntList = titleIntList;
        mRecyclerView = recyclerView;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> RecyclerView.ViewHolder <span class="hljs-title">onCreateViewHolder</span>(ViewGroup parent, <span class="hljs-keyword">int</span> viewType) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ViewHolder(LayoutInflater.from(mContext).inflate(R.layout.item_right, <span class="hljs-keyword">null</span>));
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBindViewHolder</span>(RecyclerView.ViewHolder holder, <span class="hljs-keyword">int</span> position) {
        ViewHolder viewHolder = (ViewHolder) holder;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDataList &amp;&amp; mDataList.size() &gt; <span class="hljs-number">0</span>) {
            viewHolder.textContent.setText(mDataList.get(position).getText());
        } <span class="hljs-keyword">else</span> {
            Log.i(TAG, <span class="hljs-string">"getView: null == mDataList"</span>);
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getItemCount</span>() {
        <span class="hljs-keyword">return</span> mDataList.size();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSelection</span>(<span class="hljs-keyword">int</span> pos) {
        <span class="hljs-keyword">if</span> (pos &lt; mDataList.size()) {
            moveToPosition(pos);
        }
    }

<span class="hljs-javadoc">/**
 * 使RecyclerView移动到指定的位置
 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">moveToPosition</span>(<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> n) {
        <span class="hljs-comment">//先从RecyclerView的LayoutManager中获取第一项和最后一项的Position</span>
        <span class="hljs-keyword">int</span> firstItem = ((LinearLayoutManager) mRecyclerView.getLayoutManager()).findFirstVisibleItemPosition();
        <span class="hljs-keyword">int</span> lastItem = ((LinearLayoutManager) mRecyclerView.getLayoutManager()).findLastVisibleItemPosition();
        <span class="hljs-keyword">int</span> pos = mTitleIntList.get(n);
        mShouldScroll = <span class="hljs-keyword">false</span>;
        mRecyclerView.setOnScrollListener(<span class="hljs-keyword">new</span> RecyclerViewListener(n));
        <span class="hljs-comment">//然后区分情况</span>
        <span class="hljs-keyword">if</span> (pos &lt;= firstItem) {
            <span class="hljs-comment">//当要置顶的项在当前显示的第一个项的前面时</span>
            mRecyclerView.scrollToPosition(pos);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pos &lt;= lastItem) {
            <span class="hljs-comment">//当要置顶的项已经在屏幕上显示时</span>
            <span class="hljs-keyword">int</span> top = mRecyclerView.getChildAt(pos - firstItem).getTop() - <span class="hljs-number">50</span>;
            mRecyclerView.scrollBy(<span class="hljs-number">0</span>, top);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//当要置顶的项在当前显示的最后一项的后面时,调用scrollToPosition只会将该项滑动到屏幕上。需要再次滑动到顶部</span>
            mRecyclerView.scrollToPosition(pos);
            <span class="hljs-comment">//这里这个变量是用在RecyclerView滚动监听里面的</span>
            mShouldScroll = <span class="hljs-keyword">true</span>;
        }
    }

    <span class="hljs-javadoc">/**
     * 滚动监听
     */</span>
    class RecyclerViewListener extends RecyclerView.OnScrollListener{
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>;
        RecyclerViewListener(<span class="hljs-keyword">int</span> n) {
            <span class="hljs-keyword">this</span>.n = n;
        }
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onScrolled</span>(RecyclerView recyclerView, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy) {
            <span class="hljs-keyword">super</span>.onScrolled(recyclerView, dx, dy);
            <span class="hljs-comment">//在这里进行第二次滚动</span>
            <span class="hljs-keyword">if</span> (mShouldScroll ){
                mShouldScroll = <span class="hljs-keyword">false</span>;
                moveToPosition(n);
            }
        }
    }

    class ViewHolder extends RecyclerView.ViewHolder {
        TextView textContent;
        ViewHolder(View itemView) {
            <span class="hljs-keyword">super</span>(itemView);
            textContent = (TextView) itemView.findViewById(R.id.text_content);
        }
    }
}
</code></pre> 
<hr> 
<p>　　<strong>四、RecyclerView吸顶效果的实现所必须要的自定义ItemDecoration 类</strong> 这个类需要认真看一下，实现了吸顶效果。通过getItemOffsets(Rect outRect, View view, RecyclerView parent, RecyclerView.State state)方法设置预留吸顶的高度，在onDraw(Canvas c, RecyclerView parent, RecyclerView.State state)方法以及onDrawOver(Canvas c, RecyclerView parent, RecyclerView.State state)方法中进行了坐标的计算，然后使用Canvas以及Paint、TextPaint绘制出吸顶</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.zyf.linkagelistview;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.res.Resources;
<span class="hljs-keyword">import</span> android.graphics.Canvas;
<span class="hljs-keyword">import</span> android.graphics.Color;
<span class="hljs-keyword">import</span> android.graphics.Paint;
<span class="hljs-keyword">import</span> android.graphics.Rect;
<span class="hljs-keyword">import</span> android.support.v7.widget.RecyclerView;
<span class="hljs-keyword">import</span> android.text.TextPaint;
<span class="hljs-keyword">import</span> android.text.TextUtils;
<span class="hljs-keyword">import</span> android.view.View;

<span class="hljs-keyword">import</span> com.zyf.linkagelistview.bean.Bean;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-javadoc">/**
 * Created by zyf on 2017/5/8.
 * 实现吸顶功能的RecyclerView
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ItemDecoration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ItemDecoration</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = ItemDecoration.class.getSimpleName();
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-keyword">private</span> ArrayList&lt;Bean&gt; mDataList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> OnDecorationCallback mOnDecorationCallback;

    <span class="hljs-keyword">private</span> Paint mPaint;
    <span class="hljs-keyword">private</span> TextPaint mTextPaint;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mTopGap = <span class="hljs-number">50</span>;          <span class="hljs-comment">// 吸顶高（可随意改变）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mAlignBottom = <span class="hljs-number">10</span>;


    <span class="hljs-keyword">public</span> <span class="hljs-title">ItemDecoration</span>(Context context, ArrayList&lt;Bean&gt; dataList, OnDecorationCallback onDecorationCallback) {
        <span class="hljs-keyword">this</span>.mContext = context;
        <span class="hljs-keyword">this</span>.mDataList = dataList;
        <span class="hljs-keyword">this</span>.mOnDecorationCallback = onDecorationCallback;

        Resources resources = mContext.getResources();
        mPaint = <span class="hljs-keyword">new</span> Paint();
        mPaint.setColor(resources.getColor(R.color.black));
        mTextPaint = <span class="hljs-keyword">new</span> TextPaint();
        mTextPaint.setColor(Color.WHITE);
        mTextPaint.setAntiAlias(<span class="hljs-keyword">true</span>); <span class="hljs-comment">// 去锯齿</span>
        mTextPaint.setTextSize(<span class="hljs-number">25</span>);
        mTextPaint.setTextAlign(Paint.Align.LEFT);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getItemOffsets</span>(Rect outRect, View view, RecyclerView parent, RecyclerView.State state) {
        <span class="hljs-keyword">super</span>.getItemOffsets(outRect, view, parent, state);
        <span class="hljs-keyword">int</span> pos = parent.getChildAdapterPosition(view);
        String groupId = mOnDecorationCallback.onGroupId(pos);
        <span class="hljs-keyword">if</span> (groupId.equals(<span class="hljs-string">"-1"</span>))
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (pos == <span class="hljs-number">0</span> || isGroupFirstItem(pos)){
            outRect.top = mTopGap;   <span class="hljs-comment">// 每组的头部都预留出位置</span>
            <span class="hljs-keyword">if</span> (mDataList.get(pos).getTitle().equals(<span class="hljs-string">""</span>))
                outRect.top = <span class="hljs-number">0</span>;
        }<span class="hljs-keyword">else</span> {
            outRect.top = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span>(Canvas c, RecyclerView parent, RecyclerView.State state) {
        <span class="hljs-keyword">super</span>.onDraw(c, parent, state);

        <span class="hljs-keyword">int</span> left = parent.getPaddingLeft();
        <span class="hljs-keyword">int</span> right = parent.getWidth() - parent.getPaddingRight();
        <span class="hljs-keyword">int</span> childCount = parent.getChildCount();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;childCount; i++){
            View view = parent.getChildAt(i);
            <span class="hljs-keyword">int</span> pos = parent.getChildAdapterPosition(view);
            String groupId = mOnDecorationCallback.onGroupId(pos);
            <span class="hljs-keyword">if</span> (groupId.equals(<span class="hljs-string">"-1"</span>))
                <span class="hljs-keyword">return</span>;
            String textLine = mOnDecorationCallback.onGroupFirstStr(pos).toUpperCase();
            <span class="hljs-keyword">if</span> (textLine.equals(<span class="hljs-string">""</span>)){
                <span class="hljs-keyword">float</span> top = view.getTop();
                <span class="hljs-keyword">float</span> bottom = view.getTop();
                c.drawRect(left, top, right, bottom, mPaint);
                <span class="hljs-keyword">return</span>;
            }<span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (pos == <span class="hljs-number">0</span> || isGroupFirstItem(pos)){  <span class="hljs-comment">// 当前位置为0或为一组中的第一个时，显示顶部</span>
                    <span class="hljs-keyword">float</span> top = view.getTop() - mTopGap;
                    <span class="hljs-keyword">float</span> bottom =  view.getTop();
                    c.drawRect(left, top, right, bottom, mPaint);
                    c.drawText(textLine, left, bottom, mTextPaint);
                }
            }

        }
    }

    <span class="hljs-comment">// 在onDraw之后调用，此处做吸顶一直存在的功能</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDrawOver</span>(Canvas c, RecyclerView parent, RecyclerView.State state) {
        <span class="hljs-keyword">super</span>.onDrawOver(c, parent, state);
        <span class="hljs-keyword">int</span> itemCount = state.getItemCount();
        <span class="hljs-keyword">int</span> childCount = parent.getChildCount();
        <span class="hljs-keyword">int</span> left = parent.getPaddingLeft();
        <span class="hljs-keyword">int</span> right = parent.getWidth() - parent.getPaddingRight();

        String preGroupId = <span class="hljs-string">""</span>;
        String groupId = <span class="hljs-string">"-1"</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;childCount; i++){
            View view = parent.getChildAt(i);
            <span class="hljs-keyword">int</span> position = parent.getChildAdapterPosition(view);

            preGroupId = groupId;
            groupId = mOnDecorationCallback.onGroupId(position);

            <span class="hljs-keyword">if</span> (groupId.equals(<span class="hljs-string">"-1"</span>) || groupId.equals(preGroupId))
                <span class="hljs-keyword">continue</span>;
            String textLine = mOnDecorationCallback.onGroupFirstStr(position).toUpperCase();
            <span class="hljs-keyword">if</span> (TextUtils.isEmpty(textLine))
                <span class="hljs-keyword">continue</span>;

            <span class="hljs-keyword">int</span> viewBottom = view.getBottom();
            <span class="hljs-comment">// 当view.getTop()&lt;mTopGap的时候，一直显示在顶部mTopGap的位置</span>
            <span class="hljs-keyword">float</span> textY = Math.max(mTopGap, view.getTop());

            <span class="hljs-comment">// 此处实现被后一个title顶出屏幕的效果</span>
            <span class="hljs-keyword">if</span> (position + <span class="hljs-number">1</span> &lt; itemCount){
                String nextGroupId = mOnDecorationCallback.onGroupId(position + <span class="hljs-number">1</span>);
                <span class="hljs-comment">// 当后面一组的顶部位置到达当前组吸顶的底部时，将当前组吸顶往上移动（被顶出屏幕）</span>
                <span class="hljs-keyword">if</span> (!nextGroupId.equals(groupId) &amp;&amp; viewBottom &lt; textY){
                    textY = viewBottom;
                }
            }

            <span class="hljs-keyword">if</span> (view.getTop() &lt; textY){
                mOnDecorationCallback.onGroupFirstStr(textLine);
            }
            c.drawRect(left, textY - mTopGap, right, textY, mPaint);
            c.drawText(textLine, left + <span class="hljs-number">2</span> * mAlignBottom, textY - mAlignBottom, mTextPaint);
        }
    }

    <span class="hljs-javadoc">/**
     * 判断是否为组内的第一个item
     *<span class="hljs-javadoctag"> @param</span> pos
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isGroupFirstItem</span>(<span class="hljs-keyword">int</span> pos){
        <span class="hljs-keyword">if</span> (pos == <span class="hljs-number">0</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }<span class="hljs-keyword">else</span>{
            String preGroupId = mOnDecorationCallback.onGroupId(pos - <span class="hljs-number">1</span>);
            String groupId = mOnDecorationCallback.onGroupId(pos);
            <span class="hljs-keyword">if</span> (groupId.equals(preGroupId)){
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }<span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
        }
    }

    <span class="hljs-javadoc">/**
     * 外部接口
     */</span>
    interface OnDecorationCallback{
        String onGroupId(<span class="hljs-keyword">int</span> pos);          <span class="hljs-comment">// 返回pos位置对应的title</span>
        String onGroupFirstStr(<span class="hljs-keyword">int</span> pos);    <span class="hljs-comment">// 返回pos位置对应的title（用于对比title）</span>
        <span class="hljs-keyword">void</span> onGroupFirstStr(String title); <span class="hljs-comment">// 传入的是title</span>
    }
}</code></pre> 
<p>这样就可以实现简单的ListView联动效果。</p> 
<hr> 
<p>　　<strong>五、总结</strong> <br> 　　该联动Demo主要思路是点击左边菜单ListView的item，调用RecyclerView适配器中移动到指定的位置moveToPosition（int n）方法，实现右边RecyclerView滚动到指定位置；滑动右边RecyclerView，调用左边菜单ListView中适配器的setSelection（int pos）方法实现左边联动的功能。 以及RecyclerView的吸顶效果的实现，也是本篇博客的重点。 <br> 　　<strong>建议认真理解下RecyclerView的适配器类AdapterRight中moveToPosition（int n）方法，以及实现吸顶功能的自定义ItemDecoration类中吸顶效果的实现方式。</strong>大神们如发现有bug或者更好的实现方式，欢迎私信交流！ <br> 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　—————<em>by Jeff</em>—————- <br> 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　—————<em>分享使我快乐，感谢您的阅读</em>—————　</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/313b8c5265ce66541d2ed1162b71ebb5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Error:Could not run build action using Gradle installation</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fda42ef53f1fb44e5ee51065787bb82d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在一个字符串中删除在另一个字符串中出现的字符</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>