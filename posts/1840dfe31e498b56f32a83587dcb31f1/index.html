<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Mquant】6：构建价差套利(二) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Mquant】6：构建价差套利(二)" />
<meta property="og:description" content="文章目录 1. 上节回顾2. 本节内容3. 统计套利3.1 构建均值回归策略 4. 实践4.1 选择交易标的4.2 确定交易规则4.3 策略代码4.4 策略回测 5.实盘交易 1. 上节回顾 【Mquant】5：构建价差套利(一)介绍了价差套利的原理和跨期套利的概念。同时，提到了价差套利存在的一定风险，并且介绍了跨期套利的原理和分类、投研分析和价差特征分析的方法。
2. 本节内容 本文将带领读者从零开始，逐步构建一个完整的价差实战套利策略。这将是一个循序渐进的过程，旨在帮助读者了解价差套利的核心概念和实施步骤。
首先重点讲解价差套利策略的构建过程。这将涉及选择适合价差套利的市场和交易品种，确定合适的套利时机和条件，并建立相应的交易规则和执行策略。使用一些常用的技术工具和指标，帮助读者进行价差分析和套利机会的识别。
在策略构建的过程中，本文将提供详细的实例和案例分析，以便读者能够更好地理解和应用所学知识。同时，作者还会强调风险管理的重要性，分享一些有效的风险控制方法，并提供实用的建议和技巧。
本文最后将引导读者进行模拟交易和实盘操作，以验证和优化所构建的价差套利策略。通过实际的交易实践，读者将能够更好地理解市场动态和实际执行的挑战，并逐步提升自身的交易技能和经验。
3. 统计套利 在统计套利中，常用的方法包括配对交易（Pairs Trading）、均值回归策略（Mean Reversion）、协整关系交易（Cointegration Trading）等。这些方法基于统计学的原理，利用价格或资产之间的相对价差、均值偏离或协整关系等统计指标来确定交易信号和执行策略。
在实践中，统计套利中的某些策略可以包含价差套利的元素，例如配对交易和均值回归策略经常涉及价格差异的利用。同时，统计套利的一些方法和工具，如协整关系的分析和模型构建，也可以为价差套利提供理论支持和辅助分析。
3.1 构建均值回归策略 本文着手于构建一个均值回归策略，通过理论和实践相结合的方式，帮助读者快速构建一套属于自己的交易策略，构造一个均值回归策略涉及以下步骤：
选择资产：首先，选择您感兴趣的资产或市场，可以是股票、期货、外汇等。确保选择的资产存在明显的价格波动和均值回归的趋势。
确定均值：通过历史数据计算资产的均值。常见的方法是使用移动平均线（如简单移动平均线或指数加权移动平均线）来估计资产价格的均值。
计算偏离度：计算资产价格相对于均值的偏离度。可以使用标准差、百分位数或其他统计指标来度量价格的偏离程度。
确定交易信号：根据偏离度确定交易信号。当价格偏离均值超过一定阈值时，产生交易信号。例如，当价格偏离均值超过一个标准差时，可以认为价格过度偏离，产生反向交易信号。
确定交易规则：定义具体的交易规则，包括入场点、出场点和止损点。例如，当价格偏离均值达到一定程度时，进入反向头寸；当价格回归到均值附近时，平仓并获利。
风险管理：制定有效的风险管理策略，包括设置止损点、控制仓位大小和分散投资等。确保风险可控，并考虑交易成本和流动性等因素。
回测和优化：使用历史数据进行回测，评估策略的表现，并进行必要的优化。调整参数和交易规则，以提高策略的盈利能力和稳定性。
实盘交易：在回测和优化后，将策略应用到实盘交易中。始终密切监控市场情况和策略表现，并根据需要进行调整和优化。
4. 实践 4.1 选择交易标的 选择交易标的核心是确保选择的资产存在明显的价格波动和均值回归的趋势
使用统计指标来评估价格的波动性和均值回归的趋势。常用的指标包括标准差、平均绝对偏差（Mean Absolute Deviation）、波动率等。较高的波动性和明显的均值回归特征可能表明资产适合均值回归策略。
协整性分析：对于多个相关资产，可以进行协整性分析。协整关系是指一组资产的价格在长期内存在稳定的线性关系。如果资产之间存在协整关系，并且价格偏离协整关系时会发生均值回归，那么这些资产可能适合均值回归策略。
历史数据分析：通过对资产的历史价格数据进行分析，评估价格的波动性和均值回归的趋势。观察价格的波动范围、频率和幅度，以及价格是否有向均值回归的倾向。
在上节内容【Mquant】5：构建价差套利(一)基础上，这一章节我们对btc数据又进行了一系列的统计学分析，以说明均值回归策略适用于什么周期，用什么指标来量化。
import numpy as np import pandas as pd df = pd.read_csv(&#34;spread_data.csv&#34;) # 计算价格波动性指标 std = np.std(df[&#39;spread&#39;]) # 标准差 mad = np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1840dfe31e498b56f32a83587dcb31f1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-07T14:30:45+08:00" />
<meta property="article:modified_time" content="2023-11-07T14:30:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Mquant】6：构建价差套利(二)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__7" rel="nofollow">1. 上节回顾</a></li><li><a href="#2__10" rel="nofollow">2. 本节内容</a></li><li><a href="#3__20" rel="nofollow">3. 统计套利</a></li><li><ul><li><a href="#31__26" rel="nofollow">3.1 构建均值回归策略</a></li></ul> 
  </li><li><a href="#4__45" rel="nofollow">4. 实践</a></li><li><ul><li><a href="#41__46" rel="nofollow">4.1 选择交易标的</a></li><li><a href="#42__81" rel="nofollow">4.2 确定交易规则</a></li><li><a href="#43__86" rel="nofollow">4.3 策略代码</a></li><li><a href="#44__150" rel="nofollow">4.4 策略回测</a></li></ul> 
  </li><li><a href="#5_406" rel="nofollow">5.实盘交易</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="1__7"></a>1. 上节回顾</h2> 
<p><a href="https://blog.csdn.net/m0_58598240/article/details/127619793">【Mquant】5：构建价差套利(一)</a>介绍了价差套利的原理和跨期套利的概念。同时，提到了价差套利存在的一定风险，并且介绍了跨期套利的原理和分类、投研分析和价差特征分析的方法。</p> 
<h2><a id="2__10"></a>2. 本节内容</h2> 
<p>本文将带领读者从零开始，逐步构建一个完整的价差实战套利策略。这将是一个循序渐进的过程，旨在帮助读者了解价差套利的核心概念和实施步骤。</p> 
<p>首先重点讲解价差套利策略的构建过程。这将涉及选择适合价差套利的市场和交易品种，确定合适的套利时机和条件，并建立相应的交易规则和执行策略。使用一些常用的技术工具和指标，帮助读者进行价差分析和套利机会的识别。</p> 
<p>在策略构建的过程中，本文将提供详细的实例和案例分析，以便读者能够更好地理解和应用所学知识。同时，作者还会强调风险管理的重要性，分享一些有效的风险控制方法，并提供实用的建议和技巧。</p> 
<p>本文最后将引导读者进行模拟交易和实盘操作，以验证和优化所构建的价差套利策略。通过实际的交易实践，读者将能够更好地理解市场动态和实际执行的挑战，并逐步提升自身的交易技能和经验。</p> 
<h2><a id="3__20"></a>3. 统计套利</h2> 
<p>在统计套利中，常用的方法包括<strong>配对交易（Pairs Trading）</strong>、<strong>均值回归策略（Mean Reversion）</strong>、协整关系交易（Cointegration Trading）等。这些方法基于统计学的原理，利用价格或资产之间的相对价差、均值偏离或协整关系等统计指标来确定交易信号和执行策略。</p> 
<p>在实践中，统计套利中的某些策略可以包含价差套利的元素，例如配对交易和均值回归策略经常涉及价格差异的利用。同时，统计套利的一些方法和工具，如协整关系的分析和模型构建，也可以为价差套利提供理论支持和辅助分析。</p> 
<h3><a id="31__26"></a>3.1 构建均值回归策略</h3> 
<p>本文着手于构建一个均值回归策略，通过理论和实践相结合的方式，帮助读者快速构建一套属于自己的交易策略，构造一个均值回归策略涉及以下步骤：</p> 
<ol><li> <p>选择资产：首先，选择您感兴趣的资产或市场，可以是股票、期货、外汇等。确保选择的资产存在明显的价格波动和均值回归的趋势。</p> </li><li> <p>确定均值：通过历史数据计算资产的均值。常见的方法是使用移动平均线（如简单移动平均线或指数加权移动平均线）来估计资产价格的均值。</p> </li><li> <p>计算偏离度：计算资产价格相对于均值的偏离度。可以使用标准差、百分位数或其他统计指标来度量价格的偏离程度。</p> </li><li> <p>确定交易信号：根据偏离度确定交易信号。当价格偏离均值超过一定阈值时，产生交易信号。例如，当价格偏离均值超过一个标准差时，可以认为价格过度偏离，产生反向交易信号。</p> </li><li> <p>确定交易规则：定义具体的交易规则，包括入场点、出场点和止损点。例如，当价格偏离均值达到一定程度时，进入反向头寸；当价格回归到均值附近时，平仓并获利。</p> </li><li> <p>风险管理：制定有效的风险管理策略，包括设置止损点、控制仓位大小和分散投资等。确保风险可控，并考虑交易成本和流动性等因素。</p> </li><li> <p>回测和优化：使用历史数据进行回测，评估策略的表现，并进行必要的优化。调整参数和交易规则，以提高策略的盈利能力和稳定性。</p> </li><li> <p>实盘交易：在回测和优化后，将策略应用到实盘交易中。始终密切监控市场情况和策略表现，并根据需要进行调整和优化。</p> </li></ol> 
<h2><a id="4__45"></a>4. 实践</h2> 
<h3><a id="41__46"></a>4.1 选择交易标的</h3> 
<p>选择交易标的核心是确保选择的资产存在明显的价格波动和均值回归的趋势</p> 
<ol><li> <p>使用统计指标来评估价格的波动性和均值回归的趋势。常用的指标包括标准差、平均绝对偏差（Mean Absolute Deviation）、波动率等。较高的波动性和明显的均值回归特征可能表明资产适合均值回归策略。</p> </li><li> <p>协整性分析：对于多个相关资产，可以进行协整性分析。协整关系是指一组资产的价格在长期内存在稳定的线性关系。如果资产之间存在协整关系，并且价格偏离协整关系时会发生均值回归，那么这些资产可能适合均值回归策略。</p> </li><li> <p>历史数据分析：通过对资产的历史价格数据进行分析，评估价格的波动性和均值回归的趋势。观察价格的波动范围、频率和幅度，以及价格是否有向均值回归的倾向。</p> </li></ol> 
<p>在上节内容<a href="https://blog.csdn.net/m0_58598240/article/details/127619793">【Mquant】5：构建价差套利(一)</a>基础上，这一章节我们对btc数据又进行了一系列的统计学分析，以说明均值回归策略适用于什么周期，用什么指标来量化。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"spread_data.csv"</span><span class="token punctuation">)</span>
<span class="token comment"># 计算价格波动性指标</span>
std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 标准差</span>
mad <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 平均绝对偏差</span>
volatility <span class="token operator">=</span> std <span class="token operator">/</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 波动率（标准差与均值的比率）</span>

<span class="token comment"># 计算均值回归指标</span>
mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 均值</span>
rolling_mean <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'spread'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 移动平均线</span>

<span class="token comment"># 输出结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"价格波动性指标："</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"标准差："</span><span class="token punctuation">,</span> std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"平均绝对偏差："</span><span class="token punctuation">,</span> mad<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"波动率："</span><span class="token punctuation">,</span> volatility<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n均值回归指标："</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"均值："</span><span class="token punctuation">,</span> mean<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/bf/s6YBuzpU_o.png" alt="在这里插入图片描述"><br> 当波动率大于0.337或者绝对偏差大于94.8的时候开启均值回归策略。</p> 
<h3><a id="42__81"></a>4.2 确定交易规则</h3> 
<p><img src="https://images2.imgbox.com/47/01/f2rsAUBr_o.png" alt="在这里插入图片描述"><br> 确定均值，常用的方法可以是ma均线，可以是机器学习拟合过去一段时间的回归曲线，可以是布林通道。确定交易信号，均值回归策略核心是认为相同品种的价差最终会走向价值回归，那么就在价差大的时候开仓，价差小的时候平仓。</p> 
<h3><a id="43__86"></a>4.3 策略代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> plotly<span class="token punctuation">.</span>express <span class="token keyword">as</span> px

<span class="token comment"># 读取数据，设置时间戳索引</span>
df_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"spread_data.csv"</span><span class="token punctuation">)</span>
df_data<span class="token punctuation">.</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>DatetimeIndex<span class="token punctuation">(</span>df_data<span class="token punctuation">[</span><span class="token string">"datetime"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"spread"</span><span class="token punctuation">:</span> df_data<span class="token punctuation">[</span><span class="token string">"spread"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">"5min"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>last<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 设置策略参数</span>
window <span class="token operator">=</span> <span class="token number">20</span>
dev <span class="token operator">=</span> <span class="token number">3</span>
<span class="token comment"># 计算均线和上下轨</span>
df<span class="token punctuation">[</span><span class="token string">"ma"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"spread"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">"std"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"spread"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">"up"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"ma"</span><span class="token punctuation">]</span> <span class="token operator">+</span> df<span class="token punctuation">[</span><span class="token string">"std"</span><span class="token punctuation">]</span> <span class="token operator">*</span> dev
df<span class="token punctuation">[</span><span class="token string">"down"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"ma"</span><span class="token punctuation">]</span> <span class="token operator">-</span> df<span class="token punctuation">[</span><span class="token string">"std"</span><span class="token punctuation">]</span> <span class="token operator">*</span> dev

<span class="token comment"># 抛弃NA数值</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 计算目标仓位</span>
target <span class="token operator">=</span> <span class="token number">0</span>
target_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> ix<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 没有仓位</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> target<span class="token punctuation">:</span>
        <span class="token keyword">if</span> row<span class="token punctuation">.</span>spread <span class="token operator">&gt;=</span> row<span class="token punctuation">.</span>up<span class="token punctuation">:</span>
            target <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">elif</span> row<span class="token punctuation">.</span>spread <span class="token operator">&lt;=</span> row<span class="token punctuation">.</span>down<span class="token punctuation">:</span>
            target <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment"># 多头仓位</span>
    <span class="token keyword">elif</span> target <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> row<span class="token punctuation">.</span>spread <span class="token operator">&gt;=</span> row<span class="token punctuation">.</span>ma<span class="token punctuation">:</span>
            target <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 空头仓位</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> row<span class="token punctuation">.</span>spread <span class="token operator">&lt;=</span> row<span class="token punctuation">.</span>ma<span class="token punctuation">:</span>
            target <span class="token operator">=</span> <span class="token number">0</span>
        
    <span class="token comment"># 记录目标仓位</span>
    target_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>target<span class="token punctuation">)</span>

df<span class="token punctuation">[</span><span class="token string">"target"</span><span class="token punctuation">]</span> <span class="token operator">=</span> target_data
<span class="token comment"># 计算仓位</span>
df<span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"target"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 计算盈亏</span>
df<span class="token punctuation">[</span><span class="token string">"change"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"spread"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">"pnl"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"change"</span><span class="token punctuation">]</span> <span class="token operator">*</span> df<span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"pnl"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制净值曲线</span>
px<span class="token punctuation">.</span>line<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/1d/PD7qdUx2_o.png" alt="在这里插入图片描述"></p> 
<p>从目前回测曲线上来看，这个策略表现还不错，但是没有计算手续费和滑点，为了更精准的回测出我们构建的策略表现到底如何，下面采用veighna自带的价差交易回测引擎来进行回测。</p> 
<h3><a id="44__150"></a>4.4 策略回测</h3> 
<ol><li>在vnpy_spreadtrading(位置位于：External Libraries\site-packages)目录下的strategies下创建boll_spread_strategy.py策略文件<br> <img src="https://images2.imgbox.com/bc/3f/JbFr8G34_o.png" alt="在这里插入图片描述"></li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> vnpy<span class="token punctuation">.</span>trader<span class="token punctuation">.</span>utility <span class="token keyword">import</span> BarGenerator<span class="token punctuation">,</span> ArrayManager
<span class="token keyword">from</span> vnpy_spreadtrading <span class="token keyword">import</span> <span class="token punctuation">(</span>
    SpreadStrategyTemplate<span class="token punctuation">,</span>
    SpreadAlgoTemplate<span class="token punctuation">,</span>
    SpreadData<span class="token punctuation">,</span>
    OrderData<span class="token punctuation">,</span>
    TradeData<span class="token punctuation">,</span>
    TickData<span class="token punctuation">,</span>
    BarData
<span class="token punctuation">)</span>
<span class="token keyword">from</span> vnpy<span class="token punctuation">.</span>trader<span class="token punctuation">.</span>constant <span class="token keyword">import</span> Interval


<span class="token keyword">class</span> <span class="token class-name">BollSpreadStrategy</span><span class="token punctuation">(</span>SpreadStrategyTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""""""</span>

    author <span class="token operator">=</span> <span class="token string">"mossloo"</span>

    ma_window <span class="token operator">=</span> <span class="token number">20</span>
    ma_dev <span class="token operator">=</span> <span class="token number">3</span>
    max_pos <span class="token operator">=</span> <span class="token number">1</span>
    payup <span class="token operator">=</span> <span class="token number">0.001</span>
    interval <span class="token operator">=</span> <span class="token number">5</span>

    spread_pos <span class="token operator">=</span> <span class="token number">0.0</span>
    ma_up <span class="token operator">=</span> <span class="token number">0.0</span>
    ma_down <span class="token operator">=</span> <span class="token number">0.0</span>
    ma <span class="token operator">=</span> <span class="token number">0.0</span>

    parameters <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"ma_window"</span><span class="token punctuation">,</span>
        <span class="token string">"ma_dev"</span><span class="token punctuation">,</span>
        <span class="token string">"max_pos"</span><span class="token punctuation">,</span>
        <span class="token string">"payup"</span><span class="token punctuation">,</span>
        <span class="token string">"interval"</span>
    <span class="token punctuation">]</span>
    variables <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"spread_pos"</span><span class="token punctuation">,</span>
        <span class="token string">"ma_up"</span><span class="token punctuation">,</span>
        <span class="token string">"ma_down"</span><span class="token punctuation">,</span>
        <span class="token string">"ma"</span>
    <span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            strategy_engine<span class="token punctuation">,</span>
            strategy_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
            spread<span class="token punctuation">:</span> SpreadData<span class="token punctuation">,</span>
            setting<span class="token punctuation">:</span> <span class="token builtin">dict</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""""""</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>
            strategy_engine<span class="token punctuation">,</span> strategy_name<span class="token punctuation">,</span> spread<span class="token punctuation">,</span> setting
        <span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>bg <span class="token operator">=</span> BarGenerator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>on_spread_bar<span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> on_window_bar<span class="token operator">=</span>self<span class="token punctuation">.</span>on_5min_spread_bar<span class="token punctuation">,</span>
                               interval<span class="token operator">=</span>Interval<span class="token punctuation">.</span>MINUTE<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>am <span class="token operator">=</span> ArrayManager<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when strategy is inited.
        """</span>
        self<span class="token punctuation">.</span>write_log<span class="token punctuation">(</span><span class="token string">"策略初始化"</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>load_bar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when strategy is started.
        """</span>
        self<span class="token punctuation">.</span>write_log<span class="token punctuation">(</span><span class="token string">"策略启动"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when strategy is stopped.
        """</span>
        self<span class="token punctuation">.</span>write_log<span class="token punctuation">(</span><span class="token string">"策略停止"</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>put_event<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_spread_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when spread price is updated.
        """</span>
        tick <span class="token operator">=</span> self<span class="token punctuation">.</span>get_spread_tick<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>on_spread_tick<span class="token punctuation">(</span>tick<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_spread_tick</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tick<span class="token punctuation">:</span> TickData<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when new spread tick data is generated.
        """</span>
        self<span class="token punctuation">.</span>bg<span class="token punctuation">.</span>update_tick<span class="token punctuation">(</span>tick<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_spread_bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bar<span class="token punctuation">:</span> BarData<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>bg<span class="token punctuation">.</span>update_bar<span class="token punctuation">(</span>bar<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_5min_spread_bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bar<span class="token punctuation">:</span> BarData<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when spread bar data is generated.
        """</span>
        self<span class="token punctuation">.</span>stop_all_algos<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>am<span class="token punctuation">.</span>update_bar<span class="token punctuation">(</span>bar<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>am<span class="token punctuation">.</span>inited<span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        self<span class="token punctuation">.</span>ma <span class="token operator">=</span> self<span class="token punctuation">.</span>am<span class="token punctuation">.</span>sma<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ma_window<span class="token punctuation">)</span>
        dev <span class="token operator">=</span> self<span class="token punctuation">.</span>am<span class="token punctuation">.</span>std<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ma_window<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ma_up <span class="token operator">=</span> self<span class="token punctuation">.</span>ma_dev <span class="token operator">*</span> dev <span class="token operator">+</span> self<span class="token punctuation">.</span>ma
        self<span class="token punctuation">.</span>ma_down <span class="token operator">=</span> self<span class="token punctuation">.</span>ma <span class="token operator">-</span> self<span class="token punctuation">.</span>ma_dev <span class="token operator">*</span> dev

        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>spread_pos<span class="token punctuation">:</span>
            <span class="token keyword">if</span> bar<span class="token punctuation">.</span>close_price <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>ma_up<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>start_short_algo<span class="token punctuation">(</span>
                    bar<span class="token punctuation">.</span>close_price <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    self<span class="token punctuation">.</span>max_pos<span class="token punctuation">,</span>
                    payup<span class="token operator">=</span>self<span class="token punctuation">.</span>payup<span class="token punctuation">,</span>
                    interval<span class="token operator">=</span>self<span class="token punctuation">.</span>interval
                <span class="token punctuation">)</span>
            <span class="token keyword">elif</span> bar<span class="token punctuation">.</span>close_price <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>ma_down<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>start_long_algo<span class="token punctuation">(</span>
                    bar<span class="token punctuation">.</span>close_price <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    self<span class="token punctuation">.</span>max_pos<span class="token punctuation">,</span>
                    payup<span class="token operator">=</span>self<span class="token punctuation">.</span>payup<span class="token punctuation">,</span>
                    interval<span class="token operator">=</span>self<span class="token punctuation">.</span>interval
                <span class="token punctuation">)</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>spread_pos <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> bar<span class="token punctuation">.</span>close_price <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>ma<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>start_long_algo<span class="token punctuation">(</span>
                    bar<span class="token punctuation">.</span>close_price <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    <span class="token builtin">abs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>spread_pos<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    payup<span class="token operator">=</span>self<span class="token punctuation">.</span>payup<span class="token punctuation">,</span>
                    interval<span class="token operator">=</span>self<span class="token punctuation">.</span>interval
                <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> bar<span class="token punctuation">.</span>close_price <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>ma<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>start_short_algo<span class="token punctuation">(</span>
                    bar<span class="token punctuation">.</span>close_price <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    <span class="token builtin">abs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>spread_pos<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    payup<span class="token operator">=</span>self<span class="token punctuation">.</span>payup<span class="token punctuation">,</span>
                    interval<span class="token operator">=</span>self<span class="token punctuation">.</span>interval
                <span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>put_event<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_spread_pos</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when spread position is updated.
        """</span>
        self<span class="token punctuation">.</span>spread_pos <span class="token operator">=</span> self<span class="token punctuation">.</span>get_spread_pos<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>put_event<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_spread_algo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> algo<span class="token punctuation">:</span> SpreadAlgoTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when algo status is updated.
        """</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">:</span> OrderData<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when order status is updated.
        """</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">on_trade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> trade<span class="token punctuation">:</span> TradeData<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Callback when new trade data is received.
        """</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">stop_open_algos</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""""""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>buy_algoid<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>stop_algo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>buy_algoid<span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>short_algoid<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>stop_algo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>short_algoid<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">stop_close_algos</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""""""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sell_algoid<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>stop_algo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sell_algoid<span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>cover_algoid<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>stop_algo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cover_algoid<span class="token punctuation">)</span>

</code></pre> 
<ol start="2"><li>继续打开jupyter notebook</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> vnpy<span class="token punctuation">.</span>trader<span class="token punctuation">.</span>optimize <span class="token keyword">import</span> OptimizationSetting
<span class="token keyword">from</span> vnpy_spreadtrading<span class="token punctuation">.</span>backtesting <span class="token keyword">import</span> BacktestingEngine
<span class="token keyword">from</span> vnpy_spreadtrading<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>boll_spread_strategy <span class="token keyword">import</span> <span class="token punctuation">(</span>
    BollSpreadStrategy
<span class="token punctuation">)</span>
<span class="token keyword">from</span> vnpy_spreadtrading<span class="token punctuation">.</span>base <span class="token keyword">import</span> LegData<span class="token punctuation">,</span> SpreadData
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> vnpy<span class="token punctuation">.</span>trader<span class="token punctuation">.</span>constant <span class="token keyword">import</span> Interval

symbol_1 <span class="token operator">=</span> <span class="token string">"BTCUSDT_240329.BINANCE"</span>
symbol_2 <span class="token operator">=</span> <span class="token string">"BTCUSDT_231229.BINANCE"</span>

spread <span class="token operator">=</span> SpreadData<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"BTC-Spread"</span><span class="token punctuation">,</span>
    legs<span class="token operator">=</span><span class="token punctuation">[</span>LegData<span class="token punctuation">(</span>symbol_1<span class="token punctuation">)</span><span class="token punctuation">,</span> LegData<span class="token punctuation">(</span>symbol_2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    variable_symbols<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"A"</span><span class="token punctuation">:</span> symbol_1<span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">:</span> symbol_2<span class="token punctuation">}</span><span class="token punctuation">,</span>
    variable_directions<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"A"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    price_formula<span class="token operator">=</span><span class="token string">"A-B"</span><span class="token punctuation">,</span>
    trading_multipliers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>symbol_1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> symbol_2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    active_symbol<span class="token operator">=</span>symbol_1<span class="token punctuation">,</span>
    min_volume<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
    compile_formula<span class="token operator">=</span><span class="token boolean">False</span>                          <span class="token comment"># 回测时不编译公式，compile_formula传False，从而支持多进程优化</span>
<span class="token punctuation">)</span>

engine <span class="token operator">=</span> BacktestingEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
engine<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>
    spread<span class="token operator">=</span>spread<span class="token punctuation">,</span>
    interval<span class="token operator">=</span>Interval<span class="token punctuation">.</span>MINUTE<span class="token punctuation">,</span>
    start<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    end<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    rate<span class="token operator">=</span><span class="token number">0.0004</span><span class="token punctuation">,</span>
    slippage<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span>
    size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
    pricetick<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span>
    capital<span class="token operator">=</span><span class="token number">1_000_000</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

engine<span class="token punctuation">.</span>add_strategy<span class="token punctuation">(</span>BollSpreadStrategy<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
engine<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
engine<span class="token punctuation">.</span>run_backtesting<span class="token punctuation">(</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> engine<span class="token punctuation">.</span>calculate_result<span class="token punctuation">(</span><span class="token punctuation">)</span>
engine<span class="token punctuation">.</span>calculate_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span>
engine<span class="token punctuation">.</span>show_chart<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9d/ce/PzXtq4hh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/71/5c/wWueN27L_o.png" alt="在这里插入图片描述"><br> 对于这个策略而言，我们亏钱的原因在于手续费太高了，由于我们策略使用的是市价单，加密市场对于市价单收取的手续费要远远高于限价单，所以这个策略的手续费在万分之四左右，如果能手续费降低到万分之一，加上百分之五十的返佣，到万分之0.5，那么这个策略的夏普比能到7.83。<br> <img src="https://images2.imgbox.com/04/cb/ZcXKSsg9_o.png" alt="在这里插入图片描述"><br> 策略还可以进行参数优化，找到参数平原地带，后续选择较优的参数跑模拟盘验证。</p> 
<pre><code class="prism language-python">setting <span class="token operator">=</span> OptimizationSetting<span class="token punctuation">(</span><span class="token punctuation">)</span>
setting<span class="token punctuation">.</span>set_target<span class="token punctuation">(</span><span class="token string">"sharpe_ratio"</span><span class="token punctuation">)</span>
setting<span class="token punctuation">.</span>add_parameter<span class="token punctuation">(</span><span class="token string">"ma_window"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
setting<span class="token punctuation">.</span>add_parameter<span class="token punctuation">(</span><span class="token string">"ma_dev"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

engine<span class="token punctuation">.</span>run_ga_optimization<span class="token punctuation">(</span>setting<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="5_406"></a>5.实盘交易</h2> 
<p>很显然，我们上面的程序并不能直接上实盘交易，但如果我们手续费非常低的情况下如万分之一，或者遇到极端行情，某些币种现货和期货之间的价差非常大，比如前段时间的luna，还有这段时间的mask，只要我们设置好程序，仍然可以在极端行情下赚取到稳定的资金，这也是我们学习量化交易的原因，只有长久稳定的赚钱，才能在市场立于不败之地。下一章节，我将带领大家优化策略，回测，实盘部署。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb0da1180df98a40754c92e8622a9260/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql之备份和恢复</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/885e6cfe2c46a13d16d778a9bab4c258/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Mquant】2：量化平台的选择</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>