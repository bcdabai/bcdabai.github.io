<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>自己实现SpringBoot三方Starer依赖封装(自动装配自定义实现) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="自己实现SpringBoot三方Starer依赖封装(自动装配自定义实现)" />
<meta property="og:description" content="一.对Spring Boot自动装配理解
自动装配其实是一种按照SpringBoot的约定配置规则实现三方依赖注入项目,通过配置文件&#43;注解实现配置文件识别以及对应的Bean等IOC注入,供SpringBoot 使用.
具体自动装配原理可以参考下边博文学习
https://www.cnblogs.com/monkey-xuan/p/15911610.html
二.自己封装自定义Starter
被封装项目创建Springboot项目或者maven项目
创建自定义配置类
package com.example.springstarerredisautoconfig.redisson; import org.redisson.Redisson; import org.redisson.api.RedissonClient; import org.redisson.config.Config; import org.springframework.boot.autoconfigure.condition.ConditionalOnClass; import org.springframework.boot.context.properties.EnableConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @ConditionalOnClass(Redisson.class) @EnableConfigurationProperties(RedissonProperties2.class) @Configuration public class RedissonAutoConfiguration { @Bean public RedissonClient redissonClient(RedissonProperties2 redissonProperties) { final Config config = new Config(); String prefix = &#34;redis://&#34;; if (redissonProperties.isSsl()) { prefix=&#34;rediss://&#34;; } String address = prefix&#43;redissonProperties.getHost()&#43;&#34;:&#34;&#43;redissonProperties.getPort(); config.useSingleServer().setAddress(address); return Redisson.create(config); } } RedissonProperties2
package com.example.springstarerredisautoconfig.redisson; import org.springframework.boot.context.properties.ConfigurationProperties; @ConfigurationProperties(prefix = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/085b4ae9daa63934d71ae1b6c4a17aff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-23T18:13:23+08:00" />
<meta property="article:modified_time" content="2023-09-23T18:13:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">自己实现SpringBoot三方Starer依赖封装(自动装配自定义实现)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>一.对Spring Boot自动装配理解<br> 自动装配其实是一种按照SpringBoot的约定配置规则实现三方依赖注入项目,通过配置文件+注解实现配置文件识别以及对应的Bean等IOC注入,供SpringBoot 使用.<br> 具体自动装配原理可以参考下边博文学习<br> <a href="https://www.cnblogs.com/monkey-xuan/p/15911610.html" rel="nofollow">https://www.cnblogs.com/monkey-xuan/p/15911610.html</a><br> 二.自己封装自定义Starter<br> 被封装项目创建Springboot项目或者maven项目<br> 创建自定义配置类</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springstarerredisautoconfig<span class="token punctuation">.</span>redisson</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span><span class="token class-name">Redisson</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Config</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">EnableConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedissonProperties2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token class-name">RedissonProperties2</span> redissonProperties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> prefix <span class="token operator">=</span> <span class="token string">"redis://"</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">isSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prefix<span class="token operator">=</span><span class="token string">"rediss://"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> address <span class="token operator">=</span> prefix<span class="token operator">+</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>RedissonProperties2</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springstarerredisautoconfig<span class="token punctuation">.</span>redisson</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"bobo.redisson"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonProperties2</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> ssl <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> host<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHost</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPort</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> port<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> timeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> ssl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> ssl<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ssl <span class="token operator">=</span> ssl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"RedissonProperties{"</span> <span class="token operator">+</span>
                <span class="token string">"host='"</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", port="</span> <span class="token operator">+</span> port <span class="token operator">+</span>
                <span class="token string">", timeout="</span> <span class="token operator">+</span> timeout <span class="token operator">+</span>
                <span class="token string">", ssl="</span> <span class="token operator">+</span> ssl <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>resources文件下创建META-INF文件夹<br> 添加spring.factories文件 主要是通过它扫描配置文件是否注入IOC</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span>EnableAutoConfiguration</span><span class="token operator">=</span>\
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springstarerredisautoconfig<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span>RedissonAutoConfiguration</span>
</code></pre> 
<p>此刻需要注意如果通过SpringBoot项目打包依赖jar需要SpringBoot可执行jar和可依赖jar前置只是，如果maven项目打包就直接是可依赖jar不存在该问题<br> 目前我的是SpringBoot打包依赖jar方式<br> 删除test文件夹，不然报错<br> pom改变打包方式</p> 
<pre><code class="prism language-java">        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>configuration<span class="token operator">-</span>processor<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>redisson<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>redisson<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.16</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token comment">//修改打包方式</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>classifier<span class="token punctuation">&gt;</span></span>exec<span class="token operator">&lt;</span><span class="token operator">/</span>classifier<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
</code></pre> 
<p>主工程</p> 
<p>引入打包依赖</p> 
<pre><code class="prism language-java">        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>example<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span><span class="token class-name">SpringStarerRedisAutoConfig</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>示例代码</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootstart5<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/query"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> length <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> length1 <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"key的"</span> <span class="token operator">+</span> redissonClient<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>配置文件属性</p> 
<pre><code class="prism language-java">bobo<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.131</span><span class="token number">.140</span>
bobo<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">6379</span>
bobo<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>ssl<span class="token operator">=</span><span class="token boolean">false</span>
bobo<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>timeout<span class="token operator">=</span><span class="token number">1000</span>
</code></pre> 
<p>项目启动后，被自定义的starter中redissonClient成功注入SpringBoot IOC.</p> 
<p><strong>附加知识关于SpringBoot可执行jar和普通依赖jar区别</strong></p> 
<ol><li>产生的问题</li></ol> 
<p>Spring Boot 项目打包成的可运行 jar包 ，被其他项目依赖之后，总是报错找不到类的错误？</p> 
<p>这是由于还没有搞清楚可执行 jar 和普通 jar 到底有什么区别导致的。</p> 
<ol start="2"><li>可运行jar与普通jar的区别</li></ol> 
<p>普通jar包：可以被其他项目应用依赖，不可以用 java -jar xxx.jar 运行。<br> 可运行jar包：不可以被其他项目应用依赖，可以用 java -jar xxx.jar 运行。<br> 注：SpringBoot项目默认打包的是可运行jar包，普通项目默认打包的是不可运行的jar包，但是，普通项目也可以打包成可运行jar包。</p> 
<p>疑问：</p> 
<p>同样是执行mvn package命令进行项目打包，为什么 Spring Boot 项目就打成了可执行 jar ，而普通项目则打包成了不可执行 jar 呢？</p> 
<p>解答：<br> Spring Boot 项目默认的插件配置 spring-boot-maven-plugin 依赖包，这个打包插件存在 5 个方面的功能，如下:<br> <img src="https://images2.imgbox.com/68/ec/L05tUVMM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7d/ce/tG69UKKb_o.png" alt="在这里插入图片描述"><br> 五个功能分别是：</p> 
<p>（1）build-info：生成项目的构建信息文件 build-info.properties<br> （2）repackage：这个是默认 goal，在 mvn package 执行之后，这个命令再次打包生成可执行的 jar，同时将 mvn package 生成的 jar 重命名为 *.origin<br> （3）run：这个可以用来运行 Spring Boot 应用<br> （4）start：这个在 mvn integration-test 阶段，进行 Spring Boot 应用生命周期的管理<br> （5）stop：这个在 mvn integration-test 阶段，进行 Spring Boot 应用生命周期的管理</p> 
<p>默认情况下使用就是 repackage 功能，其他功能要使用，则需要开发者显式配置。</p> 
<ol start="3"><li>了解打包过程</li></ol> 
<p>SpringBoot的repackage 功能的 作用，就是在打包的时候，多做一点额外的事情：</p> 
<p>（1）首先 mvn package 命令 对项目进行打包，打成一个 jar，这个 jar 就是一个普通的 jar，可以被其他项目依赖，但是不可以被执行<br> （2）repackage 命令，对第一步 打包成的 jar 进行再次打包，将之打成一个 可执行 jar ，通过将第一步打成的 jar 重命名为 *.original 文件</p> 
<p>举例说明：</p> 
<p>Spring Boot 项目进行打包，可以执行 mvn package 命令，也可以直接在 IDEA 中点击 package进行打包，打包结果如下显示:</p> 
<p><img src="https://images2.imgbox.com/9b/44/9hrnCkgX_o.png" alt="在这里插入图片描述"><br> 可以看到有两个文件，admin-0.0.1-SNAPSHOT.jar 是可运行jar包，admin-0.0.1-SNAPSHOT.jar.original是被重命名的 可依赖jar包。</p> 
<ol start="4"><li>jar包之间的差异</li></ol> 
<p>可执行 jar 包结构<br> <img src="https://images2.imgbox.com/1f/22/kPbshudS_o.png" alt="在这里插入图片描述"><br> 可执行 jar 中，我们自己的代码是存在 于 BOOT-INF/classes/ 目录下，另外，还有一个 META-INF 的目录，该目录下有一个 MANIFEST.MF 文件，打开该文件，内容如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Manifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">1.0</span>
<span class="token class-name">Created</span><span class="token operator">-</span><span class="token class-name">By</span><span class="token operator">:</span> <span class="token class-name">Maven</span> <span class="token class-name">Jar</span> <span class="token class-name">Plugin</span> <span class="token number">3.2</span><span class="token number">.0</span>
<span class="token class-name">Build</span><span class="token operator">-</span><span class="token class-name">Jdk</span><span class="token operator">-</span><span class="token class-name">Spec</span><span class="token operator">:</span> <span class="token number">14</span>
<span class="token class-name">Implementation</span><span class="token operator">-</span><span class="token class-name">Title</span><span class="token operator">:</span> admin
<span class="token class-name">Implementation</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span>
<span class="token class-name">Main</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>JarLauncher</span>
<span class="token class-name">Start</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>yolo<span class="token punctuation">.</span>admin<span class="token punctuation">.</span></span>AdminApplication</span>
<span class="token class-name">Spring</span><span class="token operator">-</span><span class="token class-name">Boot</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">2.3</span><span class="token number">.4</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span>
<span class="token class-name">Spring</span><span class="token operator">-</span><span class="token class-name">Boot</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">:</span> <span class="token constant">BOOT</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span>classes<span class="token operator">/</span>
<span class="token class-name">Spring</span><span class="token operator">-</span><span class="token class-name">Boot</span><span class="token operator">-</span><span class="token class-name">Lib</span><span class="token operator">:</span> <span class="token constant">BOOT</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span>lib<span class="token operator">/</span>
<span class="token class-name">Spring</span><span class="token operator">-</span><span class="token class-name">Boot</span><span class="token operator">-</span><span class="token class-name">Classpath</span><span class="token operator">-</span><span class="token class-name">Index</span><span class="token operator">:</span> <span class="token constant">BOOT</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span>classpath<span class="token punctuation">.</span>idx
</code></pre> 
<p>Start-Class : 这就是可执行 jar 的入口类<br> Spring-Boot-Classes : 代码编译后的位置<br> Spring-Boot-Lib : 项目所依赖的 jar 的位置</p> 
<p>如果自己要打一个可执行 jar 包的话，除了添加相关依赖之外，还需要配置 META-INF/MANIFEST.MF 文件。</p> 
<p>不可执行 jar 包的结构：</p> 
<p>首先将默认的后缀 .original 除去，然后给文件重命名 .jar，重命名完成，进行解压 如下:<br> <img src="https://images2.imgbox.com/51/14/4ziVTy4E_o.png" alt="在这里插入图片描述"><br> 不可执行 jar 根目录就相当于我们的 classpath，直接就能看到我们的代码，并且也拥有 META-INF/MANIFEST.MF 文件，但是文件中没有定义启动类等配置。</p> 
<pre><code class="prism language-java"><span class="token class-name">Manifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">1.0</span>
<span class="token class-name">Created</span><span class="token operator">-</span><span class="token class-name">By</span><span class="token operator">:</span> <span class="token class-name">Maven</span> <span class="token class-name">Jar</span> <span class="token class-name">Plugin</span> <span class="token number">3.2</span><span class="token number">.0</span>
<span class="token class-name">Build</span><span class="token operator">-</span><span class="token class-name">Jdk</span><span class="token operator">-</span><span class="token class-name">Spec</span><span class="token operator">:</span> <span class="token number">14</span>
<span class="token class-name">Implementation</span><span class="token operator">-</span><span class="token class-name">Title</span><span class="token operator">:</span> admin
<span class="token class-name">Implementation</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span>
</code></pre> 
<p>注：这个不可以执行 jar 也没有将项目的依赖打包进来。<br> 由此可见这两个jar包内部结构是完全不同的，因此一个可以直接执行，另一个则可以被其他项目依赖。</p> 
<ol start="5"><li>同时打包两个jar包</li></ol> 
<p>提议：一般来说，Spring Boot 直接打包成可执行 jar 就可以了，不建议将 Spring Boot 作为普通的 jar 被其他的项目所依赖。如果有这种需求，建议将被依赖的部分，单独抽出来做一个普通的 Maven 项目，然后在 Spring Boot 中引用这个 Maven 项目。</p> 
<p>依环境必须实现可依赖jar的话，如下可以实现：</p> 
<p>pom.xml文件中spring-boot-maven-plugin 插件添加如下配置：</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>classifier<span class="token punctuation">&gt;</span></span>exec<span class="token operator">&lt;</span><span class="token operator">/</span>classifier<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>
</code></pre> 
<p>classifier : 表示可执行 jar 的名字 , 执行 repackage 命令时，就不会给 mvn package 所打成的 jar 重命名 , 如下：<br> <img src="https://images2.imgbox.com/e6/6d/2BLy29Bu_o.png" alt="在这里插入图片描述"><br> 第一个 jar 表示可以被其他项目依赖的 jar ，第二个 jar 则表示一个可执行 jar。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de4d2b8fd13362f82ee128e56d2b58e7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">(23)认识Linq:序列与集合,延迟与缓存,链式与查询式,性能提升技巧</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/320b0767c3b438627f2b57ed21b01351/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring系列漏洞复现CVE-2022-22947、CVE-2022-22963、CVE-2022-22965、CVE-2022-22978</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>