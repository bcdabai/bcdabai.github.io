<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>存储过程解析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="存储过程解析" />
<meta property="og:description" content="使用存储过程来解决涨工资 涨工资，总裁涨1000，经理涨800，其他人涨400。 伪代码：
ResultSet rs = “select empno,job from emp”;
While(rs.next()){
Int eno = rs.getInt(“empno”);
String job = rs.getString(“job”);
If(“PRESIDENT”.equals(job))
{
update emp set sal = sal&#43;1000;
}else if(“Manager”.equals(job))
{
update emp set sal = sal&#43;800;
}else
{
update emp set sal = sal&#43;400;
}
}
分析：那么上面这样的一个过程，使用存储过程(PL/SQL)就可以轻松解决。可以写很少的java代码。
①.查询emp表：7839的姓名和薪水并打印.
declare
pename emp.ename%type;
psal emp.sal%type;
begin
--得到7839的姓名和薪水
select ename,sal into pename,psal from emp where empno = 7839;
dbms_output.put_line(pename||&#39;的薪水是&#39;||psal);
end;
运行结果：KING的薪水是5000
②.使用记录型变量" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9449a6010b5e59efecf37f3401e20404/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-13T08:52:16+08:00" />
<meta property="article:modified_time" content="2022-05-13T08:52:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">存储过程解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:center;"> </p> 
<ul><li style="text-align:justify;">使用存储过程来解决涨工资 
  <ul><li style="text-align:justify;">涨工资，总裁涨1000，经理涨800，其他人涨400。</li></ul></li></ul> 
<p style="margin-left:0;text-align:justify;">伪代码：</p> 
<div style="margin-left:21pt;"> 
 <p style="margin-left:0;text-align:justify;">ResultSet rs = “select empno,job from emp”;</p> 
 <p style="margin-left:0;text-align:justify;">While(rs.next()){<!-- --></p> 
 <p style="margin-left:0;text-align:justify;">Int eno = rs.getInt(“empno”);</p> 
 <p style="margin-left:0;text-align:justify;">String job = rs.getString(“job”);</p> 
 <p style="margin-left:0;text-align:justify;">If(“PRESIDENT”.equals(job))</p> 
 <p style="margin-left:0;text-align:justify;">{<!-- --></p> 
 <p style="margin-left:0;text-align:justify;">       update emp set sal = sal+1000;</p> 
 <p style="margin-left:0;text-align:justify;">}else if(“Manager”.equals(job))</p> 
 <p style="margin-left:0;text-align:justify;">{<!-- --></p> 
 <p style="margin-left:0;text-align:justify;">       update emp set sal = sal+800;</p> 
 <p style="margin-left:0;text-align:justify;">}else</p> 
 <p style="margin-left:0;text-align:justify;">{<!-- --></p> 
 <p style="margin-left:0;text-align:justify;">       update emp set sal = sal+400;</p> 
 <p style="margin-left:0;text-align:justify;">}</p> 
 <p style="margin-left:0;text-align:justify;">}</p> 
</div> 
<p style="margin-left:0;text-align:justify;">分析：那么上面这样的一个过程，使用存储过程(PL/SQL)就可以轻松解决。可以写很少的java代码。</p> 
<p style="margin-left:0;text-align:justify;">①.查询emp表：7839的姓名和薪水并打印.</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">pename emp.ename%type;</p> 
<p style="margin-left:0;text-align:left;">psal emp.sal%type;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:justify;">--得到7839的姓名和薪水</p> 
<p style="margin-left:0;text-align:left;">select ename,sal into pename,psal from emp where empno = 7839;</p> 
<p style="margin-left:0;text-align:left;">dbms_output.put_line(pename||'的薪水是'||psal);</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<p style="margin-left:0;text-align:justify;">运行结果：KING的薪水是5000</p> 
<p style="margin-left:0;text-align:justify;">②.使用记录型变量</p> 
<p style="margin-left:0;text-align:justify;">记录型变量：取这个表里面的一行作为我们的这个类型，那么一行有多个列，那么就有多个类型，相当于一个数组。</p> 
<p style="margin-left:0;text-align:justify;">多个数据类型作为的我们的数据类型。</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  emp_rec emp%rowtype;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">  select * into  emp_rec from emp where empno=7839;</p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line(emp_rec.ename||'的薪水是'||emp_rec.sal);</p> 
<p style="margin-left:0;text-align:left;">  end;</p> 
<p style="margin-left:0;text-align:justify;"> /</p> 
<p style="margin-left:0;text-align:justify;">③.从键盘接收一个数字(使用PL/SQL判断输入输出数字)</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;">accept num prompt '请输入一个数字';</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  pnum number :=&amp;num;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">  if pnum = 0 then dbms_output.put_line('你输入的数字是0');</p> 
<p style="margin-left:0;text-align:left;">  elsif pnum = 1 then dbms_output.put_line('你输入的数字是1');</p> 
<p style="margin-left:0;text-align:left;">  else dbms_output.put_line('其他数字');</p> 
<p style="margin-left:0;text-align:left;">  end if;</p> 
<p style="margin-left:0;text-align:left;">  end;</p> 
<p style="margin-left:0;text-align:left;">  /</p> 
<p style="margin-left:0;text-align:justify;">运行结果：你输入的数字是1</p> 
<p style="margin-left:0;text-align:justify;">④.输出1~10的数字</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;"> declare</p> 
<p style="margin-left:0;text-align:left;">   pnum number :=1;</p> 
<p style="margin-left:0;text-align:left;">   begin</p> 
<p style="margin-left:0;text-align:left;"> loop</p> 
<p style="margin-left:0;text-align:left;">  exit when pnum&gt;10;</p> 
<p style="margin-left:0;text-align:left;"> dbms_output.put_line(pnum);</p> 
<p style="margin-left:0;text-align:left;">  pnum := pnum+1;</p> 
<p style="margin-left:0;text-align:left;">  end loop;</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<ul><li style="text-align:justify;">光标的使用</li></ul> 
<p style="margin-left:0;text-align:justify;">光标的作用：<strong>用于存储一个查询返回的多行数据。</strong></p> 
<p style="margin-left:0;text-align:justify;">①.查询所有人的薪水：</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">cursor cemp is select ename,sal from emp;</p> 
<p style="margin-left:0;text-align:left;">pename emp.ename%type;</p> 
<p style="margin-left:0;text-align:left;">psal emp.sal%type;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  open cemp;</p> 
<p style="margin-left:0;text-align:left;">  loop</p> 
<p style="margin-left:0;text-align:left;">  fetch cemp into pename,psal; </p> 
<p style="margin-left:0;text-align:left;">  exit when cemp%notfound;</p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line(pename||'的薪水是'||psal); </p> 
<p style="margin-left:0;text-align:left;">  end loop;</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<p style="margin-left:0;text-align:justify;">运行结果：</p> 
<p style="margin-left:0;text-align:left;">SMITH的薪水是800</p> 
<p style="margin-left:0;text-align:left;">ALLEN的薪水是1600</p> 
<p style="margin-left:0;text-align:left;">WARD的薪水是1250</p> 
<p style="margin-left:0;text-align:left;">JONES的薪水是2975</p> 
<p style="margin-left:0;text-align:left;">MARTIN的薪水是1250</p> 
<p style="margin-left:0;text-align:left;">BLAKE的薪水是2850</p> 
<p style="margin-left:0;text-align:left;">CLARK的薪水是2450</p> 
<p style="margin-left:0;text-align:left;">SCOTT的薪水是3000</p> 
<p style="margin-left:0;text-align:left;">KING的薪水是5000</p> 
<p style="margin-left:0;text-align:left;">TURNER的薪水是1500</p> 
<p style="margin-left:0;text-align:left;">ADAMS的薪水是1100</p> 
<p style="margin-left:0;text-align:left;">JAMES的薪水是950</p> 
<p style="margin-left:0;text-align:left;">FORD的薪水是3000</p> 
<p style="margin-left:0;text-align:left;">MILLER的薪水是1300</p> 
<p style="margin-left:0;text-align:justify;">②.使用光标：涨工资，总裁涨1000，经理涨800，其他人涨400</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">cursor cemp is select empno,job<a class="msocomanchor" href="#_msocom_1" rel="nofollow">[h1]</a>  from emp;</p> 
<p style="margin-left:0;text-align:left;">pno emp.empno%type;</p> 
<p style="margin-left:0;text-align:left;">pjob emp.job%type;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  open cemp;</p> 
<p style="margin-left:0;text-align:left;">  loop</p> 
<p style="margin-left:0;text-align:left;">    fetch cemp into pno,pjob;</p> 
<p style="margin-left:0;text-align:left;">    exit when cemp%notfound; </p> 
<p style="margin-left:0;text-align:left;">     <em>-- </em><em>判断职位</em><em> </em></p> 
<p style="margin-left:0;text-align:left;">  if pjob='PRESIDENT' then update emp set sal=sal+1000 where empno=pno;</p> 
<p style="margin-left:0;text-align:left;">  elsif pjob='MANAGER' then update emp set sal=sal+800 where empno=pno;</p> 
<p style="margin-left:0;text-align:left;">  else update emp set sal = sal +400 where empno=pno;</p> 
<p style="margin-left:0;text-align:left;">  end if;</p> 
<p style="margin-left:0;text-align:left;">  end loop;</p> 
<p style="margin-left:0;text-align:left;">  close cemp;</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<p style="margin-left:0;text-align:justify;">③.定义带参数的光标(查询并打印某个部门中员工的姓名)</p> 
<p style="margin-left:0;text-align:left;">set serveroutput on</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;"> cursor cemp(dno number) is select ename from emp where empno = dno;</p> 
<p style="margin-left:0;text-align:left;"> pname emp.ename%type;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">open cemp(7369);//传递参数7369</p> 
<p style="margin-left:0;text-align:left;">loop</p> 
<p style="margin-left:0;text-align:left;">  fetch cemp into pname;</p> 
<p style="margin-left:0;text-align:left;">  exit when cemp%notfound; </p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line(pname);</p> 
<p style="margin-left:0;text-align:left;">end loop;</p> 
<p style="margin-left:0;text-align:left;">close cemp;</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<p style="margin-left:0;text-align:justify;">运行结果：</p> 
<p style="margin-left:0;text-align:justify;">SMITH</p> 
<p style="margin-left:0;text-align:justify;">④.查询并打印30号部门员工姓名。</p> 
<p style="margin-left:0;text-align:left;">  declare</p> 
<p style="margin-left:0;text-align:left;">  cursor cemp(dno number) is select ename from emp where deptno = dno;</p> 
<p style="margin-left:0;text-align:left;">  dename emp.ename%type;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">    open cemp(30);</p> 
<p style="margin-left:0;text-align:left;">    loop</p> 
<p style="margin-left:0;text-align:left;">      fetch cemp into dename;</p> 
<p style="margin-left:0;text-align:left;">      exit when cemp%notfound;</p> 
<p style="margin-left:0;text-align:left;">      dbms_output.put_line(dename);</p> 
<p style="margin-left:0;text-align:left;">    end loop;</p> 
<p style="margin-left:0;text-align:left;">    close cemp;</p> 
<p style="margin-left:0;text-align:left;">    end;</p> 
<p style="margin-left:0;text-align:justify;"> </p> 
<p style="margin-left:0;text-align:justify;">⑤.为部门号为10的员工涨工资</p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  cursor cemp(dno number) is select deptno from emp where deptno = dno;</p> 
<p style="margin-left:0;text-align:left;">  dempno emp.deptno%type;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">    open cemp(10);</p> 
<p style="margin-left:0;text-align:left;">    fetch cemp into dempno;</p> 
<p style="margin-left:0;text-align:left;">    update emp set sal= sal*1.1 where deptno=dempno;</p> 
<p style="margin-left:0;text-align:left;">    close cemp;</p> 
<p style="margin-left:0;text-align:justify;">  end;</p> 
<ul><li style="text-align:justify;">例外的使用</li></ul> 
<ul><li style="text-align:justify;">被0除例外</li></ul> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  pnum number;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">    pnum := 1/0;</p> 
<p style="margin-left:0;text-align:left;">    exception</p> 
<p style="margin-left:0;text-align:left;">      when zero_divide then dbms_output.put_line('1:0不能做被除数');</p> 
<p style="margin-left:0;text-align:left;">      dbms_output.put_line('2:0不能做被除数');</p> 
<p style="margin-left:0;text-align:left;">      when value_error then dbms_output.put_line('算数或者替换错误');</p> 
<p style="margin-left:0;text-align:left;">      when others then dbms_output.put_line('其他例外');</p> 
<p style="margin-left:0;text-align:justify;">  end;</p> 
<p style="margin-left:0;text-align:justify;">运行结果：</p> 
<p style="margin-left:0;text-align:left;">1:0不能做被除数</p> 
<p style="margin-left:0;text-align:justify;">2:0不能做被除数</p> 
<ul><li style="text-align:justify;">查询并打印50号部门的员工姓名(测试异常：原因：数据表里面没有50号部门)</li></ul> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  cursor cemp is select ename from emp where deptno=50<a class="msocomanchor" href="#_msocom_2" rel="nofollow">[h2]</a> ;</p> 
<p style="margin-left:0;text-align:left;">  pename emp.ename%type; </p> 
<p style="margin-left:0;text-align:left;">  no_emp_found<a class="msocomanchor" href="#_msocom_3" rel="nofollow">[h3]</a>  exception;</p> 
<p style="margin-left:0;text-align:left;">  begin</p> 
<p style="margin-left:0;text-align:left;">    open cemp;</p> 
<p style="margin-left:0;text-align:left;">    fetch cemp into pename;</p> 
<p style="margin-left:0;text-align:left;">    if cemp%notfound then    </p> 
<p style="margin-left:0;text-align:left;">      raise no_emp_found<a class="msocomanchor" href="#_msocom_4" rel="nofollow">[h4]</a> ;</p> 
<p style="margin-left:0;text-align:left;">    end if;</p> 
<p style="margin-left:0;text-align:left;">    close cemp;   </p> 
<p style="margin-left:0;text-align:left;">    exception</p> 
<p style="margin-left:0;text-align:left;">      when no_emp_found<a class="msocomanchor" href="#_msocom_5" rel="nofollow">[h5]</a>  then dbms_output.put_line('没有找到员工');</p> 
<p style="margin-left:0;text-align:left;">      when others then dbms_output.put_line('其他例外');</p> 
<p style="margin-left:0;text-align:justify;">end;</p> 
<p style="margin-left:0;text-align:justify;">运行结果：</p> 
<p style="margin-left:0;text-align:justify;">没有找到员工</p> 
<ul><li style="text-align:justify;">存储过程存储函数</li></ul> 
<p style="margin-left:0;text-align:justify;"> </p> 
<div> 
 <hr> 
 <div> 
  <div> 
   <p style="margin-left:0;"> <a class="msocomoff" href="#_msoanchor_1" rel="nofollow">[h1]</a>必须是数据库的字段列名。</p> 
  </div> 
 </div> 
 <div> 
  <div> 
   <p style="margin-left:0;"> <a class="msocomoff" href="#_msoanchor_2" rel="nofollow">[h2]</a>由于数据库没有部门号50这个部门，那么就会抛出异常，我们这里手动自定义一个异常，然后抛出，然后再下面捕获。</p> 
  </div> 
 </div> 
 <div> 
  <div> 
   <p style="margin-left:0;"> <a class="msocomoff" href="#_msoanchor_3" rel="nofollow">[h3]</a>定义异常</p> 
  </div> 
 </div> 
 <div> 
  <div> 
   <p style="margin-left:0;"> <a class="msocomoff" href="#_msoanchor_4" rel="nofollow">[h4]</a>抛出异常</p> 
  </div> 
 </div> 
 <div> 
  <div> 
   <p style="margin-left:0;"> <a class="msocomoff" href="#_msoanchor_5" rel="nofollow">[h5]</a>捕获异常</p> 
  </div> 
 </div> 
</div> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7529da3c84f156ce81a5f9847d496869/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue--vue&#43;ElementUI实现动态树&#43;数据表格&#43;分页</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a3a97f7edcdf76b85411738c7cf320c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据仓库介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>