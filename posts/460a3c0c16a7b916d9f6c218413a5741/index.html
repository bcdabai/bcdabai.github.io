<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用百度地图api模拟实时定位页面 完整示例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用百度地图api模拟实时定位页面 完整示例" />
<meta property="og:description" content="使用百度地图api模拟实时定位页面 完整示例 效果：使用百度地图api在页面上显示车辆的实时位置，并有自动刷新和手动刷新两种方式可以选择。每次刷新后，都会在地图上显示车辆的最新位置。 示例运行效果截图： 步骤 1. 首先，我们要创建一个一个main方法，用来往一个txt文件中不断地写新的坐标，来模拟GPS设备不断获取的坐标数据。 所以我们先写一个任务，它的作用是产生一个新的位置坐标，并将其写入一个名为position.txt的文档中。
package com.icbc.dataDisplayService.bean; import java.io.BufferedWriter; import java.io.File; import java.io.FileWriter; import java.io.IOException; import java.util.Random; public class TimerTask extends java.util.TimerTask { // private Position position; @Override public void run() { //随机生成坐标 //lon的取值范围是121.4600-121.4800 //lat的取值范围是31.2200-31.2800 Random randomLon = new Random(); Random randomLat = new Random(); double lon = ((double)(1214600&#43;randomLon.nextInt(200)))/10000; double lat = ((double)(312200&#43;randomLon.nextInt(600)))/10000; // this.position.setLon(lon); // this.position.setLat(lat); //把他写到文件里 File positionFile = new File(&#34;D:\\Myapplication\\java\\GPSDataDisplayService\\src\\main\\java\\com\\icbc\\dataDisplayService\\position.txt&#34;);//文件路径 try{ FileWriter fw = new FileWriter(positionFile,true); BufferedWriter bw = new BufferedWriter(fw); bw." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/460a3c0c16a7b916d9f6c218413a5741/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-06T10:09:34+08:00" />
<meta property="article:modified_time" content="2018-08-06T10:09:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用百度地图api模拟实时定位页面 完整示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="使用百度地图api模拟实时定位页面-完整示例">使用百度地图api模拟实时定位页面 完整示例</h3> 
<hr> 
<h4 id="效果使用百度地图api在页面上显示车辆的实时位置并有自动刷新和手动刷新两种方式可以选择每次刷新后都会在地图上显示车辆的最新位置">效果：使用百度地图api在页面上显示车辆的实时位置，并有<strong>自动刷新</strong>和<strong>手动刷新</strong>两种方式可以选择。每次刷新后，都会在地图上显示车辆的最新位置。</h4> 
<h4 id="示例运行效果截图">示例运行效果截图：</h4> 
<p><img title="" alt="这里写图片描述" src="https://images2.imgbox.com/0e/cb/AVpMAYH2_o.jpg"></p> 
<h3 id="步骤"><strong>步骤</strong></h3> 
<h5 id="1-首先我们要创建一个一个main方法用来往一个txt文件中不断地写新的坐标来模拟gps设备不断获取的坐标数据">1. 首先，我们要创建一个一个main方法，用来往一个txt文件中不断地写新的坐标，来模拟GPS设备不断获取的坐标数据。</h5> 
<p>所以我们先写一个任务，它的作用是产生一个新的位置坐标，并将其写入一个名为<code>position.txt</code>的文档中。</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.icbc.dataDisplayService.bean;

<span class="hljs-keyword">import</span> java.io.BufferedWriter;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.FileWriter;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimerTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">util</span>.<span class="hljs-title">TimerTask</span> {<!-- --></span>
<span class="hljs-comment">//    private Position position;</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
        <span class="hljs-comment">//随机生成坐标</span>
        <span class="hljs-comment">//lon的取值范围是121.4600-121.4800</span>
        <span class="hljs-comment">//lat的取值范围是31.2200-31.2800</span>
        Random randomLon = <span class="hljs-keyword">new</span> Random();
        Random randomLat = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-keyword">double</span> lon = ((<span class="hljs-keyword">double</span>)(<span class="hljs-number">1214600</span>+randomLon.nextInt(<span class="hljs-number">200</span>)))/<span class="hljs-number">10000</span>;
        <span class="hljs-keyword">double</span> lat = ((<span class="hljs-keyword">double</span>)(<span class="hljs-number">312200</span>+randomLon.nextInt(<span class="hljs-number">600</span>)))/<span class="hljs-number">10000</span>;
<span class="hljs-comment">//        this.position.setLon(lon);</span>
<span class="hljs-comment">//        this.position.setLat(lat);</span>
        <span class="hljs-comment">//把他写到文件里</span>
        File positionFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"D:\\Myapplication\\java\\GPSDataDisplayService\\src\\main\\java\\com\\icbc\\dataDisplayService\\position.txt"</span>);<span class="hljs-comment">//文件路径</span>
        <span class="hljs-keyword">try</span>{
            FileWriter fw = <span class="hljs-keyword">new</span> FileWriter(positionFile,<span class="hljs-keyword">true</span>);
            BufferedWriter bw = <span class="hljs-keyword">new</span> BufferedWriter(fw);
                bw.write(String.valueOf(lon)+<span class="hljs-string">"\n"</span>);<span class="hljs-comment">//这里要写String类型,先写经度</span>
                bw.write(String.valueOf(lat)+<span class="hljs-string">"\n"</span>);<span class="hljs-comment">//写纬度</span>
                bw.flush();
            bw.close();
            fw.close();
        }<span class="hljs-keyword">catch</span> (IOException e){
            e.printStackTrace();
        }
    }
}</code></pre> 
<blockquote> 
 <p>注： <br> - 经度和纬度都是利用随机数生成的，范围最好不要波动太大 <br> - 文件的路径最写成绝对路径，否则有可能找不到。</p> 
</blockquote> 
<p>之后在main方法中定时执行这个任务，我这里设置的时间是5秒，也就是每隔五秒钟向txt文档中写入一个新的坐标点。</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.icbc.dataDisplayService.bean;

<span class="hljs-keyword">import</span> com.icbc.dataDisplayService.dao.CarDao;
<span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hljs-keyword">import</span> java.io.*;
<span class="hljs-keyword">import</span> java.nio.Buffer;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Timer;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> {<!-- --></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) {

Timer timer = <span class="hljs-keyword">new</span> Timer();
        System.out.println(<span class="hljs-string">"创建"</span>);
timer.schedule(<span class="hljs-keyword">new</span> TimerTask(),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>*<span class="hljs-number">1000</span>);<span class="hljs-comment">//每隔5秒将一个新点的坐标写入txt文件</span>
    }
    }</code></pre> 
<p>别忘了创建实体类<code>Positon</code></p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.icbc.dataDisplayService.bean;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Position</span> {<!-- --></span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> lon;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> lat;

    <span class="hljs-keyword">public</span> <span class="hljs-title">Position</span>(<span class="hljs-keyword">double</span> lon, <span class="hljs-keyword">double</span> lat) {
        <span class="hljs-keyword">this</span>.lon = lon;
        <span class="hljs-keyword">this</span>.lat = lat;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getLon</span>() {
        <span class="hljs-keyword">return</span> lon;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLon</span>(<span class="hljs-keyword">double</span> lon) {
        <span class="hljs-keyword">this</span>.lon = lon;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getLat</span>() {
        <span class="hljs-keyword">return</span> lat;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLat</span>(<span class="hljs-keyword">double</span> lat) {
        <span class="hljs-keyword">this</span>.lat = lat;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Position{"</span> +
                <span class="hljs-string">"lon="</span> + lon +
                <span class="hljs-string">", lat="</span> + lat +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre> 
<p><br></p> 
<h5 id="2创建testcontrollerjava-这个controller用于和前端交互和传递数据前端页面每发来一次请求此controller就去positiontxt中读取最新的一条数据并返回此坐标点">2.创建<code>TestController.java</code> 这个Controller用于和前端交互和传递数据，前端页面每发来一次请求，此Controller就去<code>position.txt</code>中读取最新的一条数据并返回此坐标点。</h5> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.icbc.dataDisplayService.controller;


<span class="hljs-keyword">import</span> com.icbc.dataDisplayService.bean.Position;
<span class="hljs-keyword">import</span> org.omg.CORBA.PUBLIC_MEMBER;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;

<span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.FileReader;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;


<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> sun.rmi.runtime.Log;

<span class="hljs-comment">//这是一个测试类，会去txt文件中读取数据并返回最新的经纬度给我</span>
<span class="hljs-annotation">@Controller</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> {<!-- --></span>
<span class="hljs-comment">//这个方法用来返回视图</span>
    <span class="hljs-annotation">@RequestMapping</span>(value = <span class="hljs-string">"/currentMap"</span>,method = RequestMethod.GET)
    <span class="hljs-keyword">public</span> String <span class="hljs-title">toCurrentPositionMap</span>(){
        <span class="hljs-keyword">return</span> <span class="hljs-string">"CurrentPositionMap"</span>;
    }
<span class="hljs-comment">//这个方法在前台用ajax调用，返回最新的位置坐标</span>
    <span class="hljs-annotation">@RequestMapping</span>(value = <span class="hljs-string">"/currentMapFuck"</span>,method = RequestMethod.GET)
    <span class="hljs-annotation">@ResponseBody</span>
    <span class="hljs-comment">//此方法返回一个最新的位置点给我</span>
    <span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">getCurrentPosition</span>(){

        List&lt;Double&gt; doubleList = <span class="hljs-keyword">new</span> ArrayList&lt;Double&gt;();<span class="hljs-comment">//用来存储从文件中读取到的数据</span>

        File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"D:\\Myapplication\\java\\GPSDataDisplayService\\src\\main\\java\\com\\icbc\\dataDisplayService\\position.txt"</span>);
        <span class="hljs-keyword">try</span>{
            String readData;
            FileReader fr = <span class="hljs-keyword">new</span> FileReader(file);
            BufferedReader br = <span class="hljs-keyword">new</span> BufferedReader(fr);
            <span class="hljs-keyword">while</span> ((readData = br.readLine())!=<span class="hljs-keyword">null</span>){<!-- --><span class="hljs-comment">//没有读到文件尾的s时候</span>
                <span class="hljs-keyword">try</span>{
                    doubleList.add(Double.parseDouble(readData));
                }<span class="hljs-keyword">catch</span> (Exception e){
                    e.printStackTrace();
                }
            }
        }<span class="hljs-keyword">catch</span> (IOException e){
            e.printStackTrace();
        }

        <span class="hljs-keyword">double</span> lon = doubleList.get(doubleList.size()-<span class="hljs-number">2</span>);
        <span class="hljs-keyword">double</span> lat = doubleList.get(doubleList.size()-<span class="hljs-number">1</span>);

        Map&lt;String,Object&gt; modelMap = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;(<span class="hljs-number">2</span>);
        modelMap.put(<span class="hljs-string">"data"</span>,<span class="hljs-keyword">new</span> Position(lon,lat));
        modelMap.put(<span class="hljs-string">"success"</span>,<span class="hljs-string">"true"</span>);

        <span class="hljs-keyword">return</span> modelMap;

    }
}</code></pre> 
<blockquote> 
 <p>注： <br> - 第二个方法中,<code>@ResponseBody</code>一定要写，因为前端要用ajax传递数据。 <br> - 由于我只是这里只是模拟，所以选择了将所有数据都读出然后取最后一条这种效率比较低的方法，实际上，如果指定去文件中读最后两条数据会更好。 <br> 最后Map中的数据就是返回值，将会在前端页面中进行接收和处理。</p> 
</blockquote> 
<p><br></p> 
<h5 id="3-前端页面的编写">3. 前端页面的编写</h5> 
<p>在编写前端页面之前，首先我们要了解百度地图api的使用方法。 <br> <a href="http://lbsyun.baidu.com/" rel="nofollow">百度地图api官网</a>中有很简单明了的<a href="http://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/getkey" rel="nofollow">例子</a>。从获取密钥开始，每一步都有教程。大概只需要知道<strong>如何创建地图实例</strong>、<strong>如何设置和清除覆盖物</strong>、<strong>如何设置覆盖物动画</strong>等等这些基本的就行了。 <br> 当你已经具备了上述的基本关于百度地图api的使用方法，你就可以开始着手编写页面了。</p> 
<blockquote> 
 <p>注： <br> - 本页面已完成功能为主，并没有经过美化，所以比较丑。 <br> - 除了百度地图api之外，你还需要对JQuery和ajax有基本的了解</p> 
</blockquote> 
<p>首先，我们用ajax向Controller发送请求并拿到最新点的坐标。关于ajax怎样和Controller交互请参考<a href="https://blog.csdn.net/a355586533/article/details/51927045">博客</a>。</p> 
<pre class="prettyprint"><code class="language-javascript hljs ">&lt;%--用ajax从后台contorller拿到数据--%&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 写ajax请求，调用TestController中的方法</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">getCurrentPosition</span><span class="hljs-params">()</span> {<!-- --></span>
           <span class="hljs-keyword">var</span> position = [];<span class="hljs-comment">//定义一个数组来储存经纬度</span>
            console.log(<span class="hljs-string">"执行了函数"</span>);
            jQuery.ajax({
                type:<span class="hljs-string">'GET'</span>,
                content:<span class="hljs-string">'application/json'</span>,
                url:<span class="hljs-string">'/currentMapFuck'</span>,
                dataType:<span class="hljs-string">'json'</span>,
                success :<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelMap)</span> {<!-- --></span>
                    console.log(<span class="hljs-string">"成功"</span>);
                    console.log(modelMap.data.lon);
                    console.log(modelMap.data.lat);
                    position.push(modelMap.data.lon);
                    position.push( modelMap.data.lat);
                },
                error :<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
                    alert(<span class="hljs-string">"error"</span>);
                    console.log(<span class="hljs-string">"失败"</span>)
                }
            });
                      <span class="hljs-keyword">return</span> position;<span class="hljs-comment">//把这个数返回</span>
        }
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span></code></pre> 
<p>能够拿到最新点位置坐标之后，我们就能在地图上做文章了。先导入百度地图js库。</p> 
<pre class="prettyprint"><code class="language-html hljs "> <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://api.map.baidu.com/api?v=3.0&amp;ak=您的密钥"</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">//v3.0版本的引用方式：src="http://api.map.baidu.com/api?v=3.0&amp;ak=您的密钥"</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></code></pre> 
<p>之后定义一个div作为地图显示的区域。</p> 
<pre class="prettyprint"><code class="language-html hljs "><span class="vbscript">&lt;%--div的名字只能是container，否则就显示不出来，别问我问什么知道--%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"container"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span></code></pre> 
<p>然后利用得到的最新坐标点创建地图实例</p> 
<pre class="prettyprint"><code class="language-javascript hljs ">&lt;script type=<span class="hljs-string">"text/javascript"</span>&gt;
    <span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> BMap.Map(<span class="hljs-string">"container"</span>);<span class="hljs-comment">//地图的实例</span>

    <span class="hljs-keyword">var</span> myPosition = [];
    myPosition = getCurrentPosition();

    <span class="hljs-comment">//要把点和marker设置成全局变量</span>
    <span class="hljs-keyword">var</span> point;
    <span class="hljs-keyword">var</span> marker;

    <span class="hljs-keyword">var</span>  carIcon = <span class="hljs-keyword">new</span> BMap.Icon(<span class="hljs-string">"http://lbsyun.baidu.com/jsdemo/img/car.png"</span>, <span class="hljs-keyword">new</span> BMap.Size(<span class="hljs-number">300</span>,<span class="hljs-number">157</span>));<span class="hljs-comment">//创建一个小车的图标</span>

    <span class="hljs-comment">//让程序停止500毫秒之后在做function中的事情</span>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">// 创建地图实例</span>
         point = <span class="hljs-keyword">new</span> BMap.Point(myPosition[<span class="hljs-number">0</span>], myPosition[<span class="hljs-number">1</span>]);<span class="hljs-comment">//这里已经能得到，就不打印了</span>

        <span class="hljs-comment">// 初始化地图</span>
        map.centerAndZoom(point, <span class="hljs-number">13</span>);<span class="hljs-comment">//地图的中心点和缩放级别</span>

        <span class="hljs-comment">//添加一个marker</span>
         marker = <span class="hljs-keyword">new</span> BMap.Marker(point,{icon:carIcon});
        map.addOverlay(marker);

    },<span class="hljs-number">500</span>);</code></pre> 
<blockquote> 
 <p>注： <br> - 由于我模拟的是显示车辆的位置，所以我把marker的图标替换成了小车，你可以根据自己的需要替换成其他的。 <br> - 由于调用的函数里面有网络请求，需要一定的时间，所以可能会出现没有赋值成功的问题，我这里用了一个很蠢的方法，让程序暂停0.5秒保证网络请求结束，建议以后可以用回调函数来改进。</p> 
</blockquote> 
<p>如果不出意外，现在你打开网页，就能看到地图中心有一个小车了，并且这个小车在地图刷新时它的最新位置。接下来就要考虑如何让它的位置能够刷新。 <br> 手动刷新比较简单，所以我们从手动刷新入手。 <br> 首先写一个用来刷新marker位置的函数</p> 
<pre class="prettyprint"><code class="language-js hljs ">   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeMarkerPosition</span> <span class="hljs-params">()</span> {<!-- --></span>
        myPosition = getCurrentPosition();
       setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
           point = <span class="hljs-keyword">new</span> BMap.Point(myPosition[<span class="hljs-number">0</span>], myPosition[<span class="hljs-number">1</span>]);<span class="hljs-comment">//得到了最新的坐标点</span>
           console.log(<span class="hljs-string">"地图中心："</span>+myPosition[<span class="hljs-number">0</span>]+<span class="hljs-string">"  "</span>+myPosition[<span class="hljs-number">1</span>]);
           marker = <span class="hljs-keyword">new</span> BMap.Marker(point,{icon:carIcon});
           <span class="hljs-comment">//map.centerAndZoom(point, 14);</span>
           map.clearOverlays();<span class="hljs-comment">//在地图上清除掉所有的覆盖物。</span>
           map.addOverlay(marker);
           marker.setAnimation(BMAP_ANIMATION_BOUNCE);<span class="hljs-comment">//给marker设置动画</span>
           console.log(<span class="hljs-string">"maker的位置"</span>+marker.getPosition().lng+<span class="hljs-string">"  "</span>+marker.getPosition().lat);
       },<span class="hljs-number">500</span>);<span class="hljs-comment">//此暂停放噶目前不得已而位置，带我日后掌握回调函数再战</span>
    }</code></pre> 
<p>之后我们在页面上写一个按钮，把这个函数绑定给这个按钮，手动刷新就就完成了。</p> 
<pre class="prettyprint"><code class="language-html hljs "><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"manualDiv"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"manualDiv"</span>&gt;</span>
    <span class="vbscript">&lt;%--手动刷新就显示这个div--%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"getCurrentPosition"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"changeMarkerPosition()"</span>&gt;</span>刷新<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span></code></pre> 
<p>接下来我们考虑如何在手动刷新和自动刷新之间切换。 <br> 我这里使用了一个下拉菜单。</p> 
<pre class="prettyprint"><code class="language-html hljs ">   刷新方式：
    <span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"refreshChoice"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"refreshChoice"</span>&gt;</span> <span class="hljs-comment">&lt;!--别把class写成calss了ヽ(●-`Д´-)ノ--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">option</span>  <span class="hljs-attribute">selected</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"manual"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"手动刷新"</span>  &gt;</span>手动刷新<span class="hljs-tag">&lt;/<span class="hljs-title">option</span>&gt;</span> <span class="hljs-comment">&lt;!--设置手动刷新为默认选项，但是在火狐上好像有bug--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">option</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"auto"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"自动刷新"</span> &gt;</span>自动刷新<span class="hljs-tag">&lt;/<span class="hljs-title">option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span></code></pre> 
<p>然后需要用到jQuery中的监听器来监听下拉菜单状态的改变，以便采取不同的刷新方法。</p> 
<pre class="prettyprint"><code class="language-js hljs ">&lt;script&gt;
    <span class="hljs-keyword">var</span> timer;
    <span class="hljs-comment">//利用jq监测下拉菜单的状态</span>
    $(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
        $(<span class="hljs-string">".refreshChoice"</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
           <span class="hljs-comment">// alert($(this).find("option:checked").attr("id")); 通过此方法能得到用户选择的option的id值，从而判断用户选择了哪个选项。</span>

            <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">"option:checked"</span>).attr(<span class="hljs-string">"id"</span>)==<span class="hljs-string">"manual"</span>){
                $(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
                   $(<span class="hljs-string">"#manualDiv"</span>).show();<span class="hljs-comment">//如果选择了手动,就把面板显示出来</span>
                    clearInterval(timer);
                });
            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">"option:checked"</span>).attr(<span class="hljs-string">"id"</span>)==<span class="hljs-string">"auto"</span>){
                $(<span class="hljs-string">"#manualDiv"</span>).hide();<span class="hljs-comment">//如果选择了自动，就把面板隐藏。</span>
              timer = setInterval(changeMarkerPosition,<span class="hljs-number">5000</span>);
                <span class="hljs-comment">//每隔5秒刷新一次点的坐标</span>
            }
        });
    });
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span></code></pre> 
<blockquote> 
 <p>注： <br> - 这里使用了if语句根据下来菜单选项中id的值来判断当前用户选择的是哪一个选项。 <br> - 如果选择了手动，就把刷新按钮显示出来，反之则隐藏。 <br> - 在用户选择了自动刷新之后，利用 timer = setInterval(changeMarkerPosition,5000);让刷新每隔5秒钟自动循环进行。 <br> - 设置全局变量timer，在用户选择手动刷新的时候，将自动刷新的任务关闭。</p> 
</blockquote> 
<p>最终，jsp中的完整代码如下：</p> 
<pre class="prettyprint"><code class="language-html hljs "><span class="vbscript">&lt;%--
  Created by IntelliJ IDEA.
  User: <span class="hljs-number">13905</span>
  <span class="hljs-built_in">Date</span>: <span class="hljs-number">2018</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2</span>
  <span class="hljs-built_in">Time</span>: <span class="hljs-number">17</span>:<span class="hljs-number">02</span>
  <span class="hljs-keyword">To</span> change this template use File | Settings | File Templates.
--%&gt;</span>
<span class="vbscript">&lt;%@ taglib prefix=<span class="hljs-string">"c"</span> uri=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span>
<span class="vbscript">&lt;%@ page contentType=<span class="hljs-string">"text/html;charset=UTF-8"</span> language=<span class="hljs-string">"java"</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"initial-scale=1.0, user-scalable=no"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"Content-Type"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html; charset=utf-8"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="vbscript">&lt;%--导入jQuery库--%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"../../js/jquery-3.3.1.js"</span>&gt;</span><span class="javascript">
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>


<span class="hljs-comment">&lt;!--导入百度地图js库--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span><span class="css">
        <span class="hljs-tag">html</span><span class="hljs-rules">{<!-- --><span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"><span class="hljs-number">100</span>%</span></span></span>}
        <span class="hljs-tag">body</span><span class="hljs-rules">{<!-- --><span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"><span class="hljs-number">100</span>%</span></span>;<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"><span class="hljs-number">0</span>px</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span>px</span></span></span>}
        <span class="hljs-id">#container</span><span class="hljs-rules">{<!-- --><span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"><span class="hljs-number">100</span>%</span></span></span>}
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://api.map.baidu.com/api?v=3.0&amp;ak=lH6NeYMvgZMhGi8j9gRmTZuEXObQQ1tX"</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">//v3.0版本的引用方式：src="http://api.map.baidu.com/api?v=3.0&amp;ak=您的密钥"</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="vbscript">&lt;%--用ajax从后台contorller拿到数据--%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 写ajax请求，调用TestController中的方法</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">getCurrentPosition</span><span class="hljs-params">()</span> {<!-- --></span>
           <span class="hljs-keyword">var</span> position = [];
            console.log(<span class="hljs-string">"执行了函数"</span>);
            jQuery.ajax({
                type:<span class="hljs-string">'GET'</span>,
                content:<span class="hljs-string">'application/json'</span>,
                url:<span class="hljs-string">'/currentMapFuck'</span>,
                dataType:<span class="hljs-string">'json'</span>,
                success :<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelMap)</span> {<!-- --></span>
                    console.log(<span class="hljs-string">"成功"</span>);
                    console.log(modelMap.data.lon);
                    console.log(modelMap.data.lat);
                    position.push(modelMap.data.lon);
                    position.push( modelMap.data.lat);

                },
                error :<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
                    alert(<span class="hljs-string">"error"</span>);
                    console.log(<span class="hljs-string">"失败"</span>)
                }
            });
                      <span class="hljs-keyword">return</span> position;
        }
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>
这是展示实时位置的地图
<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>
    刷新方式：
    <span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"refreshChoice"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"refreshChoice"</span>&gt;</span> <span class="hljs-comment">&lt;!--别把class写成calss了ヽ(●-`Д´-)ノ--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">option</span>  <span class="hljs-attribute">selected</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"manual"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"手动刷新"</span>  &gt;</span>手动刷新<span class="hljs-tag">&lt;/<span class="hljs-title">option</span>&gt;</span> <span class="hljs-comment">&lt;!--设置手动刷新为默认选项，但是在火狐上好像有bug--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">option</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"auto"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"自动刷新"</span> &gt;</span>自动刷新<span class="hljs-tag">&lt;/<span class="hljs-title">option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"manualDiv"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"manualDiv"</span>&gt;</span>
    <span class="vbscript">&lt;%--手动刷新就显示这个div--%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"getCurrentPosition"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"changeMarkerPosition()"</span>&gt;</span>刷新<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>





<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">var</span> timer;
    <span class="hljs-comment">//利用jq监测下拉菜单的状态</span>
    $(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
        $(<span class="hljs-string">".refreshChoice"</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
           <span class="hljs-comment">// alert($(this).find("option:checked").attr("id")); 通过此方法能得到用户选择的option的id值，从而判断用户选择了哪个选项。</span>

            <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">"option:checked"</span>).attr(<span class="hljs-string">"id"</span>)==<span class="hljs-string">"manual"</span>){


                $(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>

                   $(<span class="hljs-string">"#manualDiv"</span>).show();<span class="hljs-comment">//如果选择了手动,就把面板显示出来</span>
                    clearInterval(timer);

                });



            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">"option:checked"</span>).attr(<span class="hljs-string">"id"</span>)==<span class="hljs-string">"auto"</span>){
                $(<span class="hljs-string">"#manualDiv"</span>).hide();<span class="hljs-comment">//如果选择了自动，就把面板隐藏。</span>

              timer = setInterval(changeMarkerPosition,<span class="hljs-number">5000</span>);
                <span class="hljs-comment">//每隔3秒刷新一次点的坐标</span>

            }

        });
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>



<span class="vbscript">&lt;%--div的名字只能是container，否则就显示不出来，别问我问什么知道--%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"container"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> BMap.Map(<span class="hljs-string">"container"</span>);<span class="hljs-comment">//地图的实例</span>

    <span class="hljs-keyword">var</span> myPosition = [];
    myPosition = getCurrentPosition();

    <span class="hljs-comment">//要把点和marker设置成全局变量试一试</span>
    <span class="hljs-keyword">var</span> point;
    <span class="hljs-keyword">var</span> marker;

    <span class="hljs-keyword">var</span>  carIcon = <span class="hljs-keyword">new</span> BMap.Icon(<span class="hljs-string">"http://lbsyun.baidu.com/jsdemo/img/car.png"</span>, <span class="hljs-keyword">new</span> BMap.Size(<span class="hljs-number">300</span>,<span class="hljs-number">157</span>));<span class="hljs-comment">//创建一个小车的图标</span>

    <span class="hljs-comment">//让程序停止200毫秒之后在做function中的事情</span>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-comment">// 创建地图实例</span>
         point = <span class="hljs-keyword">new</span> BMap.Point(myPosition[<span class="hljs-number">0</span>], myPosition[<span class="hljs-number">1</span>]);<span class="hljs-comment">//这里已经能得到，就不打印了</span>

        <span class="hljs-comment">// 初始化地图</span>
        map.centerAndZoom(point, <span class="hljs-number">13</span>);

        <span class="hljs-comment">//添加一个marker</span>
         marker = <span class="hljs-keyword">new</span> BMap.Marker(point,{icon:carIcon});
        map.addOverlay(marker);

    },<span class="hljs-number">500</span>);


    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeMarkerPosition</span> <span class="hljs-params">()</span> {<!-- --></span>
        myPosition = getCurrentPosition();
       setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
           point = <span class="hljs-keyword">new</span> BMap.Point(myPosition[<span class="hljs-number">0</span>], myPosition[<span class="hljs-number">1</span>]);<span class="hljs-comment">//的饿到了最新的坐标点</span>
           console.log(<span class="hljs-string">"地图中心："</span>+myPosition[<span class="hljs-number">0</span>]+<span class="hljs-string">"  "</span>+myPosition[<span class="hljs-number">1</span>]);
           marker = <span class="hljs-keyword">new</span> BMap.Marker(point,{icon:carIcon});
           <span class="hljs-comment">//map.centerAndZoom(point, 14);</span>
           map.clearOverlays();<span class="hljs-comment">//在地图上清除掉所有的覆盖物。</span>
           map.addOverlay(marker);
           marker.setAnimation(BMAP_ANIMATION_BOUNCE);<span class="hljs-comment">//给marker设置动画</span>
           console.log(<span class="hljs-string">"maker的位置"</span>+marker.getPosition().lng+<span class="hljs-string">"  "</span>+marker.getPosition().lat);
       },<span class="hljs-number">500</span>);<span class="hljs-comment">//此暂停放噶目前不得已而位置，带我日后掌握回调函数再战</span>

    }

</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre> 
<p>现在再打开网页，不管是手动刷新还是自动刷新，你的小车位置会随着时间而改变了。 <br> <strong>完毕</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/84430b84265802d02c868db0ee367e94/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">遇到 no plugin found for prefix &#39;tomcat 7&#39; in the current project and in the plugin groups 的解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/17da73a5ff5875d422f6c38ec77d7ab6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">samba挂载错误mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. ma</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>