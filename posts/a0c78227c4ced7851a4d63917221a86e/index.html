<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>早高峰共享单车潮汐点的群智优化Baseline - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="早高峰共享单车潮汐点的群智优化Baseline" />
<meta property="og:description" content="参考自：coogle数据科学 https://coggle.club/learn/dcic2021/
一、赛题说明 2021数字中国创新大赛大数据赛道-城市管理大数据专题
二、数据读取与理解 共享单车轨迹数据 共享单车轨迹数据为共享单车在使用时候产生的位置定位数据，具体包含单车在不同时间段（默认是15秒记录一次）下的经纬度信息。
读取数据：读取单车轨迹数据： import os, codecs import pandas as pd import numpy as np PATH = &#39;../dataset/&#39; # 共享单车轨迹数据 bike_track = pd.concat([ pd.read_csv(PATH &#43; &#39;gxdc_gj20201221.csv&#39;), pd.read_csv(PATH &#43; &#39;gxdc_gj20201222.csv&#39;), pd.read_csv(PATH &#43; &#39;gxdc_gj20201223.csv&#39;), pd.read_csv(PATH &#43; &#39;gxdc_gj20201224.csv&#39;), pd.read_csv(PATH &#43; &#39;gxdc_gj20201225.csv&#39;) ]) # 按照单车ID和时间进行排序 bike_track = bike_track.sort_values([&#39;BICYCLE_ID&#39;, &#39;LOCATING_TIME&#39;]) 路线可视化 import folium m = folium.Map(location=[24.482426, 118.157606], zoom_start=12) my_PolyLine=folium.PolyLine(locations=bike_track[bike_track[&#39;BICYCLE_ID&#39;] == &#39;000152773681a23a7f2d9af8e8902703&#39;][[&#39;LATITUDE&#39;, &#39;LONGITUDE&#39;]].values,weight=5) m.add_children(my_PolyLine) 共享单车停车点位（电子围栏）数据 共享单车停车点位（电子围栏）数据为规范共享单车停车秩序，统一划定的共享单车停放区域。
读取数据 def bike_fence_format(s): s = s." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a0c78227c4ced7851a4d63917221a86e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-19T23:00:45+08:00" />
<meta property="article:modified_time" content="2021-02-19T23:00:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">早高峰共享单车潮汐点的群智优化Baseline</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考自：<a href="https://coggle.club/learn/dcic2021/" rel="nofollow">coogle数据科学 https://coggle.club/learn/dcic2021/</a></p> 
<h3><a id="_2"></a>一、赛题说明</h3> 
<p><a href="https://data.xm.gov.cn/contest-series/digit-china-2021/#/3/contest_explain?projectId=c81952239f3411eab1d014187758123f" rel="nofollow">2021数字中国创新大赛大数据赛道-城市管理大数据专题</a></p> 
<h3><a id="_6"></a>二、数据读取与理解</h3> 
<h4><a id="_7"></a>共享单车轨迹数据</h4> 
<p>共享单车轨迹数据为共享单车在使用时候产生的位置定位数据，具体包含单车在不同时间段（默认是15秒记录一次）下的经纬度信息。</p> 
<ul><li>读取数据：读取单车轨迹数据：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> codecs
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

PATH <span class="token operator">=</span> <span class="token string">'../dataset/'</span>
<span class="token comment"># 共享单车轨迹数据</span>
bike_track <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201221.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201222.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201223.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201224.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201225.csv'</span><span class="token punctuation">)</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 按照单车ID和时间进行排序</span>
bike_track <span class="token operator">=</span> bike_track<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">,</span> <span class="token string">'LOCATING_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>路线可视化</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> folium
m <span class="token operator">=</span> folium<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">24.482426</span><span class="token punctuation">,</span> <span class="token number">118.157606</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom_start<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
my_PolyLine<span class="token operator">=</span>folium<span class="token punctuation">.</span>PolyLine<span class="token punctuation">(</span>locations<span class="token operator">=</span>bike_track<span class="token punctuation">[</span>bike_track<span class="token punctuation">[</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'000152773681a23a7f2d9af8e8902703'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span>weight<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_children<span class="token punctuation">(</span>my_PolyLine<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7e/ec/nUTVvAKT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_41"></a>共享单车停车点位（电子围栏）数据</h4> 
<p>共享单车停车点位（电子围栏）数据为规范共享单车停车秩序，统一划定的共享单车停放区域。</p> 
<ul><li>读取数据</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">bike_fence_format</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> s

<span class="token comment"># 共享单车停车点位（电子围栏）数据</span>
bike_fence <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_tcd.csv'</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>bike_fence_format<span class="token punctuation">)</span>
</code></pre> 
<ul><li>围栏可视化</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> folium
m <span class="token operator">=</span> folium<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">24.482426</span><span class="token punctuation">,</span> <span class="token number">118.157606</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom_start<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> data <span class="token keyword">in</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    folium<span class="token punctuation">.</span>Marker<span class="token punctuation">(</span>
        data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>add_to<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
m
</code></pre> 
<p><img src="https://images2.imgbox.com/75/6b/Pmlxbchc_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_72"></a>共享单车订单数据</h4> 
<p>共享单车订单数据为共享单车使用时开锁和关锁信息的数据。</p> 
<ul><li>读取数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 共享单车订单数据</span>
bike_order <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_dd.csv'</span><span class="token punctuation">)</span>
bike_order <span class="token operator">=</span> bike_order<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>单车位置可视化</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> folium
m <span class="token operator">=</span> folium<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">24.482426</span><span class="token punctuation">,</span> <span class="token number">118.157606</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom_start<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
my_PolyLine<span class="token operator">=</span>folium<span class="token punctuation">.</span>PolyLine<span class="token punctuation">(</span>locations<span class="token operator">=</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'0000ff105fd5f9099b866bccd157dc50'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span>weight<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_children<span class="token punctuation">(</span>my_PolyLine<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/8f/pwXNBx5a_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_94"></a>轨道交通数据</h4> 
<ul><li>数据读取</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 轨道站点进站客流数据</span>
rail_inflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gdzdtjsj_jzkl.csv'</span><span class="token punctuation">)</span>
rail_inflow <span class="token operator">=</span> rail_inflow<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 轨道站点出站客流数据</span>
rail_outflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gdzdtjsj_czkl.csv'</span><span class="token punctuation">)</span>
rail_outflow <span class="token operator">=</span> rail_outflow<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 轨道站点闸机设备编码数据</span>
rail_device <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gdzdkltj_zjbh.csv'</span><span class="token punctuation">)</span>
rail_device<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'LINE_NO'</span><span class="token punctuation">,</span> <span class="token string">'STATION_NO'</span><span class="token punctuation">,</span> <span class="token string">'STATION_NAME'</span><span class="token punctuation">,</span>
    <span class="token string">'A_IN_MANCHINE'</span><span class="token punctuation">,</span> <span class="token string">'A_OUT_MANCHINE'</span><span class="token punctuation">,</span> 
    <span class="token string">'B_IN_MANCHINE'</span><span class="token punctuation">,</span> <span class="token string">'B_OUT_MANCHINE'</span>
<span class="token punctuation">]</span>
rail_device <span class="token operator">=</span> rail_device<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_117"></a>三、共享单车潮汐点分析</h3> 
<h3><a id="_119"></a>经纬度匹配</h3> 
<p>在本赛题中如果想要完成具体潮汐计算，则需要将订单或轨迹与具体的停车点进行匹配，需要计算在不同时间下每个停车点：</p> 
<ul><li>停了多少车（订单终点为停车点）；</li><li>骑走多少车（订单起点为停车点）；</li></ul> 
<p>因此我们需要根据订单定位到具体的停车点：<br> <img src="https://images2.imgbox.com/55/21/bIJoE51S_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_128"></a>停车点处理</h4> 
<p>首先我们对停车点进行处理，需要计算得出每个停车点的面积和中心经纬度：</p> 
<pre><code class="prism language-python"><span class="token comment"># 得出停车点 LATITUDE 范围</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MIN_LATITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MAX_LATITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 得到停车点 LONGITUDE 范围</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MIN_LONGITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MAX_LONGITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> geopy<span class="token punctuation">.</span>distance <span class="token keyword">import</span> geodesic
<span class="token comment"># 根据停车点 范围 计算具体的面积</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_AREA'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geodesic<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'MIN_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'MIN_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'MAX_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'MAX_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>meters<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 根据停车点 计算中心经纬度</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>中心经纬度可以用来具体的距离匹配，当然如果用四个点的坐标会更加准确，但计算时间更大。</p> 
<h4><a id="Geohash_154"></a>Geohash经纬度匹配</h4> 
<p>在赛题中计算单车与停车点的关系主要的就在经纬度计算，如何将单车维度与停车点进行匹配？这个问题会影响具体的匹配精度，同时也会影响匹配的速度。在此我们使用geohash库来对经纬度进行编码，这样可以增加统计的速度，也可以动态调整经纬匹配的范围。</p> 
<p>如果想深入了解geohash，可以参考以下链接：</p> 
<ul><li><a href="https://www.cnblogs.com/feiquan/p/11380461.html" rel="nofollow">geohash介绍</a></li><li><a href="https://coggle.club/learn/dcic2020/task5" rel="nofollow">DCIC2020</a></li></ul> 
<p>通过geohash可以将一个经纬度编码为一个字符串，需要注意的是precision控制了编码精度，数值越大覆盖范围越小，数值越小覆盖范围越大。</p> 
<p>需要注意：这里的precision与具体的定位点范围强相关，需要根据具体的赛题要求完成设置。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> geohash
bike_order<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

bike_fence<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>使用<code>ws7gx9</code>对单车订单数据进行索引，可以得到具体订单数据：</p> 
<pre><code class="prism language-python"><span class="token comment"># bike_order[bike_order['geohash'] == 'ws7gx9']</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/f9/7M7ERGdF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_184"></a>区域流量与潮汐统计</h3> 
<p>在完成具体的经纬度匹配后，接下来就需要完成具体的区域流量统计，即统计某一范围内的不同时间的流量（入流量和出流量）。</p> 
<p>首先对订单数据进行时间提取：</p> 
<pre><code class="prism language-python">bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>day<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>

bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>hour<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>pad<span class="token punctuation">(</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>side<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>fillchar<span class="token operator">=</span><span class="token string">'0'</span><span class="token punctuation">)</span>

<span class="token comment"># 日期和时间进行拼接</span>
bike_order<span class="token punctuation">[</span><span class="token string">'DAY_HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">+</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span>
</code></pre> 
<p>使用透视表统计每个区域在不同时间的入流量和出流量：</p> 
<pre><code class="prism language-python">bike_inflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY_HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_outflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY_HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>通过以上代码就可以统计完成区域流量，接下来可以做简单的绘图：</p> 
<pre><code class="prism language-python">bike_inflow<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'wsk593'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
bike_outflow<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'wsk593'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>bike_inflow<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bike_inflow<span class="token punctuation">.</span>columns<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'入流量'</span><span class="token punctuation">,</span> <span class="token string">'出流量'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/7c/xve3FMB1_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">bike_inflow<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'wsk52r'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
bike_outflow<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'wsk52r'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>bike_inflow<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bike_inflow<span class="token punctuation">.</span>columns<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'入流量'</span><span class="token punctuation">,</span> <span class="token string">'出流量'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prop <span class="token operator">=</span> prop<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/f2/6lnwjLMn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1Geohash_235"></a>方法1：Geohash匹配计算潮汐</h3> 
<p>由于赛题需要统计工作日早高峰期间的潮汐现象，所以我们可以按照天进行单车流量统计：</p> 
<pre><code class="prism language-python">bike_inflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_outflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>根据入流量和出流量，可以计算得到每个位置的留存流量：</p> 
<pre><code class="prism language-python">bike_remain <span class="token operator">=</span> <span class="token punctuation">(</span>bike_inflow <span class="token operator">-</span> bike_outflow<span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 存在骑走的车数量 大于 进来的车数量</span>
bike_remain<span class="token punctuation">[</span>bike_remain <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  

<span class="token comment"># 按照天求平均</span>
bike_remain <span class="token operator">=</span> bike_remain<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里假设我们需要统计街道维度的潮汐情况，我们可以先把街道信息提取，然后计算密度。这里我们需要计算每个街道不同停车点的留存车辆，所以不能重复统计。</p> 
<pre><code class="prism language-python"><span class="token comment"># 总共有993条街</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'STREET'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 留存车辆 / 街道停车位总面积，计算得到密度</span>
bike_density <span class="token operator">=</span> bike_fence<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'STREET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> hs<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>bike_remain<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> hs<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token operator">/</span> bike_fence<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'STREET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'FENCE_AREA'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 按照密度倒序</span>
bike_density <span class="token operator">=</span> bike_density<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>就可以得到潮汐情况最严重的道路：<br> <img src="https://images2.imgbox.com/95/2b/j0ATCRVj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_280"></a>方法2：距离匹配计算潮汐</h3> 
<p>如果使用Geohash来统计会存在一个问题，统计的方法会不准确，导致只能精确到街道信息。本节将使用经纬度距离匹配的方法来进行尝试，具体的思路为计算订单最近的停车点，进而计算具体的潮汐情况。</p> 
<p>对于经纬度距离计算，可以直接使用sklearn中的NearestNeighbors，通过设置haversine距离可以很方便的完成最近停车点的计算。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> NearestNeighbors

<span class="token comment"># https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.DistanceMetric.html</span>
knn <span class="token operator">=</span> NearestNeighbors<span class="token punctuation">(</span>metric <span class="token operator">=</span> <span class="token string">"haversine"</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">'brute'</span><span class="token punctuation">)</span>
knn<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>计算订单中对应的停车点位置：</p> 
<pre><code class="prism language-python"><span class="token comment"># 需要11s左右</span>
dist<span class="token punctuation">,</span> index <span class="token operator">=</span> knn<span class="token punctuation">.</span>kneighbors<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">,</span><span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_neighbors<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>但是如果直接使用NearestNeighbors计算速度会非常慢，如果是全量定量订单数据可能需要较长时间。因此可以用hnsw做近似搜索，速度较快但精度差一点。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> hnswlib
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

p <span class="token operator">=</span> hnswlib<span class="token punctuation">.</span>Index<span class="token punctuation">(</span>space<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>init_index<span class="token punctuation">(</span>max_elements<span class="token operator">=</span><span class="token number">300000</span><span class="token punctuation">,</span> ef_construction<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> M<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>set_ef<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>set_num_threads<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>add_items<span class="token punctuation">(</span>np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>计算所有订单的停车位置：</p> 
<pre><code class="prism language-python">index<span class="token punctuation">,</span> dist <span class="token operator">=</span> p<span class="token punctuation">.</span>knn_query<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">,</span><span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后计算所有停车点的潮汐流量：</p> 
<pre><code class="prism language-python">bike_order<span class="token punctuation">[</span><span class="token string">'fence'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values

bike_inflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'fence'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_outflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'fence'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_remain <span class="token operator">=</span> <span class="token punctuation">(</span>bike_inflow <span class="token operator">-</span> bike_outflow<span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
bike_remain<span class="token punctuation">[</span>bike_remain <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  
bike_remain <span class="token operator">=</span> bike_remain<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>计算停车点的密度：</p> 
<pre><code class="prism language-python">bike_density <span class="token operator">=</span> bike_remain <span class="token operator">/</span> bike_fence<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'FENCE_AREA'</span><span class="token punctuation">]</span>
bike_density <span class="token operator">=</span> bike_density<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
bike_density <span class="token operator">=</span> bike_density<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/02/7d/qzSuOCSM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_350"></a>四、共享单车潮汐点优化</h3> 
<p>根据上面的街道潮汐统计，我们可以统计得出每个街道的具体潮汐情况，并进而可以按照密度计算得到潮汐情况最为严重的区域。为了对厦门市潮汐情况与区域关系进行可视化，来对具体的潮汐情况进行直观的感受。</p> 
<p>首先我们按照之前的代码完成具体数据读取，并对单车订单数据的时间进行提取：</p> 
<pre><code class="prism language-python">bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>day<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>

bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'UPDATE_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>hour<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>pad<span class="token punctuation">(</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>side<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>fillchar<span class="token operator">=</span><span class="token string">'0'</span><span class="token punctuation">)</span>

bike_order<span class="token punctuation">[</span><span class="token string">'DAY_HOUR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span> <span class="token operator">+</span> bike_order<span class="token punctuation">[</span><span class="token string">'HOUR'</span><span class="token punctuation">]</span>
</code></pre> 
<p>为了方便统计这里，我们只使用一个时间的订单数据进行绘制：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> folium
<span class="token keyword">from</span> folium <span class="token keyword">import</span> plugins
<span class="token keyword">from</span> folium<span class="token punctuation">.</span>plugins <span class="token keyword">import</span> HeatMap

map_hooray <span class="token operator">=</span> folium<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">24.482426</span><span class="token punctuation">,</span> <span class="token number">118.157606</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom_start<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
HeatMap<span class="token punctuation">(</span>bike_order<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token string">'DAY_HOUR'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'2106'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                   <span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add_to<span class="token punctuation">(</span>map_hooray<span class="token punctuation">)</span>

<span class="token keyword">for</span> data <span class="token keyword">in</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    folium<span class="token punctuation">.</span>Marker<span class="token punctuation">(</span>
        data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>add_to<span class="token punctuation">(</span>map_hooray<span class="token punctuation">)</span>

map_hooray
</code></pre> 
<p><img src="https://images2.imgbox.com/19/74/B0YqA28a_o.png" alt="在这里插入图片描述">如上图，我们可以看到颜色表示为具体停车位置的热度，具体点为订车点的位置。</p> 
<ul><li>并不是所有的车都听到了停车点，有一些车听到了距离停车点较远的距离；</li><li>有一些停车点有潮汐现象，有的不存在潮汐现象；</li></ul> 
<h4><a id="_390"></a>其他停车点推荐</h4> 
<p>根据之前的街道潮汐统计，我们可以得到每个停车点具体的潮汐情况。如果此停车点停满了，进一步我们也可以推荐其他停车点。</p> 
<p>我们使用下面的代码完成具体的停车点潮汐统计：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> geohash
bike_order<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> 
                        geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> geopy<span class="token punctuation">.</span>distance <span class="token keyword">import</span> geodesic

bike_fence<span class="token punctuation">[</span><span class="token string">'MIN_LATITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MAX_LATITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

bike_fence<span class="token punctuation">[</span><span class="token string">'MIN_LONGITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'MAX_LONGITUDE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_AREA'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geodesic<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'MIN_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'MIN_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'MAX_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'MAX_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>meters<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_LOC'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">import</span> geohash
bike_order<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_order<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

bike_fence<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

bike_inflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_outflow <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>bike_order<span class="token punctuation">[</span>bike_order<span class="token punctuation">[</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   values<span class="token operator">=</span><span class="token string">'LOCK_STATUS'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DAY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

bike_remain <span class="token operator">=</span> <span class="token punctuation">(</span>bike_inflow <span class="token operator">-</span> bike_outflow<span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
bike_remain<span class="token punctuation">[</span>bike_remain <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  
bike_remain <span class="token operator">=</span> bike_remain<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
bike_fence<span class="token punctuation">[</span><span class="token string">'DENSITY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bike_fence<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>bike_remain<span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果乘客到了一个潮汐停车点A，如何对乘客进行引导呢？</p> 
<ul><li>推荐的停车点B应该和A距离不远；</li><li>推荐的停车点B应该没有潮汐情况；</li><li>也需要考虑到跨街道和横穿马路的情况；</li></ul> 
<p>首先为了完成停车点距离计算，还是先定义好KNN：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> NearestNeighbors

knn <span class="token operator">=</span> NearestNeighbors<span class="token punctuation">(</span>metric <span class="token operator">=</span> <span class="token string">"haversine"</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">'brute'</span><span class="token punctuation">)</span>
knn<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后是具体的计算逻辑进行编码：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">fence_recommend1</span><span class="token punctuation">(</span>fence_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fence_center <span class="token operator">=</span> bike_fence<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>bike_fence<span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span><span class="token operator">==</span>fence_id<span class="token punctuation">,</span> <span class="token string">'FENCE_CENTER'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 具体街道方向</span>
    fence_dir <span class="token operator">=</span> fence_id<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># 根据距离计算最近的20个待选位置</span>
    dist<span class="token punctuation">,</span> index <span class="token operator">=</span> knn<span class="token punctuation">.</span>kneighbors<span class="token punctuation">(</span><span class="token punctuation">[</span>fence_center<span class="token punctuation">]</span><span class="token punctuation">,</span> n_neighbors<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

    <span class="token comment"># 对每个待选位置进行筛选</span>
    <span class="token keyword">for</span> idx <span class="token keyword">in</span> index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># 剔除已经有很多车的</span>
        <span class="token keyword">if</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'DENSITY'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token comment"># 剔除需要过街的</span>
        <span class="token keyword">if</span> fence_dir <span class="token operator">not</span> <span class="token keyword">in</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">return</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre> 
<h4><a id="_479"></a>停车引导计划</h4> 
<p>此外还需要考虑到单车没有起到停车点的情况，即推荐根据经纬度推荐最近非潮汐停车点：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">fence_recommend2</span><span class="token punctuation">(</span>la<span class="token punctuation">,</span> lo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dist<span class="token punctuation">,</span> index <span class="token operator">=</span> knn<span class="token punctuation">.</span>kneighbors<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>la<span class="token punctuation">,</span> lo<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_neighbors<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> idx <span class="token keyword">in</span> index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'DENSITY'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">return</span> bike_fence<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'FENCE_ID'</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre> 
<p>综上所述我们可以将潮汐引导计划描述如下，分为两种情况：<br> 综上所述我们可以将潮汐引导计划描述如下，分为两种情况：</p> 
<h3><a id="_495"></a>五、共享单车调度方案</h3> 
<h4><a id="_496"></a>单车利用率</h4> 
<p>共享单车作为城市交通中重要的一环，可以方便市民便捷出行。但单车具体的位置随着群体波动，并且容易出现单车潮汐和分布不均衡的情况，最终导致单车利用率较低。<br> <img src="https://images2.imgbox.com/40/5b/x0hfXcN7_o.png" alt="在这里插入图片描述"><br> 首先我们可以统计不同品牌单车的利用率：</p> 
<pre><code class="prism language-python"><span class="token comment"># 共享单车轨迹数据</span>
bike_track <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201221.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201222.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201223.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201224.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>PATH <span class="token operator">+</span> <span class="token string">'gxdc_gj20201225.csv'</span><span class="token punctuation">)</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span>
bike_track <span class="token operator">=</span> bike_track<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">,</span> <span class="token string">'LOCATING_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

bike_use_ratio <span class="token operator">=</span> bike_track<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">,</span><span class="token string">'BICYCLE_ID'</span><span class="token punctuation">,</span> <span class="token string">'hour'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">15.0</span> <span class="token operator">/</span> <span class="token number">3615</span>
bike_use_ratio <span class="token operator">=</span> bike_use_ratio<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
bike_use_ratio<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'hour'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

统计结果：
source   hour
halou    <span class="token number">6</span>       <span class="token number">0.157031</span>
         <span class="token number">7</span>       <span class="token number">0.221240</span>
         <span class="token number">8</span>       <span class="token number">0.315490</span>
         <span class="token number">9</span>       <span class="token number">0.223382</span>
meituan  <span class="token number">6</span>       <span class="token number">0.092250</span>
         <span class="token number">7</span>       <span class="token number">0.099389</span>
         <span class="token number">8</span>       <span class="token number">0.099104</span>
         <span class="token number">9</span>       <span class="token number">0.108867</span>
qingju   <span class="token number">6</span>       <span class="token number">0.054113</span>
         <span class="token number">7</span>       <span class="token number">0.161101</span>
         <span class="token number">8</span>       <span class="token number">0.195099</span>
         <span class="token number">9</span>       <span class="token number">0.120881</span>
Name<span class="token punctuation">:</span> date<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>从统计结果我们可以看出哈喽单车的利用率是其中最高的，而且随着早高峰的到来变化也非常明显。其次是青桔单车，单车利用率也较高。表现最差的是美团单车，单车利用率较低，且在早高峰并没有充分利用。<br> <img src="https://images2.imgbox.com/8d/e9/RJRbsY4s_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_536"></a>调度衡量指标</h4> 
<p>对于共享单车利用率比较低的原因主要是单车调度不到位导致的，即在需要骑车的位置要有单车。这个过程就是单车调度的目标，在原始电单车分布的情况下对单车进行调度，让单车利用率变得更高。但是单车调度是存在成本的：</p> 
<ul><li>每次调度的单车是有限的；</li><li>每次调度的单车是存在时间成本；</li></ul> 
<p>调度具体的衡量因素包括：</p> 
<ul><li>调度之后的单车的使用率；</li><li>调度之后的停车点的潮汐情况；</li><li>调度过程中的调度成本： 
  <ul><li>调度单车个数；</li><li>调度单车次数；</li></ul> </li></ul> 
<p>因此单车调度方法的优化指标可以写为：</p> 
<p><img src="https://images2.imgbox.com/01/ed/230XCMIa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_554"></a>单车调度算法</h4> 
<h5><a id="_555"></a>基于贪心思路的调度算法</h5> 
<h5><a id="_556"></a>基于遗传算法的调度算法</h5> 
<h3><a id="_557"></a>六、单车畅行友好度方案</h3> 
<p>geohash用一个字符串表示经度和纬度两个坐标。某些情况下无法在两列上同时应用索引 （例如MySQL 4之前的版本，Google App Engine的数据层等），利用geohash，只需在一列上应用索引即可。</p> 
<p>其次，geohash表示的并不是一个点，而是一个矩形区域。比如编码wx4g0ec19，它表示的是一个矩形区域。 使用者可以发布地址编码，既能表明自己位于北海公园附近，又不至于暴露自己的精确坐标，有助于隐私保护。</p> 
<ul><li>热力图展示中，用于geohash点聚合功能，可以提高大量点前端渲染的性能</li><li>地址聚类中，通过geohash计算，进行地址归类</li><li>地址信息缓存时，通过geohash为key，来索引缓存信息</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> glob

INPUT_PATH <span class="token operator">=</span> <span class="token string">'../input/'</span> <span class="token comment">#文件目录</span>
MAX_ROWS <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment"># 文件读取行数</span>

taxiorder2019 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>INPUT_PATH <span class="token operator">+</span> <span class="token string">'taxiOrder20190531.csv'</span><span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                           dtype <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                               <span class="token string">'GETON_LONGITUDE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>
                               <span class="token string">'GETON_LATITUDE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>
                               <span class="token string">'GETOFF_LONGITUDE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>
                               <span class="token string">'GETOFF_LATITUDE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>
                               <span class="token string">'PASS_MILE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float16<span class="token punctuation">,</span>
                               <span class="token string">'NOPASS_MILE'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float16<span class="token punctuation">,</span>
                               <span class="token string">'WAITING_TIME'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>float16
                           <span class="token punctuation">}</span><span class="token punctuation">)</span>


taxiorder2019<span class="token punctuation">[</span><span class="token string">'GETON_DATE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>taxiorder2019<span class="token punctuation">[</span><span class="token string">'GETON_DATE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
taxiorder2019<span class="token punctuation">[</span><span class="token string">'GETOFF_DATE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>taxiorder2019<span class="token punctuation">[</span><span class="token string">'GETOFF_DATE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

taxiorder2019 <span class="token operator">=</span> taxiorder2019<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'CAR_NO'</span><span class="token punctuation">:</span><span class="token string">'CARNO'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
taxiorder2019<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'CARNO'</span><span class="token punctuation">,</span><span class="token string">'GETON_DATE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
taxiorder2019<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># taxigps2019.apply(lambda x: geohash.encode(x['GETON_LATITUDE'], x['GETON_LONGITUDE'],  precision=5), axis=1)</span>

taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> taxiorder2019<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'GETON_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'GETON_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
s0000000    6335
ws7unv0q     813
wsk584c9     745
ws7grb9s     617
ws7unv0r     608
wsk52k80     447
wsk584cd     416
ws7grbsy     409
ws7grb6d     394
wsk52dj9     362
Name: geohash, dtype: int64
'''</span>
</code></pre> 
<p>其中s0000000为经纬度异常点，可以剔除掉。接下来我们统计下热门经纬度的中心：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> idx <span class="token keyword">in</span> taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    df <span class="token operator">=</span> taxiorder2019<span class="token punctuation">[</span>taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">==</span> idx<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'GETON_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'GETON_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
ws7unv0q 118.070595 24.637962
wsk584c9 118.127205 24.53685
ws7grb9s 118.116165 24.48105
ws7unv0r 118.07057 24.63811
wsk52k80 118.136154 24.502394
wsk584cd 118.1272 24.536997
ws7grbsy 118.12063 24.481407
ws7grb6d 118.11762 24.479357
wsk52dj9 118.15463 24.48881
wsk58ktu 118.14406 24.546976
'''</span>
</code></pre> 
<h4><a id="_633"></a>订单调度分析</h4> 
<p>巡游车根据等待时间统计具体位置：</p> 
<pre><code class="prism language-python">legal_hash <span class="token operator">=</span> taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index
taxiorder2019<span class="token punctuation">[</span>taxiorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>legal_hash<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'WAITING_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>网约车根据等待时间统计具体位置：</p> 
<pre><code class="prism language-python">wycorder2019<span class="token punctuation">[</span><span class="token string">'DEP_TIME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>wycorder2019<span class="token punctuation">[</span><span class="token string">'DEP_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y%m%d%H%M%S'</span><span class="token punctuation">)</span>
wycorder2019<span class="token punctuation">[</span><span class="token string">'BOOK_DEP_TIME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>wycorder2019<span class="token punctuation">[</span><span class="token string">'BOOK_DEP_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y%m%d%H%M%S'</span><span class="token punctuation">)</span>

wycorder2019<span class="token punctuation">[</span><span class="token string">'WAITING_TIME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>wycorder2019<span class="token punctuation">[</span><span class="token string">'DEP_TIME'</span><span class="token punctuation">]</span> <span class="token operator">-</span> wycorder2019<span class="token punctuation">[</span><span class="token string">'BOOK_DEP_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>seconds
wycorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> wycorder2019<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> geohash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'DEP_LATITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'DEP_LONGITUDE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
wycorder2019<span class="token punctuation">[</span>wycorder2019<span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>legal_hash<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'geohash'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'WAITING_TIME'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>通过统计发现，网约车与巡游车达不到车的位置区域存在部分重叠，但还是会有交叉的情况</p> 
<ul><li>比如打不到网约车，也打不到出租车；</li><li>比如打不到网约车，但能达到出租车；</li></ul> 
<p><img src="https://images2.imgbox.com/52/b9/iCgyQnaW_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b89cb63c385d7b75e8911a167fb0628f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">找不到java虚拟机_找不到Java虚拟机(JVM)库，要更正此问题，请先检查java运行时环境是否已正确安装。...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ae82e29b7a83594012ae708d684a9d2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MCDF实验——Lab5</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>