<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>量化交易——python数据分析及可视化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="量化交易——python数据分析及可视化" />
<meta property="og:description" content="该项目分为两个部分：一是数据计算，二是可视化，三是MACD策略 一、计算MACD 1、数据部分 数据来源：tushare
数据字段包含：日期，开盘价，收盘价，最低价，最高价，涨跌
需要计算的数据：macd，diff，dea
2、MACD的计算 （1）计算指数移动平均值（EMA） 12日EMA的算式为
EMA（12）=前一日EMA（12）×11/13&#43;今日收盘价×2/13
26日EMA的算式为
EMA（26）=前一日EMA（26）×25/27&#43;今日收盘价×2/27
（2）计算离差值（DIF） DIF=今日EMA（12）－今日EMA（26）
（3）计算DIF的9日EMA 根据离差值计算其9日的EMA，即离差平均值，是所求的MACD值。为了不与指标原名相混淆，此值又名
DEA或DEM。
今日DEA（MACD）=前一日DEA×8/10&#43;今日DIF×2/10。
计算出的DIF和DEA的数值均为正值或负值。
用（DIF-DEA）×2即为MACD柱状图。
二、可视化 1、可视化工具：pyecharts pyecharts官网
三、MACD策略 代码实现如下： from typing import List, Sequence, Union from pyecharts import options as opts from pyecharts.commons.utils import JsCode from pyecharts.charts import Kline, Line, Bar, Grid # 数据 #时间， #ema重构版 import pandas as pd import numpy as np import tushare as ts def macd(code,start_date,end_date): &#39;&#39;&#39; 获取数据 预处理 计算股票的ema、dif、dea、macd 主要有9日，12日，26日 &#39;&#39;&#39; #获取数据 pro=ts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/545f9fe9d7ce8410345251d6fa07b23e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T22:37:40+08:00" />
<meta property="article:modified_time" content="2023-10-24T22:37:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">量化交易——python数据分析及可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MACD_0"></a>该项目分为两个部分：一是数据计算，二是可视化，三是MACD策略</h2> 
<h2><a id="MACD_1"></a>一、计算MACD</h2> 
<h3><a id="1_2"></a>1、数据部分</h3> 
<p>数据来源：tushare<br> 数据字段包含：日期，开盘价，收盘价，最低价，最高价，涨跌<br> 需要计算的数据：macd，diff，dea</p> 
<h3><a id="2MACD_6"></a>2、MACD的计算</h3> 
<h4><a id="1EMA_7"></a>（1）计算指数移动平均值（EMA）</h4> 
<p>12日EMA的算式为<br> EMA（12）=前一日EMA（12）×11/13+今日收盘价×2/13<br> 26日EMA的算式为<br> EMA（26）=前一日EMA（26）×25/27+今日收盘价×2/27</p> 
<h4><a id="2DIF_12"></a>（2）计算离差值（DIF）</h4> 
<p>DIF=今日EMA（12）－今日EMA（26）</p> 
<h4><a id="3DIF9EMA_14"></a>（3）计算DIF的9日EMA</h4> 
<p>根据离差值计算其9日的EMA，即离差平均值，是所求的MACD值。为了不与指标原名相混淆，此值又名<br> DEA或DEM。<br> 今日DEA（MACD）=前一日DEA×8/10+今日DIF×2/10。<br> 计算出的DIF和DEA的数值均为正值或负值。<br> 用（DIF-DEA）×2即为MACD柱状图。</p> 
<h2><a id="_21"></a>二、可视化</h2> 
<h3><a id="1pyecharts_22"></a>1、可视化工具：pyecharts</h3> 
<p><a href="https://pyecharts.org/#/" rel="nofollow">pyecharts官网</a><br> <img src="https://images2.imgbox.com/d3/b3/ui5Na9hT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="MACD_25"></a>三、MACD策略</h2> 
<h2><a id="_29"></a>代码实现如下：</h2> 
<pre><code class="prism language-python">
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Sequence<span class="token punctuation">,</span> Union
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>utils <span class="token keyword">import</span> JsCode
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Kline<span class="token punctuation">,</span> Line<span class="token punctuation">,</span> Bar<span class="token punctuation">,</span> Grid

<span class="token comment"># 数据</span>
<span class="token comment">#时间，</span>
<span class="token comment">#ema重构版</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tushare <span class="token keyword">as</span> ts
<span class="token keyword">def</span> <span class="token function">macd</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>start_date<span class="token punctuation">,</span>end_date<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取数据
    预处理
    计算股票的ema、dif、dea、macd
    主要有9日，12日，26日

    '''</span>
    <span class="token comment">#获取数据</span>
    pro<span class="token operator">=</span>ts<span class="token punctuation">.</span>pro_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#获取日k线数据</span>
    df<span class="token operator">=</span>pro<span class="token punctuation">.</span>daily<span class="token punctuation">(</span>ts_code<span class="token operator">=</span>code<span class="token punctuation">,</span>start_date<span class="token operator">=</span>start_date<span class="token punctuation">,</span>end_date<span class="token operator">=</span>end_date<span class="token punctuation">)</span>
    <span class="token comment">#删除不需要的数据</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'ts_code'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'pre_close'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'pct_chg'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'amount'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'trade_date'</span><span class="token punctuation">)</span>
    <span class="token comment">#将成交量缩小一万倍</span>
    df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'vol'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'vol'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">)</span>
    df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'vol'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'vol'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    需要输出哪些数据？
    return:    
    日期，开盘价，收盘价，最低价，最高价，涨跌，macd，dif，dea
    date,open,close,low,high,vol,涨跌，macd，diff，dea

    '''</span>
    <span class="token comment">#ema计算函数</span>
    <span class="token keyword">def</span> <span class="token function">ema</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>data<span class="token operator">=</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ema <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ema<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ema<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">/</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ema
    <span class="token comment">#计算dea</span>
    <span class="token keyword">def</span> <span class="token function">dea</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#传入数组numpy.array</span>
        dea <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            dea<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dea<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">/</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>dea<span class="token punctuation">)</span>
    ema_12<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ema<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ema_26<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ema<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dif<span class="token operator">=</span>ema_12<span class="token operator">-</span>ema_26
    dea<span class="token operator">=</span>dea<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>dif<span class="token punctuation">)</span>
    macd<span class="token operator">=</span><span class="token punctuation">(</span>dif<span class="token operator">-</span>dea<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>
    <span class="token comment">#转化为pd</span>
    df1<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'macd'</span><span class="token punctuation">:</span>macd<span class="token punctuation">,</span><span class="token string">'dif'</span><span class="token punctuation">:</span>dif<span class="token punctuation">,</span><span class="token string">'dea'</span><span class="token punctuation">:</span>dea<span class="token punctuation">}</span>
    df1<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>df1<span class="token punctuation">)</span>
    <span class="token comment">#连接数据</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df1<span class="token punctuation">)</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
    <span class="token comment">#判断涨跌，1为涨，0为跌</span>
    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> x<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>
    
    x<span class="token operator">=</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token operator">-</span>df<span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token comment">#调整列顺序</span>
    df<span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'trade_date'</span><span class="token punctuation">,</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token string">'low'</span><span class="token punctuation">,</span><span class="token string">'high'</span><span class="token punctuation">,</span><span class="token string">'vol'</span><span class="token punctuation">,</span><span class="token string">'macd'</span><span class="token punctuation">,</span><span class="token string">'dif'</span><span class="token punctuation">,</span><span class="token string">'dea'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token comment">#插入涨跌数据</span>
    df<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span>value<span class="token operator">=</span>x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> df<span class="token punctuation">.</span>values<span class="token comment">#转化为列表</span>

macd<span class="token operator">=</span>macd<span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span>start_date<span class="token operator">=</span><span class="token string">'20230101'</span><span class="token punctuation">,</span>end_date<span class="token operator">=</span><span class="token string">'20230320'</span><span class="token punctuation">)</span>
echarts_data <span class="token operator">=</span>macd<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>echarts_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>echarts_data<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
echarts_data = [
    ["2015-10-16", 18.4, 18.58, 18.33, 18.79, 67.00, 1, 0.04, 0.11, 0.09],
    ["2015-10-19", 18.56, 18.25, 18.19, 18.56, 55.00, 0, -0.00, 0.08, 0.09],
   
    ["2016-12-30", 17.53, 17.6, 17.47, 17.61, 22.00, 0, -0.05, -0.03, -0.01],
    ["2017-01-03", 17.6, 17.92, 17.57, 17.98, 28.00, 1, 0.00, 0.00, 0.00],
]
'''</span>
<span class="token keyword">def</span> <span class="token function">split_data</span><span class="token punctuation">(</span>origin_data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
    datas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    times <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    vols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    macds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    difs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    deas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>origin_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        datas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        times<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        vols<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        macds<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        difs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        deas<span class="token punctuation">.</span>append<span class="token punctuation">(</span>origin_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    vols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> vols<span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"datas"</span><span class="token punctuation">:</span> datas<span class="token punctuation">,</span>
        <span class="token string">"times"</span><span class="token punctuation">:</span> times<span class="token punctuation">,</span>
        <span class="token string">"vols"</span><span class="token punctuation">:</span> vols<span class="token punctuation">,</span>
        <span class="token string">"macds"</span><span class="token punctuation">:</span> macds<span class="token punctuation">,</span>
        <span class="token string">"difs"</span><span class="token punctuation">:</span> difs<span class="token punctuation">,</span>
        <span class="token string">"deas"</span><span class="token punctuation">:</span> deas<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">split_data_part</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Sequence<span class="token punctuation">:</span>
    mark_line_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    idx <span class="token operator">=</span> <span class="token number">0</span>
    tag <span class="token operator">=</span> <span class="token number">0</span>
    vols <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">and</span> tag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            idx <span class="token operator">=</span> i
            vols <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
            tag <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> tag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            vols <span class="token operator">+=</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">or</span> tag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            mark_line_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"xAxis"</span><span class="token punctuation">:</span> idx<span class="token punctuation">,</span>
                        <span class="token string">"yAxis"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">"value"</span><span class="token punctuation">:</span> vols<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"xAxis"</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                        <span class="token string">"yAxis"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
            idx <span class="token operator">=</span> i
            vols <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
            tag <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">if</span> tag <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            vols <span class="token operator">+=</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">and</span> tag <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            mark_line_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"xAxis"</span><span class="token punctuation">:</span> idx<span class="token punctuation">,</span>
                        <span class="token string">"yAxis"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>vols <span class="token operator">/</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" M"</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"xAxis"</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                        <span class="token string">"yAxis"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
            idx <span class="token operator">=</span> i
            vols <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> mark_line_data


<span class="token keyword">def</span> <span class="token function">calculate_ma</span><span class="token punctuation">(</span>day_count<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Union<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> day_count<span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        sum_total <span class="token operator">=</span> <span class="token number">0.0</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>day_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            sum_total <span class="token operator">+=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sum_total <span class="token operator">/</span> day_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result


<span class="token keyword">def</span> <span class="token function">draw_chart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    kline <span class="token operator">=</span> <span class="token punctuation">(</span>
        Kline<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>xaxis_data<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            itemstyle_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>ItemStyleOpts<span class="token punctuation">(</span>
                color<span class="token operator">=</span><span class="token string">"#ef232a"</span><span class="token punctuation">,</span>
                color0<span class="token operator">=</span><span class="token string">"#14b143"</span><span class="token punctuation">,</span>
                border_color<span class="token operator">=</span><span class="token string">"#ef232a"</span><span class="token punctuation">,</span>
                border_color0<span class="token operator">=</span><span class="token string">"#14b143"</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            markpoint_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>MarkPointOpts<span class="token punctuation">(</span>
                data<span class="token operator">=</span><span class="token punctuation">[</span>
                    opts<span class="token punctuation">.</span>MarkPointItem<span class="token punctuation">(</span>type_<span class="token operator">=</span><span class="token string">"max"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"最大值"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    opts<span class="token punctuation">.</span>MarkPointItem<span class="token punctuation">(</span>type_<span class="token operator">=</span><span class="token string">"min"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"最小值"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            markline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>MarkLineOpts<span class="token punctuation">(</span>
                label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>
                    position<span class="token operator">=</span><span class="token string">"middle"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">,</span> font_size<span class="token operator">=</span><span class="token number">15</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                data<span class="token operator">=</span>split_data_part<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                symbol<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"circle"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>
            markarea_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>MarkAreaOpts<span class="token punctuation">(</span>is_silent<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> data<span class="token operator">=</span>split_data_part<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
            title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"K线周期图表"</span><span class="token punctuation">,</span> pos_left<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                type_<span class="token operator">=</span><span class="token string">"category"</span><span class="token punctuation">,</span>
                is_scale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                boundary_gap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                axisline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisLineOpts<span class="token punctuation">(</span>is_on_zero<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                splitline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>SplitLineOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                split_number<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
                min_<span class="token operator">=</span><span class="token string">"dataMin"</span><span class="token punctuation">,</span>
                max_<span class="token operator">=</span><span class="token string">"dataMax"</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            yaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                is_scale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> splitline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>SplitLineOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            tooltip_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TooltipOpts<span class="token punctuation">(</span>trigger<span class="token operator">=</span><span class="token string">"axis"</span><span class="token punctuation">,</span> axis_pointer_type<span class="token operator">=</span><span class="token string">"line"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            datazoom_opts<span class="token operator">=</span><span class="token punctuation">[</span>
                opts<span class="token punctuation">.</span>DataZoomOpts<span class="token punctuation">(</span>
                    is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> type_<span class="token operator">=</span><span class="token string">"inside"</span><span class="token punctuation">,</span> xaxis_index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> range_end<span class="token operator">=</span><span class="token number">100</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>DataZoomOpts<span class="token punctuation">(</span>
                    is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> xaxis_index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pos_top<span class="token operator">=</span><span class="token string">"97%"</span><span class="token punctuation">,</span> range_end<span class="token operator">=</span><span class="token number">100</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>DataZoomOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> xaxis_index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> range_end<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment"># 三个图的 axis 连在一块</span>
            <span class="token comment"># axispointer_opts=opts.AxisPointerOpts(</span>
            <span class="token comment">#     is_show=True,</span>
            <span class="token comment">#     link=[{"xAxisIndex": "all"}],</span>
            <span class="token comment">#     label=opts.LabelOpts(background_color="#777"),</span>
            <span class="token comment"># ),</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    kline_line <span class="token operator">=</span> <span class="token punctuation">(</span>
        Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>xaxis_data<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">"MA5"</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>calculate_ma<span class="token punctuation">(</span>day_count<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            is_smooth<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
            linestyle_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LineStyleOpts<span class="token punctuation">(</span>opacity<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
            xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                type_<span class="token operator">=</span><span class="token string">"category"</span><span class="token punctuation">,</span>
                grid_index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            yaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                grid_index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                split_number<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
                axisline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisLineOpts<span class="token punctuation">(</span>is_on_zero<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                axistick_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisTickOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                splitline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>SplitLineOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># Overlap Kline + Line</span>
    overlap_kline_line <span class="token operator">=</span> kline<span class="token punctuation">.</span>overlap<span class="token punctuation">(</span>kline_line<span class="token punctuation">)</span>

    <span class="token comment"># Bar-1</span>
    bar_1 <span class="token operator">=</span> <span class="token punctuation">(</span>
        Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>xaxis_data<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">"Volumn"</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"vols"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            xaxis_index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            yaxis_index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment"># 根据 echarts demo 的原版是这么写的</span>
            <span class="token comment"># itemstyle_opts=opts.ItemStyleOpts(</span>
            <span class="token comment">#     color=JsCode("""</span>
            <span class="token comment">#     function(params) {<!-- --></span>
            <span class="token comment">#         var colorList;</span>
            <span class="token comment">#         if (data.datas[params.dataIndex][1]&gt;data.datas[params.dataIndex][0]) {<!-- --></span>
            <span class="token comment">#           colorList = '#ef232a';</span>
            <span class="token comment">#         } else {<!-- --></span>
            <span class="token comment">#           colorList = '#14b143';</span>
            <span class="token comment">#         }</span>
            <span class="token comment">#         return colorList;</span>
            <span class="token comment">#     }</span>
            <span class="token comment">#     """)</span>
            <span class="token comment"># )</span>
            <span class="token comment"># 改进后在 grid 中 add_js_funcs 后变成如下</span>
            itemstyle_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>ItemStyleOpts<span class="token punctuation">(</span>
                color<span class="token operator">=</span>JsCode<span class="token punctuation">(</span>
                    <span class="token triple-quoted-string string">"""
                function(params) {
                    var colorList;
                    if (barData[params.dataIndex][1] &gt; barData[params.dataIndex][0]) {
                        colorList = '#ef232a';
                    } else {
                        colorList = '#14b143';
                    }
                    return colorList;
                }
                """</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
            xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                type_<span class="token operator">=</span><span class="token string">"category"</span><span class="token punctuation">,</span>
                grid_index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># Bar-2 (Overlap Bar + Line)</span>
    bar_2 <span class="token operator">=</span> <span class="token punctuation">(</span>
        Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>xaxis_data<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">"MACD"</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"macds"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            xaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            yaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            itemstyle_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>ItemStyleOpts<span class="token punctuation">(</span>
                color<span class="token operator">=</span>JsCode<span class="token punctuation">(</span>
                    <span class="token triple-quoted-string string">"""
                        function(params) {
                            var colorList;
                            if (params.data &gt;= 0) {
                              colorList = '#ef232a';
                            } else {
                              colorList = '#14b143';
                            }
                            return colorList;
                        }
                        """</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
            xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                type_<span class="token operator">=</span><span class="token string">"category"</span><span class="token punctuation">,</span>
                grid_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
                axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            yaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>
                grid_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
                split_number<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
                axisline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisLineOpts<span class="token punctuation">(</span>is_on_zero<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                axistick_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisTickOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                splitline_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>SplitLineOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    line_2 <span class="token operator">=</span> <span class="token punctuation">(</span>
        Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>xaxis_data<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"times"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">"DIF"</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"difs"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            xaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            yaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span>
            series_name<span class="token operator">=</span><span class="token string">"DIF"</span><span class="token punctuation">,</span>
            y_axis<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"deas"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            xaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            yaxis_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
            label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># 最下面的柱状图和折线图</span>
    overlap_bar_line <span class="token operator">=</span> bar_2<span class="token punctuation">.</span>overlap<span class="token punctuation">(</span>line_2<span class="token punctuation">)</span>

    <span class="token comment"># 最后的 Grid</span>
    grid_chart <span class="token operator">=</span> Grid<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 这个是为了把 data.datas 这个数据写入到 html 中,还没想到怎么跨 series 传值</span>
    <span class="token comment"># demo 中的代码也是用全局变量传的</span>
    grid_chart<span class="token punctuation">.</span>add_js_funcs<span class="token punctuation">(</span><span class="token string">"var barData = {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># K线图和 MA5 的折线图</span>
    grid_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>
        overlap_kline_line<span class="token punctuation">,</span>
        grid_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>GridOpts<span class="token punctuation">(</span>pos_left<span class="token operator">=</span><span class="token string">"3%"</span><span class="token punctuation">,</span> pos_right<span class="token operator">=</span><span class="token string">"1%"</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token string">"60%"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># Volumn 柱状图</span>
    grid_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>
        bar_1<span class="token punctuation">,</span>
        grid_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>GridOpts<span class="token punctuation">(</span>
            pos_left<span class="token operator">=</span><span class="token string">"3%"</span><span class="token punctuation">,</span> pos_right<span class="token operator">=</span><span class="token string">"1%"</span><span class="token punctuation">,</span> pos_top<span class="token operator">=</span><span class="token string">"71%"</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token string">"10%"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># MACD DIFS DEAS</span>
    grid_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>
        overlap_bar_line<span class="token punctuation">,</span>
        grid_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>GridOpts<span class="token punctuation">(</span>
            pos_left<span class="token operator">=</span><span class="token string">"3%"</span><span class="token punctuation">,</span> pos_right<span class="token operator">=</span><span class="token string">"1%"</span><span class="token punctuation">,</span> pos_top<span class="token operator">=</span><span class="token string">"82%"</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token string">"14%"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    grid_chart<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"professional_kline_chart.html"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> split_data<span class="token punctuation">(</span>origin_data<span class="token operator">=</span>echarts_data<span class="token punctuation">)</span>
    draw_chart<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="_466"></a>文章持续更新中。。。</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85a5ff173b34ec9f2af8fb916550517d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【取最大值的三种方式】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3854437f2b07a19de73be6b989138585/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">(Zst_2001)B站-面向对象软考笔记简</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>