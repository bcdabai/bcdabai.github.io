<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五)" />
<meta property="og:description" content="文章目录 Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五)DLc： 消息类和通信类服务器客户端 Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五) DLc： 消息类和通信类 Message
namespace Net { public class Message { public byte Type; public int Command; public object Content; public Message() { } public Message(byte type, int command, object content) { Type = type; Command = command; Content = content; } } //消息类型 public class MessageType { //unity //类型 public static byte Type_UI = 0; //账号登录注册 public const byte Type_Account = 1; //用户 public const byte Type_User = 2; //攻击 public const byte Type_Battle = 3; //注册账号 public const int Account_Register = 100; public const int Account_Register_Res = 101; //登陆 public const int Account_Login = 102; public const int Account_Login_res = 103; //角色部分 //选择角色 public const int User_Select = 204; public const int User_Select_res = 205; public const int User_Create_Event = 206; //删除角色 public const int User_Remove_Event = 207; //攻击和移动 //移动point[] public const int Battle_Move = 301; //移动响应id point[] public const int Battle_Move_Event = 302; //攻击 targetid public const int Battle_Attack = 303; //攻击响应id targetid 剩余血量 public const int Battle_Attack_Event = 304; } } peer类" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e46aea712d1664fde7fe7c0a064ac28d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-19T14:48:28+08:00" />
<meta property="article:modified_time" content="2023-08-19T14:48:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#UnityPhotonServerPhotonServer_1" rel="nofollow">Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五)</a></li><li><ul><li><a href="#DLc__3" rel="nofollow">DLc： 消息类和通信类</a></li><li><a href="#_240" rel="nofollow">服务器</a></li><li><a href="#_363" rel="nofollow">客户端</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="UnityPhotonServerPhotonServer_1"></a>Unity进阶–通过PhotonServer实现人物移动和攻击–PhotonServer(五)</h2> 
<h3><a id="DLc__3"></a>DLc： 消息类和通信类</h3> 
<ul><li> <p>Message</p> <pre><code class="prism language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">Net</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Message</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">byte</span></span> Type<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Command<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">object</span></span> Content<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">Message</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span></span> type<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> command<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> content<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Type <span class="token operator">=</span> type<span class="token punctuation">;</span>
            Command <span class="token operator">=</span> command<span class="token punctuation">;</span>
            Content <span class="token operator">=</span> content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//消息类型</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageType</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//unity</span>
        <span class="token comment">//类型</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">byte</span></span> Type_UI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   
        <span class="token comment">//账号登录注册</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">byte</span></span> Type_Account <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">//用户</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">byte</span></span> Type_User <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">//攻击</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">byte</span></span> Type_Battle <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

        <span class="token comment">//注册账号</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Account_Register <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Account_Register_Res <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>
        <span class="token comment">//登陆</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Account_Login <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Account_Login_res <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>

        <span class="token comment">//角色部分</span>
        <span class="token comment">//选择角色</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> User_Select <span class="token operator">=</span> <span class="token number">204</span><span class="token punctuation">;</span> 
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> User_Select_res <span class="token operator">=</span> <span class="token number">205</span><span class="token punctuation">;</span> 
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> User_Create_Event <span class="token operator">=</span> <span class="token number">206</span><span class="token punctuation">;</span>
        <span class="token comment">//删除角色</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> User_Remove_Event <span class="token operator">=</span> <span class="token number">207</span><span class="token punctuation">;</span>

        <span class="token comment">//攻击和移动</span>
        <span class="token comment">//移动point[]</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Battle_Move <span class="token operator">=</span> <span class="token number">301</span><span class="token punctuation">;</span>
        <span class="token comment">//移动响应id point[]</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Battle_Move_Event <span class="token operator">=</span> <span class="token number">302</span><span class="token punctuation">;</span>
        <span class="token comment">//攻击 targetid</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Battle_Attack <span class="token operator">=</span> <span class="token number">303</span><span class="token punctuation">;</span>
        <span class="token comment">//攻击响应id targetid 剩余血量</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> Battle_Attack_Event <span class="token operator">=</span> <span class="token number">304</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
  <ul><li> <p>peer类</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Photon<span class="token punctuation">.</span>SocketServer</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PhotonHostRuntimeInterfaces</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Bll</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">PhotonServerFirst</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PSPeer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ClientPeer</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token function">PSPeer</span><span class="token punctuation">(</span><span class="token class-name">InitRequest</span> initRequest<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>initRequest<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>

        <span class="token comment">//处理客户端断开的后续工作</span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisconnect</span><span class="token punctuation">(</span><span class="token class-name">DisconnectReason</span> reasonCode<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> reasonDetail<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//关闭管理器</span>
            BLLManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>accountBLL<span class="token punctuation">.</span><span class="token function">OnDisconnect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            BLLManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userBLL<span class="token punctuation">.</span><span class="token function">OnDisconnect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//处理客户端的请求</span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnOperationRequest</span><span class="token punctuation">(</span><span class="token class-name">OperationRequest</span> operationRequest<span class="token punctuation">,</span> <span class="token class-name">SendParameters</span> sendParameters<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            PSTest<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"收到客户端的消息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> dic <span class="token operator">=</span> operationRequest<span class="token punctuation">.</span>Parameters<span class="token punctuation">;</span>

            <span class="token comment">//打包，转为PhotonMessage</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span>Type <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>dic<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span>Command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>dic<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> objs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span></span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dic<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                objs<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dic<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            message<span class="token punctuation">.</span>Content <span class="token operator">=</span> objs<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//消息分发</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Type_Account<span class="token punctuation">:</span>
                    <span class="token comment">//PSTest.log.Info("收到客户端的登陆消息");</span>
                    BLLManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>accountBLL<span class="token punctuation">.</span><span class="token function">OnOperationRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Type_User<span class="token punctuation">:</span>
                    BLLManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userBLL<span class="token punctuation">.</span><span class="token function">OnOperationRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">:</span>
                    PSTest<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"收到攻击移动命令"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    BLLManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>battleMoveBLL<span class="token punctuation">.</span><span class="token function">OnOperationRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> </li></ul> </li><li> <p>客户端对接类</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ExitGames<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>Photon</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Net</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhotonManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyrSingletonBase<span class="token punctuation">&lt;</span>PhotonManager<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IPhotonPeerListener</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span>  <span class="token class-name">PhotonPeer</span> peer<span class="token punctuation">;</span>
    
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">DontDestroyOnLoad</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Start is called before the first frame update</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        peer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PhotonPeer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ConnectionProtocol<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        peer<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1:4530"</span><span class="token punctuation">,</span> <span class="token string">"PhotonServerFirst"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        peer<span class="token punctuation">.</span><span class="token function">Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//断开连接</span>
        peer<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DebugReturn</span><span class="token punctuation">(</span><span class="token class-name">DebugLevel</span> level<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 接收服务器事件</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="eventData"&gt;&lt;/param&gt;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEvent</span><span class="token punctuation">(</span><span class="token class-name">EventData</span> eventData<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        
        <span class="token comment">//拆包</span>
        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>Type <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>eventData<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>Command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>eventData<span class="token punctuation">.</span> Parameters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span></span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> eventData<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>eventData<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        msg<span class="token punctuation">.</span>Content <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        MessageCenter<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 接收服务器响应</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="operationResponse"&gt;&lt;/param&gt;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnOperationResponse</span><span class="token punctuation">(</span><span class="token class-name">OperationResponse</span> operationResponse<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>operationResponse<span class="token punctuation">.</span>OperationCode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>operationResponse<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 状态改变</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name="statusCode"&gt;&lt;/param&gt;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStatusChanged</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span> statusCode<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 发送消息</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Send</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span></span> type<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> command<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">byte</span></span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> o <span class="token keyword">in</span> objs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        peer<span class="token punctuation">.</span><span class="token function">OpCustom</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dic<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> </li></ul> 
<h3><a id="_240"></a>服务器</h3> 
<ul><li> <p>BLL管理</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Bll<span class="token punctuation">.</span>BattleMove</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Bll<span class="token punctuation">.</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Bll</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BLLManager</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BLLManager</span> bLLManager<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">BLLManager</span> Instance
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>bLLManager <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    bLLManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BLLManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> bLLManager<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//登录注册管理</span>
        <span class="token keyword">public</span> <span class="token class-name">IMessageHandler</span> accountBLL<span class="token punctuation">;</span>
        <span class="token comment">//角色管理</span>
        <span class="token keyword">public</span> <span class="token class-name">IMessageHandler</span> userBLL<span class="token punctuation">;</span>
        <span class="token comment">//移动和攻击管理</span>
        <span class="token keyword">public</span> <span class="token class-name">IMessageHandler</span> battleMoveBLL<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token function">BLLManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        accountBLL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PhsotonServerFirst<span class="token punctuation">.</span>Bll<span class="token punctuation">.</span>Account<span class="token punctuation">.</span>AccountBLL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userBLL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserBLL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        battleMoveBLL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BattleMoveBLL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <p>}</p> </li><li> <p>移动BLL</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Dal</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">PhotonServerFirst<span class="token punctuation">.</span>Bll<span class="token punctuation">.</span>BattleMove</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> <span class="token class-name">BattleMoveBLL</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMessageHandler</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisconnect</span><span class="token punctuation">(</span><span class="token class-name">PSPeer</span> peer<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnOperationRequest</span><span class="token punctuation">(</span><span class="token class-name">PSPeer</span> peer<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>message<span class="token punctuation">.</span>Content<span class="token punctuation">;</span> 
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>Command<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Battle_Move<span class="token punctuation">:</span>
                    PSTest<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"BattleMove收到移动命令"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">Move</span><span class="token punctuation">(</span>peer<span class="token punctuation">,</span> objs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Battle_Attack<span class="token punctuation">:</span>
                    <span class="token function">Attack</span><span class="token punctuation">(</span>peer<span class="token punctuation">,</span> objs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token class-name">PSPeer</span> peer<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//targetid</span>
            <span class="token comment">//id targetid 剩余血量</span>
            <span class="token class-name"><span class="token keyword">int</span></span> targetid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//攻击者</span>
            <span class="token class-name">UserModel</span> user <span class="token operator">=</span> DALManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userDAL<span class="token punctuation">.</span><span class="token function">GetUserModel</span><span class="token punctuation">(</span>peer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//被攻击者</span>
            <span class="token class-name">UserModel</span> targetUser <span class="token operator">=</span> DALManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userDAL<span class="token punctuation">.</span><span class="token function">GetUserModel</span><span class="token punctuation">(</span>targetid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//计算伤害</span>
            targetUser<span class="token punctuation">.</span>Hp <span class="token operator">-=</span> user<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>Attack<span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">PSPeer</span> otherpeer <span class="token keyword">in</span> DALManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userDAL<span class="token punctuation">.</span><span class="token function">GetuserPeers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                SendMessage<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>otherpeer<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Battle_Attack_Event<span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> targetUser<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> targetUser<span class="token punctuation">.</span>Hp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

            <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token class-name">PSPeer</span> peer<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//位置</span>
                <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> points <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//将要移动的客户端</span>
                <span class="token class-name">UserModel</span> user <span class="token operator">=</span> DALManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userDAL<span class="token punctuation">.</span><span class="token function">GetUserModel</span><span class="token punctuation">(</span>peer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                user<span class="token punctuation">.</span>Points <span class="token operator">=</span> points<span class="token punctuation">;</span>
                <span class="token comment">//通知所有客户端移动</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">PSPeer</span> otherpeer <span class="token keyword">in</span> DALManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>userDAL<span class="token punctuation">.</span><span class="token function">GetuserPeers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                PSTest<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"通知所有客户端移动"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    SendMessage<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>otherpeer<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Battle_Move_Event<span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> </li></ul> 
<h3><a id="_363"></a>客户端</h3> 
<ul><li> <p>逻辑类</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BattleManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ManagerBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        MessageCenter<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">UserControll</span> user<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">UserControll</span> User<span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                user <span class="token operator">=</span> UserControll<span class="token punctuation">.</span>idUserDic<span class="token punctuation">[</span>UserControll<span class="token punctuation">.</span>ID<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Ray</span> ray <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenPointToRay</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">RaycastHit</span> hit<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> res <span class="token operator">=</span> Physics<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> <span class="token keyword">out</span> hit<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>tag <span class="token operator">==</span><span class="token string">"Ground"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//Debug.Log("点击到地面");</span>
                    <span class="token comment">//移动到hit.point</span>
                    PhotonManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Battle_Move<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> hit<span class="token punctuation">.</span>point<span class="token punctuation">.</span>x<span class="token punctuation">,</span>hit<span class="token punctuation">.</span>point<span class="token punctuation">.</span>y<span class="token punctuation">,</span> hit<span class="token punctuation">.</span>point<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//Debug.Log(hit.point);</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>tag <span class="token operator">==</span><span class="token string">"User"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//Debug.Log("点击到玩家");</span>
                    <span class="token comment">//获取距离</span>
                    <span class="token class-name"><span class="token keyword">float</span></span> dis <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> User<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>dis <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> dis <span class="token operator">&lt;</span> <span class="token number">3f</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">UserControll</span> targetUser <span class="token operator">=</span> hit<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserControll<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        PhotonManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Battle_Attack<span class="token punctuation">,</span> targetUser<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReceiveMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">ReceiveMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>message<span class="token punctuation">.</span>Content<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span> Command<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Battle_Move_Event<span class="token punctuation">:</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"移动"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">Move</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> MessageType<span class="token punctuation">.</span>Battle_Attack_Event<span class="token punctuation">:</span>
                <span class="token function">Attack</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//移动</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//移动的用户id</span>
        <span class="token class-name"><span class="token keyword">int</span></span> userid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//移动的位置</span>
        <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> points <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        UserControll<span class="token punctuation">.</span>idUserDic<span class="token punctuation">[</span> userid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Move</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">byte</span></span> <span class="token function">GetMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> MessageType<span class="token punctuation">.</span>Type_Battle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> objs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//攻击者id被攻击者id 当前剩余血量</span>
        <span class="token class-name"><span class="token keyword">int</span></span> userid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> targetid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> hp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>objs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//攻击</span>
        UserControll<span class="token punctuation">.</span>idUserDic<span class="token punctuation">[</span>userid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Attack</span><span class="token punctuation">(</span>targetid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hp <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            UserControll<span class="token punctuation">.</span>idUserDic<span class="token punctuation">[</span>targetid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> </li><li> <p>角色绑定的类</p> <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>AI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserControll</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//保存了所有角色的集合</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> UserControll<span class="token punctuation">&gt;</span></span> idUserDic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> UserControll<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//当前客户端角色的id</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> ID<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Animator</span> ani<span class="token punctuation">;</span>
    <span class="token comment">//private NavMeshAgent agent;</span>
    <span class="token comment">//目标位置</span>
    <span class="token keyword">private</span> <span class="token class-name">Vector3</span> targetPos<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isRun<span class="token punctuation">;</span>
    <span class="token comment">//角色id</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isDie<span class="token punctuation">;</span>

    <span class="token comment">// Start is called before the first frame update</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        ani <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//agent = GetComponent&lt;NavMeshAgent&gt;();</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Update is called once per frame</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isDie<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRun<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//计算距离</span>
            <span class="token class-name"><span class="token keyword">float</span></span> dis <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span> position<span class="token punctuation">,</span>targetPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dis <span class="token operator">&gt;</span> <span class="token number">0.5f</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//移动</span>
                <span class="token comment">//agent.isStopped = false;</span>
               <span class="token comment">// ani.SetBoo1( "IsRun", true);</span>
                <span class="token comment">//agent.SetDestination(targetPos);</span>
                transform<span class="token punctuation">.</span>position <span class="token operator">=</span> targetPos<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//停止</span>
                <span class="token comment">//agent.isStopped = true;</span>
               <span class="token comment">// ani.setBoo1("IsRun", false);</span>
                isRun <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span> target<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        targetPos <span class="token operator">=</span> target<span class="token punctuation">;</span>
        isRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> targetId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得要攻击的角色</span>
        <span class="token class-name">UserControll</span> targetUser <span class="token operator">=</span> idUserDic<span class="token punctuation">[</span>targetId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>targetUser<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ani.SetTrigger( "Attack");</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//ani. setTrigger("Die");</span>
        isDie <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>AI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserControll</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//保存了所有角色的集合</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> UserControll<span class="token punctuation">&gt;</span></span> idUserDic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> UserControll<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//当前客户端角色的id</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> ID<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Animator</span> ani<span class="token punctuation">;</span>
    <span class="token comment">//private NavMeshAgent agent;</span>
    <span class="token comment">//目标位置</span>
    <span class="token keyword">private</span> <span class="token class-name">Vector3</span> targetPos<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isRun<span class="token punctuation">;</span>
    <span class="token comment">//角色id</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isDie<span class="token punctuation">;</span>

    <span class="token comment">// Start is called before the first frame update</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        ani <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//agent = GetComponent&lt;NavMeshAgent&gt;();</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Update is called once per frame</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isDie<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRun<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//计算距离</span>
            <span class="token class-name"><span class="token keyword">float</span></span> dis <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span> position<span class="token punctuation">,</span>targetPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dis <span class="token operator">&gt;</span> <span class="token number">0.5f</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//移动</span>
                <span class="token comment">//agent.isStopped = false;</span>
               <span class="token comment">// ani.SetBoo1( "IsRun", true);</span>
                <span class="token comment">//agent.SetDestination(targetPos);</span>
                transform<span class="token punctuation">.</span>position <span class="token operator">=</span> targetPos<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//停止</span>
                <span class="token comment">//agent.isStopped = true;</span>
               <span class="token comment">// ani.setBoo1("IsRun", false);</span>
                isRun <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span> target<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        targetPos <span class="token operator">=</span> target<span class="token punctuation">;</span>
        isRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> targetId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得要攻击的角色</span>
        <span class="token class-name">UserControll</span> targetUser <span class="token operator">=</span> idUserDic<span class="token punctuation">[</span>targetId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>targetUser<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ani.SetTrigger( "Attack");</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//ani. setTrigger("Die");</span>
        isDie <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1566a4f21a9b1682b76495429c95d1c4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CNN之图像识别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95a3b61b1bd3f8b5cc8f44dc237c9ce2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">批量拉取git仓库的shell脚本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>