<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue3 企业级优雅实战 - 组件库框架 - 10 实现组件库 cli - 下 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue3 企业级优雅实战 - 组件库框架 - 10 实现组件库 cli - 下" />
<meta property="og:description" content="上文创建了一堆 utils、component-info，并实现了新组件模块相关目录和文件的创建。本文继续实现后面的内容。
1 组件样式文件并导入 在 src/service 目录中创建 init-scss.ts 文件，该文件导出 initScss 函数。
由于 .vue 类型的组件的样式就直接写在了 style 中，故首先判断组件类型是否是 tsx，tsx 类型的组件才进行这一步的操作：
在 scss/components/ 目录下创建组件的 scss 文件 _xxx.module.scss；在 scss/components/index.scss 中导入 _xxx.module.scss。 1.1 init-scss.ts 代码实现如下：
import { ComponentInfo } from &#39;../domain/component-info&#39; import path from &#39;path&#39; import { scssTemplate } from &#39;../util/template-utils&#39; import fs from &#39;fs&#39; import { g } from &#39;../util/log-utils&#39; const updateComponentScssIndex = (scssRootPath: string, lineName: string) =&gt; { const indexScssPath = path.resolve(scssRootPath, &#39;components/index." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1d1d106f2b6785bfde2c539f11526c2a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-08T15:51:03+08:00" />
<meta property="article:modified_time" content="2023-02-08T15:51:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue3 企业级优雅实战 - 组件库框架 - 10 实现组件库 cli - 下</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>上文创建了一堆 utils、component-info，并实现了新组件模块相关目录和文件的创建。本文继续实现后面的内容。</p> 
<h3><a id="1__3"></a>1 组件样式文件并导入</h3> 
<p>在 <em>src/service</em> 目录中创建 <em>init-scss.ts</em> 文件，该文件导出 <em>initScss</em> 函数。</p> 
<p>由于 .vue 类型的组件的样式就直接写在了 <em>style</em> 中，故首先判断组件类型是否是 <em>tsx</em>，tsx 类型的组件才进行这一步的操作：</p> 
<ol><li>在 <em>scss/components/</em> 目录下创建组件的 scss 文件 <em>_xxx.module.scss</em>；</li><li>在 <em>scss/components/index.scss</em> 中导入 <em>_xxx.module.scss</em>。</li></ol> 
<h4><a id="11_initscssts_12"></a>1.1 init-scss.ts</h4> 
<p>代码实现如下：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ComponentInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../domain/component-info'</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> scssTemplate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/template-utils'</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> g <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/log-utils'</span>

<span class="token keyword">const</span> <span class="token function-variable function">updateComponentScssIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span>scssRootPath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lineName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> indexScssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>scssRootPath<span class="token punctuation">,</span> <span class="token string">'components/index.scss'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>indexScssPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> newContent <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@use "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.module";\n</span><span class="token template-punctuation string">`</span></span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>indexScssPath<span class="token punctuation">,</span> newContent<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 创建组件库 scss 文件，并在 scss/components/index.scss 中引入该文件
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initScss</span> <span class="token operator">=</span> <span class="token punctuation">(</span>componentInfo<span class="token operator">:</span> ComponentInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// tsx 类型需要创建scss文件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>componentInfo<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tsx'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> parentPath<span class="token punctuation">,</span> lineName<span class="token punctuation">,</span> lineNameWithPrefix <span class="token punctuation">}</span> <span class="token operator">=</span> componentInfo
    
    <span class="token comment">// scss 根目录（packages/scss）</span>
    <span class="token keyword">const</span> scssRootPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">,</span> <span class="token string">'scss'</span><span class="token punctuation">)</span>

    <span class="token comment">// 1. 创建组件的 scss 文件</span>
    <span class="token keyword">const</span> componentScssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>scssRootPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">components/_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.module.scss</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>componentScssPath<span class="token punctuation">,</span> <span class="token function">scssTemplate</span><span class="token punctuation">(</span>lineNameWithPrefix<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 2. 在组件库 scss 入口文件 （packages/components/index.scss）引入上面创建的文件</span>
    <span class="token function">updateComponentScssIndex</span><span class="token punctuation">(</span>scssRootPath<span class="token punctuation">,</span> lineName<span class="token punctuation">)</span>

    <span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'component scss init success'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="12_templateutilsts_55"></a>1.2 template-utils.ts</h4> 
<p>上面的 <em>init-scss.ts</em> 在创建 scss 文件时调用了 <em>template-utils.ts</em> 中的 <em>scssTemplate</em> 函数获取模板。故需要在 <em>util/template-utils.ts</em> 中添加该函数：</p> 
<pre><code class="prism language-typescript"><span class="token comment">/**
 * scss 文件模板
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> scssTemplate <span class="token operator">=</span> <span class="token punctuation">(</span>lineNameWithPrefix<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import "../tools";
@import "../acss/mp";
@import "../base/var.module";

@include b('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineNameWithPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">') {
}
</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2__74"></a>2 添加到组件库入口模块</h3> 
<p>新组件和样式创建完成，接下来便是将新组件模块安装到组件库入口模块的依赖中。在 <em>src/service</em> 目录中创建 <em>update-component-lib.ts</em> 文件，该文件导出函数 <em>updateComponentLib</em>。该函数需要完成两件事：</p> 
<ol><li>在组件库入口模块中安装新组件为依赖；</li><li>更新组件库入口模块的 index.ts 文件，引入新组件。</li></ol> 
<p>代码实现如下：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ComponentInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../domain/component-info'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> execCmd <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/cmd-utils'</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Config <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../config'</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> g <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/log-utils'</span>

<span class="token keyword">const</span> <span class="token function-variable function">updateComponentLibIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span>libPath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> componentInfo<span class="token operator">:</span> ComponentInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> indexPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>libPath<span class="token punctuation">,</span> <span class="token string">'index.ts'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>indexPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> index1 <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'// import component end'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> index2 <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'] // components'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index1<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>upCamelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>nameWithLib<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index1<span class="token punctuation">,</span> index2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,\n  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>upCamelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index2<span class="token punctuation">)</span>

  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>indexPath<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 更新组件库入口
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateComponentLib</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>componentInfo<span class="token operator">:</span> ComponentInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 组件库入口的路径</span>
  <span class="token keyword">const</span> libPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">.</span>parentPath<span class="token punctuation">,</span> Config<span class="token punctuation">.</span><span class="token constant">COMPONENT_LIB_NAME</span><span class="token punctuation">)</span>

  <span class="token comment">// 1. 添加新创建的组件到依赖中</span>
  <span class="token keyword">await</span> <span class="token function">execCmd</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cd </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>libPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &amp;&amp; pnpm install </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>nameWithLib<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  <span class="token comment">// 2. 更新入口 index.ts</span>
  <span class="token function">updateComponentLibIndex</span><span class="token punctuation">(</span>libPath<span class="token punctuation">,</span> componentInfo<span class="token punctuation">)</span>

  <span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'component library update success'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3__126"></a>3 组件库文档相关文件</h3> 
<h4><a id="31_initdocts_128"></a>3.1 init-doc.ts</h4> 
<p>在 <em>src/service</em> 目录中创建 <em>init-doc.ts</em> 文件，该文件导出函数 <em>initDoc</em>。该函数需要完成三件事：</p> 
<ol><li>创建组件的 MarkDown 文档；</li><li>创建组件 MD 文档中的 demo；</li><li>更新组件库文档菜单。</li></ol> 
<p>代码实现如下：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ComponentInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../domain/component-info'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> g <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/log-utils'</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> demoTemplate<span class="token punctuation">,</span> mdTemplate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/template-utils'</span>

<span class="token comment">/**
 * 创建组件文档、demo及更新菜单
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initDoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span>componentInfo<span class="token operator">:</span> ComponentInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 组件库文档根路径</span>
  <span class="token keyword">const</span> docRootPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">.</span>parentPath<span class="token punctuation">,</span> <span class="token string">'../docs'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> lineName<span class="token punctuation">,</span> lineNameWithPrefix<span class="token punctuation">,</span> upCamelName<span class="token punctuation">,</span> zhName <span class="token punctuation">}</span> <span class="token operator">=</span> componentInfo

  <span class="token comment">// 1. 创建组件的 MD 文档</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>docRootPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">components/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.md</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mdTemplate</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 2. 创建组件文档中的 Demo</span>
  fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>docRootPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">demos/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>docRootPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">demos/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-1.vue</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">demoTemplate</span><span class="token punctuation">(</span>lineNameWithPrefix<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 3. 更新组件库文档菜单</span>
  <span class="token keyword">const</span> menuPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>docRootPath<span class="token punctuation">,</span> <span class="token string">'components.ts'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>menuPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'] // end'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,\n  { text: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>upCamelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>zhName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', link: '/components/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' }\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>menuPath<span class="token punctuation">,</span> result<span class="token punctuation">)</span>

  <span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'component document init success'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="32_templateutilsts_173"></a>3.2 template-utils.ts</h4> 
<p>上面的 init-doc.ts 调用了 <em>mdTemplate</em> 和 <em>demoTemplate</em> 两个函数，在 <em>template-utils.ts</em> 中添加这两个函数：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">mdTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>componentInfo<span class="token operator">:</span> ComponentInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
# </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>upCamelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>zhName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

## 基本使用

&lt;preview path="../demos/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-1.vue" title="基本使用" description=" "&gt;&lt;/preview&gt;

## 组件 API

### Attributes 属性

| 参数 | 说明 | 类型 | 可选值 | 默认值 |
|  ----  | ----  | ----  | ----  | ----  |
|  |  |  |  | |

### Methods 方法

| 方法名 | 说明 | 参数 | 返回值 |
|  ----  | ----  | ----  | ----  |
|  |  |  |  |

### Events 事件

| 事件名 | 说明 | 参数 | 返回值 |
|  ----  | ----  | ----  | ----  |
|  |  |  |  |

### Slots 插槽

| 插槽名 | 说明 | 参数 |
|  ----  | ----  | ----  |
|  |  |  |
</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">demoTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>lineNameWithPrefix<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;template&gt;
  &lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineNameWithPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineNameWithPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
&lt;/script&gt;

&lt;style scoped lang="scss"&gt;
&lt;/style&gt;
</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这两个函数的模板可以自己去定义。</p> 
<h3><a id="4_createcomponentts_230"></a>4 create-component.ts</h3> 
<p>四个步骤都已实现，最后需要在 <em>src/command/create-component.ts</em> 文件中的 <em>createNewComponent</em> 函数中完成上面四个 service 的调用。</p> 
<h4><a id="41_import_234"></a>4.1 import</h4> 
<p>导入四个service及使用到的其他函数：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ComponentInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../domain/component-info'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> closeLoading<span class="token punctuation">,</span> showLoading <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/loading-utils'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> g<span class="token punctuation">,</span> r <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/log-utils'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> initComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../service/init-component'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> initScss <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../service/init-scss'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> updateComponentLib <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../service/update-component-lib'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> initDoc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../service/init-doc'</span>
</code></pre> 
<h4><a id="42_createNewComponent_248"></a>4.2 createNewComponent</h4> 
<p>该函数首先根据用户输入，构造 ComponentInfo 对象，然后依次调用引入的四个 service，完成组件创建的全部流程：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">createNewComponent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>componentName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> componentType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> description<span class="token punctuation">,</span> componentType<span class="token punctuation">)</span>
  <span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token string">'Generating, please wait...'</span><span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 构造 ComponentInfo 对象</span>
    <span class="token keyword">const</span> componentInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentInfo</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> description<span class="token punctuation">,</span> componentType<span class="token punctuation">)</span>
    <span class="token comment">// 2. 创建组件目录及文件</span>
    <span class="token keyword">await</span> <span class="token function">initComponent</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span>
    <span class="token comment">// 3. 创建样式</span>
    <span class="token keyword">await</span> <span class="token function">initScss</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span>
    <span class="token comment">// 4. 更新组件库入口</span>
    <span class="token keyword">await</span> <span class="token function">updateComponentLib</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span>
    <span class="token comment">// 5. 组件库文档</span>
    <span class="token function">initDoc</span><span class="token punctuation">(</span>componentInfo<span class="token punctuation">)</span>

    <span class="token function">closeLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">g</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">component [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>lineName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>componentInfo<span class="token punctuation">.</span>zhName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] created done!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">closeLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">r</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>组件库 cli 就这样完成了。运行 <em>pnpm run gen</em>，依次输入组件名、组件中文名，选择组件类型，便自动完成组件的创建、注册、文档的创建了。优雅哥花了大量篇幅介绍 cli 的开发，不仅仅可以在这里使用，通过本案例的实现，希望大家可以将这种方式移植到其他地方，如从 github 拉取代码模板、自动化 CI/CD 等。</p> 
<p>下一篇文章将介绍组件库的打包构建和发布。</p> 
<p>感谢阅读本文，如果本文给了你一点点帮助或者启发，还请三连支持一下，了解更多内容工薇号“程序员优雅哥”。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f9ff4d73221b6f3d49f0d5261e39f17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【MYSQL】binlog安全清理的两种方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bb1971f66a1c4f4b2d1503fc598811b9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Angular基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>