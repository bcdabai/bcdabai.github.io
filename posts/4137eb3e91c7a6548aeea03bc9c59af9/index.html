<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android&#43;圆角屏幕方法,android屏幕圆角实现方法的示例代码 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android&#43;圆角屏幕方法,android屏幕圆角实现方法的示例代码" />
<meta property="og:description" content="现在很多全面屏手机的屏幕四角做成圆的，其圆润的感觉给人带来别样的视觉体验。先来一张我大锤子镇楼(不是广告呀，锤子没给钱)，大家来直观感受一下圆角的魅力。
锤子.jpg
当然这种是硬件上实现的，我怀疑也是方的显示屏，然后做了个圆角遮蔽。那对于我们这些脸方的手机，就不能笑嘻嘻的圆一回吗？答案是肯定的，no picture say ...
(应该能看出来我用的是神马手机吧)
圆角实现：
那我们就应该思考了，软件层面怎样实现这种效果呢。相信很多朋友立马会想到――使用悬浮窗。
实现原理：利用WindowManager将我们的圆角加到屏幕的四个角，圆角颜色设置为黑色，形成视觉圆角屏幕。
1.自定义圆角view
很显然，首先我们需要实现一个形状如下图的圆角，怎么做呢？用path(不熟悉的小伙伴可以百度一下哈)，这里我们以左上角为例实现这个圆角。
圆角
// top left
case Gravity.TOP | Gravity.LEFT:
path.moveTo(0.0f,0.0f);
path.lineTo(0.0f,(float) h);
path.arcTo(new RectF(0.0f,0.0f,((float) w) * 2.0f,((float) h) * 2.0f),180.0f,90.0f,true);
path.lineTo((float) w,0.0f);
path.close();
break;
为了能让用户自定义圆角颜色，大小，透明度，各个角是否显示，我在里面加了对应的控制变量，当用户设置的时候更新view就可以了。
public void setCornerSize(int size){
this.cornerSize = size;
requestLayout();
invalidate();
}
是不是很简单，这样一个圆角view就实现了。
2.显示圆角
现在我们就要在屏幕的四个角将圆角加上去了。这里使用了android的悬浮窗技术。即用windowmanager将我们的圆角加到顶层的window上，遮蔽其他部分。windowmanager在添加view的时候需要设置一个WindowManager.LayoutParams。下面我们初始化这个Params：
// window manager
manager = (WindowManager) this.getApplicationContext()
.getSystemService(Context.WINDOW_SERVICE);
params = new WindowManager.LayoutParams();
/*
系统提示类型:7.0以前可以直接用TOAST的类型，不用申请权限，直接添加
7.0以后不行了,需要申请SYSTEM_ALERT_WINDOW权限，window type最好
设置为ERROR 或者 PHONE
*/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4137eb3e91c7a6548aeea03bc9c59af9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-25T21:26:07+08:00" />
<meta property="article:modified_time" content="2021-05-25T21:26:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android&#43;圆角屏幕方法,android屏幕圆角实现方法的示例代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>现在很多全面屏手机的屏幕四角做成圆的，其圆润的感觉给人带来别样的视觉体验。先来一张我大锤子镇楼(不是广告呀，锤子没给钱)，大家来直观感受一下圆角的魅力。</p> 
 <p align="center"><img src="https://images2.imgbox.com/d1/20/pWRN7WtG_o.png" alt="12aa508a3320c0f0a9062e223ae78211.png"></p> 
 <p>锤子.jpg</p> 
 <p>当然这种是硬件上实现的，我怀疑也是方的显示屏，然后做了个圆角遮蔽。那对于我们这些脸方的手机，就不能笑嘻嘻的圆一回吗？答案是肯定的，no picture say ...</p> 
 <p align="center"><img src="https://images2.imgbox.com/0b/80/luxtTYaP_o.png" alt="85bd367b6614b5d21c69d479af8d9eb4.png"></p> 
 <p>(应该能看出来我用的是神马手机吧)</p> 
 <p>圆角实现：</p> 
 <p>那我们就应该思考了，软件层面怎样实现这种效果呢。相信很多朋友立马会想到――使用悬浮窗。</p> 
 <p>实现原理：利用WindowManager将我们的圆角加到屏幕的四个角，圆角颜色设置为黑色，形成视觉圆角屏幕。</p> 
 <p>1.自定义圆角view</p> 
 <p>很显然，首先我们需要实现一个形状如下图的圆角，怎么做呢？用path(不熟悉的小伙伴可以百度一下哈)，这里我们以左上角为例实现这个圆角。</p> 
 <p align="center"><img src="https://images2.imgbox.com/09/51/agUkgmx9_o.png" alt="573e9c01dfa148a65f66f21d79933da8.png"></p> 
 <p>圆角</p> 
 <p>// top left</p> 
 <p>case Gravity.TOP | Gravity.LEFT:</p> 
 <p>path.moveTo(0.0f,0.0f);</p> 
 <p>path.lineTo(0.0f,(float) h);</p> 
 <p>path.arcTo(new RectF(0.0f,0.0f,((float) w) * 2.0f,((float) h) * 2.0f),180.0f,90.0f,true);</p> 
 <p>path.lineTo((float) w,0.0f);</p> 
 <p>path.close();</p> 
 <p>break;</p> 
 <p>为了能让用户自定义圆角颜色，大小，透明度，各个角是否显示，我在里面加了对应的控制变量，当用户设置的时候更新view就可以了。</p> 
 <p>public void setCornerSize(int size){<!-- --></p> 
 <p>this.cornerSize = size;</p> 
 <p>requestLayout();</p> 
 <p>invalidate();</p> 
 <p>}</p> 
 <p>是不是很简单，这样一个圆角view就实现了。</p> 
 <p>2.显示圆角</p> 
 <p>现在我们就要在屏幕的四个角将圆角加上去了。这里使用了android的悬浮窗技术。即用windowmanager将我们的圆角加到顶层的window上，遮蔽其他部分。windowmanager在添加view的时候需要设置一个WindowManager.LayoutParams。下面我们初始化这个Params：</p> 
 <p>// window manager</p> 
 <p>manager = (WindowManager) this.getApplicationContext()</p> 
 <p>.getSystemService(Context.WINDOW_SERVICE);</p> 
 <p>params = new WindowManager.LayoutParams();</p> 
 <p>/*</p> 
 <p>系统提示类型:7.0以前可以直接用TOAST的类型，不用申请权限，直接添加</p> 
 <p>7.0以后不行了,需要申请SYSTEM_ALERT_WINDOW权限，window type最好</p> 
 <p>设置为ERROR 或者 PHONE</p> 
 <p>*/</p> 
 <p>if (Utilities.isCanUseToastType()) {<!-- --></p> 
 <p>params.type = WindowManager.LayoutParams.TYPE_TOAST;</p> 
 <p>} else {<!-- --></p> 
 <p>params.type = WindowManager.LayoutParams.TYPE_SYSTEM_ERROR;</p> 
 <p>}</p> 
 <p>params.format = 1;</p> 
 <p>params.flags = WindowManager.LayoutParams.FLAG_FULLSCREEN // 全屏</p> 
 <p>| WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS // 覆盖到status bar</p> 
 <p>| WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION // 覆盖到导航栏</p> 
 <p>// 以下属性设置加载我们圆角window 不抢焦点,不拦截事件</p> 
 <p>| WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE</p> 
 <p>| WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL</p> 
 <p>| WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;</p> 
 <p>params.alpha = 1.0f;</p> 
 <p>params.x = 0;</p> 
 <p>params.y = 0;</p> 
 <p>// 设置 大小为全屏</p> 
 <p>params.width = ViewUtil.getScreenSize(this).x;</p> 
 <p>params.height = ViewUtil.getScreenSize(this).y;</p> 
 <p>注释写的比较详细，不明白的自行百度哈。</p> 
 <p>接着我们需要把圆角加到屏幕上：</p> 
 <p>public void addCornerViewByPosition(String position){<!-- --></p> 
 <p>boolean enable = true;</p> 
 <p>switch (position) {<!-- --></p> 
 <p>case LEFT_TOP:</p> 
 <p>enable = leftTopEnable;</p> 
 <p>params.gravity = Gravity.TOP | Gravity.LEFT;</p> 
 <p>break;</p> 
 <p>case RIGHT_TOP:</p> 
 <p>enable = rightTopEnable;</p> 
 <p>params.gravity = Gravity.TOP | Gravity.RIGHT;</p> 
 <p>break;</p> 
 <p>case LEFT_BOTTOM:</p> 
 <p>enable = leftBottomEnable;</p> 
 <p>params.gravity = Gravity.BOTTOM | Gravity.LEFT;</p> 
 <p>break;</p> 
 <p>case RIGHT_BOTTOM:</p> 
 <p>enable = rightBottomEnable;</p> 
 <p>params.gravity = Gravity.BOTTOM | Gravity.RIGHT;</p> 
 <p>break;</p> 
 <p>}</p> 
 <p>CornerView corner = buildCorner(enable,params.gravity);</p> 
 <p>if(!corners.containsValue(corner)) {<!-- --></p> 
 <p>corners.put(position,corner);</p> 
 <p>manager.addView(corner,params);</p> 
 <p>}</p> 
 <p>}</p> 
 <p>以上代码是根据各个位置是否能显示将我们的corner加到屏幕上，其中buildCorner是根据用户自定义的设置创建cornerview</p> 
 <p>private CornerView buildCorner(boolean enable,int position){<!-- --></p> 
 <p>CornerView corner = new CornerView(this);</p> 
 <p>corner.setColor(currentColor);</p> 
 <p>corner.setCornerOpacity(currentOpacity);</p> 
 <p>corner.setCornerSize(currentCornerSize);</p> 
 <p>corner.setLocation(position);</p> 
 <p>if(enable){<!-- --></p> 
 <p>corner.show();</p> 
 <p>} else {<!-- --></p> 
 <p>corner.hide();</p> 
 <p>}</p> 
 <p>return corner;</p> 
 <p>}</p> 
 <p>至此，我们的圆角就显示到屏幕上了(鼓掌)。</p> 
 <p>圆角保活：</p> 
 <p>首先我们为了让圆角能够长期存在于屏幕上，我把其操作(添加，删除，自定义)放到了一个service，但是Service也很容易被杀，这里我们就有必要保活了。</p> 
 <p>android中的保活方案有很多，比如使用Service startForeground，双进程，一个像素的Activity，接收系统广播启动服务，使用JobSheduler，定时器等等。</p> 
 <p>这里我使用了第一种方案，即当用户选则保活时，使用Service startForeground发出一条通知，最大程度的保证我们的Service不被杀死。代码比较简单，就不贴了。</p> 
 <p>一些小细节：</p> 
 <p>我在测试的时候发现，强制停止应用服务后，再次进入应用，当我们想去掉圆角时却始终去不掉，这个问题在一些商业应用上也存在。这个是因为我我们之前添加的view没有移除掉，重新开启应用的时候又加了一层。所以我们要在destroy之前把我们的view移除掉，然后功能就正常了。</p> 
 <p>再者就是权限的申请问题，我们在加悬浮窗的时候要检测是否有权限，代码如下</p> 
 <p>public static boolean checkFloatWindowPermission(Context context) {<!-- --></p> 
 <p>final int version = Build.VERSION.SDK_INT;</p> 
 <p>if (version &gt;= 19) {<!-- --></p> 
 <p>return checkOp(context,24); //OP_SYSTEM_ALERT_WINDOW = 24;</p> 
 <p>}</p> 
 <p>return true;</p> 
 <p>}</p> 
 <p>@TargetApi(Build.VERSION_CODES.KITKAT)</p> 
 <p>private static boolean checkOp(Context context,int op) {<!-- --></p> 
 <p>final int version = Build.VERSION.SDK_INT;</p> 
 <p>if (version &gt;= 19) {<!-- --></p> 
 <p>AppOpsManager manager = (AppOpsManager) context.getSystemService(Context.APP_OPS_SERVICE);</p> 
 <p>try {<!-- --></p> 
 <p>Class clazz = AppOpsManager.class;</p> 
 <p>Method method = clazz.getDeclaredMethod("checkOp",int.class,String.class);</p> 
 <p>return AppOpsManager.MODE_ALLOWED == (int)method.invoke(manager,op,Binder.getCallingUid(),context.getPackageName());</p> 
 <p>} catch (Exception e) {<!-- --></p> 
 <p>Log.e("",Log.getStackTraceString(e));</p> 
 <p>}</p> 
 <p>} else {<!-- --></p> 
 <p>Log.e("Utilities","Below API 19 cannot invoke!");</p> 
 <p>}</p> 
 <p>return false;</p> 
 <p>}</p> 
 <p>这里用到了反射，也感谢网上大神的解决方案。</p> 
 <p>小结：</p> 
 <p>第一次写博客，比较生疏，很错误的地方希望大家谅解和指正(我已经准备好迎接大家的口水了)。</p> 
 <p>希望一起学习，一起进步</p> 
 <p>最后附上app截图，庆祝一下</p> 
 <p align="center"><img src="https://images2.imgbox.com/0f/2e/bDoqKrid_o.png" alt="1d665ee0ae8e39274e3010bde3e9feed.png"></p> 
 <p>以上就是本文的全部内容，希望对大家的学习有所帮助，也希望大家多多支持编程小技巧。</p> 
 <p>总结</p> 
 <p>如果觉得编程之家网站内容还不错，欢迎将编程之家网站推荐给程序员好友。</p> 
 <p>本图文内容来源于网友网络收集整理提供，作为学习参考使用，版权属于原作者。</p> 
 <p align="center"></p> 
 <p>小编个人微信号 jb51ccc</p> 
 <p>喜欢与人分享编程技术与工作经验，欢迎加入编程之家官方交流群！</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27fb078aa1f70b07348c66f478514ade/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【GAMES201学习笔记】物质点法入门</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/37c28eda5ea5a032649d23cad436f5cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">查看Keras版本号</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>