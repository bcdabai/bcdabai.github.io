<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一个易用的消息订阅发布系统-Pubsub.js - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一个易用的消息订阅发布系统-Pubsub.js" />
<meta property="og:description" content="本文作者系360奇舞团前端开发工程师
简介 随着软件架构越来越复杂，如何有效地解决各个模块之间的通信问题变得尤为重要。一种常见的解决方案就是采用消息订阅发布机制。在这种模式下，每个模块只需要关注自己要发送或接收的消息，而不必关心其他模块的内部实现。
今天要介绍的 pubsub.js 就是一个非常实用的消息订阅发布库。它具有使用简单、性能高效、支持多平台等优点，可以很好地满足各种需求。
基本使用 首先，让我们来看看如何使用 pubsub.js 进行消息的发送与接收。首先，我们需要引入库：
import PubSub from &#34;pubsub-js&#34;; 然后，在需要发送消息的地方，我们可以使用 publish 方法：
// 发布一个名为 &#39;testEvent&#39; 的事件，并带上数据 let data = { name: &#39;John Doe&#39; }; PubSub.publish(&#39;testEvent&#39;, data); 而在需要接收消息的地方，我们需要先使用 subscribe 方法进行订阅：
// 订阅名为 &#39;testEvent&#39; 的事件 let subscription = PubSub.subscribe(&#39;testEvent&#39;, function(message, data) { console.log(&#34;Received data:&#34;, data.name); }); // 当不再需要接收消息时，记得取消订阅 PubSub.unsubscribe(subscription); 以上就是一个简单的消息订阅发布流程。
一些使用场景 比如：状态。
// 可以外部变更组件内状态 pubsub.publish(STATE_UPDATED_EVENT, newState); // 在其他组件中订阅该事件以获得新状态 pubsub.subscribe(STATE_UPDATED_EVENT, (newState) =&gt; { this.setState(newState); }); 事务处理。
// 当异步操作完成时发布事件 function subscribeTransaction() { var subscription = PubSub." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4bc26d8e18f5b0bf5e7baffab75f16e5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-07T18:01:21+08:00" />
<meta property="article:modified_time" content="2023-11-07T18:01:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一个易用的消息订阅发布系统-Pubsub.js</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <blockquote> 
  <p>本文作者系360奇舞团前端开发工程师</p> 
 </blockquote> 
 <h3>简介</h3> 
 <p>随着软件架构越来越复杂，如何有效地解决各个模块之间的通信问题变得尤为重要。一种常见的解决方案就是采用消息订阅发布机制。在这种模式下，每个模块只需要关注自己要发送或接收的消息，而不必关心其他模块的内部实现。</p> 
 <p>今天要介绍的 pubsub.js 就是一个非常实用的消息订阅发布库。它具有使用简单、性能高效、支持多平台等优点，可以很好地满足各种需求。</p> 
 <h3>基本使用</h3> 
 <p>首先，让我们来看看如何使用 pubsub.js 进行消息的发送与接收。首先，我们需要引入库：</p> 
 <pre class="has"><code class="language-go">import PubSub from "pubsub-js";</code></pre> 
 <p>然后，在需要发送消息的地方，我们可以使用 publish 方法：</p> 
 <pre class="has"><code class="language-go">// 发布一个名为 'testEvent' 的事件，并带上数据
let data = { name: 'John Doe' };
PubSub.publish('testEvent', data);</code></pre> 
 <p>而在需要接收消息的地方，我们需要先使用 subscribe 方法进行订阅：</p> 
 <pre class="has"><code class="language-go">// 订阅名为 'testEvent' 的事件
let subscription = PubSub.subscribe('testEvent', function(message, data) {
    console.log("Received data:", data.name);
});
// 当不再需要接收消息时，记得取消订阅
PubSub.unsubscribe(subscription);</code></pre> 
 <p>以上就是一个简单的消息订阅发布流程。</p> 
 <h3>一些使用场景</h3> 
 <p>比如：状态。</p> 
 <pre class="has"><code class="language-go">// 可以外部变更组件内状态
pubsub.publish(STATE_UPDATED_EVENT, newState);

// 在其他组件中订阅该事件以获得新状态
pubsub.subscribe(STATE_UPDATED_EVENT, (newState) =&gt; {
    this.setState(newState);
});</code></pre> 
 <p>事务处理。</p> 
 <pre class="has"><code class="language-go">// 当异步操作完成时发布事件

function subscribeTransaction() {
  var subscription = PubSub.subscribe("transaction_start", async function(message, data) {
    try {
      // 处理事务...
      await someAsyncOperation();
      await someOtherAsyncOperation();
      resolve(true);
    } catch(e) {
      reject(e);
    }
  });</code></pre> 
 <p>可以设置主题。</p> 
 <pre class="has"><code class="language-go">import React, { useState, useEffect } from 'react';
import PubSub from 'pubsub-js';

function App() {
  const [theme, setTheme] = useState('default');

  const handleThemeChange = (nextTheme) =&gt; {
    setTheme(nextTheme);
  };

  useEffect(() =&gt; {
    const subscription = PubSub.subscribe('theme-change', handleThemeChange);
    return () =&gt; {
      PubSub.unsubscribe(subscription);
    };
  }, []);

  return (
    &lt;div&gt;
      &lt;h1&gt;Current theme: {theme}&lt;/h1&gt;

      {/* 主题切换按钮 */}
      &lt;button onClick={() =&gt; PubSub.publish('theme-change', 'dark')}&gt;
        Switch to dark mode
      &lt;/button&gt;

      {/* 这个组件会随着主题改变而变 */}
      &lt;ThemedFunctionComponent theme={theme} /&gt;
    &lt;/div&gt;
  );
}

function ThemedFunctionComponent({ theme }) {
  useEffect(() =&gt; {
    console.log('Theme changed to:', theme);
  }, [theme]);

  return (
    &lt;div style={<!-- -->{ color: theme === 'dark' ? '#fff' : '#000' }}&gt;
      This is the themed component.
    &lt;/div&gt;
  );
}

export default App;</code></pre> 
 <p>React 的小伙伴还可以封装一个自定义 Hooks 来更简洁的使用它。</p> 
 <h3>订阅完之后，别忘了取消订阅。</h3> 
 <p>取消特定订阅</p> 
 <pre class="has"><code class="language-go">var mySubscriber = function (msg, data) {
    console.log(msg, data);
};

var token = PubSub.subscribe('MY TOPIC', mySubscriber);

PubSub.unsubscribe(token);</code></pre> 
 <p>取消某个函数的所有订阅</p> 
 <pre class="has"><code class="language-go">var mySubscriber = function(msg, data) {
    console.log(msg, data);
};

PubSub.unsubscribe(mySubscriber);</code></pre> 
 <p>取消某个主题的订阅</p> 
 <pre class="has"><code class="language-go">PubSub.subscribe('a', myFunc1);
PubSub.subscribe('a.b', myFunc2);
PubSub.subscribe('a.b.c', myFunc3);

PubSub.unsubscribe('a.b');
// 'a.b'和'a.b.c' 会被取消订阅
// ` a `的通知仍然会被发布</code></pre> 
 <p>清楚所有订阅</p> 
 <pre class="has"><code class="language-go">PubSub.clearAllSubscriptions();
// 所有订阅都被删除</code></pre> 
 <p>订阅计数</p> 
 <pre class="has"><code class="language-go">PubSub.countSubscriptions('token');</code></pre> 
 <p>PubSub.js 通过发布/订阅模式实现实现组件间的解耦合，可以减少代码的复杂度和维护成本，使代码设计更人性化。</p> 
 <p style="text-align:center;">- END -</p> 
 <h3>关于奇舞团</h3> 
 <p style="text-align:left;">奇舞团是 360 集团最大的大前端团队，代表集团参与 W3C 和 ECMA 会员（TC39）工作。奇舞团非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。<br></p> 
 <p style="text-align:left;"><img src="https://images2.imgbox.com/a7/be/ccZqBus4_o.png" alt="4ca2a4e380825bc53e633a8f664f411c.png"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/998f3a69469e23bb1969a4f229238769/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用IDEA创建Vue3通过Vite实现工程化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b10766b084ef3eb3fb6d96e0a6c486d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ArcGIS Pro设置谷歌影像（无水印）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>