<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache poi HSSFWorkbook 操作excel教程2（从excel文件导入数据） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache poi HSSFWorkbook 操作excel教程2（从excel文件导入数据）" />
<meta property="og:description" content="转载自：https://www.hangge.com/blog/cache/detail_2722.html
叙述 在之前的文章中演示了如何实现数据的导出，本文接着演示如何实现数据导入。对前端而言，数据导入就是文件上传，对后端这边则是获取上传的文件进行解析，并把解析出来的数据保存到数据库中。
解决方案 1，添加依赖
编辑项目的 pom.xml 文件，添加 poi 相关依赖：
&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt; &lt;/dependency&gt; 2，创建数据模型
这里我们定义一个 User 模型对象，后面将会把解析出来的数据转成这个数据模型集合。
@Getter @Setter @AllArgsConstructor @NoArgsConstructor @ToString public class User { private int id; private String name; private String gender; private Date birthday; private String workID; } 3，创建导入工具类
为方便使用，这里封装一个用于导入数据的工具类。里面主要工作是获取上传文件的流，然后进行解析，最终将得到的数据集合返回。
public class PoiUtils { // 从excel文件中导入数据 public static List&lt;User&gt; importUser2List(MultipartFile file) { List&lt;User&gt; users = new ArrayList&lt;&gt;(); try { // 根据上传文件的流获取一个 HSSFWorkbook 对象 HSSFWorkbook workbook = new HSSFWorkbook(new POIFSFileSystem(file." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a8cebade87ae9ec4c46a2542b640315c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-18T11:04:23+08:00" />
<meta property="article:modified_time" content="2020-08-18T11:04:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache poi HSSFWorkbook 操作excel教程2（从excel文件导入数据）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>转载自：<a href="https://www.hangge.com/blog/cache/detail_2722.html" rel="nofollow">https://www.hangge.com/blog/cache/detail_2722.html</a></p> 
<h3>叙述</h3> 
<p>    在之前的文章中演示了如何实现数据的导出，本文接着演示如何实现数据导入。对前端而言，数据导入就是文件上传，对后端这边则是获取上传的文件进行解析，并把解析出来的数据保存到数据库中。</p> 
<h4>解决方案</h4> 
<p><span style="color:#f33b45;"><strong>1，添加依赖</strong></span></p> 
<p>编辑项目的 pom.xml 文件，添加 poi 相关依赖：</p> 
<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
    &lt;artifactId&gt;poi&lt;/artifactId&gt;
    &lt;version&gt;3.17&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><span style="color:#f33b45;"><strong>2，创建数据模型</strong></span></p> 
<p>这里我们定义一个 User 模型对象，后面将会把解析出来的数据转成这个数据模型集合。</p> 
<pre><code class="language-java">@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@ToString
public class User {
    private int id;
    private String name;
    private String gender;
    private Date birthday;
    private String workID;
}</code></pre> 
<p><span style="color:#f33b45;"><strong>3，创建导入工具类</strong></span></p> 
<p>为方便使用，这里封装一个用于导入数据的工具类。里面主要工作是获取上传文件的流，然后进行解析，最终将得到的数据集合返回。</p> 
<pre><code class="language-java">public class PoiUtils {
    // 从excel文件中导入数据
    public static List&lt;User&gt; importUser2List(MultipartFile file) {
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        try {
            // 根据上传文件的流获取一个 HSSFWorkbook 对象
            HSSFWorkbook workbook =
                    new HSSFWorkbook(new POIFSFileSystem(file.getInputStream()));
            // 获取 workbook 中表单的个数
            int numberOfSheets = workbook.getNumberOfSheets();
            // 遍历表单
            for (int i = 0; i &lt; numberOfSheets; i++) {
                HSSFSheet sheet = workbook.getSheetAt(i);
                // 对于每个表单，先获取行数
                int physicalNumberOfRows = sheet.getPhysicalNumberOfRows();
                User user;
                for (int j = 0; j &lt; physicalNumberOfRows; j++) {
                    if (j == 0) {
                        continue;//标题行跳过
                    }
                    HSSFRow row = sheet.getRow(j);
                    if (row == null) {
                        continue;//没数据跳过
                    }
                    // 如果该行数据正常，则获取改行的单元格个数进行遍历
                    int physicalNumberOfCells = row.getPhysicalNumberOfCells();
                    user = new User();
                    for (int k = 0; k &lt; physicalNumberOfCells; k++) {
                        HSSFCell cell = row.getCell(k);
                        switch (cell.getCellTypeEnum()) {
                            // 处理格式为普通文本的单元格数据
                            case STRING: {
                                String cellValue = cell.getStringCellValue();
                                if (cellValue == null) {
                                    cellValue = "";
                                }
                                switch (k) {
                                    case 1:
                                        user.setName(cellValue);
                                        break;
                                    case 2:
                                        user.setWorkID(cellValue);
                                        break;
                                    case 3:
                                        user.setGender(cellValue);
                                        break;
                                }
                            }
                            break;
                            // 处理其他格式的单元格数据
                            default: {
                                switch (k) {
                                    case 0:
                                        user.setId((int)cell.getNumericCellValue());
                                        break;
                                    case 4:
                                        user.setBirthday(cell.getDateCellValue());
                                        break;
                                }
                            }
                            break;
                        }
                    }
                    users.add(user);
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        // 将遍历得到的数据集合返回
        return users;
    }
}</code></pre> 
<p><span style="color:#f33b45;"><strong>4，数据导入接口</strong></span></p> 
<p>我们创建一个 Controller 调用这个工具类来获取 excel 文件中的人员数据：</p> 
<pre><code class="language-java">@RestController
public class HelloController {
    @PostMapping("/importUser")
    public String importUser(MultipartFile file) {
        List&lt;User&gt; users = PoiUtils.importUser2List(file);
        System.out.println("--- 共有" + users.size() + "条数据 ---");
        for (User user: users) {
            System.out.println(user);
        }
        return "导出成功！";
    }
}</code></pre> 
<p><span style="color:#f33b45;"><strong>5，前端实现</strong></span></p> 
<p>前端主要是一个 Excel 表格的上传，这里直接采用 Element 的文件上传控件，具体代码如下：</p> 
<pre><code>（1）el-upload 组件属性介绍：
accept：表示接收的上传文件类型
action：表示上传接口
:on-success：表示上传成功时的回调
:on-error：表示上传失败时的回调
:disabled：表示当 fileUploadBtnText 属性的值为“正在导入”时禁用上传控件
:before-upload：表示文件上传前的回调
（2）el-button 组件属性介绍：
:loading="fileUploadBtnText=='正在导入'" 表示当 fileUploadBtnText 文本为“正在导入”时，显示一个 Loading 加载</code></pre> 
<pre><code class="language-html">&lt;template&gt;
  &lt;div&gt;
      &lt;el-upload
        :show-file-list="false"
        accept="application/vnd.ms-excel"
        action="/importUser"
        :on-success="fileUploadSuccess"
        :on-error="fileUploadError" :disabled="fileUploadBtnText=='正在导入'"
        :before-upload="beforeFileUpload" style="display: inline"&gt;
        &lt;el-button size="mini" type="success" :loading="fileUploadBtnText=='正在导入'"&gt;
          &lt;i class="fa fa-lg fa-level-up" style="margin-right: 5px"&gt;&lt;/i&gt;{<!-- -->{fileUploadBtnText}}
        &lt;/el-button&gt;
      &lt;/el-upload&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  export default{
    data(){
      return {
        fileUploadBtnText: '导入数据', // 按钮文字
      }
    },
    methods: {
      // 文件上传成功的回调
      fileUploadSuccess(response, file, fileList) {
        if (response) {
          this.$message({type: 'success', message: response});
        }
        this.fileUploadBtnText = '导入数据';
      },
      // 文件上传失败的回调
      fileUploadError(err, file, fileList) {
        this.$message({type: 'error', message: "导入失败!"});
        this.fileUploadBtnText = '导入数据';
      },
      // 文件上传前的回调
      beforeFileUpload(file) {
        this.fileUploadBtnText = '正在导入';
      }
    }
  }
&lt;/script&gt;
&lt;style&gt;
&lt;/style&gt;</code></pre> 
<p><span style="color:#f33b45;"><strong>6，运行测试 </strong></span></p> 
<p>（1）准备一个用于上传的 excel 文件，内容如下：</p> 
<p><img alt="" height="491" src="https://images2.imgbox.com/25/16/G4cA5kjV_o.png" width="565"></p> 
<p>（2）点击“导入数据”按钮选择 excel 文件后会自动上传：</p> 
<p><img alt="" height="208" src="https://images2.imgbox.com/9d/a3/zltiTwED_o.png" width="569"></p> 
<p>（3）后端接收到文件后解析并打印出相关信息：</p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/43/ac/xrUe1IbN_o.png" width="672"></p> 
<p>（4）同时前端也会显示成功信息：</p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/c4/c2/e6iuMT74_o.png" width="563"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/41215aea304659c9a1acd990de0552fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux下ps命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a141aee93557b86f01f9e7f9add8d06b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Numpy将字符串数组转换为浮点数数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>