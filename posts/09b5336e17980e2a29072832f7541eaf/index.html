<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>线上服务器CPU100%了，该怎么排查、定位、解决？ - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="线上服务器CPU100%了，该怎么排查、定位、解决？" />
<meta property="og:description" content="你好，我是洋一，一个持续向上生长的互联网人。
再三考虑，准备出一些 Java面试系列 的文章，希望对你有帮助。
问你 线上生产服务器 CPU 100%了，你是如何排查、定位以及解决问题？
作甚 面试官问你，主要是想看看你有没有处理高负载的线上问题。考察对于此类问题，是否有一套自己的打法，是否你能熟练运用一些命令去排查、定位和解决问题的能力。对于开发来讲，是基本功，是需要主动掌握的。
解决 一般 CPU 100%，基本都是代码死循环造成的。
排查的核心思路是 找到对应服务器，定位是哪个进程的哪个线程中的哪些代码引发的问题，可以简单介绍当时的异常代码示例。
1. 使用 top -c 命令定位当前进程 top -c，可以显示当前进程的运行列表，然后输入 P，按照 CPU 的使用率进行排序。
如上图仅为演示效果，这样我们就能很清晰地看到哪个进程的 CPU 负载最大。比如 显示进程 PID 为 2479501 的 Java进程负载消耗最大。
2. 定位负载最大进程对应的线程 使用命令 top -Hp 2479501 找到这个进程对应的线程，然后输入 P ，按照 CPU 的使用率进行排序。
如上图所示，我们可以看到 2479508 耗费 CPU 最大。
3. 定位哪段代码导致 CPU 过高 因线程 PID 2479508 是十进制，我们需要将其转换为 十六进制 ，为什么要将十进制转换为十六进制 ？因为计算机需要二进制，十六是二的四次方，而十进制不是二的整数次幂，十六进制方便我们可读。比如，其转换结果是：25d594
接着，我们需要使用 jstack 打印进程的堆栈信息，再通过 grep 查看对应线程相关的东西。
jstack 2479501 | grep ‘25d594’ -C5 --color 这个时候就可以打印出代码，基本上帮助我们定位到出问题的位置，可以看到是哪个类中的哪个方法导致此次 CPU 100% 的原因了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/09b5336e17980e2a29072832f7541eaf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-22T23:36:39+08:00" />
<meta property="article:modified_time" content="2022-03-22T23:36:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">线上服务器CPU100%了，该怎么排查、定位、解决？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>你好，我是洋一，一个持续向上生长的互联网人。</p> 
<p>再三考虑，准备出一些 <strong>Java面试系列</strong> 的文章，希望对你有帮助。</p> 
<h3><a id="_6"></a>问你</h3> 
<p>线上生产服务器 CPU 100%了，你是如何排查、定位以及解决问题？</p> 
<h3><a id="_12"></a>作甚</h3> 
<p>面试官问你，主要是想看看你有没有处理高负载的线上问题。考察对于此类问题，是否有一套自己的打法，是否你能熟练运用一些命令去排查、定位和解决问题的能力。对于开发来讲，是基本功，是需要主动掌握的。</p> 
<h3><a id="_18"></a>解决</h3> 
<p>一般 CPU 100%，基本都是代码死循环造成的。</p> 
<p>排查的核心思路是 找到对应服务器，定位是哪个进程的哪个线程中的哪些代码引发的问题，可以简单介绍当时的异常代码示例。</p> 
<h4><a id="1__top_c__24"></a>1. 使用 top -c 命令定位当前进程</h4> 
<p><strong>top -c</strong>，可以显示当前进程的运行列表，然后输入 <strong>P</strong>，按照 CPU 的使用率进行排序。</p> 
<p><img src="https://images2.imgbox.com/50/26/q4dNESeD_o.png" alt="演示，非异常情况"></p> 
<p>如上图仅为演示效果，这样我们就能很清晰地看到哪个进程的 CPU 负载最大。比如 显示进程 <strong>PID</strong> 为 <strong>2479501</strong> 的 Java进程负载消耗最大。</p> 
<h4><a id="2__32"></a>2. 定位负载最大进程对应的线程</h4> 
<p>使用命令 <strong>top -Hp 2479501</strong> 找到这个进程对应的线程，然后输入 <strong>P</strong> ，按照 CPU 的使用率进行排序。</p> 
<p><img src="https://images2.imgbox.com/16/45/EiYLwMn1_o.png" alt=""></p> 
<p>如上图所示，我们可以看到 <strong>2479508</strong> 耗费 CPU 最大。</p> 
<h4><a id="3__CPU__42"></a>3. 定位哪段代码导致 CPU 过高</h4> 
<p>因线程 PID <strong>2479508</strong> 是十进制，我们需要将其转换为 十六进制 ，为什么要将十进制转换为十六进制 ？因为计算机需要二进制，十六是二的四次方，而十进制不是二的整数次幂，十六进制方便我们可读。比如，其转换结果是：<strong>25d594</strong></p> 
<p>接着，我们需要使用 <strong>jstack</strong> 打印进程的堆栈信息，再通过 <strong>grep</strong> 查看对应线程相关的东西。</p> 
<pre><code class="prism language-bash">jstack <span class="token number">2479501</span> <span class="token operator">|</span> <span class="token function">grep</span> ‘25d594’ -C5 --color
</code></pre> 
<p>这个时候就可以打印出代码，基本上帮助我们定位到出问题的位置，可以看到是哪个类中的哪个方法导致此次 CPU 100% 的原因了。</p> 
<p>好了，今天就到这里！<strong>如上，希望对你有价值，感谢各位的点赞、收藏和评论，我们下期见！</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/809cce74d777ee4e58e2aeafcac3b5fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">leetcode-剑指offer</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4c27386c80c11990ee4cc4a092e2e96a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">kafka日志存储【日志索引】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>