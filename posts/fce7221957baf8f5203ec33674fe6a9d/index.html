<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2022山东省赛赛题Linux答案解析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2022山东省赛赛题Linux答案解析" />
<meta property="og:description" content="2022山东省赛赛题 服务器配置及应用项目 三、linux 服务配置 (一)dns 服务 1.所有 linux 主机启用防火墙，防火墙区域为 public，在防火墙中放行对
应服务端口。
2.利用 chrony，配置 linux1 为其他 linux 主机提供 NTP 服务。
3.所有linux主机root用户使用完全合格域名免密码ssh登录到其他linux
主机。
4.利用 bind 配置 linux1 为主 dns 服务器，linux2 为备用 dns 服务器；为
所有 linux 主机提供冗余 dns 正反向解析服务。
yum -y install chronyd #chrony时间服务 #编辑服务端chrony的配置文件 vim /etc/chrony.conf server 10.10.21.101 iburst #line 3 allow 10.10.21.0/24 #line 23 local stratum 10 #line 26 systemctl start chronyd #放行防火墙 firewall-cmd --add-service=ntp #复制一份客户端配置文件 cp -p /etc/chrony.conf / #编辑客户端chrony的配置文件 vim /chrony." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fce7221957baf8f5203ec33674fe6a9d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T11:36:17+08:00" />
<meta property="article:modified_time" content="2023-03-28T11:36:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2022山东省赛赛题Linux答案解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="2022_0"></a>2022山东省赛赛题</h2> 
<h3><a id="_2"></a><strong>服务器配置及应用项目</strong></h3> 
<h4><a id="linux__6"></a><strong>三、linux 服务配置</strong></h4> 
<h5><a id="dns__8"></a><strong>(一)dns 服务</strong></h5> 
<p>1.所有 linux 主机启用防火墙，防火墙区域为 public，在防火墙中放行对</p> 
<p>应服务端口。</p> 
<p>2.利用 chrony，配置 linux1 为其他 linux 主机提供 NTP 服务。</p> 
<p>3.所有linux主机root用户使用完全合格域名免密码ssh登录到其他linux</p> 
<p>主机。</p> 
<p>4.利用 bind 配置 linux1 为主 dns 服务器，linux2 为备用 dns 服务器；为</p> 
<p>所有 linux 主机提供冗余 dns 正反向解析服务。</p> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> chronyd
<span class="token comment">#chrony时间服务</span>
<span class="token comment">#编辑服务端chrony的配置文件</span>
<span class="token function">vim</span> /etc/chrony.conf
server <span class="token number">10.10</span>.21.101 iburst <span class="token comment">#line 3 </span>
allow <span class="token number">10.10</span>.21.0/24 <span class="token comment">#line 23 </span>
<span class="token builtin class-name">local</span> stratum <span class="token number">10</span> <span class="token comment">#line 26</span>
systemctl start chronyd
<span class="token comment">#放行防火墙</span>
firewall-cmd --add-service<span class="token operator">=</span>ntp
<span class="token comment">#复制一份客户端配置文件</span>
<span class="token function">cp</span> -p /etc/chrony.conf /
 <span class="token comment">#编辑客户端chrony的配置文件</span>
<span class="token function">vim</span> /chrony.conf
server <span class="token number">10.10</span>.21.101 iburst <span class="token comment">#line 3 </span>
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span> <span class="token keyword">do</span> <span class="token function">scp</span> chrony.conf <span class="token number">10.10</span>.21.10<span class="token variable">$i</span>:/etc/chrony.conf <span class="token punctuation">;</span> <span class="token function">ssh</span> <span class="token number">10.10</span>.21.10<span class="token variable">$i</span> <span class="token string">"systemctl restart chronyd&amp;&amp;chronyc sources -v"</span><span class="token punctuation">;</span><span class="token keyword">done</span> 
<span class="token comment">#免密登录</span>
ssh-keygen  
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span> <span class="token punctuation">;</span><span class="token keyword">do</span>  ssh-copy-id <span class="token number">10.10</span>.21.10<span class="token variable">$i</span> <span class="token punctuation">;</span><span class="token keyword">done</span>
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token keyword">do</span> <span class="token function">scp</span> -r /root/.ssh/* <span class="token number">10.10</span>.21.10<span class="token variable">$i</span>:/root/.ssh/ <span class="token punctuation">;</span><span class="token keyword">done</span>
yum -y <span class="token function">install</span> <span class="token builtin class-name">bind</span> bind-utils
<span class="token comment">#linux1主DNS</span>
<span class="token comment">#编辑bind主配置文件 </span>
<span class="token function">vim</span> /etc/named.conf 
listen-on port <span class="token number">53</span> <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">#line 11 </span>
allow-query <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">#line 19 </span>

<span class="token comment">#编辑bind区域配置文件 </span>
<span class="token function">vim</span> /etc/named.rfc1912.zones 
<span class="token comment">#正向解析 </span>
zone <span class="token string">"skills.com"</span> IN <span class="token punctuation">{<!-- --></span> 
	<span class="token builtin class-name">type</span> master<span class="token punctuation">;</span> 
	<span class="token function">file</span> <span class="token string">"skills.com.zone"</span><span class="token punctuation">;</span> 
	allow-transfer <span class="token punctuation">{<!-- --></span> <span class="token number">10.10</span>.21.102<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">#反向解析 </span>
zone <span class="token string">"21.10.10.in-addr.arpa"</span> IN <span class="token punctuation">{<!-- --></span> 
	<span class="token builtin class-name">type</span> master<span class="token punctuation">;</span> 
	<span class="token function">file</span> <span class="token string">"21.10.10.arpa"</span><span class="token punctuation">;</span> 
	allow-transfer <span class="token punctuation">{<!-- --></span> <span class="token number">10.10</span>.21.102<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token builtin class-name">cd</span> /var/named/ 
<span class="token function">cp</span> -p named.localhost skills.com.zone 
<span class="token function">cp</span> -p named.loopback <span class="token number">120.10</span>.10.arpa
<span class="token comment">#编辑skills.com正向区域配置文件 </span>
<span class="token function">vim</span> skills.com.zone 
<span class="token variable">$TTL</span> 1D 
@       IN SOA  @ rname.invalid. <span class="token punctuation">(</span>
                                        <span class="token number">0</span>       <span class="token punctuation">;</span> serial
                                        1D      <span class="token punctuation">;</span> refresh
                                        1H      <span class="token punctuation">;</span> retry
                                        1W      <span class="token punctuation">;</span> expire
                                        3H <span class="token punctuation">)</span>    <span class="token punctuation">;</span> minimum
        NS      @
        A       <span class="token number">127.0</span>.0.1
linux1  A       <span class="token number">10.10</span>.21.101
linux2  A       <span class="token number">10.10</span>.21.102
linux3  A       <span class="token number">10.10</span>.21.103
linux4  A       <span class="token number">10.10</span>.21.104
linux5  A       <span class="token number">10.10</span>.21.105
linux6  A       <span class="token number">10.10</span>.21.106
linux7  A       <span class="token number">10.10</span>.21.107
*       A       <span class="token number">10.10</span>.21.101
tomcat  A       <span class="token number">10.10</span>.21.102
www     A       <span class="token number">10.10</span>.21.101
<span class="token comment">#编辑skills.com反向区域配置文件</span>
<span class="token function">vim</span> <span class="token number">120.10</span>.10.arpa
<span class="token variable">$TTL</span> 1D
@       IN SOA  @ rname.invalid. <span class="token punctuation">(</span>
                                        <span class="token number">0</span>       <span class="token punctuation">;</span> serial
                                        1D      <span class="token punctuation">;</span> refresh
                                        1H      <span class="token punctuation">;</span> retry
                                        1W      <span class="token punctuation">;</span> expire
                                        3H <span class="token punctuation">)</span>    <span class="token punctuation">;</span> minimum
        NS      @
        A       <span class="token number">127.0</span>.0.1
<span class="token number">101</span>     PTR     linux1.skills.com.
<span class="token number">102</span>     PTR     linux2.skills.com.
<span class="token number">103</span>     PTR     linux3.skills.com.
<span class="token number">104</span>     PTR     linux4.skills.com.
<span class="token number">105</span>     PTR     linux5.skills.com.
<span class="token number">106</span>     PTR     linux6.skills.com.
<span class="token number">107</span>     PTR     linux7.skills.com.
<span class="token comment">#防火墙放行服务 </span>
firewall-cmd --add-service<span class="token operator">=</span>dns
<span class="token comment">#更改权限</span>
<span class="token function">chown</span> -R root.named skills.com.zone 
<span class="token function">chown</span> -R root.named <span class="token number">120.10</span>.10.arpa 
<span class="token comment">#启动bind服务 </span>
systemctl <span class="token builtin class-name">enable</span> --now named
Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.
<span class="token comment">#备用DNS</span>
<span class="token comment">#编辑bind主配置文件 </span>
<span class="token function">vim</span> /etc/named.conf 
listen-on port <span class="token number">53</span> <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">#line 11 </span>
allow-query <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">#line 19 </span>

<span class="token comment">#编辑bind区域配置文件 </span>
<span class="token function">vim</span> /etc/named.rfc1912.zones 
<span class="token comment">#正向解析 </span>
zone <span class="token string">"skills.com"</span> IN <span class="token punctuation">{<!-- --></span> 
	<span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span> 
	<span class="token function">file</span> <span class="token string">"slaves/skills.com.zone"</span><span class="token punctuation">;</span> 
	masters <span class="token punctuation">{<!-- --></span> <span class="token number">10.10</span>.21.101<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	masterfile-format text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">#反向解析 </span>
zone <span class="token string">"120.10.10.in-addr.arpa"</span> IN <span class="token punctuation">{<!-- --></span> 
	<span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span> 
	<span class="token function">file</span> <span class="token string">"slaves/120.10.10.arpa"</span><span class="token punctuation">;</span> 
	masters <span class="token punctuation">{<!-- --></span> <span class="token number">10.10</span>.21.101<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	masterfile-format text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
firewall-cmd --add-service<span class="token operator">=</span>dns
<span class="token comment">#启动bind服务 </span>
systemctl restart named 
systemctl <span class="token builtin class-name">enable</span> named 
Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.
<span class="token comment">#查看skills.com.zone和120.10.10.arpa，有没有过来</span>
ll /var/named/slaves/
</code></pre> 
<p>5.在 linux1 上安装 ansible，作为 ansible 的控制节点。linux2-linux7 作</p> 
<p>为 ansible 的受控节点。在 linux1 编写/root/skills.yaml 剧本，实现在 linux1</p> 
<p>创建文件/root/ansible.txt，并将该文件复制到所有受控节点的/root 目录。</p> 
<pre><code class="prism language-shell"><span class="token comment">#从包中安装ansible,注意Rocky8.6可以直接安装ansible</span>
yum -y <span class="token function">install</span> ansible*
<span class="token comment">#自定义主机清单</span>
<span class="token function">vim</span> /etc/ansible/hosts
<span class="token punctuation">[</span>server<span class="token punctuation">]</span>
<span class="token number">10.10</span>.21.101
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token number">10.10</span>.21.10<span class="token punctuation">[</span><span class="token number">2</span>:7<span class="token punctuation">]</span>
<span class="token comment">#编写playbook脚本</span>
<span class="token function">vim</span> /root/skills.yaml
---
- hosts: server
  gather_facts: no
  tasks:
    - name: <span class="token function">touch</span> <span class="token function">file</span>
      file: <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">"/root/ansible.txt"</span> <span class="token assign-left variable">state</span><span class="token operator">=</span>touch 
- hosts: client
  gather_facts: no
  tasks:
    - name: copy <span class="token function">file</span>
      copy: <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"/root/ansible.txt"</span> <span class="token assign-left variable">dest</span><span class="token operator">=</span><span class="token string">"/root/"</span>
      
<span class="token comment">#运行playbook</span>
ansible-playbook skills.yaml 
</code></pre> 
<p>6.配置 linux1 为 CA 服务器,为 linux 主机颁发证书。证书颁发机构有效期</p> 
<p>10 年，公用名为 linux1.skills.com。申请并颁发一张供 linux 服务器使用的证</p> 
<p>书，证书信息：有效期=5 年，公用名=skills.com，国家=CN，省=Beijing，城市</p> 
<p>=Beijing，组织=skills，组织单位=system，使用者可选名称=*.skills.com 和</p> 
<p>skills.com。将证书 skills.crt 和私钥 skills.key 复制到需要证书的 linux 服</p> 
<p>务器/etc/ssl 目录。浏览器访问 https 网站时，不出现证书警告信息。</p> 
<pre><code class="prism language-shell"><span class="token comment">#创建根私钥</span>
openssl genrsa -out /etc/pki/CA/private/cakey.pem
<span class="token builtin class-name">cd</span> /etc/pki/CA/
<span class="token comment">#创建根证书</span>
openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days <span class="token number">3650</span> <span class="token comment">#天数</span>
CN Beijing Beijing Skills System skills.com
<span class="token comment">#在CA文件夹下创建 数据库索引文件 和 当前证书序列号</span>
<span class="token function">touch</span> index.txt
<span class="token builtin class-name">echo</span> 01 <span class="token operator">&gt;</span> serial
<span class="token comment">#导出安装用证书ca.pfx</span>
openssl pkcs12 -export -inkey private/cakey.pem -in cacert.pem -out  certs/ca.pfx
<span class="token comment">#证书</span>
openssl genrsa -out  skills.key
openssl req -new -key skills.key -out skills.csr
<span class="token assign-left variable">CN</span><span class="token operator">=</span>*.skills.com,OU<span class="token operator">=</span>System,O<span class="token operator">=</span>Skills,L<span class="token operator">=</span>Beijing,S<span class="token operator">=</span>Beijing,C<span class="token operator">=</span>CN
openssl ca -in skills.csr -out  skills.crt  -days <span class="token number">1825</span> 
openssl pkcs12 -export -inkey skills.key -in skills.crt -out  skills.pfx
</code></pre> 
<h5><a id="apache__215"></a><strong>(二)apache 服务</strong></h5> 
<p>1.用apache2配置linux2为web服务器，使用skills.com或any.skills.com</p> 
<p>（any 代表任意网址前缀，用 linux1.skills.com 和 web.skills.com 测试）访</p> 
<p>问时，自动跳转到 www.skills.com。禁止使用 IP 地址访问，默认首页文档</p> 
<p>/var/www/html/index.html 的内容为"apache"。</p> 
<p>2.把/etc/ssl/skills.crt 证书文件和/etc/ssl/skills.key 私钥文件转换</p> 
<p>成含有证书和私钥的/etc/ssl/skills.pfx 文件；然后把/etc/ssl/skills.pfx</p> 
<p>转换为含有证书和私钥的/etc/ssl/skills.pem文件，再从/etc/ssl/skills.pem</p> 
<p>文件中提取证书和私钥分别到/etc/ssl/apache.crt 和/etc/ssl/apache.key。</p> 
<p>3.客户端访问 apache 服务时，必需有 ssl 证书。</p> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> httpd mod_ssl
<span class="token builtin class-name">cd</span> /etc/ssl
<span class="token comment">#配置文件在/usr/config文件夹下新建一个server.conf文件，内容如下</span>
<span class="token function">vim</span> /etc/ssl/server.conf
<span class="token punctuation">[</span>req<span class="token punctuation">]</span>
<span class="token assign-left variable">req_extensions</span><span class="token operator">=</span>req_ext

<span class="token punctuation">[</span>req_ext<span class="token punctuation">]</span>
subjectAltName <span class="token operator">=</span>@alt_names

<span class="token punctuation">[</span>alt_names<span class="token punctuation">]</span>
DNS.1 <span class="token operator">=</span> www.skills.com   <span class="token comment"># 自行根据待配置证书的域名修改</span>
DNS.2 <span class="token operator">=</span> *.skill.com <span class="token comment"># 自行根据待配置证书的域名修改，该项用来认证二级域名，若无需验证去掉即可</span>

openssl genrsa -out  skills.key
openssl req -new -key skills.key -out skills.csr
<span class="token assign-left variable">CN</span><span class="token operator">=</span>www.skills.com,OU<span class="token operator">=</span>System,O<span class="token operator">=</span>Skills,L<span class="token operator">=</span>Beijing,S<span class="token operator">=</span>Beijing,C<span class="token operator">=</span>CN
<span class="token comment">#把这个成功申请</span>
openssl ca -in skills.csr -out  skills.crt  -days <span class="token number">1825</span> -extensions req_ext -extfile server.conf
<span class="token comment"># 默 认 首 页 文 档/var/www/html/index.html 的内容为"Apache"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Apache"</span> <span class="token operator">&gt;</span> /var/www/html/index.html
<span class="token comment">#apache配置</span>
<span class="token operator">&lt;</span>virtualhost *:8<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
 servername www.skills.com
 serveralias *.skills.com
 RewriteEngine on
 RewriteRule ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> https://www.skills.com/ <span class="token punctuation">[</span>L<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>/virtualhost<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>virtualhost *:44<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
 servername www.skills.com
 serveralias *.skills.com
 DocumentRoot <span class="token string">"/var/www/html"</span>
 SSLEngine on
 SSLCertificateFile /etc/ssl/skills.crt
 SSLCertificateKeyFile /etc/ssl/skills.key
 SSLCACertificateFile /etc/ssl/cacert.pem
<span class="token operator">&lt;</span>/virtualhost<span class="token operator">&gt;</span> 
<span class="token comment">#隐藏apache版本信息 </span>
ServerTokens Prod
ServerSignature off
<span class="token comment">#客户端访问，要有三个证书key,crt,pem</span>
<span class="token function">curl</span> -k --cert skills.crt --key skills.key --cacert /etc/pki/CA/cacert.pem  https://www.skills.com

<span class="token comment">#把证书转换为带私钥的pfx格式 </span>
openssl pkcs12 -export -inkey skills.key -in skills.crt -out  skills.pfx 
<span class="token comment">#将pfx转换为pem格式证书，pfx是包含私钥的，不加密私钥</span>
openssl pkcs12 -in skills.pfx -nodes -out skills.pem 
<span class="token comment">#从 PFX 格式文件中提取私钥格式文件 (.key)</span>
openssl pkcs12 -in skills.pfx -nocerts -nodes -out skills.key	
</code></pre> 
<h5><a id="ftp__287"></a><strong>(三)ftp 服务</strong></h5> 
<p>1.用 vsftpd 配置 linux3 为 ftp 服务器，新建本地用户 test，能上传下载。</p> 
<p>2.配置 ftp 虚拟用户认证模式，虚拟用户 ftp1 和 ftp2 映射用户为 ftp；</p> 
<p>ftp1 能上传下载,但禁止上传后缀名为.docx 的文件；ftp2 仅能下载。</p> 
<p>3.所有用户登录 ftp 后的目录为/var/ftp/vdir/&lt;$USERNAME&gt;，</p> 
<p>$USERNAME 表示用户名。</p> 
<p>4.使用 ftp 命令在本机验证。</p> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> vsftpd
<span class="token comment">#创建用户</span>
<span class="token function">useradd</span> -d /var/ftp/pub <span class="token builtin class-name">test</span> 
<span class="token builtin class-name">echo</span> <span class="token string">"xiaoming:Pass-1234"</span><span class="token operator">|</span>chpasswd
<span class="token comment">#vsftpd配置文件</span>
<span class="token function">vim</span> /etc/vsftpd/vsftpd.conf
<span class="token assign-left variable">listen</span><span class="token operator">=</span>YES
<span class="token assign-left variable">listen_ipv6</span><span class="token operator">=</span>NO
<span class="token assign-left variable">guest_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">guest_username</span><span class="token operator">=</span>ftp
<span class="token assign-left variable">user_config_dir</span><span class="token operator">=</span>/etc/vsftpd/ftp
<span class="token assign-left variable">allow_writeable_chroot</span><span class="token operator">=</span>YES
<span class="token comment">#添加虚拟用户配置</span>
<span class="token function">vim</span> /etc/vsftpd/ftpuser.list
ftp1
Pass-1234
ftp2
Pass-1234
<span class="token comment">#哈希加密</span>
db_load -T -t <span class="token builtin class-name">hash</span> -f /etc/vsftpd/ftpuser.list /etc/vsftpd/ftpuser.db
<span class="token function">find</span> / -name pam_userdb.so
<span class="token comment">#PAM验证</span>
<span class="token function">vim</span> /etc/pam.d/vsftpd
auth    required        /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/ftpuser
account required        /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/ftpuser
<span class="token comment">#配置用户文件</span>
<span class="token function">mkdir</span> /etc/vsftpd/ftp
<span class="token function">vim</span> /etc/vsftpd/ftp/ftp1
<span class="token assign-left variable">local_root</span><span class="token operator">=</span>/var/ftp/vdir/ftp1
<span class="token assign-left variable">anon_world_readable_only</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_upload_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_mkdir_write_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_other_write_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">deny_file</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span>*.docx<span class="token punctuation">}</span>
<span class="token function">vim</span> /etc/vsftpd/ftp/ftp2
<span class="token assign-left variable">local_root</span><span class="token operator">=</span>/var/ftp/vdir/ftp2
<span class="token assign-left variable">anon_world_readable_only</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_upload_enable</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_mkdir_write_enable</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_other_write_enable</span><span class="token operator">=</span>NO
:wq
<span class="token function">mkdir</span> /var/ftp/vdir/<span class="token punctuation">{<!-- --></span>ftp1,ftp2<span class="token punctuation">}</span> -p
<span class="token function">chown</span> ftp:ftp /var/ftp/vdir/* -R
<span class="token function">chmod</span> <span class="token number">777</span> /var/ftp/pub
systemctl restart vsftpd
firewall-cmd --add-service<span class="token operator">=</span>ftp
<span class="token comment">#测试</span>
<span class="token function">ftp</span> <span class="token number">10.10</span>.21.101
</code></pre> 
<h5><a id="nfs__352"></a><strong>(四)nfs 服务</strong></h5> 
<p>1.配置 linux2 为 kdc 服务器，负责 linux3 和 linux4 的验证。</p> 
<p>2.在 linux3 上，创建用户，用户名为 xiao，uid=2000，gid=2000，家目</p> 
<p>录为/home/xiaodir。</p> 
<p>3.配置 linux3 为 nfs 服务器，目录/srv/sharenfs 的共享要求为：linux</p> 
<p>服务器所在网络用户有读写权限，所有用户映射为 xiao，kdc 加密方式为 krb5p。</p> 
<p>4.配置 linux4 为 nfs 客户端， 利用 autofs 按需挂载 linux3 上的</p> 
<p>/srv/sharenfs 到/sharenfs 目录，挂载成功后在该目录创建 test 目录。</p> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> krb5* nfs-utils
<span class="token comment">#修改KDC主配置文件 </span>
<span class="token function">vim</span> /etc/krb5.conf
<span class="token number">18</span>行和21行后面所有
 default_realm <span class="token operator">=</span> SKILLS.COM
<span class="token punctuation">[</span>realms<span class="token punctuation">]</span>
 <span class="token number">22</span>  SKILLS.COM <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 <span class="token number">23</span>      kdc <span class="token operator">=</span> linux2.skills.com
 <span class="token number">24</span>      admin_server <span class="token operator">=</span> linux2.skills.com
 <span class="token number">25</span>  <span class="token punctuation">}</span>
 <span class="token number">26</span> 
 <span class="token number">27</span> <span class="token punctuation">[</span>domain_realm<span class="token punctuation">]</span>
 <span class="token number">28</span>  .skills.com <span class="token operator">=</span> SKILLS.COM
 <span class="token number">29</span>  skills.com <span class="token operator">=</span> SKILLS.COM
 <span class="token comment">#kdc数据库初始化,回车两下</span>
kdb5_util create -s
<span class="token comment">#创建客户端密钥并把密钥导出</span>
kadmin.local
addprinc -randkey nfs/linux3.skills.com
addprinc -randkey nfs/linux4.skills.com
ktadd -k /tmp/linux3 nfs/linux3.skills.com
ktadd -k /tmp/linux4 nfs/linux4.skills.com
<span class="token builtin class-name">exit</span>
<span class="token function">scp</span> /etc/krb5.conf linux3.skills.com:/etc/krb5.conf 
<span class="token function">scp</span> /etc/krb5.conf linux4.skills.com:/etc/krb5.conf 
<span class="token function">scp</span> /tmp/linux3 linux3.skills.com:/etc/krb5.keytab 
<span class="token function">scp</span> /tmp/linux4 linux4.skills.com:/etc/krb5.keytab
systemctl <span class="token builtin class-name">enable</span> --now krb5kdc
firewall-cmd --add-service<span class="token operator">=</span>kerberos
<span class="token comment">#linux3</span>
yum -y <span class="token function">install</span> krb5* nfs-utils nfs-utils
kinit -kt /etc/krb5.keytab nfs/linux3.skills.com
klist 
<span class="token comment">#linux3 创用户,用户名为 xiao，uid=2000，gid=2000，家目录为/home/xiaodir</span>
<span class="token function">groupadd</span> -g <span class="token number">2000</span> xiao
<span class="token function">useradd</span> -u <span class="token number">2000</span> -g <span class="token number">2000</span> -d /home/xiaodir xiao
<span class="token comment">#NFS服务</span>
yum <span class="token function">install</span> nfs-utils -y
<span class="token function">mkdir</span> -p /srv/sharenfs
<span class="token function">vim</span> /etc/exports
/srv/sharenfs <span class="token number">10.10</span>.21.0/24<span class="token punctuation">(</span>rw,root_squash,async,anonuid<span class="token operator">=</span><span class="token number">2000</span>,anongid<span class="token operator">=</span><span class="token number">2000</span>,sec<span class="token operator">=</span>krb5p<span class="token punctuation">)</span>
:wq
systemctl <span class="token builtin class-name">enable</span> --now nfs-server
firewall-cmd --add-service<span class="token operator">=</span>nfs
firewall-cmd --add-service<span class="token operator">=</span>rpc-bind 
firewall-cmd --add-service<span class="token operator">=</span>mountd 
<span class="token comment">#linux4</span>
yum -y <span class="token function">install</span> krb5* nfs-utils nfs-utils autofs
<span class="token function">vim</span> /etc/auto.master
<span class="token comment"># 挂载点的父目录   /etc/auto.misc</span>
/sharenfs       /etc/auto.misc
<span class="token function">vim</span> /etc/auto.misc
<span class="token comment"># 挂载点的真实目录     -fstype=nfs,rw   server:/nfs-share</span>
xiao -fstype<span class="token operator">=</span>nfs,rw,sync,no_root_squash <span class="token number">10.10</span>.21.103:/srv/sharenfs
:wq
systemctl <span class="token builtin class-name">enable</span> --now autofs
<span class="token function">mkdir</span> /sharenfs
<span class="token builtin class-name">cd</span> /sharenfs
<span class="token builtin class-name">cd</span> xiao
<span class="token function">mkdir</span> <span class="token builtin class-name">test</span>
<span class="token comment"># 检查文件系统挂载情况</span>
<span class="token function">df</span> -Th
</code></pre> 
<h5><a id="postgresql__433"></a><strong>(五)postgresql 服务</strong></h5> 
<p>1.配置 linux5 为 postgresql 服务器，创建数据库 userdb；在库中创建</p> 
<p>表 userinfo，在表中插入 2 条记录，分别为（1,user1，1995-7-1），（2,user2，</p> 
<p>1995-9-1），口令与用户名相同，password 字段用 md5 函数加密，表结构如下：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-WcxOqj9q-1679974466927)(C:\Users\yzp\AppData\Roaming\Typora\typora-user-images\image-20221114142211717.png)]</p> 
<p>2.设置可以直接在 shell 下操作数据库，然后备份数据库 userdb 到</p> 
<p>/var/local/postgresqlbak/userdb.sql。</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y postgresql postgresql-server
<span class="token comment">#初始化数据库</span>
/usr/bin/postgresql-setup --initdb
WARNING: using obsoleted argument syntax, try --help
WARNING: arguments transformed to: postgresql-setup --initdb --unit postgresql
 * Initializing database <span class="token keyword">in</span> <span class="token string">'/var/lib/pgsql/data'</span> 
 * Initialized, logs are <span class="token keyword">in</span> /var/lib/pgsql/initdb_postgresql.log
 <span class="token comment">#启动服务</span>
 systemctl <span class="token builtin class-name">enable</span> --now postgresql
 <span class="token comment">#开启防火墙</span>
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">5432</span>/tcp --permanent
<span class="token comment">#创建数据库</span>
<span class="token function">sudo</span> -u postgres psql
createdb database userdb<span class="token punctuation">;</span>
<span class="token comment">#登入数据库</span>
<span class="token punctuation">\</span>c userdb
<span class="token comment">#创建表结构</span>
create table userinfo<span class="token punctuation">(</span>id serial primary key not null,name varchar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> ,birthday <span class="token function">date</span> ,password varchar<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token comment">#插入数据 </span>
insert into userinfo values<span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">'user1'</span>,<span class="token string">'1995-7-1'</span>,MD5<span class="token punctuation">(</span><span class="token string">'user1'</span><span class="token punctuation">))</span><span class="token punctuation">;</span> 
insert into userinfo values<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">'user2'</span>,<span class="token string">'1995-9-1'</span>,MD5<span class="token punctuation">(</span><span class="token string">'user2'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token punctuation">\</span>q
<span class="token comment">#备份数据库userdb到/var/local/postgresqlbak/userdb.sql</span>
<span class="token function">mkdir</span> -p /var/local/postgresqlbak 
<span class="token function">chmod</span> <span class="token number">777</span> /var/local/postgresqlbak/ 
<span class="token function">sudo</span> -u postgres pg_dump -c -C -f /var/local/postgresqlbak/userdb.sql userdb
</code></pre> 
<h5><a id="redis__476"></a><strong>(六)redis 服务</strong></h5> 
<p>1.利用 linux6 搭建 redis cluster 集群，使用端口 7004-7006 模拟主节点，</p> 
<p>7001-7003 模拟从节点，让其他主机可以访问 redis 集群。</p> 
<pre><code class="prism language-shell"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/redis.conf
<span class="token number">69</span> <span class="token builtin class-name">bind</span> <span class="token number">10.10</span>.21.103
<span class="token number">136</span> daemonize <span class="token function">yes</span>
<span class="token number">838</span>  cluster-enabled <span class="token function">yes</span>
<span class="token number">846</span>  cluster-config-file nodes-6379.conf
:wq
<span class="token function">mkdir</span> -p /rediscluster/<span class="token punctuation">{<!-- --></span><span class="token number">7001</span><span class="token punctuation">..</span><span class="token number">7006</span><span class="token punctuation">}</span>
<span class="token comment">#使用shell脚本进行批量操作 </span>
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">7001</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">7006</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token keyword">do</span> <span class="token function">cp</span> /etc/redis.conf /rediscluster/<span class="token variable">$i</span>/<span class="token punctuation">;</span> <span class="token function">sed</span> -i <span class="token string">"s/6379/<span class="token variable">$i</span>/g"</span> /rediscluster/<span class="token variable">$i</span>/redis.conf<span class="token punctuation">;</span>
<span class="token comment">#创建集群</span>
redis-cli --cluster create <span class="token number">10.10</span>.21.103:7001 <span class="token number">10.10</span>.21.103:7002 <span class="token number">10.10</span>.21.103:7003 <span class="token number">10.10</span>.21.103:7004 <span class="token number">10.10</span>.21.103:7005 <span class="token number">10.10</span>.21.103:7006 --cluster-replicas <span class="token number">1</span>
</code></pre> 
<h6><a id="Mariadb__497"></a><strong>(五)Mariadb 服务</strong></h6> 
<p>1.配置 Linux3 为 Mariadb 服务器，安装 Mariadb-server，创建数据库用户</p> 
<p>jack，在任意机器上对所有数据库有完全权限；允许 root 远程登陆。</p> 
<p>2.配置 Linux4 为 Mariadb 客户端，创建数据库 userdb；在库中创建表</p> 
<p>userinfo，在表中插入 2 条记录，分别为(1,user1，1995-7-1，男)，(2,user2，</p> 
<p>1995-9-1，女)，口令与用户名相同，password 字段用 password 函数加密，表结</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ojYuj4bS-1679974466928)(C:\Users\yzp\AppData\Roaming\Typora\typora-user-images\image-20221114142955846.png)]</p> 
<p>3.修改表 userinfo 的结构，在 name 字段后添加新字段 height(数据类型为</p> 
<p>float)，更新 user1 和 user2 的 height 字段内容为 1.61 和 1.62。</p> 
<p>4.将表 userinfo 中的记录导出，并存放到/var/databak/mysql.sql 文件中</p> 
<pre><code class="prism language-shell"><span class="token comment">#服务端</span>
Yum <span class="token function">install</span> -y mariadb mariadb-server
Systemctl restart mariadb mariadb.service
mysql
GRANT ALL PRIVILEGES ON *.* to jack@<span class="token string">'%'</span> identified by <span class="token string">"Pass-1234"</span><span class="token punctuation">;</span>
<span class="token comment">#客户端</span>
um <span class="token function">install</span> -y mariadb mariadb-server
Systemctl restart mariadb mariadb.service
Mysql -u jack -h <span class="token number">10.10</span>.21.103 -p
create database userdb<span class="token punctuation">;</span>
use userdb<span class="token punctuation">;</span>
<span class="token comment">#创建表结构</span>
create table userinfo<span class="token punctuation">(</span>id int primary key auto_increment,name varchar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>,birthday datetime,sex char<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,password char<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token comment">#插入数据 </span>
insert into userinfo values<span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">'user1'</span>,<span class="token string">'1995-7-1'</span>,<span class="token string">'nan'</span>,password<span class="token punctuation">(</span><span class="token string">'user1'</span><span class="token punctuation">))</span><span class="token punctuation">;</span> 
insert into userinfo values<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">'user2'</span>,<span class="token string">'1995-9-1'</span>,<span class="token string">'nv'</span>,password<span class="token punctuation">(</span><span class="token string">'user2'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
allter table userinfo <span class="token function">add</span> height float after name<span class="token punctuation">;</span>
update userinfo <span class="token builtin class-name">set</span> height <span class="token operator">=</span> <span class="token number">1.61</span> where <span class="token function">id</span> <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
update userinfo <span class="token builtin class-name">set</span> height <span class="token operator">=</span> <span class="token number">1.62</span> where <span class="token function">id</span> <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
load data <span class="token builtin class-name">local</span> infile <span class="token string">'/1/mysql.txt'</span> into table userinfo<span class="token punctuation">;</span>
<span class="token builtin class-name">exit</span>
<span class="token comment">#内容导入userinfo表</span>
<span class="token punctuation">[</span>root@linux4<span class="token punctuation">]</span><span class="token comment">#mysqldump -h 10.10.21.103 -u jack -p"Pass-1234" -B --databases userdb --tables userinfo &gt; '/var/databak/mysql.sql'</span>
</code></pre> 
<p><strong>(四)Mail 服务</strong></p> 
<p>1.配置 linux4 为 mail 服务器，安装 postfix 和 dovecot。</p> 
<p>2.仅支持 smtps 和 pop3s 连接，证书路径为/etc/ssl/skills.crt，私钥路</p> 
<p>径为/etc/ssl/skills.key。</p> 
<p>3.创建用户 mail1 和 mail2，向 all@skills.com 发送的邮件，每个用户</p> 
<p>都会收到。</p> 
<p>4.root 用户使用 mail 工具向 all@skills.com 发送一封邮件，邮件</p> 
<p>主题为“Hello”，内容为“Welcome”。</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> postfix dovecot -y

<span class="token comment">#配置postfix </span>
<span class="token function">vim</span> /etc/postfix/main.cf 
myhostname <span class="token operator">=</span> linux5.skills.com 
mydomain <span class="token operator">=</span> skills.com 
myorigin <span class="token operator">=</span> <span class="token variable">$mydomain</span> 
inet_interfaces <span class="token operator">=</span> all 
mydestination <span class="token operator">=</span> <span class="token variable">$myhostname</span>,<span class="token variable">$mydomain</span> 
mynetworks <span class="token operator">=</span> <span class="token number">10.10</span>.21.0/24 
home_mailbox <span class="token operator">=</span> Maildir/
<span class="token comment">#ssl</span>
smtpd_tls_key_file <span class="token operator">=</span> /etc/ssl/skills.key
smtpd_tls_cert_file <span class="token operator">=</span> /etc/ssl/skills.crt

<span class="token function">vim</span> /etc/postfix/master.cf
<span class="token comment">#smtp inet n - n - - smtpd #line 12 </span>
smtps inet n - n - - smtpd <span class="token comment">#line 29 </span>
	-o <span class="token assign-left variable">syslog_name</span><span class="token operator">=</span>postfix/smtps <span class="token comment">#line 30 </span>
	-o <span class="token assign-left variable">smtpd_tls_wrappermode</span><span class="token operator">=</span>yes <span class="token comment">#line 31</span>

<span class="token comment">#编辑dovecot</span>
<span class="token function">vim</span> /etc/dovecot/dovecot.conf
protocols <span class="token operator">=</span> imap pop3 lmtp submission
listen <span class="token operator">=</span> *, ::
login_trusted_networks <span class="token operator">=</span> <span class="token number">10.10</span>.21.0/24

<span class="token function">vim</span> /etc/dovecot/conf.d/10-mail.conf
mail_location <span class="token operator">=</span> maildir:~/Maildir

<span class="token function">vim</span> /etc/dovecot/conf.d/10-ssl.conf
ssl <span class="token operator">=</span> <span class="token function">yes</span>
ssl_cert <span class="token operator">=</span> <span class="token operator">&lt;</span>/etc/ssl/skills.crt
ssl_key <span class="token operator">=</span> <span class="token operator">&lt;</span>/etc/ssl/skills.key

<span class="token comment">#防火墙</span>
firewall-cmd --add-service<span class="token operator">=</span>pop3s
firewall-cmd --add-service<span class="token operator">=</span>smtps
firewall-cmd --add-service<span class="token operator">=</span>smtp
firewall-cmd --add-service<span class="token operator">=</span>pop3
systemctl start postfix dovecot
systemctl <span class="token builtin class-name">enable</span> postfix.service dovecot.service 
Created symlink /etc/systemd/system/multi-user.target.wants/postfix.service → /usr/lib/systemd/system/postfix.service.
Created symlink /etc/systemd/system/multi-user.target.wants/dovecot.service → /usr/lib/systemd/system/dovecot.service.
<span class="token comment">#创建用户mail1和mail2</span>
<span class="token function">useradd</span> mail1
<span class="token function">useradd</span> mail2
<span class="token comment">#设置密码</span>
<span class="token builtin class-name">echo</span> <span class="token string">"mail1:Pass-1234"</span> <span class="token operator">|</span> chpasswd
<span class="token builtin class-name">echo</span> <span class="token string">"mail2:Pass-1234"</span> <span class="token operator">|</span> chpasswd
<span class="token comment">#配置</span>
<span class="token function">vim</span> /etc/aliases
all: mail1,mail2
:wq
newaliases
yum <span class="token function">install</span> mailx -y
<span class="token builtin class-name">echo</span> <span class="token string">"Welcome"</span> <span class="token operator">|</span> mail -s <span class="token string">"Hello"</span> all@skills.com
<span class="token function">cat</span> /home/mail1/Maildir/new/1652068709.Vfd00Ibe30cM57337.linux4.skills.com 
Return-Path: <span class="token operator">&lt;</span>root@skills.com<span class="token operator">&gt;</span>
X-Original-To: all@skills.com
Delivered-To: all@skills.com
Received: by linux4.skills.com <span class="token punctuation">(</span>Postfix, from userid <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">id</span> 07D07A1C8D<span class="token punctuation">;</span> Mon,  <span class="token number">9</span> May <span class="token number">2022</span> <span class="token number">11</span>:58:29 +0800 <span class="token punctuation">(</span>CST<span class="token punctuation">)</span>
Date: Mon, 09 May <span class="token number">2022</span> <span class="token number">11</span>:58:28 +0800
To: all@skills.com
Subject: Hello
User-Agent: Heirloom mailx <span class="token number">12.5</span> <span class="token number">7</span>/5/10
MIME-Version: <span class="token number">1.0</span>
Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>us-ascii
Content-Transfer-Encoding: 7bit
Message-Id: <span class="token operator">&lt;</span><span class="token number">20220509035829</span>.07D07A1C8D@linux4.skills.com<span class="token operator">&gt;</span>
From: root <span class="token operator">&lt;</span>root@skills.com<span class="token operator">&gt;</span>

Welcome
</code></pre> 
<h6><a id="pxe__636"></a><strong>(六)pxe 服务</strong></h6> 
<p>1.linux5 安装 DHCP 服务，地址范围为 10.10.21.10-10.10.21.19，网关</p> 
<p>为 10.10.21.1，dns 为 10.10.21.101，域名为 skills.com。</p> 
<p>2.安装 tftp-server，tftp 目录为默认值。</p> 
<p>3.挂载 linux 光盘文件到/var/www/html/cdrom;实现完全自动安装 linux</p> 
<p>文字界面，配置文件为/var/www/html/ks.cfg(参考/root/anaconda-ks.cfg)，</p> 
<p>在/var/lib/tftpboot/pxelinux.cfg/default 文件中指定安装源和 ks 文件。</p> 
<pre><code class="prism language-shell">yum -y  <span class="token function">install</span> httpd syslinux xinetd tftp-server dhcp-server
<span class="token comment"># 复制配置文件</span>
<span class="token function">cp</span> -a /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf 
cp: overwrite <span class="token string">'/etc/dhcp/dhcpd.conf'</span>? y
<span class="token comment">#将以下配置修改</span>
subnet <span class="token number">10.5</span>.5.0 netmask <span class="token number">255.255</span>.255.224 <span class="token punctuation">{<!-- --></span>
  range <span class="token number">10.5</span>.5.26 <span class="token number">10.5</span>.5.30<span class="token punctuation">;</span>
  option domain-name-servers ns1.internal.example.org<span class="token punctuation">;</span>
  option domain-name <span class="token string">"internal.example.org"</span><span class="token punctuation">;</span>
  option routers <span class="token number">10.5</span>.5.1<span class="token punctuation">;</span>
  option broadcast-address <span class="token number">10.5</span>.5.31<span class="token punctuation">;</span>
  default-lease-time <span class="token number">600</span><span class="token punctuation">;</span>
  max-lease-time <span class="token number">7200</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">#修改为如下配置</span>

subnet <span class="token number">10.10</span>.21.0 netmask <span class="token number">255.255</span>.255.0 <span class="token punctuation">{<!-- --></span> <span class="token comment">#地址网段 和 掩码 </span>
	range <span class="token number">10.10</span>.21.10 <span class="token number">10.10</span>.21.19<span class="token punctuation">;</span> <span class="token comment">#地址池 </span>
    option domain-name-servers <span class="token number">10.10</span>.21.101<span class="token punctuation">;</span>
    option domain-name <span class="token string">"skills.com"</span><span class="token punctuation">;</span>
    option routers <span class="token number">10.10</span>.21.254<span class="token punctuation">;</span>
    filename <span class="token string">"pxelinux.0"</span><span class="token punctuation">;</span> <span class="token comment">#pxe引导程序文件 </span>
    next-server <span class="token number">10.10</span>.21.104<span class="token punctuation">;</span> <span class="token comment">#tfpt服务器地址</span>
<span class="token punctuation">}</span>
<span class="token function">mkdir</span> /var/www/html/cdrom
<span class="token function">mount</span> /root/Rocky-8.5-x86_64-dvd1.iso /var/www/html/cdrom
<span class="token comment"># 拷贝启动所需文件</span>
 <span class="token function">cp</span> -a /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/
 <span class="token function">cp</span> -a /var/www/html/cdrom/isolinux/<span class="token punctuation">{<!-- --></span>initrd.img,ldlinux.c32,vesamenu.c32,libcom32.c32,vmlinuz,libutil.c32<span class="token punctuation">}</span> /var/lib/tftpboot/
<span class="token comment"># 拷贝引导文件并修改</span>
<span class="token function">mkdir</span> /var/lib/tftpboot/pxelinux.cfg
<span class="token function">cp</span> /var/www/html/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default
<span class="token function">vim</span> /var/lib/tftpboot/pxelinux.cfg/default 
label linux
  menu label ^Manual Install CentOS Linux <span class="token number">8</span>
  kernel vmlinuz
  menu default
  append <span class="token assign-left variable">initrd</span><span class="token operator">=</span>initrd.img inst.stage2<span class="token operator">=</span>http://10.10.21.104/cdrom <span class="token assign-left variable">ks</span><span class="token operator">=</span>http://10.10.21.104/ks.cfg quiet
<span class="token comment">#保存并退出:wq!</span>
<span class="token function">cp</span> /root/anaconda-ks.cfg /var/www/html/ks.cfg
<span class="token comment"># 拷贝引导文件并修改</span>
<span class="token function">chmod</span> o+r /var/www/html/ks.cfg 
<span class="token comment"># 赋予其他用户添加可读权限</span>
<span class="token function">vim</span> /var/www/html/ks.cfg 
text
url --url<span class="token operator">=</span><span class="token string">"http://10.10.21.104:8888/cdrom/"</span>
<span class="token comment">#下面四个注释</span>
<span class="token comment">#repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream</span>
<span class="token comment"># Use CDROM installation media</span>
<span class="token comment">#cdrom</span>
<span class="token comment"># Partition clearing information</span>
clearpart --all --initlabel 	<span class="token comment">#none 改成all 初始化硬盘</span>
<span class="token function">reboot</span>		<span class="token comment">#最后一行加上reboot 装完系统自动重启</span>
非编辑模式下输入 :%s/vda/sda/g	
非编辑模式下输入 :wq
systemctl restart httpd tftp.socket xinetd dhcpd 
systemctl <span class="token builtin class-name">enable</span> httpd tftp.socket xinetd dhcp
<span class="token comment">#防火墙</span>
firewall-cmd --add-service<span class="token operator">=</span>dhcp
firewall-cmd --add-service<span class="token operator">=</span>tftp
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">8888</span>/tcp
</code></pre> 
<p><strong>(六)samba 服务</strong></p> 
<p>1.在 linux5 上创建 user00-user19 等 20 个用户；user00 和 user01</p> 
<p>添加到 dev 组，user02 和 user03 添加到 sale 组。把用户 user00-user03 添加到 samba 用户。</p> 
<p>2.配置 linux5 为 samba 服务器,建立共享目录/srv/sharesmb，共享名与</p> 
<p>目录名相同。dev 组用户对 sharesmb 共享有读写权限，sale 组对 sharesmb</p> 
<p>共享有只读权限；用户对自己新建的文件有完全权限，对其他用户的文件只有读</p> 
<p>权限，且不能删除别人的文件。在本机用 smbclient 命令测试。</p> 
<p>3.在 linux6 修改/etc/fstab,使用用户 user00 实现自动挂载 linux3 的</p> 
<p>sharesmb 共享到/sharesmb。</p> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> samba samba-client
<span class="token comment">#创建20个用户</span>
<span class="token punctuation">[</span>root@linux3 srv<span class="token punctuation">]</span><span class="token comment"># vi /222.sh </span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{<!-- --></span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">}</span>
<span class="token keyword">do</span>
        <span class="token function">useradd</span> user<span class="token variable">$i</span>
<span class="token keyword">done</span>
<span class="token comment">#创建组</span>
<span class="token function">groupadd</span> sale
<span class="token function">groupadd</span> dev
<span class="token comment">#修改用户的所属组</span>
<span class="token function">usermod</span> user01 -g dev
<span class="token function">usermod</span> user00 -g dev
<span class="token function">usermod</span> user02 -g sale
<span class="token function">usermod</span> user03 -g sale
pdbedit -a user00
pdbedit -a user01
pdbedit -a user02
pdbedit -a user03
<span class="token comment">#创建目录</span>
<span class="token function">mkdir</span> -p /srv/sharesmb
firewall-cmd --add-service<span class="token operator">=</span>samba
<span class="token comment">#编辑samba的配置文件</span>
<span class="token function">vim</span> /etc/samba/smb.conf
<span class="token punctuation">[</span>sharesmb<span class="token punctuation">]</span>
	path <span class="token operator">=</span> /srv/sharesmb
	browseable <span class="token operator">=</span> <span class="token function">yes</span>
	<span class="token function">write</span> list <span class="token operator">=</span> dev
	valid <span class="token function">users</span> <span class="token operator">=</span>@dev,@sale
 :wq
 systemctl <span class="token builtin class-name">enable</span> --now smb
 <span class="token comment"># smbclient 命令测试</span>
 yum -y <span class="token function">install</span> samba-client
 smbclient //10.10.21.103/sharesmb/ -U user00
Password:
<span class="token assign-left variable">Domain</span><span class="token operator">=</span><span class="token punctuation">[</span>WORKGROUP<span class="token punctuation">]</span> <span class="token assign-left variable">OS</span><span class="token operator">=</span><span class="token punctuation">[</span>Unix<span class="token punctuation">]</span> <span class="token assign-left variable">Server</span><span class="token operator">=</span><span class="token punctuation">[</span>Samba <span class="token number">3.6</span>.9-151.el6<span class="token punctuation">]</span>
smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span>
<span class="token comment">#linux4</span>
<span class="token function">mkdir</span> /sharesmb
yum -y <span class="token function">install</span> cifs-utils
<span class="token function">vim</span> /etc/fstab
//10.10.21.103/sharesmb /sharesmb cifs defaults,username<span class="token operator">=</span>user00,password<span class="token operator">=</span>Pass-1234 <span class="token number">0</span> <span class="token number">0</span>
<span class="token function">mount</span> -a
</code></pre> 
<h6><a id="_779"></a><strong>(七)脚本</strong></h6> 
<p>1.在 linux7 上编写/root/CreateFile.py 的 python3 脚本，创建 20 个</p> 
<p>文件/root/python/File10 至/root/python/File29，如果文件存在，则删除后</p> 
<p>再创建；每个文件的内容同文件名，如 File10 文件的内容为“File10”。</p> 
<pre><code class="prism language-shell"><span class="token function">import</span> os
os.system<span class="token punctuation">(</span><span class="token string">"mkdir -p /root/python"</span><span class="token punctuation">)</span>
<span class="token function">file</span>  <span class="token operator">=</span> <span class="token string">"/root/python/"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10,29</span><span class="token punctuation">)</span>:

    if<span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span>:
        res <span class="token operator">=</span> os.path.isfile<span class="token punctuation">(</span><span class="token string">"/root/python/file{}"</span>.format<span class="token punctuation">(</span>n<span class="token punctuation">))</span>
        if<span class="token punctuation">(</span>res<span class="token punctuation">)</span>:

            os.system<span class="token punctuation">(</span><span class="token string">"rm -rf {}file{}"</span>.format<span class="token punctuation">(</span>file,n<span class="token punctuation">))</span>
        else:
            res1 <span class="token operator">=</span> os.system<span class="token punctuation">(</span><span class="token string">"touch {}file{}"</span>.format<span class="token punctuation">(</span>file,n<span class="token punctuation">))</span>
            ec <span class="token operator">=</span> os.system<span class="token punctuation">(</span><span class="token string">"echo file{} &gt;&gt; {}file{}"</span>.format<span class="token punctuation">(</span>n,file,n<span class="token punctuation">))</span>

    else:
        res <span class="token operator">=</span> os.path.isfile<span class="token punctuation">(</span><span class="token string">"{}file{}"</span>.format<span class="token punctuation">(</span>file,n<span class="token punctuation">))</span>
        if<span class="token punctuation">(</span>res<span class="token punctuation">)</span>:

            os.system<span class="token punctuation">(</span><span class="token string">"rm -rf {}file{}"</span>.format<span class="token punctuation">(</span>file,n<span class="token punctuation">))</span>
        else:
            res2 <span class="token operator">=</span> os.system<span class="token punctuation">(</span><span class="token string">"touch {}file{}"</span>.format<span class="token punctuation">(</span>file,n<span class="token punctuation">))</span>
            ec1 <span class="token operator">=</span> os.system<span class="token punctuation">(</span><span class="token string">"echo file{} &gt;&gt; {}file{}"</span>.format<span class="token punctuation">(</span>n,file,n<span class="token punctuation">))</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb520d7c6a36741bf290c107e44850c4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">记录关于PageHelper插件不生效的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bc5ef83d98806851786d0a909512fdf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA集成chatGPT</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>