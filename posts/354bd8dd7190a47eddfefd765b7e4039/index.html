<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp 打包app wgt热更新和整包更新以及更新弹窗动画 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp 打包app wgt热更新和整包更新以及更新弹窗动画" />
<meta property="og:description" content="app热更新是app项目最常见的功能，接下来我总结了当时做这个功能的过程，来交流学习一哈
热更新的流程步骤 在用户进入app就获取当前版本号与调用后端接口返回的版本号对比是否是最新的版本不是最新弹出弹窗让用户确认是否更新，点击更新下载wgt资源包更新，重启应用即可
代码流程 1.封装两个判断js文件 call-check-version.js 判断是否需要更新 import { getVersion } from &#39;@/api/user.js&#39; // 获取最新版本信息的接口 /** * 对比版本号，如需要，请自行修改判断规则 * 支持比对	(&#34;3.0.0.0.0.1.0.1&#34;, &#34;3.0.0.0.0.1&#34;)	(&#34;3.0.0.1&#34;, &#34;3.0&#34;)	(&#34;3.1.1&#34;, &#34;3.1.1.1&#34;) 之类的 * @param {Object} v1 * @param {Object} v2 * v1 &gt; v2 return 1 * v1 &lt; v2 return -1 * v1 == v2 return 0 */ function compare(v1 = &#39;0&#39;, v2 = &#39;0&#39;) { v1 = String(v1).split(&#39;.&#39;) v2 = String(v2).split(&#39;.&#39;) const minVersionLens = Math." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/354bd8dd7190a47eddfefd765b7e4039/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-05T13:58:39+08:00" />
<meta property="article:modified_time" content="2023-06-05T13:58:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp 打包app wgt热更新和整包更新以及更新弹窗动画</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>app热更新是app项目最常见的功能，接下来我总结了当时做这个功能的过程，来交流学习一哈</strong></p> 
<h2><a id="_1"></a>热更新的流程步骤</h2> 
<ul><li><strong>在用户进入app就获取当前版本号与调用后端接口返回的版本号对比是否是最新的版本</strong></li><li><strong>不是最新弹出弹窗让用户确认是否更新，点击更新下载wgt资源包更新，重启应用即可</strong><br> <img src="https://images2.imgbox.com/ca/d8/F617B1dD_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="_5"></a>代码流程</h2> 
<h3><a id="1js_6"></a>1.封装两个判断js文件</h3> 
<ul><li><strong>call-check-version.js 判断是否需要更新</strong></li></ul> 
<pre><code class="prism language-javascript">	<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user.js'</span> <span class="token comment">// 获取最新版本信息的接口</span>
<span class="token comment">/**
	 * 对比版本号，如需要，请自行修改判断规则
	 * 支持比对	("3.0.0.0.0.1.0.1", "3.0.0.0.0.1")	("3.0.0.1", "3.0")	("3.1.1", "3.1.1.1") 之类的
	 * @param {Object} v1
	 * @param {Object} v2
	 * v1 &gt; v2 return 1
	 * v1 &lt; v2 return -1
	 * v1 == v2 return 0
	 */</span>
	<span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span>v1 <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">,</span> v2 <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		v1 <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
		v2 <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
		<span class="token keyword">const</span> minVersionLens <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span>

		<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> minVersionLens<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> curV1 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">const</span> curV2 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>curV1 <span class="token operator">&gt;</span> curV2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				result <span class="token operator">=</span> <span class="token number">1</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>curV1 <span class="token operator">&lt;</span> curV2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length <span class="token operator">!==</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> v1BiggerThenv2 <span class="token operator">=</span> v1<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> v2<span class="token punctuation">.</span>length
			<span class="token keyword">const</span> maxLensVersion <span class="token operator">=</span> v1BiggerThenv2 <span class="token operator">?</span> v1 <span class="token operator">:</span> v2
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> minVersionLens<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLensVersion<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">const</span> curVersion <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>maxLensVersion<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>curVersion <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					v1BiggerThenv2 <span class="token operator">?</span> result <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">:</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
					<span class="token keyword">break</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> result
	<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// #ifdef APP-PLUS</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>appid<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">widgetInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'checkVersion'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">appid</span><span class="token operator">:</span> plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>appid<span class="token punctuation">,</span>
				<span class="token literal-property property">appVersion</span><span class="token operator">:</span> plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token comment">// 当前版本</span>
				<span class="token literal-property property">wgtVersion</span><span class="token operator">:</span> widgetInfo<span class="token punctuation">.</span>version <span class="token comment">// wgt版本</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// console.log("data: ",data);</span>
			<span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// let {appVersionPackage,app_version}=res.data.list</span>
				<span class="token comment">// let result={<!-- --></span>
				<span class="token comment">// 	code:1,</span>
				<span class="token comment">// 	url:appVersionPackage,</span>
				<span class="token comment">// 	version:app_version,</span>
				<span class="token comment">// 	platform:'Android',</span>
				<span class="token comment">// 	contents:'1.修改头像\n2.分享内容', //更新内容</span>
				<span class="token comment">// 	is_mandatory:false, //强制更新</span>
				<span class="token comment">// 	is_silently:0, //静默更新 1是 0否</span>
				<span class="token comment">// 	type:'apk' //wgt/apk</span>
				<span class="token comment">// }</span>
				<span class="token comment">// console.log(result)</span>
				<span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">compare</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">.</span>version<span class="token punctuation">,</span> data<span class="token punctuation">.</span>appVersion<span class="token punctuation">)</span>
				<span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token function">compare</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">.</span>version<span class="token punctuation">,</span> data<span class="token punctuation">.</span>wgtVersion<span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> w <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 同时大于当前版本和wgt版本，则需要更新</span>
					res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">2</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">//不用更新</span>
					res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
				<span class="token punctuation">}</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">result</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info <span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token comment">// uniCloud.callFunction({<!-- --></span>
			<span class="token comment">// 	name: 'uni-upgrade-center',</span>
			<span class="token comment">// 	data,</span>
			<span class="token comment">// 	success: (e) =&gt; {<!-- --></span>
			<span class="token comment">// 		console.log("e: ", e);</span>
			<span class="token comment">// 		resolve(e)</span>
			<span class="token comment">// 	},</span>
			<span class="token comment">// 	fail: (error) =&gt; {<!-- --></span>
			<span class="token comment">// 		reject(error)</span>
			<span class="token comment">// 	}</span>
			<span class="token comment">// })</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// #endif</span>
	<span class="token comment">// #ifndef APP-PLUS</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请在App中使用'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// #endif</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li><strong>check-update.js 更新方式选择（弹窗）</strong></li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> callCheckVersion <span class="token keyword">from</span> <span class="token string">'./call-check-version'</span>

<span class="token comment">// 推荐再App.vue中使用</span>
<span class="token keyword">const</span> <span class="token constant">PACKAGE_INFO_KEY</span> <span class="token operator">=</span> <span class="token string">'__package_info__'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// #ifdef APP-PLUS</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">callCheckVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
				code<span class="token punctuation">,</span>
				is_silently<span class="token punctuation">,</span> <span class="token comment">// 是否静默更新</span>
				url<span class="token punctuation">,</span> <span class="token comment">// 安装包下载地址</span>
				platform<span class="token punctuation">,</span> <span class="token comment">// 安装包平台</span>
				type <span class="token comment">// 安装包类型</span>
			<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>code<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 此处逻辑仅为实例，可自行编写</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

				<span class="token comment">// 静默更新，只有wgt有</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>is_silently<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					uni<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">url</span><span class="token operator">:</span> e<span class="token punctuation">.</span>result<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								<span class="token comment">// 下载好直接安装，下次启动生效</span>
								plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
									<span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">false</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">/**
				 * 提示升级一
				 * 使用 uni.showModal
				 */</span>
				<span class="token comment">// return updateUseModal(e.result)</span>

				<span class="token comment">/**
				 * 提示升级二
				 * 官方适配的升级弹窗，可自行替换资源适配UI风格
				 */</span>
				uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token constant">PACKAGE_INFO_KEY</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uni_modules/pages/upgrade-popup?local_storage_key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">PACKAGE_INFO_KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 更新弹窗页面</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'更新弹框跳转失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
						uni<span class="token punctuation">.</span><span class="token function">removeStorageSync</span><span class="token punctuation">(</span><span class="token constant">PACKAGE_INFO_KEY</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				
				<span class="token keyword">return</span>
			
			<span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// TODO 云函数报错处理</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// #endif</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 使用 uni.showModal 升级
 */</span>
<span class="token keyword">function</span> <span class="token function">updateUseModal</span><span class="token punctuation">(</span><span class="token parameter">packageInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
		title<span class="token punctuation">,</span> <span class="token comment">// 标题</span>
		contents<span class="token punctuation">,</span> <span class="token comment">// 升级内容</span>
		is_mandatory<span class="token punctuation">,</span> <span class="token comment">// 是否强制更新</span>
		url<span class="token punctuation">,</span> <span class="token comment">// 安装包下载地址</span>
		platform<span class="token punctuation">,</span> <span class="token comment">// 安装包平台</span>
		type <span class="token comment">// 安装包类型</span>
	<span class="token punctuation">}</span> <span class="token operator">=</span> packageInfo<span class="token punctuation">;</span>

	<span class="token keyword">let</span> isWGT <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">'wgt'</span>
	<span class="token keyword">let</span> isiOS <span class="token operator">=</span> <span class="token operator">!</span>isWGT <span class="token operator">?</span> platform<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'iOS'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> confirmText <span class="token operator">=</span> isiOS <span class="token operator">?</span> <span class="token string">'立即跳转更新'</span> <span class="token operator">:</span> <span class="token string">'立即下载更新'</span>

	<span class="token keyword">return</span> uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		title<span class="token punctuation">,</span>
		<span class="token literal-property property">content</span><span class="token operator">:</span> contents<span class="token punctuation">,</span>
		<span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token operator">!</span>is_mandatory<span class="token punctuation">,</span>
		confirmText<span class="token punctuation">,</span>
		<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

			<span class="token comment">// 安装包下载</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isiOS<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">openURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'后台下载中……'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1000</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// wgt 和 安卓下载更新</span>
			downloadTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				url<span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'下载安装包失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 下载好直接安装，下次启动生效</span>
					plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">false</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							<span class="token comment">//更新完重启app</span>
							plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">return</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'安装成功是否重启？'</span><span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
									<span class="token comment">//更新完重启app</span>
									plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新失败'</span><span class="token punctuation">,</span>
							<span class="token literal-property property">content</span><span class="token operator">:</span> err
								<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
							<span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li><strong>我的目录结构，你们可以根据自己的习惯更改，记得修改文件里的引用路劲</strong><br> <img src="https://images2.imgbox.com/3f/25/CxoRMthd_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="2_263"></a>2.弹窗界面效果</h3> 
<ul><li><strong>upgrade-popup.vue 弹窗动画</strong></li></ul> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"mask flex-center"</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content botton-radius"</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-top"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-top-text"</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>image <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-top"</span> style<span class="token operator">=</span><span class="token string">"top: 0;"</span> width<span class="token operator">=</span><span class="token string">"100%"</span> height<span class="token operator">=</span><span class="token string">"100%"</span> src<span class="token operator">=</span><span class="token string">"../images/bg_top.png"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-header"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-body"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>subTitle<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>text style<span class="token operator">=</span><span class="token string">"padding-left:20rpx;font-size: 0.5em;color: #666;"</span><span class="token operator">&gt;</span>v<span class="token punctuation">.</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>version<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"body"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>scroll<span class="token operator">-</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"box-des-scroll"</span> scroll<span class="token operator">-</span>y<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"box-des"</span><span class="token operator">&gt;</span>
							<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>contents<span class="token punctuation">}</span><span class="token punctuation">}</span>
						<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>scroll<span class="token operator">-</span>view<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"footer flex-center"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"isAppStore"</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-button"</span> style<span class="token operator">=</span><span class="token string">"border: none;color: #fff;"</span> plain @click<span class="token operator">=</span><span class="token string">"jumpToAppStore"</span><span class="token operator">&gt;</span>
							<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>downLoadBtnTextiOS<span class="token punctuation">}</span><span class="token punctuation">}</span>
						<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!downloadSuccess"</span><span class="token operator">&gt;</span>
							<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"progress-box flex-column"</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"downloading"</span><span class="token operator">&gt;</span>
								<span class="token operator">&lt;</span>progress <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"progress"</span> border<span class="token operator">-</span>radius<span class="token operator">=</span><span class="token string">"35"</span> <span class="token operator">:</span>percent<span class="token operator">=</span><span class="token string">"downLoadPercent"</span>
									activeColor<span class="token operator">=</span><span class="token string">"#3DA7FF"</span> show<span class="token operator">-</span>info stroke<span class="token operator">-</span>width<span class="token operator">=</span><span class="token string">"10"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
								<span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"width:100%;font-size: 28rpx;display: flex;justify-content: space-around;"</span><span class="token operator">&gt;</span>
									<span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>downLoadingText<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
									<span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>downloadedSize<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>packageFileSize<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token constant">M</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
								<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
							<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>

							<span class="token operator">&lt;</span>button v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-button"</span> style<span class="token operator">=</span><span class="token string">"border: none;color: #fff;"</span> plain
								@click<span class="token operator">=</span><span class="token string">"updateApp"</span><span class="token operator">&gt;</span>
								<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>downLoadBtnText<span class="token punctuation">}</span><span class="token punctuation">}</span>
							<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>button v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"downloadSuccess &amp;&amp; !installed"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-button"</span>
							style<span class="token operator">=</span><span class="token string">"border: none;color: #fff;"</span> <span class="token literal-property property">plain</span> <span class="token operator">:</span>loading<span class="token operator">=</span><span class="token string">"installing"</span> <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"installing"</span>
							@click<span class="token operator">=</span><span class="token string">"installPackage"</span><span class="token operator">&gt;</span>
							<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>installing <span class="token operator">?</span> <span class="token string">'正在安装……'</span> <span class="token operator">:</span> <span class="token string">'下载完成，立即安装'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
						<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

						<span class="token operator">&lt;</span>button v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"installed &amp;&amp; isWGT"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"content-button"</span> style<span class="token operator">=</span><span class="token string">"border: none;color: #fff;"</span> plain
							@click<span class="token operator">=</span><span class="token string">"restart"</span><span class="token operator">&gt;</span>
							安装完毕，点击重启
						<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>

			<span class="token operator">&lt;</span>image v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!is_mandatory"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"close-img"</span> src<span class="token operator">=</span><span class="token string">"../images/app_update_close.png"</span>
				@click<span class="token punctuation">.</span>stop<span class="token operator">=</span><span class="token string">"closeUpdate"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
	<span class="token keyword">const</span> localFilePathKey <span class="token operator">=</span> <span class="token string">'UNI_ADMIN_UPGRADE_CENTER_LOCAL_FILE_PATH'</span>
	<span class="token keyword">const</span> platform_iOS <span class="token operator">=</span> <span class="token string">'iOS'</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> downloadTask <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> openSchemePromise

	<span class="token comment">/**
	 * 对比版本号，如需要，请自行修改判断规则
	 * 支持比对	("3.0.0.0.0.1.0.1", "3.0.0.0.0.1")	("3.0.0.1", "3.0")	("3.1.1", "3.1.1.1") 之类的
	 * @param {Object} v1
	 * @param {Object} v2
	 * v1 &gt; v2 return 1
	 * v1 &lt; v2 return -1
	 * v1 == v2 return 0
	 */</span>
	<span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span>v1 <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">,</span> v2 <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		v1 <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
		v2 <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
		<span class="token keyword">const</span> minVersionLens <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> minVersionLens<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> curV1 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">const</span> curV2 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>curV1 <span class="token operator">&gt;</span> curV2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				result <span class="token operator">=</span> <span class="token number">1</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>curV1 <span class="token operator">&lt;</span> curV2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length <span class="token operator">!==</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> v1BiggerThenv2 <span class="token operator">=</span> v1<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
			<span class="token keyword">const</span> maxLensVersion <span class="token operator">=</span> v1BiggerThenv2 <span class="token operator">?</span> v1 <span class="token operator">:</span> v2<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> minVersionLens<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLensVersion<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">const</span> curVersion <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>maxLensVersion<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>curVersion <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					v1BiggerThenv2 <span class="token operator">?</span> result <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">:</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 从之前下载安装</span>
				<span class="token literal-property property">installForBeforeFilePath</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>

				<span class="token comment">// 安装</span>
				<span class="token literal-property property">installed</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token literal-property property">installing</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

				<span class="token comment">// 下载</span>
				<span class="token literal-property property">downloadSuccess</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token literal-property property">downloading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

				<span class="token literal-property property">downLoadPercent</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token literal-property property">downloadedSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token literal-property property">packageFileSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>

				<span class="token literal-property property">tempFilePath</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 要安装的本地包地址</span>

				<span class="token comment">// 默认安装包信息</span>
				<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新日志'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">contents</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
				<span class="token literal-property property">is_mandatory</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

				<span class="token comment">// 可自定义属性</span>
				<span class="token literal-property property">subTitle</span><span class="token operator">:</span> <span class="token string">'发现新版本'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">downLoadBtnTextiOS</span><span class="token operator">:</span> <span class="token string">'立即跳转更新'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">downLoadBtnText</span><span class="token operator">:</span> <span class="token string">'立即下载更新'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">downLoadingText</span><span class="token operator">:</span> <span class="token string">'安装包下载中，请稍后'</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span>
			local_storage_key
		<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>local_storage_key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'local_storage_key为空，请检查后重试'</span><span class="token punctuation">)</span>
				uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>

			<span class="token keyword">const</span> localPackageInfo <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span>local_storage_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localPackageInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'安装包信息为空，请检查后重试'</span><span class="token punctuation">)</span>
				uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>

			<span class="token keyword">const</span> requiredKey <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">]</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> localPackageInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>requiredKey<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>localPackageInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">参数 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 必填，请检查后重试</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
					uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> localPackageInfo<span class="token punctuation">)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkLocalStoragePackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onBackPress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 强制更新不允许返回</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span>

			downloadTask <span class="token operator">&amp;&amp;</span> downloadTask<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			openSchemePromise <span class="token operator">=</span> <span class="token keyword">null</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">isWGT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'wgt'</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">isiOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isWGT <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>platform<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>platform_iOS<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">isAppStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isiOS <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isiOS <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isWGT <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.apk'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">checkLocalStoragePackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 如果已经有下载好的包，则直接提示安装</span>
				<span class="token keyword">const</span> localFilePathRecord <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span>localFilePathKey<span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>localFilePathRecord<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
						version<span class="token punctuation">,</span>
						savedFilePath<span class="token punctuation">,</span>
						installed
					<span class="token punctuation">}</span> <span class="token operator">=</span> localFilePathRecord

					<span class="token comment">// 比对版本</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>installed <span class="token operator">&amp;&amp;</span> <span class="token function">compare</span><span class="token punctuation">(</span>version<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>downloadSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>installForBeforeFilePath <span class="token operator">=</span> savedFilePath<span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>tempFilePath <span class="token operator">=</span> savedFilePath
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 如果保存的包版本小 或 已安装过，则直接删除</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteSavedFile</span><span class="token punctuation">(</span>savedFilePath<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token keyword">async</span> <span class="token function">closeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'关闭更新'</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>downloading<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">return</span> uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'下载中，请稍后……'</span><span class="token punctuation">,</span>
							<span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
							<span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">500</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'是否取消下载？'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">cancelText</span><span class="token operator">:</span> <span class="token string">'否'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">confirmText</span><span class="token operator">:</span> <span class="token string">'是'</span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								downloadTask <span class="token operator">&amp;&amp;</span> downloadTask<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
								uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>downloadSuccess <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 包已经下载完毕，稍后安装，将包保存在本地</span>
					<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>
					uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token comment">// this.$navTo('/pages/index/index')</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">updateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkStoreScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">downloadPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 跳转应用商店</span>
			<span class="token function">checkStoreScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">const</span> storeList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>store_list <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>enable<span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>storeList <span class="token operator">&amp;&amp;</span> storeList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					storeList
						<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cur<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next<span class="token punctuation">.</span>priority <span class="token operator">-</span> cur<span class="token punctuation">.</span>priority<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>scheme<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> curIndex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							openSchemePromise <span class="token operator">=</span> <span class="token punctuation">(</span>promise <span class="token operator">||</span> <span class="token punctuation">(</span>promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
									plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">openURL</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
										<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token keyword">return</span> openSchemePromise
						<span class="token punctuation">}</span><span class="token punctuation">,</span> openSchemePromise<span class="token punctuation">)</span>
					<span class="token keyword">return</span> openSchemePromise
				<span class="token punctuation">}</span>

				<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">downloadPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>downloading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

				<span class="token comment">//下载包</span>
				downloadTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">this</span><span class="token punctuation">.</span>downloadSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span>tempFilePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePath

							<span class="token comment">// 强制更新，直接安装</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">installPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>downloading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

						<span class="token keyword">this</span><span class="token punctuation">.</span>downLoadPercent <span class="token operator">=</span> <span class="token number">0</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>downloadedSize <span class="token operator">=</span> <span class="token number">0</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>packageFileSize <span class="token operator">=</span> <span class="token number">0</span>

						downloadTask <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				downloadTask<span class="token punctuation">.</span><span class="token function">onProgressUpdate</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>downLoadPercent <span class="token operator">=</span> res<span class="token punctuation">.</span>progress<span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>downloadedSize <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>totalBytesWritten <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>packageFileSize <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>totalBytesExpectedToWrite <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">installPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// #ifdef APP-PLUS</span>
				<span class="token comment">// wgt资源包安装</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isWGT<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>installing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>installing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

					<span class="token comment">// wgt包，安装后会提示 安装成功，是否重启</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isWGT<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 强制更新安装完成重启</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
								<span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
								<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'安装成功，正在重启……'</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>

							<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
								<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">const</span> localFilePathRecord <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span>localFilePathKey<span class="token punctuation">)</span>
						uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>localFilePathKey<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
							<span class="token operator">...</span>localFilePathRecord<span class="token punctuation">,</span>
							<span class="token literal-property property">installed</span><span class="token operator">:</span> <span class="token boolean">true</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 如果是安装之前的包，安装失败后删除之前的包</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>installForBeforeFilePath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteSavedFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>installForBeforeFilePath<span class="token punctuation">)</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>installForBeforeFilePath <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// 安装失败需要重新下载安装包</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>installing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

					uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新失败，请重新下载'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">content</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
						<span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// 非wgt包，安装跳出覆盖安装，此处直接返回上一页</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isWGT <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>is_mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP-PLUS</span>
				<span class="token comment">//更新完重启app</span>
				plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token parameter">tempFilePath<span class="token punctuation">,</span> version</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					uni<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						tempFilePath<span class="token punctuation">,</span>
						<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span>
							savedFilePath
						<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>localFilePathKey<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
								version<span class="token punctuation">,</span>
								savedFilePath
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">deleteSavedFile</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				uni<span class="token punctuation">.</span><span class="token function">removeStorageSync</span><span class="token punctuation">(</span>localFilePathKey<span class="token punctuation">)</span>
				<span class="token keyword">return</span> uni<span class="token punctuation">.</span><span class="token function">removeSavedFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					filePath
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">jumpToAppStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">openURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"scss"</span><span class="token operator">&gt;</span>
	page <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">background</span><span class="token operator">:</span> transparent<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>flex<span class="token operator">-</span>center <span class="token punctuation">{<!-- --></span>
		<span class="token comment">/* #ifndef APP-NVUE */</span>
		<span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
		<span class="token comment">/* #endif */</span>
		justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>
		align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>mask <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">position</span><span class="token operator">:</span> fixed<span class="token punctuation">;</span>
		<span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>botton<span class="token operator">-</span>radius <span class="token punctuation">{<!-- --></span>
		border<span class="token operator">-</span>bottom<span class="token operator">-</span>left<span class="token operator">-</span>radius<span class="token operator">:</span> 30rpx<span class="token punctuation">;</span>
		border<span class="token operator">-</span>bottom<span class="token operator">-</span>right<span class="token operator">-</span>radius<span class="token operator">:</span> 30rpx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>content <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">position</span><span class="token operator">:</span> relative<span class="token punctuation">;</span>
		<span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">width</span><span class="token operator">:</span> 600rpx<span class="token punctuation">;</span>
		background<span class="token operator">-</span>color<span class="token operator">:</span> #fff<span class="token punctuation">;</span>
		box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
		<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span> 50rpx<span class="token punctuation">;</span>
		font<span class="token operator">-</span>family<span class="token operator">:</span> Source Han Sans <span class="token constant">CN</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>text <span class="token punctuation">{<!-- --></span>
		<span class="token comment">/* #ifndef APP-NVUE */</span>
		<span class="token literal-property property">display</span><span class="token operator">:</span> block<span class="token punctuation">;</span>
		<span class="token comment">/* #endif */</span>
		line<span class="token operator">-</span>height<span class="token operator">:</span> 200px<span class="token punctuation">;</span>
		text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>content<span class="token operator">-</span>top <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
		<span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span>195rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">width</span><span class="token operator">:</span> 600rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 270rpx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>content<span class="token operator">-</span>top<span class="token operator">-</span>text <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> 45rpx<span class="token punctuation">;</span>
		font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token constant">F8F8FA</span><span class="token punctuation">;</span>
		<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
		<span class="token literal-property property">top</span><span class="token operator">:</span> 120rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">left</span><span class="token operator">:</span> 50rpx<span class="token punctuation">;</span>
		z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>content<span class="token operator">-</span>header <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 70rpx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>title <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> 33rpx<span class="token punctuation">;</span>
		font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>
		<span class="token comment">/* #3DA7FF  $my-theme-olor */</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #3DA7FF<span class="token punctuation">;</span>  
		line<span class="token operator">-</span>height<span class="token operator">:</span> 38px<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>footer <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 150rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
		align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
		justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>around<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>box<span class="token operator">-</span>des<span class="token operator">-</span>scroll <span class="token punctuation">{<!-- --></span>
		box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
		<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span> 40rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 200rpx<span class="token punctuation">;</span>
		text<span class="token operator">-</span>align<span class="token operator">:</span> left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>box<span class="token operator">-</span>des <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> 26rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">000000</span><span class="token punctuation">;</span>
		line<span class="token operator">-</span>height<span class="token operator">:</span> 50rpx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>progress<span class="token operator">-</span>box <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>progress <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">90</span><span class="token operator">%</span><span class="token punctuation">;</span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 40rpx<span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> 35px<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>close<span class="token operator">-</span>img <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">width</span><span class="token operator">:</span> 70rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> 70rpx<span class="token punctuation">;</span>
		z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
		<span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token operator">-</span>120rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">%</span> <span class="token operator">-</span> 70rpx <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>content<span class="token operator">-</span>button <span class="token punctuation">{<!-- --></span>
		text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
		<span class="token literal-property property">flex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> 30rpx<span class="token punctuation">;</span>
		font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token constant">FFFFFF</span><span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> 40rpx<span class="token punctuation">;</span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span> 18rpx<span class="token punctuation">;</span>

		<span class="token literal-property property">height</span><span class="token operator">:</span> 80rpx<span class="token punctuation">;</span>
		line<span class="token operator">-</span>height<span class="token operator">:</span> 80rpx<span class="token punctuation">;</span>

		<span class="token literal-property property">background</span><span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #1785ff<span class="token punctuation">,</span> #3DA7FF<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span>flex<span class="token operator">-</span>column <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
		flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>
		align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre> 
<ul><li><strong>需要在pages.json文件中配置路由信息</strong></li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// ……app更新</span>
				    <span class="token punctuation">{<!-- --></span>
				        <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"uni_modules/pages/upgrade-popup"</span><span class="token punctuation">,</span> <span class="token comment">// 文件路劲</span>
				        <span class="token string-property property">"style"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				            <span class="token string-property property">"disableScroll"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				            <span class="token string-property property">"app-plus"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				                <span class="token string-property property">"backgroundColorTop"</span><span class="token operator">:</span> <span class="token string">"transparent"</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"background"</span><span class="token operator">:</span> <span class="token string">"transparent"</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"titleNView"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"scrollIndicator"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"popGesture"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"animationType"</span><span class="token operator">:</span> <span class="token string">"fade-in"</span><span class="token punctuation">,</span>
				                <span class="token string-property property">"animationDuration"</span><span class="token operator">:</span> <span class="token number">200</span>
				
				            <span class="token punctuation">}</span>
				        <span class="token punctuation">}</span>
				    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3Appvue_onLaunch_830"></a>3.在App.vue页面的 <code>onLaunch</code>中调用刚才的方法即可</h3> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
	<span class="token keyword">import</span> update <span class="token keyword">from</span> <span class="token string">'@/uni_modules/utils/check-update.js'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 全局变量
     */</span>
    <span class="token literal-property property">globalData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/**
     * 初始化完成时触发
     */</span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 小程序主动更新</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			
			<span class="token comment">//app更新</span>
			<span class="token comment">// #ifdef APP-PLUS</span>
			  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    
      <span class="token comment">/**
       * 小程序主动更新
       */</span>
      <span class="token function">updateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> updateManager <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getUpdateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        updateManager<span class="token punctuation">.</span><span class="token function">onCheckForUpdate</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 请求完新版本信息的回调</span>
          <span class="token comment">// console.log(res.hasUpdate)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        updateManager<span class="token punctuation">.</span><span class="token function">onUpdateReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新提示'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'新版本已经准备好，即将重启应用'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span>
                updateManager<span class="token punctuation">.</span><span class="token function">applyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        updateManager<span class="token punctuation">.</span><span class="token function">onUpdateFailed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 新的版本下载失败</span>
          uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新提示'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'新版本下载失败'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"scss"</span><span class="token operator">&gt;</span>
  <span class="token comment">/* 引入uView库样式 */</span>
  @<span class="token keyword">import</span> <span class="token string">"uview-ui/index.scss"</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
  <span class="token comment">/* 项目基础样式 */</span>
  @<span class="token keyword">import</span> <span class="token string">"./app.scss"</span><span class="token punctuation">;</span>

  <span class="token punctuation">.</span>uni<span class="token operator">-</span>app<span class="token operator">--</span>showlayout<span class="token operator">+</span>uni<span class="token operator">-</span>tabbar<span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar<span class="token operator">-</span>bottom<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>uni<span class="token operator">-</span>app<span class="token operator">--</span>showlayout<span class="token operator">+</span>uni<span class="token operator">-</span>tabbar<span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar<span class="token operator">-</span>bottom <span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>uni<span class="token operator">-</span>app<span class="token operator">--</span>showlayout<span class="token operator">+</span>uni<span class="token operator">-</span>tabbar<span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar<span class="token operator">-</span>top<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>uni<span class="token operator">-</span>app<span class="token operator">--</span>showlayout<span class="token operator">+</span>uni<span class="token operator">-</span>tabbar<span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar<span class="token operator">-</span>top <span class="token punctuation">.</span>uni<span class="token operator">-</span>tabbar <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token keyword">var</span><span class="token punctuation">(</span><span class="token operator">--</span>window<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token keyword">var</span><span class="token punctuation">(</span><span class="token operator">--</span>window<span class="token operator">-</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre> 
<h3><a id="wgt__913"></a>打包wgt包 部署</h3> 
<ul><li><strong>1.修改版本号，在manifest.json的基础配置里修改</strong><br> <img src="https://images2.imgbox.com/af/77/v1UsRoEn_o.png" alt="在这里插入图片描述"></li><li><strong>打包wgt包，在发行里点击打包wgt</strong><br> <img src="https://images2.imgbox.com/81/46/M02QerGV_o.png" alt="在这里插入图片描述"></li><li><strong>3.将wgt包下载上传到服务器，后端配置相同的版本号即可</strong></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbf98011dd0d03ca7da4eb32ef5c08c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue路由中间件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5db43b99ca283c399200da26225cd046/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ModuleNotFoundError: No module named ‘fcntl‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>