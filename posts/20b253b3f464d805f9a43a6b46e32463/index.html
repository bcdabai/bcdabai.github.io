<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux同步时间的方法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux同步时间的方法" />
<meta property="og:description" content="方法一：非生产时使用 第一种是在所有机器上，使用连接工具的并发命令功能，同时运行修改时间命令，比如执行date -s “2019-05-25 17:00:00” ，这个方法适合自己测试环境用
第二种就是安装了一个ntpdate命令，然后同步时间的master是一个所有人都可以用的master
安装工具 yum -y install ntp ntpdate 同步网络时间 ntpdate cn.pool.ntp.org 方法二：NTP服务 使用ntpd server，为多台机器同步时间，这里以三台机器为例
第一步：在三台机器上运行ntpdate命令，验证是否安装有ntpdate，如果没有运行yum -y install ntp安装该服务
第二步：选出一台机器，做master，编辑它的/etc/ntp.conf文件
进入配置文件之后，首先将配置文件中所有的restrict开头的行注释掉，如下面这种
其后另写一条生效的服务配置
restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap 格式：restrict 允许的ip范围一般默认就行 mask 允许同步的网段子网掩码 nomodify notrap 将所有server开头的行全部注释，添加如下的新信息
server 127.127.1.0 fudge 127.127.1.0 stratum 10 第三步：master启动ntp服务并开机自启
service ntpd restart chkconfig ntpd on 第四步：所有子节点运行命令，同步master的时间。
ntpdate master节点ip 如果子节点运行命令之后，如果提示no server那就等两分钟左右在在运行 如果提示`the NTP socket is in use, exiting`说明当前子节点的ntp服务启动了，你要关掉它 第五步：让集群自己同步时间，有两种方式
第一种方式：通过crontab来完成同步，推荐这种，容易控制时间同步频率 所有子节点配置定时任务，半分钟同步一次，命令如下： crontab -e 上面的命令会打开linux自带的定时任务列表在其中添加如下一条信息： 30 * * * * /usr/sbin/ntpdate master的ip或域名 &gt;&gt; /root/ntpdate." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/20b253b3f464d805f9a43a6b46e32463/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-04T13:17:28+08:00" />
<meta property="article:modified_time" content="2022-11-04T13:17:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux同步时间的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><font color="reddf">方法一：非生产时使用</font></h4> 
<p>第一种是在所有机器上，使用连接工具的并发命令功能，同时运行修改时间命令，比如执行date -s “2019-05-25 17:00:00” ，这个方法适合自己测试环境用</p> 
<p>第二种就是安装了一个ntpdate命令，然后同步时间的master是一个所有人都可以用的master</p> 
<pre><code class="prism language-bash">安装工具
yum -y <span class="token function">install</span> ntp ntpdate
同步网络时间
ntpdate cn.pool.ntp.org
</code></pre> 
<h4><font color="reddf">方法二：NTP服务</font></h4> 
<p>使用ntpd server，为多台机器同步时间，这里以三台机器为例</p> 
<p>第一步：在三台机器上运行<font color="red">ntpdate</font>命令，验证是否安装有ntpdate，如果没有运行<font color="red">yum -y install ntp</font>安装该服务</p> 
<p>第二步：选出一台机器，做master，编辑它的<font color="red">/etc/ntp.conf</font>文件</p> 
<p>进入配置文件之后，首先将配置文件中所有的restrict开头的行注释掉，如下面这种<br> <img src="https://images2.imgbox.com/cd/30/ATRuhbNz_o.png" alt="在这里插入图片描述"><br> 其后另写一条生效的服务配置</p> 
<pre><code class="prism language-bash">restrict <span class="token number">192.168</span>.1.0 mask <span class="token number">255.255</span>.255.0 nomodify notrap
格式：restrict 允许的ip范围一般默认就行 mask 允许同步的网段子网掩码 nomodify notrap
</code></pre> 
<p>将所有server开头的行全部注释，添加如下的新信息</p> 
<pre><code class="prism language-bash">server <span class="token number">127.127</span>.1.0
fudge <span class="token number">127.127</span>.1.0 stratum <span class="token number">10</span>
</code></pre> 
<p>第三步：master启动ntp服务并开机自启</p> 
<pre><code class="prism language-bash"><span class="token function">service</span> ntpd restart
<span class="token function">chkconfig</span> ntpd on
</code></pre> 
<p>第四步：所有子节点运行命令，同步master的时间。</p> 
<pre><code class="prism language-bash">ntpdate  master节点ip

如果子节点运行命令之后，如果提示no server那就等两分钟左右在在运行
如果提示<span class="token variable"><span class="token variable">`</span>the NTP socket is <span class="token keyword">in</span> use, exiting<span class="token variable">`</span></span>说明当前子节点的ntp服务启动了，你要关掉它
</code></pre> 
<p>第五步：让集群自己同步时间，有两种方式</p> 
<pre><code class="prism language-bash">第一种方式：通过crontab来完成同步，推荐这种，容易控制时间同步频率

所有子节点配置定时任务，半分钟同步一次，命令如下：
<span class="token function">crontab</span> -e

上面的命令会打开linux自带的定时任务列表在其中添加如下一条信息：
<span class="token number">30</span> * * * * /usr/sbin/ntpdate master的ip或域名 <span class="token operator">&gt;&gt;</span> /root/ntpdate.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>

后期需要观察一下/root/ntpdate.log中有没有定时同步时间的运行日志
</code></pre> 
<p>说明一下：<code>30 * * * * </code>代表了五个时间占位符，上面写的代表30分钟同步一次，你可以自己改，五个站位符号按顺序分别为分、时、日、月、天</p> 
<pre><code class="prism language-bash">*    *    *    *    *
<span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    +----- 星期中星期几 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>星期天 为0<span class="token punctuation">)</span>
<span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    +---------- 月份 <span class="token punctuation">(</span><span class="token number">1</span> - <span class="token number">12</span><span class="token punctuation">)</span> 
<span class="token operator">|</span>    <span class="token operator">|</span>    +--------------- 一个月中的第几天 <span class="token punctuation">(</span><span class="token number">1</span> - <span class="token number">31</span><span class="token punctuation">)</span>
<span class="token operator">|</span>    +-------------------- 小时 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">23</span><span class="token punctuation">)</span>
+------------------------- 一小时中的某分钟 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">59</span><span class="token punctuation">)</span>

一般情况下直接指定数字就够了，但是它可以指定表达式来完成更多变的事件指定，表达式很简单，网上搜索案例就行了
</code></pre> 
<pre><code class="prism language-bash">第二种方式：依赖于ntp服务

所有子节点同样配置/etc/ntp.conf文件，不过不需要master那样麻烦，只需要注释所有restrict和server配置，添加“server master节点ip”即可，最后保证所有节点启动并设置开机自启ntp服务

但是这个方法推荐，有时候不一定灵不灵，而且无法灵活的控制频率
</code></pre> 
<h4><font color="reddf">方法三：chrony 不推荐用</font></h4> 
<p>a) 所有节点，执行<code>rpm -qa | grep chrony</code>检查是否已经安装chrony，若没有执行yum -y install chrony安装</p> 
<p>b) vi /etc/chrony.conf修改如下<br> <img src="https://images2.imgbox.com/7c/82/Tv6s8p0U_o.png" alt="在这里插入图片描述"><br> c) scp命令分发各节点，同步各节点的chrony.conf配置</p> 
<p>d) 启动chrony服务并设为开机启动</p> 
<pre><code class="prism language-bash">systemctl <span class="token builtin class-name">enable</span> chronyd.service
systemctl start chronyd.service
systemctl status chronyd.service
</code></pre> 
<p>e) 查看时间同步源：chronyc sources -v<br> <img src="https://images2.imgbox.com/78/c6/9TZbD8kg_o.png" alt="在这里插入图片描述"><br> f) 查看时间同步源状态：chronyc sourcestats -v<br> <img src="https://images2.imgbox.com/50/ee/ddPYJXXq_o.png" alt="在这里插入图片描述"><br> g) 检查是否已经同步过：timedatectl（NTP synchronized）<br> <img src="https://images2.imgbox.com/35/23/afoJD9dm_o.png" alt="在这里插入图片描述"></p> 
<p><code>之所以不推荐使用改服务，是因为它的运行需要时区的设置，默认的时区不是中国时区，可是想改时区特别麻烦，多数时候改了之后无效，作者本人之前用的时候是将系统时区，再到服务时区全部改了才生效的，中间折腾了很久，所以用过一次以后再也不用这个服务了</code></p> 
<pre><code class="prism language-bash">先改服务时区:
timedatectl status
timedatectl list-timezones
timedatectl set-timezone <span class="token string">"Asia/Shanghai"</span>
chronyc -a makestep

--------------------------------------------

后改系统时区:
先查看服务器时区用的那个
<span class="token function">ls</span> -l /etc/localtime

如果要修改运行 tzselect 命令
之后依次选择 Asia -<span class="token operator">&gt;</span> Shanghai

设置完还没完，要手动更改时区文件
<span class="token function">rm</span> -rf /etc/localtime
<span class="token function">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3eb0b81420b989234fe7810730409aba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">银河麒麟V4服务器升级openssh</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/046f839294272439f5db1997957074b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python基于改进Unet的新冠肺炎等级分割系统（源码＆教程）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>