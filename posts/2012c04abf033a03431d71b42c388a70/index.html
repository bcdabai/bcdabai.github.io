<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android NDK JNI配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android NDK JNI配置" />
<meta property="og:description" content="android NDK JNI配置 ！！！！！！！！！！！！！！！！！！！
首先配置好android SDK 以及JNI
使用编译器android sudo
！！！！！！！！！！！！！！！！！！！
新建项目-基础配置阶段一 新建项目 选择project视图
新建JNI
在文件夹中创建一个Android.mk文件 （就是jni所在路径的makefile）写入一下内容
LOCAL_PATH:=$(call my-dir) include $(CLEAR_VARS) #libtestjni.so LOCAL_MODULE := testjni LOCAL_SRC_FILES := test.cpp LOCAL_LDLIBS := -llog include $(BUILD_SHARED_LIBRARY) 在app的build.gradle中的android 范围内加入
sourceSets { main.jniLibs { //表示生产的so文件所在路径在什么位置 source { srcDirs = [&#39;../libs&#39;] } } } 删除 main { jni.srcDirs = [‘src/main/jni’, ‘…/JNI/’] }
在JNI中创建一个test.cpp
void testJni_Hello() { return; } 使用Windows PowerShell （win10自带工具）
cd JNI目录
ndk-build.cmd
运行示例：
PS C:\Users\Daidenghui&gt; cd E:\02course\MyApplication\MyApplication09\JNI" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2012c04abf033a03431d71b42c388a70/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-15T18:26:15+08:00" />
<meta property="article:modified_time" content="2021-10-15T18:26:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android NDK JNI配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="android_NDK_JNI_0"></a>android NDK JNI配置</h2> 
<blockquote> 
 <p>！！！！！！！！！！！！！！！！！！！</p> 
 <p>首先配置好android SDK 以及JNI</p> 
 <p>使用编译器android sudo</p> 
 <p>！！！！！！！！！！！！！！！！！！！</p> 
</blockquote> 
<h3><a id="_10"></a>新建项目-基础配置阶段一</h3> 
<ol><li> <p>新建项目 选择project视图</p> </li><li> <p>新建JNI<br> <img src="https://images2.imgbox.com/d1/b8/ZlEXYgZA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9e/62/PuITXBW6_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<p><img src="https://images2.imgbox.com/73/ab/Guy4DVTV_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li> <p>在文件夹中创建一个Android.mk文件 （就是jni所在路径的makefile）写入一下内容</p> <pre><code>LOCAL_PATH:=$(call my-dir)

include $(CLEAR_VARS)

#libtestjni.so
LOCAL_MODULE := testjni
LOCAL_SRC_FILES := test.cpp 
LOCAL_LDLIBS := -llog

include $(BUILD_SHARED_LIBRARY)
</code></pre> </li><li> <p>在app的build.gradle中的android 范围内加入</p> <pre><code>	sourceSets {
        main.jniLibs {
            //表示生产的so文件所在路径在什么位置
            source {
                srcDirs = ['../libs']
            }
        }
    }
</code></pre> </li><li> <p><strong>删除 main { jni.srcDirs = [‘src/main/jni’, ‘…/JNI/’] }</strong></p> </li><li> <p>在JNI中创建一个test.cpp</p> <pre><code>void testJni_Hello()
{
    return;
}
</code></pre> </li><li> <p>使用Windows PowerShell （win10自带工具）</p> <p><code>cd JNI目录</code></p> <p><code>ndk-build.cmd</code></p> </li></ol> 
<p>运行示例：</p> 
<blockquote> 
 <p>PS C:\Users\Daidenghui&gt; cd E:\02course\MyApplication\MyApplication09\JNI<br> PS E:\02course\MyApplication\MyApplication09\JNI&gt; ndk-build.cmd<br> Android NDK: APP_PLATFORM not set. Defaulting to minimum supported version android-14.<br> [arm64-v8a] Compile++ : testjni &lt;= test.cpp<br> [arm64-v8a] StaticLibrary : libstdc++.a<br> [arm64-v8a] SharedLibrary : libtestjni.so<br> [arm64-v8a] Install : libtestjni.so =&gt; libs/arm64-v8a/libtestjni.so<br> [x86_64] Compile++ : testjni &lt;= test.cpp<br> [x86_64] StaticLibrary : libstdc++.a<br> [x86_64] SharedLibrary : libtestjni.so<br> [x86_64] Install : libtestjni.so =&gt; libs/x86_64/libtestjni.so<br> [mips64] Compile++ : testjni &lt;= test.cpp<br> [mips64] StaticLibrary : libstdc++.a<br> [mips64] SharedLibrary : libtestjni.so<br> [mips64] Install : libtestjni.so =&gt; libs/mips64/libtestjni.so<br> [armeabi-v7a] Compile++ thumb: testjni &lt;= test.cpp<br> [armeabi-v7a] StaticLibrary : libstdc++.a<br> [armeabi-v7a] SharedLibrary : libtestjni.so<br> [armeabi-v7a] Install : libtestjni.so =&gt; libs/armeabi-v7a/libtestjni.so<br> [armeabi] Compile++ thumb: testjni &lt;= test.cpp<br> [armeabi] StaticLibrary : libstdc++.a<br> [armeabi] SharedLibrary : libtestjni.so<br> [armeabi] Install : libtestjni.so =&gt; libs/armeabi/libtestjni.so<br> [x86] Compile++ : testjni &lt;= test.cpp<br> [x86] StaticLibrary : libstdc++.a<br> [x86] SharedLibrary : libtestjni.so<br> [x86] Install : libtestjni.so =&gt; libs/x86/libtestjni.so<br> [mips] Compile++ : testjni &lt;= test.cpp<br> [mips] StaticLibrary : libstdc++.a<br> [mips] SharedLibrary : libtestjni.so<br> [mips] Install : libtestjni.so =&gt; libs/mips/libtestjni.so<br> PS E:\02course\MyApplication\MyApplication09\JNI&gt;</p> 
</blockquote> 
<h3><a id="_103"></a>阶段二</h3> 
<ol><li> <p>在在src中 跟Activity同一层路径 创建一个 专门调用JNI的类 OBOJNI.class</p> <pre><code>//专门调用jni C++接口的类
public class OBOJNI {


    public static OBOJNI getInstance() {
        if (instance == null) {
            instance = new OBOJNI();
        }

        return instance;
    }

    private static  OBOJNI instance = null;


    //提供一个调用JNI接口的成员方法
    public native void hello_jni();


    //加载cpp给提供的 动态库
    static {
        System.loadLibrary("testjni"); //libtestjni.so  testjni要和Android.mk里面的模块名字是一样的
    }

}
</code></pre> </li><li> <p>使用 Windows PowerShell 进入java目录</p> <p>然后执行<code>javah -jni com.你的包名.OBOJNI</code><br> 运行示例：</p> 
  <blockquote> 
   <p>PS E:\02course\MyApplication\MyApplication09\JNI&gt; cd E:\02course\MyApplication\MyApplication09\app\src\main\java<br> PS E:\02course\MyApplication\MyApplication09\app\src\main\java&gt; ls</p> 
   <pre><code>目录: E:\02course\MyApplication\MyApplication09\app\src\main\java
</code></pre> 
   <p>Mode LastWriteTime Length Name</p> 
   <hr> 
   <p>d----- 2021/10/15 17:32 com</p> 
   <p>PS E:\02course\MyApplication\MyApplication09\app\src\main\java&gt; javah -jni com.ddh.dai.myapplication09.OBOJNI<br> 错误: 编码GBK的不可映射字符<br> 错误: 编码GBK的不可映射字符<br> 错误: 编码GBK的不可映射字符<br> 错误: 编码GBK的不可映射字符</p> 
  </blockquote> <p>成功后会多一个文件<br> <img src="https://images2.imgbox.com/8e/bd/kyL8NNFE_o.png" alt="在这里插入图片描述"></p> </li><li> <p>将标注部分加入test.cpp中<br> <img src="https://images2.imgbox.com/c1/83/JuPQmxxi_o.png" alt="在这里插入图片描述"></p> <p>修改test.cpp为</p> <pre><code class="prism language-C">//
// Created by Daidenghui on 2021/10/15.
//

#include &lt;jni.h&gt;
#include &lt;android/log.h&gt;


void testJni_Hello()
{
    __android_log_print(ANDROID_LOG_ERROR,"testjni", "JNI: I am OK");
    return;
}

#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_ddh_dai_myapplication09_OBOJNI
 * Method:    hello_jni
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_com_ddh_dai_myapplication09_OBOJNI_hello_1jni
(JNIEnv *ev, jobject){
    testJni_Hello();
}

#ifdef __cplusplus
}
#endif

</code></pre> </li><li> <p>再次使用Windows PowerShell进入JNI目录</p> <p>执行：ndk-bulid.com</p> </li></ol> 
<p>运行示例：</p> 
<blockquote> 
 <p>PS E:\02course\MyApplication\MyApplication09\JNI&gt; cd E:\02course\MyApplication\MyApplication09\JNI<br> PS E:\02course\MyApplication\MyApplication09\JNI&gt; ndk-build.cmd<br> [arm64-v8a] Compile++ : testjni &lt;= test.cpp<br> [arm64-v8a] SharedLibrary : libtestjni.so<br> [arm64-v8a] Install : libtestjni.so =&gt; libs/arm64-v8a/libtestjni.so<br> [x86_64] Compile++ : testjni &lt;= test.cpp<br> [x86_64] SharedLibrary : libtestjni.so<br> [x86_64] Install : libtestjni.so =&gt; libs/x86_64/libtestjni.so<br> [mips64] Compile++ : testjni &lt;= test.cpp<br> [mips64] SharedLibrary : libtestjni.so<br> [mips64] Install : libtestjni.so =&gt; libs/mips64/libtestjni.so<br> [armeabi-v7a] Compile++ thumb: testjni &lt;= test.cpp<br> [armeabi-v7a] SharedLibrary : libtestjni.so<br> [armeabi-v7a] Install : libtestjni.so =&gt; libs/armeabi-v7a/libtestjni.so<br> [armeabi] Compile++ thumb: testjni &lt;= test.cpp<br> [armeabi] SharedLibrary : libtestjni.so<br> [armeabi] Install : libtestjni.so =&gt; libs/armeabi/libtestjni.so<br> [x86] Compile++ : testjni &lt;= test.cpp<br> [x86] SharedLibrary : libtestjni.so<br> [x86] Install : libtestjni.so =&gt; libs/x86/libtestjni.so<br> [mips] Compile++ : testjni &lt;= test.cpp<br> [mips] SharedLibrary : libtestjni.so<br> [mips] Install : libtestjni.so =&gt; libs/mips/libtestjni.so</p> 
</blockquote> 
<p>然后运行即可</p> 
<p>看到输出就表示成功</p> 
<p><img src="https://images2.imgbox.com/c2/0b/WmddnAQ3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="end_241"></a>end</h3> 
<p><strong>每次修改.cpp文件后都需要使用Windows PowerShell进入JNI目录执行：ndk-bulid.com</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9a539c05414034a288509e6739dc4174/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git Pull Failed 原因和解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/29b60236d27af93c3d68b61cd74f8371/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络IP地址管理的重要性</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>