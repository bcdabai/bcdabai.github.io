<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker安装mysql步骤及远程连接问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker安装mysql步骤及远程连接问题" />
<meta property="og:description" content="1. 在docker仓库中搜索mysql的镜像：
docker search mysql 下载镜像： docker pull mysql
2. 查看本地镜像：
docker images -a 参数-a 表示所有 3.运行mysql
docker run --name mysql \ --restart=always \ -p 3306:3306 \ -v /data/mysql/log:/var/log/mysql \ -v /data/mysql/data:/var/lib/mysql \ -v /data/mysql/conf:/etc/mysql/conf.d \ -e MYSQL_ROOT_PASSWORD=root \ -d mysql 命令说明：
-p 3306:3306：将容器的3306端口映射到主机的3306端口，主机端口:docker端口--name 容器名称1.-v /mydata/mysql/log:/var/log/mysql(日志文件挂载)
将容器中的日志文件夹/var/log/mysql挂载到主机对应的/mydata/mysql文件夹中
2.-v /mydata/mysql/data:/var/lib/mysql(数据文件挂载)
将容器中的数据文件夹/var/lib/mysql挂载到主机对应的/mydata/mysql/data文件夹中
3.-v /mydata/mysql/conf:/etc/mysql(配置文件挂载)
将容器的配置文件夹/etc/mysql挂载到主机对应的/mydata/mysql/conf文件夹中-e MYSQL_ROOT_PASSWORD=123456：初始化root用户的密码-d: 后台运行容器，并返回容器ID--restart=always 自动启动mysql：指定用这个镜像来创建运行实例 4. 查看运行中的容器：
docker ps （可加参数 -a 表示所有，如果不加这个参数只会展示运行状态的容器，
按容器即服务的思想，某种程度上可以把容器也当作服务，）
这样 mysql 就已安装并成功启动，处于运行状态了。
可以通过 docker port 容器name 查看对应端口" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/76e0a799fab0588dc1d38c2f4b9896c5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-29T18:22:53+08:00" />
<meta property="article:modified_time" content="2023-03-29T18:22:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker安装mysql步骤及远程连接问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1. 在docker仓库中搜索mysql的镜像：</p> 
<p> docker search mysql  <br> 下载镜像： docker pull mysql</p> 
<p>2.     查看本地镜像：</p> 
<p> docker images -a               参数-a 表示所有 </p> 
<p></p> 
<p>3.运行mysql</p> 
<pre><code class="language-bash">docker run --name mysql \
--restart=always \
-p 3306:3306 \
-v /data/mysql/log:/var/log/mysql \
-v /data/mysql/data:/var/lib/mysql \
-v /data/mysql/conf:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql</code></pre> 
<p></p> 
<p>命令说明：</p> 
<ul><li><strong>-p 3306:3306：</strong>将容器的3306端口映射到主机的3306端口，主机端口:docker端口</li><li><strong>--name</strong>  容器名称</li><li><strong>1.-v /mydata/mysql/log:/var/log/mysql(日志文件挂载)<br> 将容器中的日志文件夹/var/log/mysql挂载到主机对应的/mydata/mysql文件夹中<br> 2.-v /mydata/mysql/data:/var/lib/mysql(数据文件挂载)<br> 将容器中的数据文件夹/var/lib/mysql挂载到主机对应的/mydata/mysql/data文件夹中<br> 3.-v /mydata/mysql/conf:/etc/mysql(配置文件挂载)<br> 将容器的配置文件夹/etc/mysql挂载到主机对应的/mydata/mysql/conf文件夹中</strong></li><li><strong>-e MYSQL_ROOT_PASSWORD=123456：</strong>初始化root用户的密码</li><li><strong>-d:</strong> 后台运行容器，并返回容器ID</li><li><strong>--restart=always</strong>    自动启动</li><li>mysql：指定用这个镜像来创建运行实例</li></ul> 
<p></p> 
<p>4. 查看运行中的容器：</p> 
<p>docker ps  <br> （可加参数 -a 表示所有，如果不加这个参数只会展示运行状态的容器，</p> 
<p>  按容器即服务的思想，某种程度上可以把容器也当作服务，）</p> 
<p>这样 mysql 就已安装并成功启动，处于运行状态了。</p> 
<p>可以通过 docker port 容器name 查看对应端口</p> 
<p>5. 可能出现远程连接失败</p> 
<p><strong>通过navicat 远程连接docker里的mysql结果发现连接不了出现了一个</strong><strong>10060 unknow error</strong></p> 
<p><strong>要么是网络问题，要么就是权限问题，要么就是防火墙的问题（iptables）,要么就是端口号不正确。</strong></p> 
<p><strong>（1）、如果你到了下面这一步，说明你的网络是没问题的</strong></p> 
<p><strong>//进入容器的命令</strong></p> 
<p><strong>docker exec -it mysql bash</strong></p> 
<blockquote> 
 <p></p> 
 <p><strong>[root@iZbp17yjchz883bn0kud44Z service]# docker exec -it mysql bash<br> bash-4.4# mysql -uroot -p<br> Enter password: <br> Welcome to the MySQL monitor.  Commands end with ; or \g.<br> Your MySQL connection id is 8<br> Server version: 8.0.32 MySQL Community Server - GPL</strong></p> 
 <p><strong>Copyright (c) 2000, 2023, Oracle and/or its affiliates.</strong></p> 
 <p><strong>Oracle is a registered trademark of Oracle Corporation and/or its<br> affiliates. Other names may be trademarks of their respective<br> owners.</strong></p> 
 <p><strong>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</strong></p> 
 <p><strong>mysql&gt; show databases;<br> +--------------------+<br> | Database           |<br> +--------------------+<br> | information_schema |<br> | mysql              |<br> | performance_schema |<br> | sys                |<br> +--------------------+<br> 4 rows in set (0.00 sec)</strong></p> 
 <p><strong>mysql&gt; </strong><br>  </p> 
</blockquote> 
<p><strong>（2）、权限问题，如果权限问题的话，你就尝试更改一下权限，mysql账户是否不允许远程连接。如果无法连接可以尝试以下方法：</strong></p> 
<p>创建账户:create user '用户名'@'访问主机' identified by '密码';<br> 赋予权限:grant 权限列表 on 数据库 to '用户名'@'访问主机' ;(修改权限时在后面加with grant option)</p> 
<p></p> 
<blockquote> 
 <pre>#添加远程登录用户
CREATE USER 'liaozesong'@'%' IDENTIFIED WITH mysql_native_password BY 'Lzslov123!';
GRANT ALL PRIVILEGES ON *.* TO 'liaozesong'@'%';</pre> 
</blockquote> 
<p><strong>或者</strong></p> 
<blockquote> 
 <p>update user set host = "%" where user='root';<strong> </strong></p> 
</blockquote> 
<blockquote> 
 <p><strong>FLUSH PRIVILEGES; //需要输入次命令使修改生效</strong></p> 
</blockquote> 
<p><strong>（3）、防火墙问题：很多时候在liunx系统上安装了web服务应用后（如tomcat、apache等），需要让其它电脑能访问到该应用，而linux系统（centos-7、redhat等）的防火墙是默认只对外开放了22端口，可能没有对mysql的3306开放端口。</strong></p> 
<p><strong>centos7修改防火墙：</strong></p> 
<blockquote> 
 <p>firewall-cmd --state</p> 
</blockquote> 
<p><img alt="" src="https://images2.imgbox.com/dc/2d/XdrUPzBh_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/23/e5/PZCmNS0n_o.png"></p> 
<p><strong>如果返回的是 “not running”，那么需要先开启防火墙；</strong></p> 
<ol><li> <p>开启防火墙</p> </li></ol> 
<hr> 
<pre><code>systemctl start firewalld.service</code></pre> 
<p><img alt="" src="https://images2.imgbox.com/5a/73/koLJoEJK_o.png"></p> 
<p> </p> 
<p>再次查看防火墙状态，发现已开启！</p> 
<p>开启指定端口</p> 
<blockquote> 
 <p>firewall-cmd --zone=public --add-port=3306/tcp --permanent<br> 显示 success 表示成功<br> –zone=public 表示作用域为公共的<br> –add-port=443/tcp 添加 tcp 协议的端口端口号为 443<br> –permanent 永久生效，如果没有此参数，则只能维持当前 服 务生命周期内，重新启动后失效；</p> 
</blockquote> 
<p>重启防火墙</p> 
<blockquote> 
 <p>systemctl restart firewalld.service<br> 系统没有任何提示表示成功！</p> 
</blockquote> 
<p>重新加载防火墙</p> 
<blockquote> 
 <p>firewall-cmd --reload<br>  </p> 
</blockquote> 
<p><strong>centOs6主机的端口设置在/etc/sysconfig/iptables文件中配置。</strong></p> 
<p><strong>vi编辑器的用法：esc：命令行模式/插入模式；i:插入，wq:保存推出，q:退出，q!:不保存退出</strong></p> 
<p><strong>把-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT 放在下面的位置，不要乱放，这就开放了mysql远程连接的端口,然后重启一下iptables的服务就ok了。</strong></p> 
<p><strong>[root@localhost ~]# vi /etc/sysconfig/iptables</strong></p> 
<p><strong># sample configuration for iptables service<br> # you can edit this manually or use system-config-firewall<br> # please do not ask us to add additional ports/services to this default configuration<br> *filter<br> :INPUT ACCEPT [0:0]<br> :FORWARD ACCEPT [0:0]<br> :OUTPUT ACCEPT [0:0]<br> -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT<br> -A INPUT -p icmp -j ACCEPT<br> -A INPUT -i lo -j ACCEPT<br> -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT//centos-7默认的端口<br> -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT<br> -A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT//tomcat端口<br> -A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT //mysql端口<br> -A INPUT -j REJECT --reject-with icmp-host-prohibited<br> -A FORWARD -j REJECT --reject-with icmp-host-prohibited<br> COMMIT<br> ~</strong></p> 
<p><strong>[root@localhost ~]# service iptables restart<br> Redirecting to /bin/systemctl restart iptables.service<br> [root@localhost ~]#</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ee20d6a27edb9bcd8651d3a7f03d0380/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QT串口助手（实现数据的收发功能）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/814291e1e4f390d47ffcc5694502dc35/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多中间件优雅停机问题处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>