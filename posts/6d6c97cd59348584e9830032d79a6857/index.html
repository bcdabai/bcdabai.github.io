<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【2023TUCTF&amp;NBCTF】Crypto&amp;Web - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【2023TUCTF&amp;NBCTF】Crypto&amp;Web" />
<meta property="og:description" content="title: 2023TUCTF&amp;NBCTF-Crypto&amp;Web
tags: ctf-contest
categories: ctf-contest
博客传送门
文章目录 2023 TUCTF &amp; NBCTFTUCTF-CryptoCustom ECB Cipher | SOLVED题面：题目：考点：ECB 异或移位算法的逆向解题： Keyboard Cipher | SOVLED题面：题目：考点：基础编码转换 键盘密码解题： Table Encryption | SOLVED题面：题目：考点： 文件解密解题： Bludgeon the Booty | SOLVED题面：考点：连接服务器暴力破解解题： NBCTFcrypto/Rivest Shamir forgot Adleman | SOLVED题面：考点：异或题目：解题： crypto/32&#43;32=64 | SOLVED题面：考点：base64题目：解题： crypto/SBG-ABW&#39;s Insanity | SOLVED题面：题目：考点：gcd 整数分解 AES ECB解题： crypto/Too Little Information | SOLVED题面：题目：考点：移位 CopperSmith解题： web/Inspector Gadget题面：题目：考点：信息收集 web/walter&#39;s crystal shop题面：题目：考点：代码审计 SQL注入解题： web/secret tunnel题面：题目：考点：SSRF解题： web/Galleria题面：题目：考点：代码审查解题： 2023 TUCTF &amp; NBCTF TUCTF-Crypto 网址：https://ctfd.tuctf.com/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6d6c97cd59348584e9830032d79a6857/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-07T10:26:32+08:00" />
<meta property="article:modified_time" content="2023-12-07T10:26:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【2023TUCTF&amp;NBCTF】Crypto&amp;Web</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p>title: 2023TUCTF&amp;NBCTF-Crypto&amp;Web<br> tags: ctf-contest<br> categories: ctf-contest</p> 
<hr> 
<p><a href="http://happy-superman.github.io/2023/12/06/2023-12-3-TUCTF-NBCTF/" rel="nofollow">博客传送门</a></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#2023_TUCTF__NBCTF_9" rel="nofollow">2023 TUCTF &amp; NBCTF</a></li><li><a href="#TUCTFCrypto_11" rel="nofollow">TUCTF-Crypto</a></li><li><ul><li><a href="#Custom_ECB_Cipher__SOLVED_15" rel="nofollow">Custom ECB Cipher | SOLVED</a></li><li><ul><li><a href="#_17" rel="nofollow">题面：</a></li><li><a href="#_21" rel="nofollow">题目：</a></li><li><a href="#ECB__54" rel="nofollow">考点：ECB 异或移位算法的逆向</a></li><li><a href="#_56" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#Keyboard_Cipher__SOVLED_140" rel="nofollow">Keyboard Cipher | SOVLED</a></li><li><ul><li><a href="#_142" rel="nofollow">题面：</a></li><li><a href="#_146" rel="nofollow">题目：</a></li><li><a href="#__154" rel="nofollow">考点：基础编码转换 键盘密码</a></li><li><a href="#_156" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#Table_Encryption__SOLVED_170" rel="nofollow">Table Encryption | SOLVED</a></li><li><ul><li><a href="#_172" rel="nofollow">题面：</a></li><li><a href="#_176" rel="nofollow">题目：</a></li><li><a href="#__180" rel="nofollow">考点： 文件解密</a></li><li><a href="#_182" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#Bludgeon_the_Booty__SOLVED_282" rel="nofollow">Bludgeon the Booty | SOLVED</a></li><li><ul><li><a href="#_284" rel="nofollow">题面：</a></li><li><a href="#_298" rel="nofollow">考点：连接服务器暴力破解</a></li><li><a href="#_300" rel="nofollow">解题：</a></li></ul> 
  </li></ul> 
  </li><li><a href="#NBCTF_380" rel="nofollow">NBCTF</a></li><li><ul><li><a href="#cryptoRivest_Shamir_forgot_Adleman__SOLVED_384" rel="nofollow">crypto/Rivest Shamir forgot Adleman | SOLVED</a></li><li><ul><li><a href="#_386" rel="nofollow">题面：</a></li><li><a href="#_390" rel="nofollow">考点：异或</a></li><li><a href="#_392" rel="nofollow">题目：</a></li><li><a href="#_421" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#crypto323264__SOLVED_445" rel="nofollow">crypto/32+32=64 | SOLVED</a></li><li><ul><li><a href="#_447" rel="nofollow">题面：</a></li><li><a href="#base64_451" rel="nofollow">考点：base64</a></li><li><a href="#_453" rel="nofollow">题目：</a></li><li><a href="#_461" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#cryptoSBGABWs_Insanity__SOLVED_486" rel="nofollow">crypto/SBG-ABW's Insanity | SOLVED</a></li><li><ul><li><a href="#_488" rel="nofollow">题面：</a></li><li><a href="#_492" rel="nofollow">题目：</a></li><li><a href="#gcd__AES_ECB_524" rel="nofollow">考点：gcd 整数分解 AES ECB</a></li><li><a href="#_526" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#cryptoToo_Little_Information__SOLVED_622" rel="nofollow">crypto/Too Little Information | SOLVED</a></li><li><ul><li><a href="#_624" rel="nofollow">题面：</a></li><li><a href="#_628" rel="nofollow">题目：</a></li><li><a href="#_CopperSmith_657" rel="nofollow">考点：移位 CopperSmith</a></li><li><a href="#_659" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#webInspector_Gadget_806" rel="nofollow">web/Inspector Gadget</a></li><li><ul><li><a href="#_808" rel="nofollow">题面：</a></li><li><a href="#_812" rel="nofollow">题目：</a></li><li><a href="#_816" rel="nofollow">考点：信息收集</a></li></ul> 
   </li><li><a href="#webwalters_crystal_shop_858" rel="nofollow">web/walter's crystal shop</a></li><li><ul><li><a href="#_860" rel="nofollow">题面：</a></li><li><a href="#_864" rel="nofollow">题目：</a></li><li><a href="#_SQL_922" rel="nofollow">考点：代码审计 SQL注入</a></li><li><a href="#_924" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#websecret_tunnel_954" rel="nofollow">web/secret tunnel</a></li><li><ul><li><a href="#_956" rel="nofollow">题面：</a></li><li><a href="#_960" rel="nofollow">题目：</a></li><li><a href="#SSRF_1026" rel="nofollow">考点：SSRF</a></li><li><a href="#_1028" rel="nofollow">解题：</a></li></ul> 
   </li><li><a href="#webGalleria_1072" rel="nofollow">web/Galleria</a></li><li><ul><li><a href="#_1074" rel="nofollow">题面：</a></li><li><a href="#_1078" rel="nofollow">题目：</a></li><li><a href="#_1176" rel="nofollow">考点：代码审查</a></li><li><a href="#_1178" rel="nofollow">解题：</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="2023_TUCTF__NBCTF_9"></a>2023 TUCTF &amp; NBCTF</h2> 
<h2><a id="TUCTFCrypto_11"></a>TUCTF-Crypto</h2> 
<p>网址：https://ctfd.tuctf.com/</p> 
<h3><a id="Custom_ECB_Cipher__SOLVED_15"></a>Custom ECB Cipher | SOLVED</h3> 
<h4><a id="_17"></a>题面：</h4> 
<p>I have designed a simple algorithm which I believe it’s secure. I am confident you cannot compromise my message with the x value.</p> 
<h4><a id="_21"></a>题目：</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util <span class="token keyword">import</span> number

flag <span class="token operator">=</span> <span class="token string">b"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>

<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> msg <span class="token operator">^</span> msg <span class="token operator">&gt;&gt;</span> x
    msg <span class="token operator">=</span> msg <span class="token operator">^</span> msg <span class="token operator">&lt;&lt;</span> <span class="token number">13</span> <span class="token operator">&amp;</span> <span class="token number">275128763</span>
    msg <span class="token operator">=</span> msg <span class="token operator">^</span> msg <span class="token operator">&lt;&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;</span> <span class="token number">2186268085</span>
    msg <span class="token operator">=</span> msg <span class="token operator">^</span> msg <span class="token operator">&gt;&gt;</span> <span class="token number">14</span>
    <span class="token keyword">return</span> msg

<span class="token keyword">def</span> <span class="token function">transform</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span>
    new_message <span class="token operator">=</span> <span class="token string">b''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        block <span class="token operator">=</span> message<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">4</span> <span class="token punctuation">:</span> i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span>
        block <span class="token operator">=</span> number<span class="token punctuation">.</span>bytes_to_long<span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        block <span class="token operator">=</span> convert<span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        block <span class="token operator">=</span> number<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
        new_message <span class="token operator">+=</span> block
    <span class="token keyword">return</span> new_message

c <span class="token operator">=</span> transform<span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c ='</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
c = e34a707c5c1970cc6375181577612a4ed07a2c3e3f441d6af808a8acd4310b89bd7e2bb9
'''</span>

</code></pre> 
<h4><a id="ECB__54"></a>考点：ECB 异或移位算法的逆向</h4> 
<h4><a id="_56"></a>解题：</h4> 
<p>该题的加密逻辑比较清晰，主要通过transform函数进行块加密，每4个字节的数据进行一次加密，进入到convert函数，我们观察convert函数，可以发现，这里的异或和移位操作全部都是可逆的，所以写出一个逆向解密函数</p> 
<p>其中bits代表比特位数，4个字节为一组，一个字节占8bit，所以bits设置为32</p> 
<pre><code class="prism language-Python">from Crypto.Util import number

# flag = b"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# right shift inverse
def inverse_right(res, shift, bits=32):
    tmp = res
    for i in range(bits // shift):
        tmp = res ^ tmp &gt;&gt; shift
    return tmp

# right shift with mask inverse
def inverse_right_mask(res, shift, mask, bits=32):
    tmp = res
    for i in range(bits // shift):
        tmp = res ^ tmp &gt;&gt; shift &amp; mask
    return tmp

# left shift inverse
def inverse_left(res, shift, bits=32):
    tmp = res
    for i in range(bits // shift):
        print("test:",i)
        tmp = res ^ tmp &lt;&lt; shift
    return tmp

# left shift with mask inverse
def inverse_left_mask(res, shift, mask, bits=32):
    tmp = res
    for i in range(bits // shift):
        # print("test:",i)
        tmp = res ^ tmp &lt;&lt; shift &amp; mask
    return tmp
def convert(msg,x):
    msg = msg ^ msg &gt;&gt; x
    msg = msg ^ msg &lt;&lt; 13 &amp; 275128763
    msg = msg ^ msg &lt;&lt; 20 &amp; 2186268085
    msg = msg ^ msg &gt;&gt; 14
    return msg

def inv_convert(msg,x):
    msg = inverse_right(msg,14)
    msg = inverse_left_mask(msg,20,2186268085)
    msg = inverse_left_mask(msg,13,275128763)
    msg = inverse_right(msg,x)
    return msg

def inv_transform(message,x):
    old_message = b''
    for i in range(int(len(message) / 4)):
        # print(i)
        block = message[i * 4 : i * 4 +4]  #先取出4个字节
        block = number.bytes_to_long(block)
        # print(block.bit_length())
        block = inv_convert(block,x)
        block = number.long_to_bytes(block, 4)
        old_message += block
    return old_message

c = 'e34a707c5c1970cc6375181577612a4ed07a2c3e3f441d6af808a8acd4310b89bd7e2bb9'

a = bytes.fromhex(c)
print(len(a))
for x in range(1,20):
    print(inv_transform(a,x))
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/9f/fJeNDYgT_o.png" alt="image-20231205150011387"></p> 
<p>flag：<code>TUCTF{sRta^s90s-#VgsnzPsta-TjLx7s8Txgs-*Ko}</code></p> 
<h3><a id="Keyboard_Cipher__SOVLED_140"></a>Keyboard Cipher | SOVLED</h3> 
<h4><a id="_142"></a>题面：</h4> 
<p>I designed an algorithm to encrypt a message using my keyboard. No one can decrypt it without any information about my algorithm. Note: Wrap the flag in TUCTF{}.</p> 
<h4><a id="_146"></a>题目：</h4> 
<p>虽然提供了一个enc后缀的文件 但是直接改成txt后缀即可成功打开</p> 
<pre><code class="prism language-txt">0x636a56355279424b615464354946686b566942794e586c4849455279523359674d47394d49486845643045675a316b315569426163304d675a316c715469426163314567616b6c7354534268563252594947745063434178643045675332395149466c6e536d343d
</code></pre> 
<h4><a id="__154"></a>考点：基础编码转换 键盘密码</h4> 
<h4><a id="_156"></a>解题：</h4> 
<p>两步转换</p> 
<p><img src="https://images2.imgbox.com/84/3e/l3ZdgYQ1_o.png" alt="image-20231205155406745"></p> 
<p>得到：</p> 
<p><code>r5yG Ji7y XdV r5yG DrGv 0oL xDwA gY5R ZsC gYjN ZsQ jIlM aWdX kOp 1wA KoP YgJn</code></p> 
<p>类似围棋 四个键围在中间的就是flag的值</p> 
<h3><a id="Table_Encryption__SOLVED_170"></a>Table Encryption | SOLVED</h3> 
<h4><a id="_172"></a>题面：</h4> 
<p>You can’t crack my file! I am the exclusive owner of the encryption key!</p> 
<h4><a id="_176"></a>题目：</h4> 
<p>题目给出了一个文件，其文件名为：<code>table_encryption.xml.enc</code></p> 
<h4><a id="__180"></a>考点： 文件解密</h4> 
<h4><a id="_182"></a>解题：</h4> 
<p>其后缀为enc 表明文件进行了加密</p> 
<p>首先分析一下这个enc的加密模式，他是采用了某种加密方式对于文件里面的内容使用一个密钥进行加密，所以我们推测是采用了异或的加密模式，现在可以直接使用python中对于文件进行二进制流进行读取，相当于读取的内容是密文，然后因为文件后缀是xml文件 所以该文件开头部分我们是已知的，相当于明文已知，所以可以对密钥进行恢复</p> 
<p>用010打开文件 获得前段部分的密文</p> 
<p><img src="https://images2.imgbox.com/31/18/IHFU9sef_o.png" alt="image-20231205204044679"></p> 
<p>数量可以先多一点 然后得到密钥的值后进行微调</p> 
<pre><code class="prism language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'table_encryption.xml.enc'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#以ascii码读取</span>

<span class="token comment">#因为是xml后缀 也就证明 我们是知道这个加密文件中的部分明文 根据部分已知明文恢复密钥</span>
pp <span class="token operator">=</span> <span class="token string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#38</span>
pm <span class="token operator">=</span> <span class="token string">'79 52 17 07 05 00 3B 0A 00 1A 07 08 4E 6E 56 50'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#32  前面的位数不是必须要确定的 而是因为我们推测这个加密的体系 是将文件的内容与给出的密码进行异或</span>

key <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>pp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">int</span><span class="token punctuation">(</span>pm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token comment">#到此我们拿到key = Emoji Moring Sta</span>
<span class="token comment">#所以将目前加密的文件全部逐个十六进制与Emoji Moring Sta 进行异或 即可实现解密</span>

x <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.xml'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>拿到解密后的文件：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>users<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comments<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>varchar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>John Doe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>email</span><span class="token punctuation">&gt;</span></span>john@tuctf.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>email</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>TUCTF{x0r_t4bl3s_R_fun!!!11!}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h3><a id="Bludgeon_the_Booty__SOLVED_282"></a>Bludgeon the Booty | SOLVED</h3> 
<h4><a id="_284"></a>题面：</h4> 
<p>You have found me treasure chest, but can you crack its code?</p> 
<pre><code>  ___________
 /           \
/__|0|0|0|0|__\
|      @      |
|_____________|
</code></pre> 
<p>“This here lock be cursed by the shaman of the swamp to change keys for each attempt” <code>nc chal.tuctf.com 30002</code></p> 
<h4><a id="_298"></a>考点：连接服务器暴力破解</h4> 
<h4><a id="_300"></a>解题：</h4> 
<p>3位密码锁 从000到999全部尝试一遍暴力破解</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> socket  
<span class="token keyword">import</span> time  
  
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 创建socket对象  </span>
    client_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>  
  
    <span class="token comment"># 连接到服务器  想当于使用了nc指令</span>
    server_address <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'chal.tuctf.com'</span><span class="token punctuation">,</span> <span class="token number">30002</span><span class="token punctuation">)</span>  <span class="token comment"># 服务器IP地址和端口号  </span>
    client_socket<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>server_address<span class="token punctuation">)</span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 发送选择旋转锁的命令  </span>
        client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'1\n'</span><span class="token punctuation">)</span>  
        <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
        response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
 
        <span class="token comment"># 发送选择旋转轮子的命令  </span>
        client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'1\n'</span><span class="token punctuation">)</span>  
        <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
        response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
        <span class="token keyword">if</span> <span class="token string">"The chest is still locked!"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
 
 
        <span class="token comment"># 发送选择旋转方向的命令  </span>
        client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'+\n'</span><span class="token punctuation">)</span>  <span class="token comment"># 假设选择顺时针方向  </span>
        <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
        <span class="token keyword">if</span> <span class="token string">"The chest is still locked!"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 发送选择旋转锁的命令  </span>
            client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'1\n'</span><span class="token punctuation">)</span>  
            <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
            response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    
            <span class="token comment"># 发送选择旋转轮子的命令  </span>
            client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'2\n'</span><span class="token punctuation">)</span>  
            <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
            response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
            <span class="token comment"># 发送选择旋转方向的命令  </span>
            client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'+\n'</span><span class="token punctuation">)</span>  <span class="token comment"># 假设选择顺时针方向  </span>
            <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
            response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 发送选择旋转锁的命令  </span>
                client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'1\n'</span><span class="token punctuation">)</span>  
                <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
                response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        
                <span class="token comment"># 发送选择旋转轮子的命令  </span>
                client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'3\n'</span><span class="token punctuation">)</span>  
                <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
                response <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 接收的最大字节数  </span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
                <span class="token comment"># 发送选择旋转方向的命令  </span>
                client_socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'+\n'</span><span class="token punctuation">)</span>  <span class="token comment"># 假设选择顺时针方向  </span>
                <span class="token comment"># time.sleep(2)  # 等待服务器响应  </span>
                <span class="token keyword">if</span> <span class="token string">"The chest is still locked!"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器响应: "</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment"># 关闭连接  </span>
    client_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>  
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>该脚本从000进行遍历，可能耗时会长一点，但是只要抛出结果，脚本就会自动结束</p> 
<h2><a id="NBCTF_380"></a>NBCTF</h2> 
<p>网址：https://nbctf.com/challs</p> 
<h3><a id="cryptoRivest_Shamir_forgot_Adleman__SOLVED_384"></a>crypto/Rivest Shamir forgot Adleman | SOLVED</h3> 
<h4><a id="_386"></a>题面：</h4> 
<p>Exponents took too long. I decided to use an alternative. It won’t about the same right? https://en.wikipedia.org/wiki/RSA*(cryptosystem)*</p> 
<h4><a id="_390"></a>考点：异或</h4> 
<h4><a id="_392"></a>题目：</h4> 
<p>chall.py:</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

n <span class="token operator">=</span> p<span class="token operator">*</span>q
e <span class="token operator">=</span> <span class="token number">123589168751396275896312856328164328381265978316578963271231567137825613822284638216416</span>
m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span><span class="token string">b"nbctf{[REDACTED]}"</span><span class="token punctuation">)</span>

ct <span class="token operator">=</span> <span class="token punctuation">(</span>m<span class="token operator">^</span>e<span class="token punctuation">)</span> <span class="token operator">%</span> n

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"e = "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ct = "</span><span class="token punctuation">,</span> ct<span class="token punctuation">)</span>
</code></pre> 
<p>out.txt:</p> 
<pre><code class="prism language-txt">n =  13431294979312769345517878088407659222785929563176888493659632690735510803353339825485161776891929296355466082338185199541755546384591261208929371208286410559187299345800125302598147388467283782373829399059130130575707550536466670447022349923395822077916588516101640779751198703879200863153859677174339078186779847910915309774616338231020176817201080756103027200290903849975398368943087868140010448011002364291104062990443568049879169811274854879262048473842331319786127894828031613201122015559660817797429013884663990368453887433480357502012963127000535358820517096295714967262963843868885674823702064175405493435873
e =  123589168751396275896312856328164328381265978316578963271231567137825613822284638216416
ct =  159269674251793083518243077048685663852794473778188330996147339166703385101217832722333
</code></pre> 
<h4><a id="_421"></a>解题：</h4> 
<p>在模n域中进行异或</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># p = getPrime(1024)</span>
<span class="token comment"># q = getPrime(1024)</span>

<span class="token comment"># n = p*q</span>
e <span class="token operator">=</span> <span class="token number">123589168751396275896312856328164328381265978316578963271231567137825613822284638216416</span>
<span class="token comment"># m = bytes_to_long(b"nbctf{[REDACTED]}")</span>

<span class="token comment"># ct = (m^e) % n</span>
n <span class="token operator">=</span>  <span class="token number">13431294979312769345517878088407659222785929563176888493659632690735510803353339825485161776891929296355466082338185199541755546384591261208929371208286410559187299345800125302598147388467283782373829399059130130575707550536466670447022349923395822077916588516101640779751198703879200863153859677174339078186779847910915309774616338231020176817201080756103027200290903849975398368943087868140010448011002364291104062990443568049879169811274854879262048473842331319786127894828031613201122015559660817797429013884663990368453887433480357502012963127000535358820517096295714967262963843868885674823702064175405493435873</span>
e <span class="token operator">=</span>  <span class="token number">123589168751396275896312856328164328381265978316578963271231567137825613822284638216416</span>
ct <span class="token operator">=</span>  <span class="token number">159269674251793083518243077048685663852794473778188330996147339166703385101217832722333</span>
re <span class="token operator">=</span> <span class="token punctuation">(</span>ct<span class="token operator">^</span>e<span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="crypto323264__SOLVED_445"></a>crypto/32+32=64 | SOLVED</h3> 
<h4><a id="_447"></a>题面：</h4> 
<p>64 is too much, but 32 isn’t. 32+32=64?</p> 
<h4><a id="base64_451"></a>考点：base64</h4> 
<h4><a id="_453"></a>题目：</h4> 
<p>32_1.txt</p> 
<p>32_2.txt</p> 
<p>两个文件都达到了一万多行 就不贴了</p> 
<h4><a id="_461"></a>解题：</h4> 
<p>这么多数据 就是因为不断使用了base64进行循环加密，所以不断进行base64解密</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> base64

flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"32_1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment">#b'nbctf{h0pE_'</span>

flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"32_2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

<span class="token comment">#b'y0U_h4d_fUn}'</span>
</code></pre> 
<h3><a id="cryptoSBGABWs_Insanity__SOLVED_486"></a>crypto/SBG-ABW’s Insanity | SOLVED</h3> 
<h4><a id="_488"></a>题面：</h4> 
<p>“Skill Issue” - AnonymousBlueWhale</p> 
<h4><a id="_492"></a>题目：</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> pad
<span class="token keyword">import</span> hashlib

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span><span class="token string">b'we give you this as a gift!'</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1096</span><span class="token punctuation">)</span>
q1 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1096</span><span class="token punctuation">)</span>
q2 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1096</span><span class="token punctuation">)</span>
n1 <span class="token operator">=</span> p<span class="token operator">*</span>q1
n2 <span class="token operator">=</span> p<span class="token operator">*</span>q2

e <span class="token operator">=</span> <span class="token number">11</span>

ct1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>
ct2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>

key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>q1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span>
enc_flag <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>pad<span class="token punctuation">(</span><span class="token string">b"nbctf{[REDACTED]}"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ct1 ="</span><span class="token punctuation">,</span> ct1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ct2 ="</span><span class="token punctuation">,</span> ct2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"enc_flag ="</span><span class="token punctuation">,</span> enc_flag<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="gcd__AES_ECB_524"></a>考点：gcd 整数分解 AES ECB</h4> 
<h4><a id="_526"></a>解题：</h4> 
<p>对题目进行分析，因为AES.ECB是直接根据密钥进行逆向解密的</p> 
<p>所以我们的目的就是获得q1</p> 
<p>所以观察q1的生成方式，看看在哪里出现了q1，准确定位到对应代码</p> 
<pre><code class="prism language-python">n1 <span class="token operator">=</span> p<span class="token operator">*</span>q1
n2 <span class="token operator">=</span> p<span class="token operator">*</span>q2

e <span class="token operator">=</span> <span class="token number">11</span>

ct1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>
ct2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>
</code></pre> 
<p>其中ct1和ct2、m、e均已知，下面进行数学推导</p> 
<pre><code class="prism language-txt">ct1 = m^e + k1 * n1 = m^e + k1 * p * q1
ct2 = m^e + k2 * n2 = m^e + k2 * p * q2
=&gt;
k1 * p * q1 = ct1 - m^e
k2 * p * q2 = ct2 - m^e
=&gt; 然后我们发现对上面式子中求出来的两个数求gcd公约数即可获得p
=&gt; 然后有p了之后对1式两边同时除p 
k1 * q1 = (ct1 - m^e) / p
=&gt;最后一步是要获得q1 显然是有k1的干扰两个数相乘，所以借助一点工具 对这个数进行分解
</code></pre> 
<p>法1：本地跑yafu</p> 
<p>法2：在线网站分解https://www.alpertron.com.ar/ECM.HTM</p> 
<p>exp：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> pad
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> gmpy2

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span><span class="token string">b'we give you this as a gift!'</span><span class="token punctuation">)</span>

<span class="token comment"># p = getPrime(1096)</span>
<span class="token comment"># q1 = getPrime(1096)</span>
<span class="token comment"># q2 = getPrime(1096)</span>
<span class="token comment"># n1 = p*q1</span>
<span class="token comment"># n2 = p*q2</span>

e <span class="token operator">=</span> <span class="token number">11</span>

<span class="token comment"># ct1 = pow(m,e,n1)</span>
<span class="token comment"># ct2 = pow(m,e,n2)</span>
<span class="token comment">#根据ct1和ct2 得到n1和n2</span>

ct1 <span class="token operator">=</span> <span class="token number">196150896308015382573408099004515975466540094705348761587854272630906023749083911008835478259767648401709605726136589590310666858430120235218762651641330953170392784645631801449432061363776229651965539255255795373230255852992805188205639228954217034390731460194284731845705855212209524525682241998203303747513174581513168217999505436596818091279091144718119512522929858750349220346765422769476003604849600128605208123474607256344535541843454810706150705449483256361736428064150792476736751093915251743882647862500622465233906844054109281842278362125589335774364236155483783338907105809549449368926475631824722919958889450225026843225780470131268709445293157749</span>
ct2 <span class="token operator">=</span> <span class="token number">83507921327913521142443934492559420944369023782917085618978768157512494136296269338031471193927727958060037960270530278173852027186606624474398269053920321522448607751539858355179998108075848593814112217098612017462222420001262248144471923306139580601814218471659969728514600258330312623506466116333593434744460773476488134792248490905628242447603788884700795677619881924772996081377617066055448888668800826281711315468059146518373888252421991592124071284411947405472003802863596010724784730366575751160333120162778945930063499020829492960600318519615351417595308518636794008603089224459556289944808655338805251676963828327517925911000528943113536807796285824</span>

tmp <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">)</span>
flag1 <span class="token operator">=</span> tmp <span class="token operator">-</span> ct1 <span class="token comment">#= k1 * n1 = k1 * p * q1</span>
flag2 <span class="token operator">=</span> tmp <span class="token operator">-</span> ct2 <span class="token comment">#= k2 * n2 = k2 * p * q2</span>
p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>flag1<span class="token punctuation">,</span>flag2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>p<span class="token punctuation">,</span>flag2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag1 <span class="token operator">//</span> p<span class="token punctuation">)</span>
k1q1 <span class="token operator">=</span> flag1 <span class="token operator">//</span> p
<span class="token comment">#得到k1和q1分解</span>
q1 <span class="token operator">=</span> <span class="token number">603701201822386830907144477326706640694145605732107023753674808182665696931502012989218558077472289899849882120737934821898165435847435044518846871242860227586749788240998624721376490806164324545522115137075097300642534248374378375756928831273442124872283671893345317220496457140852434166575343690062190540448032738970711476061243</span>
key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>q1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span>
    <span class="token comment"># enc_flag = cipher.encrypt(pad(b"nbctf{[REDACTED]}", 16))</span>

enc_flag <span class="token operator">=</span> <span class="token string">'ac2289b707b174c541cf0952bf3b2057561b0872451444a5bbecf18c007ea20fa2b7c8a1707a74a1657e5adb5c1a417f'</span>
enc_flag <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>enc_flag<span class="token punctuation">)</span>
<span class="token comment"># print(cipher.decrypt(enc_flag))</span>
<span class="token comment"># print(enc_flag)</span>
<span class="token keyword">if</span> <span class="token string">b"nbctf"</span> <span class="token keyword">in</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>enc_flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>enc_flag<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#b'nbctf{c0ngr4ts_0n_F1nish1n9_Th3_3_P4rt3r!!!!}\x03\x03\x03'</span>
</code></pre> 
<h3><a id="cryptoToo_Little_Information__SOLVED_622"></a>crypto/Too Little Information | SOLVED</h3> 
<h4><a id="_624"></a>题面：</h4> 
<p>My computer crashed generating my keys. 😦 Can you recover them for me?</p> 
<h4><a id="_628"></a>题目：</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>

n <span class="token operator">=</span> p<span class="token operator">*</span>q
e <span class="token operator">=</span> <span class="token number">65537</span>

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span><span class="token string">b"nbctf{[REDACTED]}"</span><span class="token punctuation">)</span>

ct <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ct <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>n <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

hint <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">+</span>q<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">200</span> <span class="token comment"># I can't be giving you that much!</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>hint <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

ct <span class="token operator">=</span> <span class="token number">20030315247290021934293927354887580426070566017560641204155610658927917290198737029903594702064351773446005018155094643288125396810753014936800515440652855824038470725838848349666236623899089094953181436465435270989651491997801177943499187812270081592263331832916362349716591828106306150603120693022149233534</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">90166344558664675592644684556355545187373291859609367810958775310181360193141550862577281658089332577942193823477148064165061303827534169112815736618901965700400798345371758370344207077280925015891945591352156370597957742921722432314582261224366498475465730899163137511778647694175484386010210005826793007961</span>
hint <span class="token operator">=</span> <span class="token number">12227137598952006551839416663729660224872609953685427677011433223002140448682395830146750981200</span>

</code></pre> 
<h4><a id="_CopperSmith_657"></a>考点：移位 CopperSmith</h4> 
<h4><a id="_659"></a>解题：</h4> 
<p>前置知识点：</p> 
<p><img src="https://images2.imgbox.com/33/94/HBxQylG2_o.png" alt="image-20231206153106063"></p> 
<p>对移位这次一定要弄明白了：</p> 
<pre><code class="prism language-python">hint <span class="token operator">&gt;&gt;</span> <span class="token number">200</span>   <span class="token comment">#右移相当于缩小 </span>
</code></pre> 
<blockquote> 
 <p>对于十进制来说：</p> 
 <p>做除运算 等价于hint // 2**200</p> 
 <p>对于二进制来说：</p> 
 <p>移位前0b10111011100100110101010000111011001111110110110110000001101011110000000101100100000100111001110101000011001001110 11000100101100011111011100110110000110011011100100011111110111110000111110000010100001001111001100001100110000111011011011001011111111101000010111101000011010011110001011111100111000111010010001010000</p> 
 <p>移位后0b10111011100100110101010000111011001111110110110110000001101011110000000101100100000100111001110101000011001001110</p> 
 <p>相当于直接截取掉低200位二进制数据</p> 
</blockquote> 
<pre><code class="prism language-python">hint <span class="token operator">&lt;&lt;</span> <span class="token number">200</span>  <span class="token comment">#左移相当于扩大</span>
</code></pre> 
<blockquote> 
 <p>对于十进制来说：</p> 
 <p>做乘运算 等价于hint * 2**200</p> 
 <p>对于二进制来说：</p> 
 <p>移位前</p> 
 <p>0b1011101110010011010101000011101100111111011011011000000110101111000000010110010000010011100111010100001100100111011000100101100011111011100110110000110011011100100011111110111110000111110000010100001001111001100001100110000111011011011001011111111101000010111101000011010011110001011111100111000111010010001010000</p> 
 <p>移位后</p> 
 <p>0b101110111001001101010100001110110011111101101101100000011010111100000001011001000001001110011101010000110010011101100010010110001111101110011011000011001101110010001111111011111000011111000001010000100111100110000110011000011101101101100101111111110100001011110100001101001111000101111110011100011101001000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 在低200位填充0 相当于把原来位置的权值抬高了</p> 
</blockquote> 
<p>目前题目中给出的是</p> 
<p><code>p+q &gt;&gt; 200</code></p> 
<p>相当于p+q的低200位丢失了 需要恢复</p> 
<p>在低位确实的运算中有这样一个特点：</p> 
<p>n = p * q</p> 
<p>n = p * (p + q - p)</p> 
<p>得到关于p的一个方程</p> 
<p>p*((p+q)-p) - n = 0</p> 
<p>因为p+q是缺失低200位的</p> 
<p>所以该方程解出的结果也是p也是部分数据 虽然结果也是512bit位的 但是存在部分数据丢失，具有相同的MBS(最高有效位)</p> 
<pre><code class="prism language-python">p_ <span class="token operator">=</span> var<span class="token punctuation">(</span><span class="token string">'p_'</span><span class="token punctuation">)</span>
<span class="token comment">#当前hint的二进制位数为313 缺少200位</span>
approx_p_plus_q <span class="token operator">=</span> hint <span class="token operator">&lt;&lt;</span> <span class="token number">200</span> <span class="token comment">#反向移位补全数据 512</span>
approx_p <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p_<span class="token operator">*</span><span class="token punctuation">(</span>approx_p_plus_q <span class="token operator">-</span> p_<span class="token punctuation">)</span> <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>approx_p<span class="token punctuation">)</span>  <span class="token comment">#因为hint进行了填充 所以此时的p也是512位 具有相同最高有效位313 只不过低200位的数据不准确</span>
</code></pre> 
<p>那么恢复丢失的数据 =&gt; CopperSmith</p> 
<p>假设缺失的数据为x bit设置为200位</p> 
<pre><code class="prism language-python">PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> x <span class="token operator">+</span> p3  <span class="token comment">#p3因为低位截断了 所以一定是比真实值小的 补充一个x</span>
x0 <span class="token operator">=</span> f<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">200</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">#求小根 其中第一个参数是2的kbits次方可以保证最后解得的小根是kbits位  就是缺失的位数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x0<span class="token punctuation">)</span>
p <span class="token operator">=</span> p3<span class="token operator">+</span>x0
</code></pre> 
<p>到此完美结束</p> 
<p>调试exp如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#sage</span>
 
<span class="token comment">#p3已知高位 这里的n就是N3</span>
hint <span class="token operator">=</span> <span class="token number">12227137598952006551839416663729660224872609953685427677011433223002140448682395830146750981200</span>
n <span class="token operator">=</span> <span class="token number">90166344558664675592644684556355545187373291859609367810958775310181360193141550862577281658089332577942193823477148064165061303827534169112815736618901965700400798345371758370344207077280925015891945591352156370597957742921722432314582261224366498475465730899163137511778647694175484386010210005826793007961</span>
 
<span class="token comment">#本事</span>
p_ <span class="token operator">=</span> var<span class="token punctuation">(</span><span class="token string">'p_'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">'''1011101110010011010101000011101100111111011011011000000110101111000000010110010000010011100111010100001100100111011000100101100011111011100110110000110011011100100011111110111110000111110000010100001001111001100001100110000111011011011001011111111101000010111101000011010011110001011111100111000111010010001010000'''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
approx_p_plus_q <span class="token operator">=</span> hint <span class="token operator">&lt;&lt;</span> <span class="token number">200</span>
approx_p <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p_<span class="token operator">*</span><span class="token punctuation">(</span>approx_p_plus_q <span class="token operator">-</span> p_<span class="token punctuation">)</span> <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>approx_p<span class="token punctuation">)</span>
<span class="token comment">#解出p的低位</span>
p3<span class="token operator">=</span><span class="token number">7304778595800693962623587470016492934656897172638927993210828812588740492194432727308053205092654458616385476570357533214681567145360876311971890757777044</span>
<span class="token comment">#sage</span>
 
<span class="token comment">#p3已知高位 这里的n就是N3</span>
<span class="token comment"># p3 = 7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902</span>
<span class="token comment"># n = 113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span>
 
<span class="token comment">#全位数</span>
<span class="token comment"># pbits = 512</span>
 
<span class="token comment">#缺省位数</span>
<span class="token comment"># kbits = pbits - p3.nbits()#nbits()位数</span>
<span class="token comment"># print (p3.nbits())</span>
<span class="token comment"># p3 = p3 &lt;&lt; kbits   #反方向移动缺省的位数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">'''10001011011110010000001110010110100000110110010101111000001110011010100001001001011001110100100111010000101100111000111000100111110011100011111110110111011000010110101111110101110111011100000001011010010111111010100010111001100101011110000110000100111100101100110010111101000001100010111001100010011001010101101011010010110100000100001010100100110000111011001101100111100111110110101011010111000010111111100000011010001000111001111010101101011100001010000001001010111100101001100001000100101101100011011010010100'''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> x <span class="token operator">+</span> p3  <span class="token comment">#p3因为低位截断了 所以一定是比真实值小的 补充一个x</span>
x0 <span class="token operator">=</span> f<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">200</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">#求小根 其中第一个参数是2的kbits次方可以保证最后解得的小根是kbits位  就是缺失的位数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x0<span class="token punctuation">)</span>
p <span class="token operator">=</span> p3<span class="token operator">+</span>x0
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"p: "</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token comment">#assert是断言语句 如果是true 则正常执行 如果是false 则程序运行中断</span>
<span class="token comment"># assert n % p == 0</span>
q <span class="token operator">=</span> n <span class="token operator">//</span> <span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
ct <span class="token operator">=</span> <span class="token number">20030315247290021934293927354887580426070566017560641204155610658927917290198737029903594702064351773446005018155094643288125396810753014936800515440652855824038470725838848349666236623899089094953181436465435270989651491997801177943499187812270081592263331832916362349716591828106306150603120693022149233534</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>phi<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>ct<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"############test#####################"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>approx_p<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>flag:<code>b'nbctf{cr34t1v3_fl4gs_4r3_s0_h4rd_t0_m4k3...}'</code></p> 
<h3><a id="webInspector_Gadget_806"></a>web/Inspector Gadget</h3> 
<h4><a id="_808"></a>题面：</h4> 
<p>While snooping around this website, inspector gadet lost parts of his flag. Can you help him find it?</p> 
<h4><a id="_812"></a>题目：</h4> 
<p><a href="https://inspector-gadget.chal.nbctf.com" rel="nofollow">inspector-gadget.chal.nbctf.com</a></p> 
<h4><a id="_816"></a>考点：信息收集</h4> 
<p>F12</p> 
<p><img src="https://images2.imgbox.com/a3/bf/vu0d6mEU_o.png" alt="image-20231206180159384"></p> 
<p>直接在控制台跑一下<code>getflag()</code>函数</p> 
<p><img src="https://images2.imgbox.com/ca/25/S0T7MYtY_o.png" alt="image-20231206180248579"></p> 
<p>图片遮盖</p> 
<p><img src="https://images2.imgbox.com/10/1a/UFbyBR3x_o.png" alt="image-20231206180335228"></p> 
<hr> 
<p>下面有很多点击功能点</p> 
<p>挨个试一试</p> 
<p><strong><img src="https://images2.imgbox.com/45/31/2ieGJarT_o.png" alt="image-20231206180714726"></strong></p> 
<p>进去之后</p> 
<p><img src="https://images2.imgbox.com/77/7b/QYE4SF4r_o.png" alt="image-20231206180743641"></p> 
<p>title中发现flag</p> 
<p><img src="https://images2.imgbox.com/70/86/EgVyUcP6_o.png" alt="image-20231206180822341"></p> 
<p>信息泄露 robots.txt</p> 
<p><img src="https://images2.imgbox.com/67/c0/BKrMDCXr_o.png" alt="image-20231206180907075"></p> 
<p>flag:<code>nbctf{G00d_J06_D3tect1v3_G4dg3t352}</code></p> 
<h3><a id="webwalters_crystal_shop_858"></a>web/walter’s crystal shop</h3> 
<h4><a id="_860"></a>题面：</h4> 
<p>My buddy Walter is selling some crystals, check out his shop!</p> 
<h4><a id="_864"></a>题目：</h4> 
<p><a href="https://walters-crystal-shop.chal.nbctf.com" rel="nofollow">walters-crystal-shop.chal.nbctf.com</a></p> 
<p>给出源码 直接打开app.js</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sqlite3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"sqlite3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlite3<span class="token punctuation">.</span>Database</span><span class="token punctuation">(</span><span class="token string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">"./flag.txt"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">"utf8"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> crystals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./crystals"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE crystals (name TEXT, price REAL, quantity INTEGER)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> stmt <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO crystals (name, price, quantity) VALUES (?, ?, ?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> crystal <span class="token keyword">of</span> crystals<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    stmt<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>crystal<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> crystal<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> crystal<span class="token punctuation">[</span><span class="token string">"quantity"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  stmt<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE IF NOT EXISTS flag (flag TEXT)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO flag (flag) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>flag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/crystals"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token string">"Missing required fields"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  db<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM crystals WHERE name LIKE '%</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> rows</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Internal server error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">sendfile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Server listening on port 3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_SQL_922"></a>考点：代码审计 SQL注入</h4> 
<h4><a id="_924"></a>解题：</h4> 
<p>通过代码审计 得到路由和参数</p> 
<p><img src="https://images2.imgbox.com/fc/aa/gyEgTfBV_o.png" alt="image-20231206182417672"></p> 
<p>路由：<code>crystals</code></p> 
<p>参数：<code>name</code></p> 
<p><img src="https://images2.imgbox.com/4f/3b/SdqQcajw_o.png" alt="image-20231206182456391"></p> 
<p>明确参数数量为3</p> 
<p><img src="https://images2.imgbox.com/9c/36/AWEye6cB_o.png" alt="image-20231206182519692"></p> 
<p>明确flag在数据库中的位置</p> 
<p><img src="https://images2.imgbox.com/3b/15/zgA2Xtmi_o.png" alt="image-20231206182542740"></p> 
<p>明确闭合方式 单引号闭合</p> 
<p><img src="https://images2.imgbox.com/eb/fb/GOokpWOe_o.png" alt="image-20231206182623878"></p> 
<p>flag：<code>nbctf{h0p3fuLLy_7h3_D3A_d035n7_kn0w_ab0ut_th3_0th3r_cRyst4l5}</code></p> 
<h3><a id="websecret_tunnel_954"></a>web/secret tunnel</h3> 
<h4><a id="_956"></a>题面：</h4> 
<p>Can you find the flag on the other end of my secret tunnel?</p> 
<h4><a id="_960"></a>题目：</h4> 
<p><a href="https://secret-tunnel.chal.nbctf.com" rel="nofollow">secret-tunnel.chal.nbctf.com</a></p> 
<p>main.py</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/local/bin/python</span>

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response
<span class="token keyword">import</span> requests

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>
            static_url_path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
            static_folder<span class="token operator">=</span><span class="token string">"static"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/fetchdata"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">fetchdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token string">"127"</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"No loopback for you!"</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> url<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"Only 2 dots allowed!"</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"x"</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"I don't like twitter &gt;:("</span> <span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span> 
    <span class="token keyword">if</span> <span class="token string">"flag"</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"It's not gonna be that easy :)"</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>flag.py</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> Response

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">1337</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="SSRF_1026"></a>考点：SSRF</h4> 
<h4><a id="_1028"></a>解题：</h4> 
<p><img src="https://images2.imgbox.com/7d/da/LSrzOcZi_o.png" alt="image-20231206215124712"></p> 
<p>明确4个限制</p> 
<p>大体就知道是想让我们去访问内网的flag路由</p> 
<p>那么在linux系统中</p> 
<p>代替127.0.0.1的有很多</p> 
<p>比如</p> 
<p><code>0</code> <code>localhost</code></p> 
<p>然后根据flag.py知道对于端口为<code>1337</code></p> 
<p>同时flag需要转换 采用URL编码</p> 
<p><img src="https://images2.imgbox.com/87/05/dmNjTdEy_o.png" alt="image-20231206215509152"></p> 
<p>换一个f就行了</p> 
<p>payload:<code>http://0:1337/%66lag</code></p> 
<p><img src="https://images2.imgbox.com/be/f7/rUHjkgpD_o.png" alt="image-20231206215555967"></p> 
<p>法二：</p> 
<p>用自己的服务器利用重定向跳转</p> 
<p>输入框 =&gt; 自己的服务器 =&gt; 重定向访问到内网的flag路由</p> 
<p>写在服务器的内容</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location:http://127.0.0.1:1337/flag"</span><span class="token punctuation">)</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="webGalleria_1072"></a>web/Galleria</h3> 
<h4><a id="_1074"></a>题面：</h4> 
<p>Put up some fun images for everyone in this amazing image gallery!</p> 
<h4><a id="_1078"></a>题目：</h4> 
<p>app.py</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> send_file
<span class="token keyword">import</span> os
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filename

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'uploads'</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">allowed_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    allowed_extensions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">'.'</span> <span class="token keyword">in</span> filename <span class="token keyword">and</span> filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> allowed_extensions


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span> <span class="token keyword">and</span> allowed_file<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>SEEK_END<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"File is too large"</span><span class="token punctuation">,</span> <span class="token number">413</span>

        <span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        filename <span class="token operator">=</span> secure_filename<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">check_file_path</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _path <span class="token operator">=</span> Path<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span>Path<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parts<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> part <span class="token keyword">in</span> _path<span class="token punctuation">.</span>parts<span class="token punctuation">:</span>
        <span class="token keyword">if</span> part <span class="token operator">==</span> <span class="token string">'.'</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> part <span class="token operator">==</span> <span class="token string">'..'</span><span class="token punctuation">:</span>
            parts<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            parts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>part<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parts<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    _path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
    _path <span class="token operator">=</span> Path<span class="token punctuation">(</span>_path<span class="token punctuation">)</span>
    <span class="token keyword">return</span> _path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> _path<span class="token punctuation">.</span>is_file<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">gallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'uploads'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> check_file_path<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

    image_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>
        app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'gallery.html'</span><span class="token punctuation">,</span> images<span class="token operator">=</span>image_files<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span>

</code></pre> 
<p>dockerfile:</p> 
<pre><code class="prism language-dockerfile">FROM python:3.11-slim AS app

WORKDIR /var/www/html

RUN pip3 install --no-cache-dir flask

RUN mkdir uploads
COPY app.py .
COPY templates ./templates

COPY flag.txt /tmp/flag.txt

CMD ["python3", "app.py"]
</code></pre> 
<h4><a id="_1176"></a>考点：代码审查</h4> 
<h4><a id="_1178"></a>解题：</h4> 
<p>我们先没有看源码的情况下 上传一张图片 然后发现看到其他人上传的照片全部显示出来了</p> 
<p>这引起一丝警觉</p> 
<p>然后对代码进行审查</p> 
<p><img src="https://images2.imgbox.com/ca/67/KjLQE3pS_o.png" alt="image-20231206221703254"></p> 
<p>找到这个路由</p> 
<p>参数是<code>file</code></p> 
<p>对file指定的文件进行读取</p> 
<p><img src="https://images2.imgbox.com/20/53/vfQjhNiH_o.png" alt="image-20231206221803040"></p> 
<p>然后我们又在dockerfile中看到flag文件的位置</p> 
<p>读！</p> 
<p><img src="https://images2.imgbox.com/d8/ac/83fFfirU_o.png" alt="image-20231206221906877"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/814906bb17fb8c801f0393058ef3d024/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[React]基于Antd的FormModal的组件封装以及useFormModal的hooks封装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3902fc2aea631182f6bde707714dcb60/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Scala 从入门到精通</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>