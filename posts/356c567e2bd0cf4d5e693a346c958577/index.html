<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Web直播之RTMP协议：vue-video-player &#43; videojs-flash - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Web直播之RTMP协议：vue-video-player &#43; videojs-flash" />
<meta property="og:description" content="视频直播服务目前支持3种直播协议：RTMP、HLS、HTTP-FLV。
本文主要讲解在 Vue 项目中如何使用 vue-video-player 播放器播放 rtmp 流。
1.准备工作 cnpm install --save vue-video-player cnpm install --save videojs-flash cnpm install --save videojs-swf 2.代码实战 &lt;template&gt; &lt;div&gt; &lt;video-player :options=&#34;playerOptions&#34;&gt;&lt;/video-player&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import { videoPlayer } from &#39;vue-video-player&#39; import &#39;video.js/dist/video-js.css&#39; import &#39;videojs-flash&#39; import SWF_URL from &#39;videojs-swf/dist/video-js.swf&#39; export default { components: { videoPlayer }, data () { return { playerOptions: { autoplay: true, sources: [{ type: &#39;rtmp/mp4&#39;, src: &#39;rtmp://58.200.131.2:1935/livetv/hunantv&#39; // 亲测可用 }], techOrder: [&#39;html5&#39;, &#39;flash&#39;], flash: { swf: SWF_URL } } } } } &lt;/script&gt; 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/356c567e2bd0cf4d5e693a346c958577/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-12T15:19:18+08:00" />
<meta property="article:modified_time" content="2023-07-12T15:19:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Web直播之RTMP协议：vue-video-player &#43; videojs-flash</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>视频直播服务目前支持3种直播协议：RTMP、HLS、HTTP-FLV。<br> 本文主要讲解在 Vue 项目中如何使用 vue-video-player 播放器播放 rtmp 流。</p> 
<h5>1.准备工作</h5> 
<pre><code class="hljs">cnpm install --save vue-video-player
cnpm install --save videojs-flash
cnpm install --save videojs-swf</code></pre> 
<h5>2.代码实战</h5> 
<pre><code class="hljs">&lt;template&gt;
  &lt;div&gt;
    &lt;video-player :options="playerOptions"&gt;&lt;/video-player&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { videoPlayer } from 'vue-video-player'
import 'video.js/dist/video-js.css'
import 'videojs-flash'
import SWF_URL from 'videojs-swf/dist/video-js.swf'

export default {
  components: {
    videoPlayer
  },
  data () {
    return {
      playerOptions: {
        autoplay: true,
        sources: [{
          type: 'rtmp/mp4',
          src: 'rtmp://58.200.131.2:1935/livetv/hunantv' // 亲测可用
        }],
        techOrder: ['html5', 'flash'],
        flash: {
          swf: SWF_URL
        }
      }
    }
  }
}
&lt;/script&gt;</code></pre> 
<h5>3.解决问题</h5> 
<h6>Q1: 控制台报错 The "flash" tech is undefined. Skipped browser support check for that tech.</h6> 
<p>方案1(无效)：删除 node_modules，再用 npm 安装；<br> 方案2(有效)：查看 vue-video-player 和 videojs-flash 的 package.json，发现这2个插件最新版引入的 video.js 版本没有严格统一，怀疑和插件版本有关，故进行版本降级，如下：</p> 
<pre><code class="hljs">"dependencies": {
  "vue-video-player": "5.0.1", 
  "videojs-flash": "2.1.0"
}</code></pre> 
<p>方案3(未验证)：以下解决方案来自 vue-video-player <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fsurmon-china%2Fvue-video-player%2Fissues%2F221" rel="nofollow" title="issues#221">issues#221</a></p> 
<blockquote> 
 <p>根本原因是 videojs 和 videojs-flash 里的各有一个 video.js，如果两个版本不一样可能就会报错了，终极解决方案就是配置第三方模块的查找顺序，优先查找本身安装的videojs 就可以了。</p> 
</blockquote> 
<pre><code class="hljs">// webpack.config.js
resolve: {
   modules: [path.resolve('node_modules'), 'node_modules'],
    ...
}</code></pre> 
<h6>Q2: 控制台报错 Cross-origin plugin content from <code>https://vjs.zencdn.net/swf/5.4.1/video-js.swf</code> must have a visible size larger than 400 x 300 pixels, or it will be blocked. Invisible content is always blocked.</h6> 
<p>当直播视频设置了 autoplay: true，并且宽高小于400x300，例如直播墙的需求，这时便出现如上报错。<br> 2个关键点：1.跨源插件 2.大于400x300，解决其一便能自动播放。视频窗口大小取决于需求，不可控制。针对跨源插件，需要安装上述版本的videojs-swf插件，import即可。<br> 注：引入 videojs-swf@5.4.1 的插件，需要在 vue.config.js 中加入 chainwebpack 配置，否则项目运行会报错：无法找到相关 loader</p> 
<pre><code class="hljs">// vue.config.js
module.exports = {
  chainWebpack: config =&gt; {
    config.module
      .rule('swf')
      .test(/\.swf$/)
      .use('url-loader')
      .loader('url-loader')
      .options({
        limit: 10000
      })
  }
}</code></pre> 
<p>liveweb是好游科技开发的一款web播放器，支持多种协议(RTSP/RTMP/HLS/HTTP-FLV/WebSocket-FLV/GB28181/HTTP-TS/WebSocket-TS/HTTP-fMP4/WebSocket-fMP4/MP4/WebRTC),支持协议互转。<br> 全面支持H265/H264/AAC/G711/OPUS。<br> 支持WebRTC推流，支持转其他协议<br> 支持WebRTC播放，支持其他协议转WebRTC<br> 支持TWCC rtcp动态调整码率<br> 支持remb/pli/sr/rr rtcp<br> 支持rtp扩展解析<br> 支持GOP缓冲，webrtc播放秒开<br> 支持datachannel<br> 支持webrtc over tcp模式<br> 优秀的nack、jitter buffer算法, 抗丢包能力卓越<br> 支持whip/whep协议</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c9571852165a3144a549bf90c7295814/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vscode中Git常用操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0a812af1f18ee84e28d23dcb0ff412af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">uniapp 打包安卓apk (原生App)云打包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>