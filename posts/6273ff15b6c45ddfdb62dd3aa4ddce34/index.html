<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringCloudAlibaba 2021.0.1.0 版本整合Nacos配置中心 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringCloudAlibaba 2021.0.1.0 版本整合Nacos配置中心" />
<meta property="og:description" content="nacos安装教程：服务注册中心和配置中心nacos安装 一、组件版本关系 SpringCloudAlibaba、SpringCloud、SpringBoot对应版本
Spring Cloud Alibaba VersionSpring Cloud VersionSpring Boot Version 2021.0.1.0
Spring Cloud 2021.0.1
2.6.3
Nacos对应版本
Spring Cloud Alibaba VersionSentinel VersionNacos VersionRocketMQ VersionDubbo VersionSeata Version 2021.0.1.0
1.8.3
1.4.2
4.9.2
2.7.15
1.4.2
官方提醒：每个 Spring Cloud Alibaba 版本及其自身所适配的各组件对应版本（经过验证，自行搭配各组件版本不保证可用）
更多版本对应关系参考：版本说明 Wiki
二、集成Nacos配置中心 1、SpringCloudAlibaba依赖 &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;2.6.3&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;2021.0.1&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;2021.0.1.0&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; 2、启动配置管理 启动了 Nacos server 后，需要添加依赖" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6273ff15b6c45ddfdb62dd3aa4ddce34/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-19T13:39:56+08:00" />
<meta property="article:modified_time" content="2022-07-19T13:39:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringCloudAlibaba 2021.0.1.0 版本整合Nacos配置中心</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p> nacos安装教程：<a class="link-info" href="https://blog.csdn.net/Utopia_Zq/article/details/108821165?spm=1001.2014.3001.5501" title="服务注册中心和配置中心nacos安装">服务注册中心和配置中心nacos安装</a> </p> 
<h2>一、组件版本关系</h2> 
<p>SpringCloudAlibaba、SpringCloud、SpringBoot对应版本</p> 
<table><thead><tr><th>Spring Cloud Alibaba Version</th><th>Spring Cloud Version</th><th>Spring Boot Version</th></tr></thead><tbody><tr><td> <p>2021.0.1.0</p> </td><td> <p>Spring Cloud 2021.0.1</p> </td><td> <p>2.6.3</p> </td></tr></tbody></table> 
<p>Nacos对应版本</p> 
<table><thead><tr><th>Spring Cloud Alibaba Version</th><th>Sentinel Version</th><th>Nacos Version</th><th>RocketMQ Version</th><th>Dubbo Version</th><th>Seata Version</th></tr></thead><tbody><tr><td> <p>2021.0.1.0</p> </td><td> <p>1.8.3</p> </td><td> <p>1.4.2</p> </td><td> <p>4.9.2</p> </td><td> <p>2.7.15</p> </td><td> <p>1.4.2</p> </td></tr></tbody></table> 
<p>官方提醒：每个 Spring Cloud Alibaba 版本及其自身所适配的各组件对应版本（经过验证，自行搭配各组件版本不保证可用）</p> 
<p>更多版本对应关系参考：<a class="link-info" href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" title="版本说明 Wiki">版本说明 Wiki</a></p> 
<h2>二、集成Nacos配置中心</h2> 
<h3>1、SpringCloudAlibaba依赖</h3> 
<pre><code class="language-XML">&lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
                &lt;version&gt;2.6.3&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;2021.0.1&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;2021.0.1.0&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre> 
<h3>2、启动配置管理</h3> 
<p>启动了 Nacos server 后，需要添加依赖</p> 
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>注意</strong>：版本 <a href="https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-nacos-config" rel="nofollow" title="2.1.x.RELEASE">2.1.x.RELEASE</a> 对应的是 Spring Boot 2.1.x 版本。版本 <a href="https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-nacos-config" rel="nofollow" title="2.0.x.RELEASE">2.0.x.RELEASE</a> 对应的是 Spring Boot 2.0.x 版本，版本 <a href="https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-nacos-config" rel="nofollow" title="1.5.x.RELEASE">1.5.x.RELEASE</a> 对应的是 Spring Boot 1.5.x 版本。</p> 
<h3>3、两种配置方式bootstrap.yml、spring.config.import</h3> 
<p>3.1 配置 bootstrap.yml</p> 
<p>SpringCloudAlibaba2021.0.1.0版本移除了对bootstrap.yml支持。看spring-cloud-starter-alibaba-nacos-config依赖关系中虽然引入了spring-cloud-starter-bootstrap，但是不会生效，必须重新引入bootstrap的依赖</p> 
<pre><code class="language-XML">&lt;dependency&gt;
     &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
     &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> 
<p>bootstrap.yml</p> 
<pre><code class="language-html">spring:
  application:
    name: provider-server
  cloud:
    nacos:
      config:
        file-extension: yml
        group: PROVIDER_CONFIG_GROUP
        name: provider-server-dev.yml
        shared-configs: #配置共享文件
          - data-id: application-common.yml
            group: PROVIDER_CONFIG_GROUP
            refresh: true
          - data-id: application-custom.yml
            group: PROVIDER_CONFIG_GROUP
            refresh: false</code></pre> 
<p> Nacos配置中心文件</p> 
<p><img alt="" height="492" src="https://images2.imgbox.com/c0/45/u7psvm9k_o.png" width="1200"></p> 
<p>在 Nacos Spring Cloud 中，<code>dataId</code> 的完整格式如下：</p> 
<pre><code>${prefix}-${spring.profiles.active}.${file-extension}
</code></pre> 
<ul><li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li><li><code>spring.profiles.active</code> 即为当前环境对应的 profile，详情可以参考 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles" rel="nofollow" title="Spring Boot文档">Spring Boot文档</a>。 <strong>注意：当 <code>spring.profiles.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></strong></li><li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li></ul> 
<p>provider-server-dev.yml</p> 
<p><img alt="" height="497" src="https://images2.imgbox.com/78/5d/xihy8Juv_o.png" width="706"></p> 
<p></p> 
<p> application-custom.yml</p> 
<p><img alt="" height="344" src="https://images2.imgbox.com/9a/21/LWhwQ9m1_o.png" width="648"></p> 
<p></p> 
<p>application-common.yml</p> 
<p>这个配置是共享文件，这里配置redis缓存</p> 
<p><img alt="" height="557" src="https://images2.imgbox.com/33/30/kceFqoyq_o.png" width="890"></p> 
<pre><code>spring:
  redis:
    # Redis默认情况下有16个分片，这里配置具体使用的分片。默认是索引为0的分片
    database: 1
    # Redis服务器地址
    host: 127.0.0.1
    # Redis服务器连接端口
    port: 6379
    # Redis服务器连接密码（默认为空）
    password: 123456
    # 连接超时时间（毫秒）
    timeout: 2000s

    # 配置文件中添加 lettuce.pool 相关配置，则会使用到lettuce连接池
    lettuce:
      pool:
        # 连接池最大阻塞等待时间（使用负值表示没有限制） 默认 -1
        max-wait: 60s
        # 连接池中的最大空闲连接 默认 8
        max-idle: 10
        # 连接池中的最小空闲连接 默认 0
        min-idle: 10
        # 连接池最大连接数（使用负值表示没有限制） 默认 8
        max-activ: 8

</code></pre> 
<p>3.2 spring.config.import方式</p> 
<p>使用这个方法时，不需要bootstrap.yml。如果引用了 spring-cloud-starter-bootstrap需要去除</p> 
<p>创建application.yml</p> 
<pre><code class="language-XML">server:
  port: 8090

spring:
  application:
    name: provider-server
  cloud:
    nacos:
      discovery:
        group: PROVIDER_GROUP
      config:
        group: PROVIDER_CONFIG_GROUP
        server-addr: 127.0.0.1:8848
  config:
    import:
      - optional:nacos:provider-server-dev.yml  # 监听 PROVIDER_GROUP :provider-config-dev.yml
      #      - optional:nacos:provider-server-dev.yml?group=group_01  # 覆盖默认 group，监听 group_01:provider-config-dev.yml
      #      - optional:nacos:provider-server-dev.yml?group=group_02&amp;refreshEnabled=false # 不开启动态刷新
      - nacos:provider-server-dev.yml # 在拉取nacos配置异常时会快速失败，会导致 spring 容器启动失败
</code></pre> 
<h3>4、通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动更新</h3> 
<p>读取配置文件有两种方式：</p> 
<p>1、直接通过@Value注解</p> 
<p>2、通过实体类注入</p> 
<p>UserConfig.java</p> 
<p>其中prefix = "configdata"是application-custom.yml配置文件内容的前缀</p> 
<pre><code class="language-java">@Data
@Configuration
@ConfigurationProperties(prefix = "configdata")
public class UserConfig {
    private String name;
    private Integer age;
    private String id;
}</code></pre> 
<pre><code class="language-java">@RefreshScope
@RestController
@RequestMapping("/provider")
public class ProviderController {

    @Autowired
    private UserConfig userConfig;

    @Autowired
    private StringRedisTemplate redisTemplate;
    
    @Value("${server.port}")
    private String port;

    @GetMapping("/getNacosConfig")
    public String providerTest() {
        return "我是provider，已成功获取nacos配置中心的数据：(name:" + userConfig.getName() +",age:"+userConfig.getAge()+",id:"+userConfig.getId()+")";
    }

    @GetMapping("/addRedis")
    public void addRedisValue(){
        redisTemplate.opsForValue().set("zhangsan","23");
    }
    
    @GetMapping("/getPort")
    public String getPort() {
        return "我是provider，已成功获取nacos配置中心的数据：(端口号:" +port +")";
    }
}</code></pre> 
<h3> 5、演示</h3> 
<p>1、@Value注解</p> 
<p><img alt="" height="90" src="https://images2.imgbox.com/7a/9b/NWvHpvPp_o.png" width="535"></p> 
<p>2、实体类</p> 
<p><img alt="" height="89" src="https://images2.imgbox.com/32/6a/SqM5JGba_o.png" width="689"></p> 
<p> 修改配置并且发布</p> 
<p><img alt="" height="451" src="https://images2.imgbox.com/86/61/wiiANB5y_o.png" width="687"></p> 
<p></p> 
<p><img alt="" height="112" src="https://images2.imgbox.com/9d/94/ySeBZiTg_o.png" width="616"></p> 
<p>验证动态刷新完成 </p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/295ac79468c914d022c95e122f141016/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UE4 合并静态网格体</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12b795255823d58a70615d5dcc45453d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nodejs面经</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>