<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Goé¡¹ç›®é…ç½®ç®¡ç†ç¥å™¨ä¹‹viperä½¿ç”¨è¯¦è§£ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Goé¡¹ç›®é…ç½®ç®¡ç†ç¥å™¨ä¹‹viperä½¿ç”¨è¯¦è§£" />
<meta property="og:description" content="ä½œè€…ï¼šç¨‹åºå‘˜CKeen
åšå®¢ï¼šhttp://ckeen.cnâ€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
é•¿æœŸåšæŒåšæœ‰ä»·å€¼çš„äº‹ï¼ç§¯ç´¯æ²‰æ·€ï¼ŒæŒç»­æˆé•¿ï¼Œå‡ç»´æ€è€ƒï¼å¸Œæœ›æŠŠç¼–ç ä½œä¸ºé•¿æœŸå…´è¶£çˆ±å¥½ğŸ˜„
ç›®å½•
1. viperçš„ä»‹ç»
2. viperçš„ä½¿ç”¨
2.1 Viperå¯¹è±¡çš„åˆ›å»º
2.2Â é¢„è®¾é»˜è®¤é…ç½®ã€‚Â 2.3Â ä»å‘½ä»¤è¡Œå·¥å…·çš„é€‰é¡¹å‚æ•°Flagsè¯»å–
2.4Â ä»ç¯å¢ƒå˜é‡è¯»å–
2.5Â ä»é…ç½®æ–‡ä»¶è¯»å–
2.6Â ä»è¿œç¨‹key/valueå­˜å‚¨è¯»å–
2.7Â ç›‘å¬é…ç½®å˜åŒ–
2.8 å†™å…¥é…ç½®åˆ°æ–‡ä»¶
3.Â æºç åˆ†æ--é…ç½®è¯»å–çš„é¡ºåº
4. å‚è€ƒèµ„æ–™â€‹â€‹â€‹â€‹â€‹â€‹â€‹
1. viperçš„ä»‹ç» viperæ˜¯goä¸€ä¸ªå¼ºå¤§çš„æµè¡Œçš„é…ç½®è§£å†³æ–¹æ¡ˆçš„åº“ã€‚viperæ˜¯spf13çš„å¦å¤–ä¸€ä¸ªé‡é‡çº§åº“ã€‚æœ‰å¤§é‡é¡¹ç›®éƒ½ä½¿ç”¨è¯¥åº“ï¼Œæ¯”å¦‚hugo, dockerç­‰ã€‚ å®ƒåŸºæœ¬ä¸Šå¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹çš„é…ç½®éœ€æ±‚å’Œæ ¼å¼, viperæ”¯æŒåŠŸèƒ½
è®¾ç½®é»˜è®¤é…ç½®æ”¯æŒå„ç§é…ç½®æ–‡ä»¶ï¼Œå¦‚JSONï¼ŒTOML, YAML, HCL, envfileå’ŒJavaå±æ€§é…ç½®æ–‡ä»¶æ”¯æŒç›‘å¬æ–‡ä»¶å˜åŒ–ä»¥åŠé‡æ–°è¯»å–é…ç½®æ”¯æŒä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®æ”¯æŒä»è¿œç¨‹é…ç½®ç³»ç»Ÿ(etcdæˆ–Consul)è¯»å–é…ç½®ï¼Œå¹¶èƒ½ç›‘å¬è¿œç¨‹é…ç½®ä¿®æ”¹æ”¯æŒä»å‘½ä»¤è¡Œæ ‡å¿—Flagè¯»å–é…ç½®ï¼Œæ¯”å¦‚æ­é…cobraä½¿ç”¨æ”¯æŒè¯»å–ç¼“å†²åŒºæ•°æ® Viperä¸»è¦ä¸ºæˆ‘ä»¬åšä»¥ä¸‹å·¥ä½œ:
æŸ¥æ‰¾ã€åŠ è½½å’Œè§£ç»„JSONã€TOMLã€YAMLã€HCLã€INIã€envfileæˆ–Javaå±æ€§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚æä¾›ä¸€ç§æœºåˆ¶æ¥ä¸ºä¸åŒçš„é…ç½®é€‰é¡¹è®¾ç½®é»˜è®¤å€¼ã€‚æä¾›ä¸€ç§æœºåˆ¶æ¥ä¸ºé€šè¿‡å‘½ä»¤è¡Œæ ‡å¿—æŒ‡å®šçš„é€‰é¡¹è®¾ç½®è¦†ç›–å€¼ã€‚æä¾›åˆ«åç³»ç»Ÿï¼Œä»¥ä¾¿åœ¨ä¸ç ´åç°æœ‰ä»£ç çš„æƒ…å†µä¸‹è½»æ¾é‡å‘½åå‚æ•°ã€‚å½“ç”¨æˆ·æä¾›äº†ä¸é»˜è®¤å€¼ç›¸åŒçš„å‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆå®¹æ˜“åŒºåˆ†å®ƒä»¬ã€‚ vieprçš„å®‰è£…å¾ˆç®€å•ï¼Œç›´æ¥å†å·¥ç¨‹ä¸­ä½¿ç”¨go getå‘½ä»¤å®‰è£…å³å¯
$ go get github.com/spf13/viper 2. viperçš„ä½¿ç”¨ 2.1 Viperå¯¹è±¡çš„åˆ›å»º Viperçš„æ˜¯viperåº“çš„ä¸»è¦å®ç°å¯¹è±¡, viperæä¾›äº†ä¸‹é¢çš„æ–¹æ³•å¯ä»¥è·å–Viperå®ä¾‹ï¼š
func GetViper() *Viper func New() *Viper func NewWithOptions(opts ...Option) *Viper func Sub(key string) *Viper ä½¿ç”¨viper.GetViper()è·å–çš„ä¸ºå…¨å±€çš„Viperå®ä¾‹å¯¹è±¡,é»˜è®¤ä½¿ç”¨viperåŒ…ä½¿ç”¨ä¹Ÿæ˜¯è¯¥å…¨å±€Viperå®ä¾‹ã€‚æŸ¥çœ‹viperçš„æºç ï¼Œå¯ä»¥çœ‹åˆ°viperé»˜è®¤æä¾›äº†ä¸€ä¸ªå…¨å±€çš„Viperå®ä¾‹ï¼š var v *Viper func init() { v = New() } // New returns an initialized Viper instance." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/823362637ee39e45d392f344950e97d9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-27T13:54:55+08:00" />
<meta property="article:modified_time" content="2023-06-27T13:54:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Goé¡¹ç›®é…ç½®ç®¡ç†ç¥å™¨ä¹‹viperä½¿ç”¨è¯¦è§£</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>ä½œè€…ï¼šç¨‹åºå‘˜CKeen<br> åšå®¢ï¼š<a href="http://www.ckeen.cn/" rel="nofollow" title="http://ckeen.cnâ€‹â€‹â€‹â€‹â€‹â€‹â€‹">http://ckeen.cnâ€‹â€‹â€‹â€‹â€‹â€‹â€‹</a>â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹</p> 
<blockquote> 
 <p>é•¿æœŸåšæŒåšæœ‰ä»·å€¼çš„äº‹ï¼ç§¯ç´¯æ²‰æ·€ï¼ŒæŒç»­æˆé•¿ï¼Œå‡ç»´æ€è€ƒï¼å¸Œæœ›æŠŠç¼–ç ä½œä¸ºé•¿æœŸå…´è¶£çˆ±å¥½ğŸ˜„</p> 
</blockquote> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="1.%20viper%E7%9A%84%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#1.%20viper%E7%9A%84%E4%BB%8B%E7%BB%8D" rel="nofollow">1. viperçš„ä»‹ç»</a></p> 
<p id="2.%20viper%E7%9A%84%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#2.%20viper%E7%9A%84%E4%BD%BF%E7%94%A8" rel="nofollow">2. viperçš„ä½¿ç”¨</a></p> 
<p id="2.1%20%C2%A0Viper%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA-toc" style="margin-left:80px;"><a href="#2.1%20%C2%A0Viper%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA" rel="nofollow">2.1 Â Viperå¯¹è±¡çš„åˆ›å»º</a></p> 
<p id="2.2%C2%A0%E9%A2%84%E8%AE%BE%E4%B8%80%E4%BA%9B%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#2.2%C2%A0%E9%A2%84%E8%AE%BE%E4%B8%80%E4%BA%9B%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE" rel="nofollow">2.2Â é¢„è®¾é»˜è®¤é…ç½®ã€‚Â </a></p> 
<p id="2.3%C2%A0%E4%BB%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0Flags%E8%AF%BB%E5%8F%96-toc" style="margin-left:80px;"><a href="#2.3%C2%A0%E4%BB%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0Flags%E8%AF%BB%E5%8F%96" rel="nofollow">2.3Â ä»å‘½ä»¤è¡Œå·¥å…·çš„é€‰é¡¹å‚æ•°Flagsè¯»å–</a></p> 
<p id="2.4%C2%A0%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96-toc" style="margin-left:80px;"><a href="#2.4%C2%A0%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96" rel="nofollow">2.4Â ä»ç¯å¢ƒå˜é‡è¯»å–</a></p> 
<p id="2.5%C2%A0%E4%BB%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-toc" style="margin-left:80px;"><a href="#2.5%C2%A0%E4%BB%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96" rel="nofollow">2.5Â ä»é…ç½®æ–‡ä»¶è¯»å–</a></p> 
<p id="2.6%C2%A0%E4%BB%8E%E8%BF%9C%E7%A8%8Bkey%2Fvalue%E5%AD%98%E5%82%A8%E8%AF%BB%E5%8F%96-toc" style="margin-left:80px;"><a href="#2.6%C2%A0%E4%BB%8E%E8%BF%9C%E7%A8%8Bkey%2Fvalue%E5%AD%98%E5%82%A8%E8%AF%BB%E5%8F%96" rel="nofollow">2.6Â ä»è¿œç¨‹key/valueå­˜å‚¨è¯»å–</a></p> 
<p id="2.7%C2%A0%E7%9B%91%E5%90%AC%E9%85%8D%E7%BD%AE%E5%8F%98%E5%8C%96-toc" style="margin-left:80px;"><a href="#2.7%C2%A0%E7%9B%91%E5%90%AC%E9%85%8D%E7%BD%AE%E5%8F%98%E5%8C%96" rel="nofollow">2.7Â ç›‘å¬é…ç½®å˜åŒ–</a></p> 
<p id="2.8%20%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E5%88%B0%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#2.8%20%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E5%88%B0%E6%96%87%E4%BB%B6" rel="nofollow">2.8 å†™å…¥é…ç½®åˆ°æ–‡ä»¶</a></p> 
<p id="3.%C2%A0%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90--%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96%E7%9A%84%E9%A1%BA%E5%BA%8F-toc" style="margin-left:40px;"><a href="#3.%C2%A0%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90--%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96%E7%9A%84%E9%A1%BA%E5%BA%8F" rel="nofollow">3.Â æºç åˆ†æ--é…ç½®è¯»å–çš„é¡ºåº</a></p> 
<p id="4.%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:40px;"><a href="#4.%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">4. å‚è€ƒèµ„æ–™</a>â€‹â€‹â€‹â€‹â€‹â€‹â€‹</p> 
<hr> 
<h3 id="1.%20viper%E7%9A%84%E4%BB%8B%E7%BB%8D"><strong>1. viperçš„ä»‹ç»</strong></h3> 
<p>viperæ˜¯goä¸€ä¸ªå¼ºå¤§çš„æµè¡Œçš„é…ç½®è§£å†³æ–¹æ¡ˆçš„åº“ã€‚viperæ˜¯spf13çš„å¦å¤–ä¸€ä¸ªé‡é‡çº§åº“ã€‚æœ‰å¤§é‡é¡¹ç›®éƒ½ä½¿ç”¨è¯¥åº“ï¼Œæ¯”å¦‚hugo, dockerç­‰ã€‚ å®ƒåŸºæœ¬ä¸Šå¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹çš„é…ç½®éœ€æ±‚å’Œæ ¼å¼, viperæ”¯æŒåŠŸèƒ½</p> 
<ul><li>è®¾ç½®é»˜è®¤é…ç½®</li><li>æ”¯æŒå„ç§é…ç½®æ–‡ä»¶ï¼Œå¦‚JSONï¼ŒTOML, YAML, HCL, envfileå’ŒJavaå±æ€§é…ç½®æ–‡ä»¶</li><li>æ”¯æŒç›‘å¬æ–‡ä»¶å˜åŒ–ä»¥åŠé‡æ–°è¯»å–é…ç½®</li><li>æ”¯æŒä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®</li><li>æ”¯æŒä»è¿œç¨‹é…ç½®ç³»ç»Ÿ(etcdæˆ–Consul)è¯»å–é…ç½®ï¼Œå¹¶èƒ½ç›‘å¬è¿œç¨‹é…ç½®ä¿®æ”¹</li><li>æ”¯æŒä»å‘½ä»¤è¡Œæ ‡å¿—Flagè¯»å–é…ç½®ï¼Œæ¯”å¦‚æ­é…cobraä½¿ç”¨</li><li>æ”¯æŒè¯»å–ç¼“å†²åŒºæ•°æ®</li></ul> 
<p>Viperä¸»è¦ä¸ºæˆ‘ä»¬åšä»¥ä¸‹å·¥ä½œ:</p> 
<ul><li>æŸ¥æ‰¾ã€åŠ è½½å’Œè§£ç»„JSONã€TOMLã€YAMLã€HCLã€INIã€envfileæˆ–Javaå±æ€§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚</li><li>æä¾›ä¸€ç§æœºåˆ¶æ¥ä¸ºä¸åŒçš„é…ç½®é€‰é¡¹è®¾ç½®é»˜è®¤å€¼ã€‚</li><li>æä¾›ä¸€ç§æœºåˆ¶æ¥ä¸ºé€šè¿‡å‘½ä»¤è¡Œæ ‡å¿—æŒ‡å®šçš„é€‰é¡¹è®¾ç½®è¦†ç›–å€¼ã€‚</li><li>æä¾›åˆ«åç³»ç»Ÿï¼Œä»¥ä¾¿åœ¨ä¸ç ´åç°æœ‰ä»£ç çš„æƒ…å†µä¸‹è½»æ¾é‡å‘½åå‚æ•°ã€‚</li><li>å½“ç”¨æˆ·æä¾›äº†ä¸é»˜è®¤å€¼ç›¸åŒçš„å‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆå®¹æ˜“åŒºåˆ†å®ƒä»¬ã€‚</li></ul> 
<p>vieprçš„å®‰è£…å¾ˆç®€å•ï¼Œç›´æ¥å†å·¥ç¨‹ä¸­ä½¿ç”¨go getå‘½ä»¤å®‰è£…å³å¯</p> 
<div> 
 <pre><code>$ go get github.com/spf13/viper
</code></pre> 
</div> 
<h3 id="2.%20viper%E7%9A%84%E4%BD%BF%E7%94%A8"><a id="2_viper_37"></a>2. viperçš„ä½¿ç”¨</h3> 
<h4 id="2.1%20%C2%A0Viper%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA">2.1 Â Viperå¯¹è±¡çš„åˆ›å»º</h4> 
<p>Viperçš„æ˜¯viperåº“çš„ä¸»è¦å®ç°å¯¹è±¡, viperæä¾›äº†ä¸‹é¢çš„æ–¹æ³•å¯ä»¥è·å–Viperå®ä¾‹ï¼š</p> 
<div> 
 <pre><code class="language-Go">func GetViper() *Viper
func New() *Viper
func NewWithOptions(opts ...Option) *Viper
func Sub(key string) *Viper
</code></pre> 
</div> 
<ul><li>ä½¿ç”¨viper.GetViper()è·å–çš„ä¸ºå…¨å±€çš„Viperå®ä¾‹å¯¹è±¡,é»˜è®¤ä½¿ç”¨viperåŒ…ä½¿ç”¨ä¹Ÿæ˜¯è¯¥å…¨å±€Viperå®ä¾‹ã€‚æŸ¥çœ‹viperçš„æºç ï¼Œå¯ä»¥çœ‹åˆ°viperé»˜è®¤æä¾›äº†ä¸€ä¸ªå…¨å±€çš„Viperå®ä¾‹ï¼š</li></ul> 
<div> 
 <pre><code class="language-Go">var v *Viper

func init() {
	v = New()
}

// New returns an initialized Viper instance.
func New() *Viper {
	v := new(Viper)
	v.keyDelim = "."
	v.configName = "config"
	v.configPermissions = os.FileMode(0o644)
	v.fs = afero.NewOsFs()
	v.config = make(map[string]interface{})
	v.override = make(map[string]interface{})
	v.defaults = make(map[string]interface{})
	v.kvstore = make(map[string]interface{})
	v.pflags = make(map[string]FlagValue)
	v.env = make(map[string][]string)
	v.aliases = make(map[string]string)
	v.typeByDefValue = false
	v.logger = jwwLogger{}

	v.resetEncoding()

	return v
}
</code></pre> 
</div> 
<ul><li>Newå’ŒNewWithOptionsä¸ºæˆ‘ä»¬æä¾›äº†åˆ›å»ºå®ä¾‹çš„æ–¹æ³•ã€‚Newæ˜¯ç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®é¡¹è¿›è¡Œåˆ›å»ºï¼Œè€ŒNewWithOptionså¯ä»¥ä¼ å…¥ä¸€äº›é…ç½®é¡¹ã€‚</li></ul> 
<div> 
 <pre><code class="language-Go">func New1() *viper.Viper {
	return viper.New()
}

func New2() *viper.Viper {
	return viper.NewWithOptions()
}
</code></pre> 
</div> 
<ul><li>Subä¸ºæˆ‘ä»¬è¯»å–å­é…ç½®é¡¹æä¾›äº†ä¸€ä¸ªæ–°çš„å®ä¾‹Viperï¼Œä½¿ç”¨å­é…ç½®é¡¹çš„Viperå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é™å®šä»–åªè¯»å–è¯¥å­é…ç½®é¡¹çš„é…ç½®ã€‚</li></ul> 
<div> 
 <pre><code class="language-Go">v := viper.Sub("db")
url := v.Get("url")
log.Printf("mysql url:%s\n", url)
</code></pre> 
</div> 
<h4 id="2.2%C2%A0%E9%A2%84%E8%AE%BE%E4%B8%80%E4%BA%9B%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">2.2Â é¢„è®¾é»˜è®¤é…ç½®ã€‚Â </h4> 
<div> 
 <pre><code class="language-Go">viper.SetDefault("ContentDir", "content")
viper.SetDefault("Taxonomies", map[string]string{"tag": "tags", "category": "categories"})

viper.SetDefault("redis.port", 6379)
viper.SetDefault("mysql.url", "root:root@tcp(127.0.0.1:3306)/stock?charset=utf8mb4&amp;parseTime=True&amp;loc=Local")
</code></pre> 
</div> 
<p>Â æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›é¡¹ç›®åˆå§‹åŒ–çš„é»˜è®¤çš„é…ç½®é¡¹ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®ã€‚</p> 
<h4 id="2.3%C2%A0%E4%BB%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0Flags%E8%AF%BB%E5%8F%96">2.3Â ä»å‘½ä»¤è¡Œå·¥å…·çš„é€‰é¡¹å‚æ•°Flagsè¯»å–</h4> 
<p>viperä¸»è¦æä¾›äº†ä»¥ä¸‹å››ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç»‘å®šå‘½ä»¤è¡Œå‚æ•°çš„è¾“å…¥çš„é€‰é¡¹å€¼ï¼š</p> 
<div> 
 <pre><code class="language-Go">func (v *Viper) BindFlagValue(key string, flag FlagValue) error
func (v *Viper) BindFlagValues(flags FlagValueSet) (err error)
func (v *Viper) BindPFlag(key string, flag *pflag.Flag) error
func (v *Viper) BindPFlags(flags *pflag.FlagSet) error
</code></pre> 
</div> 
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦ç»“åˆä¹‹å‰è®²çš„cobraåº“ä¸­çš„pflagæ¥è®²è§£ä¸€ä¸‹viperå¯¹Flagsé€‰é¡¹å‚æ•°çš„ç»‘å®šã€‚<br> åœ¨cobraä¸­ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡cobra.Commandæ¥ç»„ç»‡ä¸åŒçš„å‘½ä»¤å’Œå­å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬æˆ‘é€šè¿‡åœ¨rootæ ¹å‘½ä»¤æ¥åšæµ‹è¯•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p> 
<div> 
 <pre><code class="language-Go">func init(){
	rootCmd.Flags().String("author", "YOUR NAME", "Author name for copyright attribution")
	rootCmd.Flags().String("email", "YOUR EMAIL", "Author email for contact")

	// ç»‘å®šå¤šä¸ªkey-valueå€¼
	viper.BindPFlags(rootCmd.Flags())

  // å•ä¸ªç»‘å®šä¸åŒçš„key
	viper.BindPFlag("author", rootCmd.Flags().Lookup("author"))
	viper.BindPFlag("email", rootCmd.Flags().Lookup("email"))

	rootCmd.AddCommand(version.VersionCmd)
}
</code></pre> 
</div> 
<p>åœ¨cobraçš„å‘½ä»¤çš„runå›è°ƒæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡viperçš„æ¥è·å–è¾“å…¥çš„é€‰é¡¹å€¼</p> 
<div> 
 <pre><code class="language-Go">func run(){
	fmt.Println("go root cmd run")

	fmt.Println(viper.GetString("author"))

	fmt.Println(viper.GetString("email"))
}
</code></pre> 
</div> 
<p>å¯åŠ¨åº”ç”¨ï¼Œä¼ å…¥å‚æ•°æµ‹è¯•ä¸€ä¸‹ï¼š</p> 
<div> 
 <pre><code class="language-Go">go run main.go --author ckeen --email ck@gmail.com
</code></pre> 
</div> 
<p>æŸ¥çœ‹ä¸€ä¸‹æ‰“å°ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ä»viperæˆåŠŸè·å–åˆ°ä»¥flagä¼ å…¥çš„å‚æ•°å€¼ï¼š</p> 
<div> 
 <pre><code class="language-bash">âœ  cli git:(master) âœ— go run main.go --author keen --email ck@gmail.com
go root cmd run
ckeen
ck@gmail.com
</code></pre> 
</div> 
<h4 id="2.4%C2%A0%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96">2.4Â ä»ç¯å¢ƒå˜é‡è¯»å–</h4> 
<p>viperæ”¯æŒç»‘å®šç¯å¢ƒå˜é‡ï¼Œä»¥å¯¹ç¯å¢ƒå˜é‡è¿›è¡Œæ“ä½œã€‚å¯¹ç¯å¢ƒå˜é‡çš„æ“ä½œä¸»è¦æœ‰ä»¥ä¸‹çš„å‡½æ•°ï¼š</p> 
<div> 
 <pre><code class="language-Go">func (v *Viper) AutomaticEnv()			// å¼€å¯ç»‘å®šç¯å¢ƒå˜é‡
func (v *Viper) BindEnv(input ...string) error		// ç»‘å®šç³»ç»Ÿä¸­æŸä¸ªç¯å¢ƒå˜é‡
func (v *Viper) SetEnvKeyReplacer(r *strings.Replacer)
func (v *Viper) SetEnvPrefix(in string)
</code></pre> 
</div> 
<p>é‚£æˆ‘ä»¬æ˜¯æ€ä¹ˆå¯¹ç¯å¢ƒå˜é‡è¿›è¡Œæ“ä½œçš„å‘¢ï¼Ÿ ä¸‹é¢æˆ‘ä»¬è¯´ä¸€ä¸‹ä¸»è¦çš„æ“ä½œæ–¹æ³•ï¼š</p> 
<ol><li>ä½¿ç”¨AutomaticEnv()å¼€å¯ç»‘å®šç¯å¢ƒå˜é‡ï¼Œæ²¡å¼€å¯çš„æ—¶å€™ä¸ä¼šä»ç¯å¢ƒå˜é‡è·å–ï¼Œå¼€å¯åå¯ä»¥è·å–ç¯å¢ƒå˜é‡çš„å€¼ã€‚å¦‚æœä¸æƒ³å¼€å¯æ‰€æœ‰ç¯å¢ƒå˜é‡å€¼ï¼Œå¯ä»¥ä½¿ç”¨BindEnv(input â€¦string)æ–¹æ³•ç»‘å®šå•ä¸ªç¯å¢ƒå˜é‡çš„ç»‘å®šï¼Œ é‚£ä¹ˆåªæœ‰è¯¥ç»‘å®šçš„ç¯å¢ƒå˜é‡çš„keyæ‰èƒ½è·å–åˆ°å€¼</li><li>ç»‘å®šç¯å¢ƒå˜é‡åï¼Œå¯ä»¥ä½¿ç”¨æ­£å¸¸çš„Getæ–¹æ³•æ¥è·å–å˜é‡å€¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 
  <div> 
   <pre><code class="language-Go">func testEnv(){
	v := New1()

	os.Setenv("CK_HOME","123")
	os.Setenv("CK_NAME","ckeen")

	v.AutomaticEnv()
	//v.BindEnv("SHELL")
	v.AllowEmptyEnv(true)

	log.Printf("os env:%+v\n", os.Environ())

	log.Printf("env: %+v\n", v.Get("HOME"))
	log.Printf("env: %+v\n", v.Get("SHELL"))

	v.SetEnvPrefix("CK")

	log.Printf("ck-home: %+v\n", v.Get("HOME"))
	log.Printf("ck-email: %+v\n", v.Get("NAME"))

}</code></pre> 
  </div> </li><li>è¿˜å¯ä»¥é€šè¿‡SetEnvPrefix()æ–¹æ³•è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€, å‰ç¼€å’ŒKeyä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†å‰²</li></ol> 
<h4 id="2.5%C2%A0%E4%BB%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">2.5Â ä»é…ç½®æ–‡ä»¶è¯»å–</h4> 
<p>æˆ‘ä»¬é‡ç‚¹è®²ä¸€ä¸‹æ“ä½œå®ä¾‹çš„æ–¹æ³•ï¼šÂ </p> 
<p>å…ˆçœ‹ä¸‹æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶app.ymlæ–‡ä»¶ï¼š</p> 
<div> 
 <pre><code class="language-bash">app:
  name: viper-test
  mode: dev

db:
  mysql:
    url: "root:root@tcp(127.0.0.1:3306)/stock?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"
  redis:
    host: 127.0.0.1
    port:  6067
    db: 0
    passwd: 123456</code></pre> 
</div> 
<p>ç„¶åæˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸‹ä½¿ç”¨viperåº“å®é™…çš„æ“ä½œæ–¹æ³•ï¼šÂ </p> 
<ul><li>åˆå§‹åŒ–é…ç½® 
  <div> 
   <pre><code class="language-Go">func InitConfig() (*viper.Viper, error) {
  v := viper.New()
  v.AddConfigPath(".")					// æ·»åŠ é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œç‚¹å·ä¸ºå½“å‰ç›®å½•
  v.AddConfigPath("./configs")		// æ·»åŠ å¤šä¸ªæœç´¢ç›®å½•
  v.SetConfigType("yaml")				// å¦‚æœé…ç½®æ–‡ä»¶æ²¡æœ‰åç¼€ï¼Œå¯ä»¥ä¸ç”¨é…ç½®
  v.SetConfigName("app.yml")			// æ–‡ä»¶åï¼Œæ²¡æœ‰åç¼€
	
	// v.SetConfigFile("configs/app.yml")
  
  // è¯»å–é…ç½®æ–‡ä»¶
  if err := v.ReadInConfig(); err == nil {
		log.Printf("use config file -&gt; %s\n", v.ConfigFileUsed())
	} else {
		return nil,err
	}
  return v, nil
}
</code></pre> 
  </div> <p>é¦–å…ˆè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œç‚¹å·è¡¨ç¤ºå½“å‰è·¯å¾„ï¼Œæœç´¢è·¯å¾„å¯ä»¥æ·»åŠ å¤šä¸ªç„¶åè®¾ç½®äº†é…ç½®æ–‡ä»¶ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®æ–‡ä»¶ç±»å‹ä¸ºyamlï¼Œ</p> <p>æ¥ç€æˆ‘ä»¬è®¾ç½®äº†é…ç½®æ–‡ä»¶åç§°ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä»é…ç½®çš„æœç´¢è·¯å¾„ä»æŸ¥æ‰¾ã€‚</p> <p>æœ€åæˆ‘ä»¬é€šè¿‡æä¾›çš„ReadInConfig()å‡½æ•°è¯»å–é…ç½®æ–‡ä»¶</p> </li><li>è¯»å–é…ç½®æ–‡ä»¶ 
  <div> 
   <pre><code class="language-Go">// é€šè¿‡.å·æ¥åŒºåˆ†ä¸åŒå±‚çº§ï¼Œæ¥è·å–é…ç½®å€¼
log.Printf("app.mode=%s\n", v.Get("app.mode"))
log.Printf("db.mysql.url=%s\n", v.Get("db.mysql.url"))
log.Printf("db.redis.host=%s\n", v.GetString("db.redis.host"))
log.Printf("db.redis.port=%d\n", v.GetInt("db.redis.port"))

// ä½¿ç”¨Subè·å–å­é…ç½®ï¼Œç„¶åè·å–é…ç½®å€¼
v2 := v.Sub("db")
log.Printf("db.mysql.url:%s\n", v2.Sub("mysql").GetString("url"))
log.Printf("db.redis.host:%s\n", v2.Sub("redis").GetString("host"))
log.Printf("db.redis.port:%s\n", v2.Sub("redis").GetInt("port"))</code></pre> 
  </div> <p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨viperæä¾›çš„ä¸åŒçš„æ–¹æ³•æ¥è¯»å–é…ç½®å€¼ï¼Œå¤šå±‚çº§çš„çš„é…ç½®é¡¹æˆ‘ä»¬ä½¿ç”¨ç‚¹å·è¿›è¡ŒåŒºåˆ†ã€‚é™¤äº†ä¸Šé¢è¿™äº›æ–¹æ³•ï¼Œviperè¿˜æä¾›äº†å¦‚ä¸‹è·å–ç±»å‹è·å–é…ç½®é¡¹å€¼ï¼š<br><img alt="" height="503" src="https://images2.imgbox.com/08/b1/eUsUYZ1r_o.png" width="558">â€‹</p> <p>Â <strong>æ³¨ï¼š å…¶ä¸­é‡è¦çš„ä¸€ä¸ªå‡½æ•°IsSetå¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦è¢«è®¾ç½®</strong></p> </li></ul> 
<p>Â viperåº“æä¾›äº†ä¸åŒçš„ç±»å‹çš„å‡½æ•°ï¼Œæ¥æ–¹ä¾¿æˆ‘ä»¬è¯»å–ä¸åŒæ•°æ®ç±»å‹çš„é…ç½®ã€‚</p> 
<h4 id="2.6%C2%A0%E4%BB%8E%E8%BF%9C%E7%A8%8Bkey%2Fvalue%E5%AD%98%E5%82%A8%E8%AF%BB%E5%8F%96">2.6Â ä»è¿œç¨‹key/valueå­˜å‚¨è¯»å–</h4> 
<p>åœ¨Viperä¸­å¯ç”¨è¿œç¨‹æ”¯æŒï¼Œéœ€è¦åœ¨ä»£ç ä¸­åŒ¿åå¯¼å…¥<code>viper/remote</code>è¿™ä¸ªåŒ…ã€‚</p> 
<div> 
 <pre><code class="language-Go">_ "github.com/spf13/viper/remote"</code></pre> 
</div> 
<p>Viperå°†è¯»å–ä»Key/Valueå­˜å‚¨ç³»ç»Ÿä¸­çš„æ£€ç´¢åˆ°çš„é…ç½®å­—ç¬¦ä¸²ï¼ˆå¦‚<code>JSON</code>ã€<code>TOML</code>ã€<code>YAML</code>æ ¼å¼ï¼‰ã€‚viperç›®å‰æ”¯æŒConsul/Etcd/firestoreä¸‰ç§Key/Valueçš„å­˜å‚¨ç³»ç»Ÿã€‚ä¸‹é¢æˆ‘æ¥æ¼”ç¤ºä»etcdè¯»å–é…ç½®ï¼š</p> 
<ul><li>é¦–å…ˆæˆ‘ä»¬å®‰è£…cryptçš„å·¥å…· 
  <div> 
   <pre><code class="language-Go">go get github.com/bketelsen/crypt/bin/crypt</code></pre> 
  </div> </li><li>ä½¿ç”¨cryptçš„å‘½ä»¤ï¼Œå°†app.ymlçš„æ–‡ä»¶æ·»åŠ åˆ°detcd 
  <div> 
   <pre><code>crypt set --endpoint=http://127.0.0.1:2379 -plaintext /config/app.yml /Users/ckeen/Documents/code/gosource/go-awesome/go-samples/viper/configs/app.yml</code></pre> 
  </div> </li><li>æ·»åŠ viperçš„æ“ä½œè¿œç¨‹èµ„æºçš„é…ç½® 
  <div> 
   <pre><code class="language-Go">_ "github.com/spf13/viper/remote"</code></pre> 
  </div> </li><li>å®ç°ä»è¿œç¨‹è¯»å–é…ç½® 
  <div> 
   <pre><code class="language-Go">func InitConfigFromRemote() (*viper.Viper,error) {
	v := viper.New()
	// è¿œç¨‹é…ç½®
	v.AddRemoteProvider("etcd","http://127.0.0.1:2379","config/app.yml")
	//v.SetConfigType("json")
	v.SetConfigFile("app.yml")
	v.SetConfigType("yml")

	if err := v.ReadRemoteConfig(); err == nil {
		log.Printf("use config file -&gt; %s\n", v.ConfigFileUsed())
	} else {
		return nil, err
	}
	return v, nil
}

func main(){
  
  v, err := InitConfigFromRemote()
	if err != nil {
		log.Printf("read remote error:%+v\n")
	}

	log.Printf("remote read app.mode=%+v\n", v.GetString("app.mode"))
	log.Printf("remote read db.mysql.url=%+v\n", v.GetString("db.mysql.url"))
 
}</code></pre> 
  </div> </li><li>æµ‹è¯•æ‰“å°ç»“æœ<br><img alt="" height="202" src="https://images2.imgbox.com/f3/78/lItX124z_o.png" width="1200">â€‹</li></ul> 
<h4 id="2.7%C2%A0%E7%9B%91%E5%90%AC%E9%85%8D%E7%BD%AE%E5%8F%98%E5%8C%96">2.7Â ç›‘å¬é…ç½®å˜åŒ–</h4> 
<p>viperæä¾›å¦‚ä¸‹ä¸¤ç§ç›‘å¬é…ç½®çš„å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°çš„ç›‘å¬å’Œä¸€ä¸ªè¿œç¨‹ç›‘å¬çš„ï¼š</p> 
<div> 
 <pre><code class="language-Go">func (v *Viper) WatchConfig()
func (v *Viper) WatchRemoteConfig() error
func (v *Viper) WatchRemoteConfigOnChannel() error
</code></pre> 
</div> 
<p>æˆ‘ä»¬ä¸»è¦çœ‹ä¸€ä¸‹ç›‘å¬æœ¬åœ°æ–‡ä»¶å˜æ›´çš„ç¤ºä¾‹</p> 
<div> 
 <pre><code class="language-Go">v, err := InitConfig()
if err != nil {
log.Fatalf("viperè¯»å–å¤±è´¥, error:%+v\n",err)
}

// ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–åçš„å›è°ƒ
v.OnConfigChange(func(e fsnotify.Event) {
  fmt.Println("Config file changed:", e.Name)
  fmt.Println(v.Get("db.redis.passwd"))
})

v.WatchConfig()

// é˜»å¡è¿›ç¨‹é€€å‡º
time.Sleep(time.Duration(1000000) * time.Second)
</code></pre> 
</div> 
<p>æˆ‘ä»¬ä½¿ç”¨å‰é¢çš„InitConfig()æ–¹æ³•æ¥åˆå§‹åŒ–æœ¬åœ°æ–‡ä»¶è¯»å–é…ç½®ï¼Œç„¶åè®¾å®šäº†ç›‘å¬å‡½æ•°ï¼Œæœ€åä½¿ç”¨WatchConfig()å¼€å¯æœ¬åœ°æ–‡ä»¶ç›‘å¬ã€‚</p> 
<p>å½“æˆ‘ä»¬ä¿®æ”¹æœ¬åœ°é…ç½®configs/app.ymlçš„db.redis.passwdçš„å€¼ï¼Œç„¶åä¿å­˜åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æœ‰æ‰“å°æœ€æ–°ä¿®æ”¹åçš„å€¼ï¼Œä¸è¦æˆ‘ä»¬é‡æ–°å»è·å–ã€‚</p> 
<h4 id="2.8%20%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E5%88%B0%E6%96%87%E4%BB%B6">2.8 å†™å…¥é…ç½®åˆ°æ–‡ä»¶</h4> 
<p>viperæä¾›äº†å¦‚ä¸‹å››ä¸ªå†™å…¥é…ç½®æ–‡ä»¶å‘æ–¹æ³•</p> 
<div> 
 <pre><code class="language-Go">func (v *Viper) SafeWriteConfig() error
func (v *Viper) SafeWriteConfigAs(filename string) error
func (v *Viper) WriteConfig() error
func (v *Viper) WriteConfigAs(filename string) error</code></pre> 
</div> 
<p>ä½¿ç”¨SafeWriteConfig()å’ŒWriteConfig()æ—¶ï¼Œå¯ä»¥å…ˆè®¾å®šSetConfigFile()è®¾å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚é…ç½®å†™å…¥ç¤ºä¾‹ï¼š<br> Â </p> 
<div> 
 <pre><code class="language-Go">v := New1()
v.SetConfigFile("./hello.yml")

log.Printf("config path:%+v\n", v.ConfigFileUsed())

v.SetDefault("author","CKeen")
v.SetDefault("email", "ck@gmail.com")

v.Set("hello", "foo")

v.Set("slice", []string {"slice1","slice2","slice3"})

v.SetDefault("test.web", "https://ckeen.cn")

v.WriteConfig()

//v.WriteConfigAs("./hello.yml")</code></pre> 
</div> 
<p>å¦‚æœä½¿ç”¨SafeWriteConfigAs()æˆ–è€…WriteConfigAs()æ–¹æ³•ï¼Œåˆ™ç›´æ¥ä¼ å…¥é…ç½®æ–‡ä»¶è·¯å¾„å³å¯ã€‚</p> 
<p></p> 
<h3 id="3.%C2%A0%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90--%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96%E7%9A%84%E9%A1%BA%E5%BA%8F">3.Â æºç åˆ†æ--é…ç½®è¯»å–çš„é¡ºåº</h3> 
<p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹æˆ‘ä»¬çŸ¥é“ï¼Œviperè¯»å–é…ç½®ä¸»è¦é€šè¿‡ä¸€ç³»åˆ—Getæ–¹æ³•æ¥å®ç°ï¼Œæˆ‘ä»¬ä»Getæ–¹æ³•è·³è½¬åˆ°æºç å¯ä»¥å‘ç°ï¼Œ ä¸»è¦è·å–çš„é…ç½®å€¼çš„ä¸ºfindæ–¹æ³•ï¼Œ æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p> 
<div> 
 <pre><code class="language-Go">func (v *Viper) find(lcaseKey string, flagDefault bool) interface{} {
	var (
		val    interface{}
		exists bool
		path   = strings.Split(lcaseKey, v.keyDelim)
		nested = len(path) &gt; 1
	)

	// compute the path through the nested maps to the nested value
	if nested &amp;&amp; v.isPathShadowedInDeepMap(path, castMapStringToMapInterface(v.aliases)) != "" {
		return nil
	}

	// if the requested key is an alias, then return the proper key
	lcaseKey = v.realKey(lcaseKey)
	path = strings.Split(lcaseKey, v.keyDelim)
	nested = len(path) &gt; 1

	// Set() override first
	val = v.searchMap(v.override, path)
	if val != nil {
		return val
	}
	if nested &amp;&amp; v.isPathShadowedInDeepMap(path, v.override) != "" {
		return nil
	}

	// PFlag override next
	flag, exists := v.pflags[lcaseKey]
	if exists &amp;&amp; flag.HasChanged() {
		switch flag.ValueType() {
		case "int", "int8", "int16", "int32", "int64":
			return cast.ToInt(flag.ValueString())
		case "bool":
			return cast.ToBool(flag.ValueString())
		case "stringSlice", "stringArray":
			s := strings.TrimPrefix(flag.ValueString(), "[")
			s = strings.TrimSuffix(s, "]")
			res, _ := readAsCSV(s)
			return res
		case "intSlice":
			s := strings.TrimPrefix(flag.ValueString(), "[")
			s = strings.TrimSuffix(s, "]")
			res, _ := readAsCSV(s)
			return cast.ToIntSlice(res)
		case "stringToString":
			return stringToStringConv(flag.ValueString())
		default:
			return flag.ValueString()
		}
	}
	if nested &amp;&amp; v.isPathShadowedInFlatMap(path, v.pflags) != "" {
		return nil
	}

	// Env override next
	if v.automaticEnvApplied {
		// even if it hasn't been registered, if automaticEnv is used,
		// check any Get request
		if val, ok := v.getEnv(v.mergeWithEnvPrefix(lcaseKey)); ok {
			return val
		}
		if nested &amp;&amp; v.isPathShadowedInAutoEnv(path) != "" {
			return nil
		}
	}
	envkeys, exists := v.env[lcaseKey]
	if exists {
		for _, envkey := range envkeys {
			if val, ok := v.getEnv(envkey); ok {
				return val
			}
		}
	}
	if nested &amp;&amp; v.isPathShadowedInFlatMap(path, v.env) != "" {
		return nil
	}

	// Config file next
	val = v.searchIndexableWithPathPrefixes(v.config, path)
	if val != nil {
		return val
	}
	if nested &amp;&amp; v.isPathShadowedInDeepMap(path, v.config) != "" {
		return nil
	}

	// K/V store next
	val = v.searchMap(v.kvstore, path)
	if val != nil {
		return val
	}
	if nested &amp;&amp; v.isPathShadowedInDeepMap(path, v.kvstore) != "" {
		return nil
	}

	// Default next
	val = v.searchMap(v.defaults, path)
	if val != nil {
		return val
	}
	if nested &amp;&amp; v.isPathShadowedInDeepMap(path, v.defaults) != "" {
		return nil
	}

	if flagDefault {
		// last chance: if no value is found and a flag does exist for the key,
		// get the flag's default value even if the flag's value has not been set.
		if flag, exists := v.pflags[lcaseKey]; exists {
			switch flag.ValueType() {
			case "int", "int8", "int16", "int32", "int64":
				return cast.ToInt(flag.ValueString())
			case "bool":
				return cast.ToBool(flag.ValueString())
			case "stringSlice", "stringArray":
				s := strings.TrimPrefix(flag.ValueString(), "[")
				s = strings.TrimSuffix(s, "]")
				res, _ := readAsCSV(s)
				return res
			case "intSlice":
				s := strings.TrimPrefix(flag.ValueString(), "[")
				s = strings.TrimSuffix(s, "]")
				res, _ := readAsCSV(s)
				return cast.ToIntSlice(res)
			case "stringToString":
				return stringToStringConv(flag.ValueString())
			default:
				return flag.ValueString()
			}
		}
		// last item, no need to check shadowing
	}

	return nil
}</code></pre> 
</div> 
<p>é€šè¿‡æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“viperè¯»å–é…ç½®çš„ä¼˜å…ˆçº§é¡ºåºï¼š<u><strong>aliasåˆ«å &gt; è°ƒç”¨Setè®¾ç½® &gt; flag &gt; env &gt; config &gt; key/value store &gt; default</strong></u></p> 
<p>è¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹<u><em><strong>:viperé…ç½®é”®ä¸åŒºåˆ†å¤§å°å†™ï¼Œå› ä¸ºviperå†…éƒ¨å¯¹keyç»Ÿä¸€è½¬ä¸ºäº†å°å†™ã€‚</strong></em></u></p> 
<h3 id="4.%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. å‚è€ƒèµ„æ–™</h3> 
<ol><li> <p>viperçš„åŒ…åœ°å€ï¼š<a href="https://pkg.go.dev/github.com/spf13/viper" rel="nofollow" title="viper package - github.com/spf13/viper - Go Packages">viper package - github.com/spf13/viper - Go Packages</a></p> </li><li> <p>viperçš„githubåœ°å€ï¼š <a href="https://github.com/spf13/viper" title="GitHub - spf13/viper: Go configuration with fangs">GitHub - spf13/viper: Go configuration with fangs</a></p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36b52b736dd6e06160de9fba103b6216/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">HTTPã€HTTPSã€FTP å’Œ TCP è¯¦ç»†è®²è§£ï¼šåè®®çš„åŠŸèƒ½å’Œç‰¹ç‚¹</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4525912753728030c6f04b206753b073/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€Android Frameworkç³»åˆ—ã€‘ç¬¬2ç«  Binderæœºåˆ¶å¤§å…¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>