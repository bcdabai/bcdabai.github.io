<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WSL2 &#43; Docker &#43; xfce4安装及使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WSL2 &#43; Docker &#43; xfce4安装及使用" />
<meta property="og:description" content="WSL2 &#43; Docker &#43; xfce4安装及使用 WSL官方指南：适用于 Linux 的 Windows 子系统安装指南 (Windows 10)
文档比较详细，而且会持续更新，欢迎大家指错。
文章目录 WSL2 &#43; Docker &#43; xfce4安装及使用一、前言1.1 什么是WSL?1.2 比较 WSL 1 和 WSL 21.3 WSL可以做什么？ 二、便捷自动安装（本人未测试）三、手动安装 WSL 23.1 启用适用于 Linux 的 Windows 子系统*3.2 更新到 WSL 23.2.1 检查运行 WSL 2 的要求3.2.2 启用“虚拟机平台”可选组件*3.2.3 将 WSL 2 设置为默认版本3.2.4 下载 Linux 内核更新包 3.3 安装所选的 Linux 分发版3.3.1 下载 Linux 分发版3.3.2 设置新分发版3.3.3 修改ubuntu的apt安装源3.3.4 重置 Linux 密码(可选)3.3.5 忘记密码(可选)3.3.6 修改root用户密码(可选)3.3.7 修改默认用户root(可选) 3.4 自定义分发版安装目录(可选，推荐)3.4.1 如果未安装分发版3.4.2 如果已经安装分发版(未测试) 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8ad7315009b4f4910f57fbaa9d01b6fc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-07T19:44:21+08:00" />
<meta property="article:modified_time" content="2023-11-07T19:44:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WSL2 &#43; Docker &#43; xfce4安装及使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="WSL2__Docker__xfce4_0"></a>WSL2 + Docker + xfce4安装及使用</h2> 
<blockquote> 
 <p>WSL官方指南：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10" rel="nofollow">适用于 Linux 的 Windows 子系统安装指南 (Windows 10)</a></p> 
 <p>文档比较详细，而且会持续更新，欢迎大家指错。</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#WSL2__Docker__xfce4_0" rel="nofollow">WSL2 + Docker + xfce4安装及使用</a></li><li><ul><li><a href="#_9" rel="nofollow">一、前言</a></li><li><ul><li><a href="#11_WSL_11" rel="nofollow">1.1 什么是WSL?</a></li><li><a href="#12__WSL_1__WSL_2_17" rel="nofollow">1.2 比较 WSL 1 和 WSL 2</a></li><li><a href="#13_WSL_29" rel="nofollow">1.3 WSL可以做什么？</a></li></ul> 
   </li><li><a href="#_43" rel="nofollow">二、便捷自动安装（本人未测试）</a></li><li><a href="#_WSL_2_59" rel="nofollow">三、手动安装 WSL 2</a></li><li><ul><li><a href="#31__Linux__Windows__63" rel="nofollow">3.1 启用适用于 Linux 的 Windows 子系统*</a></li><li><a href="#32__WSL_2_98" rel="nofollow">3.2 更新到 WSL 2</a></li><li><ul><li><a href="#321__WSL_2__100" rel="nofollow">3.2.1 检查运行 WSL 2 的要求</a></li><li><a href="#322__115" rel="nofollow">3.2.2 启用“虚拟机平台”可选组件*</a></li><li><a href="#323__WSL_2__154" rel="nofollow">3.2.3 将 WSL 2 设置为默认版本</a></li><li><a href="#324__Linux__189" rel="nofollow">3.2.4 下载 Linux 内核更新包</a></li></ul> 
    </li><li><a href="#33__Linux__203" rel="nofollow">3.3 安装所选的 Linux 分发版</a></li><li><ul><li><a href="#331__Linux__219" rel="nofollow">3.3.1 下载 Linux 分发版</a></li><li><a href="#332__248" rel="nofollow">3.3.2 设置新分发版</a></li><li><a href="#333_ubuntuapt_277" rel="nofollow">3.3.3 修改ubuntu的apt安装源</a></li><li><a href="#334__Linux__408" rel="nofollow">3.3.4 重置 Linux 密码(可选)</a></li><li><a href="#335__414" rel="nofollow">3.3.5 忘记密码(可选)</a></li><li><a href="#336_root_426" rel="nofollow">3.3.6 修改root用户密码(可选)</a></li><li><a href="#337_root_451" rel="nofollow">3.3.7 修改默认用户root(可选)</a></li></ul> 
    </li><li><a href="#34__501" rel="nofollow">3.4 自定义分发版安装目录(可选，推荐)</a></li><li><ul><li><a href="#341__505" rel="nofollow">3.4.1 如果未安装分发版</a></li><li><a href="#342__531" rel="nofollow">3.4.2 如果已经安装分发版(未测试)</a></li></ul> 
    </li><li><a href="#35__Windows_Terminal_608" rel="nofollow">3.5 安装 Windows Terminal终端(可选，推荐安装)</a></li><li><ul><li><a href="#351__616" rel="nofollow">3.5.1 微软商店自动安装</a></li><li><a href="#352__622" rel="nofollow">3.5.2 手动离线安装</a></li></ul> 
    </li><li><a href="#36_WSL_634" rel="nofollow">3.6 查询WSL状态、设置分发版版本</a></li><li><a href="#37_WSLsystemd_672" rel="nofollow">3.7 安装WSL的systemd命令(可选)</a></li><li><a href="#38__723" rel="nofollow">3.8 可能出现的问题</a></li><li><ul><li><a href="#381__725" rel="nofollow">3.8.1 参考的对象类型不支持尝试的操作（参考问题）</a></li><li><a href="#382_HyperV_733" rel="nofollow">3.8.2 关于Hyper-V是否需要开启</a></li><li><a href="#383_Windows_10_WSL2_748" rel="nofollow">3.8.3 关于Windows 10 家庭版能否安装WSL2的问题</a></li><li><a href="#384_WSL__2__756" rel="nofollow">3.8.4 WSL 转换到版本 2 失败</a></li><li><a href="#385_WslRegisterDistribution_failed_with_error_0x800701bc_766" rel="nofollow">3.8.5 WslRegisterDistribution failed with error: 0x800701bc</a></li><li><a href="#386__772" rel="nofollow">3.8.6 其他错误</a></li></ul> 
   </li></ul> 
   </li><li><a href="#WSL2_778" rel="nofollow">四、WSL2使用帮助</a></li><li><ul><li><a href="#41_IP_780" rel="nofollow">4.1 网络访问方式(IP)</a></li><li><a href="#42__801" rel="nofollow">4.2 文件系统</a></li><li><ul><li><a href="#421__819" rel="nofollow">4.2.1 设置软连接快捷访问（可选）</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Docker_859" rel="nofollow">五、安装Docker</a></li><li><ul><li><a href="#51_linuxdocker_871" rel="nofollow">5.1 原生linux安装docker</a></li><li><a href="#52_Docker_Desktop_for_Windows_921" rel="nofollow">5.2 Docker Desktop for Windows（推荐）</a></li><li><ul><li><a href="#521_Docker_Desktop_925" rel="nofollow">5.2.1 准备修改Docker Desktop软件默认安装路径(可选)</a></li><li><a href="#522__949" rel="nofollow">5.2.2 开始安装</a></li><li><a href="#523__WSL2__Docker_974" rel="nofollow">5.2.3 在 WSL2 运行 Docker</a></li><li><a href="#524__1002" rel="nofollow">5.2.4 修改镜像和容器等数据存储位置(可选)</a></li><li><a href="#525_Docker__WSL_2_1100" rel="nofollow">5.2.5 Docker + WSL 2使用手册</a></li></ul> 
    </li><li><a href="#53__1117" rel="nofollow">5.3 两种安装方式总结</a></li><li><a href="#54__WSL__1143" rel="nofollow">5.4 检查 WSL 模式</a></li><li><a href="#55__1179" rel="nofollow">5.5 配置镜像加速器（阿里云）</a></li><li><ul><li><a href="#551_Docker_Desktop_for_Windows_1183" rel="nofollow">5.5.1 Docker Desktop for Windows</a></li><li><a href="#552_Docker_ce_1195" rel="nofollow">5.5.2 Docker ce</a></li></ul> 
    </li><li><a href="#56__1220" rel="nofollow">5.6 可能出现的问题</a></li></ul> 
   </li><li><a href="#_1287" rel="nofollow">六、安装桌面环境(可选)</a></li><li><ul><li><a href="#61__1291" rel="nofollow">6.1 介绍</a></li><li><a href="#62__1321" rel="nofollow">6.2 开始</a></li><li><a href="#63__1325" rel="nofollow">6.3 源更新与升级依赖</a></li><li><a href="#64__1334" rel="nofollow">6.4 安装桌面环境</a></li><li><ul><li><a href="#641_xfce4_1340" rel="nofollow">6.4.1 安装xfce4</a></li></ul> 
    </li><li><a href="#65_session_1354" rel="nofollow">6.5 为当前用户指定登录session类型</a></li><li><a href="#66__1379" rel="nofollow">6.6 安装远程桌面服务</a></li><li><ul><li><a href="#661_xrdp_1385" rel="nofollow">6.6.1 安装xrdp</a></li><li><a href="#662_xrdp_1424" rel="nofollow">6.6.2 修改xrdp配置</a></li><li><a href="#663__1490" rel="nofollow">6.6.3 重启一下电脑</a></li><li><a href="#664_xrdp_1494" rel="nofollow">6.6.4 启动xrdp</a></li><li><a href="#665_IP_1508" rel="nofollow">6.6.5 查看IP地址</a></li></ul> 
    </li><li><a href="#67__1516" rel="nofollow">6.7 远程连接</a></li><li><ul><li><a href="#671__1526" rel="nofollow">6.7.1 配置防火墙</a></li></ul> 
    </li><li><a href="#68__1544" rel="nofollow">6.8 设置中文以及安装输入法（坑）</a></li><li><ul><li><a href="#681_1548" rel="nofollow">6.8.1安装中文语言包</a></li><li><a href="#682__1567" rel="nofollow">6.8.2 修改默认语言环境为中文</a></li><li><a href="#683__1581" rel="nofollow">6.8.3 安装完整的语言支持</a></li><li><a href="#684__1611" rel="nofollow">6.8.4 安装中文输入法</a></li></ul> 
    </li><li><a href="#69__1638" rel="nofollow">6.9 可能出现的问题</a></li><li><ul><li><a href="#691_xrdp_1640" rel="nofollow">6.9.1 xrdp远程桌面黑屏处理</a></li><li><a href="#692__1663" rel="nofollow">6.9.2 进入图形界面一段时间后黑屏</a></li><li><a href="#693_xrdp_mm_process_login_response_login_failed_1673" rel="nofollow">6.9.3 运行一段时间后，出现xrdp_mm_process_login_response: login failed</a></li></ul> 
    </li><li><a href="#610__1688" rel="nofollow">6.10 安装软件</a></li><li><ul><li><a href="#611_Chrome_1692" rel="nofollow">6.11 安装Chrome</a></li></ul> 
   </li></ul> 
   </li><li><a href="#UbuntuSSH_1746" rel="nofollow">七、Ubuntu配置远程SSH登录</a></li><li><ul><li><a href="#71_WSLUbuntusshserver_1754" rel="nofollow">7.1 WSL的Ubuntu安装ssh-server</a></li><li><a href="#72_Windows_1802" rel="nofollow">7.2 设置Windows主机的端口转发</a></li><li><a href="#73_Windows_1850" rel="nofollow">7.3 设置Windows防火墙端口规则</a></li></ul> 
   </li><li><a href="#_1873" rel="nofollow">八、问题</a></li><li><a href="#WSl__1953" rel="nofollow">九、WSl 命令参考</a></li><li><a href="#_2078" rel="nofollow">参考链接</a></li><li><a href="#_2086" rel="nofollow">文章更新日志</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p>本文内容：主要记录WSL2下安装与使用ubuntu，WSL中ubuntu的图形界面的安装，以及对图形界面的调教，还有 Docker 安装。</p> 
</blockquote> 
<h3><a id="_9"></a>一、前言</h3> 
<h4><a id="11_WSL_11"></a>1.1 什么是WSL?</h4> 
<p>wsl 是适用于 Linux 的 Windows 子系统（英语：Windows Subsystem for Linux，简称WSL）。是一个为在Windows 10和Windows Server 2019上能够原生运行Linux二进制可执行文件（ELF格式）的兼容层，可让开发人员按原样运行 GNU/Linux 环境 - 包括大多数命令行工具、实用工具和应用程序 - <strong>且不会产生传统虚拟机或双启动设置开销</strong>。</p> 
<p>简单来说，以前想在windows中使用linux，需要安装vmware虚拟机，现在则不比这么麻烦了，直接安装linux子系统，<strong>秒开</strong>。</p> 
<h4><a id="12__WSL_1__WSL_2_17"></a>1.2 比较 WSL 1 和 WSL 2</h4> 
<p>WSL 2 是WSL 1的一个新版本，它支持适用于 Linux 的 Windows 子系统在 Windows 上运行 ELF64 Linux 二进制文件。 它的主要目标是<strong>提高文件系统性能</strong>，以及<strong>支持完全的系统调用兼容性</strong>。</p> 
<p>相对于WSL采用API转换的方式， WSL 2 则完全不同，win10 开始内置了一个轻量级虚拟机，经过不断的优化，这个虚拟机实现了与 windows 的高度集成，实现了虚拟机的高性能运行，WSL2 便是运行在虚拟机上的一个<strong>完整的 linux 内核</strong>，比如<strong>Docker</strong>、cgroup、iptables、GPU、图形界面这些功能都能正常工作。。因此 WSL 2 给了在 windows 更接近<strong>原生linux</strong>的体验，同时<strong>WSL 2 的开启速度有了非常明显的提升</strong>，几乎不需要再等待。</p> 
<p>这一新的体系结构改变了这些 Linux 二进制文件与Windows 和计算机硬件进行交互的方式，但仍然提供与 WSL 1（当前广泛可用的版本）中相同的用户体验。</p> 
<p>单个 Linux 分发版可以在 WSL 1 或 WSL 2 体系结构中运行。 每个分发版可随时升级或降级，并且你可以并行运行 WSL 1 和 WSL 2 分发版。 WSL 2 使用全新的体系结构，该体系结构受益于运行真正的 Linux 内核。</p> 
<p>WSL 1 和 WSL 2 的主要区别和优势可以参考官方文档：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions" rel="nofollow">比较 WSL 1 和 WSL 2</a>。</p> 
<h4><a id="13_WSL_29"></a>1.3 WSL可以做什么？</h4> 
<ul><li><a href="https://aka.ms/wslstore" rel="nofollow">在 Microsoft Store</a> 中选择你偏好的 GNU/Linux 分发版。</li><li>运行常用的命令行软件工具（例如 <code>grep</code>、<code>sed</code>、<code>awk</code>）或其他 ELF-64 二进制文件。</li><li>运行 Bash shell 脚本和 GNU/Linux 命令行应用程序; 
  <ul><li>工具：vim、emacs、tmux</li><li>语言：<a href="https://docs.microsoft.com/zh-cn/windows/nodejs/setup-on-wsl2" rel="nofollow">NodeJS</a>、Javascript、<a href="https://docs.microsoft.com/zh-cn/windows/python/web-frameworks" rel="nofollow">Python</a>、Ruby、C/ C++、C# 与 F#、Rust、Go 等。</li><li>服务：SSHD、<a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-database" rel="nofollow">MySQL</a>、Apache、lighttpd、<a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-database" rel="nofollow">MongoDB</a>、<a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-database" rel="nofollow">PostgreSQL</a>。</li></ul> </li><li>使用自己的 GNU/Linux 分发包管理器安装其他软件。</li><li>使用类似于 Unix 的命令行 shell 调用 Windows 应用程序。</li><li>在 Windows 上调用 GNU/Linux 应用程序。</li></ul> 
<p><strong>装完WSL2后，我就把Windows上跑的Docker、Mysql、nginx 等服务迁进了容器，这就很nice</strong></p> 
<h3><a id="_43"></a>二、便捷自动安装（本人未测试）</h3> 
<blockquote> 
 <p>注意：看了官方介绍，感觉手动安装其实并不会比自动安装繁琐，总共也就几步操作而已。自动安装无法把控细节，我倾向手动安装。这里不过多介绍，看官方文档即可</p> 
</blockquote> 
<p><strong>建议浏览WSL官方指南</strong>：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install" rel="nofollow">安装 WSL | Microsoft Docs</a></p> 
<p>官方已经更新便捷的安装方式，现在，可以在管理员 <strong>PowerShell</strong> 或 <strong>Windows 命令提示符</strong>中输入此命令，然后重启计算机来安装运行适用于 Linux 的 Windows 子系统 (WSL) 所需的全部内容。</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span>install
</code></pre> 
<p>此命令将启用所需的可选组件，下载最新的 Linux 内核，将 WSL 2 设置为默认值，并安装 Linux 发行版（默认安装 Ubuntu）。</p> 
<p>…</p> 
<h3><a id="_WSL_2_59"></a>三、手动安装 WSL 2</h3> 
<p><strong>WSL官方指南</strong>：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-manual" rel="nofollow">旧版 WSL 的手动安装步骤 | Microsoft Docs</a></p> 
<h4><a id="31__Linux__Windows__63"></a>3.1 启用适用于 Linux 的 Windows 子系统*</h4> 
<p>需要先启用“<strong>适用于 Linux 的 Windows 子系统</strong>”可选功能，然后才能在 Windows 上安装 Linux 分发。</p> 
<ul><li> <p><strong>方法一：通过命令来启用</strong></p> <p>以<strong>管理员身份</strong>打开 ”<strong>Windows PowerShell</strong>“ 或者”<strong>命令提示符</strong>“，并运行：</p> <pre><code class="prism language-shell">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
</code></pre> <p><strong>执行结果：</strong></p> <pre><code class="prism language-shell">C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

部署映像服务和管理工具
版本: <span class="token number">10.0</span>.18362.1379

映像版本: <span class="token number">10.0</span>.18363.1500

启用一个或多个功能
<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token number">100.0</span>%<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span>
操作成功完成。
</code></pre> </li><li> <p><strong>方法二：在windows功能中手动设置</strong></p> <p>在“控制面板\所有控制面板项\程序和功能”中选择“启用或者关闭Windows功能”，勾选对应选项即可：</p> <p><img src="https://images2.imgbox.com/cc/ce/xkfYYoGr_o.png" alt=""></p> </li></ul> 
<p><strong><mark>如果只想安装 WSL 1，现在可以重新启动计算机，然后继续安装所选的 Linux 发行版。 若要更新到 WSL 2，请先继续执行下一步，之后再重新启动计算机。</mark></strong></p> 
<h4><a id="32__WSL_2_98"></a>3.2 更新到 WSL 2</h4> 
<h5><a id="321__WSL_2__100"></a>3.2.1 检查运行 WSL 2 的要求</h5> 
<p>若要更新到 WSL 2，需要运行 Windows 10。</p> 
<ul><li>对于 x64 系统：<strong>版本 1903</strong> 或更高版本，采用 <strong>内部版本 18362</strong> 或更高版本。</li><li>对于 ARM64 系统：<strong>版本 2004</strong> 或更高版本，采用 <strong>内部版本 19041</strong> 或更高版本。</li></ul> 
<p>若要检查 Windows 版本及内部版本号，选择 <code>Windows 徽标键 + R</code>，然后键入“<strong>winver</strong>”，选择“确定”。 更新到“设置”菜单中的最新 Windows 版本。</p> 
<p><img src="https://images2.imgbox.com/46/fa/lqUA2hb7_o.png" alt=""></p> 
<blockquote> 
 <p>备注：</p> 
 <p>如果运行的是 Windows 10 版本1903 或 1909，请在 Windows 菜单中打开“设置”，导航到“更新和安全性”，然后选择“检查更新”。 内部版本号必须是 18362.1049+ 或 18363.1049+，次要内部版本号需要高于 .1049。 阅读详细信息：<a href="https://devblogs.microsoft.com/commandline/wsl-2-support-is-coming-to-windows-10-versions-1903-and-1909/" rel="nofollow">WSL 2 即将支持 Windows 10 版本 1903 和 1909</a>。 请参阅<a href="https://docs.microsoft.com/zh-cn/windows/wsl/troubleshooting#im-on-windows-10-version-1903-and-i-still-do-not-see-options-for-wsl-2" rel="nofollow">疑难解答说明</a>。</p> 
</blockquote> 
<h5><a id="322__115"></a>3.2.2 启用“虚拟机平台”可选组件*</h5> 
<p><mark>安装 WSL 2 之前，必须启用“<strong>虚拟机平台</strong>”可选功能。</mark></p> 
<ul><li> <p><strong>方法一：通过命令来启用</strong></p> <p>以<strong>管理员身份</strong>打开 ”<strong>Windows PowerShell</strong>“ 或者”<strong>命令提示符</strong>“，并运行：</p> <pre><code class="prism language-shell">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre> <p><strong>执行结果：</strong></p> <pre><code class="prism language-shell">C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

部署映像服务和管理工具
版本: <span class="token number">10.0</span>.18362.1379

映像版本: <span class="token number">10.0</span>.18363.1500

启用一个或多个功能
<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token number">100.0</span>%<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span>
操作成功完成。
</code></pre> </li><li> <p><strong>方法二：在windows功能中手动设置</strong></p> <p>在“<strong>控制面板\所有控制面板项\程序和功能”中选择“启用或者关闭Windows功能</strong>”，勾选对应选项即可：</p> <p><img src="https://images2.imgbox.com/ad/0f/qdzeurWl_o.png" alt=""></p> </li></ul> 
<p><strong><mark>重新启动计算机，以完成 WSL 安装并更新到 WSL 2。</mark></strong></p> 
<p>检测是否开启虚拟化，打开<strong>任务管理器</strong> -&gt; <strong>性能</strong> -&gt; <strong>虚拟化已启用</strong></p> 
<p><img src="https://images2.imgbox.com/9f/a5/a4Y9UAa6_o.png" alt=""></p> 
<h5><a id="323__WSL_2__154"></a>3.2.3 将 WSL 2 设置为默认版本</h5> 
<p>安装新的 Linux 分发版之前，请以<strong>管理员身份</strong>打开 ”<strong>Windows PowerShell</strong>“ 或者”<strong>命令提示符</strong>“中运行以下命令，以将 WSL 2 设置为默认版本</p> 
<p>先检查 WSL 状态，查看有关 WSL 配置的常规信息，例如默认发行版类型、默认发行版和内核版本。</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span>status
</code></pre> 
<p>如果默认版本不是2，则执行以下命令：</p> 
<pre><code class="prism language-shell">wsl --set-default-version <span class="token number">2</span>
</code></pre> 
<p>正常情况下，出现以下信息</p> 
<pre><code class="prism language-shell">C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>wsl --set-default-version <span class="token number">2</span>
有关与 WSL <span class="token number">2</span> 的主要区别的信息，请访问 https://aka.ms/wsl2
操作成功完成。
</code></pre> 
<p>但如果执行结果如下，则<strong>需要更新 Linux 内核</strong>，操作见下一步，更新完，继续设置默认版本</p> 
<pre><code class="prism language-shell">C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>wsl --set-default-version <span class="token number">2</span>
WSL <span class="token number">2</span> requires an update to its kernel component. For information please visit https://aka.ms/wsl2kernel
（WSL <span class="token number">2</span> 需要更新其内核组件。有关信息，请访问 https://aka.ms/wsl2kernel）
有关与 WSL <span class="token number">2</span> 的主要区别的信息，请访问 https://aka.ms/wsl2
</code></pre> 
<p>设置完后，这会使你安装的任何新发行版均初始化为 WSL 2 发行版。</p> 
<h5><a id="324__Linux__189"></a>3.2.4 下载 Linux 内核更新包</h5> 
<ol><li>下载最新包：</li></ol> 
<ul><li> <p><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi" rel="nofollow">适用于 x64 计算机的 WSL2 Linux 内核更新包</a></p> 
  <blockquote> 
   <p>备注：</p> 
   <p>如果使用的是 ARM64 计算机，请下载 <a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi" rel="nofollow">ARM64 包</a>。 如果不确定自己计算机的类型，请打开命令提示符或 PowerShell，并输入：<code>systeminfo | find "System Type"</code>。 <strong>警告：</strong> 在非英语 Windows 版本中，你可能需要修改搜索文本，例如在德语中为 <code>systeminfo | find "Systemtyp"</code>。</p> 
  </blockquote> </li></ul> 
<ol start="2"><li>运行上一步中下载的更新包。 （双击以运行，系统将提示你提供提升的权限，选择“是”以批准此安装。）</li></ol> 
<p>安装完成后，<strong>请继续执行之前失败的操作</strong>。 （如果希望将新的 Linux 安装设置为 WSL 1，请跳过此步骤。）</p> 
<h4><a id="33__Linux__203"></a>3.3 安装所选的 Linux 分发版</h4> 
<blockquote> 
 <p>Windows 10 的 WSL 2 需要依赖于WSL 发行版，<strong>Microsoft Store中的WSL 发行版应用。适用于 Linux 的 Windows 子系统安装是会自动装在系统驱动器（通常是 C: 驱动器）中运行，所以注意C盘的空间。（注意：如果需要修改安装位置，请先查看下文自定义安装方法，再来查看本节其他配置介绍）。</strong></p> 
</blockquote> 
<p><strong>查看当前已安装发行版</strong></p> 
<pre><code class="prism language-bash">wslconfig /l
</code></pre> 
<p>或</p> 
<pre><code class="prism language-bash">wsl <span class="token parameter variable">--list</span> <span class="token parameter variable">--all</span>
</code></pre> 
<h5><a id="331__Linux__219"></a>3.3.1 下载 Linux 分发版</h5> 
<blockquote> 
 <p><strong>注意，如果是自定义安装，则跳过该步骤</strong></p> 
</blockquote> 
<ol><li>打开 <a href="https://aka.ms/wslstore" rel="nofollow">Microsoft Store</a>，并选择你偏好的 <strong>Linux 分发版</strong> (如果上述连接打开有错，请直接打开 <strong>Microsoft Store</strong> 搜索)。这里推荐使用最新得长期稳定版，目前是 <strong>Ubuntu 20.04 LTS</strong>。</li></ol> 
<p><img src="https://images2.imgbox.com/f0/f9/IFCP8oIP_o.png" alt=""></p> 
<p>单击以下链接会打开每个分发版的 Microsoft Store 页面，(如果下述连接打开有错，请直接打开Microsoft Store搜索)。：</p> 
<ul><li><a href="https://www.microsoft.com/store/apps/9N9TNGVNDL3Q" rel="nofollow">Ubuntu 18.04 LTS</a></li><li><a href="https://www.microsoft.com/store/apps/9n6svws3rx71" rel="nofollow">Ubuntu 20.04 LTS</a></li><li><a href="https://www.microsoft.com/store/apps/9NJFZK00FGKV" rel="nofollow">openSUSE Leap 15.1</a></li><li><a href="https://www.microsoft.com/store/apps/9MZ3D1TRP8T1" rel="nofollow">SUSE Linux Enterprise Server 12 SP5</a></li><li><a href="https://www.microsoft.com/store/apps/9PN498VPMF3Z" rel="nofollow">SUSE Linux Enterprise Server 15 SP1</a></li><li><a href="https://www.microsoft.com/store/apps/9PKR34TNCV07" rel="nofollow">Kali Linux</a></li><li><a href="https://www.microsoft.com/store/apps/9MSVKQC78PK6" rel="nofollow">Debian GNU/Linux</a></li><li><a href="https://www.microsoft.com/store/apps/9n6gdm4k2hnc" rel="nofollow">Fedora Remix for WSL</a></li><li><a href="https://www.microsoft.com/store/apps/9NV1GV1PXZ6P" rel="nofollow">Pengwin</a></li><li><a href="https://www.microsoft.com/store/apps/9N8LP0X93VCP" rel="nofollow">Pengwin Enterprise</a></li><li><a href="https://www.microsoft.com/store/apps/9p804crf0395" rel="nofollow">Alpine WSL</a></li><li><a href="https://www.microsoft.com/store/apps/9msmjqd017x7" rel="nofollow">Raft（免费试用版）</a></li></ul> 
<ol start="2"><li> <p>在分发版的页面中，选择“<strong>获取</strong>”。</p> <p><strong>注意：这样会自动安装到系统盘，如果需要更改安装目录，参考下文</strong>[[#3.4 自定义分发版安装目录(可选，推荐)]]</p> </li></ol> 
<p><img src="https://images2.imgbox.com/da/28/zhZKxRFj_o.png" alt=""></p> 
<h5><a id="332__248"></a>3.3.2 设置新分发版</h5> 
<p>首次启动新安装的 Linux分发版时，将打开一个控制台窗口。（自定义安装则是双击安装目录的 <code>Ubuntu***.exe</code> 文件，就是之前安装的应用，如果第一次启动ubuntu失败，可以重启电脑再次试下）</p> 
<p>如果还是出错，参考下文[[#3.8 可能出现的问题]]</p> 
<p><img src="https://images2.imgbox.com/49/70/mz8T9IOB_o.png" alt=""></p> 
<p>系统会要求你等待一分钟或两分钟，以便文件解压缩并存储到电脑上。未来的所有启动时间应不到一秒。</p> 
<p>然后，需要为新的 Linux 分发版<strong>创建用户帐户和密码</strong>。</p> 
<p><img src="https://images2.imgbox.com/4a/4f/h5Fqky6A_o.png" alt=""></p> 
<p><strong>祝贺你！现已成功安装并设置了与 Windows 操作系统完全集成的 Linux 分发！</strong></p> 
<ul><li>此 <strong>用户名</strong> 和 <strong>密码</strong> 特定于安装的每个单独的 Linux 分发版，与 Windows 用户名无关。</li><li>创建 <strong>用户名</strong> 和 <strong>密码</strong> 后，该帐户将是分发版的默认用户，并将在启动时自动登录（可修改）。</li><li>此帐户将被视为 Linux 管理员，能够运行 <code>sudo</code> (Super User Do) 管理命令。</li><li>在适用于 Linux 的 Windows 子系统上运行的每个 Linux 分发版都有其自身的 Linux 用户帐户和密码。 每当添加分发版、重新安装或重置时，都必须配置一个 Linux 用户帐户。</li></ul> 
<p>安装完后，可用 <code>wsl -l -v </code> 查看Linux 分发版的 WSL 版本（后面有详解）</p> 
<pre><code class="prism language-powershell"><span class="token function">PS</span> C:\Users\wys&gt; wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
  NAME                   STATE           VERSION
<span class="token operator">*</span> Ubuntu                 Running         2
</code></pre> 
<h5><a id="333_ubuntuapt_277"></a>3.3.3 修改ubuntu的apt安装源</h5> 
<p>第一步：进入 ubuntu，备份源文件</p> 
<pre><code class="prism language-shell"><span class="token function">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak
</code></pre> 
<p>第二步：编辑 <code>/etc/apt/sources.list</code> 文件，更换成国内源</p> 
<blockquote> 
 <p>注意，以下是Ubuntu 20.04版本</p> 
</blockquote> 
<ul><li>网易源</li></ul> 
<pre><code class="prism language-ini">#网易源
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb http://mirrors.163.com/ubuntu/ focal main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-security main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-updates main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-backports main restricted universe multiverse
# deb-src http://mirrors.163.com/ubuntu/ focal main restricted universe multiverse
# deb-src http://mirrors.163.com/ubuntu/ focal-security main restricted universe multiverse
# deb-src http://mirrors.163.com/ubuntu/ focal-updates main restricted universe multiverse
# deb-src http://mirrors.163.com/ubuntu/ focal-backports main restricted universe multiverse
# 预发布软件源，不建议启用
# deb http://mirrors.163.com/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src http://mirrors.163.com/ubuntu/ focal-proposed main restricted universe multiverse
</code></pre> 
<ul><li>阿里源 <a href="https://developer.aliyun.com/mirror/?spm=a2c6h.12883283.J_5404914170.31.487643078mL0su" rel="nofollow">阿里巴巴开源镜像站-OPSX镜像站-阿里云开发者社区</a></li></ul> 
<pre><code class="prism language-ini">#阿里源
deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
</code></pre> 
<ul><li>清华源https</li></ul> 
<pre><code class="prism language-ini">#清华源https

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
</code></pre> 
<p>我这里使用的阿里源，可直接执行如下命令</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse"</span><span class="token operator">&gt;</span>/etc/apt/sources.list
</code></pre> 
<blockquote> 
 <p>注意，以下是Ubuntu 22.04版本</p> 
</blockquote> 
<ul><li> <p>网易源</p> <pre><code class="prism language-ini">deb http://mirrors.163.com/ubuntu/ jammy main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ jammy-security main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ jammy-updates main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ jammy-proposed main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ jammy main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ jammy-proposed main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ jammy-backports main restricted universe multiverse
</code></pre> </li><li> <p>阿里源 <a href="https://developer.aliyun.com/mirror/?spm=a2c6h.12883283.J_5404914170.31.487643078mL0su" rel="nofollow">阿里巴巴开源镜像站-OPSX镜像站-阿里云开发者社区</a></p> <pre><code class="prism language-ini">deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
</code></pre> </li><li> <p>清华源</p> <pre><code class="prism language-ini"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
</code></pre> </li></ul> 
<p><strong>然后执行更新</strong>：</p> 
<pre><code class="prism language-shell"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>
</code></pre> 
<h5><a id="334__Linux__408"></a>3.3.4 重置 Linux 密码(可选)</h5> 
<p>若要更改密码，请打开 <strong>Linux 分发版</strong>（例如 <strong>Ubuntu</strong>）并输入以下命令：<code>passwd</code></p> 
<p>系统会要求你输入当前密码，然后要求输入新密码，之后再确认新密码。</p> 
<h5><a id="335__414"></a>3.3.5 忘记密码(可选)</h5> 
<p>如果忘记了 Linux 分发版的密码：</p> 
<ol><li> <p>请打开 PowerShell，并使用以下命令直接进入默认 WSL 分发版的根目录：<code>wsl -u root</code></p> 
  <blockquote> 
   <p>如果需要在非默认分发版中更新忘记的密码，请使用命令：<code>wsl -d Debian -u root</code>，记得将 <code>Debian</code> 替换为目标分发版的名称。</p> 
  </blockquote> </li><li> <p>在 <strong>PowerShell</strong> 内的根级别打开 WSL 发行版后，可使用此命令更新密码：<code>passwd &lt;WSLUsername&gt;</code>，其中 <code>&lt;WSLUsername&gt;</code> 是 DISTRO 中帐户的用户名，而你忘记了它的密码。</p> </li><li> <p>系统将提示你输入新的 UNIX 密码，然后确认该密码。 在被告知密码已成功更新后，请使用命令 <code>exit</code> 在 <strong>PowerShell</strong> 内关闭 WSL</p> </li></ol> 
<h5><a id="336_root_426"></a>3.3.6 修改root用户密码(可选)</h5> 
<ul><li> <p><strong><mark>WSL 默认是没有设置 root 密码的，系统实现的是每次开启时随机设置root密码，导致无法切换到root权限进行操作</mark></strong></p> </li><li> <p>设置 <strong>root</strong> 用户密码，这样要输三次命令，第一次当前用户密码，后两次就是设置密码以及确认密码</p> <pre><code># 语法: sudo passwd 用户名
sudo passwd root
</code></pre> </li><li> <p><code>password updated successfully</code> 代表密码更新成功，切换用户</p> <pre><code># 语法: su 用户名
su root
</code></pre> </li></ul> 
<p>如果我们想要使用 <strong>root</strong> 用户的话，为了避免 sudo 切换 root 是需要输入密码，<strong>把自己配置的用户名加到sudo免密中</strong>，命令如下：</p> 
<pre><code> # 替换leap为自己单独配置的用户名
 sudo echo "leap ALL=(ALL:ALL) NOPASSWD: ALL" &gt;&gt;/etc/sudoers 
</code></pre> 
<h5><a id="337_root_451"></a>3.3.7 修改默认用户root(可选)</h5> 
<ul><li> <p><strong>查看自己安装的哪个版本</strong></p> <p>可以去 Microsoft Store 商店 - 我的软件 - 已安装, 中查看</p> <p><img src="https://images2.imgbox.com/ff/de/iAaeR4Fm_o.png" alt=""></p> </li></ul> 
<blockquote> 
 <p>我这里安装的是 ubuntu，我就以 ubuntu 为例</p> 
</blockquote> 
<ul><li> <p><strong>查看修改命令</strong>，输入ubuntu 按回车会自动补全版本对应的命令</p> <pre><code class="prism language-powershell"><span class="token comment"># 如果安装的是ubuntu1804，则命令可能是 </span>
ubuntu <span class="token operator">/</span>?
或者
ubuntu1804 <span class="token operator">/</span>?
</code></pre> <p><img src="https://images2.imgbox.com/c2/3a/b5cc0xsM_o.png" alt=""></p> </li><li> <p><strong>设置默认用户</strong></p> <pre><code class="prism language-powershell"><span class="token comment"># 语法: ubuntu config --default-user 用户名(已存在的)</span>
<span class="token comment"># 如果安装的是ubuntu1804（可用wsl -l -v 查看），则命令也可能是ubuntu1804 config --default-user 用户名(已存在的)</span>
<span class="token function">PS</span> C:\WINDOWS\system32&gt; ubuntu config <span class="token operator">--</span>default-user root
<span class="token function">PS</span> C:\WINDOWS\system32&gt;

<span class="token comment"># 没有报错就代表成功</span>
</code></pre> </li><li> <p>注意，如果出现以下错误（<strong>一般情况是因为采用自定义分发版安装才会出现该情况</strong>）</p> <pre><code class="prism language-powershell"><span class="token function">PS</span> C:\Users\Administrator&gt; ubuntu config <span class="token operator">--</span>default-user root
正确，然后再试一次。
所在位置 行:1 字符: 1
<span class="token operator">+</span> ubuntu config <span class="token operator">--</span>default-user root
<span class="token operator">+</span> ~~~~~~
    <span class="token operator">+</span> CategoryInfo          : ObjectNotFound: <span class="token punctuation">(</span>ubuntu:String<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> CommandNotFoundException
    <span class="token operator">+</span> FullyQualifiedErrorId : CommandNotFoundException
</code></pre> <p>这个错误是说无法识别该命令。你需要找到以 ubuntu 开头的 <strong>exe</strong> 文件(即安装目录，可使用强大的绿色搜索工具 <strong>everything</strong> 搜索)，比如我的是 <strong>ubuntu.exe</strong>，然后在==<strong>管理员权限的命令终端</strong>==中 <strong>cd</strong> 进入所在目录，再来执行以上命令</p> </li></ul> 
<p>重新打开已经是 <strong>root</strong> 用户了</p> 
<p><img src="https://images2.imgbox.com/6a/f2/PWlEFPyG_o.png" alt=""></p> 
<h4><a id="34__501"></a>3.4 自定义分发版安装目录(可选，推荐)</h4> 
<blockquote> 
 <p>我的电脑我做主，C盘寸土不让，离线安装</p> 
</blockquote> 
<h5><a id="341__505"></a>3.4.1 如果未安装分发版</h5> 
<p>在 <strong>Microsoft Store</strong>下载的 WSL 发行版会自动安装到<strong>C盘</strong>，<strong>不能手动选择安装位置</strong>。微软提供了一个手动下载WSL发行版的网址，可以绕开MS Store的自动安装</p> 
<ol><li>手动下载，下载地址：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-manual#downloading-distributions" rel="nofollow">下载发行版 | Microsoft Docs</a></li></ol> 
<p><img src="https://images2.imgbox.com/b2/85/6kuGXT6w_o.png" alt=""></p> 
<ol start="2"><li>选择想要的发行版下载后，可以得到一个后缀名为 <code>.AppxBundle</code> 的文件。（官方文档说是 <code>.appx</code>的文件，其实是错的，很多博客也跟着瞎抄。)把这个 <code>.AppxBundle</code> 的文件的后缀改为<code>.zip</code>，然后解压到，这才能得到 <code>.appx</code>的文件。</li></ol> 
<p><img src="https://images2.imgbox.com/33/21/el0IJhxM_o.png" alt=""></p> 
<ol start="3"><li>根据系统型号，选择对应的 <code>.appx</code>的文件后缀改为<code>.zip</code>，然后解压到想要安装 <strong>WSL</strong> 的目录下，我们可以得到一些文件。</li></ol> 
<p><img src="https://images2.imgbox.com/53/24/nxdfv81b_o.png" alt=""></p> 
<ol start="4"><li>找到 xxx.exe文件（如ubuntu.exe，其他发行版的话也有类似的程序）双击打开，等待一段时间就可以安装成功。然后就跟上述 [[#3.3.2 设置新分发版]] 一样，开始设置用户名和密码。</li></ol> 
<blockquote> 
 <p>注意</p> 
</blockquote> 
<p>安装目录的磁盘不能开==<strong>压缩内容以便节省磁盘空间</strong>==选项，否则会<strong>报错 0xc03a001a</strong></p> 
<p>可以<strong>右键文件夹–&gt;属性–&gt;常规–&gt;高级</strong>找到并关闭这个选项，<strong>开了压缩功能的文件夹右上角会有两个蓝色的小箭头</strong></p> 
<p><img src="https://images2.imgbox.com/32/66/du94QFRb_o.png" alt=""></p> 
<h5><a id="342__531"></a>3.4.2 如果已经安装分发版(未测试)</h5> 
<ul><li> <p><strong>如果之前的数据不重要，可以删除原来安装在C盘的发行版</strong></p> <p>首先停止 Linux 发行版在 WSL 的运行（这里以 Ubuntu 18.04 为例）：</p> <pre><code class="prism language-powershell">wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
wsl <span class="token operator">-</span>t Ubuntu-18<span class="token punctuation">.</span>04
wsl <span class="token operator">--</span>shutdown
wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
</code></pre> <p>查看 Windows 系统已经安装的软件包：</p> <pre><code class="prism language-powershell"><span class="token function">Get-AppxPackage</span> <span class="token operator">-</span>allusers <span class="token punctuation">|</span> <span class="token function">Select</span> Name<span class="token punctuation">,</span> PackageFullName
</code></pre> <p>删除 Ubuntu 发行版</p> <pre><code class="prism language-powershell"><span class="token function">get-appxpackage</span> CanonicalGroupLimited<span class="token punctuation">.</span>&lt;发行版名称和版本号&gt;onWindows <span class="token punctuation">|</span> <span class="token function">remove-Appxpackage</span>
</code></pre> 
  <blockquote> 
   <p>这里以 Ubuntu 18.04 为例，所以要将 “&lt;发行版名称和版本号&gt;” 替换为 “Ubuntu18.04” ， 如果是 Ubuntu<br> 20.04 ，那么就应当替换为 “Ubuntu20.04”。</p> 
  </blockquote> <p>删除 Ubuntu 18.04</p> <pre><code class="prism language-powershell"><span class="token function">get-appxpackage</span> CanonicalGroupLimited<span class="token punctuation">.</span>Ubuntu18<span class="token punctuation">.</span>04onWindows <span class="token punctuation">|</span> <span class="token function">remove-Appxpackage</span>
</code></pre> <p>然后开始重新安装，按照上一步<strong>未安装分发版</strong>的流程即可。</p> </li><li> <p><strong>如果是想直接迁移之前数据</strong>，操作如下：</p> 
  <ol><li> <p>首先查看所有分发版本</p> <pre><code class="prism language-powershell">C:\Users\Administrator&gt;wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
  NAME                   STATE           VERSION
<span class="token operator">*</span> Ubuntu                 Running         2
</code></pre> </li><li> <p>导出分发版为tar文件到d盘</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>export Ubuntu D:\wsl\ubuntu\ubuntu<span class="token punctuation">.</span>tar
</code></pre> </li><li> <p>注销当前分发版</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>unregister Ubuntu
</code></pre> </li><li> <p>重新导入并安装分发版在 <code>D:\wsl\ubuntu\</code></p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>import Ubuntu D:\wsl\ubuntu D:\wsl\ubuntu\ubuntu<span class="token punctuation">.</span>tar <span class="token operator">--</span>version 2
</code></pre> </li><li> <p>设置默认登陆用户为安装时用户名</p> <pre><code class="prism language-powershell">ubuntu config <span class="token operator">--</span>default-user Username
</code></pre> </li><li> <p>删除tar文件(可选)</p> <pre><code class="prism language-powershell"><span class="token function">del</span> D:\wsl\ubuntu\ubuntu20<span class="token punctuation">.</span>04<span class="token punctuation">.</span>tar
</code></pre> </li></ol> </li></ul> 
<h4><a id="35__Windows_Terminal_608"></a>3.5 安装 Windows Terminal终端(可选，推荐安装)</h4> 
<blockquote> 
 <p>安装 Windows Terminal，可用于和 WSL 子系统交互。强烈推荐</p> 
</blockquote> 
<p>Windows 终端（<strong>Windows Terminal</strong>）可启用多个选项卡（在多个 Linux 命令行、Windows 命令提示符、PowerShell 和 Azure CLI 等之间快速切换）、创建键绑定（用于打开或关闭选项卡、复制粘贴等的快捷方式键）、使用搜索功能，以及<strong>使用自定义主题（配色方案、字体样式和大小、背景图像/模糊/透明度）</strong>。 <a href="https://docs.microsoft.com/zh-cn/windows/terminal" rel="nofollow">了解详细信息。</a></p> 
<p><a href="https://docs.microsoft.com/zh-cn/windows/terminal/get-started" rel="nofollow">官方文档：安装和设置 Windows 终端</a>。</p> 
<h5><a id="351__616"></a>3.5.1 微软商店自动安装</h5> 
<p>可以从 <a href="https://aka.ms/terminal" rel="nofollow">Microsoft Store</a> 安装 Windows 终端。</p> 
<p><img src="https://images2.imgbox.com/1b/6d/oPuVsCB2_o.png" alt=""></p> 
<h5><a id="352__622"></a>3.5.2 手动离线安装</h5> 
<p>如果你无法访问 Microsoft Store，<a href="https://github.com/microsoft/terminal/releases">GitHub 发布页</a>上发布有内部版本。 如果从 GitHub 安装，终端将不会自动更新为新版本。（我就是在github上下载的，因为Microsoft Store突然无法安装应用，网上说是需要更新系统版本，但我系统已经更新过了。）</p> 
<ol><li>到 <strong>Windows Terminal</strong> 的 <a href="https://github.com/microsoft/terminal/releases">GitHub 发布页</a> 下载最新的release包，即以 <code>.msixbundle</code> 为后缀的文件</li><li>将文件后缀名改为 <code>.zip</code> 后解压缩文件</li><li>在解压后的文件夹中找到名为 <code>CascadiaPackage***.msix</code> 的文件，有x86、x64和ARM64版本的，选择x64那个文件，修改后缀名为 <code>.zip</code>，然后解压</li><li>在解压后的文件夹中，找到 <strong>WindowsTerminal.exe</strong> 的文件，直接双击就能运行了，还是绿色免安装版的</li><li>可以把这个文件夹拷贝到安全的位置，然后将 *.exe 文件添加到桌面快捷方式，就能轻松使用 <strong>Windows Terminal</strong></li></ol> 
<p><img src="https://images2.imgbox.com/9b/c5/zy02ta8M_o.png" alt=""></p> 
<h4><a id="36_WSL_634"></a>3.6 查询WSL状态、设置分发版版本</h4> 
<p>可打开 PowerShell 命令行并输入以下命令（仅在 Windows 内部版本 18362 或更高版本中可用），检查分配给每个已安装的 Linux 分发版的 WSL 版本：</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">-</span>l <span class="token operator">--</span>all <span class="token operator">-</span>v
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span>list <span class="token operator">--</span>all <span class="token operator">--</span>verbose
</code></pre> 
<p>若要将分发版设置为受某一 WSL 版本支持，请运行：</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-version</span> &lt;distribution name&gt; &lt;versionNumber&gt;
或者
wsl <span class="token operator">-</span>s &lt;distribution name&gt; &lt;versionNumber&gt;
</code></pre> 
<p>请确保将 <code>&lt;distribution name&gt;</code> 替换为你的<strong>分发版的实际名称</strong>，并将 <code>&lt;versionNumber&gt;</code> 替换为数字“<strong>1</strong>”或“<strong>2</strong>”。 可以随时更改回 WSL 1，方法是运行与上面相同的命令，但将“2”替换为“1”。</p> 
<blockquote> 
 <p>从 WSL 1 更新到 WSL 2 可能需要几分钟才能完成，具体取决于目标分发版的大小。 如果从 Windows 10 周年更新或创意者更新运行 WSL 1 的旧（历史）安装，可能会遇到更新错误。 按照这些说明<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-legacy#uninstallingremoving-the-legacy-distro" rel="nofollow">卸载并删除任何旧分发</a>。</p> 
 <p>如果 <code>wsl --set-default-version</code> 结果为无效命令，请输入 <code>wsl --help</code>。 如果 <code>--set-default-version</code> 未列出，则表示你的 OS 不支持它，你需要更新到版本 1903（内部版本 18362）或更高版本。 如果你在使用 ARM64 版本 19041，那么当使用 PowerShell 时，此命令可能会失败；在这种情况下，你可使用命令提示符，而不是发出 <code>wsl.exe</code> 命令。</p> 
 <p>运行命令后如果看到此消息：<code>WSL 2 requires an update to its kernel component. For information please visit https://aka.ms/wsl2kernel</code>。 仍需要安装 MSI Linux 内核更新包（见上文）。</p> 
</blockquote> 
<p>此外，如果要使 WSL 2 成为你的默认体系结构，可以通过此命令执行该操作：</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version 2
</code></pre> 
<p>这会将安装的任何新分发版的版本设置为 WSL 2。</p> 
<h4><a id="37_WSLsystemd_672"></a>3.7 安装WSL的systemd命令(可选)</h4> 
<p>由于 Linux 环境应用程序（如Ubuntu，Debian，OpenSuse或Kali）不支持为Linux操作系统提供基本构建块的 <code>Systemd</code>，使用的是经典的<code>SysV init（sysvinit）</code>系统，因此我们无法使用 <code>reboot</code> 或使用 <code>systemctl</code> 命令来管理 <code>systemd</code> 服务。</p> 
<p>在 WSL 中可以用<code>SysV init</code>的命令代替 <code>systemd</code> 命令</p> 
<p><img src="https://images2.imgbox.com/66/25/9llR7UIM_o.png" alt=""></p> 
<p>但 <strong>systemd</strong> 还是很重要的（例如：不安装可能会导致下面图形化界面安装失败）。如果需要，可通过以下方式安装：</p> 
<ol><li> <p>安装git</p> <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span>
</code></pre> </li><li> <p>运行脚本和命令</p> <pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/DamionGans/ubuntu-wsl2-systemd-script.git
<span class="token builtin class-name">cd</span> ubuntu-wsl2-systemd-script/
<span class="token function">bash</span> ubuntu-wsl2-systemd-script.sh
</code></pre> </li><li> <p>然后重新启动 <code>ubuntu shell</code> 并尝试运行 <code>systemctl</code></p> <pre><code class="prism language-bash">systemctl
</code></pre> </li></ol> 
<p>如果报错：<strong>System has not been booted with systemd as init system (PID 1). Can’t operate.</strong></p> 
<pre><code class="prism language-bash">root@DESKTOP-58FD2RV:/home<span class="token comment"># systemctl</span>
System has not been booted with systemd as init system <span class="token punctuation">(</span>PID <span class="token number">1</span><span class="token punctuation">)</span>. Can't operate.
Failed to connect to bus: Host is down
</code></pre> 
<p>解决办法：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 安装daemonize</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> daemonize

<span class="token comment">#执行以下命令开启</span>

<span class="token function">sudo</span> daemonize /usr/bin/unshare <span class="token parameter variable">--fork</span> <span class="token parameter variable">--pid</span> --mount-proc /lib/systemd/systemd --system-unit<span class="token operator">=</span>basic.target

<span class="token builtin class-name">exec</span> <span class="token function">sudo</span> nsenter <span class="token parameter variable">-t</span> <span class="token variable"><span class="token variable">$(</span>pidof systemd<span class="token variable">)</span></span> <span class="token parameter variable">-a</span> <span class="token function">su</span> - <span class="token environment constant">$LOGNAME</span>
</code></pre> 
<h4><a id="38__723"></a>3.8 可能出现的问题</h4> 
<h5><a id="381__725"></a>3.8.1 参考的对象类型不支持尝试的操作（参考问题）</h5> 
<ul><li> <p>问题：从terminal启动ubuntu1804报错：<strong>参考的对象类型不支持尝试的操作</strong>。直接启动ubuntu，出现1804报错</p> <p>解决办法：以管理员身份打开”<strong>Windows PowerShell</strong>“，然后执行 <code>netsh winsock reset</code>，然后继续操作（如果还是不行，重启电脑即可）</p> <p>操作前记得备份数据，因为可能会丢失docker的镜像容器数据</p> </li></ul> 
<h5><a id="382_HyperV_733"></a>3.8.2 关于Hyper-V是否需要开启</h5> 
<p>问题：Windows 10 安装了 wsl2，整个安装过程是不需要启用 Hyper-V，但是网络很多的讨论和教程都提到说 wsl 2 用的时 Hyper-V。</p> 
<p>官方文档有提到</p> 
<pre><code>WSL 2 is available on all SKUs where WSL is currently available, including Windows 10 Home.

The newest version of WSL uses Hyper-V architecture to enable its virtualization. This architecture will be available in the 'Virtual Machine Platform' optional component. This optional component will be available on all SKUs. 
</code></pre> 
<p>就是说，WSL 的最新版本使用 Hyper-V 架构来实现虚拟化，该架构可用在“<strong>虚拟机平台</strong>”可选组件中。因为这个”<strong>虚拟机平台</strong>“就是一个精简版的 <strong>Hyper-v</strong>，所以开启“<strong>虚拟机平台</strong>”即可。</p> 
<h5><a id="383_Windows_10_WSL2_748"></a>3.8.3 关于Windows 10 家庭版能否安装WSL2的问题</h5> 
<p>Windows 10 家庭版上没有 Hyper-V 功能。所以网上很多教程都提到需要安装 Hyper-V，这是不对的。</p> 
<p>官方解释：WSL 2 在可使用 WSL 的所有桌面 SKU 上都可使用，包括 Windows 10 家庭版。</p> 
<p>官方原文：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/faq#wsl-2------hyper-v---------windows-10-----" rel="nofollow">关于适用于 Linux 的 Windows 子系统的常见问题解答 | Microsoft Docs</a></p> 
<h5><a id="384_WSL__2__756"></a>3.8.4 WSL 转换到版本 2 失败</h5> 
<p>如果显示错误消息，例如“转换失败”或“错误 <strong>0x03a001a</strong> 由于虚拟磁盘系统限制，无法完成请求的操作。虚拟磁盘文件必须是未压缩和未加密的，并且不能是稀疏的。”，请尝试检查以下内容。</p> 
<ul><li>重新启动系统。</li><li>必须在 BIOS 中启用虚拟化扩展，例如 Intel VT-x 或 AMD-V。</li><li>必须为 Ubuntu AppData 文件夹禁用压缩和加密（请参阅<a href="https://github.com/microsoft/WSL/issues/4103">Github 问题 #4103</a>）。路径看起来像这样。</li></ul> 
<p>再次尝试将发行版转换为版本 2，操作应该会成功。</p> 
<h5><a id="385_WslRegisterDistribution_failed_with_error_0x800701bc_766"></a>3.8.5 WslRegisterDistribution failed with error: 0x800701bc</h5> 
<p><img src="https://images2.imgbox.com/59/bd/DIhEDYR8_o.png" alt=""></p> 
<p>造成该问题的原因是WSL版本由原来的 WSL1 升级到 WSL2 后，内核没有升级，前往<a href="https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-kernel" rel="nofollow">微软WSL官网</a>下载安装适用于 x64 计算机的最新 WSL2 <a href="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020">Linux</a> 内核更新包即可。</p> 
<h5><a id="386__772"></a>3.8.6 其他错误</h5> 
<p>可参考官方文档 <a href="https://docs.microsoft.com/zh-cn/windows/wsl/faq" rel="nofollow">关于适用于 Linux 的 Windows 子系统的常见问题解答 | Microsoft Docs</a></p> 
<p>博客：<a href="https://blog.csdn.net/swordsm/article/details/107948497">WSL2 网络异常排查 [ping 不通、网络地址异常、缺少默认路由、被宿主机防火墙拦截]</a></p> 
<h3><a id="WSL2_778"></a>四、WSL2使用帮助</h3> 
<h4><a id="41_IP_780"></a>4.1 网络访问方式(IP)</h4> 
<p>官方文档：<a href="https://docs.microsoft.com/en-us/windows/wsl/networking" rel="nofollow">使用 WSL |访问网络应用程序微软文档 (microsoft.com)</a></p> 
<p>注意：在使用win10的wsl2子系统时，windows会通过虚拟交换机给<strong>win10本机</strong>与<strong>wsl2子系统</strong>各自会分配一个ip地址。</p> 
<p><strong>18945之前的WSL2版本</strong>，如果我们在容器里运行了一个网络服务，例如启动一个WEB服务。想在 Win10 宿主机中访问这个WEB服务，我们先要通过 <code>ip a</code> 或 <code>ifconfig</code> 命令查看其IP地址才能访问，而且更崩溃的是每次重启后再运行WSL2容器，虚拟交换机会被重新创建，其IP地址和网关会重新分配。</p> 
<p><strong><mark>但在版本18945之后，支持通过localhost访问WSL2容器，所以我们不用考虑这个问题了（有些博客更新不及时，容易误导新手）。</mark></strong></p> 
<p>附上官方发行文档：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/release-notes#build-18945" rel="nofollow">微软WSL官方发行版本说明</a></p> 
<p>注：可使用以下命令之一获取IP地址</p> 
<pre><code>ip addr | grep eth0
ifconfig 
</code></pre> 
<p><strong>如果非要固定IP，参考链接：</strong><a href="https://blog.csdn.net/manbu_cy/article/details/108476859">WSL2固定ip地址</a></p> 
<h4><a id="42__801"></a>4.2 文件系统</h4> 
<blockquote> 
 <p>WSL2中使用虚拟硬件磁盘来存储文件，在Windows下不能像WSL1一样直接访问C盘中的地址。</p> 
</blockquote> 
<p>建议先浏览官方文档：<a href="https://docs.microsoft.com/en-us/windows/wsl/filesystems" rel="nofollow">跨文件系统|工作微软文档 (microsoft.com)</a></p> 
<p>需要在Windows下访问Ubuntu的文件系统的话，可以有两种方式：</p> 
<ol><li> <p>在Linux中运行 <code>explorer.exe .</code></p> <p>可以立即打开Linux当前所在的文件目录，<strong>注意：.exe后面还有个空格后面再加一个点</strong>。</p> </li><li> <p>在windows 的资源管理器的文件路径里、命令行窗口或者PowerShell中运行 <code>\\wsl$\ubuntu</code>，可以立即打开Linux当前所在的文件目录</p> <p><img src="https://images2.imgbox.com/ce/31/Iy3BU95r_o.png" alt=""></p> </li><li> <p>添加网络映射的形式添加</p> </li></ol> 
<h5><a id="421__819"></a>4.2.1 设置软连接快捷访问（可选）</h5> 
<p>你应该注意到了，当进入wsl2 后，默认处于 <code>/mnt/c/Users/wys</code>。</p> 
<p><img src="https://images2.imgbox.com/a4/bd/8Q1LEUw3_o.png" alt=""></p> 
<p>查询磁盘，可以发现wsl2的文件结构有点特别，原先windows 系统的C盘和D盘被挂载到 <code>/mnt</code> 下，而且还多了一个 <code>wsl</code> 目录。</p> 
<pre><code class="prism language-bash">root@DESKTOP-58FD2RV:/<span class="token comment"># ls</span>
bin   dev  home  lib    lib64   lost+found  mnt  proc  run   snap  sys  usr
boot  etc  init  lib32  libx32  media       opt  root  sbin  srv   tmp  var
root@DESKTOP-58FD2RV:/<span class="token comment"># df -h</span>
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb        251G  <span class="token number">1</span>.2G  238G   <span class="token number">1</span>% /
tmpfs           <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /mnt/wsl
tools           171G  136G   36G  <span class="token number">80</span>% /init
none            <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /dev
none            <span class="token number">6</span>.3G   12K  <span class="token number">6</span>.3G   <span class="token number">1</span>% /run
none            <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /run/lock
none            <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /run/shm
none            <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /run/user
tmpfs           <span class="token number">6</span>.3G     <span class="token number">0</span>  <span class="token number">6</span>.3G   <span class="token number">0</span>% /sys/fs/cgroup
C:<span class="token punctuation">\</span>             171G  136G   36G  <span class="token number">80</span>% /mnt/c
D:<span class="token punctuation">\</span>              67G   24G   43G  <span class="token number">36</span>% /mnt/d
</code></pre> 
<p>而Ubuntu的文件，因为通过<strong>Microsoft Store</strong>安装的，默认在c盘，所以为了避免占用C盘空间，我用软连接，快捷访问D盘。在D盘中创建目录 <code>mnt/d/wsl/Ubuntu</code> ，以后的文件都放在这里。然后在wsl2 中直接访问 <code>/home/ubuntu</code> 即可，这样比较符合linux操作习惯。当然如果不闲麻烦，也可以每次手动进入D盘。</p> 
<pre><code class="prism language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /mnt/d/wsl/ubuntu /home/ubuntu

root@DESKTOP-58FD2RV:/<span class="token comment"># ll /home/</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Apr <span class="token number">27</span> <span class="token number">17</span>:33 ./
drwxr-xr-x <span class="token number">19</span> root root <span class="token number">4096</span> Apr <span class="token number">26</span> <span class="token number">16</span>:29 <span class="token punctuation">..</span>/
lrwxrwxrwx  <span class="token number">1</span> root root   <span class="token number">18</span> Apr <span class="token number">27</span> <span class="token number">17</span>:33 ubuntu -<span class="token operator">&gt;</span> /mnt/d/wsl/ubuntu//
drwxr-xr-x  <span class="token number">3</span> ycw  ycw  <span class="token number">4096</span> Apr <span class="token number">27</span> <span class="token number">13</span>:19 ycw/
</code></pre> 
<h3><a id="Docker_859"></a>五、安装Docker</h3> 
<p>凭借原生 Linux 内核，WSL2 拥有接近原生的文件系统性能，这导致 Docker 宣布其即将推出的<a href="https://engineering.docker.com/2019/06/docker-hearts-wsl-2/" rel="nofollow">Windows Docker</a>版本<a href="https://engineering.docker.com/2019/06/docker-hearts-wsl-2/" rel="nofollow">将利用 WSL2</a>而不是它目前依赖的 Moby Linux VM 在 <strong>Hyper-V</strong> 中运行 Linux 容器。您不再需要等待 Docker for Windows 启动其 VM。根据 Docker 的说法，WSL2 和 Docker 守护进程在他们的开发笔记本电脑上在 2 秒内启动，这意味着 WSL2 可以在容器启动的同时启动（而不是在启动时）。作为一个额外的好处，从容器到 Windows 主机的绑定挂载将不再依赖于 Samba 服务，而是由 WSL2 以更好的性能本地处理。</p> 
<blockquote> 
 <p>三种安装选项</p> 
</blockquote> 
<p>因为 wsl 2 已经完整使用了 linux 内核了，所以现在有三种安装选项，主要是前两种</p> 
<ul><li>安装<strong>Docker Desktop for Windows</strong>（设置wsl2访问）可以参考教程<a href="https://docs.docker.com/desktop/windows/wsl/#install" rel="nofollow">docker官方文档</a>以及<a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-containers" rel="nofollow">Microsoft WSL官方文档</a></li><li>直接在Linux中安装<strong>Docker ce</strong>（此种方式和在linux虚拟机安装docker类似）可以参考<a href="https://docs.docker.com/engine/install/ubuntu/" rel="nofollow">Docker官方文档</a></li><li><strong>Docker Toolbox for Windows</strong>（兼容Windows 10以下安装的方式，这里不讨论这种方式，<strong>不推荐</strong>）</li></ul> 
<h4><a id="51_linuxdocker_871"></a>5.1 原生linux安装docker</h4> 
<blockquote> 
 <p>因为wsl2已经完整使用了linux内核了，此种方式和先前在linux虚拟机安装docker类似，可以参考我之前的博客</p> 
</blockquote> 
<p><a href="https://developer.aliyun.com/article/110806" rel="nofollow">阿里云社区Docker ce安装流程</a></p> 
<p>linux安装方式有很多，这里将使用sh脚本形式来安装</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token parameter variable">-o</span> get-docker.sh
<span class="token function">sudo</span> <span class="token function">sh</span> get-docker.sh
<span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">docker</span> start
</code></pre> 
<blockquote> 
 <p>执行脚本安装过程中，脚本提示“<strong>建议使用Docker Desktop for windows</strong>”，20s内按Ctrl+C会退出安装，所以需要等待20s，另外此种方式需要访问外网。</p> 
</blockquote> 
<p>检查docker安装正常</p> 
<pre><code class="prism language-bash"><span class="token comment"># 检查dockerd进程启动</span>
<span class="token function">service</span> <span class="token function">docker</span> status
<span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> <span class="token function">docker</span>
<span class="token comment"># 检查拉取镜像等正常</span>
<span class="token function">docker</span> pull busybox
<span class="token function">docker</span> images
</code></pre> 
<blockquote> 
 <p><strong>注意</strong>：不同于完全linux虚拟机方式，WLS2下通过<code>apt install docker-ce</code>命令安装的docker无法启动，因为WSL2方式的ubuntu里面没有systemd。上述官方get-docker.sh安装的docker，dockerd进程是用ubuntu传统的init方式而非systemd启动的。</p> 
</blockquote> 
<pre><code>vim /lib/systemd/system/docker.service

### 修改文件
[Service]
ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock -H fd:// --containerd=/run/containerd/containerd.sock
### 上面这一行,主要是增加了`-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock`


1. vim /etc/default/docker

2. 修改启动配置文件，如下：

# 开启远程访问 -H tcp://0.0.0.0:2375
# 开启本地套接字访问 -H unix:///var/run/docker.sock
DOCKER_OPTS="-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"

重启Docker
sudo service docker restart
</code></pre> 
<h4><a id="52_Docker_Desktop_for_Windows_921"></a>5.2 Docker Desktop for Windows（推荐）</h4> 
<p>Docker 也专门开发了可以使用 <code>WSL2</code> 中的 <code>Docker</code> 守护进程的桌面管理程序，具体请查看<strong>docker官方文档</strong> <a href="https://docs.docker.com/docker-for-windows/wsl/" rel="nofollow">Docker Desktop WSL 2 backend (opens new window)</a>，打开 <strong>Docker Desktop WSL2 backend</strong> 页面，查看是否满足安装要求，然后下载最新的 <strong>Docker Desktop for Windows</strong> 程序 ，建议下载 <code>stable</code> 版本。</p> 
<h5><a id="521_Docker_Desktop_925"></a>5.2.1 准备修改Docker Desktop软件默认安装路径(可选)</h5> 
<blockquote> 
 <p>win10安装 <strong>docker desktop</strong> 时，没有提供选择权限，默认直接就安装到了c盘。我们可以修改默认安装路径，但是注意，这里只是修改了这个应用的程序安装位置而已，镜像和容器等数据还是默认存储在C盘。如果要修改镜像和容器等数据存储位置，下文有介绍。</p> 
</blockquote> 
<p>网上总结的方法目前只有一种，就提前将c盘的docker安装路径软连接到其他盘，具体操作如下：</p> 
<ol><li> <p>现在先建立Docker文件夹，例如 <code>D:\software\Docker</code></p> </li><li> <p>如果已经安装的，需要去控制面板里先卸载</p> </li><li> <p>然后在命令提示符执行下边的命令（注意：需要管理员身份运行命令提示符）</p> <pre><code class="prism language-powershell">mklink <span class="token operator">/</span>j <span class="token string">"C:\Program Files\Docker"</span> <span class="token string">"D:\software\Docker"</span>
</code></pre> <p>成功如下</p> <p><img src="https://images2.imgbox.com/a1/2c/GrIvOMZ5_o.png" alt=""></p> </li><li> <p>最后通过下一步 [[#5.2.2 开始安装]]安装完后，可以发现 <strong>docker desktop</strong> 已经安装到了d盘</p> <p><img src="https://images2.imgbox.com/8a/4d/IUgMoLxa_o.png" alt=""></p> </li></ol> 
<h5><a id="522__949"></a>5.2.2 开始安装</h5> 
<p>官方文档：<a href="https://docs.docker.com/desktop/windows/install/" rel="nofollow">Install Docker Desktop on Windows | Docker Documentation</a></p> 
<ul><li> <p><strong>手动下载安装</strong></p> <p>点击以下 [链接 (opens new window)](https://desktop.docker.com/win/stable/amd64/Docker Desktop Installer.exe)下载 <strong>Docker Desktop for Windows</strong>。下载好之后双击 <code>Docker Desktop Installer.exe</code> 开始安装。</p> </li><li> <p><strong>使用 <a href="https://docs.microsoft.com/zh-cn/windows/package-manager/" rel="nofollow">winget (opens new window)</a> 安装(未测试)</strong></p> <pre><code class="prism language-powershell">winget install Docker<span class="token punctuation">.</span>DockerDesktop
</code></pre> <p>下载后直接安装，（为了避免不可预知的问题，最好用右键“以管理员身份运行”）。跟随安装界面，一路下一步即可。所有的选项都采用默认。安装成功后，点击“Close”关闭窗口。</p> </li></ul> 
<p>安装成功后，启动<strong>Docker Desktop</strong>，然后在终端窗口执行命令检测是否安装成功</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 查询版本</span>
docker version
<span class="token comment"># 查询详细信息</span>
docker info
</code></pre> 
<h5><a id="523__WSL2__Docker_974"></a>5.2.3 在 WSL2 运行 Docker</h5> 
<p>若你的 Windows 版本为 Windows 10 专业版或家庭版 v1903 及以上版本或 Windows 11，可以使用 WSL2 运行 Docker。</p> 
<p>注意，这个时候在 WSL 里面执行 docker 命令是找不到的，需要设置一下。</p> 
<ol><li> <p>打开 Docker Desktop <strong>Settings</strong>，选择<strong>General</strong></p> <p>勾选<strong>Use WSL 2 based engine</strong>。（如果在已经支持WSL的操作系统上，安装Docker Desktop，那么这个选项是被默认选中的，无需更改。）</p> <p><img src="https://images2.imgbox.com/b6/9b/ySvQTpSs_o.png" alt=""></p> <p>注意，如果不选中<code>Use WSL 2 based engine</code>，Resources下面就会回到之前版本的模样。自己制定CPU、内存等信息。但是该版本指定这些信息会出错（这是给WSL 1 用的）。</p> </li></ol> 
<p>​ <img src="https://images2.imgbox.com/dd/60/nnSQ1Hce_o.png" alt=""></p> 
<ol start="2"><li> <p>进入 <strong>Settings &gt; Resources &gt; WSL Integration</strong>。</p> <p>在这个界面中，选择任何你想要使用的Linux发行版本（<strong>手动选择后，可以在Linux中来操作Docker</strong>）。</p> <p><img src="https://images2.imgbox.com/0a/09/JS2YiBb9_o.png" alt=""></p> <p>点击 Apply &amp; Restart</p> </li><li> <p><strong>重启</strong> <code>Docker desktop for Windows</code>，重启完成后我们就可以在 WSL2里面使用 docker 命令了</p> </li></ol> 
<p>在WSL2里面执行 <code>df -Th</code> ,会发现增加了一些新的与docker有关的挂载点。</p> 
<h5><a id="524__1002"></a>5.2.4 修改镜像和容器等数据存储位置(可选)</h5> 
<p>因为我使用的是WSL2的版本，docker 运行数据都在 WSL 发行版中，文件位置都只能由 WSL 管理。因此 <strong>docker desktop</strong> 在安装的时候创建如下两个发行版（distro）</p> 
<ul><li>docker-desktop</li><li>docker-desktop-data</li></ul> 
<blockquote> 
 <p>说明</p> 
</blockquote> 
<p>这两个wsl子系统默认存放在系统盘（<strong>即使通过上文修改了Docker Desktop的安装路径</strong>），默认存储位置： <code>%LOCALAPPDATA%/Docker/wsl</code> （即 <code>C:\Users\xxxxx\AppData\Local\Docker\wsl</code>）。如果访问 <code>%LOCALAPPDATA%/Docker/wsl</code> 目录，就可以看到两个文件夹，同时每个文件夹中都会有一个 <strong>vhdx</strong> 文件。</p> 
<ul><li><code>data/ext4.vhdx</code> 是被 <strong>docker-desktop-data</strong> 发行版使用，存放镜像</li><li><code>distro/ext4.vhdx</code> 是被 <strong>docker-desktop</strong> 发行版使用，存放程序（内存占用小，根据需要，可以不用修改）</li></ul> 
<p><strong>docker-desktop-data</strong> 是被用来存储docker images 以及相关的数据。因此，它的大小会随着使用逐步增长，因此导致系统盘空间不足。</p> 
<p>vhdx文件最大支持256G，超过此大小，则可能需要对其进行扩展。参见：<a href="https://docs.microsoft.com/en-us/windows/wsl/vhd-size" rel="nofollow">扩展 WSL 2 虚拟硬盘|的大小微软文档 (microsoft.com)</a></p> 
<p><strong>修改方法如下：</strong></p> 
<ul><li> <p><strong>方法一：通过 wsl 命令进行操作</strong></p> <pre><code class="prism language-powershell"><span class="token comment"># 查看已创建子系统</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">-</span>l <span class="token operator">-</span>v <span class="token operator">--</span>all
  NAME                   STATE           VERSION
<span class="token operator">*</span> Ubuntu                 Running         2
  docker-desktop-<span class="token keyword">data</span>    Running         2
  docker-desktop         Running         2

<span class="token comment"># 终止所有正在运行的docker发行版</span>
<span class="token comment"># 可以使用以下命令立即终止所有正在运行的发行版，包括Ubuntu，可以手动退出Docker Desktop也行</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>shutdown

<span class="token comment"># 再次查看，保证docker发行版也停止运行，</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
  NAME                   STATE           VERSION
<span class="token operator">*</span> Ubuntu                 Running         2
  docker-desktop-<span class="token keyword">data</span>    Stopped         2
  docker-desktop         Stopped         2

<span class="token comment"># 备份导出wsl子系统镜像(注意，根据官方说明，最好在停止发行版8秒后，再来操作)</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>export docker-desktop E:\Docker\wsl\docker-desktop\docker-desktop<span class="token punctuation">.</span>tar
<span class="token comment"># 注意，原有的 docker images 也会一起导出</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>export docker-desktop-<span class="token keyword">data</span> E:\Docker\wsl\docker-desktop-<span class="token keyword">data</span>\docker-desktop-<span class="token keyword">data</span><span class="token punctuation">.</span>tar

<span class="token comment"># 注销删除现有的wsl子系统，注销过后会发现原来在c盘的ext4.vhdx文件已经删除了</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>unregister docker-desktop
正在注销<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>unregister docker-desktop-<span class="token keyword">data</span>
正在注销<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># 重新创建wsl子系统</span>
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>import docker-desktop E:\Docker\wsl\docker-desktop E:\Docker\wsl\docker-desktop\docker-desktop<span class="token punctuation">.</span>tar <span class="token operator">--</span>version 2
C:\Users\xxxxx&gt;wsl <span class="token operator">--</span>import docker-desktop-<span class="token keyword">data</span> E:\Docker\wsl\docker-desktop-<span class="token keyword">data</span> E:\Docker\wsl\docker-desktop-<span class="token keyword">data</span>\docker-desktop-<span class="token keyword">data</span><span class="token punctuation">.</span>tar <span class="token operator">--</span>version 2
</code></pre> <p>根据需要，设置默认分发版（可选，因为我是默认使用Ubuntu，所以不执行）</p> <pre><code class="prism language-powershell">wsl <span class="token operator">-</span>s docker-desktop
</code></pre> <p>重新启动 <strong>docker desktop</strong>，验证docker服务是否可以正常使用。查看新目录中的vhdx的修改时间，如果修改时间是最新时间，就说明配置成功。然后随便拉个nginx下来启动试试。</p> <p>验证成功后，上面导出的两个文件根据自己需要进行删除。</p> <pre><code class="prism language-powershell"><span class="token function">del</span> E:\docker\wsl\docker-desktop\docker-desktop<span class="token punctuation">.</span>tar
<span class="token function">del</span> E:\docker\wsl\docker-desktop-<span class="token keyword">data</span>\docker-desktop-<span class="token keyword">data</span><span class="token punctuation">.</span>tar
</code></pre> </li><li> <p><strong>方法二：通过软链接(未测试)</strong></p> 
  <ol><li> <p>将 <code>%LOCALAPPDATA%/Docker/wsl/data</code> 下的 <strong>ext4.vhdx</strong> 复制到想要的路径下，本文路径为：<code>E:\Docker\wsl\docker-desktop-data</code></p> </li><li> <p>删除源文件夹，本文是 <code>%LOCALAPPDATA%/Docker/wsl</code> 下的 <strong>data</strong> 文件夹</p> </li><li> <p>以管理员运行cmd并且使用以下命令创建链接：</p> <pre><code class="prism language-powershell">mklink <span class="token operator">/</span>J C:\Users\xxxxx\AppData\Local\Docker\wsl\<span class="token keyword">data</span> E:\Docker\wsl\docker-desktop-<span class="token keyword">data</span>
</code></pre> <p>请大家自行替换路径，本文路径分别为源路径：<code>C:\Users\Administrator\AppData\Local\Docker\wsl\data</code>，以及想要移动的路径：<code>E:\Docker\wsl\docker-desktop-data</code> ，此时可以在源路径看到新建出来的软链接文件夹</p> </li><li> <p>而 <code>%LOCALAPPDATA%/Docker/wsl/distro</code>下的 <strong>ext4.vhdx</strong> 也是同样的操作，这里不重复介绍</p> </li><li> <p>重新启动 <strong>docker desktop</strong>，验证docker服务是否可以正常使用。查看新目录中的vhdx的修改时间，如果修改时间是最新时间，就说明配置成功。然后随便拉个nginx下来启动试试。</p> </li></ol> </li><li> <p>总结网上的其他方法（这些方法感觉不是很靠谱，<strong>未测试</strong>。有测试过的同行，麻烦踢我一下）</p> 
  <ul><li> <p>方法一：打开docker desktop 的 Settings，点击左侧 menu，找到 Resources 按钮，点击并找到 Disk Image Location，然后进行修改（这种方法有很多人找不到这个选项，是因为Docker 被WSL2管理，不允许修改）</p> </li><li> <p>方法二：打开docker desktop 的 Settings，点击左侧 Docker Engine，修改配置文件，添加 <code>graph</code> 属性（操作很简单，但我不想测试了）</p> </li></ul> <p>参考博客：<a href="https://blog.csdn.net/liangcsdn111/article/details/110236655">windows10 docker 安装在D盘</a></p> </li></ul> 
<h5><a id="525_Docker__WSL_2_1100"></a>5.2.5 Docker + WSL 2使用手册</h5> 
<p>官方文档：<a href="https://docs.docker.com/desktop/windows/" rel="nofollow">Docker Desktop for Windows 用户手册|Docker 文档</a></p> 
<p>这里给出一点建议</p> 
<ol><li> <p>使用 Docker 和 WSL 2 进行工作或者开发应用程序。建议使用Linux 容器，这样在 Linux 发行版中，也能方便使用 Docker 。</p> </li><li> <p>如何访问 windows containers 中的数据库或者网站呢？用容器ip访问</p> </li><li> <p>如何访问 linux containers 中的数据库或者网站呢？</p> <p>如果是宿主机访问容器：用localhost、127.0.0.1、宿主机局域网ip</p> <p>如果是局域网中其他客户端访问：用宿主机局域网ip</p> </li></ol> 
<h4><a id="53__1117"></a>5.3 两种安装方式总结</h4> 
<ol><li> <p><strong>WSL2下原生linux安装docker方式</strong>和完全linux虚拟机安装docker类似，区别在于WSL2下的linux不支持systemd。</p> </li><li> <p><strong>Docker Desktop for windows方式</strong>，其实质是利用docker的C/S架构，将windows模式下的docker对应<code>docker.sock</code>，docker客户端二进制和docker的数据目录挂载到WSL2里面的linux机器，在此linux机器下执行docker命令(<strong>docker命令为docker客户端</strong>)，实质为客户端通过挂载的 <code>/var/run/docker.sock</code> 文件与windows里面的dockerd服务端进程通信。如下图，我们在linux下重新启动linux下dockerd进程，linux模式下下载的busybox镜像又可以看到了，<code>/var/run/docker.sock</code> 的时间戳也被更新了，此时客户端通过 <code>/var/run/docker.sock</code> 文件与linux下的dockerd服务端通信。</p> <p><img src="https://images2.imgbox.com/cb/06/UtBbnC42_o.png" alt=""></p> <p><img src="https://images2.imgbox.com/ea/eb/XPa2ewsN_o.png" alt=""></p> <p>Docker for Desktop 里 <strong>Windows Container</strong> 和 <strong>Linux Container</strong> 两种 docker 容器化运行时，两种运行时不能同时使用，可以切换，切换过程中数据是不会丢失的，你不可以在 <strong>windows container</strong> 环境下操作 <strong>linux container</strong> 的镜像与容器，更不能在 <strong>linux container</strong> 环境下操作 <strong>windows container</strong> 的镜像和容器，两者架构上不一致。</p> <p><strong>要使用哪个模式下的docker，重启下该模式下的docker服务端即可</strong>，本质都是修改 <code>/var/run/docker.sock</code> 文件。理论可以同时使用，但是需要修改docker配置，通过 <code>-H</code> 参数增加dockerd的tcp监听，执行具体docker命令时指定dockerd监听的对应IP和端口即可。</p> <p>切换操作如下，右键点击图标，可以切换 <code>containers</code>，**默认安装完就是 Linux Container ，不推荐使用 Windows containers **。</p> <p><img src="https://images2.imgbox.com/b1/99/CLzhNvHD_o.png" alt=""></p> <p>有些是因为系统版本不太行，不能选择 <code>Windows containers</code>（下图是本人很早时候安装出现的情况）</p> <p><img src="https://images2.imgbox.com/1b/94/zqJF3VEv_o.png" alt=""></p> <p>在<strong>windows terminal</strong> 中 <code>docker ps</code> 命令在windows和ubuntu中查看容器进程，查到的结果是一样的。</p> </li></ol> 
<p>最后，就可以在win 10 下使用各种 linux 子系统了， 也可以在 win10 和 linux 下使用 docker 和以及 kubernetes 啦。</p> 
<h4><a id="54__WSL__1143"></a>5.4 检查 WSL 模式</h4> 
<blockquote> 
 <p>确保Linux发行版本是运行在WSL 2 模式下。WSL 在V1 和 V2 两种模式下都可以运行</p> 
</blockquote> 
<p>首先在 <code>Windows PowerSell</code> 中，输入：</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
</code></pre> 
<p>就可以查看到，多了 <strong>docker desktop</strong> 的信息。（因为我是安装的<strong>Docker Desktop for Windows</strong>）</p> 
<pre><code class="prism language-powershell"><span class="token function">PS</span> C:\Users\wys&gt; wsl <span class="token operator">-</span>l <span class="token operator">-</span>v
  NAME                   STATE           VERSION
<span class="token operator">*</span> Ubuntu                 Running         2
  docker-desktop-<span class="token keyword">data</span>    Running         2
  docker-desktop         Running         2
</code></pre> 
<p>如果现有的 <strong>WSL</strong> 是v1，通过下面的命令可以升级为 v2:</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-version</span> <span class="token punctuation">(</span>distro name<span class="token punctuation">)</span> 2
</code></pre> 
<p>想要把 v2 设置为默认模式，可以通过下面的命令：</p> 
<pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version 2
</code></pre> 
<p>开始使用！</p> 
<p>在Windows CMD中，通过命令随便运行几个容器。在Linux中，就可以查看到已经运行的容器信息。</p> 
<h4><a id="55__1179"></a>5.5 配置镜像加速器（阿里云）</h4> 
<blockquote> 
 <p>安装 Docker 软件后，可以直接通过 docker pull 命令拉取镜像。如未配置镜像加速源，直接拉取 DockerHub 中的镜像，通常下载速度会比较慢。这里我将用阿里云镜像加速器。</p> 
</blockquote> 
<h5><a id="551_Docker_Desktop_for_Windows_1183"></a>5.5.1 Docker Desktop for Windows</h5> 
<p>在系统右下角托盘图标内右键菜单选择 <code>Settings</code>，打开配置窗口后左侧导航菜单选择 <code>Docker Engine</code>。编辑窗口内的JSON串，填写下方加速器地址：</p> 
<pre><code class="prism language-ini">{
  "registry-mirrors": ["https://4bj04jx5.mirror.aliyuncs.com"]
}
</code></pre> 
<p>编辑完成后点击 <code>Apply</code> 保存按钮，等待 Docker 重启并应用配置的镜像加速器。</p> 
<h5><a id="552_Docker_ce_1195"></a>5.5.2 Docker ce</h5> 
<blockquote> 
 <p>这里适用于Ubuntu 和 CentOS</p> 
</blockquote> 
<p>针对Docker客户端版本大于 1.10.0 的用户</p> 
<p>您可以通过修改daemon配置文件 <code>/etc/docker/daemon.json</code>来使用加速器</p> 
<pre><code class="prism language-ini">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "registry-mirrors": ["https://4bj04jx5.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre> 
<p>参考链接：</p> 
<p><a href="https://blog.csdn.net/weixin_44953227/article/details/109242166">配置 Docker 镜像加速源地址</a></p> 
<p><a href="https://help.aliyun.com/document_detail/60750.html" rel="nofollow">阿里云镜像加速</a></p> 
<h4><a id="56__1220"></a>5.6 可能出现的问题</h4> 
<ul><li> <p><strong>docker for windows could not read CA certificate</strong></p> <p>问题原因：之前安装过 <strong>docker toolbox</strong>。</p> <p>解决步骤：</p> 
  <ol><li>删掉四个docker 的环境变量</li><li>执行cmd命令 <code>docker-machine rm default</code></li><li>以管理员身份执行cmd命令 <code>@FOR /f “tokens=*” %i IN (‘docker-machine env -u’) DO @%i</code></li></ol> </li><li> <p><strong>Filesharing has been cancelled</strong></p> <p>安装成功后，可能用到<strong>docker-compose</strong>，对于新手，这部分可能会遇到麻烦。</p> <p>问题原因：当前创建的目录没有加入到文件分享当中，导致操作被取消（如果开启WSL 2就没有这个问题）</p> <p>解决步骤：</p> 
  <ol><li>Docker Desktop -&gt; Settings -&gt; Resources -&gt; File Sharing</li><li>将当前项目目录或项目的父级目录（根目录或上几级）添加进去</li><li>Apply &amp; Restart</li><li>Docker Desktop -&gt; Restart</li></ol> </li><li> <p><strong>Ubuntu22.04 Dokcer 安装 mysql8.0 失败，日志如下：mysqld: Cannot change permissions of the file ‘ca.pem’ (OS errno 1 - Operation not permitted)</strong></p> <pre><code class="prism language-text">root@LAPTOP-LHBT0GVK:/home/dockerdata/mysql8.0# docker logs mysql8.0
2022-10-17 16:24:27+08:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.27-1debian10 started.
2022-10-17 16:24:27+08:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
2022-10-17 16:24:27+08:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.27-1debian10 started.
2022-10-17 16:24:27+08:00 [Note] [Entrypoint]: Initializing database files
mysqld: [Warning] World-writable config file '/etc/my.cnf' is ignored.
2022-10-17T08:24:27.814101Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.27) initializing of server in progress as process 43
2022-10-17T08:24:27.823718Z 0 [Warning] [MY-010159] [Server] Setting lower_case_table_names=2 because file system for /var/lib/mysql/ is case insensitive
2022-10-17T08:24:27.831806Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2022-10-17T08:24:29.447600Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
mysqld: Cannot change permissions of the file 'ca.pem' (OS errno 1 - Operation not permitted)
2022-10-17T08:24:31.139785Z 0 [ERROR] [MY-010295] [Server] Could not set file permission for ca.pem
2022-10-17T08:24:31.139843Z 0 [ERROR] [MY-013236] [Server] The designated data directory /var/lib/mysql/ is unusable. You can remove all files that the server added to it.
2022-10-17T08:24:31.140179Z 0 [ERROR] [MY-010119] [Server] Aborting
2022-10-17T08:24:32.831797Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.0.27)  MySQL Community Server - GPL.
</code></pre> <p>在 WSL2 发行版中创建。<code>/etc/wsl.conf</code>，输入以下内容</p> <pre><code class="prism language-shell"><span class="token punctuation">[</span>automount<span class="token punctuation">]</span>
options <span class="token operator">=</span> <span class="token string">"metadata"</span>
</code></pre> <p>保存（）并重新启动 WSL</p> <pre><code class="prism language-bash"><span class="token comment"># 关闭所有的wsl</span>
wsl <span class="token parameter variable">--shutdown</span>
<span class="token comment"># 启动wsl</span>
wsl
</code></pre> <p>参考：<a href="https://www.jianshu.com/p/e91ad956eed7" rel="nofollow">Docker安装MYSQL无法运行的天坑 mysqld: Can’t read dir of ‘/etc/mysql/conf.d/’ (OS errno 13 - Permission den… </a></p> </li></ul> 
<h3><a id="_1287"></a>六、安装桌面环境(可选)</h3> 
<blockquote> 
 <p>补充：实在没有必要在WSL 中安装桌面环境和输入法等等，感觉就很另类，而且不实用，别整这些花里胡哨的。我写这个流程，单纯是因为公司需要桌面环境，所以尝试了一下，反正我最后卸载了。</p> 
</blockquote> 
<h4><a id="61__1291"></a>6.1 介绍</h4> 
<p>WSL 2是为开发人员准备的命令行工具，今天突然在官网发现，<a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/gui-apps" rel="nofollow">WSL 2已经支持原生GUI</a>，但有先决条件。</p> 
<ul><li> <p>需要 <strong>Windows 11 版本22000或更高</strong> 版本才能访问此功能。 可以加入 Windows 预览<a href="https://insider.windows.com/" rel="nofollow">体验计划</a>，以获取最新的预览版。</p> </li><li> <p><strong>安装了 vGPU 的驱动程序</strong></p> <p>若要运行 Linux GUI 应用，你应该首先安装与你的系统匹配的预览驱动程序。 这使你能够使用虚拟 GPU (vGPU) 以便你可以从硬件加速 OpenGL 呈现中获益。</p> </li></ul> 
<p>这里我的电脑系统比较老，同时不愿意加入预览体验计划（不想踩坑），而且也不愿意加入升级 Windows 11（还是不想踩坑），所以不尝试这种方法。有需要的可以参考博客：<a href="https://blog.csdn.net/xianyu58/article/details/118226096">WSL 2 GUI 原生支持！</a></p> 
<p>因为桌面环境可以在WSL2内部运行，我们可以使用适用于 Windows 的 X 服务器来侦听 Linux 中的 X11（图形）程序。实现原理是，远程桌面启动监听服务用于监听，WSL启动程序后把界面数据发送给远程桌面软件，远程桌面软件接收到数据进行绘制，于是在Win下看到图形界面。</p> 
<blockquote> 
 <p>安装流程总共分为三步</p> 
</blockquote> 
<ul><li> <p>安装远程桌面服务（xrdp，Xming或VcXSrv）</p> </li><li> <p>安装X11（图形）程序（xfce4，xubuntu-desktop，ubuntu-desktop）</p> </li><li> <p>进行配置设置</p> </li></ul> 
<blockquote> 
 <p>以下是我找到的大部分方案：</p> 
</blockquote> 
<ul><li> <p>直接安装 <code>xfce4</code> ，然后设置 <code>xrdp</code> 远程连接，参考这个<a href="https://www.bilibili.com/s/video/BV1LA411n7BK" rel="nofollow">B站视频教程</a>。<strong>xfce4</strong> 是一个轻量级桌面环境，推荐这个。</p> </li><li> <p>安装 <code>xubuntu-desktop</code> ，然后设置 <code>xrdp</code> 远程连接，参考<a href="https://blog.csdn.net/xmh19936688/article/details/90212960">这个教程</a>。<strong>xubuntu</strong> 桌面相当于 <strong>xfce4</strong> 桌面加上一些小工具。</p> </li><li> <p>安装 <code>ubuntu-desktop</code>，使用 <code>X Server</code>，参考：<a href="https://zhuanlan.zhihu.com/p/34884285" rel="nofollow">WSL 使用指南——04 安装桌面环境</a></p> </li><li> <p>安装 <code>ubuntu-desktop</code>，并使用 <code>VcXsrv</code> 显示服务器程序显示。参考<a href="https://blog.csdn.net/Ashken/article/details/108974058">这个教程</a></p> 
  <ul><li>注意这个教程在 WSL2 下 <strong>ubuntu18.04LTS</strong> 中没有问题。但安装 <strong>ubuntu20.04LTS 桌面环境</strong>可能会失败。据说是因为 <strong>gnome 桌面</strong>是基于 <code>systemd</code>，而 <strong>WSL</strong> 不支持 <code>systemd</code>，所以需要先安装 <code>systemd</code>。操作流程参考流程[[#2.3.4 安装WSL的systemd脚本]]。</li></ul> </li></ul> 
<h4><a id="62__1321"></a>6.2 开始</h4> 
<p>本人安装的WSL 分发版是 <code>Ubuntu 20.04.3 LTS (GNU/Linux 5.4.72-microsoft-standard-WSL2 x86_64)</code> ，准备采用第一种方法<code>xfce4</code> + <code>xrdp</code> 。</p> 
<h4><a id="63__1325"></a>6.3 源更新与升级依赖</h4> 
<p>设置国内源，这里省略，可参考流程[[#2.3.3 修改ubuntu的apt安装源]]</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade
</code></pre> 
<h4><a id="64__1334"></a>6.4 安装桌面环境</h4> 
<p>在 Ubuntu 源仓库有很多桌面环境供你选择。一个选择是安装 Gnome，它是 Ubuntu 20.04 的默认桌面环境。另外一个选项就是安装 <code>xfce</code>。它是快速，稳定，并且轻量的桌面环境，使得它成为远程服务器的理想桌面。</p> 
<p>不同的桌面环境，可以参考文章<a href="https://linux.cn/article-5095-1-renrendongbeilinux.html" rel="nofollow">Ubuntu &amp; XFCE vs Xubuntu区别介绍</a></p> 
<h5><a id="641_xfce4_1340"></a>6.4.1 安装xfce4</h5> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> xfce4
</code></pre> 
<p>安装 <strong>xfce4</strong> 过程中，会弹框出现选择显示管理DM选择 <code>gdm3</code> 和 <code>lightdm</code> 的提示，建议选择 <code>lightdm</code></p> 
<p>如果错过了安装过程中出现的这个向导，那么可以在安装完成后执行下面的命令重新设置DM</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> dpkg-reconfigure lightdm
</code></pre> 
<h4><a id="65_session_1354"></a>6.5 为当前用户指定登录session类型</h4> 
<p><strong>注意这一步很重要,如果不设置的话会导致后面远程桌面连接上闪退</strong></p> 
<pre><code class="prism language-bash">$ <span class="token function">vim</span> ~/.xsession

<span class="token comment"># 写入下面内容(就一行)</span>
xfce4-session
</code></pre> 
<p>或者一步到位</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token builtin class-name">echo</span> xfce4-session <span class="token operator">&gt;</span> ~/.xsession
</code></pre> 
<p>这是告诉系统，开启桌面环境的时候用 <strong>xfce4-session</strong> 。</p> 
<p>完成后，执行下面这段代码就可以看到桌面的图形界面了。</p> 
<pre><code class="prism language-bash">xfce4-session
</code></pre> 
<h4><a id="66__1379"></a>6.6 安装远程桌面服务</h4> 
<blockquote> 
 <p>补充：如果想连接虚拟机或者双系统里面的Ubuntu，同样可以参考此流程。</p> 
</blockquote> 
<p>Xrdp 是一个微软远程桌面协议（RDP）的开源实现，它允许你通过图形界面控制远程系统。通过 RDP，你可以登录远程机器，并且创建一个真实的桌面会话，就像你登录本地机器一样。</p> 
<h5><a id="661_xrdp_1385"></a>6.6.1 安装xrdp</h5> 
<p>Xrdp 被包含在默认的 Ubuntu 软件源中。想要安装它，运行：</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> xrdp
</code></pre> 
<p>一旦安装完成，Xrdp 服务将会自动启动。你可以输入下面的命令，验证它：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl status xrdp
</code></pre> 
<p>如果提示找不到该命令，那是没有安装 systemd 命令。参考[[#2.3.4 安装WSL的systemd命令]]</p> 
<p>输出将会像下面这样：</p> 
<pre><code class="prism language-bash">● xrdp.service - xrdp daemon
     Loaded: loaded <span class="token punctuation">(</span>/lib/systemd/system/xrdp.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
     Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Fri <span class="token number">2021</span>-11-02 <span class="token number">17</span>:36:16 UTC<span class="token punctuation">;</span> 2min 27s ago
  <span class="token punctuation">..</span>.
</code></pre> 
<p>默认情况下，Xrdp 使用<code>/etc/ssl/private/ssl-cert-snakeoil.key</code>,它仅仅对“ssl-cert” 用户组成语可读。运行下面的命令，将<code>xrdp</code>用户添加到这个用户组：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> adduser xrdp ssl-cert  
</code></pre> 
<p>重启 Xrdp 服务，使得修改生效：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl restart xrdp
</code></pre> 
<p>就这样。Xrdp 已经在你的 Ubuntu 服务器上安装好了，你可以开始使用它了。</p> 
<h5><a id="662_xrdp_1424"></a>6.6.2 修改xrdp配置</h5> 
<p>Xrdp 配置文件定位在<code>/etc/xrdp</code>目录。对于基本的 Xrdp 连接，你不需要对配置文件做任何改动。</p> 
<p>主要的配置文件被命名为 <a href="https://linux.die.net/man/5/xrdp.ini" rel="nofollow">xrdp.ini</a>。这个文件被分成不同的段，允许你设置全局配置，例如安全，监听地址，创建不同的 xrdp 登录会话等。</p> 
<blockquote> 
 <p>修改默认端口</p> 
</blockquote> 
<p>由于 <code>xrdp</code> 安装好后，默认配置使用的是和Windows远程桌面相同的 <code>3389</code> 端口，为了防止和Windows系统远程桌面冲突，建议修改成其他的端口。（<strong>虚拟机和双系统可忽略</strong>）</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/xrdp/xrdp.ini
<span class="token comment"># 修改下面这一行,将默认的3389改成其他端口即可</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3390</span>
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/port=3389/port=3390/g'</span> /etc/xrdp/xrdp.ini
</code></pre> 
<blockquote> 
 <p>修改图像设置（可选）</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/xrdp/xrdp.ini
</code></pre> 
<p><code>max_bpp=32 </code> 修改为128（最大位图深度）</p> 
<p><code>#xserverbpp=24</code> 修改为128，取消注释‘#’。</p> 
<blockquote> 
 <p>设置连接会话进程是否保留</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/xrdp/sesman.ini
</code></pre> 
<p>将<code>KillDisconnected</code>的值修改为 <code>true</code>，保存退出。这样每次断开连接时，linux都会关闭会话进程，连接数量达到上限，出现问题。</p> 
<blockquote> 
 <p>设置 Xrdp 连接的桌面环境</p> 
</blockquote> 
<p>Xrdp 使用默认的 X Window 桌面环境（Gnome or XFCE）。Xrdp 使用 <code>startwm.sh</code> 文件启动 X 会话。如果你想使用另外一个 X Window 桌面，编辑这个文件。</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/xrdp/startwm.sh
</code></pre> 
<p>用#注释末尾两行test和exec：</p> 
<pre><code class="prism language-ini">test -x /etc/X11/Xsession &amp;&amp; exec /etc/X11/Xsession exec /bin/sh
/etc/X11/Xsession
</code></pre> 
<p>添加一行</p> 
<pre><code class="prism language-shell">startxfce4

<span class="token comment"># 如果你是装的虚拟机或者双系统Ubuntu桌面版（即桌面环境默认是ubuntu-desktop，Unity桌面），则这里就添加gnome-session</span>
</code></pre> 
<p>不管什么时候你对配置文件做出修改，你需要重启 Xrdp 服务。</p> 
<h5><a id="663__1490"></a>6.6.3 重启一下电脑</h5> 
<p><strong>本人测试发现，这里需要重启电脑主机，不然可能报错，重启后再启动xrdp。大家可以先跳过这步试试，不行再重启电脑。</strong></p> 
<h5><a id="664_xrdp_1494"></a>6.6.4 启动xrdp</h5> 
<p>由于WSL2里面没有 <code>systemd</code> ，所以需要手动启动</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> /etc/init.d/xrdp start
</code></pre> 
<p>或者可以安装 <code>systemd</code> ，参考步骤[[#2.3.4 安装WSL的systemd脚本]]</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">service</span> xrdp restart
</code></pre> 
<h5><a id="665_IP_1508"></a>6.6.5 查看IP地址</h5> 
<pre><code class="prism language-bash"><span class="token function">ip</span> a
</code></pre> 
<p><code>eth0</code> 项中，<code>inet</code> 后面的地址记下来。</p> 
<h4><a id="67__1516"></a>6.7 远程连接</h4> 
<p>按下 <code>windows + R</code> 键，输入 <code>mstsc</code> 打开远程桌面连接</p> 
<p>在计算机（Computer）栏输入刚才记下的ip地址及端口3390，或者地址输入<code>localhost:3390</code>，注意这里的端口号应当与上面修改配置中一致。用户名可填可不填，因为之后会提示填写，或者输入 WSL 2 中使用的账号密码</p> 
<p><img src="https://images2.imgbox.com/22/de/irsN9bfl_o.png" alt=""></p> 
<p>如果连接不上，可以用 <code>telnet</code> 命令测试端口是否开启。如果连接不通，检查 <strong>Xrdp</strong> 是否启动，同时是否有防火墙设置。</p> 
<h5><a id="671__1526"></a>6.7.1 配置防火墙</h5> 
<p>Xrdp 守护程序在所有的网络接口上默认监听端口<code>3389</code>。如果你在你的 Ubuntu 服务器上运行一个防火墙，你需要打开 Xrdp 端口。</p> 
<p>想要允许从某一个指定的 IP 地址或者 IP 范围访问 Xrdp 服务器，例如<code>192.168.33.0/24</code>，你需要运行下面的命令：</p> 
<pre><code class="prism language-python">sudo ufw allow <span class="token keyword">from</span> <span class="token number">192.168</span><span class="token number">.33</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> to <span class="token builtin">any</span> port <span class="token number">3389</span>
</code></pre> 
<p>如果你想允许从任何地方访问（由于安全原因，这种方式不鼓励），运行：</p> 
<pre><code class="prism language-undefined">sudo ufw allow 3389
</code></pre> 
<p>想要增加安全，你可以考虑 Xrdp 仅仅监听 localhost，并且创建一个 SSH 隧道，将本地机器的<code>3389</code>端口到远程服务器的同样端口之间的流量加密。</p> 
<h4><a id="68__1544"></a>6.8 设置中文以及安装输入法（坑）</h4> 
<blockquote> 
 <p>本人尝试各种方法，均测试失败，所以下面流程可以跳过。如果有人成功了，麻烦在评论区踢我一脚</p> 
</blockquote> 
<h5><a id="681_1548"></a>6.8.1安装中文语言包</h5> 
<p><strong>方法一：</strong></p> 
<pre><code>sudo dpkg-reconfigure locales
</code></pre> 
<p>然后一直按键盘上的 ↓ 找到 <code>zh_CN UTF-8</code>，然后按空格勾选，再tab切换到ok上回车，接下来的界面选 <code>zh</code> 再回车。<br> 这一步完成后可能会导致键盘不可用，不用激动，点击桌面左上角图标注销后重进就好了。</p> 
<p>首次进入中文界面会提示是否重命名那几个文件夹，建议保持英文状态，因为有些路径是写进配置文件了的，重命名会带来不必要的麻烦。</p> 
<p><strong>方法二：</strong></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> language-pack-zh-hans
</code></pre> 
<h5><a id="682__1567"></a>6.8.2 修改默认语言环境为中文</h5> 
<p>设置本地化环境变量</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"LANG=zh_CN.UTF-8"</span> <span class="token operator">&gt;&gt;</span> ~/.profile
</code></pre> 
<p>或者通过 <code>locale-gen</code></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> locale-gen zh_CN.UTF-8
</code></pre> 
<h5><a id="683__1581"></a>6.8.3 安装完整的语言支持</h5> 
<p>打开<code>Applications</code>-&gt;<code>Settings</code>-&gt;<code>Language Support</code>，按提示安装包就可以。或者执行命令</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> /usr/bin/gnome-language-selector
</code></pre> 
<p>如果出现闪退，可以在终端中来启动，发现错误：<strong>Failed to connect to socket /var/run/dbus/system_bus_socket: No such file or directory</strong></p> 
<p><img src="https://images2.imgbox.com/28/71/DWX49Vlt_o.png" alt=""></p> 
<p>解决办法：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> dbus

<span class="token function">sudo</span> /etc/init.d/dbus start
</code></pre> 
<p>再次打开<strong>语言支持</strong>，开始安装</p> 
<p><img src="https://images2.imgbox.com/6a/2e/cMg007G8_o.png" alt=""></p> 
<p>在 system settings-&gt;language support-&gt;install/remove languages，在弹出的菜单中选择Chinese(simplified),点击apply</p> 
<p><img src="https://images2.imgbox.com/48/2a/ydavZU9E_o.png" alt=""></p> 
<p>为了避免每次重启都得手动运行 dbus，可以在<strong>应用程序 - 设置 - 会话与启动 - 应用程序自启动</strong>，添加 <strong>/etc/init.d/dbus start</strong>。</p> 
<h5><a id="684__1611"></a>6.8.4 安装中文输入法</h5> 
<p>任选一种</p> 
<blockquote> 
 <p>安装中文输入法fcitx-pinyin</p> 
</blockquote> 
<p>参考链接：<a href="https://blog.csdn.net/weixin_41921520/article/details/99871111">安装中文输入法</a></p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> fcitx fcitx-pinyin
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"export XMODIFIERS=@im=fcitx<span class="token entity" title="\n">\n</span>export GTK_IM_MODULE=fcitx<span class="token entity" title="\n">\n</span>export QT_IM_MODULE=fcitx<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">&gt;&gt;</span> ~/.profile
</code></pre> 
<p>软件包已装，在<strong>应用程序 - 设置 - 会话与启动 - 应用程序自启动</strong>，添加 <strong>/usr/bin/fcitx</strong>。</p> 
<p>打开系统自带的 Input Method Configuration，直接点击OK、Yes，然后将默认的 ibus 切换为 fcitx，一路OK</p> 
<p><img src="https://images2.imgbox.com/cd/6a/sGXgmEyn_o.png" alt=""></p> 
<p>搜狗输入法是建立在fcitx框架之上的，所以要将输入法框架选择为fictx，</p> 
<blockquote> 
 <p>安装搜狗输入法</p> 
</blockquote> 
<p><a href="https://pinyin.sogou.com/linux/help.php" rel="nofollow">官方安装指南</a></p> 
<h4><a id="69__1638"></a>6.9 可能出现的问题</h4> 
<h5><a id="691_xrdp_1640"></a>6.9.1 xrdp远程桌面黑屏处理</h5> 
<pre><code>sudo vim /etc/xrdp/startwm.sh
在上面文件中添加

unset DBUS_SESSION_BUS_ADDRESS
unset XDG_RUNTIME_DIR
</code></pre> 
<p>添加位置如下图：</p> 
<p><img src="https://images2.imgbox.com/c6/81/nOMMJzVo_o.png" alt=""></p> 
<p>重启 xrdp</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">service</span> xrdp restart

<span class="token comment">#没效果就用下面的命令：</span>
<span class="token function">sudo</span> /etc/init.d/xrdp restart
</code></pre> 
<h5><a id="692__1663"></a>6.9.2 进入图形界面一段时间后黑屏</h5> 
<p>进入图形界面，点击右上角Applications—&gt;Settings—&gt;Light Locker Settings。</p> 
<p>设置 Automatically lock the session 为 Never。</p> 
<p><img src="https://images2.imgbox.com/50/d2/aynQY0N2_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/38/28/5mUTjWq6_o.png" alt=""></p> 
<h5><a id="693_xrdp_mm_process_login_response_login_failed_1673"></a>6.9.3 运行一段时间后，出现xrdp_mm_process_login_response: login failed</h5> 
<p>问题原因：远程桌面没有正确关闭，虽然在windows 系统关闭远程桌面连接，但是在里linux上的进程还在运行，导致连接数量达到上限，出现问题。</p> 
<p>解决：通过设置 sesman.in 文件内的参数，解决。</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/xrdp/sesman.ini
</code></pre> 
<p>可以修改会话设置 ：将最大会话限制该大 MaxSessions=50<br> 将KillDisconnected=1；则每次断开连接时，linux都会关闭会话进程。</p> 
<p>然后重启/etc/init.d/xrdp restart 就可解决问题</p> 
<h4><a id="610__1688"></a>6.10 安装软件</h4> 
<p><strong>再次提醒先设置好 apt 源，可以手动修改文件，或者从图形界面的设置中进行设置</strong></p> 
<h5><a id="611_Chrome_1692"></a>6.11 安装Chrome</h5> 
<blockquote> 
 <p>可以直接从软件市场中下载</p> 
</blockquote> 
<p>这种比较方便</p> 
<blockquote> 
 <p><strong>命令行安装</strong></p> 
</blockquote> 
<ol><li> <p>为Google Chrome浏览器创建源列表文件</p> <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/apt/sources.list.d/google-chrome.list
</code></pre> </li><li> <p>添加源</p> <pre><code class="prism language-bash">deb <span class="token punctuation">[</span>arch<span class="token operator">=</span>amd64<span class="token punctuation">]</span> http://dl.google.com/linux/chrome/deb/ stable main
</code></pre> </li><li> <p>运行以下命令以下载Google的签名密钥</p> <pre><code class="prism language-bash"><span class="token function">wget</span> https://dl.google.com/linux/linux_signing_key.pub
</code></pre> </li><li> <p>使用apt-key将其添加到密钥环中，以便包管理器可以验证Google Chrome deb包的完整性</p> <pre><code class="prism language-bash"><span class="token function">sudo</span> apt-key <span class="token function">add</span> linux_signing_key.pub
</code></pre> </li><li> <p>更新包列表并安装稳定版Google Chrome</p> <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update

<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> google-chrome-stable
</code></pre> </li><li> <p>从命令行启动Chrome浏览器</p> <pre><code class="prism language-bash">google-chrome-stable

如果提示Running as root without --no-sandbox is not supported.
这是因为当前是root用户下安装的，所以无法打开，而非root用户上启动下，肯定能启动起来。

可以在启动命令后增加“–no-sandbox”
/usr/bin/google-chrome-stable –no-sandbox

如果不想一直使用命令启动，可以在 /usr/share/applications中找到Chrome的快捷方式，然后右键在其properties中command中增加”–no-sandbox”即可。从此以后，就可以直接在Search中找到Chrome进行启动了，或者将快捷方法发送到桌面来启动。
</code></pre> </li></ol> 
<h3><a id="UbuntuSSH_1746"></a>七、Ubuntu配置远程SSH登录</h3> 
<p>局域网电脑如果想远程连接另一台Windows电脑上的WSL2 Ubuntu，网络需要经过PC1 -&gt; PC2(Windows)-&gt;PC2(WSL2-Ubuntu)。所以需要经过三个步骤：</p> 
<ol><li>WSL的Ubuntu安装ssh-server</li><li>设置Windows主机的端口转发</li><li>开启Windows防火墙端口规则</li></ol> 
<h4><a id="71_WSLUbuntusshserver_1754"></a>7.1 WSL的Ubuntu安装ssh-server</h4> 
<p>WSL2下的Ubuntu默认是支持SSH的，支持默认不被开启。需要开启的，需要手动编辑下SSH服务的配置文件。</p> 
<p>首先查询一下是否已经安装openssh-server（一般默认已经安装了）</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openssh-server
</code></pre> 
<p>然后修改Ubuntu子系统 <code>/etc/ssh/sshd_config</code> 配置文件</p> 
<pre><code>vi /etc/ssh/sshd_config
</code></pre> 
<p>进入之后，修改如下几行配置</p> 
<ul><li><code>Port = 22</code> 去掉这行的#，代表启用端口号22</li><li><code>ListenAddress 0.0.0.0</code> 去掉这行的#，代表监听所有地址</li><li><code>PasswordAuthentication yes</code>，将这行的 <strong>no</strong> 改成 <strong>yes</strong>，代表支持账号密码形式的登录</li><li><code>#PermitRootLogin prohibit-password</code> 意思是允许root登录，但是禁止root用密码登录，所以保持默认，保留这行的#注释。</li><li>新增一行<code>PermitRootLogin yes</code>，默认情况下，root用户只支持用RSA登录，所以需要修改配置</li></ul> 
<p><img src="https://images2.imgbox.com/e2/d9/7hvdn6sA_o.png" alt=""></p> 
<p>设置后，重新启动ssh服务。在Ubuntu子系统中，执行以下命令</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">ssh</span> --full-restart
</code></pre> 
<p>如果 <code>ubuntu</code> 下重新启动ssh服务 <code>sudo service ssh restart</code>，报如下错误：</p> 
<pre><code class="prism language-shell">root@LAPTOP-LHBT0GVK:/etc/ssh<span class="token comment"># service ssh restart</span>
sshd: no hostkeys available -- exiting.
</code></pre> 
<p><strong>解决方法</strong></p> 
<p>在 /etc/ssh 路径下输入</p> 
<pre><code class="prism language-shell">ssh-keygen <span class="token parameter variable">-A</span>
/etc/init.d/ssh start     <span class="token comment">#完成</span>
</code></pre> 
<h4><a id="72_Windows_1802"></a>7.2 设置Windows主机的端口转发</h4> 
<p>安装完重启后，可以使用Windows主机内的shell工具，进行连接测试。首先查询WSL2-Ubuntu的虚拟网卡地址：</p> 
<pre><code class="prism language-shell"><span class="token function">ifconfig</span>
或者
<span class="token function">ip</span> addr
</code></pre> 
<p><img src="https://images2.imgbox.com/90/88/sJOlYYv7_o.png" alt=""></p> 
<p>如上图的虚拟网卡地址为172.22.3.120， 所以在Windows的ssh工具的关键信息如下：</p> 
<pre><code class="prism language-text">连接地址：172.22.3.120
账户：*User*（Ubuntu的用户名）
密码：*Password*（Ubuntu的用户密码）
端口号：22
</code></pre> 
<p><strong>Windows</strong> 自带网络工具 <code>netsh</code>，通过 <code>netsh</code> 可以配置将网络监听到的固定IP地址的固定端口号数据，转发到其他地址。在此会将本机的2222端口转发到WSL2-Ubuntu中为例（Windows本机选用2222的目的是，预留默认的22端口，防止以后其他功能发生冲突），因此按照目前的搭建需求，需要将0.0.0.0:2222的数据转发到172.22.3.120:22。</p> 
<p><strong>以管理员权限启动PowerShell</strong>，输入以下命令：</p> 
<pre><code class="prism language-powershell">netsh interface portproxy add v4tov4 listenaddress=0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0 listenport=2222 connectaddress=172<span class="token punctuation">.</span>22<span class="token punctuation">.</span>3<span class="token punctuation">.</span>120 connectport=22
</code></pre> 
<p>参数说明：</p> 
<pre><code class="prism language-text">标记值listenport：IPv4 侦听端口。
connectaddress：1IPv4 连接地址，这里是2222。
connectport：IPv4 连接端口，这里是172.22.3.120。
listenaddress： IPv4 侦听地址，这里是22。
protocol： 使用的协议。现在只支持 TCP。
说明: 添加通过 IPV4 的 IP4 和代理连接到的侦听项目
</code></pre> 
<p>执行完成后，调用下面命令查看：</p> 
<pre><code class="prism language-powershell">netsh interface portproxy show all
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/c7/9wdCM1VC_o.png" alt=""></p> 
<h4><a id="73_Windows_1850"></a>7.3 设置Windows防火墙端口规则</h4> 
<p>防火墙的设置规则，同样使用netsh工具，也同样需要管理员权限运行PowerShell。</p> 
<pre><code class="prism language-powershell">netsh advfirewall firewall add rule name=WSL2 <span class="token function">dir</span>=in action=allow protocol=TCP localport=2222
</code></pre> 
<p>（也可以在防火墙-高级设置-入站规则中设置）</p> 
<p>连接测试：</p> 
<pre><code class="prism language-text">连接地址：xx.xx.xx.xx(运行WSL的Windows主机地址)
账户：*User*（WSL-Ubuntu的用户名）
密码：*Password*（WSL-Ubuntu的用户密码）
端口号：2222（因为本文使用了2222端口，如果设置为其他，注意修改）
</code></pre> 
<p>完成以上即可连接成功。</p> 
<p>如果需要通过公网进行远程ssh连接到WSL，也是可以的，需要在局域网中实现内网穿透。在原有的网络通路加入NAT方法即可，如PC1 -&gt; NAT -&gt; PC2(Windows)-&gt; PC2(WSL2-Ubuntu)</p> 
<h3><a id="_1873"></a>八、问题</h3> 
<ul><li> <p>参考的对象类型不支持尝试的操作。 Error code: Wsl/Service/0x8007273d [已退出]</p> <p>问题原因：<code>Proxifer</code>开发人员解释，原因是<code>Winsock LSP DLL</code> 被加载到其进程中，则wsl.exe将显示此错误。最简单的解决方案是对wsl.exe使用<code>WSCSetApplicationCategory WinAPI</code> 调用来防止这种情况。这会在注册表<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WinSock2\Parameters\AppId_Catalog</code>中为 <code>wsl.exe</code> 创建一条记录，这将告诉Windows不要将<code>LSP DLL</code>加载到 <code>wsl.exe</code> 进程中。</p> <p>解决步骤：</p> <p>方法一临时方案：（每次应用商店 Microsoft Store 版本 WSL 更新时，都会导致这个问题）</p> <p>以管理员身份打开”<strong>Windows PowerShell</strong>“，然后执行 <code>netsh winsock reset</code>，然后继续操作（如果还是不行，重启电脑即可）（操作前记得备份数据，因为可能会丢失docker的镜像容器数据）（已验证确实可以）</p> <p>方法二<strong>永久方案</strong>：</p> <p>1.先下载nolsp.exe，下载地址1：https://wtto00.github.io/cdn/windows/nolsp.exe，下载地址2：https://files.cnblogs.com/files/turingguo/NoLsp.zip</p> <p>2.然后<strong>管理员身份</strong>打开 <code>powershell</code></p> <pre><code class="prism language-shell"><span class="token comment"># 打开nolsp.exe所在目录</span>
<span class="token builtin class-name">cd</span> E:<span class="token punctuation">\</span>Downloads<span class="token punctuation">\</span>Other<span class="token punctuation">\</span>nolsp.exe

<span class="token comment"># 执行下面命令</span>
<span class="token comment"># 该步骤就相当于添加注册表。</span>
<span class="token comment"># 注意：这里的wsl.exe必须是全路径，不能是相对路径</span>
.<span class="token punctuation">\</span>nolsp.exe C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>wsl.exe

<span class="token comment"># 提示Success!，则操作成功，再打开wsl2 就可以了</span>

<span class="token comment"># -----------------------------</span>
<span class="token comment"># 如果上述命令不行，可以换成下面的命令</span>
.<span class="token punctuation">\</span>nolsp.exe <span class="token string">"C:\Program Files\WindowsApps\MicrosoftCorporationII.WindowsSubsystemForLinux_1.1.2.0_x64__8wekyb3d8bbwe\wsl.exe"</span>
.<span class="token punctuation">\</span>nolsp.exe <span class="token string">"C:\Program Files\WindowsApps\MicrosoftCorporationII.WindowsSubsystemForLinux_1.1.2.0_x64__8wekyb3d8bbwe\wslservice.exe"</span>
<span class="token comment"># 注意：这里的wsl.exe以及wslservice.exe，必须是全路径，不能是相对路径。(全路径地址，大家自行查询)</span>
</code></pre> <p><strong>这样就可以永久有效了，再也不会报错了！</strong></p> <p>可以打开注册表regedit，找到<code>\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WinSock2\Parameters\AppId_Catalog</code>，依次点击此目录的各项，可以找到该注册信息</p> <p><img src="https://images2.imgbox.com/d7/ad/rwnj0Dli_o.png" alt=""></p> <p>至此，就可以打开wsl了。</p> <p><strong>如果商店 Microsoft Store 版本 WSL 更新了，需要重新执行一遍此流程</strong></p> <p>参考链接：<br> <a href="https://blog.csdn.net/qq_42361881/article/details/121500438">win10启动ubuntu报错 参考的对象类型不支持尝试的操作_Chivalrous Expert的博客-CSDN博客</a></p> <p><a href="https://github.com/microsoft/WSL/issues/4177">Winsock 模块中断 WSL2 ·期刊 #4177 ·微软/WSL ·GitHub的</a></p> </li><li> <p>提示：在此 WSL 2 发行版中找不到命令“docker”。我们建议在 Docker 桌面设置中激活 WSL 集成。</p> <p>有关将 Docker Desktop 与 WSL 2 结合使用的详细信息，请访问：</p> <p>https://docs.docker.com/go/wsl2/</p> <p>我已经访问了该链接并按照它提供的所有说明进行操作，从而启用 WSL 与 Ubuntu 的集成，如下所示：</p> <p><img src="https://images2.imgbox.com/f7/62/M2hbzIbu_o.png" alt=""></p> <p>但是收到的错误仍然是一样的。</p> <p>问题原因：不知道什么原因，导致 <code>/usr/bin/docker</code> 是个空目录</p> <p>解决步骤：查看<code>/usr/bin/docker</code>是不是一个空目录，先删除掉，然后在Docker Desktop 重新设置一下就好</p> <pre><code class="prism language-shell"><span class="token comment"># 查看</span>
<span class="token function">ls</span> <span class="token parameter variable">-l</span> /usr/bin
</code></pre> <p>下图是正常情况（都是软连接）。</p> <p><img src="https://images2.imgbox.com/3e/22/xKDa5UEM_o.png" alt=""></p> </li></ul> 
<h3><a id="WSl__1953"></a>九、WSl 命令参考</h3> 
<p>命令行官方文档：https://docs.microsoft.com/zh-cn/windows/wsl/basic-commands</p> 
<p>以下基本的 WSL 命令以 PowerShell 或 Windows 命令提示符支持的格式列出。 若要通过 Bash/Linux 发行版命令行运行这些命令，必须将 <code>wsl</code> 替换为 <code>wsl.exe</code>。</p> 
<ul><li> <p>列出已安装的 Linux 发行版</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>list <span class="token operator">--</span>verbose
或者
wsl <span class="token operator">-</span>l <span class="token operator">-</span>v

其他选项包括：
<span class="token operator">--</span>all（列出所有发行版）
<span class="token operator">--</span>running（仅列出当前正在运行的发行版）
<span class="token operator">--</span>quite（仅显示发行版名称）。
</code></pre> </li><li> <p>列出可用的 Linux 发行版</p> <p>查看可通过在线商店获得的 Linux 发行版列表。</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>list <span class="token operator">--</span>online
或者
wsl <span class="token operator">-</span>l <span class="token operator">-</span>o
</code></pre> </li><li> <p>设置默认 WSL 版本</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version &lt;Version&gt;
</code></pre> <p>若要将默认版本设置为 WSL 1 或 WSL 2，请将 <code>&lt;Version&gt;</code> 替换为数字 1 或 2，表示对于安装新的 Linux 发行版，你希望默认使用哪个版本的 WSL。 例如，<code>wsl --set-default-version 2</code>。</p> </li><li> <p>设置 WSL 版本</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-version</span> &lt;distribution name&gt; &lt;versionNumber&gt;
</code></pre> <p>若要指定运行 Linux 发行版的 WSL 版本（1 或 2），请将 <code>&lt;distribution name&gt;</code> 替换为发行版的名称，并将 <code>&lt;versionNumber&gt;</code> 替换为 1 或 2。</p> </li><li> <p>设置默认 Linux 发行版</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span><span class="token function">set-default</span> &lt;Distribution Name&gt;
或者
wsl <span class="token operator">-</span>s &lt;Distribution Name&gt;
</code></pre> <p>若要设置 WSL 命令将用于运行的默认 Linux 发行版，请将 <code>&lt;Distribution Name&gt;</code> 替换为你首选的 Linux 发行版的名称。</p> </li><li> <p>通过 PowerShell 或 CMD 运行特定的 Linux 发行版</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>distribution &lt;Distribution Name&gt; <span class="token operator">--</span>user &lt;User Name&gt;
</code></pre> <p>若要通过特定用户运行特定 Linux 发行版，请将 <code>&lt;Distribution Name&gt;</code> 替换为你首选的 Linux 发行版的名称（例如 Debian），将 <code>&lt;User Name&gt;</code> 替换为现有用户的名称（例如 root）。 如果 WSL 发行版中不存在该用户，你将会收到一个错误。 若要输出当前用户名，请使用 <code>whoami</code> 命令。</p> </li><li> <p>更新 WSL</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>update
</code></pre> <p>手动更新 WSL Linux 内核的版本。 还可以使用 <code>wsl --update rollback</code> 命令回滚到 WSL Linux 内核的上一版本。</p> </li><li> <p>检查 WSL 状态</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>status
</code></pre> <p>查看有关 WSL 配置的常规信息，例如默认发行版类型、默认发行版和内核版本。</p> </li><li> <p>Help 命令</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>help
</code></pre> <p>查看 WSL 中可用的选项和命令列表。</p> </li><li> <p>主目录</p> <pre><code class="prism language-powershell">wsl ~
</code></pre> <p><code>~</code> 可与 wsl 一起使用，以在用户的主目录中启动。 若要在 WSL 命令提示符中从任何目录跳回到主目录，可使用命令 <code>cd ~</code>。</p> </li><li> <p>关闭</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>shutdown
</code></pre> <p>立即终止所有正在运行的发行版和 WSL 2 轻量级实用工具虚拟机。 在需要重启 WSL 2 虚拟机环境的情形下，例如<a href="https://docs.microsoft.com/zh-cn/windows/wsl/vhd-size" rel="nofollow">更改内存使用限制</a>或更改 <a href="https://docs.microsoft.com/zh-cn/windows/wsl/manage#" rel="nofollow">.wslconfig 文件</a>，可能必须使用此命令。</p> </li><li> <p>启动</p> <pre><code class="prism language-shell">wsl
</code></pre> </li><li> <p>Terminate</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>terminate &lt;Distribution Name&gt;
</code></pre> <p>若要终止指定的发行版或阻止其运行，请将 <code>&lt;Distribution Name&gt;</code> 替换为目标发行版的名称。</p> </li><li> <p>注销或卸载 Linux 发行版</p> <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>unregister &lt;Distribution Name&gt;
</code></pre> <p>通过将 <code>&lt;Distribution Name&gt;</code> 替换为目标发行版的名称，注销或卸载特定发行版。 这会从 WSL 中删除此发行版，并删除所有关联的数据、设置和软件。 还可以像卸载任何其他应用商店应用程序一样卸载 Windows 计算机上的 Linux 发行版应用。</p> </li></ul> 
<h3><a id="_2078"></a>参考链接</h3> 
<p><a href="https://zhuanlan.zhihu.com/p/61542198" rel="nofollow">【WSL+Docker】新手Win10下的WSL Ubuntu18并使用Docker（两种方式）</a></p> 
<p><a href="https://blog.csdn.net/sandonz/article/details/120854876">WSL（Ubuntu20.04）与其图形界面安装配置</a></p> 
<p><a href="https://autoize.com/xfce4-desktop-environment-and-x-server-for-ubuntu-on-wsl-2/" rel="nofollow">用于 WSL 2 上的 Ubuntu 的 Xfce4 桌面环境和 X 服务器</a></p> 
<h3><a id="_2086"></a>文章更新日志</h3> 
<ul><li>2023-11-06 补充可能遇到的问题（解决 wsl 突然不可用问题）</li><li>2023-03-31 补充Ubuntu22.04配置远程SSH登录</li><li>2022-10-19 补充安装Ubuntu22.04版本遇到的问题</li><li>2022-03-03 为每个软件环境安装，增加自定义方案。优化文章结构，更新软件版本变动</li><li>2021-05-08 编写文章</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/58f5bb98196811c8e9af8584831a7e05/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">工具类xxxUtil从application.properties中读取参数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/76ce348d077602eb4377eaf515c083fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTML5&#43;CSS3实现小米商城（完整）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>