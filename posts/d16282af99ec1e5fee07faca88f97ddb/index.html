<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>tensorflow2 训练和预测使用不同的输出层、获取权重参数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="tensorflow2 训练和预测使用不同的输出层、获取权重参数" />
<meta property="og:description" content="目标： youtubeNet通过训练tensorflow2时设置不同的激活函数，训练和预测采用不同的分支，然后可以在训练和测试时，把模型进行分离，得到训练和预测时，某些层的参数不同。可以通过类似迁移学习的办法实现。
第二，获取训练模型的参数。
获取模型参数： 比较简单，就是调用model.get_weights()。也可以用精确定位到某层，得到 w_dense4 =model.get_layer(&#39;dense4&#39;).get_weights()
#获取训练后的权重参数
weigts_parm = model.get_weights()
获得的就是模型参数的每一层权重和偏置信息。
模型不同输出： 想不到更好办法，利用迁移学习的办法，如果模型天生支持判断是预测阶段还是预测阶段，就更好了。
原理就是：
模型构建时，先构建一个分支，一个用于训练train。把要替换的层或者激活函数单独拧出来。利用模型打包compile时，把train都包含进模型。利用train=train，这样训练还是用到训练参数。预测时，单独新建一个model，去接收之前model某层的输出。添加上自己想要的层，如果需要重新训练，则重新compile，如果不想再训练，直接predict就好了。
由于预测的那个分支没有经过训练，所以一般只适用于对最后输出层，采用了不同的输出函数，比如YouTube推荐模型，输出层训练时用得weighted LR，而预测时用了e^x 激活函数，这种方式就能实现训练时用一个激活函数，预测时用另一个激活函数。 import tensorflow as tf import os import pandas as pd # 读取数据集 (train_images, train_labels), (test_images, test_labels) = tf.keras.datasets.fashion_mnist.load_data() # 数据集归一化,注意softmax输出的分类labels不用归一化 train_images = train_images / 255 test_images = test_images / 255 # 创建模型结构 net_input=tf.keras.Input(shape=(28,28)) fl=tf.keras.layers.Flatten(name=&#39;flatten&#39;)(net_input)#调用input l1=tf.keras.layers.Dense(128,activation=&#34;relu&#34;,name=&#39;dense1&#39;)(fl) d1=tf.keras.layers.Dense(64,activation=&#34;relu&#34;,name=&#39;dense2&#39;)(l1) l2=tf.keras.layers.Dense(32,activation=&#34;relu&#34;,name=&#39;dense3&#39;)(d1) l3=tf.keras.layers.Dense(10,activation=None,name=&#39;dense4&#39;)(l2) output=tf.keras.activations.softmax(l3) # 创建模型类 model = tf.keras.Model(inputs=net_input, outputs=output) # 查看模型的结构 model.summary() # 模型编译 model." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d16282af99ec1e5fee07faca88f97ddb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-19T15:06:17+08:00" />
<meta property="article:modified_time" content="2021-12-19T15:06:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">tensorflow2 训练和预测使用不同的输出层、获取权重参数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>目标：</h2> 
<p><font color="#999AAA">youtubeNet通过训练tensorflow2时设置不同的激活函数，训练和预测采用不同的分支，然后可以在训练和测试时，把模型进行分离，得到训练和预测时，某些层的参数不同。可以通过类似迁移学习的办法实现。<br> 第二，获取训练模型的参数。</font></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_6"></a>获取模型参数：</h2> 
<font color="#999AAA"> 比较简单，就是调用model.get_weights()。也可以用精确定位到某层，得到 </font> 
<p><code>w_dense4 =model.get_layer('dense4').get_weights()</code></p> 
<p>#获取训练后的权重参数<br> weigts_parm = model.get_weights()<br> 获得的就是模型参数的每一层权重和偏置信息。</p> 
<hr color="#000000" size='1"'> 
<h2><a id="_19"></a>模型不同输出：</h2> 
<p><font color="#999AAA">想不到更好办法，利用迁移学习的办法，如果模型天生支持判断是预测阶段还是预测阶段，就更好了。<br> 原理就是：</font></p> 
<ul><li>模型构建时，先构建一个分支，一个用于训练train。</li><li>把要替换的层或者激活函数单独拧出来。</li><li>利用模型打包compile时，把train都包含进模型。</li><li>利用train=train，这样训练还是用到训练参数。</li><li>预测时，单独新建一个model，去接收之前model某层的输出。</li><li>添加上自己想要的层，如果需要重新训练，则重新compile，如果不想再训练，直接predict就好了。<br> 由于预测的那个分支没有经过训练，所以一般只适用于对最后输出层，采用了不同的输出函数，比如YouTube推荐模型，输出层训练时用得weighted LR，而预测时用了e^x 激活函数，这种方式就能实现训练时用一个激活函数，预测时用另一个激活函数。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 读取数据集</span>
<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>fashion_mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 数据集归一化,注意softmax输出的分类labels不用归一化</span>
train_images <span class="token operator">=</span> train_images <span class="token operator">/</span> <span class="token number">255</span>
test_images <span class="token operator">=</span> test_images <span class="token operator">/</span> <span class="token number">255</span>

<span class="token comment"># 创建模型结构</span>
net_input<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fl<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'flatten'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>net_input<span class="token punctuation">)</span><span class="token comment">#调用input</span>
l1<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">"relu"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dense1'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>fl<span class="token punctuation">)</span>
d1<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">"relu"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dense2'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span>
l2<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">"relu"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dense3'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
l3<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dense4'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span>
output<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>activations<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>l3<span class="token punctuation">)</span>
<span class="token comment"># 创建模型类</span>
model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>net_input<span class="token punctuation">,</span> outputs<span class="token operator">=</span>output<span class="token punctuation">)</span>

<span class="token comment"># 查看模型的结构</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 模型编译</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              loss<span class="token operator">=</span><span class="token string">"sparse_categorical_crossentropy"</span><span class="token punctuation">,</span>
              metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">,</span><span class="token string">'mse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 模型训练</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> validation_split<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token comment">#获取训练后的权重参数</span>
weigts_parm <span class="token operator">=</span> model<span class="token punctuation">.</span>get_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>weigts_parm<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#12</span>
model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_images<span class="token punctuation">,</span>test_labels<span class="token punctuation">)</span>
weigt_dense3 <span class="token operator">=</span> weigts_parm<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>

weigt_dense3_embedding <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>weigt_dense3<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weigt_dense3_embedding<span class="token punctuation">)</span>

predicts <span class="token operator">=</span>model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_images<span class="token punctuation">)</span>

<span class="token comment">#another_model</span>
<span class="token comment"># inputs=model.input</span>
out1 <span class="token operator">=</span> model<span class="token punctuation">.</span>get_layer<span class="token punctuation">(</span><span class="token string">'dense3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>output
out <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'mydense1'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>out1<span class="token punctuation">)</span>
out <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'mydense2'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
mylogits <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'my_logit'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>

predict_model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>model<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">,</span>outputs<span class="token operator">=</span>mylogits<span class="token punctuation">)</span>
predict_model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>sparse_categorical_crossentropy<span class="token punctuation">,</span>
                      optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span>metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">,</span><span class="token string">'mse'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>predict_model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
predict_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> validation_split<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
predicts_2 <span class="token operator">=</span> predict_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_images<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> predicts_2<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(predicts_2)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>test_labels<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python">Model<span class="token punctuation">:</span> <span class="token string">"model"</span>
_________________________________________________________________
Layer <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span>                 Output Shape              Param <span class="token comment">#   </span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
input_1 <span class="token punctuation">(</span>InputLayer<span class="token punctuation">)</span>         <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">]</span>          <span class="token number">0</span>         
_________________________________________________________________
flatten <span class="token punctuation">(</span>Flatten<span class="token punctuation">)</span>            <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">784</span><span class="token punctuation">)</span>               <span class="token number">0</span>         
_________________________________________________________________
dense1 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>               <span class="token number">100480</span>    
_________________________________________________________________
dense2 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>                <span class="token number">8256</span>      
_________________________________________________________________
dense3 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>                <span class="token number">2080</span>      
_________________________________________________________________
dense4 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                <span class="token number">330</span>       
_________________________________________________________________
tf<span class="token punctuation">.</span>compat<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax <span class="token punctuation">(</span>TFO <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                <span class="token number">0</span>         
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Total params<span class="token punctuation">:</span> <span class="token number">111</span><span class="token punctuation">,</span><span class="token number">146</span>
Trainable params<span class="token punctuation">:</span> <span class="token number">111</span><span class="token punctuation">,</span><span class="token number">146</span>
Non<span class="token operator">-</span>trainable params<span class="token punctuation">:</span> <span class="token number">0</span>
_________________________________________________________________
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">29.354023</span><span class="token punctuation">:</span> I tensorflow<span class="token operator">/</span>compiler<span class="token operator">/</span>mlir<span class="token operator">/</span>mlir_graph_optimization_pass<span class="token punctuation">.</span>cc<span class="token punctuation">:</span><span class="token number">176</span><span class="token punctuation">]</span> <span class="token boolean">None</span> of the MLIR Optimization Passes are enabled <span class="token punctuation">(</span>registered <span class="token number">2</span><span class="token punctuation">)</span>
Epoch <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">30.006144</span><span class="token punctuation">:</span> I tensorflow<span class="token operator">/</span>stream_executor<span class="token operator">/</span>platform<span class="token operator">/</span>default<span class="token operator">/</span>dso_loader<span class="token punctuation">.</span>cc<span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">]</span> Successfully opened dynamic library cublas64_11<span class="token punctuation">.</span>dll
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">30.563964</span><span class="token punctuation">:</span> I tensorflow<span class="token operator">/</span>stream_executor<span class="token operator">/</span>platform<span class="token operator">/</span>default<span class="token operator">/</span>dso_loader<span class="token punctuation">.</span>cc<span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">]</span> Successfully opened dynamic library cublasLt64_11<span class="token punctuation">.</span>dll
<span class="token number">1080</span><span class="token operator">/</span><span class="token number">1080</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 7s 5ms<span class="token operator">/</span>step <span class="token operator">-</span> loss<span class="token punctuation">:</span> <span class="token number">0.5380</span> <span class="token operator">-</span> acc<span class="token punctuation">:</span> <span class="token number">0.8104</span> <span class="token operator">-</span> mse<span class="token punctuation">:</span> <span class="token number">27.6815</span> <span class="token operator">-</span> val_loss<span class="token punctuation">:</span> <span class="token number">0.3976</span> <span class="token operator">-</span> val_acc<span class="token punctuation">:</span> <span class="token number">0.8528</span> <span class="token operator">-</span> val_mse<span class="token punctuation">:</span> <span class="token number">27.5902</span>
Epoch <span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token number">1080</span><span class="token operator">/</span><span class="token number">1080</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 5s 5ms<span class="token operator">/</span>step <span class="token operator">-</span> loss<span class="token punctuation">:</span> <span class="token number">0.3796</span> <span class="token operator">-</span> acc<span class="token punctuation">:</span> <span class="token number">0.8623</span> <span class="token operator">-</span> mse<span class="token punctuation">:</span> <span class="token number">27.6900</span> <span class="token operator">-</span> val_loss<span class="token punctuation">:</span> <span class="token number">0.3787</span> <span class="token operator">-</span> val_acc<span class="token punctuation">:</span> <span class="token number">0.8628</span> <span class="token operator">-</span> val_mse<span class="token punctuation">:</span> <span class="token number">27.5929</span>
<span class="token number">8</span>
<span class="token number">313</span><span class="token operator">/</span><span class="token number">313</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 2s 5ms<span class="token operator">/</span>step <span class="token operator">-</span> loss<span class="token punctuation">:</span> <span class="token number">0.3998</span> <span class="token operator">-</span> acc<span class="token punctuation">:</span> <span class="token number">0.8566</span> <span class="token operator">-</span> mse<span class="token punctuation">:</span> <span class="token number">27.6816</span>
         <span class="token number">0</span>         <span class="token number">1</span>         <span class="token number">2</span>   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token number">29</span>        <span class="token number">30</span>        <span class="token number">31</span>
<span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.287471</span>  <span class="token number">0.036533</span> <span class="token operator">-</span><span class="token number">0.127725</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token number">0.234849</span>  <span class="token number">0.014998</span>  <span class="token number">0.068000</span>
<span class="token number">1</span> <span class="token operator">-</span><span class="token number">0.109836</span> <span class="token operator">-</span><span class="token number">0.223555</span> <span class="token operator">-</span><span class="token number">0.400632</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.338368</span> <span class="token operator">-</span><span class="token number">0.307823</span> <span class="token operator">-</span><span class="token number">0.406235</span>
<span class="token number">2</span> <span class="token operator">-</span><span class="token number">0.094260</span> <span class="token operator">-</span><span class="token number">0.186713</span> <span class="token operator">-</span><span class="token number">0.101085</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.025677</span>  <span class="token number">0.120322</span>  <span class="token number">0.028206</span>
<span class="token number">3</span> <span class="token operator">-</span><span class="token number">0.386172</span>  <span class="token number">0.152541</span> <span class="token operator">-</span><span class="token number">0.527324</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.248855</span> <span class="token operator">-</span><span class="token number">0.129524</span> <span class="token operator">-</span><span class="token number">0.235581</span>
<span class="token number">4</span> <span class="token operator">-</span><span class="token number">0.201059</span> <span class="token operator">-</span><span class="token number">0.341049</span> <span class="token operator">-</span><span class="token number">0.474235</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.021036</span>  <span class="token number">0.152996</span>  <span class="token number">0.161320</span>
<span class="token number">5</span> <span class="token operator">-</span><span class="token number">0.174123</span>  <span class="token number">0.459365</span> <span class="token operator">-</span><span class="token number">0.005071</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token number">0.244765</span>  <span class="token number">0.244738</span>  <span class="token number">0.067327</span>
<span class="token number">6</span>  <span class="token number">0.330713</span>  <span class="token number">0.066037</span> <span class="token operator">-</span><span class="token number">0.465473</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.378929</span> <span class="token operator">-</span><span class="token number">0.101122</span>  <span class="token number">0.235503</span>
<span class="token number">7</span>  <span class="token number">0.242240</span>  <span class="token number">0.199673</span>  <span class="token number">0.010125</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.217853</span>  <span class="token number">0.255141</span> <span class="token operator">-</span><span class="token number">0.057792</span>
<span class="token number">8</span> <span class="token operator">-</span><span class="token number">0.140202</span> <span class="token operator">-</span><span class="token number">0.248611</span> <span class="token operator">-</span><span class="token number">0.405854</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">0.030497</span>  <span class="token number">0.384872</span>  <span class="token number">0.019411</span>
<span class="token number">9</span> <span class="token operator">-</span><span class="token number">0.133955</span>  <span class="token number">0.261924</span>  <span class="token number">0.068150</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token number">0.404557</span>  <span class="token number">0.171754</span>  <span class="token number">0.072854</span>

<span class="token punctuation">[</span><span class="token number">10</span> rows x <span class="token number">32</span> columns<span class="token punctuation">]</span>
Model<span class="token punctuation">:</span> <span class="token string">"model_1"</span>
_________________________________________________________________
Layer <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span>                 Output Shape              Param <span class="token comment">#   </span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
input_1 <span class="token punctuation">(</span>InputLayer<span class="token punctuation">)</span>         <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">]</span>          <span class="token number">0</span>         
_________________________________________________________________
flatten <span class="token punctuation">(</span>Flatten<span class="token punctuation">)</span>            <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">784</span><span class="token punctuation">)</span>               <span class="token number">0</span>         
_________________________________________________________________
dense1 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>               <span class="token number">100480</span>    
_________________________________________________________________
dense2 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>                <span class="token number">8256</span>      
_________________________________________________________________
dense3 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>               <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>                <span class="token number">2080</span>      
_________________________________________________________________
mydense1 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>             <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>               <span class="token number">4224</span>      
_________________________________________________________________
mydense2 <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>             <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>                <span class="token number">8256</span>      
_________________________________________________________________
my_logit <span class="token punctuation">(</span>Dense<span class="token punctuation">)</span>             <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                <span class="token number">650</span>       
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Total params<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span><span class="token number">946</span>
Trainable params<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span><span class="token number">946</span>
Non<span class="token operator">-</span>trainable params<span class="token punctuation">:</span> <span class="token number">0</span>
_________________________________________________________________
<span class="token boolean">None</span>
Epoch <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token number">1080</span><span class="token operator">/</span><span class="token number">1080</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 7s 6ms<span class="token operator">/</span>step <span class="token operator">-</span> loss<span class="token punctuation">:</span> <span class="token number">0.4096</span> <span class="token operator">-</span> acc<span class="token punctuation">:</span> <span class="token number">0.8584</span> <span class="token operator">-</span> mse<span class="token punctuation">:</span> <span class="token number">27.6896</span> <span class="token operator">-</span> val_loss<span class="token punctuation">:</span> <span class="token number">0.4016</span> <span class="token operator">-</span> val_acc<span class="token punctuation">:</span> <span class="token number">0.8642</span> <span class="token operator">-</span> val_mse<span class="token punctuation">:</span> <span class="token number">27.5922</span>
Epoch <span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token number">1080</span><span class="token operator">/</span><span class="token number">1080</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 6s 5ms<span class="token operator">/</span>step <span class="token operator">-</span> loss<span class="token punctuation">:</span> <span class="token number">0.3320</span> <span class="token operator">-</span> acc<span class="token punctuation">:</span> <span class="token number">0.8794</span> <span class="token operator">-</span> mse<span class="token punctuation">:</span> <span class="token number">27.6930</span> <span class="token operator">-</span> val_loss<span class="token punctuation">:</span> <span class="token number">0.3711</span> <span class="token operator">-</span> val_acc<span class="token punctuation">:</span> <span class="token number">0.8647</span> <span class="token operator">-</span> val_mse<span class="token punctuation">:</span> <span class="token number">27.5948</span>
</code></pre> 
<p>对比打印两个模型的输出：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> predicts<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token keyword">for</span> i <span class="token keyword">in</span> predicts_2<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<hr color="#000000" size='1"'> 
<h2><a id="_184"></a>建议：</h2> 
<font color="#999AAA"> </font> 
<ul><li>1、获取模型某层的参数，常常就是embedding向量</li><li>2、模型的不同输出。采用迁移学习的办法。</li></ul> 
<p>有更好的办法可以提出。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b2600d3ba4dc51094c47ed3165e2d91d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ES6中的class类内容详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72351e80d83032d2c3679c9c15653d8e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[ERROR]: Action client not connected:***/arm_trajectory_controller</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>