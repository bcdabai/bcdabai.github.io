<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>awk命令详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="awk命令详解" />
<meta property="og:description" content="目录
一、awk概述
1.工作原理
2.语法格式
3.awk常用的内建变量
二、按行输出文本
1.输出所有内容
2.输出指定行号的内容
3.输出奇偶行内容
4.输出匹配行的行内容
二、按字段输出文本
1.输出指定字段
2.输出结果指定分隔符
2.1OFS指定输出结果分隔符
3.输出匹配字段的行内容
4.三元运算符
三、通过管道符、双引号调用shell命令
1.统计行数
2.查看当前内存使用百分比
3.查看当前cpu空闲率
4.显示系统上次重启时间
5.getline的使用
四、BEGIN，END模式
1.awk数组
2.过滤文本中重复行数
3.过滤访问本机密码输入失败的命令
一、awk概述 AWK是一种处理文本文件的语言，是一个强大的文件分析工具。
它是专门为文本处理设计的编程语言，也是行处理软件，通常用于扫描，过滤，统计汇总等工作，数据可以来自标准输入也可以是管道或文件。
1.工作原理 awk逐行读取文本，默认以空格或Tab键为分隔符进行分隔，将分隔所得的各个字段保存到内建变量中，并按模式或条件执行编辑命令。
与sed命令相比：
sed命令常用于一整行的处理。awk命令倾向于将一行分成多个“字段” 然后再进行处理。awk信息的读入是逐行读取的，执行结果可以通过 print 的功能将字段数据打印显示。在使用 awk 命令的过程中,可以使用逻辑操作符“&amp;&amp;”表示“与”，“||”表示“或”，“!”表示“非”；还可以进行简单的数学运算，如&#43;、-、*、/、%、^分别表示加、减、乘、除、取余和乘方。 2.语法格式 awk 选项 &#39;模式或条件 {操作}&#39; 文件1 文件2 awk -f 脚本文件 文件1 文件2 3.awk常用的内建变量 FS：列分隔符。指定每行文本的字段分隔符，默认为空格或制表位，与“ -F ”作用相同 OFS：输出分隔符。指定输出字段间的分隔符。 RS：行分隔符。awk从文件读取资料时，将根据RS的定义把资料切割为多条记录， awk一次仅读取一条记录，以进行处理，预设值为 \n (换行符) NF：当前处理行的字段个数 NR：当前处理行的行号 FNR：awk当前读取的记录数，其变量值小于等于NR （比如当读取第二个文件时，FNR是从0开始重新计数，而NR不会）。 NR==FNR：用于在读取两个或两个以上的文件时，判断是不是在读取第一个文件 $0：当前处理行的整行内容 $n：当前处理行的第 n 个字段（第 n 列） FILENAME：被处理的文件名 二、按行输出文本 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fb43226b47f76dc421ff9c0e72e09101/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-15T19:09:22+08:00" />
<meta property="article:modified_time" content="2023-05-15T19:09:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">awk命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81awk%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81awk%E6%A6%82%E8%BF%B0" rel="nofollow">一、awk概述</a></p> 
<p id="1.%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#1.%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">1.工作原理</a></p> 
<p id="2.%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F-toc" style="margin-left:40px;"><a href="#2.%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F" rel="nofollow">2.语法格式</a></p> 
<p id="%C2%A03.awk%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F-toc" style="margin-left:40px;"><a href="#%C2%A03.awk%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F" rel="nofollow"> 3.awk常用的内建变量</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%8C%89%E8%A1%8C%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%8C%89%E8%A1%8C%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC" rel="nofollow">二、按行输出文本</a></p> 
<p id="1.%E8%BE%93%E5%87%BA%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#1.%E8%BE%93%E5%87%BA%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9" rel="nofollow">1.输出所有内容</a></p> 
<p id="2.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E8%A1%8C%E5%8F%B7%E7%9A%84%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#2.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E8%A1%8C%E5%8F%B7%E7%9A%84%E5%86%85%E5%AE%B9" rel="nofollow">2.输出指定行号的内容</a></p> 
<p id="3.%E8%BE%93%E5%87%BA%E5%A5%87%E5%81%B6%E8%A1%8C%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#3.%E8%BE%93%E5%87%BA%E5%A5%87%E5%81%B6%E8%A1%8C%E5%86%85%E5%AE%B9" rel="nofollow">3.输出奇偶行内容</a></p> 
<p id="4.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E8%A1%8C%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#4.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E8%A1%8C%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9" rel="nofollow">4.输出匹配行的行内容</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%8C%89%E5%AD%97%E6%AE%B5%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%8C%89%E5%AD%97%E6%AE%B5%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC" rel="nofollow">二、按字段输出文本</a></p> 
<p id="1.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5-toc" style="margin-left:40px;"><a href="#1.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5" rel="nofollow">1.输出指定字段</a></p> 
<p id="2.%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%8C%87%E5%AE%9A%E5%88%86%E9%9A%94%E7%AC%A6-toc" style="margin-left:40px;"><a href="#2.%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%8C%87%E5%AE%9A%E5%88%86%E9%9A%94%E7%AC%A6" rel="nofollow">2.输出结果指定分隔符</a></p> 
<p id="2.1OFS%E6%8C%87%E5%AE%9A%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%88%86%E9%9A%94%E7%AC%A6-toc" style="margin-left:80px;"><a href="#2.1OFS%E6%8C%87%E5%AE%9A%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%88%86%E9%9A%94%E7%AC%A6" rel="nofollow">2.1OFS指定输出结果分隔符</a></p> 
<p id="3.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E5%AD%97%E6%AE%B5%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#3.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E5%AD%97%E6%AE%B5%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9" rel="nofollow">3.输出匹配字段的行内容</a></p> 
<p id="4.%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6-toc" style="margin-left:40px;"><a href="#4.%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6" rel="nofollow">4.三元运算符</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E7%AC%A6%E3%80%81%E5%8F%8C%E5%BC%95%E5%8F%B7%E8%B0%83%E7%94%A8shell%E5%91%BD%E4%BB%A4-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E7%AC%A6%E3%80%81%E5%8F%8C%E5%BC%95%E5%8F%B7%E8%B0%83%E7%94%A8shell%E5%91%BD%E4%BB%A4" rel="nofollow">三、通过管道符、双引号调用shell命令</a></p> 
<p id="1.%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0-toc" style="margin-left:40px;"><a href="#1.%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0" rel="nofollow">1.统计行数</a></p> 
<p id="2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%99%BE%E5%88%86%E6%AF%94-toc" style="margin-left:40px;"><a href="#2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%99%BE%E5%88%86%E6%AF%94" rel="nofollow">2.查看当前内存使用百分比</a></p> 
<p id="3.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dcpu%E7%A9%BA%E9%97%B2%E7%8E%87-toc" style="margin-left:40px;"><a href="#3.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dcpu%E7%A9%BA%E9%97%B2%E7%8E%87" rel="nofollow">3.查看当前cpu空闲率</a></p> 
<p id="4.%E6%98%BE%E7%A4%BA%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%AC%A1%E9%87%8D%E5%90%AF%E6%97%B6%E9%97%B4-toc" style="margin-left:40px;"><a href="#4.%E6%98%BE%E7%A4%BA%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%AC%A1%E9%87%8D%E5%90%AF%E6%97%B6%E9%97%B4" rel="nofollow">4.显示系统上次重启时间</a></p> 
<p id="5.getline%E7%9A%84%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#5.getline%E7%9A%84%E4%BD%BF%E7%94%A8" rel="nofollow">5.getline的使用</a></p> 
<p id="%E5%9B%9B%E3%80%81BEGIN%EF%BC%8CEND%E6%A8%A1%E5%BC%8F-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81BEGIN%EF%BC%8CEND%E6%A8%A1%E5%BC%8F" rel="nofollow">四、BEGIN，END模式</a></p> 
<p id="%C2%A01.awk%E6%95%B0%E7%BB%84-toc" style="margin-left:40px;"><a href="#%C2%A01.awk%E6%95%B0%E7%BB%84" rel="nofollow"> 1.awk数组</a></p> 
<p id="2.%E8%BF%87%E6%BB%A4%E6%96%87%E6%9C%AC%E4%B8%AD%E9%87%8D%E5%A4%8D%E8%A1%8C%E6%95%B0-toc" style="margin-left:40px;"><a href="#2.%E8%BF%87%E6%BB%A4%E6%96%87%E6%9C%AC%E4%B8%AD%E9%87%8D%E5%A4%8D%E8%A1%8C%E6%95%B0" rel="nofollow">2.过滤文本中重复行数</a></p> 
<p id="-toc" style="margin-left:40px;"><a href="#" rel="nofollow">3.过滤访问本机密码输入失败的命令</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81awk%E6%A6%82%E8%BF%B0">一、awk概述</h2> 
<p>AWK是一种处理文本文件的语言，是一个强大的文件分析工具。</p> 
<p>它是专门为文本处理设计的编程语言，也是行处理软件，通常用于扫描，过滤，统计汇总等工作，数据可以来自标准输入也可以是管道或文件。</p> 
<h3 id="1.%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">1.工作原理</h3> 
<p>awk逐行读取文本，默认以空格或Tab键为分隔符进行分隔，将分隔所得的各个字段保存到内建变量中，并按模式或条件执行编辑命令。</p> 
<p><strong>与sed命令相比：</strong></p> 
<ul><li>sed命令常用于一整行的处理。</li><li>awk命令倾向于将一行分成多个“字段” 然后再进行处理。awk信息的读入是逐行读取的，执行结果可以通过 print 的功能将字段数据打印显示。在使用 awk 命令的过程中,可以使用逻辑操作符“&amp;&amp;”表示“与”，“||”表示“或”，“!”表示“非”；还可以进行简单的数学运算，如+、-、*、/、%、^分别表示加、减、乘、除、取余和乘方。</li></ul> 
<h3 id="2.%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F">2.语法格式</h3> 
<pre><code class="language-bash">awk 选项 '模式或条件 {操作}' 文件1 文件2

awk -f 脚本文件 文件1 文件2

</code></pre> 
<h3 id="%C2%A03.awk%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F"><strong> 3.awk常用的内建变量</strong></h3> 
<pre><code class="language-bash">FS：列分隔符。指定每行文本的字段分隔符，默认为空格或制表位，与“ -F ”作用相同

OFS：输出分隔符。指定输出字段间的分隔符。

RS：行分隔符。awk从文件读取资料时，将根据RS的定义把资料切割为多条记录，
awk一次仅读取一条记录，以进行处理，预设值为 \n (换行符)

NF：当前处理行的字段个数

NR：当前处理行的行号

FNR：awk当前读取的记录数，其变量值小于等于NR
（比如当读取第二个文件时，FNR是从0开始重新计数，而NR不会）。

NR==FNR：用于在读取两个或两个以上的文件时，判断是不是在读取第一个文件

$0：当前处理行的整行内容

$n：当前处理行的第 n 个字段（第 n 列）

FILENAME：被处理的文件名

</code></pre> 
<h2 id="%E4%BA%8C%E3%80%81%E6%8C%89%E8%A1%8C%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC">二、按行输出文本</h2> 
<h3 id="1.%E8%BE%93%E5%87%BA%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9">1.输出所有内容</h3> 
<pre><code class="language-bash">awk '{print}' a.txt   或
awk '{print $0 }' a.txt
abc
two
three
four
five
six
seven
eight
nine
ten
eleven
twelve</code></pre> 
<h3 id="2.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E8%A1%8C%E5%8F%B7%E7%9A%84%E5%86%85%E5%AE%B9">2.输出指定行号的内容</h3> 
<pre><code class="language-bash">#打印1-3行的行内容
awk 'NR==1,NR==3{print $0}' a.txt
one
two
three
#打印1-3行的行内容，&amp;&amp;表示“与”
awk '(NR&gt;=1)&amp;&amp;(NR&lt;=3){print $0}' a.txt
one
two
three
#打印第1行或第3行的行内容，|| 表示“或”
awk 'NR==1||NR==3{print $0}' a.txt
one
three
#打印行号小于4的行内容，！表示取反
awk '!(NR&gt;4){print $0}' a.txt
one
two
three
four
</code></pre> 
<h3 id="3.%E8%BE%93%E5%87%BA%E5%A5%87%E5%81%B6%E8%A1%8C%E5%86%85%E5%AE%B9">3.输出奇偶行内容</h3> 
<pre><code class="language-bash">#输出奇数行，行号取余=1为奇数行
awk '(NR%2)==1{print $0}' a.txt
one
three
five
seven
nine
eleven
#输出偶数行
awk '(NR%2)==0{print $0}' a.txt
two
four
six
eight
ten
twelve
</code></pre> 
<h3 id="4.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E8%A1%8C%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9">4.输出匹配行的行内容</h3> 
<pre><code class="language-bash">#输出以 n 开头的行内容
awk '/^n/{print $0}' a.txt
nine
#输出以 e 结尾的行内容
awk '/e$/{print $0}' a.txt
one
three
five
nine
twelve
</code></pre> 
<h2 id="%E4%BA%8C%E3%80%81%E6%8C%89%E5%AD%97%E6%AE%B5%E8%BE%93%E5%87%BA%E6%96%87%E6%9C%AC">二、按字段输出文本</h2> 
<h3 id="1.%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5">1.输出指定字段</h3> 
<pre><code class="language-python"># -F 指定分隔符；$1 所在行以分隔符分隔的第一个字段
awk -F ":" '{print $1}' passwd
root
daemon
adm
y
named
lisi
apache
dhcpd
# $NF 表示所在行最后一个字段，NR 表示当前行的行号
awk -F ":" '{print NR,$NF }' passwd
1 /bin/bash
2 /sbin/nologin
3 /sbin/nologin
4 /bin/bash
5 /sbin/nologin
6 /bin/bash
7 /sbin/nologin
8 /sbin/nologin
</code></pre> 
<h3 id="2.%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%8C%87%E5%AE%9A%E5%88%86%E9%9A%94%E7%AC%A6">2.输出结果指定分隔符</h3> 
<pre><code class="language-python">#输出第1和第3个字段，输出结果默认以 空格 分隔
awk -F ":" '{print $1,$3 }' passwd
root 0
daemon 2
adm 3
y 1000
named 25
lisi 1001
apache 48
dhcpd 177

awk -F ":" '{print $1","$3 }' passwd
root,0
daemon,2
adm,3
y,1000
named,25
lisi,1001
apache,48
dhcpd,177

awk -F ":" '{print $1"=="$3 }' passwd
root==0
daemon==2
adm==3
y==1000
named==25
lisi==1001
apache==48
dhcpd==177
</code></pre> 
<h4 id="2.1OFS%E6%8C%87%E5%AE%9A%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%88%86%E9%9A%94%E7%AC%A6">2.1OFS指定输出结果分隔符</h4> 
<pre><code class="language-bash">echo 'A B C D' | awk '{OFS=":";print $0}'
A B C D
# $1=$1 用来激活$0的重新赋值，通常是在改变OFS后而需要输出$0时这样做
echo 'A B C D' | awk '{OFS=":";$1=$1;print $0}'
A:B:C:D
</code></pre> 
<h3 id="3.%E8%BE%93%E5%87%BA%E5%8C%B9%E9%85%8D%E5%AD%97%E6%AE%B5%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9">3.输出匹配字段的行内容</h3> 
<pre><code class="language-python">cat passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
y:x:1000:1000:y:/home/y:/bin/bash
named:x:25:25:Named:/var/named:/sbin/nologin
lisi:x:1001:1001::/home/lisi:/bin/bash
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
dhcpd:x:177:177:DHCP server:/:/sbin/nologin
#输出第3字段大于50的行的第1和第3字段
awk -F ":" '$3&gt;50{print $1,$3}' passwd
y 1000
lisi 1001
dhcpd 177
#输出第7字段中包含/bash的行内容
awk -F ":" '$7~"/bash"{print $0}' passwd
root:x:0:0:root:/root:/bin/bash
y:x:1000:1000:y:/home/y:/bin/bash
lisi:x:1001:1001::/home/lisi:/bin/bash
</code></pre> 
<h3 id="4.%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6">4.三元运算符</h3> 
<p><span style="color:#0d0016;"><strong><span style="background-color:#ffd900;">条件表达式？值1：值2</span></strong></span></p> 
<p><span style="color:#0d0016;">若条件表达式成立，则取值1；反之，取值2。</span></p> 
<pre><code class="language-python">awk -F ":" '{print $3,$4}' passwd
0 0
2 2
3 4
1000 1000
25 25
1001 1001
48 48
177 177
#三元运算符，如果第3个字段的值大于等于第4个字段的值，则把第3个字段的值赋给max，
#否则第4个字段的值赋给max
awk -F ":" '{max=($3&gt;=$4)?$3:$4;{print max}}' passwd
0
2
4
1000
25
1001
48
177</code></pre> 
<h2 id="%E4%B8%89%E3%80%81%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E7%AC%A6%E3%80%81%E5%8F%8C%E5%BC%95%E5%8F%B7%E8%B0%83%E7%94%A8shell%E5%91%BD%E4%BB%A4">三、通过管道符、双引号调用shell命令</h2> 
<h3 id="1.%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0">1.统计行数</h3> 
<pre><code class="language-python">awk -F ":" '/bash$/{print}' passwd 
root:x:0:0:root:/root:/bin/bash
y:x:1000:1000:y:/home/y:/bin/bash
lisi:x:1001:1001::/home/lisi:/bin/bash
#调用 wc -l 统计使用bash的行数
awk -F ":" '/bash$/{print|"wc -l"}' passwd 
3</code></pre> 
<h3 id="2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%99%BE%E5%88%86%E6%AF%94">2.查看当前内存使用百分比</h3> 
<pre><code class="language-python">#查看当前内存使用百分比
free -m | awk '/Mem:/{print int($3/($3+$4)*100)"%"}'
87%</code></pre> 
<h3 id="3.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dcpu%E7%A9%BA%E9%97%B2%E7%8E%87">3.查看当前cpu空闲率</h3> 
<pre><code class="language-python"># -b -n 1 表示只需要1次输出结果
top -b -n 1 | grep Cpu
%Cpu(s):  2.9 us,  2.9 sy,  0.0 ni, 96.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 
#输出cpu空闲率的字段
top -b -n 1 | grep Cpu | awk -F "," '{print $4}'
96.9 id
#输出Cpu空闲率
top -b -n 1 | grep Cpu | awk -F "," '{print $4}' | awk '{print$1}'
96.9
</code></pre> 
<h3 id="4.%E6%98%BE%E7%A4%BA%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%AC%A1%E9%87%8D%E5%90%AF%E6%97%B6%E9%97%B4">4.显示系统上次重启时间</h3> 
<blockquote> 
 <p>date -d      #显示字符串所指的日期与时间。字符串前后必须加上双引号</p> 
 <p>date +"%Y-%m-%d"      #注意 ：+ 和格式之间没有空格</p> 
 <p></p> 
 <p>常用格式：</p> 
 <p>%F：完整日期格式，等价于%Y-%m-%d</p> 
 <p>%Y：年份</p> 
 <p>%m：月份</p> 
 <p>%d：按月计的日期</p> 
 <p>%T：时间，等于%H:%M:%S</p> 
 <p>%H： 小时，24小时制（00~23）</p> 
 <p>%M：分钟</p> 
 <p>%S：秒</p> 
</blockquote> 
<pre><code class="language-python">#查看当前时间
date 
2023年 05月 15日 星期一 16:24:53 CST

#显示当月的第一天
date +"%Y%m01"
20230501

#显示一天前
date -d "1 day ago" +%F
2023-05-14

#显示当月的倒数第三天，1 month 表示下个月的今天，-3 day 表示三天前
date -d "$(date -d "1 month" +"%Y%m01")-3 day" +"%Y%m%d"
20230529

#查看上次系统重启时间
#/proc/uptime 第一列输出的是，系统启动到现在的时间（以秒为单位）；
#第二列输出的是，系统空闲的时间（以秒为单位）
date -d "$(awk -F "." '{print $1}' /proc/uptime) second ago" +"%F %H:%M:%S"
2023-05-11 02:15:22

</code></pre> 
<h3 id="5.getline%E7%9A%84%E4%BD%BF%E7%94%A8">5.getline的使用</h3> 
<p><strong>当getline左右无重定向符“&lt;”或“|”时</strong>，awk首先读取到了第一行，就是1，然后getline，就得到了1下面的行，就是2，因为getline之后，awk会改变对应的NF，NR，FNR和$0等内部变量，所以此时的$0的值就不再是1，而是2了，即<strong>隔行输出。然后将它打印出来</strong>。<br><strong>当getline左右有重定向符“&lt;”或“|”时</strong>，getline则作用于定向输入文件，由于该文件是刚打开，并没有被awk读入一行，只是getline读入，那么<strong>getline返回的是该文件的第一行</strong>，而不是隔行。</p> 
<pre><code class="language-python">#当有重定向符号或 “|” 时，只会输出第1行
awk 'BEGIN {"cat a.txt" |getline; {print }}'
one

#当有重定向符号或 “|” 时，输出奇数行
cat a.txt | awk '{print $0;getline}'
one
three
five
seven
nine
eleven
#输出偶数行
cat a.txt | awk '{getline;print $0}'
two
four
six
eight
ten
twelve
</code></pre> 
<h2 id="%E5%9B%9B%E3%80%81BEGIN%EF%BC%8CEND%E6%A8%A1%E5%BC%8F">四、BEGIN，END模式</h2> 
<p><strong>BEGIN模式：</strong>在处理指定文本之前，需要先执行BEGIN模式中的指定的操作。</p> 
<p><strong>END模式：</strong>在处理指定文本结束后，需要执行END模式中的指定操作</p> 
<pre><code class="language-python">awk '/e$/{print $0}' a.txt
one
three
five
nine
twelve
#统计以 e 结尾的行
awk 'BEGIN{x=0}; /e$/{x++};END{print x}' a.txt
5
#先处理完BEGIN的内容，再打印文本里面的内容
awk 'BEGIN{FS=":"};{if($3&gt;=20){print}}' passwd
y:x:1000:1000:y:/home/y:/bin/bash
named:x:25:25:Named:/var/named:/sbin/nologin
lisi:x:1001:1001::/home/lisi:/bin/bash
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
dhcpd:x:177:177:DHCP server:/:/sbin/nologin

#统计以冒号分隔的文本段落数，END{}语句块中，往往会放入打印结果等语句
echo $PATH | awk 'BEGIN{RS=":"}{print NR,$0};END{print NR}'
1 /usr/local/sbin
2 /usr/local/bin
3 /usr/sbin
4 /usr/bin
5 /root/bin

5
</code></pre> 
<h3 id="%C2%A01.awk%E6%95%B0%E7%BB%84"> 1.awk数组</h3> 
<pre><code class="language-python">#BEGIN中的命令只执行一次
awk 'BEGIN{a[0]=1;a[1]=2;a[2]=3;print a[2]}'
3
#awk数组的下标除了数字，还可以使用字符串，字符串需要使用双引号
awk 'BEGIN{a["q"]="aaa";a["m"]="bbb";a["y"]="ccc";print a["q"]}'
aaa

awk 'BEGIN{a["q"]=1;a["m"]=2;a["y"]=3;for(i in a){print i,a[i]}}'
y 3
m 2
q 1</code></pre> 
<h3 id="2.%E8%BF%87%E6%BB%A4%E6%96%87%E6%9C%AC%E4%B8%AD%E9%87%8D%E5%A4%8D%E8%A1%8C%E6%95%B0">2.过滤文本中重复行数</h3> 
<pre><code class="language-bash">cat b.txt
aaa
bbb
ccc
aaa
aaa
aaa
bbb
bbb
ccc
#将文本的内容作为数组下标，a[$1]++表示出现相同的行，就自加1
awk '{a[$1]++}END{for (i in a){print i,a[i]}}' b.txt
aaa 4
ccc 2
bbb 3
</code></pre> 
<h3>3.过滤访问本机密码输入失败的命令</h3> 
<pre><code class="language-python">#过滤密码输出错误的IP地址及输入次数
awk '/Failed password/{ip[$11]++}END{for(i in ip){print i,ip[i]}}' 
/var/log/secure 
192.168.88.121 4
192.168.88.20 6

#过滤输入次数大于4次的IP地址
awk '/Failed password/{ip[$11]++}END{for(i in ip){print i,ip[i]}}' 
/var/log/secure | awk '$2&gt;4{print $1}'
192.168.88.20

</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7c8f8cd233285618e57400102e71d6c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">程序流程控制（switch、for、while、do_while）和break、continue关键字</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/60db721dbf75f7120d6f8a8d87c3e33a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">详解c&#43;&#43;STL—string组件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>