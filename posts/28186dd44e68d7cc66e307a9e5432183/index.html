<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot的消息转换器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot的消息转换器" />
<meta property="og:description" content="我们制作Web项目时,有时候会遇到Long型长度超过16位的数字,我们的页面就会丢失一定的精度,
例如,我自己尝试了效果:
这里我想着通过员工id禁用员工,代码如下:
后台运行结合We页面进行禁用操作后 这里运行后的结果却不是我们想要的结果,正常情况的是账号状态应该呈现禁用状态,查了数据库
id为1545396580193001474
可是后端数据传到前端数据的id值:1545396580193001500
出现这样的结果的大多因数是Long类型长度超过16位
出现这样的解决方案:
1.配置类转换器类JacksonObjectMapper
:
public class JacksonObjectMapper extends ObjectMapper { public static final String DEFAULT_DATE_FORMAT = &#34;yyyy-MM-dd&#34;; public static final String DEFAULT_DATE_TIME_FORMAT = &#34;yyyy-MM-dd HH:mm:ss&#34;; public static final String DEFAULT_TIME_FORMAT = &#34;HH:mm:ss&#34;; public JacksonObjectMapper() { super(); //收到未知属性时不报异常 this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false); //反序列化时，属性不存在的兼容处理 this.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); SimpleModule simpleModule = new SimpleModule() .addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) .addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))) .addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))) .addSerializer(BigInteger.class, ToStringSerializer.instance) .addSerializer(Long.class, ToStringSerializer.instance) .addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/28186dd44e68d7cc66e307a9e5432183/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-10T11:11:02+08:00" />
<meta property="article:modified_time" content="2022-07-10T11:11:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot的消息转换器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>我们制作Web项目时,有时候会遇到Long型长度超过16位的数字,我们的页面就会丢失一定的精度,</p> 
<p>例如,我自己尝试了效果:</p> 
<p><img alt="" height="153" src="https://images2.imgbox.com/7e/7e/2F5IhzEL_o.png" width="1200"></p> 
<p> 这里我想着通过员工id禁用员工,代码如下:</p> 
<p><img alt="" height="414" src="https://images2.imgbox.com/8c/10/DA01KdxY_o.png" width="1145"></p> 
<p>后台运行结合We页面进行禁用操作后 </p> 
<p><img alt="" height="298" src="https://images2.imgbox.com/4f/79/Pi6ULzuX_o.png" width="1170"></p> 
<p> </p> 
<p> 这里运行后的结果却不是我们想要的结果,正常情况的是账号状态应该呈现禁用状态,查了数据库</p> 
<p><img alt="" height="33" src="https://images2.imgbox.com/bf/aa/1kWhzMLc_o.png" width="1193"></p> 
<p>id为1545396580193001474</p> 
<p>可是后端数据传到前端数据的id值:1545396580193001500</p> 
<p><img alt="" height="34" src="https://images2.imgbox.com/c4/d7/miDCOR9G_o.png" width="1197"></p> 
<p>出现这样的结果的大多因数是Long类型长度超过16位</p> 
<p>出现这样的解决方案:</p> 
<p>1.配置类转换器类JacksonObjectMapper</p> 
<p>:</p> 
<pre><code>public class JacksonObjectMapper extends ObjectMapper {

    public static final String DEFAULT_DATE_FORMAT = "yyyy-MM-dd";
    public static final String DEFAULT_DATE_TIME_FORMAT = "yyyy-MM-dd HH:mm:ss";
    public static final String DEFAULT_TIME_FORMAT = "HH:mm:ss";

    public JacksonObjectMapper() {
        super();
        //收到未知属性时不报异常
        this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false);

        //反序列化时，属性不存在的兼容处理
        this.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);


        SimpleModule simpleModule = new SimpleModule()
                .addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))
                .addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))
                .addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))

                .addSerializer(BigInteger.class, ToStringSerializer.instance)
                .addSerializer(Long.class, ToStringSerializer.instance)
                .addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))
                .addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))
                .addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));

        //注册功能模块 例如，可以添加自定义序列化器和反序列化器
        this.registerModule(simpleModule);
    }
}
</code></pre> 
<p> 2.宽展MVC框架的消息转换器</p> 
<p>创建配置类:WebmvcConfig</p> 
<pre><code>@Slf4j
@Configuration
public class WebmvcConfig extends WebMvcConfigurationSupport {

    @Override
    protected void extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        //创建消息转换器
        MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
        //添加消息转换类
        converter.setObjectMapper(new JacksonObjectMapper());
        //添加索引
        converters.add(0,converter);
    }
}
</code></pre> 
<p>配置后,重启项目后就没问题了</p> 
<p><img alt="" height="301" src="https://images2.imgbox.com/01/39/QIQlkeJ8_o.png" width="1200"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2e9fe866d195cc03e6bcb1482f74b22/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySql使用存储过程开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6f424ce8d6c1be78ecd2a1714a78633/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">easyExcel导出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>