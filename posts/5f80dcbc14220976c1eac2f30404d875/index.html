<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pyinstaller遇到的问题总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pyinstaller遇到的问题总结" />
<meta property="og:description" content="pyinstaller遇到的问题总结 1.RecursionError: maximum recursion depth exceeded 解决步骤：
1)pyinstaller -F xxx.py
​ 这一步肯定会报上述错误导致失败，但是会产生一个xxx.spec文件
2)在xxx.spec文件中增加两行(添加在原文件第二行):
import sys sys.setrecursionlimit(5000) 3)pyinstaller xxx.spec
打包成功。
2.UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xce in position 解决方法：在你打包的命令行中先输入chcp 65001 然后再输入打包命令。
3.WARNING: file already exists but should not: C:\…\…\…\Local\Temp_MEI58962\include\pyconfig.h 报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时pyconfig.h多打了一次，所以会报已经存在了。这个解决方案就是把多余的pyconfig.h去掉。具体解决方法如下：
在自动生成的xxx.spec中，添加如下代码，去掉多余依赖项：
#add_begin for d in a.datas: if &#39;pyconfig&#39; in d[0]: a.datas.remove(d) break #add_end 位置在a后面，pyz前面。
4.WARNING: file already exists but should not: C:\…\…\…\Local\Temp_MEI165842\torchvision_C.cp37-win_amd64.pyd 这个试了挺多办法，还未解决，有解决了的大哥麻烦告知一下，感激不尽！！！
5.最麻烦的，torch和torchvision打包问题，exe在自己电脑上能用，在其他电脑上就报错如下： 其实主要问题是pyinstaller不支持torchvision在0.3.0以上的版本。但是，要给torchvision降级什么的·····不多说了，懂的都懂！！！
[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-rT1z876E-1600249368225)(https://user-images.githubusercontent.com/34004152/74804720-5e0c1680-5324-11ea-8974-ce18e0692b42.png)]
所以，真解决方案：在GitHub上找到了大佬的解决方法：
这里详细说一下：在主文件，也就是你要打包的文件头部添加
def script_method(fn, _rcb=None): return fn def script(obj, optimize=True, _frames_up=0, _rcb=None): return obj import torch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5f80dcbc14220976c1eac2f30404d875/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-16T17:44:20+08:00" />
<meta property="article:modified_time" content="2020-09-16T17:44:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pyinstaller遇到的问题总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="pyinstaller_0"></a>pyinstaller遇到的问题总结</h2> 
<h3><a id="1RecursionError_maximum_recursion_depth_exceeded_2"></a>1.RecursionError: maximum recursion depth exceeded</h3> 
<p>解决步骤：</p> 
<p><strong>1)pyinstaller -F xxx.py</strong></p> 
<p>​ 这一步肯定会报上述错误导致失败，但是会产生一个xxx.spec文件</p> 
<p><strong>2)在xxx.spec文件中增加两行(添加在原文件第二行):</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
sys<span class="token punctuation">.</span>setrecursionlimit<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>3)pyinstaller xxx.spec</strong></p> 
<p>打包成功。</p> 
<h3><a id="2UnicodeDecodeError_utf8_codec_cant_decode_byte_0xce_in_position_21"></a>2.UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xce in position</h3> 
<p>解决方法：在你打包的命令行中先输入<code>chcp 65001</code> 然后再输入打包命令。</p> 
<h3><a id="3WARNING_file_already_exists_but_should_not_CLocalTemp_MEI58962includepyconfigh_25"></a>3.WARNING: file already exists but should not: C:\…\…\…\Local\Temp_MEI58962\include\pyconfig.h</h3> 
<p>报错内容可能不同，但都是xxx已存在，问题的原因是pyinstaller打包时pyconfig.h多打了一次，所以会报已经存在了。这个解决方案就是把多余的pyconfig.h去掉。具体解决方法如下：</p> 
<p>在自动生成的xxx.spec中，添加如下代码，去掉多余依赖项：</p> 
<pre><code class="prism language-python"><span class="token comment">#add_begin</span>
<span class="token keyword">for</span> d <span class="token keyword">in</span> a<span class="token punctuation">.</span>datas<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'pyconfig'</span> <span class="token keyword">in</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        a<span class="token punctuation">.</span>datas<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token comment">#add_end</span>
</code></pre> 
<p>位置在a后面，pyz前面。</p> 
<h3><a id="4WARNING_file_already_exists_but_should_not_CLocalTemp_MEI165842torchvision_Ccp37win_amd64pyd_42"></a>4.WARNING: file already exists but should not: C:\…\…\…\Local\Temp_MEI165842\torchvision_C.cp37-win_amd64.pyd</h3> 
<p>这个试了挺多办法，还未解决，有解决了的大哥麻烦告知一下，感激不尽！！！</p> 
<h3><a id="5torchtorchvisionexe_46"></a>5.最麻烦的，torch和torchvision打包问题，exe在自己电脑上能用，在其他电脑上就报错如下：</h3> 
<p>其实主要问题是pyinstaller不支持torchvision在0.3.0以上的版本。但是，要给torchvision降级什么的·····不多说了，懂的都懂！！！</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-rT1z876E-1600249368225)(https://user-images.githubusercontent.com/34004152/74804720-5e0c1680-5324-11ea-8974-ce18e0692b42.png)]</p> 
<p>所以，真解决方案：在GitHub上找到了大佬的解决方法：</p> 
<p>这里详细说一下：在主文件，也就是你要打包的文件头部添加</p> 
<pre><code>def script_method(fn, _rcb=None):
    return fn
def script(obj, optimize=True, _frames_up=0, _rcb=None):
    return obj
import torch.jit
torch.jit.script_method = script_method
torch.jit.script = script
</code></pre> 
<p>不过记得添加在import torch后面，否则会报错。</p> 
<p>有的可能在这一步就好了，但是，可能会发现打包出来的exe文件没有变大，因为torch和torchvision之类的库并没有打包进exe，于是在其他电脑上运行依然报错。这里就要修改spec文件了，在a = Analysis里修改path和hiddenimports：</p> 
<pre><code>datas=[(path.join(site_packages,"torch"), "torch"),
                (path.join(site_packages,"torchvision"), "torchvision"),
                (path.join(site_packages,"cv2"), "cv2")],
             hiddenimports=['torch', 'torchvision', 'cv2'],
</code></pre> 
<p>这里我的site_packages在"F:\Anaconda3\Lib\site-packages"，即自己电脑anaconda里的拓展库位置。</p> 
<p>其实这不可能也不行，但是这时候我正好注意到了pyinstaller xxx.spec时所报的信息：</p> 
<p><img src="https://images2.imgbox.com/c3/33/wEbjW8C4_o.png" alt="image-20200916172325903"></p> 
<p>注意到那一堆warning没，这张图是没问题的图，这些warning暂时没发现有啥影响，但在之前还有其他warning的，是torch和torchvision报的，也是缺少dll，不过这些dll在电脑上其实都有，只是pyinstaller太蠢了，找不到，都在"site-packages"里，把他们一个个找到复制到要打包文件目录就行了，我这里需要的文件如下图：</p> 
<p><img src="https://images2.imgbox.com/2f/9c/V6aiIuEl_o.png" alt="image-20200916172719088"></p> 
<p>这些dll都是我一个个搜索，然后复制过来的，每个人的torch和torchvision版本都可能不一样，大家各找各的就行了。</p> 
<p>顺带一提，我的环境是：</p> 
<pre><code>cuda = 10.0
torch = 1.1.0
torchvision = 0.3.0
</code></pre> 
<p>这样应该就么得问题了，我看见有人OpenCV打包也遇到类似问题，我这里也收集一下解决方法：</p> 
<p>首先也是把opencv_videoio_ffmpeg430_64.dll复制到主文件夹下，这个也是每个人的版本都不一样的，然后在主代码里加上一段：</p> 
<pre><code>import ctypes

try:
    temp = ctypes.windll.LoadLibrary('opencv_videoio_ffmpeg430_64.dll')

except:
    pass
</code></pre> 
<p>应该就好了。</p> 
<h3><a id="_115"></a>是不是以为完了？？？？？？？？</h3> 
<p>我还遇见其他问题了，，，，</p> 
<p>因为我需要用到mmcv这个库，但它只要一打包就绝对出问题，，，</p> 
<p><img src="https://images2.imgbox.com/d2/a5/IdFgGh79_o.png" alt="image-20200916173610493"></p> 
<p>顺藤摸瓜，File “setuptools\depends.py”, line 6, 在这里，我们进去看看：</p> 
<p><img src="https://images2.imgbox.com/f7/bb/NxxjzgUz_o.png" alt="image-20200916173717746"></p> 
<p>长得不咋地，，，挺能折腾我。</p> 
<p>是因为绝对路径问题吧，好像pyinstaller可以冻结路径，懒得搞了，改成这样子就行了，不过事后记得改回来，不然在自己电脑上以后可能会报错！！！！</p> 
<pre><code>from py33compat import Bytecode
from py27compat import find_module, PY_COMPILED, PY_FROZEN, PY_SOURCE
import py27compat
</code></pre> 
<p>到这里就告一段落了，如果有类似问题可以给我留言，万一我那天想起这个账号了随手登录看见了可以一起讨论下！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0efd7cfa641ada5c6e815b9ddb297060/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python开发Windows桌面应用程序（一）PyCharm&#43;PyQt5开发环境搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44dc063d1922a1235d8d674713eda6d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">选中多行多光标进行操作及一些常用的命令(快捷键)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>