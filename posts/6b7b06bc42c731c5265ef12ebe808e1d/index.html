<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32 编码器驱动/旋转编码器旋钮encoder - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32 编码器驱动/旋转编码器旋钮encoder" />
<meta property="og:description" content="本文已比较纯粹的方式介绍编码器和驱动的编写
编码器最少有两个输出信号，一种典型的结构如上图所示。AB是编码器的输出引脚。当触点和黄色的金属片接触的时候信号发生跳变沿，可以上上升沿也可以是下降沿，具体根据AB引脚默认的电平状态，和金属片电平状态。
当编码器转过一段角度后就会出现上图的波形。AB信号交替出现脉冲。上图所示的状态。B还在金属片上B是高电平,A已经不再金属片上恢复默认电平低。逆时针转动时，A触点比B触点先接触到金属片。所以A的高电平超前B的高电平。超前多少，根据金属片的长度和AB触点的间距决定。所以当顺时针转动的时候，B触点比A触点先接触到金属片。
根据这样的特点可以，从AB出现脉冲的先后可以判别出旋转的方向。脉冲的个数可以判断出转了多少角度。
实际波形
上通道为A，下通道为B
下图为正逆时针旋转
下图为顺时针旋转
对于数字输入输出的MCU来说，可以使用三种方式来实现编码器的驱动
1.GPIO抽样法 按照一定的时间间隔去采集AB触点的电平，根据电平的状态去判别脉冲计数。
上图所示，I:A出现低电平时，B是高电平。出现第一张图顺时针的状态。
II: B是低电平的时候，A是高电平，说明出现第二张图的状态。
抽样法关键在于测量到上述I，II的特征电平。抽样的时间需要根据旋转编码器的最快速度来进行设定，已保证能够采样到特征电平。
一般来说手工扭动的旋转编码器的采样间隔可以是1ms
代码如下，输入参数gpio1,gpio2为AB项的电平值。需要1ms为周期进行采样
encoder_poision_cnt 为脉冲计数器
encoder_dir 为方向
实验结果还不错，虽然看上去简单，但是其稳定性不错。
void task2_task(void *pvParameters) { while(1) { encoder_gpio_in = GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_10); encoder_gpio_in2 = GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_11); encoder_dir = app_encoder_gpio_mes_test(encoder_gpio_in,encoder_gpio_in2); vTaskDelay(1); } } uint16_t app_encoder_gpio_mes_test(uint16_t gpio1,uint16_t gpio2) { static char lock=0; static uint16_t knob_dir =0; if((gpio1 == 0 &amp;&amp; gpio2 ==1)&amp;(!lock)) { lock =1; knob_dir= 1; encoder_poision_cnt&#43;&#43;; } else if((gpio2 ==0 &amp;&amp; gpio1==1)&amp;(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6b7b06bc42c731c5265ef12ebe808e1d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-25T14:02:19+08:00" />
<meta property="article:modified_time" content="2022-01-25T14:02:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32 编码器驱动/旋转编码器旋钮encoder</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文已比较纯粹的方式介绍编码器和驱动的编写<br> <img src="https://images2.imgbox.com/37/bc/Y1JJWcfj_o.png" alt="在这里插入图片描述"><br> 编码器最少有两个输出信号，一种典型的结构如上图所示。AB是编码器的输出引脚。当触点和黄色的金属片接触的时候信号发生跳变沿，可以上上升沿也可以是下降沿，具体根据AB引脚默认的电平状态，和金属片电平状态。<br> <img src="https://images2.imgbox.com/a5/86/rstE6cDj_o.png" alt="在这里插入图片描述"><br> 当编码器转过一段角度后就会出现上图的波形。AB信号交替出现脉冲。上图所示的状态。B还在金属片上B是高电平,A已经不再金属片上恢复默认电平低。逆时针转动时，A触点比B触点先接触到金属片。所以A的高电平超前B的高电平。超前多少，根据金属片的长度和AB触点的间距决定。所以当顺时针转动的时候，B触点比A触点先接触到金属片。<br> 根据这样的特点可以，从AB出现脉冲的先后可以判别出旋转的方向。脉冲的个数可以判断出转了多少角度。</p> 
<p>实际波形<br> 上通道为A，下通道为B<br> 下图为正逆时针旋转<br> <img src="https://images2.imgbox.com/e6/42/KSL6IQNZ_o.png" alt="在这里插入图片描述"><br> 下图为顺时针旋转<br> <img src="https://images2.imgbox.com/70/31/RMdJjOHp_o.png" alt="在这里插入图片描述"></p> 
<p>对于数字输入输出的MCU来说，可以使用三种方式来实现编码器的驱动</p> 
<h3><a id="1GPIO_16"></a>1.GPIO抽样法</h3> 
<p>按照一定的时间间隔去采集AB触点的电平，根据电平的状态去判别脉冲计数。<br> 上图所示，I:A出现低电平时，B是高电平。出现第一张图顺时针的状态。<br> II: B是低电平的时候，A是高电平，说明出现第二张图的状态。<br> 抽样法关键在于测量到上述I，II的特征电平。抽样的时间需要根据旋转编码器的最快速度来进行设定，已保证能够采样到特征电平。</p> 
<p>一般来说手工扭动的旋转编码器的采样间隔可以是1ms<br> 代码如下，输入参数gpio1,gpio2为AB项的电平值。需要1ms为周期进行采样<br> encoder_poision_cnt 为脉冲计数器<br> encoder_dir 为方向<br> 实验结果还不错，虽然看上去简单，但是其稳定性不错。</p> 
<pre><code class="prism language-c">
<span class="token keyword">void</span> <span class="token function">task2_task</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
		encoder_gpio_in <span class="token operator">=</span>    <span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
		encoder_gpio_in2 <span class="token operator">=</span> <span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_11<span class="token punctuation">)</span><span class="token punctuation">;</span>
		encoder_dir <span class="token operator">=</span>  <span class="token function">app_encoder_gpio_mes_test</span><span class="token punctuation">(</span>encoder_gpio_in<span class="token punctuation">,</span>encoder_gpio_in2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
<span class="token class-name">uint16_t</span> <span class="token function">app_encoder_gpio_mes_test</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> gpio1<span class="token punctuation">,</span><span class="token class-name">uint16_t</span> gpio2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">char</span> lock<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token class-name">uint16_t</span> knob_dir <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	 
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gpio1 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> gpio2 <span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">!</span>lock<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    	lock <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    	knob_dir<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		encoder_poision_cnt<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gpio2 <span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> gpio1<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">!</span>lock<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		lock <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		knob_dir <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>encoder_poision_cnt<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
			encoder_poision_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gpio2 <span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> gpio1<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		lock <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		knob_dir<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
	
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> knob_dir<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="2_75"></a>2.中断法</h3> 
<p>由于编码器是金属触点，所以必然会出现抖动。抖动对于响应快速的外部中断来说是一个比较麻烦的问题。<br> 根据抖动的持续时间，可以做一个简单的延时滤波。<br> 原理是AB接触到触点时，会发生电平的跳边沿，跳边沿触发中断后，判断电平的状态。从而按照1的方法判别</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">app_encoder_it_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*PA10  PA11  encoder In*/</span>
	NVIC_InitTypeDef   NVIC_InitStruct<span class="token punctuation">;</span>
	EXTI_InitTypeDef   EXTI_InitStruct<span class="token punctuation">;</span>

	<span class="token comment">/*exti line config*/</span>
	EXTI_InitStruct<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span>EXTI_Line10<span class="token punctuation">;</span>
	EXTI_InitStruct<span class="token punctuation">.</span>EXTI_LineCmd <span class="token operator">=</span>ENABLE <span class="token punctuation">;</span>
	EXTI_InitStruct<span class="token punctuation">.</span>EXTI_Mode <span class="token operator">=</span>EXTI_Mode_Interrupt<span class="token punctuation">;</span>
	EXTI_InitStruct<span class="token punctuation">.</span>EXTI_Trigger <span class="token operator">=</span> EXTI_Trigger_Falling<span class="token punctuation">;</span>
	<span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	EXTI_InitStruct<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span>EXTI_Line11<span class="token punctuation">;</span>
	<span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PinSource10<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PinSource11<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*NVIC config*/</span>
	NVIC_InitStruct<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span>EXTI15_10_IRQn<span class="token punctuation">;</span>
	NVIC_InitStruct<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span>ENABLE <span class="token punctuation">;</span>
	NVIC_InitStruct<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>
	NVIC_InitStruct<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


	<span class="token function">NVIC_Init</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>NVIC_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">do_things</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
		i<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">EXTI15_10_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">char</span> lock<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token class-name">uint16_t</span> knob_dir <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token function">do_things</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* simple filter */</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EXTI_GetITStatus</span><span class="token punctuation">(</span>EXTI_Line10<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	
		<span class="token comment">/*Rising or Falling or noise*/</span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_10<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/*Rising*/</span>
		  <span class="token punctuation">{<!-- --></span>
		  	
		  <span class="token punctuation">}</span>
		  <span class="token keyword">else</span><span class="token comment">/*Falling*/</span> 	
		  <span class="token punctuation">{<!-- --></span>	
		 
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_11<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					encoder_poision_cnt<span class="token operator">++</span><span class="token punctuation">;</span>
					knob_dir <span class="token operator">=</span> FORWORD<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
		  
		  <span class="token punctuation">}</span>

		<span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span>EXTI_Line10<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">EXTI_GetITStatus</span><span class="token punctuation">(</span>EXTI_Line11<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		
		 <span class="token comment">/*Rising or Falling or noise*/</span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_11<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/*Rising*/</span>
		  <span class="token punctuation">{<!-- --></span>		
		
		  		
		  		
		  <span class="token punctuation">}</span>
		  <span class="token keyword">else</span> <span class="token comment">/*Falling*/</span>
		  <span class="token punctuation">{<!-- --></span>
		  	
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_Pin_10<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span>encoder_poision_cnt<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		  	<span class="token punctuation">{<!-- --></span>
				encoder_poision_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
				knob_dir <span class="token operator">=</span> BACKWORD<span class="token punctuation">;</span>
		  	<span class="token punctuation">}</span>
		  <span class="token punctuation">}</span>
		  
		<span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span>EXTI_Line11<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="3TIM__169"></a>3.使用TIM 的编码器模块</h3> 
<p>STM32 的TIM模块自己带encoder的接口，可以不在CPU的参与下自己动进行方向，脉冲计数。<br> 需要用户去读取CNT和DIR的数值已获取计数值和旋转方向。<br> TIM模块庞大复杂，如果不熟悉该模块可以使用上面的基础方法。<br> 代码如下</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">app_encoder_tim_gpio_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	GPIO_InitTypeDef   GPIO_InitStruct<span class="token punctuation">;</span>
	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>


	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Pin  <span class="token operator">=</span>GPIO_Pin_8<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span>GPIO_Speed_10MHz<span class="token punctuation">;</span>

	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Pin  <span class="token operator">=</span>GPIO_Pin_9<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span>GPIO_Speed_10MHz<span class="token punctuation">;</span>

	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">app_encoder_tim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">app_encoder_tim</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	

	TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure<span class="token punctuation">;</span>
	TIM_ICInitTypeDef    TIM_ICInitStructure<span class="token punctuation">;</span>


	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_TIM1<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">;</span> <span class="token comment">// No prescaling </span>
	
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span> 
	
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_ClockDivision <span class="token operator">=</span> TIM_CKD_DIV1<span class="token punctuation">;</span>
	
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_CounterMode <span class="token operator">=</span> TIM_CounterMode_Up<span class="token punctuation">;</span> 
	
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 

	<span class="token function">TIM_ICStructInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TIM_ICInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	TIM_ICInitStructure<span class="token punctuation">.</span>TIM_ICFilter <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//ICx_FILTER;</span>
	
	<span class="token function">TIM_ICInit</span><span class="token punctuation">(</span>TIM1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_ICInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

	TIM1<span class="token operator">-&gt;</span>CNT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	
	<span class="token function">TIM_EncoderInterfaceConfig</span><span class="token punctuation">(</span>TIM1<span class="token punctuation">,</span> TIM_EncoderMode_TI12<span class="token punctuation">,</span> TIM_ICPolarity_Rising<span class="token punctuation">,</span>TIM_ICPolarity_Rising<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM1<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d924aa54c4dca249747a68f0bd39ce87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">全面了解环保HJ212协议和使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50234692a9394b6616b8b1bb166cb386/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Qt学习之C&#43;&#43;基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>