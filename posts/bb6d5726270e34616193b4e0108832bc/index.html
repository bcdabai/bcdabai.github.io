<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jenkins利用阿里镜像仓库部署springboot应用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jenkins利用阿里镜像仓库部署springboot应用" />
<meta property="og:description" content="Jenkins利用阿里镜像仓库部署springboot应用 一、本次目标二、环境准备三、jenkins创建项目1、添加全局配置参数，这里我配置了版本号信息2、源码配置3、maven打包&amp;docker镜像包生成4、远程机器执行部署脚本 四、构建五、访问测试 一、本次目标 使用jenkins将gitee代码库中的代码编译后打成docker镜像包并发布到阿里云个人镜像仓库，之后在远程服务部署该镜像包
二、环境准备 阿里云镜像仓库
登陆阿里云查找“容器镜像服务”
进入容器镜像服务
我们需要在jenkins所在的机器上进行授权，否则编译打包好的docker镜像无法推送至阿里的镜像仓库中，可以参考下文
docker推送镜像至阿里私有镜像仓库
进入到个人实例
# 登陆授权 docker login --username=自己的用户名 registry.cn-hangzhou.aliyuncs.com # 取消授权 docker logout registry.cn-hangzhou.aliyuncs.com 授权完成之后我们就可以正常向阿里镜像仓库推送docker镜像文件了。
三、jenkins创建项目 1、添加全局配置参数，这里我配置了版本号信息 2、源码配置 3、maven打包&amp;docker镜像包生成 4、远程机器执行部署脚本 完整的配置信息如下图
本次部署涉及到几个重要的脚本如下：
Dockerfile文件内容如下：
# 该镜像需要依赖的基础镜像 FROM java:8 # 指定维护者的名字 MAINTAINER zhanghang VOLUME /tmp RUN echo &#34;export LC_ALL=zh_CN.UTF-8&#34; &gt;&gt; /etc/profile ENV TZ=Asia/Shanghai RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # 将当前目录下的jar包复制到docker容器的/目录下 ADD ./target/button_swagger.jar button_swagger.jar RUN bash -c &#39;touch /button_swagger." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bb6d5726270e34616193b4e0108832bc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-24T09:52:55+08:00" />
<meta property="article:modified_time" content="2023-02-24T09:52:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jenkins利用阿里镜像仓库部署springboot应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Jenkins利用阿里镜像仓库部署springboot应用</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、本次目标</a></li><li><a href="#_4" rel="nofollow">二、环境准备</a></li><li><a href="#jenkins_25" rel="nofollow">三、jenkins创建项目</a></li><li><ul><li><a href="#1_26" rel="nofollow">1、添加全局配置参数，这里我配置了版本号信息</a></li><li><a href="#2_29" rel="nofollow">2、源码配置</a></li><li><a href="#3mavendocker_31" rel="nofollow">3、maven打包&amp;docker镜像包生成</a></li><li><a href="#4_33" rel="nofollow">4、远程机器执行部署脚本</a></li></ul> 
  </li><li><a href="#_106" rel="nofollow">四、构建</a></li><li><a href="#_110" rel="nofollow">五、访问测试</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、本次目标</h2> 
<p>使用jenkins将gitee代码库中的代码编译后打成docker镜像包并发布到阿里云个人镜像仓库，之后在远程服务部署该镜像包</p> 
<h2><a id="_4"></a>二、环境准备</h2> 
<p><a href="https://account.aliyun.com/login/login.htm?oauth_callback=https://cr.console.aliyun.com/cn-hangzhou/instances&amp;lang=zh" rel="nofollow">阿里云镜像仓库</a><br> 登陆阿里云查找“容器镜像服务”<br> <img src="https://images2.imgbox.com/73/22/QnUjpNOK_o.png" alt="在这里插入图片描述"><br> 进入容器镜像服务<br> <img src="https://images2.imgbox.com/b0/01/OsLvaXgs_o.png" alt="在这里插入图片描述"><br> 我们需要在jenkins所在的机器上进行授权，否则编译打包好的docker镜像无法推送至阿里的镜像仓库中，可以参考下文<br> <a href="https://blog.csdn.net/qq_26709459/article/details/128726699">docker推送镜像至阿里私有镜像仓库</a><br> 进入到个人实例<br> <img src="https://images2.imgbox.com/91/65/7w8Wow6N_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># 登陆授权</span>
<span class="token function">docker</span> login <span class="token parameter variable">--username</span><span class="token operator">=</span>自己的用户名 registry.cn-hangzhou.aliyuncs.com
<span class="token comment"># 取消授权</span>
<span class="token function">docker</span> <span class="token builtin class-name">logout</span> registry.cn-hangzhou.aliyuncs.com
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/52/x31psw0e_o.png" alt="在这里插入图片描述"></p> 
<p>授权完成之后我们就可以正常向阿里镜像仓库推送docker镜像文件了。</p> 
<h2><a id="jenkins_25"></a>三、jenkins创建项目</h2> 
<h3><a id="1_26"></a>1、添加全局配置参数，这里我配置了版本号信息</h3> 
<p><img src="https://images2.imgbox.com/6a/86/LMEStBVY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_29"></a>2、源码配置</h3> 
<p><img src="https://images2.imgbox.com/92/75/YW27sEVz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3mavendocker_31"></a>3、maven打包&amp;docker镜像包生成</h3> 
<p><img src="https://images2.imgbox.com/9a/db/JIoaCjqQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_33"></a>4、远程机器执行部署脚本</h3> 
<p><img src="https://images2.imgbox.com/fc/25/6NIZVsdc_o.png" alt="在这里插入图片描述"><br> 完整的配置信息如下图<br> <img src="https://images2.imgbox.com/be/c6/ywT0fRPu_o.png" alt="在这里插入图片描述"><br> 本次部署涉及到几个重要的脚本如下：<br> Dockerfile文件内容如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 该镜像需要依赖的基础镜像</span>
FROM java:8
<span class="token comment"># 指定维护者的名字</span>
MAINTAINER zhanghang
VOLUME /tmp
RUN <span class="token builtin class-name">echo</span> <span class="token string">"export LC_ALL=zh_CN.UTF-8"</span>  <span class="token operator">&gt;&gt;</span>  /etc/profile
ENV <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
RUN <span class="token function">ln</span> <span class="token parameter variable">-snf</span> /usr/share/zoneinfo/<span class="token variable">$TZ</span> /etc/localtime <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$TZ</span> <span class="token operator">&gt;</span> /etc/timezone
<span class="token comment"># 将当前目录下的jar包复制到docker容器的/目录下</span>
ADD ./target/button_swagger.jar button_swagger.jar
RUN <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">'touch /button_swagger.jar'</span>

expose <span class="token number">8099</span>
<span class="token comment"># 指定docker容器启动时运行jar包</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span>,<span class="token string">"-jar"</span>,<span class="token string">"/button_swagger.jar"</span><span class="token punctuation">]</span>
</code></pre> 
<p>deploy.sh脚本内容如下：</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">imagename</span><span class="token operator">=</span>button-swagger
<span class="token assign-left variable">container</span><span class="token operator">=</span>button-swagger
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> button-swagger:<span class="token variable">$version</span> <span class="token builtin class-name">.</span>
<span class="token function">docker</span> tag button-swagger:<span class="token variable">$version</span> registry.cn-hangzhou.aliyuncs.com/zhanghangns/button-swagger:<span class="token variable">$version</span>
<span class="token function">docker</span> push registry.cn-hangzhou.aliyuncs.com/zhanghangns/button-swagger:<span class="token variable">$version</span>
<span class="token builtin class-name">echo</span> <span class="token string">"执行docker images"</span>
<span class="token function">docker</span> images 
<span class="token builtin class-name">echo</span> <span class="token string">"----开始删除本地镜像----"</span>
<span class="token function">docker</span> rmi button-swagger:<span class="token variable">$version</span>
<span class="token function">docker</span> rmi registry.cn-hangzhou.aliyuncs.com/zhanghangns/button-swagger:<span class="token variable">$version</span>
<span class="token builtin class-name">echo</span> <span class="token string">"----删除本地镜像完成----"</span>
</code></pre> 
<p>button-swagger.sh脚本内容如下：</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">imagename</span><span class="token operator">=</span>button-swagger
<span class="token assign-left variable">container</span><span class="token operator">=</span>button-swagger
<span class="token builtin class-name">echo</span> <span class="token string">"远程机器执行docker ps"</span>
<span class="token function">docker</span> <span class="token function">ps</span> 
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> inspect $container <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> /dev/null <span class="token operator">|</span> <span class="token function">grep</span> $container<span class="token variable">)</span></span>"</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">then</span> 
  <span class="token builtin class-name">echo</span> <span class="token variable">$container</span> <span class="token string">"容器存在，停止并删除"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"docker stop"</span> <span class="token variable">$container</span>
  <span class="token function">docker</span> stop <span class="token variable">$container</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"docker rm"</span> <span class="token variable">$container</span>
  <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$container</span>
<span class="token keyword">else</span> 
  <span class="token builtin class-name">echo</span> <span class="token variable">$container</span> <span class="token string">"容器不存在"</span>
<span class="token keyword">fi</span>
<span class="token comment"># 删除镜像</span>
<span class="token builtin class-name">echo</span> <span class="token string">"远程机器执行docker images"</span>
<span class="token function">docker</span> images 
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span> $imagesname <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> /dev/null<span class="token variable">)</span></span>"</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">then</span> 
  <span class="token builtin class-name">echo</span> <span class="token variable">$imagesname</span> <span class="token string">'镜像存在，删除它'</span>
  <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span> $imagesname <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> /dev/null<span class="token variable">)</span></span>
<span class="token keyword">else</span> 
  <span class="token builtin class-name">echo</span> <span class="token variable">$imagesname</span> <span class="token string">'不存在'</span>
<span class="token keyword">fi</span>
<span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/zhanghangns/button-swagger:<span class="token variable">$version</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> button-swagger <span class="token parameter variable">-p</span> <span class="token number">8099</span>:8099 registry.cn-hangzhou.aliyuncs.com/zhanghangns/button-swagger:<span class="token variable">$version</span>
</code></pre> 
<h2><a id="_106"></a>四、构建</h2> 
<p><img src="https://images2.imgbox.com/99/69/VIQk06sp_o.png" alt="在这里插入图片描述"><br> 查看部署log<br> <img src="https://images2.imgbox.com/d5/df/BN31u3cE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_110"></a>五、访问测试</h2> 
<p>http://ip:port/swagger-ui.html#/<br> <img src="https://images2.imgbox.com/7a/13/Zh8GvTjn_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53b94f239c4d215144d0aa8d559e99f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringMVC学习（一）——快速搭建SpringMVC开发环境（非注解方式）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39c2edd52613ce6fbeb55934a5044c9d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">node.js从控制台中获取数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>